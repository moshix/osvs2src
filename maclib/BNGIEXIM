         PRINT OFF                                                      00050000
         MACRO                                                          00100000
&NAME    BNGHJN &LABEL,&HJN                                             00150000
         LCLA  &K                                                       00200000
         LCLC  &HJA,&HJB,&HJC                                           00250000
&HJC     SETC  'PTF NO.'                                                00300000
&K       SETA  K'&SYSPARM                                               00350000
         AIF   (&K LT 4).CODE                                           00400000
&HJA     SETC  '&SYSPARM'(1,4)                                          00450000
         AIF   (&K LT 8).CODE                                           00500000
&HJB     SETC  '&SYSPARM'(5,4)                                          00550000
         AIF   (&K LT 15).CODE                                          00600000
&HJC     SETC  '&SYSPARM'(9,7)                                          00650000
.CODE    ANOP                                                           00700000
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00750000
         B     &LABEL .                 BR AROUND CONSTANTS             00800000
         SPACE 2                                                        00850000
.NOBRNCH ANOP                                                           00900000
         AIF   ('&NAME' EQ '').NOLABEL                                  00950000
         DC    C'&NAME' .              MODULE IDENTIFIER                01000000
.NOLABEL ANOP                                                           01050000
         AIF   ('&HJA' EQ '').NEXT                                      01100000
         DC    X'&HJA' .                DATE OF MODIFICATION            01150000
.NEXT    ANOP                                                           01200000
         AIF   ('HJB' EQ '').DATE                                       01250000
         AIF   ('&HJN' NE 'HJN').DATE                                   01300000
         DC    X'&HJB' .                HJN OF MODIFICATION             01350000
.DATE    ANOP                                                           01400000
         DC    C'&HJC' .                PTF LEVEL                       01450000
.NOPTF   ANOP                                                           01500000
         AIF   ('&LABEL' EQ '').NOLBL                                   01550000
         SPACE 2                                                        01600000
&LABEL   DS    0H                                                       01650000
.NOLBL   ANOP                                                           01700000
         MEND                                                           01750000
         PRINT ON                                                       01800000
*********************************************************************** 01850000
*                                                                     * 01900000
* MODULE NAME = BNGIEXIT                                              * 01950000
*                                                                     * 02000000
* DESCRIPTIVE NAME = IMS DEMF USER EXIT SYMBOLIC NAME CONVERSION      * 02050000
*                    MODULE                                           * 02100000
*                                                                     * 02150000
* COPYRIGHT = NONE                                                    * 02200000
*                                                                     * 02250000
* STATUS = RELEASE 1, LEVEL 1                                         * 02300000
*                                                                     * 02350000
* FUNCTION = CONVERTS SYMBOLIC NAME TO EXPLICIT HARDWARE ADDRESSES    * 02400000
*            IN THE FORM OF CONTROL/LINE/TERMINAL FOR REMOTE TERMINAL * 02450000
*            SYMBOLIC NAME OR IN THE FORM OF TERMINAL ADDRESS ONLY    * 02500000
*            FOR LOCAL TERMINAL SYMBOLIC NAME.                        * 02550000
*                                                                     * 02600000
* NOTES = NONE                                                        * 02650000
*                                                                     * 02700000
*    DEPENDENCIES =                                                   * 02750000
*                                                                     * 02800000
*    THE FOLLOWING ARE IMS CONTROL BLOCKS AND THEIR LABELS AS USED BY * 02850000
*    DEMF IMS BNGIEXIT MODULE:                                        * 02900000
*                                                                     * 02950000
*    IMS                                                              * 03000000
*    CONTROL BLOCKS                  LABELS USED                      * 03050000
*    ----------------------------    -----------                      * 03100000
*                                                                     * 03150000
*    COMMUNICATION LINE BLOCK        CLBFLAG3                         * 03200000
*    (CLB)                           CLB3DECB                         * 03250000
*                                    CLB3CL40                         * 03300000
*                                    CLBDCB                           * 03350000
*                                                                     * 03400000
*    COMMUNICATION NAME TABLE        CNTNAME1                         * 03450000
*    (CNT)                           CNTCTBPT                         * 03500000
*                                                                     * 03550000
*    COMMUNICATION TERMINAL BLOCK    CTBCLB                           * 03600000
*    (CTB)                           CTBTERM                          * 03650000
*                                                                     * 03700000
*    SYSTEM CONTENTS DIRECTORY       SCDCNT                           * 03750000
*    (SCD)                           SCDCNTN                          * 03800000
*                                    SCDCNTL                          * 03850000
*                                                                     * 03900000
*    RESTRICTIONS = NONE                                              * 03950000
*                                                                     * 04000000
*    REGISTER CONVENTIONS =  R7  ADDRESS OF COMM TERM BLOCK (CTB)     * 04050000
*                            R9  ADDRESS OF COMM LINK BLOCK (CLB)     * 04100000
*                            R10 ADDRESS OF COMM NAME TABLE (CNT)     * 04150000
*                            R11 ADDRESS OF SYSTEM CONTENTS DIR (SCD) * 04200000
*                                                                     * 04250000
*    PATCH LABEL = BNGIPTCH                                           * 04300000
*                                                                     * 04350000
* MODULE TYPE =  IMS USER EXIT                                        * 04400000
*                                                                     * 04450000
*    PROCESSOR = ASSEMBLER H                                          * 04500000
*                                                                     * 04550000
*    MODULE SIZE = 1524 DECIMAL BYTES                                 * 04600000
*                                                                     * 04650000
*    ATTRIBUTES =  SERIALLY REUSABLE                                  * 04700000
*                                                                     * 04750000
* ENTRY POINT = BNGIEXIT                                              * 04800000
*                                                                     * 04850000
*    PURPOSE = SEE FUNCTION                                           * 04900000
*                                                                     * 04950000
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 05000000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 05050000
*              R15 LOADED WITH ENTRY POINT                            * 05100000
*                                                                     * 05150000
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 05200000
*                                                                     * 05250000
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 05300000
*                                                                     * 05350000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 05400000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 05450000
*                                                                     * 05500000
* EXIT-ERROR  = NONE                                                  * 05550000
*                                                                     * 05600000
* EXTERNAL REFERENCE = NONE                                           * 05650000
*                                                                     * 05700000
*    ROUTINES =                                                       * 05750000
*                                                                     * 05800000
*    DATA AREAS =                                                     * 05850000
*                                                                     * 05900000
*    CONTROL BLOCK = DCB                                              * 05950000
*                                                                     * 06000000
* TABLES = SEE DEPENDENCIES ABOVE                                     * 06050000
*                                                                     * 06100000
* MACROS = SAVE, RETURN                                               * 06150000
*                                                                     * 06200000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 06250000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 06300000
* CHANGE 02  02/22/78  BNGHJN MACRO ADDED                             * 06350000
*D100750                                                       @OZ29911 06400000
*A078000                                                       @OZ29911 06450000
*A060000,061000,063000                                         @OZ30477 06500000
*C103500,134500                                                @OZ30477 06550000
*A165500                                                       @OY21683 06600000
*DUMMY APAR ENTRY TO CORRECT CDS FOR DEMF/IMS                  @OZ36411 06650000
* DUMMY APAR ENTRY TO CORRECT PREREQ STRINGS                   @OZ36693 06700000
*C 202500,204500-205000                                        @AZ47407 06725000
*D 203000-204000,214000-214500                                 @AZ47407 06750000
*                                                                     * 06775000
*********************************************************************** 06800000
BNGIEXIT  TITLE  'DEMF TRANSACTION INPUT EDIT USER EXIT FOR IMS 1.1.4'  06850000
*********************************************************************** 06900000
*                                                                     * 06950000
* SINCE AN IMS MESSAGE PROCESSING PROGRAM (BMP OR MPP) HAS NO ACCESS  * 07000000
* TO IMS CONTROL BLOCKS AND ONE DESIRABLE FEATURE OF DEMF (DISPLAY    * 07050000
* EXCEPTION MONITORING FACILITY) IS THE ABILITY TO DISPLAY A TERMINAL * 07100000
* ERROR DATA WHEN ONLY ITS SYMBOLIC NAME IS KNOWN, OR NOTHING IS KNOWN* 07150000
* EXCEPT THAT IT IS CONNECTED TO AN DEMF-SUPPORTING SOFTWARE PACKAGE, * 07200000
* IMS BEING SUCH PACKAGE, SOME WAY NEEDED TO BE FOUND TO OBTAIN LINE, * 07250000
* CONTROL UNIT, AND TERMINAL ADDRESSES, AVAILABLE ONLY IN THE IMS     * 07300000
* CONTROL REGION, AND PASS THIS DATA TO THE DEMF TRANSACTION PROCESSOR, 07350000
* EXECUTING IN ITS OWN SEPARATE REGION. DEMF DATA IS ACCESSED BY LINE,* 07400000
* CONTROL UNIT AND TERMINAL ADDRESSES, NOT BY SYMBOLIC. THE EASIEST WAY 07450000
* TO IMPLEMENT THIS FUNCTION IS BY IMS TRANSACTION INPUT EDIT USER EXIT 07500000
* THIS PROGRAM BEING SUCH EXIT FOR DEMF TRANSACTIONS. IF OMITTED FROM * 07550000
* THE IMS CONTROL REGION,THE ONLY EFFECT TO DEMF IS THAT EXCEPTION DATA 07600000
* WILL BE AVAILABLE ONLY BY LINE, CONTROL UNIT AND TERMINAL ADDRESSES * 07650000
* ENTERED BY THE OPERATOR.                                            * 07700000
*                                                                     * 07750000
* A SPECIAL OPERAND WILL BE ADDED TO DEMF TRANSACTION MESSAGES BY THIS* 07800000
* PROGRAM TO INDICATE THE LINE, CONTROL UNIT AND TERMINAL ADDRESS OF  * 07850000
* THE TERMINAL MAKING THE REQUEST & OF ANOTHER TERMINAL WHOSE SYMBOLIC* 07900000
* NAME IS KNOW. TRANSACTIONS MODIFIED BY THIS PROGRAM AND THE RESULTS * 07950000
* PASSED TO THE DEMF TRANSACTION PROCESSOR ARE AS FOLLOW:             * 08000000
*                                                                     * 08050000
*    TRANSACTION ENTERED:        TRANSACTION PASSED TO PROCESSOR:     * 08100000
*        DEMF 3270                   DEMF 3270 X'FF'LLLCCTT - REMOTE  * 08150000
*        DEMF 3270                   DEMF 3270 X'FF'TTT     - LOCAL   * 08200000
*        DEMF 3270 (VTAM TERMINAL)   DEMF 3270 X'FE'VTAMNAME - @OZ30477 08250000
*        DEMF 3270 SYMBNAME          DEMF 3270 SYMBNAME X'FF'LLLCCTT  * 08300000
*        DEMF 3270 SYMBNAME          DEMF 3270 SYMBNAME X'FF'TTT      * 08350000
* DEMF 3270 SYMBNAME(VTAM)    DEMF 3270 SYMBNAME X'FE'VTAMNAME @OZ30477 08400000
*        DEMF 3270 N1 N2 ...         INPUT PASSED TO DISP UNCHANGED   * 08450000
*        DEMF (29-BYTES) MENU (X'ED 3270 OPTION)                      * 08500000
*                                    DEMF 3270 X'FF'LLLCCTT - REMOTE  * 08550000
*                                    DEMF 3270 X'FF'TTT     - LOCAL   * 08600000
*                                    DEMF 3270 X'FE'VTAMNAME - @OZ30477 08650000
*                                                              @OZ30477 08700000
* THE X'FE' IS A SPECIAL INDICATOR MEANING THAT THE FOLLOWING  @OZ30477 08750000
* DATA IS:                                                     @OZ30477 08800000
*                                                              @OZ30477 08850000
*     VTAMNAME - VTAM NODE NAME                                @OZ30477 08900000
*                                                              @OZ30477 08950000
*     SINCE THERE IS NO WAY TO CONVERT AN IMS SYMBOLIC         @OZ30477 09000000
*     TERMINAL NAME TO A HARDWARE ADDRESS UNDER VTAM, THE      @OZ30477 09050000
*     VTAM NODE NAME ASSOCIATED WITH THE IMS SYMBOLIC NAME IS  @OZ30477 09100000
*     PASSED INSTEAD OF THE HARDWARE ADDRESS.                  @OZ30477 09150000
*                                                                     * 09200000
* THE X'FF' IS A SPECIAL INDICATOR MEANING THAT THE FOLLOWING DATA IS:* 09250000
*                                                                     * 09300000
*     LLL     - THE CHANNEL AND UNIT LINE ADDRESS FROM THE O/S UCB    * 09350000
*     CC & TT - THE CONTROL UNIT AND TERMINAL TP-LINE FOR REMOTE      * 09400000
*               ADDRESSING CHARACTERS FROM THE IMS CTB.               * 09450000
*                                                                     * 09500000
*     TTT     - THE TERMINAL TP-LINE FOR LOCAL USING ADDRESSING       * 09550000
*               CHARACTERS FROM THE O/S UCB.                          * 09600000
*                                                                     * 09650000
* THE SYMBOLIC DEVICE NAME MUST BE 1-8 CHARACTERS BUT IF THE NAME IS  * 09700000
*    3 CHARACTERS OR LESS, AT LEAST ONE MUST NOT BE HEX-EQUAL(0-9,A-F)* 09750000
*    OR THE USER MAY GET A SYMBOLIC CONVERSION WHEN HE MEANT TO       * 09800000
*    ENTER A HARDWARE ADDRESS.                                        * 09850000
*                                                                     * 09900000
*********************************************************************** 09950000
         EJECT                                                          10000000
BNGIEXIT CSECT                                                          10050000
*        PRINT NOGEN                                                    10100000
         USING *,BASE1             PROGRAM BASE                         10150000
         USING IECTDECB,CLBREG     IMS COMMUNICATION LINE BLOCK         10200000
         USING CNT,CNTREG          IMS COMMUNICATION NAME TABLE         10250000
         USING CTB,CTBREG          IMS COMMUNICATION TERMINAL BLOCK     10300000
         USING IHADCB,DCBREG       O/S DATA CONTROL BLOCK               10350000
         USING DEB,DEBREG          O/S DATA EXTENT BLOCK                10400000
         USING MSG,MSGREG          TRANSACTION MESSAGE SEGMENT BUFFER   10450000
         USING SCD,SCDREG          IMS SYSTEM CONTENTS DIRECTORY        10500000
         USING UCB,UCBREG          O/S UNIT CONTROL BLOCK               10550000
         SAVE  (14,12),,BNGIEXIT.DEMF.TRANSACTION.INPUT.EDIT.USER.EXIT  10600000
         LR    BASE1,R15           SET PROGRAM BASE                     10650000
BNGIEXIT BNGHJN SKIPID                                         @OZ29911 10700000
*        L     SCDREG,=V(XXXISCD)   SET IMS SCDREG                      10750000
*        L     SCDREG,0(SCDREG)                                         10800000
         L     MSGREG,DECAREA      SET MESSAGE SEGMENT BASE             10850000
         LA    MSGREG,0(MSGREG)    INSURE TOP BYTE IS ZERO              10900000
         XC    PARM1(40),PARM1     INSURE ALL PARMS ZEROS               10950000
         CLI   MSGZ2,0             MSG EDITED BY MFS OR BASIC? 0=BASIC  11000000
         BNE   MFSEDIT             BYPASS EXTENDING 10 BYTES IF MFS     11050000
*********************************************************************** 11100000
*                                                                     * 11150000
*        BASIC MSG EDIT PROCESSING                                    * 11200000
*                                                                     * 11250000
*********************************************************************** 11300000
         LA    DATAREG,MSGDATA     DATAREG = POINT TO INPUT DATA        11350000
         LH    DATALOOP,MSGLL      LOAD MSG LENGTH                      11400000
         SH    DATALOOP,=H'5'      SUBTRACT (LLZZ) + (1 FOR TR)         11450000
         EX    DATALOOP,TRNSLATE   CHANGE LOWER CASE TO UPPER CASE      11500000
         LA    DATALOOP,5(DATALOOP)   RESTORE LENGTH OF MSG             11550000
         AR    DATALOOP,MSGREG     POINT TO END OF MSG                  11600000
         BAL   LINKREG,EDITRTN     CALL EDIT ROUTINE                    11650000
         CLC   PARM2(5),=X'F3F2F7F000' IS 3270 REQUEST ?                11700000
         BNE   RETURN              NO.                                  11750000
         CLI   PARM3,X'00'         YES. IS SYMBOLIC NAME ENTERED ?      11800000
         BE    G3270               NO. FIND HDWR ADDR FOR RQSD TERM     11850000
         CLI   PARM4,X'00'         YES. ANY MORE PARMS ?                11900000
         BNE   RETURN              YES. MUST BE HDWR ADDRESSES          11950000
         L     CNTREG,SCDCNT       SET COMMUNICATION NAME TABLE         12000000
         LH    R0,SCDCNTN            POOL ADDRESS AND CNT COUNT         12050000
         OC    PARM3,=CL8' '       MASK TO BLANK ON BINARY ZEROS        12100000
CKNXTCNT CLC   PARM3,CNTNAME1       IS CNTNAME1 = REQUEST ?             12150000
         BE    CNTFOUND            SET CLB/CTB POINTERS IF EQUAL        12200000
         AH    CNTREG,SCDCNTL      MOVE TO NEXT COMM. NAME TABLE ENTRY  12250000
         BCT   R0,CKNXTCNT         KEEP CHECKING UNTILL ALL ARE CHECKED 12300000
*                                                                       12350000
RETURN   RETURN (14,12),T,RC=0          RETURN TO IMS WITH GOOD CODE    12400000
*                                                                       12450000
TRNSLATE TR    0(1,DATAREG),LOTOUP      TRANSLATE LOWER CASE TO UPPER   12500000
*                                                                       12550000
*                                                                       12600000
*********************************************************************** 12650000
*                                                                     * 12700000
*        BASIC EDIT PROCESSING FOR 3270 SYMBOLIC TERMINAL             * 12750000
*                                                                     * 12800000
*********************************************************************** 12850000
CNTFOUND L     CTBREG,CNTCTBPT     SET CTB ADDRESS FOR SYMBOLIC TERMNAL 12900000
         L     CLBREG,CTBCLB       SET CLB ADDRESS FOR SYMBOLIC TERMNAL 12950000
*********************************************************************** 13000000
*                                                                     * 13050000
*        BASIC EDIT PROCESSING FOR 3270 DEFAULT TERMINAL              * 13100000
*                                                                     * 13150000
*********************************************************************** 13200000
G3270    OC    CLBDCB,CLBDCB       IS CLBDCB = ZEROS, THEN THIS@OZ30477 13250000
*                                      IS VTAM TERMINAL REQUEST@OZ30477 13300000
         BNZ   G3270AA             NO. A BTAM TERMINAL REQUEST.@OZ30477 13350000
         LH    R1,MSGLL            LOAD MSG LENGTH             @OZ30477 13400000
         AR    R1,MSGREG           R1=POINT TO END OF MSG      @OZ30477 13450000
         MVI   0(R1),X'FE'        SET VTAM CONVERSION INDICATOR@OZ30477 13500000
         MVC   1(8,R1),CLBNAME    MOVE VTAM NODE NAME TO OUTPUT@OZ30477 13550000
         LH    R1,MSGLL            LOAD MSG LENGTH             @OZ30477 13600000
         LA    R1,9(R1)            BUMP R1=NEW BASIC LENGTH    @OZ30477 13650000
         STH   R1,MSGLL            STORE BACK NEW BASIC LENGTH @OZ30477 13700000
         B     RETURN                                          @OZ30477 13750000
G3270AA  BAL   LINKREG,CONVSYMN    CALL CONVERT SYMBOLIC RTN   @OZ30477 13800000
         CLI   PARM4,X'00'         IS SYMBOLIC NAME CONVERTED?          13850000
         BE    RETURN              NO                                   13900000
         LH    R1,MSGLL            LOAD MSG LENGTH                      13950000
         AR    R1,MSGREG           R1=POINT TO END OF MSG               14000000
         MVI   0(R1),X'FF'         SET SYMBOLIC CONVERSION INDICATOR    14050000
         MVC   1(3,R1),PARM4       MOVE HWR LINE/TERM ADDR TO OUTPUT    14100000
         UNPK  DBLWD,CTBTERM(3)    UNPACK 3 CNTRL & TERM ADDRESSES      14150000
         MVC   4(4,R1),DBLWD+3     MOVE CNTRL & TERM ADDR TO OUTPUT     14200000
         TR    4(4,R1),HXTOEB      CONVERT CNTRL & TERM ADDR TO EBCDIC  14250000
         LH    R1,MSGLL            LOAD MSG LENGTH                      14300000
         LA    R1,8(R1)            BUMP R1=NEW BASIC LENGTH             14350000
         STH   R1,MSGLL            STORE BACK NEW BASIC LENGTH          14400000
         B     RETURN                                                   14450000
*********************************************************************** 14500000
*                                                                     * 14550000
*        MFS MSG EDIT PROCESSING                                      * 14600000
*                                                                     * 14650000
*********************************************************************** 14700000
MFSEDIT  LA    DATAREG,MSGDATA        POINT TO KEY-IN AREA              14750000
         LA    DATALOOP,33            TRANSLATE FROM 'DEMF' ON TO END   14800000
*                                       OF 29-BYTE KEY-IN AREA          14850000
         EX    DATALOOP,TRNSLATE      CHANGE LOWER CASE TO UPPER CASE   14900000
         CLC   MSGKEYED,=CL29' '   WAS ANYTHING KEYED IN ?              14950000
         BNE   MFS0002             YES. GO EDIT INPUT                   15000000
         CLC   MSGCMDCD,=C'MENU'   IS INPUT FROM MENU SCREEN ?          15050000
         BNE   RETURN              NO. RETURN TO IMS                    15100000
         CLC   MSGDPRSS,=C'DEPRESS' IS THIS FROM MENU PAGE 1 ?          15150000
         BNE   RETURN              NO. RETURN TO IMS                    15200000
         CLI   MSG3270,C' '        IS THIS 3270 REQUEST FROM MENU ?     15250000
         BE    RETURN              NO. RETURN TO IMS                    15300000
         B     MFS3270             YES. GO FIND HARDWARE ADDRESS        15350000
MFS0002  LA    DATAREG,MSGKEYED    POINT TO KEYED-IN DATA               15400000
         LR    DATALOOP,DATAREG    SETUP DATA LOOP                      15450000
         LA    DATALOOP,29(DATALOOP) SET DATALOOP=END OF 29 BYTE AREA   15500000
         BAL   LINKREG,EDITRTN     CALL EDIT ROUTINE                    15550000
         CLC   PARM1(5),=X'F3F2F7F000' IS 3270 REQUEST ?                15600000
         BNE   RETURN              NO. RETURN TO IMS                    15650000
         CLI   PARM2,X'00'         YES. IS SYMBOLIC NAME ENTERED ?      15700000
         BE    MFS3270             NO. FIND HDWR ADDR FOR RQSD TERM     15750000
         CLI   PARM3,X'00'         YES. ANY MORE PARMS ?                15800000
         BNE   RETURN              YES. MUST BE HDWR ADDRESSES          15850000
         L     CNTREG,SCDCNT       SET COMMUNICATION NAME TABLE         15900000
         LH    R0,SCDCNTN            POOL ADDRESS AND CNT COUNT         15950000
         OC    PARM2,=CL8' '       MASK TO BLANK ON BINARY ZEROS        16000000
MFS0004  CLC   PARM2,CNTNAME1      IS CNTNAME1= REQUEST ?               16050000
         BE    MFS0006             SET CLB/CTB POINTERS IF EQUAL        16100000
         AH    CNTREG,SCDCNTL      MOVE TO NEXT COMM. NAME TABLE ENTRY  16150000
         BCT   R0,MFS0004          KEEP CHECKING UNTILL ALL ARE CHECKED 16200000
         B     RETURN              NO MATCH TO IMS SYMBOLICS, SO RETURN 16250000
*********************************************************************** 16300000
*                                                                     * 16350000
*        MFS EDIT PROCESSING FOR 3270 SYMBOLIC TERMINAL               * 16400000
*                                                                     * 16450000
*********************************************************************** 16500000
MFS0006  L     CTBREG,CNTCTBPT     SET CTB ADDRESS FOR SYMBOLIC TERMNAL 16550000
         L     CLBREG,CTBCLB       SET CLB ADDRESS FOR SYMBOLIC TERMNAL 16600000
*********************************************************************** 16650000
*                                                                     * 16700000
*        MFS EDIT PROCESSING FOR 3270 DEFAULT TERMINAL                * 16750000
*                                                                     * 16800000
*********************************************************************** 16850000
MFS3270  OC    CLBDCB,CLBDCB     IS CLBDCB = ZEROS, THEN THIS  @OZ30477 16900000
*                                   IS A VTAM TERMINAL REQUEST.@OZ30477 16950000
         BNZ   MFS0008             NO. A BTAM TERMINAL REQUSET.@OZ30477 17000000
         LA    R1,MSGKEYED   SET R1=ADDR OF 29 BYTE KEY-IN AREA@OZ30477 17050000
         MVC   MSGKEYED,=CL29' '   CLEAR KEY-IN AREA           @OZ30477 17100000
         MVC   0(5,R1),=C'3270 '   MOVE '3270 ' TO 29 BYTE AREA@OZ30477 17150000
         LA    R1,5(R1)            PRESET 'R1' PASS '3270 '    @OZ30477 17200000
         CLI   PARM2,X'00'         IS SYMBOLIC NAME IN PARM2 ? @OZ30477 17250000
         BE    MFS0005             NO. JUST ADD VTAM NAME      @OZ30477 17300000
         MVC   5(8,R1),PARM2      YES. ADD SYMBOLIC NAME TO MSG@OZ30477 17350000
         LA    R1,13(R1)        POINT PASS '3270 ' AND SYMBOLIC@OZ30477 17400000
MFS0005  MVI   0(R1),X'FE'        SET VTAM CONVERSION INDICATOR@OZ30477 17450000
         MVC   1(8,R1),CLBNAME    MOVE VTAM NODE NAME TO OUTPUT@OZ30477 17500000
         B     RETURN                                          @OZ30477 17550000
MFS0008  BAL   LINKREG,CONVSYMN   CALL CONVERT SYMBOLIC ROUTINE@OZ30477 17600000
         CLI   PARM4,X'00'         IS SYMBOLIC NAME CONVERTED?          17650000
         BE    RETURN              NO                                   17700000
         LA    R1,MSGKEYED         SET R1=ADDR OF 29 BYTE KEY-IN AREA   17750000
         MVC   MSGKEYED,=CL29' '   CLEAR KEY-IN AREA                    17800000
         MVC   0(5,R1),=C'3270 '    MOVE '3270 ' TO 29 BYTE AREA        17850000
         LA    R1,5(R1)            PRESET 'R1' PASS '3270 '             17900000
         CLI   PARM2,X'00'         IS SYMBOLIC NAME IN PARM2 ?          17950000
         BE    MFS0010             NO. JUST ADD HARDWARE ADDRESSES      18000000
         MVC   5(8,R1),PARM2       YES. ADD SYMBOLIC NAME TO MSG        18050000
         LA    R1,13(R1)           POINT PASS '3270 ' AND SYMBOLICNAME  18100000
MFS0010  MVI   0(R1),X'FF'         SET SYMBOLIC CONVERSION INDICATOR    18150000
         MVC   1(3,R1),PARM4       MOVE HWR LINE/TERM ADDR TO OUTPUT    18200000
         UNPK  DBLWD,CTBTERM(3)    UNPACK 3 CNTRL & TERM ADDRESSES      18250000
         MVC   4(4,R1),DBLWD+3     MOVE CNTRL & TERM ADDR TO OUTPUT     18300000
         TR    4(4,R1),HXTOEB      CONVERT CNTRL & TERM ADDR TO EBCDIC  18350000
         B     RETURN                                                   18400000
*********************************************************************   18450000
*                                                                   *   18500000
*        INPUT EDITING SUBROUTINE FOR BOTH BASIC AND MFS MSG        *   18550000
*                                                                   *   18600000
*********************************************************************   18650000
EDITRTN  LA    PARMREG,PARM1       POINT TO PARMS.                      18700000
         LR    R1,PARMREG                                               18750000
         MVI   NEWPARM,C'1'        TURN ON 'NEW PARM' SWITCH.           18800000
EDIT001  CLI   0(DATAREG),C'A'     IS IT AN 'A' OR HIGHER?              18850000
         BL    EDIT004             NO. CHECK NEW PARM SWITCH.           18900000
         MVI   NEWPARM,C'0'        YES. SET NEW PARM SWITCH OFF.        18950000
         MVC   0(1,R1),0(DATAREG)  PUT THIS BYTE IN THIS PARM           19000000
         CLI   PARM5,X'00'         ARE ALL PARMS USED UP?               19050000
         BNER  LINKREG             YES. RETURN TO CALLER                19100000
         LA    R1,1(R1)            BUMP PARM POINTER WORKREG.           19150000
EDIT003  LA    DATAREG,1(DATAREG)  BUMP TIOA POINTER.                   19200000
         CR    DATAREG,DATALOOP    IS THERE MORE DATA IN TIOA?          19250000
         BL    EDIT001             YES. GO PROCESS MORE DATA.           19300000
         BR    LINKREG             NO. RETURN TO CALLER.                19350000
EDIT004  CLI   NEWPARM,C'1'        IS NEW-PARM SWITCH ON?               19400000
         BE    EDIT003             YES. CHECK FOR MORE DATA.            19450000
         CLI   PARM5,X'00'         NO. ARE ALL PARMS USED UP?           19500000
         BNER  LINKREG             YES. RETURN TO CALLER                19550000
         LA    PARMREG,8(PARMREG)  NO. BUMP TO NEXT NEW PARM.           19600000
         LR    R1,PARMREG          POINT WORK REG TO NEXT PARM.         19650000
         MVI   NEWPARM,C'1'        TURN ON NEW-PARM SWICH.              19700000
         B     EDIT003             GO CHECK FOR MORE DATA.              19750000
*********************************************************************** 19800000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 19850000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 19900000
*********************************************************************** 19950000
*********************************************************************** 20000000
*                                                                     * 20050000
*        SUBROUTINE TO CONVERT SYMBOLIC NAME TO HARDWARE DEVICE       * 20100000
*                                                                     * 20150000
********************************************************************* * 20200000
CONVSYMN L     DCBREG,CLBDCB       GET LINE'S DCB ADDRESS      @AZ47407 20250000
         TM    DCBOFLGS,DCBOFOPN   IS DCB OPEN?                @AZ47407 20300000
         BZ    RETURN              LEAVE IF 'NOT AVAIL'                 20550000
         L     DEBREG,DCBDEBAD     GET LINE'S DEB ADDRESS IF OPEN       20600000
         XR    R2,R2               PREPARE FOR CALCULATIONS:            20650000
         IC    R2,DECRLN           GET ACCESS METHOD'S DD-CARD NUMBER   20700000
         L     UCBREG,CTBCTT            GET CTT ADDRESS        @OY21683 20750000
         CLI   0(UCBREG),X'0E'          TEST FOR LOCAL         @OY21683 20800000
         BNE   NOLOCL                   NO                     @OY21683 20850000
         LH    R2,CTBTRMNO              GET TERMNO FROM CTB    @OY21683 20900000
NOLOCL   EQU   *                                               @OY21683 20950000
         BCTR  R2,0                CHANGE TO RELATIVE DD # FROM DD 1    21000000
         SLL   R2,2                MULTIPLY RELATIVE DD # BY FOUR       21050000
         L     UCBREG,DEBUCBAD(R2) GET LINE'S UCB ADDRESS               21100000
         LA    UCBREG,0(UCBREG)    DROP TOP BYTE OF UCBREG              21150000
         CLI   UCBID,UCBSTND       MAKE ONE UCB ADDRESS VALIDITY CHECK  21200000
         BNER  LINKREG             LEAVE 'NOT AVAIL', SOMETHING'S WRONG 21250000
         MVC   PARM4(3),UCBNAME    ADD LINE'S ADDRESS TO SPECIAL OPRAND 21300000
         BR    LINKREG             RETURN TO EDIT MAIN-LINE             21350000
*                                                                       21500000
         EJECT                                                          21550000
*********************************************************************** 21600000
BNGIPTCH DC    C'PATCH AREA S-CONS:',128S(*)                            21650000
*********************************************************************** 21700000
*                                                                       21750000
COMMAREA DS    0D       MAP OF COMMUNICATION AREA                       21800000
PARM1    DS    D          1ST INPUT PARM - DEMF                         21850000
PARM2    DS    D          2ND INPUT PARM - 3270                         21900000
PARM3    DS    D          3RD INPUT PARM - LLL OR TTT                   21950000
PARM4    DS    D          4TH INPUT PARM - CC  OR NULLS                 22000000
PARM5    DS    D          5TH INPUT PARM - TT  OR NULLS                 22050000
DBLWD    DS    D          DOUBLEWORD WORK AREA                          22100000
NEWPARM  DS    C          SWITCH TO DETERMINE START OF NEW PARM         22150000
HXTOEB   DS    0D                                                       22200000
         DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   22250000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           22300000
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           22350000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            22400000
*                                                                       22450000
LOTOUP   DS    0F       LOWER CASE TO UPPER CASE TR TABLE               22500000
         DC    X'000102030405060708090A0B0C0D0E0F'                      22550000
         DC    X'101112131415161718191A1B1C1D1E1F'                      22600000
         DC    X'202122232425262728292A2B2C2D2E2F'                      22650000
         DC    X'303132333435363738393A3B3C3D3E3F'                      22700000
         DC    X'404142434445464748494A4B4C4D4E4F'                      22750000
         DC    X'505152535455565758595A5B5C5D5E5F'                      22800000
         DC    X'606162636465666768696A6B6C6D6E6F'                      22850000
         DC    X'707172737475767778797A7B7C7D7E7F'                      22900000
         DC    X'80C1C2C3C4C5C6C7C8C98A8B8C8D8E8F'                      22950000
         DC    X'90D1D2D3D4D5D6D7D8D99A9B9C9D9E9F'                      23000000
         DC    X'A0A1E2E3E4E5E6E7E8E9AAABACADAEAF'                      23050000
         DC    X'F0F1F2F3F4F5F6F7F8F9BABBBCBDBEBF'                      23100000
         DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      23150000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      23200000
         DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      23250000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      23300000
         LTORG                                                          23350000
*********************************************************************** 23400000
*                                                                       23450000
DEB      DSECT ,      O/S DATA EXTENT BLOCK MAP:                        23500000
         DS    XL32     BASIC SECTION - UN-REFERENCED                   23550000
DEBUCBAD DS    F        UCB ADDRESS OF FIRST LINE FOR THE CLB/DCB       23600000
*                                                                       23650000
MSGIN    DSECT ,      MAP OF TRANSACTION MESSAGE SEGMENT:               23700000
MSG      DS    0F       START OF TRANSACTION MESSAGE SEGMENT            23750000
MSGLL    DS    H        LENGTH OF MESSAGE (INCLUDING LL,Z1,Z2)          23800000
MSGZ1    DS    X          UN-REFERENCED - SHOULD ALWAYS BE X'00'        23850000
MSGZ2    DS    X        IMS EDIT INDICATOR - =0 BASIC EDIT              23900000
*                                            >0 MFS EDIT                23950000
TIOADBA  DS    0F       START OF MESSAGE DATA (INPUT AREA)              24000000
MSGDATA  DS    0C       FIRST BYTE OF MESSAGE DATA POINTER              24050000
MSGTXCD  DS    CL5      'DEMF ' AREA                                    24100000
MSGKEYED DS    CL29     29 BYTES KEY-IN AREA                            24150000
MSGCMDCD DS    CL4      4 BYTES CMND CODE AREA                          24200000
MSGMENU  DS    0C       START OF MENU PAGE1 INPUT AREA FOR (X)          24250000
MSGALL   DS    C          MENU PAGE1 1ST (X) INPUT AREA                 24300000
MSG3270  DS    C          MENU PAGE1 2ND (X) INPUT AREA                 24350000
MSGRMOT  DS    C          MENU PAGE1 3RD (X) INPUT AREA                 24400000
MSGLOCL  DS    C          MENU PAGE1 4TH (X) INPUT AREA                 24450000
MSGDPRSS DS    CL7        MENU PAGE1 5TH INPUT AREA (FOR ENTER KEY)     24500000
*                                                                       24550000
UCB      DSECT ,      O/S UNIT CONTROL BLOCK MAP:                       24600000
         DS    XL2        UN-REFERENCED                                 24650000
UCBID    DS    X        UCB IDENTIFIER                                  24700000
UCBSTND  EQU   X'FF'    UCB IDENTIFIER VALUE                            24750000
         ORG   UCB+13     UN-REFERENCED                                 24800000
UCBNAME  DS    CL3      PRINTABLE LINE ADDRESS (CUU)                    24850000
         DCBD  DSORG=XE,DEVD=BS                                         24900000
         ICLI  CLBBASE=0,CNTBASE=0,CTBBASE=0                            24950000
         ISCD  SECTYPE=DSECT,SCDBASE=0                                  25000000
*                                                                       25050000
R0       EQU   0                                                        25100000
R1       EQU   1                                                        25150000
R2       EQU   2                                                        25200000
DATAREG  EQU   2              POINTER TO DATA TO BE EDIT                25250000
DCBREG   EQU   3                                                        25300000
DEBREG   EQU   4              O/S DATA EXTENTED BLOCK                   25350000
UCBREG   EQU   5              O/S UNIT CONTROL BLOCK                    25400000
MSGREG   EQU   6              POINTER TO INPUT MESSAGE                  25450000
CTBREG   EQU   7              COMMUNICATIONS TERMINAL BLOCK             25500000
DATALOOP EQU   8              LENGTH OF DATA TO BE EDIT                 25550000
CLBREG   EQU   9              COMMUNICATIONS LINE BLOCK                 25600000
CNTREG   EQU   10             COMMUNICATIONS NAME TABLE                 25650000
SCDREG   EQU   11             SYSTEMS CONTENTS DIRECTORY                25700000
BASE1    EQU   12             BASE REGISTER                             25750000
*UNUSED  EQU   13             POINTER TO IMS REGISTER SAVE AREA         25800000
LINKREG  EQU   14             LINKAGE REGISTER                          25850000
PARMREG  EQU   15             POINTER TO PARAMETERS 1,2,3,4             25900000
R15      EQU   15             ENTRY POINT TO THIS PROGRAM FROM IMS      25950000
         END   BNGIEXIT                                                 26000000
