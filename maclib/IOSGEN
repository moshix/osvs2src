         MACRO                                                          00050002
&NAME    IOSGEN &FUNC,&TABLE=,&UCB=,&REG=,&VAR=,&LINKR=                 00100002
         GBLB  &IECIHDR                 HEADER SWITCH                   00150002
         GBLB  &IECIFLG,&IECITP         FIRST TIME SWITCH               00200002
         GBLB  &IECIMNT,&IECIDET        FIRST TIME SWITCH               00201002
         GBLB  &IECILCH,&IECIRES        FIRST TIME SWITCH               00202002
         LCLC  &LABEL                   LABEL GENERATION                00210002
         LCLC  &FIELD                   UCB FIELD                       00250002
         LCLC  &BIT,&INDEX              UCB EQUATE NAME                 00300002
.*                                      OR BRANCH ENTRY (IECVGENA)      00350002
.*                                      OR TP ERRTAB                    00400002
         AIF   ('&IECIHDR' EQ '1').IOSG010                              00450002
&IECIHDR SETB  1                        SET HEADER SWITCH               00500002
*****************************************************************       00550002
*                                                               *       00600002
*             IOSGEN MACRO                                      *       00650002
*                                                               *       00700002
*        OS/VS2 RELEASE 2, 10/14/74, LEVEL=00                   *       00750003
*                                                               *       00800002
*        METHOD OF ACCESS                                       *       00850002
*              BAL - IOSGEN &FUNC,.....REQUIRED KEYWORDS        *       00900002
*              PLS - GEN REFS(....,....,MAPPING MACRO LABELS)   *       00950002
*                    (IOSGEN &FUNC,...REQUIRED KEYWORDS);       *       01000002
*                                                               *       01050002
*        THE MACRO FACILITIES OF IOSGEN ARE PROVIDED TO         *       01100002
*        SUPPORT FUNCTIONS WHICH REQUIRE A CHANGE TO OR         *       01150002
*        INFORMATION FROM THE RESOURCES WHICH GOVERN THE        *       01200002
*        CONTROL STRUCTURE OF THE I/O SUPERVISOR.  THESE        *       01250002
*        ARE NOT AN INTEGRAL PART OF IOS AND, THROUGH IOSGEN,   *       01300002
*        CAN REMAIN INDEPENDENT OF THE RESOURCE GOVERNING       *       01350002
*        STRUCTURE. IOSGEN IS A PRIVATE MACRO AVAILABLE         *       01400002
*        ONLY TO AUTHORIZED SYSTEM ROUTINES.                    *       01450002
*                                                               *       01500002
*****************************************************************       01550002
.IOSG010 ANOP                                                           01600002
         AIF   ('&FUNC' EQ 'DETECTOR').DET000                           01650002
         AIF   ('&FUNC' EQ 'DOM').DOM000                                01700002
         AIF   ('&FUNC' EQ 'LCH').LCH000                                01750002
         AIF   ('&FUNC' EQ 'MAP').MAP000                                01800002
         AIF   ('&FUNC' EQ 'MOUNT').MNT000                              01850002
         AIF   ('&FUNC' EQ 'PTHAVL').PTH000                             01900002
         AIF   ('&FUNC' EQ 'RESTART').RES000                            01950002
         AIF   ('&FUNC' EQ 'SIMINT').SIM000                             02000002
         AIF   ('&FUNC' EQ 'SWAP').SWP000                               02050002
         AIF   ('&FUNC' EQ 'TP').TP000                                  02100002
         AIF   ('&FUNC' EQ 'UCBFLG').FLG000                             02150002
         AIF   ('&FUNC' EQ 'UCBLOOK').UCB000                            02200002
         AIF   ('&FUNC' EQ 'VARY').VAR000                               02250002
         AIF   ('&FUNC' EQ 'SETVOID').SV000                    @Y30LPLC 02270003
         AGO   .IOSGEN3                                                 02300002
.*****     *****     *****     *****     *****     *****     *****      02350002
.*****      MAP      *****      MAP      *****      MAP      *****      02400002
.*****     *****     *****     *****     *****     *****     *****      02450002
.MAP000  ANOP                                                           02500002
*                                                                       02550064
*    THE MAP FUNCTION HAS BEEN REPLACED BY THE IOSMAP MACRO    @G64APLK 02580064
*                                                                       02610064
         AGO   .IOSGEN3                                                 02690064
.*****     *****     *****     *****     *****     *****     *****      02720064
.*****     PTHAVL    *****     PTHAVL    *****     PTHAVL    *****      02750064
.*****     *****     *****     *****     *****     *****     *****      02780064
.PTH000  ANOP                                                           02800064
*                                                                       02810064
*        THE PTHAVL FUNCTION HAS BEEN DELETED.                 @G64APLK 02820064
*                                                                       02856064
         AGO   .IOSGEN3                                        @ZA12429 02864064
.*****     *****     *****     *****     *****     *****     *****      02872064
.*****    UCBLOOK    *****    UCBLOOK    *****    UCBLOOK    *****      02880064
.*****     *****     *****     *****     *****     *****     *****      02888064
.UCB000  ANOP                                                           02896064
.*                                                                      02904064
.*       CSECT AUTHORIZATION                                            02912064
.*                                                                      02920064
         AIF   (('&SYSECT' EQ 'IQAALL00') OR                           X02928064
               ('&SYSECT' EQ 'IQAERR00')).UCBAUTH                       02936064
         AIF   ('&SYSECT' EQ 'IGC0005I').UCBAUTH                        02944064
         AIF   ('&SYSECT' EQ 'IGC0905I').UCBAUTH                        02952064
         AIF   ('&SYSECT' EQ 'IEEVDEV').UCBAUTH                         02960064
         AIF   ('&SYSECT' EQ 'IEEVPTH').UCBAUTH                         02968064
         AIF   ('&SYSECT' EQ 'IEAVNIP0').UCBAUTH                        02976064
         AIF   ('&SYSECT' EQ 'IEAVNIPM').UCBAUTH                        02984064
         AIF   ('&SYSECT' EQ 'WMMCCABE').UCBAUTH                        02992064
         AIF   ('&SYSECT' EQ 'IEEMPDM').UCBAUTH                         03000064
         AIF   ('&SYSECT' EQ 'IQASTK00').UCBAUTH                        03008064
         AIF   ('&SYSECT' EQ 'ISTINMAV').UCBAUTH                        03016064
         AIF   ('&SYSECT' EQ 'IEE3603D').UCBAUTH                        03024064
         AIF   ('&SYSECT' EQ 'IGC0012F').UCBAUTH               @ZUP1085 03032064
        AIF   ('&SYSECT' EQ 'ICBVMT00').UCBAUTH               @ZA12429  03040064
.*       AGO   .IOSGEN1                                        @ZA12429 03048064
.UCBAUTH ANOP                                                           03056064
         SPACE 2                                                        03100002
*****************************************************************       03150002
*                                                               *       03200002
* FUNCTION:                                                     *       03250002
*    UCBLOOK - LOCATES THE UNIT CONTROL BLOCK (UCB) ASSO-       *       03300064
*    CIATED WITH A DEVICE ADDRESS.                              *       03350064
*                                                               *       03400064
* MACRO CALL:                                                   *       03450064
*    LABEL  IOSGEN  UCBLOOK,UCB=(REG),REG=(REG)                 *       03500064
*                                                               *       03550064
*       PLS - GEN REFS(CVTILK1,CVTILK2,CVTIXAVL,CVTMAP,         *       03600064
*             IOCOMEX,CVTPTR,IOCOM,IOX,IOCUCBBM,IOXHICH)       @YM06032 03650064
*             (IOSGEN UCBLOOK,...KEYWORDS AS IN BAL);           *       03700064
*                                                               *       03900002
* INPUT:                                                        *       03950002
*    REGISTER 13 MUST CONTAIN THE ADDRESS OF A 16 WORD          *       04000002
*    SAVEAREA.                                                  *       04050002
*                                                               *       04100002
*    REGISTER 15 WILL BE USED AS A BASE REGISTER AND, AS        *       04150002
*    SUCH, USING AND DROP STATEMENTS ARE ISSUED.  IF THE        *       04200002
*    CALLING MODULE IS USING REGISTER 15 AS A BASE, IT MUST     *       04250002
*    REESTABLISH ADDRESSABILITY BY ISSUING ANOTHER USING        *       04300002
*    STATEMENT.                                                 *       04350002
*                                                               *       04400002
*    UCB=  MAY SPECIFY A GPR (SYMBOLIC OR ABSOLUTE), WHICH      *       04700064
*    IS TO CONTAIN THE ADDRESS OF THE UCB COMMON SEGMENT UPON   *       04710064
*    RETURN TO THE CALLER. IF OMITTED, REGISTER 7 IS ASSUMMED.  *       04720064
*                                                               *       04730064
*    REG=  MAY SPECIFY A GPR (SYMBOLIC OR ABSOLUTE) WHICH       *       04740064
*    WILL CONTAIN THE HEXIDECIMAL DEVICE ADDRESS; RIGHT         *       04750064
*    JUSTIFIED.  IF THIS PARAMETER IS OMITTED, REGISTER 6 IS    *       04760064
*    ASSUMED.                                                   *       04770064
*                                                               *       04850002
*    LABEL - OPTIONAL LABEL.                                    *       04900064
*                                                               *       04950064
* OUTPUT:                                                       *       05000064
*                                                               *       05050064
*    UCB=  CONTAINS THE ADDRESS OF THE UCB.                     *       05080064
*                                                               *       05110064
*    REGISTER 15 WILL CONTAIN ONE OF THE FOLLOWING RETURN CODES:*       05140064
*         00=  UCB ADDRESS HAS BEEN FOUND                       *       05170064
*         04=  DEVICE ADDRESS WAS INVALID                       *       05200064
*                                                               *       05300064
* ATTRIBUTES:                                                   *       05350064
*    THIS FUNCTION IS EXPANDED AS RE-ENTRANT, IN-LINE CODE.     *       05400064
*                                                               *       07000002
* OTHER:                                                        *       07050002
*    THE EXPANSION OF THIS FUNCTION IS DEPENDENT ON THE         *       07100002
*    SPECIFICATION OF THE FOLLOWING MAPPING MACROS              *       07150002
*    IN THE CALLING CSECT ASSEMBLY:                             *       07200002
*         CVT   DSECT=YES                                       *       07250064
*         IECDIOCM                                              *       07300064
*         IECDIOCX                                            @YM03330* 07350064
*                                                               *       07650002
*    LOCKS ARE NOT REQUIRED BY THIS FUNCTION.                   *       07700002
*                                                               *       07750002
*****************************************************************       07800002
         SPACE 2                                                        07850002
*****************************************************************       07900002
*                                                               *       07950002
*        REGISTER DEFINITIONS                                   *       08000002
*                                                               *       08050002
*****************************************************************       08100002
         SPACE                                                          08150002
IECIUZRO EQU   0                   RESERVED                             08200064
*        EQU   1                   RESERVED                             08250064
IECIUWK2 EQU   2                   EVEN WORK REG                        08300064
IECIUWK3 EQU   3                   ODD WORK REG                         08350064
IECIUCVT EQU   4                   CVT PTR                              08400064
IECIULST EQU   5                   CHAN AND UCB LIST PTR                08450064
IECIUEVN EQU   6                   EVEN WORK REG                        08500064
IECIUODD EQU   7                   ODD WORK REG                         08550064
IECIUNDX EQU   8                   TABLE INDEX REG                      08600064
*        EQU   9                   RESERVED                             08650064
*        EQU   10                  RESERVED                             08700064
*        EQU   11                  RESERVED                             08750064
*        EQU   12                  RESERVED                             08800064
IECIUSAV EQU   13                  SAVE AREA PTR                        08850064
*        EQU   14                  RESERVED                             08900064
IECIUBAS EQU   15                  BASE REG                             08950064
         SPACE                                                          09000064
*****************************************************************       09050064
*                                                               *       09100064
*        MISCELLANEOUS EQUATES                                  *       09150064
*                                                               *       09200064
*****************************************************************       09250064
         SPACE                                                          09300064
IECIURC4 EQU   4                   RETURN CODE OF 4                     09350064
IECIUMBM EQU   128                 MOVING BIT MASK                      09400064
IECIUB16 EQU   16                  NO. OF BITS FOR SHIFTS      @YM06032 09450064
IECIUDNM EQU   X'0F'               DEVICE NUMBER MASK                   09500064
         AIF   ('&UCB' NE '').UCB010                                    09550064
IECIUUCB EQU   28                  OFFSET IN SAVE AREA FOR REG 7        09600064
*                                  *WHICH WILL CONTAIN ADDR OF          09650064
*                                  *VALID UCB                           09700064
.UCB010  ANOP                                                           09750064
IECIURTC EQU   60                  OFFSET FOR REG 15 IN SAVEAREA        09800064
*                                  *WHICH WILL CONTAIN                  09850064
*                                  *RETURN CODE                         09900064
         SPACE                                                          12050002
*****************************************************************       12100002
*                                                               *       12150002
*        ESTABLISH ADDRESSABILITY                               *       12200002
*                                                               *       12250002
*****************************************************************       12300002
         SPACE                                                          12350002
&NAME    STM   IECIUZRO,IECIUBAS,0(IECIUSAV)  SAVE REGS                 12400064
         BALR  IECIUBAS,0          EST ADDRESSABILITY                   12450064
         USING *,IECIUBAS                                               12500064
         SPACE                                                          12550064
         AIF   ('&REG' EQ '').UCB030                                    12600064
         LR    IECIUEVN,&REG(1)    GET DEVICE ADDR FROM CALLER          12650064
.UCB030  ANOP                                                           12700064
         SPACE                                                          12750064
****************************************************************        12800064
*                                                              *        12850064
*        VALIDATE UCB DEVICE ADDRESS                           *        12900064
*                                                              *        12950064
****************************************************************        13000064
         SPACE                                                          13050064
         SR    IECIUODD,IECIUODD   ZERO WORK REGISTER          @YM06032 13100064
         SRDL  IECIUEVN,IECIUB16   ISOLATE DEVICE ADDRESS      @YM06032 13150064
         LTR   IECIUEVN,IECIUEVN   ANYTHING IN HI BYTES-INVALID@YM06032 13200064
         BNZ   IECIU070            YES, TAKE ERROR EXIT        @YM06032 13250064
         SPACE                                                          13300064
         SLDL  IECIUEVN,IECIUB16   RESTORE DEVICE ADDRESS      @YM06032 13350064
         SPACE                                                          13400064
         L     IECIUCVT,CVTPTR(0,0)  GET CVT PTR                        13450064
         L     IECIULST,CVTIXAVL-CVTMAP(0,IECIUCVT)  GET IOCOM PTR      13500064
         L     IECIUWK2,IOCOMEX-IOCOM(0,IECIULST) GET IOX PTR           13550064
         SPACE                                                          13600064
         CLM   IECIUEVN,2,IOXHICH-IOX(IECIUWK2) IS CHAN VALID? @YM06032 13650064
         BH    IECIU070            NO, TAKE ERROR EXIT                  13700064
         SPACE                                                          13750064
         LR    IECIUWK2,IECIUEVN   COPY DEVICE ADDR                     13800064
         L     IECIULST,IOCUCBBM-IOCOM(0,IECIULST) GET UCB              13850064
*                                  *BIT MASK TABLE ADDR                 13900064
         SRDL  IECIUWK2,3(0)       CREATE TABLE AND BIT INDICES         13950064
         SRL   IECIUWK3,29(0)      ALIGN BIT INDEX                      14000064
         IC    IECIUWK2,0(IECIUWK2,IECIULST) GET BYTE                   14050064
*                                  *WITH DEVICE BIT                     14100064
         LA    IECIULST,IECIUMBM(0,0) GET MOVING BIT MASK               14150064
         SRL   IECIULST,0(IECIUWK3) CREATE DEVICE MASK                  14200064
         SPACE                                                          14250064
         NR    IECIUWK2,IECIULST   AND OUT ALL BUT DEVICE BIT           14300064
         BZ    IECIU070            INVALID DEVICE ADDRESS               14350064
         SPACE                                                          14400064
*****************************************************************       14450064
*                                                               *       14500064
*        ISOLATE DEVICE NUMBER, CHANNEL ADDRESS AND             *       14550064
*              CONTROL UNIT ADDRESS                             *       14600064
*                                                               *       14650064
*****************************************************************       14700064
         SPACE                                                          14750064
         LA    IECIUNDX,IECIUDNM(0,0)  GET DEVICE NUMBER MASK           14800064
         NR    IECIUNDX,IECIUEVN   ISOLATE DEVICE NUMBER                14850064
         SRDL  IECIUEVN,8(0)       SEPARATE CHANNEL AND                 14900064
*                                  *CONTROL UNIT ADDRESSES              14950064
*                                  *IN EVEN/ODD REGS                    15000064
         SRL   IECIUODD,28(0)      ISOLATE CONTROL UNIT                 15050064
         SPACE                                                          15100064
*****************************************************************       15150064
*                                                               *       15200064
*        GO TO CHANNEL TABLE AND CALCULATE CONTROL UNIT INDEX   *       15250064
*        CALCULATE UCB TABLE INDEX AND OBTAIN UCB TABLE PTR     *       15300064
*                                                               *       15350064
*****************************************************************       15400064
         SPACE                                                          15450064
         L     IECIULST,CVTILK1-CVTMAP(0,IECIUCVT)  GET CHANNEL         15500064
*                                  *TABLE PTR                           15550064
         IC    IECIUEVN,0(IECIUEVN,IECIULST)  GET CHAN INDEX            15600064
         SPACE                                                          15650064
         ALR   IECIUEVN,IECIUODD   ADD CHAN INDEX TO CU ADDR   @ZA08721 15700064
         SPACE                                                          15750064
         ALR   IECIUEVN,IECIUEVN   GET 2 * THIS VALUE          @ZA08721 15800064
*                                  *TO GET CONTROL UNIT INDEX           15850064
         AH    IECIUNDX,0(IECIUEVN,IECIULST) ADD CU INDEX TO            15900064
*                                  *CU NO.                              15950064
         SPACE                                                          16000064
         ALR   IECIUNDX,IECIUNDX   DOUBLE CU INDEX                      16050064
*                                  *TO GET UCB PTR INDEX                16100064
         L     IECIULST,CVTILK2-CVTMAP(0,IECIUCVT)  GET DEVICE          16150064
*                                  *LIST PTR--START OF LIST             16200064
         LH    IECIUODD,0(IECIUNDX,IECIULST)  GET UCB PTR               16250064
         N     IECIUODD,IECIUMSK   AND OFF ANY PROPAGATED BITS @Z30AALB 16300064
         SPACE                                                          16350064
*****************************************************************       16400064
*                                                               *       16450064
*        SET RETURN CODE EQUAL TO ZERO, AND SET UCB ADDRESS     *       16500064
*                                                               *       16550064
*****************************************************************       16600064
         SPACE                                                          16650064
         SLR   IECIUNDX,IECIUNDX   SET RETURN CODE =0                   16700064
         ST    IECIUNDX,IECIURTC(0,IECIUSAV)  STORE RETURN CODE         16750064
*                                  *IN REG 15 REG SAVE                  16800064
         AIF   ('&UCB' EQ '').UCB040                                    16850064
         LA    IECIUNDX,&UCB(1).(0,0)   GET REG VALUE                   16900064
         SLL   IECIUNDX,2(0)  REG VALUE * 4 = INDEX                     16950064
         ST    IECIUODD,0(IECIUNDX,IECIUSAV)  SET UCB ADDR              17000064
         AGO   .UCB050                                                  17050064
.UCB040  ANOP                                                           17100064
         ST    IECIUODD,IECIUUCB(0,IECIUSAV) SET UCB ADDR               17150064
.UCB050  ANOP                                                           17200064
         B     IECIUXIT            GO RESTORE REGS                      17250064
         SPACE                                                          17300064
*********************************************************************** 17350064
*                                                                     * 17400064
*        CONSTANT FOR UCBLOOK FUNCTION, LOCATED HERE TO ALLEVIATE AN  * 17450064
*        EXTRA BRANCH INSTRUCTION AROUND IT.                          * 17500064
*                                                                     * 17550064
*********************************************************************** 17600064
         SPACE                                                          17650064
         DS    0F                  PERFORMANCE BOUNDRY         @Z30AALB 17700064
IECIUMSK DC    X'0000FFFF'         AND MASK FOR UCB ADDRESS    @Z30AALB 17750064
         SPACE                                                          17800064
*****************************************************************       17850064
*                                                               *       17900064
*    INVALID DEVICE ADDRESS.  SET RETURN CODE EQUAL TO FOUR.    *       17950064
*                                                               *       18000064
*****************************************************************       18050064
         SPACE                                                          18100064
IECIU070 LA    IECIUNDX,IECIURC4(0,0)   SET RETURN CODE =4              18150064
         ST    IECIUNDX,IECIURTC(0,IECIUSAV)  STORE IN REG 15           18200064
*                                  *SAVE AREA                           18250064
         SPACE                                                          18300064
*****************************************************************       18350064
*                                                               *       18400064
*        RESTORE REGISTERS AND RETURN INLINE TO CALLER          *       18450064
*                                                               *       18500064
*****************************************************************       18550064
         SPACE                                                          18600064
IECIUXIT LM    IECIUZRO,IECIUBAS,0(IECIUSAV)  RESTORE REGS              18650064
*                                  *REG 15 LOADS RETURN CODE            18700064
         DROP  IECIUBAS                                                 18750064
         MEXIT                                                          18800064
.*****     *****     *****     *****     *****     *****     *****      18850064
.*****     UCBFLG    *****     UCBFLG    *****     UCBFLG    *****      18900064
.*****     *****     *****     *****     *****     *****     *****      18950064
.FLG000  ANOP                                                           19000064
.*                                                                      19050064
.*       CSECT AUTHORIZATION                                            19100064
.*                                                                      19150064
         AIF   ('&SYSECT' EQ 'IGE0025C').FLGAUTH                        19200064
         AIF   ('&SYSECT' EQ 'IEFAB494').FLGAUTH                        19250064
         AIF   ('&SYSECT' EQ 'IGC0005I').FLGAUTH                        19300064
         AIF   ('&SYSECT' EQ 'IGC0905I').FLGAUTH                        19350064
         AIF   ('&SYSECT' EQ 'IEC1052').FLGAUTH                         19400064
         AIF   ('&SYSECT' EQ 'IFG0193B').FLGAUTH                        19450064
         AIF   ('&SYSECT' EQ 'IFG0194J').FLGAUTH                        19500064
         AIF   ('&SYSECT' EQ 'IFG0202G').FLGAUTH                        19550064
         AIF   ('&SYSECT' EQ 'IEEVCPU').FLGAUTH                         19600064
         AIF   ('&SYSECT' EQ 'AMDSAUCB').FLGAUTH                        19650064
         AIF   ('&SYSECT' EQ 'IECVIOPM').FLGAUTH                        19700064
         AIF   ('&SYSECT' EQ 'WMMCCABE').FLGAUTH                        19750064
         AIF   ('&SYSECT' EQ 'IGG0290F').FLGAUTH                        19800064
         AIF   ('&SYSECT' EQ 'IGG0191A').FLGAUTH                        19850064
         AIF   ('&SYSECT' EQ 'IGE0100I').FLGAUTH                        19900064
         AIF   ('&SYSECT' EQ 'IGFTMC00').FLGAUTH               @Z40WPLP 19950064
         AIF   ('&SYSECT' EQ 'IGFTMCHK').FLGAUTH                        20000064
         AIF   ('&SYSECT' EQ 'IGFDM1').FLGAUTH                          20050064
         AIF   ('&SYSECT' EQ 'IGFDI1').FLGAUTH                          20100064
         AIF   ('&SYSECT' EQ 'ER3890').FLGAUTH                          20150064
         AIF   ('&SYSECT' EQ 'IGG019S1').FLGAUTH                        20200064
         AIF   ('&SYSECT' EQ 'IGG0197D').FLGAUTH                        20250064
         AIF   ('&SYSECT' EQ 'IGG019V5').FLGAUTH                        20300064
         AIF   ('&SYSECT' EQ 'IATSSDI').FLGAUTH JES3 CTC      @Z40WPLD  20350064
         AIF   ('&SYSECT' EQ 'IATMSIO').FLGAUTH                         20400064
         AIF   ('&SYSECT' EQ 'IATGRCT').FLGAUTH                @ZM34513 20450064
         AIF   ('&SYSECT' EQ 'IECTCATN').FLGAUTH                        20500064
         AIF   ('&SYSECT' EQ 'IGG019S3').FLGAUTH               @ED030LD 20550064
         AIF   ('&SYSECT' EQ 'IGE0001H').FLGAUTH               @Y30LB16 20600064
         AIF   ('&SYSECT' EQ 'IEE3103D').FLGAUTH                        20650064
         AIF   ('&SYSECT' EQ 'IEFAB488').FLGAUTH               @ZA06075 20700064
         AIF   ('&SYSECT' EQ 'IGFDE1').FLGAUTH                 @ZA12429 20750064
         AIF   ('&SYSECT' EQ 'IGE0002E').FLGAUTH               @ZA11845 20800064
         AIF   ('&SYSECT' EQ 'IGE0003C').FLGAUTH                        20850064
         AIF   ('&SYSECT' EQ 'IGTUJA').FLGAUTH                          20900064
.*       AGO   .IOSGEN1                                        @ZA12429 20950064
.FLGAUTH ANOP                                                           21000064
.*                                                                      21050064
.*       CHECK FOR MISSING AND INVALID PARAMETERS                       21100064
.*                                                                      21150064
         AIF   ('&UCB' EQ '').IOSGEN3   REQUIRED KEYWORD                21200064
         AIF   (('&TABLE' EQ 'UCBACTV') OR ('&TABLE' EQ 'UCBBSY') OR   X21250064
               ('&TABLE' EQ 'UCBPSNS') OR ('&TABLE' EQ 'UCBNRY') OR    X21300064
               ('&TABLE' EQ 'UCBTICBT')).FLG005                         21350064
         AIF   (('&TABLE' EQ 'UCBDDRSW') OR ('&TABLE' EQ 'UCBQISCE')   X21400064
               OR ('&TABLE' EQ 'UCBIVRR') OR ('&TABLE' EQ 'UCBIVRS')   X21450064
               OR ('&TABLE' EQ '')).FLG005                              21500064
         AIF   ('&TABLE' EQ 'UCBPMSK').FLG005                           21550064
         AIF   ('&TABLE' EQ 'UCBIORST').FLG005                          21600064
         AIF   ('&TABLE' EQ 'UCBITF').FLG005                            21650064
         AIF   ('&TABLE' EQ 'UCBRVRS').FLG005                  @OZ03863 21700064
         AGO   .IOSGEN3                                                 21750064
.FLG005  ANOP                                                           21800064
         AIF   (('&TABLE' EQ 'UCBPMSK') AND (N'&REG LT 2)).IOSGEN2      21850064
         AIF   (('&VAR' NE 'ON') AND ('&VAR' NE 'OFF') AND             X21900064
               ('&VAR' NE 'TEST') AND ('&VAR' NE '')).IOSGEN4           21950064
         AIF   ('&TABLE' EQ 'UCBPMSK').FLG007                           22000064
         AIF   ('&TABLE' EQ 'UCBIORST').FLG007                          22050064
         AIF   ('&TABLE' EQ 'UCBITF').FLG007                            22100064
         AIF   (('&REG' NE 'COND') AND ('&REG' NE 'UNCOND') AND        X22150064
               ('&REG' NE '')).IOSGEN3                                  22200064
         AIF   ('&TABLE' EQ 'UCBRVRS').FLG007                  @ZA35584 22220064
         AIF   ((('&REG' EQ 'COND') OR ('&REG' EQ 'UNCOND')) AND       X22250064
               ('&TABLE' NE 'UCBNRY')).IOSGEN3                          22300064
         AIF   ((('&TABLE' EQ 'UCBACTV') OR ('&TABLE' EQ 'UCBBSY')     X22350064
               OR ('&TABLE' EQ 'UCBPSNS')) AND (('&VAR' NE 'TEST')     X22400064
               AND ('&VAR' NE ''))).IOSGEN4                             22450064
.FLG007  ANOP                                                           22500064
         AIF   ('&IECIFLG' EQ '1').FLG010    ONE CALL ONLY              22550064
&IECIFLG SETB  1                        SET FIRST TIME SWITCH           22600064
         SPACE 2                                                        27250002
*****************************************************************       27300002
*                                                               *       27350002
* FUNCTION:                                                     *       27400002
*    UCBFLG - TESTS, SETS OR RESETS SELECTED STATUS             *       27450064
*             INDICATORS IN THE UCB.                            *       27470064
*                                                               *       27490064
* MACRO CALL:                                                   *       27510064
*    LABEL  IOSGEN  UCBFLG,UCB=(REG),VAR=ON OR OFF OR TEST,     *       27530064
*                   TABLE=UCBBITNAME,REG=COND OR UNCOND OR      *       27550064
*                   (REG1,REG2)                                 *       27570064
*                                                               *       27590064
*         PLS - GEN REFS(UCBFLA,UCBFLB,UCBFLC,CVTPTR,           *       27610064
*               CVTIXAVL,IOCGENA,UCBOB,UCBCCWOF,UCB3TAPE,       *       27630064
*               CVTMAP,IOCOM,UCBCMEXT,UCBEXTPT)                 *       27650064
*               (IOSGEN UCBFLG,...KEYWORDS AS IN BAL);          *       27670064
*         NOTE:  %DEACT OFF; MUST FOLLOW INCLUDE STATEMENTS     *       27690064
*                FOR VAR=OFF.                                   *       27710064
*         NOTE:  THE ABOVE REPRESENT THE MAXIMUM REFERENCES     *       27730064
*                REQUIRED.                                      *       27750064
*                                                               *       27770064
*    SPECIAL TAPE OPTION:                                       *       27790064
*         LABEL  IOSGEN  UCBFLG,UCB=(REG)                       *       27810064
*                                                               *       27830064
*    SPECIAL UCBPMSK OPTION:                                    *       27850064
*         LABEL  IOSGEN  UCBFLG,UCB=(REG),TABLE=UCBPMSK,        *       27870064
*                        REG=(REG1,REG2)                        *       27890064
*                                                               *       27910064
* INPUT:                                                        *       27930064
*    REGISTER 13 MUST CONTAIN THE ADDRESS OF 16 WORD SAVEAREA   *       27950064
*    FOR THE 'ON' OR 'OFF' OPTIONS AND SPECIAL TAPE OPTION.     *       27970064
*                                                               *       27990064
*    UCB=  MUST SPECIFY A GPR (ABSOLUTE OR SYMBOLIC) CONTAINING *       28010064
*    THE ADDRESS OF THE UCB REPRESENTING THE DEVICE FOR WHICH   *       28030064
*    THE FUNCTION IS DIRECTED.  THIS GPR MUST POINT TO THE      *       28050064
*    UCB COMMON SEGMENT. FOR MULTIPLE EXPOSURE DEVICES,         *       28070064
*    IECVGENA WILL ACQUIRE THE UCB LOCK FROM THE BASE UCB       *       28090064
*    AND WILL USE THE ADDRESS IN THIS PARAMETER  TO             *       28110064
*    PERFORM THE REQUESTED OPERATION.                           *       28130064
*                                                               *       28150064
*    VAR=  INDICATES THE TYPE OF ACTION TO BE PERFORMED.        *       28170064
*         ON - THE DESIGNATED INDICATOR IS TO BE TURNED ON.     *       28190064
*         OFF - THE DESIGNATED INDICATOR IS TO BE TURNED OFF.   *       28210064
*         TEST - (DEFAULT) THE DESIGNATED INDICATOR IS TO       *       28230064
*                BE TESTED.                                     *       28250064
*                                                               *       28270064
*    TABLE=  SPECIFIES THE SYMBOLIC NAME OF THE INDICATOR TO    *       28290064
*    BE TESTED, SET, OR RESET.  THE FOLLOWING SYMBOLS ARE       *       28310064
*    SUPPORTED:                                                 *       28330064
*         UCBACTV  - CHANNEL END IS OUTSTANDING ('TEST' ONLY).  *       28350064
*         UCBBSY   - DEVICE END IS OUTSTANDING ('TEST' ONLY).   *       28370064
*         UCBPSNS  - A SENSE OPERATION IS EITHER PENDING OR     *       28390064
*                    ACTIVE ('TEST' ONLY).                      *       28410064
*         UCBNRY   - THE DEVICE IS NOT READY.                   *       28430064
*         UCBTICBT - A CHANNEL END OR DEVICE END INTERRUPT      *       28450064
*                    HAS BEEN SOLICITED FROM THE DEVICE AND IS  *       28470064
*                    CURRENTLY OUTSTANDING.                     *       28490064
*         UCBDDRSW - A VOLUME SWITCH (DYNAMIC DEVICE            *       28510064
*                    RECONFIGURATION) IS PENDING ON THIS DEVICE.*       28530064
*         UCBQISCE - A COMPONENT HAS INHIBITED FURTHER I/O FROM *       28550064
*                    BEING INITIATED TO A DEVICE EXCEPT I/O     *       28570064
*                    REQUESTS FROM THAT COMPONENT.              *       28590064
*         UCBIVRS  - INTERVENTION REQUIRED MESSAGE HAS BEEN SENT*       28610064
*         UCBIVRR  - INTERVENTION REQUIRED MESSAGE IS NEEDED.   *       28630064
*         UCBPMSK  - RESETS THE PATH MASK FOR MESSAGES ISSUED.  *       28650064
*         UCBIORST - I/O RESTART DEVICE NON-ACCESSABLE.         *       28670064
*         UCBITF - INTERCEPT CONDITION.                         *       28690064
*         UCBRVRS - NOTREADY AND INTERVENTION MSG       @OZ03863*       28710064
*                    SENT.                                      *       28730064
*                                                               *       28750064
*    REG=  APPLIES TO UCBNRY ('ON' ONLY), UCBPMSK OR           @ZA35584 28770064
*                     UCBRVRS                                  @ZA35584 28776064
*         COND   - (DEFAULT) IMPLIES THAT THE NOT READY STATUS  *       28790064
*                   IS TO BE SET ONLY IF AN UNSOLICITED DEVICE  *       28810064
*                   END HAS NOT OCCURED SINCE THE LAST SIO      *       28830064
*                   WAS ISSUED.                                 *       28850064
*         UNCOND - IMPLIES SETTING THE INDICATOR REGARDLESS OF  *       28870064
*                  THE INTERRUPT STATUS.                        *       28890064
*         (REG1,REG2) - GENERAL REGISTERS USED FOR              *       28910064
*                  COMPARE AND SWAP INSTRUCTION.                *       28930064
*                                                               *       28950064
*    LABEL  OPTIONAL LABEL PARAMETER.                           *       28970064
*                                                               *       28990064
*    OPTIONAL TAPE OPTION - THE STATUS INDICATORS 'NOT READY'   *       29010064
*    AND 'INTERCEPT CONDITION' ARE SET OFF.  THIS CALL IS VALID *       29030064
*    ONLY FOR A TAPE DEVICE AND IF BOTH THE STATUS INDICATORS   *       29050064
*    ARE ALREADY SET ON.  THE 16 WORD SAVE AREA IS REQUIRED FOR *       29070064
*    THIS EXPANSION.  TO RESET AN INTERCEPT CONDITION, I/O      *       29090064
*    SUPERVISOR RESOURCES ALLOCATED TO MAINTAIN THE STATUS OF   *       29110064
*    THE INTERRUPT MUST BE RELEASED.                            *       29130064
*                                                               *       29150064
* OUTPUT:                                                       *       29170064
*    TEST OPTION - THE CONDITION CODE OF ZERO INDICATES THE     *       29190064
*    INDICATOR IS TURNED OFF.                                   *       29210064
*                                                               *       29230064
* EXTERNAL ROUTINES:                                            *       29250064
*    IECVGENA - RESIDENT IOSGEN SUBROUTINE. THIS MODULE IS      *       29270064
*    ENTERED VIA A BAL INSTRUCTION FOR ALL CONDITIONS EXCEPT    *       29290064
*    'TEST' AND THE RESET OF UCBPMSK.                           *       29310064
*                                                               *       29330064
* ATTRIBUTES:                                                   *       29350064
*    THE UCBFLG FUNCTION IS EXPANDED AS IN-LINE, REENTRANT      *       29370064
*    CODE AND MAY BE EXPANDED A VARIABLE NUMBER OF TIMES        *       29390064
*    WITHIN THE SAME ASSEMBLY WITHOUT DUPLICATING SYMBOLS.      *       29410064
*                                                               *       29430064
* OTHER:                                                        *       29450064
*    A RESET OF THE 'UCBQISE' INDICATOR WILL ALSO CAUSE         *       29470064
*    THE DEVICE TO BE RESTARTED BY THE I/O SUPERVISOR           *       29490064
*    THE NEXT TIME ENTERED.                                     *       29510064
*                                                               *       29530064
*    THE FOLLOWING MAPPING MACRO ARE REQUIRED:                  *       29550064
*         IEFUCBOB              (TEST ONLY)                     *       29570064
*         CVT   DSECT=YES       (ON & OFF ONLY)                 *       29590064
*         IECDIOCM              (ON & OFF ONLY)                 *       29610064
*                                                               *       29900002
*    LOCKS ARE NOT REQUIRED BY THIS FUNCTION.                   *       29950002
*                                                               *       30000002
*****************************************************************       30050002
         SPACE 2                                                        30100002
*****************************************************************       30150002
*                                                               *       30200002
*        REGISTER EQUATES                                       *       30250064
*                                                               *       30280064
*****************************************************************       30310064
         SPACE                                                          30340064
IECIFGR0 EQU   0                   UCB PREFIX OFFSET REG                30370064
IECIFUCB EQU   4                   UCB PTR                              30400064
IECIFVAR EQU   5                   VARIATION VALUE REG                  30430064
*                                  *APPLIES TO NORMAL REQUESTS          30460064
IECIFSAV EQU   13                  SAVE AREA PTR                        30490064
IECIFRTN EQU   14                  RETURN REG FROM IECVGENA             30520064
IECIFBRR EQU   15                  BRANCH REG TO IECVGENA               30550064
         SPACE                                                          30580064
*****************************************************************       30610064
*                                                               *       30640064
*        UCB - UNIT CONTROL BLOCK                               *       30670064
*              FLAGS DEFINED TO PREVENT PLS XREF PROBLEMS       *       30700064
*                                                               *       30730064
*****************************************************************       30760064
         SPACE                                                          30790064
IECIFXXX EQU   512                 UCB PREFIX                           30820064
IECIFACT EQU   X'02'               UCBACTV - TEST                       30850064
IECIFBSY EQU   X'80'               UCBBSY - TEST                        30880064
IECIFDDR EQU   X'01'               UCBDDRSW  - TEST                     30910064
IECIFIOR EQU   X'80'               UCBIORST - TEST                      30940064
IECIFIVR EQU   X'04'               UCBIVRR  - TEST                      30970064
IECIFIVS EQU   X'08'               UCBIVRS  - TEST                      31000064
IECIFNRY EQU   X'40'               UCBNRY  - TEST                       31030064
*                                  *AND (SPECIAL TAPE CALL)             31060064
IECIFPSN EQU   X'10'               UCBPSNS  - TEST                      31090064
IECIFQIS EQU   X'01'               UCBQISCE  - TEST                     31120064
IECIFTIC EQU   X'02'               UCBTICBT  - TEST                     31150064
IECIFUDE EQU   X'20'               UCBUDE - (UCBNRY 'ON' COND)          31180064
IECIF3TA EQU   X'80'               UCB3TAPE - (SPECIAL TAPE CALL)       31210064
IECIFINT EQU   X'10'               UCBITF - TEST                        31240064
*                                  *AND (SPECIAL TAPE CALL)             31270064
         SPACE                                                          31300064
*****************************************************************       31330064
*                                                               *       31360064
*        SPECIAL ENTRY POINT BRANCH TABLE VALUES FOR IECVGENA   *       31390064
*        THESE VALUES ARE DISPLACEMENTS FROM REGISTER 15        *       31420064
*        ALL UCBFLG VARIATIONS USE THE DISPLACEMENT 'IECIFLOK'  *       31450064
*                                                               *       31480064
*****************************************************************       31510064
         SPACE                                                          31540064
*        EQU   0                   NOT AVAILABLE   (SWAP)               31570064
*        EQU   4                   NOT AVAILABLE   (VARY)               31600064
*        EQU   8                   NOT AVAILABLE   (RESERVED)           31630064
*        EQU   12                  NOT AVAILABLE   (RESERVED)           31660064
IECIFLOK EQU   16                  UCBFLG                               31690064
*                                  *SETS UCB LOCK IMMEDIATELY           31720064
         SPACE                                                          31750064
*****************************************************************       31780064
*                                                               *       31810064
*        NORMAL BRANCH TABLE VALUES FOR IECVGENA                *       31840064
*        THESE VALUES ARE DISPLACEMENTS FROM REGISTER 5         *       31870064
*                                                               *       31900064
*****************************************************************       31930064
         SPACE                                                          31960064
IECIFNRC EQU   0                   UCBNRY - ON (CONDITIONALLY)          31990064
IECIFNRN EQU   4                   UCBNRY - ON (UNCONDITIONALLY)        32020064
IECIFNIS EQU   8                   UCBNRY & UCBITF - OFF (TAPE)         32050064
IECIFNRF EQU   12                  UCBNRY - OFF                         32080064
IECIFTIN EQU   20                  UCBTICBT - ON                        32110064
IECIFTIF EQU   28                  UCBTICBT - OFF                       32140064
IECIFDDN EQU   36                  UCBDDRSW - ON                        32170064
IECIFDDF EQU   44                  UCBDDRSW - OFF                       32200064
IECIFQIN EQU   52                  UCBQISCE - ON                        32230064
IECIFQIF EQU   60                  UCBQISCE - OFF                       32260064
IECIFIVN EQU   68                  UCBIVRR - ON                         32290064
IECIFIVF EQU   76                  UCBIVRR - OFF                        32320064
IECIFRSN EQU   84                  UCBIVRS - ON                         32350064
IECIFRSF EQU   92                  UCBIVRS - OFF                        32380064
IECIFION EQU   100                 UCBIORST - ON                        32410064
IECIFIOF EQU   108                 UCBIORST - OFF                       32440064
IECIFITN EQU   116                 UCBITF - ON                          32470064
IECIFITF EQU   124                 UCBITF - OFF                         32500064
IECIFRVN EQU   128                 UCBNRY ON-UCBIVRS ON        @OZ03863 32530064
*                                  UNDER SAME LOCK             @OZ03863 32560064
IECIFRVF EQU   136                 UCBNRY & IVRS OFF  @ZA16174,@OZ03863 32590064
*                                  UNDER SAME LOCK             @OZ03863 32620064
         SPACE                                                          32650064
.FLG010  ANOP                                                           32680064
.*                                                                      32710064
.*       CHECK FOR TYPE OF VARIATION                                    32740064
.*                                                                      32770064
         AIF   ('&TABLE' EQ 'UCBPMSK').FLG170  SPECIAL UCBPMSK CALL     32800064
         AIF   ('&TABLE' EQ '').FLG070  SPECIAL TAPE CALL               32830064
         AIF   (('&VAR' NE 'TEST') AND ('&VAR' NE '')).FLG080           32860064
.*                                                                      32890064
.*       MUST BE 'TEST'                                                 32920064
.*       SET &FIELD EQUAL TO UCB FIELD NAME                             32950064
.*       SET &BIT TO EQUATE DESIGNATION                                 32980064
.*                                                                      33010064
         AIF   ('&TABLE' NE 'UCBIVRS').FLG020                           33040064
&BIT     SETC  'IVS'                    PREVENT DUPLICATE SYMBOLS       33070064
         AGO   .FLG030                                                  33100064
.FLG020  ANOP                                                           33130064
&BIT     SETC  '&TABLE'(4,3)            SET BIT NAME                    33160064
.FLG030  ANOP                                                           33190064
         AIF   (('&TABLE' NE 'UCBACTV') AND ('&TABLE' NE 'UCBBSY')     X33220064
               AND ('&TABLE' NE 'UCBQISCE') AND ('&TABLE' NE           X33250064
               'UCBPSNS') AND ('&TABLE' NE 'UCBNRY')).FLG040            33280064
&FIELD   SETC  'UCBFLA'                                                 33310064
         AGO   .FLG060                                                  33340064
.FLG040  ANOP                                                           33370064
         AIF   ('&TABLE' NE 'UCBIORST').FLG050                          33400064
&FIELD   SETC  'UCBFLB'                                                 33430064
         AGO   .FLG060                                                  33460064
.FLG050  ANOP                                                           33490064
&FIELD   SETC  'UCBFLC'                                                 33520064
.*                                                                      33550064
.*       CHECK FOR UCBITF TO AVOID DUPLICATE SYMBOLS                    33580064
.*                                                                      33610064
         AIF   ('&TABLE' NE 'UCBITF').FLG060                            33640064
&BIT     SETC  'INT'                                                    33670064
.*                                                                      33700064
.*       CONSTRUCT FOR 'TEST'                                           33730064
.*                                                                      33760064
.FLG060  ANOP                                                           33790064
&NAME    TM    &FIELD.-UCBOB&UCB.,IECIF&BIT   TEST SELECTED BIT         33820064
         MEXIT                                                          33850064
.*                                                                      33880064
.*       MUST BE UCBNRY AND UCBITF 'OFF' FOR SPECIAL TAPE CALL          33910064
.*                                                                      33940064
.FLG070  ANOP                                                           33970064
&BIT     SETC  'NI'                                                     34000064
&INDEX   SETC  'S'                                                      34030064
&LABEL   SETC  '&SYSNDX'(2,3)                                           34060064
&NAME    TM    UCBTBYT3-UCBOB&UCB.,IECIF3TA  IS IT A TAPE               34090064
         BNO   IECIF&LABEL         NO, EXIT IMMEDIATELY                 34120064
         TM    UCBFLA-UCBOB&UCB.,IECIFNRY  IS DEV NOT READY             34150064
         BNO   IECIF&LABEL         NO, EXIT IMMEDIATELY                 34180064
         TM    UCBFLC-UCBOB&UCB.,IECIFINT  IS IT                        34210064
*                                  *INTERCEPT CONDITION                 34240064
         BNO   IECIF&LABEL         NO, EXIT IMMEDIATELY                 34270064
         AGO   .FLG140                                                  34300064
.*                                                                      34330064
.*       MUST BE 'ON' OR 'OFF'                                          34360064
.*       CHECK FOR UCBNRY 'ON' AND TYPE OF CONDITION                    34390064
.*                                                                      34420064
.FLG080  ANOP                                                           34450064
         AIF   (('&TABLE' NE 'UCBNRY') OR (('&TABLE' EQ 'UCBNRY')      X34480064
               AND ('&VAR' EQ 'OFF'))).FLG090                           34510064
         AIF   (('&REG' NE 'COND') AND ('&REG' NE '')).FLG100           34540064
.*                                                                      34570064
.*       MUST BE UCBNRY 'ON' - 'COND'                                   34600064
.*                                                                      34630064
&BIT     SETC  'NR'                                                     34660064
&INDEX   SETC  'C'                                                      34690064
&LABEL   SETC  '&SYSNDX'(2,3)                                           34720064
&NAME    TM    UCBFLC-UCBOB&UCB.,IECIFUDE  IS IT                        34750064
*                                  *UNSOLICITED DEVICE END              34780064
         BO    IECIF&LABEL         YES, EXIT IMMEDIATELY                34810064
         AGO   .FLG140                                                  34840064
.*                                                                      34870064
.*       CHECK FOR UCBIVRS TO PREVENT DUPLICATE SYMBOLS                 34900064
.*                                                                      34930064
.FLG090  ANOP                                                           34960064
         AIF   ('&TABLE' NE 'UCBIVRS').FLG100                           34990064
&BIT     SETC  'RS'                                                     35020064
         AGO   .FLG110                                                  35050064
.*                                                                      35080064
.*       SET &BIT TO REMAINING FIRST TWO CHARACTERS                     35110064
.*                                                                      35140064
.FLG100  ANOP                                                           35170064
&BIT     SETC  '&TABLE'(4,2)            GET FIRST 2 CHARS AFTER UCB     35200064
&LABEL   SETC  '&SYSNDX'(2,3)                                  @ZA03863 35230064
.*                                                                      35260064
.*       SET &INDEX FOR 'ON' OR 'OFF'                                   35290064
.*                                                                      35320064
.FLG110  ANOP                                                           35350064
         AIF   ('&VAR' NE 'ON').FLG120                                  35380064
&INDEX   SETC  'N'                      MUST BE 'ON'                    35410064
         AGO   .FLG125                                         @OZ03863 35440064
.FLG120  ANOP                                                           35470064
&INDEX   SETC  'F'                      MUST BE 'OFF'                   35500064
.FLG125 AIF ('&TABLE' NE 'UCBRVRS').FLG130                     @OZ03863 35530064
         AIF   ('&REG' EQ 'UNCOND').FLG130                     @ZA35584 35540064
&NAME    TM    UCBFLC-UCBOB&UCB.,IECIFUDE IS IT UNSOLICITED             35560064
*                                         * END                         35590064
         BO    IECIF&LABEL                YES, EXIT IMMEDIATELY         35620064
         AGO   .FLG140                                         @OZ03863 35650064
.*                                                                      35680064
.*       CONSTRUCT REGISTER SAVE AND RESTORE                            35710064
.*       SET UCB PTR FOR IECVGENA                                       35740064
.*       GET IECVGENA ENTRY POINT                                       35770064
.*                                                                      35800064
.FLG130  ANOP                                                           35830064
&NAME    STM   IECIFGR0,IECIFBRR,0(IECIFSAV)  SAVE REGS                 35860064
         AGO   .FLG150                                                  35890064
.FLG140  ANOP                                                           35920064
         STM   IECIFGR0,IECIFBRR,0(IECIFSAV)  SAVE REGS                 35950064
.FLG150  ANOP                                                           35980064
         LR    IECIFUCB,&UCB(1)    SET IECVGENA UCB PTR                 36010064
         LA    IECIFGR0,IECIFXXX(0,0)  GET PREFIX OFFSET                36040064
         SLR   IECIFUCB,IECIFGR0   ADJUST TO PREFIX                     36070064
         L     IECIFBRR,CVTPTR(0,0)  GET CVT PTR                        36100064
         L     IECIFBRR,CVTIXAVL-CVTMAP(0,IECIFBRR)  GET IOCOM PTR      36130064
         L     IECIFBRR,IOCGENA-IOCOM(0,IECIFBRR)  GET IECVGENA PTR     36160064
         LA    IECIFVAR,IECIF&BIT.&INDEX.(0,0)  BRANCH TABLE ENTRY      36190064
*                                  *FOR THIS OPERATION                  36220064
         BAL   IECIFRTN,IECIFLOK(0,IECIFBRR)  CALL IECVGENA             36250064
         LM    IECIFGR0,IECIFBRR,0(IECIFSAV)  RESTORE REGS              36280064
.*                                                                      36310064
.*       GENERATE BRANCH LABELS FOR                                     36340064
.*       SPECIAL TAPE CALL AND UCBNRY 'ON' CONDITIONALLY                36370064
.*       ALSO SETTING UCBNRY & UCBIVR FOR MVM ERP              @OZ03863 36400064
.*       UNDER ONE LOCK.                                       @OZ03863 36430064
.*                                                                      36460064
         AIF   ('&TABLE' EQ 'UCBRVRS').FLG155                  @OZ03863 36490064
         AIF   ('&BIT'(1,1) NE 'N').FLG160                              36520064
         AIF   (('&INDEX' NE 'C') AND ('&INDEX' NE 'S')).FLG160         36550064
.FLG155  ANOP                                                  @OZ03863 36580064
IECIF&LABEL EQU *                  CONTINUE PROCESSING                  36610064
.FLG160  ANOP                                                           36640064
         MEXIT                                                          36670064
.*                                                                      36700064
.*     SPECIAL UCBPMSK CALL                                             36730064
.*                                                                      36760064
.FLG170  ANOP                                                           36790064
&INDEX   SETC  '&SYSNDX'(3,2)      SET UNIQUE EQUATE SUFFIX             36820064
&LABEL   SETC  '&SYSNDX'(2,3)      SET UNIQUE LABEL SUFFIX              36850064
&NAME    B     IECIF&LABEL         GO AROUND CONSTANT                   36880064
         DS    0F                  GET FULLWORD ALIGNMENT               36910064
IECIFM&INDEX DC X'FFFF0000'        ANDING MASK FOR UCBPMSK              36940064
*                                                             *@ZA02138 36970064
IECIF&LABEL L &UCB(1).,UCBEXTPT-UCBOB(0,&UCB(1).) GET EXT PTR  @ZA00425 37000064
         LA    &UCB(1).,0(0,&UCB(1).)  CLEAR HI ORDER BYTE              37030064
*                                                             *@ZA02138 37060064
IECIFP&INDEX L &REG(1),UCBCCWOF-UCBCMEXT(0,&UCB(1).) GET UCBPMSK        37090064
         L     &REG(2).,IECIFM&INDEX.(0)  GET ANDING MASK               37120064
         NR    &REG(2).,&REG(1)    AND OUT BITS                         37150064
         CS    &REG(1).,&REG(2).,UCBCCWOF-UCBCMEXT&UCB  SWAP            37180064
         BNE   IECIFP&INDEX        LOOP UNTIL SWAP IS COMPLETE @ZA02138 37210064
         MEXIT                                                          37240064
.*****     *****     *****     *****     *****     *****     *****      37270064
.*****     TP*TP     *****     TP*TP     *****     TP*TP     *****      37300064
.*****     *****     *****     *****     *****     *****     *****      37330064
.TP000   ANOP                                                           37360064
.*                                                                      37390064
.*       CSECT AUTHORIZATION                                            37420064
.*                                                                      37450064
         AIF   ('&SYSECT' EQ 'WMMCCABE').TPAUTH                         37480064
         AIF   ('&SYSECT' EQ 'ISTINCAV').TPAUTH                         37510064
         AIF   ('&SYSECT' EQ 'HASPINIT').TPAUTH                         37540064
         AIF   ('&SYSECT' EQ 'HASPNUC').TPAUTH                          37570064
         AIF   ('&SYSECT' EQ 'IATINCN').TPAUTH                          37600064
         AIF   ('&SYSECT' EQ 'IATLVIN').TPAUTH                          37630064
         AIF   ('&SYSECT' EQ 'IEAVNP19').TPAUTH     MSS        @ZUP1085 37660064
         AIF   ('&SYSECT' EQ 'IGG0198B').TPAUTH                @YM02910 37690064
         AIF   ('&SYSECT' EQ 'IGG02036').TPAUTH                @YM02910 37720064
         AIF   ('&SYSECT' EQ 'IGG01938').TPAUTH                @YM02910 37750064
         AIF   ('&SYSECT' EQ 'IEDQOT01').TPAUTH                @YM02910 37780064
         AIF   ('&SYSECT' EQ 'IGG01939').TPAUTH                @Y30X8LB 37810064
         AIF   ('&SYSECT' EQ 'IEDIAA').TPAUTH                  @Y30X8LB 37840064
         AIF   ('&SYSECT' EQ 'ICBINIT' ).TPAUTH                @Y30LPLC 37870064
.*       AGO   .IOSGEN1                                        @ZA12429 37900064
.TPAUTH  ANOP                                                           37930064
.*                                                                      37960064
.*       CHECK PARAMETERS FOR ERRORS                                    37990064
.*                                                                      38020064
         AIF   (('&UCB' EQ '') OR ('&VAR' EQ '')).IOSGEN3               38050064
         AIF   ('&VAR' NE 'ATNMOD').TP010                               38080064
         AIF   ('&TABLE' EQ '').IOSGEN3                                 38110064
         AIF   ('&REG' EQ '').TP030                                     38140064
         AIF   (N'&REG LT 2).IOSGEN2                                    38170064
         AGO   .TP030                                                   38200064
.TP010   ANOP                                                           38230064
         AIF   (('&VAR' EQ 'ATNTABG') OR ('&VAR' EQ 'ATNTABT')).TP030   38260064
         AIF   (K'&VAR NE 2).IOSGEN4                                    38290064
.TP030   ANOP                                                           38320064
         AIF   ('&IECITP' EQ '1').TP040 CHECK FIRST TIME SWITCH         38350064
&IECITP  SETB  1                        SET SWITCH                      38380064
         SPACE 2                                                        41650002
*****************************************************************       41700002
*                                                               *       41750002
* FUNCTION:                                                     *       41800002
*    TP - WILL MODIFY THE ATTENTION TABLE INDEX OR ERROR        *       41850064
*         TABLE INDEX IN THE UCB.                               *       41890064
*                                                               *       41930064
*    LABEL  IOSGEN  TP,UCB=(GPR),VAR=ATNTABG OR ATNTABT OR      *       41970064
*           ERRTAB OR ATNMOD,                                   *       42010064
*           TABLE=(GPR),REG=(GPR1,GPR2)                         *       42050064
*                                                               *       42090064
*    PLS - GEN REFS(UCBOB,UCBETI,UCBATI,CVTPTR,CVTMAP,          *       42130064
*          CVTIXAVL,ATBRTN,ATB,IOCATTBL,IOCOM,UCBEXTPT,         *       42170064
*          UCBCMEXT,ATBASID)                                    *       42210064
*          (IOSGEN TP,...KEYWORDS AS IN BAL);                   *       42250064
*                                                               *       42290064
* INPUT:                                                        *       42330064
*    UCB=  MUST SPECIFY A GPR (ABSOLUTE OR SYMBOLIC)            *       42370064
*    CONTAINING THE ADDRESS OF THE UCB COMMON SEGMENT TO        *       42410064
*    BE MODIFIED.                                               *       42450064
*                                                               *       42490064
*    VAR=  ATTENTION TABLE INDEX OR ERROR TABLE INDEX.          *       42530064
*         ATNTABG - ATTENTION TABLE INDEX FOR GRAPHICS.         *       42570064
*         ATNTABT - ATTENTION TABLE INDEX FOR TELEPROCESSING.   *       42610064
*         ERRTAB  - MUST SPECIFY THE NEW ERRTAB INDEX           *       42650064
*                   IN HEX (2A,2B,ETC. ).  IT WILL RESULT       *       42690064
*                   IN CODE TO RESET THE ERRTAB INDEX.          *       42730064
*         ATNMOD - ATTENTION TABLE INDEX FOR JES.               *       42770064
*                                                               *       42810064
*    TABLE=  (ATNMOD ONLY) MUST SPECIFY A GPR (ABSOLUTE OR      *       42850064
*    SYMBOLIC) WHICH CONTAINS THE ATTENTION TABLE INDEX         *       42890064
*    RIGHT ALIGNED.                                             *       42930064
*                                                               *       42970064
*    REG=(GPR1,GPR2)  THIS PARAMETER IS REQUIRED ONLY           *       43010064
*    IF THE USER (ATNMOD ONLY). DESIRES THE OPTION TO           *       43050064
*    CHANGE THE ATTENTION TABLE ROUTINE ADDRESS AND THE ASID.   *       43090064
*        GPR1 - MUST CONTAIN THE ADDRESS OF THE ATTENTION       *       43130064
*               ROUTINE RIGHT ALIGNED OR ZERO.                  *       43170064
*        GPR2 - MUST CONTAIN THE ASID RIGHT ALIGNED OR ZERO.    *       43210064
*                                                               *       43250064
* OUTPUT:                                                       *       43290064
*    NONE.                                                      *       43330064
*                                                               *       43370064
* ATTRIBUTES:                                                   *       43410064
*    THE FUNCTION EXPANDS AS IN-LINE,REENTRANT CODE             *       43450064
*    AND MAY BE EXPANDED A VARIABLE NUMBER OF TIMES             *       43490064
*    IN THE CALLING CSECT.                                      *       43530064
*                                                               *       43570064
* OTHER:                                                        *       43610064
*    THE EXPANSION OF THE FUNCTION IS DEPENDENT ON THE          *       43650064
*    SPECIFICATION OF THE FOLLOWING MAPPING MACROS              *       43690064
*    IN THE CALLING CSECT ASSEMBLY:                             *       43730064
*         IEFUCBOB                                              *       43770064
*         CVT      DSECT=YES    (ATNMOD WITH REG= ONLY)         *       43810064
*         IECDIOCM              (ATNMOD WITH REG= ONLY)         *       43850064
*         IECDATB               (ATNMOD WITH REG= ONLY)         *       43890064
*                                                               *       43930064
*    NO LOCKS ARE REQUIRED FOR THIS FUNCTION IN THAT            *       43970064
*    ONLY SEQUENTLY ALLOCATED DEVICES ARE SUPPORTED             *       44010064
*    (VIA AUTHORIZATION PROVIDED BY THE CALLING CSECT NAME)     *       44050064
*    AND SERIALIZATION IS ASSUMED.                              *       44090064
*                                                               *       44400002
*****************************************************************       44450002
         SPACE 2                                                        44500002
*****************************************************************       44550002
*                                                               *       44600002
*        UCB - UNIT CONTROL BLOCK                               *       44650064
*              ATTENTION TABLE INDEX AND ERROR TABLE INDEX      *       44700064
*                                                               *       44750064
*****************************************************************       44800064
         SPACE                                                          44850064
IECITABG EQU   X'10'               ATNTABG (GRAPHICS)                   44900064
IECITABT EQU   X'14'               ATNTABT (TELEPROCESSING)             44950064
         SPACE                                                          45000064
.TP040   ANOP                                                           45050064
&NAME    L     &UCB(1).,UCBEXTPT-UCBOB(0,&UCB(1).) GET EXT PTR          45100064
         LA    &UCB(1).,0(0,&UCB(1).) CLEAR HI ORDER BYTE               45150064
.*                                                                      45200064
.*       CHECK FOR TYPE OF ACTION                                       45250064
.*                                                                      45300064
         AIF   ('&VAR' EQ 'ATNMOD').TP060                               45350064
         AIF   (('&VAR' EQ 'ATNTABG') OR ('&VAR' EQ 'ATNTABT')).TP050   45400064
.*                                                                      45450064
.*       CONSTRUCT ERROR TABLE INDEX CODE                               45500064
.*                                                                      45550064
&INDEX   SETC  '&SYSNDX'(2,3)           SET TO LAST 3 DIGITS            45600064
IECIT&INDEX EQU   X'&VAR'                  ERROR TABLE INDEX            45650064
         MVI   UCBETI-UCBCMEXT&UCB.,IECIT&INDEX  SET ERROR              45700064
*                                  *TABLE INDEX                         45750064
         MEXIT                                                          45800064
.*                                                                      45850064
.*       SET UP ATTENTION TABLE INDEX                                   45900064
.*                                                                      45950064
.TP050   ANOP                                                           46000064
&INDEX   SETC  '&VAR'(5,3)                                              46050064
         MVI   UCBATI-UCBCMEXT&UCB.,IECIT&INDEX  SET ATTENTION          46100064
*                                  *TABLE INDEX                         46150064
         MEXIT                                                          46200064
.TP060   ANOP                                                           46250064
         AIF   ('&REG' NE '').TP080                                     46300064
         STC   &TABLE(1).,UCBATI-UCBCMEXT(0,&UCB(1).)                   46350064
*                                  *SET ATTENTION TABLE INDEX           46400064
         MEXIT                                                          46450064
.*                                                                      46500064
.*       CONSTRUCT UNIQUE LABEL                                         46550064
.*                                                                      46600064
.TP080   ANOP                                                           46650064
&LABEL   SETC  '&SYSNDX'(2,3)      SET LAST 3 DIGITS                    46700064
         STC   &TABLE(1).,UCBATI-UCBCMEXT(0,&UCB(1).)                   46750064
*                                  *SET ATTENTION TABLE INDEX           46800064
         LTR   &REG(1).,&REG(1)                                         46850064
*                                  *TEST FOR ATTENTION TABLE RTN ADDR   46900064
         BZ    IECIT&LABEL         NONE, EXIT                           46950064
         L     &UCB(1).,CVTPTR(0,0)  GET CVT PTR                        47000064
         L     &UCB(1).,CVTIXAVL-CVTMAP(0,&UCB(1).)                     47050064
*                                  *GET IOCOM PTR                       47100064
         L     &UCB(1).,IOCATTBL-IOCOM(0,&UCB(1).)                      47150064
*                                  *GET ATTENTION TABLE PTR             47200064
         SLL   &TABLE(1).,1(0)     DOUBLE INDEX                         47250064
         ALR   &UCB(1).,&TABLE(1)  POINT TO THIS ENTRY                  47300064
         ST    &REG(1).,ATBRTN-ATB(0,&UCB(1).)                          47350064
*                                  *SET ATTENTION TABLE ROUTINE ADDR    47400064
         LTR   &REG(2).,&REG(2)    *IS ASID PROVIDED                    47450064
         BZ    IECIT&LABEL         NO, EXIT                             47500064
         STH   &REG(2).,ATBASID-ATB(0,&UCB(1).)                         47550064
*                                  *SET ASID                            47600064
IECIT&LABEL DS 0H                  TP EXIT POINT                        47650064
         MEXIT                                                          47700064
.*****     *****     *****     *****     *****     *****     *****      47750064
.*****   DETECTOR    *****   DETECTOR    *****   DETECTOR    *****      47800064
.*****     *****     *****     *****     *****     *****     *****      47850064
.DET000  ANOP                                                           47900064
.*                                                                      47950064
.*       CSECT AUTHORIZATION                                            48000064
.*                                                                      48050064
         AIF   ('&SYSECT' EQ 'IEEVCPU').DETAUTH                         48100064
         AIF   ('&SYSECT' EQ 'WMMCCABE').DETAUTH                        48150064
         AIF   ('&SYSECT' EQ 'IEE21110').DETAUTH                        48200064
         AIF   ('&SYSECT' EQ 'IEAVNP02').DETAUTH               @OZ00805 48250064
         AIF   ('&SYSECT' EQ 'IEAVTACR').DETAUTH               @OZ00805 48300064
         AIF   ('&SYSECT' EQ 'IEECLEAN').DETAUTH               @OZ00805 48350064
.*       AGO   .IOSGEN1                                        @ZA12429 48400064
.DETAUTH ANOP                                                           48450064
.*                                                                      48500064
.*       CHECK PARAMETERS FOR ERRORS                                    48550064
.*                                                                      48600064
         AIF   ('&UCB' EQ '').IOSGEN3                                   48650064
         AIF   ('&VAR' NE '2').DET005                          @OZ00805 48700064
         AIF   (N'&REG LT 2).IOSGEN2                           @OZ00805 48750064
.DET005  ANOP                                                  @OZ00805 48800064
         AIF   ('&IECIDET' EQ '1').DET010  CHECK FIRST TIME SWITCH      48850064
&IECIDET SETB  1                       SET SWITCH                       48900064
         SPACE 2                                                        53500002
*****************************************************************       53550002
*                                                               *       53600002
* FUNCTION:                                                     *       53650002
*    DETECTOR - DETERMINES IF A DEVICE IS A SHARED DASD         *       53700064
*         WHICH HAS BEEN RESERVED (HARDWARE OR SOFTWARE).       *       53740064
*                                                               *       53780064
*    LABEL  IOSGEN  DETECTOR,UCB=(REG),VAR=1 OR 0               *       53820064
*                                                               *       53860064
*    LABEL  IOSGEN DETECTOR,UCB=(REG),REG=(REG1,REG2),VAR=2     *       53900064
*                                                       @OZ00805*       53940064
*     PLS - GEN REFS(UCBOB,UCBTBYT2,UCBTBYT3,UCBSTAT,UCBSQC,    *       53980064
*           UCBFLP1)                                    @OZ00805*       54020064
*          (IOSGEN DETECTOR,UCB=(REG),VAR=1 OR 0);              *       54060064
*          (IOSGEN DETECTOR,UCB=(REG),REG=(REG1,REG2),VAR=2);   *       54100064
*                                                       @OZ00805*       54140064
*                                                               *       54250064
* INPUT:                                                        *       54300064
*    UCB=  MUST SPECIFY A GPR (ABSOLUTE OR SYMBOLIC)            *       54350064
*    CONTAINING THE ADDRESS OF THE UCB COMMON SEGMENT TO        *       54400064
*    BE MODIFIED.                                               *       54450064
*                                                               *       54500064
*    VAR=  MAY BE SET TO 0 OR 1 OR 2.                   @OZ00805*       54550064
*         0 - TEST WILL BE APPLIED TO THE SOFTWARE              *       54600064
*             RESERVE INDICATOR (RESERVE MACRO ISSUED           *       54650064
*             BY SOFTWARE COMPONENT, HARDWARE RESERVE           *       54700064
*             MAY OR MAY NOT BE IN EFFECT).                     *       54750064
*         1 - (DEFAULT) TEST WILL BE APPLIED TO THE             *       54800064
*             HARDWARE RESERVE INDICATOR (RESERVE               *       54850064
*             INSTRUCTION ISSUED TO DEVICE).                    *       54900064
*                                                               *       54950064
*         2 - TEST WILL BE MADE TO DETERMINE IF IN A    @OZ00805*       55000064
*             SHARED U.P DEVICE. IF SO, R/R WILL BE     @OZ00805*       55050064
*             SET/RESET.ALSO TWO (2) WORK REGISTERS     @OZ00805*       55100064
*             MUST BE PROVIDED ON INPUT. EXAMPLE        @OZ00805*       55150064
*             PROVIDED ABOVE.                           @OZ00805*       55200064
*                                                               *       55250064
* OUTPUT:                                                       *       55300064
*   VAR 0 OR 1                                          @OZ00805*       55350064
*    UPON EXIT FROM THIS EXPANSION, THE CONDITION CODE WILL     *       55400064
*    BE SET TO REFLECT THE CONDITIONS TESTED.  A TEST IS        *       55450064
*    MADE FOR DIRECT ACCESS DEVICE TYPE, SHARED FILE,           *       55500064
*    AND RESERVED STATUS.                                       *       55550064
*         CC=0  THE CONDITIONS OF THE TESTS WERE NOT MET.       *       55600064
*         CC=NON-ZERO  THE CONDITIONS OF THE TESTS WERE MET.    *       55650064
*    VAR -2                                             @OZ00805*       55700064
*           UPON EXIT FROM THIS FUNCTION THE RESERVE/   @OZ00805*       55750064
*           RELEASE CAPABILITY WILL BE SET/RESET        @OZ00805*       55800064
*           DEPENDING  ON UP/MP ENVIORNMENT.            @OZ00805*       55850064
*                                                               *       55900064
*                                                               *       55950064
* ATTRIBUTES:                                                   *       56000064
*    THE FUNCTION EXPANDS AS IN-LINE,REENTRANT CODE             *       56050064
*    AND REQUIRES 20 BYTES OF STORAGE, AND MAY BE EXPANDED      *       56100064
*    A VARIABLE NUMBER OF TIMES WITHIN THE SAME ASSEMBLY        *       56150064
*    WITHOUT DUPLICATING SYMBOLS.                               *       56200064
*                                                               *       56250064
* OTHER:                                                        *       56300064
*    THE EXPANSION OF THE FUNCTION IS DEPENDENT ON THE          *       56350064
*    SPECIFICATION OF THE UCB MAPPING MACRO IEFUCBOB            *       56400064
*    IN THE CALLING CSECT ASSEMBLY.                             *       56450064
*                                                               *       56500064
*    NO LOCKS ARE REQUIRED FOR THIS FUNCTION.                   *       56550064
*                                                               *       58700002
*****************************************************************       58750002
         SPACE 2                                                        58800002
*****************************************************************       58850002
*                                                               *       58900002
*        UCB - UNIT CONTROL BLOCK                               *       58950064
*              REFERENCES AND SPECIAL EQUATES                   *       59000064
*                                                               *       59030064
*****************************************************************       59060064
         SPACE                                                          59090064
IECIDSHR EQU   X'20'               UCBRR                                59120064
IECID3DA EQU   X'20'               UCB3DACC                             59150064
IECIDHRC EQU   X'10'               UCBRESVH                    @YM01123 59180064
IECIDSRC EQU   X'FF'               TEST FOR SOFTWARE                    59210064
IECIDSUP EQU   X'40'               SHARED U.P                  @OZ00805 59240064
IECIDCPU EQU   X'01'               ONE CPU ALIVE               @OZ00805 59270064
IECIDOFF EQU   X'DF'               TURN OFF R/R                @OZ00805 59300064
*                                  *RESERVE COUNT                       59330064
         SPACE                                                          59360064
.DET010  ANOP                                                           59390064
.*                                                                      59420064
.*       CONSTRUCT UNIQUE LABEL SUFFIX                                  59450064
.*                                                                      59480064
&LABEL   SETC  '&SYSNDX'(2,3)           SET TO LAST 3 DIGITS            59510064
.*                                                                      59540064
.*       CONSTRUCT TESTS FOR DIRECT ACCESS AND SHARE                    59570064
.*                                                                      59600064
&NAME    TM    UCBTBYT3-UCBOB&UCB.,IECID3DA  IS THIS A                  59630064
*                                  *DIRECT ACCESS DEVICE                59660064
         BZ    IECID&LABEL         NO, EXIT IMMEDIATELY                 59690064
         AIF ('&VAR' EQ '2').DET030                            @OZ00805 59720064
         SPACE                                                          59750064
         TM    UCBTBYT2-UCBOB&UCB.,IECIDSHR  IS THIS                    59780064
*                                  *DEVICE SHAREABLE                    59810064
*                                  *BETWEEN CPU-S                       59840064
         BZ    IECID&LABEL         NO, EXIT IMMEDIATELY                 59870064
         SPACE                                                          59900064
.*                                                                      59930064
.*       IF VAR=0, THEN GENERATE SOFTWARE TEST                          59960064
.*       IF VAR=1 OR NULL,  THEN GENERATE HARDWARE TEST                 59990064
.*                                                                      60020064
         AIF   ('&VAR' EQ '0').DET020                                   60050064
         TM    UCBFLB-UCBOB&UCB.,IECIDHRC  TEST FOR  @YM01123           60080064
*                                  *HARDWARE RESERVE                    60110064
         AGO   .DETXIT                                                  60140064
.DET020  ANOP                                                           60170064
         TM    UCBSQC-UCBOB&UCB.,IECIDSRC  TEST FOR                     60200064
*                                  *SOFTWARE RESERVE                    60230064
         AGO   .DETXIT                                         @OZ00805 60260064
.DET030 ANOP                                                   @OZ00805 60290064
.*      IF VAR=2 SET/RESET UCBRR AND EXIT                      @OZ00805 60320064
        SPACE                                                           60350064
        L    &REG(2).,UCBEXTPT-UCBOB(0,&UCB) GET UCB EXTENSION @OZ00805 60440064
        TM   UCBFLP1-UCBCMEXT(&REG(2).),IECIDSUP IS DEV SHARED @OZ00805 60470064
        BZ   IECID&LABEL     NO,EXIT IMMEDIATELY               @OZ00805 60500064
*                                        * MORE THAN 1 CPU     @OZ00805 60530064
        L    &REG(2).,CVTPTR(0,0)   GET CVT @                  @G64APLK 60560064
        L    &REG(1).,CVTCSD-CVTMAP(0,&REG(2).) GET CSD @      @G64APLK 60566064
        CLI  CSDCPUOL-CSD+1(&REG(1).),IECIDCPU                 @OZ00805 60572064
        BNE  IECDT&LABEL      YES,TURN OFF R/R                 @OZ00805 60578064
        L    &REG(1).,CVTCRCA-CVTMAP(0,&REG(2).) GET CRCA @    @G64APLK 60584064
        LTR  &REG(1).,&REG(1) IS CRH/CHS ACTIVE ?              @G64APLK 60590064
        BNZ  IECDT&LABEL      YES, TURN OFF R/R                @G64APLK 60596064
*                                                           *  @OZ00805 60620064
        OI   UCBTBYT2-UCBOB&UCB,IECIDSHR TURN ON R/R           @OZ00805 60650064
        B    IECID&LABEL                                       @OZ00805 60680064
IECDT&LABEL NI UCBTBYT2-UCBOB&UCB,IECIDOFF TURN OFF R/R        @OZ00805 60710064
.DETXIT  ANOP                                                           60740064
IECID&LABEL DS 0H                  DETECTOR EXIT POINT                  60770064
         MEXIT                                                          60800064
.*****     *****     *****     *****     *****     *****     *****      60830064
.*****      DOM      *****      DOM      *****      DOM      *****      60860064
.*****     *****     *****     *****     *****     *****     *****      60890064
.DOM000  ANOP                                                           60920064
.*                                                                      60950064
.*       CSECT AUTHORIZATION                                            60980064
.*                                                                      61010064
         AIF   ('&SYSECT' EQ 'WMMCCABE').DOMAUTH                        61040064
         AIF   ('&SYSECT' EQ 'IEECVET7').DOMAUTH                        61070064
.*       AGO   .IOSGEN1                                        @ZA12429 61100064
.DOMAUTH ANOP                                                           61130064
.*                                                                      61160064
.*       CHECK FOR MISSING PARAMETERS                                   61190064
.*                                                                      61220064
         AIF   (('&TABLE' EQ '') OR ('&REG' EQ '')).IOSGEN3             61250064
         AIF   (N'&REG LT 3).IOSGEN2                                    61280064
         SPACE 2                                                        68650002
*****************************************************************       68700002
*                                                               *       68750002
* FUNCTION:                                                     *       68800002
*    DOM - DETERMINES WHICH PREVIOUSLY ISSUED 'INTERVENTION     *       68850064
*          REQUIRED' MESSAGES CAN BE DELETED.                   *       68880064
*                                                               *       68910064
* MACRO CALL:                                                   *       68940064
*    LABEL  IOSGEN  DOM,TABLE=(REG),REG=(REG1,REG2,REG3)        *       68970064
*                                                               *       69000064
*         PLS - GEN REFS(CVTPTR,CVTILK2,UCBOB,UCBFLA,           *       69030064
*               UCBFLC,UCBNAME,UCBTBYT3,CVTMAP)                 *       69060064
*               (IOSGEN DOM,...KEYWORDS AS IN BAL);             *       69090064
*                                                               *       69120064
* INPUT:                                                        *       69150064
*    TABLE=  MAY SPECIFY A GPR (SYMBOLIC OR ABSOLUTE), WHICH    *       69180064
*    IS TO CONTAIN THE ADDRESS OF A LIST OF FOUR BYTE           *       69210064
*    ENTRIES.  THE RIGHT MOST THREE BYTES CONTAIN THE EBCDIC    *       69240064
*    BASE UNIT ADDRESS OF THE DEVICE TO TESTED FOR OUTSTANDING  *       69270064
*    INTERVENTION REQUIRED.  THE FIRST BYTE MUST CONTAIN X'00'  *       69300064
*    EXCEPT FOR THE LAST ENTRY WHICH WILL BE DENOTED BY X'80'.  *       69330064
*                                                               *       69360064
*    REG=  MUST SPECIFY THREE REGISTERS (SYMBOLIC OR ABSOLUTE)  *       69390064
*    WHICH MAY BE USED BY THIS EXPANSION.                       *       69420064
*                                                               *       69450064
*    LABEL - OPTIONAL LABEL.                                    *       69480064
*                                                               *       69510064
* OUTPUT:                                                       *       69540064
*    A X'40' WILL BE SET IN THE FIRST BYTE OF EACH ENTRY BY     *       69570064
*    THIS FUNCTION IF THE MESSAGE CAN BE DELETED.               *       69600064
*                                                               *       69630064
* ATTRIBUTES:                                                   *       69660064
*    THIS FUNCTION IS EXPANDED AS RE-ENTRANT, IN-LINE CODE.     *       69690064
*                                                               *       69720064
* OTHER:                                                        *       69750064
*    THE EXPANSION OF THIS FUNCTION IS DEPENDENT ON THE         *       69780064
*    SPECIFICATION OF THE FOLLOWING MAPPING MACROS              *       69810064
*    IN THE CALLING CSECT ASSEMBLY:                             *       69840064
*         IEFUCBOB                                              *       69870064
*         CVT   DSECT=YES                                       *       69900064
*                                                               *       69930064
*    LOCKS ARE NOT REQUIRED BY THIS FUNCTION.                   *       69960064
*                                                               *       70650002
*****************************************************************       70700002
         SPACE 2                                                        70750002
*****************************************************************       70800002
*                                                               *       70850002
*        UCB - UNIT CONTROL BLOCK                               *       70900002
*              REFERENCES AND SPECIAL EQUATES                   *       70950064
*                                                               *       70970064
*****************************************************************       70990064
         SPACE                                                          71010064
IECIOK01 EQU   1                   CONSTANT OF 1                        73395503
IECIOK03 EQU   3                   CONSTANT OF 3                        73396403
IECIOIN2 EQU   2                   UCB SCAN TBL INCREMENT               73397303
IECIOIN4 EQU   4                   DOM LIST INCREMENT                   73398203
IECIO3TA EQU   X'80'               UCB3TAPE                             73400003
IECIONRY EQU   X'40'               UCBNRY                               73400903
IECIOITF EQU   X'10'               UCBITF                               73401803
IECIODOM EQU   X'40'               DOM INDICATOR                        73402703
IECIOEND EQU   X'80'               END OF LIST INDICATOR                73403603
IECIOXFF EQU   X'FF'               END OF UCBLOOK UP TABLE              73404503
*                                  *AND 'AND'ING CONSTANT               73405503
         SPACE                                                          73406503
*****************************************************************       73408003
*                                                               *       73408703
*        GET VALID UCB ADDRESS FROM UCB LOOK-UP TABLE           *       73409403
*                                                               *       73410103
*****************************************************************       73412003
         SPACE                                                          73413003
&NAME    LR    &REG(1).,&TABLE(1)   PUT LIST ADDR IN WORK REG           73414003
         SPACE                                                          73415003
IECIO010 L     &REG(2).,CVTPTR(0,0)  GET CVT PTR                        73416003
         L     &REG(2).,CVTILK2-CVTMAP(0,&REG(2).)  UCB SCAN            73417003
*                                  *TABLE                               73418003
         SPACE                                                          73419003
IECIO020 LH    &REG(3).,0(0,&REG(2).)  GET UCB PTR                      73420003
         N     &REG(3).,IECIOMSK   AND OFF ANY PROPAGATED BITS @Z30AALB 73421003
         SPACE                                                          73422003
         LTR   &REG(3).,&REG(3)   IS THIS A FILLER                      73423003
         BNZ   IECIO040            NO, GO TO TEST                       73424003
         SPACE                                                          73425003
IECIO030 LA    &REG(2).,IECIOIN2(0,&REG(2).)  UPDATE TABLE PTR          73426003
         SPACE                                                          73427003
         CLI   IECIOK01(&REG(2).),IECIOXFF  TEST FOR END OF TABLE       73428003
         BE    IECIO050            YES, NO DOM FOR THIS MSG             73429003
         SPACE                                                          73430003
         B     IECIO020            CONTINUE SEARCH                      73431003
         SPACE                                                          73432003
*****************************************************************       73433003
*                                                               *       73434003
*        DETERMINE IF UNIT NAMES IN UCB AND LIST ARE EQUAL      *       73435003
*        AND IF MESSAGE IS TO BE DELETED                        *       73436003
*                                                               *       73437003
*****************************************************************       73438003
         SPACE                                                          73439003
IECIO040 CLC   IECIOK01(IECIOK03,&REG(1).),UCBNAME-UCBOB(&REG(3).)      73440003
*                                  *ARE UNIT NAMES EQUAL                73441003
         BNE   IECIO030            NO, CONTINUE SEARCH                  73442003
         SPACE                                                          73443003
         TM    UCBFLA-UCBOB(&REG(3).),IECIONRY  TEST IF DEVICE          73444003
*                                  *READY                               73444703
         BZ    IECIO070            YES, GO TO INDICATE DOM              73445403
         SPACE                                                          73446103
         CLI   UCBTBYT3-UCBOB(&REG(3).),IECIO3TA  TEST FOR TAPE         73448003
*                                  *DEVICE                              73449003
         BNE   IECIO050            NO, GO INDICATE NO DOM               73450003
         SPACE                                                          73451003
         TM    UCBFLC-UCBOB(&REG(3).),IECIOITF  TEST REWIND,            73452003
*                                  *UNLOAD CONDITION                    73453003
         BO    IECIO070            YES, GO INDICATE DOM                 73454003
         SPACE                                                          73455003
*****************************************************************       73455503
*                                                               *       73457003
*        UPDATE MESSAGE STATUS                                  *       73458003
*                                                               *       73459003
*****************************************************************       73460003
         SPACE                                                          73461003
IECIO050 NI    0(&REG(1).),IECIOXFF-IECIODOM  SET NO DOM                73462003
         B     IECIO080            GO TO UPDATE LIST PTR                73463003
         SPACE                                                          73464003
IECIO060 OC    0(IECIOK01,&REG(1).),0(&REG(2).)  DOM EQ PREV            73465003
         OI    0(&REG(2).),IECIODOM  SET DOM FOR PREV                   73465803
         B     IECIO080            GO TO UPDATE LIST PTR                73466603
         SPACE                                                          73467403
IECIO070 OI    0(&REG(1).),IECIODOM  INDICATE DOM                       73468203
         SPACE                                                          73469003
*****************************************************************       73469803
*                                                               *       73470603
*        SCAN LIST FOR DUPLICATE REQUESTS                       *       73473003
*        AND FOR END OF LIST                                    *       73473703
*                                                               *       73474403
*****************************************************************       73475103
         SPACE                                                          73477003
IECIO080 TM    0(&REG(1).),IECIOEND  TEST FOR LIST END                  73477703
         BO    IECIO100            YES, LEAVE ROUTINE                   73478403
         SPACE                                                          73479103
         LA    &REG(1).,IECIOIN4(0,&REG(1).)  POINT TO NEXT ENTRY       73481003
         LR    &REG(2).,&REG(1)   INIT REG FOR SCAN                     73482003
         LA    &REG(3).,IECIOIN4(0,0)  INIT REG FOR DECREMENT           73483003
         SPACE                                                          73484003
IECIO090 SLR   &REG(2).,&REG(3)   POINT TO PREV ENTRY                   73485003
         SPACE                                                          73486003
         CLC   IECIOK01(IECIOK03,&REG(1).),IECIOK01(&REG(2).)           73487003
*                                  *ARE UNIT ADDR EQUAL                 73488003
         BE    IECIO060            YES, GO TO HANDLE                    73488803
         SPACE                                                          73489603
         CR    &REG(2).,&TABLE(1)   IS LAST ENTRY TESTED                73491003
         BH    IECIO090            NO, CONTINUE TEST                    73491803
         SPACE                                                          73492603
         B     IECIO010            GO TO HANDLE                         73494003
         SPACE                                                          73494703
*********************************************************************** 73496003
*                                                                     * 73496603
*        CONSTANT FOR DOM FUNCTION, PLACED HERE TO ALLEVIATE AN       * 73498003
*        EXTRA BRANCH INSTRUCTION AROUND IT.                          * 73499003
*                                                                     * 73500003
*********************************************************************** 73501003
         SPACE                                                          73502003
         DS    0F                                                       73503003
IECIOMSK DC    X'0000FFFF'                                     @Z30AALB 73504003
         SPACE                                                          73505003
*****************************************************************       73506003
*                                                               *       73506803
*        RETURN IN-LINE TO CALLER                               *       73507603
*                                                               *       73508403
*****************************************************************       73509203
         SPACE                                                          73510003
IECIO100 DS    0H                  END OF DOM ROUTINE                   73512003
         SPACE                                                          73512903
         MEXIT                                                          73513803
.*****     *****     *****     *****     *****     *****     *****      73514703
.*****     MOUNT     *****     MOUNT     *****     MOUNT     *****      73515603
.*****     *****     *****     *****     *****     *****     *****      73516503
.MNT000  ANOP                                                           73517403
.*                                                                      73518803
.*       CSECT AUTHORIZATION                                            73519603
.*                                                                      73520403
         AIF   ('&SYSECT' EQ 'IQASTK00').MNTAUTH                        73522003
         AIF   ('&SYSECT' EQ 'WMMCCABE').MNTAUTH                        73522803
.*       AGO   .IOSGEN1                                        @ZA12429 73523664
.MNTAUTH ANOP                                                           73524403
.*                                                                      73525403
.*       CHECK FOR MISSING PARAMETERS                                   73527003
.*                                                                      73528003
         AIF   (('&UCB' EQ '') OR ('&REG' EQ '')).IOSGEN3               73529003
         AIF   ('&IECIMNT' EQ '1').MNT010   ONE CALL ONLY               73530003
&IECIMNT SETB  1                   SET FIRST TIME SWITCH                73531003
         SPACE 2                                                        73532003
*****************************************************************       73533003
*                                                               *       73534003
* FUNCTION:                                                     *       73535003
*    MOUNT - TESTS FOR A MOUNT PENDING CONDITION.               *       73536003
*                                                               *       73537003
* MACRO CALL:                                                   *       73538003
*    LABEL  IOSGEN  MOUNT,UCB=(REG),REG=(REG)                   *       73539003
*                                                               *       73540003
*         PLS - GEN REFS(UCBDMCT,UCBSTAT,UCBOB,                 *       73541003
*               UCBFLA,UCBTBYT3)                                *       73542003
*               (IOSGEN MOUNT,...KEYWORDS AS IN BAL);           *       73543003
*                                                               *       73544003
* INPUT:                                                        *       73545003
*    UCB=  MAY SPECIFY A GPR (SYMBOLIC OR ABSOLUTE), WHICH      *       73545703
*    IS TO CONTAIN THE ADDRESS OF THE UCB COMMON SEGMENT FOR    *       73546403
*    WHICH THE MOUNT TEST IS TO BE DIRECTED. THE DEVICE MUST    *       73547103
*    BE A MOUNTABLE DASD OR TAPE ONLY.  IF ANOTHER TYPE         *       73549003
*    IS SPECIFIED.  CONTROL IS GIVEN TO THE NEXT                *       73549803
*    SEQUENTIAL INSTRUCTION FOLLOWING THE EXPANSION.            *       73550603
*                                                               *       73551403
*    REG=  MUST SPECIFY A GPR (SYMBOLIC OR ABSOLUTE)            *       73552203
*    CONTAINING THE ADDRESS OF THE INSTRUCTION TO BE            *       73554003
*    GIVEN CONTROL IF A MOUNT CONDITION IS PENDING.             *       73555003
*                                                               *       73556003
*    LABEL - OPTIONAL LABEL.                                    *       73557003
*                                                               *       73558003
* OUTPUT:                                                       *       73559003
*    NONE                                                       *       73559803
*                                                               *       73560603
* ATTRIBUTES:                                                   *       73561403
*    THIS FUNCTION IS EXPANDED AS RE-ENTRANT, IN-LINE CODE,     *       73562203
*    AND MAY BE EXPANDED A VARIABLE NUMBER OF TIMES             *       73564003
*    IN THE CSECT ASSEMBLY WITHOUT DUPLICATION OF SYMBOLS.      *       73565003
*                                                               *       73566003
* OTHER:                                                        *       73567003
*    THE EXPANSION OF THIS FUNCTION IS DEPENDENT ON THE         *       73568003
*    SPECIFICATION OF THE IEFUCBOB MAPPING MACRO                *       73569003
*    IN THE CALLING CSECT ASSEMBLY.                             *       73570003
*                                                               *       73571003
*    LOCKS ARE NOT REQUIRED BY THIS FUNCTION.                   *       73572003
*                                                               *       73572903
*****************************************************************       73573803
         SPACE 2                                                        73574703
*****************************************************************       73575603
*                                                               *       73576503
*        UCB - UNIT CONTROL BLOCK                               *       73577903
*              REFERENCES AND SPECIAL EQUATES                   *       73578803
*                                                               *       73579703
*****************************************************************       73580603
         SPACE                                                          73581503
IECINMNT EQU   X'80'               UCBMOUNT                             73582403
IECINALC EQU   X'08'               UCBALOC                              73583303
IECINNRY EQU   X'40'               UCBNRY                               73584203
IECIN3DA EQU   X'20'               UCB3DACC                             73586003
IECIN3TA EQU   X'80'               UCB3TAPE                             73586903
.MNT010  ANOP                                                           73587803
.*                                                                      73588703
.*       CONSTRUCT UNIQUE LABEL SUFFIX                                  73589603
.*                                                                      73590403
&LABEL   SETC  '&SYSNDX'(2,3)      SET LAST 3 DIGITS                    73591203
         SPACE                                                          73593003
&NAME    TM    UCBTBYT3-UCBOB&UCB.,IECIN3DA+IECIN3TA                    73593603
*                                  *IS IT A DASD OR TAPE                73595003
         BZ    IECIN&LABEL         NO, EXIT IMMEDIATELY                 73595903
         SPACE                                                          73596803
         TM    UCBDMCT-UCBOB&UCB.,IECINMNT  MOUNT REQ PENDING           73597703
         BNO   IECIN&LABEL         NO, EXIT IMMEDIATELY                 73598603
         SPACE                                                          73599503
         TM    UCBTBYT3-UCBOB&UCB.,IECIN3DA  IS IT A DASD               73600403
         BO    0(0,&REG(1).)       YES, GO TO MOUNT PEND RTN            73601303
         SPACE                                                          73602203
         TM    UCBSTAT-UCBOB&UCB.,IECINALC  DEVICE ALLOCATED            73603103
         BNO   IECIN&LABEL         NO, SKIP MOUNT PEND RTN              73604003
         SPACE                                                          73604903
         TM    UCBFLA-UCBOB&UCB.,IECINNRY DEVICE NOT READY              73605803
         BO    0(0,&REG(1).)       YES, GO TO MOUNT PEND RTN            73606703
         SPACE                                                          73607603
IECIN&LABEL DS    0H               END OF MOUNT ROUTINE                 73608503
         MEXIT                                                          73611003
.*****     *****     *****     *****     *****     *****     *****      73611603
.*****     SIMINT    *****     SIMINT    *****     SIMINT    *****      73612203
.*****     *****     *****     *****     *****     *****     *****      73614003
.SIM000  ANOP                                                           73615003
*                                                                       73616064
*       THE SIMINT FUNCTION HAS BEEN REPLACED BY THE IOSINTRP           73617064
*       MACRO.                                                 @ZA16163 73618064
*                                                                       73618664
         AGO   .IOSGEN3                                                 73619264
.*****     *****     *****     *****     *****     *****     *****      73619864
.*****     VARY      *****     VARY      *****     VARY      *****      73620464
.*****     *****     *****     *****     *****     *****     *****      73621064
.VAR000  ANOP                                                           73621664
.*                                                                      73622264
.*       CSECT AUTHORIZATION                                            73622864
.*                                                                      73623464
         AIF   (('&SYSECT' EQ 'IEEVDEV')                               X73624064
               OR ('&SYSECT' EQ 'IEEVPTH')).VARAUTH                     73624664
         AIF   ('&SYSECT' EQ 'WMMCCABE').VARAUTH                        73625264
.*       AGO   .IOSGEN1                                        @ZA12429 73625864
.VARAUTH ANOP                                                           73626464
.*                                                                      73627064
.*       CHECK FOR MISSING PARAMETERS                                   73627664
.*                                                                      73628264
         AIF   ('&TABLE' EQ '').IOSGEN3                                 73628864
         SPACE 2                                                        73630403
*****************************************************************       73631203
*                                                               *       73633003
* FUNCTION:                                                     *       73633703
*    VARY - ALTERS THE STATUS OF A PATH TO A DEVICE.            *       73634464
*                                                               *       73635164
* MACRO CALL:                                                   *       73635864
*    LABEL  IOSGEN  VARY,TABLE=LABEL OR (REG)                   *       73636564
*                                                               *       73637264
*         PLS - GEN                                             *       73637964
*               REFS(CVTPTR,CVTMAP,CVTIXAVL,IOCOM,IOCGENA)      *       73638464
*               (IOSGEN VARY,...KEYWORDS AS IN BAL);            *       73640064
*                                                               *       73640764
* INPUT:                                                        *       73641464
*    REGISTER 13 MUST CONTAIN THE ADDRESS OF A 16 WORD          *       73642164
*    SAVE AREA.                                                 *       73642864
*                                                               *       73643564
*    TABLE= MUST SPECIFY THE ADDRESS OF A TWO WORD TABLE        *       73644264
*    WITH THE FOLLOWING FORMAT.  THE ADDRESS MAY OPTIONALLY     *       73644964
*    BE PASSED IN ANY REGISTER (SYMBOLIC OR ABSOLUTE) OTHER     *       73645664
*    THAN 13.                                                   *       73646364
*                                                               *       73647064
*         +0  HEXIDECIMAL DEVICE ADDRESS TO BE VARIED,          *       73647764
*             E.G., X'0293'.                                    *       73648464
*         +2  VARY ONLINE (X'04'),                              *       73649164
*             VARY OFFLINE CONDITIONALLY (X'00'),               *       73649864
*             VARY OFFLINE UNCONDITIONALLY (X'80').             *       73650564
*         +3  CHANNEL SET ID (X'00' OR X'01').                 @G64APLK 73651264
*         +4  UNUSED.                                           *       73651964
*         +5  BASE ADDRESS OF DEVICE IN EBCDIC;                 *       73652664
*             E.G.,X'F2F9F3'.                                   *       73653364
*    NOTE:  THIS FIELD IS CONDIDERED INPUT ONLY AND IS          *       73654064
*           NOT PRESERVED ACROSS THE INTERFACE.                 *       73654764
*                                                               *       73655464
* OUTPUT:                                                       *       73656164
*    THE FOLLOWING RETURN CODES ARE RETURNED IN                 *       73656864
*    REGISTER 15:                                               *       73657564
*         00 - SUCCESSFUL VARY.                                 *       73658264
*         04 - VARY OFFLINE UNCONDITIONALLY, THE LAST PATH      *       73658964
*              TO THE DEVICE HAS BEEN VARIED OFFLINE.           *       73659664
*         08 - VARY OFFLINE CONDITIONALLY, THE PATH TO BE       *       73660364
*              VARIED REPRESENTED THE LAST PATH TO THE DEVICE.  *       73661064
*         12 - THE SPECIFIED ALTERNATE PATH IS NOT A VALID      *       73661764
*              PATH TO THE DEVICE.                              *       73662464
*         16 - THE UCB FOR THE SPECIFIED BASE ADDRESS CAN       *       73663164
*              NOT BE FOUND.                                    *       73663864
*         20 - THE UCB FOR THE SPECIFIED BASE ADDRESS REP-      *       73664564
*              RESENTS A SHARED DASD DEVICE AND THE SPECIFIED   *       73665264
*              PATH IS RESERVED.                                *       73665964
*                                                               *       73666664
* EXTERNAL ROUTINES:                                            *       73667364
*    IECVGENA - RESIDENT IOSGEN SUBROUTINE.                     *       73668064
*                                                               *       73668764
* ATTRIBUTES:                                                   *       73669464
*    THIS FUNCTION IS EXPANDED AS REENTRANT CODE.               *       73670164
*                                                               *       73670864
* OTHER:                                                        *       73671564
*    THE FOLLOWING MAPPING MACROS ARE REQUIRED:                 *       73672264
*         CVT  DSECT=YES                                        *       73672964
*         IECDIOCM                                              *       73673664
*                                                               *       73674364
*    THE UCB LOCK IS OBTAINED FOR THIS FUNCTION.                *       73675064
*                                                               *       73680903
*****************************************************************       73681803
         SPACE 2                                                        73682703
*****************************************************************       73683603
*                                                               *       73684503
*        REGISTER EQUATES                                       *       73685464
*                                                               *       73686464
*****************************************************************       73687464
         SPACE                                                          73688464
IECIVZRO EQU   0                   REFERENCE ONLY                       73689464
IECIVTBL EQU   5                   PARAMETER POINTER                    73690464
IECIVCVT EQU   6                   CVT POINTER                          73691464
IECIVSAV EQU   13                  SAVE AREA PTR                        73692464
IECIVRTN EQU   14                  RETURN REG FROM IECVGENA             73693464
IECIVBAS EQU   15                  BRANCH REG TO IECVGENA               73694464
         SPACE                                                          73695464
IECIVARY EQU   4                   'VARY' ENTRY OFFSET IN IECVGENA      73696464
         SPACE                                                          73697464
.* THE VALIDITY CHECK CODE HAS BEEN MOVED TO IECVGENA          @G64APLK 73698464
&NAME    STM   IECIVZRO,IECIVBAS,0(IECIVSAV) SAVE REGS                  73699464
         AIF   ('&TABLE'(1,1) EQ '(').VAR010                            73700464
         LA    IECIVTBL,&TABLE.(0)  GET PARAMETER ADDR                  73701464
         AGO   .VAR020                                                  73702464
.VAR010  ANOP                                                           73703464
         LR    IECIVTBL,&TABLE(1)   GET TABLE PTR                       73704464
.VAR020  ANOP                                                           73705464
         SPACE                                                          73706464
         L     IECIVCVT,CVTPTR(0,0)  GET CVT PTR                        73707464
         L     IECIVBAS,CVTIXAVL-CVTMAP(0,IECIVCVT) GET IOCOM PTR       73708464
         L     IECIVBAS,IOCGENA-IOCOM(0,IECIVBAS)  GET IECVGENA PTR     73709464
         BAL   IECIVRTN,IECIVARY(0,IECIVBAS) CALL IECVGENA              73710464
         SPACE                                                          73711464
IECIVXIT LM    IECIVZRO,IECIVBAS,0(IECIVSAV) RESTORE REGS               73712464
         MEXIT                                                          73713464
.*****     *****     *****     *****     *****     *****     *****      73714464
.*****     *LCH*     *****     *LCH*     *****     *LCH*     *****      73715464
.*****     *****     *****     *****     *****     *****     *****      73716464
.LCH000   ANOP                                                          73717464
*                                                                       73718464
*        THE LCH FUNCTION HAS BEEN DELETED.                    @G64APLK 73719464
*                                                                       73720464
         AGO   .IOSGEN3                                                 73721464
.*****     *****     *****     *****     *****     *****     *****      73722464
.*****    RESTART    *****    RESTART    *****    RESTART    *****      73723464
.*****     *****     *****     *****     *****     *****     *****      73724464
.RES000   ANOP                                                          73725464
.*                                                                      73726464
.*       CSECT AUTHORIZATION                                            73727464
.*                                                                      73728464
         AIF   ('&SYSECT' EQ 'IGC016').RESAUTH                          73729464
         AIF   ('&SYSECT' EQ 'IATMSIO').RESAUTH                         73730464
         AIF   ('&SYSECT' EQ 'IEEVCPU').RESAUTH                @YM03483 73731464
         AIF   ('&SYSECT' EQ 'WMMCCABE').RESAUTH                        73732464
.*       AGO   .IOSGEN1                                        @ZA12429 73733464
.RESAUTH ANOP                                                           73734464
.*                                                                      73735464
.*       CHECK PARAMETERS FOR ERRORS                                    73736464
.*                                                                      73737464
         AIF   (('&VAR' NE 'ALL') AND ('&VAR' NE 'CHANNEL') AND        X73738464
               ('&VAR' NE '')).IOSGEN3                                  73739464
         AIF   (N'&REG LT 4).IOSGEN2                                    73740464
         AIF   ('&IECIRES' EQ '1').RES010 CHECK FIRST TIME SWITCH       73741464
&IECIRES SETB  1                        SET SWITCH                      73742464
         SPACE 2                                                        73785002
*****************************************************************       73786002
*                                                               *       73787002
* FUNCTION:                                                     *       73788002
*    RESTART - CAUSES THE SPECIFIED CHANNEL (OR ALL CHANNELS)   *       73789064
*              ON THE SPECIFIED CPU TO BE MARKED FOR RESTART    *       73790064
*              THE NEXT TIME THE I/O SUPERVISOR IS ENTERED      *       73791064
*              FOR THAT CPU.                                    *       73792064
*                                                               *       73793064
* MACRO CALL:                                                   *       73794064
*    LABEL  IOSGEN  RESTART,REG=(REG1,REG2,REG3,REG4),          *       73795064
*                   VAR=ALL OR CHANNEL                          *       73796064
*                                                               *       73797064
*         PLS - GEN REFS(CVTPTR,CVTMAP,CVTIXAVL,CVTLCCAT,       *       73798064
*               IOCOM,IOCOMEX,IOCCTBL,IOX,IOXCHMSK,             *       73799064
*               IRTENTRY,IRTCHMSK,LCCA,LCCAIRT)                 *       73800064
*               (IOSGEN RESTART,...KEYWORDS AS IN BAL);         *       73801064
*                                                               *       73802064
* INPUT:                                                        *       73803064
*    REG= MUST SPECIFY FOUR GPRS (SYMBOLIC OR ABSOLUTE)         *       73804064
*    WHICH MAY BE USED BY THIS FUNCTION AS WORK REGISTERS.      *       73805064
*         REG1 - (VAR=CHANNEL ONLY) MUST CONTAIN THE CHANNEL    *       73806064
*                NUMBER (ONE BYTE BINARY, RIGHT JUSTIFIED)      *       73807064
*                WHICH IS TO BE MARKED FOR RESTART.             *       73808064
*         REG2 - MUST CONTAIN THE PHYSICAL CPUID OF THE CPU     *       73809064
*                WHICH HAS THE CHANNEL(S) TO BE RESTARTED.      *       73810064
*         REG3 - NO RESTRICTIONS.                               *       73811064
*         REG4 - NO RESTRICTIONS.                               *       73812064
*    THE CONTENTS OF THESE REGISTERS ON EXIT FROM THIS          *       73813064
*    EXPANSION ARE UNPREDICTABLE.                               *       73814064
*                                                               *       73815064
*    VAR= INDICATES WHICH OPTION IS REQUESTED:                  *       73816064
*         VAR=ALL - RESTART ALL CHANNELS.                       *       73817064
*         VAR=CHANNEL - (DEFAULT) RESTART SELECTED CHANNEL.     *       73818064
*                                                               *       73819064
* ATTRIBUTES:                                                   *       73820064
*    THE FUNCTION EXPANDS AS IN-LINE,REENTRANT CODE             *       73821064
*    AND MAY BE EXPANDED A VARIABLE NUMBER OF TIMES IN THE      *       73822064
*    CALLING CSECT.                                             *       73823064
*                                                               *       73824064
* OTHER:                                                        *       73825064
*    THE CHANNEL RESTART MASK OF THE SPECIFIED CPU IS           *       73826064
*    MODIFIED VIA SERIALIZATION OF THE COMPARE AND SWAP         *       73827064
*    INSTRUCTION.                                               *       73828064
*                                                               *       73829064
*    THE EXPANSION OF THIS FUNCTION IS DEPENDENT ON THE         *       73830064
*    SPECIFICATION OF THE FOLLOWING MAPPING MACROS              *       73831064
*    IN THE CALLING CSECT ASSEMBLY:                             *       73832064
*         CVT     DSECT=YES                                     *       73833064
*         IHALCCA                                               *       73834064
*         IECDIRT                                               *       73835064
*         IECDIOCM                                              *       73836064
*         IECDIOCX                                              *       73837064
*                                                               *       73838064
*    LOCKS ARE NOT REQUIRED BY THIS FUNCTION.                   *       73839064
*                                                               *       73848002
*****************************************************************       73849002
         SPACE 2                                                        73850002
*****************************************************************       73851002
*                                                               *       73852002
*        MISCELLANEOUS EQUATES                                  *       73853064
*                                                               *       73856064
*****************************************************************       73859064
         SPACE                                                          73862064
IECIRCHT EQU   2                   CHANNEL TABLE MASK OFFSET            73865064
.RES010  ANOP                                                           73868064
.*                                                                      73871064
.*       CONSTRUCT UNIQUE LABEL SUFFIX                                  73874064
.*                                                                      73877064
&LABEL   SETC  '&SYSNDX'(2,3)      SET LAST 3 DIGITS                    73880064
         SPACE                                                          73883064
&NAME    L     &REG(4).,CVTPTR(0,0)  GET CVT PTR                        73886064
         L     &REG(3).,CVTLCCAT-CVTMAP(0,&REG(4).)                     73889064
*                                  *GET LCCAVT PTR                      73892064
         L     &REG(4).,CVTIXAVL-CVTMAP(0,&REG(4).)                     73895064
*                                  *GET IOCOM PTR                       73898064
         SLL   &REG(2).,2(0)       GET LCCAVT INDEX                     73901064
         L     &REG(3).,0(&REG(2).,&REG(3).)                            73904064
*                                  *GET LCCA PTR                        73907064
         LA    &REG(3).,LCCAIRT-LCCA(0,&REG(3).)                        73910064
*                                  *GET IRT PTR                         73913064
.*                                                                      73916064
.*       TEST FOR VAR=ALL                                               73919064
.*                                                                      73922064
         AIF   ('&VAR' NE 'ALL').RES020                                 73925064
         L     &REG(4).,IOCOMEX-IOCOM(0,&REG(4).)                       73928064
*                                  *GET IOCOMX PTR                      73931064
         LH    &REG(4).,IOXCHMSK-IOX(0,&REG(4).)                        73934064
*                                  *GET MASK OF GENERATED CHNLS         73937064
         AGO   .RES030                                                  73940064
.RES020  ANOP                                                           73943064
         L     &REG(4).,IOCCTBL-IOCOM(0,&REG(4).)                       73946064
*                                  *GET CHANNEL TABLE ADDR              73949064
         SLL   &REG(1).,3(0)       GET CHANNEL TABLE INDEX              73952064
         LH    &REG(4).,IECIRCHT(&REG(1).,&REG(4).)                     73955064
*                                  *GET MASK FOR THIS CHANNEL           73958064
.RES030  ANOP                                                           73961064
         SLL   &REG(4).,16(0)      ALIGN CHANNEL(S)                     73964064
*                                  *TO BE RESTARTED                     73967064
IECIR&LABEL L &REG(1).,IRTCHMSK-IRTENTRY(0,&REG(3).)                    73970064
*                                  *GET THIS CPUS CHNL RESTART MASK     73973064
         LR    &REG(2).,&REG(1)    GET WORKING COPY OF CHNL MASK        73976064
         OR    &REG(2).,&REG(4)    SET NEW BIT(S)                       73979064
         CS    &REG(1).,&REG(2).,IRTCHMSK-IRTENTRY(&REG(3).)            73982064
         BNE   IECIR&LABEL         LOOP UNTIL SWAP COMPLETES            73985064
         MEXIT                                                          73988064
.*****     *****     *****     *****     *****     *****     *****      73991064
.*****     SWAP      *****     SWAP      *****     SWAP      *****      73994064
.*****     *****     *****     *****     *****     *****     *****      73997064
.SWP000  ANOP                                                           74000064
.*                                                                      74003064
.*       CSECT AUTHORIZATION                                            74006064
.*                                                                      74009064
         AIF   ('&SYSECT' EQ 'IGFDW0').SWPAUTH                          74012064
         AIF   ('&SYSECT' EQ 'WMMCCABE').SWPAUTH                        74015064
.*       AGO   .IOSGEN1                                        @ZA12429 74018064
.SWPAUTH ANOP                                                           74021064
.*                                                                      74024064
.*       CHECK PARAMETERS FOR ERRORS                                    74027064
.*                                                                      74030064
         AIF   (('&UCB' EQ '') OR ('&REG' EQ '') OR                    X74033064
               ('&VAR' EQ '')).IOSGEN3                                  74036064
         SPACE 2                                                        74051803
*****************************************************************       74052803
*                                                               *       74053803
* FUNCTION:                                                     *       74055803
*    SWAP - SUPPORTS A DDR DEVICE SWAP.                         *       74056864
*                                                               *       74076864
* MACRO CALL:                                                   *       74096864
*    LABEL  IOSGEN  SWAP,VAR=LABEL OR (REG),UCB=(REG),          *       74116864
*                   REG=(REG)                                   *       74136864
*                                                               *       74156864
*         PLS - GEN REFS(CVTMAP,CVTPTR,CVTIXAVL,                *       74176864
*               IOCOM,IOCGENA )                                @ZA12145 74196864
*               (IOSGEN  SWAP,...KEYWORDS AS IN BAL);           *       74216864
*                                                               *       74236864
* INPUT:                                                        *       74256864
*    REGISTER 13 MUST CONTAIN THE ADDRESS OF A 18 WORD          *       74276864
*    SAVEAREA.                                                  *       74296864
*                                                               *       74316864
*    VAR=  MUST SPECIFY THE ADDRESS (LABEL OR GPR) OF AN        *       74336864
*    36 WORD WORK AREA BE USED DURING THE SWAP PROCESSING.      *       74356864
*                                                               *       74376864
*    UCB=  MUST SPECIFY A GPR (SYMBOLIC OR ABSOLUTE), CON-      *       74396864
*    TAINING THE ADDRESS OF THE SWAPPED 'TO' UCB.               *       74416864
*                                                               *       74436864
*    REG=  MUST SPECIFY A GPR (SYMBOLIC OR ABSOLUTE), CON-      *       74456864
*    TAINING THE ADDRESS OF THE SWAPPED 'FROM' UCB.             *       74476864
*                                                               *       74496864
*    NOTE:  REGISTERS 14 AND 15 MAY NOT BE USED FOR PARAMETERS. *       74516864
*                                                               *       74536864
*    LABEL - OPTIONAL LABEL.                                    *       74556864
*                                                               *       74576864
* OUTPUT:                                                       *       74596864
*    RETURN CODE - IN FIRST WORD OF WORK AREA;                 @ZA12145 74616864
*                  SET BY IECVGENA                             @ZA12145 74636864
*            0 = SWAP COMPLETED SUCCESSFULLY.                  @ZA12145 74656864
*            4 = SWAP FAILED                                   @ZA12145 74676864
*                                                               *       74696864
* EXTERNAL ROUTINES:                                            *       74716864
*    IECVGENA - RESIDENT IOSGEN SUBROUTINE.  THIS MODULE IS     *       74736864
*    ENTERED VIA A BALR INSTRUCTION TO SWAP BOTH UCB'S AND      *       74756864
*    IOQE'S.                                                    *       74776864
*                                                               *       74796864
* ATTRIBUTES:                                                   *       74816864
*    THIS FUNCTION IS EXPANDED AS RE-ENTRANT, IN-LINE CODE.     *       74836864
*                                                               *       74856864
* OTHER:                                                        *       74876864
*    THE EXPANSION OF THIS FUNCTION IS DEPENDENT ON THE         *       74896864
*    SPECIFICATION OF THE FOLLOWING MAPPING MACROS              *       74916864
*    IN THE CALLING CSECT ASSEMBLY:                             *       74936864
*         CVT   DSECT=YES                                       *       74956864
*         IECDIOCM                                              *       74976864
*                                                               *       74996864
*    SPECIAL NOTE:  BOTH UCB'S ARE ASSUMED TO BE QUIESCED.      *       75016864
*                   THE USER OF THIS FUNCTION MUST BE IN SRB   @ZA12145 75036864
*                   MODE.                                      @ZA12145 75056864
*                                                               *       75076864
*    LOCKS ARE NOT REQUIRED FOR THIS FUNCTION.                  *       75096864
*                                                               *       75401902
*****************************************************************       75450902
         SPACE 2                                                        75499902
*****************************************************************       75548902
*                                                               *       75597902
*        REGISTER DEFINITIONS FOR SWAP                          *       75646964
*                                                               *       86965902
*****************************************************************       87014902
         SPACE                                                          87063902
IECIXWK0 EQU   0                   WORK REG                             87112902
IECIXTOO EQU   4                   'TO' UCB PTR                         87161964
IECIXCOM EQU   5                   IOCOM PTR                            87211964
IECIXFRM EQU   6                   'FROM' UCB PTR                       87261964
IECIXWRK EQU   8                   WORK AREA PTR                        87311964
IECIXCVT EQU   12                  CVT PTR                              87700902
IECIXSAV EQU   13                  SAVE AREA PTR                        87749902
IECIXRTN EQU   14                  RETURN REG                           87798902
IECIXBAS EQU   15                  BASE REG                             87847902
         SPACE 2                                                        87896902
*****************************************************************       87945902
*                                                               *       87994902
*        MISCELLANEOUS EQUATES FOR SWAP                         *       88043964
*                                                               *       88093964
*****************************************************************       88143964
         SPACE                                                          88193964
IECIXK08 EQU    8                  CONSTANT OF 8                        88243964
IECIX512 EQU   512                 CONSTANT OF 512                      88293964
IECIXK12 EQU   12                  CONSTANT OF 12                       88343964
IECIXK20 EQU   20                  CONSTANT OF 20                       88393964
         SPACE                                                          88827902
*****************************************************************       88876902
*                                                               *       88925902
*        SPECIAL ENTRY POINT BRANCH TABLE VALUES FOR IECVGENA   *       88974902
*        THESE VALUES ARE DISPLACEMENTS FROM REGISTER 15        *       89023902
*                                                               *       89072902
*****************************************************************       89121902
         SPACE                                                          89170902
*        EQU   0                   (SWAP)                               89219902
*        EQU   4                   NOT AVAILABLE   (VARY)               89268902
*        EQU   8                   NOT AVAILABLE   (RESERVED)           89317902
*        EQU   12                  NOT AVAILABLE   (RESERVED)           89366902
*        EQU   16                  NOT AVAILABLE   (UCBFLG)             89415902
         SPACE                                                          89464902
*****************************************************************       89513902
*                                                               *       89562902
*        ESTABLISH ADDRESSABILITY                               *       89611902
*                                                               *       89660902
*****************************************************************       89709902
         SPACE                                                          89758902
&NAME    STM   IECIXRTN,IECIXCVT,IECIXK12(IECIXSAV)  SAVE REGS          89807902
         LA    IECIXTOO,&UCB(1).(0,0)   GET REG VALUE                   89954902
         SLL   IECIXTOO,2(0)       REG VALUE * 4 = INDEX                90003902
         L     IECIXTOO,IECIXK20(IECIXTOO,IECIXSAV)  GET                90052902
*                                  *'TOO' UCB PTR                       90101902
         LA    IECIXFRM,&REG(1).(0,0)   GET REG VALUE                   90150902
         SLL   IECIXFRM,2(0)       REG VALUE * 4 = INDEX                90199902
         L     IECIXFRM,IECIXK20(IECIXFRM,IECIXSAV)  GET                90248902
*                                  *'FROM' UCB PTR                      90297902
         AIF   ('&VAR'(1,1) EQ '(').SWP010                              90347902
         LA    IECIXWRK,&VAR(1).(0) GET WORK AREA ADDRESS               90397902
         AGO   .SWP020                                                  90447902
.SWP010  ANOP                                                           90497902
         LA    IECIXWRK,&VAR(1).(0,0)   GET REG VALUE                   90547902
         SLL   IECIXWRK,2(0)       REG VALUE * 4 = INDEX                90597902
         L     IECIXWRK,IECIXK20(IECIXWRK,IECIXSAV)  GET                90647902
*                                  *'WORK AREA' PTR                     90697902
.SWP020  ANOP                                                           90747902
         SPACE                                                          90787902
*****************************************************************       90836902
*                                                               *       90885902
*        CALL IECVGENA TO PERFORM THE SWAP                     @ZA12145 90934964
*                                                               *       90984964
*****************************************************************       91034964
         SPACE                                                          91084964
         L     IECIXCVT,CVTPTR(0,0)  GET CVTPTR                         91134964
         LA    IECIXWK0,IECIX512(0,0) GET PREFIX VALUE                  91483902
         SLR   IECIXTOO,IECIXWK0   POINT TO UCB PREFIX                  91493902
         SLR   IECIXFRM,IECIXWK0   POINT TO UCB PREFIX                  91503902
         L     IECIXCOM,CVTIXAVL-CVTMAP(0,IECIXCVT)  GET IOCOM PTR      91522902
         L     IECIXBAS,IOCGENA-IOCOM(0,IECIXCOM)  GET IECVGENA PTR     91571964
         BALR  IECIXRTN,IECIXBAS   CALL IECVGENA                        91621964
         SPACE                                                          91671964
IECIXXIT LM    IECIXRTN,IECIXCVT,IECIXK12(IECIXSAV)  RESTORE REGS       91721964
         MEXIT                                                          99068902
.*****     *****     *****     *****     *****     *****       @Y30LPLC 99069503
.*****    SETVOID    *****    SETVOID    *****    SETVOID      @Y30LPLC 99070103
.*****     *****     *****     *****     *****     *****       @Y30LPLC 99070703
.SV000   ANOP                                                  @Y30LPLC 99071303
.*                                                             @Y30LPLC 99071903
.*       CSECT AUTHORIZATION                                   @Y30LPLC 99072503
.*                                                             @Y30LPLC 99073103
         AIF   ('&SYSECT' EQ 'ICBINIT').SVAUTH                 @Y30LPLC 99073703
         AIF   ('&SYSECT' EQ 'IECVIOPM').SVAUTH                @ZA04107 99074004
         AIF   ('&SYSECT' EQ 'IGTUJA').SVAUTH                           99074364
.*       AGO   .IOSGEN1                                        @ZA12429 99074464
.SVAUTH  ANOP                                                  @Y30LPLC 99074603
.*       CHECK PARAMETERS FOR ERRORS                           @Y30LPLC 99074903
.*                                                             @Y30LPLC 99075003
         AIF   (N'&REG LT 4).IOSGEN2                           @Y30LPLC 99075103
************************************************************** @Y30LPLC 99075203
*                                                              @Y30LPLC 99075503
* FUNCTION:                                                    @Y30LPLC 99076103
*    SETVOID - WILL INITIALIZW ENTRIES IN THE VOID TABLE       @Y30LPLC 99076703
*              (VECTOR OF IOS DRIVERS).                        @Y30LPLC 99077303
*                                                              @Y30LPLC 99077903
*    LABEL    IOSGEN SETVOID,VAR=PURGE OR RESTORE OR EXTENT,   @Y30LPLC 99078503
*                    REG=(GPR1,GPR2,GPR3,GPR4)                @Y30LPLC  99079104
*                                                              @Y30LPLC 99079703
*    PLS - GEN REFS(CVTPTR,CVTMAP,CVTIXAVL,IOCOM,IOCVOID)      @Y30LPLC 99080303
*                                                              @Y30LPLC 99080903
*          (IOSGEN SETVOID,...KEYWORDS AS IN BAL);             @Y30LPLC 99081503
*                                                              @Y30LPLC 99082103
* INPUT:                                                       @Y30LPLC 99082703
*    VAR= PURGE - SET DRIVER PURGE VOID ENTRY                  @Y30LPLC 99083303
*         (PURGE,A)-SET DRIVER PURGE VOID ENTRY WITH USE COUNT @ZA04107 99083404
*         (PURGE,R)-REMOVE DRIVER PURGE VOID ENTRY WITH USE    @ZA04107 99083504
*                   COUNT                                      @ZA04107 99083604
*         RESTORE - SET DRIVER RESTORE VOID ENTRY              @Y30LPLC 99083903
*         EXTENT - SET DRIVER END OF EXTENT VOID ENTRY         @Y30LPLC 99084503
*                                                              @Y30LPLC 99085103
*    REG=(GPR1,GPR2,GPR3,GPR4) FOUR REGISTERS ARE REQUIRED     @Y30LPLC 99085703
*    BY THIS FUNCTION.                                         @Y30LPLC 99086303
*         GPR1 - CONTAINS THE DRIVER ID RIGHT ALIGNED.         @Y30LPLC 99086903
*                CONTENTS WILL BE DESTROYED FOR                @ZA04107 99087104
*                VAR=(PURGE,A OR R)                            @ZA04107 99087304
*         GPR2 - CONTAINS ENTRY POINT ADDRESS FOR VOID.        @Y30LPLC 99087503
*                WORK REGISTER FOR VAR=(PURGE,R)               @ZA04107 99087804
*         GPR3 - WORK REGISTER. CONTENTS WILL BE DESTROYED     @Y30LPLC 99088103
*         GPR4 - WORK REGISTER. CONTENTS WILL BE DESTROYED     @Y30LPLC 99088703
*                                                              @Y30LPLC 99089303
* OUTPUT:                                                      @Y30LPLC 99089903
*        SPECIFIED VOID TABLE ENTRY WILL BE SET.               @Y30LPLC 99090503
*        FOR VAR=(PURGE,A OR R) THE HIGH ORDER BYTE OF THE     @ZA04107 99090604
*        ENTRY WILL BE USED AS A USE COUNT -- INCREMENTED FOR  @ZA04107 99090704
*        'A', DECREMENTED FOR 'R'. WHEN THE COUNT REACHES ZERO @ZA04107 99090804
*        THE ENTRY WILL BE SET TO THE ADDRESS OF A BR14        @ZA04107 99090904
*        INSTRUCTION WHICH IS LOCATED AT THE END OF THE VOID   @ZA04107 99091004
*        TABLE.                                                @ZA04107 99091104
*                                                              @Y30LPLC 99091604
* ATTRIBUTES:                                                  @Y30LPLC 99091703
*    THE FUNCTION EXPANDS AS IN-LINE, REENTRANT CODE AND MAY   @Y30LPLC 99092303
*    BE EXPANDED A VARIABLE NUMBER OF TIMES IN THE CALLING     @Y30LPLC 99092903
*    CSECT.                                                    @Y30LPLC 99093503
*                                                              @Y30LPLC 99094103
* OTHER:                                                       @Y30LPLC 99094703
*    THE EXPANSION OF THE FUNCTION IS DEPENDENT ON THE         @Y30LPLC 99095303
*    SPECIFICATION OF THE FOLLOWING MAPPING MACROS IN          @Y30LPLC 99095903
*    THE CALLING CSECT ASSEMBLY                                @Y30LPLC 99096503
*        CVT   DSECT=YES                                       @Y30LPLC 99097103
*        IECDIOCM                                              @Y30LPLC 99097703
*        IECDVOID DSECT=YES                                    @Y30LPLC 99098303
*                                                              @Y30LPLC 99098903
************************************************************** @Y30LPLC 99099503
&LABEL   SETC  '&SYSNDX'(2,3)                                  @ZA04107 99100504
         L     &REG(3).,CVTPTR(0,0)     GET CVT PTR            @Y30LPLC 99101903
         L     &REG(3).,CVTIXAVL-CVTMAP(0,&REG(3).) GET IOCOM  @Y30LPLC 99102503
         L     &REG(3).,IOCVOID-IOCOM(0,&REG(3).) GET VOID PTR @Y30LPLC 99103103
         LR    &REG(4).,&REG(1)         COPY DRIVER ID         @Y30LPLC 99103703
         SLL   &REG(4).,2               DRIVER ID * 4          @Y30LPLC 99104303
         SLL   &REG(1).,3               DRIVER ID * 8          @Y30LPLC 99104903
         ALR   &REG(1).,&REG(4)         VOID INDEX = 12 *      @Y30LPLC 99105503
.*                                       DRIVER ID             @Y30LPLC 99106103
         AIF   ('&VAR' EQ 'PURGE').SV010                       @Y30LPLC 99106703
         AIF   ('&VAR' EQ 'RESTORE').SV020                     @Y30LPLC 99107303
         AIF   ('&VAR' EQ 'EXTENT').SV030                      @Y30LPLC 99107903
         AIF   ('&VAR' EQ '(PURGE,A)').SV040                   @ZA04107 99108104
         AIF   ('&VAR' EQ '(PURGE,R)').SV050                   @ZA04107 99108304
         AGO   .IOSGEN3                                        @Y30LPLC 99108503
.SV010   ANOP                                                  @Y30LPLC 99109103
         ST    &REG(2).,VOIPRG-VOIENTRY(&REG(1).,&REG(3).)     @Y30LPLC 99109703
         MEXIT                                                 @Y30LPLC 99110303
.SV020   ANOP                                                  @Y30LPLC 99110903
         ST    &REG(2).,VOIRSTR-VOIENTRY(&REG(1).,&REG(3).)    @Y30LPLC 99111503
         MEXIT                                                 @Y30LPLC 99112103
.SV030   ANOP                                                  @Y30LPLC 99112703
         ST    &REG(2).,VOIEXTNT-VOIENTRY(&REG(1).,&REG(3).)   @Y30LPLC 99113303
         MEXIT                                                 @Y30LPLC 99113903
.SV040   ANOP                                                  @ZA04107 99114004
         ALR   &REG(3).,&REG(1)    ADDRESS OF VOID ENTRY       @ZA04107 99114104
         LA    &REG(2).,0(&REG(2).) CLEAR HI BYTE OF ADDRESS   @ZA04107 99114204
         L     &REG(1).,VOIPRG-VOIENTRY(&REG(3).,0) CURRENT    @ZA04107 99114304
IECIS&LABEL LR    &REG(4).,&REG(1) COPY CURRENT ENTRY          @ZA04107 99114404
         SRL   &REG(4).,24         SHIFT COUNT TO BOTTOM       @ZA04107 99114904
         LA    &REG(4).,1(&REG(4).) INCREMENT COUNT            @ZA04107 99115004
         SLL   &REG(4).,24         SHIFT COUNT TO TOP          @ZA04107 99115104
         OR    &REG(4).,&REG(2)    OR ROUTINE ADDRESS          @ZA04107 99115204
         CS    &REG(1).,&REG(4).,VOIPRG-VOIENTRY(&REG(3).)     @ZA04107 99115304
         BNZ   IECIS&LABEL                                     @ZA04107 99116304
         MEXIT                                                 @ZA04107 99141904
.SV050   ANOP                                                  @ZA04107 99142904
         ALR   &REG(3).,&REG(1)    ADDRESS OF VOID ENTRY       @ZA04107 99143904
IECIT&LABEL L     &REG(2).,CVTPTR(0,0) GET CVT PTR             @ZA04107 99144904
         L     &REG(2).,CVTIXAVL-CVTMAP(0,&REG(2).) GET IOCOM  @ZA04107 99145904
         LH    &REG(4).,IOCVOICT-IOCOM(0,&REG(2)) MAX ENTRY    @ZA04107 99146904
         LR    &REG(1).,&REG(4)    COPY COUNT                  @ZA04107 99147904
         SLL   &REG(4).,2          MAX * 4                     @ZA04107 99148904
         SLL   &REG(1).,3          MAX * 8                     @ZA04107 99149904
         ALR   &REG(1).,&REG(4)    BR14 = MAX * 12             @ZA04107 99150904
         L     &REG(2).,IOCVOID-IOCOM(0,&REG(2)) GET VOID PTR  @ZA04107 99151904
         ALR   &REG(2).,&REG(1)    ADDR OF BR14 AT END OF VOID @ZA04107 99152904
         L     &REG(1).,VOIPRG-VOIENTRY(&REG(3).,0) CURRENT    @ZA04107 99153904
         LR    &REG(4).,&REG(1)    COPY CURRENT ENTRY          @ZA04107 99154904
         SRL   &REG(4).,24         SHIFT COUNT TO BOTTOM       @ZA04107 99155904
         BCTR  &REG(4).,0          DECREMENT ONE               @ZA04107 99156904
         SLL   &REG(4).,24         SHIFT COUNT TO TOP          @ZA04107 99157904
         LTR   &REG(4).,&REG(4)    IS COUNT NOW ZERO           @ZA04107 99158904
         BZ    IECIS&LABEL         YES--USE BR14 ADDRESS       @ZA04107 99159904
         LA    &REG(2).,0(&REG(1).) NO--KEEP CURRENT ADDR      @ZA04107 99160904
IECIS&LABEL OR    &REG(4).,&REG(2) OR ROUTINE ADDRESS          @ZA04107 99161904
         CS    &REG(1).,&REG(4).,VOIPRG-VOIENTRY(&REG(3).)     @ZA04107 99162604
         BNZ   IECIT&LABEL                                     @ZA04107 99163304
         MEXIT                                                 @ZA04107 99164904
.*****     *****     *****     *****     *****     *****     *****      99165904
.*****     MNOTE     *****     MNOTE     *****     MNOTE     *****      99166902
.*****     *****     *****     *****     *****     *****     *****      99215902
.*                                                                      99264902
.*       MNOTE ERROR MESSAGES                                           99313902
.*                                                                      99362902
.IOSGEN1 MNOTE 8,'*** &SYSECT MAY NOT INVOKE &FUNC FUNCTION.'           99411902
         MEXIT                                                          99460902
.*                                                                      99509902
.IOSGEN2 MNOTE 8,'*** INSUFFICIENT WORK REGISTERS SPECIFIED.'           99558902
         MEXIT                                                          99607902
.*                                                                      99656902
.IOSGEN3 MNOTE 8,'*** ERROR IN PARAMETER SET UP, OR &FUNC NOT A SUPPORTX99705964
               ED FUNCTION'                                             99735964
         MEXIT                                                          99803902
.*                                                                      99852902
.IOSGEN4 MNOTE 8,'*** &VAR NOT SUPPORTED FOR &TABLE BIT OF &FUNC .'     99901902
         MEND                                                           99950902
