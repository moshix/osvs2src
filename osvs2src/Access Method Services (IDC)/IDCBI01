         TITLE '************** IDCBI01: IDCAMS BLDINDEX ROUTINE ********00001000
               ******** '                                               00002000
        MACRO                                                           00003000
        GETMAIN &R,&LV=                                                 00004000
        L     REG15,0(REG1)           GDTTBL ADDRESS                    00005000
        L     REG15,GDTPRL(REG15)     PROL ROUTINE ADDRESS              00006000
        CNOP  2,4                     BOUNDARY ALIGNMENT                00007000
        LA    REG14,*+14              RETURN ADDRESS                    00008000
        BALR  REG1,REG15              LINKAGE TO PROL ROUTINE           00009000
        DC    A(MODID)                MODULE ID ADDRESS                 00010000
        DC    A(@SIZDATD)             AUTOMATIC STORAGE SIZE ADDRESS    00011000
        MEND                                                            00012000
IDCBI01  CSECT ,                                                   0002 00013000
@MAINENT DS    0H                                                  0002 00014000
         USING *,@15                                               0002 00015000
         B     @PROLOG                                             0002 00016000
         DC    AL1(16)                                             0002 00017000
         DC    C'IDCBI01   76.288'                                 0002 00018000
         DROP  @15                                                      00019000
@PROLOG  STM   @14,@12,12(@13)                                     0002 00020000
         BALR  @12,0                                               0002 00021000
@PSTART  LA    @11,4095(,@12)                                      0002 00022000
         LA    @10,4095(,@11)                                      0002 00023000
         LA    @09,4095(,@10)                                      0002 00024000
         USING @PSTART,@12                                         0002 00025000
         USING @PSTART+4095,@11                                    0002 00026000
         USING @PSTART+8190,@10                                    0002 00027000
         USING @PSTART+12285,@09                                   0002 00028000
         L     @00,@SIZDATD                                        0002 00029000
         GETMAIN  R,LV=(0)                                              00030000
         LR    @08,@01                                             0002 00031000
         USING @DATD,@08                                           0002 00032000
         ST    @13,@SA00001+4                                      0002 00033000
         LM    @00,@01,20(@13)                                     0002 00034000
         ST    @08,8(,@13)                                         0002 00035000
         LR    @13,@08                                             0002 00036000
         MVC   @PC00001(12),0(@01)                                 0002 00037000
*                                                                  0201 00038000
*        OLDERID2 = NEWERID2;                                      0202 00039000
         L     @04,@PC00001                                        0202 00040000
         L     @04,GDTTR2(,@04)                                    0202 00041000
         MVC   @TS00001(95),NEWERID2(@04)                          0202 00042000
         MVC   OLDERID2(95,@04),@TS00001                           0202 00043000
*        NEWID2   = 'BI01';                                        0203 00044000
         MVC   NEWID2(4,@04),@CC00922                              0203 00045000
*        SETRC    = 0;                  /* MAXIMUM CONDITION CODE    */ 00046000
         SLR   SETRC,SETRC                                         0204 00047000
*        STATCOMM = ''B;                /* STATUS COMMUNICATION AREA */ 00048000
         XC    STATCOMM(6),STATCOMM                                0205 00049000
*        IOCSADDR = ''B;                /* IOCSTR ADDRESSES          */ 00050000
         XC    IOCSADDR(16),IOCSADDR                               0206 00051000
*        DDSTRU   = ADDR(DARGAREA);     /* POINTER TO DARGLIST       */ 00052000
         LA    @04,DARGAREA                                        0207 00053000
         ST    @04,DDSTRU                                          0207 00054000
*        DARGAREA = ''B;                /* DARGLIST AREA             */ 00055000
         XC    DARGAREA(44),DARGAREA                               0208 00056000
*        SRTCTLTB = ''B;                /* SORT CONTROL TABLE        */ 00057000
*                                                                  0209 00058000
         XC    SRTCTLTB(76),SRTCTLTB                               0209 00059000
*        /************************************************************/ 00060000
*        /*                                                          */ 00061000
*        /* CALL OPENPROC TO OPEN THE BASE CLUSTER - TERMINATE       */ 00062000
*        /* PROCESSING IF ERROR IN OPENING                           */ 00063000
*        /*                                                          */ 00064000
*        /************************************************************/ 00065000
*                                                                  0210 00066000
*        CALL OPENPROC ('B',IOCSBASE,NULLPTR,NULLPTR);             0210 00067000
*                                                                  0210 00068000
         MVC   @AL00001(16),@AL00210                               0210 00069000
         LA    @04,IOCSBASE                                        0210 00070000
         ST    @04,@AL00001+4                                      0210 00071000
         LA    @01,@AL00001                                        0210 00072000
         BAL   @14,OPENPROC                                        0210 00073000
*        RESPECIFY RTNREG RSTD;                                    0211 00074000
*        TESTRC = RTNREG;                                          0212 00075000
         LR    TESTRC,RTNREG                                       0212 00076000
*        RESPECIFY RTNREG UNRSTD;                                  0213 00077000
*                                                                  0213 00078000
*        IF TESTRC ^= 0                                            0214 00079000
*          THEN                                                    0214 00080000
         LTR   TESTRC,TESTRC                                       0214 00081000
         BZ    @RF00214                                            0214 00082000
*            SETRC = LASTCC12;                                     0215 00083000
*                                                                  0215 00084000
         LA    SETRC,12                                            0215 00085000
*        /************************************************************/ 00086000
*        /*                                                          */ 00087000
*        /* CALL JCPROC TO DETERMINE IF EXTERNAL SORT JOB CONTROL    */ 00088000
*        /* HAS BEEN PROVIDED.  A TERMINATING CONDITION EXISTS IF    */ 00089000
*        /* JCPROC COULD NOT OBTAIN THE REQUIRED DATA YET THE CALLER */ 00090000
*        /* SPECIFIED THE EXTERNALSORT PARAMETER.                    */ 00091000
*        /*                                                          */ 00092000
*        /************************************************************/ 00093000
*                                                                  0216 00094000
*        IF SETRC ^= LASTCC12                                      0216 00095000
*          THEN                                                    0216 00096000
@RF00214 C     SETRC,@CF00035                                      0216 00097000
         BE    @RF00216                                            0216 00098000
*            DO;                                                   0217 00099000
*                                                                  0217 00100000
*            CALL JCPROC (IOINADDR);                               0218 00101000
*                                                                  0218 00102000
         LA    @04,IOINADDR                                        0218 00103000
         ST    @04,@AL00001                                        0218 00104000
         LA    @01,@AL00001                                        0218 00105000
         BAL   @14,JCPROC                                          0218 00106000
*            RESPECIFY RTNREG RSTD;                                0219 00107000
*            TESTRC = RTNREG;                                      0220 00108000
         LR    TESTRC,RTNREG                                       0220 00109000
*            RESPECIFY RTNREG UNRSTD;                              0221 00110000
*                                                                  0221 00111000
*            IF TESTRC ^=0                                         0222 00112000
*              THEN                                                0222 00113000
         LTR   TESTRC,TESTRC                                       0222 00114000
         BZ    @RF00222                                            0222 00115000
*                SETRC = LASTCC12;                                 0223 00116000
*                                                                  0223 00117000
         LA    SETRC,12                                            0223 00118000
*            END;                                                  0224 00119000
*                                                                  0224 00120000
@RF00222 DS    0H                                                  0225 00121000
*        /************************************************************/ 00122000
*        /*                                                          */ 00123000
*        /* THIS IS THE MAIN LOOP TO BUILD AN ALTERNATE INDEX. THE   */ 00124000
*        /* LOOP IS EXECUTED ONCE FOR EACH ALTERNATE INDEX           */ 00125000
*        /* IDENTIFIED THROUGH THE OUTFILE OR OUTDATASET PARAMETER.  */ 00126000
*        /* TWO SECOND LEVEL PROCEDURES ARE CALLED IN THIS LOOP -    */ 00127000
*        /*                                                          */ 00128000
*        /*      MAINPROC - THE SECOND LEVEL PROCEDURE WHICH         */ 00129000
*        /*                 CONTROLS THE BUILDING OF THE AIX         */ 00130000
*        /*                                                          */ 00131000
*        /*      FINPROC  - THE SECOND LEVEL PROCEDURE WHICH CLOSES  */ 00132000
*        /*                 THE AIX AND(OPTIONALLY) THE SORT WORK    */ 00133000
*        /*                 FILES, PRINTS OUTSTANDING ERROR          */ 00134000
*        /*                 MESSAGES AND THE AIX FINAL STATUS MESSAGE*/ 00135000
*        /*                                                          */ 00136000
*        /************************************************************/ 00137000
*                                                                  0225 00138000
*        IF ADDR(OFILE) ^= NULLPTR                                 0225 00139000
*          THEN                                                    0225 00140000
@RF00216 L     @04,@PC00001+4                                      0225 00141000
         L     @04,FDTPTR+8(,@04)                                  0225 00142000
         LTR   @04,@04                                             0225 00143000
         BZ    @RF00225                                            0225 00144000
*            OUTCOUNT = OFILECNT;                                  0226 00145000
*                                                                  0226 00146000
         LH    OUTCOUNT,OFILECNT(,@04)                             0226 00147000
*          ELSE                                                    0227 00148000
*            OUTCOUNT = ODSCNT;                                    0227 00149000
*                                                                  0227 00150000
         B     @RC00225                                            0227 00151000
@RF00225 L     @04,@PC00001+4                                      0227 00152000
         L     @04,FDTPTR+12(,@04)                                 0227 00153000
         LH    OUTCOUNT,ODSCNT(,@04)                               0227 00154000
*        DO I = 1 TO OUTCOUNT WHILE SETRC ^= LASTCC12;             0228 00155000
*                                                                  0228 00156000
@RC00225 LA    @07,1                                               0228 00157000
         B     @DE00228                                            0228 00158000
@DL00228 C     SETRC,@CF00035                                      0228 00159000
         BE    @DC00228                                            0228 00160000
*          CALL MAINPROC (I,DSBADDR,IOCSADDR,IOINADDR,STATCOMM);   0229 00161000
*                                                                  0229 00162000
         LA    @07,I                                               0229 00163000
         ST    @07,@AL00001                                        0229 00164000
         LA    @07,DSBADDR                                         0229 00165000
         ST    @07,@AL00001+4                                      0229 00166000
         LA    @07,IOCSADDR                                        0229 00167000
         ST    @07,@AL00001+8                                      0229 00168000
         LA    @07,IOINADDR                                        0229 00169000
         ST    @07,@AL00001+12                                     0229 00170000
         LA    @07,STATCOMM                                        0229 00171000
         ST    @07,@AL00001+16                                     0229 00172000
         LA    @01,@AL00001                                        0229 00173000
         BAL   @14,MAINPROC                                        0229 00174000
*          CALL FINPROC (IOCSADDR,STATCOMM);                       0230 00175000
*                                                                  0230 00176000
         LA    @07,IOCSADDR                                        0230 00177000
         ST    @07,@AL00001                                        0230 00178000
         LA    @07,STATCOMM                                        0230 00179000
         ST    @07,@AL00001+4                                      0230 00180000
         LA    @01,@AL00001                                        0230 00181000
         BAL   @14,FINPROC                                         0230 00182000
*          IF SAVERC > SETRC                                       0231 00183000
*            THEN                                                  0231 00184000
         LH    @07,SAVERC                                          0231 00185000
         CR    @07,SETRC                                           0231 00186000
         BNH   @RF00231                                            0231 00187000
*              SETRC = SAVERC;                                     0232 00188000
*                                                                  0232 00189000
         LR    SETRC,@07                                           0232 00190000
*          STATCOMM = ''B;                                         0233 00191000
*                                                                  0233 00192000
@RF00231 XC    STATCOMM(6),STATCOMM                                0233 00193000
*          /**********************************************************/ 00194000
*          /*                                                        */ 00195000
*          /* IF THERE ARE MORE ALTERNATE INDEXES TO PROCESS,        */ 00196000
*          /* RE-POSITION THE BASE CLUSTER TO THE FIRST RECORD.      */ 00197000
*          /* IF THE BASE CLUSTER IS A KSDS, THE KEY OF THE FIRST    */ 00198000
*          /* RECORD WAS SAVED BY SORTPROC WHEN IT WAS READ.         */ 00199000
*          /* SET THE RE-PROCESS FLAG IN THE IOCSTR SO THAT FIRST    */ 00200000
*          /* GET WILL CAUSE THE I/O ADAPTER TO RESET THE            */ 00201000
*          /* END-OF-FILE INDICATOR ON THE BASE CLUSTER.             */ 00202000
*          /*                                                        */ 00203000
*          /**********************************************************/ 00204000
*                                                                  0234 00205000
*          IF I < OUTCOUNT &                                       0234 00206000
*             SETRC ^= LASTCC12                                    0234 00207000
*            THEN                                                  0234 00208000
         C     OUTCOUNT,I                                          0234 00209000
         BNH   @RF00234                                            0234 00210000
         C     SETRC,@CF00035                                      0234 00211000
         BE    @RF00234                                            0234 00212000
*              DO;                                                 0235 00213000
*                                                                  0235 00214000
*              IOCSPTR  = IOCSBASE;                                0236 00215000
         L     IOCSPTR,IOCSBASE                                    0236 00216000
*              AMDSBPTR = DSBBASE;                                 0237 00217000
         L     AMDSBPTR,DSBBASE                                    0237 00218000
*              IOCMACPA = ON;                                      0238 00219000
*                                                                  0238 00220000
         OI    IOCMACPA(IOCSPTR),B'00000100'                       0238 00221000
*              IF AMDDST = ON                                      0239 00222000
*                THEN                                              0239 00223000
         TM    AMDDST(AMDSBPTR),B'10000000'                        0239 00224000
         BNO   @RF00239                                            0239 00225000
*                  DO;                                             0240 00226000
*                                                                  0240 00227000
*                  IOCKYA = ADDR(SAVEKEY);                         0241 00228000
         LA    @07,SAVEKEY                                         0241 00229000
         ST    @07,IOCKYA(,IOCSPTR)                                0241 00230000
*                  IOCPTL = AMDKEYLN;                              0242 00231000
*                                                                  0242 00232000
         LH    @07,AMDKEYLN(,AMDSBPTR)                             0242 00233000
         STH   @07,IOCPTL(,IOCSPTR)                                0242 00234000
*                  END;                                            0243 00235000
*                                                                  0243 00236000
*                ELSE                                              0244 00237000
*                  IOCRBA = NULLPTR;                               0244 00238000
*                                                                  0244 00239000
         B     @RC00239                                            0244 00240000
@RF00239 SLR   @07,@07                                             0244 00241000
         ST    @07,IOCRBA(,IOCSPTR)                                0244 00242000
*              CALL IDCIOPO0 (GDTTBL,IOCSBASE);                    0245 00243000
*                                                                  0245 00244000
@RC00239 L     @07,@PC00001                                        0245 00245000
         ST    @07,@AL00001                                        0245 00246000
         LA    @04,IOCSBASE                                        0245 00247000
         ST    @04,@AL00001+4                                      0245 00248000
         MVI   @AL00001+4,X'80'                                    0245 00249000
         L     @15,GDTPOS(,@07)                                    0245 00250000
         LA    @01,@AL00001                                        0245 00251000
         BALR  @14,@15                                             0245 00252000
*              RESPECIFY RTNREG RSTD;                              0246 00253000
*              TESTRC = RTNREG;                                    0247 00254000
         LR    TESTRC,RTNREG                                       0247 00255000
*              RESPECIFY RTNREG UNRSTD;                            0248 00256000
*                                                                  0248 00257000
*              IF TESTRC ^= 0                                      0249 00258000
*                THEN                                              0249 00259000
         LTR   TESTRC,TESTRC                                       0249 00260000
         BZ    @RF00249                                            0249 00261000
*                  SETRC = LASTCC12;                               0250 00262000
*                                                                  0250 00263000
         LA    SETRC,12                                            0250 00264000
*              END;                                                0251 00265000
*                                                                  0251 00266000
@RF00249 DS    0H                                                  0252 00267000
*        END;                                                      0252 00268000
*                                                                  0252 00269000
@RF00234 LA    @07,1                                               0252 00270000
         AL    @07,I                                               0252 00271000
@DE00228 ST    @07,I                                               0252 00272000
         CR    @07,OUTCOUNT                                        0252 00273000
         BNH   @DL00228                                            0252 00274000
@DC00228 DS    0H                                                  0253 00275000
*        /************************************************************/ 00276000
*        /*                                                          */ 00277000
*        /* CALL TERMPROC TO PERFORM FINAL CLEANUP - CLOSE BASE      */ 00278000
*        /* CLUSTER, DELETE SORT FILES IF THEY EXIST, FREE ANY       */ 00279000
*        /* REMAINING MAIN STORAGE, PRINT TERMINATION MESSAGE        */ 00280000
*        /*                                                          */ 00281000
*        /************************************************************/ 00282000
*                                                                  0253 00283000
*        CALL TERMPROC (IOCSADDR,IOINADDR,SRTCTLTB);               0253 00284000
*                                                                  0253 00285000
         LA    @04,IOCSADDR                                        0253 00286000
         ST    @04,@AL00001                                        0253 00287000
         LA    @04,IOINADDR                                        0253 00288000
         ST    @04,@AL00001+4                                      0253 00289000
         LA    @04,SRTCTLTB                                        0253 00290000
         ST    @04,@AL00001+8                                      0253 00291000
         LA    @01,@AL00001                                        0253 00292000
         BAL   @14,TERMPROC                                        0253 00293000
*        /************************************************************/ 00294000
*        /*                                                          */ 00295000
*        /* RETURN TO IDCAMS EXECUTIVE                               */ 00296000
*        /*                                                          */ 00297000
*        /************************************************************/ 00298000
*                                                                  0254 00299000
*        CALL IDCSAEP0(GDTTBL,MODID);                              0254 00300000
         L     @15,@PC00001                                        0254 00301000
         ST    @15,@AL00001                                        0254 00302000
         LA    @14,MODID                                           0254 00303000
         ST    @14,@AL00001+4                                      0254 00304000
         MVI   @AL00001+4,X'80'                                    0254 00305000
         L     @15,GDTEPL(,@15)                                    0254 00306000
         LA    @01,@AL00001                                        0254 00307000
         BALR  @14,@15                                             0254 00308000
*        /************************************************************/ 00309000
*        /*                                                          */ 00310000
*        /* PROCEDURE NAME - OPENPROC                                */ 00311000
*        /*                                                          */ 00312000
*        /* FUNCTION - PERFORMS THE FUNCTION OF OPENING THE          */ 00313000
*        /*            DATA SETS REQUIRED BY THE BLDINDEX FSR -      */ 00314000
*        /*            BASE CLUSTER, ALTERNATE INDEX AND(OPTIONALLY) */ 00315000
*        /*            SORT WORK FILES.  OPENPROC INITIALIZES THE    */ 00316000
*        /*            OPEN ARGUMENT LIST(OPNAGL) OPTIONS BASED ON   */ 00317000
*        /*            THE TYPE OF DATA SET BEING OPENED.            */ 00318000
*        /*                                                          */ 00319000
*        /* INPUT -                                                  */ 00320000
*        /*         OTYPE - DATA SET TYPE                            */ 00321000
*        /*                 . B = BASE CLUSTER                       */ 00322000
*        /*                 . A = AIX                                */ 00323000
*        /*                 . S = FIRST PASS SORT WORK FILE          */ 00324000
*        /*                 . M = MERGE PASS SORT WORK FILE          */ 00325000
*        /*                                                          */ 00326000
*        /*         OINDX - INDEX VALUE OF AIX OR SORT FILE          */ 00327000
*        /*                                                          */ 00328000
*        /*         OIOINPT - POINTER TO DATA OBTAINED FROM THE      */ 00329000
*        /*                   SORT WORK JOB CONTROL FOR THE SORT     */ 00330000
*        /*                   WORK FILE BEING OPENED                 */ 00331000
*        /*                                                          */ 00332000
*        /* OUTPUT -                                                 */ 00333000
*        /*         OIOCS - POINTER TO IOCS OF OPEN DATA SET         */ 00334000
*        /*                                                          */ 00335000
*        /* EXIT,NORMAL - RETURN CODE 0, OPEN WAS SUCCESSFUL         */ 00336000
*        /*                                                          */ 00337000
*        /* EXIT,ERROR -                                             */ 00338000
*        /*               RETURN CODE 8, OPEN OF AIX OR SORT WORK    */ 00339000
*        /*                              FILE WAS NOT SUCCESSFUL     */ 00340000
*        /*               RETURN CODE 12, OPEN OF BASE CLUSTER WAS   */ 00341000
*        /*                               NOT SUCCESSFUL             */ 00342000
*        /*                                                          */ 00343000
*        /************************************************************/ 00344000
*                                                                  0255 00345000
*OPENPROC:                                                         0255 00346000
*        PROCEDURE (OTYPE,         /* DATA SET TYPE TO BE OPENED     */ 00347000
*                   OIOCS,         /* RETURN AREA FOR IOCSTR ADDRESS */ 00348000
*                   OINDX,         /* AIX OR SORT WORK FILE INDEX    */ 00349000
*                   OIOINPT);      /* POINTER TO SORT WORK JOB       */ 00350000
@EL00001 L     @13,4(,@13)                                         0255 00351000
@EF00001 L     @00,@SIZDATD                                        0255 00352000
         LR    @01,@08                                             0255 00353000
         FREEMAIN R,LV=(0),A=(1)                                        00354000
@ER00001 LM    @14,@12,12(@13)                                     0255 00355000
         BR    @14                                                 0255 00356000
OPENPROC STM   @14,@12,@SA00002                                    0255 00357000
         MVC   @PC00002(16),0(@01)                                 0255 00358000
*                                  /* CONTROL DATA                   */ 00359000
*                                                                  0256 00360000
*        /************************************************************/ 00361000
*        /*                                                          */ 00362000
*        /* ARGUMENTS OF INVOCATION                                  */ 00363000
*        /*                                                          */ 00364000
*        /************************************************************/ 00365000
*                                                                  0256 00366000
*        DCL                                                       0256 00367000
*          OTYPE   CHAR(1),        /* DATA SET TYPE                  */ 00368000
*          OIOCS   PTR(31),        /* RETURN  AREA FOR IOCS ADDRESS  */ 00369000
*          OINDX   FIXED(31),      /* AIX OR SORT WORK FILE INDEX    */ 00370000
*          OIOINPT PTR(31);        /* POINTER TO RETURN AREA         */ 00371000
*                                  /* CONTAINING SORT WORK JOB       */ 00372000
*                                  /* CONTROL DATA                   */ 00373000
*                                                                  0257 00374000
*        /************************************************************/ 00375000
*        /*                                                          */ 00376000
*        /* OPEN ARGUMENT LIST                                       */ 00377000
*        /*                                                          */ 00378000
*        /************************************************************/ 00379000
*                                                                  0257 00380000
*        DCL 1 OPENAREA BDY(WORD),                                 0257 00381000
*              2 OPENID   CHAR(8),              /* OPNAGL DUMP ID    */ 00382000
*              2 OPENLIST CHAR(LENGTH(OPNAGL)); /* OPNAGL            */ 00383000
*                                                                  0257 00384000
*        /************************************************************/ 00385000
*        /*                                                          */ 00386000
*        /* VARIABLES USED AS PARAMETERS OF THE UQUAL MACRO TO       */ 00387000
*        /* QUALIFY DATA SET NAMES IN A TSO ENVIRONMENT              */ 00388000
*        /*                                                          */ 00389000
*        /************************************************************/ 00390000
*                                                                  0258 00391000
*        DCL                                                       0258 00392000
*          QDSNPTR  PTR(31),       /* POINTER TO DATA SET NAME       */ 00393000
*          QDSNLEN  FIXED(15),     /* LENGTH OF DATA SET NAME        */ 00394000
*          QCATPTR  PTR(31),       /* POINTER TO CATALOG NAME        */ 00395000
*          QDSNPSWD PTR(31);       /* POINTER TO DATA SET PASSWORD   */ 00396000
*                                                                  0258 00397000
*        /************************************************************/ 00398000
*        /*                                                          */ 00399000
*        /* INITIALIZATION - SET UP COMMON AREAS OF OPNAGL           */ 00400000
*        /*                                                          */ 00401000
*        /************************************************************/ 00402000
*                                                                  0259 00403000
*        OLDERID2 = NEWERID2;                                      0259 00404000
         L     @03,@PC00001                                        0259 00405000
         L     @03,GDTTR2(,@03)                                    0259 00406000
         MVC   @TS00001(95),NEWERID2(@03)                          0259 00407000
         MVC   OLDERID2(95,@03),@TS00001                           0259 00408000
*        NEWID2 = 'BIP1';                                          0260 00409000
         MVC   NEWID2(4,@03),@CC01125                              0260 00410000
*        OPENID = 'OPNAGL';                                        0261 00411000
         MVI   OPENID+6,C' '                                       0261 00412000
         MVI   OPENID+7,C' '                                       0261 00413000
         MVC   OPENID(6),@CC01126                                  0261 00414000
*        OPNPTR = ADDR(OPENLIST);                                  0262 00415000
         LA    OPNPTR,OPENLIST                                     0262 00416000
*        OPNAGL = ''B;                                             0263 00417000
         XC    OPNAGL(48,OPNPTR),OPNAGL(OPNPTR)                    0263 00418000
*        OPNIOC = ADDR(OIOCS);                                     0264 00419000
*                                                                  0264 00420000
         L     @03,@PC00002+4                                      0264 00421000
         ST    @03,OPNIOC(,OPNPTR)                                 0264 00422000
*        /************************************************************/ 00423000
*        /*                                                          */ 00424000
*        /* OPEN THE BASE CLUSTER.  SET UP THE INPUT PROCESSING      */ 00425000
*        /* OPTION.  THE BASE CLUSTER CAN BE SPECIFIED VIA A JCL     */ 00426000
*        /* STATEMENT OR, IN A SYSTEM WITH DYNAMIC ALLOCATION, ITS   */ 00427000
*        /* DATA SET NAME.  WHEN DESCRIBED BY ITS DATA SET NAME,     */ 00428000
*        /* THE I/0 ADAPTER PERFORMS DYNAMIC ALLOCATION AS PART OF   */ 00429000
*        /* UOPEN PROCESSING.  THE I/0 ADAPTER DISTINGUISHES THE     */ 00430000
*        /* TYPE OF OPEN BY THE SETTING OF OPNDDDN OR OPNDSN.        */ 00431000
*        /*                                                          */ 00432000
*        /************************************************************/ 00433000
*                                                                  0265 00434000
*        IF OTYPE = 'B'                                            0265 00435000
*          THEN                                                    0265 00436000
         L     @03,@PC00002                                        0265 00437000
         CLI   OTYPE(@03),C'B'                                     0265 00438000
         BNE   @RF00265                                            0265 00439000
*OPENBASE:   DO;                                                   0266 00440000
*                                                                  0266 00441000
OPENBASE DS    0H                                                  0267 00442000
*            OPNOPTIN = ON;                                        0267 00443000
*                                                                  0267 00444000
         OI    OPNOPTIN(OPNPTR),B'10000000'                        0267 00445000
*            IF ADDR(IFILE) ^= NULLPTR                             0268 00446000
*              THEN                                                0268 00447000
         L     @03,@PC00001+4                                      0268 00448000
         L     @03,FDTPTR(,@03)                                    0268 00449000
         LTR   @03,@03                                             0268 00450000
         BZ    @RF00268                                            0268 00451000
*                DO;                                               0269 00452000
*                                                                  0269 00453000
*                OPNDDN = ADDR(IFILEVAL);                          0270 00454000
*                                                                  0270 00455000
         LA    @15,IFILEVAL(,@03)                                  0270 00456000
         ST    @15,OPNDDN(,OPNPTR)                                 0270 00457000
*                IF IFILEPLN ^= 0                                  0271 00458000
*                  THEN                                            0271 00459000
         CLI   IFILEPLN(@03),0                                     0271 00460000
         BE    @RF00271                                            0271 00461000
*                    OPNPWA = ADDR(IFILEPAS);                      0272 00462000
*                                                                  0272 00463000
         LA    @03,IFILEPAS(,@03)                                  0272 00464000
         ST    @03,OPNPWA(,OPNPTR)                                 0272 00465000
*                END;                                              0273 00466000
*                                                                  0273 00467000
*              /******************************************************/ 00468000
*              /*                                                    */ 00469000
*              /* THE BASE CLUSTER DATA SET NAME HAS BEEN SPECIFIED. */ 00470000
*              /* IN A TSO ENVIRONMENT THE DATA SET NAME MAY BE      */ 00471000
*              /* UNQUALIFIED.  IF SO, ISSUE THE UQUAL MACRO TO      */ 00472000
*              /* ACCOMPLISH NAME QUALIFICATION.  IF ERROR, RETURN   */ 00473000
*              /* WITH A CONDITION CODE 12                           */ 00474000
*              /*                                                    */ 00475000
*              /******************************************************/ 00476000
*                                                                  0274 00477000
*              ELSE                                                0274 00478000
*                DO;                                               0274 00479000
*                                                                  0274 00480000
         B     @RC00268                                            0274 00481000
@RF00268 DS    0H                                                  0275 00482000
*                IF IDSFUQ = ON                                    0275 00483000
*                  THEN                                            0275 00484000
         L     @03,@PC00001+4                                      0275 00485000
         L     @03,FDTPTR+4(,@03)                                  0275 00486000
         TM    IDSFUQ(@03),B'10000000'                             0275 00487000
         BNO   @RF00275                                            0275 00488000
*                    DO;                                           0276 00489000
*                                                                  0276 00490000
*                    QDSNPTR = ADDR(IDSVAL);                       0277 00491000
         LA    @15,IDSVAL(,@03)                                    0277 00492000
         ST    @15,QDSNPTR                                         0277 00493000
*                    QDSNLEN = IDSLEN;                             0278 00494000
         SLR   @15,@15                                             0278 00495000
         IC    @15,IDSLEN(,@03)                                    0278 00496000
         STH   @15,QDSNLEN                                         0278 00497000
*                    QCATPTR = NULLPTR;                            0279 00498000
*                                                                  0279 00499000
         SLR   @15,@15                                             0279 00500000
         ST    @15,QCATPTR                                         0279 00501000
*                    IF IDSPLN ^= 0                                0280 00502000
*                      THEN                                        0280 00503000
         CLI   IDSPLN(@03),0                                       0280 00504000
         BE    @RF00280                                            0280 00505000
*                        QDSNPSWD = ADDR(IDSPAS);                  0281 00506000
*                                                                  0281 00507000
         LA    @03,IDSPAS(,@03)                                    0281 00508000
         ST    @03,QDSNPSWD                                        0281 00509000
*                      ELSE                                        0282 00510000
*                        QDSNPSWD = NULLPTR;                       0282 00511000
*                                                                  0282 00512000
         B     @RC00280                                            0282 00513000
@RF00280 SLR   @03,@03                                             0282 00514000
         ST    @03,QDSNPSWD                                        0282 00515000
*                    CALL IDCSAQL0 (GDTTBL,QDSNPTR,QDSNLEN,        0283 00516000
*                            QCATPTR,QDSNPSWD);                    0283 00517000
*                                                                  0283 00518000
@RC00280 L     @15,@PC00001                                        0283 00519000
         ST    @15,@AL00001                                        0283 00520000
         LA    @14,QDSNPTR                                         0283 00521000
         ST    @14,@AL00001+4                                      0283 00522000
         LA    @14,QDSNLEN                                         0283 00523000
         ST    @14,@AL00001+8                                      0283 00524000
         LA    @14,QCATPTR                                         0283 00525000
         ST    @14,@AL00001+12                                     0283 00526000
         LA    @14,QDSNPSWD                                        0283 00527000
         ST    @14,@AL00001+16                                     0283 00528000
         MVI   @AL00001+16,X'80'                                   0283 00529000
         L     @15,GDTQAL(,@15)                                    0283 00530000
         LA    @01,@AL00001                                        0283 00531000
         BALR  @14,@15                                             0283 00532000
*                    RESPECIFY RTNREG RSTD;                        0284 00533000
*                    TESTRC = RTNREG;                              0285 00534000
         LR    TESTRC,RTNREG                                       0285 00535000
*                    RESPECIFY RTNREG UNRSTD;                      0286 00536000
*                                                                  0286 00537000
*                    IF TESTRC ^= 0                                0287 00538000
*                      THEN                                        0287 00539000
         LTR   TESTRC,TESTRC                                       0287 00540000
         BZ    @RF00287                                            0287 00541000
*                        RETURN CODE(LASTCC12);                    0288 00542000
*                                                                  0288 00543000
         LA    @15,12                                              0288 00544000
         L     @14,@SA00002                                        0288 00545000
         LM    @00,@12,@SA00002+8                                  0288 00546000
         BR    @14                                                 0288 00547000
*                    END;                                          0289 00548000
*                                                                  0289 00549000
@RF00287 DS    0H                                                  0290 00550000
*                /****************************************************/ 00551000
*                /*                                                  */ 00552000
*                /* REFERENCE THE BASE CLUSTER DATA SET NAME AND     */ 00553000
*                /* ITS PASSWORD IN THE OPNAGL.                      */ 00554000
*                /*                                                  */ 00555000
*                /****************************************************/ 00556000
*                                                                  0290 00557000
*                OPNDSN = ADDR(IDSVAL);                            0290 00558000
*                                                                  0290 00559000
@RF00275 L     @03,@PC00001+4                                      0290 00560000
         L     @03,FDTPTR+4(,@03)                                  0290 00561000
         LA    @15,IDSVAL(,@03)                                    0290 00562000
         ST    @15,OPNDSN(,OPNPTR)                                 0290 00563000
*                IF IDSPLN ^= 0                                    0291 00564000
*                  THEN                                            0291 00565000
         CLI   IDSPLN(@03),0                                       0291 00566000
         BE    @RF00291                                            0291 00567000
*                    OPNPWA = ADDR(IDSPAS);                        0292 00568000
*                                                                  0292 00569000
         LA    @03,IDSPAS(,@03)                                    0292 00570000
         ST    @03,OPNPWA(,OPNPTR)                                 0292 00571000
*                END;                                              0293 00572000
*                                                                  0293 00573000
*            END OPENBASE;                                         0294 00574000
*                                                                  0294 00575000
*          /**********************************************************/ 00576000
*          /*                                                        */ 00577000
*          /* OPEN THE ALTERNATE INDEX.  SET UP THE PROCESSING       */ 00578000
*          /* OPTIONS - OUTPUT, KEYED, RESET, OPEN ALTERNATE INDEX   */ 00579000
*          /* ONLY.  THE ALTERNATE INDEX CAN BE SPECIFIED IN THE     */ 00580000
*          /* SAME MANNER AS DESCRIBED ABOVE FOR THE BASE CLUSTER.   */ 00581000
*          /*                                                        */ 00582000
*          /**********************************************************/ 00583000
*                                                                  0295 00584000
*          ELSE                                                    0295 00585000
*            IF OTYPE = 'A'                                        0295 00586000
*              THEN                                                0295 00587000
         B     @RC00265                                            0295 00588000
@RF00265 L     @03,@PC00002                                        0295 00589000
         CLI   OTYPE(@03),C'A'                                     0295 00590000
         BNE   @RF00295                                            0295 00591000
*OPENAIX:        DO;                                               0296 00592000
*                                                                  0296 00593000
OPENAIX  DS    0H                                                  0297 00594000
*                OPNOPTOT = ON;                                    0297 00595000
*                OPNOPTKS = ON;                                    0298 00596000
         OI    OPNOPTOT(OPNPTR),B'01001000'                        0298 00597000
*                OPNMODAX = ON;                                    0299 00598000
*                OPNMODRS = ON;                                    0300 00599000
*                                                                  0300 00600000
         OI    OPNMODAX(OPNPTR),B'00001100'                        0300 00601000
*                IF ADDR(OFILE) ^= NULLPTR                         0301 00602000
*                  THEN                                            0301 00603000
         SLR   @03,@03                                             0301 00604000
         L     @15,@PC00001+4                                      0301 00605000
         L     @15,FDTPTR+8(,@15)                                  0301 00606000
         CR    @15,@03                                             0301 00607000
         BE    @RF00301                                            0301 00608000
*                    DO;                                           0302 00609000
*                                                                  0302 00610000
*                    OPNDDN = ADDR(OFILEVAL(OINDX));               0303 00611000
*                                                                  0303 00612000
         L     @14,@PC00002+8                                      0303 00613000
         L     @14,OINDX(,@14)                                     0303 00614000
         MH    @14,@CH01639                                        0303 00615000
         LA    @01,0(@14,@15)                                      0303 00616000
         AL    @01,@CF01668                                        0303 00617000
         ST    @01,OPNDDN(,OPNPTR)                                 0303 00618000
*                    IF OFILEPLN(OINDX) ^= 0                       0304 00619000
*                      THEN                                        0304 00620000
         LA    @01,0(@14,@15)                                      0304 00621000
         AL    @01,@CF01669                                        0304 00622000
         SLR   @00,@00                                             0304 00623000
         IC    @00,OFILEPLN-2(,@01)                                0304 00624000
         CR    @03,@00                                             0304 00625000
         BE    @RF00304                                            0304 00626000
*                        OPNPWA = ADDR(OFILEPAS(OINDX));           0305 00627000
*                                                                  0305 00628000
         AL    @15,@CF01670                                        0305 00629000
         LA    @03,OFILEPAS-3(@14,@15)                             0305 00630000
         ST    @03,OPNPWA(,OPNPTR)                                 0305 00631000
*                    END;                                          0306 00632000
*                                                                  0306 00633000
*                  /**************************************************/ 00634000
*                  /*                                                */ 00635000
*                  /* THE ALTERNATE INDEX DATA SET NAME HAS BEEN     */ 00636000
*                  /* SPECIFIED.  IF THE NAME IS UNQUALIFIED, ISSUE  */ 00637000
*                  /* THE UQUAL MACRO AS DESCRIBED FOR THE BASE      */ 00638000
*                  /* CLUSTER.  IF ERROR, RETURN WITH A CONDITION    */ 00639000
*                  /* CODE 8.                                        */ 00640000
*                  /*                                                */ 00641000
*                  /**************************************************/ 00642000
*                                                                  0307 00643000
*                  ELSE                                            0307 00644000
*                    DO;                                           0307 00645000
*                                                                  0307 00646000
         B     @RC00301                                            0307 00647000
@RF00301 DS    0H                                                  0308 00648000
*                    IF ODSFUQ(OINDX) = ON                         0308 00649000
*                      THEN                                        0308 00650000
         L     @03,@PC00002+8                                      0308 00651000
         L     @03,OINDX(,@03)                                     0308 00652000
         MH    @03,@CH01640                                        0308 00653000
         L     @15,@PC00001+4                                      0308 00654000
         L     @15,FDTPTR+12(,@15)                                 0308 00655000
         ST    @03,@TF00001                                        0308 00656000
         ALR   @03,@15                                             0308 00657000
         AL    @03,@CF01671                                        0308 00658000
         TM    ODSFUQ-12(@03),B'10000000'                          0308 00659000
         BNO   @RF00308                                            0308 00660000
*                        DO;                                       0309 00661000
*                                                                  0309 00662000
*                        QDSNPTR = ADDR(ODSVAL(OINDX));            0310 00663000
         L     @03,@TF00001                                        0310 00664000
         AL    @03,@CF01672                                        0310 00665000
         LA    @03,ODSVAL-23(@03,@15)                              0310 00666000
         ST    @03,QDSNPTR                                         0310 00667000
*                        QDSNLEN = ODSLEN(OINDX);                  0311 00668000
         L     @03,@TF00001                                        0311 00669000
         AL    @03,@CF01673                                        0311 00670000
         SLR   @14,@14                                             0311 00671000
         IC    @14,ODSLEN-22(@03,@15)                              0311 00672000
         STH   @14,QDSNLEN                                         0311 00673000
*                        QCATPTR = NULLPTR;                        0312 00674000
*                                                                  0312 00675000
         SLR   @03,@03                                             0312 00676000
         ST    @03,QCATPTR                                         0312 00677000
*                        IF ODSPLN(OINDX) ^= 0                     0313 00678000
*                          THEN                                    0313 00679000
         L     @14,@TF00001                                        0313 00680000
         AL    @14,@CF01674                                        0313 00681000
         SLR   @07,@07                                             0313 00682000
         IC    @07,ODSPLN-2(@14,@15)                               0313 00683000
         CR    @03,@07                                             0313 00684000
         BE    @RF00313                                            0313 00685000
*                            QDSNPSWD = ADDR(ODSPAS(OINDX));       0314 00686000
*                                                                  0314 00687000
         L     @03,@TF00001                                        0314 00688000
         AL    @15,@CF01675                                        0314 00689000
         LA    @03,ODSPAS-3(@03,@15)                               0314 00690000
         ST    @03,QDSNPSWD                                        0314 00691000
*                          ELSE                                    0315 00692000
*                            QDSNPSWD = NULLPTR;                   0315 00693000
*                                                                  0315 00694000
         B     @RC00313                                            0315 00695000
@RF00313 SLR   @03,@03                                             0315 00696000
         ST    @03,QDSNPSWD                                        0315 00697000
*                        CALL IDCSAQL0 (GDTTBL,QDSNPTR,QDSNLEN,    0316 00698000
*                                QCATPTR,QDSNPSWD);                0316 00699000
*                                                                  0316 00700000
@RC00313 L     @15,@PC00001                                        0316 00701000
         ST    @15,@AL00001                                        0316 00702000
         LA    @14,QDSNPTR                                         0316 00703000
         ST    @14,@AL00001+4                                      0316 00704000
         LA    @14,QDSNLEN                                         0316 00705000
         ST    @14,@AL00001+8                                      0316 00706000
         LA    @14,QCATPTR                                         0316 00707000
         ST    @14,@AL00001+12                                     0316 00708000
         LA    @14,QDSNPSWD                                        0316 00709000
         ST    @14,@AL00001+16                                     0316 00710000
         MVI   @AL00001+16,X'80'                                   0316 00711000
         L     @15,GDTQAL(,@15)                                    0316 00712000
         LA    @01,@AL00001                                        0316 00713000
         BALR  @14,@15                                             0316 00714000
*                        RESPECIFY RTNREG RSTD;                    0317 00715000
*                        TESTRC = RTNREG;                          0318 00716000
         LR    TESTRC,RTNREG                                       0318 00717000
*                        RESPECIFY RTNREG UNRSTD;                  0319 00718000
*                                                                  0319 00719000
*                        IF TESTRC ^= 0                            0320 00720000
*                          THEN                                    0320 00721000
         LTR   TESTRC,TESTRC                                       0320 00722000
         BZ    @RF00320                                            0320 00723000
*                            RETURN CODE(LASTCC08);                0321 00724000
*                                                                  0321 00725000
         LA    @15,8                                               0321 00726000
         L     @14,@SA00002                                        0321 00727000
         LM    @00,@12,@SA00002+8                                  0321 00728000
         BR    @14                                                 0321 00729000
*                        END;                                      0322 00730000
*                                                                  0322 00731000
@RF00320 DS    0H                                                  0323 00732000
*                    /************************************************/ 00733000
*                    /*                                              */ 00734000
*                    /* REFERENCE THE ALTERNATE INDEX DATA SET NAME  */ 00735000
*                    /* AND ITS PASSWORD IN THE OPNAGL.              */ 00736000
*                    /*                                              */ 00737000
*                    /************************************************/ 00738000
*                                                                  0323 00739000
*                    OPNDSN = ADDR(ODSVAL(OINDX));                 0323 00740000
*                                                                  0323 00741000
@RF00308 L     @03,@PC00002+8                                      0323 00742000
         L     @03,OINDX(,@03)                                     0323 00743000
         MH    @03,@CH01640                                        0323 00744000
         L     @15,@PC00001+4                                      0323 00745000
         L     @15,FDTPTR+12(,@15)                                 0323 00746000
         LA    @01,0(@03,@15)                                      0323 00747000
         AL    @01,@CF01672                                        0323 00748000
         ST    @01,OPNDSN(,OPNPTR)                                 0323 00749000
*                    IF ODSPLN(OINDX) ^= 0                         0324 00750000
*                      THEN                                        0324 00751000
         LA    @01,0(@03,@15)                                      0324 00752000
         AL    @01,@CF01674                                        0324 00753000
         SLR   @00,@00                                             0324 00754000
         IC    @00,ODSPLN-2(,@01)                                  0324 00755000
         C     @00,@CF00116                                        0324 00756000
         BE    @RF00324                                            0324 00757000
*                        OPNPWA = ADDR(ODSPAS(OINDX));             0325 00758000
*                                                                  0325 00759000
         AL    @15,@CF01675                                        0325 00760000
         LA    @03,ODSPAS-3(@03,@15)                               0325 00761000
         ST    @03,OPNPWA(,OPNPTR)                                 0325 00762000
*                    END;                                          0326 00763000
*                                                                  0326 00764000
*                END OPENAIX;                                      0327 00765000
*                                                                  0327 00766000
*              /******************************************************/ 00767000
*              /*                                                    */ 00768000
*              /* OPEN A FIRST PASS SORT WORK FILE.  SET UP THE      */ 00769000
*              /* PROCESSING OPTIONS - OUTPUT, CONTROL INTERVAL,     */ 00770000
*              /* USER BUFFERS, RESET.                               */ 00771000
*              /*                                                    */ 00772000
*              /******************************************************/ 00773000
*                                                                  0328 00774000
*              ELSE                                                0328 00775000
*                IF OTYPE = 'S'                                    0328 00776000
*                  THEN                                            0328 00777000
         B     @RC00295                                            0328 00778000
@RF00295 L     @03,@PC00002                                        0328 00779000
         CLI   OTYPE(@03),C'S'                                     0328 00780000
         BNE   @RF00328                                            0328 00781000
*                    DO;                                           0329 00782000
*                                                                  0329 00783000
*                    OPNOPTOT = ON;                                0330 00784000
*                    OPNOPTBK = ON;                                0331 00785000
         OI    OPNOPTOT(OPNPTR),B'01010000'                        0331 00786000
*                    OPNMODUB = ON;                                0332 00787000
*                    OPNMODRS = ON;                                0333 00788000
*                                                                  0333 00789000
         OI    OPNMODUB(OPNPTR),B'00000110'                        0333 00790000
*                    END;                                          0334 00791000
*                                                                  0334 00792000
*                  /**************************************************/ 00793000
*                  /*                                                */ 00794000
*                  /* OPEN A MERGE PASS SORT WORK FILE.  SET UP THE  */ 00795000
*                  /* PROCESSING OPTIONS - UPDATE, DIRECT, CONTROL   */ 00796000
*                  /* INTERVAL, USER BUFFERS.                        */ 00797000
*                  /*                                                */ 00798000
*                  /**************************************************/ 00799000
*                                                                  0335 00800000
*                  ELSE                                            0335 00801000
*                    DO;                                           0335 00802000
*                                                                  0335 00803000
         B     @RC00328                                            0335 00804000
@RF00328 DS    0H                                                  0336 00805000
*                    OPNOPTUP = ON;                                0336 00806000
*                    OPNOPTDR = ON;                                0337 00807000
*                    OPNOPTBK = ON;                                0338 00808000
         OI    OPNOPTUP(OPNPTR),B'00110010'                        0338 00809000
*                    OPNMODUB = ON;                                0339 00810000
*                                                                  0339 00811000
         OI    OPNMODUB(OPNPTR),B'00000010'                        0339 00812000
*                    END;                                          0340 00813000
*                                                                  0340 00814000
*        /************************************************************/ 00815000
*        /*                                                          */ 00816000
*        /* REFERENCE THE DATA SET NAME FOR A SORT WORK FILE.        */ 00817000
*        /* USING THE DATA SET NAME CAUSES THE I/O ADAPTER TO        */ 00818000
*        /* PERFORM DYNAMIC ALLOCATION AS A PART OF UOPEN            */ 00819000
*        /* PROCESSING.                                              */ 00820000
*        /*                                                          */ 00821000
*        /************************************************************/ 00822000
*                                                                  0341 00823000
*        IF OTYPE = 'S' |                                          0341 00824000
*           OTYPE = 'M'                                            0341 00825000
*          THEN                                                    0341 00826000
@RC00328 DS    0H                                                  0341 00827000
@RC00295 DS    0H                                                  0341 00828000
@RC00265 L     @03,@PC00002                                        0341 00829000
         CLI   OTYPE(@03),C'S'                                     0341 00830000
         BE    @RT00341                                            0341 00831000
         CLI   OTYPE(@03),C'M'                                     0341 00832000
         BNE   @RF00341                                            0341 00833000
@RT00341 DS    0H                                                  0342 00834000
*            DO;                                                   0342 00835000
*                                                                  0342 00836000
*            SWDATPTR = OIOINPT + 4;                               0343 00837000
*                                                                  0343 00838000
         LA    @03,4                                               0343 00839000
         L     @15,@PC00002+12                                     0343 00840000
         L     SWDATPTR,OIOINPT(,@15)                              0343 00841000
         ALR   SWDATPTR,@03                                        0343 00842000
*            IF IODSNID ^= DSNIDMSK                                0344 00843000
*              THEN                                                0344 00844000
         CLC   IODSNID(2,SWDATPTR),@CB00960                        0344 00845000
         BE    @RF00344                                            0344 00846000
*                SWDATPTR = SWDATPTR + IODSNLN + 4;                0345 00847000
*                                                                  0345 00848000
         LR    @05,SWDATPTR                                        0345 00849000
         AH    @05,IODSNLN(,SWDATPTR)                              0345 00850000
         ALR   @05,@03                                             0345 00851000
         LR    SWDATPTR,@05                                        0345 00852000
*            OPNDSN = ADDR(IODSN);                                 0346 00853000
*                                                                  0346 00854000
@RF00344 LA    @05,IODSN(,SWDATPTR)                                0346 00855000
         ST    @05,OPNDSN(,OPNPTR)                                 0346 00856000
*            END;                                                  0347 00857000
*                                                                  0347 00858000
*        /************************************************************/ 00859000
*        /*                                                          */ 00860000
*        /* ISSUE UOPEN - IF ERROR, RETURN WITH A CONDITION CODE 12  */ 00861000
*        /* FOR THE BASE CLUSTER AND A CODE 8 FOR ALL OTHERS         */ 00862000
*        /*                                                          */ 00863000
*        /************************************************************/ 00864000
*                                                                  0348 00865000
*        CALL IDCIOOP0(GDTTBL,OPNAGL);                             0348 00866000
*                                                                  0348 00867000
@RF00341 L     @15,@PC00001                                        0348 00868000
         ST    @15,@AL00001                                        0348 00869000
         ST    OPNPTR,@AL00001+4                                   0348 00870000
         MVI   @AL00001+4,X'80'                                    0348 00871000
         L     @15,GDTOPN(,@15)                                    0348 00872000
         LA    @01,@AL00001                                        0348 00873000
         BALR  @14,@15                                             0348 00874000
*        RESPECIFY RTNREG RSTD;                                    0349 00875000
*        TESTRC = RTNREG;                                          0350 00876000
         LR    TESTRC,RTNREG                                       0350 00877000
*        RESPECIFY RTNREG UNRSTD;                                  0351 00878000
*                                                                  0351 00879000
*        IF GDTDBG = NULLPTR                                       0352 00880000
*          THEN;                                                   0352 00881000
         L     @02,@PC00001                                        0352 00882000
         L     @02,GDTDBG(,@02)                                    0352 00883000
         LTR   @02,@02                                             0352 00884000
         BZ    @RT00352                                            0352 00885000
*          ELSE                                                    0354 00886000
*            CALL IDCDB010 (GDTTBL,'BIP2');                        0354 00887000
*                                                                  0354 00888000
         L     @02,@PC00001                                        0354 00889000
         ST    @02,@AL00001                                        0354 00890000
         LA    @15,@CC01132                                        0354 00891000
         ST    @15,@AL00001+4                                      0354 00892000
         MVI   @AL00001+4,X'80'                                    0354 00893000
         L     @15,GDTDBG(,@02)                                    0354 00894000
         LA    @01,@AL00001                                        0354 00895000
         BALR  @14,@15                                             0354 00896000
*        IF TESTRC ^= 0                                            0355 00897000
*          THEN                                                    0355 00898000
@RT00352 LTR   TESTRC,TESTRC                                       0355 00899000
         BZ    @RF00355                                            0355 00900000
*            IF OTYPE = 'B'                                        0356 00901000
*              THEN                                                0356 00902000
         L     @15,@PC00002                                        0356 00903000
         CLI   OTYPE(@15),C'B'                                     0356 00904000
         BNE   @RF00356                                            0356 00905000
*                RETURN CODE(LASTCC12);                            0357 00906000
*                                                                  0357 00907000
         LA    @15,12                                              0357 00908000
         L     @14,@SA00002                                        0357 00909000
         LM    @00,@12,@SA00002+8                                  0357 00910000
         BR    @14                                                 0357 00911000
*              ELSE                                                0358 00912000
*                RETURN CODE(LASTCC08);                            0358 00913000
*                                                                  0358 00914000
@RF00356 LA    @15,8                                               0358 00915000
         L     @14,@SA00002                                        0358 00916000
         LM    @00,@12,@SA00002+8                                  0358 00917000
         BR    @14                                                 0358 00918000
*          /**********************************************************/ 00919000
*          /*                                                        */ 00920000
*          /* FOLLOWING A SUCCESSFUL OPEN, VERIFY THAT THE BASE      */ 00921000
*          /* CLUSTER IS NOT EMPTY.  IF EMPTY, ISSUE MESSAGE AND     */ 00922000
*          /* RETURN WITH CONDITION CODE 12.  FOR ALL OTHER          */ 00923000
*          /* SUCCESSFUL OPENS, RETURN WITH A CONDITION CODE 0       */ 00924000
*          /*                                                        */ 00925000
*          /**********************************************************/ 00926000
*                                                                  0359 00927000
*          ELSE                                                    0359 00928000
*            IF OTYPE = 'B'                                        0359 00929000
*              THEN                                                0359 00930000
@RF00355 L     @15,@PC00002                                        0359 00931000
         CLI   OTYPE(@15),C'B'                                     0359 00932000
         BNE   @RF00359                                            0359 00933000
*                IF OIOCS -> IOCHURBA = 0                          0360 00934000
*                  THEN                                            0360 00935000
         L     @15,@PC00002+4                                      0360 00936000
         L     @15,OIOCS(,@15)                                     0360 00937000
         L     @14,IOCHURBA(,@15)                                  0360 00938000
         LTR   @14,@14                                             0360 00939000
         BNZ   @RF00360                                            0360 00940000
*                    DO;                                           0361 00941000
*                                                                  0361 00942000
*                    DARGDBP = OIOCS -> IOCDSN;                    0362 00943000
         L     @14,DDSTRU                                          0362 00944000
         L     @15,IOCDSN(,@15)                                    0362 00945000
         ST    @15,DARGDBP(,@14)                                   0362 00946000
*                    DARGSTID = BASEMPTY;                          0363 00947000
         MVC   DARGSTID(4,@14),@CF00890                            0363 00948000
*                    DARGILP = LENGTH(DSNAME);                     0364 00949000
*                                                                  0364 00950000
         MVC   DARGILP(2,@14),@CH00596                             0364 00951000
*                    CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);        0365 00952000
*                                                                  0365 00953000
         L     @15,@PC00001                                        0365 00954000
         ST    @15,@AL00001                                        0365 00955000
         LA    @14,@CF00116                                        0365 00956000
         ST    @14,@AL00001+4                                      0365 00957000
         LA    @14,DDSTRU                                          0365 00958000
         ST    @14,@AL00001+8                                      0365 00959000
         MVI   @AL00001+8,X'80'                                    0365 00960000
         L     @15,GDTPRT(,@15)                                    0365 00961000
         LA    @01,@AL00001                                        0365 00962000
         BALR  @14,@15                                             0365 00963000
*                    RETURN CODE(LASTCC12);                        0366 00964000
*                                                                  0366 00965000
         LA    @15,12                                              0366 00966000
         L     @14,@SA00002                                        0366 00967000
         LM    @00,@12,@SA00002+8                                  0366 00968000
         BR    @14                                                 0366 00969000
*                    END;                                          0367 00970000
*                                                                  0367 00971000
*                                                                  0367 00972000
*        RETURN CODE(LASTCC00);                                    0368 00973000
*                                                                  0368 00974000
@RF00360 DS    0H                                                  0368 00975000
@RF00359 SLR   @15,@15                                             0368 00976000
         L     @14,@SA00002                                        0368 00977000
         LM    @00,@12,@SA00002+8                                  0368 00978000
         BR    @14                                                 0368 00979000
*END OPENPROC;                                                     0369 00980000
*        /************************************************************/ 00981000
*        /*                                                          */ 00982000
*        /* PROCEDURE NAME - JCPROC                                  */ 00983000
*        /*                                                          */ 00984000
*        /* FUNCTION - PERFORMS THE FUNCTION OF DETERMINING IF       */ 00985000
*        /*            THE CALLER OF BLDINDEX HAS PROVIDED SORT WORK */ 00986000
*        /*            FILE JOB CONTROL AND, IF SO, OF OBTAINING     */ 00987000
*        /*            THE DATA SET NAMES AND VOLUME SERIAL LISTS.   */ 00988000
*        /*            THE CALLER CAN SPECIFY DNAMES VIA THE         */ 00989000
*        /*            WORKFILES PARAMETER OR PROVIDE JOB CONTROL    */ 00990000
*        /*            USING THE DEFAULT DNAMES OF IDCUT1 AND        */ 00991000
*        /*            IDCUT2.  IF THE CALLER PROVIDES SORT WORK     */ 00992000
*        /*            JOB CONTROL, IT WILL BE USED ONLY IF AN       */ 00993000
*        /*            INTERNAL SORT CANNOT BE PERFORMED. JCPROC     */ 00994000
*        /*            USES THE UIOINFO MACRO TO DETERMINE IF JOB    */ 00995000
*        /*            CONTROL EXISTS AND, IF SO, TO OBTAIN THE      */ 00996000
*        /*            DATA.                                         */ 00997000
*        /*                                                          */ 00998000
*        /* INPUT -                                                  */ 00999000
*        /*                                                          */ 01000000
*        /* OUTPUT -                                                 */ 01001000
*        /*          JCIOIN - POINTERS TO THE AREA RETURNED BY       */ 01002000
*        /*                   UIOINFO.  THESE POINTERS WILL BE       */ 01003000
*        /*                   ZERO IF NO DATA WAS OBTAINED.          */ 01004000
*        /*                                                          */ 01005000
*        /* EXIT,NORMAL - RETURN CODE 0, JOB CONTROL DATA SUCCESS-   */ 01006000
*        /*                              FULLY OBTAINED OR, IF NOT,  */ 01007000
*        /*                              THE EXTERNALSORT PARAMETER  */ 01008000
*        /*                              WAS NOT SPECIFIED           */ 01009000
*        /*                                                          */ 01010000
*        /* EXIT,ERROR  - RETURN CODE 12, JOB CONTROL DATA WAS NOT   */ 01011000
*        /*                               OBTAINED AND THE EXTERNAL- */ 01012000
*        /*                               SORT PARAMETER WAS         */ 01013000
*        /*                               SPECIFIED                  */ 01014000
*        /*                                                          */ 01015000
*        /************************************************************/ 01016000
*                                                                  0370 01017000
*JCPROC:                                                           0370 01018000
*        PROCEDURE (JCIOIN);           /* PTRS TO DATA OBTAINED      */ 01019000
*                                                                  0370 01020000
JCPROC   STM   @14,@12,@SA00003                                    0370 01021000
         MVC   @PC00003(4),0(@01)                                  0370 01022000
*        /************************************************************/ 01023000
*        /*                                                          */ 01024000
*        /* ARGUMENTS OF INVOCATION                                  */ 01025000
*        /*                                                          */ 01026000
*        /************************************************************/ 01027000
*                                                                  0371 01028000
*        DCL 1 JCIOIN BDY(WORD),       /* POINTERS TO UIOINFO        */ 01029000
*              2 JCIOINPT(2) PTR(31);  /* RETURN AREAS               */ 01030000
*                                                                  0371 01031000
*                                                                  0371 01032000
*        /************************************************************/ 01033000
*        /*                                                          */ 01034000
*        /* LOOP CONTROL                                             */ 01035000
*        /*                                                          */ 01036000
*        /************************************************************/ 01037000
*                                                                  0372 01038000
*        DCL                                                       0372 01039000
*          JC    FIXED(31),                                        0372 01040000
*          STOPJ BIT(1);                                           0372 01041000
*                                                                  0372 01042000
*        /************************************************************/ 01043000
*        /*                                                          */ 01044000
*        /* DNAME TO BE PASSED TO UIOINFO                            */ 01045000
*        /*                                                          */ 01046000
*        /************************************************************/ 01047000
*                                                                  0373 01048000
*        DCL SWFDNAME CHAR(8);                                     0373 01049000
*                                                                  0373 01050000
*        /************************************************************/ 01051000
*        /*                                                          */ 01052000
*        /* UIOINFO OPTION BYTE                                      */ 01053000
*        /*                                                          */ 01054000
*        /************************************************************/ 01055000
*                                                                  0374 01056000
*        DCL UIOINOPT CHAR(1);                                     0374 01057000
*                                                                  0374 01058000
*        RFY IOINFOPT BASED(ADDR(UIOINOPT));                       0375 01059000
*                                                                  0375 01060000
*        /************************************************************/ 01061000
*        /*                                                          */ 01062000
*        /* INITIALIZATION - SET UP UIOINFO OPTION BYTE              */ 01063000
*        /*                                                          */ 01064000
*        /************************************************************/ 01065000
*                                                                  0376 01066000
*        OLDERID2 = NEWERID2;                                      0376 01067000
         L     @15,@PC00001                                        0376 01068000
         L     @15,GDTTR2(,@15)                                    0376 01069000
         MVC   @TS00001(95),NEWERID2(@15)                          0376 01070000
         MVC   OLDERID2(95,@15),@TS00001                           0376 01071000
*        NEWID2 = 'BIJ1';                                          0377 01072000
*                                                                  0377 01073000
         MVC   NEWID2(4,@15),@CC01145                              0377 01074000
*        IOINFOPT = ''B;                                           0378 01075000
         LA    @15,UIOINOPT                                        0378 01076000
         MVI   IOINFOPT(@15),X'00'                                 0378 01077000
*        IOINFVOL = ON;                                            0379 01078000
*        IOINFDSN = ON;                                            0380 01079000
*        IOINFSUP = ON;                                            0381 01080000
         OI    IOINFVOL(@15),B'01110000'                           0381 01081000
*        STOPJ = OFF;                                              0382 01082000
*                                                                  0382 01083000
         NI    STOPJ,B'01111111'                                   0382 01084000
*        /************************************************************/ 01085000
*        /*                                                          */ 01086000
*        /* UIOINFO LOOP - SET UP DNAME TO BE REFERENCED.  USE       */ 01087000
*        /* WORKFILES PARAMETER IF SPECIFIED - OTHERWISE USE         */ 01088000
*        /* DEFAULT DNAMES                                           */ 01089000
*        /*                                                          */ 01090000
*        /************************************************************/ 01091000
*                                                                  0383 01092000
*        DO JC =1 TO 2 WHILE STOPJ = OFF;                          0383 01093000
*                                                                  0383 01094000
         LA    JC,1                                                0383 01095000
@DL00383 TM    STOPJ,B'10000000'                                   0383 01096000
         BNZ   @DC00383                                            0383 01097000
*          IF ADDR(WFILE) ^= NULLPTR                               0384 01098000
*            THEN                                                  0384 01099000
         L     @03,@PC00001+4                                      0384 01100000
         L     @15,FDTPTR+20(,@03)                                 0384 01101000
         LTR   @15,@15                                             0384 01102000
         BZ    @RF00384                                            0384 01103000
*              IF JC = 1                                           0385 01104000
*                THEN                                              0385 01105000
         C     JC,@CF00220                                         0385 01106000
         BNE   @RF00385                                            0385 01107000
*                  SWFDNAME = WFLE1VAL;                            0386 01108000
*                                                                  0386 01109000
         L     @03,FDTPTR+24(,@03)                                 0386 01110000
         MVC   SWFDNAME(8),WFLE1VAL(@03)                           0386 01111000
*                ELSE                                              0387 01112000
*                  SWFDNAME = WFLE2VAL;                            0387 01113000
*                                                                  0387 01114000
         B     @RC00385                                            0387 01115000
@RF00385 L     @03,@PC00001+4                                      0387 01116000
         L     @03,FDTPTR+28(,@03)                                 0387 01117000
         MVC   SWFDNAME(8),WFLE2VAL(@03)                           0387 01118000
*            ELSE                                                  0388 01119000
*              SWFDNAME = DEFDDN(JC);                              0388 01120000
*                                                                  0388 01121000
         B     @RC00384                                            0388 01122000
@RF00384 LR    @03,JC                                              0388 01123000
         SLA   @03,3                                               0388 01124000
         LA    @01,DEFDDN-8(@03)                                   0388 01125000
         MVC   SWFDNAME(8),0(@01)                                  0388 01126000
*          /**********************************************************/ 01127000
*          /*                                                        */ 01128000
*          /* ISSUE UIOINFO                                          */ 01129000
*          /*                                                        */ 01130000
*          /**********************************************************/ 01131000
*                                                                  0389 01132000
*          CALL IDCIOSI0 (GDTTBL,IOINFOPT,JCIOINPT(JC),SWFDNAME,   0389 01133000
*                   UGPID01);                                      0389 01134000
*                                                                  0389 01135000
@RC00384 L     @15,@PC00001                                        0389 01136000
         ST    @15,@AL00001                                        0389 01137000
         LA    @14,UIOINOPT                                        0389 01138000
         ST    @14,@AL00001+4                                      0389 01139000
         LR    @14,JC                                              0389 01140000
         SLA   @14,2                                               0389 01141000
         L     @07,@PC00003                                        0389 01142000
         AL    @07,@CF01678                                        0389 01143000
         LA    @14,JCIOINPT(@14,@07)                               0389 01144000
         ST    @14,@AL00001+8                                      0389 01145000
         LA    @14,SWFDNAME                                        0389 01146000
         ST    @14,@AL00001+12                                     0389 01147000
         LA    @14,UGPID01                                         0389 01148000
         ST    @14,@AL00001+16                                     0389 01149000
         MVI   @AL00001+16,X'80'                                   0389 01150000
         L     @15,GDTIFO(,@15)                                    0389 01151000
         LA    @01,@AL00001                                        0389 01152000
         BALR  @14,@15                                             0389 01153000
*          RESPECIFY RTNREG RSTD;                                  0390 01154000
*          TESTRC = RTNREG;                                        0391 01155000
         LR    TESTRC,RTNREG                                       0391 01156000
*          RESPECIFY RTNREG UNRSTD;                                0392 01157000
*                                                                  0392 01158000
*          IF TESTRC ^= 0                                          0393 01159000
*            THEN                                                  0393 01160000
         LTR   TESTRC,TESTRC                                       0393 01161000
         BZ    @RF00393                                            0393 01162000
*              STOPJ = ON;                                         0394 01163000
*                                                                  0394 01164000
         OI    STOPJ,B'10000000'                                   0394 01165000
*        END;                                                      0395 01166000
*                                                                  0395 01167000
@RF00393 AL    JC,@CF00220                                         0395 01168000
         C     JC,@CF00154                                         0395 01169000
         BNH   @DL00383                                            0395 01170000
@DC00383 DS    0H                                                  0396 01171000
*        IF GDTDBG = NULLPTR                                       0396 01172000
*          THEN;                                                   0396 01173000
         L     @15,@PC00001                                        0396 01174000
         L     @15,GDTDBG(,@15)                                    0396 01175000
         LTR   @15,@15                                             0396 01176000
         BZ    @RT00396                                            0396 01177000
*          ELSE                                                    0398 01178000
*            CALL IDCDB010 (GDTTBL,'BIJ2');                        0398 01179000
*                                                                  0398 01180000
         L     @15,@PC00001                                        0398 01181000
         ST    @15,@AL00001                                        0398 01182000
         LA    @14,@CC01146                                        0398 01183000
         ST    @14,@AL00001+4                                      0398 01184000
         MVI   @AL00001+4,X'80'                                    0398 01185000
         L     @15,GDTDBG(,@15)                                    0398 01186000
         LA    @01,@AL00001                                        0398 01187000
         BALR  @14,@15                                             0398 01188000
*        /************************************************************/ 01189000
*        /*                                                          */ 01190000
*        /* IF UIOINFO WAS NOT SUCCESSFUL FOR BOTH SORT WORK FILES,  */ 01191000
*        /* ZERO POINTERS TO RETURN AREAS - ISSUE ERROR MESSAGE IF   */ 01192000
*        /* EXTERNALSORT PARAMETER WAS SPECIFIED                     */ 01193000
*        /*                                                          */ 01194000
*        /************************************************************/ 01195000
*                                                                  0399 01196000
*        IF STOPJ = ON                                             0399 01197000
*          THEN                                                    0399 01198000
@RT00396 TM    STOPJ,B'10000000'                                   0399 01199000
         BNO   @RF00399                                            0399 01200000
*            DO;                                                   0400 01201000
*                                                                  0400 01202000
*            JCIOIN = ''B;                                         0401 01203000
*                                                                  0401 01204000
         L     @15,@PC00003                                        0401 01205000
         XC    JCIOIN(8,@15),JCIOIN(@15)                           0401 01206000
*            IF ADDR(ESORT) ^= NULLPTR                             0402 01207000
*              THEN                                                0402 01208000
         L     @15,@PC00001+4                                      0402 01209000
         L     @15,FDTPTR+32(,@15)                                 0402 01210000
         LTR   @15,@15                                             0402 01211000
         BZ    @RF00402                                            0402 01212000
*                DO;                                               0403 01213000
*                                                                  0403 01214000
*                DARGSTID = JCLERROR;                              0404 01215000
         L     @01,DDSTRU                                          0404 01216000
         MVC   DARGSTID(4,@01),@CF00900                            0404 01217000
*                CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);            0405 01218000
*                                                                  0405 01219000
         L     @15,@PC00001                                        0405 01220000
         ST    @15,@AL00001                                        0405 01221000
         LA    @14,@CF00116                                        0405 01222000
         ST    @14,@AL00001+4                                      0405 01223000
         LA    @14,DDSTRU                                          0405 01224000
         ST    @14,@AL00001+8                                      0405 01225000
         MVI   @AL00001+8,X'80'                                    0405 01226000
         L     @15,GDTPRT(,@15)                                    0405 01227000
         LA    @01,@AL00001                                        0405 01228000
         BALR  @14,@15                                             0405 01229000
*                RETURN CODE(LASTCC12);                            0406 01230000
*                                                                  0406 01231000
         LA    @15,12                                              0406 01232000
         L     @14,@SA00003                                        0406 01233000
         LM    @00,@12,@SA00003+8                                  0406 01234000
         BR    @14                                                 0406 01235000
*                END;                                              0407 01236000
*                                                                  0407 01237000
*            END;                                                  0408 01238000
*                                                                  0408 01239000
@RF00402 DS    0H                                                  0409 01240000
*        RETURN CODE(LASTCC00);                                    0409 01241000
@RF00399 SLR   @15,@15                                             0409 01242000
         L     @14,@SA00003                                        0409 01243000
         LM    @00,@12,@SA00003+8                                  0409 01244000
         BR    @14                                                 0409 01245000
*END JCPROC;                                                       0410 01246000
*        /************************************************************/ 01247000
*        /*                                                          */ 01248000
*        /* PROCEDURE NAME - MAINPROC                                */ 01249000
*        /*                                                          */ 01250000
*        /* FUNCTION - PERFORMS THE FUNCTION OF CONTROLLING THE      */ 01251000
*        /*            BUILD PROCESS FOR AN ALTERNATE INDEX.         */ 01252000
*        /*            THIS PROCESS IS ACCOMPLISHED BY CALLING       */ 01253000
*        /*            THIRD LEVEL PROCEDURES AS FOLLOWS -           */ 01254000
*        /*                                                          */ 01255000
*        /*                OPENPROC - OPEN THE AIX                   */ 01256000
*        /*                                                          */ 01257000
*        /*                LOCPROC  - PERFORM VSAM CATALOG LOCATE    */ 01258000
*        /*                           FUNCTIONS TO OBTAIN INFORMA-   */ 01259000
*        /*                           TION REGARDING THE BASE        */ 01260000
*        /*                           CLUSTER AND AIX.               */ 01261000
*        /*                                                          */ 01262000
*        /*                INITPROC - DETERMINE THE RESOURCES        */ 01263000
*        /*                           REQUIRED FOR SORTING,          */ 01264000
*        /*                           INITIALIZE FOR SORTING AND     */ 01265000
*        /*                           OBTAIN RESOURCES               */ 01266000
*        /*                                                          */ 01267000
*        /*                CNTLPROC - READ THE BASE CLUSTER AND      */ 01268000
*        /*                           CONTROL THE SORT-MERGE AND     */ 01269000
*        /*                           BUILDING OF AIX RECORDS        */ 01270000
*        /*                                                          */ 01271000
*        /* INPUT -                                                  */ 01272000
*        /*         MAINI - CURRENT VALUE OF THE VARIABLE CONTROL-   */ 01273000
*        /*                 LING THE MAIN BUILD AIX LOOP IN THE      */ 01274000
*        /*                 HIGHEST LEVEL PROCEDURE                  */ 01275000
*        /*                                                          */ 01276000
*        /*      MAINAMDS - POINTERS TO AMDSB AREAS                  */ 01277000
*        /*                                                          */ 01278000
*        /*      MAINIOCS - AREA CONTAINING THE ADDRESSES OF THE     */ 01279000
*        /*                 IOCSTR FOR EACH OPEN DATA SET            */ 01280000
*        /*                                                          */ 01281000
*        /*      MAINIOIN - AREA CONTAINING THE ADDRESSES OF THE     */ 01282000
*        /*                 DATA OBTAINED FROM THE SORT WORK JOB     */ 01283000
*        /*                 CONTROL                                  */ 01284000
*        /*                                                          */ 01285000
*        /*      MAINSTAT - STATUS COMMUNICATION AREA                */ 01286000
*        /*                                                          */ 01287000
*        /* OUTPUT -                                                 */ 01288000
*        /*                                                          */ 01289000
*        /*      MAINSTAT - STATUS COMMUNICATION AREA CONTAINING     */ 01290000
*        /*                 THE FINAL STATUS OF THE AIX              */ 01291000
*        /*                                                          */ 01292000
*        /* EXIT,NORMAL -   RETURN CODE 0, AIX HAS BEEN SUCCESS-     */ 01293000
*        /*                                FULLY BUILT               */ 01294000
*        /*                                                          */ 01295000
*        /* EXIT,ERROR -                                             */ 01296000
*        /*                 RETURN CODE 4, AIX HAS BEEN BUILT WITH   */ 01297000
*        /*                                NON-TERMINATING ERRORS    */ 01298000
*        /*                                                          */ 01299000
*        /*                 RETURN CODE 8, AIX WAS NOT BUILT         */ 01300000
*        /*                                                          */ 01301000
*        /*                 RETURN CODE 12, TERMINATING BASE         */ 01302000
*        /*                                 CLUSTER ERROR            */ 01303000
*        /*                                                          */ 01304000
*        /************************************************************/ 01305000
*                                                                  0411 01306000
*MAINPROC:                                                         0411 01307000
*        PROCEDURE (MAINI,             /* LOOP CONTROL VARIABLE      */ 01308000
*                   MAINAMDS,          /* POINTERS TO AMDSB AREAS    */ 01309000
*                   MAINIOCS,          /* POINTERS TO IOCSTRS        */ 01310000
*                   MAINIOIN,          /* POINTERS TO JOB CNTRL DATA */ 01311000
*                   MAINSTAT);         /* STATUS COMMUNICATION AREA  */ 01312000
*                                                                  0411 01313000
MAINPROC STM   @14,@12,@SA00004                                    0411 01314000
         MVC   @PC00004(20),0(@01)                                 0411 01315000
*        /************************************************************/ 01316000
*        /*                                                          */ 01317000
*        /* ARGUMENTS OF INVOCATION                                  */ 01318000
*        /*                                                          */ 01319000
*        /************************************************************/ 01320000
*                                                                  0412 01321000
*        DCL MAINI FIXED(31);           /* INDEX VALUE TO CURRENT AIX*/ 01322000
*                                                                  0412 01323000
*        DCL 1 MAINAMDS BDY(WORD),      /* POINTERS TO AMDSBS        */ 01324000
*              2 MAIAMBAS PTR(31),      /* POINTER TO BASE AMDSB     */ 01325000
*              2 MAIAMAIX PTR(31);      /* POINTER TO AIX AMDSB      */ 01326000
*                                                                  0413 01327000
*        DCL 1 MAINIOCS BDY(WORD),      /* POINTERS TO IOCSTR FOR    */ 01328000
*              2 MAIOCSPT(4) PTR(31);   /* EACH OPEN DATA SET        */ 01329000
*                                                                  0414 01330000
*        DCL 1 MAINIOIN BDY(WORD),      /* POINTERS TO RETURN AREAS  */ 01331000
*              2 MAIOINPT(2) PTR(31);   /* CONTAINING SORT WORK FILE */ 01332000
*                                       /* JOB CONTROL DATA          */ 01333000
*        DCL 1 MAINSTAT,                                           0416 01334000
*              2 MASAVERC FIXED(15),    /* CURRENT CONDITION CODE    */ 01335000
*              2 MASTID   CHAR(4);      /* ERROR IDENTIFIERS         */ 01336000
*        /************************************************************/ 01337000
*        /*                                                          */ 01338000
*        /* CALL OPENPROC TO OPEN THE ALTERNATE INDEX.  IF AN        */ 01339000
*        /* ERROR HAS OCCURRED, RETURN WITH A CONDITION CODE 8       */ 01340000
*        /*                                                          */ 01341000
*        /************************************************************/ 01342000
*                                                                  0417 01343000
*        OLDERID2 = NEWERID2;                                      0417 01344000
         L     @15,@PC00001                                        0417 01345000
         L     @15,GDTTR2(,@15)                                    0417 01346000
         MVC   @TS00001(95),NEWERID2(@15)                          0417 01347000
         MVC   OLDERID2(95,@15),@TS00001                           0417 01348000
*        NEWID2 = 'BI02';                                          0418 01349000
*                                                                  0418 01350000
         MVC   NEWID2(4,@15),@CC01166                              0418 01351000
*        CALL OPENPROC ('A',MAIOCSPT(2),MAINI,NULLPTR);            0419 01352000
*                                                                  0419 01353000
         LA    @15,@CC00721                                        0419 01354000
         ST    @15,@AL00001                                        0419 01355000
         L     @15,@PC00004+8                                      0419 01356000
         LA    @15,MAIOCSPT+4(,@15)                                0419 01357000
         ST    @15,@AL00001+4                                      0419 01358000
         L     @15,@PC00004                                        0419 01359000
         ST    @15,@AL00001+8                                      0419 01360000
         LA    @15,@CF00116                                        0419 01361000
         ST    @15,@AL00001+12                                     0419 01362000
         LA    @01,@AL00001                                        0419 01363000
         BAL   @14,OPENPROC                                        0419 01364000
*        RESPECIFY RTNREG RSTD;                                    0420 01365000
*        TESTRC = RTNREG;                                          0421 01366000
         LR    TESTRC,RTNREG                                       0421 01367000
*        RESPECIFY RTNREG UNRSTD;                                  0422 01368000
*                                                                  0422 01369000
*        IF TESTRC ^= 0                                            0423 01370000
*          THEN                                                    0423 01371000
         LTR   TESTRC,TESTRC                                       0423 01372000
         BZ    @RF00423                                            0423 01373000
*            DO;                                                   0424 01374000
*                                                                  0424 01375000
*            MASAVERC = LASTCC08;                                  0425 01376000
         L     @15,@PC00004+16                                     0425 01377000
         MVC   MASAVERC(2,@15),@CH00180                            0425 01378000
*            RETURN;                                               0426 01379000
*                                                                  0426 01380000
@EL00004 DS    0H                                                  0426 01381000
@EF00004 DS    0H                                                  0426 01382000
@ER00004 LM    @14,@12,@SA00004                                    0426 01383000
         BR    @14                                                 0426 01384000
*            END;                                                  0427 01385000
*                                                                  0427 01386000
*        /************************************************************/ 01387000
*        /*                                                          */ 01388000
*        /* CALL LOCPROC TO OBTAIN INFORMATION RE THE BASE CLUSTER   */ 01389000
*        /* AND AIX AND VERIFY THEIR RELATIONSHIP.  IF AN ERROR      */ 01390000
*        /* HAS OCCURRED, PASS THE CONDITION CODE BACK TO THE        */ 01391000
*        /* CALLING PROCEDURE (HIGHEST LEVEL)                        */ 01392000
*        /*                                                          */ 01393000
*        /************************************************************/ 01394000
*                                                                  0428 01395000
*        MAIAMBAS = ADDR(DSBBAREA);                                0428 01396000
@RF00423 L     @15,@PC00004+4                                      0428 01397000
         LA    @14,DSBBAREA                                        0428 01398000
         ST    @14,MAIAMBAS(,@15)                                  0428 01399000
*        MAIAMAIX = ADDR(DSBAAREA);                                0429 01400000
*                                                                  0429 01401000
         LA    @14,DSBAAREA                                        0429 01402000
         ST    @14,MAIAMAIX(,@15)                                  0429 01403000
*        CALL LOCPROC (MAINAMDS,MAINIOCS,MAINI,MAINSTAT);          0430 01404000
*                                                                  0430 01405000
         ST    @15,@AL00001                                        0430 01406000
         L     @15,@PC00004+8                                      0430 01407000
         ST    @15,@AL00001+4                                      0430 01408000
         L     @15,@PC00004                                        0430 01409000
         ST    @15,@AL00001+8                                      0430 01410000
         L     @15,@PC00004+16                                     0430 01411000
         ST    @15,@AL00001+12                                     0430 01412000
         LA    @01,@AL00001                                        0430 01413000
         BAL   @14,LOCPROC                                         0430 01414000
*        RESPECIFY RTNREG RSTD;                                    0431 01415000
*        TESTRC = RTNREG;                                          0432 01416000
         LR    TESTRC,RTNREG                                       0432 01417000
*        RESPECIFY RTNREG UNRSTD;                                  0433 01418000
*                                                                  0433 01419000
*        IF GDTDBG = NULLPTR                                       0434 01420000
*          THEN;                                                   0434 01421000
         L     @02,@PC00001                                        0434 01422000
         L     @02,GDTDBG(,@02)                                    0434 01423000
         LTR   @02,@02                                             0434 01424000
         BZ    @RT00434                                            0434 01425000
*          ELSE                                                    0436 01426000
*            CALL IDCDB010 (GDTTBL,'BI03');                        0436 01427000
*                                                                  0436 01428000
         L     @02,@PC00001                                        0436 01429000
         ST    @02,@AL00001                                        0436 01430000
         LA    @15,@CC01168                                        0436 01431000
         ST    @15,@AL00001+4                                      0436 01432000
         MVI   @AL00001+4,X'80'                                    0436 01433000
         L     @15,GDTDBG(,@02)                                    0436 01434000
         LA    @01,@AL00001                                        0436 01435000
         BALR  @14,@15                                             0436 01436000
*        IF TESTRC ^= 0                                            0437 01437000
*          THEN                                                    0437 01438000
@RT00434 LTR   TESTRC,TESTRC                                       0437 01439000
         BZ    @RF00437                                            0437 01440000
*            DO;                                                   0438 01441000
*                                                                  0438 01442000
*            MASAVERC = TESTRC;                                    0439 01443000
         L     @02,@PC00004+16                                     0439 01444000
         STH   TESTRC,MASAVERC(,@02)                               0439 01445000
*            RETURN;                                               0440 01446000
*                                                                  0440 01447000
         B     @EL00004                                            0440 01448000
*            END;                                                  0441 01449000
*                                                                  0441 01450000
*        /************************************************************/ 01451000
*        /*                                                          */ 01452000
*        /* CALL INITPROC TO OBTAIN RESOURCES FOR BUILDING THIS      */ 01453000
*        /* ALTERNATE INDEX.  RESOURCES CONSIST OF CORE FOR          */ 01454000
*        /* BUFFERS AND WORK AREAS, CORE FOR THE ACTUAL SORT AND     */ 01455000
*        /* DEFINED AND OPENED SORT WORK FILES IF IT IS DETERMINED   */ 01456000
*        /* THAT SUCH ARE REQUIRED.  IF AN ERROR OCCURS, RETURN      */ 01457000
*        /* WITH A CONDITION CODE 8.                                 */ 01458000
*        /*                                                          */ 01459000
*        /************************************************************/ 01460000
*                                                                  0442 01461000
*        CALL INITPROC (MAINAMDS,MAINIOCS,MAINIOIN,                0442 01462000
*                       SRTCTLTB,MAINSTAT);                        0442 01463000
*                                                                  0442 01464000
@RF00437 L     @15,@PC00004+4                                      0442 01465000
         ST    @15,@AL00001                                        0442 01466000
         L     @15,@PC00004+8                                      0442 01467000
         ST    @15,@AL00001+4                                      0442 01468000
         L     @15,@PC00004+12                                     0442 01469000
         ST    @15,@AL00001+8                                      0442 01470000
         LA    @15,SRTCTLTB                                        0442 01471000
         ST    @15,@AL00001+12                                     0442 01472000
         L     @15,@PC00004+16                                     0442 01473000
         ST    @15,@AL00001+16                                     0442 01474000
         LA    @01,@AL00001                                        0442 01475000
         BAL   @14,INITPROC                                        0442 01476000
*        RESPECIFY RTNREG RSTD;                                    0443 01477000
*        TESTRC = RTNREG;                                          0444 01478000
         LR    TESTRC,RTNREG                                       0444 01479000
*        RESPECIFY RTNREG UNRSTD;                                  0445 01480000
*                                                                  0445 01481000
*        IF TESTRC ^= 0                                            0446 01482000
*          THEN                                                    0446 01483000
         LTR   TESTRC,TESTRC                                       0446 01484000
         BZ    @RF00446                                            0446 01485000
*            DO;                                                   0447 01486000
*                                                                  0447 01487000
*            MASAVERC = LASTCC08;                                  0448 01488000
         L     @15,@PC00004+16                                     0448 01489000
         MVC   MASAVERC(2,@15),@CH00180                            0448 01490000
*            RETURN;                                               0449 01491000
*                                                                  0449 01492000
         B     @EL00004                                            0449 01493000
*            END;                                                  0450 01494000
*                                                                  0450 01495000
*        /************************************************************/ 01496000
*        /*                                                          */ 01497000
*        /* CALL CNTLPROC TO PERFORM THE ACTUAL BUILDING OF THE      */ 01498000
*        /* ALTERNATE INDEX.  CNTLPROC READS THE BASE CLUSTER        */ 01499000
*        /* RECORDS AND CALLS LOWER LEVEL PROCEDURES TO CREATE THE   */ 01500000
*        /* SORT RECORDS, PERFORM THE SORT AND BUILD THE ALTERNATE   */ 01501000
*        /* INDEX.  ON RETURN TO MAINPROC, THE FINAL CONDITION       */ 01502000
*        /* CODE FOR THIS ALTERNATE INDEX HAS BEEN PLACED IN THE     */ 01503000
*        /* STATUS COMMUNICATION AREA WHERE IT WILL BE USED IN       */ 01504000
*        /* FINPROC.                                                 */ 01505000
*        /*                                                          */ 01506000
*        /************************************************************/ 01507000
*                                                                  0451 01508000
*        CALL CNTLPROC (MAINAMDS,MAINIOCS,MAINIOIN,                0451 01509000
*                       SRTCTLTB,MAINSTAT);                        0451 01510000
*                                                                  0451 01511000
@RF00446 L     @15,@PC00004+4                                      0451 01512000
         ST    @15,@AL00001                                        0451 01513000
         L     @15,@PC00004+8                                      0451 01514000
         ST    @15,@AL00001+4                                      0451 01515000
         L     @15,@PC00004+12                                     0451 01516000
         ST    @15,@AL00001+8                                      0451 01517000
         LA    @15,SRTCTLTB                                        0451 01518000
         ST    @15,@AL00001+12                                     0451 01519000
         L     @15,@PC00004+16                                     0451 01520000
         ST    @15,@AL00001+16                                     0451 01521000
         LA    @01,@AL00001                                        0451 01522000
         BAL   @14,CNTLPROC                                        0451 01523000
*        IF GDTDBG = NULLPTR                                       0452 01524000
*          THEN;                                                   0452 01525000
         L     @15,@PC00001                                        0452 01526000
         L     @15,GDTDBG(,@15)                                    0452 01527000
         LTR   @15,@15                                             0452 01528000
         BZ    @RT00452                                            0452 01529000
*          ELSE                                                    0454 01530000
*            CALL IDCDB010 (GDTTBL,'BI04');                        0454 01531000
*                                                                  0454 01532000
         L     @15,@PC00001                                        0454 01533000
         ST    @15,@AL00001                                        0454 01534000
         LA    @14,@CC01171                                        0454 01535000
         ST    @14,@AL00001+4                                      0454 01536000
         MVI   @AL00001+4,X'80'                                    0454 01537000
         L     @15,GDTDBG(,@15)                                    0454 01538000
         LA    @01,@AL00001                                        0454 01539000
         BALR  @14,@15                                             0454 01540000
*        /************************************************************/ 01541000
*        /*                                                          */ 01542000
*        /* MAINPROC HAS COMPLETED FOR THIS ALTERNATE INDEX.         */ 01543000
*        /* RETURN TO THE CALLING PROCEDURE (HIGHEST LEVEL).         */ 01544000
*        /*                                                          */ 01545000
*        /************************************************************/ 01546000
*                                                                  0455 01547000
*        RETURN;                                                   0455 01548000
         B     @EL00004                                            0455 01549000
*END MAINPROC;                                                     0456 01550000
         B     @EL00004                                            0456 01551000
*        /************************************************************/ 01552000
*        /*                                                          */ 01553000
*        /* PROCEDURE NAME - FINPROC                                 */ 01554000
*        /*                                                          */ 01555000
*        /* FUNCTION - PERFORMS CLEANUP FOLLOWING THE BUILD OF       */ 01556000
*        /*            ONE ALTERNATE INDEX, CONSISTING OF            */ 01557000
*        /*                                                          */ 01558000
*        /*              . PRINT OUTSTANDING ERROR MESSAGE           */ 01559000
*        /*                                                          */ 01560000
*        /*              . PRINT AIX FINAL STATUS MESSAGE            */ 01561000
*        /*                                                          */ 01562000
*        /*              . CLOSE AIX AND, OPTIONALLY, SORT WORK      */ 01563000
*        /*                FILES                                     */ 01564000
*        /*                                                          */ 01565000
*        /*              . FREE CORE USED FOR BUILDING THE AIX       */ 01566000
*        /*                JUST COMPLETED                            */ 01567000
*        /*                                                          */ 01568000
*        /* INPUT -                                                  */ 01569000
*        /*        FINIOCS - AREA CONTAINING THE ADDRESSES OF THE    */ 01570000
*        /*                  IOCSTR FOR EACH OPEN DATA SET           */ 01571000
*        /*                                                          */ 01572000
*        /*        FINSTAT - STATUS COMMUNICATION AREA CONTAINING    */ 01573000
*        /*                  OUTSTANDING ERROR MESSAGE ID AND CURRENT*/ 01574000
*        /*                  CONDITION CODE                          */ 01575000
*        /* OUTPUT                                                   */ 01576000
*        /*       - ERROR AND AIX STATUS MESSAGES ARE PRINTED        */ 01577000
*        /*                                                          */ 01578000
*        /************************************************************/ 01579000
*                                                                  0457 01580000
*FINPROC:                                                          0457 01581000
*        PROCEDURE (FINIOCS,            /* POINTERS TO IOCSTR FOR    */ 01582000
*                                       /* EACH OPEN DATA SET        */ 01583000
*                   FINSTAT);           /* STATUS COMMUNICATION AREA */ 01584000
*                                                                  0457 01585000
FINPROC  STM   @14,@12,@SA00005                                    0457 01586000
         MVC   @PC00005(8),0(@01)                                  0457 01587000
*        /************************************************************/ 01588000
*        /*                                                          */ 01589000
*        /* ARGUMENTS OF INVOCATION                                  */ 01590000
*        /*                                                          */ 01591000
*        /************************************************************/ 01592000
*                                                                  0458 01593000
*        DCL 1 FINIOCS BDY(WORD),       /* IOCSTR ADDRESSES          */ 01594000
*              2 FIIOCSBS PTR(31),      /* BASE CLUSTER IOCSTR       */ 01595000
*              2 FIIOCSAX PTR(31),      /* AIX IOCSTR                */ 01596000
*              2 FIIOCSSR(2) PTR(31);   /* SORT WORK FILE IOCSTR(2)  */ 01597000
*                                                                  0458 01598000
*        DCL 1 FINSTAT,                 /* STATUS COMMUNICATION AREA */ 01599000
*              2 FISAVERC FIXED(15),    /* CURRENT CONDITION CODE    */ 01600000
*              2 FISTID   CHAR(4);      /* ERROR IDENTIFIERS         */ 01601000
*                                                                  0459 01602000
*        /************************************************************/ 01603000
*        /*                                                          */ 01604000
*        /* LOOP CONTROL VARIABLE                                    */ 01605000
*        /*                                                          */ 01606000
*        /************************************************************/ 01607000
*                                                                  0460 01608000
*        DCL FN    FIXED(31);                                      0460 01609000
*                                                                  0460 01610000
*        /************************************************************/ 01611000
*        /*                                                          */ 01612000
*        /* AREA TO SAVE NAME OF ALTERNATE INDEX FOR MESSAGE         */ 01613000
*        /*                                                          */ 01614000
*        /************************************************************/ 01615000
*                                                                  0461 01616000
*        DCL FINAIXNM CHAR(44);                                    0461 01617000
*                                                                  0461 01618000
*        /************************************************************/ 01619000
*        /*                                                          */ 01620000
*        /* AREA CONTAINING THE ERROR CONVERSION TABLE USED BY       */ 01621000
*        /* UERROR TO PRINT PROSE MESSAGES FOR CATALOG ERROR RETURN  */ 01622000
*        /* CODES.                                                   */ 01623000
*        /*                                                          */ 01624000
*        /************************************************************/ 01625000
*                                                                  0462 01626000
*        DCL ERRTAB CHAR(LENGTH(ERCNVTAB));                        0462 01627000
*                                                                  0462 01628000
*        /************************************************************/ 01629000
*        /*                                                          */ 01630000
*        /* VARIABLES AND CONSTANTS USED IN PRINTING OF ERROR        */ 01631000
*        /* MESSAGES.                                                */ 01632000
*        /*                                                          */ 01633000
*        /************************************************************/ 01634000
*                                                                  0463 01635000
*        DCL NOERROR BIT(32) CONSTANT('00000000'X);                0463 01636000
*        /************************************************************/ 01637000
*        /*                                                          */ 01638000
*        /* IF THE ALTERNATE INDEX IS OPEN, CLOSE IT                 */ 01639000
*        /*                                                          */ 01640000
*        /************************************************************/ 01641000
*                                                                  0464 01642000
*        OLDERID2 = NEWERID2;                                      0464 01643000
         L     @15,@PC00001                                        0464 01644000
         L     @14,GDTTR2(,@15)                                    0464 01645000
         MVC   @TS00001(95),NEWERID2(@14)                          0464 01646000
         MVC   OLDERID2(95,@14),@TS00001                           0464 01647000
*        NEWID2 = 'BIFI';                                          0465 01648000
*                                                                  0465 01649000
         MVC   NEWID2(4,@14),@CC01189                              0465 01650000
*        IF FIIOCSAX ^= NULLPTR                                    0466 01651000
*          THEN                                                    0466 01652000
         L     @14,@PC00005                                        0466 01653000
         L     @07,FIIOCSAX(,@14)                                  0466 01654000
         LTR   @07,@07                                             0466 01655000
         BZ    @RF00466                                            0466 01656000
*            DO;                                                   0467 01657000
*                                                                  0467 01658000
*            FINAIXNM = FIIOCSAX -> IOCDSN -> DSNAME;              0468 01659000
*                                                                  0468 01660000
         L     @02,IOCDSN(,@07)                                    0468 01661000
         MVC   FINAIXNM(44),DSNAME(@02)                            0468 01662000
*            CALL IDCIOCL0 (GDTTBL,FIIOCSAX);                      0469 01663000
*                                                                  0469 01664000
         ST    @15,@AL00001                                        0469 01665000
         LA    @02,FIIOCSAX(,@14)                                  0469 01666000
         ST    @02,@AL00001+4                                      0469 01667000
         MVI   @AL00001+4,X'80'                                    0469 01668000
         L     @15,GDTCLS(,@15)                                    0469 01669000
         LA    @01,@AL00001                                        0469 01670000
         BALR  @14,@15                                             0469 01671000
*            RESPECIFY RTNREG RSTD;                                0470 01672000
*            TESTRC = RTNREG;                                      0471 01673000
         LR    TESTRC,RTNREG                                       0471 01674000
*            RESPECIFY RTNREG UNRSTD;                              0472 01675000
*                                                                  0472 01676000
*            IF TESTRC ^= 0 &                                      0473 01677000
*               FISAVERC < LASTCC08                                0473 01678000
*              THEN                                                0473 01679000
         LTR   TESTRC,TESTRC                                       0473 01680000
         BZ    @RF00473                                            0473 01681000
         L     @02,@PC00005+4                                      0473 01682000
         LH    @15,FISAVERC(,@02)                                  0473 01683000
         C     @15,@CF00180                                        0473 01684000
         BNL   @RF00473                                            0473 01685000
*                FISAVERC = LASTCC04;                              0474 01686000
*                                                                  0474 01687000
         MVC   FISAVERC(2,@02),@CH00043                            0474 01688000
*            FIIOCSAX = NULLPTR;                                   0475 01689000
*                                                                  0475 01690000
@RF00473 L     @15,@PC00005                                        0475 01691000
         SLR   @14,@14                                             0475 01692000
         ST    @14,FIIOCSAX(,@15)                                  0475 01693000
*            END;                                                  0476 01694000
*                                                                  0476 01695000
*        /************************************************************/ 01696000
*        /*                                                          */ 01697000
*        /* IF SORT WORK FILES ARE OPEN, CLOSE THEM                  */ 01698000
*        /*                                                          */ 01699000
*        /************************************************************/ 01700000
*                                                                  0477 01701000
*        DO FN = 1 TO 2;                                           0477 01702000
*                                                                  0477 01703000
@RF00466 LA    FN,1                                                0477 01704000
@DL00477 DS    0H                                                  0478 01705000
*          IF FIIOCSSR(FN) ^= NULLPTR                              0478 01706000
*            THEN                                                  0478 01707000
         LR    @03,FN                                              0478 01708000
         SLA   @03,2                                               0478 01709000
         L     @15,@PC00005                                        0478 01710000
         L     @14,FIIOCSSR-4(@03,@15)                             0478 01711000
         LTR   @14,@14                                             0478 01712000
         BZ    @RF00478                                            0478 01713000
*              DO;                                                 0479 01714000
*                                                                  0479 01715000
         ST    @03,@TF00001                                        0479 01716000
*              CALL IDCIOCL0 (GDTTBL,FIIOCSSR(FN));                0480 01717000
*                                                                  0480 01718000
         L     @14,@PC00001                                        0480 01719000
         ST    @14,@AL00001                                        0480 01720000
         L     @01,@TF00001                                        0480 01721000
         LA    @15,FIIOCSSR-4(@01,@15)                             0480 01722000
         ST    @15,@AL00001+4                                      0480 01723000
         MVI   @AL00001+4,X'80'                                    0480 01724000
         L     @15,GDTCLS(,@14)                                    0480 01725000
         LA    @01,@AL00001                                        0480 01726000
         BALR  @14,@15                                             0480 01727000
*              RESPECIFY RTNREG RSTD;                              0481 01728000
*              TESTRC = RTNREG;                                    0482 01729000
         LR    TESTRC,RTNREG                                       0482 01730000
*              RESPECIFY RTNREG UNRSTD;                            0483 01731000
*                                                                  0483 01732000
*              IF TESTRC ^= 0 &                                    0484 01733000
*                 FISAVERC < LASTCC08                              0484 01734000
*                THEN                                              0484 01735000
         LTR   TESTRC,TESTRC                                       0484 01736000
         BZ    @RF00484                                            0484 01737000
         L     @15,@PC00005+4                                      0484 01738000
         LH    @14,FISAVERC(,@15)                                  0484 01739000
         C     @14,@CF00180                                        0484 01740000
         BNL   @RF00484                                            0484 01741000
*                  FISAVERC = LASTCC04;                            0485 01742000
*                                                                  0485 01743000
         MVC   FISAVERC(2,@15),@CH00043                            0485 01744000
*              FIIOCSSR(FN) = NULLPTR;                             0486 01745000
*                                                                  0486 01746000
@RF00484 LR    @03,FN                                              0486 01747000
         SLA   @03,2                                               0486 01748000
         L     @15,@PC00005                                        0486 01749000
         SLR   @14,@14                                             0486 01750000
         ST    @14,FIIOCSSR-4(@03,@15)                             0486 01751000
*              END;                                                0487 01752000
*                                                                  0487 01753000
*        END;                                                      0488 01754000
*                                                                  0488 01755000
@RF00478 AL    FN,@CF00220                                         0488 01756000
         C     FN,@CF00154                                         0488 01757000
         BNH   @DL00477                                            0488 01758000
*        /************************************************************/ 01759000
*        /*                                                          */ 01760000
*        /* THE STATUS COMMUNICATION AREA CONTAINS A MESSAGE ID  IF  */ 01761000
*        /* AN ERROR MESSAGE IS TO BE PRINTED.                       */ 01762000
*        /*                                                          */ 01763000
*        /************************************************************/ 01764000
*                                                                  0489 01765000
*        IF FISTID ^= NOERROR                                      0489 01766000
*          THEN                                                    0489 01767000
         L     @15,@PC00005+4                                      0489 01768000
         CLC   FISTID(4,@15),@CB01188                              0489 01769000
         BE    @RF00489                                            0489 01770000
*            DO;                                                   0490 01771000
*                                                                  0490 01772000
*            DARGAREA = ''B;                                       0491 01773000
*                                                                  0491 01774000
         XC    DARGAREA(44),DARGAREA                               0491 01775000
*            /********************************************************/ 01776000
*            /*                                                      */ 01777000
*            /* SET UP THE DATA SET NAME IF REQUIRED FOR THE         */ 01778000
*            /* MESSAGE.                                             */ 01779000
*            /*                                                      */ 01780000
*            /********************************************************/ 01781000
*                                                                  0492 01782000
*            IF FISTID = INVALAIX |                                0492 01783000
*               FISTID = NOTRELAT |                                0492 01784000
*               FISTID = INVALBAS |                                0492 01785000
*               FISTID = LOCRTNER                                  0492 01786000
*              THEN                                                0492 01787000
         CLC   FISTID(4,@15),@CB00884                              0492 01788000
         BE    @RT00492                                            0492 01789000
         CLC   FISTID(4,@15),@CB00888                              0492 01790000
         BE    @RT00492                                            0492 01791000
         CLC   FISTID(4,@15),@CB00886                              0492 01792000
         BE    @RT00492                                            0492 01793000
         CLC   FISTID(4,@15),@CB00914                              0492 01794000
         BNE   @RF00492                                            0492 01795000
@RT00492 DS    0H                                                  0493 01796000
*                DO;                                               0493 01797000
*                                                                  0493 01798000
*                DARGILP = LENGTH(DSNAME);                         0494 01799000
*                                                                  0494 01800000
         L     @15,DDSTRU                                          0494 01801000
         MVC   DARGILP(2,@15),@CH00596                             0494 01802000
*                IF FISAVERC = LASTCC12                            0495 01803000
*                  THEN                                            0495 01804000
         L     @14,@PC00005+4                                      0495 01805000
         CLC   FISAVERC(2,@14),@CH00035                            0495 01806000
         BNE   @RF00495                                            0495 01807000
*                    DARGDBP = FIIOCSBS -> IOCDSN;                 0496 01808000
*                                                                  0496 01809000
         L     @14,@PC00005                                        0496 01810000
         L     @01,FIIOCSBS(,@14)                                  0496 01811000
         L     @14,IOCDSN(,@01)                                    0496 01812000
         ST    @14,DARGDBP(,@15)                                   0496 01813000
*                  ELSE                                            0497 01814000
*                    DARGDBP = ADDR(FINAIXNM);                     0497 01815000
*                                                                  0497 01816000
         B     @RC00495                                            0497 01817000
@RF00495 LA    @15,FINAIXNM                                        0497 01818000
         L     @14,DDSTRU                                          0497 01819000
         ST    @15,DARGDBP(,@14)                                   0497 01820000
*                END;                                              0498 01821000
*                                                                  0498 01822000
@RC00495 DS    0H                                                  0499 01823000
*            /********************************************************/ 01824000
*            /*                                                      */ 01825000
*            /* FOR CATALOG ERRORS FROM LOCATE OR DEFINE SET UP      */ 01826000
*            /* THE ERROR CONVERSION TABLE AND CALL UERROR TO PRINT  */ 01827000
*            /* THE PROSE ERROR MESSAGE.                             */ 01828000
*            /*                                                      */ 01829000
*            /********************************************************/ 01830000
*                                                                  0499 01831000
*            IF FISTID = LOCATERR |                                0499 01832000
*               FISTID = DEFERROR                                  0499 01833000
*              THEN                                                0499 01834000
@RF00492 L     @15,@PC00005+4                                      0499 01835000
         CLC   FISTID(4,@15),@CB00920                              0499 01836000
         BE    @RT00499                                            0499 01837000
         CLC   FISTID(4,@15),@CB00906                              0499 01838000
         BNE   @RF00499                                            0499 01839000
@RT00499 DS    0H                                                  0500 01840000
*                DO;                                               0500 01841000
*                                                                  0500 01842000
*                ERCNVADR = ADDR(ERRTAB);                          0501 01843000
         LA    @15,ERRTAB                                          0501 01844000
         ST    @15,ERCNVADR                                        0501 01845000
*                ERCNVTAB = ''B;                                   0502 01846000
         XC    ERCNVTAB(32,@15),ERCNVTAB(@15)                      0502 01847000
*                ERCATLG  = ON;                                    0503 01848000
         OI    ERCATLG(@15),B'10000000'                            0503 01849000
*                ERCATRC  = CATRETCC;                              0504 01850000
         LH    @14,CATRETCC                                        0504 01851000
         ST    @14,ERCATRC(,@15)                                   0504 01852000
*                ERCPLPT  = CTGPLPTR;                              0505 01853000
*                                                                  0505 01854000
         L     @14,CTGPLPTR                                        0505 01855000
         ST    @14,ERCPLPT(,@15)                                   0505 01856000
*                IF FISTID = LOCATERR                              0506 01857000
*                  THEN                                            0506 01858000
         L     @14,@PC00005+4                                      0506 01859000
         CLC   FISTID(4,@14),@CB00920                              0506 01860000
         BNE   @RF00506                                            0506 01861000
*                    ERCATLC = ON;                                 0507 01862000
*                                                                  0507 01863000
         OI    ERCATLC(@15),B'10000000'                            0507 01864000
*                  ELSE                                            0508 01865000
*                    ERCATDE = ON;                                 0508 01866000
*                                                                  0508 01867000
         B     @RC00506                                            0508 01868000
@RF00506 L     @01,ERCNVADR                                        0508 01869000
         OI    ERCATDE(@01),B'01000000'                            0508 01870000
*                CALL IDCTPER0 (GDTTBL,ERCNVADR);                  0509 01871000
*                                                                  0509 01872000
@RC00506 L     @15,@PC00001                                        0509 01873000
         ST    @15,@AL00001                                        0509 01874000
         LA    @14,ERCNVADR                                        0509 01875000
         ST    @14,@AL00001+4                                      0509 01876000
         MVI   @AL00001+4,X'80'                                    0509 01877000
         L     @15,GDTERR(,@15)                                    0509 01878000
         LA    @01,@AL00001                                        0509 01879000
         BALR  @14,@15                                             0509 01880000
*                END;                                              0510 01881000
*                                                                  0510 01882000
*              /******************************************************/ 01883000
*              /*                                                    */ 01884000
*              /* FOR ALL OTHER MESSAGES ISSUE UPRINT                */ 01885000
*              /*                                                    */ 01886000
*              /******************************************************/ 01887000
*                                                                  0511 01888000
*              ELSE                                                0511 01889000
*                DO;                                               0511 01890000
*                                                                  0511 01891000
         B     @RC00499                                            0511 01892000
@RF00499 DS    0H                                                  0512 01893000
*                DARGSTID = FISTID;                                0512 01894000
*                                                                  0512 01895000
         L     @15,@PC00005+4                                      0512 01896000
         L     @01,DDSTRU                                          0512 01897000
         MVC   DARGSTID(4,@01),FISTID(@15)                         0512 01898000
*                CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);            0513 01899000
*                                                                  0513 01900000
         L     @15,@PC00001                                        0513 01901000
         ST    @15,@AL00001                                        0513 01902000
         LA    @14,@CF00116                                        0513 01903000
         ST    @14,@AL00001+4                                      0513 01904000
         LA    @14,DDSTRU                                          0513 01905000
         ST    @14,@AL00001+8                                      0513 01906000
         MVI   @AL00001+8,X'80'                                    0513 01907000
         L     @15,GDTPRT(,@15)                                    0513 01908000
         LA    @01,@AL00001                                        0513 01909000
         BALR  @14,@15                                             0513 01910000
*                END;                                              0514 01911000
*                                                                  0514 01912000
*            /********************************************************/ 01913000
*            /*                                                      */ 01914000
*            /* PRINT SECONDARY MESSAGES                             */ 01915000
*            /*                                                      */ 01916000
*            /********************************************************/ 01917000
*                                                                  0515 01918000
*            DARGAREA = ''B;                                       0515 01919000
*                                                                  0515 01920000
@RC00499 XC    DARGAREA(44),DARGAREA                               0515 01921000
*            IF FISTID = SORTSTRT |                                0516 01922000
*               FISTID = SORTCONT                                  0516 01923000
*              THEN                                                0516 01924000
         L     @15,@PC00005+4                                      0516 01925000
         CLC   FISTID(4,@15),@CB00902                              0516 01926000
         BE    @RT00516                                            0516 01927000
         CLC   FISTID(4,@15),@CB00904                              0516 01928000
         BNE   @RF00516                                            0516 01929000
@RT00516 DS    0H                                                  0517 01930000
*                DARGSTID = JCLERROR;                              0517 01931000
*                                                                  0517 01932000
         L     @01,DDSTRU                                          0517 01933000
         MVC   DARGSTID(4,@01),@CF00900                            0517 01934000
*              ELSE                                                0518 01935000
*                IF FISTID = DEFERROR                              0518 01936000
*                  THEN                                            0518 01937000
         B     @RC00516                                            0518 01938000
@RF00516 L     @15,@PC00005+4                                      0518 01939000
         CLC   FISTID(4,@15),@CB00906                              0518 01940000
         BNE   @RF00518                                            0518 01941000
*                    DARGSTID = DEFERROR;                          0519 01942000
*                                                                  0519 01943000
         L     @01,DDSTRU                                          0519 01944000
         MVC   DARGSTID(4,@01),@CF00906                            0519 01945000
*                  ELSE                                            0520 01946000
*                    IF FISTID = LOCATERR                          0520 01947000
*                      THEN                                        0520 01948000
         B     @RC00518                                            0520 01949000
@RF00518 L     @15,@PC00005+4                                      0520 01950000
         CLC   FISTID(4,@15),@CB00920                              0520 01951000
         BNE   @RF00520                                            0520 01952000
*                        DO;                                       0521 01953000
*                                                                  0521 01954000
*                        DARGSTID = LOCATERR;                      0522 01955000
         L     @14,DDSTRU                                          0522 01956000
         MVC   DARGSTID(4,@14),@CF00920                            0522 01957000
*                        DARGILP  = LENGTH(DSNAME);                0523 01958000
*                                                                  0523 01959000
         MVC   DARGILP(2,@14),@CH00596                             0523 01960000
*                        IF FISAVERC = LASTCC12                    0524 01961000
*                          THEN                                    0524 01962000
         CLC   FISAVERC(2,@15),@CH00035                            0524 01963000
         BNE   @RF00524                                            0524 01964000
*                            DARGDBP = FIIOCSBS -> IOCDSN;         0525 01965000
*                                                                  0525 01966000
         L     @15,@PC00005                                        0525 01967000
         L     @01,FIIOCSBS(,@15)                                  0525 01968000
         L     @15,IOCDSN(,@01)                                    0525 01969000
         ST    @15,DARGDBP(,@14)                                   0525 01970000
*                          ELSE                                    0526 01971000
*                            DARGDBP = ADDR(FINAIXNM);             0526 01972000
*                                                                  0526 01973000
         B     @RC00524                                            0526 01974000
@RF00524 LA    @15,FINAIXNM                                        0526 01975000
         L     @14,DDSTRU                                          0526 01976000
         ST    @15,DARGDBP(,@14)                                   0526 01977000
*                        END;                                      0527 01978000
*                                                                  0527 01979000
*                      ELSE;                                       0528 01980000
*                                                                  0528 01981000
@RF00520 DS    0H                                                  0529 01982000
*            IF DARGSTID ^= NOERROR                                0529 01983000
*              THEN                                                0529 01984000
@RC00520 DS    0H                                                  0529 01985000
@RC00518 DS    0H                                                  0529 01986000
@RC00516 L     @01,DDSTRU                                          0529 01987000
         L     @15,DARGSTID(,@01)                                  0529 01988000
         LTR   @15,@15                                             0529 01989000
         BZ    @RF00529                                            0529 01990000
*                CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);            0530 01991000
*                                                                  0530 01992000
         L     @15,@PC00001                                        0530 01993000
         ST    @15,@AL00001                                        0530 01994000
         LA    @14,@CF00116                                        0530 01995000
         ST    @14,@AL00001+4                                      0530 01996000
         LA    @14,DDSTRU                                          0530 01997000
         ST    @14,@AL00001+8                                      0530 01998000
         MVI   @AL00001+8,X'80'                                    0530 01999000
         L     @15,GDTPRT(,@15)                                    0530 02000000
         LA    @01,@AL00001                                        0530 02001000
         BALR  @14,@15                                             0530 02002000
*            END;                                                  0531 02003000
*                                                                  0531 02004000
@RF00529 DS    0H                                                  0532 02005000
*        /************************************************************/ 02006000
*        /*                                                          */ 02007000
*        /* IF THE CURRENT CONDITION CODE IS LESS THAN 12, AN        */ 02008000
*        /* ALTERNATE INDEX FINAL STATUS MESSAGE IS TO BE PRINTED.   */ 02009000
*        /* THE MESSAGE VARIES ACCORDING TO THE VALUE OF THE         */ 02010000
*        /* CURRENT CONDITION CODE AS FOLLOWS:                       */ 02011000
*        /*                                                          */ 02012000
*        /*    0 - ALTERNATE INDEX SUCCESSFULLY BUILT                */ 02013000
*        /*                                                          */ 02014000
*        /*    4 - ALTERNATE INDEX BUILT BUT SOME NON-TERMINATING    */ 02015000
*        /*        ERROR OR ERRORS WERE ENCOUNTERED                  */ 02016000
*        /*                                                          */ 02017000
*        /*    8 - ALTERNATE INDEX WAS NOT BUILT DUE TO A TERMINA-   */ 02018000
*        /*        TING ERROR                                        */ 02019000
*        /*                                                          */ 02020000
*        /************************************************************/ 02021000
*                                                                  0532 02022000
*        IF FISAVERC < LASTCC12                                    0532 02023000
*          THEN                                                    0532 02024000
@RF00489 L     @15,@PC00005+4                                      0532 02025000
         LH    @15,FISAVERC(,@15)                                  0532 02026000
         C     @15,@CF00035                                        0532 02027000
         BNL   @RF00532                                            0532 02028000
*            DO;                                                   0533 02029000
*                                                                  0533 02030000
*            DARGAREA = ''B;                                       0534 02031000
         XC    DARGAREA(44),DARGAREA                               0534 02032000
*            DARGDBP = ADDR(FINAIXNM);                             0535 02033000
         L     @14,DDSTRU                                          0535 02034000
         LA    @07,FINAIXNM                                        0535 02035000
         ST    @07,DARGDBP(,@14)                                   0535 02036000
*            DARGILP = LENGTH(DSNAME);                             0536 02037000
*                                                                  0536 02038000
         MVC   DARGILP(2,@14),@CH00596                             0536 02039000
*            IF FISAVERC = LASTCC00                                0537 02040000
*              THEN                                                0537 02041000
         LTR   @15,@15                                             0537 02042000
         BNZ   @RF00537                                            0537 02043000
*                DARGSTID = BUILDOK;                               0538 02044000
*                                                                  0538 02045000
         MVC   DARGSTID(4,@14),@CF00908                            0538 02046000
*              ELSE                                                0539 02047000
*                IF FISAVERC = LASTCC04                            0539 02048000
*                  THEN                                            0539 02049000
         B     @RC00537                                            0539 02050000
@RF00537 L     @15,@PC00005+4                                      0539 02051000
         CLC   FISAVERC(2,@15),@CH00043                            0539 02052000
         BNE   @RF00539                                            0539 02053000
*                    DARGSTID = BUILDERR;                          0540 02054000
*                                                                  0540 02055000
         L     @01,DDSTRU                                          0540 02056000
         MVC   DARGSTID(4,@01),@CF00910                            0540 02057000
*                  ELSE                                            0541 02058000
*                    DARGSTID = BUILDNOK;                          0541 02059000
*                                                                  0541 02060000
         B     @RC00539                                            0541 02061000
@RF00539 L     @01,DDSTRU                                          0541 02062000
         MVC   DARGSTID(4,@01),@CF00912                            0541 02063000
*            CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);                0542 02064000
*                                                                  0542 02065000
@RC00539 DS    0H                                                  0542 02066000
@RC00537 L     @15,@PC00001                                        0542 02067000
         ST    @15,@AL00001                                        0542 02068000
         LA    @14,@CF00116                                        0542 02069000
         ST    @14,@AL00001+4                                      0542 02070000
         LA    @14,DDSTRU                                          0542 02071000
         ST    @14,@AL00001+8                                      0542 02072000
         MVI   @AL00001+8,X'80'                                    0542 02073000
         L     @15,GDTPRT(,@15)                                    0542 02074000
         LA    @01,@AL00001                                        0542 02075000
         BALR  @14,@15                                             0542 02076000
*            END;                                                  0543 02077000
*                                                                  0543 02078000
*        /************************************************************/ 02079000
*        /*                                                          */ 02080000
*        /* FREE MAIN STORAGE OBTAINED FOR THIS ALTERNATE INDEX      */ 02081000
*        /* BUILD.                                                   */ 02082000
*        /*                                                          */ 02083000
*        /************************************************************/ 02084000
*                                                                  0544 02085000
*        CALL IDCSAFP0 (GDTTBL,UGPIDPG);                           0544 02086000
*                                                                  0544 02087000
@RF00532 L     @15,@PC00001                                        0544 02088000
         ST    @15,@AL00001                                        0544 02089000
         LA    @14,UGPIDPG                                         0544 02090000
         ST    @14,@AL00001+4                                      0544 02091000
         MVI   @AL00001+4,X'80'                                    0544 02092000
         L     @15,GDTFPL(,@15)                                    0544 02093000
         LA    @01,@AL00001                                        0544 02094000
         BALR  @14,@15                                             0544 02095000
*        /************************************************************/ 02096000
*        /*                                                          */ 02097000
*        /* RETURN TO CALLING PROCEDURE - HIGHEST LEVEL              */ 02098000
*        /*                                                          */ 02099000
*        /************************************************************/ 02100000
*                                                                  0545 02101000
*        RETURN;                                                   0545 02102000
*                                                                  0545 02103000
@EL00005 DS    0H                                                  0545 02104000
@EF00005 DS    0H                                                  0545 02105000
@ER00005 LM    @14,@12,@SA00005                                    0545 02106000
         BR    @14                                                 0545 02107000
*END FINPROC;                                                      0546 02108000
*        /************************************************************/ 02109000
*        /*                                                          */ 02110000
*        /* PROCEDURE NAME - TERMPROC                                */ 02111000
*        /*                                                          */ 02112000
*        /* FUNCTION - PERFORMS FINAL BLDINDEX CLEANUP, CONSISTING   */ 02113000
*        /*            OF                                            */ 02114000
*        /*              . CLOSE BASE CLUSTER                        */ 02115000
*        /*                                                          */ 02116000
*        /*              . IF SORT WORK FILES ARE DEFINED, CALL      */ 02117000
*        /*                DELTPROC TO DELETE THEM                   */ 02118000
*        /*                                                          */ 02119000
*        /*              . FREE ALL REMAINING MAIN STORAGE           */ 02120000
*        /*                                                          */ 02121000
*        /*              . PRINT FINAL TERMINATION MESSAGE           */ 02122000
*        /*                                                          */ 02123000
*        /* INPUT -                                                  */ 02124000
*        /*         TERMIOCS - AREA CONTAINING THE ADDRESS OF EACH   */ 02125000
*        /*                    OPEN DATA SET                         */ 02126000
*        /*                                                          */ 02127000
*        /*         TERMIOIN - AREA CONTAINING THE ADDRESS OF THE    */ 02128000
*        /*                    DATA OBTAINED FROM THE SORT WORK      */ 02129000
*        /*                    JOB CONTROL                           */ 02130000
*        /*                                                          */ 02131000
*        /*         TERSRTTB - SORT CONTROL TABLE                    */ 02132000
*        /*                                                          */ 02133000
*        /* OUTPUT -                                                 */ 02134000
*        /*         LASTCC - SET TO FINAL CONDITION CODE             */ 02135000
*        /*         FINAL TERMINATION MESSAGE IS PRINTED             */ 02136000
*        /*                                                          */ 02137000
*        /************************************************************/ 02138000
*                                                                  0547 02139000
*TERMPROC:                                                         0547 02140000
*        PROCEDURE (TERMIOCS,           /* IOCSTR POINTERS           */ 02141000
*                   TERMIOIN,           /* SORT JOB CONTROL POINTERS */ 02142000
*                   TERSRTTB);          /* SORT CONTROL TABLE        */ 02143000
*                                                                  0547 02144000
TERMPROC STM   @14,@12,@SA00006                                    0547 02145000
         MVC   @PC00006(12),0(@01)                                 0547 02146000
*        /************************************************************/ 02147000
*        /*                                                          */ 02148000
*        /* ARGUMENTS OF INVOCATION                                  */ 02149000
*        /*                                                          */ 02150000
*        /************************************************************/ 02151000
*                                                                  0548 02152000
*        DCL 1 TERMIOCS BDY(WORD),      /* POINTERS TO IOCSTR FOR    */ 02153000
*              2 TEIOCSPT(4) PTR(31);   /* EACH OPEN DATA SET        */ 02154000
*                                                                  0548 02155000
*        DCL 1 TERMIOIN BDY(WORD),      /* POINTERS TO RETURN AREAS  */ 02156000
*              2 TEIOINPT(2) PTR(31);   /* CONTAINING SORT WORK FILE */ 02157000
*                                       /* JOB CONTROL DATA          */ 02158000
*                                                                  0550 02159000
*        DCL TERSRTTB;                  /* SORT CONTROL TABLE        */ 02160000
*        /************************************************************/ 02161000
*        /*                                                          */ 02162000
*        /* IF THE BASE CLUSTER IS OPEN, CLOSE IT                    */ 02163000
*        /*                                                          */ 02164000
*        /************************************************************/ 02165000
*                                                                  0551 02166000
*        IF TEIOCSPT(1) ^= NULLPTR                                 0551 02167000
*          THEN                                                    0551 02168000
         L     @04,@PC00006                                        0551 02169000
         L     @15,TEIOCSPT(,@04)                                  0551 02170000
         LTR   @15,@15                                             0551 02171000
         BZ    @RF00551                                            0551 02172000
*            DO;                                                   0552 02173000
*                                                                  0552 02174000
*            CALL IDCIOCL0 (GDTTBL, TEIOCSPT(1));                  0553 02175000
*                                                                  0553 02176000
         L     @02,@PC00001                                        0553 02177000
         ST    @02,@AL00001                                        0553 02178000
         ST    @04,@AL00001+4                                      0553 02179000
         MVI   @AL00001+4,X'80'                                    0553 02180000
         L     @15,GDTCLS(,@02)                                    0553 02181000
         LA    @01,@AL00001                                        0553 02182000
         BALR  @14,@15                                             0553 02183000
*            RESPECIFY RTNREG RSTD;                                0554 02184000
*            TESTRC = RTNREG;                                      0555 02185000
         LR    TESTRC,RTNREG                                       0555 02186000
*            RESPECIFY RTNREG UNRSTD;                              0556 02187000
*                                                                  0556 02188000
*            IF TESTRC ^= 0 &                                      0557 02189000
*               SETRC < LASTCC08                                   0557 02190000
*              THEN                                                0557 02191000
         LTR   TESTRC,TESTRC                                       0557 02192000
         BZ    @RF00557                                            0557 02193000
         C     SETRC,@CF00180                                      0557 02194000
         BNL   @RF00557                                            0557 02195000
*                SETRC = LASTCC04;                                 0558 02196000
*                                                                  0558 02197000
         LA    SETRC,4                                             0558 02198000
*            END;                                                  0559 02199000
*                                                                  0559 02200000
@RF00557 DS    0H                                                  0560 02201000
*        /************************************************************/ 02202000
*        /*                                                          */ 02203000
*        /* IF SORT WORK FILES EXIST, CALL DELTPROC TO DELETE THEM   */ 02204000
*        /*                                                          */ 02205000
*        /************************************************************/ 02206000
*                                                                  0560 02207000
*        IF SRTFLDEF = ON                                          0560 02208000
*          THEN                                                    0560 02209000
@RF00551 TM    SRTFLDEF,B'10000000'                                0560 02210000
         BNO   @RF00560                                            0560 02211000
*            CALL DELTPROC (TERMIOIN);                             0561 02212000
*                                                                  0561 02213000
         L     @04,@PC00006+4                                      0561 02214000
         ST    @04,@AL00001                                        0561 02215000
         LA    @01,@AL00001                                        0561 02216000
         BAL   @14,DELTPROC                                        0561 02217000
*        /************************************************************/ 02218000
*        /*                                                          */ 02219000
*        /* CALL UFPOOL TO FREE ALL REMAINING MAIN STORAGE           */ 02220000
*        /* OBTAINED VIA UGPOOL                                      */ 02221000
*        /*                                                          */ 02222000
*        /************************************************************/ 02223000
*                                                                  0562 02224000
*        CALL IDCSAFP0 (GDTTBL,UGPID01,ALL);                       0562 02225000
*                                                                  0562 02226000
@RF00560 MVC   @AL00001+4(8),@AL00562                              0562 02227000
         L     @04,@PC00001                                        0562 02228000
         ST    @04,@AL00001                                        0562 02229000
         L     @15,GDTFPL(,@04)                                    0562 02230000
         LA    @01,@AL00001                                        0562 02231000
         BALR  @14,@15                                             0562 02232000
*        /************************************************************/ 02233000
*        /*                                                          */ 02234000
*        /* PRINT FINAL TERMINATION MESSAGE BASED ON FINAL SETTING   */ 02235000
*        /* OF LASTCC.  THE MESSAGE PRINTED DIFFERS BETWEEN A BATCH  */ 02236000
*        /* ENVIRONMENT AND A TSO ENVIRONMENT.                       */ 02237000
*        /*                                                          */ 02238000
*        /************************************************************/ 02239000
*                                                                  0563 02240000
*        LASTCC = SETRC;                                           0563 02241000
*                                                                  0563 02242000
         L     @04,@PC00001+8                                      0563 02243000
         STH   SETRC,LASTCC(,@04)                                  0563 02244000
*        DARGAREA = ''B;                                           0564 02245000
         XC    DARGAREA(44),DARGAREA                               0564 02246000
*        DARGDBP  = ADDR(LASTCC);                                  0565 02247000
         L     @05,DDSTRU                                          0565 02248000
         ST    @04,DARGDBP(,@05)                                   0565 02249000
*        DARGILP  = LENGTH(LASTCC);                                0566 02250000
*                                                                  0566 02251000
         MVC   DARGILP(2,@05),@CH00154                             0566 02252000
*        IF GDTECT = NULLPTR                                       0567 02253000
*          THEN                                                    0567 02254000
         L     @04,@PC00001                                        0567 02255000
         L     @04,GDTECT(,@04)                                    0567 02256000
         LTR   @04,@04                                             0567 02257000
         BNZ   @RF00567                                            0567 02258000
*            IF LASTCC < LASTCC12                                  0568 02259000
*              THEN                                                0568 02260000
         L     @04,@PC00001+8                                      0568 02261000
         LH    @04,LASTCC(,@04)                                    0568 02262000
         C     @04,@CF00035                                        0568 02263000
         BNL   @RF00568                                            0568 02264000
*                DARGSTID = FUNCCOMP;                              0569 02265000
         MVC   DARGSTID(4,@05),@CF00878                            0569 02266000
*              ELSE                                                0570 02267000
*                DARGSTID = FUNCTERM;                              0570 02268000
*                                                                  0570 02269000
         B     @RC00568                                            0570 02270000
@RF00568 L     @01,DDSTRU                                          0570 02271000
         MVC   DARGSTID(4,@01),@CF00880                            0570 02272000
*          ELSE                                                    0571 02273000
*            IF LASTCC = LASTCC00                                  0571 02274000
*              THEN                                                0571 02275000
         B     @RC00567                                            0571 02276000
@RF00567 L     @15,@PC00001+8                                      0571 02277000
         LH    @15,LASTCC(,@15)                                    0571 02278000
         LTR   @15,@15                                             0571 02279000
         BNZ   @RF00571                                            0571 02280000
*                DARGSTID = FUNCCOMP;                              0572 02281000
         L     @01,DDSTRU                                          0572 02282000
         MVC   DARGSTID(4,@01),@CF00878                            0572 02283000
*              ELSE                                                0573 02284000
*                DARGSTID = FUNCTSO;                               0573 02285000
*                                                                  0573 02286000
         B     @RC00571                                            0573 02287000
@RF00571 L     @01,DDSTRU                                          0573 02288000
         MVC   DARGSTID(4,@01),@CF00882                            0573 02289000
*        CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);                    0574 02290000
*                                                                  0574 02291000
@RC00571 DS    0H                                                  0574 02292000
@RC00567 L     @15,@PC00001                                        0574 02293000
         ST    @15,@AL00001                                        0574 02294000
         LA    @14,@CF00116                                        0574 02295000
         ST    @14,@AL00001+4                                      0574 02296000
         LA    @14,DDSTRU                                          0574 02297000
         ST    @14,@AL00001+8                                      0574 02298000
         MVI   @AL00001+8,X'80'                                    0574 02299000
         L     @15,GDTPRT(,@15)                                    0574 02300000
         LA    @01,@AL00001                                        0574 02301000
         BALR  @14,@15                                             0574 02302000
*        /************************************************************/ 02303000
*        /*                                                          */ 02304000
*        /* RETURN TO CALLING PROCEDURE - HIGHEST LEVEL              */ 02305000
*        /*                                                          */ 02306000
*        /************************************************************/ 02307000
*                                                                  0575 02308000
*        RETURN;                                                   0575 02309000
*                                                                  0575 02310000
@EL00006 DS    0H                                                  0575 02311000
@EF00006 DS    0H                                                  0575 02312000
@ER00006 LM    @14,@12,@SA00006                                    0575 02313000
         BR    @14                                                 0575 02314000
*END TERMPROC;                                                     0576 02315000
*        /************************************************************/ 02316000
*        /*                                                          */ 02317000
*        /* PROCEDURE NAME - LOCPROC                                 */ 02318000
*        /*                                                          */ 02319000
*        /* FUNCTION - PERFORMS THE FUNCTION OF OBTAINING REQUIRED   */ 02320000
*        /*            INFORMATION FROM THE VSAM CATALOG REGARDING   */ 02321000
*        /*            THE BASE CLUSTER AND ALTERNATE INDEX,         */ 02322000
*        /*            SPECIFICALLY THE AMDSB CONTROL BLOCK.  THIS   */ 02323000
*        /*            PROCEDURE ALSO VERIFIES THAT THE ALTERNATE    */ 02324000
*        /*            INDEX IS PROPERLY RELATED TO THE BASE         */ 02325000
*        /*            CLUSTER.  THE FOLLOWING LOCATES ARE REQUIRED- */ 02326000
*        /*                                                          */ 02327000
*        /*              1 - LOCATE THE BASE CLUSTER USING THE       */ 02328000
*        /*                  NAME PROVIDED VIA THE INFILE OR         */ 02329000
*        /*                  INDATASET PARAMETER.  THIS MAY BE       */ 02330000
*        /*                  EITHER THE BASE CLUSTER NAME OR A       */ 02331000
*        /*                  PATH OVER THE BASE.                     */ 02332000
*        /*                                                          */ 02333000
*        /*              2 - LOCATE THE BASE CLUSTER DATA AMDSB      */ 02334000
*        /*                                                          */ 02335000
*        /*              3 - LOCATE THE AIX USING THE NAME PROVIDED  */ 02336000
*        /*                  VIA THE OUTFILE OR OUTDATASET           */ 02337000
*        /*                  PARAMETER.  THIS MAY BE EITHER THE      */ 02338000
*        /*                  AIX OR A PATH OVER THE AIX.             */ 02339000
*        /*                                                          */ 02340000
*        /*              4 - IF LOCATE 3 RETURNED A PATH OVER THE    */ 02341000
*        /*                  AIX, LOCATE THE AIX USING THE CI NUMBER */ 02342000
*        /*                  RETURNED IN LOCATE 3                    */ 02343000
*        /*                                                          */ 02344000
*        /*              5 - LOCATE THE AIX DATA AMDSB               */ 02345000
*        /*                                                          */ 02346000
*        /*            LOCPROC CALLS CATPROC TO SET UP THE REQUIRED  */ 02347000
*        /*            PARAMETER LIST AND INVOKE CATALOG MANAGEMENT. */ 02348000
*        /*                                                          */ 02349000
*        /* INPUT -                                                  */ 02350000
*        /*        LOCAMDSB - POINTERS TO AMDSB AREAS                */ 02351000
*        /*                                                          */ 02352000
*        /*        LOCIOCS  - POINTERS TO IOCSTR FOR EACH OPEN DATA  */ 02353000
*        /*                   SET                                    */ 02354000
*        /*                                                          */ 02355000
*        /*        LOCI     - CURRENT VALUE OF THE VARIABLE CONTROL- */ 02356000
*        /*                   LING THE MAIN BUILD AIX LOOP IN THE    */ 02357000
*        /*                   HIGHEST LEVEL PROCEDURE                */ 02358000
*        /*                                                          */ 02359000
*        /*        LOCSTAT  - STATUS COMMUNICATION AREA              */ 02360000
*        /*                                                          */ 02361000
*        /* OUTPUT -                                                 */ 02362000
*        /*                                                          */ 02363000
*        /*        THE RETRIEVED AMDSBS ARE MOVED TO THEIR           */ 02364000
*        /*        RESPECTIVE AREAS                                  */ 02365000
*        /*                                                          */ 02366000
*        /* EXIT, NORMAL - ALL LOCATES EXECUTED SUCCESSFULLY         */ 02367000
*        /*                VERIFICATION OF AIX TO BASE SUCCESSFUL    */ 02368000
*        /*                                                          */ 02369000
*        /* EXIT,ERROR -                                             */ 02370000
*        /*              RETURN CODE 8, LOCATE OR VERIFICATION       */ 02371000
*        /*                              OF AIX FAILED               */ 02372000
*        /*                                                          */ 02373000
*        /*              RETURN CODE 12, LOCATE OR VERIFICATION      */ 02374000
*        /*                              OF BASE CLUSTER FAILED      */ 02375000
*        /*                                                          */ 02376000
*        /************************************************************/ 02377000
*LOCPROC:                                                          0577 02378000
*        PROCEDURE (LOCAMDSB,          /* PTRS TO AMDSB AREAS        */ 02379000
*                   LOCIOCS,           /* PTRS TO IOCSTRS            */ 02380000
*                   LOCI,              /* INDEX VALUE OF AIX         */ 02381000
*                   LOCSTAT);          /* STATUS COMMUNICATION AREA  */ 02382000
*                                                                  0577 02383000
LOCPROC  STM   @14,@12,@SA00007                                    0577 02384000
         MVC   @PC00007(16),0(@01)                                 0577 02385000
*        /************************************************************/ 02386000
*        /*                                                          */ 02387000
*        /* ARGUMENTS OF INVOCATION                                  */ 02388000
*        /*                                                          */ 02389000
*        /************************************************************/ 02390000
*                                                                  0578 02391000
*        DCL LOCI FIXED(31);            /* INDEX TO CURRENT AIX      */ 02392000
*                                                                  0578 02393000
*        DCL 1 LOCAMDSB BDY(WORD),                                 0579 02394000
*              2 LOAMDSPT(2) PTR(31);   /* POINTERS TO AMDSB AREAS   */ 02395000
*                                                                  0579 02396000
*        DCL 1 LOCIOCS BDY(WORD),       /* POINTERS TO IOCSTR FOR    */ 02397000
*              2 LOIOCSPT(4) PTR(31);   /* EACH OPEN DATA SET        */ 02398000
*                                                                  0580 02399000
*        DCL 1 LOCSTAT,                                            0581 02400000
*              2 LOSAVERC FIXED(15),    /* CURRENT CONDITION CODE    */ 02401000
*              2 LOSTID   CHAR(4);      /* ERROR IDENTIFIERS         */ 02402000
*                                                                  0581 02403000
*        /************************************************************/ 02404000
*        /*                                                          */ 02405000
*        /* STRUCTURES USED TO REFERENCE DATA RETURNED FROM THE      */ 02406000
*        /* CATALOG                                                  */ 02407000
*        /*                                                          */ 02408000
*        /************************************************************/ 02409000
*                                                                  0582 02410000
*        DCL ENTYPE CHAR(1) BASED(WKAENTYP);                       0582 02411000
*                                                                  0582 02412000
*        DCL 1 NAMEDS(3) CHAR(4) BASED(WKANAME),                   0583 02413000
*              2 NAMEID CHAR(1),                                   0583 02414000
*              2 NAMECI CHAR(3);                                   0583 02415000
*                                                                  0583 02416000
*        DCL 1 WKAPTRS BDY(WORD),       /* CATALOG WORK AREA POINTERS*/ 02417000
*              2 WKAENTYP PTR(31),      /* POINTER TO ENTYPE IN WKA  */ 02418000
*              2 WKANAME  PTR(31),      /* POINTER TO NAMEDS IN WKA  */ 02419000
*              2 WKAAMDSB PTR(31);      /* POINTER TO AMDSB IN WKA   */ 02420000
*                                                                  0584 02421000
*        DCL 1 BASENAME CHAR(4),        /* BASE CLUSTER NAMEDS ENTRY */ 02422000
*              2 BASEID CHAR(1),        /* BASE CLUSTER ID           */ 02423000
*              2 BASECI CHAR(3);        /* BASE CLUSTER CI           */ 02424000
*                                                                  0585 02425000
*        DCL 1 NEXTNAME CHAR(4),        /* DATA FOR NEXT LOCATE      */ 02426000
*              2 NEXTID CHAR(1),        /* ID OF NEXT LOCATE         */ 02427000
*              2 NEXTCI CHAR(3);        /* CI FOR NEXT LOCATE        */ 02428000
*        /************************************************************/ 02429000
*        /*                                                          */ 02430000
*        /* THE FORMAT OF NAMEDS RETURNED FROM EACH LOCATE IS -      */ 02431000
*        /*                                                          */ 02432000
*        /*    1 - IF THE LOCATE IS AGAINST A PATH OVER THE          */ 02433000
*        /*        BASE CLUSTER - C(BASE),D(BASE),I(BASE)            */ 02434000
*        /*                                                          */ 02435000
*        /*        IF THE LOCATE IS AGAINST THE BASE CLUSTER         */ 02436000
*        /*        ITSELF - D(BASE),I(BASE)                          */ 02437000
*        /*                                                          */ 02438000
*        /*    2 - C(BASE)                                           */ 02439000
*        /*                                                          */ 02440000
*        /*    3 - IF THE LOCATE IS AGAINST A PATH OVER THE          */ 02441000
*        /*        AIX - G(AIX),D(AIX),I(AIX)                        */ 02442000
*        /*                                                          */ 02443000
*        /*        IF THE LOCATE IS AGAINST THE AIX ITSELF -         */ 02444000
*        /*        D(AIX),I(AIX),C(BASE)                             */ 02445000
*        /*                                                          */ 02446000
*        /*    4 - IF LOCATE 3 WAS AGAINST A PATH - D(AIX),I(AIX),   */ 02447000
*        /*        C(BASE)                                           */ 02448000
*        /*                                                          */ 02449000
*        /* THE FIRST TWO LOCATES AGAINST THE BASE CLUSTER           */ 02450000
*        /* ARE PERFORMED ONLY WHEN THE FIRST AIX IS BEING BUILT.    */ 02451000
*        /* ISSUE LOCATE 1 AGAINST THE BASE CLUSTER OR PATH          */ 02452000
*        /*                                                          */ 02453000
*        /************************************************************/ 02454000
*                                                                  0587 02455000
*        OLDERID2 = NEWERID2;                                      0587 02456000
         L     @15,@PC00001                                        0587 02457000
         L     @15,GDTTR2(,@15)                                    0587 02458000
         MVC   @TS00001(95),NEWERID2(@15)                          0587 02459000
         MVC   OLDERID2(95,@15),@TS00001                           0587 02460000
*        NEWID2 = 'BIL1';                                          0588 02461000
*                                                                  0588 02462000
         MVC   NEWID2(4,@15),@CC01231                              0588 02463000
*        IF LOCI = 1                                               0589 02464000
*          THEN                                                    0589 02465000
         L     @15,@PC00007+8                                      0589 02466000
         CLC   LOCI(4,@15),@CF00220                                0589 02467000
         BNE   @RF00589                                            0589 02468000
*            DO;                                                   0590 02469000
*                                                                  0590 02470000
*            CALL CATPROC ('1',LOIOCSPT(1),NULLPTR,WKAPTRS,LOCI,   0591 02471000
*                          LOCSTAT);                               0591 02472000
*                                                                  0591 02473000
         LA    @14,@CC01233                                        0591 02474000
         ST    @14,@AL00001                                        0591 02475000
         L     @14,@PC00007+4                                      0591 02476000
         ST    @14,@AL00001+4                                      0591 02477000
         LA    @14,@CF00116                                        0591 02478000
         ST    @14,@AL00001+8                                      0591 02479000
         LA    @14,WKAPTRS                                         0591 02480000
         ST    @14,@AL00001+12                                     0591 02481000
         ST    @15,@AL00001+16                                     0591 02482000
         L     @15,@PC00007+12                                     0591 02483000
         ST    @15,@AL00001+20                                     0591 02484000
         LA    @01,@AL00001                                        0591 02485000
         BAL   @14,CATPROC                                         0591 02486000
*            RESPECIFY RTNREG RSTD;                                0592 02487000
*            TESTRC = RTNREG;                                      0593 02488000
         LR    TESTRC,RTNREG                                       0593 02489000
*            RESPECIFY RTNREG UNRSTD;                              0594 02490000
*                                                                  0594 02491000
*            IF TESTRC ^= 0                                        0595 02492000
*              THEN                                                0595 02493000
         LTR   TESTRC,TESTRC                                       0595 02494000
         BZ    @RF00595                                            0595 02495000
*                RETURN CODE(LASTCC12);                            0596 02496000
*                                                                  0596 02497000
         LA    @15,12                                              0596 02498000
         L     @14,@SA00007                                        0596 02499000
         LM    @00,@12,@SA00007+8                                  0596 02500000
         BR    @14                                                 0596 02501000
*            /********************************************************/ 02502000
*            /*                                                      */ 02503000
*            /* VERIFY THE OBJECT RETURNED IS EITHER A BASE CLUSTER  */ 02504000
*            /* OR A PATH OVER A BASE CLUSTER.                       */ 02505000
*            /*                                                      */ 02506000
*            /********************************************************/ 02507000
*                                                                  0597 02508000
*            IF ENTYPE = 'R'                                       0597 02509000
*              THEN                                                0597 02510000
@RF00595 L     @01,WKAENTYP                                        0597 02511000
         CLI   ENTYPE(@01),C'R'                                    0597 02512000
         BNE   @RF00597                                            0597 02513000
*                DO;                                               0598 02514000
*                                                                  0598 02515000
*                IF NAMEID(1) ^= 'C'                               0599 02516000
*                  THEN                                            0599 02517000
         L     @01,WKANAME                                         0599 02518000
         CLI   NAMEID(@01),C'C'                                    0599 02519000
         BE    @RF00599                                            0599 02520000
*                    DO;                                           0600 02521000
*                                                                  0600 02522000
*                    LOSTID = INVALBAS;                            0601 02523000
         L     @15,@PC00007+12                                     0601 02524000
         MVC   LOSTID(4,@15),@CB00886                              0601 02525000
*                    RETURN CODE(LASTCC12);                        0602 02526000
*                                                                  0602 02527000
         LA    @15,12                                              0602 02528000
         L     @14,@SA00007                                        0602 02529000
         LM    @00,@12,@SA00007+8                                  0602 02530000
         BR    @14                                                 0602 02531000
*                    END;                                          0603 02532000
*                                                                  0603 02533000
*                NEXTNAME = NAMEDS(2);                             0604 02534000
*                                                                  0604 02535000
@RF00599 L     @01,WKANAME                                         0604 02536000
         MVC   NEXTNAME(4),NAMEDS+4(@01)                           0604 02537000
*                END;                                              0605 02538000
*                                                                  0605 02539000
*              ELSE                                                0606 02540000
*                IF ENTYPE ^= 'C'                                  0606 02541000
*                  THEN                                            0606 02542000
         B     @RC00597                                            0606 02543000
@RF00597 L     @01,WKAENTYP                                        0606 02544000
         CLI   ENTYPE(@01),C'C'                                    0606 02545000
         BE    @RF00606                                            0606 02546000
*                    DO;                                           0607 02547000
*                                                                  0607 02548000
*                    LOSTID = INVALBAS;                            0608 02549000
         L     @15,@PC00007+12                                     0608 02550000
         MVC   LOSTID(4,@15),@CB00886                              0608 02551000
*                    RETURN CODE(LASTCC12);                        0609 02552000
*                                                                  0609 02553000
         LA    @15,12                                              0609 02554000
         L     @14,@SA00007                                        0609 02555000
         LM    @00,@12,@SA00007+8                                  0609 02556000
         BR    @14                                                 0609 02557000
*                    END;                                          0610 02558000
*                                                                  0610 02559000
*                  ELSE                                            0611 02560000
*                    NEXTNAME = NAMEDS(1);                         0611 02561000
*                                                                  0611 02562000
@RF00606 L     @01,WKANAME                                         0611 02563000
         MVC   NEXTNAME(4),NAMEDS(@01)                             0611 02564000
*            /********************************************************/ 02565000
*            /*                                                      */ 02566000
*            /* ISSUE LOCATE 2 AGAINST THE DATA COMPONENT OF THE     */ 02567000
*            /* BASE CLUSTER.  SAVE THE BASE CLUSTER CI NUMBER       */ 02568000
*            /* FOR VERIFICATION OF THE AIX RELATIONSHIP.  MOVE      */ 02569000
*            /* THE AMDSB CONTROL BLOCK TO ITS HOLD AREA             */ 02570000
*            /*                                                      */ 02571000
*            /********************************************************/ 02572000
*                                                                  0612 02573000
*            CALL CATPROC ('2',NULLPTR,NEXTCI,WKAPTRS,LOCI,        0612 02574000
*                           LOCSTAT);                              0612 02575000
*                                                                  0612 02576000
@RC00597 LA    @15,@CC01234                                        0612 02577000
         ST    @15,@AL00001                                        0612 02578000
         LA    @15,@CF00116                                        0612 02579000
         ST    @15,@AL00001+4                                      0612 02580000
         LA    @15,NEXTCI                                          0612 02581000
         ST    @15,@AL00001+8                                      0612 02582000
         LA    @15,WKAPTRS                                         0612 02583000
         ST    @15,@AL00001+12                                     0612 02584000
         L     @15,@PC00007+8                                      0612 02585000
         ST    @15,@AL00001+16                                     0612 02586000
         L     @15,@PC00007+12                                     0612 02587000
         ST    @15,@AL00001+20                                     0612 02588000
         LA    @01,@AL00001                                        0612 02589000
         BAL   @14,CATPROC                                         0612 02590000
*            RESPECIFY RTNREG RSTD;                                0613 02591000
*            TESTRC = RTNREG;                                      0614 02592000
         LR    TESTRC,RTNREG                                       0614 02593000
*            RESPECIFY RTNREG UNRSTD;                              0615 02594000
*                                                                  0615 02595000
*            IF TESTRC ^= 0                                        0616 02596000
*              THEN                                                0616 02597000
         LTR   TESTRC,TESTRC                                       0616 02598000
         BZ    @RF00616                                            0616 02599000
*                RETURN CODE(LASTCC12);                            0617 02600000
*                                                                  0617 02601000
         LA    @15,12                                              0617 02602000
         L     @14,@SA00007                                        0617 02603000
         LM    @00,@12,@SA00007+8                                  0617 02604000
         BR    @14                                                 0617 02605000
*            BASENAME = NAMEDS(1);                                 0618 02606000
*                                                                  0618 02607000
@RF00616 L     @01,WKANAME                                         0618 02608000
         MVC   BASENAME(4),NAMEDS(@01)                             0618 02609000
*            LOAMDSPT(1) -> IDAAMDSB(1:LENGTH(IDAAMDSB)) =         0619 02610000
*                           WKAAMDSB -> IDAAMDSB;                  0619 02611000
*                                                                  0619 02612000
         L     @15,@PC00007                                        0619 02613000
         L     @01,LOAMDSPT(,@15)                                  0619 02614000
         L     @15,WKAAMDSB                                        0619 02615000
         MVC   IDAAMDSB(96,@01),IDAAMDSB(@15)                      0619 02616000
*            END;                                                  0620 02617000
*                                                                  0620 02618000
*        /************************************************************/ 02619000
*        /*                                                          */ 02620000
*        /* ISSUE LOCATE 3 AGAINST THE ALTERNATE INDEX OR PATH       */ 02621000
*        /*                                                          */ 02622000
*        /************************************************************/ 02623000
*                                                                  0621 02624000
*        CALL CATPROC ('3', LOIOCSPT(2),NULLPTR,WKAPTRS,LOCI,      0621 02625000
*                      LOCSTAT);                                   0621 02626000
*                                                                  0621 02627000
@RF00589 LA    @15,@CC01235                                        0621 02628000
         ST    @15,@AL00001                                        0621 02629000
         L     @15,@PC00007+4                                      0621 02630000
         LA    @15,LOIOCSPT+4(,@15)                                0621 02631000
         ST    @15,@AL00001+4                                      0621 02632000
         LA    @15,@CF00116                                        0621 02633000
         ST    @15,@AL00001+8                                      0621 02634000
         LA    @15,WKAPTRS                                         0621 02635000
         ST    @15,@AL00001+12                                     0621 02636000
         L     @15,@PC00007+8                                      0621 02637000
         ST    @15,@AL00001+16                                     0621 02638000
         L     @15,@PC00007+12                                     0621 02639000
         ST    @15,@AL00001+20                                     0621 02640000
         LA    @01,@AL00001                                        0621 02641000
         BAL   @14,CATPROC                                         0621 02642000
*        RESPECIFY RTNREG RSTD;                                    0622 02643000
*        TESTRC = RTNREG;                                          0623 02644000
         LR    TESTRC,RTNREG                                       0623 02645000
*        RESPECIFY RTNREG UNRSTD;                                  0624 02646000
*                                                                  0624 02647000
*        IF TESTRC ^= 0                                            0625 02648000
*          THEN                                                    0625 02649000
         LTR   TESTRC,TESTRC                                       0625 02650000
         BZ    @RF00625                                            0625 02651000
*            RETURN CODE(LASTCC08);                                0626 02652000
*                                                                  0626 02653000
         LA    @15,8                                               0626 02654000
         L     @14,@SA00007                                        0626 02655000
         LM    @00,@12,@SA00007+8                                  0626 02656000
         BR    @14                                                 0626 02657000
*        NEXTNAME = NAMEDS(1);                                     0627 02658000
*                                                                  0627 02659000
@RF00625 L     @01,WKANAME                                         0627 02660000
         MVC   NEXTNAME(4),NAMEDS(@01)                             0627 02661000
*        /************************************************************/ 02662000
*        /*                                                          */ 02663000
*        /* VERIFY THAT THE OBJECT RETURNED IS EITHER AN ALTERNATE   */ 02664000
*        /* INDEX OR A PATH OVER AN ALTERNATE INDEX.  IF A PATH,     */ 02665000
*        /* ISSUE LOCATE 4 AGAINST THE AIX.                          */ 02666000
*        /*                                                          */ 02667000
*        /************************************************************/ 02668000
*                                                                  0628 02669000
*        IF ENTYPE = 'R'                                           0628 02670000
*          THEN                                                    0628 02671000
         L     @01,WKAENTYP                                        0628 02672000
         CLI   ENTYPE(@01),C'R'                                    0628 02673000
         BNE   @RF00628                                            0628 02674000
*            DO;                                                   0629 02675000
*                                                                  0629 02676000
*            IF NEXTID ^= 'G'                                      0630 02677000
*              THEN                                                0630 02678000
         CLI   NEXTID,C'G'                                         0630 02679000
         BE    @RF00630                                            0630 02680000
*                DO;                                               0631 02681000
*                                                                  0631 02682000
*                LOSTID = INVALAIX;                                0632 02683000
         L     @15,@PC00007+12                                     0632 02684000
         MVC   LOSTID(4,@15),@CB00884                              0632 02685000
*                RETURN CODE(LASTCC08);                            0633 02686000
*                                                                  0633 02687000
         LA    @15,8                                               0633 02688000
         L     @14,@SA00007                                        0633 02689000
         LM    @00,@12,@SA00007+8                                  0633 02690000
         BR    @14                                                 0633 02691000
*                END;                                              0634 02692000
*                                                                  0634 02693000
*              ELSE                                                0635 02694000
*                DO;                                               0635 02695000
*                                                                  0635 02696000
@RF00630 DS    0H                                                  0636 02697000
*                CALL CATPROC ('4',NULLPTR,NEXTCI,WKAPTRS,LOCI,    0636 02698000
*                              LOCSTAT);                           0636 02699000
*                                                                  0636 02700000
         LA    @15,@CC01236                                        0636 02701000
         ST    @15,@AL00001                                        0636 02702000
         LA    @15,@CF00116                                        0636 02703000
         ST    @15,@AL00001+4                                      0636 02704000
         LA    @15,NEXTCI                                          0636 02705000
         ST    @15,@AL00001+8                                      0636 02706000
         LA    @15,WKAPTRS                                         0636 02707000
         ST    @15,@AL00001+12                                     0636 02708000
         L     @15,@PC00007+8                                      0636 02709000
         ST    @15,@AL00001+16                                     0636 02710000
         L     @15,@PC00007+12                                     0636 02711000
         ST    @15,@AL00001+20                                     0636 02712000
         LA    @01,@AL00001                                        0636 02713000
         BAL   @14,CATPROC                                         0636 02714000
*                RESPECIFY RTNREG RSTD;                            0637 02715000
*                TESTRC = RTNREG;                                  0638 02716000
         LR    TESTRC,RTNREG                                       0638 02717000
*                RESPECIFY RTNREG UNRSTD;                          0639 02718000
*                                                                  0639 02719000
*                IF TESTRC ^= 0                                    0640 02720000
*                  THEN                                            0640 02721000
         LTR   TESTRC,TESTRC                                       0640 02722000
         BZ    @RF00640                                            0640 02723000
*                    RETURN CODE(LASTCC08);                        0641 02724000
*                                                                  0641 02725000
         LA    @15,8                                               0641 02726000
         L     @14,@SA00007                                        0641 02727000
         LM    @00,@12,@SA00007+8                                  0641 02728000
         BR    @14                                                 0641 02729000
*                NEXTNAME = NAMEDS(1);                             0642 02730000
*                                                                  0642 02731000
@RF00640 L     @01,WKANAME                                         0642 02732000
         MVC   NEXTNAME(4),NAMEDS(@01)                             0642 02733000
*                END;                                              0643 02734000
*                                                                  0643 02735000
*            END;                                                  0644 02736000
*                                                                  0644 02737000
*          ELSE                                                    0645 02738000
*            IF ENTYPE ^= 'G'                                      0645 02739000
*              THEN                                                0645 02740000
         B     @RC00628                                            0645 02741000
@RF00628 L     @01,WKAENTYP                                        0645 02742000
         CLI   ENTYPE(@01),C'G'                                    0645 02743000
         BE    @RF00645                                            0645 02744000
*                DO;                                               0646 02745000
*                                                                  0646 02746000
*                LOSTID = INVALAIX;                                0647 02747000
         L     @15,@PC00007+12                                     0647 02748000
         MVC   LOSTID(4,@15),@CB00884                              0647 02749000
*                RETURN CODE(LASTCC08);                            0648 02750000
*                                                                  0648 02751000
         LA    @15,8                                               0648 02752000
         L     @14,@SA00007                                        0648 02753000
         LM    @00,@12,@SA00007+8                                  0648 02754000
         BR    @14                                                 0648 02755000
*                END;                                              0649 02756000
*                                                                  0649 02757000
*        /************************************************************/ 02758000
*        /*                                                          */ 02759000
*        /* VERIFY THAT THE ALTERNATE INDEX IS PROPERLY RELATED TO   */ 02760000
*        /* THE BASE CLUSTER BY COMPARING THE CI NUMBER OF THE BASE  */ 02761000
*        /* RETURNED IN LOCATE 2 TO THE CI NUMBER OF THE BASE        */ 02762000
*        /* RETURNED IN LOCATE 3 OR 4                                */ 02763000
*        /*                                                          */ 02764000
*        /************************************************************/ 02765000
*                                                                  0650 02766000
*        IF NAMECI(3) ^= BASECI                                    0650 02767000
*          THEN                                                    0650 02768000
@RF00645 DS    0H                                                  0650 02769000
@RC00628 L     @01,WKANAME                                         0650 02770000
         CLC   NAMECI+8(3,@01),BASECI                              0650 02771000
         BE    @RF00650                                            0650 02772000
*            DO;                                                   0651 02773000
*                                                                  0651 02774000
*            LOSTID = NOTRELAT;                                    0652 02775000
         L     @15,@PC00007+12                                     0652 02776000
         MVC   LOSTID(4,@15),@CB00888                              0652 02777000
*            RETURN CODE(LASTCC08);                                0653 02778000
*                                                                  0653 02779000
         LA    @15,8                                               0653 02780000
         L     @14,@SA00007                                        0653 02781000
         LM    @00,@12,@SA00007+8                                  0653 02782000
         BR    @14                                                 0653 02783000
*            END;                                                  0654 02784000
*                                                                  0654 02785000
*        /************************************************************/ 02786000
*        /*                                                          */ 02787000
*        /* ISSUE LOCATE 5 AGAINST THE DATA COMPONENT OF THE         */ 02788000
*        /* ALTERNATE INDEX.  MOVE THE AMDSB TO ITS HOLD AREA.       */ 02789000
*        /*                                                          */ 02790000
*        /************************************************************/ 02791000
*                                                                  0655 02792000
*        CALL CATPROC ('5',NULLPTR,NEXTCI,WKAPTRS,LOCI,            0655 02793000
*                       LOCSTAT);                                  0655 02794000
*                                                                  0655 02795000
@RF00650 LA    @15,@CC01237                                        0655 02796000
         ST    @15,@AL00001                                        0655 02797000
         LA    @15,@CF00116                                        0655 02798000
         ST    @15,@AL00001+4                                      0655 02799000
         LA    @15,NEXTCI                                          0655 02800000
         ST    @15,@AL00001+8                                      0655 02801000
         LA    @15,WKAPTRS                                         0655 02802000
         ST    @15,@AL00001+12                                     0655 02803000
         L     @15,@PC00007+8                                      0655 02804000
         ST    @15,@AL00001+16                                     0655 02805000
         L     @15,@PC00007+12                                     0655 02806000
         ST    @15,@AL00001+20                                     0655 02807000
         LA    @01,@AL00001                                        0655 02808000
         BAL   @14,CATPROC                                         0655 02809000
*        RESPECIFY RTNREG RSTD;                                    0656 02810000
*        TESTRC = RTNREG;                                          0657 02811000
         LR    TESTRC,RTNREG                                       0657 02812000
*        RESPECIFY RTNREG UNRSTD;                                  0658 02813000
*                                                                  0658 02814000
*        IF TESTRC ^= 0                                            0659 02815000
*          THEN                                                    0659 02816000
         LTR   TESTRC,TESTRC                                       0659 02817000
         BZ    @RF00659                                            0659 02818000
*            RETURN CODE(LASTCC08);                                0660 02819000
*                                                                  0660 02820000
         LA    @15,8                                               0660 02821000
         L     @14,@SA00007                                        0660 02822000
         LM    @00,@12,@SA00007+8                                  0660 02823000
         BR    @14                                                 0660 02824000
*        LOAMDSPT(2) -> IDAAMDSB(1:LENGTH(IDAAMDSB)) =             0661 02825000
*                          WKAAMDSB -> IDAAMDSB;                   0661 02826000
*                                                                  0661 02827000
@RF00659 L     @15,@PC00007                                        0661 02828000
         L     @01,LOAMDSPT+4(,@15)                                0661 02829000
         L     @15,WKAAMDSB                                        0661 02830000
         MVC   IDAAMDSB(96,@01),IDAAMDSB(@15)                      0661 02831000
*        /************************************************************/ 02832000
*        /*                                                          */ 02833000
*        /* RETURN TO CALLING PROCEDURE - MAINPROC                   */ 02834000
*        /*                                                          */ 02835000
*        /************************************************************/ 02836000
*                                                                  0662 02837000
*        RETURN CODE(LASTCC00);                                    0662 02838000
*                                                                  0662 02839000
         SLR   @15,@15                                             0662 02840000
         L     @14,@SA00007                                        0662 02841000
         LM    @00,@12,@SA00007+8                                  0662 02842000
         BR    @14                                                 0662 02843000
*END LOCPROC;                                                      0663 02844000
*        /************************************************************/ 02845000
*        /*                                                          */ 02846000
*        /* PROCEDURE NAME - CATPROC                                 */ 02847000
*        /*                                                          */ 02848000
*        /* FUNCTION - PERFORMS THE FUNCTION OF BUILDING THE         */ 02849000
*        /*            CATALOG PARAMETER LIST (CPL) AND REQUIRED     */ 02850000
*        /*            FIELD PARAMETER LISTS (FPL) AND ISSUING       */ 02851000
*        /*            THE VSAM CATALOG MANAGEMENT LOCATE FUNCTION.  */ 02852000
*        /*                                                          */ 02853000
*        /* INPUT -                                                  */ 02854000
*        /*         CATLOCNO - THE LOCATE IDENTIFIER, 1 - 5          */ 02855000
*        /*                                                          */ 02856000
*        /*         CATLOCNM - A POINTER TO THE IOCSTR FOR THE OPEN  */ 02857000
*        /*                    BASE CLUSTER OR AIX                   */ 02858000
*        /*                                                          */ 02859000
*        /*         CATLOCCI - A CATALOG CI NUMBER TO BE USED IN     */ 02860000
*        /*                    THE LOCATE                            */ 02861000
*        /*                                                          */ 02862000
*        /*         CATLOCI  - INDEX VALUE OF MAIN AIX LOOP          */ 02863000
*        /*                                                          */ 02864000
*        /* OUTPUT -                                                 */ 02865000
*        /*         CATLOCDT - AN AREA INTO WHICH CATPROC PLACES     */ 02866000
*        /*                    ADDRESSES OF DATA RETURNED BY THE     */ 02867000
*        /*                    CATALOG                               */ 02868000
*        /*                                                          */ 02869000
*        /*         CATSTAT  - STATUS COMMUNICATION AREA             */ 02870000
*        /*                                                          */ 02871000
*        /* EXIT,NORMAL - CATALOG LOCATE WAS SUCCESSFUL              */ 02872000
*        /*                                                          */ 02873000
*        /* EXIT, ERROR-  RETURN CODE 12, CATALOG LOCATE WAS NOT     */ 02874000
*        /*                               SUCCESSFUL                 */ 02875000
*        /*                                                          */ 02876000
*        /************************************************************/ 02877000
*                                                                  0664 02878000
*CATPROC:                                                          0664 02879000
*        PROCEDURE (CATLOCNO,          /* LOCATE NUMBER ID           */ 02880000
*                   CATLOCNM,          /* PTR TO IOCSTR OF OBJECT    */ 02881000
*                   CATLOCCI,          /* CATALOG CI NUMBER OF OBJECT*/ 02882000
*                   CATLOCDT,          /* PTRS TO DATA RETURNED      */ 02883000
*                   CATLOCI,           /* INDEX VALUE OF AIX         */ 02884000
*                   CATSTAT);          /* STATUS COMMUNICATION AREA  */ 02885000
*                                                                  0664 02886000
CATPROC  STM   @14,@12,@SA00008                                    0664 02887000
         MVC   @PC00008(24),0(@01)                                 0664 02888000
*        /************************************************************/ 02889000
*        /*                                                          */ 02890000
*        /* ARGUMENTS OF INVOCATION                                  */ 02891000
*        /*                                                          */ 02892000
*        /************************************************************/ 02893000
*                                                                  0665 02894000
*        DCL                                                       0665 02895000
*          CATLOCNO CHAR(1),            /* LOCATE IDENTIFIER         */ 02896000
*          CATLOCNM PTR(31),            /* POINTER TO IOCSTR         */ 02897000
*                                       /* OF OBJECT LOCATED         */ 02898000
*          CATLOCCI CHAR(3),            /* CATALOG CI NUMBER         */ 02899000
*                                       /* OF OBJECT LOCATED         */ 02900000
*          CATLOCI  FIXED(31);          /* AIX LOOP INDEX VALUE      */ 02901000
*                                                                  0665 02902000
*        DCL 1 CATLOCDT BDY(WORD),      /* PTRS TO DATA RETURNED     */ 02903000
*              2 CATLOPTR(3) PTR(31);                              0666 02904000
*                                                                  0666 02905000
*        DCL 1 CATSTAT,                /* STATUS COMMUNICATION AREA  */ 02906000
*              2 CASAVERC FIXED(15),   /* CURRENT CONDITION CODE     */ 02907000
*              2 CASTID   CHAR(4);     /* ERROR IDENTIFIER           */ 02908000
*                                                                  0667 02909000
*        /************************************************************/ 02910000
*        /*                                                          */ 02911000
*        /* AREA CONTAINING THE CPL AND FPLS REQUIRED FOR THE        */ 02912000
*        /* LOCATES PLUS THE WORKAREA IN WHICH CATALOG MANAGEMENT    */ 02913000
*        /* RETURNS THE REQUESTED INFORMATION                        */ 02914000
*        /*                                                          */ 02915000
*        /************************************************************/ 02916000
*                                                                  0668 02917000
*        DCL 1 LOCCPLAR BDY(WORD),                                 0668 02918000
*              2 LOCCPLID CHAR(8),                /* CPL DUMP ID     */ 02919000
*              2 LOCCPL   CHAR(LENGTH(CTGPL)),    /* CPL             */ 02920000
*              2 LOCFPPTR(3) PTR(31),             /* FPL POINTERS    */ 02921000
*              2 LOCFPENT CHAR(LENGTH(CTGFL)),    /* ENTYPE FPL      */ 02922000
*              2 *        CHAR(8),                                 0668 02923000
*              2 LOCFPNAM CHAR(LENGTH(CTGFL)),    /* NAMEDS  FPL     */ 02924000
*              2 *        CHAR(8),                                 0668 02925000
*              2 LOCFPMSC CHAR(LENGTH(CTGFL)),    /* CATACB OR       */ 02926000
*              2 *        CHAR(8),                /* AMDSBCAT FPL    */ 02927000
*              2 LOCFPTST CHAR(LENGTH(CTGFL)),    /* NAMEDS TEST FPL */ 02928000
*              2 *        CHAR(8);                                 0668 02929000
*                                                                  0668 02930000
*        DCL 1 LOCWKA BDY(WORD),                  /* LOCATE WORKAREA */ 02931000
*              2 LOCWKALN FIXED(15),              /* WORKAREA LENGTH */ 02932000
*              2 LOCWKDLN FIXED(15),              /* LENGTH OF DATA  */ 02933000
*              2 LOCWKDAT CHAR((LENGTH(IDAAMDSB)) +/*              0669 02934000
*                                                    DATA RETURNED   */ 02935000
*                         (LENGTH(ENTYPE)) +                       0669 02936000
*                         (LENGTH(NAMEDS) * 3));                   0669 02937000
*                                                                  0669 02938000
*        /************************************************************/ 02939000
*        /*                                                          */ 02940000
*        /* SAVE AREA FOR CATALOG ACB ADDRESS (USED IN ALL LOCATES   */ 02941000
*        /* EXCEPT THE FIRST)                                        */ 02942000
*        /*                                                          */ 02943000
*        /************************************************************/ 02944000
*                                                                  0670 02945000
*        DCL CATACBPT PTR(31);                                     0670 02946000
*                                                                  0670 02947000
*        DCL ACBADDR PTR(31) BASED;                                0671 02948000
*                                                                  0671 02949000
*        /************************************************************/ 02950000
*        /*                                                          */ 02951000
*        /* FIELD NAMES OF DATA TO BE LOCATED.  THE SEQUENCE OF      */ 02952000
*        /* NAMES IN THIS TABLE IS FIXED.                            */ 02953000
*        /*                                                          */ 02954000
*        /************************************************************/ 02955000
*                                                                  0672 02956000
*        DCL NAMTABL(5) CHAR(8) INIT('ENTYPE','NAMEDS','CATACB',   0672 02957000
*                                    'CNTREPNO','AMDSBCAT');       0672 02958000
*                                                                  0672 02959000
*        /************************************************************/ 02960000
*        /* LOOP CONTROL VARIABLE                                    */ 02961000
*        /************************************************************/ 02962000
*                                                                  0673 02963000
*        DCL                                                       0673 02964000
*          LC    FIXED(31),                                        0673 02965000
*          STOPL BIT(1);                                           0673 02966000
*                                                                  0673 02967000
*        /************************************************************/ 02968000
*        /*                                                          */ 02969000
*        /* MASK USED IN SETTING TEST FOR NAMEDS                     */ 02970000
*        /*                                                          */ 02971000
*        /************************************************************/ 02972000
*                                                                  0674 02973000
*        DCL NAMEMASK FIXED(15) INIT(3);                           0674 02974000
*        /************************************************************/ 02975000
*        /*                                                          */ 02976000
*        /* INITIALIZATION - SET UP COMMON INDICATORS AND POINTERS   */ 02977000
*        /*                  IN CPL                                  */ 02978000
*        /*                                                          */ 02979000
*        /************************************************************/ 02980000
*                                                                  0675 02981000
*        LOCCPLAR = ''B;                                           0675 02982000
         XC    LOCCPLAR(144),LOCCPLAR                              0675 02983000
*        LOCWKA   = ''B;                                           0676 02984000
         XC    LOCWKA(113),LOCWKA                                  0676 02985000
*        LOCCPLID = 'LOCATCPL';                                    0677 02986000
*                                                                  0677 02987000
         MVC   LOCCPLID(8),@CC01283                                0677 02988000
*        CTGPLPTR = ADDR(LOCCPL);                                  0678 02989000
*                                                                  0678 02990000
         LA    @15,LOCCPL                                          0678 02991000
         ST    @15,CTGPLPTR                                        0678 02992000
*        CTGFUNC = CTGLOC;                                         0679 02993000
         NI    CTGFUNC(@15),B'00111111'                            0679 02994000
         OI    CTGFUNC(@15),B'00100000'                            0679 02995000
*        CTGAM0  = ON;                                             0680 02996000
*        CTGNUM  = ON;                                             0681 02997000
         OI    CTGAM0(@15),B'00000011'                             0681 02998000
*        CTGWKA  = ADDR(LOCWKA);                                   0682 02999000
         LA    @14,LOCWKA                                          0682 03000000
         ST    @14,CTGWKA(,@15)                                    0682 03001000
*        LOCWKALN = LENGTH(LOCWKA);                                0683 03002000
*                                                                  0683 03003000
         MVC   LOCWKALN(2),@CH01644                                0683 03004000
*        /************************************************************/ 03005000
*        /*                                                          */ 03006000
*        /* ON LOCATE 1, THE CATALOG ACB ADDRESS IS REQUESTED.       */ 03007000
*        /* SUBSEQUENTLY, THE CATALOG ACB ADDRESS IS USED IN THE     */ 03008000
*        /* LOCATE REQUEST                                           */ 03009000
*        /*                                                          */ 03010000
*        /************************************************************/ 03011000
*                                                                  0684 03012000
*        IF CATLOCNO = '1'                                         0684 03013000
*          THEN                                                    0684 03014000
         L     @14,@PC00008                                        0684 03015000
         CLI   CATLOCNO(@14),C'1'                                  0684 03016000
         BNE   @RF00684                                            0684 03017000
*            DO;                                                   0685 03018000
*                                                                  0685 03019000
*            CTGCNAME = ON;                                        0686 03020000
         OI    CTGCNAME(@15),B'00000010'                           0686 03021000
*            CATACBPT = NULLPTR;                                   0687 03022000
*                                                                  0687 03023000
         SLR   @15,@15                                             0687 03024000
         ST    @15,CATACBPT                                        0687 03025000
*            END;                                                  0688 03026000
*                                                                  0688 03027000
*          ELSE                                                    0689 03028000
*            CTGCAT = ADDR(CATACBPT);                              0689 03029000
*                                                                  0689 03030000
         B     @RC00684                                            0689 03031000
@RF00684 LA    @15,CATACBPT                                        0689 03032000
         L     @14,CTGPLPTR                                        0689 03033000
         ST    @15,CTGCAT(,@14)                                    0689 03034000
*        /************************************************************/ 03035000
*        /*                                                          */ 03036000
*        /* IF AN IOCSTR POINTER HAS BEEN PASSED TO THIS PROCEDURE,  */ 03037000
*        /* PLACE THE ADDRESS OF THE DATA SET NAME AND ITS PASSWORD  */ 03038000
*        /* IN THE CPL.  IF A CATALOG CI NUMBER WAS PASSED, POINT    */ 03039000
*        /* TO IT FROM THE CPL AND SET THE BYPASS SECURITY CHECK     */ 03040000
*        /* FLAG.  THIS LATTER IS REQUIRED BY DOS FOR ALL LOCATES    */ 03041000
*        /* WHEN A PREVIOUS LOCATE (E.G., AGAINST A PATH) HAS        */ 03042000
*        /* VERIFIED SECURITY.  THIS FLAG IS IGNORED IN OS.          */ 03043000
*        /*                                                          */ 03044000
*        /************************************************************/ 03045000
*                                                                  0690 03046000
*        IF CATLOCNM ^= NULLPTR                                    0690 03047000
*          THEN                                                    0690 03048000
@RC00684 SLR   @15,@15                                             0690 03049000
         L     @14,@PC00008+4                                      0690 03050000
         L     @14,CATLOCNM(,@14)                                  0690 03051000
         CR    @14,@15                                             0690 03052000
         BE    @RF00690                                            0690 03053000
*            DO;                                                   0691 03054000
*                                                                  0691 03055000
*            CTGNAME = ON;                                         0692 03056000
         L     @07,CTGPLPTR                                        0692 03057000
         OI    CTGNAME(@07),B'00000100'                            0692 03058000
*            CTGENT  = CATLOCNM -> IOCDSN;                         0693 03059000
*                                                                  0693 03060000
         L     @06,IOCDSN(,@14)                                    0693 03061000
         ST    @06,CTGENT(,@07)                                    0693 03062000
*            IF CATLOCNO = '1'                                     0694 03063000
*              THEN                                                0694 03064000
         L     @14,@PC00008                                        0694 03065000
         CLI   CATLOCNO(@14),C'1'                                  0694 03066000
         BNE   @RF00694                                            0694 03067000
*                IF ADDR(IFILE) ^= NULLPTR                         0695 03068000
*                  THEN                                            0695 03069000
         L     @14,@PC00001+4                                      0695 03070000
         L     @14,FDTPTR(,@14)                                    0695 03071000
         CR    @14,@15                                             0695 03072000
         BE    @RF00695                                            0695 03073000
*                    IF IFILEPLN ^= 0                              0696 03074000
*                      THEN                                        0696 03075000
         CLI   IFILEPLN(@14),0                                     0696 03076000
         BE    @RF00696                                            0696 03077000
*                        CTGPSWD = ADDR(IFILEPAS);                 0697 03078000
*                                                                  0697 03079000
         LA    @06,IFILEPAS(,@14)                                  0697 03080000
         ST    @06,CTGPSWD(,@07)                                   0697 03081000
*                      ELSE;                                       0698 03082000
*                                                                  0698 03083000
@RF00696 DS    0H                                                  0699 03084000
*                  ELSE                                            0699 03085000
*                    IF IDSPLN ^= 0                                0699 03086000
*                      THEN                                        0699 03087000
         B     @RC00695                                            0699 03088000
@RF00695 L     @15,@PC00001+4                                      0699 03089000
         L     @15,FDTPTR+4(,@15)                                  0699 03090000
         CLI   IDSPLN(@15),0                                       0699 03091000
         BE    @RF00699                                            0699 03092000
*                        CTGPSWD = ADDR(IDSPAS);                   0700 03093000
*                                                                  0700 03094000
         LA    @15,IDSPAS(,@15)                                    0700 03095000
         L     @14,CTGPLPTR                                        0700 03096000
         ST    @15,CTGPSWD(,@14)                                   0700 03097000
*                      ELSE;                                       0701 03098000
*                                                                  0701 03099000
@RF00699 DS    0H                                                  0702 03100000
*              ELSE                                                0702 03101000
*                IF ADDR(OFILE(CATLOCI)) ^= NULLPTR                0702 03102000
*                  THEN                                            0702 03103000
         B     @RC00694                                            0702 03104000
@RF00694 SLR   @15,@15                                             0702 03105000
         L     @14,@PC00008+16                                     0702 03106000
         L     @14,CATLOCI(,@14)                                   0702 03107000
         L     @07,@PC00001+4                                      0702 03108000
         L     @07,FDTPTR+8(,@07)                                  0702 03109000
         LA    @01,0(@14,@07)                                      0702 03110000
         BCTR  @01,0                                               0702 03111000
         CR    @01,@15                                             0702 03112000
         BE    @RF00702                                            0702 03113000
*                    IF OFILEPLN(CATLOCI) ^= 0                     0703 03114000
*                      THEN                                        0703 03115000
         MH    @14,@CH01639                                        0703 03116000
         LA    @01,0(@14,@07)                                      0703 03117000
         AL    @01,@CF01669                                        0703 03118000
         SLR   @00,@00                                             0703 03119000
         IC    @00,OFILEPLN-2(,@01)                                0703 03120000
         CR    @15,@00                                             0703 03121000
         BE    @RF00703                                            0703 03122000
*                        CTGPSWD = ADDR(OFILEPAS(CATLOCI));        0704 03123000
*                                                                  0704 03124000
         AL    @07,@CF01670                                        0704 03125000
         LA    @15,OFILEPAS-3(@14,@07)                             0704 03126000
         L     @14,CTGPLPTR                                        0704 03127000
         ST    @15,CTGPSWD(,@14)                                   0704 03128000
*                      ELSE;                                       0705 03129000
*                                                                  0705 03130000
@RF00703 DS    0H                                                  0706 03131000
*                  ELSE                                            0706 03132000
*                    IF ODSPLN(CATLOCI) ^= 0                       0706 03133000
*                      THEN                                        0706 03134000
         B     @RC00702                                            0706 03135000
@RF00702 L     @15,@PC00008+16                                     0706 03136000
         L     @15,CATLOCI(,@15)                                   0706 03137000
         MH    @15,@CH01640                                        0706 03138000
         L     @14,@PC00001+4                                      0706 03139000
         L     @14,FDTPTR+12(,@14)                                 0706 03140000
         LA    @01,0(@15,@14)                                      0706 03141000
         AL    @01,@CF01674                                        0706 03142000
         SLR   @00,@00                                             0706 03143000
         IC    @00,ODSPLN-2(,@01)                                  0706 03144000
         C     @00,@CF00116                                        0706 03145000
         BE    @RF00706                                            0706 03146000
*                        CTGPSWD = ADDR(ODSPAS(CATLOCI));          0707 03147000
*                                                                  0707 03148000
         AL    @14,@CF01675                                        0707 03149000
         LA    @15,ODSPAS-3(@15,@14)                               0707 03150000
         L     @14,CTGPLPTR                                        0707 03151000
         ST    @15,CTGPSWD(,@14)                                   0707 03152000
*                      ELSE;                                       0708 03153000
*                                                                  0708 03154000
@RF00706 DS    0H                                                  0709 03155000
*            END;                                                  0709 03156000
*                                                                  0709 03157000
*          ELSE                                                    0710 03158000
*            DO;                                                   0710 03159000
*                                                                  0710 03160000
         B     @RC00690                                            0710 03161000
@RF00690 DS    0H                                                  0711 03162000
*            CTGBYPSS = ON;                                        0711 03163000
         L     @15,CTGPLPTR                                        0711 03164000
         OI    CTGBYPSS(@15),B'10000000'                           0711 03165000
*            CTGENT = ADDR(CATLOCCI);                              0712 03166000
*                                                                  0712 03167000
         L     @14,@PC00008+8                                      0712 03168000
         ST    @14,CTGENT(,@15)                                    0712 03169000
*            END;                                                  0713 03170000
*                                                                  0713 03171000
*        /************************************************************/ 03172000
*        /*                                                          */ 03173000
*        /* INITIALIZE THE FPLS.  THE ENTYPE AND NAMEDS FPLS ARE     */ 03174000
*        /* ALWAYS INITIALIZED.  THE THIRD FPL IS SET TO CATACB      */ 03175000
*        /* FOR LOCATE 1 AND OVERLAYED WITH AMDSBCAT FOR LOCATES     */ 03176000
*        /* 2 AND 5.                                                 */ 03177000
*        /*                                                          */ 03178000
*        /************************************************************/ 03179000
*                                                                  0714 03180000
*        CTGFLPTR = ADDR(LOCFPENT);                                0714 03181000
*                                                                  0714 03182000
@RC00690 LA    CTGFLPTR,LOCFPENT                                   0714 03183000
*        DO LC = 1 TO 3;                                           0715 03184000
*                                                                  0715 03185000
         LA    LC,1                                                0715 03186000
@DL00715 DS    0H                                                  0716 03187000
*          CTGFLDNO = 1;                                           0716 03188000
         MVI   CTGFLDNO(CTGFLPTR),X'01'                            0716 03189000
*          CTGFLDNM = ADDR(NAMTABL(LC));                           0717 03190000
         LR    @15,LC                                              0717 03191000
         SLA   @15,3                                               0717 03192000
         LA    @15,NAMTABL-8(@15)                                  0717 03193000
         ST    @15,CTGFLDNM(,CTGFLPTR)                             0717 03194000
*          CTGFIELD(LC) = CTGFLPTR;                                0718 03195000
*                                                                  0718 03196000
         LR    @15,LC                                              0718 03197000
         SLA   @15,2                                               0718 03198000
         L     @01,CTGPLPTR                                        0718 03199000
         ST    CTGFLPTR,CTGFIELD-4(@15,@01)                        0718 03200000
*          CTGFLPTR = CTGFLPTR + LENGTH(CTGFL) + LENGTH(CTGFLDAT); 0719 03201000
*                                                                  0719 03202000
         AL    CTGFLPTR,@CF00311                                   0719 03203000
*        END;                                                      0720 03204000
*                                                                  0720 03205000
         AL    LC,@CF00220                                         0720 03206000
         C     LC,@CF00163                                         0720 03207000
         BNH   @DL00715                                            0720 03208000
*        IF CATLOCNO = '1'                                         0721 03209000
*          THEN                                                    0721 03210000
         L     @15,@PC00008                                        0721 03211000
         CLI   CATLOCNO(@15),C'1'                                  0721 03212000
         BNE   @RF00721                                            0721 03213000
*            CTGNOFLD = 3;                                         0722 03214000
*                                                                  0722 03215000
         L     @01,CTGPLPTR                                        0722 03216000
         MVI   CTGNOFLD(@01),X'03'                                 0722 03217000
*          ELSE                                                    0723 03218000
*            IF CATLOCNO = '2' |                                   0723 03219000
*               CATLOCNO = '5'                                     0723 03220000
*              THEN                                                0723 03221000
         B     @RC00721                                            0723 03222000
@RF00721 L     @15,@PC00008                                        0723 03223000
         CLI   CATLOCNO(@15),C'2'                                  0723 03224000
         BE    @RT00723                                            0723 03225000
         CLI   CATLOCNO(@15),C'5'                                  0723 03226000
         BNE   @RF00723                                            0723 03227000
@RT00723 DS    0H                                                  0724 03228000
*                DO;                                               0724 03229000
*                                                                  0724 03230000
*                CTGNOFLD = 3;                                     0725 03231000
         L     @03,CTGPLPTR                                        0725 03232000
         MVI   CTGNOFLD(@03),X'03'                                 0725 03233000
*                CTGFLPTR = ADDR(LOCFPMSC);                        0726 03234000
         LA    CTGFLPTR,LOCFPMSC                                   0726 03235000
*                CTGFLDNM = ADDR(NAMTABL(5));                      0727 03236000
*                                                                  0727 03237000
         LA    @03,NAMTABL+32                                      0727 03238000
         ST    @03,CTGFLDNM(,CTGFLPTR)                             0727 03239000
*                END;                                              0728 03240000
*                                                                  0728 03241000
*              ELSE                                                0729 03242000
*                CTGNOFLD = 2;                                     0729 03243000
*                                                                  0729 03244000
         B     @RC00723                                            0729 03245000
@RF00723 L     @01,CTGPLPTR                                        0729 03246000
         MVI   CTGNOFLD(@01),X'02'                                 0729 03247000
*        /************************************************************/ 03248000
*        /*                                                          */ 03249000
*        /* BUILD AND CHAIN THE TEST FPL FOR NAMEDS WHICH GUARANTEES */ 03250000
*        /* THAT NO MORE THAN THREE ASSOCIATIONS ARE RETURNED        */ 03251000
*        /*                                                          */ 03252000
*        /************************************************************/ 03253000
*                                                                  0730 03254000
*        CTGFLPTR = ADDR(LOCFPTST);                                0730 03255000
*                                                                  0730 03256000
@RC00723 DS    0H                                                  0730 03257000
@RC00721 LA    @15,LOCFPTST                                        0730 03258000
         LR    CTGFLPTR,@15                                        0730 03259000
*        CTGFLDNO = 1;                                             0731 03260000
         MVI   CTGFLDNO(CTGFLPTR),X'01'                            0731 03261000
*        CTGFLDCD = CTGFLDLE;                                      0732 03262000
         MVI   CTGFLDCD(CTGFLPTR),X'C0'                            0732 03263000
*        CTGFLDNM = ADDR(NAMTABL(4));                              0733 03264000
         LA    @03,NAMTABL+24                                      0733 03265000
         ST    @03,CTGFLDNM(,CTGFLPTR)                             0733 03266000
*        CTGFLNG(1) = 2;                                           0734 03267000
         MVC   CTGFLNG(4,CTGFLPTR),@CF00154                        0734 03268000
*        CTGFLPT(1) = ADDR(NAMEMASK);                              0735 03269000
*                                                                  0735 03270000
         LA    @03,NAMEMASK                                        0735 03271000
         ST    @03,CTGFLPT(,CTGFLPTR)                              0735 03272000
*        CTGFLPTR = ADDR(LOCFPNAM);                                0736 03273000
         LA    CTGFLPTR,LOCFPNAM                                   0736 03274000
*        CTGFLCHN = ADDR(LOCFPTST);                                0737 03275000
*                                                                  0737 03276000
         ST    @15,CTGFLCHN(,CTGFLPTR)                             0737 03277000
*        /************************************************************/ 03278000
*        /*                                                          */ 03279000
*        /* ISSUE THE CATALOG LOCATE REQUEST                         */ 03280000
*        /*                                                          */ 03281000
*        /************************************************************/ 03282000
*                                                                  0738 03283000
*        CALL IDCSACA0 (GDTTBL, CTGPLPTR);                         0738 03284000
*                                                                  0738 03285000
         L     @15,@PC00001                                        0738 03286000
         ST    @15,@AL00001                                        0738 03287000
         LA    @14,CTGPLPTR                                        0738 03288000
         ST    @14,@AL00001+4                                      0738 03289000
         L     @15,GDTCAT(,@15)                                    0738 03290000
         LA    @01,@AL00001                                        0738 03291000
         BALR  @14,@15                                             0738 03292000
*        RFY RTNREG RSTD;                                          0739 03293000
*        CATRETCC = RTNREG;                                        0740 03294000
         STH   RTNREG,CATRETCC                                     0740 03295000
*        RFY RTNREG UNRSTD;                                        0741 03296000
*                                                                  0741 03297000
*        IF GDTDBG = NULLPTR                                       0742 03298000
*          THEN;                                                   0742 03299000
         L     @15,@PC00001                                        0742 03300000
         L     @15,GDTDBG(,@15)                                    0742 03301000
         LTR   @15,@15                                             0742 03302000
         BZ    @RT00742                                            0742 03303000
*          ELSE                                                    0744 03304000
*            CALL IDCDB010 (GDTTBL,'BIL2');                        0744 03305000
*                                                                  0744 03306000
         L     @15,@PC00001                                        0744 03307000
         ST    @15,@AL00001                                        0744 03308000
         LA    @14,@CC01284                                        0744 03309000
         ST    @14,@AL00001+4                                      0744 03310000
         MVI   @AL00001+4,X'80'                                    0744 03311000
         L     @15,GDTDBG(,@15)                                    0744 03312000
         LA    @01,@AL00001                                        0744 03313000
         BALR  @14,@15                                             0744 03314000
*        IF CATRETCC ^= 0                                          0745 03315000
*          THEN                                                    0745 03316000
@RT00742 LH    @15,CATRETCC                                        0745 03317000
         LTR   @15,@15                                             0745 03318000
         BZ    @RF00745                                            0745 03319000
*            DO;                                                   0746 03320000
*                                                                  0746 03321000
*            CASTID = LOCATERR;                                    0747 03322000
         L     @15,@PC00008+20                                     0747 03323000
         MVC   CASTID(4,@15),@CB00920                              0747 03324000
*            RETURN CODE(LASTCC12);                                0748 03325000
*                                                                  0748 03326000
         LA    @15,12                                              0748 03327000
         L     @14,@SA00008                                        0748 03328000
         LM    @00,@12,@SA00008+8                                  0748 03329000
         BR    @14                                                 0748 03330000
*            END;                                                  0749 03331000
*                                                                  0749 03332000
*        /************************************************************/ 03333000
*        /*                                                          */ 03334000
*        /* MOVE POINTERS TO DATA RETURNED FROM FPLS TO SAVE AREA    */ 03335000
*        /* WHERE THEY WILL BE REFERENCED BY LOCPROC                 */ 03336000
*        /*                                                          */ 03337000
*        /************************************************************/ 03338000
*                                                                  0750 03339000
*        CTGFLPTR = ADDR(LOCFPENT);                                0750 03340000
@RF00745 LA    CTGFLPTR,LOCFPENT                                   0750 03341000
*        STOPL = OFF;                                              0751 03342000
*                                                                  0751 03343000
         NI    STOPL,B'01111111'                                   0751 03344000
*        DO LC = 1 TO 2 WHILE STOPL = OFF;                         0752 03345000
*                                                                  0752 03346000
         LA    LC,1                                                0752 03347000
@DL00752 TM    STOPL,B'10000000'                                   0752 03348000
         BNZ   @DC00752                                            0752 03349000
*          IF CTGFLNG(1) ^= 0                                      0753 03350000
*            THEN                                                  0753 03351000
         L     @15,CTGFLNG(,CTGFLPTR)                              0753 03352000
         LTR   @15,@15                                             0753 03353000
         BZ    @RF00753                                            0753 03354000
*              CATLOPTR(LC) = CTGFLPT(1);                          0754 03355000
*                                                                  0754 03356000
         LR    @15,LC                                              0754 03357000
         SLA   @15,2                                               0754 03358000
         L     @14,@PC00008+12                                     0754 03359000
         L     @07,CTGFLPT(,CTGFLPTR)                              0754 03360000
         AL    @14,@CF01678                                        0754 03361000
         ST    @07,CATLOPTR(@15,@14)                               0754 03362000
*            ELSE                                                  0755 03363000
*              STOPL = ON;                                         0755 03364000
*                                                                  0755 03365000
         B     @RC00753                                            0755 03366000
@RF00753 OI    STOPL,B'10000000'                                   0755 03367000
*          CTGFLPTR = CTGFLPTR + LENGTH(CTGFL) + LENGTH(CTGFLDAT); 0756 03368000
*                                                                  0756 03369000
@RC00753 AL    CTGFLPTR,@CF00311                                   0756 03370000
*        END;                                                      0757 03371000
*                                                                  0757 03372000
         AL    LC,@CF00220                                         0757 03373000
         C     LC,@CF00154                                         0757 03374000
         BNH   @DL00752                                            0757 03375000
@DC00752 DS    0H                                                  0758 03376000
*        IF CATLOCNO = '1'                                         0758 03377000
*          THEN                                                    0758 03378000
         L     @03,@PC00008                                        0758 03379000
         CLI   CATLOCNO(@03),C'1'                                  0758 03380000
         BNE   @RF00758                                            0758 03381000
*            IF CTGFLNG(1) ^= 0                                    0759 03382000
*              THEN                                                0759 03383000
         L     @03,CTGFLNG(,CTGFLPTR)                              0759 03384000
         LTR   @03,@03                                             0759 03385000
         BZ    @RF00759                                            0759 03386000
*                CATACBPT = CTGFLPT(1) -> ACBADDR;                 0760 03387000
*                                                                  0760 03388000
         L     @03,CTGFLPT(,CTGFLPTR)                              0760 03389000
         L     @03,ACBADDR(,@03)                                   0760 03390000
         ST    @03,CATACBPT                                        0760 03391000
*              ELSE                                                0761 03392000
*                STOPL = ON;                                       0761 03393000
*                                                                  0761 03394000
         B     @RC00759                                            0761 03395000
@RF00759 OI    STOPL,B'10000000'                                   0761 03396000
*          ELSE                                                    0762 03397000
*            IF CATLOCNO = '2' |                                   0762 03398000
*               CATLOCNO = '5'                                     0762 03399000
*              THEN                                                0762 03400000
         B     @RC00758                                            0762 03401000
@RF00758 L     @03,@PC00008                                        0762 03402000
         CLI   CATLOCNO(@03),C'2'                                  0762 03403000
         BE    @RT00762                                            0762 03404000
         CLI   CATLOCNO(@03),C'5'                                  0762 03405000
         BNE   @RF00762                                            0762 03406000
@RT00762 DS    0H                                                  0763 03407000
*                IF CTGFLNG(1) ^= 0                                0763 03408000
*                  THEN                                            0763 03409000
         L     @03,CTGFLNG(,CTGFLPTR)                              0763 03410000
         LTR   @03,@03                                             0763 03411000
         BZ    @RF00763                                            0763 03412000
*                    CATLOPTR(3) = CTGFLPT(1);                     0764 03413000
*                                                                  0764 03414000
         L     @03,@PC00008+12                                     0764 03415000
         L     @15,CTGFLPT(,CTGFLPTR)                              0764 03416000
         ST    @15,CATLOPTR+8(,@03)                                0764 03417000
*                  ELSE                                            0765 03418000
*                    STOPL = ON;                                   0765 03419000
*                                                                  0765 03420000
         B     @RC00763                                            0765 03421000
@RF00763 OI    STOPL,B'10000000'                                   0765 03422000
*        /************************************************************/ 03423000
*        /*                                                          */ 03424000
*        /* ALL DATA MUST BE RETURNED FOR THE LOCATE TO BE           */ 03425000
*        /* SUCCESSFUL.  OTHERWISE, RETURN WITH CONDITION CODE 12    */ 03426000
*        /*                                                          */ 03427000
*        /************************************************************/ 03428000
*                                                                  0766 03429000
*        IF STOPL = ON                                             0766 03430000
*          THEN                                                    0766 03431000
@RC00763 DS    0H                                                  0766 03432000
@RF00762 DS    0H                                                  0766 03433000
@RC00758 TM    STOPL,B'10000000'                                   0766 03434000
         BNO   @RF00766                                            0766 03435000
*            DO;                                                   0767 03436000
*                                                                  0767 03437000
*            CASTID = LOCRTNER;                                    0768 03438000
         L     @15,@PC00008+20                                     0768 03439000
         MVC   CASTID(4,@15),@CB00914                              0768 03440000
*            RETURN CODE(LASTCC12);                                0769 03441000
*                                                                  0769 03442000
         LA    @15,12                                              0769 03443000
         L     @14,@SA00008                                        0769 03444000
         LM    @00,@12,@SA00008+8                                  0769 03445000
         BR    @14                                                 0769 03446000
*            END;                                                  0770 03447000
*                                                                  0770 03448000
*        RETURN CODE(LASTCC00);                                    0771 03449000
*                                                                  0771 03450000
@RF00766 SLR   @15,@15                                             0771 03451000
         L     @14,@SA00008                                        0771 03452000
         LM    @00,@12,@SA00008+8                                  0771 03453000
         BR    @14                                                 0771 03454000
*END CATPROC;                                                      0772 03455000
*        /************************************************************/ 03456000
*        /*                                                          */ 03457000
*        /* PROCEDURE NAME - DEFPROC                                 */ 03458000
*        /*                                                          */ 03459000
*        /* FUNCTION - PERFORMS THE FUNCTION OF DEFINING THE         */ 03460000
*        /*            EXTERNAL SORT WORK FILES IF THE CALLER        */ 03461000
*        /*            SPECIFIES THE EXTERNALSORT PARAMETER OR IF    */ 03462000
*        /*            THERE IS INSUFFICIENT MAIN STORAGE TO         */ 03463000
*        /*            PERFORM AN INTERNAL SORT.  DEFPROC            */ 03464000
*        /*            OBTAINS STORAGE FOR THE CPL/FVT/FPL COMPLEX,  */ 03465000
*        /*            INITIALIZES THE CPL AND BUILDS FVTS AS        */ 03466000
*        /*            FOLLOWS -                                     */ 03467000
*        /*                                                          */ 03468000
*        /*              . CLUSTER FVT REFERENCES                    */ 03469000
*        /*                   SORT WORK FILE DATA SET NAME           */ 03470000
*        /*                   CREATION DATE FPL - DATE OBTAINED      */ 03471000
*        /*                     USING UTIME MACRO                    */ 03472000
*        /*                   EXPIRATION DATE FPL - SET TO HIGHEST   */ 03473000
*        /*                     POSSIBLE DATE(DATA SETS ARE DELETED  */ 03474000
*        /*                     WITH PURGE)                          */ 03475000
*        /*                                                          */ 03476000
*        /*              . DATA FVT REFERENCES                       */ 03477000
*        /*                   CREATION DATE FPL - SAME AS CLUSTER    */ 03478000
*        /*                   SPACE FPL - ALLOCATION IN RECORDS,     */ 03479000
*        /*                     PRIMARY IS TOTAL NUMBER OF 2K        */ 03480000
*        /*                     BLOCKS, SECONDARY IS 10 PERCENT OF   */ 03481000
*        /*                     PRIMARY                              */ 03482000
*        /*                   AMDSB FPL - ATTRIBUTES ARE ESDS, NO    */ 03483000
*        /*                     WRITECHECK, NONSPANNED, LRECL OF     */ 03484000
*        /*                     2041, CISIZE OF 2048                 */ 03485000
*        /*                   DSATTR FPL - ATTRIBUTES ARE SPEED,     */ 03486000
*        /*                     NOERASE, REUSE                       */ 03487000
*        /*                   LRECL FPL - AVERAGE RECORD SIZE OF     */ 03488000
*        /*                     2041                                 */ 03489000
*        /*                   VOLUME SERIAL LIST                     */ 03490000
*        /*                                                          */ 03491000
*        /*                 FOLLOWING A SUCCESSFUL DEFINE OF BOTH    */ 03492000
*        /*                 WORK FILES, DEFPROC CALLS OPENPROC TO    */ 03493000
*        /*                 OPEN THEM.  IF EXTERNAL SORT WORK FILES  */ 03494000
*        /*                 ALREADY EXIST ON ENTRANCE TO THIS        */ 03495000
*        /*                 PROCEDURE, THEY WILL BE USED IF THEY     */ 03496000
*        /*                 ARE LARGE ENOUGH.  OTHERWISE, THEY ARE   */ 03497000
*        /*                 DELETED AND REDEFINED                    */ 03498000
*        /*                                                          */ 03499000
*        /* INPUT -                                                  */ 03500000
*        /*        DEFCALID - IDENTIFICATION OF CALLER               */ 03501000
*        /*                                                          */ 03502000
*        /*        DEFIOIN  - AREA CONTAINING THE ADDRESSES OF THE   */ 03503000
*        /*                   DATA OBTAINED FROM THE SORT WORK JOB   */ 03504000
*        /*                   CONTROL                                */ 03505000
*        /*                                                          */ 03506000
*        /*        DEFSRTTB - SORT CONTROL TABLE                     */ 03507000
*        /*                                                          */ 03508000
*        /* OUTPUT -                                                 */ 03509000
*        /*         DEFIOCS - AREA CONTAINING THE ADDRESSES OF THE   */ 03510000
*        /*                   IOCSTR FOR EACH OPEN SORT WORK FILE    */ 03511000
*        /*                                                          */ 03512000
*        /*         DEFSTAT - STATUS COMMUNICATION AREA              */ 03513000
*        /*                                                          */ 03514000
*        /* EXIT,NORMAL - SORT WORK FILES HAVE BEEN SUCCESSFULLY     */ 03515000
*        /*               DEFINED AND OPENED                         */ 03516000
*        /*                                                          */ 03517000
*        /* EXIT,ERROR  - RETURN CODE 8                              */ 03518000
*        /*                 . EXTERNAL SORT JOB CONTROL NOT PROVIDED */ 03519000
*        /*                 . DEFINE FAILED                          */ 03520000
*        /*                 . OPEN FAILED                            */ 03521000
*        /*                                                          */ 03522000
*        /************************************************************/ 03523000
*                                                                  0773 03524000
*DEFPROC:                                                          0773 03525000
*        PROCEDURE (DEFCALID,           /* CALLER IDENTIFICATION     */ 03526000
*                   DEFIOIN,            /* POINTERS TO SORT WORK     */ 03527000
*                                       /* JOB CONTROL DATA          */ 03528000
*                   DEFIOCS,            /* POINTERS TO IOCSTR FOR    */ 03529000
*                                       /* EACH OPEN DATA SET        */ 03530000
*                   DEFSRTTB,           /* SORT CONTROL TABLE        */ 03531000
*                   DEFSTAT);           /* STATUS COMMUNICATION AREA */ 03532000
*                                                                  0773 03533000
DEFPROC  STM   @14,@12,@SA00009                                    0773 03534000
         MVC   @PC00009(20),0(@01)                                 0773 03535000
*        /************************************************************/ 03536000
*        /*                                                          */ 03537000
*        /* ARGUMENTS OF INVOCATION                                  */ 03538000
*        /*                                                          */ 03539000
*        /************************************************************/ 03540000
*                                                                  0774 03541000
*        DCL DEFCALID CHAR(1);          /* CALLER IDENTIFICATION -   */ 03542000
*                                       /* 'S' - INITPROC AT START   */ 03543000
*                                       /*       OF SORT             */ 03544000
*                                       /* 'C' - SPILPROC WHEN       */ 03545000
*                                       /*       INTERNAL SORT AREA  */ 03546000
*                                       /*       FILLED              */ 03547000
*                                                                  0775 03548000
*        DCL 1 DEFIOIN BDY(WORD),       /* POINTERS TO RETURN AREA   */ 03549000
*              2 DFIOINPT(2) PTR(31);   /* CONTAINING JOB CONTROL    */ 03550000
*                                       /* DATA                      */ 03551000
*                                                                  0776 03552000
*        DCL 1 DEFIOCS BDY(WORD),       /* POINTERS TO IOCSTR FOR    */ 03553000
*              2 DFIOCSBS PTR(31),      /* OPEN DATA SETS            */ 03554000
*              2 DFIOCSAX PTR(31),                                 0776 03555000
*              2 DFIOCSSR(2) PTR(31);                              0776 03556000
*                                                                  0776 03557000
*        DCL DEFSRTTB;                  /* SORT CONTROL TABLE        */ 03558000
*                                                                  0777 03559000
*        DCL 1 DEFSTAT,                 /* STATUS COMMUNICATION AREA */ 03560000
*              2 DFSAVERC FIXED(15),    /* CURRENT CONDITION CODE    */ 03561000
*              2 DFSTID   CHAR(4);      /* ERROR IDENTIFIER          */ 03562000
*                                                                  0778 03563000
*        /************************************************************/ 03564000
*        /*                                                          */ 03565000
*        /* LOOP CONTROL VARIABLES                                   */ 03566000
*        /*                                                          */ 03567000
*        /************************************************************/ 03568000
*                                                                  0779 03569000
*        DCL                                                       0779 03570000
*          DF FIXED(31),                                           0779 03571000
*          VS FIXED(31);                                           0779 03572000
*                                                                  0779 03573000
*        /************************************************************/ 03574000
*        /*                                                          */ 03575000
*        /* VARIABLE USED BY UTIME MACRO ISSUED TO OBTAIN CURRENT    */ 03576000
*        /* DATE                                                     */ 03577000
*        /*                                                          */ 03578000
*        /************************************************************/ 03579000
*                                                                  0780 03580000
*        DCL TIMEODAY CHAR(8);                                     0780 03581000
*                                                                  0780 03582000
*        /************************************************************/ 03583000
*        /*                                                          */ 03584000
*        /* FIELD NAMES OF DATA DEFINED                              */ 03585000
*        /*                                                          */ 03586000
*        /************************************************************/ 03587000
*                                                                  0781 03588000
*        DCL DEFNMTAB(6) CHAR(8) INIT('DSETCRDT','DSETEXDT',       0781 03589000
*              'SPACPARM','AMDSBCAT','DSATTR','LRECL');            0781 03590000
*                                                                  0781 03591000
*        /************************************************************/ 03592000
*        /*                                                          */ 03593000
*        /* SPACE ALLOCATION CODE - RECORDS                          */ 03594000
*        /*                                                          */ 03595000
*        /************************************************************/ 03596000
*                                                                  0782 03597000
*        DCL SPRECDS BIT(8) CONSTANT('40'X);                       0782 03598000
*        /************************************************************/ 03599000
*        /*                                                          */ 03600000
*        /* DETERMINE IF EXTERNAL SORT JOB CONTROL WAS PROVIDED.     */ 03601000
*        /* IF NOT RETURN WITH AN ERROR.  ERROR MESSAGE VARIES       */ 03602000
*        /* WITH THE CALLER OF DEFPROC AND INDICATES WHETHER THE     */ 03603000
*        /* SORT COULD NOT START OR COULD NOT CONTINUE               */ 03604000
*        /*                                                          */ 03605000
*        /************************************************************/ 03606000
*                                                                  0783 03607000
*        OLDERID2 = NEWERID2;                                      0783 03608000
         L     @15,@PC00001                                        0783 03609000
         L     @15,GDTTR2(,@15)                                    0783 03610000
         MVC   @TS00001(95),NEWERID2(@15)                          0783 03611000
         MVC   OLDERID2(95,@15),@TS00001                           0783 03612000
*        NEWID2 = 'BID1';                                          0784 03613000
*                                                                  0784 03614000
         MVC   NEWID2(4,@15),@CC01315                              0784 03615000
*        IF DFIOINPT(1) = NULLPTR                                  0785 03616000
*          THEN                                                    0785 03617000
         L     @15,@PC00009+4                                      0785 03618000
         L     @15,DFIOINPT(,@15)                                  0785 03619000
         LTR   @15,@15                                             0785 03620000
         BNZ   @RF00785                                            0785 03621000
*            DO;                                                   0786 03622000
*                                                                  0786 03623000
*            IF DEFCALID = 'S'                                     0787 03624000
*              THEN                                                0787 03625000
         L     @15,@PC00009                                        0787 03626000
         CLI   DEFCALID(@15),C'S'                                  0787 03627000
         BNE   @RF00787                                            0787 03628000
*                DFSTID = SORTSTRT;                                0788 03629000
*                                                                  0788 03630000
         L     @15,@PC00009+16                                     0788 03631000
         MVC   DFSTID(4,@15),@CB00902                              0788 03632000
*              ELSE                                                0789 03633000
*                DFSTID = SORTCONT;                                0789 03634000
*                                                                  0789 03635000
         B     @RC00787                                            0789 03636000
@RF00787 L     @15,@PC00009+16                                     0789 03637000
         MVC   DFSTID(4,@15),@CB00904                              0789 03638000
*            RETURN CODE(LASTCC08);                                0790 03639000
*                                                                  0790 03640000
@RC00787 LA    @15,8                                               0790 03641000
         L     @14,@SA00009                                        0790 03642000
         LM    @00,@12,@SA00009+8                                  0790 03643000
         BR    @14                                                 0790 03644000
*            END;                                                  0791 03645000
*                                                                  0791 03646000
*        /************************************************************/ 03647000
*        /*                                                          */ 03648000
*        /* IF THE REQUIREMENTS FOR THE CURRENT SORT CAN BE          */ 03649000
*        /* BE ANSWERED BY SORT WORK FILES WHICH HAVE ALREADY BEEN   */ 03650000
*        /* DEFINED, BYPASS THE DEFINE PROCESS                       */ 03651000
*        /*                                                          */ 03652000
*        /************************************************************/ 03653000
*                                                                  0792 03654000
*        IF SRTFLDEF = ON &                                        0792 03655000
*           SRTFLSIZ >= SRTBKTOT                                   0792 03656000
*          THEN;                                                   0792 03657000
*                                                                  0792 03658000
@RF00785 TM    SRTFLDEF,B'10000000'                                0792 03659000
         BNO   @RF00792                                            0792 03660000
         L     @15,SRTFLSIZ                                        0792 03661000
         C     @15,SRTBKTOT                                        0792 03662000
         BNL   @RT00792                                            0792 03663000
*          ELSE                                                    0794 03664000
*DEFSWFLS:   DO;                                                   0794 03665000
*                                                                  0794 03666000
@RF00792 DS    0H                                                  0794 03667000
DEFSWFLS DS    0H                                                  0795 03668000
*            /********************************************************/ 03669000
*            /*                                                      */ 03670000
*            /* IF SORT WORK FILES EXIST WHICH ARE NOT LARGE ENOUGH, */ 03671000
*            /* CALL DELTPROC TO DELETE THEM                         */ 03672000
*            /*                                                      */ 03673000
*            /********************************************************/ 03674000
*                                                                  0795 03675000
*            IF SRTFLDEF = ON                                      0795 03676000
*              THEN                                                0795 03677000
         TM    SRTFLDEF,B'10000000'                                0795 03678000
         BNO   @RF00795                                            0795 03679000
*                DO;                                               0796 03680000
*                                                                  0796 03681000
*                CALL DELTPROC (DEFIOIN);                          0797 03682000
*                                                                  0797 03683000
         L     @15,@PC00009+4                                      0797 03684000
         ST    @15,@AL00001                                        0797 03685000
         LA    @01,@AL00001                                        0797 03686000
         BAL   @14,DELTPROC                                        0797 03687000
*                SRTFLDEF = OFF;                                   0798 03688000
         NI    SRTFLDEF,B'01111111'                                0798 03689000
*                SRTFLSIZ = NULLPTR;                               0799 03690000
*                                                                  0799 03691000
         SLR   @15,@15                                             0799 03692000
         ST    @15,SRTFLSIZ                                        0799 03693000
*                END;                                              0800 03694000
*                                                                  0800 03695000
*            /********************************************************/ 03696000
*            /*                                                      */ 03697000
*            /* CORE FOR THE CPL/FVT/FPL COMPLEX WAS OBTAINED BY     */ 03698000
*            /* INITPROC.  ONE 2K BUFFER PRECEDES THE AREA TO BE     */ 03699000
*            /* USED BY DEFPROC.  CALCULATE THE STARTING ADDRESS.    */ 03700000
*            /*                                                      */ 03701000
*            /********************************************************/ 03702000
*                                                                  0801 03703000
*            DFCPPTR = SRTBUFPT + BLKSIZE;                         0801 03704000
*                                                                  0801 03705000
@RF00795 LA    DFCPPTR,2048                                        0801 03706000
         AL    DFCPPTR,SRTBUFPT                                    0801 03707000
*            DEFPTR = DFCPPTR + LENGTH(DFCPAREA);                  0802 03708000
*                                                                  0802 03709000
         LA    DEFPTR,488                                          0802 03710000
         ALR   DEFPTR,DFCPPTR                                      0802 03711000
*            /********************************************************/ 03712000
*            /*                                                      */ 03713000
*            /* INITIALIZE THE STATIC PORTIONS OF THE CPL            */ 03714000
*            /*                                                      */ 03715000
*            /********************************************************/ 03716000
*                                                                  0803 03717000
*            CTGPLPTR = ADDR(DEFCPL);                              0803 03718000
*                                                                  0803 03719000
         LA    @04,DEFCPL(,DFCPPTR)                                0803 03720000
         ST    @04,CTGPLPTR                                        0803 03721000
*            CPLID    = 'DEFINCPL';                                0804 03722000
         MVC   CPLID(8,DFCPPTR),@CC01318                           0804 03723000
*            CTGNAME  = ON;                                        0805 03724000
*            CTGCNAME = ON;                                        0806 03725000
         OI    CTGNAME(@04),B'00000110'                            0806 03726000
*            CTGFUNC  = CTGCMS;                                    0807 03727000
         NI    CTGFUNC(@04),B'10011111'                            0807 03728000
         OI    CTGFUNC(@04),B'10000000'                            0807 03729000
*            CTGAM0   = ON;                                        0808 03730000
         OI    CTGAM0(@04),B'00000001'                             0808 03731000
*            CTGOPTNS = CTGDEFIN;                                  0809 03732000
         NI    CTGOPTNS(@04),B'00001111'                           0809 03733000
         OI    CTGOPTNS(@04),B'00001000'                           0809 03734000
*            CTGWKA   = ADDR(NAMESWKA);                            0810 03735000
         LA    @02,NAMESWKA(,DFCPPTR)                              0810 03736000
         ST    @02,CTGWKA(,@04)                                    0810 03737000
*            CTGFVT   = ADDR(CLSTRFVT);                            0811 03738000
*                                                                  0811 03739000
         LA    @02,CLSTRFVT(,DFCPPTR)                              0811 03740000
         ST    @02,CTGFVT(,@04)                                    0811 03741000
*            IF ADDR(CAT) ^= NULLPTR                               0812 03742000
*              THEN                                                0812 03743000
         L     @02,@PC00001+4                                      0812 03744000
         L     @02,FDTPTR+16(,@02)                                 0812 03745000
         LTR   @02,@02                                             0812 03746000
         BZ    @RF00812                                            0812 03747000
*                DO;                                               0813 03748000
*                                                                  0813 03749000
*                CTGCAT = ADDR(CATVAL);                            0814 03750000
*                                                                  0814 03751000
         LA    @15,CATVAL(,@02)                                    0814 03752000
         ST    @15,CTGCAT(,@04)                                    0814 03753000
*                IF CATPLN ^= 0                                    0815 03754000
*                  THEN                                            0815 03755000
         CLI   CATPLN(@02),0                                       0815 03756000
         BE    @RF00815                                            0815 03757000
*                    CTGPSWD = ADDR(CATPAS);                       0816 03758000
*                                                                  0816 03759000
         LA    @02,CATPAS(,@02)                                    0816 03760000
         ST    @02,CTGPSWD(,@04)                                   0816 03761000
*                END;                                              0817 03762000
*                                                                  0817 03763000
@RF00815 DS    0H                                                  0818 03764000
*            /********************************************************/ 03765000
*            /*                                                      */ 03766000
*            /* INITIALIZE THE STATIC PORTION OF THE CLUSTER FVT     */ 03767000
*            /*                                                      */ 03768000
*            /********************************************************/ 03769000
*                                                                  0818 03770000
*            CTGFVPTR = ADDR(CLSTRFVT);                            0818 03771000
@RF00812 LA    CTGFVPTR,CLSTRFVT(,DFCPPTR)                         0818 03772000
*            CLSTRID  = 'CLSTRFVT';                                0819 03773000
         MVC   CLSTRID(8,DFCPPTR),@CC01319                         0819 03774000
*            CTGFVTYP = 'C';                                       0820 03775000
         MVI   CTGFVTYP(CTGFVPTR),C'C'                             0820 03776000
*            CTGFVDCH = ADDR(DATAFVT);                             0821 03777000
         LA    @04,DATAFVT(,DFCPPTR)                               0821 03778000
         ST    @04,CTGFVDCH(,CTGFVPTR)                             0821 03779000
*            CTGFVEXP = ADDR(EXDTFPL);                             0822 03780000
         LA    @15,EXDTFPL(,DFCPPTR)                               0822 03781000
         ST    @15,CTGFVEXP(,CTGFVPTR)                             0822 03782000
*            CTGFVCRE = ADDR(CRDTFPL);                             0823 03783000
         LA    @15,CRDTFPL(,DFCPPTR)                               0823 03784000
         ST    @15,CTGFVCRE(,CTGFVPTR)                             0823 03785000
*            CTGFVWKA = ADDR(RECVSWKA);                            0824 03786000
*                                                                  0824 03787000
         LA    @14,RECVSWKA(,DFCPPTR)                              0824 03788000
         ST    @14,CTGFVWKA(,CTGFVPTR)                             0824 03789000
*            /********************************************************/ 03790000
*            /*                                                      */ 03791000
*            /* INITIALIZE DATA FVT                                  */ 03792000
*            /*                                                      */ 03793000
*            /********************************************************/ 03794000
*                                                                  0825 03795000
*            CTGFVPTR = ADDR(DATAFVT);                             0825 03796000
         LR    CTGFVPTR,@04                                        0825 03797000
*            DATAID   = 'DATAFVT';                                 0826 03798000
         MVI   DATAID+7(DFCPPTR),C' '                              0826 03799000
         MVC   DATAID(7,DFCPPTR),@CC01320                          0826 03800000
*            CTGFVTYP = 'D';                                       0827 03801000
         MVI   CTGFVTYP(CTGFVPTR),C'D'                             0827 03802000
*            CTGFVCRE = ADDR(CRDTFPL);                             0828 03803000
         ST    @15,CTGFVCRE(,CTGFVPTR)                             0828 03804000
*            CTGFVVLT = DEFPTR + LENGTH(DEFAREAS);                 0829 03805000
         LA    @04,624                                             0829 03806000
         ALR   @04,DEFPTR                                          0829 03807000
         ST    @04,CTGFVVLT(,CTGFVPTR)                             0829 03808000
*            CTGFVSPC = ADDR(SPACEFPL);                            0830 03809000
         LA    @04,SPACEFPL(,DFCPPTR)                              0830 03810000
         ST    @04,CTGFVSPC(,CTGFVPTR)                             0830 03811000
*            CTGFVAMD = ADDR(AMDSBFPL);                            0831 03812000
         LA    @04,AMDSBFPL(,DFCPPTR)                              0831 03813000
         ST    @04,CTGFVAMD(,CTGFVPTR)                             0831 03814000
*            CTGFVATR = ADDR(DSATTFPL);                            0832 03815000
         LA    @04,DSATTFPL(,DFCPPTR)                              0832 03816000
         ST    @04,CTGFVATR(,CTGFVPTR)                             0832 03817000
*            CTGFVLRS = ADDR(LRECLFPL);                            0833 03818000
*                                                                  0833 03819000
         LA    @04,LRECLFPL(,DFCPPTR)                              0833 03820000
         ST    @04,CTGFVLRS(,CTGFVPTR)                             0833 03821000
*            /********************************************************/ 03822000
*            /*                                                      */ 03823000
*            /* INITIALIZE THE STATIC PORTION OF THE FPLS            */ 03824000
*            /*                                                      */ 03825000
*            /********************************************************/ 03826000
*                                                                  0834 03827000
*            CTGFLPTR = ADDR(CRDTFPL);                             0834 03828000
*                                                                  0834 03829000
         LR    CTGFLPTR,@15                                        0834 03830000
*            DO DF = 1 TO 6;                                       0835 03831000
*                                                                  0835 03832000
         LA    DF,1                                                0835 03833000
@DL00835 DS    0H                                                  0836 03834000
*              CTGFLDNO = 1;                                       0836 03835000
         MVI   CTGFLDNO(CTGFLPTR),X'01'                            0836 03836000
*              CTGFLDNM = ADDR(DEFNMTAB(DF));                      0837 03837000
*                                                                  0837 03838000
         LR    @07,DF                                              0837 03839000
         SLA   @07,3                                               0837 03840000
         LA    @07,DEFNMTAB-8(@07)                                 0837 03841000
         ST    @07,CTGFLDNM(,CTGFLPTR)                             0837 03842000
*              CTGFLPTR = CTGFLPTR + LENGTH(CTGFL) + LENGTH(CTGFLDAT);  03843000
*                                                                  0838 03844000
         AL    CTGFLPTR,@CF00311                                   0838 03845000
*            END;                                                  0839 03846000
*                                                                  0839 03847000
         AL    DF,@CF00220                                         0839 03848000
         C     DF,@CF00157                                         0839 03849000
         BNH   @DL00835                                            0839 03850000
*            /********************************************************/ 03851000
*            /*                                                      */ 03852000
*            /* SET UP CREATION DATE FPL - ISSUE UTIME TO            */ 03853000
*            /* OBTAIN CURRENT DATE                                  */ 03854000
*            /*                                                      */ 03855000
*            /********************************************************/ 03856000
*                                                                  0840 03857000
*            CTGFLPTR = ADDR(CRDTFPL);                             0840 03858000
         LA    CTGFLPTR,CRDTFPL(,DFCPPTR)                          0840 03859000
*            CTGFLNG(1) = 3;                                       0841 03860000
         MVC   CTGFLNG(4,CTGFLPTR),@CF00163                        0841 03861000
*            CTGFLPT(1) = ADDR(DEFCRYR);                           0842 03862000
*                                                                  0842 03863000
         LA    @15,DEFCRYR(,DEFPTR)                                0842 03864000
         ST    @15,CTGFLPT(,CTGFLPTR)                              0842 03865000
*            CALL IDCSATI0 (GDTTBL,TIMEODAY,DEFCRDT);              0843 03866000
*                                                                  0843 03867000
         L     @15,@PC00001                                        0843 03868000
         ST    @15,@AL00001                                        0843 03869000
         LA    @14,TIMEODAY                                        0843 03870000
         ST    @14,@AL00001+4                                      0843 03871000
         LA    @14,DEFCRDT(,DEFPTR)                                0843 03872000
         ST    @14,@AL00001+8                                      0843 03873000
         MVI   @AL00001+8,X'80'                                    0843 03874000
         L     @15,GDTTIM(,@15)                                    0843 03875000
         LA    @01,@AL00001                                        0843 03876000
         BALR  @14,@15                                             0843 03877000
*            /********************************************************/ 03878000
*            /*                                                      */ 03879000
*            /* SET UP EXPIRATION DATE FPL USING MAXIMUM EXPIRA-     */ 03880000
*            /* TION DATE.  DATA SETS WILL BE DELETED WITH PURGE     */ 03881000
*            /*                                                      */ 03882000
*            /********************************************************/ 03883000
*                                                                  0844 03884000
*            CTGFLPTR = ADDR(EXDTFPL);                             0844 03885000
         LA    CTGFLPTR,EXDTFPL(,DFCPPTR)                          0844 03886000
*            CTGFLNG(1) = 3;                                       0845 03887000
         MVC   CTGFLNG(4,CTGFLPTR),@CF00163                        0845 03888000
*            CTGFLPT(1) = ADDR(DEFEXPIR);                          0846 03889000
*                                                                  0846 03890000
         LA    @15,DEFEXPIR(,DEFPTR)                               0846 03891000
         ST    @15,CTGFLPT(,CTGFLPTR)                              0846 03892000
*            DEFEXPIR = '99999F'X;                                 0847 03893000
*                                                                  0847 03894000
         MVC   DEFEXPIR(3,DEFPTR),@CB01321                         0847 03895000
*            /********************************************************/ 03896000
*            /*                                                      */ 03897000
*            /* SET UP AMDSBCAT FPL                                  */ 03898000
*            /*                                                      */ 03899000
*            /********************************************************/ 03900000
*                                                                  0848 03901000
*            CTGFLPTR = ADDR(AMDSBFPL);                            0848 03902000
         LA    CTGFLPTR,AMDSBFPL(,DFCPPTR)                         0848 03903000
*            CTGFLNG(1) = LENGTH(IDAAMDSB);                        0849 03904000
         LA    @15,96                                              0849 03905000
         ST    @15,CTGFLNG(,CTGFLPTR)                              0849 03906000
*            CTGFLPT(1) = ADDR(DEFAMDSB);                          0850 03907000
*                                                                  0850 03908000
         ST    DEFPTR,CTGFLPT(,CTGFLPTR)                           0850 03909000
*            AMDSBPTR = ADDR(DEFAMDSB);                            0851 03910000
         LR    AMDSBPTR,DEFPTR                                     0851 03911000
*            AMDLEN   = LENGTH(IDAAMDSB);                          0852 03912000
         STH   @15,AMDLEN(,AMDSBPTR)                               0852 03913000
*            AMDCINV  = BLKSIZE;                                   0853 03914000
         MVC   AMDCINV(4,AMDSBPTR),@CF00976                        0853 03915000
*            AMDLRECL = CILRECL;                                   0854 03916000
*                                                                  0854 03917000
         MVC   AMDLRECL(4,AMDSBPTR),@CF00978                       0854 03918000
*            /********************************************************/ 03919000
*            /*                                                      */ 03920000
*            /* SET UP DSATTR FPL - SPEED, REUSABLE, DEFAULT SHARE   */ 03921000
*            /* OPTIONS                                              */ 03922000
*            /*                                                      */ 03923000
*            /********************************************************/ 03924000
*                                                                  0855 03925000
*            CTGFLPTR = ADDR(DSATTFPL);                            0855 03926000
         LA    CTGFLPTR,DSATTFPL(,DFCPPTR)                         0855 03927000
*            CTGFLNG(1) = 2;                                       0856 03928000
         MVC   CTGFLNG(4,CTGFLPTR),@CF00154                        0856 03929000
*            CTGFLPT(1) = ADDR(DEFDSATT);                          0857 03930000
*                                                                  0857 03931000
         LA    @04,DEFDSATT(,DEFPTR)                               0857 03932000
         ST    @04,CTGFLPT(,CTGFLPTR)                              0857 03933000
*            DEFSPEED = ON;                                        0858 03934000
*            DEFREUS  = ON;                                        0859 03935000
         OI    DEFSPEED(DEFPTR),B'10100000'                        0859 03936000
*            DEFSHAR  = ON;                                        0860 03937000
*                                                                  0860 03938000
         OI    DEFSHAR(DEFPTR),B'00100000'                         0860 03939000
*            /********************************************************/ 03940000
*            /*                                                      */ 03941000
*            /* SET UP LRECL FPL                                     */ 03942000
*            /*                                                      */ 03943000
*            /********************************************************/ 03944000
*                                                                  0861 03945000
*            CTGFLPTR = ADDR(LRECLFPL);                            0861 03946000
         LA    CTGFLPTR,LRECLFPL(,DFCPPTR)                         0861 03947000
*            CTGFLNG(1) = LENGTH(CILRECL);                         0862 03948000
         MVC   CTGFLNG(4,CTGFLPTR),@CF00043                        0862 03949000
*            CTGFLPT(1) = ADDR(CILRECL);                           0863 03950000
*                                                                  0863 03951000
         LA    @04,@CF00978                                        0863 03952000
         ST    @04,CTGFLPT(,CTGFLPTR)                              0863 03953000
*            /********************************************************/ 03954000
*            /*                                                      */ 03955000
*            /* INITIALIZE THE SPACPARM FPL.  THE SPACE REQUIREMENTS */ 03956000
*            /* HAVE BEEN CALCULATED IN INITPROC AS THE NUMBER OF    */ 03957000
*            /* 2K BLOCKS REQUIRED TO CONTAIN ALL SORT RECORDS       */ 03958000
*            /* (PRIMARY ALLOCATION) PLUS 10 PERCENT OF THAT FIGURE  */ 03959000
*            /* (SECONDARY ALLOCATION).  SPACE IS ALLOCATED IN       */ 03960000
*            /* RECORDS.                                             */ 03961000
*            /*                                                      */ 03962000
*            /********************************************************/ 03963000
*                                                                  0864 03964000
*            CTGFLPTR = ADDR(SPACEFPL);                            0864 03965000
         LA    CTGFLPTR,SPACEFPL(,DFCPPTR)                         0864 03966000
*            CTGFLNG(1) = LENGTH(DEFSPACE);                        0865 03967000
         MVC   CTGFLNG(4,CTGFLPTR),@CF00629                        0865 03968000
*            CTGFLPT(1) = ADDR(DEFSPACE);                          0866 03969000
*                                                                  0866 03970000
         LA    @04,DEFSPACE(,DEFPTR)                               0866 03971000
         ST    @04,CTGFLPT(,CTGFLPTR)                              0866 03972000
*            DEFPRIME = SRTBKTOT;                                  0867 03973000
         MVC   DEFPRIME(3,DEFPTR),SRTBKTOT+1                       0867 03974000
*            DEFSECND = SRTBK10;                                   0868 03975000
         MVC   DEFSECND(3,DEFPTR),SRTBK10+1                        0868 03976000
*            DEFSPTYP = SPRECDS;                                   0869 03977000
*                                                                  0869 03978000
         MVI   DEFSPTYP(DEFPTR),X'40'                              0869 03979000
*            /********************************************************/ 03980000
*            /*                                                      */ 03981000
*            /* SAVE CPL/FVT/FPL COMPLEX JUST INITIALIZED SINCE      */ 03982000
*            /* VSAM CATALOG MANAGEMENT DESTROYS CERTAIN AREAS       */ 03983000
*            /*                                                      */ 03984000
*            /********************************************************/ 03985000
*                                                                  0870 03986000
*            DEFSVCPL = CPFVAREA;                                  0870 03987000
         MVC   DEFSVCPL(240,DEFPTR),CPFVAREA(DFCPPTR)              0870 03988000
*            DEFSVFPL = FPLAREA;                                   0871 03989000
         MVC   DEFSVFPL(144,DEFPTR),FPLAREA(DFCPPTR)               0871 03990000
*            DEFSVDAT  = DEFDATA;                                  0872 03991000
         MVC   DEFSVDAT(120,DEFPTR),DEFDATA(DEFPTR)                0872 03992000
*            /********************************************************/ 03993000
*            /*                                                      */ 03994000
*            /* FOR EACH SORT WORK FILE COMPLETE THE INITIALIZATION  */ 03995000
*            /* AND ISSUE THE DEFINE REQUEST.  INITIALIZE THE        */ 03996000
*            /* CATALOG WORKAREAS                                    */ 03997000
*            /*                                                      */ 03998000
*            /********************************************************/ 03999000
*                                                                  0873 04000000
*DEFCATLG:   DO DF = 1 TO 2;                                       0873 04001000
*                                                                  0873 04002000
DEFCATLG LA    DF,1                                                0873 04003000
@DL00873 DS    0H                                                  0874 04004000
*              DEFWKA = ''B;                                       0874 04005000
         XC    DEFWKA(104,DFCPPTR),DEFWKA(DFCPPTR)                 0874 04006000
*              NAMWKTLN = LENGTH(NAMESWKA);                        0875 04007000
         MVC   NAMWKTLN(2,DFCPPTR),@CH01647                        0875 04008000
*              RECVSTLN = LENGTH(RECVSWKA);                        0876 04009000
*                                                                  0876 04010000
         MVC   RECVSTLN(2,DFCPPTR),@CH00037                        0876 04011000
*              /******************************************************/ 04012000
*              /*                                                    */ 04013000
*              /* REFERENCE THE DATA SET NAME FROM THE CLUSTER FVT   */ 04014000
*              /*                                                    */ 04015000
*              /******************************************************/ 04016000
*                                                                  0877 04017000
*              CTGFVPTR = ADDR(CLSTRFVT);                          0877 04018000
         LA    CTGFVPTR,CLSTRFVT(,DFCPPTR)                         0877 04019000
*              SWDATPTR = DFIOINPT(DF) + 4;                        0878 04020000
*                                                                  0878 04021000
         LA    @07,4                                               0878 04022000
         LR    @15,DF                                              0878 04023000
         SLA   @15,2                                               0878 04024000
         L     @14,@PC00009+4                                      0878 04025000
         AL    @14,@CF01678                                        0878 04026000
         L     SWDATPTR,DFIOINPT(@15,@14)                          0878 04027000
         ALR   SWDATPTR,@07                                        0878 04028000
*              IF IODSNID ^= DSNIDMSK                              0879 04029000
*                THEN                                              0879 04030000
         CLC   IODSNID(2,SWDATPTR),@CB00960                        0879 04031000
         BE    @RF00879                                            0879 04032000
*                  SWDATPTR = SWDATPTR + IODSNLN + 4;              0880 04033000
*                                                                  0880 04034000
         LR    @15,SWDATPTR                                        0880 04035000
         AH    @15,IODSNLN(,SWDATPTR)                              0880 04036000
         ALR   @15,@07                                             0880 04037000
         LR    SWDATPTR,@15                                        0880 04038000
*              CTGFVENT = ADDR(IODSN);                             0881 04039000
*                                                                  0881 04040000
@RF00879 LA    @07,IODSN(,SWDATPTR)                                0881 04041000
         ST    @07,CTGFVENT(,CTGFVPTR)                             0881 04042000
*              /******************************************************/ 04043000
*              /*                                                    */ 04044000
*              /* INITIALIZE THE VOLUME SERIAL LIST AND DNAME        */ 04045000
*              /* POINTER                                            */ 04046000
*              /*                                                    */ 04047000
*              /******************************************************/ 04048000
*                                                                  0882 04049000
*              CTGFVPTR = ADDR(DATAFVT);                           0882 04050000
         LA    CTGFVPTR,DATAFVT(,DFCPPTR)                          0882 04051000
*              SWDATPTR = DFIOINPT(DF) + 4;                        0883 04052000
*                                                                  0883 04053000
         LA    @07,4                                               0883 04054000
         LR    @15,DF                                              0883 04055000
         SLA   @15,2                                               0883 04056000
         L     @14,@PC00009+4                                      0883 04057000
         AL    @14,@CF01678                                        0883 04058000
         L     SWDATPTR,DFIOINPT(@15,@14)                          0883 04059000
         ALR   SWDATPTR,@07                                        0883 04060000
*              IF IOVLSID ^= VLSIDMSK                              0884 04061000
*                THEN                                              0884 04062000
         CLC   IOVLSID(2,SWDATPTR),@CB00962                        0884 04063000
         BE    @RF00884                                            0884 04064000
*                  SWDATPTR = SWDATPTR + IOVLSLN + 4;              0885 04065000
*                                                                  0885 04066000
         LR    @15,SWDATPTR                                        0885 04067000
         AH    @15,IOVLSLN(,SWDATPTR)                              0885 04068000
         ALR   @15,@07                                             0885 04069000
         LR    SWDATPTR,@15                                        0885 04070000
*              VOLLSTLN = IOVLSLN / 6;                             0886 04071000
*                                                                  0886 04072000
@RF00884 L     @07,CTGFVVLT(,CTGFVPTR)                             0886 04073000
         LH    @00,IOVLSLN(,SWDATPTR)                              0886 04074000
         SRDA  @00,32                                              0886 04075000
         D     @00,@CF00157                                        0886 04076000
         STH   @01,VOLLSTLN(,@07)                                  0886 04077000
*              DO VS = 1 TO VOLLSTLN;                              0887 04078000
*                                                                  0887 04079000
         LA    @07,1                                               0887 04080000
         B     @DE00887                                            0887 04081000
@DL00887 DS    0H                                                  0888 04082000
*                VOLCODE(VS) = ''B;                                0888 04083000
         LR    @15,@07                                             0888 04084000
         SLA   @15,3                                               0888 04085000
         L     @14,CTGFVVLT(,CTGFVPTR)                             0888 04086000
         ST    @15,@TF00001                                        0888 04087000
         ALR   @15,@14                                             0888 04088000
         AL    @15,@CF01668                                        0888 04089000
         XC    VOLCODE-2(2,@15),VOLCODE-2(@15)                     0888 04090000
*                VOLSER(VS) = IOVLSER(VS);                         0889 04091000
*                                                                  0889 04092000
         AL    @14,@TF00001                                        0889 04093000
         AL    @14,@CF01678                                        0889 04094000
         LR    @15,@07                                             0889 04095000
         MH    @15,@CH00157                                        0889 04096000
         ALR   @15,SWDATPTR                                        0889 04097000
         BCTR  @15,0                                               0889 04098000
         BCTR  @15,0                                               0889 04099000
         MVC   VOLSER-4(6,@14),IOVLSER-4(@15)                      0889 04100000
*              END;                                                0890 04101000
*                                                                  0890 04102000
         AL    @07,@CF00220                                        0890 04103000
@DE00887 ST    @07,VS                                              0890 04104000
         L     @01,CTGFVVLT(,CTGFVPTR)                             0890 04105000
         CH    @07,VOLLSTLN(,@01)                                  0890 04106000
         BNH   @DL00887                                            0890 04107000
*              VOLLSTLN = VOLLSTLN * 8;                            0891 04108000
*                                                                  0891 04109000
         L     @07,CTGFVVLT(,CTGFVPTR)                             0891 04110000
         LH    @04,VOLLSTLN(,@07)                                  0891 04111000
         SLA   @04,3                                               0891 04112000
         STH   @04,VOLLSTLN(,@07)                                  0891 04113000
*              IF ADDR(WFILE) ^= NULLPTR                           0892 04114000
*                THEN                                              0892 04115000
         L     @07,@PC00001+4                                      0892 04116000
         L     @04,FDTPTR+20(,@07)                                 0892 04117000
         LTR   @04,@04                                             0892 04118000
         BZ    @RF00892                                            0892 04119000
*                  IF DF = 1                                       0893 04120000
*                    THEN                                          0893 04121000
         C     DF,@CF00220                                         0893 04122000
         BNE   @RF00893                                            0893 04123000
*                      CTGFVIND = ADDR(WFLE1VAL);                  0894 04124000
*                                                                  0894 04125000
         L     @07,FDTPTR+24(,@07)                                 0894 04126000
         LA    @07,WFLE1VAL(,@07)                                  0894 04127000
         ST    @07,CTGFVIND(,CTGFVPTR)                             0894 04128000
*                    ELSE                                          0895 04129000
*                      CTGFVIND = ADDR(WFLE2VAL);                  0895 04130000
*                                                                  0895 04131000
         B     @RC00893                                            0895 04132000
@RF00893 L     @07,@PC00001+4                                      0895 04133000
         L     @07,FDTPTR+28(,@07)                                 0895 04134000
         LA    @07,WFLE2VAL(,@07)                                  0895 04135000
         ST    @07,CTGFVIND(,CTGFVPTR)                             0895 04136000
*                ELSE                                              0896 04137000
*                  CTGFVIND = ADDR(DEFDDN(DF));                    0896 04138000
*                                                                  0896 04139000
         B     @RC00892                                            0896 04140000
@RF00892 LR    @07,DF                                              0896 04141000
         SLA   @07,3                                               0896 04142000
         LA    @07,DEFDDN-8(@07)                                   0896 04143000
         ST    @07,CTGFVIND(,CTGFVPTR)                             0896 04144000
*              /******************************************************/ 04145000
*              /*                                                    */ 04146000
*              /* ISSUE THE UCATLG TO DEFINE THE SORT WORK FILE      */ 04147000
*              /*                                                    */ 04148000
*              /******************************************************/ 04149000
*                                                                  0897 04150000
*              CALL IDCSACA0 (GDTTBL,CTGPLPTR);                    0897 04151000
*                                                                  0897 04152000
@RC00892 L     @07,@PC00001                                        0897 04153000
         ST    @07,@AL00001                                        0897 04154000
         LA    @04,CTGPLPTR                                        0897 04155000
         ST    @04,@AL00001+4                                      0897 04156000
         L     @15,GDTCAT(,@07)                                    0897 04157000
         LA    @01,@AL00001                                        0897 04158000
         BALR  @14,@15                                             0897 04159000
*              RFY RTNREG RSTD;                                    0898 04160000
*              CATRETCC = RTNREG;                                  0899 04161000
         STH   RTNREG,CATRETCC                                     0899 04162000
*              RFY RTNREG UNRSTD;                                  0900 04163000
*                                                                  0900 04164000
*              IF GDTDBG = NULLPTR                                 0901 04165000
*                THEN;                                             0901 04166000
         L     @07,@PC00001                                        0901 04167000
         L     @07,GDTDBG(,@07)                                    0901 04168000
         LTR   @07,@07                                             0901 04169000
         BZ    @RT00901                                            0901 04170000
*                ELSE                                              0903 04171000
*                  CALL IDCDB010 (GDTTBL,'BID2');                  0903 04172000
*                                                                  0903 04173000
         L     @07,@PC00001                                        0903 04174000
         ST    @07,@AL00001                                        0903 04175000
         LA    @04,@CC01324                                        0903 04176000
         ST    @04,@AL00001+4                                      0903 04177000
         MVI   @AL00001+4,X'80'                                    0903 04178000
         L     @15,GDTDBG(,@07)                                    0903 04179000
         LA    @01,@AL00001                                        0903 04180000
         BALR  @14,@15                                             0903 04181000
*              IF CATRETCC ^= 0                                    0904 04182000
*                THEN                                              0904 04183000
@RT00901 LH    @07,CATRETCC                                        0904 04184000
         LTR   @07,@07                                             0904 04185000
         BZ    @RF00904                                            0904 04186000
*                  DO;                                             0905 04187000
*                                                                  0905 04188000
*                  DFSTID = DEFERROR;                              0906 04189000
         L     @15,@PC00009+16                                     0906 04190000
         MVC   DFSTID(4,@15),@CB00906                              0906 04191000
*                  RETURN CODE(LASTCC08);                          0907 04192000
*                                                                  0907 04193000
         LA    @15,8                                               0907 04194000
         L     @14,@SA00009                                        0907 04195000
         LM    @00,@12,@SA00009+8                                  0907 04196000
         BR    @14                                                 0907 04197000
*                  END;                                            0908 04198000
*                                                                  0908 04199000
*                /****************************************************/ 04200000
*                /*                                                  */ 04201000
*                /* IF THE FIRST DEFINE WAS SUCCESSFUL RESTORE THE   */ 04202000
*                /* CPL/FVT/FPL COMPLEX FOR THE SECOND DEFINE        */ 04203000
*                /*                                                  */ 04204000
*                /****************************************************/ 04205000
*                                                                  0909 04206000
*                ELSE                                              0909 04207000
*                  DO;                                             0909 04208000
*                                                                  0909 04209000
@RF00904 DS    0H                                                  0910 04210000
*                  CPFVAREA = DEFSVCPL;                            0910 04211000
         MVC   CPFVAREA(240,DFCPPTR),DEFSVCPL(DEFPTR)              0910 04212000
*                  FPLAREA  = DEFSVFPL;                            0911 04213000
         MVC   FPLAREA(144,DFCPPTR),DEFSVFPL(DEFPTR)               0911 04214000
*                  DEFDATA  = DEFSVDAT;                            0912 04215000
         MVC   DEFDATA(120,DEFPTR),DEFSVDAT(DEFPTR)                0912 04216000
*                  SRTFLDEF = ON;                                  0913 04217000
*                                                                  0913 04218000
         OI    SRTFLDEF,B'10000000'                                0913 04219000
*                  END;                                            0914 04220000
*                                                                  0914 04221000
*            END DEFCATLG;                                         0915 04222000
*                                                                  0915 04223000
         AL    DF,@CF00220                                         0915 04224000
         C     DF,@CF00154                                         0915 04225000
         BNH   @DL00873                                            0915 04226000
*            /********************************************************/ 04227000
*            /*                                                      */ 04228000
*            /* THIS COMPLETES THE DEFINITION OF THE SORT WORK       */ 04229000
*            /* FILES.  SAVE THE FILE SIZE                           */ 04230000
*            /*                                                      */ 04231000
*            /********************************************************/ 04232000
*                                                                  0916 04233000
*            SRTFLSIZ = SRTBKTOT;                                  0916 04234000
*                                                                  0916 04235000
         L     @15,SRTBKTOT                                        0916 04236000
         ST    @15,SRTFLSIZ                                        0916 04237000
*            END DEFSWFLS;                                         0917 04238000
*                                                                  0917 04239000
*        /************************************************************/ 04240000
*        /*                                                          */ 04241000
*        /* OPEN EACH SORT WORK DATA SET                             */ 04242000
*        /*                                                          */ 04243000
*        /************************************************************/ 04244000
*                                                                  0918 04245000
*        DO DF = 1 TO 2;                                           0918 04246000
*                                                                  0918 04247000
@RT00792 LA    DF,1                                                0918 04248000
@DL00918 DS    0H                                                  0919 04249000
*          CALL OPENPROC ('S',DFIOCSSR(DF),NULLPTR,DFIOINPT(DF));  0919 04250000
*                                                                  0919 04251000
         LA    @07,@CC01131                                        0919 04252000
         ST    @07,@AL00001                                        0919 04253000
         LR    @07,DF                                              0919 04254000
         SLA   @07,2                                               0919 04255000
         L     @15,@PC00009+8                                      0919 04256000
         LA    @15,DFIOCSSR-4(@07,@15)                             0919 04257000
         ST    @15,@AL00001+4                                      0919 04258000
         LA    @15,@CF00116                                        0919 04259000
         ST    @15,@AL00001+8                                      0919 04260000
         L     @15,@PC00009+4                                      0919 04261000
         AL    @15,@CF01678                                        0919 04262000
         LA    @07,DFIOINPT(@07,@15)                               0919 04263000
         ST    @07,@AL00001+12                                     0919 04264000
         LA    @01,@AL00001                                        0919 04265000
         BAL   @14,OPENPROC                                        0919 04266000
*          RESPECIFY RTNREG RSTD;                                  0920 04267000
*          TESTRC = RTNREG;                                        0921 04268000
         LR    TESTRC,RTNREG                                       0921 04269000
*          RESPECIFY RTNREG UNRSTD;                                0922 04270000
*                                                                  0922 04271000
*          IF TESTRC ^= 0                                          0923 04272000
*            THEN                                                  0923 04273000
         LTR   TESTRC,TESTRC                                       0923 04274000
         BZ    @RF00923                                            0923 04275000
*              RETURN CODE(LASTCC08);                              0924 04276000
*                                                                  0924 04277000
         LA    @15,8                                               0924 04278000
         L     @14,@SA00009                                        0924 04279000
         LM    @00,@12,@SA00009+8                                  0924 04280000
         BR    @14                                                 0924 04281000
*        END;                                                      0925 04282000
*                                                                  0925 04283000
@RF00923 AL    DF,@CF00220                                         0925 04284000
         C     DF,@CF00154                                         0925 04285000
         BNH   @DL00918                                            0925 04286000
*        /************************************************************/ 04287000
*        /*                                                          */ 04288000
*        /* RETURN TO CALLER OF DEFPROC                              */ 04289000
*        /*                                                          */ 04290000
*        /************************************************************/ 04291000
*                                                                  0926 04292000
*        RETURN CODE(LASTCC00);                                    0926 04293000
*                                                                  0926 04294000
         SLR   @15,@15                                             0926 04295000
         L     @14,@SA00009                                        0926 04296000
         LM    @00,@12,@SA00009+8                                  0926 04297000
         BR    @14                                                 0926 04298000
*END DEFPROC;                                                      0927 04299000
*        /************************************************************/ 04300000
*        /*                                                          */ 04301000
*        /* PROCEDURE NAME - DELTPROC                                */ 04302000
*        /*                                                          */ 04303000
*        /* FUNCTION - PERFORMS THE FUNCTION OF DELETING THE SORT    */ 04304000
*        /*            WORK FILES.  THIS PROCEDURE IS CALLED BY      */ 04305000
*        /*            DEFPROC IF DEFINED SORT WORK FILES EXIST      */ 04306000
*        /*            BUT ARE NOT LARGE ENOUGH FOR THE ALTERNATE    */ 04307000
*        /*            INDEX CURRENTLY BEING BUILT AND BY TERMPROC   */ 04308000
*        /*            DURING FINAL CLEANUP                          */ 04309000
*        /*                                                          */ 04310000
*        /* INPUT -                                                  */ 04311000
*        /*         DELTIOIN - AREA CONTAINING THE ADDRESSES OF      */ 04312000
*        /*                    THE DATA OBTAINED FROM THE SORT       */ 04313000
*        /*                    WORK JOB CONTROL                      */ 04314000
*        /*                                                          */ 04315000
*        /************************************************************/ 04316000
*                                                                  0928 04317000
*DELTPROC:                                                         0928 04318000
*        PROCEDURE (DELTIOIN);          /* PTS TO JOB CONTROL DATA   */ 04319000
*                                                                  0928 04320000
DELTPROC STM   @14,@12,@SA00010                                    0928 04321000
         MVC   @PC00010(4),0(@01)                                  0928 04322000
*        /************************************************************/ 04323000
*        /*                                                          */ 04324000
*        /* ARGUMENTS OF INVOCATION                                  */ 04325000
*        /*                                                          */ 04326000
*        /************************************************************/ 04327000
*                                                                  0929 04328000
*        DCL 1 DELTIOIN BDY(WORD),      /* POINTERS TO RETURN AREAS  */ 04329000
*              2 DLIOINPT(2) PTR(31);   /* CONTAINING SORT WORK FILE */ 04330000
*                                       /* JOB CONTROL DATA          */ 04331000
*                                                                  0930 04332000
*        /************************************************************/ 04333000
*        /*                                                          */ 04334000
*        /* LOOP CONTROL VARIABLE                                    */ 04335000
*        /*                                                          */ 04336000
*        /************************************************************/ 04337000
*                                                                  0930 04338000
*        DCL DL FIXED(31);                                         0930 04339000
*                                                                  0930 04340000
*        /************************************************************/ 04341000
*        /*                                                          */ 04342000
*        /* AREA CONTAINING THE DELETE CPL                           */ 04343000
*        /*                                                          */ 04344000
*        /************************************************************/ 04345000
*                                                                  0931 04346000
*        DCL 1 DELCPLAR BDY(WORD),                                 0931 04347000
*              2 DELCPLID CHAR(8),              /* CPL DUMP ID       */ 04348000
*              2 DELCPL   CHAR(LENGTH(CTGPL)),  /* CPL               */ 04349000
*              2 *        CHAR(4),                                 0931 04350000
*              2 DELWKA,                        /* DELETED NAMES     */ 04351000
*                                               /* WORKAREA          */ 04352000
*                3 DELWKTLN FIXED(15),                             0931 04353000
*                3 DELWKRLN FIXED(15),                             0931 04354000
*                3 DELWK(2),                                       0931 04355000
*                  4 DELWKTYP CHAR(1),                             0931 04356000
*                  4 DELWKNAM CHAR(44);                            0931 04357000
*                                                                  0931 04358000
*        /************************************************************/ 04359000
*        /*                                                          */ 04360000
*        /* INITIALIZE THE DELETE CPL                                */ 04361000
*        /*                                                          */ 04362000
*        /************************************************************/ 04363000
*                                                                  0932 04364000
*        OLDERID2 = NEWERID2;                                      0932 04365000
         L     @15,@PC00001                                        0932 04366000
         L     @15,GDTTR2(,@15)                                    0932 04367000
         MVC   @TS00001(95),NEWERID2(@15)                          0932 04368000
         MVC   OLDERID2(95,@15),@TS00001                           0932 04369000
*        NEWID2 = 'BIDL';                                          0933 04370000
*                                                                  0933 04371000
         MVC   NEWID2(4,@15),@CC01342                              0933 04372000
*        DELCPLAR = ''B;                                           0934 04373000
         XC    DELCPLAR(134),DELCPLAR                              0934 04374000
*        DELCPLID = 'DELETCPL';                                    0935 04375000
*                                                                  0935 04376000
         MVC   DELCPLID(8),@CC01343                                0935 04377000
*        CTGPLPTR = ADDR(DELCPL);                                  0936 04378000
         LA    @15,DELCPL                                          0936 04379000
         ST    @15,CTGPLPTR                                        0936 04380000
*        CTGNAME  = ON;                                            0937 04381000
*        CTGCNAME = ON;                                            0938 04382000
         OI    CTGNAME(@15),B'00000110'                            0938 04383000
*        CTGAM0   = ON;                                            0939 04384000
         OI    CTGAM0(@15),B'00000001'                             0939 04385000
*        CTGFUNC  = CTGCMS;                                        0940 04386000
         NI    CTGFUNC(@15),B'10011111'                            0940 04387000
         OI    CTGFUNC(@15),B'10000000'                            0940 04388000
*        CTGOPTNS = CTGDELET;                                      0941 04389000
         NI    CTGOPTNS(@15),B'00011111'                           0941 04390000
         OI    CTGOPTNS(@15),B'00011000'                           0941 04391000
*        CTGTYPE  = 'C';                                           0942 04392000
         MVI   CTGTYPE(@15),C'C'                                   0942 04393000
*        CTGPURG  = ON;                                            0943 04394000
*                                                                  0943 04395000
         OI    CTGPURG(@15),B'00100000'                            0943 04396000
*        DELWKTLN = LENGTH(DELWKA);                                0944 04397000
         MVC   DELWKTLN(2),@CH01647                                0944 04398000
*        CTGWKA   = ADDR(DELWKA);                                  0945 04399000
*                                                                  0945 04400000
         LA    @14,DELWKA                                          0945 04401000
         ST    @14,CTGWKA(,@15)                                    0945 04402000
*        /************************************************************/ 04403000
*        /*                                                          */ 04404000
*        /* IF THE CATALOG PARAMETER HAS BEEN SPECIFIED, REFERENCE IT*/ 04405000
*        /* FROM THE CPL TOGETHER WITH ITS PASSWORD IF SPECIFIED     */ 04406000
*        /*                                                          */ 04407000
*        /************************************************************/ 04408000
*                                                                  0946 04409000
*        IF ADDR(CAT) ^= NULLPTR                                   0946 04410000
*          THEN                                                    0946 04411000
         L     @14,@PC00001+4                                      0946 04412000
         L     @14,FDTPTR+16(,@14)                                 0946 04413000
         LTR   @14,@14                                             0946 04414000
         BZ    @RF00946                                            0946 04415000
*            DO;                                                   0947 04416000
*                                                                  0947 04417000
*            CTGCAT = ADDR(CATVAL);                                0948 04418000
*                                                                  0948 04419000
         LA    @07,CATVAL(,@14)                                    0948 04420000
         ST    @07,CTGCAT(,@15)                                    0948 04421000
*            IF CATPLN ^= 0                                        0949 04422000
*              THEN                                                0949 04423000
         CLI   CATPLN(@14),0                                       0949 04424000
         BE    @RF00949                                            0949 04425000
*                CTGPSWD = ADDR(CATPAS);                           0950 04426000
*                                                                  0950 04427000
         LA    @14,CATPAS(,@14)                                    0950 04428000
         ST    @14,CTGPSWD(,@15)                                   0950 04429000
*            END;                                                  0951 04430000
*                                                                  0951 04431000
@RF00949 DS    0H                                                  0952 04432000
*        /************************************************************/ 04433000
*        /*                                                          */ 04434000
*        /* COMPLETE THE CPL AND ISSUE THE CATALOG DELETE REQUEST    */ 04435000
*        /* FOR EACH SORT WORK FILE                                  */ 04436000
*        /*                                                          */ 04437000
*        /* REFERENCE THE SORT WORK FILE DATA SET NAME AND DNAME     */ 04438000
*        /* FROM THE CPL                                             */ 04439000
*        /*                                                          */ 04440000
*        /************************************************************/ 04441000
*                                                                  0952 04442000
*        DO DL = 1 TO 2;                                           0952 04443000
*                                                                  0952 04444000
@RF00946 LA    DL,1                                                0952 04445000
@DL00952 DS    0H                                                  0953 04446000
*          SWDATPTR = DLIOINPT(DL) + 4;                            0953 04447000
*                                                                  0953 04448000
         LA    @03,4                                               0953 04449000
         LR    @15,DL                                              0953 04450000
         SLA   @15,2                                               0953 04451000
         L     @14,@PC00010                                        0953 04452000
         AL    @14,@CF01678                                        0953 04453000
         L     SWDATPTR,DLIOINPT(@15,@14)                          0953 04454000
         ALR   SWDATPTR,@03                                        0953 04455000
*          IF IODSNID ^= DSNIDMSK                                  0954 04456000
*            THEN                                                  0954 04457000
         CLC   IODSNID(2,SWDATPTR),@CB00960                        0954 04458000
         BE    @RF00954                                            0954 04459000
*              SWDATPTR = SWDATPTR + IODSNLN + 4;                  0955 04460000
*                                                                  0955 04461000
         LR    @05,SWDATPTR                                        0955 04462000
         AH    @05,IODSNLN(,SWDATPTR)                              0955 04463000
         ALR   @05,@03                                             0955 04464000
         LR    SWDATPTR,@05                                        0955 04465000
*          CTGENT = ADDR(IODSN);                                   0956 04466000
*                                                                  0956 04467000
@RF00954 L     @05,CTGPLPTR                                        0956 04468000
         LA    @03,IODSN(,SWDATPTR)                                0956 04469000
         ST    @03,CTGENT(,@05)                                    0956 04470000
*          IF ADDR(WFILE) ^= NULLPTR                               0957 04471000
*            THEN                                                  0957 04472000
         L     @03,@PC00001+4                                      0957 04473000
         L     @04,FDTPTR+20(,@03)                                 0957 04474000
         LTR   @04,@04                                             0957 04475000
         BZ    @RF00957                                            0957 04476000
*              IF DL = 1                                           0958 04477000
*                THEN                                              0958 04478000
         C     DL,@CF00220                                         0958 04479000
         BNE   @RF00958                                            0958 04480000
*                  CTGDDNM = ADDR(WFLE1VAL);                       0959 04481000
*                                                                  0959 04482000
         L     @03,FDTPTR+24(,@03)                                 0959 04483000
         LA    @03,WFLE1VAL(,@03)                                  0959 04484000
         ST    @03,CTGDDNM(,@05)                                   0959 04485000
*                ELSE                                              0960 04486000
*                  CTGDDNM = ADDR(WFLE2VAL);                       0960 04487000
*                                                                  0960 04488000
         B     @RC00958                                            0960 04489000
@RF00958 L     @03,@PC00001+4                                      0960 04490000
         L     @03,FDTPTR+28(,@03)                                 0960 04491000
         LA    @03,WFLE2VAL(,@03)                                  0960 04492000
         L     @01,CTGPLPTR                                        0960 04493000
         ST    @03,CTGDDNM(,@01)                                   0960 04494000
*            ELSE                                                  0961 04495000
*              CTGDDNM = ADDR(DEFDDN(DL));                         0961 04496000
*                                                                  0961 04497000
         B     @RC00957                                            0961 04498000
@RF00957 LR    @03,DL                                              0961 04499000
         SLA   @03,3                                               0961 04500000
         LA    @03,DEFDDN-8(@03)                                   0961 04501000
         L     @01,CTGPLPTR                                        0961 04502000
         ST    @03,CTGDDNM(,@01)                                   0961 04503000
*          CALL IDCSACA0 (GDTTBL,CTGPLPTR);                        0962 04504000
*                                                                  0962 04505000
@RC00957 L     @03,@PC00001                                        0962 04506000
         ST    @03,@AL00001                                        0962 04507000
         LA    @15,CTGPLPTR                                        0962 04508000
         ST    @15,@AL00001+4                                      0962 04509000
         L     @15,GDTCAT(,@03)                                    0962 04510000
         LA    @01,@AL00001                                        0962 04511000
         BALR  @14,@15                                             0962 04512000
*          RFY RTNREG RSTD;                                        0963 04513000
*          CATRETCC = RTNREG;                                      0964 04514000
         STH   RTNREG,CATRETCC                                     0964 04515000
*          RFY RTNREG UNRSTD;                                      0965 04516000
*                                                                  0965 04517000
*          IF GDTDBG = NULLPTR                                     0966 04518000
*            THEN;                                                 0966 04519000
         L     @03,@PC00001                                        0966 04520000
         L     @03,GDTDBG(,@03)                                    0966 04521000
         LTR   @03,@03                                             0966 04522000
         BZ    @RT00966                                            0966 04523000
*            ELSE                                                  0968 04524000
*              CALL IDCDB010 (GDTTBL,'BIDL');                      0968 04525000
*                                                                  0968 04526000
         L     @03,@PC00001                                        0968 04527000
         ST    @03,@AL00001                                        0968 04528000
         LA    @15,@CC01342                                        0968 04529000
         ST    @15,@AL00001+4                                      0968 04530000
         MVI   @AL00001+4,X'80'                                    0968 04531000
         L     @15,GDTDBG(,@03)                                    0968 04532000
         LA    @01,@AL00001                                        0968 04533000
         BALR  @14,@15                                             0968 04534000
*        END;                                                      0969 04535000
*                                                                  0969 04536000
@RT00966 AL    DL,@CF00220                                         0969 04537000
         C     DL,@CF00154                                         0969 04538000
         BNH   @DL00952                                            0969 04539000
*        /************************************************************/ 04540000
*        /*                                                          */ 04541000
*        /* RETURN TO CALLING PROCEDURE                              */ 04542000
*        /*                                                          */ 04543000
*        /************************************************************/ 04544000
*                                                                  0970 04545000
*        RETURN;                                                   0970 04546000
*                                                                  0970 04547000
@EL00010 DS    0H                                                  0970 04548000
@EF00010 DS    0H                                                  0970 04549000
@ER00010 LM    @14,@12,@SA00010                                    0970 04550000
         BR    @14                                                 0970 04551000
*END DELTPROC;                                                     0971 04552000
*        /************************************************************/ 04553000
*        /*                                                          */ 04554000
*        /* PROCEDURE NAME - INITPROC                                */ 04555000
*        /*                                                          */ 04556000
*        /* FUNCTION - PERFORMS THE FUNCTION OF OBTAINING RESOURCES  */ 04557000
*        /*            FOR BUILDING THE ALTERNATE INDEX, CONSISTING  */ 04558000
*        /*            OF                                            */ 04559000
*        /*              . OBTAINING CORE FOR BUFFERS AND WORK AREAS */ 04560000
*        /*                                                          */ 04561000
*        /*              . CALCULATING THE SORT RECORD SIZE          */ 04562000
*        /*                                                          */ 04563000
*        /*              . CALCULATING CORE REQUIREMENTS FOR THE     */ 04564000
*        /*                SORT                                      */ 04565000
*        /*                                                          */ 04566000
*        /*              . CALCULATING SPACE REQUIREMENTS FOR AN     */ 04567000
*        /*                EXTERNAL SORT                             */ 04568000
*        /*                                                          */ 04569000
*        /*              . OBTAINING CORE THE FOR SORT               */ 04570000
*        /*                                                          */ 04571000
*        /*              . CALLING A SEPARATE INTERNAL PROCEDURE     */ 04572000
*        /*                (DEFPROC) IF IT IS NECESSARY TO DEFINE    */ 04573000
*        /*                AND OPEN SORT WORK FILES                  */ 04574000
*        /*                                                          */ 04575000
*        /* INPUT -                                                  */ 04576000
*        /*        INITAMDS - POINTERS TO BASE CLUSTER AND AIX       */ 04577000
*        /*                   AMDSB CONTROL BLOCKS                   */ 04578000
*        /*                                                          */ 04579000
*        /*        INITIOIN - POINTERS TO THE DATA OBTAINED FROM     */ 04580000
*        /*                   THE SORT WORK JOB CONTROL              */ 04581000
*        /*                                                          */ 04582000
*        /*        INITSRTB - SORT CONTROL TABLE                     */ 04583000
*        /*                                                          */ 04584000
*        /* OUTPUT -                                                 */ 04585000
*        /*        INITIOCS - POINTERS TO THE IOCSTR OF EACH SORT    */ 04586000
*        /*                   WORK FILE IF THEY WERE DEFINED AND     */ 04587000
*        /*                   OPENED                                 */ 04588000
*        /*                                                          */ 04589000
*        /*        INITSRTB - SORT CONTROL TABLE WITH FACTORS        */ 04590000
*        /*                   CALCULATED (SEE FUNCTION) AND          */ 04591000
*        /*                   POINTERS TO CORE OBTAINED              */ 04592000
*        /*                                                          */ 04593000
*        /*        INITSTAT - STATUS COMMUNICATION AREA              */ 04594000
*        /*                                                          */ 04595000
*        /* EXIT, NORMAL - ALL RESOURCES SUCCESSFULLY OBTAINED       */ 04596000
*        /*                                                          */ 04597000
*        /* EXIT, ERROR  - RETURN CODE 8, VIRTUAL CORE COULD NOT     */ 04598000
*        /*                  BE OBTAINED OR SORT WORK FILES COULD    */ 04599000
*        /*                  NOT BE DEFINED OR OPENED                */ 04600000
*        /*                                                          */ 04601000
*        /************************************************************/ 04602000
*                                                                  0972 04603000
*INITPROC:                                                         0972 04604000
*        PROCEDURE (INITAMDS,          /* PTRS TO AMDSBS             */ 04605000
*                   INITIOCS,          /* PTRS TO IOCSTRS            */ 04606000
*                   INITIOIN,          /* PTRS TO SORT WORK DATA     */ 04607000
*                   INITSRTB,          /* SORT CONTROL TABLE         */ 04608000
*                   INITSTAT);         /* STATUS COMMUNICATION AREA  */ 04609000
*                                                                  0972 04610000
INITPROC STM   @14,@12,@SA00011                                    0972 04611000
         MVC   @PC00011(20),0(@01)                                 0972 04612000
*        /************************************************************/ 04613000
*        /*                                                          */ 04614000
*        /* ARGUMENTS OF INVOCATION                                  */ 04615000
*        /*                                                          */ 04616000
*        /************************************************************/ 04617000
*                                                                  0973 04618000
*        DCL 1 INITAMDS BDY(WORD),     /* POINTERS TO AMDSBS         */ 04619000
*              2 INIAMBAS PTR(31),     /* POINTER TO BASE AMDSB      */ 04620000
*              2 INIAMAIX PTR(31);     /* POINTER TO AIX AMDSB       */ 04621000
*                                                                  0973 04622000
*        DCL 1 INITIOCS BDY(WORD),     /* POINTERS TO IOCSTR FOR     */ 04623000
*              2 INIOCSPT(4) PTR(31);  /* OPEN DATA SETS             */ 04624000
*                                                                  0974 04625000
*        DCL 1 INITIOIN BDY(WORD),     /* POINTERS TO SORT WORK      */ 04626000
*              2 INIOINPT(2) PTR(31);  /* JOB CONTROL DATA           */ 04627000
*                                                                  0975 04628000
*        DCL INITSRTB;                 /* SORT CONTROL TABLE         */ 04629000
*                                                                  0976 04630000
*        DCL 1 INITSTAT,               /* STATUS COMMUNICATION AREA  */ 04631000
*              2 INSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */ 04632000
*              2 INSTID   CHAR(4);     /* ERROR IDENTIFIER           */ 04633000
*                                                                  0977 04634000
*        /************************************************************/ 04635000
*        /*                                                          */ 04636000
*        /* VARIABLES AND CONSTANTS USED IN CALCULATIONS             */ 04637000
*        /*                                                          */ 04638000
*        /************************************************************/ 04639000
*                                                                  0978 04640000
*        DCL                                                       0978 04641000
*          WKASIZE  FIXED(31),         /* CORE FOR BUFFERS AND       */ 04642000
*                                      /* WORK AREAS                 */ 04643000
*          RSAREM   FIXED(15),         /* FACTOR TO ROUND RSA TO     */ 04644000
*                                      /* 2K BLOCK INCREMENT         */ 04645000
*          RSAINIT  FIXED(31),         /* INITIALLY CALCULATED RSA   */ 04646000
*                                      /* SIZE                       */ 04647000
*          SORTCORE FIXED(31),         /* SIZE OF RSA AND HEAP       */ 04648000
*          STOPI    BIT(1);            /* LOOP CONTROL               */ 04649000
*                                                                  0978 04650000
*        DCL                                                       0979 04651000
*          SECALLOC FIXED(8)  CONSTANT(10), /* SECONDARY ALLOCATION  */ 04652000
*          MAXEXRSA FIXED(31) CONSTANT(102400), /* MAXIMUM EXTERNAL  */ 04653000
*                                               /* SORT RSA SIZE     */ 04654000
*          MEDEXRSA FIXED(31) CONSTANT(61440),  /* MEDIUM EXTERNAL   */ 04655000
*                                               /* SORT RSA SIZE     */ 04656000
*          MINEXRSA FIXED(31) CONSTANT(32768),  /* MINIMUM EXTERNAL  */ 04657000
*                                               /* SORT RSA SIZE     */ 04658000
*          MINRSA   FIXED(31) CONSTANT(4096),   /* MINIMUM RSA SIZE  */ 04659000
*          VIRLIMIT FIXED(31)                   /* LIMIT OF VIRTUAL  */ 04660000
*                   CONSTANT(16777215);         /* CORE              */ 04661000
*        /************************************************************/ 04662000
*        /*                                                          */ 04663000
*        /* CALCULATE TOTAL CORE SIZE REQUIRED FOR BUFFERS AND       */ 04664000
*        /* WORK AREAS, CONSISTING OF                                */ 04665000
*        /*                                                          */ 04666000
*        /*    . 1 2K BUFFER AS THE AMOUNT REQUIRED FOR OUTPUT       */ 04667000
*        /*      IF AN EXTERNAL SORT IS REQUIRED                     */ 04668000
*        /*    . CPL/FVT/FPL AREA NEEDED IF SORT WORK FILES MUST     */ 04669000
*        /*      BE DEFINED                                          */ 04670000
*        /*    . ALTERNATE INDEX RECORD OUTPUT AREA                  */ 04671000
*        /*                                                          */ 04672000
*        /* CORE FOR SUPPORT OF AN EXTERNAL SORT MUST BE OBTAINED    */ 04673000
*        /* AT THIS TIME SINCE THE STATISTIC USED TO DETERMINE       */ 04674000
*        /* SORT REQUIREMENTS (NUMBER OF RECORDS IN THE BASE         */ 04675000
*        /* CLUSTER) MAY BE IN ERROR.  IF THIS STATISTIC IS LOW,     */ 04676000
*        /* IT WILL BE NECESSARY TO GO TO AN EXTERNAL SORT DURING    */ 04677000
*        /* THE FIRST SORT PHASE.                                    */ 04678000
*        /*                                                          */ 04679000
*        /************************************************************/ 04680000
*                                                                  0980 04681000
*        OLDERID2 = NEWERID2;                                      0980 04682000
         L     @05,@PC00001                                        0980 04683000
         L     @02,GDTTR2(,@05)                                    0980 04684000
         MVC   @TS00001(95),NEWERID2(@02)                          0980 04685000
         MVC   OLDERID2(95,@02),@TS00001                           0980 04686000
*        NEWID2 = 'BII1';                                          0981 04687000
*                                                                  0981 04688000
         MVC   NEWID2(4,@02),@CC01379                              0981 04689000
*        AMDSBPTR = INIAMAIX;                                      0982 04690000
*                                                                  0982 04691000
         L     @02,@PC00011                                        0982 04692000
         L     AMDSBPTR,INIAMAIX(,@02)                             0982 04693000
*        WKASIZE = BLKSIZE +                                       0983 04694000
*                  (LENGTH(DFCPAREA) + LENGTH(DEFAREAS) +          0983 04695000
*                   LENGTH(VOLLIST)) +                             0983 04696000
*                  AMDLRECL;                                       0983 04697000
*                                                                  0983 04698000
         LA    @02,3292                                            0983 04699000
         AL    @02,AMDLRECL(,AMDSBPTR)                             0983 04700000
         ST    @02,WKASIZE                                         0983 04701000
*        /************************************************************/ 04702000
*        /*                                                          */ 04703000
*        /* ISSUE UGPOOL TO OBTAIN STORAGE FOR BUFFERS AND WORK      */ 04704000
*        /* AREAS.  IF UNSUCCESSFUL, RETURN WITH CODE 8.             */ 04705000
*        /*                                                          */ 04706000
*        /************************************************************/ 04707000
*                                                                  0984 04708000
*        CALL IDCSAGP0 (GDTTBL,WKASIZE,SRTBUFPT,UGPIDPG,SETZERO);  0984 04709000
*                                                                  0984 04710000
         ST    @05,@AL00001                                        0984 04711000
         LA    @02,WKASIZE                                         0984 04712000
         ST    @02,@AL00001+4                                      0984 04713000
         LA    @02,SRTBUFPT                                        0984 04714000
         ST    @02,@AL00001+8                                      0984 04715000
         LA    @02,UGPIDPG                                         0984 04716000
         ST    @02,@AL00001+12                                     0984 04717000
         LA    @02,SETZERO                                         0984 04718000
         ST    @02,@AL00001+16                                     0984 04719000
         MVI   @AL00001+16,X'80'                                   0984 04720000
         L     @15,GDTGPL(,@05)                                    0984 04721000
         LA    @01,@AL00001                                        0984 04722000
         BALR  @14,@15                                             0984 04723000
*        RESPECIFY RTNREG RSTD;                                    0985 04724000
*        TESTRC = RTNREG;                                          0986 04725000
         LR    TESTRC,RTNREG                                       0986 04726000
*        RESPECIFY RTNREG UNRSTD;                                  0987 04727000
*                                                                  0987 04728000
*        IF TESTRC ^= 0                                            0988 04729000
*          THEN                                                    0988 04730000
         LTR   TESTRC,TESTRC                                       0988 04731000
         BZ    @RF00988                                            0988 04732000
*            DO;                                                   0989 04733000
*                                                                  0989 04734000
*            INSTID = WKACORE;                                     0990 04735000
         L     @15,@PC00011+16                                     0990 04736000
         MVC   INSTID(4,@15),@CB00898                              0990 04737000
*            RETURN CODE(LASTCC08);                                0991 04738000
*                                                                  0991 04739000
         LA    @15,8                                               0991 04740000
         L     @14,@SA00011                                        0991 04741000
         LM    @00,@12,@SA00011+8                                  0991 04742000
         BR    @14                                                 0991 04743000
*            END;                                                  0992 04744000
*                                                                  0992 04745000
*        /************************************************************/ 04746000
*        /*                                                          */ 04747000
*        /* CALCULATE THE SORT RECORD SIZE - ALTERNATE INDEX KEY     */ 04748000
*        /* LENGTH PLUS PRIME KEY LENGTH(KSDS) OR RBA LENGTH(ESDS).  */ 04749000
*        /* ASCERTAIN IF THE BASE CLUSTER IS A KSDS OR ESDS.  THIS   */ 04750000
*        /* WILL DETERMINE IF PRIME KEYS OR RBAS ARE TO BE           */ 04751000
*        /* CONCATENATED TO THE ALTERNATE KEY IN FORMING THE SORT    */ 04752000
*        /* RECORD AND THUS WILL AFFECT THE SIZE OF THE SORT RECORD. */ 04753000
*        /*                                                          */ 04754000
*        /************************************************************/ 04755000
*                                                                  0993 04756000
*        SRTRECSZ = AMDKEYLN;                                      0993 04757000
*                                                                  0993 04758000
@RF00988 LH    @05,AMDKEYLN(,AMDSBPTR)                             0993 04759000
         STH   @05,SRTRECSZ                                        0993 04760000
*        AMDSBPTR = INIAMBAS;                                      0994 04761000
*                                                                  0994 04762000
         L     @15,@PC00011                                        0994 04763000
         L     AMDSBPTR,INIAMBAS(,@15)                             0994 04764000
*        IF AMDDST = ON                                            0995 04765000
*          THEN                                                    0995 04766000
         TM    AMDDST(AMDSBPTR),B'10000000'                        0995 04767000
         BNO   @RF00995                                            0995 04768000
*            SRTRECSZ = SRTRECSZ + AMDKEYLN;                       0996 04769000
*                                                                  0996 04770000
         AH    @05,AMDKEYLN(,AMDSBPTR)                             0996 04771000
         STH   @05,SRTRECSZ                                        0996 04772000
*          ELSE                                                    0997 04773000
*            SRTRECSZ = SRTRECSZ + 4;                              0997 04774000
*                                                                  0997 04775000
         B     @RC00995                                            0997 04776000
@RF00995 LH    @05,SRTRECSZ                                        0997 04777000
         LA    @05,4(,@05)                                         0997 04778000
         STH   @05,SRTRECSZ                                        0997 04779000
*        /************************************************************/ 04780000
*        /*                                                          */ 04781000
*        /* CALCULATE EXTERNAL SORT REQUIREMENTS IN ANTICIPATION OF  */ 04782000
*        /* AN EXTERNAL SORT (THESE FACTORS WILL NOT BE USED IF      */ 04783000
*        /* AN INTERNAL SORT IS PERFORMED).                          */ 04784000
*        /*                                                          */ 04785000
*        /* CALCULATE THE NUMBER OF RECORDS PER 2 K BLOCK - 2041     */ 04786000
*        /* DIVIDED BY SORT RECORD SIZE.                             */ 04787000
*        /*                                                          */ 04788000
*        /************************************************************/ 04789000
*                                                                  0998 04790000
*        SRTRECBK = CILRECL / SRTRECSZ;                            0998 04791000
*                                                                  0998 04792000
@RC00995 LH    @05,SRTRECSZ                                        0998 04793000
         LA    @00,2041                                            0998 04794000
         SRDA  @00,32                                              0998 04795000
         DR    @00,@05                                             0998 04796000
         STH   @01,SRTRECBK                                        0998 04797000
*        /************************************************************/ 04798000
*        /*                                                          */ 04799000
*        /* CALCULATE THE TOTAL NUMBER OF 2K BLOCKS - NUMBER OF      */ 04800000
*        /* RECORDS IN BASE CLUSTER DIVIDED BY NUMBER OF RECORDS     */ 04801000
*        /* PER 2K BLOCK.  THE NUMBER OF RECORDS IN THE BASE CLUSTER */ 04802000
*        /* IS OBTAINED FROM THE STATISTIC MAINTAINED IN THE BASE    */ 04803000
*        /* CLUSTER AMDSB.  SINCE THIS STATISTIC CAN BE ERRONEOUS    */ 04804000
*        /* (DUE TO FAILURE DURING CLOSE), A SECONDARY               */ 04805000
*        /* ALLOCATION OF 10 PERCENT WILL BE USED IN DEFINING        */ 04806000
*        /* EXTERNAL SORT WORK FILES.  ADD A FUDGE FACTOR TO EACH    */ 04807000
*        /* OF THESE CALCULATIONS IN ORDER TO ENSURE A NON-ZERO      */ 04808000
*        /* RESULT.                                                  */ 04809000
*        /*                                                          */ 04810000
*        /************************************************************/ 04811000
*                                                                  0999 04812000
*        SRTBKTOT = (AMDNLR / SRTRECBK) + 10;                      0999 04813000
         LA    @15,10                                              0999 04814000
         L     @14,AMDNLR(,AMDSBPTR)                               0999 04815000
         LR    @06,@14                                             0999 04816000
         SRDA  @06,32                                              0999 04817000
         DR    @06,@01                                             0999 04818000
         ALR   @07,@15                                             0999 04819000
         ST    @07,SRTBKTOT                                        0999 04820000
*        SRTBK10  = (SRTBKTOT / SECALLOC) + 10;                    1000 04821000
*                                                                  1000 04822000
         LR    @00,@07                                             1000 04823000
         SRDA  @00,32                                              1000 04824000
         DR    @00,@15                                             1000 04825000
         ALR   @01,@15                                             1000 04826000
         ST    @01,SRTBK10                                         1000 04827000
*        /************************************************************/ 04828000
*        /*                                                          */ 04829000
*        /* DETERMINE THE STARTING VALUE OF THE SIZE OF THE RECORD   */ 04830000
*        /* SORT AREA(RSA).  THIS IS THE AREA INTO WHICH THE SORT    */ 04831000
*        /* RECORDS ARE PLACED DURING THE FIRST PHASE OF THE SORT.   */ 04832000
*        /* THE RSA SIZE IS ALWAYS IN INCREMENTS OF 2K SO THAT IT    */ 04833000
*        /* CAN BE LATER USED AS AN INPUT AREA DURING THE MERGE      */ 04834000
*        /* PHASE OF AN EXTERNAL SORT.  THE SIZE OF THE RSA INCLUDES */ 04835000
*        /* A FUDGE FACTOR TO ACCOUNT FOR AN ERRONEOUS NUMBER OF     */ 04836000
*        /* RECORDS STATISTIC.  THE FUDGE FACTOR IS EITHER THAT      */ 04837000
*        /* AMOUNT NEEDED TO ROUND UP TO THE NEXT HIGHEST 2K         */ 04838000
*        /* MULTIPLE OR 2K EXACTLY.                                  */ 04839000
*        /*                                                          */ 04840000
*        /************************************************************/ 04841000
*                                                                  1001 04842000
*        RSAINIT = AMDNLR * SRTRECSZ;                              1001 04843000
         LR    @01,@14                                             1001 04844000
         MR    @00,@05                                             1001 04845000
         LR    RSAINIT,@01                                         1001 04846000
*        RSAREM = RSAINIT // BLKSIZE;                              1002 04847000
*                                                                  1002 04848000
         LR    @00,RSAINIT                                         1002 04849000
         SRDA  @00,32                                              1002 04850000
         D     @00,@CF00976                                        1002 04851000
         LR    RSAREM,@00                                          1002 04852000
*        IF RSAREM ^= 0                                            1003 04853000
*          THEN                                                    1003 04854000
         LTR   RSAREM,RSAREM                                       1003 04855000
         BZ    @RF01003                                            1003 04856000
*            RSAINIT = RSAINIT + (BLKSIZE - RSAREM);               1004 04857000
*                                                                  1004 04858000
         LA    @15,2048                                            1004 04859000
         SLR   @15,RSAREM                                          1004 04860000
         ALR   RSAINIT,@15                                         1004 04861000
*          ELSE                                                    1005 04862000
*            RSAINIT = RSAINIT + BLKSIZE;                          1005 04863000
*                                                                  1005 04864000
         B     @RC01003                                            1005 04865000
@RF01003 AL    RSAINIT,@CF00976                                    1005 04866000
*        /************************************************************/ 04867000
*        /*                                                          */ 04868000
*        /* IF THE INITIALLY CALCULATED RSA SIZE IS LESS THAN 4K,    */ 04869000
*        /* IT IS INCREMENTED TO 4K.  THIS IS NECESSARY IN THE       */ 04870000
*        /* EVENT THAT THE NUMBER OF RECORDS STATISTIC IN THE AMDSB  */ 04871000
*        /* IS SO ERRONEOUSLY LOW THAT IT WILL BE NECESSARY TO GO    */ 04872000
*        /* INTO AN EXTERNAL SORT.  IN THAT SITUATION, THE 4K WILL   */ 04873000
*        /* BE USED FOR TWO 2K INPUT BUFFERS AND A TWO-WAY MERGE     */ 04874000
*        /* WILL OCCUR.                                              */ 04875000
*        /*                                                          */ 04876000
*        /* IF THE INITIALLY CALCULATED RSA SIZE IS GREATER THAN     */ 04877000
*        /* 4K BUT LESS THAN 32K OR IF THE CALLER HAS SPECIFIED      */ 04878000
*        /* THE EXTERNAL SORT PARAMETER, AN RSA SIZE OF 32K IS       */ 04879000
*        /* SET.  UNDER ALL CIRCUMSTANCES EXCEPT THAT MENTIONED      */ 04880000
*        /* ABOVE (A 4K RSA), 32K IS THE MINIMUM RSA SIZE THAT       */ 04881000
*        /* WILL BE USED.  THIS ALLOWS FOR A 16-WAY MERGE IF         */ 04882000
*        /* AN EXTERNAL SORT IS NECESSARY SINCE THE RSA AREA IS      */ 04883000
*        /* USED FOR INPUT BUFFERS DURING THE MERGE PHASE.           */ 04884000
*        /*                                                          */ 04885000
*        /* IF THE INITIALLY CALCULATED RSA SIZE IS GREATER THAN     */ 04886000
*        /* 16 MEGABYTES (THE LIMIT OF VIRTUAL CORE), AN EXTERNAL    */ 04887000
*        /* SORT WILL BE PERFORMED.  IN THIS SITUATION, AN RSA       */ 04888000
*        /* SIZE OF 100K IS SET.  THIS IS THE MAXIMUM RSA FOR AN     */ 04889000
*        /* EXTERNAL SORT.                                           */ 04890000
*        /*                                                          */ 04891000
*        /************************************************************/ 04892000
*                                                                  1006 04893000
*        IF RSAINIT < MINEXRSA                                     1006 04894000
*          THEN                                                    1006 04895000
@RC01003 C     RSAINIT,@CF01374                                    1006 04896000
         BNL   @RF01006                                            1006 04897000
*            IF RSAINIT < MINRSA                                   1007 04898000
*              THEN                                                1007 04899000
         L     @03,@CF01376                                        1007 04900000
         CR    RSAINIT,@03                                         1007 04901000
         BNL   @RF01007                                            1007 04902000
*                RSAINIT = MINRSA;                                 1008 04903000
*                                                                  1008 04904000
         LR    RSAINIT,@03                                         1008 04905000
*              ELSE                                                1009 04906000
*                RSAINIT = MINEXRSA;                               1009 04907000
*                                                                  1009 04908000
         B     @RC01007                                            1009 04909000
@RF01007 L     RSAINIT,@CF01374                                    1009 04910000
*          ELSE;                                                   1010 04911000
*                                                                  1010 04912000
@RF01006 DS    0H                                                  1011 04913000
*        SRTRSASZ = RSAINIT;                                       1011 04914000
*                                                                  1011 04915000
@RC01006 ST    RSAINIT,SRTRSASZ                                    1011 04916000
*        IF ADDR(ESORT) ^= NULLPTR &                               1012 04917000
*           SRTRSASZ ^= MINRSA                                     1012 04918000
*              THEN                                                1012 04919000
         L     @03,@PC00001+4                                      1012 04920000
         L     @03,FDTPTR+32(,@03)                                 1012 04921000
         LTR   @03,@03                                             1012 04922000
         BZ    @RF01012                                            1012 04923000
         L     @03,SRTRSASZ                                        1012 04924000
         C     @03,@CF01376                                        1012 04925000
         BE    @RF01012                                            1012 04926000
*                SRTRSASZ = MINEXRSA;                              1013 04927000
*                                                                  1013 04928000
         MVC   SRTRSASZ(4),@CF01374                                1013 04929000
*        IF SRTRSASZ > VIRLIMIT                                    1014 04930000
*          THEN                                                    1014 04931000
@RF01012 L     @03,SRTRSASZ                                        1014 04932000
         C     @03,@CF01378                                        1014 04933000
         BNH   @RF01014                                            1014 04934000
*            SRTRSASZ = MAXEXRSA;                                  1015 04935000
*                                                                  1015 04936000
         MVC   SRTRSASZ(4),@CF01370                                1015 04937000
*        /************************************************************/ 04938000
*        /*                                                          */ 04939000
*        /* IN A LOOP, CALCULATE THE WORKING RSA CAPACITY AND ITS    */ 04940000
*        /* MATCHING HEAP SIZE.  THE HEAP IS AN ARRAY OF POINTERS    */ 04941000
*        /* TO THE RECORDS IN THE RSA WHICH IS IN SORTED SEQUENCE.   */ 04942000
*        /* SEE PROLOG IN SORTPROC FOR DESCRIPTION OF THE FUNCTION   */ 04943000
*        /* OF THE HEAP AND HOW IT IS SORTED.  ISSUE A UGPOOL TO     */ 04944000
*        /* OBTAIN CORE FOR THE RSA AND HEAP.                        */ 04945000
*        /*                                                          */ 04946000
*        /************************************************************/ 04947000
*                                                                  1016 04948000
*        SRTRSAPT = NULLPTR;                                       1016 04949000
@RF01014 SLR   @03,@03                                             1016 04950000
         ST    @03,SRTRSAPT                                        1016 04951000
*        STOPI    = OFF;                                           1017 04952000
*                                                                  1017 04953000
         NI    STOPI,B'01111111'                                   1017 04954000
*        DO WHILE STOPI = OFF;                                     1018 04955000
*                                                                  1018 04956000
         B     @DE01018                                            1018 04957000
@DL01018 DS    0H                                                  1019 04958000
*          SRTRSACP = SRTRSASZ / SRTRECSZ;                         1019 04959000
         L     @15,SRTRSASZ                                        1019 04960000
         LR    @00,@15                                             1019 04961000
         SRDA  @00,32                                              1019 04962000
         LH    @14,SRTRECSZ                                        1019 04963000
         DR    @00,@14                                             1019 04964000
         ST    @01,SRTRSACP                                        1019 04965000
*          SORTCORE = SRTRSASZ + (SRTRSACP * 4);                   1020 04966000
*                                                                  1020 04967000
         SLA   @01,2                                               1020 04968000
         ALR   @15,@01                                             1020 04969000
         ST    @15,SORTCORE                                        1020 04970000
*          CALL IDCSAGP0 (GDTTBL,SORTCORE,SRTRSAPT,UGPIDPG,SETZERO);    04971000
*                                                                  1021 04972000
         L     @15,@PC00001                                        1021 04973000
         ST    @15,@AL00001                                        1021 04974000
         LA    @14,SORTCORE                                        1021 04975000
         ST    @14,@AL00001+4                                      1021 04976000
         LA    @14,SRTRSAPT                                        1021 04977000
         ST    @14,@AL00001+8                                      1021 04978000
         LA    @14,UGPIDPG                                         1021 04979000
         ST    @14,@AL00001+12                                     1021 04980000
         LA    @14,SETZERO                                         1021 04981000
         ST    @14,@AL00001+16                                     1021 04982000
         MVI   @AL00001+16,X'80'                                   1021 04983000
         L     @15,GDTGPL(,@15)                                    1021 04984000
         LA    @01,@AL00001                                        1021 04985000
         BALR  @14,@15                                             1021 04986000
*          RESPECIFY RTNREG RSTD;                                  1022 04987000
*          TESTRC = RTNREG;                                        1023 04988000
         LR    TESTRC,RTNREG                                       1023 04989000
*          RESPECIFY RTNREG UNRSTD;                                1024 04990000
*                                                                  1024 04991000
*          /**********************************************************/ 04992000
*          /*                                                        */ 04993000
*          /* IF THE CORE WAS SUCCESSFULLY OBTAINED, GET OUT OF      */ 04994000
*          /* LOOP.                                                  */ 04995000
*          /*                                                        */ 04996000
*          /**********************************************************/ 04997000
*                                                                  1025 04998000
*          IF TESTRC = 0                                           1025 04999000
*            THEN                                                  1025 05000000
         LTR   TESTRC,TESTRC                                       1025 05001000
         BNZ   @RF01025                                            1025 05002000
*              STOPI = ON;                                         1026 05003000
*                                                                  1026 05004000
         OI    STOPI,B'10000000'                                   1026 05005000
*            ELSE                                                  1027 05006000
*                                                                  1027 05007000
*              /******************************************************/ 05008000
*              /*                                                    */ 05009000
*              /* THE AMOUNT OF CORE BEING REQUESTED IS SET AT FOUR  */ 05010000
*              /* PLATEAUS - MAXIMUM (WHICH HAS FAILED IN WE REACH   */ 05011000
*              /* THIS POINT), 100K, 60K, 32K.  SET UP NEXT REQUEST  */ 05012000
*              /* AND TRY AGAIN.                                     */ 05013000
*              /*                                                    */ 05014000
*              /******************************************************/ 05015000
*                                                                  1027 05016000
*              IF SRTRSASZ > MAXEXRSA                              1027 05017000
*                THEN                                              1027 05018000
         B     @RC01025                                            1027 05019000
@RF01025 L     @03,@CF01370                                        1027 05020000
         C     @03,SRTRSASZ                                        1027 05021000
         BNL   @RF01027                                            1027 05022000
*                  SRTRSASZ = MAXEXRSA;                            1028 05023000
*                                                                  1028 05024000
         ST    @03,SRTRSASZ                                        1028 05025000
*                ELSE                                              1029 05026000
*                  IF SRTRSASZ > MEDEXRSA                          1029 05027000
*                    THEN                                          1029 05028000
         B     @RC01027                                            1029 05029000
@RF01027 L     @03,@CF01372                                        1029 05030000
         C     @03,SRTRSASZ                                        1029 05031000
         BNL   @RF01029                                            1029 05032000
*                      SRTRSASZ = MEDEXRSA;                        1030 05033000
*                                                                  1030 05034000
         ST    @03,SRTRSASZ                                        1030 05035000
*                    ELSE                                          1031 05036000
*                      IF SRTRSASZ > MINEXRSA                      1031 05037000
*                        THEN                                      1031 05038000
         B     @RC01029                                            1031 05039000
@RF01029 L     @03,@CF01374                                        1031 05040000
         C     @03,SRTRSASZ                                        1031 05041000
         BNL   @RF01031                                            1031 05042000
*                          SRTRSASZ = MINEXRSA;                    1032 05043000
*                                                                  1032 05044000
         ST    @03,SRTRSASZ                                        1032 05045000
*                        ELSE                                      1033 05046000
*                          STOPI = ON;                             1033 05047000
*                                                                  1033 05048000
         B     @RC01031                                            1033 05049000
@RF01031 OI    STOPI,B'10000000'                                   1033 05050000
*        END;                                                      1034 05051000
*                                                                  1034 05052000
@RC01031 DS    0H                                                  1034 05053000
@RC01029 DS    0H                                                  1034 05054000
@RC01027 DS    0H                                                  1034 05055000
@RC01025 DS    0H                                                  1034 05056000
@DE01018 TM    STOPI,B'10000000'                                   1034 05057000
         BZ    @DL01018                                            1034 05058000
*        /************************************************************/ 05059000
*        /*                                                          */ 05060000
*        /* IF NO SORT CORE WAS OBTAINED, SET THE ERROR CONDITION    */ 05061000
*        /* AND RETURN WITH A CODE 8.                                */ 05062000
*        /*                                                          */ 05063000
*        /************************************************************/ 05064000
*                                                                  1035 05065000
*        IF GDTDBG = NULLPTR                                       1035 05066000
*          THEN;                                                   1035 05067000
         L     @03,@PC00001                                        1035 05068000
         L     @03,GDTDBG(,@03)                                    1035 05069000
         LTR   @03,@03                                             1035 05070000
         BZ    @RT01035                                            1035 05071000
*          ELSE                                                    1037 05072000
*            CALL IDCDB010 (GDTTBL,'BII2');                        1037 05073000
*                                                                  1037 05074000
         L     @03,@PC00001                                        1037 05075000
         ST    @03,@AL00001                                        1037 05076000
         LA    @15,@CC01380                                        1037 05077000
         ST    @15,@AL00001+4                                      1037 05078000
         MVI   @AL00001+4,X'80'                                    1037 05079000
         L     @15,GDTDBG(,@03)                                    1037 05080000
         LA    @01,@AL00001                                        1037 05081000
         BALR  @14,@15                                             1037 05082000
*        IF SRTRSAPT = NULLPTR                                     1038 05083000
*          THEN                                                    1038 05084000
@RT01035 L     @03,SRTRSAPT                                        1038 05085000
         LTR   @03,@03                                             1038 05086000
         BNZ   @RF01038                                            1038 05087000
*            DO;                                                   1039 05088000
*                                                                  1039 05089000
*            INSTID = WKACORE;                                     1040 05090000
         L     @15,@PC00011+16                                     1040 05091000
         MVC   INSTID(4,@15),@CB00898                              1040 05092000
*            RETURN CODE(LASTCC08);                                1041 05093000
*                                                                  1041 05094000
         LA    @15,8                                               1041 05095000
         L     @14,@SA00011                                        1041 05096000
         LM    @00,@12,@SA00011+8                                  1041 05097000
         BR    @14                                                 1041 05098000
*            END;                                                  1042 05099000
*                                                                  1042 05100000
*        /************************************************************/ 05101000
*        /*                                                          */ 05102000
*        /* SORT CORE WAS SUCCESSFULLY OBTAINED.  DETERMINE IF IT    */ 05103000
*        /* IS LESS THAN THE INITIALLY CALCULATED REQUIREMENT AND,   */ 05104000
*        /* IF SO, CALL DEFPROC TO DEFINE AND OPEN THE SORT WORK     */ 05105000
*        /* FILES.  IF THE DEFINE FAILS, RETURN WITH A CODE 8.       */ 05106000
*        /*                                                          */ 05107000
*        /************************************************************/ 05108000
*                                                                  1043 05109000
*        IF SRTRSASZ < RSAINIT                                     1043 05110000
*          THEN                                                    1043 05111000
@RF01038 C     RSAINIT,SRTRSASZ                                    1043 05112000
         BNH   @RF01043                                            1043 05113000
*            DO;                                                   1044 05114000
*                                                                  1044 05115000
*            CALL DEFPROC('S',INITIOIN,INITIOCS,INITSRTB,INITSTAT);     05116000
*                                                                  1045 05117000
         LA    @15,@CC01131                                        1045 05118000
         ST    @15,@AL00001                                        1045 05119000
         L     @15,@PC00011+8                                      1045 05120000
         ST    @15,@AL00001+4                                      1045 05121000
         L     @15,@PC00011+4                                      1045 05122000
         ST    @15,@AL00001+8                                      1045 05123000
         L     @15,@PC00011+12                                     1045 05124000
         ST    @15,@AL00001+12                                     1045 05125000
         L     @15,@PC00011+16                                     1045 05126000
         ST    @15,@AL00001+16                                     1045 05127000
         LA    @01,@AL00001                                        1045 05128000
         BAL   @14,DEFPROC                                         1045 05129000
*            RESPECIFY RTNREG RSTD;                                1046 05130000
*            TESTRC = RTNREG;                                      1047 05131000
         LR    TESTRC,RTNREG                                       1047 05132000
*            RESPECIFY RTNREG UNRSTD;                              1048 05133000
*                                                                  1048 05134000
*            IF TESTRC ^= 0                                        1049 05135000
*              THEN                                                1049 05136000
         LTR   TESTRC,TESTRC                                       1049 05137000
         BZ    @RF01049                                            1049 05138000
*                RETURN CODE(LASTCC08);                            1050 05139000
*                                                                  1050 05140000
         LA    @15,8                                               1050 05141000
         L     @14,@SA00011                                        1050 05142000
         LM    @00,@12,@SA00011+8                                  1050 05143000
         BR    @14                                                 1050 05144000
*            END;                                                  1051 05145000
*                                                                  1051 05146000
@RF01049 DS    0H                                                  1052 05147000
*        /************************************************************/ 05148000
*        /*                                                          */ 05149000
*        /* CALCULATE THE NUMBER OF 2K BLOCKS IN THE RSA WHICH WILL  */ 05150000
*        /* BE USED AS INPUT BUFFERS DURING THE MERGE PHASE IF AN    */ 05151000
*        /* EXTERNAL SORT IS PERFORMED.                              */ 05152000
*        /*                                                          */ 05153000
*        /************************************************************/ 05154000
*                                                                  1052 05155000
*        SRTRSABK = SRTRSASZ / BLKSIZE;                            1052 05156000
@RF01043 L     @00,SRTRSASZ                                        1052 05157000
         SRDA  @00,32                                              1052 05158000
         D     @00,@CF00976                                        1052 05159000
         ST    @01,SRTRSABK                                        1052 05160000
*            IF SRTRSABK > 16             /*LIMIT TO 16      @OZ14784*/ 05161000
*              THEN                       /*   MERGE         @OZ14784*/ 05162000
         LA    @15,16                                              1053 05163000
         CR    @01,@15                                             1053 05164000
         BNH   @RF01053                                            1053 05165000
*                SRTRSABK = 16;                            /*@OZ14784*/ 05166000
*                                                                  1054 05167000
         ST    @15,SRTRSABK                                        1054 05168000
*        /************************************************************/ 05169000
*        /*                                                          */ 05170000
*        /* SORT INITIALIZATION HAS COMPLETED SUCCESSFULLY.  RETURN  */ 05171000
*        /* TO THE CALLING PROCEDURE(MAINPROC).                      */ 05172000
*        /*                                                          */ 05173000
*        /************************************************************/ 05174000
*                                                                  1055 05175000
*        RETURN CODE(LASTCC00);                                    1055 05176000
@RF01053 SLR   @15,@15                                             1055 05177000
         L     @14,@SA00011                                        1055 05178000
         LM    @00,@12,@SA00011+8                                  1055 05179000
         BR    @14                                                 1055 05180000
*END INITPROC;                                                     1056 05181000
*        /************************************************************/ 05182000
*        /*                                                          */ 05183000
*        /* PROCEDURE NAME - CNTLPROC                                */ 05184000
*        /*                                                          */ 05185000
*        /* FUNCTION - PERFORMS THE FUNCTION OF CONTROLLING THE      */ 05186000
*        /*            ACTUAL BUILD OF THE ALTERNATE INDEX           */ 05187000
*        /*            THROUGH THE FOLLOWING STEPS -                 */ 05188000
*        /*                                                          */ 05189000
*        /*            . INITIALIZE SORT FACTORS                     */ 05190000
*        /*                                                          */ 05191000
*        /*            . READ BASE CLUSTER RECORD AND PASS IT        */ 05192000
*        /*              TO A LOWER LEVEL PROCEDURE (SORTPROC)       */ 05193000
*        /*              WHICH WILL CREATE THE SORT RECORD, PLACE    */ 05194000
*        /*              IT IN THE RSA AND UPDATE THE HEAP ARRAY     */ 05195000
*        /*              WITH A POINTER TO THE RECORD.  IF THE RSA   */ 05196000
*        /*              REACHES CAPACITY BEFORE END OF FILE ON THE  */ 05197000
*        /*              BASE CLUSTER, SORTPROC WILL SORT THE RSA    */ 05198000
*        /*              AND CALL SPILPROC TO WRITE OUT THE RECORDS  */ 05199000
*        /*              TO THE EXTERNAL SORT WORK FILE              */ 05200000
*        /*                                                          */ 05201000
*        /*            . AT END OF FILE ON THE BASE CLUSTER, CALL    */ 05202000
*        /*              SORTPROC TO SORT THE RSA                    */ 05203000
*        /*                                                          */ 05204000
*        /*            . IF AN EXTERNAL SORT HAS BEEN INITIATED      */ 05205000
*        /*                                                          */ 05206000
*        /*              . ISSUE  A UCLOSE MACRO TO CLOSE THE        */ 05207000
*        /*                SORT WORK FILE                            */ 05208000
*        /*                                                          */ 05209000
*        /*              . CALL  OPENPROC TO RE-OPEN THE SORT WORK   */ 05210000
*        /*                FILE FOR THE FIRST MERGE PASS             */ 05211000
*        /*                                                          */ 05212000
*        /*              . CALL  MERGPROC TO PERFORM THE MERGE       */ 05213000
*        /*                PASSES OF THE EXTERNAL SORT.  AT THE      */ 05214000
*        /*                CONCLUSION OF THE MERGE, MERGPROC PASSES  */ 05215000
*        /*                EACH RECORD TO BLDPROC WHICH BUILDS AND   */ 05216000
*        /*                WRITES OUT THE ALTERNATE INDEX RECORDS.   */ 05217000
*        /*                                                          */ 05218000
*        /*            . AT END OF FILE ON THE BASE CLUSTER, IF      */ 05219000
*        /*              THE RSA DOES CONTAIN ALL THE SORT RECORDS,  */ 05220000
*        /*              CNTLPROC PASSES EACH RECORD TO BLDPROC      */ 05221000
*        /*              WHICH BUILDS AND WRITES OUT THE ALTERNATE   */ 05222000
*        /*              INDEX RECORDS.                              */ 05223000
*        /*                                                          */ 05224000
*        /* INPUT -                                                  */ 05225000
*        /*        CNTLAMDS - POINTERS TO BASE CLUSTER AND AIX       */ 05226000
*        /*                   AMDSB CONTROL BLOCKS                   */ 05227000
*        /*                                                          */ 05228000
*        /*        CNTLIOCS - POINTERS TO IOCSTR FOR EACH OPEN DATA  */ 05229000
*        /*                   SET                                    */ 05230000
*        /*                                                          */ 05231000
*        /*        CNTLIOIN - POINTERS TO THE DATA OBTAINED FROM     */ 05232000
*        /*                   THE SORT WORK JOB CONTROL              */ 05233000
*        /*                                                          */ 05234000
*        /*        CNTLSRTB - SORT CONTROL TABLE                     */ 05235000
*        /*                                                          */ 05236000
*        /* OUTPUT -                                                 */ 05237000
*        /*        CNTLSTAT - STATUS COMMUNICATION AREA CONTAINING   */ 05238000
*        /*                   FINAL AIX CONDITION CODE               */ 05239000
*        /*                                                          */ 05240000
*        /* EXIT, NORMAL - ALTERNATE INDEX SUCCESSFULLY BUILT        */ 05241000
*        /*                                                          */ 05242000
*        /* EXIT, ERROR  - FINAL AIX CONDITION CODE HAS BEEN PLACED  */ 05243000
*        /*                IN THE STATUS COMMUNICATION AREA.         */ 05244000
*        /*                                                          */ 05245000
*        /*                . CODE 8 - I/O ERROR READING BASE         */ 05246000
*        /*                           CLUSTER OR A TERMINATING       */ 05247000
*        /*                           CONDITION FOUND BY A LOWER     */ 05248000
*        /*                           LEVEL PROCEDURE                */ 05249000
*        /*                                                          */ 05250000
*        /*                . CODE 4 - A NON-TERMINATING CONDITION    */ 05251000
*        /*                           PASSED BACK FROM BLDPROC       */ 05252000
*        /*                                                          */ 05253000
*        /************************************************************/ 05254000
*CNTLPROC:                                                         1057 05255000
*        PROCEDURE (CNTLAMDS,          /* PTRS TO AMDSBS             */ 05256000
*                   CNTLIOCS,          /* PTRS TO IOCSTRS            */ 05257000
*                   CNTLIOIN,          /* PTRS TO SORT WORK DATA     */ 05258000
*                   CNTLSRTB,          /* SORT CONTROL TABLE         */ 05259000
*                   CNTLSTAT);         /* STATUS COMMUNICATION AREA  */ 05260000
*                                                                  1057 05261000
CNTLPROC STM   @14,@12,@SA00012                                    1057 05262000
         MVC   @PC00012(20),0(@01)                                 1057 05263000
*        /************************************************************/ 05264000
*        /*                                                          */ 05265000
*        /* ARGUMENTS OF INVOCATION                                  */ 05266000
*        /*                                                          */ 05267000
*        /************************************************************/ 05268000
*                                                                  1058 05269000
*        DCL 1 CNTLAMDS BDY(WORD),     /* POINTERS TO AMDSBS         */ 05270000
*              2 CNTAMBAS PTR(31),     /* POINTER  TO BASE AMDSB     */ 05271000
*              2 CNTAMAIX PTR(31);     /* POINTER  TO AIX AMDSB      */ 05272000
*                                                                  1058 05273000
*        DCL 1 CNTLIOCS BDY(WORD),     /* POINTERS TO IOCSTRS        */ 05274000
*              2 CNIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */ 05275000
*              2 CNIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */ 05276000
*              2 CNIOCSSR(2) PTR(31);  /* POINTERS TO SORT IOCSTRS   */ 05277000
*                                                                  1059 05278000
*        DCL 1 CNTLIOIN BDY(WORD),     /* POINTERS TO SORT WORK      */ 05279000
*              2 CNIOINPT(2) PTR(31);  /* JOB CONTROL DATA           */ 05280000
*                                                                  1060 05281000
*        DCL CNTLSRTB;                 /* SORT CONTROL TABLE         */ 05282000
*                                                                  1061 05283000
*        DCL 1 CNTLSTAT,               /* STATUS COMMUNICATION AREA  */ 05284000
*              2 CNSAVERC FIXED(15),   /* FINAL AIX CONDITION CODE   */ 05285000
*              2 CNSTID   CHAR(4);     /* ERROR INDENTIFIER          */ 05286000
*                                                                  1062 05287000
*        /************************************************************/ 05288000
*        /*                                                          */ 05289000
*        /* RETURN CODE FROM UGET OF BASE CLUSTER                    */ 05290000
*        /*                                                          */ 05291000
*        /************************************************************/ 05292000
*                                                                  1063 05293000
*        DCL GETRC FIXED(15);                                      1063 05294000
*                                                                  1063 05295000
*        /************************************************************/ 05296000
*        /*                                                          */ 05297000
*        /* INDEX VALUE TO PASS TO OPEN TO INDICATE THAT THE FIRST   */ 05298000
*        /* SORT WORK FILE IS TO BE OPENED                           */ 05299000
*        /*                                                          */ 05300000
*        /************************************************************/ 05301000
*                                                                  1064 05302000
*        DCL SWFONE FIXED(31) INIT(1);                             1064 05303000
*                                                                  1064 05304000
*        /************************************************************/ 05305000
*        /*                                                          */ 05306000
*        /* LOOP CONTROL VARIABLE                                    */ 05307000
*        /*                                                          */ 05308000
*        /************************************************************/ 05309000
*                                                                  1065 05310000
*        DCL NM FIXED(31);                                         1065 05311000
*        /************************************************************/ 05312000
*        /*                                                          */ 05313000
*        /* INITIALIZE SORT FACTORS                                  */ 05314000
*        /*                                                          */ 05315000
*        /************************************************************/ 05316000
*                                                                  1066 05317000
*        OLDERID2 = NEWERID2;                                      1066 05318000
         L     @03,@PC00001                                        1066 05319000
         L     @03,GDTTR2(,@03)                                    1066 05320000
         MVC   @TS00001(95),NEWERID2(@03)                          1066 05321000
         MVC   OLDERID2(95,@03),@TS00001                           1066 05322000
*        NEWID2 = 'BIC1';                                          1067 05323000
*                                                                  1067 05324000
         MVC   NEWID2(4,@03),@CC01405                              1067 05325000
*        SRTBSCNT = 0;                    /* BASE CLUSTER RECORD     */ 05326000
         SLR   @03,@03                                             1068 05327000
         ST    @03,SRTBSCNT                                        1068 05328000
*                                         /* COUNT                   */ 05329000
*        SRTHEAPT = SRTRSAPT + SRTRSASZ;  /* POINTER TO HEAP         */ 05330000
         L     @15,SRTRSAPT                                        1069 05331000
         LR    @14,@15                                             1069 05332000
         AL    @14,SRTRSASZ                                        1069 05333000
         ST    @14,SRTHEAPT                                        1069 05334000
*        SRTCURSA = SRTRSAPT;             /* POINTER TO CURRENT      */ 05335000
         ST    @15,SRTCURSA                                        1070 05336000
*                                         /* RSA RECORD SLOT         */ 05337000
*        SRTRSACT = 0;                    /* COUNT OF RECORDS IN RSA */ 05338000
         ST    @03,SRTRSACT                                        1071 05339000
*        SRTFLBLD = ON;                   /* BLDPROC FIRST ENTRY FLAG*/ 05340000
         OI    SRTFLBLD,B'00010000'                                1072 05341000
*        SRTOSTRG = 0;                    /* NUMBER OF OUTPUT STRINGS*/ 05342000
         ST    @03,SRTOSTRG                                        1073 05343000
*        SRTFLEXT = OFF;                  /* EXTERNAL SORT FLAG      */ 05344000
         NI    SRTFLEXT,B'10111111'                                1074 05345000
*        GETRC    = 0;                    /* UGET RETURN CODE        */ 05346000
*                                                                  1075 05347000
         SLR   GETRC,GETRC                                         1075 05348000
*        /************************************************************/ 05349000
*        /*                                                          */ 05350000
*        /*  INITIALIZE THE RDF AND CIDF FIELDS IN THE OUTPUT        */ 05351000
*        /*  BUFFER SO THAT THE BUFFER WILL BE SET UP IF AN EXTERNAL */ 05352000
*        /*  SORT MUST BE PERFORMED                                  */ 05353000
*        /*                                                          */ 05354000
*        /************************************************************/ 05355000
*                                                                  1076 05356000
*        OUTBUFPT = SRTBUFPT;                                      1076 05357000
*                                                                  1076 05358000
         L     @15,SRTBUFPT                                        1076 05359000
         ST    @15,OUTBUFPT                                        1076 05360000
*        OUTRDFFL = ''B;                                           1077 05361000
         MVI   OUTRDFFL(@15),X'00'                                 1077 05362000
*        OUTRDFLN = CILRECL;                                       1078 05363000
         LA    @14,2041                                            1078 05364000
         STH   @14,OUTRDFLN(,@15)                                  1078 05365000
*        OUTCIDFS = CILRECL;                                       1079 05366000
         STH   @14,OUTCIDFS(,@15)                                  1079 05367000
*        OUTCIDLN = 0;                                             1080 05368000
*                                                                  1080 05369000
         STH   @03,OUTCIDLN(,@15)                                  1080 05370000
*        /************************************************************/ 05371000
*        /*                                                          */ 05372000
*        /* IN A LOOP, READ BASE CLUSTER RECORDS AND PASS THEM       */ 05373000
*        /* TO SORTPROC.  AT END OF FILE MAKE ONE MORE CALL TO       */ 05374000
*        /* CAUSE THE RECORDS IN THE RSA TO BE SORTED. RETURN        */ 05375000
*        /* TO THE CALLING PROCEDURE (MAINPROC) IF AN ERROR.         */ 05376000
*        /*                                                          */ 05377000
*        /************************************************************/ 05378000
*                                                                  1081 05379000
*        DO WHILE GETRC ^= 16;                                     1081 05380000
*                                                                  1081 05381000
         B     @DE01081                                            1081 05382000
@DL01081 DS    0H                                                  1082 05383000
*          CALL IDCIOGT0 (GDTTBL,CNIOCSBS);                        1082 05384000
*                                                                  1082 05385000
         L     @03,@PC00001                                        1082 05386000
         ST    @03,@AL00001                                        1082 05387000
         L     @15,@PC00012+4                                      1082 05388000
         ST    @15,@AL00001+4                                      1082 05389000
         MVI   @AL00001+4,X'80'                                    1082 05390000
         L     @15,GDTGET(,@03)                                    1082 05391000
         LA    @01,@AL00001                                        1082 05392000
         BALR  @14,@15                                             1082 05393000
*          RFY RTNREG RSTD;                                        1083 05394000
*          GETRC = RTNREG;                                         1084 05395000
         LR    GETRC,RTNREG                                        1084 05396000
*          RFY RTNREG UNRSTD;                                      1085 05397000
*                                                                  1085 05398000
*          IF GETRC ^= 0                                           1086 05399000
*            THEN                                                  1086 05400000
         LTR   GETRC,GETRC                                         1086 05401000
         BZ    @RF01086                                            1086 05402000
*              IF GETRC ^= 16                                      1087 05403000
*                THEN                                              1087 05404000
         C     GETRC,@CF00474                                      1087 05405000
         BE    @RF01087                                            1087 05406000
*                  DO;                                             1088 05407000
*                                                                  1088 05408000
*                  CNSAVERC = LASTCC08;                            1089 05409000
         L     @15,@PC00012+16                                     1089 05410000
         MVC   CNSAVERC(2,@15),@CH00180                            1089 05411000
*                  RETURN;                                         1090 05412000
*                                                                  1090 05413000
@EL00012 DS    0H                                                  1090 05414000
@EF00012 DS    0H                                                  1090 05415000
@ER00012 LM    @14,@12,@SA00012                                    1090 05416000
         BR    @14                                                 1090 05417000
*                  END;                                            1091 05418000
*                                                                  1091 05419000
*          /**********************************************************/ 05420000
*          /*                                                        */ 05421000
*          /* AT THIS POINT, GETRC IS EITHER 0 (NOT END-OF-FILE)     */ 05422000
*          /* OR 16 (END-OF-FILE)                                    */ 05423000
*          /*                                                        */ 05424000
*          /**********************************************************/ 05425000
*                                                                  1092 05426000
*          IF GETRC = 0                                            1092 05427000
*            THEN                                                  1092 05428000
@RF01087 DS    0H                                                  1092 05429000
@RF01086 LTR   GETRC,GETRC                                         1092 05430000
         BNZ   @RF01092                                            1092 05431000
*               CALL SORTPROC (CNTLAMDS,CNTLIOCS,CNTLIOIN,         1093 05432000
*                              CNTLSRTB,CNTLSTAT,'N');             1093 05433000
         L     @03,@PC00012                                        1093 05434000
         ST    @03,@AL00001                                        1093 05435000
         L     @03,@PC00012+4                                      1093 05436000
         ST    @03,@AL00001+4                                      1093 05437000
         L     @03,@PC00012+8                                      1093 05438000
         ST    @03,@AL00001+8                                      1093 05439000
         L     @03,@PC00012+12                                     1093 05440000
         ST    @03,@AL00001+12                                     1093 05441000
         L     @03,@PC00012+16                                     1093 05442000
         ST    @03,@AL00001+16                                     1093 05443000
         LA    @03,@CC01407                                        1093 05444000
         ST    @03,@AL00001+20                                     1093 05445000
         LA    @01,@AL00001                                        1093 05446000
         BAL   @14,SORTPROC                                        1093 05447000
*            ELSE                                                  1094 05448000
*               CALL SORTPROC (CNTLAMDS,CNTLIOCS,CNTLIOIN,         1094 05449000
*                              CNTLSRTB,CNTLSTAT,'L');             1094 05450000
*                                                                  1094 05451000
         B     @RC01092                                            1094 05452000
@RF01092 L     @03,@PC00012                                        1094 05453000
         ST    @03,@AL00001                                        1094 05454000
         L     @03,@PC00012+4                                      1094 05455000
         ST    @03,@AL00001+4                                      1094 05456000
         L     @03,@PC00012+8                                      1094 05457000
         ST    @03,@AL00001+8                                      1094 05458000
         L     @03,@PC00012+12                                     1094 05459000
         ST    @03,@AL00001+12                                     1094 05460000
         L     @03,@PC00012+16                                     1094 05461000
         ST    @03,@AL00001+16                                     1094 05462000
         LA    @03,@CC01408                                        1094 05463000
         ST    @03,@AL00001+20                                     1094 05464000
         LA    @01,@AL00001                                        1094 05465000
         BAL   @14,SORTPROC                                        1094 05466000
*          RESPECIFY RTNREG RSTD;                                  1095 05467000
@RC01092 DS    0H                                                  1096 05468000
*          TESTRC = RTNREG;                                        1096 05469000
         LR    TESTRC,RTNREG                                       1096 05470000
*          RESPECIFY RTNREG UNRSTD;                                1097 05471000
*                                                                  1097 05472000
*          IF TESTRC ^= 0                                          1098 05473000
*            THEN                                                  1098 05474000
         LTR   TESTRC,TESTRC                                       1098 05475000
         BZ    @RF01098                                            1098 05476000
*              DO;                                                 1099 05477000
*                                                                  1099 05478000
*              CNSAVERC = LASTCC08;                                1100 05479000
         L     @15,@PC00012+16                                     1100 05480000
         MVC   CNSAVERC(2,@15),@CH00180                            1100 05481000
*              RETURN;                                             1101 05482000
*                                                                  1101 05483000
         B     @EL00012                                            1101 05484000
*              END;                                                1102 05485000
*                                                                  1102 05486000
*                                                                  1102 05487000
*                                                                  1102 05488000
*        END;                                                      1103 05489000
*                                                                  1103 05490000
@RF01098 DS    0H                                                  1103 05491000
@DE01081 C     GETRC,@CF00474                                      1103 05492000
         BNE   @DL01081                                            1103 05493000
*        IF GDTDBG = NULLPTR                                       1104 05494000
*          THEN;                                                   1104 05495000
         L     @15,@PC00001                                        1104 05496000
         L     @15,GDTDBG(,@15)                                    1104 05497000
         LTR   @15,@15                                             1104 05498000
         BZ    @RT01104                                            1104 05499000
*          ELSE                                                    1106 05500000
*            CALL IDCDB010 (GDTTBL, 'BIC2');                       1106 05501000
*                                                                  1106 05502000
         L     @15,@PC00001                                        1106 05503000
         ST    @15,@AL00001                                        1106 05504000
         LA    @14,@CC01409                                        1106 05505000
         ST    @14,@AL00001+4                                      1106 05506000
         MVI   @AL00001+4,X'80'                                    1106 05507000
         L     @15,GDTDBG(,@15)                                    1106 05508000
         LA    @01,@AL00001                                        1106 05509000
         BALR  @14,@15                                             1106 05510000
*        /************************************************************/ 05511000
*        /*                                                          */ 05512000
*        /* IF ALL THE RECORDS COULD NOT BE CONTAINED IN THE RSA,    */ 05513000
*        /* SORTPROC HAS CALLED SPILPROC TO GO INTO AN EXTERNAL      */ 05514000
*        /* SORT.  IF THE EXTERNAL SORT FLAG IS SET, A MERGE WILL    */ 05515000
*        /* BE PERFORMED.                                            */ 05516000
*        /*                                                          */ 05517000
*        /************************************************************/ 05518000
*                                                                  1107 05519000
*        IF SRTFLEXT = ON                                          1107 05520000
*          THEN                                                    1107 05521000
@RT01104 TM    SRTFLEXT,B'01000000'                                1107 05522000
         BNO   @RF01107                                            1107 05523000
*CNTLEXT:    DO;                                                   1108 05524000
*                                                                  1108 05525000
*                                                                  1108 05526000
CNTLEXT  DS    0H                                                  1109 05527000
*            /********************************************************/ 05528000
*            /*                                                      */ 05529000
*            /* DURING THE SORT PHASE, THE OUTPUT SORT WORK FILE     */ 05530000
*            /* IS IN CREATE MODE.  DURING SUBSEQUENT MERGE PASSES,  */ 05531000
*            /* IT IS USED AND REUSED WITHOUT BEING CLOSED AND       */ 05532000
*            /* REOPENED BY DIRECT, UPDATE PROCESSING.  HOWEVER,     */ 05533000
*            /* DIRECT, UPDATE PROCESSING CANNOT BE USED IF THE FILE */ 05534000
*            /* IS IN CREATE MODE.  THEREFORE, IT MUST BE CLOSED     */ 05535000
*            /* AND REOPENED AT THIS TIME.                           */ 05536000
*            /*                                                      */ 05537000
*            /********************************************************/ 05538000
*                                                                  1109 05539000
*            CALL IDCIOCL0 (GDTTBL,CNIOCSSR(1));                   1109 05540000
*                                                                  1109 05541000
         L     @15,@PC00001                                        1109 05542000
         ST    @15,@AL00001                                        1109 05543000
         L     @14,@PC00012+4                                      1109 05544000
         LA    @14,CNIOCSSR(,@14)                                  1109 05545000
         ST    @14,@AL00001+4                                      1109 05546000
         MVI   @AL00001+4,X'80'                                    1109 05547000
         L     @15,GDTCLS(,@15)                                    1109 05548000
         LA    @01,@AL00001                                        1109 05549000
         BALR  @14,@15                                             1109 05550000
*            CNIOCSSR(1) = NULLPTR;                                1110 05551000
*                                                                  1110 05552000
         L     @15,@PC00012+4                                      1110 05553000
         SLR   @14,@14                                             1110 05554000
         ST    @14,CNIOCSSR(,@15)                                  1110 05555000
*            CALL OPENPROC ('M',CNIOCSSR(1),NULLPTR,CNIOINPT(1));  1111 05556000
*                                                                  1111 05557000
         LA    @14,@CC00744                                        1111 05558000
         ST    @14,@AL00001                                        1111 05559000
         LA    @15,CNIOCSSR(,@15)                                  1111 05560000
         ST    @15,@AL00001+4                                      1111 05561000
         LA    @15,@CF00116                                        1111 05562000
         ST    @15,@AL00001+8                                      1111 05563000
         L     @15,@PC00012+8                                      1111 05564000
         ST    @15,@AL00001+12                                     1111 05565000
         LA    @01,@AL00001                                        1111 05566000
         BAL   @14,OPENPROC                                        1111 05567000
*            RESPECIFY RTNREG RSTD;                                1112 05568000
*            TESTRC = RTNREG;                                      1113 05569000
         LR    TESTRC,RTNREG                                       1113 05570000
*            RESPECIFY RTNREG UNRSTD;                              1114 05571000
*                                                                  1114 05572000
*            IF TESTRC ^= 0                                        1115 05573000
*              THEN                                                1115 05574000
         LTR   TESTRC,TESTRC                                       1115 05575000
         BZ    @RF01115                                            1115 05576000
*                DO;                                               1116 05577000
*                                                                  1116 05578000
*                CNSAVERC = LASTCC08;                              1117 05579000
         L     @15,@PC00012+16                                     1117 05580000
         MVC   CNSAVERC(2,@15),@CH00180                            1117 05581000
*                RETURN;                                           1118 05582000
*                                                                  1118 05583000
         B     @EL00012                                            1118 05584000
*                END;                                              1119 05585000
*                                                                  1119 05586000
*            /********************************************************/ 05587000
*            /*                                                      */ 05588000
*            /* CALL MERGPROC TO PERFORM THE MERGE PASSES OF THE     */ 05589000
*            /* SORT WORK FILES.  AT THE COMPLETION OF THE MERGE,    */ 05590000
*            /* MERGPROC WILL PASS EACH RECORD TO BLDPROC TO         */ 05591000
*            /* ACCOMPLISH THE BUILDING AND WRITING OF THE           */ 05592000
*            /* ALTERNATE INDEX RECORDS.                             */ 05593000
*            /*                                                      */ 05594000
*            /********************************************************/ 05595000
*                                                                  1120 05596000
*            CALL MERGPROC (CNTLAMDS,CNTLIOCS,CNTLIOIN,            1120 05597000
*                           CNTLSRTB,CNTLSTAT);                    1120 05598000
*                                                                  1120 05599000
@RF01115 L     @15,@PC00012                                        1120 05600000
         ST    @15,@AL00001                                        1120 05601000
         L     @15,@PC00012+4                                      1120 05602000
         ST    @15,@AL00001+4                                      1120 05603000
         L     @15,@PC00012+8                                      1120 05604000
         ST    @15,@AL00001+8                                      1120 05605000
         L     @15,@PC00012+12                                     1120 05606000
         ST    @15,@AL00001+12                                     1120 05607000
         L     @15,@PC00012+16                                     1120 05608000
         ST    @15,@AL00001+16                                     1120 05609000
         LA    @01,@AL00001                                        1120 05610000
         BAL   @14,MERGPROC                                        1120 05611000
*            RESPECIFY RTNREG RSTD;                                1121 05612000
*            TESTRC = RTNREG;                                      1122 05613000
         LR    TESTRC,RTNREG                                       1122 05614000
*            RESPECIFY RTNREG UNRSTD;                              1123 05615000
*                                                                  1123 05616000
*            IF TESTRC ^= 0                                        1124 05617000
*              THEN                                                1124 05618000
         LTR   TESTRC,TESTRC                                       1124 05619000
         BZ    @RF01124                                            1124 05620000
*                DO;                                               1125 05621000
*                                                                  1125 05622000
*                CNSAVERC = LASTCC08;                              1126 05623000
         L     @15,@PC00012+16                                     1126 05624000
         MVC   CNSAVERC(2,@15),@CH00180                            1126 05625000
*                RETURN;                                           1127 05626000
*                                                                  1127 05627000
         B     @EL00012                                            1127 05628000
*                END;                                              1128 05629000
*                                                                  1128 05630000
*            END CNTLEXT;                                          1129 05631000
*                                                                  1129 05632000
*          /**********************************************************/ 05633000
*          /*                                                        */ 05634000
*          /* IF THE EXTERNAL SORT WORK FLAG IS NOT SET, ALL THE     */ 05635000
*          /* SORTED RECORDS ARE CONTAINED WITHIN THE RSA.           */ 05636000
*          /* OBTAIN EACH RECORD IN SEQUENCE FROM THE RSA AND        */ 05637000
*          /* PASS IT TO BLDPROC FOR BUILDING AND WRITING THE        */ 05638000
*          /* ALTERNATE INDEX RECORDS.                               */ 05639000
*          /*                                                        */ 05640000
*          /**********************************************************/ 05641000
*                                                                  1130 05642000
*          ELSE                                                    1130 05643000
*CNTLINT:    DO;                                                   1130 05644000
*                                                                  1130 05645000
         B     @RC01107                                            1130 05646000
@RF01107 DS    0H                                                  1130 05647000
CNTLINT  DS    0H                                                  1131 05648000
*            DO NM = 1 TO SRTRSACT;                                1131 05649000
*                                                                  1131 05650000
         LA    NM,1                                                1131 05651000
         B     @DE01131                                            1131 05652000
@DL01131 DS    0H                                                  1132 05653000
*              CALL BLDPROC (SHEAPTR(NM),CNTLAMDS,CNTLIOCS,        1132 05654000
*                            CNTLSRTB,CNTLSTAT);                   1132 05655000
*                                                                  1132 05656000
         LR    @03,NM                                              1132 05657000
         SLA   @03,2                                               1132 05658000
         L     @01,SRTHEAPT                                        1132 05659000
         AL    @01,@CF01678                                        1132 05660000
         LA    @03,SHEAPTR(@03,@01)                                1132 05661000
         ST    @03,@AL00001                                        1132 05662000
         L     @03,@PC00012                                        1132 05663000
         ST    @03,@AL00001+4                                      1132 05664000
         L     @03,@PC00012+4                                      1132 05665000
         ST    @03,@AL00001+8                                      1132 05666000
         L     @03,@PC00012+12                                     1132 05667000
         ST    @03,@AL00001+12                                     1132 05668000
         L     @03,@PC00012+16                                     1132 05669000
         ST    @03,@AL00001+16                                     1132 05670000
         LA    @01,@AL00001                                        1132 05671000
         BAL   @14,BLDPROC                                         1132 05672000
*              RESPECIFY RTNREG RSTD;                              1133 05673000
*              TESTRC = RTNREG;                                    1134 05674000
         LR    TESTRC,RTNREG                                       1134 05675000
*              RESPECIFY RTNREG UNRSTD;                            1135 05676000
*                                                                  1135 05677000
*              IF TESTRC ^= 0                                      1136 05678000
*                THEN                                              1136 05679000
         LTR   TESTRC,TESTRC                                       1136 05680000
         BZ    @RF01136                                            1136 05681000
*                  DO;                                             1137 05682000
*                                                                  1137 05683000
*                  CNSAVERC = LASTCC08;                            1138 05684000
         L     @15,@PC00012+16                                     1138 05685000
         MVC   CNSAVERC(2,@15),@CH00180                            1138 05686000
*                  RETURN;                                         1139 05687000
*                                                                  1139 05688000
         B     @EL00012                                            1139 05689000
*                  END;                                            1140 05690000
*                                                                  1140 05691000
*            END;                                                  1141 05692000
*                                                                  1141 05693000
@RF01136 AL    NM,@CF00220                                         1141 05694000
@DE01131 C     NM,SRTRSACT                                         1141 05695000
         BNH   @DL01131                                            1141 05696000
*            END CNTLINT;                                          1142 05697000
*                                                                  1142 05698000
*        /************************************************************/ 05699000
*        /*                                                          */ 05700000
*        /* CALL BLDPROC ONE MORE TIME TO WRITE OUT THE LAST         */ 05701000
*        /* ALTERNATE INDEX RECORD                                   */ 05702000
*        /*                                                          */ 05703000
*        /************************************************************/ 05704000
*                                                                  1143 05705000
*        CALL BLDPROC (NULLPTR,CNTLAMDS,CNTLIOCS,                  1143 05706000
*                      CNTLSRTB,CNTLSTAT);                         1143 05707000
*                                                                  1143 05708000
@RC01107 LA    @15,@CF00116                                        1143 05709000
         ST    @15,@AL00001                                        1143 05710000
         L     @15,@PC00012                                        1143 05711000
         ST    @15,@AL00001+4                                      1143 05712000
         L     @15,@PC00012+4                                      1143 05713000
         ST    @15,@AL00001+8                                      1143 05714000
         L     @15,@PC00012+12                                     1143 05715000
         ST    @15,@AL00001+12                                     1143 05716000
         L     @15,@PC00012+16                                     1143 05717000
         ST    @15,@AL00001+16                                     1143 05718000
         LA    @01,@AL00001                                        1143 05719000
         BAL   @14,BLDPROC                                         1143 05720000
*        RESPECIFY RTNREG RSTD;                                    1144 05721000
*        TESTRC = RTNREG;                                          1145 05722000
         LR    TESTRC,RTNREG                                       1145 05723000
*        RESPECIFY RTNREG UNRSTD;                                  1146 05724000
*                                                                  1146 05725000
*        IF TESTRC ^= 0                                            1147 05726000
*          THEN                                                    1147 05727000
         LTR   TESTRC,TESTRC                                       1147 05728000
         BZ    @RF01147                                            1147 05729000
*            DO;                                                   1148 05730000
*                                                                  1148 05731000
*            CNSAVERC = LASTCC08;                                  1149 05732000
         L     @15,@PC00012+16                                     1149 05733000
         MVC   CNSAVERC(2,@15),@CH00180                            1149 05734000
*            RETURN;                                               1150 05735000
*                                                                  1150 05736000
         B     @EL00012                                            1150 05737000
*            END;                                                  1151 05738000
*                                                                  1151 05739000
*        /************************************************************/ 05740000
*        /*                                                          */ 05741000
*        /* BUILDING OF THE ALTERNATE INDEX IS COMPLETE.  RETURN TO  */ 05742000
*        /* THE CALLING PROCEDURE (MAINPROC).                        */ 05743000
*        /*                                                          */ 05744000
*        /************************************************************/ 05745000
*                                                                  1152 05746000
*        RETURN;                                                   1152 05747000
*                                                                  1152 05748000
         B     @EL00012                                            1152 05749000
*END CNTLPROC;                                                     1153 05750000
         B     @EL00012                                            1153 05751000
*        /************************************************************/ 05752000
*        /*                                                          */ 05753000
*        /* PROCEDURE NAME - SORTPROC                                */ 05754000
*        /*                                                          */ 05755000
*        /* FUNCTION - PERFORMS THE FUNCTION OF BUILDING THE SORT    */ 05756000
*        /*            RECORDS FROM THE BASE CLUSTER RECORD,         */ 05757000
*        /*            PLACING EACH RECORD IN THE RECORD SORT AREA   */ 05758000
*        /*            (RSA) AND UPDATING THE TABLE OF POINTERS      */ 05759000
*        /*            (CALLED THE 'HEAP') TO THE RECORDS IN THE     */ 05760000
*        /*            RSA.  THE HEAP IS SORTED WHEN THE RSA         */ 05761000
*        /*            HAS REACHED CAPACITY AND/OR WHEN THE LAST     */ 05762000
*        /*            BASE CLUSTER RECORD HAS BEEN PROCESSED.       */ 05763000
*        /*                                                          */ 05764000
*        /*            THE HEAP SORT CONSISTS OF TWO PHASES. THE     */ 05765000
*        /*            FIRST PHASE BUILDS THE HEAP INTO A TREE OF    */ 05766000
*        /*            NODES HAVING A PARENT-CHILD RELATIONSHIP.     */ 05767000
*        /*            EACH PARENT NODE HAS TWO CHILD NODES AND THE  */ 05768000
*        /*            PARENT REPRESENTS A KEY HIGHER THAN EITHER    */ 05769000
*        /*            OF THE TWO CHILDREN. AT THE END OF THE FIRST  */ 05770000
*        /*            PHASE THE NODE AT THE TOP OF THE TREE REPRE-  */ 05771000
*        /*            SENTS THE HIGHEST KEY.  THE SECOND PHASE      */ 05772000
*        /*            REMOVES THE TOP NODE, PLACES IT AT THE        */ 05773000
*        /*            BOTTOM, REDUCES THE HEAP BY 1 AND ADJUSTS     */ 05774000
*        /*            THE PARENT-CHILD RELATIONSHIPS OF THE         */ 05775000
*        /*            REMAINING NODES.  THIS LOOP CONTINUES UNTIL   */ 05776000
*        /*            THE TOP OF THE HEAP REPRESENTS THE LOWEST     */ 05777000
*        /*            KEY.                                          */ 05778000
*        /*                                                          */ 05779000
*        /*            AFTER THE HEAP IS SORTED, IF THE SORT WAS     */ 05780000
*        /*            CAUSED BY THE RSA REACHING CAPACITY,          */ 05781000
*        /*            SORTPROC CALLS SPILPROC TO WRITE OUT THE      */ 05782000
*        /*            RECORDS IN THE RSA IN A STRING OF 2K BLOCKS   */ 05783000
*        /*            TO THE EXTERNAL SORT WORK FILE.               */ 05784000
*        /*                                                          */ 05785000
*        /*            CNTLPROC CALLS SORTPROC UNDER THE FOLLOWING   */ 05786000
*        /*            CONDITIONS                                    */ 05787000
*        /*                                                          */ 05788000
*        /*              . AFTER EACH BASE CLUSTER RECORD HAS BEEN   */ 05789000
*        /*                READ. THE ADDRESS OF THE RECORD IS        */ 05790000
*        /*                CONTAINED IN THE IOCSTR                   */ 05791000
*        /*                                                          */ 05792000
*        /*              . AT END OF FILE ON THE BASE CLUSTER        */ 05793000
*        /*                                                          */ 05794000
*        /*            EACH SORT RECORD IS FORMED BY CONCATENATING   */ 05795000
*        /*            THE PRIME KEY OF THE BASE CLUSTER (KSDS) OR   */ 05796000
*        /*            ITS RBA (ESDS) TO THE ALTERNATE KEY.  IF      */ 05797000
*        /*            THE BASE CLUSTER RECORD IS NOT LONG ENOUGH    */ 05798000
*        /*            TO CONTAIN THE ALTERNATE KEY, SORTPROC        */ 05799000
*        /*            ISSUES A WARNING MESSAGE AND SETS THE         */ 05800000
*        /*            CURRENT CONDITION CODE TO 4.                  */ 05801000
*        /*                                                          */ 05802000
*        /* INPUT -                                                  */ 05803000
*        /*        SORTAMDS - POINTERS TO BASE CLUSTER AND AMDSB     */ 05804000
*        /*                   CONTROL BLOCKS                         */ 05805000
*        /*                                                          */ 05806000
*        /*        SORTIOCS - POINTERS TO IOCSTR FOR EACH OPEN DATA  */ 05807000
*        /*                   SET                                    */ 05808000
*        /*                                                          */ 05809000
*        /*        SORTIOIN - POINTERS TO THE DATA OBTAINED FROM THE */ 05810000
*        /*                   SORT WORK JOB CONTROL                  */ 05811000
*        /*                                                          */ 05812000
*        /*        SORTSRTB - SORT CONTROL TABLE                     */ 05813000
*        /*                                                          */ 05814000
*        /*        SORTCLID - CALL ID-'N'=NOT LAST, 'L'=LAST         */ 05815000
*        /*                                                          */ 05816000
*        /* OUTPUT -                                                 */ 05817000
*        /*        SORTSTAT - STATUS COMMUNICATION AREA              */ 05818000
*        /*        SORT RECORD PLACED IN RSA AND HEAP UPDATED        */ 05819000
*        /*                                                          */ 05820000
*        /* EXIT,NORMAL - RETURN CODE O, SOSAVERC = 0 - ALL FUNCTIONS*/ 05821000
*        /*                              COMPLETED SUCCESSFULLY      */ 05822000
*        /*                                                          */ 05823000
*        /*                              SOSAVERC = 4 - AIX KEY WAS  */ 05824000
*        /*                              NOT CONTAINED IN BASE       */ 05825000
*        /*                              CLUSTER RECORD              */ 05826000
*        /*                                                          */ 05827000
*        /* EXIT,ERROR  - RETURN CODE 8, SPILPROC WAS CALLED AN      */ 05828000
*        /*                              ENCOUNTERED A TERMINATING   */ 05829000
*        /*                              ERROR                       */ 05830000
*        /*                                                          */ 05831000
*        /************************************************************/ 05832000
*                                                                  1154 05833000
*SORTPROC:                                                         1154 05834000
*        PROCEDURE (SORTAMDS,          /* POINTERS TO AMDSBS         */ 05835000
*                   SORTIOCS,          /* POINTERS TO IOCSTRS        */ 05836000
*                   SORTIOIN,          /* POINTERS TO SORT WORK DATA */ 05837000
*                   SORTSRTB,          /* SORT CONTROL TABLE         */ 05838000
*                   SORTSTAT,          /* STATUS COMMUNICATION AREA  */ 05839000
*                   SORTCLID);         /* CALL IDENTIFIER            */ 05840000
*                                                                  1154 05841000
SORTPROC STM   @14,@12,@SA00013                                    1154 05842000
         MVC   @PC00013(24),0(@01)                                 1154 05843000
*        /************************************************************/ 05844000
*        /*                                                          */ 05845000
*        /* ARGUMENTS OF INVOCATION                                  */ 05846000
*        /*                                                          */ 05847000
*        /************************************************************/ 05848000
*                                                                  1155 05849000
*        DCL 1 SORTAMDS BDY(WORD),     /* POINTERS TO AMDSBS         */ 05850000
*              2 SORAMBAS PTR(31),     /* POINTER TO BASE AMDSB      */ 05851000
*              2 SORAMAIX PTR(31);     /* POINTER TO AIX AMDSB       */ 05852000
*                                                                  1155 05853000
*        DCL 1 SORTIOCS BDY(WORD),     /* POINTERS TO IOCSTRS        */ 05854000
*              2 SOIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */ 05855000
*              2 SOIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */ 05856000
*              2 SOIOCSSR(2) PTR(31);  /* POINTER TO SORT IOCSTRS    */ 05857000
*                                                                  1156 05858000
*        DCL 1 SORTIOIN BDY(WORD),     /* POINTERS TO SORTWORK       */ 05859000
*              2 SOIOINPT(2) PTR(31);  /* JOB CONTROL DATA           */ 05860000
*                                                                  1157 05861000
*        DCL SORTSRTB;                 /* SORT CONTROL TABLE         */ 05862000
*                                                                  1158 05863000
*        DCL 1 SORTSTAT,               /* STATUS COMMUNICATION AREA  */ 05864000
*              2 SOSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */ 05865000
*              2 SOSTID   CHAR(4);     /* ERROR IDENTIFIER           */ 05866000
*                                                                  1159 05867000
*        DCL SORTCLID CHAR(1);         /* IF 'L', THIS IS THE LAST   */ 05868000
*                                      /* CALL TO SORTPROC           */ 05869000
*                                                                  1161 05870000
*        /************************************************************/ 05871000
*        /*                                                          */ 05872000
*        /* VARIABLES USED BY THE SORTING PROCESS                    */ 05873000
*        /*                                                          */ 05874000
*        /************************************************************/ 05875000
*                                                                  1161 05876000
*        DCL                                                       1161 05877000
*          SORTL FIXED(31),            /* CONTROLS FIRST PHASE       */ 05878000
*          SORTR FIXED(31),            /* CONTROLS SECOND PHASE      */ 05879000
*          SORTI FIXED(31),            /* PARENT                     */ 05880000
*          SORTJ FIXED(31),            /* CHILD                      */ 05881000
*          SORTK PTR(31);              /* WORKING KEY                */ 05882000
*                                                                  1161 05883000
*        /************************************************************/ 05884000
*        /*                                                          */ 05885000
*        /* VARIABLE USED TO MOVE THE RBA TO THE SORT RECORD         */ 05886000
*        /*                                                          */ 05887000
*        /************************************************************/ 05888000
*                                                                  1162 05889000
*        DCL CHARRBA CHAR(4) DEFINED(IOCRBA);                      1162 05890000
*        /************************************************************/ 05891000
*        /*                                                          */ 05892000
*        /* ON ENTRY, DETERMINE IF THE RSA HAS REACHED CAPACITY OR   */ 05893000
*        /* IF THIS IS THE LAST CALL.  IF SO, SEQUENCE  THE HEAP.    */ 05894000
*        /*                                                          */ 05895000
*        /************************************************************/ 05896000
*                                                                  1163 05897000
*        IF SRTRSACT = SRTRSACP |                                  1163 05898000
*           SORTCLID = 'L'                                         1163 05899000
*          THEN                                                    1163 05900000
         CLC   SRTRSACT(4),SRTRSACP                                1163 05901000
         BE    @RT01163                                            1163 05902000
         L     @15,@PC00013+20                                     1163 05903000
         CLI   SORTCLID(@15),C'L'                                  1163 05904000
         BNE   @RF01163                                            1163 05905000
@RT01163 DS    0H                                                  1164 05906000
*SORTLOOP:   DO;                                                   1164 05907000
*                                                                  1164 05908000
SORTLOOP DS    0H                                                  1165 05909000
*            IF GDTDBG = NULLPTR                                   1165 05910000
*              THEN;                                               1165 05911000
         L     @15,@PC00001                                        1165 05912000
         L     @15,GDTDBG(,@15)                                    1165 05913000
         LTR   @15,@15                                             1165 05914000
         BZ    @RT01165                                            1165 05915000
*              ELSE                                                1167 05916000
*                CALL IDCDB010 (GDTTBL,'BISR');                    1167 05917000
*                                                                  1167 05918000
         L     @15,@PC00001                                        1167 05919000
         ST    @15,@AL00001                                        1167 05920000
         LA    @14,@CC01447                                        1167 05921000
         ST    @14,@AL00001+4                                      1167 05922000
         MVI   @AL00001+4,X'80'                                    1167 05923000
         L     @15,GDTDBG(,@15)                                    1167 05924000
         LA    @01,@AL00001                                        1167 05925000
         BALR  @14,@15                                             1167 05926000
*            /********************************************************/ 05927000
*            /*                                                      */ 05928000
*            /* INITIALIZE THE VALUES OF L AND R.  WHILE L IS        */ 05929000
*            /* GREATER THAN 1, WE ARE BUILDING THE HEAP.  REMOVE    */ 05930000
*            /* A WORKING KEY LEAVING A SLOT IN THE HEAP.            */ 05931000
*            /*                                                      */ 05932000
*            /********************************************************/ 05933000
*                                                                  1168 05934000
*            SORTL = SRTRSACT / 2 + 1;                             1168 05935000
@RT01165 L     @02,SRTRSACT                                        1168 05936000
         LR    @00,@02                                             1168 05937000
         SRDA  @00,32                                              1168 05938000
         D     @00,@CF00154                                        1168 05939000
         AL    @01,@CF00220                                        1168 05940000
         LR    SORTL,@01                                           1168 05941000
*            SORTR = SRTRSACT;                                     1169 05942000
*                                                                  1169 05943000
         LR    SORTR,@02                                           1169 05944000
*SORTOUTR:   DO WHILE SORTR > 1;                                   1170 05945000
*                                                                  1170 05946000
SORTOUTR B     @DE01170                                            1170 05947000
@DL01170 DS    0H                                                  1171 05948000
*              IF SORTL > 1                                        1171 05949000
*                THEN                                              1171 05950000
         C     SORTL,@CF00220                                      1171 05951000
         BNH   @RF01171                                            1171 05952000
*                  DO;                                             1172 05953000
*                                                                  1172 05954000
*                  SORTL = SORTL - 1;                              1173 05955000
         BCTR  SORTL,0                                             1173 05956000
*                  SORTK = SHEAPTR(SORTL);                         1174 05957000
*                                                                  1174 05958000
         LR    @04,SORTL                                           1174 05959000
         SLA   @04,2                                               1174 05960000
         L     @02,SRTHEAPT                                        1174 05961000
         AL    @02,@CF01678                                        1174 05962000
         L     @04,SHEAPTR(@04,@02)                                1174 05963000
         ST    @04,SORTK                                           1174 05964000
*                  END;                                            1175 05965000
*                                                                  1175 05966000
*                /****************************************************/ 05967000
*                /*                                                  */ 05968000
*                /* WHEN THE VALUE OF L REACHES 1, THE HEAP IS       */ 05969000
*                /* BUILT.  NOW SORT IT.  THE KEY AT THE BOTTOM OF   */ 05970000
*                /* THE HEAP BECOMES THE WORKING KEY, THE KEY AT     */ 05971000
*                /* THE TOP (THE HIGHEST IN VALUE) GOES TO THE       */ 05972000
*                /* BOTTOM AND THE SIZE OF THE HEAP IS REDUCED BY    */ 05973000
*                /* ONE.  THE EMPTY SLOT IS AT THE TOP OF THE HEAP.  */ 05974000
*                /* WHEN R REACHES 1, WE ARE DONE                    */ 05975000
*                /*                                                  */ 05976000
*                /****************************************************/ 05977000
*                                                                  1176 05978000
*                ELSE                                              1176 05979000
*                  DO;                                             1176 05980000
*                                                                  1176 05981000
         B     @RC01171                                            1176 05982000
@RF01171 DS    0H                                                  1177 05983000
*                  SORTK = SHEAPTR(SORTR);                         1177 05984000
         L     @04,SRTHEAPT                                        1177 05985000
         LR    @02,SORTR                                           1177 05986000
         SLA   @02,2                                               1177 05987000
         LA    @01,0(@02,@04)                                      1177 05988000
         AL    @01,@CF01678                                        1177 05989000
         L     @15,SHEAPTR(,@01)                                   1177 05990000
         ST    @15,SORTK                                           1177 05991000
*                  SHEAPTR(SORTR) = SHEAPTR(1);                    1178 05992000
*                                                                  1178 05993000
         L     @15,SHEAPTR(,@04)                                   1178 05994000
         AL    @04,@CF01678                                        1178 05995000
         ST    @15,SHEAPTR(@02,@04)                                1178 05996000
*                  SORTR = SORTR - 1;                              1179 05997000
*                                                                  1179 05998000
         BCTR  SORTR,0                                             1179 05999000
*                  END;                                            1180 06000000
*                                                                  1180 06001000
*              IF SORTR > 1                                        1181 06002000
*                THEN                                              1181 06003000
@RC01171 C     SORTR,@CF00220                                      1181 06004000
         BNH   @RF01181                                            1181 06005000
*RNOTONE:          DO;                                             1182 06006000
*                                                                  1182 06007000
RNOTONE  DS    0H                                                  1183 06008000
*                  /**************************************************/ 06009000
*                  /*                                                */ 06010000
*                  /* ESTABLISH A PARENT-CHILD RELATIONSHIP AT THE   */ 06011000
*                  /* POINT OF THE EMPTY SLOT.  DETERMINE WHICH OF   */ 06012000
*                  /* THE TWO CHILDREN IS GREATER.  IF THE WORKING   */ 06013000
*                  /* KEY IS SMALLER THAN THE CHOSEN CHILD, MOVE     */ 06014000
*                  /* THE CHILD UP TO THE EMPTY SLOT, THUS MOVING    */ 06015000
*                  /* THE EMPTY SLOT DOWN TO THE CHILD'S FORMER      */ 06016000
*                  /* SLOT.  ESTABLISH A NEW PARENT-CHILD AT THE     */ 06017000
*                  /* NEW EMPTY SLOT.  IF THE WORKING KEY IS EQUAL   */ 06018000
*                  /* TO OR LARGER THAN THE CHOSEN CHILD, THE INNER  */ 06019000
*                  /* LOOP IS COMPLETE.  SET J GREATER THAN R TO     */ 06020000
*                  /* FORCE EXIT.  THE INNER LOOP IS CODED           */ 06021000
*                  /* SEPARATELY FOR THE SITUATION IN WHICH THE      */ 06022000
*                  /* SORT RECORD IS GREATER THAN 256 BYTES IN       */ 06023000
*                  /* ORDER TO REDUCE COMPARES FOR THE NORMAL CASE.  */ 06024000
*                  /*                                                */ 06025000
*                  /**************************************************/ 06026000
*                                                                  1183 06027000
*                  SORTI = SORTL;                                  1183 06028000
         LR    SORTI,SORTL                                         1183 06029000
*                  SORTJ = SORTI * 2;                              1184 06030000
*                                                                  1184 06031000
         LR    SORTJ,SORTI                                         1184 06032000
         ALR   SORTJ,SORTJ                                         1184 06033000
*                  IF SRTRECSZ <= MVCMLIM                          1185 06034000
*                    THEN                                          1185 06035000
         LH    @15,SRTRECSZ                                        1185 06036000
         C     @15,@CF00925                                        1185 06037000
         BH    @RF01185                                            1185 06038000
*SORTINNM:             DO WHILE SORTJ <= SORTR;                    1186 06039000
*                                                                  1186 06040000
SORTINNM B     @DE01186                                            1186 06041000
@DL01186 DS    0H                                                  1187 06042000
*                      IF SORTJ < SORTR                            1187 06043000
*                        THEN                                      1187 06044000
*                                                                  1187 06045000
*                                                                  1187 06046000
         CR    SORTJ,SORTR                                         1187 06047000
         BNL   @RF01187                                            1187 06048000
*                          IF SHEAPTR(SORTJ) -> RSAREC(1:SRTRECSZ) <    06049000
*                             SHEAPTR(SORTJ + 1) -> RSAREC(1:SRTRECSZ)  06050000
*                            THEN                                  1188 06051000
         L     @15,SRTHEAPT                                        1188 06052000
         LR    @14,SORTJ                                           1188 06053000
         SLA   @14,2                                               1188 06054000
         LA    @01,0(@14,@15)                                      1188 06055000
         AL    @01,@CF01678                                        1188 06056000
         L     @01,SHEAPTR(,@01)                                   1188 06057000
         L     @15,SHEAPTR(@14,@15)                                1188 06058000
         LH    @14,SRTRECSZ                                        1188 06059000
         BCTR  @14,0                                               1188 06060000
         EX    @14,@SC01690                                        1188 06061000
         BNL   @RF01188                                            1188 06062000
*                              SORTJ = SORTJ + 1;                  1189 06063000
*                                                                  1189 06064000
         AL    SORTJ,@CF00220                                      1189 06065000
*                            ELSE;                                 1190 06066000
*                                                                  1190 06067000
@RF01188 DS    0H                                                  1191 06068000
*                        ELSE;                                     1191 06069000
*                                                                  1191 06070000
@RF01187 DS    0H                                                  1192 06071000
*                      IF SORTK -> RSAREC(1:SRTRECSZ) <            1192 06072000
*                         SHEAPTR(SORTJ) -> RSAREC(1:SRTRECSZ)     1192 06073000
*                        THEN                                      1192 06074000
         L     @15,SRTHEAPT                                        1192 06075000
         LR    @14,SORTJ                                           1192 06076000
         SLA   @14,2                                               1192 06077000
         AL    @14,@CF01678                                        1192 06078000
         L     @14,SHEAPTR(@14,@15)                                1192 06079000
         LH    @07,SRTRECSZ                                        1192 06080000
         BCTR  @07,0                                               1192 06081000
         L     @01,SORTK                                           1192 06082000
         EX    @07,@SC01692                                        1192 06083000
         BNL   @RF01192                                            1192 06084000
*                          DO;                                     1193 06085000
*                                                                  1193 06086000
*                          SHEAPTR(SORTI) = SHEAPTR(SORTJ);        1194 06087000
*                                                                  1194 06088000
*                                                                  1194 06089000
         LR    @07,SORTI                                           1194 06090000
         SLA   @07,2                                               1194 06091000
         AL    @15,@CF01678                                        1194 06092000
         ST    @14,SHEAPTR(@07,@15)                                1194 06093000
*                          SORTI = SORTJ;                          1195 06094000
         LR    SORTI,SORTJ                                         1195 06095000
*                          SORTJ = SORTJ * 2;                      1196 06096000
*                                                                  1196 06097000
         ALR   SORTJ,SORTJ                                         1196 06098000
*                          END;                                    1197 06099000
*                                                                  1197 06100000
*                        ELSE                                      1198 06101000
*                          SORTJ = SORTR + 1;                      1198 06102000
*                                                                  1198 06103000
         B     @RC01192                                            1198 06104000
@RF01192 LA    SORTJ,1                                             1198 06105000
         ALR   SORTJ,SORTR                                         1198 06106000
*                      END SORTINNM;                               1199 06107000
*                                                                  1199 06108000
@RC01192 DS    0H                                                  1199 06109000
@DE01186 CR    SORTJ,SORTR                                         1199 06110000
         BNH   @DL01186                                            1199 06111000
*                    ELSE                                          1200 06112000
*SORTINLG:             DO WHILE SORTJ <= SORTR;                    1200 06113000
*                                                                  1200 06114000
         B     @RC01185                                            1200 06115000
@RF01185 DS    0H                                                  1200 06116000
SORTINLG B     @DE01200                                            1200 06117000
@DL01200 DS    0H                                                  1201 06118000
*                      IF SORTJ < SORTR                            1201 06119000
*                        THEN                                      1201 06120000
         CR    SORTJ,SORTR                                         1201 06121000
         BNL   @RF01201                                            1201 06122000
*                          IF SHEAPTR(SORTJ) -> RSAREC(1:MVCMLIM) <     06123000
*                             SHEAPTR(SORTJ + 1) -> RSAREC(1:MVCMLIM)   06124000
*                            THEN                                  1202 06125000
         L     @15,SRTHEAPT                                        1202 06126000
         LR    @14,SORTJ                                           1202 06127000
         SLA   @14,2                                               1202 06128000
         LA    @01,0(@14,@15)                                      1202 06129000
         AL    @01,@CF01678                                        1202 06130000
         L     @01,SHEAPTR(,@01)                                   1202 06131000
         L     @15,SHEAPTR(@14,@15)                                1202 06132000
         CLC   RSAREC(256,@01),RSAREC(@15)                         1202 06133000
         BNL   @RF01202                                            1202 06134000
*                              SORTJ = SORTJ + 1;                  1203 06135000
*                                                                  1203 06136000
         AL    SORTJ,@CF00220                                      1203 06137000
*                            ELSE                                  1204 06138000
*                              IF SHEAPTR(SORTJ) -> RSAREC(1:MVCMLIM) = 06139000
*                                 SHEAPTR(SORTJ + 1) ->            1204 06140000
*                                                   RSAREC(1:MVCMLIM)   06141000
*                                THEN                              1204 06142000
         B     @RC01202                                            1204 06143000
@RF01202 L     @15,SRTHEAPT                                        1204 06144000
         LR    @14,SORTJ                                           1204 06145000
         SLA   @14,2                                               1204 06146000
         LA    @01,0(@14,@15)                                      1204 06147000
         AL    @01,@CF01678                                        1204 06148000
         L     @07,SHEAPTR(,@01)                                   1204 06149000
         L     @06,SHEAPTR(@14,@15)                                1204 06150000
         CLC   RSAREC(256,@07),RSAREC(@06)                         1204 06151000
         BNE   @RF01204                                            1204 06152000
*                                  IF SHEAPTR(SORTJ) ->            1205 06153000
*                                       RSAREC(MVCMLIM + 1:SRTRECSZ) <  06154000
*                                     SHEAPTR(SORTJ + 1) ->        1205 06155000
*                                       RSAREC(MVCMLIM + 1:SRTRECSZ)    06156000
*                                    THEN                          1205 06157000
         LH    @15,SRTRECSZ                                        1205 06158000
         SL    @15,@CF01651                                        1205 06159000
         EX    @15,@SC01694                                        1205 06160000
         BNL   @RF01205                                            1205 06161000
*                                      SORTJ = SORTJ + 1;          1206 06162000
*                                                                  1206 06163000
         AL    SORTJ,@CF00220                                      1206 06164000
*                                    ELSE;                         1207 06165000
@RF01205 DS    0H                                                  1208 06166000
*                                ELSE;                             1208 06167000
@RF01204 DS    0H                                                  1209 06168000
*                        ELSE;                                     1209 06169000
*                                                                  1209 06170000
@RF01201 DS    0H                                                  1210 06171000
*                      IF (SORTK -> RSAREC(1:MVCMLIM) <            1210 06172000
*                          SHEAPTR(SORTJ) -> RSAREC(1:MVCMLIM)) |  1210 06173000
*                                                                  1210 06174000
*                         (SORTK -> RSAREC(1:MVCMLIM) =            1210 06175000
*                          SHEAPTR(SORTJ) -> RSAREC(1:MVCMLIM) &   1210 06176000
*                          SORTK -> RSAREC(MVCMLIM + 1:SRTRECSZ) < 1210 06177000
*                          SHEAPTR(SORTJ) ->                       1210 06178000
*                                   RSAREC(MVCMLIM + 1:SRTRECSZ))  1210 06179000
*                                                                  1210 06180000
*                        THEN                                      1210 06181000
@RC01201 L     @15,SORTK                                           1210 06182000
         LR    @14,SORTJ                                           1210 06183000
         SLA   @14,2                                               1210 06184000
         L     @01,SRTHEAPT                                        1210 06185000
         AL    @01,@CF01678                                        1210 06186000
         L     @14,SHEAPTR(@14,@01)                                1210 06187000
         CLC   RSAREC(256,@15),RSAREC(@14)                         1210 06188000
         BL    @RT01210                                            1210 06189000
         CLC   RSAREC(256,@15),RSAREC(@14)                         1210 06190000
         BNE   @RF01210                                            1210 06191000
         LH    @07,SRTRECSZ                                        1210 06192000
         SL    @07,@CF01651                                        1210 06193000
         EX    @07,@SC01696                                        1210 06194000
         BNL   @RF01210                                            1210 06195000
@RT01210 DS    0H                                                  1211 06196000
*                          DO;                                     1211 06197000
*                                                                  1211 06198000
*                          SHEAPTR(SORTI) = SHEAPTR(SORTJ);        1212 06199000
*                                                                  1212 06200000
         L     @15,SRTHEAPT                                        1212 06201000
         LR    @14,SORTI                                           1212 06202000
         SLA   @14,2                                               1212 06203000
         LR    @07,SORTJ                                           1212 06204000
         SLA   @07,2                                               1212 06205000
         AL    @07,@CF01678                                        1212 06206000
         L     @07,SHEAPTR(@07,@15)                                1212 06207000
         AL    @15,@CF01678                                        1212 06208000
         ST    @07,SHEAPTR(@14,@15)                                1212 06209000
*                          SORTI = SORTJ;                          1213 06210000
         LR    SORTI,SORTJ                                         1213 06211000
*                          SORTJ = SORTJ * 2;                      1214 06212000
*                                                                  1214 06213000
         ALR   SORTJ,SORTJ                                         1214 06214000
*                          END;                                    1215 06215000
*                                                                  1215 06216000
*                        ELSE                                      1216 06217000
*                          SORTJ = SORTR + 1;                      1216 06218000
*                                                                  1216 06219000
         B     @RC01210                                            1216 06220000
@RF01210 LA    SORTJ,1                                             1216 06221000
         ALR   SORTJ,SORTR                                         1216 06222000
*                      END SORTINLG;                               1217 06223000
*                                                                  1217 06224000
@RC01210 DS    0H                                                  1217 06225000
@DE01200 CR    SORTJ,SORTR                                         1217 06226000
         BNH   @DL01200                                            1217 06227000
*                  /**************************************************/ 06228000
*                  /*                                                */ 06229000
*                  /* MOVE THE WORKING KEY TO THE FINAL SLOT         */ 06230000
*                  /*                                                */ 06231000
*                  /**************************************************/ 06232000
*                                                                  1218 06233000
*                  SHEAPTR(SORTI) = SORTK;                         1218 06234000
*                                                                  1218 06235000
@RC01185 LR    @02,SORTI                                           1218 06236000
         SLA   @02,2                                               1218 06237000
         L     @15,SORTK                                           1218 06238000
         L     @14,SRTHEAPT                                        1218 06239000
         AL    @14,@CF01678                                        1218 06240000
         ST    @15,SHEAPTR(@02,@14)                                1218 06241000
*                  END RNOTONE;                                    1219 06242000
*                                                                  1219 06243000
*            END SORTOUTR;                                         1220 06244000
*                                                                  1220 06245000
@RF01181 DS    0H                                                  1220 06246000
@DE01170 LA    @04,1                                               1220 06247000
         CR    SORTR,@04                                           1220 06248000
         BH    @DL01170                                            1220 06249000
*            /********************************************************/ 06250000
*            /*                                                      */ 06251000
*            /* MOVE THE FINAL WORKING KEY TO THE TOP OF THE HEAP.   */ 06252000
*            /*                                                      */ 06253000
*            /********************************************************/ 06254000
*                                                                  1221 06255000
*            IF SRTRSACT > 1                                       1221 06256000
*              THEN                                                1221 06257000
         C     @04,SRTRSACT                                        1221 06258000
         BNL   @RF01221                                            1221 06259000
*               SHEAPTR(1) = SORTK;                                1222 06260000
*                                                                  1222 06261000
         L     @15,SORTK                                           1222 06262000
         L     @14,SRTHEAPT                                        1222 06263000
         ST    @15,SHEAPTR(,@14)                                   1222 06264000
*            END SORTLOOP;                                         1223 06265000
*                                                                  1223 06266000
@RF01221 DS    0H                                                  1224 06267000
*        /************************************************************/ 06268000
*        /*                                                          */ 06269000
*        /* AFTER THE HEAP HAS BEEN SORTED, DETERMINE IF EITHER      */ 06270000
*        /* OF THE FOLLOWING CONDITIONS EXIST -                      */ 06271000
*        /*                                                          */ 06272000
*        /*   . THE RSA HAS REACHED CAPACITY BEFORE THE END OF FILE  */ 06273000
*        /*     ON THE BASE CLUSTER                                  */ 06274000
*        /*                                                          */ 06275000
*        /*   . THE RSA HAS NOT REACHED CAPACITY BUT AN EXTERNAL     */ 06276000
*        /*     SORT HAS BEEN INITIATED BY ITS REACHING CAPACITY     */ 06277000
*        /*     PREVIOUSLY AND END OF FILE HAS BEEN REACHED          */ 06278000
*        /*                                                          */ 06279000
*        /* IF EITHER OF THESE CONDITIONS EXIST, CALL SPILPROC       */ 06280000
*        /* TO WRITE OUT THE RSA RECORDS IN A STRING TO THE SORT     */ 06281000
*        /* WORK FILE.  IF SPILPROC ENCOUNTERS AN ERROR, RETURN TO   */ 06282000
*        /* THE CALLING PROCEDURE (CNTLPROC) WITH A CODE 8.          */ 06283000
*        /*                                                          */ 06284000
*        /************************************************************/ 06285000
*                                                                  1224 06286000
*        IF (SRTRSACT = SRTRSACP & SORTCLID ^= 'L') |              1224 06287000
*           (SORTCLID = 'L' & SRTFLEXT = ON)                       1224 06288000
*          THEN                                                    1224 06289000
@RF01163 CLC   SRTRSACT(4),SRTRSACP                                1224 06290000
         BNE   @GL00018                                            1224 06291000
         L     @15,@PC00013+20                                     1224 06292000
         CLI   SORTCLID(@15),C'L'                                  1224 06293000
         BNE   @RT01224                                            1224 06294000
@GL00018 L     @15,@PC00013+20                                     1224 06295000
         CLI   SORTCLID(@15),C'L'                                  1224 06296000
         BNE   @RF01224                                            1224 06297000
         TM    SRTFLEXT,B'01000000'                                1224 06298000
         BNO   @RF01224                                            1224 06299000
@RT01224 DS    0H                                                  1225 06300000
*            DO;                                                   1225 06301000
*                                                                  1225 06302000
*            CALL SPILPROC (SORTIOCS,SORTIOIN,SORTSRTB,SORTSTAT);  1226 06303000
*                                                                  1226 06304000
         L     @15,@PC00013+4                                      1226 06305000
         ST    @15,@AL00001                                        1226 06306000
         L     @15,@PC00013+8                                      1226 06307000
         ST    @15,@AL00001+4                                      1226 06308000
         L     @15,@PC00013+12                                     1226 06309000
         ST    @15,@AL00001+8                                      1226 06310000
         L     @15,@PC00013+16                                     1226 06311000
         ST    @15,@AL00001+12                                     1226 06312000
         LA    @01,@AL00001                                        1226 06313000
         BAL   @14,SPILPROC                                        1226 06314000
*            RESPECIFY RTNREG RSTD;                                1227 06315000
*            TESTRC = RTNREG;                                      1228 06316000
         LR    TESTRC,RTNREG                                       1228 06317000
*            RESPECIFY RTNREG UNRSTD;                              1229 06318000
*                                                                  1229 06319000
*            IF TESTRC ^= 0                                        1230 06320000
*              THEN                                                1230 06321000
         LTR   TESTRC,TESTRC                                       1230 06322000
         BZ    @RF01230                                            1230 06323000
*                RETURN CODE(LASTCC08);                            1231 06324000
*                                                                  1231 06325000
         LA    @15,8                                               1231 06326000
         L     @14,@SA00013                                        1231 06327000
         LM    @00,@12,@SA00013+8                                  1231 06328000
         BR    @14                                                 1231 06329000
*            END;                                                  1232 06330000
*                                                                  1232 06331000
@RF01230 DS    0H                                                  1233 06332000
*        /************************************************************/ 06333000
*        /*                                                          */ 06334000
*        /* IF A BASE CLUSTER RECORD HAS BEEN PASSED AS A PARA-      */ 06335000
*        /* METER TO SORTPROC (I.E., THIS IS NOT THE LAST CALL),     */ 06336000
*        /* PREPARE TO FORM THE SORT RECORD.  KEEP A COUNT OF THE    */ 06337000
*        /* NUMBER OF RECORDS IN THE BASE CLUSTER.  IF THIS IS THE   */ 06338000
*        /* FIRST BASE CLUSTER RECORD AND THE BASE CLUSTER IS A      */ 06339000
*        /* KSDS, SAVE ITS KEY.  THIS KEY WILL BE USED TO            */ 06340000
*        /* RE-POSITION AT THE START OF THE BASE CLUSTER IF          */ 06341000
*        /* MULTIPLE ALTERNATE INDEXES ARE BEING BUILT.              */ 06342000
*        /*                                                          */ 06343000
*        /************************************************************/ 06344000
*                                                                  1233 06345000
*        IF SORTCLID ^= 'L'                                        1233 06346000
*          THEN                                                    1233 06347000
@RF01224 L     @15,@PC00013+20                                     1233 06348000
         CLI   SORTCLID(@15),C'L'                                  1233 06349000
         BE    @RF01233                                            1233 06350000
*NEWREC:     DO;                                                   1234 06351000
*                                                                  1234 06352000
NEWREC   DS    0H                                                  1235 06353000
*            AMDSBPTR = SORAMBAS;                                  1235 06354000
         L     @03,@PC00013                                        1235 06355000
         L     AMDSBPTR,SORAMBAS(,@03)                             1235 06356000
*            IOCSPTR  = SOIOCSBS;                                  1236 06357000
         L     @05,@PC00013+4                                      1236 06358000
         L     IOCSPTR,SOIOCSBS(,@05)                              1236 06359000
*            SRTBSCNT = SRTBSCNT + 1;                              1237 06360000
*                                                                  1237 06361000
         LA    @05,1                                               1237 06362000
         L     @03,SRTBSCNT                                        1237 06363000
         ALR   @03,@05                                             1237 06364000
         ST    @03,SRTBSCNT                                        1237 06365000
*            IF SRTBSCNT = 1                                       1238 06366000
*              THEN                                                1238 06367000
         CR    @03,@05                                             1238 06368000
         BNE   @RF01238                                            1238 06369000
*                IF AMDDST = ON                                    1239 06370000
*                  THEN                                            1239 06371000
         TM    AMDDST(AMDSBPTR),B'10000000'                        1239 06372000
         BNO   @RF01239                                            1239 06373000
*                    DO;                                           1240 06374000
*                                                                  1240 06375000
*                    SAVEKEY = ''B;                                1241 06376000
         XC    SAVEKEY(256),SAVEKEY                                1241 06377000
*                    SAVEKEY(1:AMDKEYLN) =                         1242 06378000
*                      BASEREC(AMDRKP + 1:AMDRKP + AMDKEYLN);      1242 06379000
*                                                                  1242 06380000
         LH    @05,AMDKEYLN(,AMDSBPTR)                             1242 06381000
         BCTR  @05,0                                               1242 06382000
         LH    @03,AMDRKP(,AMDSBPTR)                               1242 06383000
         L     @01,IOCDAD(,IOCSPTR)                                1242 06384000
         ALR   @01,@03                                             1242 06385000
         EX    @05,@SM01698                                        1242 06386000
*                    END;                                          1243 06387000
*                                                                  1243 06388000
*            /********************************************************/ 06389000
*            /*                                                      */ 06390000
*            /* IF THE BASE CLUSTER RECORD IS NOT LONG ENOUGH TO     */ 06391000
*            /* CONTAIN THE FULL ALTERNATE KEY, ISSUE A WARNING      */ 06392000
*            /* MESSAGE CONTAINING THE FIRST 10 BYTES OF THE PRIME   */ 06393000
*            /* KEY OR THE RBA.                                      */ 06394000
*            /*                                                      */ 06395000
*            /********************************************************/ 06396000
*                                                                  1244 06397000
*            AMDSBPTR = SORAMAIX;                                  1244 06398000
*                                                                  1244 06399000
@RF01239 DS    0H                                                  1244 06400000
@RF01238 L     @03,@PC00013                                        1244 06401000
         L     AMDSBPTR,SORAMAIX(,@03)                             1244 06402000
*            IF AMDAXRKP + AMDKEYLN > IOCDLN                       1245 06403000
*              THEN                                                1245 06404000
         LH    @05,AMDAXRKP(,AMDSBPTR)                             1245 06405000
         AH    @05,AMDKEYLN(,AMDSBPTR)                             1245 06406000
         C     @05,IOCDLN(,IOCSPTR)                                1245 06407000
         BNH   @RF01245                                            1245 06408000
*                DO;                                               1246 06409000
*                                                                  1246 06410000
*                SOSAVERC = LASTCC04;                              1247 06411000
*                                                                  1247 06412000
         L     @15,@PC00013+16                                     1247 06413000
         MVC   SOSAVERC(2,@15),@CH00043                            1247 06414000
*                DARGLIST = ''B;                                   1248 06415000
*                                                                  1248 06416000
         L     @15,DDSTRU                                          1248 06417000
         XC    DARGLIST(20,@15),DARGLIST(@15)                      1248 06418000
*                IF SORAMBAS -> AMDDST = ON                        1249 06419000
*                  THEN                                            1249 06420000
         L     @03,SORAMBAS(,@03)                                  1249 06421000
         TM    AMDDST(@03),B'10000000'                             1249 06422000
         BNO   @RF01249                                            1249 06423000
*                    DO;                                           1250 06424000
*                                                                  1250 06425000
*                    DARGSTID = NOAXKYKS;                          1251 06426000
         MVC   DARGSTID(4,@15),@CF00892                            1251 06427000
*                    DARGDBP  = IOCKYA;                            1252 06428000
*                                                                  1252 06429000
         L     @03,IOCKYA(,IOCSPTR)                                1252 06430000
         ST    @03,DARGDBP(,@15)                                   1252 06431000
*                    IF IOCKYL > 10                                1253 06432000
*                      THEN                                        1253 06433000
         CLI   IOCKYL(IOCSPTR),10                                  1253 06434000
         BNH   @RF01253                                            1253 06435000
*                        DARGILP = 10;                             1254 06436000
         MVC   DARGILP(2,@15),@CH00037                             1254 06437000
*                      ELSE                                        1255 06438000
*                        DARGILP = IOCKYL;                         1255 06439000
*                                                                  1255 06440000
         B     @RC01253                                            1255 06441000
@RF01253 SLR   @03,@03                                             1255 06442000
         IC    @03,IOCKYL(,IOCSPTR)                                1255 06443000
         L     @01,DDSTRU                                          1255 06444000
         STH   @03,DARGILP(,@01)                                   1255 06445000
*                    END;                                          1256 06446000
*                                                                  1256 06447000
*                  ELSE                                            1257 06448000
*                    DO;                                           1257 06449000
*                                                                  1257 06450000
         B     @RC01249                                            1257 06451000
@RF01249 DS    0H                                                  1258 06452000
*                    DARGSTID = NOAXKYES;                          1258 06453000
         L     @03,DDSTRU                                          1258 06454000
         MVC   DARGSTID(4,@03),@CF00916                            1258 06455000
*                    DARGDBP = ADDR(IOCRBA);                       1259 06456000
         LA    @15,IOCRBA(,IOCSPTR)                                1259 06457000
         ST    @15,DARGDBP(,@03)                                   1259 06458000
*                    DARGILP = LENGTH(IOCRBA);                     1260 06459000
*                                                                  1260 06460000
         MVC   DARGILP(2,@03),@CH00043                             1260 06461000
*                    END;                                          1261 06462000
*                                                                  1261 06463000
*                CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);            1262 06464000
*                                                                  1262 06465000
@RC01249 L     @15,@PC00001                                        1262 06466000
         ST    @15,@AL00001                                        1262 06467000
         LA    @14,@CF00116                                        1262 06468000
         ST    @14,@AL00001+4                                      1262 06469000
         LA    @14,DDSTRU                                          1262 06470000
         ST    @14,@AL00001+8                                      1262 06471000
         MVI   @AL00001+8,X'80'                                    1262 06472000
         L     @15,GDTPRT(,@15)                                    1262 06473000
         LA    @01,@AL00001                                        1262 06474000
         BALR  @14,@15                                             1262 06475000
*                END;                                              1263 06476000
*                                                                  1263 06477000
*              ELSE                                                1264 06478000
*                DO;                                               1264 06479000
*                                                                  1264 06480000
         B     @RC01245                                            1264 06481000
@RF01245 DS    0H                                                  1265 06482000
*                /****************************************************/ 06483000
*                /*                                                  */ 06484000
*                /* THE BASE CLUSTER RECORD CONTAINS THE ALTERNATE   */ 06485000
*                /* KEY.  MOVE IT TO THE NEXT RECORD AREA IN THE     */ 06486000
*                /* RSA AND FOLLOW IT WITH THE PRIME KEY OR RBA.     */ 06487000
*                /* UPDATE THE COUNT OF RECORDS IN THE RSA.          */ 06488000
*                /*                                                  */ 06489000
*                /****************************************************/ 06490000
*                                                                  1265 06491000
*                RSAREC(1:AMDKEYLN) =                              1265 06492000
*                  BASEREC(AMDAXRKP + 1:AMDAXRKP + AMDKEYLN);      1265 06493000
*                                                                  1265 06494000
         L     @05,SRTCURSA                                        1265 06495000
         LH    @03,AMDKEYLN(,AMDSBPTR)                             1265 06496000
         LR    @15,@03                                             1265 06497000
         BCTR  @15,0                                               1265 06498000
         LH    @01,AMDAXRKP(,AMDSBPTR)                             1265 06499000
         L     @14,IOCDAD(,IOCSPTR)                                1265 06500000
         ALR   @01,@14                                             1265 06501000
         EX    @15,@SM01700                                        1265 06502000
*                IF SORAMBAS -> AMDDST = ON                        1266 06503000
*                  THEN                                            1266 06504000
         L     @15,@PC00013                                        1266 06505000
         L     @15,SORAMBAS(,@15)                                  1266 06506000
         TM    AMDDST(@15),B'10000000'                             1266 06507000
         BNO   @RF01266                                            1266 06508000
*                    RSAREC(AMDKEYLN + 1:SRTRECSZ) =               1267 06509000
*                      BASEREC(SORAMBAS -> AMDRKP + 1:             1267 06510000
*                              SORAMBAS -> AMDRKP +                1267 06511000
*                              SORAMBAS -> AMDKEYLN);              1267 06512000
*                                                                  1267 06513000
         ALR   @05,@03                                             1267 06514000
         LCR   @03,@03                                             1267 06515000
         AH    @03,SRTRECSZ                                        1267 06516000
         BCTR  @03,0                                               1267 06517000
         LH    @01,AMDRKP(,@15)                                    1267 06518000
         ALR   @14,@01                                             1267 06519000
         EX    @03,@SM01702                                        1267 06520000
*                  ELSE                                            1268 06521000
*                    RSAREC(AMDKEYLN + 1:SRTRECSZ) =               1268 06522000
*                      CHARRBA;                                    1268 06523000
*                                                                  1268 06524000
         B     @RC01266                                            1268 06525000
@RF01266 LH    @05,AMDKEYLN(,AMDSBPTR)                             1268 06526000
         L     @03,SRTCURSA                                        1268 06527000
         ALR   @03,@05                                             1268 06528000
         LCR   @05,@05                                             1268 06529000
         AH    @05,SRTRECSZ                                        1268 06530000
         BCTR  @05,0                                               1268 06531000
         EX    @05,@SM01704                                        1268 06532000
*                SRTRSACT = SRTRSACT + 1;                          1269 06533000
*                                                                  1269 06534000
@RC01266 LA    @15,1                                               1269 06535000
         AL    @15,SRTRSACT                                        1269 06536000
         ST    @15,SRTRSACT                                        1269 06537000
*                /****************************************************/ 06538000
*                /*                                                  */ 06539000
*                /* PLACE THE ADDRESS OF THE NEW RECORD INTO THE     */ 06540000
*                /* HEAP.  UPDATE THE CURRENT RSA AND HEAP ADDRESSES */ 06541000
*                /* TO THE NEXT AVAILABLE SLOT.                      */ 06542000
*                /*                                                  */ 06543000
*                /****************************************************/ 06544000
*                                                                  1270 06545000
*                SHEAPTR(SRTRSACT) = SRTCURSA;                     1270 06546000
*                                                                  1270 06547000
         L     @14,SRTCURSA                                        1270 06548000
         SLA   @15,2                                               1270 06549000
         L     @01,SRTHEAPT                                        1270 06550000
         AL    @01,@CF01678                                        1270 06551000
         ST    @14,SHEAPTR(@15,@01)                                1270 06552000
*                SRTCURSA = SRTCURSA + SRTRECSZ;                   1271 06553000
*                                                                  1271 06554000
         AH    @14,SRTRECSZ                                        1271 06555000
         ST    @14,SRTCURSA                                        1271 06556000
*                END;                                              1272 06557000
*                                                                  1272 06558000
*            END NEWREC;                                           1273 06559000
*                                                                  1273 06560000
*          ELSE                                                    1274 06561000
*                                                                  1274 06562000
*            /********************************************************/ 06563000
*            /*                                                      */ 06564000
*            /* THIS IS THE LAST CALL TO SORTPROC.  STORE THE BASE   */ 06565000
*            /* CLUSTER RECORD COUNT IN THE BASE AMDSB.  THIS COUNT  */ 06566000
*            /* IS MADE BY SORTPROC IN THE EVENT THAT MULTIPLE       */ 06567000
*            /* ALTERNATE INDEXES ARE BEING BUILT.  THE STATISTIC    */ 06568000
*            /* WILL THEN BE CORRECT FOR THE SECOND AND SUBSEQUENT   */ 06569000
*            /* BUILDS.                                              */ 06570000
*            /*                                                      */ 06571000
*            /*******************************************************/  06572000
*                                                                  1274 06573000
*            SORAMBAS -> AMDNLR = SRTBSCNT;                        1274 06574000
*                                                                  1274 06575000
         B     @RC01233                                            1274 06576000
@RF01233 L     @15,@PC00013                                        1274 06577000
         L     @01,SORAMBAS(,@15)                                  1274 06578000
         L     @00,SRTBSCNT                                        1274 06579000
         ST    @00,AMDNLR(,@01)                                    1274 06580000
*        /************************************************************/ 06581000
*        /*                                                          */ 06582000
*        /* THIS COMPLETES SORTPROC PROCESSING.  RETURN TO CALLING   */ 06583000
*        /* PROCEDURE (CNTLPROC).                                    */ 06584000
*        /*                                                          */ 06585000
*        /************************************************************/ 06586000
*                                                                  1275 06587000
*        RETURN CODE(LASTCC00);                                    1275 06588000
*                                                                  1275 06589000
@RC01233 SLR   @15,@15                                             1275 06590000
         L     @14,@SA00013                                        1275 06591000
         LM    @00,@12,@SA00013+8                                  1275 06592000
         BR    @14                                                 1275 06593000
*END SORTPROC;                                                     1276 06594000
*        /************************************************************/ 06595000
*        /*                                                          */ 06596000
*        /* PROCEDURE NAME - SPILPROC                                */ 06597000
*        /*                                                          */ 06598000
*        /* FUNCTION - PERFORMS THE FUNCTION OF WRITING OUT THE      */ 06599000
*        /*            RECORDS IN THE RECORD SORT AREA TO THE        */ 06600000
*        /*            FIRST EXTERNAL SORT WORK FILE.  RECORDS       */ 06601000
*        /*            ARE MOVED IN SEQUENCE, USING THE POINTERS     */ 06602000
*        /*            IN THE SORTED HEAP, TO THE OUTPUT 2K BUFFER.  */ 06603000
*        /*            WHEN THE BUFFER IS FILLED, A UPUT MACRO IS    */ 06604000
*        /*            ISSUED TO WRITE IT TO THE OUTPUT SORT WORK    */ 06605000
*        /*            FILE.  THIS PROCESS CONTINUES UNTIL ALL       */ 06606000
*        /*            RECORDS HAVE BEEN WRITTEN OUT.                */ 06607000
*        /*                                                          */ 06608000
*        /* INPUT -                                                  */ 06609000
*        /*        SPILIOCS - POINTERS TO IOCSTR FOR EACH OPEN DATA  */ 06610000
*        /*                   SET                                    */ 06611000
*        /*                                                          */ 06612000
*        /*        SPILIOIN - POINTERS TO THE DATA OBTAINED FROM     */ 06613000
*        /*                   THE SORT WORK JOB CONTROL              */ 06614000
*        /*                                                          */ 06615000
*        /*        SPILSRTB - SORT CONTROL TABLE                     */ 06616000
*        /*                                                          */ 06617000
*        /* OUTPUT -                                                 */ 06618000
*        /*        SPILSTAT - STATUS COMMUNICATION AREA              */ 06619000
*        /*                                                          */ 06620000
*        /*        SORT RECORDS HAVE BEEN WRITTEN TO THE SORT        */ 06621000
*        /*        WORK FILE                                         */ 06622000
*        /*                                                          */ 06623000
*        /* EXIT, NORMAL - ALL FUNCTIONS SUCCESSFULLY COMPLETED      */ 06624000
*        /*                                                          */ 06625000
*        /* EXIT, ERROR  - RETURN CODE 8,                            */ 06626000
*        /*                                                          */ 06627000
*        /*                  . THE SORT WORK FILE WAS NOT OPEN       */ 06628000
*        /*                    ON ENTRY TO SPILPROC AND DEFPROC      */ 06629000
*        /*                    WAS CALLED WHERE A TERMINATING        */ 06630000
*        /*                    ERROR WAS ENCOUNTERED                 */ 06631000
*        /*                                                          */ 06632000
*        /*                  . AN ERROR OCCURRED IN WRITING A        */ 06633000
*        /*                    RECORD TO THE OUTPUT FILE             */ 06634000
*        /*                                                          */ 06635000
*        /************************************************************/ 06636000
*                                                                  1277 06637000
*SPILPROC:                                                         1277 06638000
*        PROCEDURE (SPILIOCS,          /* POINTERS TO IOCSTRS        */ 06639000
*                   SPILIOIN,          /* POINTERS TO SORT WORK DATA */ 06640000
*                   SPILSRTB,          /* SORT CONTROL TABLE         */ 06641000
*                   SPILSTAT);         /* STATUS COMMUNICATION AREA  */ 06642000
*                                                                  1277 06643000
SPILPROC STM   @14,@12,@SA00014                                    1277 06644000
         MVC   @PC00014(16),0(@01)                                 1277 06645000
*        /************************************************************/ 06646000
*        /*                                                          */ 06647000
*        /* ARGUMENTS OF INVOCATION                                  */ 06648000
*        /*                                                          */ 06649000
*        /************************************************************/ 06650000
*                                                                  1278 06651000
*        DCL 1 SPILIOCS BDY(WORD),     /* POINTERS TO IOCSTRS        */ 06652000
*              2 SPIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */ 06653000
*              2 SPIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */ 06654000
*              2 SPIOCSSR(2) PTR(31);  /* POINTERS TO SORT IOCSTRS   */ 06655000
*                                                                  1278 06656000
*        DCL 1 SPILIOIN BDY(WORD),     /* POINTER TO SORT WORK JOB   */ 06657000
*              2 SPIOINPT(2) PTR(31);  /* CONTROL DATA               */ 06658000
*                                                                  1279 06659000
*        DCL SPILSRTB;                 /* SORT CONTROL TABLE         */ 06660000
*                                                                  1280 06661000
*        DCL 1 SPILSTAT,               /* STATUS COMMUNICATION AREA  */ 06662000
*              2 SPSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */ 06663000
*              2 SPSTID   CHAR(4);     /* ERROR IDENTIFIER           */ 06664000
*                                                                  1281 06665000
*        /************************************************************/ 06666000
*        /*                                                          */ 06667000
*        /* LOOP CONTROL VARIABLES                                   */ 06668000
*        /*                                                          */ 06669000
*        /************************************************************/ 06670000
*                                                                  1282 06671000
*        DCL                                                       1282 06672000
*          PUTCTR FIXED(31),           /* NUMBER OF RECORDS TO WRITE */ 06673000
*          SP1    FIXED(31),           /* HEAP INDEX                 */ 06674000
*          SP2    FIXED(31),           /* INNER LOOP CONTROL         */ 06675000
*          SP2LIM FIXED(15);           /* INNER LOOP TO VALUE        */ 06676000
*                                                                  1282 06677000
*        /************************************************************/ 06678000
*        /*                                                          */ 06679000
*        /* OVERLAY OF SORT RECORD IN THE 2K BUFFER                  */ 06680000
*        /*                                                          */ 06681000
*        /************************************************************/ 06682000
*                                                                  1283 06683000
*        DCL SPRECPTR PTR(31);                                     1283 06684000
*                                                                  1283 06685000
*        DCL SPSRTREC CHAR(*) BASED(SPRECPTR);                     1284 06686000
*        /************************************************************/ 06687000
*        /*                                                          */ 06688000
*        /* IF THE SORT WORK FILES HAVE NOT PREVIOUSLY BEEN OPENED,  */ 06689000
*        /* CALL DEFPROC TO DEFINE (IF NECESSARY) AND OPEN THEM      */ 06690000
*        /*                                                          */ 06691000
*        /************************************************************/ 06692000
*                                                                  1285 06693000
*        OLDERID2 = NEWERID2;                                      1285 06694000
         L     @15,@PC00001                                        1285 06695000
         L     @15,GDTTR2(,@15)                                    1285 06696000
         MVC   @TS00001(95),NEWERID2(@15)                          1285 06697000
         MVC   OLDERID2(95,@15),@TS00001                           1285 06698000
*        NEWID2 = 'BISP';                                          1286 06699000
*                                                                  1286 06700000
         MVC   NEWID2(4,@15),@CC01482                              1286 06701000
*        IF SPIOCSSR(1) = NULLPTR                                  1287 06702000
*          THEN                                                    1287 06703000
         L     @15,@PC00014                                        1287 06704000
         L     @14,SPIOCSSR(,@15)                                  1287 06705000
         LTR   @14,@14                                             1287 06706000
         BNZ   @RF01287                                            1287 06707000
*            DO;                                                   1288 06708000
*                                                                  1288 06709000
*            CALL DEFPROC ('C',SPILIOIN,SPILIOCS,SPILSRTB,SPILSTAT);    06710000
*                                                                  1289 06711000
         LA    @14,@CC00727                                        1289 06712000
         ST    @14,@AL00001                                        1289 06713000
         L     @14,@PC00014+4                                      1289 06714000
         ST    @14,@AL00001+4                                      1289 06715000
         ST    @15,@AL00001+8                                      1289 06716000
         L     @15,@PC00014+8                                      1289 06717000
         ST    @15,@AL00001+12                                     1289 06718000
         L     @15,@PC00014+12                                     1289 06719000
         ST    @15,@AL00001+16                                     1289 06720000
         LA    @01,@AL00001                                        1289 06721000
         BAL   @14,DEFPROC                                         1289 06722000
*            RESPECIFY RTNREG RSTD;                                1290 06723000
*            TESTRC = RTNREG;                                      1291 06724000
         LR    TESTRC,RTNREG                                       1291 06725000
*            RESPECIFY RTNREG UNRSTD;                              1292 06726000
*                                                                  1292 06727000
*            IF TESTRC ^= 0                                        1293 06728000
*              THEN                                                1293 06729000
         LTR   TESTRC,TESTRC                                       1293 06730000
         BZ    @RF01293                                            1293 06731000
*                RETURN CODE(LASTCC08);                            1294 06732000
*                                                                  1294 06733000
         LA    @15,8                                               1294 06734000
         L     @14,@SA00014                                        1294 06735000
         LM    @00,@12,@SA00014+8                                  1294 06736000
         BR    @14                                                 1294 06737000
*            END;                                                  1295 06738000
*                                                                  1295 06739000
@RF01293 DS    0H                                                  1296 06740000
*        /************************************************************/ 06741000
*        /*                                                          */ 06742000
*        /* INITIALIZE LOOP CONTROL FACTORS AND IOCSTR               */ 06743000
*        /*                                                          */ 06744000
*        /************************************************************/ 06745000
*                                                                  1296 06746000
*        SP1    = 1;                                               1296 06747000
@RF01287 LA    SP1,1                                               1296 06748000
*        PUTCTR = SRTRSACT;                                        1297 06749000
*                                                                  1297 06750000
         L     PUTCTR,SRTRSACT                                     1297 06751000
*        IF PUTCTR < SRTRECBK                                      1298 06752000
*          THEN                                                    1298 06753000
         CH    PUTCTR,SRTRECBK                                     1298 06754000
         BNL   @RF01298                                            1298 06755000
*            SP2LIM = PUTCTR;                                      1299 06756000
*                                                                  1299 06757000
         LR    SP2LIM,PUTCTR                                       1299 06758000
*          ELSE                                                    1300 06759000
*            SP2LIM = SRTRECBK;                                    1300 06760000
*                                                                  1300 06761000
         B     @RC01298                                            1300 06762000
@RF01298 LH    SP2LIM,SRTRECBK                                     1300 06763000
*        IOCSPTR = SPIOCSSR(1);                                    1301 06764000
@RC01298 L     @07,@PC00014                                        1301 06765000
         L     IOCSPTR,SPIOCSSR(,@07)                              1301 06766000
*        IOCWORK  = SRTBUFPT;                                      1302 06767000
         L     @07,SRTBUFPT                                        1302 06768000
         ST    @07,IOCWORK(,IOCSPTR)                               1302 06769000
*        IOCDLN   = BLKSIZE;                                       1303 06770000
         MVC   IOCDLN(4,IOCSPTR),@CF00976                          1303 06771000
*        IOCDAD   = 0;                                             1304 06772000
*                                                                  1304 06773000
         SLR   @07,@07                                             1304 06774000
         ST    @07,IOCDAD(,IOCSPTR)                                1304 06775000
*        /************************************************************/ 06776000
*        /*                                                          */ 06777000
*        /* THE OUTER LOOP IS CONTROLLED BY THE NUMBER OF RECORDS    */ 06778000
*        /* IN THE RSA (CONTAINED IN PUTCTR).                        */ 06779000
*        /*                                                          */ 06780000
*        /************************************************************/ 06781000
*                                                                  1305 06782000
*SP1LP:  DO WHILE PUTCTR > 0;                                      1305 06783000
*                                                                  1305 06784000
SP1LP    B     @DE01305                                            1305 06785000
@DL01305 DS    0H                                                  1306 06786000
*          SPRECPTR = SRTBUFPT;                                    1306 06787000
*                                                                  1306 06788000
         L     SPRECPTR,SRTBUFPT                                   1306 06789000
*          /**********************************************************/ 06790000
*          /*                                                        */ 06791000
*          /* THE INNER LOOP IS CONTROLLED BY THE NUMBER OF RECORDS  */ 06792000
*          /* TO BE MOVED TO THE OUTPUT BUFFER, EITHER ITS FULL      */ 06793000
*          /* CAPACITY OR THE NUMBER OF RECORDS REMAINING IN THE     */ 06794000
*          /* RSA - I.E., THE LAST BLOCK.  USING THE POINTERS IN     */ 06795000
*          /* THE HEAP IN SEQUENCE, MOVE THE RECORDS IN THE RSA      */ 06796000
*          /* TO THE OUTPUT BUFFER.                                  */ 06797000
*          /*                                                        */ 06798000
*          /**********************************************************/ 06799000
*                                                                  1307 06800000
*SP2LP:    DO SP2 = 1 TO SP2LIM;                                   1307 06801000
*                                                                  1307 06802000
SP2LP    LA    @07,1                                               1307 06803000
         B     @DE01307                                            1307 06804000
@DL01307 DS    0H                                                  1308 06805000
*            SRTCURSA = SHEAPTR(SP1);                              1308 06806000
*                                                                  1308 06807000
         LR    @07,SP1                                             1308 06808000
         SLA   @07,2                                               1308 06809000
         L     @01,SRTHEAPT                                        1308 06810000
         AL    @01,@CF01678                                        1308 06811000
         L     @07,SHEAPTR(@07,@01)                                1308 06812000
         ST    @07,SRTCURSA                                        1308 06813000
*            IF SRTRECSZ <= MVCMLIM                                1309 06814000
*              THEN                                                1309 06815000
         LH    @15,SRTRECSZ                                        1309 06816000
         C     @15,@CF00925                                        1309 06817000
         BH    @RF01309                                            1309 06818000
*                SPSRTREC(1:SRTRECSZ) = RSAREC(1:SRTRECSZ);        1310 06819000
*                                                                  1310 06820000
         BCTR  @15,0                                               1310 06821000
         EX    @15,@SM01706                                        1310 06822000
*              ELSE                                                1311 06823000
*                DO;                                               1311 06824000
*                                                                  1311 06825000
         B     @RC01309                                            1311 06826000
@RF01309 DS    0H                                                  1312 06827000
*                SPSRTREC(1:MVCMLIM) = RSAREC(1:MVCMLIM);          1312 06828000
         L     @07,SRTCURSA                                        1312 06829000
         MVC   SPSRTREC(256,SPRECPTR),RSAREC(@07)                  1312 06830000
*                SPSRTREC(MVCMLIM + 1:SRTRECSZ) =                  1313 06831000
*                  RSAREC(MVCMLIM + 1:SRTRECSZ);                   1313 06832000
*                                                                  1313 06833000
         LH    @15,SRTRECSZ                                        1313 06834000
         SL    @15,@CF01651                                        1313 06835000
         EX    @15,@SM01708                                        1313 06836000
*                END;                                              1314 06837000
*                                                                  1314 06838000
*            SPRECPTR = SPRECPTR + SRTRECSZ;                       1315 06839000
@RC01309 AH    SPRECPTR,SRTRECSZ                                   1315 06840000
*            SP1      = SP1 + 1;                                   1316 06841000
*                                                                  1316 06842000
         AL    SP1,@CF00220                                        1316 06843000
*          END SP2LP;                                              1317 06844000
*                                                                  1317 06845000
         LA    @07,1                                               1317 06846000
         AL    @07,SP2                                             1317 06847000
@DE01307 ST    @07,SP2                                             1317 06848000
         CR    @07,SP2LIM                                          1317 06849000
         BNH   @DL01307                                            1317 06850000
*          /**********************************************************/ 06851000
*          /*                                                        */ 06852000
*          /* WRITE THE 2K BLOCK TO THE SORT WORK FILE               */ 06853000
*          /*                                                        */ 06854000
*          /**********************************************************/ 06855000
*                                                                  1318 06856000
*          CALL IDCIOPT0 (GDTTBL,SPIOCSSR(1));                     1318 06857000
*                                                                  1318 06858000
         L     @07,@PC00001                                        1318 06859000
         ST    @07,@AL00001                                        1318 06860000
         L     @15,@PC00014                                        1318 06861000
         LA    @15,SPIOCSSR(,@15)                                  1318 06862000
         ST    @15,@AL00001+4                                      1318 06863000
         MVI   @AL00001+4,X'80'                                    1318 06864000
         L     @15,GDTPUT(,@07)                                    1318 06865000
         LA    @01,@AL00001                                        1318 06866000
         BALR  @14,@15                                             1318 06867000
*          RESPECIFY RTNREG RSTD;                                  1319 06868000
*          TESTRC = RTNREG;                                        1320 06869000
         LR    TESTRC,RTNREG                                       1320 06870000
*          RESPECIFY RTNREG UNRSTD;                                1321 06871000
*                                                                  1321 06872000
*          IF TESTRC ^= 0                                          1322 06873000
*            THEN                                                  1322 06874000
         LTR   TESTRC,TESTRC                                       1322 06875000
         BZ    @RF01322                                            1322 06876000
*              RETURN CODE(LASTCC08);                              1323 06877000
*                                                                  1323 06878000
         LA    @15,8                                               1323 06879000
         L     @14,@SA00014                                        1323 06880000
         LM    @00,@12,@SA00014+8                                  1323 06881000
         BR    @14                                                 1323 06882000
*          IOCDAD = 0;                                             1324 06883000
*                                                                  1324 06884000
@RF01322 SLR   @07,@07                                             1324 06885000
         ST    @07,IOCDAD(,IOCSPTR)                                1324 06886000
*          /**********************************************************/ 06887000
*          /*                                                        */ 06888000
*          /* CALCULATE THE NUMBER OF RECORDS TO BE MOVED ON NEXT    */ 06889000
*          /* PASS THROUGH SP2 LOOP                                  */ 06890000
*          /*                                                        */ 06891000
*          /**********************************************************/ 06892000
*                                                                  1325 06893000
*          PUTCTR = PUTCTR - SP2LIM;                               1325 06894000
*                                                                  1325 06895000
         SLR   PUTCTR,SP2LIM                                       1325 06896000
*          IF PUTCTR < SRTRECBK                                    1326 06897000
*            THEN                                                  1326 06898000
         CH    PUTCTR,SRTRECBK                                     1326 06899000
         BNL   @RF01326                                            1326 06900000
*              SP2LIM = PUTCTR;                                    1327 06901000
*                                                                  1327 06902000
         LR    SP2LIM,PUTCTR                                       1327 06903000
*        END SP1LP;                                                1328 06904000
*                                                                  1328 06905000
@RF01326 DS    0H                                                  1328 06906000
@DE01305 SLR   @07,@07                                             1328 06907000
         CR    PUTCTR,@07                                          1328 06908000
         BH    @DL01305                                            1328 06909000
*        /************************************************************/ 06910000
*        /*                                                          */ 06911000
*        /* INCREMENT NUMBER OF STRINGS AND RESET FACTORS.           */ 06912000
*        /* IF THE NUMBER OF RECORDS IN THE RSA IS LESS THAN         */ 06913000
*        /* THE RSA CAPACITY,SAVE THAT NUMBER AS THE NUMBER OF RECORD*/ 06914000
*        /* IN THE LAST STRING.                                      */ 06915000
*        /*                                                          */ 06916000
*        /************************************************************/ 06917000
*                                                                  1329 06918000
*        SRTOSTRG = SRTOSTRG + 1;                                  1329 06919000
         LA    @06,1                                               1329 06920000
         AL    @06,SRTOSTRG                                        1329 06921000
         ST    @06,SRTOSTRG                                        1329 06922000
*        SRTCURSA = SRTRSAPT;                                      1330 06923000
*                                                                  1330 06924000
         L     @06,SRTRSAPT                                        1330 06925000
         ST    @06,SRTCURSA                                        1330 06926000
*        IF SRTRSACT = SRTRSACP                                    1331 06927000
*          THEN                                                    1331 06928000
         CLC   SRTRSACT(4),SRTRSACP                                1331 06929000
         BNE   @RF01331                                            1331 06930000
*            SRTRSACT = 0;                                         1332 06931000
*                                                                  1332 06932000
         ST    @07,SRTRSACT                                        1332 06933000
*        /************************************************************/ 06934000
*        /*                                                          */ 06935000
*        /* SET THE EXTERNAL SORT FLAG                               */ 06936000
*        /*                                                          */ 06937000
*        /************************************************************/ 06938000
*                                                                  1333 06939000
*        SRTFLEXT = ON;                                            1333 06940000
*                                                                  1333 06941000
@RF01331 OI    SRTFLEXT,B'01000000'                                1333 06942000
*        /************************************************************/ 06943000
*        /*                                                          */ 06944000
*        /* THIS COMPLETES SPILPROC PROCESSING.  RETURN TO CALLING   */ 06945000
*        /* PROCEDURE                                                */ 06946000
*        /*                                                          */ 06947000
*        /************************************************************/ 06948000
*                                                                  1334 06949000
*        RETURN CODE(LASTCC00);                                    1334 06950000
*                                                                  1334 06951000
         SLR   @15,@15                                             1334 06952000
         L     @14,@SA00014                                        1334 06953000
         LM    @00,@12,@SA00014+8                                  1334 06954000
         BR    @14                                                 1334 06955000
*END SPILPROC;                                                     1335 06956000
*        /************************************************************/ 06957000
*        /*                                                          */ 06958000
*        /* PROCEDURE NAME - BLDPROC                                 */ 06959000
*        /*                                                          */ 06960000
*        /* FUNCTION - PERFORMS THE FUNCTION OF BUILDING THE         */ 06961000
*        /*            ALTERNATE INDEX RECORD AND WRITING IT TO      */ 06962000
*        /*            THE ALTERNATE INDEX DATA SET.  THE ALTERNATE  */ 06963000
*        /*            INDEX RECORD CONTAINS STATIC INFORMATION      */ 06964000
*        /*            IN THE FIRST FIVE BYTES FOLLOWED BY THE       */ 06965000
*        /*            ALTERNATE KEY FOLLOWED BY ONE OR MORE         */ 06966000
*        /*            POINTERS TO THE BASE CLUSTER.  THESE POINTERS */ 06967000
*        /*            ARE PRIME KEYS IF THE BASE CLUSTER IS A KSDS  */ 06968000
*        /*            OR RBAS IF THE BASE CLUSTER IS AN ESDS.       */ 06969000
*        /*            BLDPROC OBTAINS THE ALTERNATE KEY FROM THE    */ 06970000
*        /*            SORT RECORD PASSED TO IT  AND MOVES IT TO     */ 06971000
*        /*            THE ALTERNATE INDEX RECORD.  ALL BASE         */ 06972000
*        /*            CLUSTER POINTERS (OBTAINED FROM THE SORT      */ 06973000
*        /*            RECORDS) FOR THE SAME ALTERNATE KEY ARE       */ 06974000
*        /*            MOVED TO THE SAME ALTERNATE INDEX RECORD.     */ 06975000
*        /*                                                          */ 06976000
*        /* INPUT -                                                  */ 06977000
*        /*        BLRECPTR - POINTER TO SORT RECORD                 */ 06978000
*        /*                                                          */ 06979000
*        /*        BLDAMDS  - POINTERS TO BASE CLUSTER AND AIX       */ 06980000
*        /*                   AMDSB CONTROL BLOCKS                   */ 06981000
*        /*                                                          */ 06982000
*        /*        BLDIOCS  - POINTERS TO IOCSTR FOR EACH OPEN       */ 06983000
*        /*                   DATA SET                               */ 06984000
*        /*                                                          */ 06985000
*        /*        BLDSRTB  - SORT CONTROL TABLE                     */ 06986000
*        /*                                                          */ 06987000
*        /* OUTPUT -                                                 */ 06988000
*        /*        BLDSTAT  - STATUS COMMUNICATION AREA              */ 06989000
*        /*                                                          */ 06990000
*        /*        ALTERNATE INDEX RECORDS                           */ 06991000
*        /*                                                          */ 06992000
*        /* EXIT,NORMAL - RETURN CODE 0, BLSAVERC = 0 - ALL FUNCTIONS*/ 06993000
*        /*                              COMPLETED SUCCESSFULLY      */ 06994000
*        /*                                                          */ 06995000
*        /*                              BLSAVERC = 4 - NONUNIQUEKEYS*/ 06996000
*        /*                              FOR AN AIX DEFINED AS       */ 06997000
*        /*                              UNIQUEKEY OR AIX RECORD     */ 06998000
*        /*                              COULD NOT CONTAIN ALL BASE  */ 06999000
*        /*                              POINTERS                    */ 07000000
*        /*                                                          */ 07001000
*        /* EXIT,ERROR  - RETURN CODE 8, I/O ERROR WRITING AIX       */ 07002000
*        /*                              RECORD                      */ 07003000
*        /*                                                          */ 07004000
*        /************************************************************/ 07005000
*                                                                  1336 07006000
*BLDPROC:                                                          1336 07007000
*        PROCEDURE (BLRECPTR,          /* PTR TO INPUT SORT RECORD   */ 07008000
*                   BLDAMDS,           /* PTRS TO AMDSBS             */ 07009000
*                   BLDIOCS,           /* PTRS TO IOCSTRS            */ 07010000
*                   BLDSRTB,           /* SORT CONTROL TABLE         */ 07011000
*                   BLDSTAT);          /* STATUS COMMUNICATION AREA  */ 07012000
*                                                                  1336 07013000
BLDPROC  STM   @14,@12,@SA00015                                    1336 07014000
         MVC   @PC00015(20),0(@01)                                 1336 07015000
*        /************************************************************/ 07016000
*        /*                                                          */ 07017000
*        /* ARGUMENTS OF INVOCATION                                  */ 07018000
*        /*                                                          */ 07019000
*        /************************************************************/ 07020000
*                                                                  1337 07021000
*        DCL BLRECPTR PTR(31);         /* POINTER TO INPUT SORT      */ 07022000
*                                      /* RECORD                     */ 07023000
*                                                                  1338 07024000
*        DCL 1 BLDAMDS BDY(WORD),      /* POINTERS TO AMDSBS         */ 07025000
*              2 BLDAMBAS PTR(31),     /* POINTER TO BASE AMDSB      */ 07026000
*              2 BLDAMAIX PTR(31);     /* POINTER TO AIX AMDSB       */ 07027000
*                                                                  1338 07028000
*        DCL 1 BLDIOCS BDY(WORD),      /* POINTERS TO IOCSTRS        */ 07029000
*              2 BLIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */ 07030000
*              2 BLIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */ 07031000
*              2 BLIOCSSR(2) PTR(31);  /* POINTER TO SORT IOCSTRS    */ 07032000
*                                                                  1339 07033000
*        DCL BLDSRTB;                  /* SORT CONTROL TABLE         */ 07034000
*                                                                  1340 07035000
*        DCL 1 BLDSTAT,                /* STATUS COMMUNICATION AREA  */ 07036000
*              2 BLSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */ 07037000
*              2 BLSTID   CHAR(4);     /* ERROR IDENTIFIER           */ 07038000
*                                                                  1341 07039000
*                                                                  1341 07040000
*        /************************************************************/ 07041000
*        /*                                                          */ 07042000
*        /* OVERLAY OF INPUT SORT RECORD                             */ 07043000
*        /*                                                          */ 07044000
*        /************************************************************/ 07045000
*                                                                  1342 07046000
*        DCL BLSRTREC CHAR(*) BASED(BLRECPTR);                     1342 07047000
*                                                                  1342 07048000
*        /************************************************************/ 07049000
*        /*                                                          */ 07050000
*        /* SAVE AREA FOR LENGTH OF STATIC INFORMATION PLUS THE      */ 07051000
*        /* LENGTH OF THE ALTERNATE KEY                              */ 07052000
*        /*                                                          */ 07053000
*        /************************************************************/ 07054000
*                                                                  1343 07055000
*        DCL STATLEN FIXED(15);                                    1343 07056000
*                                                                  1343 07057000
*        /************************************************************/ 07058000
*        /*                                                          */ 07059000
*        /* OVERLAY OF STATIC PORTION OF AIX RECORD                  */ 07060000
*        /*                                                          */ 07061000
*        /************************************************************/ 07062000
*                                                                  1344 07063000
*/********************************************************************/ 07064000
*/*                                                                  */ 07065000
*/*   MACRO NAME = IDAAIR                                            */ 07066000
*/*                                                                  */ 07067000
*/*   DESCRIPTIVE NAME =ALTERNATE INDEX RECORD                       */ 07068000
*/*                                                                  */ 07069000
*/*   FUNCTION = DESCRIBES THE ALTERNATE INDEX RECORD HEADER         */ 07070000
*/*                                                                  */ 07071000
*/*   INCLUDED MACROS = NONE                                         */ 07072000
*/*                                                                  */ 07073000
*/*   METHOD OF ACCESS = PL/S - NO DECLARES NECESSARY                */ 07074000
*/*                                                                  */ 07075000
*/*   CREATED BY = RECORD MANAGEMENT MODULE IDA019RU                 */ 07076000
*/*                                                                  */ 07077000
*/*   STATUS = VS/1 RELEASE 4  (CHANGE FLAG @X04SVXX)                */ 07078000
*/*                                                                  */ 07079000
*/*   DATE OF LAST CHANGE = 9 AUG 74                                 */ 07080000
*/*                                                                  */ 07081000
*/********************************************************************/ 07082000
*   DCL                                                            1344 07083000
*     1 IDAAIX BASED,               /* ALTERNATE INDEX RECORD        */ 07084000
*      2 AIXFG BIT(8),              /* FLAG FIELD                    */ 07085000
*       3 * BIT(7),                 /* RESERVED                      */ 07086000
*       3 AIXPKP BIT(1),            /* 0= RBA POINTERS 1=PRIME KEY 1344 07087000
*                                      POINTERS                      */ 07088000
*      2 AIXPL FIXED(8),            /* LENGTH OF THE POINTER         */ 07089000
*      2 AIXPC FIXED(15),           /* NUMBER OF POINTERS            */ 07090000
*      2 AIXKL FIXED(8),            /* LENGTH OF AIX KEY             */ 07091000
*      2 AIXKY CHAR(*);             /* AIX KEY                       */ 07092000
*   DCL AIXPCMAX CONSTANT(32767)FIXED(15);/* MAXIMUM AIXPC VALUE     */ 07093000
*                                                                  1345 07094000
*        /************************************************************/ 07095000
*        /*                                                          */ 07096000
*        /* VARIABLES USED BY BLDPROC                                */ 07097000
*        /*                                                          */ 07098000
*        /************************************************************/ 07099000
*                                                                  1346 07100000
*        DCL FIRSTKEY BIT(1);          /* FIRST PRIME KEY OR RBA FLAG*/ 07101000
*                                                                  1346 07102000
*        DCL MSGTXT(2) CHAR(3) INIT('KEY','RBA'); /* MESSAGE TEXT    */ 07103000
*                                                                  1347 07104000
*        DCL BL FIXED(31);             /* LOOP CONTROL               */ 07105000
*                                                                  1348 07106000
*        DCL CLRSTART FIXED(15);       /* START OF AREA TO CLEAR     */ 07107000
*                                                                  1349 07108000
*        DCL UNQLIMIT FIXED(8);        /* LIMIT OF LOOP TO PRINT     */ 07109000
*                                      /* NONUNIQUEKEYS              */ 07110000
*                                                                  1351 07111000
*        DCL IOCDADSV PTR(31);         /* SAVE AREA FOR IOCDAD       */ 07112000
*                                                                  1351 07113000
*        DCL MAXAIXPC FIXED(15) CONSTANT(32767); /* MAXIMUM NUMBER   */ 07114000
*                                                /* OF AIX POINTERS  */ 07115000
*        /************************************************************/ 07116000
*        /*                                                          */ 07117000
*        /* IF THIS IS THE FIRST ENTRY TO BLDPROC, PERFORM INITIAL-  */ 07118000
*        /* IZATION.                                                 */ 07119000
*        /*                                                          */ 07120000
*        /************************************************************/ 07121000
*                                                                  1353 07122000
*        AMDSBPTR = BLDAMAIX;                                      1353 07123000
         L     @03,@PC00015+4                                      1353 07124000
         L     AMDSBPTR,BLDAMAIX(,@03)                             1353 07125000
*        IOCSPTR  = BLIOCSAX;                                      1354 07126000
*                                                                  1354 07127000
         L     @05,@PC00015+8                                      1354 07128000
         L     IOCSPTR,BLIOCSAX(,@05)                              1354 07129000
*        IF SRTFLBLD = ON                                          1355 07130000
*          THEN                                                    1355 07131000
         TM    SRTFLBLD,B'00010000'                                1355 07132000
         BNO   @RF01355                                            1355 07133000
*FIRSTIME:   DO;                                                   1356 07134000
*                                                                  1356 07135000
FIRSTIME DS    0H                                                  1357 07136000
*            OLDERID2 = NEWERID2;                                  1357 07137000
         L     @05,@PC00001                                        1357 07138000
         L     @05,GDTTR2(,@05)                                    1357 07139000
         MVC   @TS00001(95),NEWERID2(@05)                          1357 07140000
         MVC   OLDERID2(95,@05),@TS00001                           1357 07141000
*            NEWID2 = 'BIB1';                                      1358 07142000
*                                                                  1358 07143000
         MVC   NEWID2(4,@05),@CC01530                              1358 07144000
*            SRTEXCES = 0;                                         1359 07145000
         SLR   @05,@05                                             1359 07146000
         ST    @05,SRTEXCES                                        1359 07147000
*            FIRSTKEY = ON;                                        1360 07148000
         OI    FIRSTKEY,B'10000000'                                1360 07149000
*            SRTFLBLD = OFF;                                       1361 07150000
*                                                                  1361 07151000
         NI    SRTFLBLD,B'11101111'                                1361 07152000
*            /********************************************************/ 07153000
*            /*                                                      */ 07154000
*            /* THE AIX OUTPUT AREA IS IN CORE GOTTEN BY INITPROC.   */ 07155000
*            /* IT IS PRECEDED BY ONE 2K BUFFER AND THE DEFINE       */ 07156000
*            /* CPL/PUT/FPL COMPLEX.                                 */ 07157000
*            /*                                                      */ 07158000
*            /********************************************************/ 07159000
*                                                                  1362 07160000
*            IOCDAD = SRTBUFPT + BLKSIZE +                         1362 07161000
*                     LENGTH(DFCPAREA) + LENGTH(DEFAREAS) +        1362 07162000
*                     LENGTH(VOLLIST);                             1362 07163000
*                                                                  1362 07164000
         LA    @05,3292                                            1362 07165000
         AL    @05,SRTBUFPT                                        1362 07166000
         ST    @05,IOCDAD(,IOCSPTR)                                1362 07167000
*            IOCDADSV = IOCDAD;                                    1363 07168000
*                                                                  1363 07169000
         ST    @05,IOCDADSV                                        1363 07170000
*            RFY IDAAIX BASED (IOCDAD);                            1364 07171000
*                                                                  1364 07172000
*            /********************************************************/ 07173000
*            /*                                                      */ 07174000
*            /* CALCULATE LENGTH OF STATIC PORTION OF AIX RECORD.    */ 07175000
*            /* SET UP STATIC PORTION AND ALTERNATE KEY              */ 07176000
*            /*                                                      */ 07177000
*            /********************************************************/ 07178000
*                                                                  1365 07179000
*            STATLEN = LENGTH(IDAAIX) + AMDKEYLN;                  1365 07180000
*                                                                  1365 07181000
         LA    @03,5                                               1365 07182000
         AH    @03,AMDKEYLN(,AMDSBPTR)                             1365 07183000
         STH   @03,STATLEN                                         1365 07184000
*            IOCDLN = STATLEN;                                     1366 07185000
*                                                                  1366 07186000
         ST    @03,IOCDLN(,IOCSPTR)                                1366 07187000
*            IF BLDAMBAS -> AMDDST = ON                            1367 07188000
*              THEN                                                1367 07189000
         L     @03,@PC00015+4                                      1367 07190000
         L     @03,BLDAMBAS(,@03)                                  1367 07191000
         TM    AMDDST(@03),B'10000000'                             1367 07192000
         BNO   @RF01367                                            1367 07193000
*                DO;                                               1368 07194000
*                                                                  1368 07195000
*                AIXPKP = ON;                                      1369 07196000
         OI    AIXPKP(@05),B'00000001'                             1369 07197000
*                AIXPL  = BLDAMBAS -> AMDKEYLN;                    1370 07198000
*                                                                  1370 07199000
         LH    @03,AMDKEYLN(,@03)                                  1370 07200000
         STC   @03,AIXPL(,@05)                                     1370 07201000
*                END;                                              1371 07202000
*                                                                  1371 07203000
*              ELSE                                                1372 07204000
*                AIXPL = 4;                                        1372 07205000
*                                                                  1372 07206000
         B     @RC01367                                            1372 07207000
@RF01367 L     @05,IOCDAD(,IOCSPTR)                                1372 07208000
         MVI   AIXPL(@05),X'04'                                    1372 07209000
*            AIXKL = AMDKEYLN;                                     1373 07210000
*                                                                  1373 07211000
@RC01367 L     @05,IOCDAD(,IOCSPTR)                                1373 07212000
         LH    @03,AMDKEYLN(,AMDSBPTR)                             1373 07213000
         STC   @03,AIXKL(,@05)                                     1373 07214000
*            AIXKY(1:AMDKEYLN) = BLSRTREC(1:AMDKEYLN);             1374 07215000
*                                                                  1374 07216000
         BCTR  @03,0                                               1374 07217000
         L     @15,@PC00015                                        1374 07218000
         L     @01,BLRECPTR(,@15)                                  1374 07219000
         EX    @03,@SM01711                                        1374 07220000
*            END FIRSTIME;                                         1375 07221000
*                                                                  1375 07222000
*          ELSE                                                    1376 07223000
*                                                                  1376 07224000
*            /********************************************************/ 07225000
*            /*                                                      */ 07226000
*            /* IF THIS IS NOT THE FIRST ENTRY TO BLDPROC, DETERMINE */ 07227000
*            /* IF AN AIX RECORD IS TO BE WRITTEN OUT.  IF BLDPROC   */ 07228000
*            /* IS CALLED WITH A NULL SORT RECORD POINTER, THE LAST  */ 07229000
*            /* RECORD IS TO BE WRITTEN OUT.  IF THE AIX RECORD      */ 07230000
*            /* COULD NOT CONTAIN ALL THE BASE POINTERS, ISSUE A     */ 07231000
*            /* MESSAGE FIRST                                        */ 07232000
*            /*                                                      */ 07233000
*            /********************************************************/ 07234000
*                                                                  1376 07235000
*            IF BLRECPTR = NULLPTR |                               1376 07236000
*               BLSRTREC(1:AMDKEYLN) ^= AIXKY(1:AMDKEYLN)          1376 07237000
*              THEN                                                1376 07238000
         B     @RC01355                                            1376 07239000
@RF01355 L     @05,@PC00015                                        1376 07240000
         L     @05,BLRECPTR(,@05)                                  1376 07241000
         LTR   @05,@05                                             1376 07242000
         BZ    @RT01376                                            1376 07243000
         L     @03,IOCDAD(,IOCSPTR)                                1376 07244000
         LH    @15,AMDKEYLN(,AMDSBPTR)                             1376 07245000
         BCTR  @15,0                                               1376 07246000
         EX    @15,@SC01713                                        1376 07247000
         BE    @RF01376                                            1376 07248000
@RT01376 DS    0H                                                  1377 07249000
*PUTAIX:         DO;                                               1377 07250000
*                                                                  1377 07251000
PUTAIX   DS    0H                                                  1378 07252000
*                IF SRTEXCES ^= 0                                  1378 07253000
*                  THEN                                            1378 07254000
         L     @05,SRTEXCES                                        1378 07255000
         LTR   @05,@05                                             1378 07256000
         BZ    @RF01378                                            1378 07257000
*                    DO;                                           1379 07258000
*                                                                  1379 07259000
*                    BLSAVERC = LASTCC04;                          1380 07260000
*                                                                  1380 07261000
         LA    @05,4                                               1380 07262000
         L     @03,@PC00015+16                                     1380 07263000
         STH   @05,BLSAVERC(,@03)                                  1380 07264000
*                    DARGLIST = ''B;                               1381 07265000
         L     @03,DDSTRU                                          1381 07266000
         XC    DARGLIST(20,@03),DARGLIST(@03)                      1381 07267000
*                    DARGSTID = EXCESPTR;                          1382 07268000
         MVC   DARGSTID(4,@03),@CF00896                            1382 07269000
*                    DARGCNT  = 3;                                 1383 07270000
         LA    @15,3                                               1383 07271000
         STH   @15,DARGCNT(,@03)                                   1383 07272000
*                    DARGINS(1) = 1;                               1384 07273000
         MVC   DARGINS(2,@03),@CH00220                             1384 07274000
*                    DARGINL(1) = LENGTH(SRTEXCES);                1385 07275000
         STH   @05,DARGINL(,@03)                                   1385 07276000
*                    DARGDTM(1) = ADDR(SRTEXCES);                  1386 07277000
         LA    @05,SRTEXCES                                        1386 07278000
         ST    @05,DARGDTM(,@03)                                   1386 07279000
*                    DARGINS(2) = 2;                               1387 07280000
         MVC   DARGINS+8(2,@03),@CH00154                           1387 07281000
*                    DARGINL(2) = 3;                               1388 07282000
*                                                                  1388 07283000
         STH   @15,DARGINL+8(,@03)                                 1388 07284000
*                    IF AIXPKP = ON                                1389 07285000
*                      THEN                                        1389 07286000
         L     @05,IOCDAD(,IOCSPTR)                                1389 07287000
         TM    AIXPKP(@05),B'00000001'                             1389 07288000
         BNO   @RF01389                                            1389 07289000
*                        DARGDTM(2) = ADDR(MSGTXT(1));             1390 07290000
*                                                                  1390 07291000
         LA    @05,MSGTXT                                          1390 07292000
         ST    @05,DARGDTM+8(,@03)                                 1390 07293000
*                      ELSE                                        1391 07294000
*                        DARGDTM(2) = ADDR(MSGTXT(2));             1391 07295000
*                                                                  1391 07296000
         B     @RC01389                                            1391 07297000
@RF01389 LA    @05,MSGTXT+3                                        1391 07298000
         L     @03,DDSTRU                                          1391 07299000
         ST    @05,DARGDTM+8(,@03)                                 1391 07300000
*                    DARGINS(3) = 3;                               1392 07301000
@RC01389 L     @05,DDSTRU                                          1392 07302000
         MVC   DARGINS+16(2,@05),@CH00163                          1392 07303000
*                    DARGDTM(3) = ADDR(AIXKY);                     1393 07304000
*                                                                  1393 07305000
         L     @03,IOCDAD(,IOCSPTR)                                1393 07306000
         LA    @03,AIXKY(,@03)                                     1393 07307000
         ST    @03,DARGDTM+16(,@05)                                1393 07308000
*                    IF AMDKEYLN > 10                              1394 07309000
*                      THEN                                        1394 07310000
         LA    @03,10                                              1394 07311000
         CH    @03,AMDKEYLN(,AMDSBPTR)                             1394 07312000
         BNL   @RF01394                                            1394 07313000
*                        DARGINL(3) = 10;                          1395 07314000
*                                                                  1395 07315000
         STH   @03,DARGINL+16(,@05)                                1395 07316000
*                      ELSE                                        1396 07317000
*                        DARGINL(3) = AMDKEYLN;                    1396 07318000
*                                                                  1396 07319000
         B     @RC01394                                            1396 07320000
@RF01394 LH    @05,AMDKEYLN(,AMDSBPTR)                             1396 07321000
         L     @03,DDSTRU                                          1396 07322000
         STH   @05,DARGINL+16(,@03)                                1396 07323000
*                    CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);        1397 07324000
*                                                                  1397 07325000
@RC01394 L     @05,@PC00001                                        1397 07326000
         ST    @05,@AL00001                                        1397 07327000
         LA    @03,@CF00116                                        1397 07328000
         ST    @03,@AL00001+4                                      1397 07329000
         LA    @03,DDSTRU                                          1397 07330000
         ST    @03,@AL00001+8                                      1397 07331000
         MVI   @AL00001+8,X'80'                                    1397 07332000
         L     @15,GDTPRT(,@05)                                    1397 07333000
         LA    @01,@AL00001                                        1397 07334000
         BALR  @14,@15                                             1397 07335000
*                    SRTEXCES = 0;                                 1398 07336000
*                                                                  1398 07337000
         SLR   @05,@05                                             1398 07338000
         ST    @05,SRTEXCES                                        1398 07339000
*                    END;                                          1399 07340000
*                                                                  1399 07341000
*                /****************************************************/ 07342000
*                /*                                                  */ 07343000
*                /* WRITE OUT THE AIX RECORD AND CLEAR THE RECORD    */ 07344000
*                /* AREA                                             */ 07345000
*                /*                                                  */ 07346000
*                /****************************************************/ 07347000
*                                                                  1400 07348000
*                CALL IDCIOPT0 (GDTTBL,BLIOCSAX);                  1400 07349000
*                                                                  1400 07350000
@RF01378 L     @05,@PC00001                                        1400 07351000
         ST    @05,@AL00001                                        1400 07352000
         L     @15,@PC00015+8                                      1400 07353000
         LA    @15,BLIOCSAX(,@15)                                  1400 07354000
         ST    @15,@AL00001+4                                      1400 07355000
         MVI   @AL00001+4,X'80'                                    1400 07356000
         L     @15,GDTPUT(,@05)                                    1400 07357000
         LA    @01,@AL00001                                        1400 07358000
         BALR  @14,@15                                             1400 07359000
*                RESPECIFY RTNREG RSTD;                            1401 07360000
*                TESTRC = RTNREG;                                  1402 07361000
         LR    TESTRC,RTNREG                                       1402 07362000
*                RESPECIFY RTNREG UNRSTD;                          1403 07363000
*                                                                  1403 07364000
*                IF TESTRC ^= 0                                    1404 07365000
*                  THEN                                            1404 07366000
         LTR   TESTRC,TESTRC                                       1404 07367000
         BZ    @RF01404                                            1404 07368000
*                    RETURN CODE(LASTCC08);                        1405 07369000
*                                                                  1405 07370000
         LA    @15,8                                               1405 07371000
         L     @14,@SA00015                                        1405 07372000
         LM    @00,@12,@SA00015+8                                  1405 07373000
         BR    @14                                                 1405 07374000
*                IOCDAD   = IOCDADSV;                              1406 07375000
@RF01404 L     @05,IOCDADSV                                        1406 07376000
         ST    @05,IOCDAD(,IOCSPTR)                                1406 07377000
*                CLRSTART = STATLEN + 1;                           1407 07378000
*                                                                  1407 07379000
         LA    @05,1                                               1407 07380000
         LH    CLRSTART,STATLEN                                    1407 07381000
         ALR   CLRSTART,@05                                        1407 07382000
*                DO BL = 1 TO AIXPC;                               1408 07383000
*                                                                  1408 07384000
         LA    @15,1                                               1408 07385000
         LR    BL,@15                                              1408 07386000
         B     @DE01408                                            1408 07387000
@DL01408 DS    0H                                                  1409 07388000
*                  AIXREC(CLRSTART:CLRSTART + AIXPL - 1) =         1409 07389000
*                    AIXREC(CLRSTART:CLRSTART + AIXPL - 1) &&      1409 07390000
*                    AIXREC(CLRSTART:CLRSTART + AIXPL - 1);        1409 07391000
*                                                                  1409 07392000
         L     @15,IOCDAD(,IOCSPTR)                                1409 07393000
         LR    @14,@15                                             1409 07394000
         ALR   @14,CLRSTART                                        1409 07395000
         BCTR  @14,0                                               1409 07396000
         SLR   @07,@07                                             1409 07397000
         IC    @07,AIXPL(,@15)                                     1409 07398000
         BCTR  @07,0                                               1409 07399000
         EX    @07,@SX01715                                        1409 07400000
*                  CLRSTART = CLRSTART + AIXPL;                    1410 07401000
*                                                                  1410 07402000
         SLR   @14,@14                                             1410 07403000
         IC    @14,AIXPL(,@15)                                     1410 07404000
         ALR   CLRSTART,@14                                        1410 07405000
*                END;                                              1411 07406000
*                                                                  1411 07407000
         AL    BL,@CF00220                                         1411 07408000
@DE01408 L     @01,IOCDAD(,IOCSPTR)                                1411 07409000
         CH    BL,AIXPC(,@01)                                      1411 07410000
         BNH   @DL01408                                            1411 07411000
*                /****************************************************/ 07412000
*                /*                                                  */ 07413000
*                /* IF THIS IS NOT THE LAST ENTRY TO BLDPROC,        */ 07414000
*                /* RESET REMAINING FACTORS AND MOVE IN NEW          */ 07415000
*                /* ALTERNATE KEY                                    */ 07416000
*                /*                                                  */ 07417000
*                /****************************************************/ 07418000
*                                                                  1412 07419000
*                IF BLRECPTR ^= NULLPTR                            1412 07420000
*                  THEN                                            1412 07421000
         SLR   @05,@05                                             1412 07422000
         L     @03,@PC00015                                        1412 07423000
         L     @03,BLRECPTR(,@03)                                  1412 07424000
         CR    @03,@05                                             1412 07425000
         BE    @RF01412                                            1412 07426000
*                    DO;                                           1413 07427000
*                                                                  1413 07428000
*                    AIXPC    = 0;                                 1414 07429000
         L     @15,IOCDAD(,IOCSPTR)                                1414 07430000
         STH   @05,AIXPC(,@15)                                     1414 07431000
*                    IOCDLN   = STATLEN;                           1415 07432000
         LH    @05,STATLEN                                         1415 07433000
         ST    @05,IOCDLN(,IOCSPTR)                                1415 07434000
*                    FIRSTKEY = ON;                                1416 07435000
*                                                                  1416 07436000
         OI    FIRSTKEY,B'10000000'                                1416 07437000
*                    AIXKY(1:AMDKEYLN) = BLSRTREC(1:AMDKEYLN);     1417 07438000
*                                                                  1417 07439000
         LH    @05,AMDKEYLN(,AMDSBPTR)                             1417 07440000
         BCTR  @05,0                                               1417 07441000
         EX    @05,@SM01717                                        1417 07442000
*                    END;                                          1418 07443000
*                                                                  1418 07444000
*                END PUTAIX;                                       1419 07445000
*                                                                  1419 07446000
@RF01412 DS    0H                                                  1420 07447000
*        /************************************************************/ 07448000
*        /*                                                          */ 07449000
*        /* IF THIS IS NOT THE LAST ENTRY TO BLDPROC,                */ 07450000
*        /* PREPARE TO MOVE THE PRIME KEY OR RBA TO THE AIX RECORD.  */ 07451000
*        /* IF THIS IS THE SECOND OR SUBSEQUENT POINTER AND THE      */ 07452000
*        /* ALTERNATE INDEX WAS DEFINED AS HAVING UNIQUEKEYS, ISSUE  */ 07453000
*        /* A MESSAGE.  IF THIS IS THE SECOND POINTER, A MESSAGE     */ 07454000
*        /* CONTAINING THE FIRST POINTER MUST ALSO BE ISSUED.        */ 07455000
*        /*                                                          */ 07456000
*        /************************************************************/ 07457000
*                                                                  1420 07458000
*        IF BLRECPTR ^= NULLPTR                                    1420 07459000
*          THEN                                                    1420 07460000
@RF01376 DS    0H                                                  1420 07461000
@RC01355 L     @05,@PC00015                                        1420 07462000
         L     @05,BLRECPTR(,@05)                                  1420 07463000
         LTR   @05,@05                                             1420 07464000
         BZ    @RF01420                                            1420 07465000
*ADDPRIME:   DO;                                                   1421 07466000
*                                                                  1421 07467000
ADDPRIME DS    0H                                                  1422 07468000
*            IF AIXPC ^= 0 &                                       1422 07469000
*               AMDUNQ = OFF                                       1422 07470000
*              THEN                                                1422 07471000
         L     @05,IOCDAD(,IOCSPTR)                                1422 07472000
         LH    @05,AIXPC(,@05)                                     1422 07473000
         LTR   @05,@05                                             1422 07474000
         BZ    @RF01422                                            1422 07475000
         TM    AMDUNQ(AMDSBPTR),B'10000000'                        1422 07476000
         BNZ   @RF01422                                            1422 07477000
*PRTNUNQ:        DO;                                               1423 07478000
*                                                                  1423 07479000
PRTNUNQ  DS    0H                                                  1424 07480000
*                BLSAVERC = LASTCC04;                              1424 07481000
*                                                                  1424 07482000
         L     @05,@PC00015+16                                     1424 07483000
         MVC   BLSAVERC(2,@05),@CH00043                            1424 07484000
*                IF FIRSTKEY = ON                                  1425 07485000
*                  THEN                                            1425 07486000
         TM    FIRSTKEY,B'10000000'                                1425 07487000
         BNO   @RF01425                                            1425 07488000
*                    UNQLIMIT = 2;                                 1426 07489000
*                                                                  1426 07490000
         LA    UNQLIMIT,2                                          1426 07491000
*                  ELSE                                            1427 07492000
*                    UNQLIMIT = 1;                                 1427 07493000
*                                                                  1427 07494000
         B     @RC01425                                            1427 07495000
@RF01425 LA    UNQLIMIT,1                                          1427 07496000
*                DO BL = 1 TO UNQLIMIT;                            1428 07497000
*                                                                  1428 07498000
@RC01425 LA    BL,1                                                1428 07499000
         B     @DE01428                                            1428 07500000
@DL01428 DS    0H                                                  1429 07501000
*                  DARGLIST = ''B;                                 1429 07502000
*                                                                  1429 07503000
         L     @15,DDSTRU                                          1429 07504000
         XC    DARGLIST(20,@15),DARGLIST(@15)                      1429 07505000
*                  IF AIXPKP = ON                                  1430 07506000
*                    THEN                                          1430 07507000
         L     @01,IOCDAD(,IOCSPTR)                                1430 07508000
         TM    AIXPKP(@01),B'00000001'                             1430 07509000
         BNO   @RF01430                                            1430 07510000
*                      DARGSTID = NONUNQKS;                        1431 07511000
*                                                                  1431 07512000
         MVC   DARGSTID(4,@15),@CF00894                            1431 07513000
*                    ELSE                                          1432 07514000
*                      DARGSTID = NONUNQES;                        1432 07515000
*                                                                  1432 07516000
         B     @RC01430                                            1432 07517000
@RF01430 L     @01,DDSTRU                                          1432 07518000
         MVC   DARGSTID(4,@01),@CF00918                            1432 07519000
*                  DARGCNT  = 2;                                   1433 07520000
@RC01430 L     @15,DDSTRU                                          1433 07521000
         MVC   DARGCNT(2,@15),@CH00154                             1433 07522000
*                  DARGINS(1) = 1;                                 1434 07523000
         MVC   DARGINS(2,@15),@CH00220                             1434 07524000
*                  DARGDTM(1) = ADDR(AIXKY);                       1435 07525000
*                                                                  1435 07526000
         L     @01,IOCDAD(,IOCSPTR)                                1435 07527000
         LA    @14,AIXKY(,@01)                                     1435 07528000
         ST    @14,DARGDTM(,@15)                                   1435 07529000
*                  IF AMDKEYLN > 10                                1436 07530000
*                    THEN                                          1436 07531000
         LA    @14,10                                              1436 07532000
         CH    @14,AMDKEYLN(,AMDSBPTR)                             1436 07533000
         BNL   @RF01436                                            1436 07534000
*                      DARGINL(1) = 10;                            1437 07535000
*                                                                  1437 07536000
         STH   @14,DARGINL(,@15)                                   1437 07537000
*                    ELSE                                          1438 07538000
*                      DARGINL(1) = AMDKEYLN;                      1438 07539000
*                                                                  1438 07540000
         B     @RC01436                                            1438 07541000
@RF01436 LH    @15,AMDKEYLN(,AMDSBPTR)                             1438 07542000
         L     @14,DDSTRU                                          1438 07543000
         STH   @15,DARGINL(,@14)                                   1438 07544000
*                  DARGINS(2) = 2;                                 1439 07545000
*                                                                  1439 07546000
@RC01436 L     @15,DDSTRU                                          1439 07547000
         MVC   DARGINS+8(2,@15),@CH00154                           1439 07548000
*                  IF AIXPL > 10                                   1440 07549000
*                    THEN                                          1440 07550000
         L     @01,IOCDAD(,IOCSPTR)                                1440 07551000
         CLI   AIXPL(@01),10                                       1440 07552000
         BNH   @RF01440                                            1440 07553000
*                      DARGINL(2) = 10;                            1441 07554000
*                                                                  1441 07555000
         MVC   DARGINL+8(2,@15),@CH00037                           1441 07556000
*                    ELSE                                          1442 07557000
*                      DARGINL(2) = AIXPL;                         1442 07558000
*                                                                  1442 07559000
         B     @RC01440                                            1442 07560000
@RF01440 L     @01,IOCDAD(,IOCSPTR)                                1442 07561000
         SLR   @00,@00                                             1442 07562000
         IC    @00,AIXPL(,@01)                                     1442 07563000
         L     @01,DDSTRU                                          1442 07564000
         STH   @00,DARGINL+8(,@01)                                 1442 07565000
*                  IF UNQLIMIT = 2 & BL = 1                        1443 07566000
*                    THEN                                          1443 07567000
@RC01440 C     UNQLIMIT,@CF00154                                   1443 07568000
         BNE   @RF01443                                            1443 07569000
         C     BL,@CF00220                                         1443 07570000
         BNE   @RF01443                                            1443 07571000
*                      DARGDTM(2) = ADDR(AIXREC) + STATLEN;        1444 07572000
*                                                                  1444 07573000
         LH    @15,STATLEN                                         1444 07574000
         AL    @15,IOCDAD(,IOCSPTR)                                1444 07575000
         L     @14,DDSTRU                                          1444 07576000
         ST    @15,DARGDTM+8(,@14)                                 1444 07577000
*                    ELSE                                          1445 07578000
*                      DARGDTM(2) = ADDR(BLSRTREC) + AMDKEYLN;     1445 07579000
*                                                                  1445 07580000
         B     @RC01443                                            1445 07581000
@RF01443 L     @15,@PC00015                                        1445 07582000
         LH    @14,AMDKEYLN(,AMDSBPTR)                             1445 07583000
         AL    @14,BLRECPTR(,@15)                                  1445 07584000
         L     @15,DDSTRU                                          1445 07585000
         ST    @14,DARGDTM+8(,@15)                                 1445 07586000
*                  CALL AMSTP011 (GDTTBL,PRTFILE,DDSTRU);          1446 07587000
*                                                                  1446 07588000
@RC01443 L     @15,@PC00001                                        1446 07589000
         ST    @15,@AL00001                                        1446 07590000
         LA    @14,@CF00116                                        1446 07591000
         ST    @14,@AL00001+4                                      1446 07592000
         LA    @14,DDSTRU                                          1446 07593000
         ST    @14,@AL00001+8                                      1446 07594000
         MVI   @AL00001+8,X'80'                                    1446 07595000
         L     @15,GDTPRT(,@15)                                    1446 07596000
         LA    @01,@AL00001                                        1446 07597000
         BALR  @14,@15                                             1446 07598000
*                END;                                              1447 07599000
*                                                                  1447 07600000
         AL    BL,@CF00220                                         1447 07601000
@DE01428 CR    BL,UNQLIMIT                                         1447 07602000
         BNH   @DL01428                                            1447 07603000
*                FIRSTKEY = OFF;                                   1448 07604000
*                                                                  1448 07605000
         NI    FIRSTKEY,B'01111111'                                1448 07606000
*                END PRTNUNQ;                                      1449 07607000
*                                                                  1449 07608000
*              ELSE                                                1450 07609000
*                                                                  1450 07610000
*                /****************************************************/ 07611000
*                /*                                                  */ 07612000
*                /* IF THE NEW PRIME KEY OR RBA WILL NOT FIT INTO    */ 07613000
*                /* THE AIX RECORD OR IF THE RECORD ALREADY CONTAINS */ 07614000
*                /* THE MAXIMUM NUMBER OF POINTERS, INCREMENT THE    */ 07615000
*                /* EXCESS COUNTER.                                  */ 07616000
*                /*                                                  */ 07617000
*                /****************************************************/ 07618000
*                                                                  1450 07619000
*                IF IOCDLN + AIXPL > AMDLRECL |                    1450 07620000
*                   AIXPC = MAXAIXPC                               1450 07621000
*                  THEN                                            1450 07622000
         B     @RC01422                                            1450 07623000
@RF01422 L     @05,IOCDAD(,IOCSPTR)                                1450 07624000
         SLR   @03,@03                                             1450 07625000
         IC    @03,AIXPL(,@05)                                     1450 07626000
         AL    @03,IOCDLN(,IOCSPTR)                                1450 07627000
         C     @03,AMDLRECL(,AMDSBPTR)                             1450 07628000
         BH    @RT01450                                            1450 07629000
         CLC   AIXPC(2,@05),@CH01518                               1450 07630000
         BNE   @RF01450                                            1450 07631000
@RT01450 DS    0H                                                  1451 07632000
*                    SRTEXCES = SRTEXCES + 1;                      1451 07633000
*                                                                  1451 07634000
         LA    @15,1                                               1451 07635000
         AL    @15,SRTEXCES                                        1451 07636000
         ST    @15,SRTEXCES                                        1451 07637000
*                  ELSE                                            1452 07638000
*                                                                  1452 07639000
*                    /************************************************/ 07640000
*                    /*                                              */ 07641000
*                    /* NO ERRORS HAVE BEEN FOUND SO MOVE THE NEW    */ 07642000
*                    /* PRIME KEY OR RBA TO THE AIX RECORD.          */ 07643000
*                    /*                                              */ 07644000
*                    /************************************************/ 07645000
*                                                                  1452 07646000
*                    DO;                                           1452 07647000
*                                                                  1452 07648000
         B     @RC01450                                            1452 07649000
@RF01450 DS    0H                                                  1453 07650000
*                    AIXREC(IOCDLN + 1:IOCDLN + AIXPL) =           1453 07651000
*                      BLSRTREC(AMDKEYLN + 1:AIXPL);               1453 07652000
*                                                                  1453 07653000
         L     @05,IOCDLN(,IOCSPTR)                                1453 07654000
         L     @03,IOCDAD(,IOCSPTR)                                1453 07655000
         ALR   @05,@03                                             1453 07656000
         SLR   @15,@15                                             1453 07657000
         IC    @15,AIXPL(,@03)                                     1453 07658000
         BCTR  @15,0                                               1453 07659000
         LH    @01,AMDKEYLN(,AMDSBPTR)                             1453 07660000
         L     @14,@PC00015                                        1453 07661000
         L     @14,BLRECPTR(,@14)                                  1453 07662000
         ALR   @14,@01                                             1453 07663000
         MVC   @TS00001(256),BLSRTREC(@14)                         1453 07664000
         EX    @15,@SM01719                                        1453 07665000
*                    IOCDLN = IOCDLN + AIXPL;                      1454 07666000
*                                                                  1454 07667000
         L     @15,IOCDLN(,IOCSPTR)                                1454 07668000
         SLR   @14,@14                                             1454 07669000
         IC    @14,AIXPL(,@03)                                     1454 07670000
         ALR   @15,@14                                             1454 07671000
         ST    @15,IOCDLN(,IOCSPTR)                                1454 07672000
*                    AIXPC = AIXPC + 1;                            1455 07673000
*                                                                  1455 07674000
         LA    @15,1                                               1455 07675000
         AH    @15,AIXPC(,@03)                                     1455 07676000
         STH   @15,AIXPC(,@03)                                     1455 07677000
*                    END;                                          1456 07678000
*                                                                  1456 07679000
*            END ADDPRIME;                                         1457 07680000
*                                                                  1457 07681000
@RC01450 DS    0H                                                  1457 07682000
@RC01422 DS    0H                                                  1458 07683000
*        /************************************************************/ 07684000
*        /*                                                          */ 07685000
*        /* THIS COMPLETES BLDPROC PROCESSING.  RETURN TO THE        */ 07686000
*        /* CALLING PROCEDURE                                        */ 07687000
*        /*                                                          */ 07688000
*        /************************************************************/ 07689000
*                                                                  1458 07690000
*        RETURN CODE(LASTCC00);                                    1458 07691000
*                                                                  1458 07692000
@RF01420 SLR   @15,@15                                             1458 07693000
         L     @14,@SA00015                                        1458 07694000
         LM    @00,@12,@SA00015+8                                  1458 07695000
         BR    @14                                                 1458 07696000
*END BLDPROC;                                                      1459 07697000
*        /************************************************************/ 07698000
*        /* PROCEDURE NAME - MERGPROC                                */ 07699000
*        /*                                                          */ 07700000
*        /* FUNCTION - PERFORMS THE FUNCTION OF MERGING STRINGS OF   */ 07701000
*        /*            SORT RECORDS ORIGINALLY BUILT BY SPILPROC     */ 07702000
*        /*            USING TWO EXTERNAL SORT WORK FILES.  THE      */ 07703000
*        /*            ORDER OF MERGE IS NORMALLY 16 OR LESS USING   */ 07704000
*        /*            AN AREA OF 32K (THE ORIGINAL RSA) FOR INPUT   */ 07705000
*        /*            BUFFERS.  IN ONE CASE, THE ORDER OF MERGE     */ 07706000
*        /*            WILL BE 2.  THAT IS, WHEN THE STATISTIC OF    */ 07707000
*        /*            THE NUMBER OF RECORDS IN THE BASE CLUSTER     */ 07708000
*        /*            AMDSB WAS SO ERRONEOUSLY LOW THAT AN RSA OF   */ 07709000
*        /*            4K WAS OBTAINED.                              */ 07710000
*        /*                                                          */ 07711000
*        /*            IN GENERAL, THE MERGE IS ACCOMPLISHED IN THE  */ 07712000
*        /*            FOLLOWING MANNER (ASSUMING A 16-WAY MERGE) -  */ 07713000
*        /*                                                          */ 07714000
*        /*            . READING THE FIRST 2K BLOCK OF THE FIRST     */ 07715000
*        /*              N STRINGS TO BE MERGED, WHERE N IS 16 IF    */ 07716000
*        /*              THERE ARE 16 OR MORE INPUT STRINGS OR       */ 07717000
*        /*              WHERE N IS THE TOTAL NUMBER OF INPUT        */ 07718000
*        /*              STRINGS IF LESS THAN 16.                    */ 07719000
*        /*                                                          */ 07720000
*        /*              USING THE FIRST RECORD OF EACH STRING,      */ 07721000
*        /*              BUILD AN ARRAY IN THE FORM OF A TREE        */ 07722000
*        /*              IN WHICH EACH PARENT NODE IS LOWER THAN     */ 07723000
*        /*              EACH OF ITS TWO CHILD NODES (SEE COMMENTS   */ 07724000
*        /*              LATER IN THIS MODULE FOR DETAILS)           */ 07725000
*        /*                                                          */ 07726000
*        /*            . OUTPUT THE LOWEST RECORD ON THE TREE.       */ 07727000
*        /*              THIS OUTPUT WILL BE TO BLDPROC IF THIS IS   */ 07728000
*        /*              THE LAST OR ONLY MERGE PASS OR TO THE       */ 07729000
*        /*              OUTPUT STRING IF THIS IS NOT THE LAST MERGE */ 07730000
*        /*              PASS.                                       */ 07731000
*        /*                                                          */ 07732000
*        /*            . UPDATE THE TREE FILLING THE SLOT LEFT       */ 07733000
*        /*              EMPTY FROM THE STEP ABOVE.                  */ 07734000
*        /*                                                          */ 07735000
*        /*            . GET THE NEXT RECORD FROM THE SAME STRING    */ 07736000
*        /*              AS THE PREVIOUS LOWEST RECORD.  OUTPUT IT   */ 07737000
*        /*              IF IT IS LOWER THAN THE CURRENT LOWEST,     */ 07738000
*        /*              OTHERWISE ADD IT TO THE TREE                */ 07739000
*        /*                                                          */ 07740000
*        /*            . CONTINUE THIS PROCESS UNTIL ALL RECORDS     */ 07741000
*        /*              IN ALL INPUT STRINGS CURRENTLY BEING        */ 07742000
*        /*              PROCESSED HAVE BEEN OUTPUT.                 */ 07743000
*        /*                                                          */ 07744000
*        /*            . LOOP UNTIL ALL INPUT STRINGS FOR THIS       */ 07745000
*        /*              MERGE PASS HAVE BEEN OUTPUT                 */ 07746000
*        /*                                                          */ 07747000
*        /*            . IF MORE MERGE PASSES ARE REQUIRED,          */ 07748000
*        /*              MAKE THE PREVIOUS OUTPUT FILE THE NEXT      */ 07749000
*        /*              INPUT FILE AND VICE VERSA AND REPEAT THE    */ 07750000
*        /*              MERGE PASSES UNTIL THE NUMBER OF INPUT      */ 07751000
*        /*              STRINGS IS EQUAL TO OR LESS THAN THE        */ 07752000
*        /*              ORDER OF MERGE                              */ 07753000
*        /*                                                          */ 07754000
*        /* INPUT -                                                  */ 07755000
*        /*        MERGAMDS - POINTER TO BASE CLUSTER AND AIX        */ 07756000
*        /*                   AMDSB CONTROL BLOCKS                   */ 07757000
*        /*                                                          */ 07758000
*        /*        MERGIOCS - POINTERS TO IOCSTR FOR EACH OPEN DATA  */ 07759000
*        /*                   SET                                    */ 07760000
*        /*                                                          */ 07761000
*        /*        MERGIOIN - POINTERS TO THE DATA OBTAINED FROM     */ 07762000
*        /*                   THE SORT WORK JOB CONTROL              */ 07763000
*        /*                                                          */ 07764000
*        /*        MERGSRTB - SORT CONTROL TABLE                     */ 07765000
*        /*                                                          */ 07766000
*        /* OUTPUT -                                                 */ 07767000
*        /*                                                          */ 07768000
*        /*        MERGSTAT - STATUS COMMUNICATION AREA              */ 07769000
*        /*                   SORT RECORDS PASSED TO BLDPROC         */ 07770000
*        /*                                                          */ 07771000
*        /* EXIT,NORMAL -  ALL FUNCTIONS COMPLETED SUCCESSFULLY      */ 07772000
*        /*                                                          */ 07773000
*        /* EXIT,ERROR  - RETURN CODE 8, I/O ERROR ON SORT WORK      */ 07774000
*        /*                              FILES OR TERMINATING        */ 07775000
*        /*                              ERROR ENCOUNTERED BY        */ 07776000
*        /*                              BLD PROC                    */ 07777000
*        /*                                                          */ 07778000
*        /************************************************************/ 07779000
*                                                                  1460 07780000
*MERGPROC:                                                         1460 07781000
*        PROCEDURE(MERGAMDS,           /* POINTERS TO AMDSBS         */ 07782000
*                  MERGIOCS,           /* POINTERS TO IOCSTRS        */ 07783000
*                  MERGIOIN,           /* POINTERS TO SORT WORK JOB  */ 07784000
*                                      /* CONTROL DATA               */ 07785000
*                  MERGSRTB,           /* SORT CONTROL TABLE         */ 07786000
*                  MERGSTAT);          /* STATUS COMMUNICATION AREA  */ 07787000
*                                                                  1460 07788000
MERGPROC STM   @14,@12,@SA00016                                    1460 07789000
         MVC   @PC00016(20),0(@01)                                 1460 07790000
*        /************************************************************/ 07791000
*        /*                                                          */ 07792000
*        /* ARGUMENTS OF INVOCATION                                  */ 07793000
*        /*                                                          */ 07794000
*        /************************************************************/ 07795000
*                                                                  1461 07796000
*        DCL 1 MERGAMDS BDY(WORD),     /* POINTERS TO AMDSBS         */ 07797000
*              2 MERAMBAS PTR(31),     /* POINTER TO BASE AMDSB      */ 07798000
*              2 MERAMAIX PTR(31);     /* POINTER TO AIX AMDSB       */ 07799000
*                                                                  1461 07800000
*        DCL 1 MERGIOCS BDY(WORD),     /* POINTERS TO IOCSTRS        */ 07801000
*              2 MRIOCSBS PTR(31),     /* POINTER TO BASE IOCSTR     */ 07802000
*              2 MRIOCSAX PTR(31),     /* POINTER TO AIX IOCSTR      */ 07803000
*              2 MRIOCSSR(2) PTR(31);  /* POINTERS TO SORT IOCSTRS   */ 07804000
*                                                                  1462 07805000
*        DCL 1 MERGIOIN BDY(WORD),     /* POINTERS TO SORT WORK JOB  */ 07806000
*              2 MRIOINPT(2) PTR(31);  /* CONTROL DATA               */ 07807000
*                                                                  1463 07808000
*        DCL MERGSRTB;                 /* SORT CONTROL TABLE         */ 07809000
*                                                                  1464 07810000
*        DCL 1 MERGSTAT,               /* STATUS COMMUNICATION AREA  */ 07811000
*              2 MRSAVERC FIXED(15),   /* CURRENT CONDITION CODE     */ 07812000
*              2 MRSTID   CHAR(4);     /*  ERROR IDENTIFIER          */ 07813000
*                                                                  1465 07814000
*        /************************************************************/ 07815000
*        /*                                                          */ 07816000
*        /* FLAGS AND CONTROL VARIABLES                              */ 07817000
*        /*                                                          */ 07818000
*        /************************************************************/ 07819000
*                                                                  1466 07820000
*        DCL 1 MERGFLAG BIT(8),                                    1466 07821000
*              2 MERGEND  BIT(1),      /* END OF MERGE FLAG          */ 07822000
*              2 MERGSTRT BIT(1),      /* START OF MERGE FLAG        */ 07823000
*              2 MERGOUT  BIT(1),      /* OUTPUT NEXT RECORD FLAG    */ 07824000
*              2 MERGUPD  BIT(1);      /* TREE UPDATE FLAG           */ 07825000
*                                                                  1466 07826000
*        DCL                                                       1467 07827000
*          M        FIXED(31),         /* TREE ADD LOOP CONTROL      */ 07828000
*          STRGCTR  FIXED(15),         /* INPUT STRING COUNTER       */ 07829000
*          STRGLIM  FIXED(15),         /* STRING LOOP CONTROL        */ 07830000
*          OUTBUFCT FIXED(15),         /* OUTPUT BUFFER RECORD COUNT */ 07831000
*          OUTBUFST FIXED(15),         /* START AND END STRING VALUE */ 07832000
*          OUTBUFEN FIXED(15),         /* OF OUTPUT BUFFER           */ 07833000
*          IOCSHOLD PTR(31),           /* IOCSTR POINTER HOLD AREA   */ 07834000
*          RBAHOLD  FIXED(31);         /* STARTING INPUT RBA         */ 07835000
*                                                                  1467 07836000
*                                                                  1467 07837000
*        DCL SWFTWO FIXED(31) INIT(2); /* SORT WORK FILE INDEX       */ 07838000
*                                                                  1468 07839000
*        DCL MAXKEY(256) CHAR(1) INIT((256) 'FF'X); /* MAX KEY VALUE */ 07840000
*                                                                  1469 07841000
*        /************************************************************/ 07842000
*        /*                                                          */ 07843000
*        /* AREAS CONTAINING STRING END CONTROL FACTORS              */ 07844000
*        /*                                                          */ 07845000
*        /************************************************************/ 07846000
*                                                                  1470 07847000
*        DCL 1 MRNLAST FIXED(31),      /* MERGE PASS - ALL BUT LAST  */ 07848000
*              2 MRNLBLK  FIXED(15),   /* LAST BLOCK NUMBER          */ 07849000
*              2 MRNLREC  FIXED(15);   /* LAST RECORD NUMBER         */ 07850000
*                                                                  1470 07851000
*        DCL 1 MRLAST  FIXED(31),      /* MERGE PASS - LAST STRING   */ 07852000
*              2 MRLBLK   FIXED(15),   /* LAST BLOCK NUMBER          */ 07853000
*              2 MRLREC   FIXED(15);   /* LAST RECORD NUMBER         */ 07854000
*                                                                  1471 07855000
*        DCL 1 STRNLAST FIXED(31),     /* STRING LOOP - ALL BUT LAST */ 07856000
*              2 STRNLBLK FIXED(15),   /* LAST BLOCK NUMBER          */ 07857000
*              2 STRNLREC FIXED(15);   /* LAST RECORD NUMBER         */ 07858000
*                                                                  1472 07859000
*        DCL 1 STRLAST  FIXED(31),     /* STRING LOOP - LAST STRING  */ 07860000
*              2 STRLBLK  FIXED(15),   /* LAST BLOCK NUMBER          */ 07861000
*              2 STRLREC  FIXED(15);   /* LAST RECORD NUMBER         */ 07862000
*                                                                  1473 07863000
*        /************************************************************/ 07864000
*        /*                                                          */ 07865000
*        /* FACTORS CONTROLLING TREE ADD AND TREE DELETE ROUTINES    */ 07866000
*        /*                                                          */ 07867000
*        /************************************************************/ 07868000
*                                                                  1474 07869000
*        DCL                                                       1474 07870000
*          TSIZE    FIXED(15),         /* SIZE OF TREE               */ 07871000
*          TCURR    FIXED(15),         /* PARENT INDEX               */ 07872000
*          TPREV    FIXED(15),         /* CHILD INDEX                */ 07873000
*          TREC1    FIXED(15),         /* RECORD INDEXES FOR TREE    */ 07874000
*          TREC2    FIXED(15),         /* DELETE ROUTINE             */ 07875000
*          TRECORD  PTR(31);           /* POINTER TO NEW OR REPLACE- */ 07876000
*                                      /* MENT RECORD                */ 07877000
*                                                                  1475 07878000
*                                                                  1475 07879000
*        /************************************************************/ 07880000
*        /*                                                          */ 07881000
*        /* OVERLAY OF TREE AND ITS AREA                             */ 07882000
*        /*                                                          */ 07883000
*        /************************************************************/ 07884000
*                                                                  1475 07885000
*        DCL TREEPTR PTR(31);                                      1475 07886000
*                                                                  1475 07887000
*        DCL 1 MERGTREE(16) BASED(TREEPTR) BDY(WORD),              1476 07888000
*              2 MTSTGNO  FIXED(15),   /* STRING NUMBER              */ 07889000
*              2 *        CHAR(2),     /* RESERVED                   */ 07890000
*              2 MTBLKREC FIXED(31),                               1476 07891000
*                3 MTBLKNO  FIXED(15), /* BLOCK NUMBER               */ 07892000
*                3 MTRECNO  FIXED(15), /* RECORD NUMBER              */ 07893000
*              2 MTPTR    PTR(31),     /* POINTER TO RECORD          */ 07894000
*              2 MTRBA    FIXED(31);   /* RBA OF RECORD              */ 07895000
*                                                                  1476 07896000
*        DCL 1 NEXTREC BDY(WORD),      /* NEXT RECORD HOLD AREA      */ 07897000
*              2 NXSTGNO  FIXED(15),                               1477 07898000
*              2 *        CHAR(2),                                 1477 07899000
*              2 NXBLKREC FIXED(31),                               1477 07900000
*                3 NXBLKNO  FIXED(15),                             1477 07901000
*                3 NXRECNO  FIXED(15),                             1477 07902000
*              2 NXPTR    PTR(31),                                 1477 07903000
*              2 NXRBA    FIXED(31);                               1477 07904000
*                                                                  1477 07905000
*        DCL MTAREA CHAR((LENGTH(MERGTREE) * 16));                 1478 07906000
*                                                                  1478 07907000
*        /************************************************************/ 07908000
*        /*                                                          */ 07909000
*        /* OVERLAY OF SORT RECORD                                   */ 07910000
*        /*                                                          */ 07911000
*        /************************************************************/ 07912000
*                                                                  1479 07913000
*        DCL MRSRTREC CHAR(*) BASED;                               1479 07914000
*        /************************************************************/ 07915000
*        /*                                                          */ 07916000
*        /* SET PROCESSING FLAGS.  INITIALIZE POINTER TO TREE.       */ 07917000
*        /*                                                          */ 07918000
*        /************************************************************/ 07919000
*                                                                  1480 07920000
*        OLDERID2 = NEWERID2;                                      1480 07921000
         L     @05,@PC00001                                        1480 07922000
         L     @05,GDTTR2(,@05)                                    1480 07923000
         MVC   @TS00001(95),NEWERID2(@05)                          1480 07924000
         MVC   OLDERID2(95,@05),@TS00001                           1480 07925000
*        NEWID2 = 'BIM1';                                          1481 07926000
*                                                                  1481 07927000
         MVC   NEWID2(4,@05),@CC01611                              1481 07928000
*        MERGEND  = OFF;                                           1482 07929000
*        MERGSTRT = ON;                                            1483 07930000
*                                                                  1483 07931000
         OI    MERGSTRT,B'01000000'                                1483 07932000
         NI    MERGEND,B'01111111'                                 1483 07933000
*        TREEPTR  = ADDR(MTAREA);                                  1484 07934000
*                                                                  1484 07935000
         LA    TREEPTR,MTAREA                                      1484 07936000
*        /************************************************************/ 07937000
*        /*                                                          */ 07938000
*        /* THIS IS THE MAIN MERGE PASS LOOP.  INITIALIZE FACTORS.   */ 07939000
*        /* GET THE NUMBER OF INPUT STRINGS.  IF EQUAL TO OR LESS    */ 07940000
*        /* THAN THE NUMBER OF INPUT BUFFERS, THIS IS THE LAST       */ 07941000
*        /* MERGE PASS.                                              */ 07942000
*        /*                                                          */ 07943000
*        /************************************************************/ 07944000
*                                                                  1485 07945000
*MERGLP: DO WHILE MERGEND = OFF;                                   1485 07946000
*                                                                  1485 07947000
MERGLP   B     @DE01485                                            1485 07948000
@DL01485 DS    0H                                                  1486 07949000
*          OLDERID2 = NEWERID2;                                    1486 07950000
         L     @05,@PC00001                                        1486 07951000
         L     @05,GDTTR2(,@05)                                    1486 07952000
         MVC   @TS00001(95),NEWERID2(@05)                          1486 07953000
         MVC   OLDERID2(95,@05),@TS00001                           1486 07954000
*          NEWID2 = 'BIM2';                                        1487 07955000
*                                                                  1487 07956000
         MVC   NEWID2(4,@05),@CC01614                              1487 07957000
*          SRTISTRG = SRTOSTRG;                                    1488 07958000
         L     @05,SRTOSTRG                                        1488 07959000
         ST    @05,SRTISTRG                                        1488 07960000
*          SRTOSTRG = 0;                                           1489 07961000
         SLR   @15,@15                                             1489 07962000
         ST    @15,SRTOSTRG                                        1489 07963000
*          STRGCTR  = SRTISTRG;                                    1490 07964000
*                                                                  1490 07965000
         STH   @05,STRGCTR                                         1490 07966000
*          IF STRGCTR <= SRTRSABK                                  1491 07967000
*            THEN                                                  1491 07968000
         C     @05,SRTRSABK                                        1491 07969000
         BH    @RF01491                                            1491 07970000
*              MERGEND = ON;                                       1492 07971000
*                                                                  1492 07972000
         OI    MERGEND,B'10000000'                                 1492 07973000
*          /**********************************************************/ 07974000
*          /*                                                        */ 07975000
*          /* THE FIRST IOCSTR IS ALWAYS FOR INPUT AND THE SECOND    */ 07976000
*          /* ALWAYS FOR OUTPUT. ON ALL BUT THE FIRST PASS, EXCHANGE */ 07977000
*          /* THEM.  ON THE FIRST PASS THEY ARE ALREADY SET          */ 07978000
*          /* CORRECTLY.  SET UP IOCSTR FOR OUTPUT AND STARTING      */ 07979000
*          /* INPUT RBA.                                             */ 07980000
*          /*                                                        */ 07981000
*          /**********************************************************/ 07982000
*                                                                  1493 07983000
*          IF MERGSTRT = OFF                                       1493 07984000
*            THEN                                                  1493 07985000
@RF01491 TM    MERGSTRT,B'01000000'                                1493 07986000
         BNZ   @RF01493                                            1493 07987000
*              DO;                                                 1494 07988000
*                                                                  1494 07989000
*              IOCSHOLD = MRIOCSSR(1);                             1495 07990000
         L     @05,@PC00016+4                                      1495 07991000
         L     IOCSHOLD,MRIOCSSR(,@05)                             1495 07992000
*              MRIOCSSR(1) = MRIOCSSR(2);                          1496 07993000
         L     @03,MRIOCSSR+4(,@05)                                1496 07994000
         ST    @03,MRIOCSSR(,@05)                                  1496 07995000
*              MRIOCSSR(2) = IOCSHOLD;                             1497 07996000
*                                                                  1497 07997000
         ST    IOCSHOLD,MRIOCSSR+4(,@05)                           1497 07998000
*              END;                                                1498 07999000
*                                                                  1498 08000000
*          RBAHOLD = 0;                                            1499 08001000
*                                                                  1499 08002000
@RF01493 SLR   @05,@05                                             1499 08003000
         ST    @05,RBAHOLD                                         1499 08004000
*          IOCSPTR = MRIOCSSR(2);                                  1500 08005000
         L     @15,@PC00016+4                                      1500 08006000
         L     IOCSPTR,MRIOCSSR+4(,@15)                            1500 08007000
*          IOCRBA  = 0;                                            1501 08008000
         ST    @05,IOCRBA(,IOCSPTR)                                1501 08009000
*          IOCDLN  = BLKSIZE;                                      1502 08010000
         MVC   IOCDLN(4,IOCSPTR),@CF00976                          1502 08011000
*          IOCWORK = SRTBUFPT;                                     1503 08012000
         L     @03,SRTBUFPT                                        1503 08013000
         ST    @03,IOCWORK(,IOCSPTR)                               1503 08014000
*          IOCDAD  = 0;                                            1504 08015000
         ST    @05,IOCDAD(,IOCSPTR)                                1504 08016000
*          OUTBUFPT = SRTBUFPT;                                    1505 08017000
         ST    @03,OUTBUFPT                                        1505 08018000
*          OUTBUFCT = 0;                                           1506 08019000
         STH   @05,OUTBUFCT                                        1506 08020000
*          OUTBUFST = 1;                                           1507 08021000
         MVC   OUTBUFST(2),@CH00220                                1507 08022000
*          OUTBUFEN = SRTRECSZ;                                    1508 08023000
*                                                                  1508 08024000
         LH    @15,SRTRECSZ                                        1508 08025000
         STH   @15,OUTBUFEN                                        1508 08026000
*          /**********************************************************/ 08027000
*          /*                                                        */ 08028000
*          /* CALCULATE THE FACTORS WHICH WILL DETERMINE WHEN THE    */ 08029000
*          /* END OF A STRING HAS BEEN REACHED.  THESE FACTORS FOR   */ 08030000
*          /* THE LAST INPUT STRING WILL BE DIFFERENT THAN FOR ALL   */ 08031000
*          /* OTHER STRINGS                                          */ 08032000
*          /*                                                        */ 08033000
*          /*   . ALL BUT LAST STRING                                */ 08034000
*          /*       RSA BLOCK CAPACITY ON FIRST PASS OR NUMBER OF    */ 08035000
*          /*       RECORDS IN ALL BUT LAST STRING (SAVED IN         */ 08036000
*          /*       SRTRCNLO ON PREVIOUS PASS) DIVIDED BY NUMBER OF  */ 08037000
*          /*       RECORDS PER BLOCK                                */ 08038000
*          /*                                                        */ 08039000
*          /*   . LAST STRING                                        */ 08040000
*          /*       NUMBER OF RECORDS IN RSA ON FIRST PASS OR NUMBER */ 08041000
*          /*       OF RECORDS IN LAST STRING (SAVED IN SRTRCLSO ON  */ 08042000
*          /*       PREVIOUS PASS) DIVIDED BY NUMBER OF RECORDS PER  */ 08043000
*          /*       BLOCK                                            */ 08044000
*          /*                                                        */ 08045000
*          /*   DIVIDEND + 1 = LAST BLOCK NUMBER                     */ 08046000
*          /*   REMAINDER = LAST RECORD NUMBER                       */ 08047000
*          /*                                                        */ 08048000
*          /**********************************************************/ 08049000
*                                                                  1509 08050000
*          IF MERGSTRT = ON                                        1509 08051000
*            THEN                                                  1509 08052000
         TM    MERGSTRT,B'01000000'                                1509 08053000
         BNO   @RF01509                                            1509 08054000
*              DO;                                                 1510 08055000
*                                                                  1510 08056000
*              SRTRCNLO = SRTRSACP;                                1511 08057000
*                                                                  1511 08058000
         L     @15,SRTRSACP                                        1511 08059000
         ST    @15,SRTRCNLO                                        1511 08060000
*              IF SRTRSACT ^= 0                                    1512 08061000
*                THEN                                              1512 08062000
         L     @15,SRTRSACT                                        1512 08063000
         CR    @15,@05                                             1512 08064000
         BE    @RF01512                                            1512 08065000
*                  SRTRCLSO = SRTRSACT;                            1513 08066000
*                                                                  1513 08067000
         ST    @15,SRTRCLSO                                        1513 08068000
*                ELSE                                              1514 08069000
*                  SRTRCLSO = SRTRSACP;                            1514 08070000
*                                                                  1514 08071000
         B     @RC01512                                            1514 08072000
@RF01512 L     @05,SRTRSACP                                        1514 08073000
         ST    @05,SRTRCLSO                                        1514 08074000
*              END;                                                1515 08075000
*                                                                  1515 08076000
@RC01512 DS    0H                                                  1516 08077000
*          MRNLBLK = SRTRCNLO / SRTRECBK;                          1516 08078000
*                                                                  1516 08079000
@RF01509 L     @05,SRTRCNLO                                        1516 08080000
         LH    @15,SRTRECBK                                        1516 08081000
         LR    @00,@05                                             1516 08082000
         SRDA  @00,32                                              1516 08083000
         DR    @00,@15                                             1516 08084000
         STH   @01,MRNLBLK                                         1516 08085000
*          MRNLREC = SRTRCNLO // SRTRECBK;                         1517 08086000
*                                                                  1517 08087000
         LR    @02,@05                                             1517 08088000
         SRDA  @02,32                                              1517 08089000
         DR    @02,@15                                             1517 08090000
         STH   @02,MRNLREC                                         1517 08091000
*          IF MRNLREC ^= 0                                         1518 08092000
*            THEN                                                  1518 08093000
         LTR   @02,@02                                             1518 08094000
         BZ    @RF01518                                            1518 08095000
*              MRNLBLK = MRNLBLK + 1;                              1519 08096000
*                                                                  1519 08097000
         LA    @01,1(,@01)                                         1519 08098000
         STH   @01,MRNLBLK                                         1519 08099000
*            ELSE                                                  1520 08100000
*              MRNLREC = SRTRECBK;                                 1520 08101000
*                                                                  1520 08102000
         B     @RC01518                                            1520 08103000
@RF01518 LH    @05,SRTRECBK                                        1520 08104000
         STH   @05,MRNLREC                                         1520 08105000
*          MRLBLK = SRTRCLSO / SRTRECBK;                           1521 08106000
*                                                                  1521 08107000
@RC01518 L     @05,SRTRCLSO                                        1521 08108000
         LH    @15,SRTRECBK                                        1521 08109000
         LR    @00,@05                                             1521 08110000
         SRDA  @00,32                                              1521 08111000
         DR    @00,@15                                             1521 08112000
         STH   @01,MRLBLK                                          1521 08113000
*          MRLREC = SRTRCLSO // SRTRECBK;                          1522 08114000
*                                                                  1522 08115000
         LR    @02,@05                                             1522 08116000
         SRDA  @02,32                                              1522 08117000
         DR    @02,@15                                             1522 08118000
         STH   @02,MRLREC                                          1522 08119000
*          IF MRLREC ^= 0                                          1523 08120000
*            THEN                                                  1523 08121000
         LTR   @02,@02                                             1523 08122000
         BZ    @RF01523                                            1523 08123000
*              MRLBLK = MRLBLK + 1;                                1524 08124000
*                                                                  1524 08125000
         LA    @01,1(,@01)                                         1524 08126000
         STH   @01,MRLBLK                                          1524 08127000
*            ELSE                                                  1525 08128000
*              MRLREC = SRTRECBK;                                  1525 08129000
         B     @RC01523                                            1525 08130000
@RF01523 LH    @05,SRTRECBK                                        1525 08131000
         STH   @05,MRLREC                                          1525 08132000
*          /**********************************************************/ 08133000
*          /*                                                        */ 08134000
*          /* THIS IS THE MAIN LOOP FOR ONE MERGE PASS.  THIS LOOP   */ 08135000
*          /* IS PERFORMED UNTIL ALL INPUT STRINGS HAVE BEEN READ    */ 08136000
*          /* AND PROCESSED.  PERFORM INITIALIZATION.  RESET         */ 08137000
*          /* COUNTERS AND SET UP INPUT IOCSTR.                      */ 08138000
*          /*                                                        */ 08139000
*          /**********************************************************/ 08140000
*                                                                  1526 08141000
*STRGLP:   DO WHILE STRGCTR > 0;                                   1526 08142000
*                                                                  1526 08143000
@RC01523 DS    0H                                                  1526 08144000
STRGLP   B     @DE01526                                            1526 08145000
@DL01526 DS    0H                                                  1527 08146000
*            SRTRCLSO = 0;                                         1527 08147000
         SLR   @07,@07                                             1527 08148000
         ST    @07,SRTRCLSO                                        1527 08149000
*            TSIZE    = 0;                                         1528 08150000
*                                                                  1528 08151000
         SLR   TSIZE,TSIZE                                         1528 08152000
*            IOCSPTR = MRIOCSSR(1);                                1529 08153000
*                                                                  1529 08154000
         L     @07,@PC00016+4                                      1529 08155000
         L     IOCSPTR,MRIOCSSR(,@07)                              1529 08156000
*            IOCRBA  = RBAHOLD;                                    1530 08157000
         L     @07,RBAHOLD                                         1530 08158000
         ST    @07,IOCRBA(,IOCSPTR)                                1530 08159000
*            IOCDLN  = BLKSIZE;                                    1531 08160000
         MVC   IOCDLN(4,IOCSPTR),@CF00976                          1531 08161000
*            IOCWORK = SRTRSAPT;                                   1532 08162000
         L     @07,SRTRSAPT                                        1532 08163000
         ST    @07,IOCWORK(,IOCSPTR)                               1532 08164000
*            INBUFPT = SRTRSAPT;                                   1533 08165000
*                                                                  1533 08166000
         LR    INBUFPT,@07                                         1533 08167000
*            /********************************************************/ 08168000
*            /*                                                      */ 08169000
*            /* SET UP THE FIRST AND LAST STRING END CONTROL         */ 08170000
*            /* FACTORS FOR THIS SET OF STRINGS                      */ 08171000
*            /*                                                      */ 08172000
*            /********************************************************/ 08173000
*                                                                  1534 08174000
*            IF STRGCTR > SRTRSABK                                 1534 08175000
*              THEN                                                1534 08176000
         L     @07,SRTRSABK                                        1534 08177000
         CH    @07,STRGCTR                                         1534 08178000
         BNL   @RF01534                                            1534 08179000
*                DO;                                               1535 08180000
*                                                                  1535 08181000
*                STRGLIM = SRTRSABK;                               1536 08182000
         STH   @07,STRGLIM                                         1536 08183000
*                STRNLAST = MRNLAST;                               1537 08184000
         L     @07,MRNLAST                                         1537 08185000
         ST    @07,STRNLAST                                        1537 08186000
*                STRLAST  = MRNLAST;                               1538 08187000
*                                                                  1538 08188000
         ST    @07,STRLAST                                         1538 08189000
*                END;                                              1539 08190000
*                                                                  1539 08191000
*              ELSE                                                1540 08192000
*                DO;                                               1540 08193000
*                                                                  1540 08194000
         B     @RC01534                                            1540 08195000
@RF01534 DS    0H                                                  1541 08196000
*                STRGLIM = STRGCTR;                                1541 08197000
         LH    @07,STRGCTR                                         1541 08198000
         STH   @07,STRGLIM                                         1541 08199000
*                STRLAST = MRLAST;                                 1542 08200000
*                                                                  1542 08201000
         L     @03,MRLAST                                          1542 08202000
         ST    @03,STRLAST                                         1542 08203000
*                IF STRGLIM = 1                                    1543 08204000
*                  THEN                                            1543 08205000
         C     @07,@CF00220                                        1543 08206000
         BNE   @RF01543                                            1543 08207000
*                    STRNLAST = MRLAST;                            1544 08208000
*                                                                  1544 08209000
         ST    @03,STRNLAST                                        1544 08210000
*                  ELSE                                            1545 08211000
*                    STRNLAST = MRNLAST;                           1545 08212000
*                                                                  1545 08213000
         B     @RC01543                                            1545 08214000
@RF01543 L     @07,MRNLAST                                         1545 08215000
         ST    @07,STRNLAST                                        1545 08216000
*                END;                                              1546 08217000
*                                                                  1546 08218000
@RC01543 DS    0H                                                  1547 08219000
*            /********************************************************/ 08220000
*            /*                                                      */ 08221000
*            /* IN A LOOP, READ THE FIRST BLOCK OF EACH INPUT        */ 08222000
*            /* STRING AND PLACE THE FIRST RECORD OF EACH STRING     */ 08223000
*            /* IN THE SORT TREE                                     */ 08224000
*            /*                                                      */ 08225000
*            /********************************************************/ 08226000
*                                                                  1547 08227000
*INITTREE:   DO M = 1 TO STRGLIM;                                  1547 08228000
*                                                                  1547 08229000
@RC01534 DS    0H                                                  1547 08230000
INITTREE LA    @07,1                                               1547 08231000
         B     @DE01547                                            1547 08232000
@DL01547 DS    0H                                                  1548 08233000
*              CALL IDCIOGT0 (GDTTBL,MRIOCSSR(1));                 1548 08234000
*                                                                  1548 08235000
         L     @07,@PC00001                                        1548 08236000
         ST    @07,@AL00001                                        1548 08237000
         L     @15,@PC00016+4                                      1548 08238000
         LA    @15,MRIOCSSR(,@15)                                  1548 08239000
         ST    @15,@AL00001+4                                      1548 08240000
         MVI   @AL00001+4,X'80'                                    1548 08241000
         L     @15,GDTGET(,@07)                                    1548 08242000
         LA    @01,@AL00001                                        1548 08243000
         BALR  @14,@15                                             1548 08244000
*              RESPECIFY RTNREG RSTD;                              1549 08245000
*              TESTRC = RTNREG;                                    1550 08246000
         LR    TESTRC,RTNREG                                       1550 08247000
*              RESPECIFY RTNREG UNRSTD;                            1551 08248000
*                                                                  1551 08249000
*              IF TESTRC ^= 0                                      1552 08250000
*                THEN                                              1552 08251000
         LTR   TESTRC,TESTRC                                       1552 08252000
         BZ    @RF01552                                            1552 08253000
*                  RETURN CODE(LASTCC08);                          1553 08254000
*                                                                  1553 08255000
         LA    @15,8                                               1553 08256000
         L     @14,@SA00016                                        1553 08257000
         LM    @00,@12,@SA00016+8                                  1553 08258000
         BR    @14                                                 1553 08259000
*              /******************************************************/ 08260000
*              /*                                                    */ 08261000
*              /* ADD THE FIRST RECORD FROM THE BLOCK JUST READ TO   */ 08262000
*              /* THE TREE.  SEE COMMENTS ON TREEADD PROCEDURE       */ 08263000
*              /* FOR DESCRIPTION OF THE TREE AND THE TREE ADD       */ 08264000
*              /* PROCESS.  WHEN THE PROPER POINT IN THE TREE IS     */ 08265000
*              /* FOUND, SET UP THE FACTORS IN THE TREE ARRAY        */ 08266000
*              /* ELEMENT.                                           */ 08267000
*              /*                                                    */ 08268000
*              /******************************************************/ 08269000
*                                                                  1554 08270000
*              TRECORD = INBUFPT;                                  1554 08271000
*                                                                  1554 08272000
@RF01552 ST    INBUFPT,TRECORD                                     1554 08273000
*              CALL TREEADD;                                       1555 08274000
*                                                                  1555 08275000
         BAL   @14,TREEADD                                         1555 08276000
*              MTPTR(TPREV)   = INBUFPT;                           1556 08277000
         LR    @07,TPREV                                           1556 08278000
         SLA   @07,4                                               1556 08279000
         LR    @01,TREEPTR                                         1556 08280000
         AL    @01,@CF01721                                        1556 08281000
         ST    INBUFPT,MTPTR-8(@07,@01)                            1556 08282000
*              MTSTGNO(TPREV) = M;                                 1557 08283000
         L     @15,M                                               1557 08284000
         LR    @14,TREEPTR                                         1557 08285000
         AL    @14,@CF01669                                        1557 08286000
         STH   @15,MTSTGNO(@07,@14)                                1557 08287000
*              MTBLKNO(TPREV) = 1;                                 1558 08288000
         LA    @14,1                                               1558 08289000
         LR    @01,TREEPTR                                         1558 08290000
         AL    @01,@CF01722                                        1558 08291000
         STH   @14,MTBLKNO-4(@07,@01)                              1558 08292000
*              MTRECNO(TPREV) = 1;                                 1559 08293000
         LR    @01,TREEPTR                                         1559 08294000
         AL    @01,@CF01723                                        1559 08295000
         STH   @14,MTRECNO-6(@07,@01)                              1559 08296000
*              MTRBA(TPREV)   = IOCRBA;                            1560 08297000
*                                                                  1560 08298000
         L     @14,IOCRBA(,IOCSPTR)                                1560 08299000
         AL    @07,@CF01678                                        1560 08300000
         ST    @14,MTRBA-12(@07,TREEPTR)                           1560 08301000
*              /******************************************************/ 08302000
*              /*                                                    */ 08303000
*              /* INCREMENT RBA TO FIRST RECORD OF NEXT STRING.      */ 08304000
*              /* POINT TO NEXT INPUT BUFFER.                        */ 08305000
*              /*                                                    */ 08306000
*              /******************************************************/ 08307000
*                                                                  1561 08308000
*              IOCRBA = IOCRBA + (BLKSIZE * STRNLBLK);             1561 08309000
         LH    @07,STRNLBLK                                        1561 08310000
         SLA   @07,11                                              1561 08311000
         ALR   @14,@07                                             1561 08312000
         ST    @14,IOCRBA(,IOCSPTR)                                1561 08313000
*              IOCWORK = IOCWORK + BLKSIZE;                        1562 08314000
         LA    @07,2048                                            1562 08315000
         AL    @07,IOCWORK(,IOCSPTR)                               1562 08316000
         ST    @07,IOCWORK(,IOCSPTR)                               1562 08317000
*              INBUFPT = IOCWORK;                                  1563 08318000
*                                                                  1563 08319000
         LR    INBUFPT,@07                                         1563 08320000
*            END INITTREE;                                         1564 08321000
*                                                                  1564 08322000
         AL    @15,@CF00220                                        1564 08323000
         LR    @07,@15                                             1564 08324000
@DE01547 ST    @07,M                                               1564 08325000
         CH    @07,STRGLIM                                         1564 08326000
         BNH   @DL01547                                            1564 08327000
*            IF GDTDBG = NULLPTR                                   1565 08328000
*              THEN;                                               1565 08329000
         L     @15,@PC00001                                        1565 08330000
         L     @15,GDTDBG(,@15)                                    1565 08331000
         LTR   @15,@15                                             1565 08332000
         BZ    @RT01565                                            1565 08333000
*              ELSE                                                1567 08334000
*                CALL IDCDB010 (GDTTBL,'BIM3');                    1567 08335000
         L     @15,@PC00001                                        1567 08336000
         ST    @15,@AL00001                                        1567 08337000
         LA    @14,@CC01620                                        1567 08338000
         ST    @14,@AL00001+4                                      1567 08339000
         MVI   @AL00001+4,X'80'                                    1567 08340000
         L     @15,GDTDBG(,@15)                                    1567 08341000
         LA    @01,@AL00001                                        1567 08342000
         BALR  @14,@15                                             1567 08343000
*            /********************************************************/ 08344000
*            /*                                                      */ 08345000
*            /* THIS IS THE MAIN PROCESSING LOOP.  THE RECORD AT     */ 08346000
*            /* THE TOP OF THE TREE (LOWEST IN VALUE) IS OUTPUT,     */ 08347000
*            /* THE TREE UPDATED AND THE NEXT RECORD EITHER ADDED    */ 08348000
*            /* TO THE TREE OR OUTPUT IF IT IS LOWER THAN THE        */ 08349000
*            /* CURRENT TOP.                                         */ 08350000
*            /*                                                      */ 08351000
*            /* CALCULATE THE LOCATION OF THE RECORD AT THE TOP      */ 08352000
*            /* OF THE TREE                                          */ 08353000
*            /*                                                      */ 08354000
*            /********************************************************/ 08355000
*                                                                  1568 08356000
*TREELP:     DO WHILE TSIZE ^= 0;                                  1568 08357000
*                                                                  1568 08358000
@RT01565 DS    0H                                                  1568 08359000
TREELP   B     @DE01568                                            1568 08360000
@DL01568 DS    0H                                                  1569 08361000
*              TRECORD = SRTRSAPT + ((MTSTGNO(1) - 1) * BLKSIZE) + 1569 08362000
*                                   ((MTRECNO(1) - 1) * SRTRECSZ); 1569 08363000
*                                                                  1569 08364000
         LH    @15,MTSTGNO(,TREEPTR)                               1569 08365000
         BCTR  @15,0                                               1569 08366000
         SLA   @15,11                                              1569 08367000
         AL    @15,SRTRSAPT                                        1569 08368000
         LH    @01,MTRECNO(,TREEPTR)                               1569 08369000
         BCTR  @01,0                                               1569 08370000
         MH    @01,SRTRECSZ                                        1569 08371000
         ALR   @15,@01                                             1569 08372000
         ST    @15,TRECORD                                         1569 08373000
*              /******************************************************/ 08374000
*              /*                                                    */ 08375000
*              /* MOVE THE LOCATION OF THE RECORD JUST OUTPUT TO     */ 08376000
*              /* THE NEXT RECORD HOLD AREA.  THE NEXT RECORD TO     */ 08377000
*              /* BE ADDED TO THE TREE IS ALWAYS THE RECORD FOLLOW-  */ 08378000
*              /* ING THE ONE WHICH WAS LAST OUTPUT.                 */ 08379000
*              /*                                                    */ 08380000
*              /******************************************************/ 08381000
*                                                                  1570 08382000
*              NEXTREC = MERGTREE(1);                              1570 08383000
*                                                                  1570 08384000
         MVC   NEXTREC(16),MERGTREE(TREEPTR)                       1570 08385000
*              /******************************************************/ 08386000
*              /*                                                    */ 08387000
*              /* OUTPUT THE RECORD EITHER TO BLDPROC OR TO THE      */ 08388000
*              /* OUTPUT BUFFER                                      */ 08389000
*              /*                                                    */ 08390000
*              /******************************************************/ 08391000
*                                                                  1571 08392000
*              CALL RECOUT;                                        1571 08393000
*                                                                  1571 08394000
         BAL   @14,RECOUT                                          1571 08395000
*              RESPECIFY RTNREG RSTD;                              1572 08396000
*              TESTRC = RTNREG;                                    1573 08397000
         LR    TESTRC,RTNREG                                       1573 08398000
*              RESPECIFY RTNREG UNRSTD;                            1574 08399000
*                                                                  1574 08400000
*              IF TESTRC ^= 0                                      1575 08401000
*                THEN                                              1575 08402000
         LTR   TESTRC,TESTRC                                       1575 08403000
         BZ    @RF01575                                            1575 08404000
*                  RETURN CODE(LASTCC08);                          1576 08405000
*                                                                  1576 08406000
         LA    @15,8                                               1576 08407000
         L     @14,@SA00016                                        1576 08408000
         LM    @00,@12,@SA00016+8                                  1576 08409000
         BR    @14                                                 1576 08410000
*              /******************************************************/ 08411000
*              /*                                                    */ 08412000
*              /* REDUCE THE SIZE OF THE TREE BY 1 FOR THE RECORD    */ 08413000
*              /* JUST OUTPUT.  IF THIS CAUSES THE TREE SIZE TO      */ 08414000
*              /* REACH ZERO, THERE IS ONLY ONE INPUT STRING LEFT.   */ 08415000
*              /* POINT THE TOP OF THE TREE TO A RECORD OF ALL FF'S. */ 08416000
*              /* THIS WILL FORCE ALL REMAINING RECORDS IN THE       */ 08417000
*              /* INPUT STRING TO BE OUTPUT IN THE 'NEXTLP' PROCESS  */ 08418000
*              /* SINCE THEY WILL BE LOWER THAN THE TOP.             */ 08419000
*              /*                                                    */ 08420000
*              /******************************************************/ 08421000
*                                                                  1577 08422000
*              TSIZE = TSIZE - 1;                                  1577 08423000
*                                                                  1577 08424000
@RF01575 BCTR  TSIZE,0                                             1577 08425000
*              IF TSIZE = 0                                        1578 08426000
*                THEN                                              1578 08427000
         LTR   TSIZE,TSIZE                                         1578 08428000
         BNZ   @RF01578                                            1578 08429000
*                  MTPTR(1) = ADDR(MAXKEY);                        1579 08430000
*                                                                  1579 08431000
         LA    @15,MAXKEY                                          1579 08432000
         ST    @15,MTPTR(,TREEPTR)                                 1579 08433000
*                /****************************************************/ 08434000
*                /*                                                  */ 08435000
*                /* THE SIZE OF THE TREE HAS NOT REACHED ZERO.       */ 08436000
*                /* UPDATE THE TREE BY CAUSING THE LOWEST KEY TO     */ 08437000
*                /* BE MOVED TO THE TOP.  THIS IS ACCOMPLISHED BY    */ 08438000
*                /* ESTABLISHING A PARENT-CHILD RELATIONSHIP AT THE  */ 08439000
*                /* EMPTY SLOT AT THE TOP, MOVING UP THE LOWEST      */ 08440000
*                /* CHILD, ESTABLISHING A NEW PARENT-CHILD AT THE    */ 08441000
*                /* SLOT JUST VACATED AND REPEATING THE PROCESS      */ 08442000
*                /* UNTIL THE TREE SIZE IS EXCEEDED.                 */ 08443000
*                /*                                                  */ 08444000
*                /****************************************************/ 08445000
*                                                                  1580 08446000
*                ELSE                                              1580 08447000
*TREEUPLP:         DO;                                             1580 08448000
*                                                                  1580 08449000
         B     @RC01578                                            1580 08450000
@RF01578 DS    0H                                                  1580 08451000
TREEUPLP DS    0H                                                  1581 08452000
*                  TPREV = 1;                                      1581 08453000
         LA    TPREV,1                                             1581 08454000
*                  TCURR = 2;                                      1582 08455000
         LA    TCURR,2                                             1582 08456000
*                  TREC1 = TCURR;                                  1583 08457000
*                                                                  1583 08458000
         STH   TCURR,TREC1                                         1583 08459000
*                  IF SRTRECSZ <= MVCMLIM                          1584 08460000
*                    THEN                                          1584 08461000
         LH    @15,SRTRECSZ                                        1584 08462000
         C     @15,@CF00925                                        1584 08463000
         BH    @RF01584                                            1584 08464000
*                      DO WHILE TCURR <= TSIZE;                    1585 08465000
*                                                                  1585 08466000
         B     @DE01585                                            1585 08467000
@DL01585 DS    0H                                                  1586 08468000
*                      IF MTPTR(TCURR) -> MRSRTREC(1:SRTRECSZ) >   1586 08469000
*                         MTPTR(TCURR + 1) -> MRSRTREC(1:SRTRECSZ) 1586 08470000
*                        THEN                                      1586 08471000
         LR    @15,TCURR                                           1586 08472000
         SLA   @15,4                                               1586 08473000
         LR    @14,TREEPTR                                         1586 08474000
         AL    @14,@CF01721                                        1586 08475000
         L     @01,MTPTR-8(@15,@14)                                1586 08476000
         L     @15,MTPTR(@15,TREEPTR)                              1586 08477000
         LH    @14,SRTRECSZ                                        1586 08478000
         BCTR  @14,0                                               1586 08479000
         EX    @14,@SC01724                                        1586 08480000
         BNH   @RF01586                                            1586 08481000
*                          TCURR = TCURR + 1;                      1587 08482000
*                                                                  1587 08483000
         AL    TCURR,@CF00220                                      1587 08484000
*                      TREC1 = TCURR;                              1588 08485000
*                                                                  1588 08486000
@RF01586 STH   TCURR,TREC1                                         1588 08487000
*                      MERGTREE(TPREV) = MERGTREE(TCURR);          1589 08488000
*                                                                  1589 08489000
         LR    @15,TPREV                                           1589 08490000
         SLA   @15,4                                               1589 08491000
         ALR   @15,TREEPTR                                         1589 08492000
         AL    @15,@CF01669                                        1589 08493000
         LR    @14,TCURR                                           1589 08494000
         SLA   @14,4                                               1589 08495000
         ALR   @14,TREEPTR                                         1589 08496000
         AL    @14,@CF01669                                        1589 08497000
         MVC   @TS00001(16),MERGTREE(@14)                          1589 08498000
         MVC   MERGTREE(16,@15),@TS00001                           1589 08499000
*                      TPREV = TCURR;                              1590 08500000
         LR    TPREV,TCURR                                         1590 08501000
*                      TCURR = TPREV * 2;                          1591 08502000
*                                                                  1591 08503000
         LR    TCURR,TPREV                                         1591 08504000
         ALR   TCURR,TCURR                                         1591 08505000
*                      END;                                        1592 08506000
*                                                                  1592 08507000
@DE01585 CR    TCURR,TSIZE                                         1592 08508000
         BNH   @DL01585                                            1592 08509000
*                    ELSE                                          1593 08510000
*                      DO WHILE TCURR <= TSIZE;                    1593 08511000
*                                                                  1593 08512000
         B     @RC01584                                            1593 08513000
@RF01584 B     @DE01593                                            1593 08514000
@DL01593 DS    0H                                                  1594 08515000
*                      IF (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) >   1594 08516000
*                          MTPTR(TCURR + 1) -> MRSRTREC(1:MVCMLIM)) |   08517000
*                                                                  1594 08518000
*                         (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) =   1594 08519000
*                          MTPTR(TCURR + 1) -> MRSRTREC(1:MVCMLIM) &    08520000
*                          MTPTR(TCURR) ->                         1594 08521000
*                                MRSRTREC(MVCMLIM + 1:SRTRECSZ) >  1594 08522000
*                          MTPTR(TCURR + 1) ->                     1594 08523000
*                                MRSRTREC(MVCMLIM + 1:SRTRECSZ))   1594 08524000
*                        THEN                                      1594 08525000
         LR    @15,TCURR                                           1594 08526000
         SLA   @15,4                                               1594 08527000
         LR    @14,TREEPTR                                         1594 08528000
         AL    @14,@CF01721                                        1594 08529000
         L     @14,MTPTR-8(@15,@14)                                1594 08530000
         L     @15,MTPTR(@15,TREEPTR)                              1594 08531000
         CLC   MRSRTREC(256,@14),MRSRTREC(@15)                     1594 08532000
         BH    @RT01594                                            1594 08533000
         CLC   MRSRTREC(256,@14),MRSRTREC(@15)                     1594 08534000
         BNE   @RF01594                                            1594 08535000
         LH    @07,SRTRECSZ                                        1594 08536000
         SL    @07,@CF01651                                        1594 08537000
         EX    @07,@SC01726                                        1594 08538000
         BNH   @RF01594                                            1594 08539000
@RT01594 DS    0H                                                  1595 08540000
*                          TCURR = TCURR + 1;                      1595 08541000
*                                                                  1595 08542000
         AL    TCURR,@CF00220                                      1595 08543000
*                      TREC1 = TCURR;                              1596 08544000
*                                                                  1596 08545000
@RF01594 STH   TCURR,TREC1                                         1596 08546000
*                      MERGTREE(TPREV) = MERGTREE(TCURR);          1597 08547000
*                                                                  1597 08548000
         LR    @15,TPREV                                           1597 08549000
         SLA   @15,4                                               1597 08550000
         ALR   @15,TREEPTR                                         1597 08551000
         AL    @15,@CF01669                                        1597 08552000
         LR    @14,TCURR                                           1597 08553000
         SLA   @14,4                                               1597 08554000
         ALR   @14,TREEPTR                                         1597 08555000
         AL    @14,@CF01669                                        1597 08556000
         MVC   @TS00001(16),MERGTREE(@14)                          1597 08557000
         MVC   MERGTREE(16,@15),@TS00001                           1597 08558000
*                      TPREV = TCURR;                              1598 08559000
         LR    TPREV,TCURR                                         1598 08560000
*                      TCURR = TPREV * 2;                          1599 08561000
*                                                                  1599 08562000
         LR    TCURR,TPREV                                         1599 08563000
         ALR   TCURR,TCURR                                         1599 08564000
*                      END;                                        1600 08565000
*                                                                  1600 08566000
@DE01593 CR    TCURR,TSIZE                                         1600 08567000
         BNH   @DL01593                                            1600 08568000
*                  /**************************************************/ 08569000
*                  /*                                                */ 08570000
*                  /* THE RECORD WHICH WAS PREVIOUSLY AT THE BOTTOM  */ 08571000
*                  /* OF THE TREE BEFORE THE TREE WAS REDUCED IN     */ 08572000
*                  /* SIZE IS MOVED INTO THE UPDATED TREE.  IF THIS  */ 08573000
*                  /* RECORD IS LOWER THAN THE LAST CHILD MOVED UP   */ 08574000
*                  /* IN THE LOOP JUST COMPLETED, WE MUST GO BACK    */ 08575000
*                  /* UP THE TREE TO FIND THE PROPER SLOT.           */ 08576000
*                  /*                                                */ 08577000
*                  /**************************************************/ 08578000
*                                                                  1601 08579000
*                  TREC2   = TSIZE + 1;                            1601 08580000
@RC01584 LA    TREC2,1                                             1601 08581000
         ALR   TREC2,TSIZE                                         1601 08582000
*                  MERGUPD = OFF;                                  1602 08583000
*                                                                  1602 08584000
         NI    MERGUPD,B'11101111'                                 1602 08585000
*                  IF SRTRECSZ <= MVCMLIM                          1603 08586000
*                    THEN                                          1603 08587000
*                                                                  1603 08588000
         LH    @07,SRTRECSZ                                        1603 08589000
         C     @07,@CF00925                                        1603 08590000
         BH    @RF01603                                            1603 08591000
*                      IF MTPTR(TREC1) -> MRSRTREC(1:SRTRECSZ) >   1604 08592000
*                         MTPTR(TREC2) -> MRSRTREC(1:SRTRECSZ)     1604 08593000
*                        THEN                                      1604 08594000
         LH    @02,TREC1                                           1604 08595000
         SLA   @02,4                                               1604 08596000
         AL    @02,@CF01721                                        1604 08597000
         L     @02,MTPTR-8(@02,TREEPTR)                            1604 08598000
         LR    @15,TREC2                                           1604 08599000
         SLA   @15,4                                               1604 08600000
         AL    @15,@CF01721                                        1604 08601000
         L     @01,MTPTR-8(@15,TREEPTR)                            1604 08602000
         BCTR  @07,0                                               1604 08603000
         EX    @07,@SC01728                                        1604 08604000
         BNH   @RF01604                                            1604 08605000
*                          MERGUPD = ON;                           1605 08606000
*                                                                  1605 08607000
         OI    MERGUPD,B'00010000'                                 1605 08608000
*                        ELSE;                                     1606 08609000
*                                                                  1606 08610000
@RF01604 DS    0H                                                  1607 08611000
*                    ELSE                                          1607 08612000
*                      IF (MTPTR(TREC1) -> MRSRTREC(1:MVCMLIM) >   1607 08613000
*                          MTPTR(TREC2) -> MRSRTREC(1:MVCMLIM))   |     08614000
*                                                                  1607 08615000
*                         (MTPTR(TREC1) -> MRSRTREC(1:MVCMLIM) =   1607 08616000
*                          MTPTR(TREC2) -> MRSRTREC(1:MVCMLIM) &   1607 08617000
*                          MTPTR(TREC1) ->                         1607 08618000
*                                MRSRTREC(MVCMLIM + 1:SRTRECSZ) >  1607 08619000
*                          MTPTR(TREC2) ->                         1607 08620000
*                                MRSRTREC(MVCMLIM + 1:SRTRECSZ))   1607 08621000
*                        THEN                                      1607 08622000
         B     @RC01603                                            1607 08623000
@RF01603 LH    @07,TREC1                                           1607 08624000
         SLA   @07,4                                               1607 08625000
         AL    @07,@CF01721                                        1607 08626000
         L     @07,MTPTR-8(@07,TREEPTR)                            1607 08627000
         LR    @02,TREC2                                           1607 08628000
         SLA   @02,4                                               1607 08629000
         AL    @02,@CF01721                                        1607 08630000
         L     @02,MTPTR-8(@02,TREEPTR)                            1607 08631000
         CLC   MRSRTREC(256,@07),MRSRTREC(@02)                     1607 08632000
         BH    @RT01607                                            1607 08633000
         CLC   MRSRTREC(256,@07),MRSRTREC(@02)                     1607 08634000
         BNE   @RF01607                                            1607 08635000
         LH    @15,SRTRECSZ                                        1607 08636000
         SL    @15,@CF01651                                        1607 08637000
         EX    @15,@SC01730                                        1607 08638000
         BNH   @RF01607                                            1607 08639000
@RT01607 DS    0H                                                  1608 08640000
*                          MERGUPD = ON;                           1608 08641000
*                                                                  1608 08642000
         OI    MERGUPD,B'00010000'                                 1608 08643000
*                        ELSE;                                     1609 08644000
*                                                                  1609 08645000
@RF01607 DS    0H                                                  1610 08646000
*                  IF MERGUPD = ON                                 1610 08647000
*                    THEN                                          1610 08648000
@RC01603 TM    MERGUPD,B'00010000'                                 1610 08649000
         BNO   @RF01610                                            1610 08650000
*                      DO;                                         1611 08651000
*                                                                  1611 08652000
*                      /**********************************************/ 08653000
*                      /*                                            */ 08654000
*                      /* CALCULATE THE LOCATION OF THE LAST CHILD   */ 08655000
*                      /* MOVED UP IN THE LOOP JUST COMPLETED AND    */ 08656000
*                      /* MOVE IT BACK TO ITS PREVIOUS SLOT          */ 08657000
*                      /*                                            */ 08658000
*                      /**********************************************/ 08659000
*                                                                  1612 08660000
*                      TCURR = TPREV;                              1612 08661000
         LR    TCURR,TPREV                                         1612 08662000
*                      TPREV = TCURR / 2;                          1613 08663000
*                                                                  1613 08664000
         LA    @07,2                                               1613 08665000
         LR    @00,TCURR                                           1613 08666000
         SRDA  @00,32                                              1613 08667000
         DR    @00,@07                                             1613 08668000
         LR    TPREV,@01                                           1613 08669000
*                      MERGTREE(TCURR) = MERGTREE(TPREV);          1614 08670000
*                                                                  1614 08671000
         LR    @15,TCURR                                           1614 08672000
         SLA   @15,4                                               1614 08673000
         ALR   @15,TREEPTR                                         1614 08674000
         AL    @15,@CF01669                                        1614 08675000
         LR    @14,TPREV                                           1614 08676000
         SLA   @14,4                                               1614 08677000
         ALR   @14,TREEPTR                                         1614 08678000
         AL    @14,@CF01669                                        1614 08679000
         MVC   @TS00001(16),MERGTREE(@14)                          1614 08680000
         MVC   MERGTREE(16,@15),@TS00001                           1614 08681000
*                      TCURR = TPREV / 2;                          1615 08682000
*                                                                  1615 08683000
         LR    @00,TPREV                                           1615 08684000
         SRDA  @00,32                                              1615 08685000
         DR    @00,@07                                             1615 08686000
         LR    TCURR,@01                                           1615 08687000
*                      /**********************************************/ 08688000
*                      /*                                            */ 08689000
*                      /* GO BACK UP THE TREE LOOKING FOR A PARENT   */ 08690000
*                      /* WHICH IS LOWER THAN THE RECORD AT THE      */ 08691000
*                      /* BOTTOM OF THE TREE.  WHEN WE FIND IT, SET  */ 08692000
*                      /* TCURR TO ZERO TO FORCE EXIT FROM LOOP.     */ 08693000
*                      /* IF TCURR REACHES ZERO IN THE NORMAL        */ 08694000
*                      /* PROCESS, THE RECORD AT THE BOTTOM GOES     */ 08695000
*                      /* IN THE TOP SLOT.                           */ 08696000
*                      /*                                            */ 08697000
*                      /**********************************************/ 08698000
*                                                                  1616 08699000
*                      IF SRTRECSZ <= MVCMLIM                      1616 08700000
*                        THEN                                      1616 08701000
         LH    @07,SRTRECSZ                                        1616 08702000
         C     @07,@CF00925                                        1616 08703000
         BH    @RF01616                                            1616 08704000
*                          DO WHILE TCURR > 0;                     1617 08705000
*                                                                  1617 08706000
         B     @DE01617                                            1617 08707000
@DL01617 DS    0H                                                  1618 08708000
*                          IF MTPTR(TCURR) -> MRSRTREC(1:SRTRECSZ) >    08709000
*                             MTPTR(TREC2) -> MRSRTREC(1:SRTRECSZ) 1618 08710000
*                            THEN                                  1618 08711000
         LR    @07,TCURR                                           1618 08712000
         SLA   @07,4                                               1618 08713000
         LR    @01,TREEPTR                                         1618 08714000
         AL    @01,@CF01721                                        1618 08715000
         L     @01,MTPTR-8(@07,@01)                                1618 08716000
         LR    @15,TREC2                                           1618 08717000
         SLA   @15,4                                               1618 08718000
         AL    @15,@CF01721                                        1618 08719000
         L     @15,MTPTR-8(@15,TREEPTR)                            1618 08720000
         LH    @14,SRTRECSZ                                        1618 08721000
         BCTR  @14,0                                               1618 08722000
         EX    @14,@SC01724                                        1618 08723000
         BNH   @RF01618                                            1618 08724000
*                              DO;                                 1619 08725000
*                                                                  1619 08726000
*                              MERGTREE(TPREV) = MERGTREE(TCURR);  1620 08727000
*                                                                  1620 08728000
         LR    @15,TPREV                                           1620 08729000
         SLA   @15,4                                               1620 08730000
         ALR   @15,TREEPTR                                         1620 08731000
         AL    @15,@CF01669                                        1620 08732000
         ALR   @07,TREEPTR                                         1620 08733000
         AL    @07,@CF01669                                        1620 08734000
         MVC   @TS00001(16),MERGTREE(@07)                          1620 08735000
         MVC   MERGTREE(16,@15),@TS00001                           1620 08736000
*                              TPREV = TCURR;                      1621 08737000
         LR    TPREV,TCURR                                         1621 08738000
*                              TCURR = TPREV / 2;                  1622 08739000
*                                                                  1622 08740000
         LR    @00,TPREV                                           1622 08741000
         SRDA  @00,32                                              1622 08742000
         D     @00,@CF00154                                        1622 08743000
         LR    TCURR,@01                                           1622 08744000
*                              END;                                1623 08745000
*                                                                  1623 08746000
*                            ELSE                                  1624 08747000
*                              TCURR = 0;                          1624 08748000
*                                                                  1624 08749000
         B     @RC01618                                            1624 08750000
@RF01618 SLR   TCURR,TCURR                                         1624 08751000
*                          END;                                    1625 08752000
*                                                                  1625 08753000
@RC01618 DS    0H                                                  1625 08754000
@DE01617 LTR   TCURR,TCURR                                         1625 08755000
         BP    @DL01617                                            1625 08756000
*                        ELSE                                      1626 08757000
*                          DO WHILE TCURR > 0;                     1626 08758000
*                                                                  1626 08759000
         B     @RC01616                                            1626 08760000
@RF01616 B     @DE01626                                            1626 08761000
@DL01626 DS    0H                                                  1627 08762000
*                          IF (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) >    08763000
*                              MTPTR(TREC2) -> MRSRTREC(1:MVCMLIM))  |  08764000
*                                                                  1627 08765000
*                             (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) =    08766000
*                              MTPTR(TREC2) -> MRSRTREC(1:MVCMLIM) &    08767000
*                              MTPTR(TCURR) ->                     1627 08768000
*                                    MRSRTREC(MVCMLIM + 1:SRTRECSZ) >   08769000
*                              MTPTR(TREC2) ->                     1627 08770000
*                                    MRSRTREC(MVCMLIM + 1:SRTRECSZ))    08771000
*                            THEN                                  1627 08772000
         LR    @07,TCURR                                           1627 08773000
         SLA   @07,4                                               1627 08774000
         AL    @07,@CF01721                                        1627 08775000
         L     @07,MTPTR-8(@07,TREEPTR)                            1627 08776000
         LR    @15,TREC2                                           1627 08777000
         SLA   @15,4                                               1627 08778000
         AL    @15,@CF01721                                        1627 08779000
         L     @15,MTPTR-8(@15,TREEPTR)                            1627 08780000
         CLC   MRSRTREC(256,@07),MRSRTREC(@15)                     1627 08781000
         BH    @RT01627                                            1627 08782000
         CLC   MRSRTREC(256,@07),MRSRTREC(@15)                     1627 08783000
         BNE   @RF01627                                            1627 08784000
         LH    @14,SRTRECSZ                                        1627 08785000
         SL    @14,@CF01651                                        1627 08786000
         EX    @14,@SC01732                                        1627 08787000
         BNH   @RF01627                                            1627 08788000
@RT01627 DS    0H                                                  1628 08789000
*                              DO;                                 1628 08790000
*                                                                  1628 08791000
*                              MERGTREE(TPREV) = MERGTREE(TCURR);  1629 08792000
*                                                                  1629 08793000
         LR    @07,TPREV                                           1629 08794000
         SLA   @07,4                                               1629 08795000
         ALR   @07,TREEPTR                                         1629 08796000
         AL    @07,@CF01669                                        1629 08797000
         LR    @15,TCURR                                           1629 08798000
         SLA   @15,4                                               1629 08799000
         ALR   @15,TREEPTR                                         1629 08800000
         AL    @15,@CF01669                                        1629 08801000
         MVC   @TS00001(16),MERGTREE(@15)                          1629 08802000
         MVC   MERGTREE(16,@07),@TS00001                           1629 08803000
*                              TPREV = TCURR;                      1630 08804000
         LR    TPREV,TCURR                                         1630 08805000
*                              TCURR = TPREV / 2;                  1631 08806000
*                                                                  1631 08807000
         LR    @00,TPREV                                           1631 08808000
         SRDA  @00,32                                              1631 08809000
         D     @00,@CF00154                                        1631 08810000
         LR    TCURR,@01                                           1631 08811000
*                              END;                                1632 08812000
*                                                                  1632 08813000
*                            ELSE                                  1633 08814000
*                              TCURR = 0;                          1633 08815000
*                                                                  1633 08816000
         B     @RC01627                                            1633 08817000
@RF01627 SLR   TCURR,TCURR                                         1633 08818000
*                          END;                                    1634 08819000
*                                                                  1634 08820000
@RC01627 DS    0H                                                  1634 08821000
@DE01626 LTR   TCURR,TCURR                                         1634 08822000
         BP    @DL01626                                            1634 08823000
*                      END;                                        1635 08824000
*                                                                  1635 08825000
@RC01616 DS    0H                                                  1636 08826000
*                  /**************************************************/ 08827000
*                  /*                                                */ 08828000
*                  /* TPREV IS NOW POINTING TO THE EMPTY SLOT WHERE  */ 08829000
*                  /* THE RECORD THAT WAS PREVIOUSLY AT THE BOTTOM   */ 08830000
*                  /* GOES.  MOVE IT IN.  THIS COMPLETES THE TREE    */ 08831000
*                  /* UPDATE LOOP.                                   */ 08832000
*                  /*                                                */ 08833000
*                  /**************************************************/ 08834000
*                                                                  1636 08835000
*                  MERGTREE(TPREV) = MERGTREE(TREC2);              1636 08836000
*                                                                  1636 08837000
@RF01610 LR    @07,TPREV                                           1636 08838000
         SLA   @07,4                                               1636 08839000
         ALR   @07,TREEPTR                                         1636 08840000
         AL    @07,@CF01669                                        1636 08841000
         LR    @02,TREC2                                           1636 08842000
         SLA   @02,4                                               1636 08843000
         ALR   @02,TREEPTR                                         1636 08844000
         AL    @02,@CF01669                                        1636 08845000
         MVC   @TS00001(16),MERGTREE(@02)                          1636 08846000
         MVC   MERGTREE(16,@07),@TS00001                           1636 08847000
*                  END TREEUPLP;                                   1637 08848000
*              /******************************************************/ 08849000
*              /*                                                    */ 08850000
*              /* GET THE NEXT RECORD                                */ 08851000
*              /*                                                    */ 08852000
*              /******************************************************/ 08853000
*                                                                  1638 08854000
*NEXTLP:       DO WHILE NXSTGNO ^= 0;                              1638 08855000
*                                                                  1638 08856000
@RC01578 DS    0H                                                  1638 08857000
NEXTLP   B     @DE01638                                            1638 08858000
@DL01638 DS    0H                                                  1639 08859000
*                IF NXRECNO = SRTRECBK                             1639 08860000
*                  THEN                                            1639 08861000
         CLC   NXRECNO(2),SRTRECBK                                 1639 08862000
         BNE   @RF01639                                            1639 08863000
*                    DO;                                           1640 08864000
*                                                                  1640 08865000
*                    IOCSPTR = MRIOCSSR(1);                        1641 08866000
         L     @15,@PC00016+4                                      1641 08867000
         L     IOCSPTR,MRIOCSSR(,@15)                              1641 08868000
*                    IOCRBA  = NXRBA + BLKSIZE;                    1642 08869000
         LA    @14,2048                                            1642 08870000
         AL    @14,NXRBA                                           1642 08871000
         ST    @14,IOCRBA(,IOCSPTR)                                1642 08872000
*                    IOCWORK = SRTRSAPT + ((NXSTGNO - 1) * BLKSIZE);    08873000
*                                                                  1643 08874000
         LH    @14,NXSTGNO                                         1643 08875000
         BCTR  @14,0                                               1643 08876000
         SLA   @14,11                                              1643 08877000
         AL    @14,SRTRSAPT                                        1643 08878000
         ST    @14,IOCWORK(,IOCSPTR)                               1643 08879000
*                    CALL IDCIOGT0 (GDTTBL,MRIOCSSR(1));           1644 08880000
*                                                                  1644 08881000
         L     @14,@PC00001                                        1644 08882000
         ST    @14,@AL00001                                        1644 08883000
         LA    @15,MRIOCSSR(,@15)                                  1644 08884000
         ST    @15,@AL00001+4                                      1644 08885000
         MVI   @AL00001+4,X'80'                                    1644 08886000
         L     @15,GDTGET(,@14)                                    1644 08887000
         LA    @01,@AL00001                                        1644 08888000
         BALR  @14,@15                                             1644 08889000
*                    RESPECIFY RTNREG RSTD;                        1645 08890000
*                    TESTRC = RTNREG;                              1646 08891000
         LR    TESTRC,RTNREG                                       1646 08892000
*                    RESPECIFY RTNREG UNRSTD;                      1647 08893000
*                                                                  1647 08894000
*                    IF TESTRC ^= 0                                1648 08895000
*                      THEN                                        1648 08896000
         LTR   TESTRC,TESTRC                                       1648 08897000
         BZ    @RF01648                                            1648 08898000
*                        RETURN CODE(LASTCC08);                    1649 08899000
*                                                                  1649 08900000
         LA    @15,8                                               1649 08901000
         L     @14,@SA00016                                        1649 08902000
         LM    @00,@12,@SA00016+8                                  1649 08903000
         BR    @14                                                 1649 08904000
*                    NXBLKNO = NXBLKNO + 1;                        1650 08905000
@RF01648 LA    @03,1                                               1650 08906000
         LH    @15,NXBLKNO                                         1650 08907000
         ALR   @15,@03                                             1650 08908000
         STH   @15,NXBLKNO                                         1650 08909000
*                    NXRECNO = 1;                                  1651 08910000
         STH   @03,NXRECNO                                         1651 08911000
*                    NXPTR   = IOCWORK;                            1652 08912000
         L     @03,IOCWORK(,IOCSPTR)                               1652 08913000
         ST    @03,NXPTR                                           1652 08914000
*                    NXRBA   = IOCRBA;                             1653 08915000
*                                                                  1653 08916000
         L     @03,IOCRBA(,IOCSPTR)                                1653 08917000
         ST    @03,NXRBA                                           1653 08918000
*                    END;                                          1654 08919000
*                                                                  1654 08920000
*                  ELSE                                            1655 08921000
*                    DO;                                           1655 08922000
*                                                                  1655 08923000
         B     @RC01639                                            1655 08924000
@RF01639 DS    0H                                                  1656 08925000
*                    NXRECNO = NXRECNO + 1;                        1656 08926000
         LH    @01,NXRECNO                                         1656 08927000
         LA    @01,1(,@01)                                         1656 08928000
         STH   @01,NXRECNO                                         1656 08929000
*                    NXPTR   = NXPTR + SRTRECSZ;                   1657 08930000
*                                                                  1657 08931000
         LH    @15,SRTRECSZ                                        1657 08932000
         AL    @15,NXPTR                                           1657 08933000
         ST    @15,NXPTR                                           1657 08934000
*                    END;                                          1658 08935000
*                                                                  1658 08936000
*                /****************************************************/ 08937000
*                /*                                                  */ 08938000
*                /* DETERMINE IF THE NEXT RECORD IS LOWER THAN THE   */ 08939000
*                /* RECORD AT THE TOP OF THE TREE.                   */ 08940000
*                /*                                                  */ 08941000
*                /****************************************************/ 08942000
*                                                                  1659 08943000
*                MERGOUT = OFF;                                    1659 08944000
*                                                                  1659 08945000
@RC01639 NI    MERGOUT,B'11011111'                                 1659 08946000
*                IF SRTRECSZ <= MVCMLIM                            1660 08947000
*                  THEN                                            1660 08948000
         LH    @15,SRTRECSZ                                        1660 08949000
         C     @15,@CF00925                                        1660 08950000
         BH    @RF01660                                            1660 08951000
*                    IF NXPTR -> MRSRTREC(1:SRTRECSZ) <=           1661 08952000
*                       MTPTR(1) -> MRSRTREC(1:SRTRECSZ)           1661 08953000
*                      THEN                                        1661 08954000
         L     @01,MTPTR(,TREEPTR)                                 1661 08955000
         BCTR  @15,0                                               1661 08956000
         L     @14,NXPTR                                           1661 08957000
         EX    @15,@SC01735                                        1661 08958000
         BH    @RF01661                                            1661 08959000
*                        MERGOUT = ON;                             1662 08960000
*                                                                  1662 08961000
         OI    MERGOUT,B'00100000'                                 1662 08962000
*                      ELSE;                                       1663 08963000
*                                                                  1663 08964000
@RF01661 DS    0H                                                  1664 08965000
*                  ELSE                                            1664 08966000
*                    IF (NXPTR -> MRSRTREC(1:MVCMLIM) <=           1664 08967000
*                        MTPTR(1) -> MRSRTREC(1:MVCMLIM)) |        1664 08968000
*                                                                  1664 08969000
*                       (NXPTR -> MRSRTREC(1:MVCMLIM) =            1664 08970000
*                        MTPTR(1) -> MRSRTREC(1:MVCMLIM) &         1664 08971000
*                        NXPTR -> MRSRTREC(MVCMLIM + 1:SRTRECSZ) <=     08972000
*                        MTPTR(1) -> MRSRTREC(MVCMLIM +1:SRTRECSZ))     08973000
*                      THEN                                        1664 08974000
         B     @RC01660                                            1664 08975000
@RF01660 L     @15,NXPTR                                           1664 08976000
         L     @14,MTPTR(,TREEPTR)                                 1664 08977000
         CLC   MRSRTREC(256,@15),MRSRTREC(@14)                     1664 08978000
         BNH   @RT01664                                            1664 08979000
         CLC   MRSRTREC(256,@15),MRSRTREC(@14)                     1664 08980000
         BNE   @RF01664                                            1664 08981000
         LH    @07,SRTRECSZ                                        1664 08982000
         SL    @07,@CF01651                                        1664 08983000
         EX    @07,@SC01737                                        1664 08984000
         BH    @RF01664                                            1664 08985000
@RT01664 DS    0H                                                  1665 08986000
*                        MERGOUT = ON;                             1665 08987000
*                                                                  1665 08988000
         OI    MERGOUT,B'00100000'                                 1665 08989000
*                      ELSE;                                       1666 08990000
*                                                                  1666 08991000
@RF01664 DS    0H                                                  1667 08992000
*                /****************************************************/ 08993000
*                /*                                                  */ 08994000
*                /* IF THE NEXT RECORD IS LOWER, OUTPUT IT           */ 08995000
*                /*                                                  */ 08996000
*                /****************************************************/ 08997000
*                                                                  1667 08998000
*                IF MERGOUT = ON                                   1667 08999000
*                  THEN                                            1667 09000000
@RC01660 TM    MERGOUT,B'00100000'                                 1667 09001000
         BNO   @RF01667                                            1667 09002000
*                    DO;                                           1668 09003000
*                                                                  1668 09004000
*                    TRECORD = NXPTR;                              1669 09005000
*                                                                  1669 09006000
         L     @15,NXPTR                                           1669 09007000
         ST    @15,TRECORD                                         1669 09008000
*                    CALL RECOUT;                                  1670 09009000
*                                                                  1670 09010000
         BAL   @14,RECOUT                                          1670 09011000
*                    RESPECIFY RTNREG RSTD;                        1671 09012000
*                    TESTRC = RTNREG;                              1672 09013000
         LR    TESTRC,RTNREG                                       1672 09014000
*                    RESPECIFY RTNREG UNRSTD;                      1673 09015000
*                                                                  1673 09016000
*                    IF TESTRC ^= 0                                1674 09017000
*                      THEN                                        1674 09018000
         LTR   TESTRC,TESTRC                                       1674 09019000
         BZ    @RF01674                                            1674 09020000
*                        RETURN CODE(LASTCC08);                    1675 09021000
*                                                                  1675 09022000
         LA    @15,8                                               1675 09023000
         L     @14,@SA00016                                        1675 09024000
         LM    @00,@12,@SA00016+8                                  1675 09025000
         BR    @14                                                 1675 09026000
*                    END;                                          1676 09027000
*                                                                  1676 09028000
*                  /**************************************************/ 09029000
*                  /*                                                */ 09030000
*                  /* THE NEXT RECORD IS NOT LOWER THAN THE RECORD   */ 09031000
*                  /* AT THE TOP OF THE TREE.  ADD IT TO THE TREE.   */ 09032000
*                  /*                                                */ 09033000
*                  /**************************************************/ 09034000
*                                                                  1677 09035000
*                  ELSE                                            1677 09036000
*                    DO;                                           1677 09037000
*                                                                  1677 09038000
         B     @RC01667                                            1677 09039000
@RF01667 DS    0H                                                  1678 09040000
*                    TRECORD = NXPTR;                              1678 09041000
*                                                                  1678 09042000
         L     @02,NXPTR                                           1678 09043000
         ST    @02,TRECORD                                         1678 09044000
*                    CALL TREEADD;                                 1679 09045000
*                                                                  1679 09046000
         BAL   @14,TREEADD                                         1679 09047000
*                    MERGTREE(TPREV) = NEXTREC;                    1680 09048000
*                                                                  1680 09049000
         LR    @02,TPREV                                           1680 09050000
         SLA   @02,4                                               1680 09051000
         ALR   @02,TREEPTR                                         1680 09052000
         AL    @02,@CF01669                                        1680 09053000
         MVC   MERGTREE(16,@02),NEXTREC                            1680 09054000
*                    /************************************************/ 09055000
*                    /*                                              */ 09056000
*                    /* ZERO THE NEXT RECORD AREA TO FORCE EXIT      */ 09057000
*                    /* FROM THE NEXT RECORD LOOP.                   */ 09058000
*                    /*                                              */ 09059000
*                    /************************************************/ 09060000
*                                                                  1681 09061000
*                    NEXTREC = ''B;                                1681 09062000
*                                                                  1681 09063000
         XC    NEXTREC(16),NEXTREC                                 1681 09064000
*                    END;                                          1682 09065000
*                                                                  1682 09066000
*              END NEXTLP;                                         1683 09067000
*                                                                  1683 09068000
@RC01667 DS    0H                                                  1683 09069000
@DE01638 LH    @15,NXSTGNO                                         1683 09070000
         LTR   @15,@15                                             1683 09071000
         BNZ   @DL01638                                            1683 09072000
*            END TREELP;                                           1684 09073000
@DE01568 SLR   @15,@15                                             1684 09074000
         CR    TSIZE,@15                                           1684 09075000
         BNE   @DL01568                                            1684 09076000
*            /********************************************************/ 09077000
*            /*                                                      */ 09078000
*            /* FINAL PROCESSING FOR ONE SET OF INPUT STRINGS.  SET  */ 09079000
*            /* UP FOR NEXT SET.  IF THERE IS A RECORD IN THE OUTPUT */ 09080000
*            /* BUFFER, WRITE IT.                                    */ 09081000
*            /*                                                      */ 09082000
*            /********************************************************/ 09083000
*                                                                  1685 09084000
*            IF OUTBUFCT ^= 0                                      1685 09085000
*              THEN                                                1685 09086000
         CH    @15,OUTBUFCT                                        1685 09087000
         BE    @RF01685                                            1685 09088000
*                DO;                                               1686 09089000
*                                                                  1686 09090000
*                CALL IDCIOPT0(GDTTBL,MRIOCSSR(2));                1687 09091000
*                                                                  1687 09092000
         L     @05,@PC00001                                        1687 09093000
         ST    @05,@AL00001                                        1687 09094000
         L     @02,@PC00016+4                                      1687 09095000
         LA    @02,MRIOCSSR+4(,@02)                                1687 09096000
         ST    @02,@AL00001+4                                      1687 09097000
         MVI   @AL00001+4,X'80'                                    1687 09098000
         L     @15,GDTPUT(,@05)                                    1687 09099000
         LA    @01,@AL00001                                        1687 09100000
         BALR  @14,@15                                             1687 09101000
*                RESPECIFY RTNREG RSTD;                            1688 09102000
*                TESTRC = RTNREG;                                  1689 09103000
         LR    TESTRC,RTNREG                                       1689 09104000
*                RESPECIFY RTNREG UNRSTD;                          1690 09105000
*                                                                  1690 09106000
*                IF TESTRC ^= 0                                    1691 09107000
*                  THEN                                            1691 09108000
         LTR   TESTRC,TESTRC                                       1691 09109000
         BZ    @RF01691                                            1691 09110000
*                    RETURN CODE(LASTCC08);                        1692 09111000
*                                                                  1692 09112000
         LA    @15,8                                               1692 09113000
         L     @14,@SA00016                                        1692 09114000
         LM    @00,@12,@SA00016+8                                  1692 09115000
         BR    @14                                                 1692 09116000
*                IOCSPTR  = MRIOCSSR(2);                           1693 09117000
@RF01691 L     @05,@PC00016+4                                      1693 09118000
         L     IOCSPTR,MRIOCSSR+4(,@05)                            1693 09119000
*                IOCDAD   = 0;                                     1694 09120000
         SLR   @05,@05                                             1694 09121000
         ST    @05,IOCDAD(,IOCSPTR)                                1694 09122000
*                OUTBUFCT = 0;                                     1695 09123000
         STH   @05,OUTBUFCT                                        1695 09124000
*                OUTBUFST = 1;                                     1696 09125000
         MVC   OUTBUFST(2),@CH00220                                1696 09126000
*                OUTBUFEN = SRTRECSZ;                              1697 09127000
*                                                                  1697 09128000
         LH    @05,SRTRECSZ                                        1697 09129000
         STH   @05,OUTBUFEN                                        1697 09130000
*                IF MERGSTRT = OFF                                 1698 09131000
*                  THEN                                            1698 09132000
         TM    MERGSTRT,B'01000000'                                1698 09133000
         BNZ   @RF01698                                            1698 09134000
*                    IOCRBA  = IOCRBA + BLKSIZE;                   1699 09135000
*                                                                  1699 09136000
         LA    @05,2048                                            1699 09137000
         AL    @05,IOCRBA(,IOCSPTR)                                1699 09138000
         ST    @05,IOCRBA(,IOCSPTR)                                1699 09139000
*                END;                                              1700 09140000
*                                                                  1700 09141000
@RF01698 DS    0H                                                  1701 09142000
*            /********************************************************/ 09143000
*            /*                                                      */ 09144000
*            /* REDUCE THE TOTAL NUMBER OF INPUT STRINGS BY THE      */ 09145000
*            /* NUMBER OF STRINGS JUST PROCESSED.  SET THE STARTING  */ 09146000
*            /* RBA FOR THE FIRST RECORD OF THE FIRST STRING OF      */ 09147000
*            /* THE NEXT SET (THE RBA OF THE LAST RECORD OF THE LAST */ 09148000
*            /* STRING OF THE PREVIOUS SET WAS SAVED).  INCREMENT    */ 09149000
*            /* THE NUMBER OF OUTPUT STRINGS.  SAVE THE NUMBER       */ 09150000
*            /* OF RECORDS IN THIS STRING.                           */ 09151000
*            /*                                                      */ 09152000
*            /********************************************************/ 09153000
*                                                                  1701 09154000
*            STRGCTR = STRGCTR - STRGLIM;                          1701 09155000
@RF01685 LH    @05,STRGCTR                                         1701 09156000
         SH    @05,STRGLIM                                         1701 09157000
         STH   @05,STRGCTR                                         1701 09158000
*            RBAHOLD = RBAHOLD + BLKSIZE;                          1702 09159000
         LA    @15,2048                                            1702 09160000
         AL    @15,RBAHOLD                                         1702 09161000
         ST    @15,RBAHOLD                                         1702 09162000
*            SRTOSTRG = SRTOSTRG + 1;                              1703 09163000
*                                                                  1703 09164000
         LA    @15,1                                               1703 09165000
         AL    @15,SRTOSTRG                                        1703 09166000
         ST    @15,SRTOSTRG                                        1703 09167000
*            IF STRGCTR > 0                                        1704 09168000
*              THEN                                                1704 09169000
         LTR   @05,@05                                             1704 09170000
         BNP   @RF01704                                            1704 09171000
*                SRTRCNLO = SRTRCLSO;                              1705 09172000
*                                                                  1705 09173000
         L     @05,SRTRCLSO                                        1705 09174000
         ST    @05,SRTRCNLO                                        1705 09175000
*            IF GDTDBG = NULLPTR                                   1706 09176000
*              THEN;                                               1706 09177000
@RF01704 L     @05,@PC00001                                        1706 09178000
         L     @05,GDTDBG(,@05)                                    1706 09179000
         LTR   @05,@05                                             1706 09180000
         BZ    @RT01706                                            1706 09181000
*              ELSE                                                1708 09182000
*                CALL IDCDB010 (GDTTBL,'BIM4');                    1708 09183000
*                                                                  1708 09184000
         L     @05,@PC00001                                        1708 09185000
         ST    @05,@AL00001                                        1708 09186000
         LA    @15,@CC01628                                        1708 09187000
         ST    @15,@AL00001+4                                      1708 09188000
         MVI   @AL00001+4,X'80'                                    1708 09189000
         L     @15,GDTDBG(,@05)                                    1708 09190000
         LA    @01,@AL00001                                        1708 09191000
         BALR  @14,@15                                             1708 09192000
*            END STRGLP;                                           1709 09193000
*                                                                  1709 09194000
@RT01706 DS    0H                                                  1709 09195000
@DE01526 LH    @05,STRGCTR                                         1709 09196000
         LTR   @05,@05                                             1709 09197000
         BP    @DL01526                                            1709 09198000
*          /**********************************************************/ 09199000
*          /*                                                        */ 09200000
*          /* THIS IS THE END OF THE MERGE LOOP.  IF THIS WAS THE    */ 09201000
*          /* FIRST MERGE PASS AND IT WAS NOT THE ONLY MERGE PASS,   */ 09202000
*          /* CLOSE AND REOPEN THE SECOND SORT WORK FILE TO GET IT   */ 09203000
*          /* OUT OF CREATE MODE.                                    */ 09204000
*          /*                                                        */ 09205000
*          /**********************************************************/ 09206000
*                                                                  1710 09207000
*          IF MERGSTRT = ON & MERGEND = OFF                        1710 09208000
*            THEN                                                  1710 09209000
         TM    MERGSTRT,B'01000000'                                1710 09210000
         BNO   @RF01710                                            1710 09211000
         TM    MERGEND,B'10000000'                                 1710 09212000
         BNZ   @RF01710                                            1710 09213000
*              DO;                                                 1711 09214000
*                                                                  1711 09215000
*              MERGSTRT = OFF;                                     1712 09216000
*                                                                  1712 09217000
         NI    MERGSTRT,B'10111111'                                1712 09218000
*              CALL IDCIOCL0(GDTTBL,MRIOCSSR(2));                  1713 09219000
*                                                                  1713 09220000
         L     @05,@PC00001                                        1713 09221000
         ST    @05,@AL00001                                        1713 09222000
         L     @15,@PC00016+4                                      1713 09223000
         LA    @15,MRIOCSSR+4(,@15)                                1713 09224000
         ST    @15,@AL00001+4                                      1713 09225000
         MVI   @AL00001+4,X'80'                                    1713 09226000
         L     @15,GDTCLS(,@05)                                    1713 09227000
         LA    @01,@AL00001                                        1713 09228000
         BALR  @14,@15                                             1713 09229000
*              MRIOCSSR(2) = NULLPTR;                              1714 09230000
*                                                                  1714 09231000
         L     @05,@PC00016+4                                      1714 09232000
         SLR   @15,@15                                             1714 09233000
         ST    @15,MRIOCSSR+4(,@05)                                1714 09234000
*              CALL OPENPROC ('M',MRIOCSSR(2),NULLPTR,MRIOINPT(2));     09235000
*                                                                  1715 09236000
         LA    @15,@CC00744                                        1715 09237000
         ST    @15,@AL00001                                        1715 09238000
         LA    @05,MRIOCSSR+4(,@05)                                1715 09239000
         ST    @05,@AL00001+4                                      1715 09240000
         LA    @05,@CF00116                                        1715 09241000
         ST    @05,@AL00001+8                                      1715 09242000
         L     @05,@PC00016+8                                      1715 09243000
         LA    @05,MRIOINPT+4(,@05)                                1715 09244000
         ST    @05,@AL00001+12                                     1715 09245000
         LA    @01,@AL00001                                        1715 09246000
         BAL   @14,OPENPROC                                        1715 09247000
*              RESPECIFY RTNREG RSTD;                              1716 09248000
*              TESTRC = RTNREG;                                    1717 09249000
         LR    TESTRC,RTNREG                                       1717 09250000
*              RESPECIFY RTNREG UNRSTD;                            1718 09251000
*                                                                  1718 09252000
*              IF TESTRC ^= 0                                      1719 09253000
*                THEN                                              1719 09254000
         LTR   TESTRC,TESTRC                                       1719 09255000
         BZ    @RF01719                                            1719 09256000
*                  RETURN CODE(LASTCC08);                          1720 09257000
*                                                                  1720 09258000
         LA    @15,8                                               1720 09259000
         L     @14,@SA00016                                        1720 09260000
         LM    @00,@12,@SA00016+8                                  1720 09261000
         BR    @14                                                 1720 09262000
*              END;                                                1721 09263000
*                                                                  1721 09264000
@RF01719 DS    0H                                                  1722 09265000
*        /************************************************************/ 09266000
*        /*                                                          */ 09267000
*        /* THIS IS THE END OF THE MERGE LOOP.  WHEN ALL MERGE       */ 09268000
*        /* PASSES HAVE BEEN COMPLETED, RETURN TO THE CALLING        */ 09269000
*        /* PROCEDURE (CNTLPROC).                                    */ 09270000
*        /*                                                          */ 09271000
*        /************************************************************/ 09272000
*                                                                  1722 09273000
*        END MERGLP;                                               1722 09274000
*                                                                  1722 09275000
@RF01710 DS    0H                                                  1722 09276000
@DE01485 TM    MERGEND,B'10000000'                                 1722 09277000
         BZ    @DL01485                                            1722 09278000
*        RETURN CODE(LASTCC00);                                    1723 09279000
         SLR   @15,@15                                             1723 09280000
         L     @14,@SA00016                                        1723 09281000
         LM    @00,@12,@SA00016+8                                  1723 09282000
         BR    @14                                                 1723 09283000
*        /************************************************************/ 09284000
*        /*                                                          */ 09285000
*        /* PROCEDURE NAME - TREEADD                                 */ 09286000
*        /*                                                          */ 09287000
*        /* FUNCTION - THIS PROCEDURE, WHICH IS INTERNAL TO          */ 09288000
*        /*            MERGPROC, ADDS A RECORD TO THE TREE.  THE     */ 09289000
*        /*            TREE IS MADE UP OF NODES WITH A SINGLE NODE   */ 09290000
*        /*            AT THE TOP.  EACH PARENT NODE HAS TWO CHILD   */ 09291000
*        /*            NODES AND THE TREE IS BUILT SO THAT THE       */ 09292000
*        /*            RECORD REPRESENTED BY THE PARENT NODE IS      */ 09293000
*        /*            LOWER IN VALUE THAN EITHER CHILD.  AS THE     */ 09294000
*        /*            TREE ADD LOOP STARTS THE SIZE OF THE TREE     */ 09295000
*        /*            IS INCREASED BY 1 THUS LEAVING AN EMPTY SLOT  */ 09296000
*        /*            AT THE BOTTOM.  THE PARENT OF THE EMPTY SLOT  */ 09297000
*        /*            IS ESTABLISHED AND IF THE NEW RECORD IS       */ 09298000
*        /*            HIGHER THAN THE PARENT, IT GOES INTO THE      */ 09299000
*        /*            EMPTY SLOT AT THE BOTTOM.  HOWEVER, IF THE    */ 09300000
*        /*            NEW RECORD IS LOWER, THE PARENT IS MOVED DOWN */ 09301000
*        /*            LEAVING AN EMPTY SLOT.  THE PARENT OF THE     */ 09302000
*        /*            NEW EMPTY SLOT IS ESTABLISHED AND THE PROCESS */ 09303000
*        /*            CONTINUES UNTIL THE NEW RECORD IS FOUND TO    */ 09304000
*        /*            BE HIGHER THAN THE PARENT AT WHICH TIME IT    */ 09305000
*        /*            GOES INTO THE EMPTY CHILD SLOT.  IF THE       */ 09306000
*        /*            PARENT IS MOVED FROM THE TOP OF THE TREE,     */ 09307000
*        /*            THE NEW RECORD GOES THERE AND THE PROCESS     */ 09308000
*        /*            STOPS.                                        */ 09309000
*        /*                                                          */ 09310000
*        /************************************************************/ 09311000
*                                                                  1724 09312000
*TREEADD:                                                          1724 09313000
*        PROCEDURE;                                                1724 09314000
*                                                                  1724 09315000
TREEADD  STM   @14,@02,12(@13)                                     1724 09316000
         ST    @04,36(,@13)                                        1724 09317000
         STM   @06,@12,44(@13)                                     1724 09318000
*        TSIZE = TSIZE + 1;                                        1725 09319000
         AL    TSIZE,@CF00220                                      1725 09320000
*        TPREV = TSIZE;                                            1726 09321000
         LR    TPREV,TSIZE                                         1726 09322000
*        TCURR = TSIZE / 2;                                        1727 09323000
*                                                                  1727 09324000
         LR    @00,TSIZE                                           1727 09325000
         SRDA  @00,32                                              1727 09326000
         D     @00,@CF00154                                        1727 09327000
         LR    TCURR,@01                                           1727 09328000
*        IF SRTRECSZ <= MVCMLIM                                    1728 09329000
*          THEN                                                    1728 09330000
         LH    @15,SRTRECSZ                                        1728 09331000
         C     @15,@CF00925                                        1728 09332000
         BH    @RF01728                                            1728 09333000
*            DO WHILE TCURR > 0;                                   1729 09334000
*                                                                  1729 09335000
         B     @DE01729                                            1729 09336000
@DL01729 DS    0H                                                  1730 09337000
*            IF MTPTR(TCURR) -> MRSRTREC(1:SRTRECSZ) >             1730 09338000
*               TRECORD -> MRSRTREC(1:SRTRECSZ)                    1730 09339000
*              THEN                                                1730 09340000
         LR    @15,TCURR                                           1730 09341000
         SLA   @15,4                                               1730 09342000
         LR    @14,TREEPTR                                         1730 09343000
         AL    @14,@CF01721                                        1730 09344000
         L     @01,MTPTR-8(@15,@14)                                1730 09345000
         LH    @14,SRTRECSZ                                        1730 09346000
         BCTR  @14,0                                               1730 09347000
         L     @07,TRECORD                                         1730 09348000
         EX    @14,@SC01739                                        1730 09349000
         BNH   @RF01730                                            1730 09350000
*                DO;                                               1731 09351000
*                                                                  1731 09352000
*                MERGTREE(TPREV) = MERGTREE(TCURR);                1732 09353000
         LR    @14,TPREV                                           1732 09354000
         SLA   @14,4                                               1732 09355000
         ALR   @14,TREEPTR                                         1732 09356000
         AL    @14,@CF01669                                        1732 09357000
         ALR   @15,TREEPTR                                         1732 09358000
         AL    @15,@CF01669                                        1732 09359000
         MVC   @TS00001(16),MERGTREE(@15)                          1732 09360000
         MVC   MERGTREE(16,@14),@TS00001                           1732 09361000
*                TPREV = TCURR;                                    1733 09362000
         LR    TPREV,TCURR                                         1733 09363000
*                TCURR = TPREV / 2;                                1734 09364000
*                                                                  1734 09365000
         LR    @00,TPREV                                           1734 09366000
         SRDA  @00,32                                              1734 09367000
         D     @00,@CF00154                                        1734 09368000
         LR    TCURR,@01                                           1734 09369000
*                END;                                              1735 09370000
*                                                                  1735 09371000
*              ELSE                                                1736 09372000
*                TCURR = 0;                                        1736 09373000
         B     @RC01730                                            1736 09374000
@RF01730 SLR   TCURR,TCURR                                         1736 09375000
*            END;                                                  1737 09376000
*                                                                  1737 09377000
@RC01730 DS    0H                                                  1737 09378000
@DE01729 LTR   TCURR,TCURR                                         1737 09379000
         BP    @DL01729                                            1737 09380000
*          ELSE                                                    1738 09381000
*            DO WHILE TCURR > 0;                                   1738 09382000
*                                                                  1738 09383000
         B     @RC01728                                            1738 09384000
@RF01728 B     @DE01738                                            1738 09385000
@DL01738 DS    0H                                                  1739 09386000
*            IF (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) >             1739 09387000
*                TRECORD -> MRSRTREC(1:MVCMLIM)) |                 1739 09388000
*                                                                  1739 09389000
*               (MTPTR(TCURR) -> MRSRTREC(1:MVCMLIM) =             1739 09390000
*                TRECORD -> MRSRTREC(1:MVCMLIM) &                  1739 09391000
*                MTPTR(TCURR) -> MRSRTREC(MVCMLIM + 1:SRTRECSZ) >  1739 09392000
*                TRECORD -> MRSRTREC(MVCMLIM + 1:SRTRECSZ))        1739 09393000
*              THEN                                                1739 09394000
         LR    @15,TCURR                                           1739 09395000
         SLA   @15,4                                               1739 09396000
         AL    @15,@CF01721                                        1739 09397000
         L     @15,MTPTR-8(@15,TREEPTR)                            1739 09398000
         L     @14,TRECORD                                         1739 09399000
         CLC   MRSRTREC(256,@15),MRSRTREC(@14)                     1739 09400000
         BH    @RT01739                                            1739 09401000
         CLC   MRSRTREC(256,@15),MRSRTREC(@14)                     1739 09402000
         BNE   @RF01739                                            1739 09403000
         LH    @07,SRTRECSZ                                        1739 09404000
         SL    @07,@CF01651                                        1739 09405000
         EX    @07,@SC01737                                        1739 09406000
         BNH   @RF01739                                            1739 09407000
@RT01739 DS    0H                                                  1740 09408000
*                DO;                                               1740 09409000
*                                                                  1740 09410000
*                MERGTREE(TPREV) = MERGTREE(TCURR);                1741 09411000
         LR    @15,TPREV                                           1741 09412000
         SLA   @15,4                                               1741 09413000
         ALR   @15,TREEPTR                                         1741 09414000
         AL    @15,@CF01669                                        1741 09415000
         LR    @14,TCURR                                           1741 09416000
         SLA   @14,4                                               1741 09417000
         ALR   @14,TREEPTR                                         1741 09418000
         AL    @14,@CF01669                                        1741 09419000
         MVC   @TS00001(16),MERGTREE(@14)                          1741 09420000
         MVC   MERGTREE(16,@15),@TS00001                           1741 09421000
*                TPREV = TCURR;                                    1742 09422000
         LR    TPREV,TCURR                                         1742 09423000
*                TCURR = TPREV / 2;                                1743 09424000
*                                                                  1743 09425000
         LR    @00,TPREV                                           1743 09426000
         SRDA  @00,32                                              1743 09427000
         D     @00,@CF00154                                        1743 09428000
         LR    TCURR,@01                                           1743 09429000
*                END;                                              1744 09430000
*                                                                  1744 09431000
*              ELSE                                                1745 09432000
*                TCURR = 0;                                        1745 09433000
         B     @RC01739                                            1745 09434000
@RF01739 SLR   TCURR,TCURR                                         1745 09435000
*            END;                                                  1746 09436000
*                                                                  1746 09437000
@RC01739 DS    0H                                                  1746 09438000
@DE01738 LTR   TCURR,TCURR                                         1746 09439000
         BP    @DL01738                                            1746 09440000
*END TREEADD;                                                      1747 09441000
@EL00017 DS    0H                                                  1747 09442000
@EF00017 DS    0H                                                  1747 09443000
@ER00017 LM    @14,@02,12(@13)                                     1747 09444000
         L     @04,36(,@13)                                        1747 09445000
         LM    @06,@12,44(@13)                                     1747 09446000
         BR    @14                                                 1747 09447000
*        /************************************************************/ 09448000
*        /*                                                          */ 09449000
*        /* PROCEDURE NAME - RECOUT                                  */ 09450000
*        /*                                                          */ 09451000
*        /* FUNCTION - THIS PROCEDURE, WHICH IS INTERNAL TO          */ 09452000
*        /*            MERGPROC, OUTPUTS A SORT RECORD.  IF THIS     */ 09453000
*        /*            IS THE LAST MERGE PASS, THE RECORD IS         */ 09454000
*        /*            PASSED TO BLDPROC.  OTHERWISE, THE RECORD     */ 09455000
*        /*            IS MOVED TO THE OUTPUT BUFFER.  IF THE        */ 09456000
*        /*            OUTPUT BUFFER IS FILLED, IT IS WRITTEN OUT.   */ 09457000
*        /*                                                          */ 09458000
*        /************************************************************/ 09459000
*                                                                  1748 09460000
*RECOUT:                                                           1748 09461000
*        PROCEDURE;                                                1748 09462000
*                                                                  1748 09463000
RECOUT   STM   @14,@12,@SA00018                                    1748 09464000
*        IF MERGEND = ON                                           1749 09465000
*          THEN                                                    1749 09466000
         TM    MERGEND,B'10000000'                                 1749 09467000
         BNO   @RF01749                                            1749 09468000
*            DO;                                                   1750 09469000
*                                                                  1750 09470000
*            CALL BLDPROC (TRECORD,MERGAMDS,MERGIOCS,              1751 09471000
*                          MERGSRTB,MERGSTAT);                     1751 09472000
*                                                                  1751 09473000
         LA    @15,TRECORD                                         1751 09474000
         ST    @15,@AL00001                                        1751 09475000
         L     @15,@PC00016                                        1751 09476000
         ST    @15,@AL00001+4                                      1751 09477000
         L     @15,@PC00016+4                                      1751 09478000
         ST    @15,@AL00001+8                                      1751 09479000
         L     @15,@PC00016+12                                     1751 09480000
         ST    @15,@AL00001+12                                     1751 09481000
         L     @15,@PC00016+16                                     1751 09482000
         ST    @15,@AL00001+16                                     1751 09483000
         LA    @01,@AL00001                                        1751 09484000
         BAL   @14,BLDPROC                                         1751 09485000
*            RESPECIFY RTNREG RSTD;                                1752 09486000
*            TESTRC = RTNREG;                                      1753 09487000
         LR    TESTRC,RTNREG                                       1753 09488000
*            RESPECIFY RTNREG UNRSTD;                              1754 09489000
*                                                                  1754 09490000
*            IF TESTRC ^= 0                                        1755 09491000
*              THEN                                                1755 09492000
         LTR   TESTRC,TESTRC                                       1755 09493000
         BZ    @RF01755                                            1755 09494000
*                RETURN CODE(LASTCC08);                            1756 09495000
*                                                                  1756 09496000
         LA    @15,8                                               1756 09497000
         L     @14,@SA00018                                        1756 09498000
         LM    @00,@12,@SA00018+8                                  1756 09499000
         BR    @14                                                 1756 09500000
*            END;                                                  1757 09501000
*                                                                  1757 09502000
*          ELSE                                                    1758 09503000
*NOTLAST:    DO;                                                   1758 09504000
*                                                                  1758 09505000
         B     @RC01749                                            1758 09506000
@RF01749 DS    0H                                                  1758 09507000
NOTLAST  DS    0H                                                  1759 09508000
*            IF SRTRECSZ <= MVCMLIM                                1759 09509000
*              THEN                                                1759 09510000
         LH    @15,SRTRECSZ                                        1759 09511000
         C     @15,@CF00925                                        1759 09512000
         BH    @RF01759                                            1759 09513000
*                OUTRECAR(OUTBUFST:OUTBUFEN) =                     1760 09514000
*                  TRECORD -> MRSRTREC(1:SRTRECSZ);                1760 09515000
*                                                                  1760 09516000
         LH    @15,OUTBUFST                                        1760 09517000
         L     @01,OUTBUFPT                                        1760 09518000
         ALR   @01,@15                                             1760 09519000
         BCTR  @01,0                                               1760 09520000
         LCR   @15,@15                                             1760 09521000
         AH    @15,OUTBUFEN                                        1760 09522000
         L     @14,TRECORD                                         1760 09523000
         EX    @15,@SM01741                                        1760 09524000
*              ELSE                                                1761 09525000
*                DO;                                               1761 09526000
*                                                                  1761 09527000
         B     @RC01759                                            1761 09528000
@RF01759 DS    0H                                                  1762 09529000
*                OUTRECAR(OUTBUFST:MVCMLIM) =                      1762 09530000
*                  TRECORD -> MRSRTREC(1:MVCMLIM);                 1762 09531000
         L     @15,OUTBUFPT                                        1762 09532000
         LH    @14,OUTBUFST                                        1762 09533000
         ALR   @14,@15                                             1762 09534000
         BCTR  @14,0                                               1762 09535000
         LA    @07,256                                             1762 09536000
         LH    @06,OUTBUFST                                        1762 09537000
         LR    @05,@07                                             1762 09538000
         SLR   @05,@06                                             1762 09539000
         L     @04,TRECORD                                         1762 09540000
         EX    @05,@SM01743                                        1762 09541000
*                OUTRECAR(OUTBUFST + MVCMLIM:OUTBUFEN) =           1763 09542000
*                  TRECORD -> MRSRTREC(MVCMLIM + 1:SRTRECSZ);      1763 09543000
*                                                                  1763 09544000
         ALR   @15,@06                                             1763 09545000
         LCR   @06,@06                                             1763 09546000
         AH    @06,OUTBUFEN                                        1763 09547000
         SLR   @06,@07                                             1763 09548000
         EX    @06,@SM01745                                        1763 09549000
*                END;                                              1764 09550000
*                                                                  1764 09551000
*            OUTBUFCT = OUTBUFCT + 1;                              1765 09552000
@RC01759 LA    @15,1                                               1765 09553000
         LH    @14,OUTBUFCT                                        1765 09554000
         ALR   @14,@15                                             1765 09555000
         STH   @14,OUTBUFCT                                        1765 09556000
*            OUTBUFST = OUTBUFEN + 1;                              1766 09557000
         LH    @07,OUTBUFEN                                        1766 09558000
         ALR   @07,@15                                             1766 09559000
         STH   @07,OUTBUFST                                        1766 09560000
*            OUTBUFEN = OUTBUFST - 1 + SRTRECSZ;                   1767 09561000
         BCTR  @07,0                                               1767 09562000
         AH    @07,SRTRECSZ                                        1767 09563000
         STH   @07,OUTBUFEN                                        1767 09564000
*            SRTRCLSO = SRTRCLSO + 1;                              1768 09565000
*                                                                  1768 09566000
         AL    @15,SRTRCLSO                                        1768 09567000
         ST    @15,SRTRCLSO                                        1768 09568000
*            IF OUTBUFCT = SRTRECBK                                1769 09569000
*              THEN                                                1769 09570000
         CH    @14,SRTRECBK                                        1769 09571000
         BNE   @RF01769                                            1769 09572000
*PUTMERG:        DO;                                               1770 09573000
*                                                                  1770 09574000
PUTMERG  DS    0H                                                  1771 09575000
*                CALL IDCIOPT0 (GDTTBL,MRIOCSSR(2));               1771 09576000
*                                                                  1771 09577000
         L     @02,@PC00001                                        1771 09578000
         ST    @02,@AL00001                                        1771 09579000
         L     @15,@PC00016+4                                      1771 09580000
         LA    @15,MRIOCSSR+4(,@15)                                1771 09581000
         ST    @15,@AL00001+4                                      1771 09582000
         MVI   @AL00001+4,X'80'                                    1771 09583000
         L     @15,GDTPUT(,@02)                                    1771 09584000
         LA    @01,@AL00001                                        1771 09585000
         BALR  @14,@15                                             1771 09586000
*                RESPECIFY RTNREG RSTD;                            1772 09587000
*                TESTRC = RTNREG;                                  1773 09588000
         LR    TESTRC,RTNREG                                       1773 09589000
*                RESPECIFY RTNREG UNRSTD;                          1774 09590000
*                                                                  1774 09591000
*                IF TESTRC ^= 0                                    1775 09592000
*                  THEN                                            1775 09593000
         LTR   TESTRC,TESTRC                                       1775 09594000
         BZ    @RF01775                                            1775 09595000
*                    RETURN CODE (LASTCC08);                       1776 09596000
*                                                                  1776 09597000
         LA    @15,8                                               1776 09598000
         L     @14,@SA00018                                        1776 09599000
         LM    @00,@12,@SA00018+8                                  1776 09600000
         BR    @14                                                 1776 09601000
*                IOCSPTR  = MRIOCSSR(2);                           1777 09602000
@RF01775 L     @15,@PC00016+4                                      1777 09603000
         L     IOCSPTR,MRIOCSSR+4(,@15)                            1777 09604000
*                IOCDAD   = 0;                                     1778 09605000
         SLR   @03,@03                                             1778 09606000
         ST    @03,IOCDAD(,IOCSPTR)                                1778 09607000
*                OUTBUFCT = 0;                                     1779 09608000
         STH   @03,OUTBUFCT                                        1779 09609000
*                OUTBUFST = 1;                                     1780 09610000
         MVC   OUTBUFST(2),@CH00220                                1780 09611000
*                OUTBUFEN = SRTRECSZ;                              1781 09612000
*                                                                  1781 09613000
         LH    @14,SRTRECSZ                                        1781 09614000
         STH   @14,OUTBUFEN                                        1781 09615000
*                /****************************************************/ 09616000
*                /*                                                  */ 09617000
*                /* THE FIRST PUT UPDATE AGAINST A WORK FILE WHICH   */ 09618000
*                /* HAS PREVIOUSLY BEEN PROCESSED WITH GET UPDATE    */ 09619000
*                /* WILL GO IN THE RECORD POSITION OF THE LAST GET.  */ 09620000
*                /* THEREFORE, A SECOND PUT IS ISSUED FOR THE FIRST  */ 09621000
*                /* RECORD TO WRITE IT AT THE ZERO RBA LOCATION.     */ 09622000
*                /*                                                  */ 09623000
*                /****************************************************/ 09624000
*                                                                  1782 09625000
*                IF MERGSTRT = OFF                                 1782 09626000
*                  THEN                                            1782 09627000
         TM    MERGSTRT,B'01000000'                                1782 09628000
         BNZ   @RF01782                                            1782 09629000
*                    DO;                                           1783 09630000
*                                                                  1783 09631000
*                    IF IOCRBA = 0                                 1784 09632000
*                     THEN                                         1784 09633000
         C     @03,IOCRBA(,IOCSPTR)                                1784 09634000
         BNE   @RF01784                                            1784 09635000
*                        DO;                                       1785 09636000
*                                                                  1785 09637000
*                        CALL IDCIOPT0 (GDTTBL,MRIOCSSR(2));       1786 09638000
*                                                                  1786 09639000
         L     @14,@PC00001                                        1786 09640000
         ST    @14,@AL00001                                        1786 09641000
         LA    @15,MRIOCSSR+4(,@15)                                1786 09642000
         ST    @15,@AL00001+4                                      1786 09643000
         MVI   @AL00001+4,X'80'                                    1786 09644000
         L     @15,GDTPUT(,@14)                                    1786 09645000
         LA    @01,@AL00001                                        1786 09646000
         BALR  @14,@15                                             1786 09647000
*                        RESPECIFY RTNREG RSTD;                    1787 09648000
*                        TESTRC = RTNREG;                          1788 09649000
         LR    TESTRC,RTNREG                                       1788 09650000
*                        RESPECIFY RTNREG UNRSTD;                  1789 09651000
*                                                                  1789 09652000
*                        IF TESTRC ^= 0                            1790 09653000
*                          THEN                                    1790 09654000
         LTR   TESTRC,TESTRC                                       1790 09655000
         BZ    @RF01790                                            1790 09656000
*                            RETURN CODE(LASTCC08);                1791 09657000
*                                                                  1791 09658000
         LA    @15,8                                               1791 09659000
         L     @14,@SA00018                                        1791 09660000
         LM    @00,@12,@SA00018+8                                  1791 09661000
         BR    @14                                                 1791 09662000
*                        IOCDAD = 0;                               1792 09663000
*                                                                  1792 09664000
@RF01790 SLR   @03,@03                                             1792 09665000
         ST    @03,IOCDAD(,IOCSPTR)                                1792 09666000
*                        END;                                      1793 09667000
*                                                                  1793 09668000
*                    IOCRBA  = IOCRBA + BLKSIZE;                   1794 09669000
*                                                                  1794 09670000
@RF01784 LA    @03,2048                                            1794 09671000
         AL    @03,IOCRBA(,IOCSPTR)                                1794 09672000
         ST    @03,IOCRBA(,IOCSPTR)                                1794 09673000
*                    END;                                          1795 09674000
*                                                                  1795 09675000
*                END PUTMERG;                                      1796 09676000
*                                                                  1796 09677000
@RF01782 DS    0H                                                  1797 09678000
*            END NOTLAST;                                          1797 09679000
*                                                                  1797 09680000
@RF01769 DS    0H                                                  1798 09681000
*        /************************************************************/ 09682000
*        /*                                                          */ 09683000
*        /* DETERMINE IF WE HAVE REACHED THE END OF A STRING AND,    */ 09684000
*        /* IF SO, ZERO THE NEXT RECORD AREA.                        */ 09685000
*        /*                                                          */ 09686000
*        /************************************************************/ 09687000
*                                                                  1798 09688000
*        IF NXSTGNO = STRGLIM                                      1798 09689000
*          THEN                                                    1798 09690000
@RC01749 CLC   NXSTGNO(2),STRGLIM                                  1798 09691000
         BNE   @RF01798                                            1798 09692000
*            IF NXBLKREC = STRLAST                                 1799 09693000
*              THEN                                                1799 09694000
         CLC   NXBLKREC(4),STRLAST                                 1799 09695000
         BNE   @RF01799                                            1799 09696000
*                DO;                                               1800 09697000
*                                                                  1800 09698000
*                RBAHOLD = NXRBA;                                  1801 09699000
         L     @15,NXRBA                                           1801 09700000
         ST    @15,RBAHOLD                                         1801 09701000
*                NEXTREC = ''B;                                    1802 09702000
*                                                                  1802 09703000
         XC    NEXTREC(16),NEXTREC                                 1802 09704000
*                END;                                              1803 09705000
*                                                                  1803 09706000
*              ELSE;                                               1804 09707000
*                                                                  1804 09708000
@RF01799 DS    0H                                                  1805 09709000
*          ELSE                                                    1805 09710000
*            IF NXBLKREC = STRNLAST                                1805 09711000
*              THEN                                                1805 09712000
         B     @RC01798                                            1805 09713000
@RF01798 CLC   NXBLKREC(4),STRNLAST                                1805 09714000
         BNE   @RF01805                                            1805 09715000
*                NEXTREC = ''B;                                    1806 09716000
*                                                                  1806 09717000
         XC    NEXTREC(16),NEXTREC                                 1806 09718000
*              ELSE;                                               1807 09719000
*                                                                  1807 09720000
@RF01805 DS    0H                                                  1808 09721000
*        RETURN CODE(LASTCC00);                                    1808 09722000
*                                                                  1808 09723000
@RC01798 SLR   @15,@15                                             1808 09724000
         L     @14,@SA00018                                        1808 09725000
         LM    @00,@12,@SA00018+8                                  1808 09726000
         BR    @14                                                 1808 09727000
*END RECOUT;                                                       1809 09728000
*END MERGPROC;                                                     1810 09729000
*END IDCBI01                                                       1811 09730000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 09731000
*/*%INCLUDE SYSLIB  (AMSDF01 )                                        * 09732000
*/*%INCLUDE SYSLIB  (AMSDF00 )                                        * 09733000
*/*@INCLUDE SYSLIB  (AMSDF02 )                                        * 09734000
*/*%INCLUDE SYSLIB  (IDCCSBI )                                        * 09735000
*/*%INCLUDE SYSLIB  (IEZCTGPL)                                        * 09736000
*/*%INCLUDE SYSLIB  (IEZCTGFL)                                        * 09737000
*/*%INCLUDE SYSLIB  (IDAAMDSB)                                        * 09738000
*/*%INCLUDE SYSLIB  (IEZCTGFV)                                        * 09739000
*/*%INCLUDE SYSLIB  (IDAAIR  )                                        * 09740000
*;                                                                 1811 09741000
@DATA    DS    0H                                                       09742000
@CH00037 DC    H'10'                                                    09743000
@CH01639 DC    H'18'                                                    09744000
@CH00596 DC    H'44'                                                    09745000
@CH01640 DC    H'66'                                                    09746000
@CH01647 DC    H'94'                                                    09747000
@CH01644 DC    H'113'                                                   09748000
@CH01518 DC    H'32767'                                                 09749000
@SC01690 CLC   RSAREC(0,@01),RSAREC(@15)                                09750000
@SC01692 CLC   RSAREC(0,@01),RSAREC(@14)                                09751000
@SC01694 CLC   RSAREC+256(0,@07),RSAREC+256(@06)                        09752000
@SC01696 CLC   RSAREC+256(0,@15),RSAREC+256(@14)                        09753000
@SM01698 MVC   SAVEKEY(0),BASEREC(@01)                                  09754000
@SM01700 MVC   RSAREC(0,@05),BASEREC(@01)                               09755000
@SM01702 MVC   RSAREC(0,@05),BASEREC(@14)                               09756000
@SM01704 MVC   RSAREC(0,@03),CHARRBA(IOCSPTR)                           09757000
@SM01706 MVC   SPSRTREC(0,SPRECPTR),RSAREC(@07)                         09758000
@SM01708 MVC   SPSRTREC+256(0,SPRECPTR),RSAREC+256(@07)                 09759000
@SM01711 MVC   AIXKY(0,@05),BLSRTREC(@01)                               09760000
@SC01713 CLC   BLSRTREC(0,@05),AIXKY(@03)                               09761000
@SX01715 XC    AIXREC(0,@14),AIXREC(@14)                                09762000
@SM01717 MVC   AIXKY(0,@15),BLSRTREC(@03)                               09763000
@SM01719 MVC   AIXREC(0,@05),@TS00001                                   09764000
@SC01724 CLC   MRSRTREC(0,@01),MRSRTREC(@15)                            09765000
@SC01726 CLC   MRSRTREC+256(0,@14),MRSRTREC+256(@15)                    09766000
@SC01728 CLC   MRSRTREC(0,@02),MRSRTREC(@01)                            09767000
@SC01730 CLC   MRSRTREC+256(0,@07),MRSRTREC+256(@02)                    09768000
@SC01732 CLC   MRSRTREC+256(0,@07),MRSRTREC+256(@15)                    09769000
@SC01735 CLC   MRSRTREC(0,@14),MRSRTREC(@01)                            09770000
@SC01737 CLC   MRSRTREC+256(0,@15),MRSRTREC+256(@14)                    09771000
@SC01739 CLC   MRSRTREC(0,@01),MRSRTREC(@07)                            09772000
@SM01741 MVC   OUTRECAR(0,@01),MRSRTREC(@14)                            09773000
@SM01743 MVC   OUTRECAR(0,@14),MRSRTREC(@04)                            09774000
@SM01745 MVC   OUTRECAR+255(0,@15),MRSRTREC+256(@04)                    09775000
         DS    0F                                                       09776000
@AL00210 DC    A(@CC00738)             LIST WITH   4 ARGUMENT(S)        09777000
         DS    F                                                        09778000
         DC    A(@CF00116)                                              09779000
         DC    A(@CF00116)                                              09780000
@AL00562 DC    A(UGPID01)              LIST WITH   2 ARGUMENT(S)        09781000
         DC    AL1(X'80')                                               09782000
         DC    AL3(ALL)                                                 09783000
@DATD    DSECT                                                          09784000
         DS    0F                                                       09785000
@SA00001 DS    18F                                                      09786000
@PC00001 DS    3F                                                       09787000
@SA00002 DS    15F                                                      09788000
@PC00002 DS    4F                                                       09789000
@SA00003 DS    15F                                                      09790000
@PC00003 DS    1F                                                       09791000
@SA00004 DS    15F                                                      09792000
@PC00004 DS    5F                                                       09793000
@SA00005 DS    15F                                                      09794000
@PC00005 DS    2F                                                       09795000
@SA00006 DS    15F                                                      09796000
@PC00006 DS    3F                                                       09797000
@SA00007 DS    15F                                                      09798000
@PC00007 DS    4F                                                       09799000
@SA00011 DS    15F                                                      09800000
@PC00011 DS    5F                                                       09801000
@SA00012 DS    15F                                                      09802000
@PC00012 DS    5F                                                       09803000
@SA00010 DS    15F                                                      09804000
@PC00010 DS    1F                                                       09805000
@SA00008 DS    15F                                                      09806000
@PC00008 DS    6F                                                       09807000
@SA00009 DS    15F                                                      09808000
@PC00009 DS    5F                                                       09809000
@SA00013 DS    15F                                                      09810000
@PC00013 DS    6F                                                       09811000
@SA00016 DS    15F                                                      09812000
@PC00016 DS    5F                                                       09813000
@SA00015 DS    15F                                                      09814000
@PC00015 DS    5F                                                       09815000
@SA00014 DS    15F                                                      09816000
@PC00014 DS    4F                                                       09817000
@SA00018 DS    15F                                                      09818000
@AL00001 DS    6A                                                       09819000
@TF00001 DS    F                                                        09820000
IDCBI01  CSECT                                                          09821000
         DS    0F                                                       09822000
@CF00116 DC    F'0'                                                     09823000
@CF00220 DC    F'1'                                                     09824000
@CH00220 EQU   @CF00220+2                                               09825000
@CF00154 DC    F'2'                                                     09826000
@CH00154 EQU   @CF00154+2                                               09827000
@CF00163 DC    F'3'                                                     09828000
@CH00163 EQU   @CF00163+2                                               09829000
@CF00043 DC    F'4'                                                     09830000
@CH00043 EQU   @CF00043+2                                               09831000
@CF00157 DC    F'6'                                                     09832000
@CH00157 EQU   @CF00157+2                                               09833000
@CF00629 DC    F'7'                                                     09834000
@CF00180 DC    F'8'                                                     09835000
@CH00180 EQU   @CF00180+2                                               09836000
@CF00035 DC    F'12'                                                    09837000
@CH00035 EQU   @CF00035+2                                               09838000
@CF00474 DC    F'16'                                                    09839000
@CF00311 DC    F'24'                                                    09840000
@CF00925 DC    F'256'                                                   09841000
@CF01651 DC    F'257'                                                   09842000
@CF00978 DC    F'2041'                                                  09843000
@CF00976 DC    F'2048'                                                  09844000
@CF01376 DC    F'4096'                                                  09845000
@CF01374 DC    F'32768'                                                 09846000
@CF01372 DC    F'61440'                                                 09847000
@CF01370 DC    F'102400'                                                09848000
@CF01378 DC    F'16777215'                                              09849000
@CF01674 DC    F'-64'                                                   09850000
@CF01675 DC    F'-63'                                                   09851000
@CF01671 DC    F'-54'                                                   09852000
@CF01673 DC    F'-44'                                                   09853000
@CF01672 DC    F'-43'                                                   09854000
@CF01669 DC    F'-16'                                                   09855000
@CF01670 DC    F'-15'                                                   09856000
@CF01722 DC    F'-12'                                                   09857000
@CF01723 DC    F'-10'                                                   09858000
@CF01721 DC    F'-8'                                                    09859000
@CF01668 DC    F'-6'                                                    09860000
@CF01678 DC    F'-4'                                                    09861000
@CF00878 DC    XL4'E4E5F001'                                            09862000
@CF00880 DC    XL4'E4E5F003'                                            09863000
@CF00882 DC    XL4'E4E5F00F'                                            09864000
@CF00890 DC    XL4'C2C9F004'                                            09865000
@CF00892 DC    XL4'C2C9F005'                                            09866000
@CF00894 DC    XL4'C2C9F006'                                            09867000
@CF00896 DC    XL4'C2C9F007'                                            09868000
@CF00900 DC    XL4'C2C9F009'                                            09869000
@CF00906 DC    XL4'C2C9F00C'                                            09870000
@CF00908 DC    XL4'C2C9F00D'                                            09871000
@CF00910 DC    XL4'C2C9F00E'                                            09872000
@CF00912 DC    XL4'C2C9F00F'                                            09873000
@CF00916 DC    XL4'C2C9F011'                                            09874000
@CF00918 DC    XL4'C2C9F012'                                            09875000
@CF00920 DC    XL4'C2C9F013'                                            09876000
@DATD    DSECT                                                          09877000
         DS    0D                                                       09878000
LISTSCAN DS    A                                                        09879000
DDSTRU   DS    A                                                        09880000
FSADDR   DS    A                                                        09881000
ERCNVADR DS    A                                                        09882000
DMPINDEX DS    A                                                        09883000
CTGPLPTR DS    A                                                        09884000
I        DS    F                                                        09885000
OUTBUFPT DS    A                                                        09886000
QDSNPTR  DS    A                                                        09887000
QCATPTR  DS    A                                                        09888000
QDSNPSWD DS    A                                                        09889000
CATACBPT DS    A                                                        09890000
VS       DS    F                                                        09891000
WKASIZE  DS    F                                                        09892000
SORTCORE DS    F                                                        09893000
SORTK    DS    A                                                        09894000
SP2      DS    F                                                        09895000
IOCDADSV DS    A                                                        09896000
M        DS    F                                                        09897000
RBAHOLD  DS    F                                                        09898000
MRNLAST  DS    FL4                                                      09899000
         ORG   MRNLAST                                                  09900000
MRNLBLK  DS    FL2                                                      09901000
MRNLREC  DS    FL2                                                      09902000
         ORG   MRNLAST+4                                                09903000
MRLAST   DS    FL4                                                      09904000
         ORG   MRLAST                                                   09905000
MRLBLK   DS    FL2                                                      09906000
MRLREC   DS    FL2                                                      09907000
         ORG   MRLAST+4                                                 09908000
STRNLAST DS    FL4                                                      09909000
         ORG   STRNLAST                                                 09910000
STRNLBLK DS    FL2                                                      09911000
STRNLREC DS    FL2                                                      09912000
         ORG   STRNLAST+4                                               09913000
STRLAST  DS    FL4                                                      09914000
         ORG   STRLAST                                                  09915000
STRLBLK  DS    FL2                                                      09916000
STRLREC  DS    FL2                                                      09917000
         ORG   STRLAST+4                                                09918000
TRECORD  DS    A                                                        09919000
LISTPTR  DS    A                                                        09920000
CATRETCC DS    H                                                        09921000
QDSNLEN  DS    H                                                        09922000
STATLEN  DS    H                                                        09923000
STRGCTR  DS    H                                                        09924000
STRGLIM  DS    H                                                        09925000
OUTBUFCT DS    H                                                        09926000
OUTBUFST DS    H                                                        09927000
OUTBUFEN DS    H                                                        09928000
TREC1    DS    H                                                        09929000
LISTLN   DS    FL1                                                      09930000
@TS00001 DS    CL256                                                    09931000
         DS    CL1                                                      09932000
STATCOMM DS    CL6                                                      09933000
         ORG   STATCOMM                                                 09934000
SAVERC   DS    FL2                                                      09935000
STATSTID DS    CL4                                                      09936000
         ORG   STATSTID                                                 09937000
STATMOD  DS    CL3                                                      09938000
STATENT  DS    AL1                                                      09939000
         ORG   STATCOMM+6                                               09940000
         DS    CL2                                                      09941000
IOCSADDR DS    CL16                                                     09942000
         ORG   IOCSADDR                                                 09943000
IOCSBASE DS    AL4                                                      09944000
IOCSAIX  DS    AL4                                                      09945000
IOCSSORT DS    2A                                                       09946000
         ORG   IOCSADDR+16                                              09947000
DSBAREA  DS    CL192                                                    09948000
         ORG   DSBAREA                                                  09949000
DSBBAREA DS    CL96                                                     09950000
DSBAAREA DS    CL96                                                     09951000
         ORG   DSBAREA+192                                              09952000
DSBADDR  DS    CL8                                                      09953000
         ORG   DSBADDR                                                  09954000
DSBBASE  DS    AL4                                                      09955000
DSBAIX   DS    AL4                                                      09956000
         ORG   DSBADDR+8                                                09957000
DARGAREA DS    CL44                                                     09958000
IOINADDR DS    CL8                                                      09959000
         ORG   IOINADDR                                                 09960000
IOINSWPT DS    2A                                                       09961000
         ORG   IOINADDR+8                                               09962000
SAVEKEY  DS    CL256                                                    09963000
SRTCTLTB DS    CL76                                                     09964000
         ORG   SRTCTLTB                                                 09965000
SRTRECSZ DS    FL2                                                      09966000
SRTRECBK DS    FL2                                                      09967000
SRTBKTOT DS    FL4                                                      09968000
SRTBK10  DS    FL4                                                      09969000
SRTEXCES DS    FL4                                                      09970000
SRTBSCNT DS    FL4                                                      09971000
SRTFLSIZ DS    FL4                                                      09972000
SRTBUFPT DS    AL4                                                      09973000
SRTRSASZ DS    FL4                                                      09974000
SRTRSACP DS    FL4                                                      09975000
SRTRSAPT DS    AL4                                                      09976000
SRTRSABK DS    FL4                                                      09977000
SRTRSACT DS    FL4                                                      09978000
SRTHEAPT DS    AL4                                                      09979000
SRTCURSA DS    AL4                                                      09980000
SRTOSTRG DS    FL4                                                      09981000
SRTISTRG DS    FL4                                                      09982000
SRTRCLSO DS    FL4                                                      09983000
SRTRCNLO DS    FL4                                                      09984000
SRTFLAGS DS    BL2                                                      09985000
         ORG   SRTFLAGS                                                 09986000
SRTFLDEF DS    BL1                                                      09987000
SRTFLEXT EQU   SRTFLAGS+0                                               09988000
SRTFLSTD EQU   SRTFLAGS+0                                               09989000
SRTFLBLD EQU   SRTFLAGS+0                                               09990000
         ORG   SRTCTLTB+74                                              09991000
@NM00073 DS    FL2                                                      09992000
         ORG   SRTCTLTB+76                                              09993000
OPENAREA DS    CL392                                                    09994000
         ORG   OPENAREA                                                 09995000
OPENID   DS    CL8                                                      09996000
OPENLIST DS    CL384                                                    09997000
         ORG   OPENAREA+392                                             09998000
STOPJ    DS    BL1                                                      09999000
SWFDNAME DS    CL8                                                      10000000
UIOINOPT DS    CL1                                                      10001000
FINAIXNM DS    CL44                                                     10002000
ERRTAB   DS    CL32                                                     10003000
         DS    CL2                                                      10004000
WKAPTRS  DS    CL12                                                     10005000
         ORG   WKAPTRS                                                  10006000
WKAENTYP DS    AL4                                                      10007000
WKANAME  DS    AL4                                                      10008000
WKAAMDSB DS    AL4                                                      10009000
         ORG   WKAPTRS+12                                               10010000
BASENAME DS    CL4                                                      10011000
         ORG   BASENAME                                                 10012000
BASEID   DS    CL1                                                      10013000
BASECI   DS    CL3                                                      10014000
         ORG   BASENAME+4                                               10015000
NEXTNAME DS    CL4                                                      10016000
         ORG   NEXTNAME                                                 10017000
NEXTID   DS    CL1                                                      10018000
NEXTCI   DS    CL3                                                      10019000
         ORG   NEXTNAME+4                                               10020000
LOCCPLAR DS    CL144                                                    10021000
         ORG   LOCCPLAR                                                 10022000
LOCCPLID DS    CL8                                                      10023000
LOCCPL   DS    CL28                                                     10024000
LOCFPPTR DS    3A                                                       10025000
LOCFPENT DS    CL16                                                     10026000
@NM00074 DS    CL8                                                      10027000
LOCFPNAM DS    CL16                                                     10028000
@NM00075 DS    CL8                                                      10029000
LOCFPMSC DS    CL16                                                     10030000
@NM00076 DS    CL8                                                      10031000
LOCFPTST DS    CL16                                                     10032000
@NM00077 DS    CL8                                                      10033000
         ORG   LOCCPLAR+144                                             10034000
LOCWKA   DS    CL113                                                    10035000
         ORG   LOCWKA                                                   10036000
LOCWKALN DS    FL2                                                      10037000
LOCWKDLN DS    FL2                                                      10038000
LOCWKDAT DS    CL109                                                    10039000
         ORG   LOCWKA+113                                               10040000
STOPL    DS    BL1                                                      10041000
TIMEODAY DS    CL8                                                      10042000
         DS    CL2                                                      10043000
DELCPLAR DS    CL134                                                    10044000
         ORG   DELCPLAR                                                 10045000
DELCPLID DS    CL8                                                      10046000
DELCPL   DS    CL28                                                     10047000
@NM00078 DS    CL4                                                      10048000
DELWKA   DS    CL94                                                     10049000
         ORG   DELWKA                                                   10050000
DELWKTLN DS    FL2                                                      10051000
DELWKRLN DS    FL2                                                      10052000
DELWK    DS    CL45                                                     10053000
         ORG   DELWK+0                                                  10054000
DELWKTYP DS    CL1                                                      10055000
DELWKNAM DS    CL44                                                     10056000
         ORG   DELCPLAR+134                                             10057000
STOPI    DS    BL1                                                      10058000
FIRSTKEY DS    BL1                                                      10059000
MERGFLAG DS    BL1                                                      10060000
         ORG   MERGFLAG                                                 10061000
MERGEND  DS    BL1                                                      10062000
MERGSTRT EQU   MERGFLAG+0                                               10063000
MERGOUT  EQU   MERGFLAG+0                                               10064000
MERGUPD  EQU   MERGFLAG+0                                               10065000
         ORG   MERGFLAG+1                                               10066000
         DS    CL3                                                      10067000
NEXTREC  DS    CL16                                                     10068000
         ORG   NEXTREC                                                  10069000
NXSTGNO  DS    FL2                                                      10070000
@NM00081 DS    CL2                                                      10071000
NXBLKREC DS    FL4                                                      10072000
         ORG   NXBLKREC                                                 10073000
NXBLKNO  DS    FL2                                                      10074000
NXRECNO  DS    FL2                                                      10075000
         ORG   NEXTREC+8                                                10076000
NXPTR    DS    AL4                                                      10077000
NXRBA    DS    FL4                                                      10078000
         ORG   NEXTREC+16                                               10079000
MTAREA   DS    CL256                                                    10080000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                10081000
@ENDDATD EQU   *                                                        10082000
IDCBI01  CSECT                                                          10083000
         DS    0F                                                       10084000
@SIZDATD DC    AL1(0)                                                   10085000
         DC    AL3(@ENDDATD-@DATD)                                      10086000
         DS    0D                                                       10087000
SWFONE   DC    F'1'                                                     10088000
SWFTWO   DC    F'2'                                                     10089000
NAMEMASK DC    H'3'                                                     10090000
@CC01283 DC    C'LOCATCPL'                                              10091000
@CC01318 DC    C'DEFINCPL'                                              10092000
@CC01319 DC    C'CLSTRFVT'                                              10093000
@CC01343 DC    C'DELETCPL'                                              10094000
@CC01320 DC    C'DATAFVT'                                               10095000
@CC01126 DC    C'OPNAGL'                                                10096000
@CC00922 DC    C'BI01'                                                  10097000
@CC01125 DC    C'BIP1'                                                  10098000
@CC01132 DC    C'BIP2'                                                  10099000
@CC01145 DC    C'BIJ1'                                                  10100000
@CC01146 DC    C'BIJ2'                                                  10101000
@CC01166 DC    C'BI02'                                                  10102000
@CC01168 DC    C'BI03'                                                  10103000
@CC01171 DC    C'BI04'                                                  10104000
@CC01189 DC    C'BIFI'                                                  10105000
@CC01231 DC    C'BIL1'                                                  10106000
@CC01284 DC    C'BIL2'                                                  10107000
@CC01315 DC    C'BID1'                                                  10108000
@CC01324 DC    C'BID2'                                                  10109000
@CC01342 DC    C'BIDL'                                                  10110000
@CC01379 DC    C'BII1'                                                  10111000
@CC01380 DC    C'BII2'                                                  10112000
@CC01405 DC    C'BIC1'                                                  10113000
@CC01409 DC    C'BIC2'                                                  10114000
@CC01447 DC    C'BISR'                                                  10115000
@CC01482 DC    C'BISP'                                                  10116000
@CC01530 DC    C'BIB1'                                                  10117000
@CC01611 DC    C'BIM1'                                                  10118000
@CC01614 DC    C'BIM2'                                                  10119000
@CC01620 DC    C'BIM3'                                                  10120000
@CC01628 DC    C'BIM4'                                                  10121000
@CC00721 DC    C'A'                                                     10122000
@CC00727 EQU   @CC01319                                                 10123000
@CC00738 EQU   @CC00922                                                 10124000
@CC00744 DC    C'M'                                                     10125000
@CC01131 DC    C'S'                                                     10126000
@CC01233 DC    C'1'                                                     10127000
@CC01234 DC    C'2'                                                     10128000
@CC01235 DC    C'3'                                                     10129000
@CC01236 DC    C'4'                                                     10130000
@CC01237 DC    C'5'                                                     10131000
@CC01407 DC    C'N'                                                     10132000
@CC01408 EQU   @CC01283                                                 10133000
@CB00884 DC    X'C2C9F001'                                              10134000
@CB00886 DC    X'C2C9F002'                                              10135000
@CB00888 DC    X'C2C9F003'                                              10136000
@CB00898 DC    X'C2C9F008'                                              10137000
@CB00902 DC    X'C2C9F00A'                                              10138000
@CB00904 DC    X'C2C9F00B'                                              10139000
@CB00906 DC    X'C2C9F00C'                                              10140000
@CB00914 DC    X'C2C9F010'                                              10141000
@CB00920 DC    X'C2C9F013'                                              10142000
@CB01188 DC    X'00000000'                                              10143000
@CB01321 DC    X'99999F'                                                10144000
@CB00960 DC    X'0001'                                                  10145000
@CB00962 DC    X'0002'                                                  10146000
ALL      DC    CL3'ALL'                                                 10147000
FORMAT   DC    CL4'FORM'                                                10148000
HSECOND  DC    CL4'HSEC'                                                10149000
CLOCK    DC    CL4'KLOK'                                                10150000
SETZERO  DC    CL4'ZERO'                                                10151000
SETBLANK DC    CL4'BLNK'                                                10152000
NOSET    DC    CL4'NSET'                                                10153000
OVERRIDE DC    CL4'OVRD'                                                10154000
ACQUIRE  DC    CL8'ACQUIRE '                                            10155000
RELINQ   DC    CL8'RELINQ  '                                            10156000
MOUNT    DC    CL8'MOUNT   '                                            10157000
DEMOUNT  DC    CL8'DEMOUNT '                                            10158000
DEFINE   DC    CL8'DEFINE  '                                            10159000
MOVE     DC    CL8'MOVE    '                                            10160000
TRACEQ   DC    CL8'TRACEQ  '                                            10161000
COPYTABL DC    CL8'COPYTABL'                                            10162000
COPYCRTG DC    CL8'COPYCRTG'                                            10163000
COPYVOL  DC    CL8'COPYVOL '                                            10164000
VVIC     DC    CL8'VVIC    '                                            10165000
TUNE     DC    CL8'TUNE    '                                            10166000
NAMES    DC    CL4'NAME'                                                10167000
UNIT     DC    CL4'UNIT'                                                10168000
SHR      DC    CL4'SHR '                                                10169000
EXCL     DC    CL4'EXCL'                                                10170000
NOWAIT   DC    CL4'NWAI'                                                10171000
WAIT     DC    CL4'WAIT'                                                10172000
MODID    DC    CL4'BI01'                                                10173000
FIXAREA  DS    CL768                                                    10174000
         ORG   FIXAREA                                                  10175000
@NM00051 DS    CL256                                                    10176000
         ORG   @NM00051                                                 10177000
@NM00052 DC    256X'00'                                                 10178000
         ORG   FIXAREA+256                                              10179000
@NM00053 DS    CL256                                                    10180000
         ORG   @NM00053                                                 10181000
@NM00054 DC    256X'00'                                                 10182000
         ORG   FIXAREA+512                                              10183000
@NM00055 DS    CL256                                                    10184000
         ORG   @NM00055                                                 10185000
@NM00056 DC    256X'00'                                                 10186000
         ORG   FIXAREA+768                                              10187000
UGPID01  DC    CL4'BI01'                                                10188000
UGPIDPG  DC    CL4'BIPG'                                                10189000
DEFDDN   DC    CL8'IDCUT1'                                              10190000
         DC    CL8'IDCUT2'                                              10191000
NAMTABL  DC    CL8'ENTYPE'                                              10192000
         DC    CL8'NAMEDS'                                              10193000
         DC    CL8'CATACB'                                              10194000
         DC    CL8'CNTREPNO'                                            10195000
         DC    CL8'AMDSBCAT'                                            10196000
DEFNMTAB DC    CL8'DSETCRDT'                                            10197000
         DC    CL8'DSETEXDT'                                            10198000
         DC    CL8'SPACPARM'                                            10199000
         DC    CL8'AMDSBCAT'                                            10200000
         DC    CL8'DSATTR'                                              10201000
         DC    CL8'LRECL'                                               10202000
MSGTXT   DC    CL3'KEY'                                                 10203000
         DC    CL3'RBA'                                                 10204000
MAXKEY   DC    256X'FF'                                                 10205000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       10206000
@01      EQU   01                                                       10207000
@02      EQU   02                                                       10208000
@03      EQU   03                                                       10209000
@04      EQU   04                                                       10210000
@05      EQU   05                                                       10211000
@06      EQU   06                                                       10212000
@07      EQU   07                                                       10213000
@08      EQU   08                                                       10214000
@09      EQU   09                                                       10215000
@10      EQU   10                                                       10216000
@11      EQU   11                                                       10217000
@12      EQU   12                                                       10218000
@13      EQU   13                                                       10219000
@14      EQU   14                                                       10220000
@15      EQU   15                                                       10221000
TREEPTR  EQU   @04                                                      10222000
TREC2    EQU   @06                                                      10223000
TPREV    EQU   @03                                                      10224000
TCURR    EQU   @02                                                      10225000
TSIZE    EQU   @05                                                      10226000
IOCSHOLD EQU   @02                                                      10227000
UNQLIMIT EQU   @03                                                      10228000
CLRSTART EQU   @03                                                      10229000
BL       EQU   @05                                                      10230000
SPRECPTR EQU   @03                                                      10231000
SP2LIM   EQU   @05                                                      10232000
SP1      EQU   @06                                                      10233000
PUTCTR   EQU   @04                                                      10234000
SORTJ    EQU   @02                                                      10235000
SORTI    EQU   @04                                                      10236000
SORTR    EQU   @03                                                      10237000
SORTL    EQU   @05                                                      10238000
NM       EQU   @02                                                      10239000
GETRC    EQU   @02                                                      10240000
RSAINIT  EQU   @02                                                      10241000
RSAREM   EQU   @03                                                      10242000
DL       EQU   @02                                                      10243000
DF       EQU   @06                                                      10244000
LC       EQU   @03                                                      10245000
FN       EQU   @02                                                      10246000
JC       EQU   @02                                                      10247000
INBUFPT  EQU   @06                                                      10248000
DEFPTR   EQU   @05                                                      10249000
DFCPPTR  EQU   @03                                                      10250000
OUTCOUNT EQU   @06                                                      10251000
SWDATPTR EQU   @04                                                      10252000
CTGFVPTR EQU   @02                                                      10253000
AMDSBPTR EQU   @04                                                      10254000
CTGFLPTR EQU   @02                                                      10255000
OPNPTR   EQU   @02                                                      10256000
IOCSPTR  EQU   @02                                                      10257000
TESTRC   EQU   @03                                                      10258000
SETRC    EQU   @05                                                      10259000
RTNREG   EQU   @15                                                      10260000
REG0     EQU   @00                                                      10261000
REG1     EQU   @01                                                      10262000
REG10    EQU   @10                                                      10263000
REG11    EQU   @11                                                      10264000
REG12    EQU   @12                                                      10265000
REG13    EQU   @13                                                      10266000
REG14    EQU   @14                                                      10267000
REG15    EQU   @15                                                      10268000
REG2     EQU   @02                                                      10269000
REG3     EQU   @03                                                      10270000
REG4     EQU   @04                                                      10271000
REG5     EQU   @05                                                      10272000
REG6     EQU   @06                                                      10273000
REG7     EQU   @07                                                      10274000
REG8     EQU   @08                                                      10275000
REG9     EQU   @09                                                      10276000
IDCSAEP0 EQU   0                                                        10277000
IDCSAGP0 EQU   0                                                        10278000
IDCSAFP0 EQU   0                                                        10279000
IDCSATI0 EQU   0                                                        10280000
IDCSACA0 EQU   0                                                        10281000
IDCSAQL0 EQU   0                                                        10282000
TRACE1   EQU   0                                                        10283000
OLDERID1 EQU   TRACE1                                                   10284000
TRACE2   EQU   0                                                        10285000
OLDERID2 EQU   TRACE2                                                   10286000
NEWID2   EQU   TRACE2+95                                                10287000
NEWERID2 EQU   5                                                        10288000
CIRAGL   EQU   0                                                        10289000
CIRTYPE  EQU   CIRAGL                                                   10290000
ALLAGL   EQU   0                                                        10291000
ALLSTS   EQU   ALLAGL+24                                                10292000
ALLDSP   EQU   ALLAGL+25                                                10293000
ALLORG   EQU   ALLAGL+26                                                10294000
ALLOPT   EQU   ALLAGL+28                                                10295000
UNITABL  EQU   0                                                        10296000
UNITADR  EQU   UNITABL+4                                                10297000
@NM00010 EQU   UNITADR                                                  10298000
UNITSTAT EQU   UNITABL+6                                                10299000
IDCIOOP0 EQU   0                                                        10300000
IDCIOCL0 EQU   0                                                        10301000
IDCIOPO0 EQU   0                                                        10302000
IDCIOGT0 EQU   0                                                        10303000
IDCIOPT0 EQU   0                                                        10304000
IDCIOSI0 EQU   0                                                        10305000
IOCSTR   EQU   0                                                        10306000
IOCDAD   EQU   IOCSTR                                                   10307000
IOCDLN   EQU   IOCSTR+4                                                 10308000
IOCKYL   EQU   IOCSTR+12                                                10309000
IOCDSO   EQU   IOCSTR+16                                                10310000
IOCRFM   EQU   IOCSTR+17                                                10311000
IOCMAC   EQU   IOCSTR+18                                                10312000
IOCMAC2  EQU   IOCSTR+19                                                10313000
IOCMACPA EQU   IOCMAC2                                                  10314000
IOCCHP   EQU   IOCSTR+20                                                10315000
IOCMSG   EQU   IOCSTR+21                                                10316000
IOCHURBA EQU   IOCSTR+28                                                10317000
IOCDSN   EQU   IOCSTR+32                                                10318000
IOCRBA   EQU   IOCSTR+40                                                10319000
IOCTTR   EQU   IOCRBA                                                   10320000
IOCMEM   EQU   IOCSTR+44                                                10321000
IOCKYA   EQU   IOCMEM                                                   10322000
IOCNWM   EQU   IOCSTR+48                                                10323000
IOCPTL   EQU   IOCNWM                                                   10324000
IOCWORK  EQU   IOCSTR+56                                                10325000
OPNAGL   EQU   0                                                        10326000
OPNOPT   EQU   OPNAGL                                                   10327000
OPNOPTIN EQU   OPNOPT                                                   10328000
OPNOPTOT EQU   OPNOPT                                                   10329000
OPNOPTUP EQU   OPNOPT                                                   10330000
OPNOPTBK EQU   OPNOPT                                                   10331000
OPNOPTKS EQU   OPNOPT                                                   10332000
OPNOPTDR EQU   OPNOPT                                                   10333000
OPNRFM   EQU   OPNAGL+1                                                 10334000
OPNTYP   EQU   OPNAGL+2                                                 10335000
OPNMOD   EQU   OPNAGL+3                                                 10336000
OPNMODAX EQU   OPNMOD                                                   10337000
OPNMODRS EQU   OPNMOD                                                   10338000
OPNMODUB EQU   OPNMOD                                                   10339000
OPNIOC   EQU   OPNAGL+4                                                 10340000
OPNDDN   EQU   OPNAGL+8                                                 10341000
OPNPWA   EQU   OPNAGL+12                                                10342000
OPNDSN   EQU   OPNAGL+16                                                10343000
OPNDEV   EQU   OPNAGL+24                                                10344000
OPNDSO   EQU   OPNAGL+41                                                10345000
OPNOPT2  EQU   OPNAGL+42                                                10346000
IOINFOPT EQU   0                                                        10347000
IOINFVOL EQU   IOINFOPT                                                 10348000
IOINFDSN EQU   IOINFOPT                                                 10349000
IOINFSUP EQU   IOINFOPT                                                 10350000
UVOLLIST EQU   0                                                        10351000
UVOLENT  EQU   UVOLLIST+2                                               10352000
AMSTP011 EQU   0                                                        10353000
IDCTPER0 EQU   0                                                        10354000
DARGLIST EQU   0                                                        10355000
DARGDBP  EQU   DARGLIST                                                 10356000
DARGSTID EQU   DARGLIST+8                                               10357000
DARGILP  EQU   DARGLIST+12                                              10358000
DARGCNT  EQU   DARGLIST+14                                              10359000
DARGARY  EQU   DARGLIST+20                                              10360000
DARGINS  EQU   DARGARY                                                  10361000
DARGINL  EQU   DARGARY+2                                                10362000
DARGDTM  EQU   DARGARY+4                                                10363000
FMTLIST  EQU   0                                                        10364000
FMTFLGS  EQU   FMTLIST                                                  10365000
FMTSPF   EQU   FMTLIST+2                                                10366000
FMTRFNO  EQU   FMTSPF                                                   10367000
FMTILEN  EQU   FMTRFNO                                                  10368000
FMTIOFF  EQU   FMTLIST+4                                                10369000
FMTTRBC  EQU   FMTIOFF                                                  10370000
FMTSTO   EQU   FMTTRBC                                                  10371000
FMTOCOL  EQU   FMTLIST+6                                                10372000
FMTCNVF  EQU   FMTLIST+10                                               10373000
ERCNVTAB EQU   0                                                        10374000
ERTYPE   EQU   ERCNVTAB                                                 10375000
ERCATLG  EQU   ERTYPE                                                   10376000
EROPER   EQU   ERCNVTAB+1                                               10377000
ERCATLC  EQU   EROPER                                                   10378000
ERCATDE  EQU   EROPER                                                   10379000
EROSOPER EQU   ERCNVTAB+2                                               10380000
ERCATRC  EQU   ERCNVTAB+16                                              10381000
ERCPLPT  EQU   ERCNVTAB+20                                              10382000
IDCDB010 EQU   0                                                        10383000
DMPITM   EQU   0                                                        10384000
DMPARY   EQU   0                                                        10385000
IFILE    EQU   0                                                        10386000
IFILEPLN EQU   IFILE                                                    10387000
IFILEPAS EQU   IFILE+1                                                  10388000
IFILEVAL EQU   IFILE+10                                                 10389000
IDS      EQU   0                                                        10390000
IDSPLN   EQU   IDS                                                      10391000
IDSPAS   EQU   IDS+1                                                    10392000
IDSFLG   EQU   IDS+10                                                   10393000
IDSFUQ   EQU   IDSFLG                                                   10394000
IDSLEN   EQU   IDS+20                                                   10395000
IDSVAL   EQU   IDS+21                                                   10396000
OFILE    EQU   0                                                        10397000
OFILECNT EQU   OFILE                                                    10398000
@NM00038 EQU   OFILE+2                                                  10399000
OFILEPLN EQU   @NM00038                                                 10400000
OFILEPAS EQU   @NM00038+1                                               10401000
OFILEVAL EQU   @NM00038+10                                              10402000
ODS      EQU   0                                                        10403000
ODSCNT   EQU   ODS                                                      10404000
@NM00039 EQU   ODS+2                                                    10405000
ODSPLN   EQU   @NM00039                                                 10406000
ODSPAS   EQU   @NM00039+1                                               10407000
ODSFLG   EQU   @NM00039+10                                              10408000
ODSFUQ   EQU   ODSFLG                                                   10409000
ODSLEN   EQU   @NM00039+20                                              10410000
ODSVAL   EQU   @NM00039+21                                              10411000
CAT      EQU   0                                                        10412000
CATPLN   EQU   CAT                                                      10413000
CATPAS   EQU   CAT+1                                                    10414000
CATFLG   EQU   CAT+10                                                   10415000
CATVAL   EQU   CAT+21                                                   10416000
WFILE    EQU   0                                                        10417000
WFLE1    EQU   0                                                        10418000
WFLE1VAL EQU   WFLE1+1                                                  10419000
WFLE2    EQU   0                                                        10420000
WFLE2VAL EQU   WFLE2+1                                                  10421000
ESORT    EQU   0                                                        10422000
CTGPL    EQU   0                                                        10423000
CTGOPTN1 EQU   CTGPL                                                    10424000
CTGBYPSS EQU   CTGOPTN1                                                 10425000
CTGNAME  EQU   CTGOPTN1                                                 10426000
CTGCNAME EQU   CTGOPTN1                                                 10427000
CTGOPTN2 EQU   CTGPL+1                                                  10428000
CTGEXT   EQU   CTGOPTN2                                                 10429000
CTGERASE EQU   CTGOPTN2                                                 10430000
CTGSMF   EQU   CTGERASE                                                 10431000
CTGREL   EQU   CTGSMF                                                   10432000
CTGPURG  EQU   CTGOPTN2                                                 10433000
CTGVMNT  EQU   CTGPURG                                                  10434000
CTGOPTN3 EQU   CTGPL+2                                                  10435000
CTGFUNC  EQU   CTGOPTN3                                                 10436000
CTGNUM   EQU   CTGOPTN3                                                 10437000
CTGAM0   EQU   CTGOPTN3                                                 10438000
CTGOPTN4 EQU   CTGPL+3                                                  10439000
CTGENT   EQU   CTGPL+4                                                  10440000
CTGFVT   EQU   CTGENT                                                   10441000
CTGCAT   EQU   CTGPL+8                                                  10442000
CTGWKA   EQU   CTGPL+12                                                 10443000
CTGDSORG EQU   CTGPL+16                                                 10444000
CTGOPTNS EQU   CTGDSORG                                                 10445000
CTGTYPE  EQU   CTGPL+18                                                 10446000
CTGNOFLD EQU   CTGPL+19                                                 10447000
CTGDDNM  EQU   CTGPL+20                                                 10448000
CTGNEWNM EQU   CTGDDNM                                                  10449000
CTGFBFLG EQU   CTGNEWNM+2                                               10450000
CTGJSCB  EQU   CTGPL+24                                                 10451000
CTGPSWD  EQU   CTGJSCB                                                  10452000
CTGFIELD EQU   CTGPL+28                                                 10453000
CTGFL    EQU   0                                                        10454000
CTGFLDNO EQU   CTGFL                                                    10455000
CTGFLDCD EQU   CTGFL+1                                                  10456000
CTGFLDRE EQU   CTGFL+3                                                  10457000
CTGFLDNM EQU   CTGFL+8                                                  10458000
CTGFLCHN EQU   CTGFL+12                                                 10459000
CTGFLDAT EQU   CTGFL+16                                                 10460000
CTGFLNG  EQU   CTGFLDAT                                                 10461000
CTGFLPT  EQU   CTGFLDAT+4                                               10462000
IDAAMDSB EQU   0                                                        10463000
AMDATTR  EQU   IDAAMDSB+1                                               10464000
AMDDST   EQU   AMDATTR                                                  10465000
AMDLEN   EQU   IDAAMDSB+2                                               10466000
AMDNEST  EQU   IDAAMDSB+4                                               10467000
AMDAXRKP EQU   AMDNEST                                                  10468000
AMDRKP   EQU   IDAAMDSB+6                                               10469000
AMDKEYLN EQU   IDAAMDSB+8                                               10470000
AMDCINV  EQU   IDAAMDSB+20                                              10471000
AMDLRECL EQU   IDAAMDSB+24                                              10472000
AMDHLRBA EQU   IDAAMDSB+28                                              10473000
AMDSSRBA EQU   IDAAMDSB+32                                              10474000
AMDATTR3 EQU   IDAAMDSB+40                                              10475000
AMDUNQ   EQU   AMDATTR3                                                 10476000
AMDSTAT  EQU   IDAAMDSB+48                                              10477000
AMDNLR   EQU   AMDSTAT+12                                               10478000
CTGFV    EQU   0                                                        10479000
CTGFVTYP EQU   CTGFV                                                    10480000
CTGFVPRO EQU   CTGFV+1                                                  10481000
CTGFVDCH EQU   CTGFV+4                                                  10482000
CTGFVIND EQU   CTGFV+16                                                 10483000
CTGFVENT EQU   CTGFV+20                                                 10484000
CTGFVEXP EQU   CTGFV+32                                                 10485000
CTGFVCRE EQU   CTGFV+36                                                 10486000
CTGFVVLT EQU   CTGFV+40                                                 10487000
CTGFVSPC EQU   CTGFV+52                                                 10488000
CTGFVAMD EQU   CTGFV+56                                                 10489000
CTGFVATR EQU   CTGFV+60                                                 10490000
CTGFVLRS EQU   CTGFV+68                                                 10491000
CTGFVLMT EQU   CTGFV+72                                                 10492000
CTGFVGAT EQU   CTGFV+76                                                 10493000
CTGFVWKA EQU   CTGFV+88                                                 10494000
DSNAME   EQU   0                                                        10495000
IODSNAME EQU   0                                                        10496000
IODSNID  EQU   IODSNAME                                                 10497000
IODSNLN  EQU   IODSNAME+2                                               10498000
IODSN    EQU   IODSNAME+4                                               10499000
IOVOLSER EQU   0                                                        10500000
IOVLSID  EQU   IOVOLSER                                                 10501000
IOVLSLN  EQU   IOVOLSER+2                                               10502000
IOVLSER  EQU   IOVOLSER+4                                               10503000
DFCPAREA EQU   0                                                        10504000
CPFVAREA EQU   DFCPAREA                                                 10505000
CPLID    EQU   CPFVAREA                                                 10506000
DEFCPL   EQU   CPFVAREA+8                                               10507000
CLSTRID  EQU   CPFVAREA+40                                              10508000
CLSTRFVT EQU   CPFVAREA+48                                              10509000
DATAID   EQU   CPFVAREA+140                                             10510000
DATAFVT  EQU   CPFVAREA+148                                             10511000
FPLAREA  EQU   DFCPAREA+240                                             10512000
CRDTFPL  EQU   FPLAREA                                                  10513000
EXDTFPL  EQU   FPLAREA+24                                               10514000
SPACEFPL EQU   FPLAREA+48                                               10515000
AMDSBFPL EQU   FPLAREA+72                                               10516000
DSATTFPL EQU   FPLAREA+96                                               10517000
LRECLFPL EQU   FPLAREA+120                                              10518000
DEFWKA   EQU   DFCPAREA+384                                             10519000
NAMESWKA EQU   DEFWKA                                                   10520000
NAMWKTLN EQU   NAMESWKA                                                 10521000
NAMWK    EQU   NAMESWKA+4                                               10522000
RECVSWKA EQU   DEFWKA+94                                                10523000
RECVSTLN EQU   RECVSWKA                                                 10524000
DEFAREAS EQU   0                                                        10525000
DEFDATA  EQU   DEFAREAS                                                 10526000
DEFAMDSB EQU   DEFDATA                                                  10527000
DEFSPACE EQU   DEFDATA+96                                               10528000
DEFPRIME EQU   DEFSPACE                                                 10529000
DEFSECND EQU   DEFSPACE+3                                               10530000
DEFSPTYP EQU   DEFSPACE+6                                               10531000
DEFCRDT  EQU   DEFDATA+104                                              10532000
DEFCRYR  EQU   DEFCRDT+1                                                10533000
DEFEXPDT EQU   DEFDATA+112                                              10534000
DEFEXPIR EQU   DEFEXPDT+1                                               10535000
DEFDSATT EQU   DEFDATA+116                                              10536000
DEFSPEED EQU   DEFDSATT                                                 10537000
DEFREUS  EQU   DEFDSATT                                                 10538000
DEFSHAR  EQU   DEFDSATT+1                                               10539000
DEFSAVE  EQU   DEFAREAS+120                                             10540000
DEFSVCPL EQU   DEFSAVE                                                  10541000
DEFSVFPL EQU   DEFSAVE+240                                              10542000
DEFSVDAT EQU   DEFSAVE+384                                              10543000
VOLLIST  EQU   0                                                        10544000
VOLLSTLN EQU   VOLLIST                                                  10545000
VOLLSTAR EQU   VOLLIST+2                                                10546000
VOLCODE  EQU   VOLLSTAR                                                 10547000
VOLSER   EQU   VOLLSTAR+2                                               10548000
OUTBUFFR EQU   0                                                        10549000
OUTRECAR EQU   OUTBUFFR                                                 10550000
OUTRDF   EQU   OUTBUFFR+2041                                            10551000
OUTRDFFL EQU   OUTRDF                                                   10552000
OUTRDFLN EQU   OUTRDF+1                                                 10553000
OUTCIDF  EQU   OUTBUFFR+2044                                            10554000
OUTCIDFS EQU   OUTCIDF                                                  10555000
OUTCIDLN EQU   OUTCIDF+2                                                10556000
INBUFFR  EQU   0                                                        10557000
INRDF    EQU   INBUFFR+2041                                             10558000
INCIDF   EQU   INBUFFR+2044                                             10559000
RSAREC   EQU   0                                                        10560000
BASEREC  EQU   0                                                        10561000
AIXREC   EQU   0                                                        10562000
SHEAPTR  EQU   0                                                        10563000
ENTYPE   EQU   0                                                        10564000
NAMEDS   EQU   0                                                        10565000
NAMEID   EQU   NAMEDS                                                   10566000
NAMECI   EQU   NAMEDS+1                                                 10567000
ACBADDR  EQU   0                                                        10568000
SPSRTREC EQU   0                                                        10569000
BLSRTREC EQU   0                                                        10570000
IDAAIX   EQU   0                                                        10571000
AIXFG    EQU   IDAAIX                                                   10572000
AIXPKP   EQU   AIXFG                                                    10573000
AIXPL    EQU   IDAAIX+1                                                 10574000
AIXPC    EQU   IDAAIX+2                                                 10575000
AIXKL    EQU   IDAAIX+4                                                 10576000
AIXKY    EQU   IDAAIX+5                                                 10577000
MERGTREE EQU   0                                                        10578000
MTSTGNO  EQU   MERGTREE                                                 10579000
MTBLKREC EQU   MERGTREE+4                                               10580000
MTBLKNO  EQU   MTBLKREC                                                 10581000
MTRECNO  EQU   MTBLKREC+2                                               10582000
MTPTR    EQU   MERGTREE+8                                               10583000
MTRBA    EQU   MERGTREE+12                                              10584000
MRSRTREC EQU   0                                                        10585000
AMSTP041 EQU   0                                                        10586000
AMSTP042 EQU   0                                                        10587000
AMSTP043 EQU   0                                                        10588000
AMSTP044 EQU   0                                                        10589000
DMPTRM   EQU   0                                                        10590000
IDCIOCO0 EQU   0                                                        10591000
IDCIOIT0 EQU   0                                                        10592000
IDCIOST0 EQU   0                                                        10593000
IDCIOTM0 EQU   0                                                        10594000
IDCIOVY0 EQU   0                                                        10595000
IDCIO050 EQU   0                                                        10596000
IDCSAAL0 EQU   0                                                        10597000
IDCSACL0 EQU   0                                                        10598000
IDCSACR0 EQU   0                                                        10599000
IDCSADE0 EQU   0                                                        10600000
IDCSADL0 EQU   0                                                        10601000
IDCSADQ0 EQU   0                                                        10602000
IDCSAFS0 EQU   0                                                        10603000
IDCSAGS0 EQU   0                                                        10604000
IDCSAID0 EQU   0                                                        10605000
IDCSALC0 EQU   0                                                        10606000
IDCSALD0 EQU   0                                                        10607000
IDCSALK0 EQU   0                                                        10608000
IDCSANQ0 EQU   0                                                        10609000
IDCSAPR0 EQU   0                                                        10610000
IDCSAPT0 EQU   0                                                        10611000
IDCSARC0 EQU   0                                                        10612000
IDCSARV0 EQU   0                                                        10613000
IDCSASC0 EQU   0                                                        10614000
IDCSASI0 EQU   0                                                        10615000
IDCSASN0 EQU   0                                                        10616000
IDCSASS0 EQU   0                                                        10617000
IDCSAST0 EQU   0                                                        10618000
IDCSAUC0 EQU   0                                                        10619000
IDCSAWO0 EQU   0                                                        10620000
IDCSA060 EQU   0                                                        10621000
IDCST010 EQU   0                                                        10622000
ISORT    EQU   0                                                        10623000
LISTTEST EQU   0                                                        10624000
NEWERID1 EQU   5                                                        10625000
GDTTBL   EQU   0                                                        10626000
GDTTR1   EQU   GDTTBL+8                                                 10627000
GDTTR2   EQU   GDTTBL+12                                                10628000
GDTDBG   EQU   GDTTBL+40                                                10629000
GDTSTC   EQU   GDTTBL+44                                                10630000
GDTPRT   EQU   GDTTBL+48                                                10631000
GDTESS   EQU   GDTTBL+52                                                10632000
GDTESA   EQU   GDTTBL+56                                                10633000
GDTRST   EQU   GDTTBL+60                                                10634000
GDTRES   EQU   GDTTBL+64                                                10635000
GDTCAL   EQU   GDTTBL+68                                                10636000
GDTGSP   EQU   GDTTBL+72                                                10637000
GDTFSP   EQU   GDTTBL+76                                                10638000
GDTGPL   EQU   GDTTBL+80                                                10639000
GDTFPL   EQU   GDTTBL+84                                                10640000
GDTLOD   EQU   GDTTBL+88                                                10641000
GDTDEL   EQU   GDTTBL+92                                                10642000
GDTPRL   EQU   GDTTBL+96                                                10643000
GDTEPL   EQU   GDTTBL+100                                               10644000
GDTTIM   EQU   GDTTBL+104                                               10645000
GDTIIO   EQU   GDTTBL+108                                               10646000
GDTTIO   EQU   GDTTBL+112                                               10647000
GDTOPN   EQU   GDTTBL+124                                               10648000
GDTCLS   EQU   GDTTBL+128                                               10649000
GDTGET   EQU   GDTTBL+132                                               10650000
GDTPUT   EQU   GDTTBL+136                                               10651000
GDTPOS   EQU   GDTTBL+140                                               10652000
GDTCPY   EQU   GDTTBL+144                                               10653000
GDTCAT   EQU   GDTTBL+148                                               10654000
GDTSNP   EQU   GDTTBL+164                                               10655000
GDTVFY   EQU   GDTTBL+172                                               10656000
GDTECT   EQU   GDTTBL+188                                               10657000
GDTUID   EQU   GDTTBL+192                                               10658000
GDTPMT   EQU   GDTTBL+196                                               10659000
GDTCIR   EQU   GDTTBL+200                                               10660000
GDTLNK   EQU   GDTTBL+204                                               10661000
GDTALC   EQU   GDTTBL+208                                               10662000
GDTDLC   EQU   GDTTBL+212                                               10663000
GDTQAL   EQU   GDTTBL+216                                               10664000
GDTSTW   EQU   GDTTBL+220                                               10665000
GDTSSC   EQU   GDTTBL+224                                               10666000
GDTENQ   EQU   GDTTBL+228                                               10667000
GDTRSV   EQU   GDTTBL+232                                               10668000
GDTDEQ   EQU   GDTTBL+236                                               10669000
GDTSFO   EQU   GDTTBL+240                                               10670000
GDTWTO   EQU   GDTTBL+244                                               10671000
GDTSCR   EQU   GDTTBL+248                                               10672000
GDTUNT   EQU   GDTTBL+252                                               10673000
GDTRCT   EQU   GDTTBL+256                                               10674000
GDTIFO   EQU   GDTTBL+260                                               10675000
GDTEXP   EQU   GDTTBL+264                                               10676000
GDTSTA   EQU   GDTTBL+268                                               10677000
GDTERR   EQU   GDTTBL+272                                               10678000
GDTUNC   EQU   GDTTBL+276                                               10679000
GDTLOC   EQU   GDTTBL+280                                               10680000
FDTTBL   EQU   0                                                        10681000
FDTPTR   EQU   FDTTBL+8                                                 10682000
LASTCC   EQU   0                                                        10683000
OTYPE    EQU   0                                                        10684000
OIOCS    EQU   0                                                        10685000
OINDX    EQU   0                                                        10686000
OIOINPT  EQU   0                                                        10687000
JCIOIN   EQU   0                                                        10688000
JCIOINPT EQU   JCIOIN                                                   10689000
MAINI    EQU   0                                                        10690000
MAINAMDS EQU   0                                                        10691000
MAIAMBAS EQU   MAINAMDS                                                 10692000
MAIAMAIX EQU   MAINAMDS+4                                               10693000
MAINIOCS EQU   0                                                        10694000
MAIOCSPT EQU   MAINIOCS                                                 10695000
MAINIOIN EQU   0                                                        10696000
MAINSTAT EQU   0                                                        10697000
MASAVERC EQU   MAINSTAT                                                 10698000
FINIOCS  EQU   0                                                        10699000
FIIOCSBS EQU   FINIOCS                                                  10700000
FIIOCSAX EQU   FINIOCS+4                                                10701000
FIIOCSSR EQU   FINIOCS+8                                                10702000
FINSTAT  EQU   0                                                        10703000
FISAVERC EQU   FINSTAT                                                  10704000
FISTID   EQU   FINSTAT+2                                                10705000
TERMIOCS EQU   0                                                        10706000
TEIOCSPT EQU   TERMIOCS                                                 10707000
TERMIOIN EQU   0                                                        10708000
TERSRTTB EQU   0                                                        10709000
LOCAMDSB EQU   0                                                        10710000
LOAMDSPT EQU   LOCAMDSB                                                 10711000
LOCIOCS  EQU   0                                                        10712000
LOIOCSPT EQU   LOCIOCS                                                  10713000
LOCI     EQU   0                                                        10714000
LOCSTAT  EQU   0                                                        10715000
LOSTID   EQU   LOCSTAT+2                                                10716000
CATLOCNO EQU   0                                                        10717000
CATLOCNM EQU   0                                                        10718000
CATLOCCI EQU   0                                                        10719000
CATLOCDT EQU   0                                                        10720000
CATLOPTR EQU   CATLOCDT                                                 10721000
CATLOCI  EQU   0                                                        10722000
CATSTAT  EQU   0                                                        10723000
CASTID   EQU   CATSTAT+2                                                10724000
DEFCALID EQU   0                                                        10725000
DEFIOIN  EQU   0                                                        10726000
DFIOINPT EQU   DEFIOIN                                                  10727000
DEFIOCS  EQU   0                                                        10728000
DFIOCSSR EQU   DEFIOCS+8                                                10729000
DEFSRTTB EQU   0                                                        10730000
DEFSTAT  EQU   0                                                        10731000
DFSTID   EQU   DEFSTAT+2                                                10732000
DELTIOIN EQU   0                                                        10733000
DLIOINPT EQU   DELTIOIN                                                 10734000
INITAMDS EQU   0                                                        10735000
INIAMBAS EQU   INITAMDS                                                 10736000
INIAMAIX EQU   INITAMDS+4                                               10737000
INITIOCS EQU   0                                                        10738000
INITIOIN EQU   0                                                        10739000
INITSRTB EQU   0                                                        10740000
INITSTAT EQU   0                                                        10741000
INSTID   EQU   INITSTAT+2                                               10742000
CNTLAMDS EQU   0                                                        10743000
CNTLIOCS EQU   0                                                        10744000
CNIOCSBS EQU   CNTLIOCS                                                 10745000
CNIOCSSR EQU   CNTLIOCS+8                                               10746000
CNTLIOIN EQU   0                                                        10747000
CNIOINPT EQU   CNTLIOIN                                                 10748000
CNTLSRTB EQU   0                                                        10749000
CNTLSTAT EQU   0                                                        10750000
CNSAVERC EQU   CNTLSTAT                                                 10751000
SORTAMDS EQU   0                                                        10752000
SORAMBAS EQU   SORTAMDS                                                 10753000
SORAMAIX EQU   SORTAMDS+4                                               10754000
SORTIOCS EQU   0                                                        10755000
SOIOCSBS EQU   SORTIOCS                                                 10756000
SORTIOIN EQU   0                                                        10757000
SORTSRTB EQU   0                                                        10758000
SORTSTAT EQU   0                                                        10759000
SOSAVERC EQU   SORTSTAT                                                 10760000
SORTCLID EQU   0                                                        10761000
SPILIOCS EQU   0                                                        10762000
SPIOCSSR EQU   SPILIOCS+8                                               10763000
SPILIOIN EQU   0                                                        10764000
SPILSRTB EQU   0                                                        10765000
SPILSTAT EQU   0                                                        10766000
BLRECPTR EQU   0                                                        10767000
BLDAMDS  EQU   0                                                        10768000
BLDAMBAS EQU   BLDAMDS                                                  10769000
BLDAMAIX EQU   BLDAMDS+4                                                10770000
BLDIOCS  EQU   0                                                        10771000
BLIOCSAX EQU   BLDIOCS+4                                                10772000
BLDSRTB  EQU   0                                                        10773000
BLDSTAT  EQU   0                                                        10774000
BLSAVERC EQU   BLDSTAT                                                  10775000
MERGAMDS EQU   0                                                        10776000
MERGIOCS EQU   0                                                        10777000
MRIOCSSR EQU   MERGIOCS+8                                               10778000
MERGIOIN EQU   0                                                        10779000
MRIOINPT EQU   MERGIOIN                                                 10780000
MERGSRTB EQU   0                                                        10781000
MERGSTAT EQU   0                                                        10782000
@NM00045 EQU   CTGDDNM                                                  10783000
CTGPROB  EQU   @NM00045                                                 10784000
CTGREASN EQU   CTGPROB+2                                                10785000
CHARRBA  EQU   IOCRBA                                                   10786000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    10787000
CTGREAS2 EQU   CTGREASN+1                                               10788000
CTGREAS1 EQU   CTGREASN                                                 10789000
CTGMODID EQU   CTGPROB                                                  10790000
MRSTID   EQU   MERGSTAT+2                                               10791000
MRSAVERC EQU   MERGSTAT                                                 10792000
MRIOCSAX EQU   MERGIOCS+4                                               10793000
MRIOCSBS EQU   MERGIOCS                                                 10794000
MERAMAIX EQU   MERGAMDS+4                                               10795000
MERAMBAS EQU   MERGAMDS                                                 10796000
BLSTID   EQU   BLDSTAT+2                                                10797000
BLIOCSSR EQU   BLDIOCS+8                                                10798000
BLIOCSBS EQU   BLDIOCS                                                  10799000
SPSTID   EQU   SPILSTAT+2                                               10800000
SPSAVERC EQU   SPILSTAT                                                 10801000
SPIOINPT EQU   SPILIOIN                                                 10802000
SPIOCSAX EQU   SPILIOCS+4                                               10803000
SPIOCSBS EQU   SPILIOCS                                                 10804000
SOSTID   EQU   SORTSTAT+2                                               10805000
SOIOINPT EQU   SORTIOIN                                                 10806000
SOIOCSSR EQU   SORTIOCS+8                                               10807000
SOIOCSAX EQU   SORTIOCS+4                                               10808000
CNSTID   EQU   CNTLSTAT+2                                               10809000
CNIOCSAX EQU   CNTLIOCS+4                                               10810000
CNTAMAIX EQU   CNTLAMDS+4                                               10811000
CNTAMBAS EQU   CNTLAMDS                                                 10812000
INSAVERC EQU   INITSTAT                                                 10813000
INIOINPT EQU   INITIOIN                                                 10814000
INIOCSPT EQU   INITIOCS                                                 10815000
DFSAVERC EQU   DEFSTAT                                                  10816000
DFIOCSAX EQU   DEFIOCS+4                                                10817000
DFIOCSBS EQU   DEFIOCS                                                  10818000
CASAVERC EQU   CATSTAT                                                  10819000
LOSAVERC EQU   LOCSTAT                                                  10820000
TEIOINPT EQU   TERMIOIN                                                 10821000
MASTID   EQU   MAINSTAT+2                                               10822000
MAIOINPT EQU   MAINIOIN                                                 10823000
FDTVERB  EQU   FDTTBL                                                   10824000
GDTPSB   EQU   GDTTBL+184                                               10825000
GDTUPT   EQU   GDTTBL+180                                               10826000
GDTCMB   EQU   GDTTBL+176                                               10827000
GDTSPR   EQU   GDTTBL+168                                               10828000
@NM00001 EQU   GDTTBL+160                                               10829000
GDTABH   EQU   GDTTBL+156                                               10830000
GDTABT   EQU   GDTTBL+152                                               10831000
GDTTOH   EQU   GDTTBL+120                                               10832000
GDTRIP   EQU   GDTTBL+116                                               10833000
GDTIOH   EQU   GDTTBL+36                                                10834000
GDTSAH   EQU   GDTTBL+32                                                10835000
GDTTPH   EQU   GDTTBL+28                                                10836000
GDTRIH   EQU   GDTTBL+24                                                10837000
GDTSTH   EQU   GDTTBL+20                                                10838000
GDTDBH   EQU   GDTTBL+16                                                10839000
GDTPRM   EQU   GDTTBL+4                                                 10840000
GDTHDR   EQU   GDTTBL                                                   10841000
@NM00080 EQU   MERGTREE+2                                               10842000
@NM00079 EQU   AIXFG                                                    10843000
INCIDLN  EQU   INCIDF+2                                                 10844000
INCIDFS  EQU   INCIDF                                                   10845000
INRDFLN  EQU   INRDF+1                                                  10846000
INRDFFL  EQU   INRDF                                                    10847000
INRECAR  EQU   INBUFFR                                                  10848000
@NM00072 EQU   DEFDATA+118                                              10849000
@NM00071 EQU   DEFDSATT+1                                               10850000
@NM00070 EQU   DEFDSATT+1                                               10851000
@NM00069 EQU   DEFDSATT                                                 10852000
@NM00068 EQU   DEFDSATT                                                 10853000
@NM00067 EQU   DEFEXPDT                                                 10854000
@NM00066 EQU   DEFCRDT+4                                                10855000
DEFCRDAY EQU   DEFCRDT+2                                                10856000
@NM00065 EQU   DEFCRDT                                                  10857000
@NM00064 EQU   DEFDATA+103                                              10858000
RECVSVOL EQU   RECVSWKA+4                                               10859000
RECVSRLN EQU   RECVSWKA+2                                               10860000
NAMRET   EQU   NAMWK+1                                                  10861000
NAMTYPE  EQU   NAMWK                                                    10862000
NAMWKRLN EQU   NAMESWKA+2                                               10863000
@NM00063 EQU   FPLAREA+136                                              10864000
@NM00062 EQU   FPLAREA+112                                              10865000
@NM00061 EQU   FPLAREA+88                                               10866000
@NM00060 EQU   FPLAREA+64                                               10867000
@NM00059 EQU   FPLAREA+40                                               10868000
@NM00058 EQU   FPLAREA+16                                               10869000
@NM00057 EQU   CPFVAREA+36                                              10870000
CTGFVPWD EQU   CTGFV+84                                                 10871000
CTGFVNAM EQU   CTGFV+80                                                 10872000
CTGFVUPG EQU   CTGFVGAT                                                 10873000
CTGFVEXT EQU   CTGFVLMT                                                 10874000
CTGFVBUF EQU   CTGFV+64                                                 10875000
CTGFVFSN EQU   CTGFVAMD                                                 10876000
CTGFVTTR EQU   CTGFVSPC                                                 10877000
CTGFVDVT EQU   CTGFV+48                                                 10878000
CTGFVRNG EQU   CTGFV+44                                                 10879000
CTGFVOWN EQU   CTGFV+28                                                 10880000
CTGFVSTY EQU   CTGFV+24                                                 10881000
CTGFVVCH EQU   CTGFV+12                                                 10882000
CTGFVICH EQU   CTGFV+8                                                  10883000
@NM00050 EQU   CTGFV+3                                                  10884000
CTGFVELM EQU   CTGFV+2                                                  10885000
@NM00049 EQU   CTGFVPRO                                                 10886000
CTGFVDRC EQU   CTGFVPRO                                                 10887000
CTGFVNDC EQU   CTGFVPRO                                                 10888000
CTGFVRVL EQU   CTGFVPRO                                                 10889000
CTGFVAVL EQU   CTGFVPRO                                                 10890000
AMDEXCP  EQU   AMDSTAT+44                                               10891000
AMDNCAS  EQU   AMDSTAT+40                                               10892000
AMDNCIS  EQU   AMDSTAT+36                                               10893000
AMDASPA  EQU   AMDSTAT+32                                               10894000
AMDRETR  EQU   AMDSTAT+28                                               10895000
AMDUPR   EQU   AMDSTAT+24                                               10896000
AMDIREC  EQU   AMDSTAT+20                                               10897000
AMDDELR  EQU   AMDSTAT+16                                               10898000
AMDNEXT  EQU   AMDSTAT+10                                               10899000
AMDNIL   EQU   AMDSTAT+8                                                10900000
AMDSTSP  EQU   AMDSTAT                                                  10901000
@NM00048 EQU   IDAAMDSB+41                                              10902000
@NM00047 EQU   AMDATTR3                                                 10903000
AMDLM    EQU   AMDATTR3                                                 10904000
AMDWAIT  EQU   AMDATTR3                                                 10905000
AMDBIND  EQU   AMDATTR3                                                 10906000
AMDFAULT EQU   AMDATTR3                                                 10907000
AMDPARDB EQU   IDAAMDSB+36                                              10908000
AMDMAXRR EQU   AMDSSRBA                                                 10909000
AMDNSLOT EQU   AMDHLRBA                                                 10910000
AMDFSCI  EQU   IDAAMDSB+16                                              10911000
AMDFSCA  EQU   IDAAMDSB+14                                              10912000
AMDCIPCA EQU   IDAAMDSB+12                                              10913000
AMDPCTCI EQU   IDAAMDSB+11                                              10914000
AMDPCTCA EQU   IDAAMDSB+10                                              10915000
AMDSPAN  EQU   AMDATTR                                                  10916000
AMDRRDS  EQU   AMDATTR                                                  10917000
AMDRANGE EQU   AMDATTR                                                  10918000
AMDORDER EQU   AMDATTR                                                  10919000
AMDREPL  EQU   AMDATTR                                                  10920000
AMDSDT   EQU   AMDATTR                                                  10921000
AMDWCK   EQU   AMDATTR                                                  10922000
AMDSBID  EQU   IDAAMDSB                                                 10923000
CTGFLDWA EQU   CTGFL+4                                                  10924000
CTGFLDTS EQU   CTGFLDRE                                                 10925000
@NM00046 EQU   CTGFLDRE                                                 10926000
CTGFLDGC EQU   CTGFL+2                                                  10927000
@NM00044 EQU   CTGFBFLG                                                 10928000
CTGNGDSN EQU   CTGFBFLG                                                 10929000
CTGGDGB  EQU   CTGFBFLG                                                 10930000
CTGKEEP  EQU   CTGFBFLG                                                 10931000
CTGPAR   EQU   CTGFBFLG                                                 10932000
CTGFDBK  EQU   CTGNEWNM                                                 10933000
@NM00043 EQU   CTGDSORG                                                 10934000
CTGCVOL  EQU   CTGCAT                                                   10935000
@NM00042 EQU   CTGOPTN4                                                 10936000
CTGBYPMT EQU   CTGOPTN4                                                 10937000
@NM00041 EQU   CTGOPTN4                                                 10938000
CTGDOCAT EQU   CTGOPTN4                                                 10939000
CTGLBASE EQU   CTGOPTN4                                                 10940000
CTGSRH   EQU   CTGOPTN3                                                 10941000
CTGGDGL  EQU   CTGOPTN3                                                 10942000
CTGSUPLT EQU   CTGOPTN3                                                 10943000
@NM00040 EQU   CTGOPTN2                                                 10944000
CTGSCR   EQU   CTGOPTN2                                                 10945000
CTGOVRID EQU   CTGOPTN2                                                 10946000
CTGDISC  EQU   CTGOPTN2                                                 10947000
CTGGTNXT EQU   CTGOPTN2                                                 10948000
CTGRCATN EQU   CTGVMNT                                                  10949000
CTGGTALL EQU   CTGREL                                                   10950000
CTGNSVS  EQU   CTGEXT                                                   10951000
CTGGENLD EQU   CTGOPTN1                                                 10952000
CTGREAD  EQU   CTGOPTN1                                                 10953000
CTGUPD   EQU   CTGOPTN1                                                 10954000
CTGCI    EQU   CTGOPTN1                                                 10955000
CTGMAST  EQU   CTGOPTN1                                                 10956000
WFLE2LEN EQU   WFLE2                                                    10957000
WFLE1LEN EQU   WFLE1                                                    10958000
CATLEN   EQU   CAT+20                                                   10959000
CATMEM   EQU   CAT+12                                                   10960000
CATMLN   EQU   CAT+11                                                   10961000
CATFUQ   EQU   CATFLG                                                   10962000
CATPOS   EQU   CAT+9                                                    10963000
ODSMEM   EQU   @NM00039+12                                              10964000
ODSMLN   EQU   @NM00039+11                                              10965000
ODSPOS   EQU   @NM00039+9                                               10966000
OFILELEN EQU   @NM00038+9                                               10967000
IDSMEM   EQU   IDS+12                                                   10968000
IDSMLN   EQU   IDS+11                                                   10969000
IDSPOS   EQU   IDS+9                                                    10970000
IFILELEN EQU   IFILE+9                                                  10971000
@NM00037 EQU   DMPARY+15                                                10972000
DMPARYTP EQU   DMPARY+14                                                10973000
DMPARYEX EQU   DMPARY+12                                                10974000
DMPARYIC EQU   DMPARY+10                                                10975000
DMPARYSZ EQU   DMPARY+8                                                 10976000
DMPARYNM EQU   DMPARY                                                   10977000
@NM00036 EQU   DMPITM+15                                                10978000
DMPITMTP EQU   DMPITM+14                                                10979000
DMPITMLN EQU   DMPITM+12                                                10980000
DMPITMPT EQU   DMPITM+8                                                 10981000
DMPITMNM EQU   DMPITM                                                   10982000
@NM00035 EQU   ERCNVTAB+24                                              10983000
ERDSNM   EQU   ERCNVTAB+12                                              10984000
@NM00034 EQU   ERCNVTAB+4                                               10985000
@NM00033 EQU   ERCNVTAB+3                                               10986000
@NM00032 EQU   EROSOPER                                                 10987000
EROSUCDX EQU   EROSOPER                                                 10988000
EROSCATL EQU   EROSOPER                                                 10989000
@NM00031 EQU   EROPER                                                   10990000
ERCATAL  EQU   EROPER                                                   10991000
ERCATDL  EQU   EROPER                                                   10992000
@NM00030 EQU   ERTYPE                                                   10993000
EROSCAT  EQU   ERTYPE                                                   10994000
@NM00029 EQU   FMTCNVF+1                                                10995000
FMTAR    EQU   FMTCNVF+1                                                10996000
FMTBS    EQU   FMTCNVF+1                                                10997000
FMTSS    EQU   FMTCNVF+1                                                10998000
FMTAL    EQU   FMTCNVF+1                                                10999000
FMTZS    EQU   FMTCNVF+1                                                11000000
@NM00028 EQU   FMTCNVF                                                  11001000
FMTPU    EQU   FMTCNVF                                                  11002000
FMTBD    EQU   FMTCNVF                                                  11003000
FMTBHD   EQU   FMTCNVF                                                  11004000
FMTBHA   EQU   FMTCNVF                                                  11005000
FMTBH    EQU   FMTCNVF                                                  11006000
FMTOLEN  EQU   FMTLIST+8                                                11007000
FMTRIO   EQU   FMTOCOL                                                  11008000
FMTSPT   EQU   FMTSTO                                                   11009000
FMTSTL   EQU   FMTILEN                                                  11010000
@NM00027 EQU   FMTFLGS+1                                                11011000
FMTHDF   EQU   FMTFLGS                                                  11012000
FMTDFF   EQU   FMTFLGS                                                  11013000
FMTSTF   EQU   FMTFLGS                                                  11014000
FMTREPF  EQU   FMTFLGS                                                  11015000
FMTBDF   EQU   FMTFLGS                                                  11016000
FMTIDF   EQU   FMTFLGS                                                  11017000
FMTSCF   EQU   FMTFLGS                                                  11018000
FMTEOLF  EQU   FMTFLGS                                                  11019000
DARGPCT  EQU   DARGINL                                                  11020000
DARGREP  EQU   DARGINS                                                  11021000
@NM00026 EQU   DARGLIST+19                                              11022000
DARGIND  EQU   DARGLIST+18                                              11023000
DARGRETL EQU   DARGLIST+16                                              11024000
DARGSENT EQU   DARGSTID+3                                               11025000
DARGSMOD EQU   DARGSTID                                                 11026000
DARGRETP EQU   DARGLIST+4                                               11027000
UVOLVOL  EQU   UVOLENT+4                                                11028000
UVOLDEV  EQU   UVOLENT                                                  11029000
UVOLCNT  EQU   UVOLLIST                                                 11030000
@NM00025 EQU   IOINFOPT                                                 11031000
IOINFTMS EQU   IOINFOPT                                                 11032000
IOINFDVT EQU   IOINFOPT                                                 11033000
OPNVOL   EQU   OPNAGL+44                                                11034000
@NM00024 EQU   OPNAGL+43                                                11035000
@NM00023 EQU   OPNOPT2                                                  11036000
OPNOPTJM EQU   OPNOPT2                                                  11037000
@NM00022 EQU   OPNOPT2                                                  11038000
OPNOPTAS EQU   OPNOPT2                                                  11039000
@NM00021 EQU   OPNDSO                                                   11040000
OPNDSOPO EQU   OPNDSO                                                   11041000
OPNDSOIS EQU   OPNDSO                                                   11042000
OPNDSOPS EQU   OPNDSO                                                   11043000
OPNDSOAM EQU   OPNDSO                                                   11044000
OPNKYL   EQU   OPNAGL+40                                                11045000
OPNBLK   EQU   OPNAGL+36                                                11046000
OPNREC   EQU   OPNAGL+32                                                11047000
OPNDEVIX EQU   OPNDEV+4                                                 11048000
OPNDEVDT EQU   OPNDEV                                                   11049000
OPNCBP   EQU   OPNAGL+20                                                11050000
OPNMODRP EQU   OPNMOD                                                   11051000
OPNMODRR EQU   OPNMOD                                                   11052000
OPNMODRC EQU   OPNMOD                                                   11053000
OPNMODAC EQU   OPNMOD                                                   11054000
OPNMODPD EQU   OPNMOD                                                   11055000
@NM00020 EQU   OPNTYP                                                   11056000
OPNTYPRV EQU   OPNTYP                                                   11057000
OPNTYPEX EQU   OPNTYP                                                   11058000
OPNTYPRA EQU   OPNTYP                                                   11059000
OPNTYPXM EQU   OPNTYP                                                   11060000
OPNTYPCI EQU   OPNTYP                                                   11061000
OPNTYPSO EQU   OPNTYP                                                   11062000
OPNTYPSI EQU   OPNTYP                                                   11063000
@NM00019 EQU   OPNRFM                                                   11064000
OPNRFMBK EQU   OPNRFM                                                   11065000
OPNRFMSF EQU   OPNRFM                                                   11066000
OPNRFMUN EQU   OPNRFM                                                   11067000
OPNRFMVR EQU   OPNRFM                                                   11068000
OPNRFMFX EQU   OPNRFM                                                   11069000
OPNOPTSK EQU   OPNOPT                                                   11070000
OPNOPTCR EQU   OPNOPT                                                   11071000
IOCEXT   EQU   IOCSTR+64                                                11072000
IOCREL   EQU   IOCSTR+60                                                11073000
IOCRRN   EQU   IOCSTR+52                                                11074000
IOCPNM   EQU   IOCNWM+2                                                 11075000
IOCVRC   EQU   IOCTTR                                                   11076000
IOCCBP   EQU   IOCSTR+36                                                11077000
IOCVOLSR EQU   IOCSTR+22                                                11078000
@NM00018 EQU   IOCMSG                                                   11079000
IOCMSGAE EQU   IOCMSG                                                   11080000
IOCMSGCE EQU   IOCMSG                                                   11081000
IOCMSGOE EQU   IOCMSG                                                   11082000
IOCMSGOP EQU   IOCMSG                                                   11083000
@NM00017 EQU   IOCMSG                                                   11084000
IOCCHPSY EQU   IOCCHP                                                   11085000
IOCCHPAS EQU   IOCCHP                                                   11086000
IOCCHPBK EQU   IOCCHP                                                   11087000
IOCCHPCR EQU   IOCCHP                                                   11088000
IOCCHPKS EQU   IOCCHP                                                   11089000
IOCCHPSK EQU   IOCCHP                                                   11090000
IOCCHPDR EQU   IOCCHP                                                   11091000
IOCCHPSQ EQU   IOCCHP                                                   11092000
@NM00016 EQU   IOCMAC2                                                  11093000
@NM00015 EQU   IOCMAC2                                                  11094000
IOCMACCP EQU   IOCMAC2                                                  11095000
IOCMACRR EQU   IOCMAC2                                                  11096000
IOCMACAS EQU   IOCMAC2                                                  11097000
IOCMACSK EQU   IOCMAC2                                                  11098000
@NM00014 EQU   IOCMAC                                                   11099000
IOCMACCC EQU   IOCMAC                                                   11100000
IOCMACDR EQU   IOCMAC                                                   11101000
IOCMACBK EQU   IOCMAC                                                   11102000
IOCMACCR EQU   IOCMAC                                                   11103000
IOCMACUP EQU   IOCMAC                                                   11104000
IOCMACOT EQU   IOCMAC                                                   11105000
IOCMACIN EQU   IOCMAC                                                   11106000
@NM00013 EQU   IOCRFM                                                   11107000
IOCRFMBK EQU   IOCRFM                                                   11108000
IOCRFMSF EQU   IOCRFM                                                   11109000
IOCRFMUN EQU   IOCRFM                                                   11110000
IOCRFMVR EQU   IOCRFM                                                   11111000
IOCRFMFX EQU   IOCRFM                                                   11112000
@NM00012 EQU   IOCDSO                                                   11113000
IOCDSOPO EQU   IOCDSO                                                   11114000
IOCDSOIS EQU   IOCDSO                                                   11115000
IOCDSOPS EQU   IOCDSO                                                   11116000
IOCDSOAM EQU   IOCDSO                                                   11117000
IOCRKP   EQU   IOCSTR+13                                                11118000
IOCTRN   EQU   IOCSTR+8                                                 11119000
UNITVTOC EQU   UNITABL+7                                                11120000
@NM00011 EQU   UNITSTAT                                                 11121000
UNITUSHR EQU   UNITSTAT                                                 11122000
UNITXSHR EQU   UNITSTAT                                                 11123000
UNITISHR EQU   UNITSTAT                                                 11124000
UNITUA   EQU   @NM00010+1                                               11125000
UNITCHA  EQU   @NM00010                                                 11126000
UNITUCB  EQU   UNITABL                                                  11127000
ALLUNCNT EQU   ALLAGL+30                                                11128000
ALLVLCNT EQU   ALLAGL+29                                                11129000
@NM00009 EQU   ALLOPT                                                   11130000
ALLOPTUN EQU   ALLOPT                                                   11131000
ALLOPTPV EQU   ALLOPT                                                   11132000
ALLOPTDS EQU   ALLOPT                                                   11133000
ALLOPTVL EQU   ALLOPT                                                   11134000
@NM00008 EQU   ALLORG+1                                                 11135000
ALLORGVS EQU   ALLORG+1                                                 11136000
@NM00007 EQU   ALLORG+1                                                 11137000
ALLORGGS EQU   ALLORG+1                                                 11138000
ALLORGUN EQU   ALLORG                                                   11139000
ALLORGPO EQU   ALLORG                                                   11140000
ALLORGMQ EQU   ALLORG                                                   11141000
ALLORGCQ EQU   ALLORG                                                   11142000
ALLORGCX EQU   ALLORG                                                   11143000
ALLORGDA EQU   ALLORG                                                   11144000
ALLORGPS EQU   ALLORG                                                   11145000
ALLORGIS EQU   ALLORG                                                   11146000
ALLDSPUN EQU   ALLDSP                                                   11147000
ALLDSPCG EQU   ALLDSP                                                   11148000
ALLDSPDE EQU   ALLDSP                                                   11149000
ALLDSPKP EQU   ALLDSP                                                   11150000
@NM00006 EQU   ALLDSP                                                   11151000
ALLSTSOD EQU   ALLSTS                                                   11152000
ALLSTSMD EQU   ALLSTS                                                   11153000
ALLSTSNW EQU   ALLSTS                                                   11154000
ALLSTSSR EQU   ALLSTS                                                   11155000
@NM00005 EQU   ALLSTS                                                   11156000
ALLPWD   EQU   ALLAGL+20                                                11157000
ALLVLP   EQU   ALLAGL+16                                                11158000
ALLULP   EQU   ALLAGL+12                                                11159000
ALLDDN   EQU   ALLAGL+4                                                 11160000
ALLDSN   EQU   ALLAGL                                                   11161000
CIRPID   EQU   CIRAGL+28                                                11162000
CIRPWD   EQU   CIRAGL+24                                                11163000
CIRCAT   EQU   CIRAGL+20                                                11164000
CIRWKP   EQU   CIRAGL+16                                                11165000
CIRTLR   EQU   CIRAGL+12                                                11166000
CIRHDR   EQU   CIRAGL+8                                                 11167000
CIRTLN   EQU   CIRAGL+6                                                 11168000
CIRHLN   EQU   CIRAGL+4                                                 11169000
@NM00004 EQU   CIRAGL+1                                                 11170000
@NM00003 EQU   CIRTYPE                                                  11171000
CIRTYPAQ EQU   CIRTYPE                                                  11172000
CIRTYP1Q EQU   CIRTYPE                                                  11173000
NEWID1   EQU   TRACE1+95                                                11174000
CALLID   EQU   OLDERID1+90                                              11175000
@NM00002 EQU   OLDERID1                                                 11176000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      11177000
@RC00268 EQU   @RC00265                                                 11178000
@RF00291 EQU   @RC00265                                                 11179000
@RC00301 EQU   @RC00295                                                 11180000
@RF00324 EQU   @RC00295                                                 11181000
@RC00385 EQU   @RC00384                                                 11182000
@RT00452 EQU   @EL00004                                                 11183000
@RC00524 EQU   @RC00520                                                 11184000
@RC00568 EQU   @RC00567                                                 11185000
@RC00702 EQU   @RC00690                                                 11186000
@RC00694 EQU   @RC00690                                                 11187000
@RC00759 EQU   @RC00758                                                 11188000
@RC00893 EQU   @RC00892                                                 11189000
@RC00958 EQU   @RC00957                                                 11190000
@RC01007 EQU   @RC01006                                                 11191000
@RF01124 EQU   @RC01107                                                 11192000
@RF01147 EQU   @EL00012                                                 11193000
@RC01202 EQU   @RC01201                                                 11194000
@RC01253 EQU   @RC01249                                                 11195000
@RC01245 EQU   @RC01233                                                 11196000
@RF01674 EQU   @RC01667                                                 11197000
@RC01728 EQU   @EL00017                                                 11198000
@RF01755 EQU   @RC01749                                                 11199000
@PB00016 EQU   @EL00001                                                 11200000
@RF00271 EQU   @RC00268                                                 11201000
@RF00304 EQU   @RC00301                                                 11202000
@RC00695 EQU   @RC00694                                                 11203000
@PB00015 EQU   @PB00016                                                 11204000
@PB00014 EQU   @PB00015                                                 11205000
@PB00013 EQU   @PB00014                                                 11206000
@PB00012 EQU   @PB00013                                                 11207000
@PB00011 EQU   @PB00012                                                 11208000
@PB00010 EQU   @PB00011                                                 11209000
@PB00009 EQU   @PB00010                                                 11210000
@PB00008 EQU   @PB00009                                                 11211000
@PB00007 EQU   @PB00008                                                 11212000
@PB00006 EQU   @PB00007                                                 11213000
@PB00005 EQU   @PB00006                                                 11214000
@PB00004 EQU   @PB00005                                                 11215000
@PB00003 EQU   @PB00004                                                 11216000
@PB00002 EQU   @PB00003                                                 11217000
@ENDDATA EQU   *                                                        11218000
         END   IDCBI01,(C'PLS1851',0701,76288)                          11219000
