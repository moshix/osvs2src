         TITLE 'IDCRC04 - FIELD MANAGEMENT FOR AMS                     *00001000
                        '                                               00002000
        MACRO                                                           00003000
        DICT  &NAME,&OFF=0,&COMB='NO',&BYTE='NO',&FIELD=,&LEN=0,&GC=, **00004000
               &SPECIAL=,&PTRS=                                         00005000
        LCLC  &X1                                                       00006000
        LCLA  &X2,&X3,&X4,&X5                                           00007000
.*                                                                      00008000
&X1     SETC  '&NAME'(1,2)                                              00009000
        AIF   (K'&NAME LT 5).YY1                                        00010000
&X1     SETC  '&X1'.'&NAME'(5,1)                                        00011000
        AIF   (K'&NAME LT 6).YY1                                        00012000
&X1     SETC  '&X1'.'&NAME'(6,1)                                        00013000
.YY1    ANOP                                                            00014000
.*                                                                      00015000
        AIF   ('&COMB' EQ 'YES').COMBN                                  00016000
        AIF   ('&BYTE' NE 'YES').NOBYTE                                 00017000
&X2     SETA  &X2+16                                                    00018000
.NOBYTE ANOP                                                            00019000
        AIF   (T'&FIELD EQ 'O').XX1                                     00020000
&X2     SETA  &X2+128                                                   00021000
&X3     SETA  0                                                         00022000
&X4     SETA  &FIELD                                                    00023000
        AGO   .XX2                                                      00024000
.XX1    ANOP                                                            00025000
        AIF   (T'&SPECIAL EQ 'O').XX1A                                  00026000
&X2     SETA  65                                                        00027000
&X3     SETA  &SPECIAL                                                  00028000
        AGO   .XX1B                                                     00029000
.XX1A   ANOP                                                            00030000
        AIF   (T'&PTRS EQ 'O').XX1AA                                    00031000
&X2     SETA  &X2+2                                                     00032000
.XX1AA  ANOP                                                            00033000
&X3     SETA  &OFF                                                      00034000
.XX1B   ANOP                                                            00035000
&X4     SETA  &LEN                                                      00036000
.XX2    ANOP                                                            00037000
.*                                                                      00038000
        AIF   (T'&GC EQ 'O').XX3                                        00039000
&X5     SETA  &GC                                                       00040000
        AIF   (&GC EQ 128).XX3                                          00041000
&X2     SETA  &X2+64                                                    00042000
.XX3    ANOP                                                            00043000
.*                                                                      00044000
X&X1    DC    CL4'&X1',AL1(&X2),AL1(&X3),AL1(&X4),AL1(&X5)              00045000
        SPACE 2                                                         00046000
.*                                                                      00047000
        MEXIT                                                           00048000
.COMBN  ANOP                                                            00049000
        AIF   (T'&GC EQ 'O').Z1                                         00050000
&X5     SETA  &GC                                                       00051000
.Z1     ANOP                                                            00052000
        DC    CL4'&X1',AL1(32),AL1(Y&X1-Y000),AL1(L'Y&X1),AL1(&X5)      00053000
        SPACE 2                                                         00054000
        MEND                                                            00055000
        MACRO                                                           00056000
        COMB &A,&B                                                      00057000
        LCLA &X,&Y                                                      00058000
        LCLC &N                                                         00059000
&N      SETC  '&A'(1,2)                                                 00060000
        AIF   (K'&A LT 5).YY2                                           00061000
&N      SETC  '&N'.'&A'(5,1)                                            00062000
        AIF   (K'&A LT 6).YY2                                           00063000
&N      SETC  '&N'.'&A'(6,1)                                            00064000
.YY2    ANOP                                                            00065000
.*                                                                      00066000
&X      SETA N'&B                                                       00067000
Y&N     DS   0CL&X                                                      00068000
.*                                                                      00069000
&Y      SETA 1                                                          00070000
.XX1    ANOP                                                            00071000
&N      SETC  '&B(&Y)'(1,2)                                             00072000
        AIF   (K'&B(&Y) LT 5).YY1                                       00073000
&N      SETC  '&N'.'&B(&Y)'(5,1)                                        00074000
        AIF   (K'&B(&Y) LT 6).YY1                                       00075000
&N      SETC  '&N'.'&B(&Y)'(6,1)                                        00076000
.YY1    ANOP                                                            00077000
        DC    AL1((8+X&N-X000)/8)                                       00078000
&Y      SETA &Y+1                                                       00079000
        AIF  (&Y LE &X).XX1                                             00080000
        SPACE 2                                                         00081000
        MEND                                                            00082000
IDCRC04  CSECT ,                                                   0002 00083000
@MAINENT DS    0H                                                  0002 00084000
         USING *,@15                                               0002 00085000
         B     @PROLOG                                             0002 00086000
         DC    AL1(16)                                             0002 00087000
         DC    C'IDCRC04   77.277'                                 0002 00088000
         DROP  @15                                                      00089000
@PROLOG  STM   @14,@12,12(@13)                                     0002 00090000
         BALR  @11,0                                               0002 00091000
@PSTART  LA    @12,4095(,@11)                                      0002 00092000
         USING @PSTART,@11                                         0002 00093000
         USING @PSTART+4095,@12                                    0002 00094000
*  FMPLAD=R1;                     /* POINT AT CALLERS FMPL           */ 00095000
         LR    FMPLAD,R1                                           0049 00096000
*  RFY R1 UNRSTD;                 /* RELEASE THE REGISTER            */ 00097000
*                                                                  0050 00098000
*  /******************************************************************/ 00099000
*  /*                                                                */ 00100000
*  /*     SET UP THE POINTER TO THE WORK AREA                        */ 00101000
*  /*                                                                */ 00102000
*  /******************************************************************/ 00103000
*                                                                  0051 00104000
*  R13->WKARSV(3)=ADDR(FMPLWKAR); /* POINT TO NEW SAVE AREA          */ 00105000
         LA    @03,FMPLWKAR(,FMPLAD)                               0051 00106000
         ST    @03,WKARSV+8(,R13)                                  0051 00107000
*  FMPLWKAR->WKARSV(2)=R13;       /* SAVE THE INCOMING SAVE          */ 00108000
         L     @03,FMPLWKAR(,FMPLAD)                               0052 00109000
         ST    R13,WKARSV+4(,@03)                                  0052 00110000
*                                 /* AREA REGISTER                   */ 00111000
*  R13=FMPLWKAR;                  /* POINT AT WORK AREA              */ 00112000
         LR    R13,@03                                             0053 00113000
*  WKACURCI='FFFFFF'X;            /* INITIALIZE THE CURRENT          */ 00114000
         MVC   WKACURCI(3,R13),@CB00227                            0054 00115000
*                                 /* CI NUMBER SO THAT THE GET       */ 00116000
*                                 /* RECORD ROUTINE DOES NOT         */ 00117000
*                                 /* GET CONFUSED                    */ 00118000
*  WKAUPTR=FMPLUPTR;              /* PLACE THE CALLERS POINTER       */ 00119000
*                                                                  0055 00120000
         MVC   WKAUPTR(4,R13),FMPLUPTR(FMPLAD)                     0055 00121000
*  /******************************************************************/ 00122000
*  /*                                                                */ 00123000
*  /*     SET UP TO HANDLE THE PLS2 GENERATED TEMPORARIES            */ 00124000
*  /*                                                                */ 00125000
*  /******************************************************************/ 00126000
*                                                                  0056 00127000
*  TEMPAD=ADDR(TEMPA);            /* POINT AT GENERATED TEMPS        */ 00128000
         LA    TEMPAD,TEMPA(,R13)                                  0056 00129000
*  GEN(USING @DATD,TEMPAD);       /* ESTABLISH ADDRESSABILITY        */ 00130000
         USING @DATD,TEMPAD                                             00131000
*  TEMPA=TEMPA&&TEMPA;            /* ZERO THE TEMPS                  */ 00132000
*                                                                  0058 00133000
         XC    TEMPA(16,R13),TEMPA(R13)                            0058 00134000
*  /******************************************************************/ 00135000
*  /*                                                                */ 00136000
*  /*     CONVERT ALL THE ALPHABETIC FIELD NAMES TO THE              */ 00137000
*  /*     CODES THAT ARE USED INTERNALLY                             */ 00138000
*  /*                                                                */ 00139000
*  /******************************************************************/ 00140000
*                                                                  0059 00141000
*  CALL PSCNC;                    /* GO TO CONVERT THE FIELD         */ 00142000
         BAL   @14,PSCNC                                           0059 00143000
*                                 /* NAMES TO INTERNAL CODES         */ 00144000
*                                                                  0060 00145000
*  /******************************************************************/ 00146000
*  /*                                                                */ 00147000
*  /*     IF THE NAME CONVERTION WENT OK, THEN BUILD THE             */ 00148000
*  /*     OUTPUT AREA DESIRED BY THE REQUEST.                        */ 00149000
*  /*                                                                */ 00150000
*  /******************************************************************/ 00151000
*                                                                  0060 00152000
*  IF FMPLRTCD=RTNCDNML           /* IF THE RETURN CODE IS           */ 00153000
*                                 /* THE NORMAL ONE                  */ 00154000
*    THEN CALL PSCNF;             /* THEN: GO TO BUILD THE           */ 00155000
         CLI   FMPLRTCD(FMPLAD),0                                  0060 00156000
         BNE   @RF00060                                            0060 00157000
         BAL   @14,PSCNF                                           0061 00158000
*                                 /*       OUTPUT AREA DESIRED       */ 00159000
*    ELSE;                        /* ELSE: CONTINUE                  */ 00160000
*                                                                  0062 00161000
@RF00060 DS    0H                                                  0063 00162000
*  /******************************************************************/ 00163000
*  /*                                                                */ 00164000
*  /*    RESTORE THE INCOMING SAVE AREA ADDRESS                      */ 00165000
*  /*                                                                */ 00166000
*  /******************************************************************/ 00167000
*                                                                  0063 00168000
*  R13=FMPLWKAR->WKARSV(2);       /* RESTORE THE SAVE AREA           */ 00169000
         L     @01,FMPLWKAR(,FMPLAD)                               0063 00170000
         L     R13,WKARSV+4(,@01)                                  0063 00171000
*                                 /* ADDRESS                         */ 00172000
*  GEN(EJECT);                                                     0064 00173000
         EJECT                                                          00174000
*/********************************************************************/ 00175000
*/*                                                                  */ 00176000
*/*  PROCEDURE NAME = PCKLC                                          */ 00177000
*/*                                                                  */ 00178000
*/*  DESCRIPTIVE NAME = CHECK LENGTH/COUNT OF FIELD                  */ 00179000
*/*                                                                  */ 00180000
*/*  FUNCTION =                                                      */ 00181000
*/*      THIS SUB-FUNCTION INSURES THAT THE REQUESTED CATALOG        */ 00182000
*/*      FIELD ACTUALLY EXISTS IN THE GROUP OCCURANCE DATA           */ 00183000
*/*      BEING PROCESSED. THE PROCESSING IS AS FOLLOWS:              */ 00184000
*/*                                                                  */ 00185000
*/*      1. CHECKS TO SEE THAT NON-REPLICATED FIELDS ARE EITHER      */ 00186000
*/*         IN THE HEADER OR THAT THE CORRECT RECORD TYPE IS         */ 00187000
*/*         BEING USED.                                              */ 00188000
*/*                                                                  */ 00189000
*/*      2. CHECKS TO SEE IF THE VARIABLE FIELD IS BEYOND THE        */ 00190000
*/*         THE NUMBER OF FIELDS PRESENT IN THE OCCURANCE DATA.      */ 00191000
*/*                                                                  */ 00192000
*/*      3. CHECKS TO SEE IF FIXED FIELD IS CONTAINED IN THE         */ 00193000
*/*         FIXED AREA.                                              */ 00194000
*/*                                                                  */ 00195000
*/*  ROUTINES CALLED =                                               */ 00196000
*/*      NONE                                                        */ 00197000
*/*                                                                  */ 00198000
*/********************************************************************/ 00199000
*                                                                  0065 00200000
*PCKLC: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0065 00201000
*                                                                  0065 00202000
         B     @PB00002                                            0065 00203000
PCKLC    DS    0H                                                  0066 00204000
*  /******************************************************************/ 00205000
*  /*                                                                */ 00206000
*  /*    CONSTANTS USED BY THIS ROUTINE                              */ 00207000
*  /*                                                                */ 00208000
*  /******************************************************************/ 00209000
*                                                                  0066 00210000
*  DCL LRECFSS   FIXED(8) CONSTANT(105);                           0066 00211000
*                                 /* L RECORD FIXED STORAGE SIZE     */ 00212000
*  DCL FRECFSS   FIXED(8) CONSTANT(48);                            0067 00213000
*                                 /* F RECORD FIXED STORAGE SIZE     */ 00214000
*                                                                  0068 00215000
*  /******************************************************************/ 00216000
*  /*                                                                */ 00217000
*  /*    BEGIN BY ASSUMING THAT THE FIELD DOES NOT EXIST.            */ 00218000
*  /*                                                                */ 00219000
*  /******************************************************************/ 00220000
*                                                                  0068 00221000
*  WKAFLDNE='1'B;                 /* INDICATE THAT THE FIELD         */ 00222000
         OI    WKAFLDNE(R13),B'01000000'                           0068 00223000
*                                 /* DOES NOT EXIST                  */ 00224000
*  /******************************************************************/ 00225000
*  /*                                                                */ 00226000
*  /*    IF THE GROUP CODE IS FOR A NON-VOLUME RECORD                */ 00227000
*  /*    FIXED AREA AND THE FIELD IS FIXED AND THE OFFSET            */ 00228000
*  /*    TO THE START OF THE FIELD IS CONTAINED IN THE HEADER        */ 00229000
*  /*    THEN INDICATE THAT THE FIELD DOES EXIST.                    */ 00230000
*  /*                                                                */ 00231000
*  /*    NOTE: HEADERS ON VOLUME RECORDS AND NON-VOLUME RECORDS      */ 00232000
*  /*          ARE THE SAME. THAT IS NOT TRUE FOR THE REMAINDER      */ 00233000
*  /*          OF THE FIXED AREA IN THE TWO TYPES.                   */ 00234000
*  /*                                                                */ 00235000
*  /******************************************************************/ 00236000
*                                                                  0069 00237000
*  IF WKADTVAR='0'B               /* IF THE FIELD IS NOT             */ 00238000
*                                 /* VARIABLE LENGTH                 */ 00239000
*    THEN IF WKAGRPCD=CONHDGC     /* THEN: IF GROUP CODE IS FOR      */ 00240000
         TM    WKADTVAR(R13),B'10000000'                           0069 00241000
         BNZ   @RF00069                                            0069 00242000
*                                 /*       THE NON-VOLUME            */ 00243000
*                                 /*       RECORD FIXED AREA         */ 00244000
*      THEN IF WKADTSTR<=LENGTH(CBKRD1)                            0070 00245000
         CLI   WKAGRPCD(R13),X'00'                                 0070 00246000
         BNE   @RF00070                                            0070 00247000
*                                 /* THEN: IF FIELD STARTS IN        */ 00248000
*                                 /*       THE HEADER                */ 00249000
*        THEN WKAFLDNE='0'B;      /* THEN: INDICATE THAT THE         */ 00250000
         CLI   WKADTSTR(R13),49                                    0071 00251000
         BH    @RF00071                                            0071 00252000
         NI    WKAFLDNE(R13),B'10111111'                           0072 00253000
*                                 /*       FIELD EXISTS              */ 00254000
*        ELSE;                    /* ELSE: CONTINUE                  */ 00255000
@RF00071 DS    0H                                                  0074 00256000
*      ELSE;                      /* ELSE: CONTINUE                  */ 00257000
@RF00070 DS    0H                                                  0075 00258000
*    ELSE;                        /* ELSE: CONTINUE                  */ 00259000
*                                                                  0075 00260000
@RF00069 DS    0H                                                  0076 00261000
*  /******************************************************************/ 00262000
*  /*                                                                */ 00263000
*  /*    IF THE FIELD IS NOT IN THE HEADER (DOES NOT YET EXIST)      */ 00264000
*  /*    THEN CHECK TO SEE THAT THE GROUP CODE MATCHES THE           */ 00265000
*  /*    TYPE OF RECORD THAT IS BEING PROCESSED. IF THE GROUP        */ 00266000
*  /*    CODE IS OK, THEN INDICATE THAT THE FIELD EXISTS.            */ 00267000
*  /*                                                                */ 00268000
*  /******************************************************************/ 00269000
*                                                                  0076 00270000
*  IF WKAFLDNE='1'B               /* IF THE FIELD DOES NOT           */ 00271000
*                                 /* EXIST                           */ 00272000
*    THEN IF WKA1BSEQ='0'B        /* THEN: IF VOLUME RECORD OR       */ 00273000
         TM    WKAFLDNE(R13),B'01000000'                           0076 00274000
         BNO   @RF00076                                            0076 00275000
*                                 /*       AN EXTENSION              */ 00276000
*      THEN IF WKAGRPCD>=CONVOLGC /* THEN: IF GROUP CODE VALID       */ 00277000
         TM    WKA1BSEQ(R13),B'10000000'                           0077 00278000
         BNZ   @RF00077                                            0077 00279000
*                                 /*       FOR VOLUME RECORD OR      */ 00280000
*                                 /*       EXTENSION                 */ 00281000
*        THEN WKAFLDNE='0'B;      /* THEN: INDICATE THAT THE         */ 00282000
         CLI   WKAGRPCD(R13),X'05'                                 0078 00283000
         BL    @RF00078                                            0078 00284000
         NI    WKAFLDNE(R13),B'10111111'                           0079 00285000
*                                 /*       FIELD DOES EXIST          */ 00286000
*        ELSE;                    /* ELSE: CONTINUE                  */ 00287000
@RF00078 DS    0H                                                  0081 00288000
*      ELSE IF WKAGRPCD<=CONNVLGC /* ELSE: IF GROUP CODE VALID       */ 00289000
*                                 /*       FOR OTHER THAN A          */ 00290000
*                                 /*       VOLUME RECORD             */ 00291000
*        THEN WKAFLDNE='0'B;      /* THEN: INDICATE THAT THE         */ 00292000
         B     @RC00077                                            0081 00293000
@RF00077 CLI   WKAGRPCD(R13),X'04'                                 0081 00294000
         BH    @RF00081                                            0081 00295000
         NI    WKAFLDNE(R13),B'10111111'                           0082 00296000
*                                 /*       FIELD DOES EXIST          */ 00297000
*        ELSE;                    /* ELSE: CONTINUE                  */ 00298000
@RF00081 DS    0H                                                  0084 00299000
*    ELSE;                        /* ELSE: CONTINUE                  */ 00300000
@RF00076 DS    0H                                                  0085 00301000
*  /******************************************************************/ 00302000
*  /*                                                                */ 00303000
*  /*    IF THE FIELD DOES EXIST, CHECK THAT THE VARIABLE            */ 00304000
*  /*    LENGTH FIELD NUMBER IS CONTAINED IN THE GROUP               */ 00305000
*  /*    OCCURANCE OR THAT THE FIXED LENGTH FIELD STARTS IN          */ 00306000
*  /*    THE FIXED AREA PROVIDED.                                    */ 00307000
*  /*                                                                */ 00308000
*  /******************************************************************/ 00309000
*                                                                  0085 00310000
*  IF WKAFLDNE='0'B               /* IF THE FIELD DOES EXIST         */ 00311000
*    THEN IF WKADTVAR='1'B        /* THEN: IF FIELD IS VARIABLE      */ 00312000
@RC00076 TM    WKAFLDNE(R13),B'01000000'                           0085 00313000
         BNZ   @RF00085                                            0085 00314000
*                                 /*       LENGTH                    */ 00315000
*      THEN IF WKAFORL='0'B       /* THEN: IF NOT F OR L RECORD      */ 00316000
         TM    WKADTVAR(R13),B'10000000'                           0086 00317000
         BNO   @RF00086                                            0086 00318000
*        THEN IF WKADTLEN>CBKVARNO                                 0087 00319000
         TM    WKAFORL(R13),B'00000001'                            0087 00320000
         BNZ   @RF00087                                            0087 00321000
*                                 /* THEN: IF FIELD NUMBER           */ 00322000
*                                 /*       DESIRED IS LARGER         */ 00323000
*                                 /*       THAN ANY AVAILABLE        */ 00324000
*          THEN WKAFLDNE='1'B;    /* THEN: INDICATE FIELD DOES       */ 00325000
         CLC   WKADTLEN(1,R13),CBKVARNO(WORKD)                     0088 00326000
         BNH   @RF00088                                            0088 00327000
         OI    WKAFLDNE(R13),B'01000000'                           0089 00328000
*                                 /*       NOT EXIST                 */ 00329000
*          ELSE;                  /* ELSE: CONTINUE                  */ 00330000
@RF00088 DS    0H                                                  0091 00331000
*        ELSE WKAFLDNE='1'B;      /* ELSE: INDICATE THE FIELD        */ 00332000
         B     @RC00087                                            0091 00333000
@RF00087 OI    WKAFLDNE(R13),B'01000000'                           0091 00334000
*                                 /*       DOES NOT EXIST            */ 00335000
*      ELSE IF WKAFORL='1'B       /* ELSE: IF IT IS AN F OR L        */ 00336000
*                                 /*       RECORD                    */ 00337000
*        THEN IF CBKID=CONFREID   /* THEN: IF F RECORD               */ 00338000
         B     @RC00086                                            0092 00339000
@RF00086 TM    WKAFORL(R13),B'00000001'                            0092 00340000
         BNO   @RF00092                                            0092 00341000
*          THEN IF WKADTSTR>=FRECFSS                               0093 00342000
         L     @01,WKABLKAD(,R13)                                  0093 00343000
         CLI   CBKID(@01),C'F'                                     0093 00344000
         BNE   @RF00093                                            0093 00345000
*                                 /* THEN: IF NOT IN FIXED AREA      */ 00346000
*                                 /*       OF THE F RECORD           */ 00347000
*            THEN WKAFLDNE='1'B;  /* THEN: INDICATE FIELD DOES       */ 00348000
         CLI   WKADTSTR(R13),48                                    0094 00349000
         BL    @RF00094                                            0094 00350000
         OI    WKAFLDNE(R13),B'01000000'                           0095 00351000
*                                 /*       NOT EXIST                 */ 00352000
*            ELSE;                /* ELSE: CONTINUE                  */ 00353000
@RF00094 DS    0H                                                  0097 00354000
*          ELSE IF WKADTSTR>=LRECFSS                               0097 00355000
*                                 /* ELSE: IF NOT IN FIXED AREA      */ 00356000
*                                 /*       OF THE L RECORD           */ 00357000
*            THEN WKAFLDNE='1'B;  /* THEN: INDICATE FIELD DOES       */ 00358000
         B     @RC00093                                            0097 00359000
@RF00093 CLI   WKADTSTR(R13),105                                   0097 00360000
         BL    @RF00097                                            0097 00361000
         OI    WKAFLDNE(R13),B'01000000'                           0098 00362000
*                                 /*       NOT EXIST                 */ 00363000
*            ELSE;                /* ELSE: CONTINUE                  */ 00364000
@RF00097 DS    0H                                                  0100 00365000
*        ELSE IF WKADTSTR>=CBKFXDLN                                0100 00366000
*                                 /* ELSE: IF DISPLACEMENT TO        */ 00367000
*                                 /*       FIELD IS LARGER THAN      */ 00368000
*                                 /*       THE SPACE AVAILABLE       */ 00369000
*          THEN WKAFLDNE='1'B;    /* THEN: INDICATE THE FIELD        */ 00370000
         B     @RC00092                                            0100 00371000
@RF00092 CLC   WKADTSTR(1,R13),CBKFXDLN(WORKD)                     0100 00372000
         BL    @RF00100                                            0100 00373000
         OI    WKAFLDNE(R13),B'01000000'                           0101 00374000
*                                 /*       DOES NOT EXIST            */ 00375000
*          ELSE;                  /* ELSE: CONTINUE                  */ 00376000
@RF00100 DS    0H                                                  0103 00377000
*    ELSE;                        /* ELSE: CONTINUE                  */ 00378000
*                                                                  0103 00379000
*                                                                  0103 00380000
@RF00085 DS    0H                                                  0104 00381000
*  END PCKLC;                     /* END OF PROCEDURE                */ 00382000
@EL00002 DS    0H                                                  0104 00383000
@EF00002 DS    0H                                                  0104 00384000
@ER00002 BR    @14                                                 0104 00385000
@PB00002 DS    0H                                                  0105 00386000
*  GEN(EJECT);                                                     0105 00387000
         EJECT                                                          00388000
*/********************************************************************/ 00389000
*/*                                                                  */ 00390000
*/*  PROCEDURE NAME = PEXPT                                          */ 00391000
*/*                                                                  */ 00392000
*/*  DESCRIPTIVE NAME = COLLECT EXTENSION POINTERS                   */ 00393000
*/*                                                                  */ 00394000
*/*  FUNCTION =                                                      */ 00395000
*/*      THIS SUB-FUNCTION SETS UP THE ADDRESS AND LENGTH OF         */ 00396000
*/*      THE EXTENSION POINTERS AS REQUESTED VIA THE RELREPNO        */ 00397000
*/*      SPECIFIED ON ENTRY. THE PROCESSING IS AS FOLLOWS:           */ 00398000
*/*                                                                  */ 00399000
*/*      1. RETURN THE HORIZONTAL EXTENSION POINTER ON RELREPNO      */ 00400000
*/*         NUMBER 1.                                                */ 00401000
*/*                                                                  */ 00402000
*/*      2. RETURN EACH SUCCEEDING VERTICAL EXTENSION POINTER        */ 00403000
*/*         (THAT IS NOT DELETED) ON EACH SUCCEEDING RELREPNO        */ 00404000
*/*         VALUE PROVIDED.                                          */ 00405000
*/*                                                                  */ 00406000
*/*  ROUTINES CALLED =                                               */ 00407000
*/*      NONE                                                        */ 00408000
*/*                                                                  */ 00409000
*/********************************************************************/ 00410000
*                                                                  0106 00411000
*PEXPT: PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);                      0106 00412000
*                                                                  0106 00413000
         B     @PB00003                                            0106 00414000
PEXPT    DS    0H                                                  0107 00415000
*  /******************************************************************/ 00416000
*  /*                                                                */ 00417000
*  /*     BEGIN BY ASSUMING THAT THE FIELD IS FOUND AND THAT         */ 00418000
*  /*     IT DOES EXIST. ALSO ASSUME THAT THE LENGTH OF ALL          */ 00419000
*  /*     POINTERS RETURNED WILL BE THE SAME.                        */ 00420000
*  /*                                                                */ 00421000
*  /******************************************************************/ 00422000
*                                                                  0107 00423000
*  WKAFLDNE='0'B;                 /* INDICATE THAT THE FIELD         */ 00424000
*                                 /* DOES EXIST                      */ 00425000
*  WKAFLDNF='0'B;                 /* INDICATE THAT THE FIELD         */ 00426000
         NI    WKAFLDNE(R13),B'10011111'                           0108 00427000
*                                 /* IS FOUND                        */ 00428000
*  WKAFNDLN=LENGTH(CBKEXTCI);     /* INITIALIZE THE FOUND            */ 00429000
         MVC   WKAFNDLN(2,R13),@CH00087                            0109 00430000
*                                 /* LENGTH                          */ 00431000
*                                                                  0110 00432000
*  /******************************************************************/ 00433000
*  /*                                                                */ 00434000
*  /*     WHEN THE RELREPNO IS 1 THEN PROVIDE THE HORIZONTAL         */ 00435000
*  /*     EXTENSION POINTER TO THE CALLER.                           */ 00436000
*  /*                                                                */ 00437000
*  /******************************************************************/ 00438000
*                                                                  0110 00439000
*  IF WKADRRNO=1                  /* IF THIS IS THE FIRST FIELD      */ 00440000
*    THEN WKAFNDAD=ADDR(CBKEXTCI);/* THEN: POINT AT THE EXTEN-       */ 00441000
         CLC   WKADRRNO(2,R13),@CH00047                            0110 00442000
         BNE   @RF00110                                            0110 00443000
         MVC   WKAFNDAD(4,R13),WKAFGOP(R13)                        0111 00444000
*                                 /*       SION POINTER              */ 00445000
*    /****************************************************************/ 00446000
*    /*                                                              */ 00447000
*    /*     WHEN THE RELREPNO IS OTHER THAN 1, ASSUME THAT           */ 00448000
*    /*     THE FIELD IS NON-EXISTANT AND THAT THE GROUP CODE        */ 00449000
*    /*     IS NOT FOUND.                                            */ 00450000
*    /*                                                              */ 00451000
*    /****************************************************************/ 00452000
*                                                                  0112 00453000
*    ELSE DO;                     /* ELSE:                           */ 00454000
         B     @RC00110                                            0112 00455000
@RF00110 DS    0H                                                  0113 00456000
*      WKAFLDNE='1'B;             /* INDICATE THAT THE FIELD         */ 00457000
*                                 /* DOES NOT EXIST                  */ 00458000
*      WKAFLDNF='1'B;             /* INDICATE THAT THE GROUP         */ 00459000
         OI    WKAFLDNE(R13),B'01100000'                           0114 00460000
*                                 /* CODE NOT FOUND                  */ 00461000
*                                                                  0115 00462000
*      /*************************************************************/  00463000
*      /*                                                            */ 00464000
*      /*     LOOP THROUGH ALL THE GROUP OCCURANCE POINTERS          */ 00465000
*      /*     OR UNTIL THE NEXT ONE IS FOUND. DO NOT INCLUDE         */ 00466000
*      /*     DELETED POINTERS IN THE RETURNED LIST.                 */ 00467000
*      /*                                                            */ 00468000
*       /*************************************************************/ 00469000
*                                                                  0115 00470000
*      WKAEXITG='0'B;             /* INITIALIZE THE LOOP             */ 00471000
         NI    WKAEXITG(R13),B'11011111'                           0115 00472000
*                                 /* CONTROL INDICATOR               */ 00473000
*      WORKA=ADDR(CBKFGOP);       /* POINT AT THE FIRST GOP          */ 00474000
         L     WORKA,WKAFGOP(,R13)                                 0116 00475000
         LA    WORKA,CBKFGOP(,WORKA)                               0116 00476000
*      WORKD=1;                   /* INITIALIZE THE COUNT OF         */ 00477000
         LA    @03,1                                               0117 00478000
         LR    WORKD,@03                                           0117 00479000
*                                 /* POINTERS FOUND                  */ 00480000
*      DO WORKB=1 TO CBKCTGOP WHILE WKAEXITG='0'B;                 0118 00481000
         LR    WORKB,@03                                           0118 00482000
         B     @DE00118                                            0118 00483000
@DL00118 TM    WKAEXITG(R13),B'00100000'                           0118 00484000
         BNZ   @DC00118                                            0118 00485000
*                                 /* LOOP TO FIND THE CORRECT        */ 00486000
*                                 /* VERTICAL EXTENSION POINTER      */ 00487000
*        IF GOPEXTPT='1'B         /* IF THIS IS AN EXTENSION         */ 00488000
*                                 /* POINTER                         */ 00489000
*          THEN IF GOPDELET='0'B  /* THEN: IF IT IS NOT A            */ 00490000
         TM    GOPEXTPT(WORKA),B'10000000'                         0119 00491000
         BNO   @RF00119                                            0119 00492000
*                                 /*       DELETED POINTER           */ 00493000
*            THEN DO;             /* THEN:                           */ 00494000
         TM    GOPDELET(WORKA),B'01000000'                         0120 00495000
         BNZ   @RF00120                                            0120 00496000
*              WORKD=WORKD+1;     /* INCREMENT COUNT OF              */ 00497000
         AH    WORKD,@CH00047                                      0122 00498000
*                                 /* EXTENSION POINTERS              */ 00499000
*              IF WORKD=WKADRRNO  /* IF THIS IS THE NEXT             */ 00500000
*                                 /* EXTENSION POINTER               */ 00501000
*                /****************************************************/ 00502000
*                /*                                                  */ 00503000
*                /*     WHEN A NEW EXTENSION POINTER IS FOUND        */ 00504000
*                /*     THEN INDICATE THAT THE GROUP CODE IS         */ 00505000
*                /*     FOUND AND THE FIELD DOES EXIST. ALSO         */ 00506000
*                /*     RETURN THE ADDRESS OF THE POINTER.           */ 00507000
*                /*                                                  */ 00508000
*                /****************************************************/ 00509000
*                                                                  0123 00510000
*                THEN DO;         /* THEN:                           */ 00511000
         CH    WORKD,WKADRRNO(,R13)                                0123 00512000
         BNE   @RF00123                                            0123 00513000
*                  WKAFNDAD=ADDR(GOPCINO);                         0125 00514000
         ST    WORKA,WKAFNDAD(,R13)                                0125 00515000
*                                 /* POINT AT THE FOUND POINTER      */ 00516000
*                  WKAFLDNE='0'B; /* INDICATE THAT THE FIELD         */ 00517000
*                                 /* DOES EXIST                      */ 00518000
*                  WKAFLDNF='0'B; /* INDICATE THAT THE GROUP         */ 00519000
         NI    WKAFLDNE(R13),B'10011111'                           0127 00520000
*                                 /* CODE FOUND                      */ 00521000
*                  WKAEXITG='1'B; /* INDICATE THAT THE LOOP IS       */ 00522000
         OI    WKAEXITG(R13),B'00100000'                           0128 00523000
*                                 /* COMPLETE                        */ 00524000
*                  END;           /*                                 */ 00525000
*                ELSE;            /* ELSE: CONTINUE                  */ 00526000
@RF00123 DS    0H                                                  0131 00527000
*              END;               /*                                 */ 00528000
*            ELSE;                /* ELSE: CONTINUE                  */ 00529000
@RF00120 DS    0H                                                  0133 00530000
*          ELSE;                  /* ELSE: CONTINUE                  */ 00531000
@RF00119 DS    0H                                                  0134 00532000
*        WORKA=WORKA+WKAGOPLN;    /* POINT AT THE NEXT GOP           */ 00533000
         AH    WORKA,WKAGOPLN(,R13)                                0134 00534000
*        END;                     /*                                 */ 00535000
         AH    WORKB,@CH00047                                      0135 00536000
@DE00118 L     @01,WKAFGOP(,R13)                                   0135 00537000
         SLR   @00,@00                                             0135 00538000
         IC    @00,CBKCTGOP(,@01)                                  0135 00539000
         CR    WORKB,@00                                           0135 00540000
         BNH   @DL00118                                            0135 00541000
@DC00118 DS    0H                                                  0136 00542000
*      END;                       /*                                 */ 00543000
*                                                                  0136 00544000
*  END PEXPT;                     /* END OF PROCEDURE                */ 00545000
@EL00003 DS    0H                                                  0137 00546000
@EF00003 DS    0H                                                  0137 00547000
@ER00003 BR    @14                                                 0137 00548000
@PB00003 DS    0H                                                  0138 00549000
*  GEN(EJECT);                                                     0138 00550000
         EJECT                                                          00551000
*/********************************************************************/ 00552000
*/*                                                                  */ 00553000
*/*  PROCEDURE NAME = PGREC                                          */ 00554000
*/*                                                                  */ 00555000
*/*  DESCRIPTIVE NAME = GET RECORD                                   */ 00556000
*/*                                                                  */ 00557000
*/*  FUNCTION =                                                      */ 00558000
*/*      THIS SUB-FUNCTION OBTAINS ADDRESSABILITY TO THE             */ 00559000
*/*      DESIRED CI NUMBER.  THE PROCESSING IS DONE AS FOLLOWS:      */ 00560000
*/*                                                                  */ 00561000
*/*      1. DETERMINE IF THE DESIRED BLOCK IS KNOWN TO FIELD         */ 00562000
*/*         MANAGEMENT, AND INTERFACES WITH THE CALLERS GET          */ 00563000
*/*         ROUTINE TO OBTAIN ADDRESSABILITY TO THE BLOCK IF         */ 00564000
*/*         REQUIRED.                                                */ 00565000
*/*                                                                  */ 00566000
*/*      2. COMPUTES SOME INFORMATIONAL POINTERS IN THE NEWLY        */ 00567000
*/*         OBTAINED BLOCK.                                          */ 00568000
*/*                                                                  */ 00569000
*/*  ROUTINES CALLED =                                               */ 00570000
*/*      USERS ROUTINE                                               */ 00571000
*/*                                                                  */ 00572000
*/********************************************************************/ 00573000
*PGREC: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0139 00574000
*                                                                  0139 00575000
         B     @PB00004                                            0139 00576000
PGREC    DS    0H                                                  0140 00577000
*  /******************************************************************/ 00578000
*  /*                                                                */ 00579000
*  /*     BEGIN BY ASSUMING THAT THE RECORD IS RETURNED.             */ 00580000
*  /*                                                                */ 00581000
*  /******************************************************************/ 00582000
*                                                                  0140 00583000
*  WKARECFN='1'B;                 /* INDICATE RECORD RETURNED        */ 00584000
         OI    WKARECFN(R13),B'10000000'                           0140 00585000
*  /******************************************************************/ 00586000
*  /*                                                                */ 00587000
*  /*     CHECK TO SEE IF ADDRESSABILITY TO THE DESIRED C.I.         */ 00588000
*  /*     NUMBER IS ALREADY KNOWN.                                   */ 00589000
*  /*                                                                */ 00590000
*  /******************************************************************/ 00591000
*                                                                  0141 00592000
*  IF WKACURCI=WKANEXCI           /* IF THE CURRENT CI NUMBER        */ 00593000
*                                 /* AND THE DESIRED CI NUMBER       */ 00594000
*                                 /* ARE EQUAL                       */ 00595000
*    THEN;                        /* THEN: CONTINUE                  */ 00596000
*                                                                  0141 00597000
         CLC   WKACURCI(3,R13),WKANEXCI(R13)                       0141 00598000
         BE    @RT00141                                            0141 00599000
*    /****************************************************************/ 00600000
*    /*                                                              */ 00601000
*    /*     INTERFACE TO THE CALLERS GET ROUTINE TO OBTAIN           */ 00602000
*    /*     ADDRESSABILITY TO THE DESIRED C.I. NUMBER.               */ 00603000
*    /*                                                              */ 00604000
*    /****************************************************************/ 00605000
*                                                                  0143 00606000
*    ELSE DO;                     /* ELSE:                           */ 00607000
*      WKARTNB=R14;               /* SAVE THE RETURN ADDRESS         */ 00608000
         ST    R14,WKARTNB(,R13)                                   0144 00609000
*      RFY R1 RSTD;               /* RESTRICT THE REGISTER           */ 00610000
*      R1=ADDR(WKAGETIF);         /* POINT AT PARAMETER LIST         */ 00611000
         LA    R1,WKAGETIF(,R13)                                   0146 00612000
*                                 /* FOR THE CALLERS GET RTN.        */ 00613000
*      R15=FMPLGRTN;              /* POINT AT CALLERS GET RTN.       */ 00614000
         L     R15,FMPLGRTN(,FMPLAD)                               0147 00615000
*      CALL SUBR15;               /* GO TO THE CALLERS GET RTN.      */ 00616000
         BALR  @14,@15                                             0148 00617000
*      RFY R1 UNRSTD;             /* RELEASE THE REGISTER            */ 00618000
*      R14=WKARTNB;               /* RESTORE RETURN ADDRESS          */ 00619000
*                                                                  0150 00620000
         L     R14,WKARTNB(,R13)                                   0150 00621000
*      /**************************************************************/ 00622000
*      /*                                                            */ 00623000
*      /*     DO THE FOLLOWING IF THE DESIRED C.I. NUMBER WAS        */ 00624000
*      /*     RETURNED.                                              */ 00625000
*      /*                                                            */ 00626000
*      /**************************************************************/ 00627000
*                                                                  0151 00628000
*      IF WKARECFN='1'B           /* IF RECORD RETURNED              */ 00629000
*        THEN DO;                 /* THEN:                           */ 00630000
*                                                                  0151 00631000
         TM    WKARECFN(R13),B'10000000'                           0151 00632000
         BNO   @RF00151                                            0151 00633000
*          /**********************************************************/ 00634000
*          /*                                                        */ 00635000
*          /*     RECORD THE C.I. NUMBER THAT ADDRESSABILITY         */ 00636000
*          /*     HAS BEEN OBTAINED FOR.                             */ 00637000
*          /*                                                        */ 00638000
*          /**********************************************************/ 00639000
*                                                                  0153 00640000
*          WKACURCI=WKANEXCI;     /* POINT AT THE CURRENT CI         */ 00641000
         MVC   WKACURCI(3,R13),WKANEXCI(R13)                       0153 00642000
*          /**********************************************************/ 00643000
*          /*                                                        */ 00644000
*          /*    CHECK TO SEE IF F OR L TYPE RECORD AND SKIP         */ 00645000
*          /*    THE NORMAL PROCESSING FOR THEM                      */ 00646000
*          /*                                                        */ 00647000
*          /**********************************************************/ 00648000
*                                                                  0154 00649000
*          IF CBKID=CONFREID | CBKID=CONCCRID                      0154 00650000
*                                 /* IF THIS IS AN L OR F TYPE       */ 00651000
*                                 /* RECORD                          */ 00652000
*            THEN WKAFORL='1'B;   /* THEN: INDICATE F OR L TYPE      */ 00653000
         L     @03,WKABLKAD(,R13)                                  0154 00654000
         CLI   CBKID(@03),C'F'                                     0154 00655000
         BE    @RT00154                                            0154 00656000
         CLI   CBKID(@03),C'L'                                     0154 00657000
         BNE   @RF00154                                            0154 00658000
@RT00154 DS    0H                                                  0155 00659000
         OI    WKAFORL(R13),B'00000001'                            0155 00660000
*            ELSE DO;             /* ELSE:                           */ 00661000
         B     @RC00154                                            0156 00662000
@RF00154 DS    0H                                                  0157 00663000
*              WKAFORL='0'B;      /* INDICATE NOT F OR L             */ 00664000
*                                                                  0157 00665000
         NI    WKAFORL(R13),B'11111110'                            0157 00666000
*              /******************************************************/ 00667000
*              /*                                                    */ 00668000
*              /*     COMPUTE THE ADDRESS OF THE EXTENSION POINTER   */ 00669000
*              /*     FOR THE NEW RECORD JUST OBTAINED.              */ 00670000
*              /*                                                    */ 00671000
*              /******************************************************/ 00672000
*                                                                  0158 00673000
*              WORKA=ADDR(CBKRD1)+CBKLOFX;                         0158 00674000
         L     @03,WKABLKAD(,R13)                                  0158 00675000
         SLR   WORKA,WORKA                                         0158 00676000
         IC    WORKA,CBKLOFX(,@03)                                 0158 00677000
         ALR   WORKA,@03                                           0158 00678000
*                                 /* POINT AT FIRST VARIABLE         */ 00679000
*                                 /* LENGTH FIELD                    */ 00680000
*              DO WORKB=1 TO CBKNVLF;                              0159 00681000
         LA    WORKB,1                                             0159 00682000
         B     @DE00159                                            0159 00683000
@DL00159 DS    0H                                                  0160 00684000
*                                 /* LOOP THROUGH ALL VARIABLE       */ 00685000
*                                 /* LENGTH FIELDS                   */ 00686000
*                WORKA=ADDR(CBKDATA)+CBKVRLEN;                     0160 00687000
         LA    @03,CBKDATA(,WORKA)                                 0160 00688000
         AH    @03,CBKVRLEN(,WORKA)                                0160 00689000
         LR    WORKA,@03                                           0160 00690000
*                                 /* POINT AT NEXT VARIABLE          */ 00691000
*                                 /* LENGTH FIELD                    */ 00692000
*                END;             /*                                 */ 00693000
         AH    WORKB,@CH00047                                      0161 00694000
@DE00159 L     @01,WKABLKAD(,R13)                                  0161 00695000
         SLR   @00,@00                                             0161 00696000
         IC    @00,CBKNVLF(,@01)                                   0161 00697000
         CR    WORKB,@00                                           0161 00698000
         BNH   @DL00159                                            0161 00699000
*              WKAFGOP=WORKA;     /* SAVE ADDRESS OF THE             */ 00700000
         ST    WORKA,WKAFGOP(,R13)                                 0162 00701000
*                                 /* EXTENSION POINTER               */ 00702000
*                                                                  0163 00703000
*              /******************************************************/ 00704000
*              /*                                                    */ 00705000
*              /*     SETUP THE LENGTH OF THE GROUP OCCURANCE        */ 00706000
*              /*     POINTER AND THE INDICATOR FOR THE SEQUENCE     */ 00707000
*              /*     NUMBER LENGTH BASED ON THE TYPE OF RECORD      */ 00708000
*              /*     THAT WAS OBTAINED.                             */ 00709000
*              /*                                                    */ 00710000
*              /******************************************************/ 00711000
*                                                                  0163 00712000
*              IF CBKID=CONVOLID |/* IF VOLUME BLOCK OR              */ 00713000
*                 CBKID=CONVEXID  /* AN EXTENSION TO IT              */ 00714000
*                THEN DO;         /* THEN:                           */ 00715000
         L     @03,WKABLKAD(,R13)                                  0163 00716000
         CLI   CBKID(@03),C'V'                                     0163 00717000
         BE    @RT00163                                            0163 00718000
         CLI   CBKID(@03),C'W'                                     0163 00719000
         BNE   @RF00163                                            0163 00720000
@RT00163 DS    0H                                                  0164 00721000
*                  WKA1BSEQ='0'B; /* CLEAR 1 BYTE SEQUENCE           */ 00722000
         NI    WKA1BSEQ(R13),B'01111111'                           0165 00723000
*                                 /* NUMBER INDICATOR                */ 00724000
*                  WKAGOPLN=LENGTH(GOP);                           0166 00725000
         MVC   WKAGOPLN(2,R13),@CH00122                            0166 00726000
*                                 /* SET UP LENGTH OF GOP FOR        */ 00727000
*                                 /* VOLUME RECORD OR EXTENSION      */ 00728000
*                  END;           /*                                 */ 00729000
*                ELSE DO;         /* ELSE:                           */ 00730000
         B     @RC00163                                            0168 00731000
@RF00163 DS    0H                                                  0169 00732000
*                  WKA1BSEQ='1'B; /* SET 1 BYTE SEQUENCE             */ 00733000
         OI    WKA1BSEQ(R13),B'10000000'                           0169 00734000
*                                 /* NUMBER INDICATOR                */ 00735000
*                  WKAGOPLN=LENGTH(GOP)-1;                         0170 00736000
         MVC   WKAGOPLN(2,R13),@CH00139                            0170 00737000
*                                 /* SET UP LENGTH OF GOP FOR        */ 00738000
*                                 /* NON-VOLUME RECORD OR ITS        */ 00739000
*                                 /* EXTENSION RECORD                */ 00740000
*                  END;           /*                                 */ 00741000
*              /******************************************************/ 00742000
*              /*                                                    */ 00743000
*              /*     COMPUTE THE ADDRESS OF THE GROUP OCCURANCE     */ 00744000
*              /*     DATA AREA FOR THIS RECORD.                     */ 00745000
*              /*                                                    */ 00746000
*              /******************************************************/ 00747000
*                                                                  0172 00748000
*              WKAGODTA=(WKAGOPLN*CBKCTGOP)+ADDR(CBKFGOP);         0172 00749000
@RC00163 L     @03,WKAFGOP(,R13)                                   0172 00750000
         SLR   @02,@02                                             0172 00751000
         IC    @02,CBKCTGOP(,@03)                                  0172 00752000
         MH    @02,WKAGOPLN(,R13)                                  0172 00753000
         LA    @03,CBKFGOP(,@03)                                   0172 00754000
         ALR   @02,@03                                             0172 00755000
         ST    @02,WKAGODTA(,R13)                                  0172 00756000
*                                 /* COMPUTE ADDRESS OF FIRST        */ 00757000
*                                 /* GROUP OCCURANCE                 */ 00758000
*              END;               /*                                 */ 00759000
*          END;                   /*                                 */ 00760000
*                                                                  0174 00761000
*        /************************************************************/ 00762000
*        /*                                                          */ 00763000
*        /*     IF NO RECORD IS RETURNED THEN INDICATE THAT          */ 00764000
*        /*     NO C.I. NUMBER HAS ADDRESSABILITY.                   */ 00765000
*        /*                                                          */ 00766000
*        /************************************************************/ 00767000
*                                                                  0175 00768000
*        ELSE WKACURCI='FFFFFF'X; /* ELSE: DESTROY CURRENT CI        */ 00769000
         B     @RC00151                                            0175 00770000
@RF00151 MVC   WKACURCI(3,R13),@CB00227                            0175 00771000
*                                 /*       NUMBER                    */ 00772000
*      END;                       /*                                 */ 00773000
*  END PGREC;                     /* END OF PROCEDURE                */ 00774000
@EL00004 DS    0H                                                  0177 00775000
@EF00004 DS    0H                                                  0177 00776000
@ER00004 BR    @14                                                 0177 00777000
@PB00004 DS    0H                                                  0178 00778000
*  GEN(EJECT);                                                     0178 00779000
         EJECT                                                          00780000
*/********************************************************************/ 00781000
*/*                                                                  */ 00782000
*/*  PROCEDURE NAME = PGREP                                          */ 00783000
*/*                                                                  */ 00784000
*/*  DESCRIPTIVE NAME = GET HIGHEST RELREPNO                         */ 00785000
*/*                                                                  */ 00786000
*/*  FUNCTION =                                                      */ 00787000
*/*      THIS SUB-FUNCTION FINDS THE HIGHEST NON-DELETED             */ 00788000
*/*      RELREPNO WITH THE DESIRED GROUPCODE. THE PROCESSING         */ 00789000
*/*      IS AS FOLLOWS:                                              */ 00790000
*/*                                                                  */ 00791000
*/*      1. SCAN THE BASE RECORD AND ANY HORIZONTAL EXTENSIONS FOR   */ 00792000
*/*         THE DESIRED GROUP CODE. THE LAST NON-DELETED ONE IS      */ 00793000
*/*         SAVED AS THE HIGHEST ONE.                                */ 00794000
*/*                                                                  */ 00795000
*/*      2. AFTER THE CORRECT COUNT IS DETERMINED THE ADDRESS        */ 00796000
*/*         AND LENGTH OF THE FIELD IS CONSTRUCTED.                  */ 00797000
*/*                                                                  */ 00798000
*/*  ROUTINES CALLED =                                               */ 00799000
*/*      PGREC                                                       */ 00800000
*/*                                                                  */ 00801000
*/********************************************************************/ 00802000
*                                                                  0179 00803000
*PGREP: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0179 00804000
         B     @PB00005                                            0179 00805000
PGREP    DS    0H                                                  0180 00806000
*  /******************************************************************/ 00807000
*  /*                                                                */ 00808000
*  /*     INITIALIZE THE NEEDED VARIABLIES AND SAVE THE RETURN       */ 00809000
*  /*     ADDRESS.                                                   */ 00810000
*  /*                                                                */ 00811000
*  /******************************************************************/ 00812000
*                                                                  0180 00813000
*  WKARTNA=R14;                   /* SAVE RETURN ADDRESS             */ 00814000
         ST    R14,WKARTNA(,R13)                                   0180 00815000
*  WKAHREPN=0;                    /* INITIALIZE HIGHEST              */ 00816000
         SLR   @03,@03                                             0181 00817000
         STH   @03,WKAHREPN(,R13)                                  0181 00818000
*                                 /* SEQUENCE NUMBER TO ZERO         */ 00819000
*  WKANEXCI=FMPLBCIN;             /* PLACE GIVEN BASE CI NUMBER      */ 00820000
         MVC   WKANEXCI(3,R13),FMPLBCIN(FMPLAD)                    0182 00821000
*                                 /* AS THE NEXT CI TO GET           */ 00822000
*                                                                  0183 00823000
*  /******************************************************************/ 00824000
*  /*                                                                */ 00825000
*  /*     LOOP THROUGH ALL GROUP OCCURANCE POINTERS FOR THIS         */ 00826000
*  /*     SET OF RECORDS AND GET THE SEQUENCE NUMBER OF THE          */ 00827000
*  /*     HIGHEST NON-DELETED ONE.                                   */ 00828000
*  /*                                                                */ 00829000
*  /******************************************************************/ 00830000
*                                                                  0183 00831000
*  WKAEXITA='0'B;                 /* INITIALIZE LOOP EXIT            */ 00832000
         NI    WKAEXITA(R13),B'11111011'                           0183 00833000
*                                 /* INDICATOR A                     */ 00834000
*  DO WHILE WKAEXITA='0'B;        /* LOOP WHILE EXIT INDICATOR       */ 00835000
         B     @DE00184                                            0184 00836000
@DL00184 DS    0H                                                  0185 00837000
*                                 /* A IS NOT ON                     */ 00838000
*                                                                  0185 00839000
*    /****************************************************************/ 00840000
*    /*                                                              */ 00841000
*    /*     GET THE CORRECT RECORD SO THAT IT MAY BE SEARCHED.       */ 00842000
*    /*     IF THE RECORD IS NOT OBTAINED THEN EXIT USING THE        */ 00843000
*    /*     COUNT THAT HAS ACCRUED TO THIS POINT.                    */ 00844000
*    /*                                                              */ 00845000
*    /****************************************************************/ 00846000
*                                                                  0185 00847000
*    CALL PGREC;                  /* GO TO GET THE CI BLOCK          */ 00848000
         BAL   @14,PGREC                                           0185 00849000
*                                 /* DESIRED                         */ 00850000
*    IF WKARECFN='0'B             /* IF RECORD WAS NOT OBTAINED      */ 00851000
*      THEN WKAEXITA='1'B;        /* THEN: INDICATE THAT THE         */ 00852000
         TM    WKARECFN(R13),B'10000000'                           0186 00853000
         BNZ   @RF00186                                            0186 00854000
         OI    WKAEXITA(R13),B'00000100'                           0187 00855000
*                                 /*       LOOP IS COMPLETE          */ 00856000
*                                                                  0188 00857000
*      /**************************************************************/ 00858000
*      /*                                                            */ 00859000
*      /*     IF THE RECORD IS RETURNED, THEN SEARCH IT FOR THE      */ 00860000
*      /*     DESIRED SEQUENCE NUMBER.                               */ 00861000
*      /*                                                            */ 00862000
*      /**************************************************************/ 00863000
*                                                                  0188 00864000
*      ELSE DO;                   /* ELSE:                           */ 00865000
         B     @RC00186                                            0188 00866000
@RF00186 DS    0H                                                  0189 00867000
*        /************************************************************/ 00868000
*        /*                                                          */ 00869000
*        /*     SEARCH ALL THE GROUP OCCURANCE POINTERS TO GET       */ 00870000
*        /*     FIND THE HIGHEST SEQUENCE NUMBER.                    */ 00871000
*        /*                                                          */ 00872000
*        /************************************************************/ 00873000
*                                                                  0189 00874000
*        WORKA=ADDR(CBKFGOP);     /* POINT AT THE FIRST GOP          */ 00875000
         L     WORKA,WKAFGOP(,R13)                                 0189 00876000
         LA    WORKA,CBKFGOP(,WORKA)                               0189 00877000
*                                 /* AFTER THE EXTENSION POINTR      */ 00878000
*        DO WORKB=1 TO CBKCTGOP;  /* LOOP WHILE THERE ARE STILL      */ 00879000
         LA    WORKB,1                                             0190 00880000
         B     @DE00190                                            0190 00881000
@DL00190 DS    0H                                                  0191 00882000
*                                 /* MORE GOP'S TO CHECK             */ 00883000
*                                                                  0191 00884000
*          /**********************************************************/ 00885000
*          /*                                                        */ 00886000
*          /*     IF THE GROUP CODE IS EQUAL TO THE DESIRED          */ 00887000
*          /*     GROUP CODE AND THE GROUP OCCURANCE POINTER         */ 00888000
*          /*     IS NOT DELETED THEN SAVE THE SEQUENCE NUMBER       */ 00889000
*          /*     BECAUSE IT MUST BE LARGER THAN THE LAST ONE.       */ 00890000
*          /*                                                        */ 00891000
*          /**********************************************************/ 00892000
*                                                                  0191 00893000
*          IF WKAGRPCD=(GOPINFO&CONTRUGC)                          0191 00894000
*                                 /* IF THE GROUP CODE OF THE        */ 00895000
*                                 /* GOP MATCHES THE DESIRED         */ 00896000
*            THEN DO;             /* THEN:                           */ 00897000
         MVC   @TS00001(1),GOPINFO(WORKA)                          0191 00898000
         NI    @TS00001,X'3F'                                      0191 00899000
         CLC   WKAGRPCD(1,R13),@TS00001                            0191 00900000
         BNE   @RF00191                                            0191 00901000
*              IF GOPDELET='0'B   /* IF GOP IS NOT DELETED           */ 00902000
*                THEN DO;         /* THEN:                           */ 00903000
         TM    GOPDELET(WORKA),B'01000000'                         0193 00904000
         BNZ   @RF00193                                            0193 00905000
*                  IF WKA1BSEQ='1'B                                0195 00906000
*                                 /* IF 1 BYTE SEQ NUMBERS ARE       */ 00907000
*                                 /* IN THE GOP                      */ 00908000
*                    THEN WKAHREPN=GOP1BSEQ;                       0195 00909000
         TM    WKA1BSEQ(R13),B'10000000'                           0195 00910000
         BNO   @RF00195                                            0195 00911000
         SLR   @03,@03                                             0196 00912000
         IC    @03,GOP1BSEQ(,WORKA)                                0196 00913000
         STH   @03,WKAHREPN(,R13)                                  0196 00914000
*                                 /* THEN: PICK UP THE 1 BYTE        */ 00915000
*                                 /*       SEQUENCE NUMBER           */ 00916000
*                    ELSE WKAHREPN=GOP2BSEQ;                       0197 00917000
         B     @RC00195                                            0197 00918000
@RF00195 MVC   WKAHREPN(2,R13),GOP2BSEQ(WORKA)                     0197 00919000
*                                 /* ELSE: PICK UP THE 2 BYTE        */ 00920000
*                                 /*       SEQUENCE NUMBER           */ 00921000
*                  END;           /*                                 */ 00922000
*                ELSE;            /* ELSE: CONTINUE                  */ 00923000
@RF00193 DS    0H                                                  0200 00924000
*              END;               /*                                 */ 00925000
*            ELSE;                /* ELSE: CONTINUE                  */ 00926000
*                                                                  0201 00927000
@RF00191 DS    0H                                                  0202 00928000
*          /**********************************************************/ 00929000
*          /*                                                        */ 00930000
*          /*     NOW THAT THIS GROUP OCCURANCE POINTER HAS          */ 00931000
*          /*     BEEN CHECKED POINT AT THE NEXT GROUP               */ 00932000
*          /*     OCCURANCE POINTER.                                 */ 00933000
*          /*                                                        */ 00934000
*          /**********************************************************/ 00935000
*                                                                  0202 00936000
*          WORKA=WORKA+WKAGOPLN;  /* POINT AT THE NEXT GOP           */ 00937000
@RC00191 AH    WORKA,WKAGOPLN(,R13)                                0202 00938000
*          END;                   /*                                 */ 00939000
         AH    WORKB,@CH00047                                      0203 00940000
@DE00190 L     @01,WKAFGOP(,R13)                                   0203 00941000
         SLR   @00,@00                                             0203 00942000
         IC    @00,CBKCTGOP(,@01)                                  0203 00943000
         CR    WORKB,@00                                           0203 00944000
         BNH   @DL00190                                            0203 00945000
*        /************************************************************/ 00946000
*        /*                                                          */ 00947000
*        /*     IF THERE IS AN EXTENSION POINTER THEN PLACE THE      */ 00948000
*        /*     EXTENSION C.I. NUMBER SO THAT NEXT TIME THE NEW      */ 00949000
*        /*     RECORD WILL BE SEARCHED. IF THERE IS NO EXTEN-       */ 00950000
*        /*     SION POINTER THEN USE THE SEQUENCE NUMBER THAT       */ 00951000
*        /*     HAS BEEN FOUND TO THIS POINT, AND INDICATE THAT      */ 00952000
*        /*     THE LOOP IS COMPLETE.                                */ 00953000
*        /*                                                          */ 00954000
*        /************************************************************/ 00955000
*                                                                  0204 00956000
*        IF CBKEXTCI=0            /* IF THE EXTENSION POINTER        */ 00957000
*                                 /* IS ZERO                         */ 00958000
*          THEN WKAEXITA='1'B;    /* THEN: INDICATE THAT LOOP        */ 00959000
         L     @01,WKAFGOP(,R13)                                   0204 00960000
         ICM   @00,7,CBKEXTCI(@01)                                 0204 00961000
         BNZ   @RF00204                                            0204 00962000
         OI    WKAEXITA(R13),B'00000100'                           0205 00963000
*                                 /*       IS COMPLETE               */ 00964000
*          ELSE WKANEXCI=CBKEXTCI;/* ELSE: SET UP THE CI NUMBER      */ 00965000
         B     @RC00204                                            0206 00966000
@RF00204 L     @01,WKAFGOP(,R13)                                   0206 00967000
         MVC   WKANEXCI(3,R13),CBKEXTCI(@01)                       0206 00968000
*                                 /*       OF THE NEXT BLOCK TO      */ 00969000
*                                 /*       CHECK                     */ 00970000
*        END;                     /*                                 */ 00971000
@RC00204 DS    0H                                                  0208 00972000
*    END;                         /*                                 */ 00973000
*                                                                  0208 00974000
@RC00186 DS    0H                                                  0208 00975000
@DE00184 TM    WKAEXITA(R13),B'00000100'                           0208 00976000
         BZ    @DL00184                                            0208 00977000
*  /******************************************************************/ 00978000
*  /*                                                                */ 00979000
*  /*     SETUP THE ADDRESS AND LENGTH SO THAT IT APPEARS THAT       */ 00980000
*  /*     THE INFORMATION IS A FIXED FIELD IN A CATALOG RECORD.      */ 00981000
*  /*                                                                */ 00982000
*  /******************************************************************/ 00983000
*                                                                  0209 00984000
*  WKAFNDLN=WKADTLEN;             /* SETUP THE LENGTH OF THE         */ 00985000
         SLR   @03,@03                                             0209 00986000
         IC    @03,WKADTLEN(,R13)                                  0209 00987000
         STH   @03,WKAFNDLN(,R13)                                  0209 00988000
*                                 /* DESIRED FIELD                   */ 00989000
*  WKAFNDAD=ADDR(WKAHREPN)+LENGTH(WKAHREPN)-WKADTLEN;              0210 00990000
         LA    @02,WKAHREPN(,R13)                                  0210 00991000
         AH    @02,@CH00200                                        0210 00992000
         SLR   @02,@03                                             0210 00993000
         ST    @02,WKAFNDAD(,R13)                                  0210 00994000
*                                 /* POINT AT THE FIELD OF THE       */ 00995000
*                                 /* DESIRED LENGTH                  */ 00996000
*                                                                  0211 00997000
*  /******************************************************************/ 00998000
*  /*                                                                */ 00999000
*  /*     SETUP THE RETURN ADDRESS TO ALLOW THE EXIT.                */ 01000000
*  /*                                                                */ 01001000
*  /******************************************************************/ 01002000
*                                                                  0211 01003000
*  R14=WKARTNA;                   /* RESTORE RETURN ADDRESS          */ 01004000
*                                                                  0211 01005000
         L     R14,WKARTNA(,R13)                                   0211 01006000
*  END PGREP;                     /* END OF PROCEDURE                */ 01007000
@EL00005 DS    0H                                                  0212 01008000
@EF00005 DS    0H                                                  0212 01009000
@ER00005 BR    @14                                                 0212 01010000
@PB00005 DS    0H                                                  0213 01011000
*  GEN(EJECT);                                                     0213 01012000
         EJECT                                                          01013000
*/********************************************************************/ 01014000
*/*                                                                  */ 01015000
*/*  PROCEDURE NAME = PGVAL                                          */ 01016000
*/*                                                                  */ 01017000
*/*  DESCRIPTIVE NAME = GET VALUE                                    */ 01018000
*/*                                                                  */ 01019000
*/*  FUNCTION =                                                      */ 01020000
*/*      THE DESIRED DATA IS FOUND IN PIECES AND RETURNED TO THE     */ 01021000
*/*      CALLER WITH THE FOLLOWING MEANING FOR THE COMBINATION       */ 01022000
*/*      OF THE RESULTANT INDICATORS:                                */ 01023000
*/*                                                                  */ 01024000
*/*        WKACMPLT='1'B & WKAFLDNE='0'B                             */ 01025000
*/*          FIELD IS COMPLETE                                       */ 01026000
*/*                                                                  */ 01027000
*/*        WKACMPLT='1'B & WKAFLDNE='1'B & WKAFLDNF='0'B             */ 01028000
*/*          THE SPECIFIED FIELD IS NOT FOUND                        */ 01029000
*/*                                                                  */ 01030000
*/*        WKACMPLT='1'B & WKAFLDNE='1'B & WKAFLDNF='1'B             */ 01031000
*/*          THE SPECIFIED GROUP CODE IS NOT FOUND                   */ 01032000
*/*                                                                  */ 01033000
*/*        WKACMPLT='0'B                                             */ 01034000
*/*          DATA IS PROVIDED FROM THE FIELD                         */ 01035000
*/*                                                                  */ 01036000
*/*      THE PROCESSING IS AS FOLLOWS:                               */ 01037000
*/*                                                                  */ 01038000
*/*      1. IF THE FIRST TIME THROUGH SET UP THE BASE CI NUMBER      */ 01039000
*/*         AS THE ONE TO BEGIN THE SEARCH. IF THIS IS NOT THE       */ 01040000
*/*         FIRST TIME THROUGH FOR THIS FIELD THEN USE THE           */ 01041000
*/*         CI NUMBER OF THE RETURNED EXTENSION POINTER TO           */ 01042000
*/*         CONTINUE THE SEARCH. IF THERE WAS NONE RETURNED          */ 01043000
*/*         THEN INDICATE FIELD IS COMPLETE.                         */ 01044000
*/*                                                                  */ 01045000
*/*      2. WITH THE DESIRED CI NUMBER, GET THE ADDRESSABILITY       */ 01046000
*/*         TO THE RECORD TO FIND THE FIELD IN.                      */ 01047000
*/*                                                                  */ 01048000
*/*      3. WITH THE DESIRED RECORD, FIND THE DESIRED DATA.          */ 01049000
*/*                                                                  */ 01050000
*/*      4. IF DATA RETURNED, THEN RETURN TO CALLER TO GIVE          */ 01051000
*/*         THIS PORTION OF THE FIELD. IF NO DATA RETURNED, THEN     */ 01052000
*/*         USE THE EXTENSION POINTER AND RETURN TO STEP 1.          */ 01053000
*/*                                                                  */ 01054000
*/*  ROUTINES CALLED =                                               */ 01055000
*/*      PGREC                                                       */ 01056000
*/*      PLVAL                                                       */ 01057000
*/*                                                                  */ 01058000
*/********************************************************************/ 01059000
*                                                                  0214 01060000
*PGVAL: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0214 01061000
         B     @PB00006                                            0214 01062000
PGVAL    DS    0H                                                  0215 01063000
*  /******************************************************************/ 01064000
*  /*                                                                */ 01065000
*  /*     BEGIN BY SAVING THE RETURN ADDRESS AND ASSUMING THAT       */ 01066000
*  /*     THE FIELD IS NOT COMPLETE.                                 */ 01067000
*  /*                                                                */ 01068000
*  /******************************************************************/ 01069000
*                                                                  0215 01070000
*  WKARTND=R14;                   /* SAVE THE RETURN ADDRESS         */ 01071000
         ST    R14,WKARTND(,R13)                                   0215 01072000
*  WKACMPLT='0'B;                 /* INDICATE THAT THE FIELD         */ 01073000
*                                 /* VALUE IS NOT COMPLETE           */ 01074000
*                                                                  0217 01075000
*  /******************************************************************/ 01076000
*  /*                                                                */ 01077000
*  /*     LOOP THROUGH THE CALLS TO PLVAL UNTIL THE FIELD IS         */ 01078000
*  /*     COMPLETE OR SOME DATA FOR THE CALLER IS PROVIDED.          */ 01079000
*  /*                                                                */ 01080000
*  /******************************************************************/ 01081000
*                                                                  0217 01082000
*  WKAEXITB='0'B;                 /* INDICATE THAT THE LOOP IS       */ 01083000
         NI    WKACMPLT(R13),B'11110101'                           0217 01084000
*                                 /* NOT COMPLETE                    */ 01085000
*  DO WHILE WKAEXITB='0'B;        /* LOOP TO HANDLE THE FIELD        */ 01086000
*                                                                  0218 01087000
         B     @DE00218                                            0218 01088000
@DL00218 DS    0H                                                  0219 01089000
*    /****************************************************************/ 01090000
*    /*                                                              */ 01091000
*    /*     CHECK TO SEE IF THE INCOMING CI NUMBER IS ZERO.          */ 01092000
*    /*     IF IT IS THEN EITHER THE BEGINING OF THE FIELD           */ 01093000
*    /*     HAS BEEN ENCOUNTERED AND THE BASE CI NUMBER SHOULD       */ 01094000
*    /*     BE USED TO START THE SEARCH, OR IT IS THE END AND        */ 01095000
*    /*     AN INDICATION THAT THE FIELD IS COMPLETE MUST BE         */ 01096000
*    /*     SETUP.                                                   */ 01097000
*    /****************************************************************/ 01098000
*                                                                  0219 01099000
*    IF WKANEXCI=0                /* IF THERE IS NO CI NUMBER        */ 01100000
*      THEN IF WKAGVFTS='1'B      /* THEN: IF THIS IS THE FIRST      */ 01101000
         ICM   @03,7,WKANEXCI(R13)                                 0219 01102000
         BNZ   @RF00219                                            0219 01103000
*                                 /*       TIME THROUGH              */ 01104000
*        THEN WKANEXCI=FMPLBCIN;  /* THEN: INITIALIZE THE CI         */ 01105000
         TM    WKAGVFTS(R13),B'00000100'                           0220 01106000
         BNO   @RF00220                                            0220 01107000
         MVC   WKANEXCI(3,R13),FMPLBCIN(FMPLAD)                    0221 01108000
*                                 /*       NUMBER TO SRART THE       */ 01109000
*                                 /*       SEARCH                    */ 01110000
*        ELSE DO;                 /* ELSE:                           */ 01111000
         B     @RC00220                                            0222 01112000
@RF00220 DS    0H                                                  0223 01113000
*          WKAEXITB='1'B;         /* INDICATE THAT THE SEARCH        */ 01114000
*                                 /* FOR THE FIELD IS COMPLETE       */ 01115000
*          WKACMPLT='1'B;         /* INDICATE THAT THE FIELD IS      */ 01116000
*                                 /* COMPLETE                        */ 01117000
*          WKAFLDNE='0'B;         /* INDICATE THAT THE FIELD         */ 01118000
         OI    WKAEXITB(R13),B'00001010'                           0225 01119000
         NI    WKAFLDNE(R13),B'10111111'                           0225 01120000
*                                 /* DOES EXIST                      */ 01121000
*          END;                   /*                                 */ 01122000
*      ELSE;                      /* ELSE: CONTINUE                  */ 01123000
@RF00219 DS    0H                                                  0228 01124000
*    /****************************************************************/ 01125000
*    /*                                                              */ 01126000
*    /*     CHECK TO SEE IF THE FIELD IS COMPLETE OR IF IT           */ 01127000
*    /*     IS STILL BEING PROCESSED.                                */ 01128000
*    /*                                                              */ 01129000
*    /****************************************************************/ 01130000
*                                                                  0228 01131000
*    IF WKAEXITB='0'B             /* IF THE SEARCH IS REQUIRED       */ 01132000
*      THEN DO;                   /* THEN:                           */ 01133000
*                                                                  0228 01134000
@RC00219 TM    WKAEXITB(R13),B'00000010'                           0228 01135000
         BNZ   @RF00228                                            0228 01136000
*        /************************************************************/ 01137000
*        /*                                                          */ 01138000
*        /*     GO TO GET THE DESIRED CI NUMBERED RECORD SO          */ 01139000
*        /*     THAT IT CAN BE SCANED FOR THE DESIRED FIELD.         */ 01140000
*        /*                                                          */ 01141000
*        /************************************************************/ 01142000
*                                                                  0230 01143000
*        CALL PGREC;              /* GET THE DESIRED RECORD          */ 01144000
         BAL   @14,PGREC                                           0230 01145000
*        IF WKARECFN='1'B         /* IF THE DESIRED RECORD WAS       */ 01146000
*                                 /* RETURNED                        */ 01147000
*          THEN CALL PLVAL;       /* THEN: LOCATE THE DESIRED        */ 01148000
         TM    WKARECFN(R13),B'10000000'                           0231 01149000
         BNO   @RF00231                                            0231 01150000
         BAL   @14,PLVAL                                           0232 01151000
*                                 /*       VALUE                     */ 01152000
*          ELSE DO;               /* ELSE:                           */ 01153000
         B     @RC00231                                            0233 01154000
@RF00231 DS    0H                                                  0234 01155000
*            WKAFLDNE='1'B;       /* INDICATE THAT THE FIELD         */ 01156000
*                                 /* DOES NOT EXIST                  */ 01157000
*            WKAFLDNF='1'B;       /* INDICATE THAT THE GROUP         */ 01158000
         OI    WKAFLDNE(R13),B'01100000'                           0235 01159000
*                                 /* CODE IS NOT FOUND               */ 01160000
*            END;                 /*                                 */ 01161000
*        IF WKAFLDNE='1'B                                          0237 01162000
*                                 /* IF THE FIELD DOES NOT           */ 01163000
*                                 /* EXIST                           */ 01164000
*          THEN DO;               /* THEN:                           */ 01165000
@RC00231 TM    WKAFLDNE(R13),B'01000000'                           0237 01166000
         BNO   @RF00237                                            0237 01167000
*            WKAEXITB='1'B;       /* INDICATE THAT THE SEARCH        */ 01168000
*                                 /* IS COMPLETE                     */ 01169000
*            WKACMPLT='1'B;       /* INDICATE THAT THE FIELD         */ 01170000
         OI    WKAEXITB(R13),B'00001010'                           0240 01171000
*                                 /* DOES NOT CONTINUE               */ 01172000
*            END;                 /*                                 */ 01173000
*          ELSE IF WKAFLDNF='1'B  /* ELSE: IF THERE IS NO DATA       */ 01174000
*                                 /*       TO RETURN TO THE          */ 01175000
*                                 /*       CALLER                    */ 01176000
*            THEN;                /* THEN: CONTINUE                  */ 01177000
         B     @RC00237                                            0242 01178000
@RF00237 TM    WKAFLDNF(R13),B'00100000'                           0242 01179000
         BO    @RT00242                                            0242 01180000
*            ELSE WKAEXITB='1'B;  /* ELSE: RETURN THE DATA TO        */ 01181000
         OI    WKAEXITB(R13),B'00000010'                           0244 01182000
*                                 /*       THE CALLER                */ 01183000
*        END;                     /*                                 */ 01184000
*      ELSE;                      /* ELSE: CONTINUE                  */ 01185000
@RF00228 DS    0H                                                  0247 01186000
*    END;                         /*                                 */ 01187000
@RC00228 DS    0H                                                  0247 01188000
@DE00218 TM    WKAEXITB(R13),B'00000010'                           0247 01189000
         BZ    @DL00218                                            0247 01190000
*  WKAGVFTS='0'B;                 /* CLEAR THE FIRST TIME            */ 01191000
         NI    WKAGVFTS(R13),B'11111011'                           0248 01192000
*                                 /* SWITCH                          */ 01193000
*                                                                  0249 01194000
*  /******************************************************************/ 01195000
*  /*                                                                */ 01196000
*  /*    SET UP THE RETURN ADDRESS TO ALLOW EXIT                     */ 01197000
*  /*                                                                */ 01198000
*  /******************************************************************/ 01199000
*                                                                  0249 01200000
*  R14=WKARTND;                   /* RESTORE THE RETURN ADDRESS      */ 01201000
         L     R14,WKARTND(,R13)                                   0249 01202000
*  END PGVAL;                     /* END OF PROCEDURE                */ 01203000
@EL00006 DS    0H                                                  0250 01204000
@EF00006 DS    0H                                                  0250 01205000
@ER00006 BR    @14                                                 0250 01206000
@PB00006 DS    0H                                                  0251 01207000
*  GEN(EJECT);                                                     0251 01208000
         EJECT                                                          01209000
*/********************************************************************/ 01210000
*/*                                                                  */ 01211000
*/*  PROCEDURE NAME = PLNRV                                          */ 01212000
*/*                                                                  */ 01213000
*/*  DESCRIPTIVE NAME = LOCATE NON-REPLICATED VALUES                 */ 01214000
*/*                                                                  */ 01215000
*/*  FUNCTION =                                                      */ 01216000
*/*      THIS ROUTINE LOCATES THE NON-REPLICATED DATA THAT IS        */ 01217000
*/*      DESIRED BY THE CALLER.  THE PROCESSING IS AS FOLLOWS:       */ 01218000
*/*                                                                  */ 01219000
*/*      1. IF THE REQUEST IS FOR OTHER THAN THE FIRST SEQUENCE      */ 01220000
*/*         NUMBER THE GROUP CODE IS NOT FOUND.                      */ 01221000
*/*                                                                  */ 01222000
*/*      2. CHECK TO SEE IF THE DESIRED IS PRESENT. IF NOT THEN      */ 01223000
*/*         INDICATE FIELD NOT FOUND.                                */ 01224000
*/*                                                                  */ 01225000
*/*      3. RETURN THE ADDRESS AND THE LENGTH OF THE DESIRED         */ 01226000
*/*         DATA.                                                    */ 01227000
*/*                                                                  */ 01228000
*/*  ROUTINES CALLED                                                 */ 01229000
*/*      PCKLC                                                       */ 01230000
*/*                                                                  */ 01231000
*/********************************************************************/ 01232000
*                                                                  0252 01233000
*PLNRV: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0252 01234000
*                                                                  0252 01235000
         B     @PB00007                                            0252 01236000
PLNRV    DS    0H                                                  0253 01237000
*  /******************************************************************/ 01238000
*  /*                                                                */ 01239000
*  /*    SAVE THE RETURN ADDRESS ON ENTRY                            */ 01240000
*  /*                                                                */ 01241000
*  /******************************************************************/ 01242000
*                                                                  0253 01243000
*  WKARTNH=R14;                   /* SAVE THE RETURN ADDRESS         */ 01244000
*                                                                  0253 01245000
         ST    R14,WKARTNH(,R13)                                   0253 01246000
*  /******************************************************************/ 01247000
*  /*                                                                */ 01248000
*  /*    HANDLE THE CASE WHERE IT IS FOR THE CORRECT RELREPNO        */ 01249000
*  /*                                                                */ 01250000
*  /******************************************************************/ 01251000
*                                                                  0254 01252000
*  IF WKADRRNO=1                  /* IF THIS IS THE FIRST TIME       */ 01253000
*                                 /* FOR THIS DATA                   */ 01254000
*    THEN DO;                     /* THEN:                           */ 01255000
         CLC   WKADRRNO(2,R13),@CH00047                            0254 01256000
         BNE   @RF00254                                            0254 01257000
*      WKAFLDNF='0'B;             /* INDICATE THAT THE GROUP         */ 01258000
         NI    WKAFLDNF(R13),B'11011111'                           0256 01259000
*                                 /* HAS BEEN FOUND                  */ 01260000
*      WORKD=ADDR(CBKNVLF);       /* POINT AT HEADER GROUP           */ 01261000
         L     WORKD,WKABLKAD(,R13)                                0257 01262000
         LA    WORKD,CBKNVLF(,WORKD)                               0257 01263000
*                                 /* OCCURANCE                       */ 01264000
*      CALL PCKLC;                /* GO TO CHECK THE EXISTANCE       */ 01265000
         BAL   @14,PCKLC                                           0258 01266000
*                                 /* OF THE DATA                     */ 01267000
*      /**************************************************************/ 01268000
*      /*                                                            */ 01269000
*      /*    HANDLE THE CASE WHERE THE FIELD DOES NOT EXIST          */ 01270000
*      /*                                                            */ 01271000
*      /**************************************************************/ 01272000
*                                                                  0259 01273000
*      IF WKAFLDNE='1'B           /* IF THE FIELD DOES NOT           */ 01274000
*                                 /* EXIST                           */ 01275000
*        THEN;                    /* THEN: CONTINUE                  */ 01276000
*                                                                  0259 01277000
         TM    WKAFLDNE(R13),B'01000000'                           0259 01278000
         BO    @RT00259                                            0259 01279000
*        /************************************************************/ 01280000
*        /*                                                          */ 01281000
*        /*    HANDLE THE CASE WHERE THE DATA DOES EXIST             */ 01282000
*        /*                                                          */ 01283000
*        /************************************************************/ 01284000
*                                                                  0261 01285000
*        ELSE DO;                 /* ELSE:                           */ 01286000
*          IF WKADTVAR='0'B       /* IF NOT VARIABLE LENGTH          */ 01287000
*                                 /* FIELD                           */ 01288000
*            THEN DO;             /* THEN:                           */ 01289000
         TM    WKADTVAR(R13),B'10000000'                           0262 01290000
         BNZ   @RF00262                                            0262 01291000
*              WKAFNDAD=ADDR(CBKRD1)+WKADTSTR;                     0264 01292000
         SLR   @03,@03                                             0264 01293000
         IC    @03,WKADTSTR(,R13)                                  0264 01294000
         AL    @03,WKABLKAD(,R13)                                  0264 01295000
         ST    @03,WKAFNDAD(,R13)                                  0264 01296000
*                                 /* POINT AT THE FIXED FIELD        */ 01297000
*              END;               /*                                 */ 01298000
*            ELSE DO;             /* ELSE:                           */ 01299000
         B     @RC00262                                            0266 01300000
@RF00262 DS    0H                                                  0267 01301000
*              WORKA=ADDR(CBKRD1)+CBKLOFX;                         0267 01302000
         L     @03,WKABLKAD(,R13)                                  0267 01303000
         SLR   WORKA,WORKA                                         0267 01304000
         IC    WORKA,CBKLOFX(,@03)                                 0267 01305000
         ALR   WORKA,@03                                           0267 01306000
*                                 /* POINT AT THE FIRST              */ 01307000
*                                 /* VARIABLE LENGTH FIELD           */ 01308000
*              DO WORKB=2 TO WKADTLEN;                             0268 01309000
         LA    WORKB,2                                             0268 01310000
         B     @DE00268                                            0268 01311000
@DL00268 DS    0H                                                  0269 01312000
*                                 /* LOOP TO FIND THE CORRECT        */ 01313000
*                                 /* FIELD                           */ 01314000
*                WORKA=ADDR(CBKDATA)+CBKVRLEN;                     0269 01315000
         LA    @03,CBKDATA(,WORKA)                                 0269 01316000
         AH    @03,CBKVRLEN(,WORKA)                                0269 01317000
         LR    WORKA,@03                                           0269 01318000
*                                 /* POINT AT THE NEXT FIELD         */ 01319000
*                END;             /*                                 */ 01320000
         AH    WORKB,@CH00047                                      0270 01321000
@DE00268 SLR   @03,@03                                             0270 01322000
         IC    @03,WKADTLEN(,R13)                                  0270 01323000
         CR    WORKB,@03                                           0270 01324000
         BNH   @DL00268                                            0270 01325000
*              WKAFNDLN=CBKVRLEN+LENGTH(CBKVRLEN);                 0271 01326000
         LA    @03,2                                               0271 01327000
         AH    @03,CBKVRLEN(,WORKA)                                0271 01328000
         STH   @03,WKAFNDLN(,R13)                                  0271 01329000
*                                 /* INDICATE THE LENGTH OF THE      */ 01330000
*                                 /* DESIRED FIELD                   */ 01331000
*              WKAFNDAD=WORKA;    /* POINT AT THE DESIRED FIELD      */ 01332000
         ST    WORKA,WKAFNDAD(,R13)                                0272 01333000
*              END;               /*                                 */ 01334000
*          END;                   /*                                 */ 01335000
*        END;                     /*                                 */ 01336000
*    /****************************************************************/ 01337000
*    /*                                                              */ 01338000
*    /*    HANDLE THE CASE WHERE THIS IS NOT RELREPNO NUMBER 1       */ 01339000
*    /*                                                              */ 01340000
*    /****************************************************************/ 01341000
*                                                                  0276 01342000
*    ELSE DO;                     /* ELSE:                           */ 01343000
         B     @RC00254                                            0276 01344000
@RF00254 DS    0H                                                  0277 01345000
*      WKAFLDNE='1'B;             /* INDICATE THAT THE FIELD         */ 01346000
*                                 /* DOES NOT EXIST                  */ 01347000
*      WKAFLDNF='1'B;             /* INDICATE THAT THE GROUP         */ 01348000
         OI    WKAFLDNE(R13),B'01100000'                           0278 01349000
*                                 /* CODE IS NOT FOUND               */ 01350000
*      END;                       /*                                 */ 01351000
*  /******************************************************************/ 01352000
*  /*                                                                */ 01353000
*  /*    SET UP THE RETURN ADDRESS TO ALLOW EXIT                     */ 01354000
*  /*                                                                */ 01355000
*  /******************************************************************/ 01356000
*                                                                  0280 01357000
*  R14=WKARTNH;                   /* RESTORE THE RETURN ADDRESS      */ 01358000
@RC00254 L     R14,WKARTNH(,R13)                                   0280 01359000
*  END PLNRV;                     /* END OF PROCEDURE                */ 01360000
@EL00007 DS    0H                                                  0281 01361000
@EF00007 DS    0H                                                  0281 01362000
@ER00007 BR    @14                                                 0281 01363000
@PB00007 DS    0H                                                  0282 01364000
*  GEN(EJECT);                                                     0282 01365000
         EJECT                                                          01366000
*/********************************************************************/ 01367000
*/*                                                                  */ 01368000
*/*  PROCEDURE NAME = PLOC2                                          */ 01369000
*/*                                                                  */ 01370000
*/*  DESCRIPTIVE NAME = LOCATE FIELD                                 */ 01371000
*/*                                                                  */ 01372000
*/*  FUNCTION =                                                      */ 01373000
*/*      THIS ROUTINE PLACES THE DESIRED FIELD IN THE OUTPUT         */ 01374000
*/*      AREA AND UPDATES THE FMFL TO INDICATE THAT IT IS            */ 01375000
*/*      PRESENT. THE PROCESSING IS AS FOLLOWS:                      */ 01376000
*/*                                                                  */ 01377000
*/*      1. A LOOP IS BEGUN TO INSURE THAT THE FOLLOWING IS          */ 01378000
*/*         DONE FOR ALL THE PORTIONS OF THE COMBINATION NAME.       */ 01379000
*/*                                                                  */ 01380000
*/*        1.1 IF THE FIELD IS FOR REPNO THEN THE NUMBER OF          */ 01381000
*/*            THE HIGHEST NON-DELETED SEQUENCE NUMBER IS            */ 01382000
*/*            OBTAINED AND PLACED IN THE OUTPUT AREA.               */ 01383000
*/*                                                                  */ 01384000
*/*        1.2 A LOOP IS BEGUN TO INSURE THAT THE COMPLETE FIELD     */ 01385000
*/*            IS OBTAINED.                                          */ 01386000
*/*                                                                  */ 01387000
*/*           1.2.1 FIND THE NEXT PORTION OF THE DESIRED FIELD.      */ 01388000
*/*                                                                  */ 01389000
*/*           1.2.2 PLACE THAT PORTION INTO THE OUTPUT AREA.         */ 01390000
*/*                                                                  */ 01391000
*/*           1.2.3 UPDATE THE FMFL AS REQUIRED.                     */ 01392000
*/*                                                                  */ 01393000
*/*  ROUTINES CALLED                                                 */ 01394000
*/*      PGVAL                                                       */ 01395000
*/*      PGREP                                                       */ 01396000
*/*      PSHIN                                                       */ 01397000
*/*                                                                  */ 01398000
*/********************************************************************/ 01399000
*                                                                  0283 01400000
*PLOC2: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0283 01401000
*                                                                  0283 01402000
         B     @PB00008                                            0283 01403000
PLOC2    DS    0H                                                  0284 01404000
*  /******************************************************************/ 01405000
*  /*                                                                */ 01406000
*  /*    SAVE THE RETURN ADDRESS ON ENTRY AND DO INITIALIZATION      */ 01407000
*  /*                                                                */ 01408000
*  /******************************************************************/ 01409000
*                                                                  0284 01410000
*  WKARTNG=R14;                   /* SAVE THE RETURN ADDRESS         */ 01411000
         ST    R14,WKARTNG(,R13)                                   0284 01412000
*  WKACOMBC=0;                    /* INITIALIZE THE COMBINATION      */ 01413000
         SLR   @03,@03                                             0285 01414000
         STH   @03,WKACOMBC(,R13)                                  0285 01415000
*                                 /* INDEX VALUE                     */ 01416000
*  WKAEXITD='0'B;                 /* INDICATE THE LOOP IS NOT        */ 01417000
         NI    WKAEXITD(R13),B'01111111'                           0286 01418000
*                                 /* COMPLETE                        */ 01419000
*  /******************************************************************/ 01420000
*  /*                                                                */ 01421000
*  /*    LOOP UNTIL THE FIELD IS COMPLETELY PROCESSED                */ 01422000
*  /*                                                                */ 01423000
*  /******************************************************************/ 01424000
*                                                                  0287 01425000
*  DO WHILE WKAEXITD='0'B;        /* LOOP UNTIL THE FIELD IS         */ 01426000
         B     @DE00287                                            0287 01427000
@DL00287 DS    0H                                                  0288 01428000
*                                 /* COMPLETELY PLACED               */ 01429000
*    WKADICTD=FMFLWKAR;           /* PLACE THE DICTIONARY            */ 01430000
         MVC   WKADICTD(4,R13),FMFLWKAR(FMFLCUR)                   0288 01431000
*                                 /* INFORMATION IN WORK AREA        */ 01432000
*                                                                  0289 01433000
*    /****************************************************************/ 01434000
*    /*                                                              */ 01435000
*    /*    HANDLE THE CHARACTERISTICS OF THE COMBINATION FIELD       */ 01436000
*    /*                                                              */ 01437000
*    /****************************************************************/ 01438000
*                                                                  0289 01439000
*    IF WKADTCMB='1'B             /* IF THIS IS A COMBINATION        */ 01440000
*                                 /* FIELD NAME                      */ 01441000
*      THEN DO;                   /* THEN:                           */ 01442000
         TM    WKADTCMB(R13),B'00100000'                           0289 01443000
         BNO   @RF00289                                            0289 01444000
*        WKACOMBC=WKACOMBC+1;     /* INCREMENT THE COMBINATION       */ 01445000
         LA    @03,1                                               0291 01446000
         AH    @03,WKACOMBC(,R13)                                  0291 01447000
         STH   @03,WKACOMBC(,R13)                                  0291 01448000
*                                 /* INDEX VALUE                     */ 01449000
*        IF WKACOMBC>=WKADTLEN    /* IF THE LAST FIELD HAS JUST      */ 01450000
*                                 /* BEEN POINTED AT                 */ 01451000
*          THEN WKAEXITD='1'B;    /* THEN: INDICATE THAT THE         */ 01452000
         SLR   @02,@02                                             0292 01453000
         IC    @02,WKADTLEN(,R13)                                  0292 01454000
         CR    @03,@02                                             0292 01455000
         BL    @RF00292                                            0292 01456000
         OI    WKAEXITD(R13),B'10000000'                           0293 01457000
*                                 /*       LOOP IS COMPLETE          */ 01458000
*          ELSE;                  /* ELSE: CONTINUE                  */ 01459000
@RF00292 DS    0H                                                  0295 01460000
*        WKASVGRC=WKAGRPCD;       /* SAVE THE GROUP CODE FOR         */ 01461000
         MVC   WKASVGRC(1,R13),WKAGRPCD(R13)                       0295 01462000
*                                 /* ANY SPECIAL FIELD NAMES         */ 01463000
*                                 /* THAT FOLLOW                     */ 01464000
*        WORKA=ADDR(DCT(DCTCMB(WKACOMBC+WKADTSTR)));               0296 01465000
         SLR   @03,@03                                             0296 01466000
         IC    @03,WKADTSTR(,R13)                                  0296 01467000
         AH    @03,WKACOMBC(,R13)                                  0296 01468000
         L     @01,WKACOMBT(,R13)                                  0296 01469000
         BCTR  @01,0                                               0296 01470000
         SLR   @02,@02                                             0296 01471000
         IC    @02,DCTCMB(@03,@01)                                 0296 01472000
         SLA   @02,3                                               0296 01473000
         L     WORKA,WKADICTT(,R13)                                0296 01474000
         AL    WORKA,@CF00343                                      0296 01475000
         LA    WORKA,DCT(@02,WORKA)                                0296 01476000
*                                 /* POINT AT THE ENTRY TO GET       */ 01477000
*                                 /* THE DESIRED INFORMATION         */ 01478000
*        WKADICTD=DCTDINFO;                                        0297 01479000
         MVC   WKADICTD(4,R13),DCTDINFO(WORKA)                     0297 01480000
*                                 /* GET THE PRESENT DICTIONARY      */ 01481000
*                                 /* INFORMATION FOR THIS FIELD      */ 01482000
*        IF WKADTSPL='1'B         /* IF THIS IS A SPECIAL FIELD      */ 01483000
*          THEN WKAGRPCD=WKASVGRC;/* THEN: GET THE GROUP CODE        */ 01484000
         TM    WKADTSPL(R13),B'00000001'                           0298 01485000
         BNO   @RF00298                                            0298 01486000
         MVC   WKAGRPCD(1,R13),WKASVGRC(R13)                       0299 01487000
*                                 /*       FROM COMBINATION          */ 01488000
*                                 /*       NAME                      */ 01489000
*          ELSE;                  /* ELSE: CONTINUE                  */ 01490000
@RF00298 DS    0H                                                  0301 01491000
*        END;                     /*                                 */ 01492000
*                                                                  0301 01493000
*      /**************************************************************/ 01494000
*      /*                                                            */ 01495000
*      /*    HANDLE THE CHARACTERISTICS OF THE SIMPLE FIELD          */ 01496000
*      /*                                                            */ 01497000
*      /**************************************************************/ 01498000
*                                                                  0302 01499000
*      ELSE WKAEXITD='1'B;        /* ELSE: INDICATE THAT THE         */ 01500000
         B     @RC00289                                            0302 01501000
@RF00289 OI    WKAEXITD(R13),B'10000000'                           0302 01502000
*                                 /*       ONE FIELD IS ALL          */ 01503000
*                                 /*       THAT IS NEEDED            */ 01504000
*    /****************************************************************/ 01505000
*    /*                                                              */ 01506000
*    /*    HANDLE THE REPNO FUNCTION                                 */ 01507000
*    /*                                                              */ 01508000
*    /****************************************************************/ 01509000
*                                                                  0303 01510000
*    IF WKADTSPL='1'B & WKADTSTR=CONREPNO                          0303 01511000
*                                 /* IF THE FIELD NAME WAS           */ 01512000
*                                 /* REPNO                           */ 01513000
*      THEN IF WKADRRNO=1 | FMFLTCHN^=0                            0303 01514000
@RC00289 TM    WKADTSPL(R13),B'00000001'                           0303 01515000
         BNO   @RF00303                                            0303 01516000
         CLI   WKADTSTR(R13),X'04'                                 0303 01517000
         BNE   @RF00303                                            0303 01518000
*                                 /* THEN: IF THIS IS THE FIRST      */ 01519000
*                                 /*       TIME FOR THIS DATA        */ 01520000
*                                 /*       OR THERE IS A TEST        */ 01521000
*                                 /*       CHAIN                     */ 01522000
*        THEN DO;                 /* THEN:                           */ 01523000
         CLC   WKADRRNO(2,R13),@CH00047                            0304 01524000
         BE    @RT00304                                            0304 01525000
         ICM   @03,15,FMFLTCHN(FMFLCUR)                            0304 01526000
         BZ    @RF00304                                            0304 01527000
@RT00304 DS    0H                                                  0305 01528000
*          CALL PGREP;            /* GET THE HIGHEST NON-            */ 01529000
         BAL   @14,PGREP                                           0306 01530000
*                                 /* DELETED RELREPNO FOR THE        */ 01531000
*                                 /* DESIRED GROUP CODE              */ 01532000
*          WKAFLDNE='0'B;         /* INDICATE THAT THE FIELD         */ 01533000
*                                 /* DOES EXIST                      */ 01534000
*          WKACMPLT='0'B;         /* INDICATE THAT THE FIELD IS      */ 01535000
         NI    WKAFLDNE(R13),B'10110111'                           0308 01536000
*                                 /* IS NOT COMPLETE                 */ 01537000
*          WKACONFG='0'B;         /* INDICATE THAT THIS IS THE       */ 01538000
         NI    WKACONFG(R13),B'11111101'                           0309 01539000
*                                 /* FIRST TIME THROUGH PSHIN        */ 01540000
*          CALL PSHIN;            /* PLACE THE RESULTANT VALUE       */ 01541000
         BAL   @14,PSHIN                                           0310 01542000
*                                 /* IN THE WORK AREA                */ 01543000
*          WKACMPLT='1'B;         /* INDICATE THAT THE FIELD IS      */ 01544000
         OI    WKACMPLT(R13),B'00001000'                           0311 01545000
*                                 /* COMPLETE                        */ 01546000
*          END;                   /*                                 */ 01547000
*        ELSE DO;                 /* ELSE:                           */ 01548000
         B     @RC00304                                            0313 01549000
@RF00304 DS    0H                                                  0314 01550000
*          WKACMPLT='1'B;         /* INDICATE THAT THE FIELD         */ 01551000
*                                 /* IS COMPLETE                     */ 01552000
*          WKAFLDNE='1'B;         /* INDICATE THAT THE FIELD         */ 01553000
*                                 /* DOES NOT EXIST                  */ 01554000
*          WKAFLDNF='1'B;         /* INDICATE THAT THE GROUP         */ 01555000
         OI    WKACMPLT(R13),B'01101000'                           0316 01556000
*                                 /* CODE IS NOT FOUND               */ 01557000
*          END;                   /*                                 */ 01558000
*      /**************************************************************/ 01559000
*      /*                                                            */ 01560000
*      /*    HANDLE THE PLACEMENT OF THE DATA FOR ALL BUT THE        */ 01561000
*      /*    REPNO FUNCTION                                          */ 01562000
*      /*                                                            */ 01563000
*      /**************************************************************/ 01564000
*                                                                  0318 01565000
*      ELSE DO;                   /* ELSE: CONTINUE                  */ 01566000
         B     @RC00303                                            0318 01567000
@RF00303 DS    0H                                                  0319 01568000
*        WKANEXCI=0;              /* ZERO THE CI NUMBER SO THAT      */ 01569000
         SLR   @03,@03                                             0319 01570000
         STCM  @03,7,WKANEXCI(R13)                                 0319 01571000
*                                 /* THE BASE CI NUMBER WILL BE      */ 01572000
*                                 /* USED TO START THE SEARCH        */ 01573000
*        WKACONFG='0'B;           /* INDICATE THAT THIS IS THE       */ 01574000
*                                 /* FIRST TIME THROUGH PSHIN        */ 01575000
*        WKAGVFTS='1'B;           /* INDICATE THAT THIS IS THE       */ 01576000
         OI    WKAGVFTS(R13),B'00000100'                           0321 01577000
         NI    WKACONFG(R13),B'11111101'                           0321 01578000
*                                 /* FIRST TIME TO PGVAL FOR         */ 01579000
*                                 /* THIS FIELD                      */ 01580000
*        WKACMPLT='0'B;           /* INDICATE THAT THE FIELD         */ 01581000
         NI    WKACMPLT(R13),B'11110111'                           0322 01582000
*                                 /* HAS NOT BEEN COMPLETELY         */ 01583000
*                                 /* MOVED                           */ 01584000
*        DO WHILE WKACMPLT='0'B;  /* LOOP UNTIL THE FIELD HAS        */ 01585000
         B     @DE00323                                            0323 01586000
@DL00323 DS    0H                                                  0324 01587000
*                                 /* BEEN PLACED                     */ 01588000
*          CALL PGVAL;            /* GET THIS PORTION OF THE         */ 01589000
         BAL   @14,PGVAL                                           0324 01590000
*                                 /* FIELD                           */ 01591000
*          IF WKACMPLT='1'B & WKAFLDNE='1'B & WKAFLDNF='1'B        0325 01592000
*                                 /* IF THE GROUP CODE COULD         */ 01593000
*                                 /* NOT BE FOUND                    */ 01594000
*            THEN;                /* THEN: CONTINUE                  */ 01595000
         TM    WKACMPLT(R13),B'01101000'                           0325 01596000
         BO    @RT00325                                            0325 01597000
*            ELSE CALL PSHIN;     /* ELSE: PLACE THE FIELD IN        */ 01598000
         BAL   @14,PSHIN                                           0327 01599000
*                                 /*       THE WORK AREA             */ 01600000
*          WKACONFG='1'B;         /* INDICATE THAT THIS IS THE       */ 01601000
@RT00325 OI    WKACONFG(R13),B'00000010'                           0328 01602000
*                                 /* N-TH TIME THROUGH PSHIN         */ 01603000
*                                 /* FOR THIS FIELD                  */ 01604000
*          END;                   /*                                 */ 01605000
@DE00323 TM    WKACMPLT(R13),B'00001000'                           0329 01606000
         BZ    @DL00323                                            0329 01607000
*        END;                     /*                                 */ 01608000
*    END;                         /*                                 */ 01609000
*                                                                  0331 01610000
@RC00303 DS    0H                                                  0331 01611000
@DE00287 TM    WKAEXITD(R13),B'10000000'                           0331 01612000
         BZ    @DL00287                                            0331 01613000
*  /******************************************************************/ 01614000
*  /*                                                                */ 01615000
*  /*    SET UP THE RETURN ADDRESS TO ALLOW EXIT                     */ 01616000
*  /*                                                                */ 01617000
*  /******************************************************************/ 01618000
*                                                                  0332 01619000
*  R14=WKARTNG;                   /* RESTORE THE RETURN ADDRESS      */ 01620000
         L     R14,WKARTNG(,R13)                                   0332 01621000
*  END PLOC2;                     /* END OF PROCEDURE                */ 01622000
@EL00008 DS    0H                                                  0333 01623000
@EF00008 DS    0H                                                  0333 01624000
@ER00008 BR    @14                                                 0333 01625000
@PB00008 DS    0H                                                  0334 01626000
*  GEN(EJECT);                                                     0334 01627000
         EJECT                                                          01628000
*/********************************************************************/ 01629000
*/*                                                                  */ 01630000
*/*  PROCEDURE NAME = PLVAL                                          */ 01631000
*/*                                                                  */ 01632000
*/*  DESCRIPTIVE NAME = LOCATE FIELD VALUE                           */ 01633000
*/*                                                                  */ 01634000
*/*  FUNCTION =                                                      */ 01635000
*/*      THIS SUB-FUNCTION LOCATES A REPEATING OR NON-REPEATING      */ 01636000
*/*      FIXED LENGTH OF VARIABLE LENGTH CATALOG FIELD WITHIN        */ 01637000
*/*      A GIVEN PHYSICAL RECORD AND IN A PARTICULAR GROUP           */ 01638000
*/*      OCCURANCE.                                                  */ 01639000
*/*                                                                  */ 01640000
*/*      THE FOLLOWING IS THE MEANING OF THE COMBINATION OF THE      */ 01641000
*/*      RESULTANT INDICATORS:                                       */ 01642000
*/*                                                                  */ 01643000
*/*        WKAFLDNE='0'B & WKAFLDNF='0'B                             */ 01644000
*/*          FIELD DATA AND MAYBE AN EXTENSION POINTER               */ 01645000
*/*                                                                  */ 01646000
*/*        WKAFLDNE='0'B & WKAFLDNF='1'B                             */ 01647000
*/*          EXTENSION POINTER                                       */ 01648000
*/*                                                                  */ 01649000
*/*        WKAFLDNE='1'B & WKAFLDNF='0'B                             */ 01650000
*/*          SPECIFIED FIELD NOT FOUND                               */ 01651000
*/*                                                                  */ 01652000
*/*        WKAFLDNE='1'B & WKAFLDNF='1'B                             */ 01653000
*/*          SPECIFIED GROUP CODE NOT FOUND                          */ 01654000
*/*                                                                  */ 01655000
*/*      THE PROCESSING IS AS FOLLOWS:                               */ 01656000
*/*                                                                  */ 01657000
*/*      1. IF THE FIELD IS NON-REPEATING, CALL PCKLC TO SEE IF      */ 01658000
*/*         THE FIELD EXISTS. IF IT DOES THEN LOCATE THE FIELD,      */ 01659000
*/*         ELSE INDICATE FIELD IS NOT EXISTENT.                     */ 01660000
*/*                                                                  */ 01661000
*/*      2. OTHERWISE, SCAN THE GROUP OCCURANCE POINTERS FOR         */ 01662000
*/*         DESIRED OCCURANCE SEQUENCE NUMBER (DELETED SEQUENCE      */ 01663000
*/*         NUMBERS ARE SKIPPED).                                    */ 01664000
*/*                                                                  */ 01665000
*/*         IF THE CORRECT OCCURANCE IS NOT FORND THEN SET           */ 01666000
*/*         THE FIELD NOT EXISTENT INDICATOR.                        */ 01667000
*/*                                                                  */ 01668000
*/*         IF THE FIELD IS RELREPNO THEN PASS THE UPDATED           */ 01669000
*/*         OCCURANCE SEQUENCE NUMBER.                               */ 01670000
*/*                                                                  */ 01671000
*/*         IF THE OCCURANCE POINTER POINTS TO ANOTHER PHYSICAL      */ 01672000
*/*         RECORD, THEN PASS THE VERTICAL POINTER AND A FIELD       */ 01673000
*/*         NOT FOUND INDICATOR BACK.                                */ 01674000
*/*                                                                  */ 01675000
*/*         OTHERWISE, CALL PCKLC TO INSURE THE FIELD DOES           */ 01676000
*/*         EXIST. IF IT DOES THEN LOCATE THE FIELD ELSE             */ 01677000
*/*         INDICATE FIELD DOES NOT EXIST.                           */ 01678000
*/*                                                                  */ 01679000
*/*  ROUTINES CALLED                                                 */ 01680000
*/*      PCKLC                                                       */ 01681000
*/*      PEXPT                                                       */ 01682000
*/*      PLNRV                                                       */ 01683000
*/*                                                                  */ 01684000
*/********************************************************************/ 01685000
*                                                                  0335 01686000
*PLVAL: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0335 01687000
*                                                                  0335 01688000
         B     @PB00009                                            0335 01689000
PLVAL    DS    0H                                                  0336 01690000
*  /******************************************************************/ 01691000
*  /*                                                                */ 01692000
*  /*    SAVE THE RETURN ADDRESS ON ENTRY AND INITIALIZE TO          */ 01693000
*  /*    PROCESS THE FIELD                                           */ 01694000
*  /*                                                                */ 01695000
*  /******************************************************************/ 01696000
*                                                                  0336 01697000
*  WKARTNC=R14;                   /* SAVE THE RETURN ADDRESS         */ 01698000
         ST    R14,WKARTNC(,R13)                                   0336 01699000
*  WKANEXCI=0;                    /* ZERO THE EXTENSION CI           */ 01700000
         SLR   @03,@03                                             0337 01701000
         STCM  @03,7,WKANEXCI(R13)                                 0337 01702000
*                                 /* NUMBER                          */ 01703000
*  WKAFNDLN=WKADTLEN;             /* INITIALIZE THE LENGTH AS        */ 01704000
         SLR   @03,@03                                             0338 01705000
         IC    @03,WKADTLEN(,R13)                                  0338 01706000
         STH   @03,WKAFNDLN(,R13)                                  0338 01707000
*                                 /* IF IT WERE FIXED LENGTH         */ 01708000
*  WKAFLDNE='0'B;                 /* INDICATE THAT THE FIELD         */ 01709000
         NI    WKAFLDNE(R13),B'10111111'                           0339 01710000
*                                 /* DOES EXIST                      */ 01711000
*                                                                  0340 01712000
*  /******************************************************************/ 01713000
*  /*                                                                */ 01714000
*  /*    HANDLE THE PROCESSING FOR REPLICATED FIELD                  */ 01715000
*  /*                                                                */ 01716000
*  /******************************************************************/ 01717000
*                                                                  0340 01718000
*  IF WKADTREP='1'B               /* IF THE FIELD IS REPLICATED      */ 01719000
*    THEN DO;                     /* THEN:                           */ 01720000
         TM    WKADTREP(R13),B'01000000'                           0340 01721000
         BNO   @RF00340                                            0340 01722000
*      WKAFLDNF='1'B;             /* INDICATE FIELD NOT FOUND        */ 01723000
*                                                                  0342 01724000
         OI    WKAFLDNF(R13),B'00100000'                           0342 01725000
*      /**************************************************************/ 01726000
*      /*                                                            */ 01727000
*      /*    EXIT OUT IF THERE IS REPLICATED FIELDS NEEDED FROM      */ 01728000
*      /*    FREE OR CCR RECORDS                                     */ 01729000
*      /*                                                            */ 01730000
*      /**************************************************************/ 01731000
*                                                                  0343 01732000
*      IF WKAFORL='1'B            /* IF RECORD IS F OR L TYPE        */ 01733000
*        THEN DO;                 /* THEN:                           */ 01734000
         TM    WKAFORL(R13),B'00000001'                            0343 01735000
         BNO   @RF00343                                            0343 01736000
*          WKAFLDNE='1'B;         /* INDICATE FIELD DOES NOT EXIST   */ 01737000
         OI    WKAFLDNE(R13),B'01000000'                           0345 01738000
*          R14=WKARTNC;           /* RESTORE RETURN ADDRESS          */ 01739000
         L     @03,WKARTNC(,R13)                                   0346 01740000
         LR    R14,@03                                             0346 01741000
*          RETURN;                /* RETURN TO CALLER                */ 01742000
@EL00009 DS    0H                                                  0347 01743000
@EF00009 DS    0H                                                  0347 01744000
@ER00009 BR    @14                                                 0347 01745000
*          END;                   /*                                 */ 01746000
*        ELSE;                    /* ELSE: CONTINUE                  */ 01747000
*                                                                  0349 01748000
@RF00343 DS    0H                                                  0350 01749000
*      /**************************************************************/ 01750000
*      /*                                                            */ 01751000
*      /*    LOOP THROUGH THE GOP'S TO FIND THE CORRECT ONE          */ 01752000
*      /*                                                            */ 01753000
*      /**************************************************************/ 01754000
*                                                                  0350 01755000
*      WORKA=ADDR(CBKFGOP);       /* POINT AT THE FIRST GOP          */ 01756000
         L     WORKA,WKAFGOP(,R13)                                 0350 01757000
         LA    WORKA,CBKFGOP(,WORKA)                               0350 01758000
*      DO WORKB=1 TO CBKCTGOP     /* LOOP THROUGH ALL THE GOP'S      */ 01759000
*         WHILE WKAFLDNF='1'B;    /* OR UNTIL THE SPECIFIC GOP       */ 01760000
         LA    WORKB,1                                             0351 01761000
         B     @DE00351                                            0351 01762000
@DL00351 TM    WKAFLDNF(R13),B'00100000'                           0351 01763000
         BNO   @DC00351                                            0351 01764000
*                                 /* IS FOUND                        */ 01765000
*        /************************************************************/ 01766000
*        /*                                                          */ 01767000
*        /*    PICK UP THE SEQUENCE NUMBER FOR THIS ENTRY            */ 01768000
*        /*                                                          */ 01769000
*        /************************************************************/ 01770000
*                                                                  0352 01771000
*        IF WKA1BSEQ='1'B         /* IF THE SEQUENCE NUMBER IS       */ 01772000
*                                 /* 1 BYTE IN LENGTH                */ 01773000
*          THEN WKASEQNO=GOP1BSEQ;/* THEN: PICK UP A 1 BYTE          */ 01774000
         TM    WKA1BSEQ(R13),B'10000000'                           0352 01775000
         BNO   @RF00352                                            0352 01776000
         SLR   @03,@03                                             0353 01777000
         IC    @03,GOP1BSEQ(,WORKA)                                0353 01778000
         STH   @03,WKASEQNO(,R13)                                  0353 01779000
*                                 /*       SEQUENCE NUMBER           */ 01780000
*          ELSE WKASEQNO=GOP2BSEQ;/* ELSE: PICK UP A 2 BYTE          */ 01781000
         B     @RC00352                                            0354 01782000
@RF00352 MVC   WKASEQNO(2,R13),GOP2BSEQ(WORKA)                     0354 01783000
*                                 /*       SEQUENCE NUMBER           */ 01784000
*                                                                  0355 01785000
*        /************************************************************/ 01786000
*        /*                                                          */ 01787000
*        /*    CHECK THIS GROUP CODE FOR THE CORRECT ONE             */ 01788000
*        /*                                                          */ 01789000
*        /************************************************************/ 01790000
*                                                                  0355 01791000
*        IF WKAGRPCD=(GOPINFO&CONTRUGC)                            0355 01792000
*                                 /* IF THE DESIRED GROUP CODE       */ 01793000
*                                 /* IS FOUND                        */ 01794000
*          THEN IF WKASEQNO=WKADRRNO                               0355 01795000
@RC00352 MVC   @TS00001(1),GOPINFO(WORKA)                          0355 01796000
         NI    @TS00001,X'3F'                                      0355 01797000
         CLC   WKAGRPCD(1,R13),@TS00001                            0355 01798000
         BNE   @RF00355                                            0355 01799000
*                                 /* THEN: IF THE DESIRED            */ 01800000
*                                 /*       SEQUENCE NUMBER IS        */ 01801000
*                                 /*       FOUND                     */ 01802000
*            THEN IF GOPDELET='1'B                                 0356 01803000
         LH    @03,WKADRRNO(,R13)                                  0356 01804000
         CH    @03,WKASEQNO(,R13)                                  0356 01805000
         BNE   @RF00356                                            0356 01806000
*                                 /* THEN: IF GOP IS DELETED         */ 01807000
*              THEN WKADRRNO=WKADRRNO+1;                           0357 01808000
         TM    GOPDELET(WORKA),B'01000000'                         0357 01809000
         BNO   @RF00357                                            0357 01810000
         AH    @03,@CH00047                                        0358 01811000
         STH   @03,WKADRRNO(,R13)                                  0358 01812000
*                                 /* THEN: SKIP TO THE NEXT          */ 01813000
*                                 /*       SEQUENCE NUMBER           */ 01814000
*              ELSE WKAFLDNF='0'B;/* ELSE: INDICATE THAT THE         */ 01815000
         B     @RC00357                                            0359 01816000
@RF00357 NI    WKAFLDNF(R13),B'11011111'                           0359 01817000
*                                 /*       FIELD IS FOUND            */ 01818000
*            ELSE;                /* ELSE: CONTINUE                  */ 01819000
@RF00356 DS    0H                                                  0361 01820000
*          ELSE;                  /* ELSE: CONTINUE                  */ 01821000
*                                                                  0361 01822000
@RF00355 DS    0H                                                  0362 01823000
*        /************************************************************/ 01824000
*        /*                                                          */ 01825000
*        /*    IF THE GOP HAS NOT BEEN FOUND POINT AT NEXT ONE       */ 01826000
*        /*                                                          */ 01827000
*        /************************************************************/ 01828000
*                                                                  0362 01829000
*        IF WKAFLDNF='1'B         /* IF FIELD IS NOT FOUND           */ 01830000
*          THEN WORKA=WORKA+WKAGOPLN;                              0362 01831000
@RC00355 TM    WKAFLDNF(R13),B'00100000'                           0362 01832000
         BNO   @RF00362                                            0362 01833000
         AH    WORKA,WKAGOPLN(,R13)                                0363 01834000
*                                 /* THEN: POINT AT THE NEXT         */ 01835000
*                                 /*       GOP                       */ 01836000
*          ELSE;                  /* ELSE: CONTINUE                  */ 01837000
@RF00362 DS    0H                                                  0365 01838000
*        END;                     /*                                 */ 01839000
         AH    WORKB,@CH00047                                      0365 01840000
@DE00351 L     @01,WKAFGOP(,R13)                                   0365 01841000
         SLR   @00,@00                                             0365 01842000
         IC    @00,CBKCTGOP(,@01)                                  0365 01843000
         CR    WORKB,@00                                           0365 01844000
         BNH   @DL00351                                            0365 01845000
@DC00351 DS    0H                                                  0366 01846000
*      /**************************************************************/ 01847000
*      /*                                                            */ 01848000
*      /*    HANDLE PROCESSING OF THE HORIZONTAL EXTENSION           */ 01849000
*      /*    POINTER IF FIELD NOT FOUND                              */ 01850000
*      /*                                                            */ 01851000
*      /**************************************************************/ 01852000
*                                                                  0366 01853000
*      IF WKAFLDNF='1'B           /* IF FIELD IS NOT FOUND           */ 01854000
*        THEN DO;                 /* THEN:                           */ 01855000
         TM    WKAFLDNF(R13),B'00100000'                           0366 01856000
         BNO   @RF00366                                            0366 01857000
*          WKANEXCI=CBKEXTCI;     /* POINT AT THE HORIZONTIAL        */ 01858000
         L     @01,WKAFGOP(,R13)                                   0368 01859000
         MVC   WKANEXCI(3,R13),CBKEXTCI(@01)                       0368 01860000
*                                 /* EXTENSION RECORD                */ 01861000
*          IF WKANEXCI^=0         /* IF THE EXTENSION POINTER        */ 01862000
*                                 /* IS NOT ZERO                     */ 01863000
*            THEN;                /* THEN: CONTINUE                  */ 01864000
         ICM   @03,7,WKANEXCI(R13)                                 0369 01865000
         BNZ   @RT00369                                            0369 01866000
*            ELSE WKAFLDNE='1'B;  /* ELSE: INDICATE THAT THE         */ 01867000
         OI    WKAFLDNE(R13),B'01000000'                           0371 01868000
*                                 /*       FIELD DOES NOT EXIST      */ 01869000
*          END;                   /*                                 */ 01870000
*                                                                  0372 01871000
*        /************************************************************/ 01872000
*        /*                                                          */ 01873000
*        /*    HANDLE THE RELREPNO FUNCTION                          */ 01874000
*        /*                                                          */ 01875000
*        /************************************************************/ 01876000
*                                                                  0373 01877000
*        ELSE IF WKADTSPL='1'B & WKADTSTR=CONRRPNO                 0373 01878000
*                                 /* ELSE: IF THE SEQUENCE           */ 01879000
*                                 /*       NUMBER FUNCTION WAS       */ 01880000
*                                 /*       SPECIFIED                 */ 01881000
*          THEN DO;               /* THEN:                           */ 01882000
         B     @RC00366                                            0373 01883000
@RF00366 TM    WKADTSPL(R13),B'00000001'                           0373 01884000
         BNO   @RF00373                                            0373 01885000
         CLI   WKADTSTR(R13),X'03'                                 0373 01886000
         BNE   @RF00373                                            0373 01887000
*            WKAFNDAD=ADDR(WKASEQNO)+LENGTH(WKASEQNO)-WKADTLEN;    0375 01888000
         LA    @03,WKASEQNO(,R13)                                  0375 01889000
         AH    @03,@CH00200                                        0375 01890000
         SLR   @02,@02                                             0375 01891000
         IC    @02,WKADTLEN(,R13)                                  0375 01892000
         SLR   @03,@02                                             0375 01893000
         ST    @03,WKAFNDAD(,R13)                                  0375 01894000
*                                 /* COMPUTE ADDRESS OF THE          */ 01895000
*                                 /* SEQUENCE NUMBER FIELD           */ 01896000
*            END;                 /*                                 */ 01897000
*                                                                  0376 01898000
*          /**********************************************************/ 01899000
*          /*                                                        */ 01900000
*          /*    HANDLE THE VERTICAL EXTENSION POINTER               */ 01901000
*          /*                                                        */ 01902000
*          /**********************************************************/ 01903000
*                                                                  0377 01904000
*          ELSE IF GOPEXTPT='1'B  /* ELSE: IF GOP IS A VERTICAL      */ 01905000
*                                 /*       EXTENSION POINTER         */ 01906000
*            THEN DO;             /* THEN:                           */ 01907000
         B     @RC00373                                            0377 01908000
@RF00373 TM    GOPEXTPT(WORKA),B'10000000'                         0377 01909000
         BNO   @RF00377                                            0377 01910000
*              WKAFLDNF='1'B;     /* INDICATE THAT THE FIELD IS      */ 01911000
         OI    WKAFLDNF(R13),B'00100000'                           0379 01912000
*                                 /* NOT FOUND                       */ 01913000
*              WKANEXCI=GOPCINO;  /* PICK UP THE VERTICAL            */ 01914000
         MVC   WKANEXCI(3,R13),GOPCINO(WORKA)                      0380 01915000
*                                 /* EXTENSION CI NUMBER             */ 01916000
*              END;               /*                                 */ 01917000
*            /********************************************************/ 01918000
*            /*                                                      */ 01919000
*            /*    HANDLE ALL OTHER FIELDS                           */ 01920000
*            /*                                                      */ 01921000
*            /********************************************************/ 01922000
*                                                                  0382 01923000
*            ELSE DO;             /* ELSE:                           */ 01924000
         B     @RC00377                                            0382 01925000
@RF00377 DS    0H                                                  0383 01926000
*              WORKD=WKAGODTA+GOPDISP;                             0383 01927000
         LH    WORKD,GOPDISP(,WORKA)                               0383 01928000
         AL    WORKD,WKAGODTA(,R13)                                0383 01929000
*                                 /* POINT AT GROUP OCCURANCE        */ 01930000
*              CALL PCKLC;        /* GO TO CHECK THE REQUESTED       */ 01931000
         BAL   @14,PCKLC                                           0384 01932000
*                                 /* FIELD PRESENCE                  */ 01933000
*              IF WKAFLDNE='0'B   /* IF THE FIELD EXISTS             */ 01934000
*                THEN DO;         /* THEN:                           */ 01935000
         TM    WKAFLDNE(R13),B'01000000'                           0385 01936000
         BNZ   @RF00385                                            0385 01937000
*                  WKANEXCI=CBKEXTCI;                              0387 01938000
         L     @01,WKAFGOP(,R13)                                   0387 01939000
         MVC   WKANEXCI(3,R13),CBKEXTCI(@01)                       0387 01940000
*                                 /* SAVE THE EXTENSION CI           */ 01941000
*                                 /* NUMBER                          */ 01942000
*                  IF WKADTVAR='0'B                                0388 01943000
*                                 /* IF NOT VARIABLE FIELD           */ 01944000
*                    THEN DO;     /* THEN:                           */ 01945000
         TM    WKADTVAR(R13),B'10000000'                           0388 01946000
         BNZ   @RF00388                                            0388 01947000
*                      WKAFNDAD=WORKD+WKADTSTR;                    0390 01948000
         LR    @03,WORKD                                           0390 01949000
         SLR   @02,@02                                             0390 01950000
         IC    @02,WKADTSTR(,R13)                                  0390 01951000
         ALR   @03,@02                                             0390 01952000
         ST    @03,WKAFNDAD(,R13)                                  0390 01953000
*                                 /* POINT AT START OF FOUND         */ 01954000
*                                 /* DATA FIELD                      */ 01955000
*                      WKANEXCI=0;/* ZERO THE EXTENSION CI           */ 01956000
         SLR   @03,@03                                             0391 01957000
         STCM  @03,7,WKANEXCI(R13)                                 0391 01958000
*                                 /* NUMBER                          */ 01959000
*                      END;       /*                                 */ 01960000
*                    ELSE DO;     /* ELSE:                           */ 01961000
         B     @RC00388                                            0393 01962000
@RF00388 DS    0H                                                  0394 01963000
*                      WORKA=WORKD+CBKFXDLN;                       0394 01964000
         LR    WORKA,WORKD                                         0394 01965000
         SLR   @03,@03                                             0394 01966000
         IC    @03,CBKFXDLN(,WORKD)                                0394 01967000
         ALR   WORKA,@03                                           0394 01968000
*                                 /* POINT AT FIRST VARIABLE         */ 01969000
*                                 /* FIELD                           */ 01970000
*                      DO WORKB=2 TO WKADTLEN;                     0395 01971000
         LA    WORKB,2                                             0395 01972000
         B     @DE00395                                            0395 01973000
@DL00395 DS    0H                                                  0396 01974000
*                                 /* LOOP TO FIND CORRECT FIELD      */ 01975000
*                        WORKA=ADDR(CBKDATA)+CBKVRLEN;             0396 01976000
         LA    @03,CBKDATA(,WORKA)                                 0396 01977000
         AH    @03,CBKVRLEN(,WORKA)                                0396 01978000
         LR    WORKA,@03                                           0396 01979000
*                                 /* POINT AT NEXT FIELD             */ 01980000
*                        END;     /*                                 */ 01981000
         AH    WORKB,@CH00047                                      0397 01982000
@DE00395 SLR   @03,@03                                             0397 01983000
         IC    @03,WKADTLEN(,R13)                                  0397 01984000
         CR    WORKB,@03                                           0397 01985000
         BNH   @DL00395                                            0397 01986000
*                      WKAFNDLN=CBKVRLEN+LENGTH(CBKVRLEN);         0398 01987000
         LA    @03,2                                               0398 01988000
         AH    @03,CBKVRLEN(,WORKA)                                0398 01989000
         STH   @03,WKAFNDLN(,R13)                                  0398 01990000
*                                 /* COMPUTE LENGTH OF FIELD         */ 01991000
*                      WKAFNDAD=WORKA;                             0399 01992000
         ST    WORKA,WKAFNDAD(,R13)                                0399 01993000
*                                 /* POINT AT FIELD                  */ 01994000
*                      END;       /*                                 */ 01995000
*                  END;           /*                                 */ 01996000
*                ELSE;            /* ELSE: CONTINUE                  */ 01997000
@RF00385 DS    0H                                                  0403 01998000
*              END;               /*                                 */ 01999000
*      END;                       /*                                 */ 02000000
*                                                                  0404 02001000
*    /****************************************************************/ 02002000
*    /*                                                              */ 02003000
*    /*    HANDLE NON-REPLICATED EXTENSION POINTERS                  */ 02004000
*    /*                                                              */ 02005000
*    /****************************************************************/ 02006000
*                                                                  0405 02007000
*    ELSE IF WKADTEPT='1'B        /* ELSE: IF EXTENSION POINTER      */ 02008000
*                                 /*       FUNCTION                  */ 02009000
*      THEN CALL PEXPT;           /* THEN: GET THE EXTENSION         */ 02010000
         B     @RC00340                                            0405 02011000
@RF00340 TM    WKADTEPT(R13),B'00000010'                           0405 02012000
         BNO   @RF00405                                            0405 02013000
         BAL   @14,PEXPT                                           0406 02014000
*                                 /*       CI NUMBERS                */ 02015000
*      /**************************************************************/ 02016000
*      /*                                                            */ 02017000
*      /*    HANDLE OTHER NON-REPLICATED FIELDS                      */ 02018000
*      /*                                                            */ 02019000
*      /**************************************************************/ 02020000
*                                                                  0407 02021000
*      ELSE CALL PLNRV;           /* ELSE: GET THE NON-REPLI-        */ 02022000
         B     @RC00405                                            0407 02023000
@RF00405 BAL   @14,PLNRV                                           0407 02024000
*                                 /*       CATED VALUE               */ 02025000
*                                                                  0408 02026000
*  /******************************************************************/ 02027000
*  /*                                                                */ 02028000
*  /*    RESTORE THE RETURN ADDRESS TO PREPARE FOR EXIT              */ 02029000
*  /*                                                                */ 02030000
*  /******************************************************************/ 02031000
*                                                                  0408 02032000
*  R14=WKARTNC;                   /* RESTORE THE RETURN ADDRESS      */ 02033000
@RC00405 DS    0H                                                  0408 02034000
@RC00340 L     R14,WKARTNC(,R13)                                   0408 02035000
*  END PLVAL;                     /* END OF PROCEDURE                */ 02036000
         B     @EL00009                                            0409 02037000
@PB00009 DS    0H                                                  0410 02038000
*  GEN(EJECT);                                                     0410 02039000
         EJECT                                                          02040000
*/********************************************************************/ 02041000
*/*                                                                  */ 02042000
*/*  PROCEDURE NAME = PSCNC                                          */ 02043000
*/*                                                                  */ 02044000
*/*  DESCRIPTIVE NAME =  SCAN THE REQUEST LIST                       */ 02045000
*/*                                                                  */ 02046000
*/*  FUNCTION =                                                      */ 02047000
*/*      THIS ROUTINE GOES THROUGH ALL OF THE FMFL'S TO TRANSLATE    */ 02048000
*/*      THE NAMES INTO THE CORRECT INDICATORS FOR FIELD             */ 02049000
*/*      MANAGEMENT TO USE.                                          */ 02050000
*/*                                                                  */ 02051000
*/*  ROUTINES CALLED                                                 */ 02052000
*/*      PTRNS                                                       */ 02053000
*/*                                                                  */ 02054000
*/********************************************************************/ 02055000
*                                                                  0411 02056000
*PSCNC: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0411 02057000
*                                                                  0411 02058000
         B     @PB00010                                            0411 02059000
PSCNC    DS    0H                                                  0412 02060000
*  WKARTNE=R14;                   /* SAVE THE RETURN ADDRESS         */ 02061000
         ST    R14,WKARTNE(,R13)                                   0412 02062000
*  FMPLRTCD=RTNCDNML;             /* INITIALIZE THE NORMAL           */ 02063000
         MVI   FMPLRTCD(FMPLAD),X'00'                              0413 02064000
*                                 /* RETURN CODE                     */ 02065000
*  DO WORKC = 1 TO FMPLFLNO;      /* LOOP THROUGH ALL OF THE         */ 02066000
         LA    WORKC,1                                             0414 02067000
         B     @DE00414                                            0414 02068000
@DL00414 DS    0H                                                  0415 02069000
*                                 /* FMFL'S TO CONVERT THE NAME      */ 02070000
*                                 /* TO INTERNAL NOTATION            */ 02071000
*    WKATSTFL='0'B;               /* INDICATE THAT THIS IS NOT       */ 02072000
         NI    WKATSTFL(R13),B'11110111'                           0415 02073000
*                                 /* A TEST FMFL                     */ 02074000
*    FMFLCUR=FMPLFMFL(WORKC);     /* POINT AT THE NON-TEST           */ 02075000
         LR    @03,WORKC                                           0416 02076000
         SLA   @03,2                                               0416 02077000
         L     FMFLCUR,FMPLFMFL-4(@03,FMPLAD)                      0416 02078000
*                                 /* FMFL                            */ 02079000
*    DO WHILE FMFLCUR^=0 & FMPLRTCD=RTNCDNML;                      0417 02080000
         B     @DE00417                                            0417 02081000
@DL00417 DS    0H                                                  0418 02082000
*                                 /* LOOP THROUGH ALL FMFL'S IN      */ 02083000
*                                 /* THE CHAIN INCLUDING THE         */ 02084000
*                                 /* TEST FMFL'S AS LONG AS          */ 02085000
*                                 /* THERE IS NO ERRORS              */ 02086000
*      CALL PTRNS;                /* GO TO CONVERT THE NAME TO       */ 02087000
         BAL   @14,PTRNS                                           0418 02088000
*                                 /* INTERNAL NOTATION               */ 02089000
*      FMFLCUR=FMFLTCHN;          /* POINT AT THE NEXT TEST          */ 02090000
         L     FMFLCUR,FMFLTCHN(,FMFLCUR)                          0419 02091000
*                                 /* FMFL                            */ 02092000
*      WKATSTFL='1'B;             /* INDICATE THAT THIS FMFL IS      */ 02093000
         OI    WKATSTFL(R13),B'00001000'                           0420 02094000
*                                 /* A TEST FMFL                     */ 02095000
*      END;                       /*                                 */ 02096000
@DE00417 LTR   FMFLCUR,FMFLCUR                                     0421 02097000
         BZ    @DC00417                                            0421 02098000
         CLI   FMPLRTCD(FMPLAD),0                                  0421 02099000
         BE    @DL00417                                            0421 02100000
@DC00417 DS    0H                                                  0422 02101000
*    END;                         /*                                 */ 02102000
         AH    WORKC,@CH00047                                      0422 02103000
@DE00414 SLR   @03,@03                                             0422 02104000
         IC    @03,FMPLFLNO(,FMPLAD)                               0422 02105000
         CR    WORKC,@03                                           0422 02106000
         BNH   @DL00414                                            0422 02107000
*  R14=WKARTNE;                   /* RESTORE THE RETURN ADDRESS      */ 02108000
*                                                                  0423 02109000
         L     R14,WKARTNE(,R13)                                   0423 02110000
*  END PSCNC;                     /* END OF PROCEDURE                */ 02111000
@EL00010 DS    0H                                                  0424 02112000
@EF00010 DS    0H                                                  0424 02113000
@ER00010 BR    @14                                                 0424 02114000
@PB00010 DS    0H                                                  0425 02115000
*  GEN(EJECT);                                                     0425 02116000
         EJECT                                                          02117000
*/********************************************************************/ 02118000
*/*                                                                  */ 02119000
*/*  PROCEDURE NAME = PSCNF                                          */ 02120000
*/*                                                                  */ 02121000
*/*  DESCRIPTIVE NAME = SCAN TO DO FUNCTION                          */ 02122000
*/*                                                                  */ 02123000
*/*  FUNCTION =                                                      */ 02124000
*/*      THIS ROUTINE LOOPS THROUGH ALL THE FMFL'S DOING THE         */ 02125000
*/*      TESTS AND LOCATING THE FIELDS TO BE PLACED IN THEM.         */ 02126000
*/*                                                                  */ 02127000
*/*  ROUTINES CALLED                                                 */ 02128000
*/*      PLOC2                                                       */ 02129000
*/*      PTSTS                                                       */ 02130000
*/*                                                                  */ 02131000
*/********************************************************************/ 02132000
*                                                                  0426 02133000
*PSCNF: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0426 02134000
*                                                                  0426 02135000
         B     @PB00011                                            0426 02136000
PSCNF    DS    0H                                                  0427 02137000
*  /******************************************************************/ 02138000
*  /*                                                                */ 02139000
*  /*    SAVE THE RETURN ADDRESS ON ENTRY AND CHECK THE OUTPUT       */ 02140000
*  /*    AREA FOR THE SIZE TO BEGIN                                  */ 02141000
*  /*                                                                */ 02142000
*  /******************************************************************/ 02143000
*                                                                  0427 02144000
*  WKARTNF=R14;                   /* SAVE THE RETURN ADDRESS         */ 02145000
         ST    R14,WKARTNF(,R13)                                   0427 02146000
*  WKAAREAP=FMPLOAR+LENGTH(FOALENTH);                              0428 02147000
         LA    @03,2                                               0428 02148000
         L     @02,FMPLOAR(,FMPLAD)                                0428 02149000
         LR    @01,@02                                             0428 02150000
         ALR   @01,@03                                             0428 02151000
         ST    @01,WKAAREAP(,R13)                                  0428 02152000
*                                 /* POINT AT THE FIRST BYTE IN      */ 02153000
*                                 /* THE OUTPUT AREA TO USE          */ 02154000
*  WKAAREAS=FMPLENTH-LENGTH(FOALENTH);                             0429 02155000
         LH    @01,FMPLENTH(,FMPLAD)                               0429 02156000
         LR    @00,@01                                             0429 02157000
         SLR   @00,@03                                             0429 02158000
         STH   @00,WKAAREAS(,R13)                                  0429 02159000
*                                 /* SETUP THE LENGTH OF THE         */ 02160000
*                                 /* OUTPUT AREA STILL REMAIN-       */ 02161000
*                                 /* ING TO BE USED                  */ 02162000
*  IF FMPLENTH>LENGTH(FOALENTH)   /* IF THERE IS ROOM TO START       */ 02163000
*    THEN DO;                     /* THEN:                           */ 02164000
         CR    @01,@03                                             0430 02165000
         BNH   @RF00430                                            0430 02166000
*      FOALENTH=LENGTH(FOALENTH); /* SETUP THE LENGTH OF THE         */ 02167000
         STH   @03,FOALENTH(,@02)                                  0432 02168000
*                                 /* OUTPUT AREA THAT HAS BEEN       */ 02169000
*                                 /* USED                            */ 02170000
*      WKAFMFLI=1;                /* INITIALIZE THE FIELD LIST       */ 02171000
         MVC   WKAFMFLI(2,R13),@CH00047                            0433 02172000
*                                 /* INDEX VALUE                     */ 02173000
*                                                                  0434 02174000
*      /**************************************************************/ 02175000
*      /*                                                            */ 02176000
*      /*    LOOP THROUGH ALL OF THE FMFL'S IN THE FMPL              */ 02177000
*      /*                                                            */ 02178000
*      /**************************************************************/ 02179000
*                                                                  0434 02180000
*      DO WHILE WKAFMFLI<=FMPLFLNO;                                0434 02181000
         B     @DE00434                                            0434 02182000
@DL00434 DS    0H                                                  0435 02183000
*                                 /* LOOP TO PROCESS THE FIELD       */ 02184000
*                                 /* LISTS                           */ 02185000
*        WKADRRNO=1;              /* INITIALIZE THE DESIRED          */ 02186000
         MVC   WKADRRNO(2,R13),@CH00047                            0435 02187000
*                                 /* RELREPNO                        */ 02188000
*        WKAEXITC='0'B;           /* INITIALIZE THE LOOP             */ 02189000
         NI    WKAEXITC(R13),B'11111110'                           0436 02190000
*                                 /* LOOP CONTROL INDICATOR          */ 02191000
*        /************************************************************/ 02192000
*        /*                                                          */ 02193000
*        /*    HANDLE ALL OF THE RELREPNO'S FOR THIS FMFL            */ 02194000
*        /*                                                          */ 02195000
*        /************************************************************/ 02196000
*                                                                  0437 02197000
*        DO WHILE WKAEXITC='0'B;  /* LOOP THROUGH THE DESIRED        */ 02198000
         B     @DE00437                                            0437 02199000
@DL00437 DS    0H                                                  0438 02200000
*                                 /* RELREPNO'S FOR THE FIELD        */ 02201000
*          FMFLCUR=FMPLFMFL(WKAFMFLI);                             0438 02202000
         LH    @03,WKAFMFLI(,R13)                                  0438 02203000
         SLA   @03,2                                               0438 02204000
         L     FMFLCUR,FMPLFMFL-4(@03,FMPLAD)                      0438 02205000
*                                 /* POINT AT THE APPROPIATE         */ 02206000
*                                 /* FIELD LIST TO PROCESS           */ 02207000
*          CALL PTSTS;            /* HANDLE ANY TEST FIELD           */ 02208000
         BAL   @14,PTSTS                                           0439 02209000
*                                 /* LISTS IF THERE IS ANY           */ 02210000
*          IF WKAFSUCC='1'B       /* IF THE FIELD IS A SUCCESS       */ 02211000
*            THEN DO;             /* THEN:                           */ 02212000
         TM    WKAFSUCC(R13),B'00010000'                           0440 02213000
         BNO   @RF00440                                            0440 02214000
*              FMFLCUR=FMPLFMFL(WKAFMFLI);                         0442 02215000
         LH    @03,WKAFMFLI(,R13)                                  0442 02216000
         SLA   @03,2                                               0442 02217000
         L     FMFLCUR,FMPLFMFL-4(@03,FMPLAD)                      0442 02218000
*                                 /* POINT AT THE APPROPIATE         */ 02219000
*                                 /* FIELD LIST TO PROCESS           */ 02220000
*                                 /* FOR THIS RELREPNO               */ 02221000
*              CALL PLOC2;        /* PLACE THE FIELD IN THE          */ 02222000
         BAL   @14,PLOC2                                           0443 02223000
*                                 /* OUTPUT AREA                     */ 02224000
*              END;               /*                                 */ 02225000
*            ELSE;                /* ELSE: CONTINUE                  */ 02226000
@RF00440 DS    0H                                                  0446 02227000
*          IF WKACMPLT='1'B & WKAFLDNE='1'B & WKAFLDNF='1'B        0446 02228000
*                                 /* IF THE GROUP CODE IS NOT        */ 02229000
*                                 /* FOUND                           */ 02230000
*            THEN WKAEXITC='1'B;  /* THEN: INDICATE THAT THE         */ 02231000
         TM    WKACMPLT(R13),B'01101000'                           0446 02232000
         BNO   @RF00446                                            0446 02233000
         OI    WKAEXITC(R13),B'00000001'                           0447 02234000
*                                 /*       FMFL HAS BEEN             */ 02235000
*                                 /*       COMPLETED                 */ 02236000
*            ELSE WKADRRNO=WKADRRNO+1;                             0448 02237000
         B     @RC00446                                            0448 02238000
@RF00446 LA    @03,1                                               0448 02239000
         AH    @03,WKADRRNO(,R13)                                  0448 02240000
         STH   @03,WKADRRNO(,R13)                                  0448 02241000
*                                 /* ELSE: COMPUTE THE NEXT          */ 02242000
*                                 /*       RELREPNO TO TRY           */ 02243000
*          END;                   /*                                 */ 02244000
*                                                                  0449 02245000
@RC00446 DS    0H                                                  0449 02246000
@DE00437 TM    WKAEXITC(R13),B'00000001'                           0449 02247000
         BZ    @DL00437                                            0449 02248000
*        /************************************************************/ 02249000
*        /*                                                          */ 02250000
*        /*    POINT AT NEXT FMFL IN FMPL                            */ 02251000
*        /*                                                          */ 02252000
*        /************************************************************/ 02253000
*                                                                  0450 02254000
*        WKAFMFLI=WKAFMFLI+1;     /* POINT AT THE NEXT FIELD         */ 02255000
         LA    @03,1                                               0450 02256000
         AH    @03,WKAFMFLI(,R13)                                  0450 02257000
         STH   @03,WKAFMFLI(,R13)                                  0450 02258000
*                                 /* LIST POINTER IN PARAMETER       */ 02259000
*                                 /* LIST                            */ 02260000
*        END;                     /*                                 */ 02261000
@DE00434 LH    @03,WKAFMFLI(,R13)                                  0451 02262000
         SLR   @02,@02                                             0451 02263000
         IC    @02,FMPLFLNO(,FMPLAD)                               0451 02264000
         CR    @03,@02                                             0451 02265000
         BNH   @DL00434                                            0451 02266000
*      END;                       /*                                 */ 02267000
*    /****************************************************************/ 02268000
*    /*                                                              */ 02269000
*    /*    HANDLE THE BAD OUTPUT AREA LENGTH                         */ 02270000
*    /*                                                              */ 02271000
*    /****************************************************************/ 02272000
*                                                                  0453 02273000
*    ELSE FMPLRTCD=RTNCDISL;      /* ELSE: INDICATE THAT THE         */ 02274000
         B     @RC00430                                            0453 02275000
@RF00430 MVI   FMPLRTCD(FMPLAD),X'14'                              0453 02276000
*                                 /*       OUTPUT AREA IS TOO        */ 02277000
*                                 /*       SMALL                     */ 02278000
*                                                                  0454 02279000
*  /******************************************************************/ 02280000
*  /*                                                                */ 02281000
*  /*    RESTORE THE RETURN ADDRESS TO ALLOW EXIT                    */ 02282000
*  /*                                                                */ 02283000
*  /******************************************************************/ 02284000
*                                                                  0454 02285000
*  R14=WKARTNF;                   /* RESTORE THE RETURN ADDRESS      */ 02286000
@RC00430 L     R14,WKARTNF(,R13)                                   0454 02287000
*  END PSCNF;                     /* END OF PROCEDURE                */ 02288000
@EL00011 DS    0H                                                  0455 02289000
@EF00011 DS    0H                                                  0455 02290000
@ER00011 BR    @14                                                 0455 02291000
@PB00011 DS    0H                                                  0456 02292000
*  GEN(EJECT);                                                     0456 02293000
         EJECT                                                          02294000
*/********************************************************************/ 02295000
*/*                                                                  */ 02296000
*/*  PROCEDURE NAME = PSHIN                                          */ 02297000
*/*                                                                  */ 02298000
*/*  DESCRIPTIVE NAME = FIELD DATA INSERT                            */ 02299000
*/*                                                                  */ 02300000
*/*  FUNCTION =                                                      */ 02301000
*/*      THIS ROUTINE PLACES THE DATA IN THE OUTPUT AREA AND         */ 02302000
*/*      UPDATES THE FMFL'S TO INDICATE THAT FACT.  THIS ROUTINE     */ 02303000
*/*      TAKES INTO ACOUNT THAT THE FIELDS MAY BE BROKEN INTO        */ 02304000
*/*      PIECES.                                                     */ 02305000
*/*                                                                  */ 02306000
*/*  ROUTINES CALLED                                                 */ 02307000
*/*      NONE                                                        */ 02308000
*/*                                                                  */ 02309000
*/********************************************************************/ 02310000
*                                                                  0457 02311000
*PSHIN: PROCEDURE OPTIONS(NOSAVEAREA,NOSAVE);                      0457 02312000
*                                                                  0457 02313000
         B     @PB00012                                            0457 02314000
PSHIN    DS    0H                                                  0458 02315000
*  DCL CHR        CHAR(512) BASED(WKAAREAP);                       0458 02316000
*                                 /* VARIABLE USED TO RECIEVE        */ 02317000
*                                 /* THE DATA INTO THE CALLERS       */ 02318000
*                                 /* WORK AREA                       */ 02319000
*  DCL CHRI       CHAR(512) BASED(WKAFNDAD);                       0459 02320000
*                                 /* VARIABLE USED TO SEND THE       */ 02321000
*                                 /* THE CATALOG RECORD DATA         */ 02322000
*                                 /* FROM IN THE RECORD IN           */ 02323000
*                                 /* WHICH IT IS FOUND               */ 02324000
*                                                                  0460 02325000
*                                                                  0460 02326000
*  /******************************************************************/ 02327000
*  /*                                                                */ 02328000
*  /*    CHECK TO SEE IF THE FIELD IS NON-EXISTENT OR IT IS          */ 02329000
*  /*    THE NORMAL TERMINATION OF A SEGMENTED FIELD                 */ 02330000
*  /*                                                                */ 02331000
*  /******************************************************************/ 02332000
*                                                                  0460 02333000
*  IF WKACMPLT='1'B & WKAFLDNE='0'B                                0460 02334000
*                                 /* IF A PARTIAL FIELD HAS          */ 02335000
*                                 /* BEEN PLACED AND THE FIELD       */ 02336000
*                                 /* IS NON-EXISTENT                 */ 02337000
*    THEN;                        /* THEN: CONTINUE                  */ 02338000
         TM    WKACMPLT(R13),B'00001000'                           0460 02339000
         BNO   @RF00460                                            0460 02340000
         TM    WKAFLDNE(R13),B'01000000'                           0460 02341000
         BZ    @RT00460                                            0460 02342000
*    /****************************************************************/ 02343000
*    /*                                                              */ 02344000
*    /*     IF THE FIELD IS NON-EXISTENT THE APPROPIATE              */ 02345000
*    /*     SETUP TO HANDLE THEM MUST BE DONE. FOR A VARIABLE        */ 02346000
*    /*     LENGTH FIELD A COUNT FIELD OF ZERO IS SUPPLIED,          */ 02347000
*    /*     AND FOR A FIXED LENGTH FIELD THE LENGTH IS SETUP         */ 02348000
*    /*     AND THE FIELD IS HANDLED LATER.                          */ 02349000
*    /*                                                              */ 02350000
*    /****************************************************************/ 02351000
*                                                                  0462 02352000
*    ELSE DO;                     /* ELSE:                           */ 02353000
@RF00460 DS    0H                                                  0463 02354000
*      IF WKACMPLT='1'B & WKAFLDNE='1'B                            0463 02355000
*                                 /* IF THE FIELD DOES NOT           */ 02356000
*                                 /* EXIST                           */ 02357000
*        THEN IF WKADTVAR='1'B    /* THEN: IF VARIABLE LENGTH        */ 02358000
         TM    WKACMPLT(R13),B'01001000'                           0463 02359000
         BNO   @RF00463                                            0463 02360000
*                                 /*       FIELD                     */ 02361000
*          THEN DO;               /* THEN:                           */ 02362000
         TM    WKADTVAR(R13),B'10000000'                           0464 02363000
         BNO   @RF00464                                            0464 02364000
*            WKAFNDAD=ADDR('0000'X);                               0466 02365000
         LA    @03,@CB00283                                        0466 02366000
         ST    @03,WKAFNDAD(,R13)                                  0466 02367000
*                                 /* POINT AT A VARIABLE             */ 02368000
*                                 /* LENGTH NULL FIELD               */ 02369000
*            WKAFNDLN=LENGTH('0000'X);                             0467 02370000
         MVC   WKAFNDLN(2,R13),@CH00171                            0467 02371000
*                                 /* SETUP LENGTH OF VARIABLE        */ 02372000
*                                 /* LENGTH NULL FIELD               */ 02373000
*            END;                 /*                                 */ 02374000
*          ELSE WKAFNDLN=WKADTLEN;                                 0469 02375000
         B     @RC00464                                            0469 02376000
@RF00464 SLR   @03,@03                                             0469 02377000
         IC    @03,WKADTLEN(,R13)                                  0469 02378000
         STH   @03,WKAFNDLN(,R13)                                  0469 02379000
*                                 /* ELSE: INDICATE THE LENGTH       */ 02380000
*                                 /*       OF THE FIXED FIELD        */ 02381000
*        ELSE;                    /* ELSE: CONTINUE                  */ 02382000
*                                                                  0470 02383000
@RF00463 DS    0H                                                  0471 02384000
*      /**************************************************************/ 02385000
*      /*                                                            */ 02386000
*      /*     CHECK TO SEE IF THERE IS ENOUGH SPACE TO DO ANY        */ 02387000
*      /*     DATA PLACEMENT IN THE WORK AREA PROVIDED BY THE        */ 02388000
*      /*     USER.                                                  */ 02389000
*      /*                                                            */ 02390000
*      /**************************************************************/ 02391000
*                                                                  0471 02392000
*      IF WKAAREAS<LENGTH(CBKVRLEN)                                0471 02393000
*                                 /* IF THERE IS NOT ENOUGH          */ 02394000
*                                 /* SPACE TO PLACE A COUNT          */ 02395000
*                                 /* FIELD FOR A VARIABLE            */ 02396000
*                                 /* LENGTH FIELD                    */ 02397000
*        THEN;                    /* THEN: CONTINUE                  */ 02398000
@RC00463 LH    @03,WKAAREAS(,R13)                                  0471 02399000
         CH    @03,@CH00200                                        0471 02400000
         BL    @RT00471                                            0471 02401000
*        /************************************************************/ 02402000
*        /*                                                          */ 02403000
*        /*     ENSURE THAT THE LENGTH USED DOES NOT EXTEND          */ 02404000
*        /*     BEYOND THE WORK AREA PROVIDED BY THE CALLER.         */ 02405000
*        /*                                                          */ 02406000
*        /************************************************************/ 02407000
*                                                                  0473 02408000
*        ELSE DO;                 /* ELSE:                           */ 02409000
*          IF WKAAREAS<WKAFNDLN                                    0474 02410000
*                                 /* IF THERE IS NOT ENOUGH          */ 02411000
*                                 /* SPACE IN THE WORK AREA          */ 02412000
*            THEN IF WKADTVAR='1'B/* THEN: IF VARIABLE LENGTH        */ 02413000
         LH    @03,WKAAREAS(,R13)                                  0474 02414000
         CH    @03,WKAFNDLN(,R13)                                  0474 02415000
         BNL   @RF00474                                            0474 02416000
*              THEN WKAFNDLN=WKAAREAS+LENGTH(CBKVRLEN);            0475 02417000
         TM    WKADTVAR(R13),B'10000000'                           0475 02418000
         BNO   @RF00475                                            0475 02419000
         AH    @03,@CH00200                                        0476 02420000
         STH   @03,WKAFNDLN(,R13)                                  0476 02421000
*                                 /* THEN: SET LENGTH TO             */ 02422000
*                                 /*       INCLUDE THE LENGTH        */ 02423000
*                                 /*       FIELD                     */ 02424000
*              ELSE WKAFNDLN=WKAAREAS;                             0477 02425000
         B     @RC00475                                            0477 02426000
@RF00475 MVC   WKAFNDLN(2,R13),WKAAREAS(R13)                       0477 02427000
*                                 /* ELSE: ADJUST THE FIELD          */ 02428000
*                                 /*       LENGTH TO RETURN          */ 02429000
*                                 /*       ONLY THE REMAINDER        */ 02430000
*                                 /*       OF THE WORK AREA          */ 02431000
*            ELSE;                /* ELSE: CONTINUE                  */ 02432000
@RF00474 DS    0H                                                  0479 02433000
*        /************************************************************/ 02434000
*        /*                                                          */ 02435000
*        /*     CONSTRUCT THE FMFL ADDRESS AND LENGTH, MODIFY        */ 02436000
*        /*     THE FIELD COUNT IF REQUIRED, AND APPEND THE          */ 02437000
*        /*     CONTINUATION FIELD IF REQUIRED                       */ 02438000
*        /*                                                          */ 02439000
*        /************************************************************/ 02440000
*                                                                  0479 02441000
*          IF FMFLADDR(1)=0       /* IF A PARTIAL FIELD HAS NOT      */ 02442000
*                                 /* BEEN STARTED                    */ 02443000
*            THEN DO;             /* THEN:                           */ 02444000
@RC00474 ICM   @03,15,FMFLADDR(FMFLCUR)                            0479 02445000
         BNZ   @RF00479                                            0479 02446000
*              FMFLADDR(1)=WKAAREAP;                               0481 02447000
         L     @03,WKAAREAP(,R13)                                  0481 02448000
         ST    @03,FMFLADDR(,FMFLCUR)                              0481 02449000
*                                 /* SETUP THE FMFL ADDRESS TO       */ 02450000
*                                 /* THE START OF THE FIELD          */ 02451000
*              FMFLENTH(1)=WKAFNDLN;                               0482 02452000
         LH    @02,WKAFNDLN(,R13)                                  0482 02453000
         ST    @02,FMFLENTH(,FMFLCUR)                              0482 02454000
*                                 /* SETUP THE FMFL LENGTH TO        */ 02455000
*                                 /* SPAN THE FIELD                  */ 02456000
*              WKASVPOS=WKAAREAP; /* SAVE THE ADDRESS OF THE         */ 02457000
         ST    @03,WKASVPOS(,R13)                                  0483 02458000
*                                 /* COUNT FIELD FOR VARIABLE        */ 02459000
*                                 /* LENGTH FIELDS                   */ 02460000
*              END;               /*                                 */ 02461000
*            ELSE DO;             /* ELSE:                           */ 02462000
         B     @RC00479                                            0485 02463000
@RF00479 DS    0H                                                  0486 02464000
*              IF WKACONFG='1'B                                    0486 02465000
*                                 /* IF THIS IS A CONTINUATION       */ 02466000
*                                 /* OF THE SAME FIELD               */ 02467000
*                THEN IF WKADTVAR='1'B                             0486 02468000
         TM    WKACONFG(R13),B'00000010'                           0486 02469000
         BNO   @RF00486                                            0486 02470000
*                                 /* THEN: IF THIS IS VARIABLE       */ 02471000
*                                 /*       LENGTH FIELD              */ 02472000
*                  THEN DO;       /* THEN:                           */ 02473000
         TM    WKADTVAR(R13),B'10000000'                           0487 02474000
         BNO   @RF00487                                            0487 02475000
*                    WKAFNDLN=WKAFNDLN-LENGTH(CBKVRLEN);           0489 02476000
         LA    @03,2                                               0489 02477000
         LH    @02,WKAFNDLN(,R13)                                  0489 02478000
         SLR   @02,@03                                             0489 02479000
         STH   @02,WKAFNDLN(,R13)                                  0489 02480000
*                                 /* REMOVE THE LENGTH FIELD         */ 02481000
*                                 /* FROM THE LENGTH TO MOVE         */ 02482000
*                    WKAFNDAD=WKAFNDAD+LENGTH(CBKVRLEN);           0490 02483000
         AL    @03,WKAFNDAD(,R13)                                  0490 02484000
         ST    @03,WKAFNDAD(,R13)                                  0490 02485000
*                                 /* ADJUST THE ADDRESS PAST         */ 02486000
*                                 /* THE LENGTH FIELD                */ 02487000
*                    WKASVPOS->CBKVRLEN=WKASVPOS->CBKVRLEN         0491 02488000
*                      +WKAFNDLN;                                  0491 02489000
         L     @03,WKASVPOS(,R13)                                  0491 02490000
         AH    @02,CBKVRLEN(,@03)                                  0491 02491000
         STH   @02,CBKVRLEN(,@03)                                  0491 02492000
*                                 /* INCREMENT THE FIELD LENGTH      */ 02493000
*                                 /* OF THE TOTAL VARIABLE           */ 02494000
*                                 /* LENGTH FIELD                    */ 02495000
*                    END;         /*                                 */ 02496000
*                  ELSE;          /* ELSE: CONTINUE                  */ 02497000
@RF00487 DS    0H                                                  0494 02498000
*                ELSE WKASVPOS=WKAAREAP;                           0494 02499000
         B     @RC00486                                            0494 02500000
@RF00486 MVC   WKASVPOS(4,R13),WKAAREAP(R13)                       0494 02501000
*                                 /* ELSE: SAVE THE ADDRESS OF       */ 02502000
*                                 /*       COUNT FIELD               */ 02503000
*              FMFLENTH(1)=FMFLENTH(1)+WKAFNDLN;                   0495 02504000
@RC00486 LH    @03,WKAFNDLN(,R13)                                  0495 02505000
         AL    @03,FMFLENTH(,FMFLCUR)                              0495 02506000
         ST    @03,FMFLENTH(,FMFLCUR)                              0495 02507000
*                                 /* ADJUST THE FMFL LENGTH TO       */ 02508000
*                                 /* INCLUDE THE NEW PORTION         */ 02509000
*              END;               /*                                 */ 02510000
*        /************************************************************/ 02511000
*        /*                                                          */ 02512000
*        /*     CHECK TO SEE IF THE FIELD EXISTS TO SEE HOW          */ 02513000
*        /*     TO HANDLE THE FILLING OF THE WORK AREA.              */ 02514000
*        /*                                                          */ 02515000
*        /************************************************************/ 02516000
*                                                                  0497 02517000
*        IF WKACMPLT='1'B & WKAFLDNE='1'B & WKADTVAR='0'B          0497 02518000
*                                 /* IF FIELD DOES NOT EXIST         */ 02519000
*                                 /* AND IT IS FIXED LENGTH          */ 02520000
*                                                                  0497 02521000
*          /**********************************************************/ 02522000
*          /*                                                        */ 02523000
*          /*     THE FIXED FIELD IS NON-EXISTENT SO IT IS           */ 02524000
*          /*     TO BE FILLED WITH F'S.                             */ 02525000
*          /*                                                        */ 02526000
*          /**********************************************************/ 02527000
*                                                                  0497 02528000
*          THEN DO;               /* THEN:                           */ 02529000
@RC00479 TM    WKACMPLT(R13),B'01001000'                           0497 02530000
         BNO   @RF00497                                            0497 02531000
         TM    WKADTVAR(R13),B'10000000'                           0497 02532000
         BNZ   @RF00497                                            0497 02533000
*            WORKA=WKAAREAP;      /* POINT AT THE AREA TO SET        */ 02534000
         L     WORKA,WKAAREAP(,R13)                                0499 02535000
*                                 /* TO FF...FF'S                    */ 02536000
*            DO WORKB=1 TO WKAFNDLN;                               0500 02537000
         LA    WORKB,1                                             0500 02538000
         B     @DE00500                                            0500 02539000
@DL00500 DS    0H                                                  0501 02540000
*                                 /* LOOP TO SET THE WHOLE           */ 02541000
*                                 /* FIELD                           */ 02542000
*              WORKA->CHAR1='FF'X;/* SET THE BYTE TO F'S             */ 02543000
         MVI   CHAR1(WORKA),X'FF'                                  0501 02544000
*              WORKA=WORKA+LENGTH(CHAR1);                          0502 02545000
         AH    WORKA,@CH00047                                      0502 02546000
*                                 /* POINT AT THE NEXT BYTE          */ 02547000
*              END;               /*                                 */ 02548000
         AH    WORKB,@CH00047                                      0503 02549000
@DE00500 CH    WORKB,WKAFNDLN(,R13)                                0503 02550000
         BNH   @DL00500                                            0503 02551000
*            END;                 /*                                 */ 02552000
*                                                                  0504 02553000
*          /**********************************************************/ 02554000
*          /*                                                        */ 02555000
*          /*     MOVE THE DATA INTO THE WORK AREA AND HANDLE        */ 02556000
*          /*     THE FIELD REGARDLESS OF IF IT IS 1 TO 256, OR      */ 02557000
*          /*     257 TO 512 BYTES IN SIZE.                          */ 02558000
*          /*                                                        */ 02559000
*          /**********************************************************/ 02560000
*                                                                  0505 02561000
*          ELSE IF WKAFNDLN>256   /* ELSE: IF FIELD CAN NOT BE       */ 02562000
*                                 /* MOVED WITH A SINGLE MOVE        */ 02563000
*              THEN DO;           /* THEN:                           */ 02564000
         B     @RC00497                                            0505 02565000
@RF00497 LH    @03,WKAFNDLN(,R13)                                  0505 02566000
         CH    @03,@CH00285                                        0505 02567000
         BNH   @RF00505                                            0505 02568000
*                CHR(1:256)=CHRI(1:256);                           0507 02569000
         L     @02,WKAAREAP(,R13)                                  0507 02570000
         L     @01,WKAFNDAD(,R13)                                  0507 02571000
         MVC   CHR(256,@02),CHRI(@01)                              0507 02572000
*                                 /* MOVE THE FIRST 256 BYTES        */ 02573000
*                                 /* OF THE FIELD                    */ 02574000
*                CHR(257:WKAFNDLN)=CHRI(257:WKAFNDLN);             0508 02575000
         SH    @03,@CH00286                                        0508 02576000
         EX    @03,@SM00347                                        0508 02577000
*                                 /* MOVE THE REMAINDER OF THE       */ 02578000
*                                 /* FIELD                           */ 02579000
*                END;             /*                                 */ 02580000
*              ELSE IF WKAFNDLN^=0  /* MAKE SURE NOT NULL    @ZA05902*/ 02581000
*                                   /* VARIABLE LENGTH MOVE  @ZA05902*/ 02582000
*                  THEN CHR(1:WKAFNDLN)=CHRI(1:WKAFNDLN);  /*@ZA05902*/ 02583000
         B     @RC00505                                            0510 02584000
@RF00505 LH    @03,WKAFNDLN(,R13)                                  0510 02585000
         LTR   @03,@03                                             0510 02586000
         BZ    @RF00510                                            0510 02587000
         L     @01,WKAAREAP(,R13)                                  0511 02588000
         BCTR  @03,0                                               0511 02589000
         L     @02,WKAFNDAD(,R13)                                  0511 02590000
         EX    @03,@SM00349                                        0511 02591000
*                                 /* THEN: MOVE THE STRING LESS      */ 02592000
*                                 /*       THAN 256 BYTES            */ 02593000
*                  ELSE;          /* NOTHING TO MOVE         @ZA05902*/ 02594000
@RF00510 DS    0H                                                  0513 02595000
*        /************************************************************/ 02596000
*        /*                                                          */ 02597000
*        /*     ADJUST THE SIZE OF THE REMAINING WORK AREA           */ 02598000
*        /*     SPACE AND ADJUST THE POINTER TO THE NEXT             */ 02599000
*        /*     AVAILABLE AREA.                                      */ 02600000
*        /*                                                          */ 02601000
*        /************************************************************/ 02602000
*                                                                  0513 02603000
*        WKAAREAS=WKAAREAS-WKAFNDLN;                               0513 02604000
@RC00505 DS    0H                                                  0513 02605000
@RC00497 LH    @03,WKAFNDLN(,R13)                                  0513 02606000
         LH    @02,WKAAREAS(,R13)                                  0513 02607000
         SLR   @02,@03                                             0513 02608000
         STH   @02,WKAAREAS(,R13)                                  0513 02609000
*                                 /* DECREMENT THE USED SPACE        */ 02610000
*                                 /* FROM THE AVAILABLE              */ 02611000
*        WKAAREAP=WKAAREAP+WKAFNDLN;                               0514 02612000
         L     @02,WKAAREAP(,R13)                                  0514 02613000
         ALR   @02,@03                                             0514 02614000
         ST    @02,WKAAREAP(,R13)                                  0514 02615000
*                                 /* POINT AT THE NEXT               */ 02616000
*                                 /* AVAILABLE SPACE                 */ 02617000
*        FOALENTH=FOALENTH+WKAFNDLN;                               0515 02618000
         L     @02,FMPLOAR(,FMPLAD)                                0515 02619000
         AH    @03,FOALENTH(,@02)                                  0515 02620000
         STH   @03,FOALENTH(,@02)                                  0515 02621000
*                                 /* INCREMENT THE LENGTH OF         */ 02622000
*                                 /* THE OUTPUT DATA SUPPLIED        */ 02623000
*        END;                     /*                                 */ 02624000
*    END;                         /*                                 */ 02625000
*  END PSHIN;                     /* END OF PROCEDURE                */ 02626000
@EL00012 DS    0H                                                  0518 02627000
@EF00012 DS    0H                                                  0518 02628000
@ER00012 BR    @14                                                 0518 02629000
@PB00012 DS    0H                                                  0519 02630000
*  GEN(EJECT);                                                     0519 02631000
         EJECT                                                          02632000
*/********************************************************************/ 02633000
*/*                                                                  */ 02634000
*/*  PROCEDURE NAME = PTCMP                                          */ 02635000
*/*                                                                  */ 02636000
*/*  DESCRIPTIVE NAME = TEST COMPARATION OF SUB-FIELDS               */ 02637000
*/*                                                                  */ 02638000
*/*  FUNCTION =                                                      */ 02639000
*/*      THIS ROUTINE DOES THE COMPARASON BETWEEN THE FIELDS TO      */ 02640000
*/*      DETERMINE IF THE TEST FAILES OR NOT.                        */ 02641000
*/*                                                                  */ 02642000
*/*  ROUTINES CALLED                                                 */ 02643000
*/*      NONE                                                        */ 02644000
*/*                                                                  */ 02645000
*/********************************************************************/ 02646000
*                                                                  0520 02647000
*PTCMP: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0520 02648000
*                                                                  0520 02649000
         B     @PB00013                                            0520 02650000
PTCMP    DS    0H                                                  0521 02651000
*  /******************************************************************/ 02652000
*  /*                                                                */ 02653000
*  /*    HANDLE THE SETUP REQUIRED ON FIRST TIME THROUGH             */ 02654000
*  /*                                                                */ 02655000
*  /******************************************************************/ 02656000
*                                                                  0521 02657000
*  IF WKATCFTS='1'B               /* IF FIRST TIME SWITCH IS ON      */ 02658000
*    THEN DO;                     /* THEN:                           */ 02659000
         TM    WKATCFTS(R13),B'00010000'                           0521 02660000
         BNO   @RF00521                                            0521 02661000
*      WKATCFTS='0'B;             /* CLEAR THE FIRST TIME            */ 02662000
         NI    WKATCFTS(R13),B'11101111'                           0523 02663000
*                                 /* SWITCH                          */ 02664000
*      WKAADJLN=FMFLENTH(1);      /* SETUP THE ADJUSTED LENGTH       */ 02665000
         MVC   WKAADJLN(2,R13),FMFLENTH+2(FMFLCUR)                 0524 02666000
*                                 /* OF THE FIELD                    */ 02667000
*      WKAADJAD=FMFLADDR(1);      /* SETUP THE ADJUSTED ADDRESS      */ 02668000
         MVC   WKAADJAD(4,R13),FMFLADDR(FMFLCUR)                   0525 02669000
*                                 /* OF THE FIELD                    */ 02670000
*      END;                       /*                                 */ 02671000
*    ELSE;                        /* ELSE: CONTINUE                  */ 02672000
*                                                                  0527 02673000
@RF00521 DS    0H                                                  0528 02674000
*  /******************************************************************/ 02675000
*  /*                                                                */ 02676000
*  /*    DETERMINE THE LENGTH TO USE ON THIS COMPARASON              */ 02677000
*  /*                                                                */ 02678000
*  /******************************************************************/ 02679000
*                                                                  0528 02680000
*  IF WKAADJLN<WKAFNDLN           /* IF ADJUSTED LENGTH IS LESS      */ 02681000
*                                 /* THAN THE FOUND LENGTH           */ 02682000
*    THEN WORKA=WKAADJLN-1;       /* THEN: USE ADJUSTED LENGTH       */ 02683000
         LH    @03,WKAADJLN(,R13)                                  0528 02684000
         CH    @03,WKAFNDLN(,R13)                                  0528 02685000
         BNL   @RF00528                                            0528 02686000
         BCTR  @03,0                                               0529 02687000
         LR    WORKA,@03                                           0529 02688000
*    ELSE WORKA=WKAFNDLN-1;       /* ELSE: USE FOUND LENGTH          */ 02689000
         B     @RC00528                                            0530 02690000
@RF00528 LH    WORKA,WKAFNDLN(,R13)                                0530 02691000
         BCTR  WORKA,0                                             0530 02692000
*  /******************************************************************/ 02693000
*  /*                                                                */ 02694000
*  /*    SET UP THE COMMON THINGS FOR ALL COMPARISONS                */ 02695000
*  /*                                                                */ 02696000
*  /******************************************************************/ 02697000
*                                                                  0531 02698000
*  WORKB=FMFLTSTC;                /* SETUP THE CONDITION CODE        */ 02699000
@RC00528 SLR   WORKB,WORKB                                         0531 02700000
         IC    WORKB,FMFLTSTC(,FMFLCUR)                            0531 02701000
*  WORKC=WKAADJAD;                /* POINT AT INPUTED SUB-           */ 02702000
         L     WORKC,WKAADJAD(,R13)                                0532 02703000
*                                 /* FIELD                           */ 02704000
*  WORKD=WKAFNDAD;                /* POINT AT FOUND SUB-FIELD        */ 02705000
*                                                                  0533 02706000
         L     WORKD,WKAFNDAD(,R13)                                0533 02707000
*  /******************************************************************/ 02708000
*  /*                                                                */ 02709000
*  /*    SET UP FOR THE CLC TYPE COMPARISONS                         */ 02710000
*  /*                                                                */ 02711000
*  /******************************************************************/ 02712000
*                                                                  0534 02713000
*  IF WKADTFLG='0'B               /* IF THE TEST IS NOT FOR A        */ 02714000
*                                 /* FLAG BYTE                       */ 02715000
*    THEN DO;                     /* THEN:                           */ 02716000
         TM    WKADTFLG(R13),B'00010000'                           0534 02717000
         BNZ   @RF00534                                            0534 02718000
*      IF WKADTVAR='1'B           /* IF VARIABLE LENGTH FIELD        */ 02719000
*        THEN DO;                 /* THEN:                           */ 02720000
         TM    WKADTVAR(R13),B'10000000'                           0536 02721000
         BNO   @RF00536                                            0536 02722000
*          WORKA=WORKA-LENGTH(CBKVRLEN);                           0538 02723000
         LA    @03,2                                               0538 02724000
         SLR   WORKA,@03                                           0538 02725000
*                                 /* ADJUST COUNT FOR LENGTH         */ 02726000
*                                 /* FIELD                           */ 02727000
*          WORKC=WORKC+LENGTH(CBKVRLEN);                           0539 02728000
         ALR   WORKC,@03                                           0539 02729000
*                                 /* ADJUST INPUT SUB-FIELD FOR      */ 02730000
*                                 /* LENGTH FIELD                    */ 02731000
*          WORKD=WORKD+LENGTH(CBKVRLEN);                           0540 02732000
         ALR   WORKD,@03                                           0540 02733000
*                                 /* ADJUST FOUND FIELD FOR          */ 02734000
*                                 /* LENGTH FIELD                    */ 02735000
*          END;                   /*                                 */ 02736000
*        ELSE;                    /* ELSE: CONTINUE                  */ 02737000
@RF00536 DS    0H                                                  0543 02738000
*      WKAADJAD=WKAADJAD+WORKA+1; /* ADJUST ADDRESS OF INPUTED       */ 02739000
         LR    @03,WORKA                                           0543 02740000
         AL    @03,WKAADJAD(,R13)                                  0543 02741000
         AH    @03,@CH00047                                        0543 02742000
         ST    @03,WKAADJAD(,R13)                                  0543 02743000
*                                 /* FIELD FOR SUB-FIELD BEING       */ 02744000
*                                 /* CHECKED                         */ 02745000
*      WKAADJLN=WKAADJLN-WORKA-1; /* ADJUST LENGTH OF REMAINING      */ 02746000
         LH    @03,WKAADJLN(,R13)                                  0544 02747000
         SLR   @03,WORKA                                           0544 02748000
         BCTR  @03,0                                               0544 02749000
         STH   @03,WKAADJLN(,R13)                                  0544 02750000
*                                 /* FIELD FOR SUB-FIELD BEING       */ 02751000
*                                 /* CHECKED                         */ 02752000
*      IF WKADTVAR='1'B & WKAADJLN=LENGTH(CBKVRLEN)                0545 02753000
*                                 /* IF VARIABLE LENGTH FIELD        */ 02754000
*                                 /* AND LENGTH INCLUDES ONLY        */ 02755000
*                                 /* THE COUNT FIELD                 */ 02756000
*            THEN WKAADJLN=0;     /* THEN: IT SHOULD BE ZERO         */ 02757000
         TM    WKADTVAR(R13),B'10000000'                           0545 02758000
         BNO   @RF00545                                            0545 02759000
         CH    @03,@CH00200                                        0545 02760000
         BNE   @RF00545                                            0545 02761000
         SLR   @03,@03                                             0546 02762000
         STH   @03,WKAADJLN(,R13)                                  0546 02763000
*            ELSE;                /* ELSE: CONTINUE                  */ 02764000
@RF00545 DS    0H                                                  0548 02765000
*      R15=ADDR(PTCMPCM);         /* POINT AT THE COMPARE-           */ 02766000
         LA    R15,PTCMPCM                                         0548 02767000
*                                 /* LOGICAL-CHARACTERS              */ 02768000
*                                 /* INSTRUCTION                     */ 02769000
*      END;                       /*                                 */ 02770000
*    /****************************************************************/ 02771000
*    /*                                                              */ 02772000
*    /*    SET UP FOR TM TYPE COMPARISONS                            */ 02773000
*    /*                                                              */ 02774000
*    /****************************************************************/ 02775000
*                                                                  0550 02776000
*    ELSE DO;                     /* ELSE:                           */ 02777000
         B     @RC00534                                            0550 02778000
@RF00534 DS    0H                                                  0551 02779000
*      WKAADJLN=WKAADJLN-1;       /* ADJUST LENGTH FOR TEST          */ 02780000
         LH    @03,WKAADJLN(,R13)                                  0551 02781000
         BCTR  @03,0                                               0551 02782000
         STH   @03,WKAADJLN(,R13)                                  0551 02783000
*      WORKA=WORKC->CHAR1;        /* PICK UP THE MASK BYTE           */ 02784000
         SLR   WORKA,WORKA                                         0552 02785000
         IC    WORKA,CHAR1(,WORKC)                                 0552 02786000
*      R15=ADDR(PTCMPTM);         /* POINT AT THE TEST-UNDER-        */ 02787000
         LA    R15,PTCMPTM                                         0553 02788000
*                                 /* MASK INSTRUCTION                */ 02789000
*      END;                       /*                                 */ 02790000
*                                                                  0554 02791000
*  /******************************************************************/ 02792000
*  /*                                                                */ 02793000
*  /*    DO THE ACTUAL COMPARISON AND RETURN TO THE CALLER           */ 02794000
*  /*                                                                */ 02795000
*  /******************************************************************/ 02796000
*                                                                  0555 02797000
*  GEN(EX WORKA,0(R15))           /* DO THE TESTING                  */ 02798000
*     REFS(PTCMPCM,PTCMPTM);      /*                                 */ 02799000
@RC00534 DS    0H                                                  0555 02800000
         EX WORKA,0(R15)                                                02801000
*  GEN(EX WORKB,PTCMPBR)          /* BRANCH IF THE TEST IS           */ 02802000
*     REFS(PTCMPBR,PTCMP1);       /* SUCCESSFUL                      */ 02803000
         EX WORKB,PTCMPBR                                               02804000
*  WKAFSUCC='0'B;                 /* INDICATE THAT THE TEST IS       */ 02805000
         NI    WKAFSUCC(R13),B'11101111'                           0557 02806000
*                                 /* UNSUCCESSFUL                    */ 02807000
*PTCMP1:                                                           0558 02808000
*  RETURN;                        /* RETURN TO CALLER                */ 02809000
*                                                                  0558 02810000
@EL00013 DS    0H                                                  0558 02811000
@EF00013 DS    0H                                                  0558 02812000
@ER00013 BR    @14                                                 0558 02813000
*/********************************************************************/ 02814000
*/*                                                                  */ 02815000
*/*      THESE ARE THE INSTRUCTIONS THAT ARE TO BE EXECUTED          */ 02816000
*/*                                                                  */ 02817000
*/********************************************************************/ 02818000
*                                                                  0559 02819000
*PTCMPCM:                                                          0559 02820000
*  GEN(CLC 0(0,WORKD),0(WORKC));  /* COMPARE TWO FIELDS              */ 02821000
PTCMPCM  CLC 0(0,WORKD),0(WORKC)                                        02822000
*PTCMPTM:                                                          0560 02823000
*  GEN(TM  0(WORKD),0);           /* TEST BITS                       */ 02824000
PTCMPTM  TM  0(WORKD),0                                                 02825000
*PTCMPBR:                                                          0561 02826000
*  GEN(BC  0,PTCMP1);             /* BRANCH IF TEST SUCCESSFUL       */ 02827000
*                                                                  0561 02828000
PTCMPBR  BC  0,PTCMP1                                                   02829000
*  END PTCMP;                     /* END OF PROCEDURE                */ 02830000
         B     @EL00013                                            0562 02831000
@PB00013 DS    0H                                                  0563 02832000
*  GEN(EJECT);                                                     0563 02833000
         EJECT                                                          02834000
*/********************************************************************/ 02835000
*/*                                                                  */ 02836000
*/*  PROCEDURE NAME = PTRNS                                          */ 02837000
*/*                                                                  */ 02838000
*/*  DESCRIPTIVE NAME = TRANSLATE THE NAME TO INDICATORS             */ 02839000
*/*                                                                  */ 02840000
*/*  FUNCTION =                                                      */ 02841000
*/*      THIS ROUTINE LOOKS UP THE COMPRESSED NAME IN THE TABLE      */ 02842000
*/*      AND SUBSTITUDES THE INDICATORS IN THE FMFL IN THE WORK      */ 02843000
*/*      AREA FIELD.                                                 */ 02844000
*/*                                                                  */ 02845000
*/*  ROUTINES CALLED                                                 */ 02846000
*/*      NONE                                                        */ 02847000
*/*                                                                  */ 02848000
*/********************************************************************/ 02849000
*                                                                  0564 02850000
*PTRNS: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0564 02851000
*                                                                  0564 02852000
         B     @PB00014                                            0564 02853000
PTRNS    DS    0H                                                  0565 02854000
*  /******************************************************************/ 02855000
*  /*                                                                */ 02856000
*  /*     FORMAT THE COMPRESSED NAME THAT IS TO BE SEARCHED          */ 02857000
*  /*     FOR IN THE TABLE.                                          */ 02858000
*  /*                                                                */ 02859000
*  /******************************************************************/ 02860000
*                                                                  0565 02861000
*  WKANAME(1:2)=FMFLNAME(1:2);    /* PLACE THE FIRST TWO CHAR-       */ 02862000
         L     @03,FMFLDNAM(,FMFLCUR)                              0565 02863000
         MVC   WKANAME(2,R13),FMFLNAME(@03)                        0565 02864000
*                                 /* ACTERS OF THE NAME              */ 02865000
*  WKANAME(3:4)=FMFLNAME(5:6);    /* PLACE THE SECOND TWO CHAR-      */ 02866000
         MVC   WKANAME+2(2,R13),FMFLNAME+4(@03)                    0566 02867000
*                                 /* ACTERS OF THE NAME              */ 02868000
*                                                                  0567 02869000
*  /******************************************************************/ 02870000
*  /*                                                                */ 02871000
*  /*     SAVE THE ADDRESS OF THE COMPRESSED NAME TABLE FOR          */ 02872000
*  /*     OTHER PROCEDURES TO OBTAIN.                                */ 02873000
*  /*                                                                */ 02874000
*  /******************************************************************/ 02875000
*                                                                  0567 02876000
*  WKACOMBT=ADDR(Y000);           /* POINT AT THE COMBINATION        */ 02877000
         LA    @03,Y000                                            0567 02878000
         ST    @03,WKACOMBT(,R13)                                  0567 02879000
*                                 /* TABLE FOR LATTER USE            */ 02880000
*  WKADICTT=ADDR(X000);           /* POINT AT THE DICTIONARY         */ 02881000
         LA    @03,X000                                            0568 02882000
         ST    @03,WKADICTT(,R13)                                  0568 02883000
*                                 /* TABLE FOR FIELD NAMES           */ 02884000
*  /******************************************************************/ 02885000
*  /*                                                                */ 02886000
*  /*     SEARCH IN THE TABLE FOR THE FIELD NAME SPECIFIED           */ 02887000
*  /*     AND PLACE THE DICTIONARY INFORMATION IN THE WKA.           */ 02888000
*  /*                                                                */ 02889000
*  /******************************************************************/ 02890000
*                                                                  0569 02891000
*  WKADICTD=0;                    /* ZERO THE WORK AREA              */ 02892000
         SLR   @02,@02                                             0569 02893000
         ST    @02,WKADICTD(,R13)                                  0569 02894000
*                                 /* DICTIONARY INFORMATION          */ 02895000
*  FMPLRTCD=RTNCDIFN;             /* INITIALIZE THE RETURN CODE      */ 02896000
         MVI   FMPLRTCD(FMPLAD),X'04'                              0570 02897000
*                                 /* TO FIELD NOT FOUND IN CASE      */ 02898000
*                                 /* THAT THE FIELD IS NOT           */ 02899000
*                                 /* FOUND                           */ 02900000
*  WORKA=WKADICTT;                /* POINT AT THE START OF THE       */ 02901000
         LR    WORKA,@03                                           0571 02902000
*                                 /* TABLE TO SEARCH                 */ 02903000
*  WORKB=ADDR(X999);              /* POINT AT THE END OF THE         */ 02904000
         LA    WORKB,X999                                          0572 02905000
*                                 /* TABLE TO SEARCH                 */ 02906000
*  DO WHILE WORKA<WORKB;          /* LOOP UNTIL THE WHOLE TABLE      */ 02907000
         B     @DE00573                                            0573 02908000
@DL00573 DS    0H                                                  0574 02909000
*                                 /* SEARCHED                        */ 02910000
*    IF WKANAME=WORKA->DCTFNAME   /* IF THE NAME FOUND IN TABLE      */ 02911000
*      THEN DO;                   /* THEN:                           */ 02912000
         CLC   WKANAME(4,R13),DCTFNAME(WORKA)                      0574 02913000
         BNE   @RF00574                                            0574 02914000
*        WKADICTD=WORKA->DCTDINFO;/* PLACE THE DICTIONARY            */ 02915000
         MVC   WKADICTD(4,R13),DCTDINFO(WORKA)                     0576 02916000
*                                 /* INFORMATION IN THE WKA          */ 02917000
*        WORKA=WORKB;             /* INDICATE THAT THE LOOP IS       */ 02918000
         LR    WORKA,WORKB                                         0577 02919000
*                                 /* IS DONE WITH THE SEARCH         */ 02920000
*        FMPLRTCD=RTNCDNML;       /* INDICATE THAT THE FIELD         */ 02921000
         MVI   FMPLRTCD(FMPLAD),X'00'                              0578 02922000
*                                 /* WAS FOUND                       */ 02923000
*        END;                     /*                                 */ 02924000
*      ELSE WORKA=WORKA+LENGTH(DCT);                               0580 02925000
         B     @RC00574                                            0580 02926000
@RF00574 AH    WORKA,@CH00053                                      0580 02927000
*                                 /* ELSE: POINT AT THE NEXT         */ 02928000
*                                 /*       ENTRY IN THE TABLE        */ 02929000
*    END;                         /*                                 */ 02930000
*                                                                  0581 02931000
@RC00574 DS    0H                                                  0581 02932000
@DE00573 CR    WORKA,WORKB                                         0581 02933000
         BL    @DL00573                                            0581 02934000
*  /******************************************************************/ 02935000
*  /*                                                                */ 02936000
*  /*     FOR ALL SPECIAL FIELD NAMES THE GROUP CODE IS              */ 02937000
*  /*     OBTAINED FROM THE CALLERS FMFL.                            */ 02938000
*  /*                                                                */ 02939000
*  /******************************************************************/ 02940000
*                                                                  0582 02941000
*  IF WKADTSPL='1'B               /* IF ONE OF THE SPECIAL           */ 02942000
*                                 /* FUNCTIONS                       */ 02943000
*    THEN WKAGRPCD=FMFLGRPC;      /* THEN: PLACE THE USER            */ 02944000
         TM    WKADTSPL(R13),B'00000001'                           0582 02945000
         BNO   @RF00582                                            0582 02946000
         MVC   WKAGRPCD(1,R13),FMFLGRPC(FMFLCUR)                   0583 02947000
*                                 /*       SUPPLIED GROUP CODE       */ 02948000
*    ELSE;                        /* ELSE: CONTINUE                  */ 02949000
@RF00582 DS    0H                                                  0585 02950000
*  /******************************************************************/ 02951000
*  /*                                                                */ 02952000
*  /*     VALIDITY CHECK THE FIELD NAME TO INSURE THAT IT HAS        */ 02953000
*  /*     NOT BEEN PLACED WHERE IT SHOULD NOT HAVE BEEN, AND         */ 02954000
*  /*     INSURE THAT ALL GROUP CODES IN A SINGLE CHAIN ARE          */ 02955000
*  /*     THE SAME. ALSO INSURE THAT NO COMBINATION NAME IS          */ 02956000
*  /*     USED IN THE TEST CHAIN.                                    */ 02957000
*  /*                                                                */ 02958000
*  /******************************************************************/ 02959000
*                                                                  0585 02960000
*  IF WKATSTFL='1'B               /* IF THIS IS A TEST FMFL          */ 02961000
*    THEN DO;                     /* THEN:                           */ 02962000
         TM    WKATSTFL(R13),B'00001000'                           0585 02963000
         BNO   @RF00585                                            0585 02964000
*      IF (FMFLTSTC & 'F0'X)=0 | (FMFLTSTC & '0F'X)^=0             0587 02965000
*                                 /* IF INVALID CONDITION CODE       */ 02966000
*                                 /* BYTE PROVIDED                   */ 02967000
*        THEN FMPLRTCD=RTNCDTCC;  /* THEN: INDICATE THE ERROR        */ 02968000
         SLR   @03,@03                                             0587 02969000
         SLR   @02,@02                                             0587 02970000
         IC    @02,FMFLTSTC(,FMFLCUR)                              0587 02971000
         LA    @01,240                                             0587 02972000
         NR    @01,@02                                             0587 02973000
         CR    @01,@03                                             0587 02974000
         BE    @RT00587                                            0587 02975000
         N     @02,@CF00306                                        0587 02976000
         CR    @02,@03                                             0587 02977000
         BE    @RF00587                                            0587 02978000
@RT00587 DS    0H                                                  0588 02979000
         MVI   FMPLRTCD(FMPLAD),X'10'                              0588 02980000
*        ELSE;                    /* ELSE: CONTINUE                  */ 02981000
@RF00587 DS    0H                                                  0590 02982000
*      IF WKADTCMB='1'B           /* IF A COMBINED FIELD NAME        */ 02983000
*        THEN FMPLRTCD=RTNCDIFS;  /* THEN: INDICATE THE ERROR        */ 02984000
         TM    WKADTCMB(R13),B'00100000'                           0590 02985000
         BNO   @RF00590                                            0590 02986000
         MVI   FMPLRTCD(FMPLAD),X'0C'                              0591 02987000
*        ELSE;                    /* ELSE: CONTINUE                  */ 02988000
@RF00590 DS    0H                                                  0593 02989000
*      IF WKASVGRC=WKAGRPCD       /* IF THE GROUP CODE IS THE        */ 02990000
*                                 /* SAME AS THE REST OF THE         */ 02991000
*                                 /* FIELD NAMES                     */ 02992000
*        THEN;                    /* THEN: CONTINUE                  */ 02993000
         CLC   WKASVGRC(1,R13),WKAGRPCD(R13)                       0593 02994000
         BE    @RT00593                                            0593 02995000
*        ELSE FMPLRTCD=RTNCDIGC;  /* ELSE: INDICATE THE ERROR        */ 02996000
         MVI   FMPLRTCD(FMPLAD),X'08'                              0595 02997000
*      END;                       /*                                 */ 02998000
*    ELSE DO;                     /* ELSE:                           */ 02999000
         B     @RC00585                                            0597 03000000
@RF00585 DS    0H                                                  0598 03001000
*      WKASVGRC=WKAGRPCD;         /* SAVE THE GROUP CODE SO          */ 03002000
         MVC   WKASVGRC(1,R13),WKAGRPCD(R13)                       0598 03003000
*                                 /* THAT ALL OTHER GROUP CODES      */ 03004000
*                                 /* CAN BE CHECKED TO IT            */ 03005000
*      IF WKADTSPL='1'B           /* IF THIS IS A SPECIAL FUNC-      */ 03006000
*                                 /* TION                            */ 03007000
*        THEN IF WKADTSTR=CONCNTRN/* THEN: IF CNTREPNO FUNCTION      */ 03008000
         TM    WKADTSPL(R13),B'00000001'                           0599 03009000
         BNO   @RF00599                                            0599 03010000
*          THEN FMPLRTCD=RTNCDIFS;/* THEN: INDICATE ERROR            */ 03011000
         CLI   WKADTSTR(R13),X'02'                                 0600 03012000
         BNE   @RF00600                                            0600 03013000
         MVI   FMPLRTCD(FMPLAD),X'0C'                              0601 03014000
*          ELSE;                  /* ELSE: CONTINUE                  */ 03015000
@RF00600 DS    0H                                                  0603 03016000
*        ELSE;                    /* ELSE: CONTINUE                  */ 03017000
@RF00599 DS    0H                                                  0604 03018000
*                                 /* CODE FOR CHECKING TO            */ 03019000
*      END;                       /*                                 */ 03020000
*                                                                  0604 03021000
*  /******************************************************************/ 03022000
*  /*                                                                */ 03023000
*  /*     PLACE THE DICTIONARY INFORMATION IN THE FMFL.              */ 03024000
*  /*                                                                */ 03025000
*  /******************************************************************/ 03026000
*                                                                  0605 03027000
*  FMFLWKAR=WKADICTD;             /* MOVE THE DICTIONARY INFOR-      */ 03028000
@RC00585 MVC   FMFLWKAR(4,FMFLCUR),WKADICTD(R13)                   0605 03029000
*                                 /* MATION FORM THE WORK AREA       */ 03030000
*                                 /* TO THE FMFL                     */ 03031000
*  /******************************************************************/ 03032000
*  /*                                                                */ 03033000
*  /*    FOR ALL NON-TEST FL'S ZERO THE ADDRESS AND LENGTH           */ 03034000
*  /*    FIELDS TO BEGIN PROCESSING.                                 */ 03035000
*  /*                                                                */ 03036000
*  /******************************************************************/ 03037000
*                                                                  0606 03038000
*  IF WKATSTFL='0'B               /* IF THIS IS NOT A TEST FL        */ 03039000
*    THEN DO;                     /* THEN:                           */ 03040000
         TM    WKATSTFL(R13),B'00001000'                           0606 03041000
         BNZ   @RF00606                                            0606 03042000
*      FMFLENTH(1)=0;             /* INITIALIZE THE LENGTH           */ 03043000
         SLR   @03,@03                                             0608 03044000
         ST    @03,FMFLENTH(,FMFLCUR)                              0608 03045000
*                                 /* FIELD TO ZERO                   */ 03046000
*      FMFLADDR(1)=0;             /* INITIALIZE THE ADDRESS          */ 03047000
         ST    @03,FMFLADDR(,FMFLCUR)                              0609 03048000
*                                 /* FIELD TO ZERO                   */ 03049000
*      END;                       /*                                 */ 03050000
*    ELSE;                        /* ELSE: CONTINUE                  */ 03051000
*                                                                  0611 03052000
@RF00606 DS    0H                                                  0612 03053000
*  /******************************************************************/ 03054000
*  /*                                                                */ 03055000
*  /*     RETURN TO THE CALLER.                                      */ 03056000
*  /*                                                                */ 03057000
*  /******************************************************************/ 03058000
*                                                                  0612 03059000
*  RETURN;                        /* RETURN TO CALLING               */ 03060000
@EL00014 DS    0H                                                  0612 03061000
@EF00014 DS    0H                                                  0612 03062000
@ER00014 BR    @14                                                 0612 03063000
*                                 /* PROCEDURE                       */ 03064000
*/********************************************************************/ 03065000
*/*                                                                  */ 03066000
*/*     THIS IS THE NAME TRANSLATION TABLE TO BE USED TO             */ 03067000
*/*     TRANSLATE THE NAMES IN THE FIELD MANAGEMENT FIELD            */ 03068000
*/*     LISTS (FMFL'S).                                              */ 03069000
*/*                                                                  */ 03070000
*/********************************************************************/ 03071000
*                                                                  0613 03072000
*X000: ;                                                           0613 03073000
X000     DS    0H                                                  0614 03074000
*  GEN REFS(Y000);                                                 0614 03075000
        DICT  $DSDIREC,COMB=YES,GC=8       DIREC INFO FOR SYNC CK       03076000
        DICT  $DSDRIRN,COMB=YES,GC=8       DIREC AND RELREPNO @OZ25037  03077000
        DICT  $EXTDATA,COMB=YES,GC=3       VOL OCCUR INFO FOR SYNC CK   03078000
        DICT  $EXTPTRS,PTRS=YES,LEN=3      RECORD EXTENTION PTRS        03079000
        DICT  $MXLRECL,OFF=26,LEN=4,GC=1   MAXIMUM LRECL                03080000
        DICT  $SPCEHDR,COMB=YES,GC=6       INFO FOR LISTCRA             03081000
        DICT  $USEDLEN,OFF=45,LEN=2        SPACE USED LENGTH            03082000
        DICT  AMDSBCAT,OFF=2,LEN=96,GC=1   CAT COPY OF AMDSB CNTRL BLK  03083000
        DICT  ATTR1,OFF=107,LEN=1,BYTE=YES DATA SET ATTRIBUTES          03084000
        DICT  ATTR2,OFF=108,LEN=1,BYTE=YES DATA SET ATTRIBUTES          03085000
        DICT  BITMAP,FIELD=1,GC=5          VOLUME SPACE BIT MAP         03086000
        DICT  BUFSIZE,OFF=110,LEN=4        MINIMUM BUFFER SPACE         03087000
        DICT  CATVOL,COMB=YES,GC=3         VOL OCCUR FOR ALIEN          03088000
        DICT  CATTR,OFF=107,LEN=1,BYTE=YES CLUSTER ATTRIBUTES           03089000
        DICT  CNTREPNO,SPECIAL=2,LEN=2     MAX RELREPNOS TO PROCESS     03090000
        DICT  CRAIDNO,OFF=11,LEN=3         CRA CI NUMBER                03091000
        DICT  CRADEVT,OFF=14,LEN=4         CRA DEVICE TYPE              03092000
        DICT  CRADITS,OFF=22,LEN=4         D/I CREATION T.S.            03093000
        DICT  CRAVOL,OFF=5,LEN=6           CRA VOLUME SERIAL            03094000
        DICT  CRACRETS,OFF=18,LEN=4        CRA CREATION T.S.            03095000
        DICT  DATASPAC,COMB=YES,GC=6       ENTIRE DATA SPACE GROUP      03096000
        DICT  DEXTENTS,COMB=YES,GC=6       DATA SPACE GRP FOR SALL      03097000
        DICT  DEVTYP,OFF=2,LEN=4,GC=3      VOLUME OCCUR DEVICE TYPE     03098000
        DICT  DIRECTRY,COMB=YES,GC=8       ENTIRE DATA SET DIRECTORY    03099000
        DICT  DSETCRDT,OFF=101,LEN=3       DATA SET CREATION DATE       03100000
        DICT  DSCRETS,OFF=5,LEN=4,GC=8     D/I CREATION T.S.            03101000
        DICT  DSETEXDT,OFF=104,LEN=3       DATA SET EXPIRATION DATE     03102000
        DICT  DSSUMTT,OFF=9,LEN=3,GC=8     SUM OF BEGINING TRACKS       03103000
        DICT  DSIDNO,OFF=2,LEN=3,GC=8      DATA SET DIRECTORY CI NO.    03104000
        DICT  DSPSOPT,OFF=17,LEN=1,GC=6,BYTE=YES                        03105000
*                                          SPACE OPTIONS FOR DATA SET   03106000
        DICT  DSTYPNAM,COMB=YES            ENTRY TYPE AND NAME          03107000
        DICT  DSCBPTR,OFF=10,LEN=5,GC=6    TTR OF DSCB FOR DATA SET     03108000
        DICT  DSATRO,COMB=YES              DATA SET ATTRIBUTES          03109000
        DICT  DSDIRSN,OFF=37,LEN=2,GC=3    DS DIR SEQ NO IN VOL OCCUR   03110000
        DICT  DSPSSQ,OFF=18,LEN=3,GC=6     SECONDARY DATA SPACE AMOUNT  03111000
        DICT  DSATTR,COMB=YES              DATA SET ATTRIBUTES          03112000
        DICT  DSCBTS,OFF=2,LEN=8,GC=6      DATA SPACE T.S.              03113000
        DICT  ENTNAME,OFF=49,LEN=44        ENTRY NAME                   03114000
        DICT  ENTIDNO,OFF=1,LEN=3          ENTRY CI NO.                 03115000
        DICT  ENTVOL,COMB=YES,GC=3         ENTRY VOL OCCUR              03116000
        DICT  ENTYPE,OFF=44,LEN=1          ENTRY TYPE                   03117000
        DICT  ENTUPGD,COMB=YES,GC=2        UPGRADE ASSOC GROUP          03118000
        DICT  ENTASSOC,COMB=YES,GC=2       ENTIRE ASSOC GROUP           03119000
        DICT  EXCPEXIT,OFF=135,LEN=8       EXCEPTION EXIT               03120000
        DICT  EXTENT,FIELD=3,GC=3          EXTENT DESCRIPTIONS          03121000
        DICT  EXTVOL,COMB=YES,GC=3         VOL OCCUR FOR EOV            03122000
        DICT  FILESEQ,OFF=12,LEN=2,GC=3    VOL OCCUR FILE SEQ NO        03123000
        DICT  HARBA,OFF=24,LEN=4,GC=3      HIGH ALLOC RBA IN VOL OCCUR  03124000
        DICT  HARBADS,OFF=125,LEN=4        HIGH ALLOC RBA FOR DATA SET  03125000
        DICT  HIKEYV,FIELD=2,GC=3          HIGH KEY IN VOL OCCUR        03126000
        DICT  HKRBA,OFF=16,LEN=4,GC=3      HIGH KEY RBA FOR DS          03127000
        DICT  HKURBA,COMB=YES,GC=3         HIGH KEY AND USED RBA        03128000
        DICT  HURBA,OFF=20,LEN=4,GC=3      HIGH USED RBA FOR DS         03129000
        DICT  HURBADS,OFF=121,LEN=4        HIGH USED                    03130000
        DICT  ITYPEXT,OFF=36,LEN=1,GC=3,BYTE=YES                        03131000
*                                          IND TYPE FOR EXTENT          03132000
        DICT  LOKEYV,FIELD=1,GC=3          LOW KEY IN VOL OCCUR         03133000
        DICT  LRECL,OFF=129,LEN=4          AVER LOGICAL RCD SIZE        03134000
        DICT  MAPSPACE,COMB=YES,GC=5       ENTIRE VOL BIT MAP GROUP     03135000
        DICT  NAME,OFF=3,LEN=3,GC=2        ASSOCIATION CI NO            03136000
        DICT  NAMEDS,COMB=YES,GC=2         ENTIRE ASSOCIATION GROUP     03137000
        DICT  NAME2,OFF=7,LEN=3,GC=2       ASSOCIATION CI NO            03138000
        DICT  NOTRKAU,OFF=34,LEN=2,GC=3    NO OF TRKS PER ALLOC UNIT    03139000
        DICT  NOBLKTRK,OFF=32,LEN=2,GC=3   NO OF BLKS PER TRK           03140000
        DICT  NODSPEXT,OFF=16,LEN=1,GC=6   NO OF DATA SPACE EXTENTS     03141000
        DICT  NOEXTNT,OFF=15,LEN=1,GC=3    NO OF VOL OCCUR EXTENTS      03142000
        DICT  OPNCALL1,COMB=YES            NON-REP FIELDS FOR OPEN      03143000
        DICT  OPENCNT,OFF=109,LEN=1        OPEN COUNT                   03144000
        DICT  OPENIND,OFF=109,LEN=1,BYTE=YES                            03145000
*                                          OPEN INDICATOR               03146000
        DICT  OWNERID,OFF=93,LEN=8         OWNER ID                     03147000
        DICT  PASSATMP,OFF=42,LEN=2,GC=4   NO OF SECURITY ATTEMPTS      03148000
        DICT  PASSPRMT,OFF=34,LEN=8,GC=4   SECURITY PROMPTING NAME      03149000
        DICT  PASSWALL,COMB=YES,GC=4       ENTIRE SECURITY GROUP        03150000
        DICT  PASSWORD,OFF=2,LEN=32,GC=4   PASSWORDS                    03151000
        DICT  PHYBLKSZ,OFF=28,LEN=4,GC=3   VOL OCCUR PHYSICAL BLKSZ     03152000
        DICT  PRIMSPAC,OFF=114,LEN=3       PRIMARY SPACE                03153000
        DICT  RELREPNO,SPECIAL=3,LEN=2     RELATIVE REPITION NUMBER     03154000
        DICT  RELIND,OFF=4,LEN=1           RELEASE INDICATOR            03155000
        DICT  REPNO,SPECIAL=4,LEN=2        HIGHEST NON-DELETED SEQ NO   03156000
        DICT  RELCRA,COMB=YES              RELEASE INDICATOR AND CRA    03157000
        DICT  RGATTR,OFF=107,LEN=1,BYTE=YES                             03158000
*                                          PATH/AIX ATTRIBUTES          03159000
        DICT  SCONSPAC,OFF=117,LEN=3       SECONDARY SPACE              03160000
        DICT  SECFLAGS,OFF=26,LEN=1,BYTE=YES                  @Z40RSSA  03161000
        DICT  SPHDFLG,OFF=15,LEN=1,GC=6,BYTE=YES                        03162000
*                                          DATA SPACE FLAG              03163000
        DICT  SPACOPTN,OFF=120,LEN=1,BYTE=YES                           03164000
*                                          SPACE OPTIONS                03165000
        DICT  SPACPARM,COMB=YES            SPACE AMOUNTS & OPTIONS      03166000
        DICT  SPEXTENT,OFF=21,LEN=64,GC=6  DATA SPACE EXTENT DESCRIP    03167000
        DICT  SYSEXTDS,OFF=122,LEN=1,GC=128                             03168000
*                                          AOS ALOWED EXTENTS PER SALL  03169000
        DICT  TYPE,OFF=2,LEN=1,GC=2        ASSOCIATION ENTRY TYPE       03170000
        DICT  TYPE2,OFF=6,LEN=1,GC=2       ASSOCIATION ENTRY TYPE       03171000
        DICT  UPDVOL,COMB=YES,GC=3         VOL OCCUR FOR EXTEND         03172000
        DICT  UPGRADE,COMB=YES,GC=2        UPGRADE ASSOCIATION GROUP    03173000
        DICT  USERAREC,FIELD=1,GC=4        SECURITY AUTHORIZATION DATA  03174000
        DICT  USERINFO,OFF=133,LEN=2       IIP FIELD                    03175000
        DICT  USVRMDUL,OFF=44,LEN=8,GC=4   SECURITY MODULE NAME         03176000
        DICT  VOLSER,OFF=6,LEN=6,GC=3      VOL OCCUR VOLUME SERIAL      03177000
        DICT  VOLDEV,COMB=YES,GC=3         VOL OCCUR FOR OPEN           03178000
        DICT  VOLRFLG,OFF=121,LEN=1,GC=128,BYTE=YES                     03179000
*                                          VOLUME RECORD FLAGS          03180000
        DICT  VOLPHY,COMB=YES,GC=3         VOLUME OCCUR FOR OPEN        03181000
        DICT  VOLFLG,OFF=14,LEN=1,GC=3,BYTE=YES                         03182000
*                                          VOLUME OCCURENCE FLAGS       03183000
        DICT  VOLTSTMP,OFF=93,LEN=8,GC=128 VOLUME ENTRY T.S.            03184000
        DICT  VOLDVCHR,OFF=101,LEN=20,GC=128                            03185000
*                                          VOL ENTRY DEV CHARACTER      03186000
        DICT  VOLEXT,COMB=YES,GC=3         VOLUME OCCURRANCE            03187000
*X999: ;                                                           0615 03188000
*                                                                  0615 03189000
X999     DS    0H                                                  0616 03190000
*Y000: ;                                                           0616 03191000
Y000     DS    0H                                                  0617 03192000
*  GEN REFS(X000);                                                 0617 03193000
*                                                                  0617 03194000
        COMB   $DSDIREC,(DSIDNO,DSCRETS,DSSUMTT)                        03195000
        COMB   $DSDRIRN,(DSIDNO,DSCRETS,DSSUMTT,RELREPNO)     @OZ25037  03196000
        COMB   $EXTDATA,(VOLSER,DSDIRSN,EXTENT)                         03197000
        COMB   $SPCEHDR,(RELREPNO,DSCBTS,DSCBPTR,SPHDFLG,NODSPEXT,    **03198000
               DSPSOPT,DSPSSQ)                                          03199000
        COMB   CATVOL,(RELREPNO,DEVTYP,VOLSER,FILESER,VOLFLG)           03200000
        COMB   DATASPAC,(RELREPNO,DSCBTS,DSCBPTR,SPHDFLG,NODSPEXT,    **03201000
               DSPSOPT,DSPSSQ,SPEXTENT)                                 03202000
        COMB   DEXTENTS,(RELREPNO,SPHDFLG,NODSPEXT,SPEXTENT)            03203000
        COMB   DIRECTRY,(RELREPNO,DSIDNO)                               03204000
        COMB   DSTYPNAM,(ENTYPE,ENTIDNO)                                03205000
        COMB   DSATRO,(ATTR1,ATTR2,OPENIND)                             03206000
        COMB   DSATTR,(ATTR1,ATTR2)                                     03207000
        COMB   ENTVOL,(RELREPNO,DEVTYP,VOLSER,FILESEQ,VOLFLG,NOEXTNT, **03208000
               HKRBA,HURBA,HARBA,PHYBLKSZ,NOBLKTRK,NOTRKAU,ITYPEXT,   **03209000
               DSDIRSN,LOKEYV,HIKEYV,EXTENT)                            03210000
        COMB   ENTUPG,(RELREPNO,TYPE,NAME,TYPE2,NAME2)                  03211000
        COMB   ENTASSOC,(RELREPNO,TYPE,NAME)                            03212000
        COMB   EXTVOL,(RELREPNO,DEVTYP,ITYPEXT,EXTENT)                  03213000
        COMB   HKURBA,(HKRBA,HURBA)                                     03214000
        COMB   MAPSPACE,(RELREPNO,BITMAP)                               03215000
        COMB   NAMEDS,(TYPE,NAME)                                       03216000
        COMB   OPNCALL1,(SPACOPTN,BUFSIZE,ENTNAME,HURBADS)              03217000
        COMB   PASSWALL,(PASSWORD,PASSPRMT,PASSATMP,USVRMDUL,USERAREC)  03218000
        COMB   RELCRA,(RELIND,CRAVOL,CRAIDNO,CRADEVT)                   03219000
        COMB   SPACPARM,(PRIMSPAC,SCONSPAC,SPACOPTN)                    03220000
        COMB   UPDVOL,(RELREPNO,DEVTYP,VOLSER,FILESEQ,VOLFLG,NOEXTNT, **03221000
               HKRBA,HURBA,HARBA,PHYBLKSZ,NOBLKTRK,NOTRKAU,ITYPEXT,   **03222000
               DSDIRSN,LOKEYV,HIKEYV)                                   03223000
        COMB   UPGRADE,(TYPE,NAME,TYPE2,NAME2)                          03224000
        COMB   VOLDEV,(DEVTYP,PHYBLKSZ,NOBLKTRK,NOTRKAU)                03225000
        COMB   VOLPHY,(RELREPNO,VOLSER,VOLFLG,NOEXTNT,HKRBA,HURBA,    **03226000
               HARBA,ITYPEXT,LOKEYV,HIKEYV,EXTENT)                      03227000
        COMB   VOLEXT,(RELREPNO,VOLSER,DSDIRSN,EXTENT)                  03228000
*  END PTRNS;                     /* END OF PROCEDURE                */ 03229000
         B     @EL00014                                            0618 03230000
@PB00014 DS    0H                                                  0619 03231000
*  GEN(EJECT);                                                     0619 03232000
         EJECT                                                          03233000
*/********************************************************************/ 03234000
*/*                                                                  */ 03235000
*/*  PROCEDURE NAME = PTSTS                                          */ 03236000
*/*                                                                  */ 03237000
*/*  DESCRIPTIVE NAME = TEST THE FMFL'S IN TEST CHAIN                */ 03238000
*/*                                                                  */ 03239000
*/*  FUNCTION =                                                      */ 03240000
*/*      THIS ROUTINE LOOPS DOWN THE TEST CHAIN AND CHECKS OUT       */ 03241000
*/*      THE DESIRED RELREPNO PROVIDED TO SEE IF THIS ONE WILL       */ 03242000
*/*      SATISFY THE NEEDS OF THE TESTS AND RETURNS THE              */ 03243000
*/*      APPROPIATE INDICATION.                                      */ 03244000
*/*                                                                  */ 03245000
*/*  ROUTINES CALLED                                                 */ 03246000
*/*      PGVAL                                                       */ 03247000
*/*      PTCMP                                                       */ 03248000
*/*                                                                  */ 03249000
*/********************************************************************/ 03250000
*                                                                  0620 03251000
*PTSTS: PROCEDURE OPTIONS(NOSAVEAREA NOSAVE);                      0620 03252000
*                                                                  0620 03253000
         B     @PB00015                                            0620 03254000
PTSTS    DS    0H                                                  0621 03255000
*  /******************************************************************/ 03256000
*  /*                                                                */ 03257000
*  /*    SAVE THE RETURN ADDRESS ON ENTRY AND INITIALIZE FOR         */ 03258000
*  /*    THE FOLLOWING PROCESS                                       */ 03259000
*  /*                                                                */ 03260000
*  /******************************************************************/ 03261000
*                                                                  0621 03262000
*  WKARTNI=R14;                   /* SAVE THE RETURN ADDRESS         */ 03263000
         ST    R14,WKARTNI(,R13)                                   0621 03264000
*  WKAFSUCC='1'B;                 /* ASSUME THAT THE TEST WAS A      */ 03265000
         OI    WKAFSUCC(R13),B'00010000'                           0622 03266000
*                                 /* SUCCESS                         */ 03267000
*                                                                  0623 03268000
*  /******************************************************************/ 03269000
*  /*                                                                */ 03270000
*  /*    LOOP THROUGH ALL OF THE FMFL'S ON THE TEST CHAIN OR         */ 03271000
*  /*    UNTIL THERE IS A FAILURE                                    */ 03272000
*  /*                                                                */ 03273000
*  /******************************************************************/ 03274000
*                                                                  0623 03275000
*  DO WHILE FMFLTCHN^=0 & WKAFSUCC='1'B;                           0623 03276000
         B     @DE00623                                            0623 03277000
@DL00623 DS    0H                                                  0624 03278000
*                                 /* LOOP WHILE THERE IS AN-         */ 03279000
*                                 /* OTHER TEST FMFL TO CHECK        */ 03280000
*                                 /* AND THE TESTS UNTIL NOW         */ 03281000
*                                 /* HAVE BEEN SUCCESSFUL            */ 03282000
*    FMFLCUR=FMFLTCHN;            /* POINT AT THE NEXT FMFL TO       */ 03283000
         L     FMFLCUR,FMFLTCHN(,FMFLCUR)                          0624 03284000
*                                 /* CHECK                           */ 03285000
*    WKADICTD=FMFLWKAR;           /* PLACE THE DICTIONARY            */ 03286000
         MVC   WKADICTD(4,R13),FMFLWKAR(FMFLCUR)                   0625 03287000
*                                 /* INFORMATION IN THE WORK         */ 03288000
*                                 /* AREA                            */ 03289000
*    /****************************************************************/ 03290000
*    /*                                                              */ 03291000
*    /*    HANDLE THE CNTREPNO FUNCTION                              */ 03292000
*    /*                                                              */ 03293000
*    /****************************************************************/ 03294000
*                                                                  0626 03295000
*    IF WKADTSPL='1'B & WKADTSTR=CONCNTRN                          0626 03296000
*                                 /* IF THIS IS A SPECIAL FIELD      */ 03297000
*                                 /* NAME AND THAT NAME IS           */ 03298000
*                                 /* CNTREPNO                        */ 03299000
*      THEN DO;                   /* THEN:                           */ 03300000
         TM    WKADTSPL(R13),B'00000001'                           0626 03301000
         BNO   @RF00626                                            0626 03302000
         CLI   WKADTSTR(R13),X'02'                                 0626 03303000
         BNE   @RF00626                                            0626 03304000
*        IF WKADRRNO<=FMFLCNTR    /* IF THE RELREPNO HAS NOT         */ 03305000
*                                 /* EXCEEDED THE DESIRED VALUE      */ 03306000
*          THEN WKAFLDNE='0'B;    /* THEN: INDICATE THAT THE         */ 03307000
         L     @01,FMFLADDR(,FMFLCUR)                              0628 03308000
         LH    @00,WKADRRNO(,R13)                                  0628 03309000
         CH    @00,FMFLCNTR(,@01)                                  0628 03310000
         BH    @RF00628                                            0628 03311000
         NI    WKAFLDNE(R13),B'10111111'                           0629 03312000
*                                 /*       FIELD DOES EXIST          */ 03313000
*          ELSE DO;               /* ELSE:                           */ 03314000
         B     @RC00628                                            0630 03315000
@RF00628 DS    0H                                                  0631 03316000
*            WKAFSUCC='0'B;       /* INDICATE THAT THE FIELD         */ 03317000
*                                 /* WAS NOT A SUCCESS               */ 03318000
*            WKAFLDNE='1'B;       /* INDICATE THAT THE FIELD         */ 03319000
         OI    WKAFLDNE(R13),B'01000000'                           0632 03320000
         NI    WKAFSUCC(R13),B'11101111'                           0632 03321000
*                                 /* DOES NOT EXIST                  */ 03322000
*            END;                 /*                                 */ 03323000
*        WKACMPLT='1'B;           /* INDICATE THAT THE FIELD         */ 03324000
@RC00628 DS    0H                                                  0635 03325000
*                                 /* WAS NOT COMPLETE                */ 03326000
*        WKAFLDNF='1'B;           /* INDICATE THAT THE GROUP         */ 03327000
         OI    WKACMPLT(R13),B'00101000'                           0635 03328000
*                                 /* CODE WAS NOT FOUND              */ 03329000
*        END;                     /*                                 */ 03330000
*                                                                  0636 03331000
*      /**************************************************************/ 03332000
*      /*                                                            */ 03333000
*      /*    HANDLE ALL OF THE OTHER FUNCTIONS                       */ 03334000
*      /*                                                            */ 03335000
*      /**************************************************************/ 03336000
*                                                                  0637 03337000
*      ELSE DO;                   /* ELSE:                           */ 03338000
         B     @RC00626                                            0637 03339000
@RF00626 DS    0H                                                  0638 03340000
*        WKATCFTS='1'B;           /* INDICATE THAT THIS IS THE       */ 03341000
*                                 /* FIRST TIME THROUGH TEST         */ 03342000
*                                 /* COMPARISON FOR THIS FIELD       */ 03343000
*        WKAGVFTS='1'B;           /* INDICATE THE FIRST TIME         */ 03344000
*                                 /* THROUGH PGVAL                   */ 03345000
*        WKAEXITF='0'B;           /* INITIALIZE THE LOOP             */ 03346000
         OI    WKATCFTS(R13),B'00010100'                           0640 03347000
         NI    WKAEXITF(R13),B'10111111'                           0640 03348000
*                                 /* CONTROL FLAG                    */ 03349000
*        WKANEXCI=0;              /* ZERO THE NEXT CI SO THAT        */ 03350000
         SLR   @03,@03                                             0641 03351000
         STCM  @03,7,WKANEXCI(R13)                                 0641 03352000
*                                 /* THE BASE CI WILL BE USED        */ 03353000
*        /************************************************************/ 03354000
*        /*                                                          */ 03355000
*        /*    HANDLE LOOPING THROUGH ALL OF THE PIECES OF THE       */ 03356000
*        /*    FIELD TO CHECK                                        */ 03357000
*        /*                                                          */ 03358000
*        /************************************************************/ 03359000
*                                                                  0642 03360000
*        DO WHILE WKAEXITF='0'B & WKAFSUCC='1'B;                   0642 03361000
         B     @DE00642                                            0642 03362000
@DL00642 DS    0H                                                  0643 03363000
*                                 /* LOOP UNTIL THE TOTAL            */ 03364000
*                                 /* COMPARISON IS DONE OR           */ 03365000
*                                 /* UNTIL A MISMATCH IS FOUND       */ 03366000
*          WKAEXITF='1'B;         /* ASSUME THAT THIS TIME           */ 03367000
         OI    WKAEXITF(R13),B'01000000'                           0643 03368000
*                                 /* THROUGH THE LOOP IS ENOUGH      */ 03369000
*          CALL PGVAL;            /* GET THE DESIRED VALUE           */ 03370000
         BAL   @14,PGVAL                                           0644 03371000
*          IF WKACMPLT='1'B       /* IF THE FIELD IS COMPLETE        */ 03372000
*            THEN IF WKAFLDNE='1'B/* THEN: IF THE FIELD DOES         */ 03373000
         TM    WKACMPLT(R13),B'00001000'                           0645 03374000
         BNO   @RF00645                                            0645 03375000
*                                 /*       NOT EXIST                 */ 03376000
*              THEN WKAFSUCC='0'B;/* THEN: INDICATE THAT THE         */ 03377000
         TM    WKAFLDNE(R13),B'01000000'                           0646 03378000
         BNO   @RF00646                                            0646 03379000
         NI    WKAFSUCC(R13),B'11101111'                           0647 03380000
*                                 /*       FIELD LIST TESTING        */ 03381000
*                                 /*       WAS NOT A SUCCESS         */ 03382000
*              ELSE IF WKAADJLN=0 /* ELSE: IF THE ADJUSTED           */ 03383000
*                                 /*       LENGTH OF FIELD           */ 03384000
*                                 /*       REMAINING IS ZERO         */ 03385000
*                THEN WKAEXITF='1'B;                               0648 03386000
         B     @RC00646                                            0648 03387000
@RF00646 ICM   @03,3,WKAADJLN(R13)                                 0648 03388000
         BNZ   @RF00648                                            0648 03389000
         OI    WKAEXITF(R13),B'01000000'                           0649 03390000
*                                 /* THEN: INDICATE THE TEST         */ 03391000
*                                 /*       IS COMPLETE               */ 03392000
*                ELSE WKAFSUCC='0'B;                               0650 03393000
         B     @RC00648                                            0650 03394000
@RF00648 NI    WKAFSUCC(R13),B'11101111'                           0650 03395000
*                                 /* ELSE: INDICATE THAT THE         */ 03396000
*                                 /*       TEST WAS NOT A            */ 03397000
*                                 /*       SUCCESS                   */ 03398000
*            ELSE DO;             /* ELSE:                           */ 03399000
         B     @RC00645                                            0651 03400000
@RF00645 DS    0H                                                  0652 03401000
*              CALL PTCMP;        /* COMPARE THE FIELD FOUND         */ 03402000
         BAL   @14,PTCMP                                           0652 03403000
*                                 /* WITH THE INPUT FIELD            */ 03404000
*              IF WKAFSUCC='1'B   /* IF THE TEST IS A SUCCESS        */ 03405000
*                                 /* AND THERE IS MORE TO CHECK      */ 03406000
*                THEN WKAEXITF='0'B;                               0653 03407000
         TM    WKAFSUCC(R13),B'00010000'                           0653 03408000
         BNO   @RF00653                                            0653 03409000
         NI    WKAEXITF(R13),B'10111111'                           0654 03410000
*                                 /* THEN: INDICATE TO CONTINUE      */ 03411000
*                ELSE DO;         /* ELSE:                           */ 03412000
         B     @RC00653                                            0655 03413000
@RF00653 DS    0H                                                  0656 03414000
*                  WKAFLDNE='0'B; /* INDICATE THAT THE FIELD         */ 03415000
*                                 /* DOES EXIST                      */ 03416000
*                  WKACMPLT='1'B; /* INDICATE THAT THE FIELD         */ 03417000
         OI    WKACMPLT(R13),B'00001000'                           0657 03418000
         NI    WKAFLDNE(R13),B'10111111'                           0657 03419000
*                                 /* IS COMPLETE                     */ 03420000
*                  END;           /*                                 */ 03421000
*              END;               /*                                 */ 03422000
@RC00653 DS    0H                                                  0660 03423000
*          END;                   /*                                 */ 03424000
@RC00645 DS    0H                                                  0660 03425000
@DE00642 TM    WKAEXITF(R13),B'01000000'                           0660 03426000
         BNZ   @DC00642                                            0660 03427000
         TM    WKAFSUCC(R13),B'00010000'                           0660 03428000
         BO    @DL00642                                            0660 03429000
@DC00642 DS    0H                                                  0661 03430000
*        END;                     /*                                 */ 03431000
*    END;                         /*                                 */ 03432000
@RC00626 DS    0H                                                  0662 03433000
@DE00623 ICM   @03,15,FMFLTCHN(FMFLCUR)                            0662 03434000
         BZ    @DC00623                                            0662 03435000
         TM    WKAFSUCC(R13),B'00010000'                           0662 03436000
         BO    @DL00623                                            0662 03437000
@DC00623 DS    0H                                                  0663 03438000
*  /******************************************************************/ 03439000
*  /*                                                                */ 03440000
*  /*    RESTORE THE RETURN ADDRESS TO ALLOW EXIT                    */ 03441000
*  /*                                                                */ 03442000
*  /******************************************************************/ 03443000
*                                                                  0663 03444000
*  R14=WKARTNI;                   /* RESTORE THE RETURN ADDRESS      */ 03445000
*                                                                  0663 03446000
         L     R14,WKARTNI(,R13)                                   0663 03447000
*  END PTSTS;                     /* END OF PROCEDURE                */ 03448000
@EL00015 DS    0H                                                  0664 03449000
@EF00015 DS    0H                                                  0664 03450000
@ER00015 BR    @14                                                 0664 03451000
@PB00015 DS    0H                                                  0665 03452000
*  GEN(EJECT);                                                     0665 03453000
         EJECT                                                          03454000
*  END IDCRC04                    /* END OF PROCEDURE                */ 03455000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 03456000
*/*@INCLUDE SYSLIB  (IDCDF61 )                                        * 03457000
*;                                                                 0666 03458000
@EL00001 DS    0H                                                  0666 03459000
@EF00001 DS    0H                                                  0666 03460000
@ER00001 LM    @14,@12,12(@13)                                     0666 03461000
         BR    @14                                                 0666 03462000
@DATA    DS    0H                                                       03463000
@CH00047 DC    H'1'                                                     03464000
@CH00200 DC    H'2'                                                     03465000
@CH00087 DC    H'3'                                                     03466000
@CH00139 DC    H'5'                                                     03467000
@CH00122 DC    H'6'                                                     03468000
@CH00053 DC    H'8'                                                     03469000
@CH00171 DC    H'16'                                                    03470000
@CH00285 DC    H'256'                                                   03471000
@CH00286 DC    H'257'                                                   03472000
@SM00347 MVC   CHR+256(0,@02),CHRI+256(@01)                             03473000
@SM00349 MVC   CHR(0,@01),CHRI(@02)                                     03474000
@DATD    DSECT                                                          03475000
         DS    0F                                                       03476000
IDCRC04  CSECT                                                          03477000
         DS    0F                                                       03478000
@CF00343 DC    F'-8'                                                    03479000
@CF00306 DC    XL4'0F'                                                  03480000
@DATD    DSECT                                                          03481000
         DS    0D                                                       03482000
@TS00001 DS    CL1                                                      03483000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                03484000
@ENDDATD EQU   *                                                        03485000
IDCRC04  CSECT                                                          03486000
         DS    0F                                                       03487000
@SIZDATD DC    AL1(0)                                                   03488000
         DC    AL3(@ENDDATD-@DATD)                                      03489000
         DS    0D                                                       03490000
@CB00227 DC    X'FFFFFF'                                                03491000
@CB00283 DC    X'0000'                                                  03492000
         DS    CL3                                                      03493000
PTCHROOM DC    100A(0)                                                  03494000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       03495000
@01      EQU   01                                                       03496000
@02      EQU   02                                                       03497000
@03      EQU   03                                                       03498000
@04      EQU   04                                                       03499000
@05      EQU   05                                                       03500000
@06      EQU   06                                                       03501000
@07      EQU   07                                                       03502000
@08      EQU   08                                                       03503000
@09      EQU   09                                                       03504000
@10      EQU   10                                                       03505000
@11      EQU   11                                                       03506000
@12      EQU   12                                                       03507000
@13      EQU   13                                                       03508000
@14      EQU   14                                                       03509000
@15      EQU   15                                                       03510000
R1       EQU   @01                                                      03511000
FMFLCUR  EQU   @04                                                      03512000
TEMPAD   EQU   @05                                                      03513000
FMPLAD   EQU   @06                                                      03514000
WORKA    EQU   @07                                                      03515000
WORKB    EQU   @08                                                      03516000
WORKC    EQU   @09                                                      03517000
WORKD    EQU   @10                                                      03518000
R13      EQU   @13                                                      03519000
R14      EQU   @14                                                      03520000
R15      EQU   @15                                                      03521000
CHAR1    EQU   0                                                        03522000
SUBR15   EQU   0                                                        03523000
FMPL     EQU   0                                                        03524000
FMPLFLNO EQU   FMPL                                                     03525000
FMPLBCIN EQU   FMPL+1                                                   03526000
FMPLGRTN EQU   FMPL+4                                                   03527000
FMPLWKAR EQU   FMPL+8                                                   03528000
FMPLUPTR EQU   FMPL+12                                                  03529000
FMPLRTCD EQU   FMPL+16                                                  03530000
FMPLENTH EQU   FMPL+18                                                  03531000
FMPLOAR  EQU   FMPL+20                                                  03532000
FMPLFMFL EQU   FMPL+24                                                  03533000
FMFL     EQU   0                                                        03534000
FMFLTSTC EQU   FMFL+1                                                   03535000
FMFLGRPC EQU   FMFL+2                                                   03536000
FMFLINDS EQU   FMFL+3                                                   03537000
FMFLWKAR EQU   FMFL+4                                                   03538000
FMFLDNAM EQU   FMFL+8                                                   03539000
FMFLTCHN EQU   FMFL+12                                                  03540000
FMFLDATA EQU   FMFL+16                                                  03541000
FMFLENTH EQU   FMFLDATA                                                 03542000
FMFLADDR EQU   FMFLDATA+4                                               03543000
FMFLNAME EQU   0                                                        03544000
FMFLCNTR EQU   0                                                        03545000
GOP      EQU   0                                                        03546000
GOPCINO  EQU   GOP                                                      03547000
GOPDISP  EQU   GOPCINO+1                                                03548000
GOPINFO  EQU   GOP+3                                                    03549000
GOPEXTPT EQU   GOPINFO                                                  03550000
GOPDELET EQU   GOPINFO                                                  03551000
GOP2BSEQ EQU   GOP+4                                                    03552000
GOP1BSEQ EQU   GOP2BSEQ                                                 03553000
CBKRD1   EQU   0                                                        03554000
CBKID    EQU   CBKRD1+44                                                03555000
CBKNVLF  EQU   CBKRD1+47                                                03556000
CBKLOFX  EQU   CBKRD1+48                                                03557000
CBKRD2   EQU   0                                                        03558000
CBKVRLEN EQU   CBKRD2                                                   03559000
CBKDATA  EQU   CBKRD2+2                                                 03560000
CBKRD3   EQU   0                                                        03561000
@NM00007 EQU   CBKRD3                                                   03562000
CBKEXTCI EQU   @NM00007                                                 03563000
CBKCTGOP EQU   CBKRD3+5                                                 03564000
CBKFGOP  EQU   CBKRD3+6                                                 03565000
CBKRD4   EQU   0                                                        03566000
CBKVARNO EQU   CBKRD4                                                   03567000
CBKFXDLN EQU   CBKRD4+1                                                 03568000
DCTE     EQU   0                                                        03569000
DCTFNAME EQU   DCTE                                                     03570000
DCTDINFO EQU   DCTE+4                                                   03571000
DCT      EQU   0                                                        03572000
DCTCMB   EQU   0                                                        03573000
FOA      EQU   0                                                        03574000
FOALENTH EQU   FOA                                                      03575000
WKA      EQU   0                                                        03576000
WKARSV   EQU   WKA                                                      03577000
WKAGETIF EQU   WKA+72                                                   03578000
@NM00009 EQU   WKAGETIF                                                 03579000
WKARECFN EQU   @NM00009                                                 03580000
WKANEXCI EQU   WKAGETIF+1                                               03581000
WKABLKAD EQU   WKAGETIF+4                                               03582000
WKAUPTR  EQU   WKA+80                                                   03583000
WKAFGOP  EQU   WKA+84                                                   03584000
WKAGODTA EQU   WKA+88                                                   03585000
WKACOMBT EQU   WKA+92                                                   03586000
WKADICTT EQU   WKA+96                                                   03587000
WKANAME  EQU   WKA+100                                                  03588000
WKACOMBC EQU   WKA+104                                                  03589000
@NM00011 EQU   WKA+106                                                  03590000
WKA1BSEQ EQU   @NM00011                                                 03591000
WKAFLDNE EQU   @NM00011                                                 03592000
WKAFLDNF EQU   @NM00011                                                 03593000
WKAFSUCC EQU   @NM00011                                                 03594000
WKACMPLT EQU   @NM00011                                                 03595000
WKAEXITA EQU   @NM00011                                                 03596000
WKAEXITB EQU   @NM00011                                                 03597000
WKAEXITC EQU   @NM00011                                                 03598000
WKAEXITD EQU   @NM00011+1                                               03599000
WKAEXITF EQU   @NM00011+1                                               03600000
WKAEXITG EQU   @NM00011+1                                               03601000
WKATCFTS EQU   @NM00011+1                                               03602000
WKATSTFL EQU   @NM00011+1                                               03603000
WKAGVFTS EQU   @NM00011+1                                               03604000
WKACONFG EQU   @NM00011+1                                               03605000
WKAFORL  EQU   @NM00011+1                                               03606000
WKASVGRC EQU   WKA+108                                                  03607000
WKACURCI EQU   WKA+109                                                  03608000
WKASEQNO EQU   WKA+112                                                  03609000
WKAFNDLN EQU   WKA+114                                                  03610000
WKAFNDAD EQU   WKA+116                                                  03611000
WKADICTD EQU   WKA+120                                                  03612000
WKADICTI EQU   WKADICTD                                                 03613000
WKADTVAR EQU   WKADICTI                                                 03614000
WKADTREP EQU   WKADICTI                                                 03615000
WKADTCMB EQU   WKADICTI                                                 03616000
WKADTFLG EQU   WKADICTI                                                 03617000
WKADTEPT EQU   WKADICTI                                                 03618000
WKADTSPL EQU   WKADICTI                                                 03619000
WKADTSTR EQU   WKADICTD+1                                               03620000
WKADTLEN EQU   WKADICTD+2                                               03621000
WKAGRPCD EQU   WKADICTD+3                                               03622000
WKAFMFLI EQU   WKA+124                                                  03623000
WKADRRNO EQU   WKA+126                                                  03624000
WKAHREPN EQU   WKA+128                                                  03625000
WKAGOPLN EQU   WKA+130                                                  03626000
WKASVPOS EQU   WKA+132                                                  03627000
WKAAREAP EQU   WKA+136                                                  03628000
WKAAREAS EQU   WKA+140                                                  03629000
WKAADJLN EQU   WKA+142                                                  03630000
WKAADJAD EQU   WKA+144                                                  03631000
WKARTNA  EQU   WKA+148                                                  03632000
WKARTNB  EQU   WKA+152                                                  03633000
WKARTNC  EQU   WKA+156                                                  03634000
WKARTND  EQU   WKA+160                                                  03635000
WKARTNE  EQU   WKA+164                                                  03636000
WKARTNF  EQU   WKA+168                                                  03637000
WKARTNG  EQU   WKA+172                                                  03638000
WKARTNH  EQU   WKA+176                                                  03639000
WKARTNI  EQU   WKA+180                                                  03640000
TEMPA    EQU   WKA+184                                                  03641000
CHR      EQU   0                                                        03642000
CHRI     EQU   0                                                        03643000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    03644000
@NM00013 EQU   WKA+200                                                  03645000
@NM00012 EQU   WKADICTI                                                 03646000
@NM00010 EQU   @NM00009                                                 03647000
@NM00008 EQU   FOA+2                                                    03648000
@NM00006 EQU   CBKRD1+45                                                03649000
@NM00005 EQU   CBKRD1                                                   03650000
@NM00004 EQU   GOPINFO                                                  03651000
@NM00003 EQU   GOPCINO                                                  03652000
FMFLSUCC EQU   FMFLINDS                                                 03653000
@NM00002 EQU   FMFLINDS                                                 03654000
FMFLDLNO EQU   FMFL                                                     03655000
@NM00001 EQU   FMPL+17                                                  03656000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      03657000
@RC00077 EQU   @RC00076                                                 03658000
@RC00085 EQU   @EL00002                                                 03659000
@RC00110 EQU   @EL00003                                                 03660000
@RT00141 EQU   @EL00004                                                 03661000
@RC00151 EQU   @EL00004                                                 03662000
@RC00193 EQU   @RC00191                                                 03663000
@RC00220 EQU   @RC00219                                                 03664000
@RT00242 EQU   @RC00228                                                 03665000
@RC00237 EQU   @RC00228                                                 03666000
@RT00259 EQU   @RC00254                                                 03667000
@RC00262 EQU   @RC00254                                                 03668000
@RC00304 EQU   @RC00303                                                 03669000
@RC00356 EQU   @RC00355                                                 03670000
@RC00377 EQU   @RC00340                                                 03671000
@RC00373 EQU   @RC00340                                                 03672000
@RC00366 EQU   @RC00340                                                 03673000
@RC00385 EQU   @RC00340                                                 03674000
@RC00464 EQU   @RC00463                                                 03675000
@RC00475 EQU   @RC00474                                                 03676000
@RT00460 EQU   @EL00012                                                 03677000
@RT00471 EQU   @EL00012                                                 03678000
PTCMP1   EQU   @EL00013                                                 03679000
@RT00593 EQU   @RC00585                                                 03680000
@RC00648 EQU   @RC00645                                                 03681000
@RC00646 EQU   @RC00645                                                 03682000
@RC00092 EQU   @RC00085                                                 03683000
@RC00086 EQU   @RC00085                                                 03684000
@RC00154 EQU   @RC00151                                                 03685000
@RC00195 EQU   @RC00193                                                 03686000
@RC00357 EQU   @RC00356                                                 03687000
@RT00369 EQU   @RC00366                                                 03688000
@RC00388 EQU   @RC00385                                                 03689000
@RC00087 EQU   @RC00086                                                 03690000
@RC00093 EQU   @RC00092                                                 03691000
@ENDDATA EQU   *                                                        03692000
         END   IDCRC04,(C'PLS1943',0701,77277)                          03693000
