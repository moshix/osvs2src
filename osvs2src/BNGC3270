         PRINT OFF                                                      00040007
         MACRO                                                          00040407
&NAME    BNGHJN &LABEL,&HJN                                             00040807
         LCLC  &HJA,&HJB                                                00041207
&HJA     SETC  '&SYSPARM'(1,4)                                          00041607
&HJB     SETC  '&SYSPARM'(5,4)                                          00042007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00042407
         B     &LABEL .                 BR AROUND CONSTANTS             00042807
         SPACE 2                                                        00043207
.NOBRNCH ANOP                                                           00043607
         AIF   ('&NAME' EQ '').NOLABEL                                  00044007
         DC    C'&NAME' .              MODULE IDENTIFIER                00044407
.NOLABEL ANOP                                                           00044807
         DC    X'&HJA' .                DATE OF MODIFICATION            00045207
         AIF   ('&HJN' NE 'HJN').DATE                                   00045607
         DC    X'&HJB' .                HJN OF MODIFICATION             00046007
.DATE    ANOP                                                           00046407
         AIF   ('&LABEL' EQ '').NOLBL                                   00046807
         SPACE 2                                                        00047207
&LABEL   DS    0H                                                       00047607
.NOLBL   ANOP                                                           00048007
         MEND                                                           00048407
         PRINT ON                                                       00048807
*********************************************************************** 00049207
*                                                                     * 00080068
* MODULE NAME = BNGC3270                                              * 00120068
*                                                                     * 00160068
* DESCRIPTIVE NAME = CICS DEMF 3270 DISPLAY MODULE                    * 00200068
*                                                                     * 00240068
* COPYRIGHT = NONE                                                    * 00280068
*                                                                     * 00320068
* STATUS = RELEASE 1, LEVEL 1                                         * 00360068
*                                                                     * 00400007
* FUNCTION = 1) RECEIVES CONTROL FROM BNGCDISP;                       * 00440068
*            2) HANDLES 3270 DISPLAY TERMINAL ERROR INFORMATION       * 00480068
*               REQUEST AND BITS PROMPTER REQUEST;                    * 00520068
*            3) ACCESSES SYS1.DEMFLOG DATA FILE AND COLLECTS THE      * 00560068
*               REQUESTED 3270 ERROR INFORMATION FROM IT;             * 00600068
*            4) FORMS OUTPUT MESSAGE WITH DISPLAY FORMAT AND WRITES   * 00640068
*               IT TO THE 3270 DISPLAY TERMINAL; (ERR INFO AND SOME   * 00680068
*               OF DISPLAY MESSAGES)                                  * 00720068
*            5) RETURNS CONTROL TO CICS.                                00760068
*                                                                     * 00800068
* NOTES = NONE                                                        * 00840068
*                                                                     * 00880068
*    DEPENDENCIES =                                                   * 00920068
*                                                                     * 00960068
*    THE FOLLOWING ARE CICS TABLES/CONTROL BLOCKS AND THEIR LABELS    * 01000068
*    USED BY DEMF CICS MODULES (BNGCDISP,BNGC3270,BNGCLOCL,BNGCRMOT   * 01040068
*    BNGCMENU) :                                                      * 01080068
*                                                                     * 01120068
*    CICS TABLE AND                                                   * 01160068
*    CONTROL BLOCKS                  LABELS USED                      * 01200068
*    ----------------------          -----------                      * 01240068
*                                                                     * 01280068
*    COMMON SYSTEM AREA              CSATCTBA                         * 01320068
*    (CSA)                                                            * 01360068
*                                                                     * 01400068
*    TERMINAL CONTROL TABLE          TCTTEDA                          * 01440068
*    TERMINAL ENTRY (TCTTE)          TCTTETM                          * 01480068
*                                    TCTTELT                          * 01520068
*                                    TCTTETI                          * 01560068
*                                    TCTTECLT                         * 01600068
*                                    TCTTETEL                         * 01640068
*                                    TCTTETT                          * 01680068
*                                    TCTTEGU                          * 01720068
*                                    TCTTETA                          * 01760068
*                                                                     * 01800068
*    TERMINAL CONTROL TABLE          TCTLELF                          * 01840068
*    LINE ENTRY (TCTLE)              TCTLEFAA                         * 01880068
*                                    TCTLEPI                          * 01920068
*                                    TCTLEMFP                         * 01960068
*                                    TCTLEPA                          * 02000068
*                                    TCTLEDCB                         * 02040068
*                                    TCTLERLN                         * 02080068
*                                                                     * 02120068
*    TERMINAL INPUT/OUTPUT AREA      TIOADBA                          * 02160068
*    (TIOA)                          TIOATDL                          * 02200068
*                                                                     * 02240068
*    TASK CONTROL AREA               TCAFCAAA                         * 02280068
*    (TCA)                           TCAFCAA                          * 02320068
*                                    TCAPCPI                          * 02360068
*                                    TCASCSA                          * 02400068
*                                                                     * 02440068
*    FILE INPUT/OUTPUT AREA          FIOADBA                          * 02480068
*    (FIOA)                                                           * 02520068
*                                                                     * 02560068
*    RESTRICTIONS = NONE                                              * 02600068
*                                                                     * 02640068
*    REGISTER CONVENTIONS = R12 ADDRESS OF TCA                        * 02680068
*                           R13 ADDRESS OF CSA                        * 02720068
*                                                                     * 02760068
*    PATCH LABEL = PATCH                                       @OX21950 02800007
*                                                                     * 02840068
* MODULE TYPE = COCS DISPLAY                                          * 02880068
*                                                                     * 02920068
*    PROCESSOR = ASSEMBLER H                                          * 02960068
*                                                                     * 03000068
*    MODULE SIZE = 6976 DECIMAL BYTES                                 * 03040068
*                                                                     * 03080068
*    ATTRIBUTES = QUASI-REENTRANT                                     * 03120068
*                                                                     * 03160068
* ENTRY POINT = BNGC3270                                              * 03200068
*                                                                     * 03240068
*    PURPOSE = SEE FUNCTION                                           * 03280068
*                                                                     * 03320068
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 03360068
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 03400068
*              R15 LOADED WITH ENTRY POINT                            * 03440068
*                                                                     * 03480068
* INPUT = PARAM LIST ITEMS USED ARE : INPUT TIOA AT BEGINNING OF PGM  * 03520068
*                                                                     * 03560068
* OUTPUT = PARAM LIST ITEMS USED ARE : OUTPUT TIOA AT LABEL - GETTIOA * 03600068
*                                                                     * 03640068
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 03680068
*               00 - OPERATION PERFORMED AS REQUESTED                 * 03720068
*                                                                     * 03760068
* EXIT-ERROR  = NONE                                                  * 03800068
*                                                                     * 03840068
* EXTERNAL REFERENCE = NONE                                           * 03880068
*                                                                     * 03920068
*    ROUTINES = LOCATE ROUTINE                                        * 03960068
*               GETTIOA ROUTINE (GET TERMINAL OUTPUT AREA)            * 04000068
*               BUOBR ROUTINE (BLOW-UP OBR ROUTINE)                   * 04040068
*               BUMDR ROUTINE (BLOW-UP MDR ROUTINE)                   * 04080068
*                                                                     * 04120068
*    DATA AREAS =  TWA (300 BYTES)                                    * 04160068
*                                                                     * 04200068
*    CONTROL BLOCK = DFHCSADS, DFHTCTLE, DFHTCTTE, DFHTCADS,          * 04240068
*                    DFHTIOA, DFHFIOA                                 * 04280068
*                                                                     * 04320068
* TABLES = CALENDAR - CONVERT JULIAN DATE TO GREGORIAN DATE TABLE     * 04360068
*          LEAPTBL  - LEAP YEAR CALCULATION TABLE                     * 04400068
*          CCWTABL  - CONVERT 270X COMMAND CODE INTO ENGLISH          * 04440068
*          CSWTABL  - CONVERT LOCAL 327X STATUS OR 270X LINE STATUS   * 04480068
*                     INTO ENGLISH                                    * 04520068
*          SENSTABL - CONVERT 270X LINE SENSE CODE INTO ENGLISH       * 04560068
*          STATSTBL - CONVERT REMOTE 327X STATUS CODE INTO ENGLISH    * 04600068
*          SENS3272 - CONVERT LOCAL 327X SENSE CODE INTO ENGLISH      * 04640068
*          CCW3272  - CONVERT LOCAL 327X COMMAND CODE INTO ENGLISH    * 04680068
*          TPOPTBL  - CONVERT BTAM TP OP CODE INTO ENGLISH            * 04720068
*          CICSPTOP - CONVERT TCAM TP OP CODE INTO ENGLISH            * 04760068
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 04800068
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 04840068
*                                                                     * 04880068
* MACROS = DCBD, DFHPC, DFHSC, DFHTC, DFHPC                           * 04920068
*                                                                     * 04960068
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 05000068
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 05000107
* CHANGE 02  02/27/78  BNGHJN MACRO ADDED                             * 05000207
*A110800,246000                                                @OZ30480 05000307
*A192000,374800,414000                                         @OZ31885 05000407
*C384000-384800                                                @OX21950 05000507
*A472800                                                       @OX21950 05000607
*                                                                     * 05080068
*********************************************************************** 05120068
BNGC3270 TITLE 'DISPLAY 3270 MDR AND OBR ENTRIES'                       05160068
R1       EQU   1                                                        05200068
BASE1    EQU   2                   1ST PROGRAM BASE REG.                05240068
BASE2    EQU   3                   2ND PROGRAM BASE REG.                05280068
TCTTEAR  EQU   4                   TCT TERML ENTRY REG.                 05320068
TIOABAR  EQU   5                   TIOA POINTER.                        05360068
FIOABAR  EQU   6                   FIOA POINTER.                        05400068
DATAREG  EQU   7                   POINTER TO DATA IN EMF FILE BLOCK.   05440068
DATALOOP EQU   8                   LOOP REG FOR PROCESSING WITH DATAREG 05480068
OUTREG   EQU   9                   POINTER TO VARIABLE AREA IN TIOA.    05520068
OUTLOOP  EQU   10                  LOOP REG FOR PROCESSING WITH OUTREG. 05560068
LINKREG  EQU   11                  LINKAGE TO COMMON SUBROUTINES.       05600068
R15      EQU   15                                                       05640068
SBA      EQU   X'11'                                                    05680068
SF       EQU   X'1D'                                                    05720068
IC       EQU   X'13'                                                    05760068
UNA      EQU   X'40'                                                    05800068
UHA      EQU   X'C8'                                                    05840068
PNA      EQU   X'60'                                                    05880068
PDA      EQU   X'E8'                                                    05920068
PIA      EQU   X'6D'                                                    05960068
MNP      EQU   X'61'                                                    06000068
L2P1     EQU   X'C150'                                                  06040068
L3P1     EQU   X'C260'                                                  06080068
L1P1     EQU   X'4040'                                                  06120068
L5P1     EQU   X'C260'                                                  06160068
L1P36    EQU   X'40E3'                                                  06200068
L4P1     EQU   X'C3F0'                                                  06240068
L1P7     EQU   X'40C6'                                                  06280068
L3P39    EQU   X'C1F6'                                                  06320068
L2P79    EQU   X'C25E'                                                  06360068
L2P1LG   EQU   X'C150'                                                  06400068
L3P1LG   EQU   X'C260'                                                  06440068
L4P1LG   EQU   X'C3F0'                                                  06480068
L1P1SM   EQU   X'4040'                                                  06520068
L2P1SM   EQU   X'40E8'                                                  06560068
L3P1SM   EQU   X'C150'                                                  06600068
L4P1SM   EQU   X'C1F8'                                                  06640068
L6P26    EQU   X'C6E9'                                                  06680068
         PRINT OFF                                                      06720068
         COPY  DFHCSADS                                                 06760068
         COPY  DFHTCTLE                                                 06800068
         COPY  DFHTCTTE                                                 06840068
         COPY  DFHTCADS                                                 06880068
         PRINT ON                                                       06920068
PARM1    DS    D                   1ST INPUT FIELD.                     06960068
PARM2    DS    D                   2ND INPUT FIELD.                     07000068
PARM3    DS    D                   3RD INPUT FIELD.                     07040068
PARM4    DS    D                   4TH INPUT FIELD.                     07080068
PARM5    DS    D                   5TH INPUT FIELD.                     07120068
PARM6    DS    D                   6TH INPUT FIELD.                     07160068
TWASBAS  DS    PL1                 COUNT OF SBA'S IN INPUT MSG.         07200068
TWAREL   DS    CL3                 FILE CONTROL RELATIVE BLK ADDR.      07240068
TWALINE  DS    F                   ADDR OF OUR TCTLE                    07280068
DUBLWD   DS    D                   WORK AREA.                           07320068
TWATIOA  DS    F                   SAVE INPUT ADDRESS.                  07360068
TWATCTID DS    F                   SAVE TERML ID.                       07400068
TWASLOT  DS    F                   SLOT COUNTER.                        07440068
SAVE14   DS    F                   SAVE AREA.                           07480068
TWAOUT   DS    F                   SAVE OUTPUT HDR ADDR                 07520068
LINESZ   DS    H                   LINE SIZE (3277 MOD 1 OR MOD 2)      07560068
LINELOOP DS    H                   NBR LINE ITEMS PER LINESZ.           07600068
OUTSWCH  DS    C                                                        07640068
HXLINLIB DS    0CL6                LINE ADDRESS INCLUDING               07680068
         DS    C                                                        07720068
HEXLINE  DS    CL2                      VTAM LIB ADDR                   07760068
HEXLIB   DS    CL3                      IN HEX FORMAT.                  07800068
HEXCTRL  DS    C                   CTRL UNIT POLL CHAR.                 07840068
HEXTERM  DS    C                   TERML POLL CHAR.                     07880068
NEWFIRST DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    07920068
NEWPREV  DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    07960068
SAVETERM DS    CL8                 TERMINAL SAVE AREA FOR 'NO ERR' MSG  08000068
SAVECU   DS    CL8                 CTRL UNIT SAVE AREA FOR 'NO ERR' MSG 08040068
SAVELINE DS    CL8                 LINE SAVE AREA FOR 'NO ERR' MSG      08080068
SAVEID   DS    CL20                CICS SYMBOLIC ID FOR 'NO ERR' MSG    08120068
BITFIRST DS    CL5                 FIRST BBBSS                          08160068
BITLAST  DS    CL5                 SECOND BBBSS                         08200068
BITPREV  DS    CL5                 THIRD BBBSS                          08240068
DATDATE  DS    CL4                 DATE OF ERROR - 00YYDDDF             08280068
DATTIME  DS    CL4                 TIME OF ERROR - HHMMSSHH             08320068
DATASLOT DSECT                                                          08360068
         USING *,DATAREG                                                08400068
DATALTH  DS    C                   LTH OF THIS SLOT                     08440068
LINEID   DS    CL6                 LINE AND LIB ADDR                    08480068
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              08520068
         DS    CL3                                                      08560068
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           08600068
         DS    CL3                                                      08640068
DATE     DS    CL4                 DATE OF ERROR - 00YY0DDF             08680068
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             08720068
         DS    CL8                                                      08760068
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 08800068
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              08840068
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 08880068
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   08920068
         DS    CL2                                                      08960068
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    09000068
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  09040068
         DS    CL6                                                      09080068
OBRUCB   DS    C                                                        09120068
         DS    CL3                                                      09160068
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 09200068
OBRCTRL  DS    C                                                        09240068
OBRTERM  DS    C                                                        09280068
         DS    CL12                                                     09320068
OBRSENSE DS    CL2                 OBR SENSE BYTES                      09360068
         ORG   DATALTH                                                  09400068
CTRLPORT DS    CL6                 PORT & LIB ADDRESS                   09440068
         DS    CL4                                                      09480068
CTRLFRST DS    CL3                 REL BLK ADDR 1ST BLK IN CHAIN.       09520068
         DS    CL3                                                      09560068
SLOTLTH  EQU   *-CTRLPORT                                               09600068
         COPY  DFHTIOA                                                  09640068
SBA1     DS    CL3                 1ST SBA POSITION.                    09680068
CODE     DS    CL4                 TRANS CODE.                          09720068
SBA2     DS    CL3                 2ND SBA                              09760068
PGRM     DS    CL4                 PROGRAM NAME.                        09800068
SBA3     DS    CL3                 3RD SBA.                             09840068
FLP      DS    CL15                FIRST/LAST/PREVIOUS IF BLOWUP RQST.  09880068
SBA4     DS    CL3                 4TH SBA.                             09920068
BUX      DS    CL4                 X FOR BLOWUP REQUEST.                09960068
TIOITEM  DS    CL5                 ITEM ADDRESS TO BLOWUP.              10000068
         ORG   FLP                 START OF BBBSS AREAS                 10040068
         DS    C                   FOR FORWARD AND BACKWARD REQUST      10080068
         DS    CL3                 4TH SBA FOR BBBSS                    10120068
TIOFIRST DS    CL5                 FIRST BBBSS AREA                     10160068
TIOLAST  DS    CL5                 LAST BBBSS AREA                      10200068
TIOPREV  DS    CL5                 PREVIOUS BBBSS AREA                  10240068
         COPY  DFHFIOA                                                  10280068
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            10320068
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              10360068
CTRLBACK DS    F                   BACKWARD PTR IN CTRL BLK CHAIN       10400068
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        10440068
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         10480068
         DS    CL15                FOR FUTURE USE                       10520068
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          10560068
         ORG   FIOADBA                                                  10600068
DATAPORT DS    CL6                 PORT & LIB ADDR                      10640068
DATATIME DS    CL4                 TIME BLOCK CREATED                   10680068
DATADATE DS    CL4                 DATE BLOCK CREATED                   10720068
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   10760068
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   10800068
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         10840068
         DS    CL10                                                     10880068
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               10920068
BNGC3270 CSECT                                                          10960068
         BALR  BASE1,0                                                  11040068
         USING *,BASE1,BASE2                                            11080068
BNGC3270 BNGHJN SKIPID                                         @OZ30480 11100007
         LA    BASE2,2048(BASE1)   SETUP PROGRAM BASE REGS.             11120068
         LA    BASE2,2048(BASE2)                                        11160068
         L     TCTTEAR,TCAFCAAA    POINT TO TCT TERML ENTRY.            11200068
         LA    TCTTEAR,0(TCTTEAR)  CLEAR HIGH ORDER BYTE FROM ADDR      11240068
         L     TIOABAR,TCTTEDA     POINT TO TIOA INPUT AREA.            11280068
A005     CP    TWASBAS,=P'2'       WERE LESS THAN 2 FIELDS INPUT?       11320068
         BNL   J010                NO. GO EXAMINE INPUT FURTHER.        11360068
A010     XC    TWAREL,TWAREL       YES. THIS IS A NEW RECAP REQUEST.    11400068
         CLC   PARM3(3),=C'ALL'    IF PARM 3 IS ONE OF THE DEMF         11440068
         BE    A140                DISPLAY CODES, THIS INPUT WAS FROM   11480068
         CLC   PARM3(4),=C'CTRL'          FORMATTED SCREEN.             11520068
         BE    A140                ZERO IT OUT AND TRY AGAIN.           11560068
         CLC   PARM3(4),=C'LINE'                                        11600068
         BE    A140                                                     11640068
         CLC   PARM3(4),=C'3270'                                        11680068
         BE    A140                                                     11720068
         CLC   PARM4(3),=C'ALL'                                         11760068
         BE    A130                                                     11800068
         CLC   PARM4(4),=C'CTRL'                                        11840068
         BE    A130                                                     11880068
         CLC   PARM4(4),=C'LINE'                                        11920068
         BE    A130                                                     11960068
         CLC   PARM4(4),=C'3270'                                        12000068
         BE    A130                                                     12040068
         CLC   PARM5(3),=C'ALL'                                         12080068
         BE    A120                                                     12120068
         CLC   PARM5(4),=C'CTRL'                                        12160068
         BE    A120                                                     12200068
         CLC   PARM5(4),=C'LINE'                                        12240068
         BE    A120                                                     12280068
         CLC   PARM5(4),=C'3270'                                        12320068
         BE    A120                                                     12360068
         OC    PARM3,PARM3         WAS LINE ID INPUT?                   12400068
         BNZ   B140                YES. GO SEARCH CTRL BLK FOR IT.      12440068
         TM    TCTEAMIB,TCTEVTAM    IS THIS FROM A VTAM TERM?           12480068
         BO    A110                 YES. CAN'T HONOR REQUEST.           12520068
         L     14,CSATCTBA         POINT TO TCT PREFIX.                 12560068
         L     14,4(14)            POINT TO BTAM ADCON LIST.            12600068
A030     CLC   0(4,14),=X'FFFFFFFF'  ANY MORE LINES TO LOOK AT?         12640068
         BE    S190                NO. SEND 'INVALID INPUT' MSG.        12680068
         L     1,0(14)             POINT TO A LINE.                     12720068
         ST    1,TWALINE           STORE ADDR IN CASE THIS IS IT.       12760068
         TM    TCTLELF,TCTLEFAA    IS THIS A POOLED LINE?               12800068
         BZ    A090                NO.                                  12840068
         TM    TCTLEPI,TCTLEMFP    YES. IS IT 1ST IN POOL?              12880068
         BZ    A150                NO. SKIP IT - DOESN'T POINT TO DCB.  12920068
A090     L     15,TCTLEPA          YES. POINT TO 1ST TERML.             12960068
A100     CLC   TCTTETI,0(15)       IS THIS OUR TERML?                   13000068
         BE    A170                YES. HAVE LOCATED ITS LINE ENTRY.    13040068
         TM    (TCTTELT-TCTTETI)(15),TCTTECLT  LAST TERML ON LINE?      13080068
         BO    A150                YES. GO LOOK AT NEXT LINE.           13120068
         AH    15,(TCTTETEL-TCTTETI)(15)  BUMP TO NEXT TERML.           13160068
         B     A100                                                     13200068
A110     MVC   TIOATDL(VTAMLTH),VTAMMSG                                 13240068
         MVC   TIOATDL+(VTAMID-VTAMMSG)(4),TCTTETI                      13280068
         B     D170                                                     13320068
VTAMMSG  DC    AL2(VTAMLTH-4),X'0000'                                   13360068
         DC    CL10'BNG010I C '                                         13400068
VTAMID   DC    CL8' ',CL21' IS A VTAM TERMINAL. '                       13440068
         DC    CL39'FOR INQUIRY,GIVE DEMF HARDWARE ADDRESS.'            13480068
VTAMLTH  EQU   *-VTAMMSG                                                13520068
A120     XC    PARM5,PARM5                                              13560068
         B     A010                                                     13600068
A130     XC    PARM4(16),PARM4                                          13640068
         B     A010                                                     13680068
A140     XC    PARM3(24),PARM3     ZERO OUT PARMS 3, 4, AND 5.          13720068
         B     A010                                                     13760068
A150     LA    14,4(14)            BUMP TO NEXT LINE ADDRESS.           13800068
         B     A030                                                     13840068
A170     EQU   *                                                        13880068
         L     1,TWALINE           POINT TO THIS TERML'S LINE.          13920068
         L     14,TCTLEDCB         POINT TO THE DCB.                    13960068
         USING IHADCB,14                                                14000068
         DCBD                                                           14040068
BNGC3270 CSECT                                                          14080068
         SR    15,15                                                    14120068
         CLI   TCTTETT,X'99'       IS THIS A LOCAL 3270?                14160068
         BE    A200                YES. GET REL LINE NBR FROM TE.       14200068
         IC    15,TCTLERLN         NO. GET REL LINE NBR FROM LE.        14240068
         B     A210                                                     14280068
A200     IC    15,TCTTEGU                                               14320068
A210     L     1,DCBDEBAD          POINT TO THE DEB.                    14360068
         LA    1,32(1)             POINT TO LIST OF UCBS.               14400068
A220     BCT   15,A230                                                  14440068
         B     A250                                                     14480068
A230     LA    1,4(1)              BCT TO APPROPRIATE RLN UCB.          14520068
         B     A220                                                     14560068
A250     L     1,0(1)              POINT TO THE UCB.                    14600068
         MVC   PARM3(3),13(1)      MOVE LINEID TO INPUT PARM FIELD.     14640068
         CLI   TCTTETT,X'99'       IS THIS A LOCAL 3270?                14680068
         BE    B130                YES. BYPASS LOOKING FOR POLL CHARS.  14720068
         L     14,TCTTETA          POINT TO ADDRESSING LIST.            14760068
         UNPK  DUBLWD,0(2,14)      GET CTRL UNIT ADDRESS.               14800068
         TR    DUBLWD,HXTOEB       CONVERT IT TO 2 EBCDIC CHARS.        14840068
         MVC   PARM4(2),DUBLWD+5   MOVE THEM TO INPUT PARM FIELD.       14880068
         NI    PARM4,X'FD'         CONVERT REMOTE CU TO ACTUAL CU NUM   14920068
         UNPK  DUBLWD,2(2,14)      GET TERML ADDRESS.                   14960068
         TR    DUBLWD,HXTOEB       CONVERT IT TO 2 EBCDIC CHARS.        15000068
         MVC   PARM5(2),DUBLWD+5   MOVE THEM TO INPUT PARM FIELD.       15040068
*                                                                       15080068
* AT THIS POINT, IF NO INPUT LINE/CTRL/TERM WAS SPECIFIED, THE          15120068
* ADDRESS PERTAINING TO THE REQUESTOR'S TERMINAL HAS BEEN PLACED        15160068
* IN THE INPUT PARMS AS IF THEY HAD BEEN KEYED IN.                      15200068
*                                                                       15240068
B130     MVC   TWATCTID,TCTTETI    MOVE THIS TERML'S CICS ID ALSO.      15280068
B140     MVC   SAVETERM,PARM5      MOVE TERMINAL  TO SAVE AREA          15320068
         MVC   SAVECU,PARM4        MOVE CTRL UNIT TO SAVE AREA          15360068
         MVC   SAVELINE,PARM3      MOVE LINE      TO SAVE AREA          15400068
B160     MVC   DUBLWD+5(3),PARM3                                        15440068
         TR    DUBLWD,EBTOHX            GET LINE,                       15480068
         PACK  DUBLWD(3),DUBLWD+5(4)    CONTROL UNIT,                   15520068
         MVC   HEXLINE,DUBLWD           AND                             15560068
         MVC   DUBLWD+5(3),PARM4        TERMINAL                        15600068
         TR    DUBLWD,EBTOHX            ADDRESS                         15640068
         PACK  DUBLWD(2),DUBLWD+5(3)    INTO HEX                        15680068
         MVC   HEXCTRL,DUBLWD           FORMAT                          15720068
D070     MVC   DUBLWD+5(3),PARM5        FOR COMPARING                   15760068
         TR    DUBLWD,EBTOHX            TO DATA IN                      15800068
         PACK  DUBLWD(2),DUBLWD+5(3)    DISK FILE.                      15840068
         MVC   HEXTERM,DUBLWD                                           15880068
         ST    TIOABAR,TWATIOA     SAVE ADDR OF ORIGINAL INPUT AREA.    15920068
         BAL   LINKREG,GETTIOA     SETUP NEW OUTPUT AREA WITH HDRS.     15960068
D080     DFHFC TYPE=GET,DATASET=EMFILE,RDIDADR=TWAREL,NORESP=D190       16000068
D090     DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=256,INITIMG=40           16040068
         L     TIOABAR,TCASCSA     GET A NEW OUTPUT AREA BIG            16080068
         ST    TIOABAR,TCTTEDA     ENOUGH FOR THE BNG001 ERR MSG.       16120068
         MVC   TIOADBA(IOERRLTH),IOERRMSG                               16160068
         MVC   TIOATDL,=AL2(IOERRLTH)                                   16200068
         UNPK  DUBLWD,TWAREL(4)         SETUP I/O ERROR MSG WITH        16240068
         TR    DUBLWD,HXTOEB            BLOCK NBR THAT                  16280068
         MVC TIOADBA+(IOBLOCK-IOERRMSG)(3),DUBLWD+4  WAS BEING READ,    16320068
         UNPK  DUBLWD,TCAFCAA(3)        AND THE CICS FILE               16360068
         TR    DUBLWD,HXTOEB            CONTROL RETURN CODE.            16400068
         MVC   TIOADBA+(IOCODE-IOERRMSG)(2),DUBLWD+3                    16440068
D170     DFHTC TYPE=(WRITE,ERASE)                                       16480068
         DFHPC TYPE=RETURN                                              16520068
D190     L     FIOABAR,TCAFCAA     POINT TO FILE I/O AREA.              16560068
         SR    DATALOOP,DATALOOP   SETUP TO LOOP ON NBR OF              16600068
         IC    DATALOOP,CTRLENTS   ENTRIES IN THIS CNTRL BLK.           16640068
         LTR   DATALOOP,DATALOOP   VERIFY THAT THE DATA SET             16680068
         BNZ   E030                IS NOT EMPTY.                        16720068
D240     LA    OUTREG,TIOADBA      POINT TO OUTPUT AREA                 16760068
         CLI   TCTTETM,X'F1'       IS THIS A 3277-1?                    16800068
         BE    D250                YES.                                 16840068
         MVC   TIOADBA(M11LGLTH),MSG11LG  SEND 'NO ERRS' MSG            16880068
         B     D260                                                     16920068
D250     MVC   TIOADBA(M11SMLTH),MSG11SM  SEND 'NO ERRS' MSG            16960068
D260     CLI   SAVETERM,X'00'      IS THERE A TERMINAL ID?              17000068
         BE    D280                NO. IT IS LOCAL TERMINAL             17040068
         CLI   TCTTETM,X'F1'       IS THIS A 3277-1?                    17080068
         BE    D271                YES.                                 17120068
         MVC   (M11LGTRM-MSG11LG)(2,OUTREG),SAVETERM                    17160068
         MVC   (M11LGCU-MSG11LG)(2,OUTREG),SAVECU                       17200068
         MVC   (M11LGLN-MSG11LG)(3,OUTREG),SAVELINE                     17240068
         MVC   (M11LGID-MSG11LG)(20,OUTREG),SAVEID                      17280068
         MVC   TIOATDL,=AL2(M11LGLTH)                                   17320068
         B     D300                                                     17360068
D271     MVC   (M11SMTRM-MSG11SM)(2,OUTREG),SAVETERM                    17400068
         MVC   (M11SMCU-MSG11SM)(2,OUTREG),SAVECU                       17440068
         MVC   (M11SMLN-MSG11SM)(3,OUTREG),SAVELINE                     17480068
         MVC   (M11SMID-MSG11SM)(20,OUTREG),SAVEID                      17520068
         MVC   TIOATDL,=AL2(M11SMLTH)                                   17560068
         B     D300                                                     17600068
D280     CLI   TCTTETM,X'F1'       (LOCAL) IS THIS A 3277-1?            17640068
         BE    D281                YES.                                 17680068
         MVC   TIOADBA(M12LGLTH),MSG12LG  SEND 'NO ERRS' MSG            17720068
         MVC   (M12LGTRM-MSG12LG)(3,OUTREG),SAVELINE      LOCAL TERM    17760068
         MVC   (M12LGID-MSG12LG)(20,OUTREG),SAVEID                      17800068
         MVC   TIOATDL,=AL2(M12LGLTH)                                   17840068
         B     D300                                                     17880068
D281     MVC   TIOADBA(M12SMLTH),MSG12SM  SEND 'NO ERRS' MSG            17920068
         MVC   (M12SMTRM-MSG12SM)(3,OUTREG),SAVELINE      LOCAL TERM    17960068
         MVC   (M12SMID-MSG12SM)(20,OUTREG),SAVEID                      18000068
         MVC   TIOATDL,=AL2(M12SMLTH)                                   18040068
D300     DFHTC TYPE=(WRITE,ERASE)                                       18080068
         DFHPC TYPE=RETURN                                              18120068
E030     LA    DATAREG,CTRLSLT1    POINT TO FIRST CTRL SLOT.            18160068
E040     OC    PARM4,PARM4         WAS A CTRL UNIT ADDR INPUT?          18200068
         BNZ   E110                YES. LINE ID IS CORRECT.             18240068
         XC    DUBLWD,DUBLWD       NO. THIS MUST BE RQST FOR LOCAL.     18280068
         MVC   DUBLWD(3),HXLINLIB  ROUND CUA ADDR DOWN                  18320068
         NI    DUBLWD+2,B'11100000'     TO EVEN CHAN ADDR.              18360068
         CLC   DUBLWD(6),CTRLPORT       LOOK FOR EQUAL LINE ADDRESS.    18400068
         B     E120                                                     18440068
E110     CLC   HXLINLIB,CTRLPORT   IS THIS SLOT = RQSTD LINE ADDR?      18480068
E120     BE    E200                YES. GO READ ITS DATA BLOCK.         18520068
         LA    DATAREG,SLOTLTH(DATAREG)  NO. BUMP TO NEXT CTRL SLOT.    18560068
         BCT   DATALOOP,E040            MORE SLOTS TO LOOK AT?          18600068
         OC    CTRLBACK,CTRLBACK        NO. IS THERE ANOTHER CTRL BLK?  18640068
         BZ    D240                NO. SEND 'NO ERRS' MSG.              18680068
         MVC   TWAREL,CTRLBACK+1        YES. SAVE NEXT BLOCK ADDR.      18720068
         DFHFC TYPE=RELEASE                                             18760068
         B     D080                                                     18800068
E200     MVC   TWAREL,CTRLFRST     MOVE DATA BLOCK ADDR.                18840068
F020     DFHFC TYPE=RELEASE        RELEASE THE CONTROL BLOCK.           19200068
         OC    TWAREL,TWAREL       IS THERE ANY DATA BLOCKS ?  @OZ31885 19210007
         BZ    T190                NO, WRITE 'NO DATA BLKS MSG'@OZ31885 19220007
         DFHFC TYPE=GET,DATASET=EMFILE,RDIDADR=TWAREL,NORESP=F050       19240068
         B     D090                                                     19280068
F050     L     FIOABAR,TCAFCAA     POINT TO DATA BLOCK.                 19320068
         XC    TWASLOT,TWASLOT     INITIALIZE SLOT COUNT TO 1.          19360068
         LH    DATALOOP,BLKLTH     SETUP TO LOOP ON NBR BYTES IN REC.   19400068
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM.            19440068
F080     L     14,TWASLOT                                               19480068
         LA    14,1(14)            ADD ONE TO SLOT COUNT                19520068
         ST    14,TWASLOT                                               19560068
         CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN MDR RECORD?         19600068
         BNE   H060                NO. TEST FURTHER.                    19640068
         CLI   MDRTYPE,X'03'       YES. IS IT A 3270?                   19680068
         BE    G060                YES. TEST FURTHER.                   19720068
F120     SR    1,1                 NO. BUMP                             19760068
         IC    1,0(DATAREG)        TO NEXT DATA ITEM.                   19800068
         LTR   1,1                 PRECENT ENDLESS LOOP                 19840068
         BZ    F240                IN CASE GARBAGE IN RECORD.           19880068
         AR    DATAREG,1                                                19920068
         SR    DATALOOP,1          ALL DONE WITH THIS BLOCK?            19960068
         LTR   DATALOOP,DATALOOP                                        20000068
         BP    F080                NO. PROCESS NEXT ITEM.               20040068
         OC    DATAFWD,DATAFWD     YES. IS THERE ANOTHER BLOCK?         20080068
         BZ    F240                NO. GO WIND UP OUTPUT.               20120068
         MVC   TWAREL,DATAFWD      YES. GET CHAIN ADDR AND              20160068
         B     F020                GO READ NEXT BLOCK.                  20200068
F240     CLI   OUTSWCH,X'FF'       WAS ANY OUTPUT CREATED?              20240068
         BNE   D240                NO. SEND 'NO ERRS' MSG.              20280068
G020     LA    1,TIOADBA           YES. COMPUTE                         20320068
         SR    OUTREG,1            TOTAL DATA LTH.                      20360068
         STH   OUTREG,TIOATDL                                           20400068
         B     D170                GO TRANSMIT DISPLAY.                 20440068
G060     CLC   MDRCTRL,HEXCTRL     IS THIS MDR FOR RQSTED CTRL UNIT?    20480068
         BNE   F120                NO. SKIP IT.                         20520068
         CLC   MDRTERM,HEXTERM     YES. IS IT FOR REQUESTED TERML?      20560068
         BNE   F120                NO. SKIP IT.                         20600068
         MVC   0(MDRLTH,OUTREG),MDRHDR   YES. SETUP BUILD 1 MDR LINE.   20640068
         UNPK  DUBLWD,MDRSTATS(3)                                       20680068
         TR    DUBLWD,HXTOEB       FILL IN REMOTE STATUS BYTES.         20720068
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                      20760068
G100     UNPK  DUBLWD,TWAREL(4)                                         20800068
         TR    DUBLWD,HXTOEB       FILL IN THIS BLK NBR.                20840068
         MVC   (MDRBBBSS-MDRHDR)(3,OUTREG),DUBLWD+4                     20880068
         UNPK  DUBLWD,TWASLOT(5)                                        20920068
         TR    DUBLWD,HXTOEB       FILL IN THIS SLOT NBR.               20960068
         MVC   (MDRBBBSS+3-MDRHDR)(2,OUTREG),DUBLWD+5                   21000068
         L     14,TWAOUT           POINT TO OUTPUT BBBSS FIELDS.        21040068
         CLC   (BBBSS-HDR3)(5,14),=C'BBBSS' IS 'FIRST' FILLED IN?       21080068
         BNE   G200                YES. SKIP IT.                        21120068
         MVC   (BBBSS-HDR3)(5,14),(MDRBBBSS-MDRHDR)(OUTREG) NO. DO IT.  21160068
         CLC   (BBBSS+10-HDR3)(5,14),=C'BBBSS' HOW ABOUT 'PREV'?        21200068
         BNE   G200                ALREADY THERE; SKIP IT.              21240068
         MVC   (BBBSS+10-HDR3)(5,14),(BBBSS-HDR3)(14)  NO. USE 'FIRST'  21280068
G200     MVC   (BBBSS+5-HDR3)(5,14),(MDRBBBSS-MDRHDR)(OUTREG)           21320068
         UNPK  DUBLWD,TIME                                              21360068
         MVC   (MDRHRS-MDRHDR)(2,OUTREG),DUBLWD+1   FILL IN HOURS       21400068
         MVC   (MDRMINS-MDRHDR)(2,OUTREG),DUBLWD+3  AND MINUTES.        21440068
G230     MVI   OUTSWCH,X'FF'       INDICATE SOME OUTPUT WAS CREATED.    21480068
         TIME    DEC          GET SYSTEM TIME                           21520068
         STCM  0,15,DATTIME        STORE TIME                           21560068
         STCM  1,15,DATDATE        STORE DATE                           21600068
         CP    DATE,DATDATE        DID ERROR HAPPEN TODAY?              21640068
         BE    G240                YES,BR HIGH INTENSITY                21680068
         SP    DATDATE,=P'1'       MAKE DATE YESTERDAY                  21720068
         CP    DATE,DATDATE        DID IT HAPPEN YESTERDAY              21760068
         BNE   G230A               NO,BR LEAVE INTENSITY NORMAL         21800068
         CLC   TIME,DATTIME        IS IT OLDER THAN 24 HRS?             21840068
         BNL   G240                NO,BR MAKE IT HIGH INTENSITY         21880068
G230A    LA    R1,LEAPTBL                                               21920068
G231     CLC   DATE+1(1),0(1)      SEE IF                               21960068
         BE    G232                ERROR HAPPENED                       22000068
         LA    R1,1(R1)            IN LEAP YEAR                         22040068
         CLI   0(R1),X'FF'         IS IT END OF TABLE                   22080068
         BNE   G231                NO,BR TRY NEXT YEAR                  22120068
         ZAP   CALENDAR+8(2),=P'28' NOT LEAP YEAR                       22160068
         B     G233                CONTINUE                             22200068
G232     ZAP   CALENDAR+8(2),=P'29' YES,LEAP YEAR                       22240068
G233     LA    R15,CALENDAR                                             22280068
G234     MVN   DATE+3(1),=X'0C'    MAKE SURE SIGN IS CORRECT            22320068
         CLC   DATE+2(2),3(R15)    COMPUTE MONTH                        22360068
         BNH   G235                AND DAY FROM                         22400068
         SP    DATE+2(2),3(2,R15)  DAY NUMBER                           22440068
         LA    R15,5(R15)                                               22480068
         B     G234                                                     22520068
G235     MVC   (MDRHRS-MDRHDR)(3,OUTREG),0(R15)  MOVE MONTH AND         22560068
         UNPK  (MDRMINS-MDRHDR)(2,OUTREG),DATE+2(2)   DAY TO OUTPUT     22600068
         OI    (MDRMINS+1-MDRHDR)(OUTREG),X'F0'                         22640068
         B     H030                                                     22680068
G240     MVI   1(OUTREG),PDA       YES.                                 22720068
         MVI   4(OUTREG),UHA                                            22760068
         MVI   15(OUTREG),PDA                                           22800068
H030     LA    OUTREG,MDRLTH(OUTREG)    BUMP TO NEXT OUTPUT SLOT.       22840068
         BCT   OUTLOOP,F120        MORE TIOA ROOM LEFT?                 22880068
         B     G020                NO. GO WIND UP OUTPUT.               22920068
H060     CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                22960068
         BE    F120                NO. SKIP IT.                         23000068
         CLC   OBRCUA,HEXLINE      YES. IS IT THE REQUESTED CUA ADDR?XX 23040068
         BNE   F120                NO. SKIP IT.                      XX 23080068
         CLI   OBRUCB,X'10'        IS THIS A REMOTE OBR ?            XX 23120068
         BE    H070                NO. BYPASS CHECKING POLL CHARS    XX 23160068
         CLC   OBRCTRL,HEXCTRL     IS IT THE REQUESTED CTRL UNIT ?      23200068
         BNE   F120                NO. SKIP IT.                         23240068
         CLC   OBRTERM,HEXTERM     IS IT THE REQUESTED TERMINAL ?       23280068
         BNE   F120                NO. SKIP IT.                         23320068
H070     MVC   0(MDRLTH,OUTREG),MDRHDR  YES. SETUP COMMON MDR/OBR HDRXX 23360068
         UNPK  DUBLWD,OBRCSW+4(3)                                       23400068
         TR    DUBLWD,HXTOEB       FILL IN CSW BYTES                    23440068
         MVC   (OBRSNS-MDRHDR)(4,OUTREG),DUBLWD+3                       23480068
         UNPK  DUBLWD,OBRSENSE(3)                                       23520068
         TR    DUBLWD,HXTOEB       FILL IN SENSE BYTES.                 23560068
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                      23600068
         NI    OBRCCW+5,X'3F'      CLEAN UP TP OP CODE.                 23640068
         UNPK  DUBLWD,OBRCCW+5(2)                                       23680068
         TR    DUBLWD,HXTOEB       FILL IN TP OP CODE.                  23720068
         MVC   (OBRTPOP+1-MDRHDR)(2,OUTREG),DUBLWD+5                    23760068
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'B'                          23800068
         CLI   ENTRYTYP,X'34'      IS THIS A TCAM OBR?                  23840068
         BNE   J005                NO. LEAVE 'B' IN FOR BTAM            23880068
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'T'    T=TCAM                23920068
J005     UNPK  DUBLWD,OBRCCW(2)                                         23960068
         TR    DUBLWD,HXTOEB       FILL IN CHANL COMMAND.               24000068
         MVC   (OBRCMD-MDRHDR)(2,OUTREG),DUBLWD+5                       24040068
         B     G100                GO FILL IN DATA COMMON TO MDR/OBR.   24080068
J010     CLC   TIOADBA+8(2),=AL2(L1P7)  IS SECOND FIELD LINE 1 POSN 7?  24120068
         BE    A010                YES. THIS IS NEW INPUT.              24160068
         CLC   TIOADBA+8(2),=AL2(L6P26) IS SECOND FIELD LINE 6 POSN 26? 24200068
         BE    A010                YES. THIS IS NEW INPUT.              24240068
         LA    14,TIOADBA          SCAN THE INPUT TO SEE                24280068
J020     CLI   0(14),C'%'          IF THE SPECIAL CHAR                  24320068
         BE    J140                '%' IS PRESENT, WHICH                24360068
         CLI   0(14),X'00'         WAS PUT OUT BY THE BLOWUP            24400068
         BE    J050                ROUTINE TO INDICATE A                24440068
         LA    14,1(14)            RETURN FROM BLOWUP.                  24480068
         B     J020                                                     24520068
J050     CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            24560068
         BNE   L160                NO. MUST BE 'BLOWUP' REQUEST.        24600068
         CLC   31(2,TIOABAR),=X'C1D3'   PAGE REQUEST           @OZ30480 24604007
         BE    ALTBBB                   YES, POINT TO NEXT FLD @OZ30480 24605007
         CLC   31(2,TIOABAR),=X'C17B'   PAGE BKWRD LARGE SCREEN@OZ30480 24606007
         BE    ALTBBB                   YES, POINT TO NEXT FLD @OZ30480 24607007
         CLC   31(2,TIOABAR),=X'406B'   PAGE FRWRD SMALL SCREEN@OZ30480 24608007
         BE    ALTBBB                   YES, POINT TO NEXT FLD @OZ30480 24609007
         B     PTOK                     NO, POINTER IS OK      @OZ30480 24610007
ALTBBB   CLC   PARM5(7),=C'FORWARD'     IS IT PAGE FORWARD     @OZ30480 24611007
         BNE   J191                     NO, MUST BE BACKWARD   @OZ30480 24612007
         MVC   NEWFIRST,TIOLAST+4       OLD LAST TO NEW FIRST  @OZ30480 24613007
         MVC   NEWPREV,TIOFIRST+4       OLD FIRST TO NEW PREV  @OZ30480 24614007
         TR    TIOLAST+4,EBTOHX         TRANSLATE OLD LAST     @OZ30480 24615007
         PACK  DUBLWD,TIOLAST+4(6)      INTO HEX               @OZ30480 24616007
         B     J110                     CONTINUE               @OZ30480 24617007
J191     MVC   NEWFIRST,TIOPREV+4       OLD PREV TO NEW FIRST  @OZ30480 24618007
         MVC   NEWPREV,TIOPREV+4        OLD PREV TO NEW PREV   @OZ30480 24619007
         TR    TIOPREV+4,EBTOHX         TRANSLATE OLD PREV     @OZ30480 24620007
         PACK  DUBLWD,TIOPREV+4(6)      INTO HEX               @OZ30480 24621007
         B     J110                     CONTINUE               @OZ30480 24622007
PTOK     EQU   *                                               @OZ30480 24623007
         CLC   PARM5(7),=C'FORWARD'  NO. IS IT PAGE FORWARD?            24640068
         BNE   J190                NO. MUST BE PAGE BACKWARD.           24680068
         MVC   NEWFIRST,TIOLAST    YES. PROMOTE LAST & FIRST FROM OLD   24720068
         MVC   NEWPREV,TIOFIRST    SCREEN TO NEW FIRST & PREVIOUS.      24760068
         TR    TIOLAST,EBTOHX                                           24800068
         PACK  DUBLWD,TIOLAST(6)   GET OLD 'LAST' BLK & SLOT IN HEX.    24840068
J110     MVC   TWAREL,DUBLWD+3     SETUP TO READ APPROPRIATE BLK.       24880068
         MVC   TWASLOT(1),DUBLWD+6  SETUP TO LOCATE APPROPRIATE SLOT.   24920068
         B     K010       GO READ BLK WHERE DISPLAY WILL RESUME.        24960068
*********************************************************************** 25000068
*                                                                     * 25040068
*        RESTORE BITS PROMPTER BBBSS SCREEN                           * 25080068
*                                                                     * 25120068
*********************************************************************** 25160068
J140     SH    14,=H'18'           BACKUP TO THE BBBSS FIELD            25200068
         MVC   BITFIRST(15),0(14)  ALIGN IT IN CASE NO PAGE ENTERED.    25240068
         MVC   NEWFIRST,BITFIRST    RESTORE OLD 'FIRST' & 'PREVIOUS'    25280068
         MVC   NEWPREV,BITPREV     AS NEW 'FIRST' & 'PREVIOUS'          25320068
         TR    BITFIRST,EBTOHX                                          25360068
         PACK  DUBLWD,BITFIRST(6)  GET OLD 'FIRST' ADDR & SLOT IN HEX.  25400068
         B     J110                                                     25440068
*********************************************************************** 25480068
J190     MVC   NEWFIRST,TIOPREV    OLD 'PREVIOUS' NOW BECOMES NEW       25520068
         MVC   NEWPREV,TIOPREV     'PREVIOUS' AND 'FIRST'               25560068
         TR    TIOPREV,EBTOHX                                           25600068
         PACK  DUBLWD,TIOPREV(6)   GET OLD 'PREVIOUS' IN HEX.           25640068
         B     J110                                                     25680068
K010     BAL   LINKREG,LOCATE      LOCATE SLOT TO RESUME AT.            25720068
         XC    PARM4(16),PARM4     ZERO OUT INPUT PARMS.                25760068
         CLI   ENTRYTYP,X'91'     IS THIS AN MDR?                       25800068
         BE    K020               YES. LINE ADDR IS OK.                 25840068
         XC    HXLINLIB,HXLINLIB  NO. DON'T USE ROUNDED DOWN ADDR.      25880068
         MVC   HXLINLIB+1(2),OBRCUA  GET ACTUAL CUA INSTEAD.            25920068
         B     K030                                                     25960068
K020     MVC   HXLINLIB,LINEID                                          26000068
K030     UNPK  DUBLWD,HEXLINE(3)   RESTORE LINE NBR FROM DATA           26040068
         TR    DUBLWD,HXTOEB       BLOCK AS IF IT HAD BEEN KEYED IN.    26080068
         MVC   PARM3(3),DUBLWD+4                                        26120068
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR RECORD?               26160068
         BE    K040                YES. PUT IN POLLING CHARS.        XX 26200068
         CLI   OBRUCB,X'10'        IS THIS A LOCAL ?                 XX 26240068
         BE    L110                YES. BR NO POLL CHARS             XX 26280068
         MVC   HEXCTRL,OBRCTRL     MOVE CTRL UNIT ADDR               XX 26320068
         MVC   HEXTERM,OBRTERM     MOVE TERMINAL ADDR                XX 26360068
         B     K050                                                  XX 26400068
K040     MVC   HEXCTRL,MDRCTRL     YES.                              XX 26440068
         MVC   HEXTERM,MDRTERM     RESTORE CTRL UNIT ADDR            XX 26480068
K050     UNPK  DUBLWD,HEXCTRL(3)   AND TERMINAL ADDR                 XX 26520068
         TR    DUBLWD,HXTOEB       AS IF THEY HAD                    XX 26560068
         MVC   PARM4(2),DUBLWD+3   BEEN KEYED IN.                    XX 26600068
         MVC   PARM5(2),DUBLWD+5                                     XX 26640068
L110     BAL   LINKREG,GETTIOA     SETUP OUTPUT AREA WITH HEADERS.      26680068
         L     14,TWAOUT                                                26720068
         MVC   (BBBSS-HDR3)(5,14),NEWFIRST  FINISH HEADER WITH ADDR     26760068
         MVC   (BBBSS+10-HDR3)(5,14),NEWPREV   OF FIRST & PREVIOUS BLK. 26800068
         B     F080                GO BUILD ANOTHER PAGE.               26840068
L160     CLC   PARM2(4),=C'TERM'   IS THIS A 'COMPANION' INPUT?         26880068
         BE    L200                YES. GO HUNT FOR CTRL & LINE ADDR.   26920068
         TR    TIOITEM,EBTOHX      NO. GET REQUESTED ITEM ADDR.         26960068
         PACK  DUBLWD,TIOITEM(6)        AND SLOT NUMBER.                27000068
         MVC   TWAREL,DUBLWD+3          INTO HEX.                       27040068
         MVC   TWASLOT(1),DUBLWD+6                                      27080068
         BAL   LINKREG,LOCATE      LOCATE APPROPRIATE SLOT IN DATA BLK. 27120068
         DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=2000,INITIMG=40          27160068
         L     TIOABAR,TCASCSA     GET A NEW OUTPUT AREA                27200068
         ST    TIOABAR,TCTTEDA     FOR THE BLOWUP DISPLAY.              27240068
         CLI   TCTTETM,C'2'        IS THIS SCREEN A MODEL 2?            27280068
         BE    M060                YES. MOVE APPROPRIATE HEADER.        27320068
         MVC   TIOADBA(BUHDR1LT),BUHDR1   NO. MOVE MODEL 1 BLOWUP HDR.  27360068
         LA    OUTREG,TIOADBA+BUHDR1LT  POINT TO NEXT BYTE OF OUTAREA.  27400068
         B     M080                                                     27440068
L200     TR    PARM3,EBTOHX        PARM3 IS BBBSS OF CTRL UNIT DISPLAY. 27480068
         PACK  DUBLWD,PARM3(6)     GET ITS BLK & SLT IN HEX.            27520068
         MVC   TWAREL,DUBLWD+3                                          27560068
         MVC   TWASLOT(1),DUBLWD+6                                      27600068
         BAL   LINKREG,LOCATE      LOCATE BLK & SLOT OF PREVIOUS DISPLY 27640068
         XC    PARM3,PARM3         ERASE BBBSS GARBAGE.                 27680068
         UNPK  PARM3(4),DATAPORT+1(3)   MOVE LINE ADDR FROM RECORD.     27720068
         MVI   PARM3+3,X'00'                                            27760068
         TR    PARM3,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   27800068
         XC    PARM4,PARM4                                              27840068
         CLI   ENTRYTYP,X'91'      IS THIS AN OBR?                      27880068
         BNE   L270                YES. SKIP POLLING CHARACTERS.     XX 27920068
         UNPK  PARM4(3),MDRCTRL(2) NO. GET CTRL UNIT POLL CHAR.         27960068
         MVI   PARM4+2,X'00'                                            28000068
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   28040068
         B     L300                                                     28080068
L270     CLI   OBRUCB,X'10'        IS THIS A LOCAL ?                 XX 28120068
         BE    L280                YES. BR NO POLL CHARS             XX 28160068
         UNPK  PARM4(3),OBRCTRL(2)  GET CTRL UNIT POLL CHARS         XX 28200068
         MVI   PARM4+2,X'00'                                         XX 28240068
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN XX 28280068
         B     A010                                                  XX 28320068
L280     MVC   PARM3,PARM5         UNROUND TERML ADDRESS                28360068
         XC    PARM5,PARM5         ERASE GARBAGE IF LOCAL CU.           28400068
L300     DFHFC TYPE=RELEASE                                             28440068
         B     A010                                                     28480068
M060     MVC   TIOADBA(BUHDR2LT),BUHDR2   MOVE MODEL 2 BLOWUP HDR.      28520068
         LA    OUTREG,TIOADBA+BUHDR2LT  POINT TO NEXT BYTE OF OUTAREA.  28560068
M080     UNPK  DUBLWD,TIME         MOVE TIME OF                         28600068
         MVC   0(2,OUTREG),DUBLWD+1     ERROR TO OUTPUT.                28640068
         MVI   2(OUTREG),C':'                                           28680068
         MVC   3(2,OUTREG),DUBLWD+3                                     28720068
         LA    1,LEAPTBL                                                28760068
M090     CLC   DATE+1(1),0(1)           FIGURE OUT IF                   28800068
         BE    M100                     ERROR HAPPENED                  28840068
         LA    1,1(1)                   DURING LEAP YEAR.               28880068
         CLI   0(1),X'FF'                                               28920068
         BNE   M090                                                     28960068
         ZAP   CALENDAR+8(2),=P'28'                                     29000068
         B     M110                                                     29040068
M100     ZAP   CALENDAR+8(2),=P'29'                                     29080068
M110     LA    15,CALENDAR                                              29120068
M120     MVN   DATE+3(1),=X'0C'    PROTECT AGAINST GARBAGE IN PACKED    29160068
         CLC   DATE+2(2),3(15)     FIELD.  COMPUTE MONTH AND            29200068
         BNH   M130                     DAY FROM DAY NUMBER.            29240068
         SP    DATE+2(2),3(2,15)                                        29280068
         LA    15,5(15)                                                 29320068
         B     M120                                                     29360068
M130     MVC   6(3,OUTREG),0(15)        MOVE MONTH TO OUTPUT.           29400068
         UNPK  9(2,OUTREG),DATE+2(2)    MOVE DAY TO OUTPUT.             29440068
         OI    10(OUTREG),X'F0'                                         29480068
         MVC   LINESZ,=H'40'                                            29520068
         MVC   LINELOOP,=H'4'                                           29560068
         CLI   TCTTETM,C'2'        SETUP CORRECT LINE SIZE & NBR        29600068
         BNE   M140                     ITEMS FOR SCREEN MODEL.         29640068
         MVC   LINESZ,=H'80'                                            29680068
         MVC   LINELOOP,=H'12'                                          29720068
M140     EQU   *                                                        29760068
         CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                29800068
         BNE   M160                YES.                                 29840068
         BAL   LINKREG,BUMDR       NO. BLOW UP AN MDR ENTRY.            29880068
M150     LA    1,TIOADBA                                                29920068
         SR    OUTREG,1                                                 29960068
         STH   OUTREG,TIOATDL      FINISH UP THE OUTPUT.                30000068
         DFHTC TYPE=WRITE,CTLCHAR=C2                                    30040068
         DFHPC TYPE=RETURN                                              30080068
M160     BAL   LINKREG,BUOBR       BLOWUP AN OBR ENTRY.                 30120068
         B     M150                                                     30160068
BUOBR    MVC   13(5,OUTREG),=C'TP-OP'   MOVE THE                        30200068
         UNPK  DUBLWD,OBRCCW+5(2)       TP OP CODE                      30240068
         TR    DUBLWD,HXTOEB            TO OUTPUT AREA.                 30280068
         MVC   19(2,OUTREG),DUBLWD+5                                    30320068
         LA    15,TPOPTBL                                               30360068
         CLI   ENTRYTYP,X'34'       IS THIS A TCAM OBR?                 30400068
         BNE   O060                 NO. REG 15 POINTS AT BTAM           30440068
         L     15,=A(TCAMTPOP)      YES. POINT TO TCAM TPOP TABLE       30480068
O060     CLC   0(2,15),DUBLWD+5                                         30520068
         BE    O120                                                     30560068
         CLC   0(2,15),=X'FFFF'                                         30600068
         BE    O120                                                     30640068
         LA    15,20(15)                                                30680068
         B     O060                                                     30720068
O120     MVC   22(18,OUTREG),2(15) MOVE EXPLANATION OF TP OP CODE.      30760068
         AH    OUTREG,LINESZ       BUMP TO NEXT LINE OF OUTPUT.         30800068
O170     MVC   0(11,OUTREG),=C'DATA LENGTH'                             30840068
         UNPK  DUBLWD,OBRCCW+6(3)                                       30880068
         TR    DUBLWD,HXTOEB       MOVE DATA LENGTH.                    30920068
         MVC   12(4,OUTREG),DUBLWD+3                                    30960068
         MVC   21(14,OUTREG),=C'RESIDUAL COUNT'                         31000068
         UNPK  DUBLWD,OBRCSW+6(3)                                       31040068
         TR    DUBLWD,HXTOEB                                            31080068
         MVC   36(4,OUTREG),DUBLWD+3                                    31120068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            31160068
         MVC   0(15,OUTREG),=C'CHANNEL COMMAND'                         31200068
         UNPK  DUBLWD,OBRCCW(2)                                         31240068
         TR    DUBLWD,HXTOEB       MOVE THE CHANNEL COMMAND.            31280068
         MVC   16(2,OUTREG),DUBLWD+5                                    31320068
         LA    15,CCWTABL                                               31360068
         CLI   OBRUCB,X'40'     IS THIS A REMOTE?                       31400068
         BE    P070             YES. USE 270X COMMANDS.                 31440068
         L     15,=A(CCW3272)   NO. USE THE 3272 COMMANDS.              31480068
P070     CLC   0(2,15),DUBLWD+5                                         31520068
         BE    P130                                                     31560068
         CLC   0(2,15),=X'FFFF'                                         31600068
         BE    P130                                                     31640068
         LA    15,20(15)                                                31680068
         B     P070                                                     31720068
P130     MVC   19(18,OUTREG),2(15) MOVE CCW EXPLANATION.                31760068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            31800068
         MVC   4(5,OUTREG),=C'SENSE' MOVE SENSE & STATUS HEADERS.       31840068
         MVC   24(6,OUTREG),=C'STATUS'                                  31880068
         UNPK  DUBLWD,OBRSENSE(3)  MOVE SENSE                        XH 31920068
         TR    DUBLWD,HXTOEB       BYTES TO                          XH 31960068
         MVC   10(4,OUTREG),DUBLWD+3    OUTPUT AREA                  XH 32000068
         UNPK  DUBLWD,OBRCSW+4(3)  MOVE OBR STATUS                   XH 32040068
         TR    DUBLWD,HXTOEB       BYTES TO                          XH 32080068
         MVC   31(4,OUTREG),DUBLWD+3    OUTPUT AREA                  XH 32120068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUTLINE.             32160068
         LR    14,OUTREG           TEMPORARY POINTER TO SENSE OUTPUT.   32200068
         LH    1,LINELOOP          LIMIT DISPLAY IF MOD 1 SCREEN.       32240068
         LA    15,SENSTABL                                              32280068
         CLI   OBRUCB,X'40'        IS THIS REMOTE?                      32320068
         BE    P200                YES, USE 270X SENSE                  32360068
         L     15,=A(SENS3272)     NO, USE 3272 SENSE                   32400068
P200     MVC   DUBLWD(1),OBRSENSE  SETUP TO TEST SENSE BITS.            32440068
         NC    DUBLWD(1),0(15)                                          32480068
         CLC   DUBLWD(1),0(15)                                          32520068
         BE    Q050                                                     32560068
Q010     LA    15,19(15)           BUMP TO NEXT SLOT IN SENSE TABL.     32600068
         CLI   0(15),X'FF'                                              32640068
         BNE   P200                                                     32680068
         B     Q080                                                     32720068
Q050     MVC   0(18,14),1(15)      MOVE EXPLANATION OF 1 SENSE BIT.     32760068
         AH    14,LINESZ           BUMP TO NEXT SENSE OUTPUT AREA.      32800068
         BCT   1,Q010              ANY TIOA ROOM LEFT?                  32840068
Q080     ST    14,SAVE14                                                32880068
         LR    14,OUTREG           NO. SETUP TO LOOK AT STATUS BITS.    32920068
         LH    1,LINELOOP                                               32960068
         LA    15,CSWTABL                                               33000068
Q110     MVC   DUBLWD(2),OBRCSW+4                                       33040068
         NC    DUBLWD(2),0(15)                                          33080068
         CLC   DUBLWD(2),0(15)                                          33120068
         BE    Q180                                                     33160068
Q150     LA    15,20(15)                                                33200068
         CLI   0(15),X'FF'                                              33240068
         BNE   Q110                                                     33280068
         B     Q210                                                     33320068
Q180     MVC   20(18,14),2(15)     MOVE EXPLANATION OF 1 CSW STATUS BIT 33360068
         AH    14,LINESZ           BUMP TO NEXT OUTPUT SLOT             33400068
         BCT   1,Q150              ANY TIOA ROOM LEFT?                  33440068
Q210     C     14,SAVE14           NO.                                  33480068
         BH    R010                                                     33520068
         L     14,SAVE14           SET OUTPUT REG TO HIGHER             33560068
R010     LR    OUTREG,14           OUTPUT ADDRESS (SENSE OR STATUS).    33600068
         BR    LINKREG                                                  33640068
BUMDR    MVC   24(6,OUTREG),=C'SENSE '  MOVE SENSE HDR.                 33680068
         UNPK  DUBLWD,MDRSTATS(3)  MOVE MDR                             33720068
         TR    DUBLWD,HXTOEB       STATUS BYTES                         33760068
         MVC   31(4,OUTREG),DUBLWD+3    TO OUTPUT AREA                  33800068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            33840068
         LR    14,OUTREG                                                33880068
         LH    1,LINELOOP                                               33920068
         AR    1,1                 LIMIT MOD 1 TO 7 BITS MAX.           33960068
         BCTR  1,0                                                      34000068
         LA    15,STATSTBL                                              34040068
R080     MVC   DUBLWD(2),MDRSTATS  SETUP TO LOOK AT REMOTE STATUS TBL.  34080068
         NC    DUBLWD(2),0(15)                                          34120068
         CLC   DUBLWD(2),0(15)                                          34160068
         BE    R170                                                     34200068
R120     LA    15,20(15)                                                34240068
         CLI   0(15),X'FF'                                              34280068
         BNE   R080                                                     34320068
         B     R200                                                     34360068
R170     MVC   20(18,14),2(15)     MOVE EXPLANATION OF 1 REMOTE STATUS  34400068
         AH    14,LINESZ           BUMP TO NEXT OUTPUT AREA             34440068
         BCT   1,R120              ANY TIOA ROOM LEFT?                  34480068
R200     LR    OUTREG,14           NO. SETUP TO COMPUTE DATA LTH.       34520068
         BR    LINKREG             RETURN TO MAIN LINE.                 34560068
LOCATE   DFHFC TYPE=GET,DATASET=EMFILE,RDIDADR=TWAREL,NORESP=S030       34600068
         B     D090                                                     34640068
S030     L     FIOABAR,TCAFCAA     POINT TO DATA BLK.                   34680068
         LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       34720068
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             34760068
         SR    1,1                 PREPARE SLOT NBR FOR                 34800068
         IC    1,TWASLOT           PUTTING OUT IN DISPLAY               34840068
         BCTR  1,0                 SUB 1 FROM TWASLOT                   34880068
         STC   1,TWASLOT+3         AND STORE INTO LAST BYTE(TWASLOT)    34920068
S060     CLI   TWASLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      34960068
         BL    S220                GO RESUME DISPLAY BUILDING.          35000068
         SR    1,1                                                      35040068
         IC    1,TWASLOT           DECREMENT SLOT COUNT BY 1.           35080068
         BCTR  1,0                                                      35120068
         STC   1,TWASLOT                                                35160068
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   35200068
         LTR   1,1                                                      35240068
         BZ    S190                PREVENT LOOP IF GARBAGE INPUT.       35280068
         AR    DATAREG,1                                                35320068
         SR    DATALOOP,1                                               35360068
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  35400068
         BP    S060                                                     35440068
S190     EQU   *                                                        35480068
         MVC   TIOADBA(INVLTH),INVMSG  IF RQSTED SLOT CAN'T             35520068
         MVC   TIOATDL,=AL2(INVLTH)     BE FOUND, SEND 'SEARCH ERROR'   35560068
         B     D170                                                     35600068
S220     BR    LINKREG             RETURN TO MAIN LINE.                 35640068
GETTIOA  DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=2000,INITIMG=40          35680068
         L     TIOABAR,TCASCSA     GET A NEW OUTPUT AREA BIG            35720068
         ST    TIOABAR,TCTTEDA     ENOUGH FOR A MODEL-2 DISPLAY.        35760068
         MVC   TIOADBA(HDR1LTH),HDR1                                    35800068
         MVC   TIOADBA+HDR1LTH(4),=C'3270'   SETUP 1ST LINE OF HEADER.  35840068
         LA    OUTREG,TIOADBA+HDR1LTH+4                                 35880068
         CLI   TCTTETM,C'2'        IS THIS SCREEN A MODEL 2?            35920068
         BNE   T120                NO. 1ST LINE IS OK.                  35960068
         MVC   0(3,OUTREG),HDR2    YES. ADD ANOTHER SBA TO FINISH       36000068
         LA    OUTREG,3(OUTREG)    THIS 80-CHAR LINE.                   36040068
T120     MVC   0(HDR3LTH,OUTREG),HDR3   MOVE THE 'PAGE' REQUEST LINES.  36080068
         MVC   SAVEID,=CL20' '     CLEAR CICS ID FROM SAVE AREA         36120068
         OC    TWATCTID,TWATCTID   IF NO INPUT WAS SPECIFIED,           36160068
         BZ    T130                SHOW USER HIS CICS TERML ID.         36200068
         MVC   (HDR3ID-HDR3)(8,OUTREG),=C'CICS ID '                     36240068
         MVC   (HDR3ID-HDR3+8)(4,OUTREG),TWATCTID                       36280068
         MVC   SAVEID(12),(HDR3ID-HDR3)(OUTREG)                         36320068
T130     ST    OUTREG,TWAOUT       SAVE THIS ADDR TO FILL IN BLK NBRS.  36360068
         LA    OUTREG,HDR3LTH(OUTREG)                                   36400068
         MVC   0(HDR4LTH,OUTREG),HDR4   MOVE THE RECAP LINE HDR.        36440068
         OC    PARM5,PARM5         IF NO TERM ADDR INPUT, SHOW ONLY LIN 36480068
         BZ    T150                                                     36520068
         MVC   (HDR4TERM-HDR4)(2,OUTREG),PARM5   FILL IN THE            36560068
         MVC   (HDR4CTRL-HDR4)(2,OUTREG),PARM4    ID OF THIS TERML      36600068
T150     EQU   *                                                        36640068
         MVC   (HDR4LINE-HDR4)(3,OUTREG),PARM3    CTRL UNIT, AND LINE.  36680068
         CLC   (HDR4TERM-HDR4)(2,OUTREG),=C'  '  IS TERML BLANK?        36720068
         BNE   T160                      NO. LET IT GO.                 36760068
         MVC   8(6,OUTREG),=C'LOCAL '    YES, CHANGE TO                 36800068
         MVC   14(3,OUTREG),PARM3        LOCAL FORMAT.                  36840068
         MVC   17(24,OUTREG),=24C' '                                    36880068
T160     EQU   *                                                        36920068
         LA    OUTREG,HDR4LTH(OUTREG)                                   36960068
         CLI   TCTTETM,C'2'        IS THIS A BIG SCREEN?                37000068
         BNE   T170                NO. THIS LINE IS OK.                 37040068
         MVC   0(3,OUTREG),HDR5    YES. ADD ANOTHER SBA TO              37080068
         LA    OUTREG,3(OUTREG)    GET US PAST 40 MORE CHARS.           37120068
T170     MVC   0(HDR6LTH,OUTREG),HDR6   MOVE COLUMN HEADERS.            37160068
         LA    OUTREG,HDR6LTH(OUTREG)                                   37200068
         LA    OUTLOOP,7           SETUP TO SHOW 7 ITEMS ON MOD 1.      37240068
         CLI   TCTTETM,C'2'        IS THIS A BIG SCREEN?                37280068
         BNE   T180                NO. RETURN TO MAIN LINE.             37320068
         MVC   0(HDR6LTH,OUTREG),HDR6   YES. MOVE ANOTHER COLUMN HDR.   37360068
         LA    OUTREG,HDR6LTH(OUTREG)                                   37400068
         LA    OUTLOOP,40          SETUP TO SHOW 40 ITEMS ON MOD 2.     37440068
T180     BR    LINKREG             RETURN TO MAIN LINE.                 37480068
T190     DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=256,INITIMG=40  @OZ31885 37484007
         L     TIOABAR,TCASCSA          GET DATA AREA          @OZ31885 37488007
         ST    TIOABAR,TCTTEDA          POINT TO MSG TO WRITE  @OZ31885 37492007
         MVC   TIOADBA(MSG13LTH),MSG13  MOVE IN THE MSG        @OZ31885 37496007
         MVC   TIOATDL,=AL2(MSG13LTH)   MOVE IN THE LENGTH     @OZ31885 37500007
         MVC   TIOADBA+(MSG13LN-MSG13)(3),SAVELINE GET LINE NO.@OZ31885 37504007
         DFHTC TYPE=(WRITE,ERASE)                              @OZ31885 37508007
         DFHPC TYPE=RETURN                                     @OZ31885 37512007
HDR1     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF'                   37520068
         DC    AL1(SF,UNA,IC),AL1(SBA),AL2(L1P36),AL1(SF,MNP)           37560068
HDR1LTH  EQU   *-HDR1                                                   37600068
HDR2     DC    AL1(SBA),AL2(L2P1)                                       37640068
HDR3     DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        37680068
         DC    AL1(SF,PNA),C') PAGE FORWARD     '                       37720068
HDR3ID   DC    C'                '                                      37760068
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        37800068
         DC    AL1(SF,PNA),C') PAGE BACKWRD'                            37840068
         DC    AL1(SF,PIA)                                              37880068
BBBSS    DC    C'BBBSSBBBSSBBBSS',AL1(SF,PNA),C'    '                   37920068
HDR3LTH  EQU   *-HDR3                                                   37960068
HDR4     DC    AL1(SF,PNA),C'RECAP REMOTE '                          XH 38000068
HDR4TERM DC    CL2'  ',C' ON CU '                                    XH 38040068
HDR4CTRL DC    CL2'  ',C' ON LINE '                                  XH 38080068
HDR4LINE DC    CL3'999',C'  '                                        XH 38120068
HDR4LTH  EQU   *-HDR4                                                XH 38160068
HDR5     DC    AL1(SBA),AL2(L4P1)                                    XH 38200068
HDR6     DC    AL1(SF,PNA),C'      FILE#  TIME SENSE STATUS TPOP CMD'   38240068
HDR6LTH  EQU   *-HDR6                                                XH 38280068
IOERRMSG DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 38320068
         DC    CL34' ',AL1(SF,PNA),CL39' '                           XH 38360068
         DC    CL39'BNG013A C I/O ERR READING SYS1.DEMFLOG '   @OX21950 38400007
         DC    CL28'  THE CICS RESPONSE CODE IS '              @OX21950 38430007
IOCODE   DC    CL4'00  '                                       @OX21950 38460007
         DC    CL9' '                                                XH 38520068
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS '              XH 38560068
IOBLOCK  DC    CL3'000'                                              XH 38600068
IOERRLTH EQU   *-IOERRMSG                                            XH 38640068
MSG11LG  DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 38680068
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 38720068
         DC    C'BNG011I C NO ERRORS RECORDED FOR REMOTE'            XH 38760068
         DC    AL1(SBA),AL2(L3P1LG),AL1(SF,PNA)                      XH 38800068
         DC    CL9'TERMINAL '                                        XH 38840068
M11LGTRM DC    CL2' '                                                XH 38880068
         DC    CL20'       ON CTRL UNIT '                            XH 38920068
M11LGCU  DC    CL2' '                                                XH 38960068
         DC    AL1(SBA),AL2(L4P1),AL1(SF,PNA)                        XH 39000068
         DC    CL8'ON LINE '                                         XH 39040068
M11LGLN  DC    CL3' '                                                XH 39080068
         DC    CL8' '                                                XH 39120068
M11LGID  DC    CL20' '         CICS SYMBOLIC NAME                    XH 39160068
M11LGLTH EQU   *-MSG11LG                                             XH 39200068
MSG11SM  DC    AL1(SBA),AL2(L1P1SM),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)  39240068
         DC    AL1(SBA),AL2(L2P1SM),AL1(SF,PNA)                         39280068
         DC    C'BNG011I C NO ERRORS RECORDED FOR REMOTE'            XH 39320068
         DC    AL1(SBA),AL2(L3P1SM),AL1(SF,PNA)                         39360068
         DC    CL9'TERMINAL '                                        XH 39400068
M11SMTRM DC    CL2' '                                                XH 39440068
         DC    CL20'       ON CTRL UNIT '                            XH 39480068
M11SMCU  DC    CL2' '                                                XH 39520068
         DC    AL1(SBA),AL2(L4P1SM),AL1(SF,PNA)                         39560068
         DC    CL8'ON LINE '                                         XH 39600068
M11SMLN  DC    CL3' '                                                XH 39640068
         DC    CL8' '                                                XH 39680068
M11SMID  DC    CL20' '         CICS SYMBOLIC NAME                    XH 39720068
M11SMLTH EQU   *-MSG11SM                                             XH 39760068
MSG12LG  DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 39800068
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 39840068
         DC    C'BNG012I C NO ERRORS RECORDED FOR LOCAL '            XH 39880068
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 39920068
         DC    CL9'TERMINAL '                                        XH 39960068
M12LGTRM DC    CL3' '                                                XH 40000068
         DC    CL7' '                                                XH 40040068
M12LGID  DC    CL20' '         CICS SYMBOLIC NAME                    XH 40080068
M12LGLTH EQU   *-MSG12LG                                             XH 40120068
MSG12SM  DC    AL1(SBA),AL2(L1P1SM),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)  40160068
         DC    AL1(SBA),AL2(L2P1SM),AL1(SF,PNA)                         40200068
         DC    C'BNG012I C NO ERRORS RECORDED FOR LOCAL '            XH 40240068
         DC    AL1(SBA),AL2(L3P1SM),AL1(SF,PNA)                         40280068
         DC    CL9'TERMINAL '                                        XH 40320068
M12SMTRM DC    CL3' '                                                XH 40360068
         DC    CL7' '                                                XH 40400068
M12SMID  DC    CL20' '         CICS SYMBOLIC NAME                    XH 40440068
M12SMLTH EQU   *-MSG12SM                                             XH 40480068
MDRHDR   DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'? ) '                     40520068
MDRBBBSS DC    CL5'BBBSS',AL1(SF,PNA)                                   40560068
MDRHRS   DC    CL2'24',C':'                                             40600068
MDRMINS  DC    CL2'60',C'  '                                            40640068
MDRSTAT  DC    CL4'XXXX',C'   '                                         40680068
OBRSNS   DC    CL4'    ',C'  '                                          40720068
OBRTPOP  DC    CL2'  ',C'  '                                            40760068
OBRCMD   DC    CL2'  ',C' '                                             40800068
MDRLTH   EQU   *-MDRHDR                                                 40840068
BUHDR1   DC    AL1(SBA),AL2(L1P7),AL1(IC)                               40880068
         DC    AL1(SBA),AL2(L3P39),AL1(SF,PIA),C'%',AL1(SBA),AL2(L5P1)  40920068
         DC    X'3CC75F40',AL1(SBA),AL2(L5P1)                           40960068
BUHDR1LT EQU   *-BUHDR1                                                 41000068
BUHDR2   DC    AL1(SBA),AL2(L1P7),AL1(IC)                               41040068
         DC    AL1(SBA),AL2(L2P79),AL1(SF,PIA),C'%',AL1(SBA),AL2(L4P1)  41080068
         DC    X'3C5D7F40',AL1(SBA),AL2(L4P1)                           41120068
BUHDR2LT EQU   *-BUHDR2                                                 41160068
INVMSG   DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 41200068
         DC    XL34'00',AL1(SBA),AL2(L2P1),AL1(SF,PNA)               XH 41240068
         DC    CL39'BNG005I C ERROR NOT FOUND ON FILE FOR '          XH 41280068
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 41320068
         DC    C'THE SELECTED ITEM '                                 XH 41360068
INVLTH   EQU   *-INVMSG                                                 41400068
MSG13    DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    41404007
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                  @OZ31885 41408007
         DC    CL39'BNG013A C NO DATA BLOCKS AVAILABLE FOR '   @OZ31885 41412007
         DC    CL5'LINE '                                      @OZ31885 41416007
MSG13LN  DC    CL3' '                                          @OZ31885 41420007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31885 41424007
         DC    CL39' MUST ALLOCATE MORE BLOCKS THAN LINES'     @OZ31885 41428007
MSG13LTH EQU   *-MSG13                                         @OZ31885 41432007
         LTORG                                                          41440068
CALENDAR DC    C'JAN',PL2'31'                                           41480068
         DC    C'FEB',PL2'28'                                           41520068
         DC    C'MAR',PL2'31'                                           41560068
         DC    C'APR',PL2'30'                                           41600068
         DC    C'MAY',PL2'31'                                           41640068
         DC    C'JUN',PL2'30'                                           41680068
         DC    C'JUL',PL2'31'                                           41720068
         DC    C'AUG',PL2'31'                                           41760068
         DC    C'SEP',PL2'30'                                           41800068
         DC    C'OCT',PL2'31'                                           41840068
         DC    C'NOV',PL2'30'                                           41880068
         DC    C'DEC',PL2'31'                                           41920068
LEAPTBL  DC    X'768084889296FF'                                        41960068
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      42000068
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     42040068
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  42080068
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     42120068
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  42160068
         DC    X'000000000000000000000000FF000000'     50-5F    TO      42200068
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   42240068
         DC    X'00000000000000000000000000000000'     70-7F   AND      42280068
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   42320068
         DC    X'00000000000000000000000000000000'     90-9F    TO      42360068
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   42400068
         DC    X'00000000000000000000000000000000'     B0-BF    AND     42440068
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      42480068
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   42520068
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     42560068
         DC    X'00010203040506070809000000000000'     F0-FF            42600068
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   42640068
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           42680068
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           42720068
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            42760068
CCWTABL  DC    CL20'00TEST IO'                                          42800068
         DC    CL20'01WRITE'                                            42840068
         DC    CL20'02READ'                                             42880068
         DC    CL20'03NO OP'                                            42920068
         DC    CL20'04SENSE'                                            42960068
         DC    CL20'05TEST WRITE'                                       43000068
         DC    CL20'06READ PREPARE'                                     43040068
         DC    CL20'07STEP COUNT'                                       43080068
         DC    CL20'09WRITE POLL'                                       43120068
         DC    CL20'0AREAD INHIBIT'                                     43160068
         DC    CL20'0DWRITE BREAK'                                      43200068
         DC    CL20'0EREAD SEARCH'                                      43240068
         DC    CL20'11WRITE W/TIME OUT'                                 43280068
         DC    CL20'12TEST READ'                                        43320068
         DC    CL20'13SAD ZERO'                                         43360068
         DC    CL20'15WRAP'                                             43400068
         DC    CL20'17SAD ONE'                                          43440068
         DC    CL20'19POLL SOH'                                         43480068
         DC    CL20'1BSAD TWO'                                          43520068
         DC    CL20'1DDIAGNOSTIC POLL'                                  43560068
         DC    CL20'1EADDRESS PREPARE'                                  43600068
         DC    CL20'1FSAD THREE'                                        43640068
         DC    CL20'23SET MODE'                                         43680068
         DC    CL20'27ENABLE'                                           43720068
         DC    CL20'29WRITE DIAL'                                       43760068
         DC    CL20'2FDISABLE'                                          43800068
         DC    CL20'33TEST SYNC'                                        43840068
         DC    CL20'37SEND EOT'                                         43880068
         DC    CL20'3BSEND INQUIRY'                                     43920068
         DC    CL20'41WRITE BREAK'                                      43960068
         DC    CL20'42READ CLEAR'                                       44000068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           44040068
TPOPTBL  DC    CL20'00ON LINE TEST'                                     44080068
         DC    CL20'01DISABLE'                                          44120068
         DC    CL20'02WRITE EOA EOT EOT'                                44160068
         DC    CL20'03WRT POLL/ADDR CHRS'                               44200068
         DC    CL20'04WRITE SPACE'                                      44240068
         DC    CL20'05RD RSP TO POLLING'                                44280068
         DC    CL20'06RD RSP TO ADDRESSING'                             44320068
         DC    CL20'07READ ID RESPONSE'                                 44360068
         DC    CL20'08WRITE EOA'                                        44400068
         DC    CL20'09NOP OR TIC'                                       44440068
         DC    CL20'0AREAD INDEX'                                       44480068
         DC    CL20'0BREAD INQUIRY'                                     44520068
         DC    CL20'0CRD RSP TO INQUIRY'                                44560068
         DC    CL20'10WRT LINE ADDRESS'                                 44600068
         DC    CL20'11RD OR WRT TEXT'                                   44640068
         DC    CL20'12RD SKIP OR TIC'                                   44680068
         DC    CL20'13WRITE DLE ETX'                                    44720068
         DC    CL20'20RD RSP TO TEXT'                                   44760068
         DC    CL20'21ALL RESET COMMANDS'                               44800068
         DC    CL20'22READ SKIP'                                        44840068
         DC    CL20'23WRITE BREAK'                                      44880068
         DC    CL20'24OPEN LOPEN CLOSE'                                 44920068
         DC    CL20'25RD RSP TO TEXT'                                   44960068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           45000068
CSWTABL  DC    B'1000000000000000',CL18'ATTENTION'                      45040068
         DC    B'0100000000000000',CL18'STATUS MODIFIER'                45080068
         DC    B'0010000000000000',CL18'CTRL UNIT END'                  45120068
         DC    B'0001000000000000',CL18'BUSY'                           45160068
         DC    B'0000100000000000',CL18'CHANNEL END'                    45200068
         DC    B'0000010000000000',CL18'DEVICE END'                     45240068
         DC    B'0000001000000000',CL18'UNIT CHECK'                     45280068
         DC    B'0000000100000000',CL18'UNIT EXCEPTION'                 45320068
         DC    B'0000000010000000',CL18'PGRM CTRLD INTRPT'              45360068
         DC    B'0000000001000000',CL18'INCORRECT LENGTH'               45400068
         DC    B'0000000000100000',CL18'PROGRAM CHECK'                  45440068
         DC    B'0000000000010000',CL18'PROTECTION CHECK'               45480068
         DC    B'0000000000001000',CL18'CHANL DATA CHECK'               45520068
         DC    B'0000000000000100',CL18'CHANL CTRL CHECK'               45560068
         DC    B'0000000000000010',CL18'INTFACE CTRL CK'                45600068
         DC    B'0000000000000001',CL18'CHAINING CHECK'                 45640068
         DC    X'FF'                                                    45680068
SENSTABL DC    B'10000000',CL18'COMMAND REJECT'                         45720068
         DC    B'01000000',CL18'INTERVENTION REQD'                      45760068
         DC    B'00100000',CL18'BUS OUT CHECK'                          45800068
         DC    B'00010000',CL18'EQUIPMENT CHECK'                        45840068
         DC    B'00001000',CL18'DATA CHECK'                             45880068
         DC    B'00000100',CL18'OVERRUN'                                45920068
         DC    B'00000010',CL18'LOST DATA'                              45960068
         DC    B'00000001',CL18'TIMEOUT'                                46000068
         DC    X'FF'                                                    46040068
STATSTBL DC    B'0010000000000000',CL18'RESERVED'                       46080068
         DC    B'0001000000000000',CL18'RESERVED'                       46120068
         DC    B'0000100000000000',CL18'DEVICE BUSY'                    46160068
         DC    B'0000010000000000',CL18'UNIT SPECIFY'                   46200068
         DC    B'0000001000000000',CL18'DEVICE END'                     46240068
         DC    B'0000000100000000',CL18'TRANSMISSION CHECK'             46280068
         DC    B'0000000000100000',CL18'COMMAND REJECT'                 46320068
         DC    B'0000000000010000',CL18'INTERVENTION REQD'              46360068
         DC    B'0000000000001000',CL18'EQUIPMENT CHECK'                46400068
         DC    B'0000000000000100',CL18'DATA CHECK'                     46440068
         DC    B'0000000000000010',CL18'CONTROL CHECK'                  46480068
         DC    B'0000000000000001',CL18'OPERATION CHECK'                46520068
         DC    X'FF'                                                    46560068
SENS3272 DC B'10000000',CL18'COMMAND REJECT'                            46600068
         DC B'01000000',CL18'INTERVENTION REQD'                         46640068
         DC B'00100000',CL18'BUS OUT CHECK'                             46680068
         DC B'00010000',CL18'EQUIPMENT CHECK'                           46720068
         DC B'00001000',CL18'DATA CHECK'                                46760068
         DC B'00000100',CL18'UNIT SPECIFY'                              46800068
         DC B'00000010',CL18'CONTROL CHECK'                             46840068
         DC B'00000001',CL18'OPERATION CHECK'                           46880068
         DC    X'FF'                                                    46920068
CCW3272  DC    CL20'01WRITE'                                            46960068
         DC    CL20'05ERASE WRITE'                                      47000068
         DC    CL20'02READ BUFFER'                                      47040068
         DC    CL20'06READ MODIFIED'                                    47080068
         DC    CL20'0BSELECT'                                           47120068
         DC    CL20'0FERASE ALL PROTECTD'                               47160068
         DC    CL20'03NO OP'                                            47200068
         DC    CL20'04SENSE'                                            47240068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           47280068
PATCH    DS    20F                                             @OX21950 47300007
TCAMTPOP DC    CL20'01WRT EOT FOR SELECT'                               47320068
         DC    CL20'02OPEN TP OP CODE'                                  47360068
         DC    CL20'03WRITE POLL CHARS'                                 47400068
         DC    CL20'04RD RSPNS TO POLL'                                 47440068
         DC    CL20'05WRITE PAD CHARS'                                  47480068
         DC    CL20'06ENABLE DIAL LINE'                                 47520068
         DC    CL20'07WRT ADDR SEQUENCE'                                47560068
         DC    CL20'08READ RSPNS TO ADDR'                               47600068
         DC    CL20'09WRITE EOA SEQUENCE'                               47640068
         DC    CL20'0ARD RSPNS EOB/ETB'                                 47680068
         DC    CL20'0BWRITE CPU ID'                                     47720068
         DC    CL20'0CREAD ENQ'                                         47760068
         DC    CL20'0DWRITE ENQ'                                        47800068
         DC    CL20'0ERD RSPNS TO ENQ'                                  47840068
         DC    CL20'0FWRITE DLE EOT'                                    47880068
         DC    CL20'10READ ID (TSO)'                                    47920068
         DC    CL20'11NON-R/W CCW'                                      47960068
         DC    CL20'12WRITE BREAK (TSO)'                                48000068
         DC    CL20'13WRT ENQ AFTER SEL'                                48040068
         DC    CL20'14READ LCOUT'                                       48080068
         DC    CL20'15WRT RSP BEFOR TXT'                                48120068
         DC    CL20'16WRITE RESPONSE'                                   48160068
         DC    CL20'17WRITE TONE'                                       48200068
         DC    CL20'18BSC READ ID ENQ'                                  48240068
         DC    CL20'1ABSC READ ID ACK'                                  48280068
         DC    CL20'1CABORT SEND/RECIEV'                                48320068
         DC    CL20'1EREAD TWX ID'                                      48360068
         DC    CL20'20BUF TRM RESET BLK'                                48400068
         DC    CL20'22CLOSE SDR RECRDNG'                                48440068
         DC    CL20'24WRT RESET AFT SEL'                                48480068
         DC    CL20'51READ SKIP LOOP'                                   48520068
         DC    CL20'53WRT IDLES LOOP'                                   48560068
         DC    CL20'57WRT DLE STX'                                      48600068
         DC    CL20'59WRT DLE ETB(ETX)'                                 48640068
         DC    CL20'5BWRT ENQ RSP TO TXT'                               48680068
         DC    CL20'FFTEXT CCW'                                         48720068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           48760068
         END   BNGC3270                                                 48800068
