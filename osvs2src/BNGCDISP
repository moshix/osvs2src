         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGCDISP                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME = CICS DEMF DISPLAY CONTROL MODULE                 * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) RECEIVES CONTROL FROM CICS;                           * 00550000
*            2) EDITS THE INPUT INTO 6 PARM FIELDS WITH LEFT JUSTIFY; * 00600000
*            3) DOES SYNTAX CHECK ON DEMF COMMANDS AND PARAMETERS;    * 00650000
*            4) DETERMINES WHETHER THE REQUEST IS FOR MENU,REMOTE,    * 00700000
*               LOCAL OR 3270 SCREEN ERROR DISPLAY AND PASSES CONTROL * 00750000
*               TO BNGTMENU,BNGTRMOT,BNGTLOCL OR BNGT3270 SEGMENT     * 00800000
*               ACCORDINGLY WITH PARAMETERS;                          * 00850000
*            5) HANDLES ALL,LINE AND CTRL ERROR DISPLAY REQUEST AND   * 00900000
*               WRITES ITS ERROR INFORMATION TO THE 3270 DISPLAY      * 00950000
*               TERMINAL AND ISSUES SOME OF THE DISPLAY MESSAGES;     * 01000000
*            6) ACCESSES SYS1.DEMFLOG DATA FILE FOR ALL,LINE AND CTRL * 01050000
*               ERROR DISPLAY REQUEST;                                * 01100000
*            7) RETURNS CONTROL TO CICS.                              * 01150000
*                                                                     * 01200000
* NOTES = NONE                                                        * 01250000
*                                                                     * 01300000
*    DEPENDENCIES =                                                   * 01350000
*                                                                     * 01400000
*    THE FOLLOWING ARE CICS TABLES/CONTROL BLOCKS AND THEIR LABELS    * 01450000
*    USED BY DEMF CICS MODULES (BNGCDISP,BNGC3270,BNGCLOCL,BNGCRMOT   * 01500000
*    BNGCMENU) :                                                      * 01550000
*                                                                     * 01600000
*    CICS TABLE AND                                                   * 01650000
*    CONTROL BLOCKS                  LABELS USED                      * 01700000
*    ----------------------          -----------                      * 01750000
*                                                                     * 01800000
*    COMMON SYSTEM AREA              CSATCTBA                         * 01850000
*    (CSA)                                                            * 01900000
*                                                                     * 01950000
*    TERMINAL CONTROL TABLE          TCTTEDA                          * 02000000
*    TERMINAL ENTRY (TCTTE)          TCTTETM                          * 02050000
*                                    TCTTELT                          * 02100000
*                                    TCTTETI                          * 02150000
*                                    TCTTECLT                         * 02200000
*                                    TCTTETEL                         * 02250000
*                                    TCTTETT                          * 02300000
*                                    TCTTEGU                          * 02350000
*                                    TCTTETA                          * 02400000
*                                                                     * 02450000
*    TERMINAL CONTROL TABLE          TCTLELF                          * 02500000
*    LINE ENTRY (TCTLE)              TCTLEFAA                         * 02550000
*                                    TCTLEPI                          * 02600000
*                                    TCTLEMFP                         * 02650000
*                                    TCTLEPA                          * 02700000
*                                    TCTLEDCB                         * 02750000
*                                    TCTLERLN                         * 02800000
*                                                                     * 02850000
*    TERMINAL INPUT/OUTPUT AREA      TIOADBA                          * 02900000
*    (TIOA)                          TIOATDL                          * 02950000
*                                                                     * 03000000
*    TASK CONTROL AREA               TCAFCAAA                         * 03050000
*    (TCA)                           TCAFCAA                          * 03100000
*                                    TCAPCPI                          * 03150000
*                                    TCASCSA                          * 03200000
*                                                                     * 03250000
*    FILE INPUT/OUTPUT AREA          FIOADBA                          * 03300000
*    (FIOA)                                                           * 03350000
*                                                                     * 03400000
*    RESTRICTIONS = NONE                                              * 03450000
*                                                                     * 03500000
*    REGISTER CONVENTIONS = R12 ADDRESS OF TCA                        * 03550000
*                           R13 ADDRESS OF CSA                        * 03600000
*                                                                     * 03650000
*    PATCH LABEL = NONE                                               * 03700000
*    PATCH LABEL = PATCH                                       @OX21950 03720007
*                                                                     * 03750000
* MODULE TYPE =  CICS DISPLAY CONTROL                                 * 03800000
*                                                                     * 03850000
*    PROCESSOR = ASSEMBLER H                                          * 03900000
*                                                                     * 03950000
*    MODULE SIZE = 5632 DECIMAL BYTES                                 * 04000000
*                                                                     * 04050000
*    ATTRIBUTES = QUASI-REENTRANT                                     * 04100000
*                                                                     * 04150000
* ENTRY POINT = BNGCDISP                                              * 04200000
*                                                                     * 04250000
*    PURPOSE = SEE FUNCTION                                           * 04300000
*                                                                     * 04350000
*    LINKAGE = R12 LOADED WITH THE ADDRESS OF TCA                     * 04400000
*              R13 LOADED WITH THE ADDRESS OF CSA                     * 04450000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 04500000
*              R15 LOADED WITH ENTRY POINT                            * 04550000
*                                                                     * 04600000
* INPUT =  INPUT TIOA                                                 * 04650000
*                                                                     * 04700000
* OUTPUT = OUTPUT TIOA                                                * 04750000
*                                                                     * 04800000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 04850000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 04900000
*                                                                     * 04950000
* EXIT-ERROR  = NONE                                                  * 05000000
*                                                                     * 05050000
* EXTERNAL REFERENCE = BNGCLOCL,BNGCRMOT,BNGCMENU AND BNGC3270        * 05100000
*                                                                     * 05150000
*    ROUTINES = LOCATE ROUTINE                                        * 05200000
*               MOD1SCAN ROUTINE                                      * 05250000
*               MOD1 TABLE BUILD (AT LABEL S215) ROUTINE              * 05300000
*                                                                     * 05350000
*    DATA AREAS =  TWA (300 BYTES)                                    * 05400000
*                                                                     * 05450000
*    CONTROL BLOCK = DFHCSADS, DFHTCTTE, DFHTCTLE, DFHTCADS,          * 05500000
*                    DFHTIOA, DFHFIOA                                 * 05550000
*                                                                     * 05600000
* TABLES = TABLE    - FUNCTION/COMPANION TABLE                        * 05650000
*          MOD1TAB  - 3277 MODEL 1 TABLE                              * 05700000
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 05750000
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 05800000
*          LOTOUP   - LOWER TO UPPER CASE CHARS TABLE                 * 05850000
*                                                                     * 05900000
* MACROS = DCBD, DFHFC, DFHSC, DFHTC, DFHPC                           * 05950000
*                                                                     * 06000000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 06050000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 06050107
* CHANGE 02  02/22/78  BNGHJN MACRO ADDED                             * 06050207
*A139000                                                       @OZ29900 06050307
*C521500                                                       @OZ30480 06050407
*A489500                                                       @OZ31882 06050507
*D454000-455000                                                @OZ31878 06050607
*C456500-457000,551500-552000,601000-602000,603500-607000      @OZ31878 06050707
*C608500-611000                                                @OZ31878 06050807
*A412000,654500,684000                                         @OZ31885 06050907
*C037000,360500-361500                                         @OX21950 06051007
*A728500                                                       @OX21950 06051107
*                                                                     * 06150000
*********************************************************************** 06200000
BNGCDISP TITLE 'DISPLAY AUDITS INPUT AND DISPLAYS ALL LINES,LINE, CTRL' 06250000
         PRINT OFF                                                      06300000
         COPY  DFHCSADS                                                 06350000
         COPY  DFHTCTTE                                                 06400000
         COPY  DFHTCTLE                                                 06450000
         COPY  DFHTIOA                                                  06500000
         COPY  DFHTCADS                                                 06550000
         PRINT ON                                                       06600000
PARM1    DS    D                   1ST INPUT PARM - DEMF                06650000
PARM2    DS    D                   2ND INPUT PARM - ALL/LINE/CTRL/      06700000
*                                                    3270               06750000
PARM3    DS    D                   3RD INPUT PARM                       06800000
PARM4    DS    D                   4TH INPUT PARM                       06850000
PARM5    DS    D                   5TH INPUT PARM                       06900000
PARM6    DS    D                   6TH INPUT PARM                       06950000
SBACNT   DS    PL1                 COUNT OF SBA'S IN INPUT              07000000
RELREC   DS    CL3                 BDAM RELATIVE BLOCK ADDRESS          07050000
SVRELREC DS    CL3           SAVE AREA FOR LINE/CTRL RELATIVE BLOCK NO. 07100000
DBLWD    DS    D                   DOUBLEWORD WORK AREA                 07150000
DUBLWD   EQU   DBLWD                                                    07200000
FULLWD   DS    F                   FULLWORD WORK AREA                   07250000
TWALINE  DS    F             SAVE AREA FOR CICS SYMBOLIC LINE POINTER   07300000
*   THE TWA FROM HERE UP MUST REMAIN IN THAT ORDER TO MATCH TWALINE     07350000
*         WITH TWATCTID IN THE 3270 PROGRAM.                            07400000
LINEID   DS    XL6                 HARDWARE LINE ADDRESS                07450000
LINENAME DS    CL8           LINE NAME SAVE AREA FOR RECAP HEADER       07500000
CTRLID   DS    X                   HARDWARE CONTROL UNIT ADDRESS        07550000
CTRLNAME DS    CL8           CTRL/CLUSTER NAME WORK AREA FOR OUTPUT     07600000
TERMNAME DS    CL8                 TERML/LOGICAL UNIT NAME WORK AREA    07650000
CLUSNAME DS    CL8           CTRL/CLUSTER NAME SAVE AREA FOR RECAP HDR. 07700000
NEWPARM  DS    C                   NEW-PARM SWITCH                      07750000
CTRPARM  DS    C                   COUNTER OF CHARS STORED IN PARM(X)   07800000
SAVETIOA DS    F                   SAVE AREA FOR ORIGINAL TIOA          07850000
SAVEBBSS DS    F                   SAVE POINTER TO BLK AND SLOT         07900000
TWASLOT  DS    C                   INPUT SLOT COUNT IN HEX              07950000
WRKSLOT  DS    C                   TWASLOT WORK AREA                    08000000
*                                  DISPLACEMENTS IN TIOA                08050000
SAVERCAP DS    F                   SAVEAREA FOR POINTER TO RECAP LINE   08100000
SAVEITEM DS    F                   SAVEAREA FOR POINTER TO FIRST LINE   08150000
*                                  AND CTRL DISPLAYS                    08200000
SLOTCNT  DS    C                   COUNT OF DETAIL SLOTS READ           08250000
ITEMCNT  DS    PL2                 COUNT OF OUTPUT ITEMS IN LINE        08300000
WORKCNT  DS    PL2                 ITEM WORK COUNTER                    08350000
WORK15   DS    CL15                                                     08400000
QUITSW   DS    C             USED TO STOP EDIT OF INPUT ON 3RD SBA      08450000
*                             IF 2ND SBA = L1P7 OR L6P26  ***ALSO*** XH 08500000
*                            USED AS MOD-1 OUTPUT-FULL-SWITCH        XH 08550000
*                               00 = NOT FULL   FF = OUTPUT FULL BUT XH 08600000
*     CONTINUE SCANNING DATA BASE FOR CORRECT ERROR COUNTS           XH 08650000
*********************************************************************** 08700000
MOD1TABL DS    CL64          MAX OF 32 ENTRIES FOR MOD-1 TABLE          08750000
*                              LOCAL TERM = 2-BYTES                     08800000
*                              REMOTE CU AND TERM = 2-BYTES             08850000
TBRELREC DS    CL3           SAVE AREA FOR PAGING 'BBB'                 08900000
TBSLOT   DS    C             SAVE AREA FOR PAGING 'SS'                  08950000
TBCTRL   DS    C             SAVE AREA FOR MDR CTRL UNIT                09000000
TBLINE   DS    CL6           SAVE AREA FOR LINE ADDR OF PAGE            09050000
TBARG    DS    CL2           SAVE AREA FOR TABLE ARGUMENT               09100000
TABLECNT DS    PL2           COUNT OF ENTRIES IN TABLE                  09150000
WKTBLCNT DS    PL2           WORK AREA FOR COUNT OF TABLE ENTRIES       09200000
MOD1SW   DS    X             00 = SWT OFF    FF = SWT ON                09250000
*                            IF ON, PERFORM MOD1 TABLE SCAN             09300000
SOUTLOOP DS    F             SAVE AREA FOR OUTLOOP REGISTER             09350000
*********************************************************************** 09400000
         COPY  DFHFIOA                                                  09450000
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            09500000
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              09550000
CTRLBACK DS    F                   BACKWARD PTR IN CTRL BLK CHAIN       09600000
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        09650000
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         09700000
         DS    CL15                FOR FUTURE USE                       09750000
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          09800000
         ORG   FIOADBA                                                  09850000
DATAPORT DS    CL6                 PORT & LIB ADDR                      09900000
DATATIME DS    CL4                 TIME BLOCK CREATED                   09950000
DATADATE DS    CL4                 DATE BLOCK CREATED                   10000000
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   10050000
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   10100000
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         10150000
         DS    CL10                                                     10200000
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               10250000
SLOTS    DSECT           MAP OF ENTRIES IN CONTROL BLOCK                10300000
         USING SLOTS,DATAREG                                            10350000
SLOTLINE DS    CL6                CHANNEL ADDRESS(PORT OR LIB)          10400000
SLOTNBC  DS    CL2                NUMBER OF BLOCKS IN THIS CHAIN        10450000
SLOTHITS DS    CL2                TOTAL HITS ON THIS LINE               10500000
SLOTRFB  DS    CL3                RELATIVE ADDRESS FIRST BLOCK IN CHAIN 10550000
SLOTRLB  DS    CL3                RELATIVE ADDRESS LAST BLOCK IN CHAIN  10600000
SLOTLTH  EQU   *-SLOTS                                                  10650000
         ORG   SLOTS         MAP OF MDR AND OBR IN DETAIL BLOCKS        10700000
DATALTH  DS    C                   LTH OF THIS SLOT                     10750000
LINEIDA  DS    CL6                 LINE AND LIB ADDR                    10800000
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              10850000
         DS    CL3                                                      10900000
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           10950000
         DS    CL3                                                      11000000
DATE     DS    CL4                 DATE OF ERROR - 00YY0DDF             11050000
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             11100000
         DS    CL8                                                      11150000
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 11200000
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              11250000
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 11300000
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   11350000
         DS    CL2                                                      11400000
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    11450000
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  11500000
         DS    CL6                                                      11550000
OBRUCB   DS    C                                                        11600000
         DS    CL3                                                      11650000
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 11700000
OBRCTRL  DS    C                                                        11750000
OBRTERM  DS    C                                                        11800000
         DS    CL12                                                     11850000
OBRSENSE DS    CL2                 OBR SENSE BYTES                      11900000
*********************************************************************** 11950000
BNGCDISP CSECT                                                          12000000
SBA      EQU   X'11'         SET BUFFER ADDRESS                         12050000
SF       EQU   X'1D'         START FIELD                                12100000
IC       EQU   X'13'         INSERT CURSOR                              12150000
UNA      EQU   X'40'         UNPROTECTED,NORMAL INTENSITY, ALPHAMERIC   12200000
PNA      EQU   X'60'         PROTECTED, NORMAL INTENSITY, ALPHAMERIC    12250000
PHA      EQU   X'E8'             PROTECTED, HIGH INTENSITY, ALPHAMERIC  12300000
MNP      EQU   X'61'             PROT,MODIFIED,NORMAL                   12350000
PIA      EQU   X'6D'             PROTECTED,MODIFIED,INVISIBLE,ALPHA     12400000
L1P1     EQU   X'4040'       LINE 1, POSITION 1  BUFFER ADDRESS.        12450000
L1P7     EQU   X'40C6'       LINE 1, POSITION 7  BUFFER ADDRESS.        12500000
L1P36    EQU   X'40E3'       LINE 1, POSITION 36 BUFFER ADDRESS.        12550000
L2P1     EQU   X'C150'       LINE 2, POSITION 1  BUFFER ADDRESS.        12600000
L2P4     EQU   X'C1D3'       PAGE FWD  BUFFER ADDR FOR 3277-2           12650000
L2P44    EQU   X'C17B'       PAGE BKWD BUFFER ADDR FOR 3277-2           12700000
L3P1     EQU   X'C260'       LINE 3, POSITION 1 BUFFER ADDRESS.         12750000
L3P4     EQU   X'C1D3'       LINE 3, POSITION 4 BUFFER ADDRESS.         12800000
L4P1     EQU   X'C3F0'       LINE 4, POSITION 1  BUFFER ADDRESS.        12850000
L4P4     EQU   X'C17B'       PAGE BKWD BUFFER ADDR FOR 3277-1           12900000
L6P26    EQU   X'C6E9'       LINE 6, POSITION 26 BUFFER ADDRESS.        12950000
TCTTEAR  EQU   2             POINTS TO TCTTE                            13000000
BASE1    EQU   3             BASE REGISTER ONE = 0-4095                 13050000
BASE2    EQU   4             BASE REGISTER TWO = 4096-8191              13100000
TIOABAR  EQU   5             POINTS TO TIOA                             13150000
FIOABAR  EQU   6             POINTS TO FIOA                             13200000
PARMREG  EQU   6             POINTS TO PARM AREA                        13250000
OUTREG   EQU   7             POINTS TO DATA IN TIOA AREA                13300000
OUTLOOP  EQU   8             USED FOR LOOPING THRU DATA IN TIOA AREA    13350000
MOD1REG  EQU   8             POINTS TO MOD-1 TABLE (MOD1TABL)           13400000
DATAREG  EQU   9             POINTS TO DATA IN FIOA AREA                13450000
DATALOOP EQU   10            USED FOR LOOPING THRU DATA IN FIOA AREA    13500000
TABLEREG EQU   11            POINTS TO FUNCTION/COMPANION TABLE         13550000
R11      EQU   11            PARMLIST COUNTER WORK REGISTER FOR CTRPARM 13600000
LINKREG  EQU   11            SUBROUTINE LINKAGE                         13650000
R14      EQU   14                                                       13700000
R15      EQU   15                                                       13750000
*********************************************************************** 13800000
         BALR  BASE1,0                                                  13850000
         USING *,BASE1,BASE2                                            13900000
BNGCDISP BNGHJN GO                                             @OZ29900 13920007
         LA    BASE2,2048(BASE1)                                        13950000
         LA    BASE2,2048(BASE2)                                        14000000
         L     TCTTEAR,TCAFCAAA                                         14050000
         LA    TCTTEAR,0(TCTTEAR)                                       14100000
         L     TIOABAR,TCTTEDA                                          14150000
         ZAP   SBACNT,=P'0'        SET SBA COUNTER TO ZERO.             14200000
         TR    TIOADBA(80),LOTOUP  TRANSLATE LOWER CASE TO UPPER CASE.  14250000
         LA    DATAREG,TIOADBA     POINT TO 1ST BYTE IN TIOA.           14300000
         LR    DATALOOP,DATAREG    SETUP DATA LOOP                      14350000
         AH    DATALOOP,TIOATDL                                         14400000
         XC    PARM1(48),PARM1     ZERO OUT PARM FIELDS                 14450000
         LA    PARMREG,PARM1       POINT TO PARMS.                      14500000
         LR    14,PARMREG                                               14550000
         MVI   QUITSW,X'00'        SET QUITSW OFF.                      14600000
         MVI   NEWPARM,C'1'        TURN ON 'NEW PARM' SWITCH.           14650000
         MVI   CTRPARM,X'00'       SET CHARS COUNTER IN PARM = ZERO     14700000
A160     CLI   0(DATAREG),SBA      IS THIS BYTE AN SBA?                 14750000
         BNE   A210                NO. CHECK IT FURTHER.                14800000
         CLI   QUITSW,X'FF'            QUIT SWITCH ON?                  14850000
         BE    C10                          YES.  QUIT EDIT.            14900000
         CLC   1(2,DATAREG),=AL2(L1P7)  IS 2ND SBA = LINE 1 POSN 7?     14950000
         BE    A170                              NO. CONTINUE EDIT      15000000
         CLC   1(2,DATAREG),=AL2(L6P26) IS 2ND SBA = LINE 6 POSN 26?    15050000
         BNE   A180                              NO. CONTINUE EDIT      15100000
A170     MVI   QUITSW,X'FF'            TURN QUIT SWITCH ON              15150000
A180     AP    SBACNT,=P'1'        YES. ADD TO TO SBA COUNTER.          15200000
         LA    DATAREG,2(DATAREG)  BUMP TIOA POINTER BY 2.              15250000
         B     B80                                                      15300000
A210     CLI   0(DATAREG),C'A'     IS IT AN 'A' OR HIGHER?              15350000
         BL    B80                 NO. CHECK NEW PARM SWITCH.           15400000
         CLI   NEWPARM,C'1'        IS FIRST CHAR FOR PARM(X)?           15450000
         BNE   B10                 NO.                                  15500000
         MVI   NEWPARM,C'0'        YES. SET FIRST CHAR IN FOR PARM      15550000
         MVI   CTRPARM,X'00'       SET PARM CHAR CTR = 0                15600000
B10      IC    R11,CTRPARM         LOAD R11 = CTRPARM                   15650000
         LA    R11,1(R11)          ADD CTRPARM = CTRPARM + 1            15700000
         STC   R11,CTRPARM         STORE NEW CTR BACK CTRPARM           15750000
         CLI   CTRPARM,X'08'       IS CHAR COUNT IN PARM OVER 8 ?       15800000
         BH    B50                 YES. GO BACK LOOP WITHOUT STORING    15850000
         MVC   0(1,14),0(DATAREG)  PUT THIS BYTE IN THIS PARM           15900000
         CLI   PARM6+7,X'00'       ARE ALL PARMS USED UP?               15950000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    16000000
         LA    14,1(14)            BUMP PARM POINTER WORKREG.           16050000
B40      LA    DATAREG,1(DATAREG)  BUMP TIOA POINTER.                   16100000
         CR    DATAREG,DATALOOP    IS THERE MORE DATA IN TIOA?          16150000
         BL    A160                YES. GO PROCESS MORE DATA.           16200000
         B     C10                 NO. GOTO SYNTAX CHECKING ROUTINE     16250000
B50      CLC   PARM2(5),=X'F3F2F7F000'  IS THIS A 3270 SCREEN INPUT ?   16300000
         BNE   B40                      NO.                             16350000
         CP    SBACNT,=P'2'        IS THIS NON-FORMATTED INPUT ?        16400000
         BH    B40                 NO.                                  16450000
         B     Z40                 YES. SEND INVALID FORMAT MSG.        16500000
B80      CLI   NEWPARM,C'1'        IS NEW-PARM SWITCH ON?               16550000
         BE    B40                 YES. CHECK FOR MORE DATA.            16600000
         CLI   PARM6,X'00'         NO. ARE ALL PARMS USED UP?           16650000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    16700000
         LA    PARMREG,8(PARMREG)  NO. BUMP TO NEXT NEW PARM.           16750000
         LR    14,PARMREG          POINT WORK REG TO NEXT PARM.         16800000
         MVI   NEWPARM,C'1'        TURN ON NEW-PARM SWICH.              16850000
         B     B40                 GO CHECK FOR MORE DATA.              16900000
*********************************************************************** 16950000
*                                                                     * 17000000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 17050000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 17100000
*                                                                     * 17150000
*********************************************************************** 17200000
         EJECT                                                          17250000
*********************************************************************** 17300000
*                                                                     * 17350000
*        SYNTAX CHECKING ROUTINE                                      * 17400000
*                                                                     * 17450000
*********************************************************************** 17500000
C10      CLI   QUITSW,X'FF'            IS SBA QUIT SWT ON ?             17550000
         BE    C15                     YES. DATA ENTERED FROM 29 AREA   17600000
         CP    SBACNT,=P'1'            NO. IS SBACNT > 1 ?              17650000
         BH    CC10                    YES. BYPASS SYNTAX CHECK         17700000
         CLI   PARM2,X'00'             IS PARM2 BLANK ?                 17750000
         BE    D80                     YES. GOTO BNGCMENU               17800000
C15      CLC   PARM2(5),=X'D4C5D5E400' IS PARM2=MENU ?                  17850000
         BNE   C20                     NO                               17900000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  17950000
         BE    D80                     YES. GOTO BNGCMENU               18000000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18050000
C20      CLC   PARM2(4),=X'C1D3D300'   IS PARM2 = ALL ?                 18100000
         BNE   C30                     NO                               18150000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  18200000
         BE    CC10                    YES.GO SCHEDULE APPROPRIATE PGM  18250000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18300000
C30      CLC   PARM2(6),=X'D3D6C3C1D300'  IS PARM2 = LOCAL ?            18350000
         BNE   C40                        NO                            18400000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  18450000
         BE    CC10                   YES.GO SCHEDULE APPROPRIATE PGM   18500000
         CLC   PARM3+1(2),=C'SS'       IS LOCAL/REMOTE SCREEN ?         18550000
         BE    CC10                   YES.                              18600000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18650000
C40      CLC   PARM2(6),=X'D9C5D4D6E3C5' IS PARM2 = REMOTE ?            18700000
         BNE   C50                     NO.                              18750000
         CLC   PARM2+7(1),=C'S'        IS REMOTE SCREEN ?               18800000
         BE    C45                     YES.                             18850000
         CLI   PARM2+6,X'00'           IS REMOTE SYNTAX ERROR ?         18900000
         BNE   Z40                     YES. GO ISSUE INVALID FORMAT MSG 18950000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  19000000
         BE    CC10                   YES.GO SCHEDULE APPROPRIATE PGM   19050000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  19100000
C45      CLI   PARM3,X'00'             IS REMOTE SCREEN ?               19150000
         BNE   CC10                   YES.                              19200000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  19250000
C50      CLC   PARM2(5),=X'D3C9D5C500' IS PARM2 = LINE ?                19300000
         BNE   C60                     NO                               19350000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  19400000
         BNE   Z40                     NO. GO ISSUE INVALID FORMAT MSG  19450000
C55      CLI   PARM3+3,X'00'           LINE ADDR = 4 OR MORE ?          19500000
         BNE   Z40                     YES.                             19550000
         CLI   PARM3+2,X'00'           LINE ADDR = 2 OR LESS ?          19600000
         BE    Z40                     YES.                             19650000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             19700000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          19750000
C57      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         19800000
         BNL   C59                     YES. IT IS NUMERIC               19850000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          19900000
         BH    Z40                     YES. IT IS INVALID FORMAT        19950000
C59      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       20000000
         BCT   DATALOOP,C57            LOOP                             20050000
         B     CC10                    NO. GO SCHEDULE APPROPRIATE PGM  20100000
C60      CLC   PARM2(5),=X'C3E3D9D300' IS PARM2 = CTRL ?                20150000
         BNE   C70                     NO                               20200000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  20250000
         BNE   Z40                     NO.                              20300000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  20350000
         BE    C55                     YES.                             20400000
C65      CLI   PARM4+2,X'00'           CTRL ADDR = 3 OR MORE ?          20450000
         BNE   Z40                     YES.                             20500000
         CLI   PARM4+1,X'00'           CTRL ADDR = 1 OR LESS ?          20550000
         BE    Z40                     YES.                             20600000
C66      LA    DATALOOP,2              SET FOR SCAN 2 CHARS             20650000
         LA    DATAREG,PARM4           SET DATAREG = PARM4 PTR          20700000
C67      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         20750000
         BNL   C69                     YES. IT IS NUMERIC               20800000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          20850000
         BH    Z40                     YES. IT IS INVALID FORMAT        20900000
C69      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       20950000
         BCT   DATALOOP,C67            LOOP                             21000000
         B     C55                     NO. GO CHECK LINE ADDR (PARM3)   21050000
C70      CLC   PARM2(5),=X'F3F2F7F000' IS PARM2 = 3270 ?                21100000
         BNE   Z40                     NO.                              21150000
         CLI   PARM6,X'00'             IS PARM6 = 00 ?                  21200000
         BNE   Z40                     NO.                              21250000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  21300000
         BE    C75                     YES.                             21350000
         CLI   PARM5+2,X'00'           IS TERMINAL ADDR = 3 OR MORE ?   21400000
         BNE   Z40                     YES.                             21450000
         CLI   PARM5+1,X'00'           IS TERMINAL ADDR = 1 OR LESS ?   21500000
         BE    Z40                     YES.                             21550000
         LA    DATALOOP,2              SET FOR SCAN 2 CHARS             21600000
         LA    DATAREG,PARM5           SET DATAREG = PARM5 PTR          21650000
C72      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         21700000
         BNL   C74                     YES. IT IS NUMERIC               21750000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          21800000
         BH    Z40                     YES. IT IS INVALID FORMAT        21850000
C74      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       21900000
         BCT   DATALOOP,C72            LOOP                             21950000
         B     C65                     NO. GO CHK LINE AND CTRL         22000000
C75      CLI   PARM4,X'00'             IS PARM4 = 00 ?                  22050000
         BNE   Z40                     NO.                              22100000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  22150000
         BE    D10                     YES. BRANCH TO BNGC3270          22200000
*********************************************************************** 22250000
*                                                                     * 22300000
*     THE FOLLOWING CODE CHECKS FOR A CICS SYMBOLIC MATCH             * 22350000
*                                                                     * 22400000
*********************************************************************** 22450000
         MVC   WORK15(8),PARM3         SAVE PARM3                       22500000
         OC    PARM3,=CL8' '           MAKE ZEROS                       22550000
         BAL   LINKREG,CICSLOC         CALL SYMBOLIC NAME CONV. RTN     22600000
         CLI   PARM3+7,X'00'           IS NAME CONVERTED ?              22650000
         BE    D10                     YES. BYPASS SYNTAX CHK           22700000
         MVC   PARM3,WORK15            NO. RESTO PARM3-CONT. SYNTAX CHK 22750000
*        ******************            **************************       22800000
         CLI   PARM3+3,X'00'           IS TERM/LINE = 4 OR MORE ?       22850000
         BNE   Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   22900000
         CLI   PARM3+2,X'00'           IS TERM/LINE = 2 OR LESS ?       22950000
         BE    Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   23000000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             23050000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          23100000
C77      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         23150000
         BNL   C79                     YES. IT IS NUMERIC               23200000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          23250000
         BH    Z70                     YES. IT IS SYMBOLIC ERROR        23300000
C79      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       23350000
         BCT   DATALOOP,C77            LOOP                             23400000
*********************************************************************** 23450000
*                                                                     * 23500000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 23550000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 23600000
*                                                                     * 23650000
*********************************************************************** 23700000
CC10     CP    SBACNT,=P'3'        CNT OF SBA LESS THAN THREE           23750000
         BL    D10                 YES,THIS IS INIT ENTRY               23800000
*********************************************************************** 23850000
*                                                                     * 23900000
*        ENTRY IS FROM A FORMATTED SCREEN. THEREFORE,                 * 23950000
*        THIS SECTION TRANSFERS CONTROL TO APPROPRIATE                * 24000000
*        COMPANION PROGRAM.                                           * 24050000
*                                                                     * 24100000
*********************************************************************** 24150000
         CLC   PARM2(4),=C'MENU'   IS THIS MENU SCREEN ?                24200000
         BE    D32                 YES. GO CHECK MENU PARAMETERS        24250000
         CLI   TIOADBA+35,C'%'     IS THIS FROM BITS PROMPTER SCR ?  XH 24300000
         BE    C190                YES. GOTO BNGC3270                XH 24350000
         CLI   PARM4,X'00'         IS PARM4 BLANK ?                     24400000
         BE    D80                 YES. USER DID NOT X ANY ENTRIES      24450000
         CLC   TIOADBA+15(2),=X'C1D3'   IS THIS A PAGE FORWARD-LG       24500000
*                                       OR A PAGE BACKWARD-SM?          24550000
         BNE   CC40                YES.                              BB 24600000
         CLI   TCTTETM,X'F1'       IS THIS A 3277-1?                 BB 24650000
         BE    CC60                YES. DO PAGE BACKWARD-SM.         BB 24700000
         B     CC50                NO. DO PAGE FORWARD-LG.           BB 24750000
CC40     CLC   TIOADBA+15(2),=X'C17B'   IS THIS A PAGE BACKWRD-LG?   BB 24800000
         BE    CC60                YES.                              BB 24850000
         CLC   TIOADBA+15(2),=X'406B'   IS THIS A PAGE FORWARD-SM?   BB 24900000
         BNE   C109                NO. MUST BE BLOWUP REQUEST        BB 24950000
CC50     MVC   PARM4(4),=C'PAGE'    SET UP PARMS FOR PAGING          BB 25000000
         MVC   PARM5(7),=C'FORWARD'     FORWARD.                     BB 25050000
         B     D10                  GO TO APPROPRIATE PGM.           BB 25100000
CC60     MVC   PARM4(4),=C'PAGE'    SET UP PARMS FOR PAGING          BB 25150000
         MVC   PARM5(7),=C'BACKWRD'     BACKWARD.                    BB 25200000
         B     D10                  GO TO APPROPRIATE PGM.           BB 25250000
*********************************************************************** 25300000
*                                                                     * 25350000
*     AT THIS POINT, THE REQUEST IS FOR A BLOWUP OF AN ENTRY OF ONE   * 25400000
*     OF THE DISPLAYS. THE FUNCTION/COMPANION TABLE IS SEARCHED FOR   * 25450000
*     THE NAME OF THE PROGRAM TO PERFORM THE NEXT DISPLAY.            * 25500000
*                                                                     * 25550000
*********************************************************************** 25600000
C109     LA    TABLEREG,TABLE      POINT AT FUNCTION/COMPANION TABLE.   25650000
C110     CLC   0(4,TABLEREG),PARM2 PGRM NAME IN TABLE?                  25700000
         BE    C170                YES.                                 25750000
         CLC   0(3,TABLEREG),=C'END'    END OF TABLE?                   25800000
         BE    D30                 YES. GO CK FOR MENU REQUEST          25850000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY.         25900000
         B     C110                GO CH NEXT ENTRY.                    25950000
C170     OC    4(4,TABLEREG),4(TABLEREG) IS THERE A COMPANION PGRM?     26000000
         BZ    D10                       NO.                            26050000
         MVC   PARM2(4),4(TABLEREG)      MOVE COMPANION NAME TO PARM2.  26100000
         CLC   PARM2(4),=C'TERM'   IS THIS A TERML ERROR REQUEST?       26150000
         BNE   D10                 NO.                                  26200000
C190     DFHPC TYPE=XCTL,PROGRAM=BNGC3270                               26250000
*********************************************************************** 26300000
*                                                                     * 26350000
*        THE FOLLOWING CODE CHECKS ALL SINGLE PARM ENTRIES FOR        * 26400000
*        A CICS SYMBOLIC MATCH.                                       * 26450000
*                                                                     * 26500000
*********************************************************************** 26550000
*********************************************************************** 26600000
*                                                                     * 26650000
*        THIS IS THE CICS SYMBOLIC NAME LOCATE/CONVERT ROUTINE.       * 26700000
*                                                                     * 26750000
*********************************************************************** 26800000
CICSLOC  L     14,CSATCTBA         POINT TO TCT PREFIX.                 26850000
         L     14,4(14)            POINT TO BTAM ADCON LIST.            26900000
D0510    CLC   0(4,14),=X'FFFFFFFF'  ANY MORE LINES TO LOOK AT?         26950000
         BE    D0600               NO. LINE NAME NOT IN CICS TCT.--EXIT 27000000
         L     1,0(14)             POINT TO A LINE.                     27050000
         ST    1,TWALINE           STORE ADDR IN CASE THIS IS IT.       27100000
         TM    TCTLELF,TCTLEFAA    IS THIS A POOLED LINE?               27150000
         BZ    D0520               NO.                                  27200000
         TM    TCTLEPI,TCTLEMFP    YES. IS IT 1ST IN POOL?              27250000
         BZ    D0540               NO. SKIP IT - DOESN'T POINT TO DCB.  27300000
D0520    L     15,TCTLEPA          YES. POINT TO 1ST TERML.             27350000
D0530    CLC   PARM3(4),0(15)      IS THIS OUR TERML?                   27400000
         BE    D0550               YES. HAVE LOCATED ITS LINE ENTRY.    27450000
         TM    (TCTTELT-TCTTETI)(15),TCTTECLT  LAST TERML ON LINE?      27500000
         BO    D0540               YES. GO LOOK AT NEXT LINE.           27550000
         AH    15,(TCTTETEL-TCTTETI)(15)  BUMP TO NEXT TERML.           27600000
         B     D0530                                                    27650000
D0540    LA    14,4(14)            BUMP TO NEXT LINE ADDRESS.           27700000
         B     D0510                                                    27750000
D0550    EQU   *                                                        27800000
         LR    TCTTEAR,15                                               27850000
         CLI   TCTTETT,X'91'       IS THIS A 3277 REMOTE?               27900000
         BE    D0560               YES.                                 27950000
         CLI   TCTTETT,X'92'       IS THIS A 3275?                      28000000
         BE    D0560               YES.                                 28050000
         CLI   TCTTETT,X'99'       IS THIS A 3277 LOCAL?                28100000
         BE    D0560               YES.                                 28150000
         B     D0590               NO. CAN'T USE SYMBOLIC NAME--EXIT    28200000
D0560    L     1,TWALINE           POINT TO THIS TERML'S LINE.          28250000
         L     14,TCTLEDCB         POINT TO THE DCB.                    28300000
         USING IHADCB,14                                                28350000
         DCBD                                                           28400000
BNGCDISP CSECT                                                          28450000
         SR    15,15                                                    28500000
         CLI   TCTTETT,X'99'       IS THIS A LOCAL 3270?                28550000
         BE    D0570               YES. GET REL LINE NBR FROM TE.       28600000
         IC    15,TCTLERLN         NO. GET REL LINE NBR FROM LE.        28650000
         B     D0572                                                    28700000
D0570    IC    15,TCTTEGU                                               28750000
D0572    L     1,DCBDEBAD          POINT TO THE DEB.                    28800000
         LA    1,32(1)             POINT TO LIST OF UCBS.               28850000
D0574    BCT   15,D0576                                                 28900000
         B     D0578                                                    28950000
D0576    LA    1,4(1)              BCT TO APPROPRIATE RLN UCB.          29000000
         B     D0574                                                    29050000
D0578    L     1,0(1)              POINT TO THE UCB.                    29100000
         XC    PARM3,PARM3                                              29150000
         MVC   PARM3(3),13(1)      MOVE LINEID TO INPUT PARM FIELD.     29200000
         CLI   TCTTETT,X'99'       IS THIS A LOCAL 3270?                29250000
         BE    D0590               YES. BYPASS LOOKING FOR POLL CHARS.  29300000
         L     14,TCTTETA          POINT TO ADDRESSING LIST.            29350000
         UNPK  DUBLWD,0(2,14)      GET CTRL UNIT ADDRESS.               29400000
         TR    DUBLWD,HXTOEB       CONVERT IT TO 2 EBCDIC CHARS.        29450000
         MVC   PARM4(2),DUBLWD+5   MOVE THEM TO INPUT PARM FIELD.       29500000
         NI    PARM4,X'FD'         CONVERT REMOTE CU TO ACTUAL CU NUM   29550000
         UNPK  DUBLWD,2(2,14)      GET TERML ADDRESS.                   29600000
         TR    DUBLWD,HXTOEB       CONVERT IT TO 2 EBCDIC CHARS.        29650000
         MVC   PARM5(2),DUBLWD+5   MOVE THEM TO INPUT PARM FIELD.       29700000
D0590    EQU   *                                                        29750000
         MVC   TWALINE,TCTTETI     SAVE CICS SYMBOLIC NAME FOR          29800000
*                                  3270 PROGRAM.                        29850000
         L     TCTTEAR,TCAFCAAA    POINT BACK TO ORIGINAL TCT           29900000
         LA    TCTTEAR,0(TCTTEAR)  CLEAR HIGH ORDER BYTE FROM ADDR      29950000
         BR    LINKREG                                                  30000000
D0600    XC    TWALINE,TWALINE                                          30050000
         BR    LINKREG                                                  30100000
*********************************************************************** 30150000
*                                                                     * 30200000
*        THIS SECTION TRANSFERS CONTROL TO APPROPRIATE PROGRAM.       * 30250000
*                                                                     * 30300000
*********************************************************************** 30350000
D10      LA    TABLEREG,TABLE      POINT AT FUNCTION/COMPANION TABLE.   30400000
D20      CLC   0(4,TABLEREG),PARM2 PROGRAM NAME IN TABLE?               30450000
         BE    D25                 YES.                                 30500000
         CLC   0(3,TABLEREG),=C'END' END OF TABLE?                      30550000
         BE    D30                 YES. GO TO CK MENU REQUEST           30600000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY.         30650000
         B     D20                 GO CHECK NEXT ENTRY.                 30700000
D25      CLI   4(TABLEREG),X'00'   IS THERE A PGRM NAME TO XCTL TO?     30750000
         BNE   E10                 NO.                                  30800000
         MVC   TCAPCPI,8(TABLEREG) STORE NAME IN TCA.                   30850000
         DFHPC TYPE=XCTL                                                30900000
D30      CLC   PARM2(4),=C'MENU'                                        30950000
         BNE   D80                 NO.                                  31000000
D32      CLI   TCTTETM,X'F1'       IS THIS A 3277 MODEL 1?              31050000
         BE    D50                 YES.                                 31100000
         CLC   TIOADBA+15(2),=X'4AD6' LARGE MENU 'ALL' = L9P23          31150000
         BE    D40                 YES.                                 31200000
         CLC   TIOADBA+15(2),=X'4BE6' LARGE MENU '3270'= L10P23         31250000
         BE    D41                 YES.                                 31300000
         CLC   TIOADBA+15(2),=X'4CF6' LARGE MENU 'RMOT'= L11P23         31350000
         BE    D42                 YES.                                 31400000
         CLC   TIOADBA+15(2),=X'4FD6' LARGE MENU 'LOCL'= L13P23         31450000
         BNE   D80                 NO. MUST BE FOR MENU.                31500000
D35      DFHPC TYPE=XCTL,PROGRAM=BNGCLOCL YES. GO TO LOCAL PROG.        31550000
D40      MVC   PARM2(3),=C'ALL'    SETUP TO                             31600000
         LA    TABLEREG,TABLE          DO                               31650000
         ZAP   SBACNT,=P'1'        ALL LINES DISPLAY.                   31700000
         B     E10                                                      31750000
D41      XC    PARM2(32),PARM2     CLEAR PARMS FOR TRANSFER             31800000
         MVC   PARM2(4),=C'3270'   SETUP TO DO                          31850000
         ZAP   SBACNT,=P'1'        3270  DISPLAY.                       31900000
         DFHPC TYPE=XCTL,PROGRAM=BNGC3270                               31950000
D42      DFHPC TYPE=XCTL,PROGRAM=BNGCRMOT                               32000000
D50      CLC   TIOADBA+15(2),=X'C17A' SMALL MENU 'ALL' = L4P3           32050000
         BE    D40                 YES.                                 32100000
         CLC   TIOADBA+15(2),=X'C2E2' SMALL MENU '3270'= L5P3           32150000
         BE    D41                 YES.                                 32200000
         CLC   TIOADBA+15(2),=X'C34A' SMALL MENU 'RMOT'= L6P3           32250000
         BE    D42                 YES.                                 32300000
         CLC   TIOADBA+15(2),=X'C45A' SMALL MENU 'LOCL'= L8P3           32350000
         BE    D35                 YES.                                 32400000
D80      DFHPC TYPE=XCTL,PROGRAM=BNGCMENU                               32450000
*********************************************************************** 32500000
*                                                                     * 32550000
*        AT THIS POINT IT HAS BEEN DETERMINED THAT THE REQUEST IS FOR * 32600000
*        ALL LINES, LINE, OR CTRL. THIS MODULE HANDLES THOSE DISPLAYS.* 32650000
*                                                                     * 32700000
*********************************************************************** 32750000
         EJECT                                                          32800000
*********************************************************************** 32850000
*                                                                     * 32900000
*        THIS SECTION CREATES THE COMMON HEADER FOR                   * 32950000
*        ALL LINES, ONE LINE, AND CTRL.                               * 33000000
*                                                                     * 33050000
*********************************************************************** 33100000
E10      MVC   SAVETIOA,TCTTEDA    SAVE ORIGINAL TIOA ADDRESS.          33150000
*                                  GET TIOA BIG ENOUGH FOR OUTPUT       33200000
         DFHSC TYPE=GETMAIN,CLASS=TERM,NUMBYTE=2048,INITIMG=00          33250000
         L     TIOABAR,TCASCSA     POINT TO NEW TIOA                    33300000
         ST    TIOABAR,TCTTEDA     POINT TO NEW TIOA                    33350000
         LA    OUTREG,TIOADBA      POINT TO START OF OUTPUT DATA AREA   33400000
         MVC   0(HDR1LTH,OUTREG),HDR1        MOVE STANDARD FIRST LINE.  33450000
         MVC   HDR1LTH(4,OUTREG),0(TABLEREG) MOVE NAME OF THIS          33500000
*                                            DISPLAY TO TIOA.           33550000
         OC    HDR1LTH(4,OUTREG),=CL4' '     CHANGE ALL'00' TO ALL' '   33600000
         LA    OUTREG,HDR1LTH+4(OUTREG)      UPDATE DATA POINTER.       33650000
         CLI   TCTTETM,X'F1'       IS THIS A 3277 MODEL 1?              33700000
         BE    E150                YES.                                 33750000
         MVC   0(3,OUTREG),HDR1X   MOVE SBA L2P1 FOR MOD 2.             33800000
         LA    OUTREG,3(OUTREG)                                         33850000
E150     MVC   0(HDR2LTH,OUTREG),HDR2   MOVE PAGE-FOWARD HEADER TO TIOA 33900000
         MVC   HDR2LTH(HDR3LTH,OUTREG),HDR3  MOVE PAGE-BACK HEADER      33950000
         LA    OUTREG,HDR2LTH+HDR3LTH-15(OUTREG)                        34000000
         ST    OUTREG,SAVEBBSS     SAVE POINTER TO BBBSS IN TIOA        34050000
         LA    OUTREG,15(OUTREG)                                        34100000
         ST    OUTREG,SAVERCAP     SAVE POINTER TO RECAP LINE           34150000
         MVC   0(41,OUTREG),16(TABLEREG)  MOVE RECAP HEADER TO TIOA     34200000
         LA    OUTREG,41(OUTREG)                                        34250000
         CLI   TCTTETM,C'1'        IS THIS A MODEL 1?                   34300000
         BE    F30                 YES.                                 34350000
         MVC   0(3,OUTREG),HDR3X   MOVE SBA L4P1 FOR MOD 2.             34400000
         LA    OUTREG,3(OUTREG)                                         34450000
F30      MVC   0(41,OUTREG),57(TABLEREG)  MOVE COLUMN HEADER TO TIOA.   34500000
         LA    OUTREG,41(OUTREG)                                        34550000
         ST    OUTREG,SAVEITEM     SAVE POINTER TO FIRST LINE ITEM      34600000
         CLI   TCTTETM,X'F1'       IS THIS A MODEL 1?                   34650000
         BE    F130                YES.                                 34700000
         MVC   0(41,OUTREG),57(TABLEREG)  MOVE COLUMN HEADER AGAIN      34750000
         LA    OUTREG,41(OUTREG)                                        34800000
         ST    OUTREG,SAVEITEM     SAVE POINTER TO FIRST LINE ITEM      34850000
         LA    OUTLOOP,80          SETUP FOR 80 LINE ITEMS FOR MOD 2    34900000
         B     F150                                                     34950000
F130     LA    OUTLOOP,14          SETUP FOR 14 LINE ITEMS FOR MOD 1    35000000
*********************************************************************** 35050000
*                                                                     * 35100000
*        THIS SECTION BUILDS THE APPROPRIATE DISPLAY                  * 35150000
*                                                                     * 35200000
*********************************************************************** 35250000
F150     CP    SBACNT,=P'2'        IS COUNT OF SBA'S LESS THAN 3?       35300000
         BH    R10                 NO. GO TO CONTINUATION SCREEN.       35350000
F180     XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        35400000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=G120,DATASET=EMFILE       35450000
F190     UNPK  DBLWD,TCAFCAA(3)                                      PH 35500000
         MVC   IOERCODE(2),DBLWD+3                                      35550000
         TR    IOERCODE,HXTOEB     MOVE CICS RETURN CODE TO I/O ERR MSG 35600000
         UNPK  DBLWD,RELREC(4)                                          35650000
         MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     35700000
         TR    IOERBLK,HXTOEB                                           35750000
         MVC   TIOATDL(IOERLTH),IOERMSG                                 35800000
F240     B     Z80                                                      35850000
IOERMSG  DC    AL2(IOERLTH-4),X'0000'                                   35900000
         DC   AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)     35950000
         DC    CL34' ',AL1(SF,PNA),CL39' '                              36000000
         DC    CL39'BNG013A C I/O ERR READING SYS1.DEMFLOG '   @OX21950 36050007
         DC    CL28'  THE CICS RESPONSE CODE IS '              @OX21950 36080007
IOERCODE DC    CL4'00  '                                       @OX21950 36110007
         DC    CL9' '                                                   36200000
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS  '                36250000
IOERBLK  DC    CL3'000'                                                 36300000
IOERLTH  EQU   *-IOERMSG                                                36350000
G120     L     FIOABAR,TCAFCAA     POINT TO FIOA AREA.                  36400000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    36450000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           36500000
         SR    DATALOOP,DATALOOP                                        36550000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      36600000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        36650000
         CLC   PARM2(3),=C'ALL'    DOES PARM2 = ALL?                    36700000
         BE    J10                 YES.                                 36750000
         OC    PARM3,PARM3         WAS A LINE ADDRESS ENTERED?          36800000
         BZ    Z40                 NO. WRITE 'NO LINE ENTERED'          36850000
         MVC   LINENAME,PARM3           MOVE LINE ADDRESS TO SAVE AREA  36900000
         MVC   CLUSNAME,PARM4           MOVE CONTROL UNIT NAME TO SAVE  36950000
         MVC   MSG7CTRL,PARM4           MOVE CTRL ADDR TO ERRS MSG AREA 37000000
         OC    MSG7CTRL,=CL8' '                                         37050000
         MVC   NOLINE,PARM3        MOVE LINE ADDRESS TO 'NO ERROR' MSG  37100000
         OC    NOLINE,=CL3' '                                           37150000
         MVC   MSG7LINE,NOLINE     MOVE LINE ADDRESS TO 'NO ERRORS'     37200000
*                                  FOR CONTROL UNIT                     37250000
H40      TR    PARM3(3),EBTOHX     CHANGE F0C6F2 TO 000F02 ETC.         37300000
         PACK  DBLWD,PARM3(4)      PACK   000F02 TO 0000F2 ETC.         37350000
         MVC   LINEID(3),DBLWD+4   MOVE GOOD PORTION TO SAVE AREA       37400000
         MVC   LINEID+3(3),=XL3'000000'                                 37450000
H80      CLC   SLOTLINE,LINEID     IS THIS CONTROL SLOT FOR OUR LINE?   37500000
         BE    L60                 YES. GO GET DETAIL BLOCK.            37550000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           37600000
         BCT   DATALOOP,H80        CHECK NEXT SLOT.                     37650000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 37700000
         BE    Z10                      NO. GO WRITE 'NO LINE ERRORS'   37750000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        37800000
         DFHFC TYPE=RELEASE                                             37850000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=H180,DATASET=EMFILE       37900000
         B     F190                BRANCH IF I/O ERROR.                 37950000
H180     L     FIOABAR,TCAFCAA     POINT TO FIOA                        38000000
         SR    DATALOOP,DATALOOP                                        38050000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                38100000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 38150000
         B     H80                                                      38200000
*********************************************************************** 38250000
*                                                                     * 38300000
*        THIS SECTION FORMATS 'ALL LINE' ENTRIES                      * 38350000
*                                                                     * 38400000
*********************************************************************** 38450000
J10      L     14,SAVEBBSS         LOAD SAVED ADDR OF BLK/SLOT TIOA.    38500000
         MVC   0(5,14),=C'00001'   MOVE 00001 TO FIRST AND              38550000
         MVC   10(5,14),0(14)      PREVIOUS BBBSS'S                     38600000
J40      MVC   PARM1(6),SLOTLINE   SETUP LINE ADDRESS FOR               38650000
J110     UNPK  DBLWD,SLOTLINE(4)   UNPK LINE ADDR IN WORKAREA           38700000
         TR    DBLWD+4(3),HXTOEB   CONVERT TO EBCDIC                    38750000
         MVC   DTLITEM,=CL8' '     CLEAR DETAIL LINE ITEM               38800000
         MVC   DTLITEM(3),DBLWD+4  PUT LINE ADDR IN DETAIL ENTRY        38850000
J150     LH    14,SLOTHITS         PUT LINE ERRORS IN REG.              38900000
         CVD   14,DBLWD            CONVERT TO DECIMAL                   38950000
         UNPK  DTLCOUNT,DBLWD+5(3) PUT LINE ERROR COUNT                 39000000
         OI    DTLCOUNT+3,X'F0'    IN OUTPUT                            39050000
         MVC   0(DTLLTH,OUTREG),DTLENTRY MOVE DETAIL ENTRY TO OUTPUT    39100000
         MVC   DTLCOUNT,=C'0001'   RESTORE PROGRAM CONSTANT.            39150000
         LA    OUTREG,DTLLTH(OUTREG) UPDATE OUTPUT POINTER              39200000
         BCT   DATALOOP,K100       MORE SLOTS IN THIS CTRL BLK?         39250000
         CLC   CTRLFWD,=F'0'       NO. MORE CTRL BLKS?                  39300000
         BE    K120                NO. PREPARE TO EXIT.                 39350000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        39400000
         DFHFC TYPE=RELEASE                                             39450000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=K50,DATASET=EMFILE        39500000
         B     F190                I/O ERROR                            39550000
K50      L     FIOABAR,TCAFCAA     POINT TO FIOA                        39600000
         SR    DATALOOP,DATALOOP                                        39650000
         IC    DATALOOP,CTRLENTS   SET LOOP CONTROL.                    39700000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT                  39750000
         B     J40                                                      39800000
K100     LA    DATAREG,SLOTLTH(DATAREG) POINT TO NEXT SLOT.             39850000
         BCT   OUTLOOP,J40         ROOM LEFT IN TIOA?                   39900000
K120     L     15,SAVEBBSS         NO. POINT TO BLK/SLT AREA IN TIOA.   39950000
         UNPK  DBLWD,RELREC(4)     STORE BDAM RELATIVE                  40000000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   40050000
         MVC   5(3,15),DBLWD+4     (LAST BBBSS) IN OUTPUT               40100000
         SR    14,14                                                    40150000
         IC    14,CTRLENTS         GET ORIGINAL COUNT OF SLOTS          40200000
         SR    14,DATALOOP         DETERMINE LAST SLOT READ.            40250000
         STC   14,DBLWD+6          STORE                                40300000
         UNPK  DBLWD(3),DBLWD+6(2) SLOT NUMBER                          40350000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         40400000
         MVC   8(2,15),DBLWD       IN OUTPUT.                           40450000
K230     LA    14,TIOADBA          COMPUTE LENGTH OF                    40500000
         SR    OUTREG,14           DATA IN TIOA.                        40550000
         STH   OUTREG,TIOATDL      STORE LENGTH IN TIOA                 40600000
         DFHTC TYPE=(WRITE,ERASE)  ALL DONE. SEND DISPLAY.              40650000
         DFHPC TYPE=RETURN                                              40700000
*********************************************************************** 40750000
*                                                                     * 40800000
*        THIS SECTION PREPARES THE 'LINE' OR 'CTRL' DISPLAY           * 40850000
*                                                                     * 40900000
*********************************************************************** 40950000
L60      MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SWITCH       XH 41000000
         ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0          41050000
         MVC   RELREC,SLOTRFB      SAVE POINTER TO DETAIL BLK           41100000
L140     DFHFC TYPE=RELEASE        RELEASE CONTROL BLOCK                41150000
         MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                41200000
         OC    RELREC,RELREC       IS THERE ANY DATA BLOCKS ?  @OZ31885 41210007
         BZ    Z130                NO, WRITE 'NO DATA BLKS MSG'@OZ31885 41220007
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=L170,DATASET=EMFILE       41250000
         B     F190                I/O ERROR                            41300000
L170     L     FIOABAR,TCAFCAA     POINT TO FIOA                        41350000
         SR    DATALOOP,DATALOOP                                        41400000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                41450000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 41500000
L210     MVI   SLOTCNT,X'00'       ZERO OUT DETAIL SLOT COUNTER.        41550000
         OC    LINENAME,=CL8' '                                         41600000
         OC    CLUSNAME,=CL8' '                                         41650000
L220     L     1,SAVERCAP          POINT TO RECAP HEADER                41700000
         CLC   PARM2(4),=C'LINE'   PARM2 = LINE?                        41750000
         BE    L230                YES.                                 41800000
         CLC   PARM4,=CL8' '       IS PARM4 BLANK?                      41850000
         BE    L225                YES. MUST BE LOCAL.                  41900000
         OC    PARM4,PARM4         OR IS PARM4 ZEROS?                   41950000
         BZ    L225                YES. MUST BE LOCAL ALSO              42000000
         MVC   22(8,1),CLUSNAME    MOVE CONTROL UNIT TO HEADER          42050000
         MVC   30(3,1),=C'ON '                                          42100000
         MVC   33(8,1),LINENAME    MOVE LINE ADDR. TO HEADER            42150000
         B     M10                                                      42200000
L225     MVC   11(19,1),=C'LOCAL CONTROL UNIT '                         42250000
         MVC   30(8,1),LINENAME    MOVE CTRL UNIT TO HEADER             42300000
         B     M10                                                      42350000
L230     MVC   21(8,1),LINENAME    MOVE LINE ADDR. TO HEADER            42400000
*********************************************************************** 42450000
*                                                                     * 42500000
*        THIS SECTION FORMATS A 'LINE' ITEM OR A 'CTRL' ITEM.         * 42550000
*                                                                     * 42600000
*********************************************************************** 42650000
M10      MVC   CTRLNAME,=D'0'      ZERO  OUT CONTROL UNIT WORK AREA.    42700000
         MVC   TERMNAME,=CL8' '    BLANK OUT TERMINAL WORK AREA.        42750000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           42800000
         MVC   TBARG,=CL2' '       CLEAR MOD-1 TABLE ARGUMENT        XH 42850000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                42900000
         BE    N10                 YES.                                 42950000
         CLI   ENTRYTYP,X'30'      IS IT AN OBR ENTRY?                  43000000
         BE    N80                 YES.                                 43050000
         CLI   ENTRYTYP,X'34'      IS IT TCAM OBR?                      43100000
         BE    N80                 YES,BR                               43150000
M100     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            43200000
         BE    N150                YES.                                 43250000
         OC    CTRLNAME,=CL8' '                                         43300000
         OC    PARM4,=CL8' '                                            43350000
         CLC   PARM4,CTRLNAME      IS PARM 4 = REMOTE CTRL UNIT NAME?   43400000
         BE    N150                YES. PROCESS ENTRY                   43450000
         CLI   PARM4,X'40'         IS PARM4 BLANK ?                     43500000
         BNE   M140                NO. MUST BE REMOTE--BYPASS CK LOCAL  43550000
         OC    LINENAME,=CL8' '                                         43600000
         CLC   LINENAME,CTRLNAME   IS LINENAME = LOCAL CTRL UNIT ?      43650000
         BE    N150                YES. PROCESS ENTRY                   43700000
M140     SR    R15,R15                                               XH 43750000
         IC    R15,SLOTCNT         ADD ONE                           XH 43800000
         AH    R15,=H'1'           TO                                XH 43850000
         STC   R15,SLOTCNT         SLOT COUNTER.                     XH 43900000
M160     SR    R14,R14                                               XH 43950000
         IC    R14,DATALTH         PUT LTH OF SLOT IN WORK REG          44000000
         AR    DATAREG,R14         POINT TO NEXT DETAIL SLOT.           44050000
         SR    DATALOOP,R14        MORE SLOTS IN THIS DETAIL BLK?       44100000
         BP    M10                 YES.                                 44150000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  44200000
         BNE   L140                YES.                                 44250000
M240     ZAP   WORKCNT,ITEMCNT                                          44300000
         BZ    Z50                                                      44350000
         B     K230                                                     44400000
N10      CLI   MOD1SW,X'00'        MOD-1 SWITCH OFF ?                XH 44450000
         BE    N30                 YES. BYPASS MOD-1 SCANNER CHECK   XH 44500000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?        XH 44550000
         BE    N20                 YES. USE REMOTE TERMINAL ADDR     XH 44600000
         MVC   TBARG(1),MDRCTRL    SET TBARG = REMOTE CTRL UNIT      XH 44650000
         B     N25                 GO CK ADDR AGAINST MOD-1 TABLE    XH 44700000
N20      MVC   TBARG(1),MDRTERM    SET TBARG = REMOTE TERMINAL       XH 44750000
N25      BAL   LINKREG,MOD1SCAN    CK IF REMOTE CU OR TERMINAL       XH 44800000
         CLC   TBARG,=X'0000'        IN MOD-1 TABLE?                 XH 44850000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 44900000
N30      UNPK  CTRLNAME(3),MDRCTRL(2)   MDR - PUT CONTROL UNIT       XH 44950000
         TR    CTRLNAME(2),HXTOEB       NAME                            45000000
         MVI   CTRLNAME+2,X'00'         IN WORK AREA.                   45050000
         UNPK  TERMNAME(3),MDRTERM(2)   PUT TERMINAL                    45100000
         TR    TERMNAME(2),HXTOEB       NAME                            45150000
         MVI   TERMNAME+2,C' '          IN WORK AREA.                   45200000
         B     M100                                                     45250000
N80      CLI   OBRUCB,X'10'        IS THIS A LOCAL                      45300000
         BE    N110                YES, GO MOVE 3 BYTE ADDRESS          45350000
N85      CLI   MOD1SW,X'00'        IS MOD-1 SWITCH OFF ?             XH 45550000
         BE    N95                 YES. BYPASS MOD-1 SCANNER CHECK   XH 45600000
         CLC   PARM2(4),=C'CTRL'      IS THIS A 'CTRL' DISPLAY?@OZ31878 45650007
         BE    N88                    YES. USE REMOTE TERM ADDR@OZ31878 45660007
         MVC   TBARG(1),OBRCTRL       PASS REMOTE CU TO MOD-1  @OZ31878 45670007
         B     N90                    GO CK ADDR AGAINST MOD-1 @OZ31878 45680007
N88      MVC   TBARG(1),OBRTERM       PASS REMOTE TERM ADDR    @OZ31878 45690007
*                                     TO MOD-1                 @OZ31878 45700007
N90      BAL   LINKREG,MOD1SCAN       CK IF REMOTE CU OR TERM  @OZ31878 45710007
         CLC   TBARG,=X'0000'        ADDR FOR REMOTE LINE ERRORS     XH 45750000
*                                    IS IN MOD-1 TABLE ?             XH 45800000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 45850000
N95      UNPK  DBLWD,OBRCTRL(2)    OBR - MOVE 1 BYTE REMOTE CU ADR   XH 45900000
         TR    DBLWD+4(3),HXTOEB                                        45950000
         MVC   CTRLNAME(2),DBLWD+5 TO WORK AREA                         46000000
         UNPK  DBLWD,OBRTERM(2)    MOVE 1-BYTE REMOTE TERML ADDR        46050000
         TR    DBLWD+4(3),HXTOEB                                        46100000
         MVC   TERMNAME(2),DBLWD+5 WORK AREA.                           46150000
         B     M100                                                     46200000
N110     CLI   MOD1SW,X'00'        IS MOD-1 SWITCH OFF ?             XH 46250000
         BE    N130                YES. BYPASS MOD-1 SCANNER CHECK   XH 46300000
         MVC   TBARG,OBRCUA        SET TBARG = LOCAL TERMINAL ADDR   XH 46350000
         BAL   LINKREG,MOD1SCAN    CK IF LOCAL TERMINAL IS IN        XH 46400000
         CLC   TBARG,=X'0000'           MOD-1 TABLE ?                XH 46450000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 46500000
N130     UNPK  DBLWD,LINEIDA(4)    OBR - MOVE 3-BYTE CONTROL UNIT    XH 46550000
         TR    DBLWD+4(3),HXTOEB        ADDRESS(POSSIBLY ROUNDED)       46600000
         MVC   CTRLNAME(3),DBLWD+4      TO WORK AREA.                   46650000
         UNPK  DBLWD,OBRCUA(3)          MOVE REAL 3-BYTE CONTROL        46700000
         TR    DBLWD+4(3),HXTOEB        UNIT ADDRESS                    46750000
         MVC   TERMNAME(3),DBLWD+4      WORK AREA.                      46800000
         B     M100                                                     46850000
N150     OC    CTRLNAME,=CL8' '                                         46900000
         L     R14,SAVEITEM        POINT TO FIRST ITEM IN TIOA          46950000
         ZAP   WORKCNT,ITEMCNT     ANY ITEMS IN TIOA?                   47000000
         BZ    P50         NO,ADD NEW ITEM                              47050000
N170     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            47100000
         BE    P20                 YES.                                 47150000
         CLC   TERMNAME,ITEMLTH(R14) WORKTERMINAL = TIOA TERMINAL?      47200000
         BE    P40                 YES.                                 47250000
N230     LA    R14,DTLLTH(R14)     BUMP TO NEXT ITEM                    47300000
         SP    WORKCNT,=PL2'1'     SUBT ONE FROM ITEM COUNTER.          47350000
         BZ    P90     ANY ITEMS?  NO. ADD NEW ITEM.                    47400000
         B     N170                                                     47450000
P20      CLC   CTRLNAME,ITEMLTH(R14)    WORK CTRL = TIOA CTRL?          47500000
         BNE   N230                NO.                                  47550000
P40      PACK  FULLWD(3),COUNTLTH(4,R14)  ADD                           47600000
         AP    FULLWD(3),=P'1'            ONE                           47650000
         UNPK  COUNTLTH(4,R14),FULLWD(3)  TO                            47700000
         OI    COUNTLTH+3(R14),X'F0'      COUNT FIELD.                  47750000
         B     M140                GO CHECK NEXT SLOT.                  47800000
P50      CLC   PARM2(4),=C'LINE'   IS IT LINE                           47850000
         BE    P170                YES,BR                               47900000
         SR    R15,R15                                                  47950000
         IC    R15,SLOTCNT                                              48000000
         AH    R15,=H'1'                                                48050000
         STC   R15,SLOTTTR                                              48100000
         L     R15,SAVEBBSS                                             48150000
         UNPK  DBLWD(3),SLOTTTR(2)                                      48200000
         TR    DBLWD,HXTOEB                                             48250000
         MVC   3(2,R15),DBLWD                                           48300000
P90      CLI   QUITSW,X'FF'        MOD-1 OUTPUT-FULL-SW ON ?         XH 48350000
         BE    M140                YES. BYPASS PUTTING ADDR IN OUTPUTXH 48400000
         CLC   PARM2(4),=C'LINE'        IS THIS A 'LINE' DISPLAY?    XH 48450000
         BE    P170                     YES.                            48500000
         MVC   DTLITEM,TERMNAME    NO. MOVE TERMINAL                    48550000
P120     MVC   0(DTLLTH,OUTREG),DTLENTRY  TO OUTPUT                     48600000
         LA    OUTREG,DTLLTH(OUTREG) UPDATE OUTPUT POINTER.             48650000
         AP    ITEMCNT,=P'1'       ADD 1 TO COUNT OF OUTPUT ITEMS.      48700000
         SR    R15,R15                                               XH 48750000
         IC    R15,SLOTCNT         ADD ONE                           XH 48800000
         AH    R15,=H'1'           TO                                XH 48850000
         STC   R15,SLOTCNT         SLOT COUNTER.                     XH 48900000
         L     R15,SAVEBBSS        NO. POINT TO BLK/SLT AREA IN TIOA.XH 48950000
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.    @OZ31882 48970007
         UNPK  DBLWD,SVRELREC(4)   STORE BDAM RELATIVE               XH 49000000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                XH 49050000
         MVC   5(3,R15),DBLWD+4    (LAST BBBSS) IN OUTPUT            XH 49100000
         SR    R14,R14                                               XH 49150000
         UNPK  DBLWD(3),SLOTCNT(2) STORE SLOT NUMBER IN              XH 49200000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                      XH 49250000
         MVC   8(2,R15),DBLWD      IN OUTPUT.                        XH 49300000
         CP    ITEMCNT,=P'1'       IS THIS THE FIRST ITEM IN TIOA ?  XH 49350000
         BNE   P140                NO. BYPASS UPDATING FIRST BBBSS   XH 49400000
         MVC   0(5,15),5(15)       SET FIRST BBBSS = LAST BBBSS      XH 49450000
         CLC   10(5,15),=C'BBBSS'  IS PREV BBBSS FILLED IN ?         XH 49500000
         BNE   P140                YES. BYPASS UPDATING PREV BBBSS   XH 49550000
         MVC   10(5,15),0(15)      SET PREV BBBSS = FIRST BBBSS      XH 49600000
P140     BCT   OUTLOOP,M160        MORE ROOM IN TIOA?                XH 49650000
         CLI   TCTTETM,X'F2'       IS THIS A 3270-2 ?                XH 49700000
         BE    M240                YES. PREPARE TO EXIT              XH 49750000
         MVI   QUITSW,X'FF'        TURN ON OUTPUT-FULL-SW FOR MOD-1  XH 49800000
         B     M160                CONTINUE SCANNING REST OF DATABASEXH 49850000
P170     MVC   DTLITEM,CTRLNAME    SETUP CONTROL UNIT ADDRESS           49900000
         B     P120                     FOR OUTPUT.                     49950000
*********************************************************************** 50000000
*                                                                     * 50050000
*        THIS SECTION PREPARES FOR AN ENTRY BLOWUP OR FOR PAGING.     * 50100000
*                                                                     * 50150000
*********************************************************************** 50200000
R10      L     R14,SAVETIOA        RESTORE POINTER TO INPUT DATA.       50250000
         LA    14,12(14)           BUMP PASS 'SSA' 12-BYTES             50300000
         CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            50350000
         BE    S010                YES,BR CK FOR FWD OR BACK            50400000
         OC    PARM5,PARM5         MAKE SURE A FIELD WAS X'ED           50450000
         BZ    Z40                 BR,ZERO NO FIELD WAS X'ED            50500000
         CLC   PARM2(4),=C'LINE'   NO. THIS MUST BE COMPANION REQUEST.  50550000
         BNE   R010                IF NOT LINE DISPLAY, GO READ RECORD. 50600000
         MVC   PARM3,PARM5         IS LINE, MOVE THE X'D FIELD TO PRM3. 50650000
         MVC   LINENAME,PARM5        MOVE LINE ADDRESS TO SAVE AREA     50700000
         XC    PARM4(16),PARM4       AS IF LINE ID HAD BEEN KEYED IN.   50750000
         B     F180                GO DO LINE DISPLAY AS IF THIS WERE   50800000
*                                  AN INITIAL 'LINE' INPUT.             50850000
R010     MVC   CLUSNAME,PARM5      MOVE CONTROL UNIT ADDR TO SAVE       50900000
         MVC   PARM4,PARM5         MOVE X'D CTRL UNIT TO PARM4 AS IF    50950000
         XC    PARM5,PARM5           IT HAD BEEN KEYED IN.              51000000
         MVC   PARM1,PARM4         PUT CTRL NAME IN PARM1 FOR TABLE     51050000
         OC    PARM1,=CL8' '                                            51100000
R140     L    14,SAVETIOA          RESTORE REG 14                       51150000
         LA    14,12(14)                                                51200000
         TR    17(3,14),EBTOHX     GET BLOCK NUMBER OF                  51250000
         PACK  DBLWD,17(4,14)         REQUESTED LINE INTO HEX.          51300000
         MVC   RELREC,DBLWD+4                                           51350000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=R170,DATASET=EMFILE       51400000
         B     F190                I/O ERROR.                           51450000
R170     L     FIOABAR,TCAFCAA                                          51500000
         XC    PARM3,PARM3                                              51550000
         UNPK  DBLWD,DATAPORT(4)        MOVE LINE ID                    51600000
         TR    DBLWD+4,HXTOEB           FROM PREVIOUS BLOCK             51650000
         MVC   LINENAME(3),DBLWD+4     TO PARM3 AS IF IT HAD BEEN       51700000
         MVC   PARM3(6),LINENAME        KEYED IN.                       51750000
         DFHFC TYPE=RELEASE                                             51800000
         CLC   PARM3,PARM4         IS THIS A LOCAL CTRL UNIT?           51850000
         BNE   F180                NO. GO TO PROCESS REMOTE.            51900000
         XC    PARM4,PARM4         YES. CLEAR REDUNDANT CU ADDR         51950000
         B     F180                GO DO A 'CTRL' DISPLAY AS IF ABOVE   52000000
*                                  CTRL & LINE HAD BEEN TYPED IN.       52050000
S010     EQU   *                                                        52100000
         CLC   19(2,14),=X'C1D3'   IS THIS A PAGE FORWARD-LG   @OZ30480 52150007
*                                       OR A PAGE BACKWARD-SM? @OZ30480 52155007
         BE    S090                YES.                        @OZ30480 52160007
         CLC   19(2,14),=X'C17B'   IS THIS A PAGE BACKWRD-LG?  @OZ30480 52165007
         BE    S090                YES.                        @OZ30480 52170007
         CLC   19(2,14),=X'406B'   IS THIS A PAGE FORWARD-SM?  @OZ30480 52175007
         BNE   S100                NO, NO OTHER PAGE REQUEST   @OZ30480 52180007
S090     LA    14,4(14)              BUMP WORK REG BY 4        @OZ30480 52185007
S100     MVC   WORK15,21(14)       CONVERT BBBSS'S TO HEX      @OZ30480 52190007
         TR    WORK15,EBTOHX                                            52200000
         CLC   PARM5(4),=C'FORW'   IS IT A 'PAGE FORWARD' REQUEST?      52250000
         BE    S110                YES.                                 52300000
         PACK  DBLWD,WORK15+10(6)                                       52350000
         MVC   RELREC,DBLWD+3      THE 'PREVIOUS' BLOCK.                52400000
         MVC   TWASLOT,DBLWD+6     AND SLOT TO RESUME AT.               52450000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                XH 52500000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                 XH 52550000
         L     15,SAVEBBSS         POINT TO NEW OUTPUT HEADER.          52600000
         MVC   0(5,15),31(14)      OLD PREVIOUS NOW BECOMES NEW         52650000
         MVC   10(5,15),31(14)     FIRST AND PREVIOUS.                  52700000
         B     S180                                                     52750000
S110     EQU   *                                                        52800000
         PACK  DBLWD,WORK15+5(6)                                        52850000
         MVC   RELREC,DBLWD+3      PLACE TO PAGE FORWARD FROM           52900000
         MVC   TWASLOT,DBLWD+6                                          52950000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                XH 53000000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                 XH 53050000
         L     15,SAVEBBSS         POINT TO NEW OUTPUT HEADER.          53100000
         MVC   0(5,15),26(14)      OLD LAST IS NEW FIRST AND            53150000
         MVC   10(5,15),21(14)     OLD FIRST IS NEW PREVIOUS.           53200000
S180     BAL   LINKREG,LOCATE      LOCATE PROPER BLOCK & SLOT.          53250000
         CLC   PARM2(3),=C'ALL'                                         53300000
         BE    J40                 GO RESUME WHERE LEFT OFF AT (ALL)    53350000
         B     S215                PERFORM MOD-1 TABLE BUILD         XH 53400000
S190     ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0       XH 53450000
         SR    R15,R15                                                  53500000
         IC    R15,DBLWD+6             UPDATE SLOT COUNTER              53550000
         SH    R15,=H'1'                   FOR PAGING IN                53600000
         STC   R15,SLOTCNT             LINE OR CTRL DISPLAYS.           53650000
S200     UNPK  DBLWD,LINEIDA(4)        MOVE LINE ADDRESS                53700000
         TR    DBLWD+4(3),HXTOEB                TO                      53750000
         MVC   LINENAME(3),DBLWD+4     SAVE AREA FOR RECAP HDR.         53800000
         MVC   LINENAME+3(5),=CL5' '        CLEAR OUT GARBAGE           53850000
         XC    PARM4,PARM4                                              53900000
         CLI   ENTRYTYP,X'91'          IS THIS AN MDR ENTRY?            53950000
         BE    S210                         YES.                        54000000
         CLI   OBRUCB,X'40'            IS THIS A REMOTE OBR ?        XH 54050000
         BNE   S205                         NO.                      XH 54100000
         UNPK  CLUSNAME(3),OBRCTRL(2)       MOVE MDR DUMMY LINE ADDR XH 54150000
         TR    CLUSNAME(2),HXTOEB                TO                  XH 54200000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR. XH 54250000
         MVC   PARM4(2),CLUSNAME              MOVE  ADDR  TO PARM4   XH 54300000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)XH 54350000
S205     MVC   CLUSNAME,LINENAME       MOVE OBR CTRL ADDR. TO SAVE ARXH 54400000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)XH 54450000
S210     UNPK  CLUSNAME(3),MDRCTRL(2)       MOVE MDR CTRL ADDR.         54500000
         TR    CLUSNAME(2),HXTOEB                TO                     54550000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR.    54600000
         MVC   PARM4(2),CLUSNAME       MOVE MDR CTRL ADDR. TO PARM4     54650000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   54700000
*********************************************************************** 54750000
*                                                                     * 54800000
*   THIS IS THE MOD-1 'LINE' AND 'CTRL' TABLE BUILD ROUTINE           * 54850000
*                                                                     * 54900000
*********************************************************************** 54950000
S215     ST    OUTLOOP,SOUTLOOP    SAVE OUTLOOP REGISTER                55000000
         MVC   MOD1TABL,=CL64' '   INITIALIZE MOD1TABL TO BLANKS        55050000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ?                     55100000
         BE    S218                YES. SAVE MDR CTRL UNIT     @OZ31878 55150007
         CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?      @OZ31878 55160007
         BNE   S220                NO. BYPASS SAVING CTRL UNIT @OZ31878 55170007
         MVC   TBCTRL,OBRCTRL      YES. SAVE REMOTE OBR CU     @OZ31878 55180007
         B     S220                                            @OZ31878 55190007
S218     MVC   TBCTRL,MDRCTRL      SET TBCTRL = MDRCTRL        @OZ31878 55200007
S220     MVC   TBLINE,LINEIDA      SAVE CURRENT LINE ID                 55250000
         XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        55300000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=S220R,DATASET=EMFILE      55350000
         B     F190                GET I/O ERROR, GO ISSUE ERR MSG.     55400000
S220R    L     FIOABAR,TCAFCAA     POINT TO FIOA AREA.                  55450000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    55500000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           55550000
         SR    DATALOOP,DATALOOP                                        55600000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      55650000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        55700000
S220A    CLC   TBLINE,SLOTLINE     IS THIS CONTROL SLOT FOR OUR LINE?   55750000
         BE    S222                YES. GO GET DETAIL BLOCK.            55800000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           55850000
         BCT   DATALOOP,S220A      CHECK NEXT SLOT.                     55900000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 55950000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        56000000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        56050000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=S222R,DATASET=EMFILE      56100000
         B     F190                GET I/O ERROR, GO ISSUE ERR MSG.     56150000
S222R    L     FIOABAR,TCAFCAA     POINT TO INPUT RECORD AREA           56200000
         SR    DATALOOP,DATALOOP                                        56250000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                56300000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 56350000
         B     S220A                                                    56400000
S222     ZAP   TABLECNT,=P'0'      SET CTR OF TABLE ITEMS = 0           56450000
         LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 56500000
         MVC   RELREC,SLOTRFB      MOVE POINTER TO DETAIL BLK           56550000
S222A    MVC   SVRELREC,RELREC     SAVE FOR COMPARE TO TABLE RELREC     56600000
         DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=S222AR,DATASET=EMFILE     56650000
         B     F190                GET I/O ERROR, GO ISSUE ERR MSG.     56700000
S222AR   L     FIOABAR,TCAFCAA     POINT TO INPUT RECORD AREA           56750000
         SR    DATALOOP,DATALOOP                                        56800000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                56850000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 56900000
         MVI   SLOTCNT,X'01'       SET COUNT OF DETAIL BLK SLOTS=1      56950000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           57000000
S222B    CLC   SVRELREC,TBRELREC   IS THIS THE RIGHT DETL BLK ?         57050000
         BNE   S222B10             NO. CONTINUE SCAN                    57100000
         CLC   SLOTCNT,TBSLOT      IS THIS THE RIGHT ENTRY ?            57150000
         BNE   S222B10             NO. CONTINUE SCAN                    57200000
S222B03  MVI   MOD1SW,X'FF'        TURN MOD-1 SWITCH ON                 57250000
S222B05  MVC   RELREC,TBRELREC     RESTORE PAGING 'BBB'                 57300000
         MVC   TWASLOT,TBSLOT      RESTORE PAGING 'SS'                  57350000
         BAL   LINKREG,LOCATE      LOCATE STARTING 'BBBSS' FOR DISP     57400000
         L     OUTLOOP,SOUTLOOP    RESTORE THE CONTENT OF OUTLOOP REG   57450000
         B     S190                RESUME PAGING SETUP                  57500000
S222B10  LA    14,MOD1TABL         POINT OT MOD-1 TABLE                 57550000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                57600000
         BE    S222C               YES.                                 57650000
         CLI   ENTRYTYP,X'30'      IS IT A BTAM OBR?                    57700000
         BE    S222D               YES.                                 57750000
         CLI   ENTRYTYP,X'34'      IS IT A TCAM OBR?                    57800000
         BE    S222D               YES.                                 57850000
S222B20  SR    15,15                                                    57900000
         IC    15,SLOTCNT          ADD ONE                              57950000
         AH    15,=H'1'            TO                                   58000000
         STC   15,SLOTCNT          SLOT COUNTER.                        58050000
         SR    14,14                                                    58100000
         IC    14,DATALTH          PUT LTH OF SLOT IN WORK REG.         58150000
         AR    DATAREG,14          POINT TO NEXT DETAIL SLOT.           58200000
         SR    DATALOOP,14         MORE SLOTS IN THIS DETAIL BLK?       58250000
         BP    S222B               YES.                                 58300000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  58350000
         BNE   S222A               YES.                                 58400000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN MOD-1 TABLE?            58450000
         BZ    S222B05             NO. EXIT BUT DON'T TURN ON MOD-1 SW. 58500000
         B     S222B03             YES. EXIT NORMALLY                   58550000
S222C    CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?           58600000
         BE    S222C50             YES.  USE TERMINAL ADDR ONLY         58650000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 58700000
         BZ    S222C30             NO. ADD NEW ITEM                     58750000
S222C10  CLC   0(1,14),MDRCTRL     IS THIS CTRL UNIT IN THE TABLE ?     58800000
         BE    S222B20             YES.  BYPASS THIS ENTRY              58850000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   58900000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT         58950000
         BZ    S222C30             BRANCH IF NO MORE ITEMS TO CK        59000000
         B     S222C10                                                  59050000
S222C30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             59100000
         BE    S222B03             YES.                                 59150000
         MVC   0(1,MOD1REG),MDRCTRL     STORE IN TABLE                  59200000
         B     S228                                                     59250000
S222C50  CLC   TBCTRL,MDRCTRL      DOES CTRL UNIT ENTRY = REQUESTED CU? 59300000
         BNE   S222B20             NO. BYPASS PUTTING TERMINAL IN TABLE 59350000
         ZAP   WKTBLCNT,TABLECNT                                        59400000
         BZ    S222C70                                                  59450000
S222C60  CLC   0(1,14),MDRTERM     IS THIS TERMINAL IN THE TABLE ?      59500000
         BE    S222B20             YES. BYPASS THIS ENTRY               59550000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   59600000
         SP    WKTBLCNT,=PL2'1'                                         59650000
         BZ    S222C70                                                  59700000
         B     S222C60                                                  59750000
S222C70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             59800000
         BE    S222B03             YES.                                 59850000
         MVC   0(1,MOD1REG),MDRTERM    PUT REMOTE TERMINAL INTO TABLE   59900000
         B     S228                                                     59950000
S222D    CLI   OBRUCB,X'10'        IS THIS A LOCAL?                     60000000
         BE    S222G               YES. GO MOVE 3-BYTE ADDR             60050000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?  @OZ31878 60100007
         BE    S222D50             YES.  USE TERMINAL ADDR ONLY@OZ31878 60105007
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31878 60110007
         BZ    S222D30             NO. ADD NEW ITEM            @OZ31878 60115007
S222D10  CLC   0(1,14),OBRCTRL     IS THIS CTRL UNIT IN TABLE? @OZ31878 60120007
         BE    S222B20             YES.  BYPASS THIS ENTRY     @OZ31878 60125007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31878 60130007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT@OZ31878 60135007
         BZ    S222D30             BRANCH IF NO MORE ITEMS     @OZ31878 60140007
         B     S222D10                                         @OZ31878 60145007
S222D30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31878 60150007
         BE    S222B03             YES.                        @OZ31878 60155007
         MVC   0(1,MOD1REG),OBRCTRL     STORE IN TABLE         @OZ31878 60160007
         B     S228                                            @OZ31878 60165007
S222D50  CLC   TBCTRL,OBRCTRL      DOES CU ENTRY = REQSTED CU? @OZ31878 60170007
         BNE   S222B20             NO. DON'T PUT TERM IN TBL   @OZ31878 60175007
         ZAP   WKTBLCNT,TABLECNT                               @OZ31878 60180007
         BZ    S222D70                                         @OZ31878 60185007
S222D60  CLC   0(1,14),OBRTERM     IS THIS TERMINAL IN THE TBL?@OZ31878 60190007
         BE    S222B20             YES. BYPASS THIS ENTRY      @OZ31878 60195007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31878 60200007
         SP    WKTBLCNT,=PL2'1'                                @OZ31878 60205007
         BZ    S222D70                                         @OZ31878 60210007
         B     S222D60                                         @OZ31878 60215007
S222D70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31878 60220007
         BE    S222B03             YES.                        @OZ31878 60225007
         MVC   0(1,MOD1REG),OBRTERM   PUT REMOTE TERM IN TABLE @OZ31878 60230007
         B     S228                                            @OZ31878 60235007
S222G    CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY ?           60250000
         BE    S222B20             YES. BYPASS THIS ERROR DATA          60300000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31878 60350007
         BZ    S225                NO. ADD NEW ITEM TO TABLE   @OZ31878 60400007
S224     CLC   0(2,14),OBRCUA      ARG MATCH TABLE ENTRY ?     @OZ31878 60450007
         BE    S222B20             YES.  BYPASS THIS ARGUMENT  @OZ31878 60500007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT  @OZ31878 60550007
         BZ    S225                NO MORE ITEMS TO CK--SO ADD @OZ31878 60600007
*                                  THIS NEW ITEM TO TABLE               60750000
         LA    14,2(14)            BUMP TO NEXT TABLE ENTRY             60800000
         B     S224                GO CK ANOTHER ENTRY         @OZ31878 60850007
S225     CP    TABLECNT,=P'32'     MORE THAN 33 ENTRIES--USER  @OZ31878 60890007
*                                  MUST BE PAGING FROM MOD-2   @OZ31878 60930007
         BE    S222B03             PREPARE TO EXIT ROUTINE.    @OZ31878 60970007
         MVC   0(2,MOD1REG),OBRCUA ADD CTRL UNIT TO MOD-1 TABLE@OZ31878 61010007
S228     LA    MOD1REG,2(MOD1REG)  UPDATE TABLE POINTER.       @OZ31878 61050007
         AP    TABLECNT,=P'1'      ADD 1 TO COUNT OF TABLE ITEMS        61150000
         B     S222B20             GO CK ANOTHER ENTRY                  61200000
*********************************************************************** 61250000
*                                                                     * 61300000
*   THIS IS THE MOD-1 TABLE SCANNER ROUTINE                           * 61350000
*                                                                     * 61400000
*********************************************************************** 61450000
MOD1SCAN ST    OUTLOOP,SOUTLOOP    SAVE OUTLOOP REGISTER CONTENT        61500000
         LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 61550000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 61600000
         BZ    MOD1EXIT            NO. EXIT AND LEAVE TBARG = ADDR.     61650000
MOD1LOOP CLC   0(2,MOD1REG),TBARG  ARG MATCH TABLE ENTRY ?              61700000
         BE    MOD1PASS            YES.  BYPASS THIS ARGUMENT           61750000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT           61800000
         BZ    MOD1EXIT            NO MORERE ITEMS TO CK--SO EXIT       61850000
         LA    MOD1REG,2(MOD1REG)  BUMP TO NEXT TABLE ENTRY             61900000
         B     MOD1LOOP            GO CHECK ANOTHER ENTRY               61950000
MOD1PASS MVC   TBARG,=X'0000'      CLEAR ARGUMENT = DO NOT USE          62000000
MOD1EXIT L     OUTLOOP,SOUTLOOP    RESTORE THE CONTENT OF OUTLOOP REG   62050000
         BR    LINKREG             RETURN TO CALLER                     62100000
*********************************************************************** 62150000
*                                                                     * 62200000
*        THIS IS THE LOCATE ROUTINE                                   * 62250000
*                                                                     * 62300000
*********************************************************************** 62350000
LOCATE   DFHFC TYPE=GET,DATASET=EMFILE,RDIDADR=RELREC,NORESP=S230       62400000
         B     F190                BRANCH IF GET I/O ERROR.             62450000
S230     L     FIOABAR,TCAFCAA     POINT TO DATA BLK.                   62500000
         MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                62550000
         CLC   PARM2(3),=C'ALL'    IS THIS 'ALL' BEING CONTINUED?       62600000
         BNE   S250                NO. GO SETUP FOR DATA BLOCK.         62650000
         CLC   TWASLOT,CTRLENTS    YES. SETUP FOR CNTRL BLOCK.          62700000
         BH    S290                QUIT IF GARBAGE KEYED IN.            62750000
         LA    DATAREG,CTRLSLT1                                         62800000
         SR    DATALOOP,DATALOOP   LOOP THRU CONTROL                    62850000
         IC    DATALOOP,CTRLENTS   BLOCK TILL REQUESTED SLOT NBR        62900000
         SR    1,1                 IS SATISFIED.                        62950000
         IC    1,TWASLOT                                                63000000
S235     BCT   1,S240                                                   63050000
         BR    LINKREG                                                  63100000
S240     BCTR  DATALOOP,0                                               63150000
         LA    DATAREG,SLOTLTH(DATAREG)                                 63200000
         B     S235                                                     63250000
S250     LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       63300000
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             63350000
         MVC   WRKSLOT,TWASLOT     MOVE TWASLOT TO WRKAREA              63400000
S260     CLI   WRKSLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      63450000
         BL    S320                GO RESUME DISPLAY BUILDING.          63500000
         SR    1,1                                                      63550000
         IC    1,WRKSLOT           DECREMENT SLOT COUNT BY 1.           63600000
         BCTR  1,0                                                      63650000
         STC   1,WRKSLOT                                                63700000
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   63750000
         LTR   1,1                                                      63800000
         BZ    S290                PREVENT LOOP IF GARBAGE INPUT.       63850000
         AR    DATAREG,1                                                63900000
         SR    DATALOOP,1                                               63950000
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  64000000
         BP    S260                                                     64050000
S290     MVC   TIOADBA(MSG5LTH),MSG5   IF RQSTED SLOT CAN'T             64100000
*                                       BE FOUND, SEND 'SEARCHING ERR'  64150000
         DFHTC TYPE=(WRITE,ERASE)                                       64200000
         DFHPC TYPE=RETURN                                              64250000
S320     BR    LINKREG             RETURN TO MAIN LINE.                 64300000
*********************************************************************** 64350000
Z10      CLC   PARM2(4),=C'CTRL'          IS PARM2 = CTRL ?             64400000
         BE    Z50                        YES.                          64450000
         MVC   TIOATDL(MSG4LTH),MSG4                                    64500000
         B     Z80                                                      64550000
Z20      MVC   TIOATDL(MSG2LTH),MSG2                                    64600000
         B     Z80                                                      64650000
Z30      MVC   TIOATDL(MSG3LTH),MSG3                                    64700000
         B     Z80                                                      64750000
Z40      MVC   TIOATDL(MSG6LTH),MSG6                                    64800000
         B     Z80                                                      64850000
Z50      CLC   MSG7CTRL,=CL2' '           REMOTE CTRL UNIT PRESENT?     64900000
         BNE   Z50A                       YES.                          64950000
         MVC   MSG8CTRL,MSG7LINE          NO. MOVE LOCAL LINE TO CTRL   65000000
         MVC   TIOATDL(MSG8LTH),MSG8                                    65050000
         B     Z80                                                      65100000
Z50A     MVC   TIOATDL(MSG7LTH),MSG7                                    65150000
         B     Z80                                                      65200000
Z70      MVC   MSG1TERM,PARM3        MOVE SYMBOLIC NAME TO ERROR MSG    65250000
         OC    MSG1TERM,=CL8' '      CONVERT X'00' TO BLANK             65300000
         MVC   TIOATDL(MSG1LTH),MSG1                                    65350000
Z80      DFHTC TYPE=(WRITE,ERASE)                                       65400000
         DFHPC TYPE=RETURN                                              65450000
Z130     MVC   MSG13LN,MSG7LINE                                @OZ31885 65460007
         MVC   TIOATDL(MSG13LTH),MSG13                         @OZ31885 65470007
         B     Z80                                             @OZ31885 65480007
*                                                                       65500000
MSG1     DC    AL2(MSG1LTH-4),X'0000'                                   65550000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    65600000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           65650000
         DC    C'BNG002I C UNABLE TO CONVERT SYMBOLIC '                 65700000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           65750000
         DC    C'TERMINAL NAME '                                        65800000
MSG1TERM DC    CL8' '                                                   65850000
MSG1LTH  EQU   *-MSG1                                                   65900000
MSG2     DC    AL2(MSG2LTH-4),X'0000'                                   65950000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    66000000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           66050000
         DC    C'BNG002I C INVALID INPUT FROM SCREEN'                   66100000
MSG2LTH  EQU   *-MSG2                                                   66150000
MSG3     DC    AL2(MSG3LTH-4),X'0000'                                   66200000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    66250000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 66300000
         DC    C'BNG003I C NO ERRORS RECORDED'                       XH 66350000
MSG3LTH  EQU   *-MSG3                                                   66400000
MSG4     DC    AL2(MSG4LTH-4),X'0000'                                   66450000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    66500000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 66550000
         DC    C'BNG004I C NO ERRORS RECORDED FOR '                  XH 66600000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 66650000
         DC    C'LINE '                                                 66700000
NOLINE   DC    CL3' '                                                   66750000
MSG4LTH  EQU   *-MSG4                                                   66800000
MSG5     DC    AL2(MSG5LTH-4),X'0000'                                   66850000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    66900000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           66950000
         DC    C'BNG005I C ERROR NOT FOUND ON FILE FOR '                67000000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           67050000
         DC    C'THE SELECTED ITEM '                                    67100000
MSG5LTH  EQU   *-MSG5                                                   67150000
MSG6     DC    AL2(MSG6LTH-4),X'0000'                                   67200000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    67250000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           67300000
         DC    C'BNG006I C INVALID FORMAT--CHECK PAGE 2 '            XH 67350000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 67400000
         DC    C'OF MENU FOR CORRECT FORMATS'                        XH 67450000
MSG6LTH  EQU   *-MSG6                                                   67500000
MSG7     DC    AL2(MSG7LTH-4),X'0000'                                   67550000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    67600000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           67650000
         DC    C'BNG007I C NO ERRORS RECORDED FOR REMOTE'            XH 67700000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           67750000
         DC    C'LINE '                                                 67800000
MSG7LINE DC    CL3' '                                                XH 67850000
         DC    C'    CONTROL UNIT '                                     67900000
MSG7CTRL DC    CL2' '                                                XH 67950000
MSG7LTH  EQU   *-MSG7                                                   68000000
MSG8     DC    AL2(MSG8LTH-4),X'0000'                                   68050000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC) XH 68100000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                        XH 68150000
         DC    C'BNG008I C NO ERRORS RECORDED FOR '                  XH 68200000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                        XH 68250000
         DC    C'LOCAL CONTROL UNIT '                                XH 68300000
MSG8CTRL DC    CL3' '                                                XH 68350000
MSG8LTH  EQU   *-MSG8                                                XH 68400000
MSG13    DC    AL2(MSG13LTH-4),X'0000'                         @OZ31885 68405007
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF'          @OZ31885 68410007
         DC    AL1(SF,UNA,IC),AL1(SBA),AL2(L2P1),AL1(SF,PNA)   @OZ31885 68415007
         DC    CL39'BNG013A C NO DATA BLOCKS AVAILABLE FOR '   @OZ31885 68420007
         DC    CL5'LINE '                                      @OZ31885 68425007
MSG13LN  DC    CL3' '                                          @OZ31885 68430007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31885 68435007
         DC    CL39' MUST ALLOCATE MORE BLOCKS THAN LINES'     @OZ31885 68440007
MSG13LTH EQU   *-MSG13                                         @OZ31885 68445007
*********************************************************************** 68450000
HDR3X    DC    AL1(SBA),AL2(L4P1)                                       68500000
HDR1X    DC    AL1(SBA),AL2(L2P1)                                       68550000
DTLENTRY DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'? ) '                     68600000
DTLITEM  DC    CL8' '                                                   68650000
         DC    AL1(SF,PNA)                                              68700000
DTLCOUNT DC    CL4'0001'                                                68750000
DTLLTH   EQU   *-DTLENTRY                                               68800000
ITEMLTH  EQU   DTLITEM-DTLENTRY                                         68850000
COUNTLTH EQU   DTLCOUNT-DTLENTRY                                        68900000
*********************************************************************** 68950000
*                                                                     * 69000000
*   THE FUNCTION/COMPANION TABLE DETERMINES WHICH PROGRAM IS TO WRITE * 69050000
*   THE REQUESTED DISPLAY AND PROVIDES THE CORRECT SCREEN AND COLUMN  * 69100000
*   HEADERS FOR THAT DISPLAY.                                         * 69150000
*                                                                     * 69200000
*********************************************************************** 69250000
TABLE    DS    0C                  FUNCTION/COMPANION TABLE             69300000
         DC    C'ALL',X'00',C'LINE',XL8'00',AL1(SF,PNA)                 69350000
         DC    CL39'    RECAP OF ALL LINES HAVING ERRORS',AL1(SF,PNA)   69400000
         DC    CL39'       LINEID  ERRS        LINEID  ERRS'            69450000
SLOT2    DC    C'LINECTRL',XL8'00',AL1(SF,PNA)                          69500000
         DC    CL17'    RECAP OF LINE',AL1(SF,PNA),CL20' ',AL1(SF,PNA)  69550000
         DC    CL39'      CTRLUNIT ERRS       CTRLUNIT ERRS'            69600000
         DC    C'CTRLTERM',XL8'00',AL1(SF,PNA)                          69650000
         DC    CL18'RECAP OF CTRL UNIT',AL1(SF,PNA),CL19' ',AL1(SF,PNA) 69700000
         DC    CL39'       TERMID  ERRS        TERMID  ERRS'            69750000
         DC    C'3270',XL4'00',C'BNGC3270',CL82' '                      69800000
         DC    C'LOCA',XL4'00',C'BNGCLOCL',CL82' '                      69850000
         DC    C'REMO',XL4'00',C'BNGCRMOT',CL82' '                      69900000
         DC    C'END'                                                   69950000
TABLELTH EQU   *-TABLE                                                  70000000
TABLENTY EQU   SLOT2-TABLE                                              70050000
HDR1     DS    0C                                                       70100000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF'                   70150000
         DC    AL1(SF,UNA,IC,SBA),AL2(L1P36),AL1(SF,MNP)                70200000
HDR1LTH  EQU   *-HDR1                                                   70250000
HDR2     DS    0C                                                       70300000
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        70350000
         DC    AL1(SF,PNA)                                              70400000
         DC    C') PAGE FORWARD '                                       70450000
         DC    CL20' '                                                  70500000
HDR2LTH  EQU   *-HDR2                                                   70550000
HDR3     DS    0C                                                       70600000
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        70650000
         DC    AL1(SF,PNA)                                              70700000
         DC    C') PAGE BACKWRD '                                       70750000
         DC    CL4' '                                                   70800000
         DC    AL1(SF,PIA)                                              70850000
         DC    CL15'BBBSSBBBSSBBBSS'     BBBSSBBBSSBBBSS BLOCK & SLOT   70900000
HDR3LTH  EQU   *-HDR3                                                   70950000
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   71000000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           71050000
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           71100000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            71150000
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      71200000
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     71250000
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  71300000
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     71350000
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  71400000
         DC    X'00000000000000000000000000000000'     50-5F    TO      71450000
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   71500000
         DC    X'00000000000000000000000000000000'     70-7F   AND      71550000
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   71600000
         DC    X'00000000000000000000000000000000'     90-9F    TO      71650000
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   71700000
         DC    X'00000000000000000000000000000000'     B0-BF    AND     71750000
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      71800000
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   71850000
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     71900000
         DC    X'00010203040506070809000000000000'     F0-FF            71950000
LOTOUP   DS    0C          LOWER CASE TO UPPER CASE TR TABLE            72000000
         DC    X'000102030405060708090A0B0C0D0E0F'                      72050000
         DC    X'101112131415161718191A1B1C1D1E1F'                      72100000
         DC    X'202122232425262728292A2B2C2D2E2F'                      72150000
         DC    X'303132333435363738393A3B3C3D3E3F'                      72200000
         DC    X'404142434445464748494A4B4C4D4E4F'                      72250000
         DC    X'505152535455565758595A5B5C5D5E5F'                      72300000
         DC    X'606162636465666768696A6B6C6D6E6F'                      72350000
         DC    X'707172737475767778797A7B7C7D7E7F'                      72400000
         DC    X'80C1C2C3C4C5C6C7C8C98A8B8C8D8E8F'                      72450000
         DC    X'90D1D2D3D4D5D6D7D8D99A9B9C9D9E9F'                      72500000
         DC    X'A0A1E2E3E4E5E6E7E8E9AAABACADAEAF'                      72550000
         DC    X'F0F1F2F3F4F5F6F7F8F9BABBBCBDBEBF'                      72600000
         DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      72650000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      72700000
         DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      72750000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      72800000
SLOTTTR  DC    C' '                                                     72850000
PATCH    DS    20F                                             @OX21950 72870007
         LTORG                                                          72900000
         END   BNGCDISP                                                 72950000
