         PRINT OFF                                                      00040007
         MACRO                                                          00040407
&NAME    BNGHJN &LABEL,&HJN                                             00040807
         LCLC  &HJA,&HJB                                                00041207
&HJA     SETC  '&SYSPARM'(1,4)                                          00041607
&HJB     SETC  '&SYSPARM'(5,4)                                          00042007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00042407
         B     &LABEL .                 BR AROUND CONSTANTS             00042807
         SPACE 2                                                        00043207
.NOBRNCH ANOP                                                           00043607
         AIF   ('&NAME' EQ '').NOLABEL                                  00044007
         DC    C'&NAME' .              MODULE IDENTIFIER                00044407
.NOLABEL ANOP                                                           00044807
         DC    X'&HJA' .                DATE OF MODIFICATION            00045207
         AIF   ('&HJN' NE 'HJN').DATE                                   00045607
         DC    X'&HJB' .                HJN OF MODIFICATION             00046007
.DATE    ANOP                                                           00046407
         AIF   ('&LABEL' EQ '').NOLBL                                   00046807
         SPACE 2                                                        00047207
&LABEL   DS    0H                                                       00047607
.NOLBL   ANOP                                                           00048007
         MEND                                                           00048407
         PRINT ON                                                       00048807
*********************************************************************** 00049207
*                                                                     * 00080068
* MODULE NAME = BNGI3270                                              * 00120068
*                                                                     * 00160068
* DESCRIPTIVE NAME =  IMS DEMF 3270 DISPLAY MODULE                    * 00200068
*                                                                     * 00240068
* COPYRIGHT = NONE                                                    * 00280068
*                                                                     * 00320068
* STATUS = RELEASE 1, LEVEL 1                                         * 00360068
*                                                                     * 00400068
* FUNCTION = 1) BNGI3270 IS LINKED TO BY BNGIDISP;                    * 00440068
*            2) HANDLES 3270 DISPLAY TERMINAL ERROR INFORMATION       * 00480068
*               REQUEST AND BITS PROMPTER REQUEST;                    * 00520068
*            2) LINKS TO BNGIREAD TO READ SYS1.DEMFLOG DATA FILE AND  * 00560068
*               COLLECTS THE REQUESTED 3270 ERROR INFORMATION FROM    * 00600068
*               IT;                                                   * 00640068
*            3) FORMS OUTPUT MESSAGE AND WRITES IT TO THE 3270 DISPLAY* 00680068
*               TERMINAL; (ERR INFO AND SOME OF DISPLAY MESSAGES)     * 00720068
*            4) RETURNS CONTROL TO BNGIDISP.                          * 00760068
*                                                                     * 00800068
* NOTES = NONE                                                        * 00840068
*                                                                     * 00880068
*    DEPENDENCIES = NONE                                              * 00920068
*                                                                     * 00960068
*    RESTRICTIONS = NONE                                              * 01000068
*                                                                     * 01040068
*    REGISTER CONVENTIONS :                                           * 01080068
*    --------------------                                             * 01120068
*                                                                     * 01160068
*    ALL DEMF RECORDING DISPLAY COMPONENTS USE STANDARD REGISTER      * 01200068
*    CONVENTIONS WITH THE EXCEPTION OF THE IMS DISPLAY COMPONENTS.    * 01240068
*    CERTAIN IMS MODULES USE ADDITIONAL REGISTERS AND THE LINK MACRO  * 01280068
*    FOR PASSING OR RETRIEVING DATA PARAMETER INFORMATION AND ARE     * 01320068
*    DETAILED BELOW:                                                  * 01360068
*                                                                     * 01400068
*     MODULE    REGISTER    CONTENTS.                                 * 01440068
*    --------   --------    ------------------------------------      * 01480068
*    BNGIDISP     R5        PASSES ADDRESS OF IMS PROGRAM             * 01520068
*                           COMMUNICATION BLOCK (PCB) TO              * 01560068
*                           BNGI3270, BNGIMENU, BNGILOCL, AND         * 01600068
*                           BNGIRMOT.                                 * 01640068
*                                                                     * 01680068
*                 R11       PASSES TO BNGIREAD THE ADDRESS OF A       * 01720068
*                           PARAMETER LIST CONTAINING:                * 01760068
*                                                                     * 01800068
*                          1) 4-BYTES - ADDRESS OF I/O AREA FROM      * 01840068
*                                       BNGIREAD                      * 01880068
*                                                                     * 01920068
*                          2) 3-BYTES - RELATIVE BLOCK ADDRESS TO     * 01960068
*                                       BE READ BY BNGIREAD           * 02000068
*                                                                     * 02040068
*                          3) 2-BYTES - STATUS OF READ FROM           * 02080068
*                                       BNGIREAD                      * 02120068
*                                                                     * 02160068
*                 R12      FOR BNGI3270, PASSES THE ADDRESS OF A      * 02200068
*                          COMMUNICATION AREA CONTAINING              * 02240068
*                          UP TO SIX EDITTED PARM FIELDS, SAVE        * 02280068
*                          AND WORK AREAS, AND THE INPUT MESSAGE.     * 02320068
*                                                                     * 02360068
*                          FOR BNGILOCL, BNGIRMOT, AND BNGIMENU;      * 02400068
*                          PASSES THE ADDRESS OF THE INPUT MESSAGE.   * 02440068
*                                                                     * 02480068
*    BNGIREAD    LINK TO BNGIDCBA       RETRIEVES THE ADDRESS OF THE  * 02520068
*                (ALIAS FOR BNGISIMS)   ADDRESS OF THE SYS1.DEMFLOG   * 02560068
*                                       DCB.                          * 02600068
*                                                                     * 02640068
*                 R11      RECEIVES ADDRESS OF PARAMETER LIST         * 02680068
*                          (SEE BNGIDISP R11 FOR LIST).               * 02720068
*                                                                     * 02760068
*    BNGI3270     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 02800068
*                                                                     * 02840068
*                 R11     PASSES TO BNGIREAD THE ADDRESS OF A         * 02880068
*                         PARAMETER LIST (SEE BNGIDISP R11 FOR LIST)  * 02920068
*                                                                     * 02960068
*                 R12     RECEIVES FROM BNGIDISP THE ADDRESS OF THE   * 03000068
*                         COMMUNICATION AREA (SEE BNGIDISP R12 FOR    * 03040068
*                         CONTENTS OF AREA).                          * 03080068
*                                                                     * 03120068
*    BNGIMENU     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03160068
*                                                                     * 03200068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 03240068
*                         BNGIDISP.                                   * 03280068
*                                                                     * 03320068
*    BNGILOCL     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03360068
*                                                                     * 03400068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 03440068
*                         BNGIDISP.                                   * 03480068
*                                                                     * 03520068
*    BNGIRMOT     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03560068
*                                                                     * 03600068
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 03640068
*                         BNGIDISP.                                   * 03680068
*                                                                     * 03720068
*    PATCH LABEL = NONE                                               * 03760068
*                                                                     * 03800068
* MODULE TYPE = IMS DISPLAY                                           * 03840068
*                                                                     * 03880068
*    PROCESSOR = ASSEMBLER H                                          * 03920068
*                                                                     * 03960068
*    MODULE SIZE = 9928 DECIMAL BYTES                                 * 04000068
*                                                                     * 04040068
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 04080068
*                                                                     * 04120068
* ENTRY POINT = BNGI3270                                              * 04160068
*                                                                     * 04200068
*    PURPOSE = SEE FUNCTION                                           * 04240068
*                                                                     * 04280068
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 04320068
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 04360068
*              R15 LOADED WITH ENTRY POINT                            * 04400068
*                                                                     * 04440068
* INPUT = PARAM LIST ITEMS USED ARE : COMMAREA (LABEL)                * 04480068
*                                                                     * 04520068
* OUTPUT = PARAM LIST ITEMS USED ARE : MSG3270 & MSGBITS (LABELS)     * 04560068
*                                                                     * 04600068
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 04640068
*               00 - OPERATION PERFORMED AS REQUESTED                 * 04680068
*                                                                     * 04720068
* EXIT-ERROR  = NONE                                                  * 04760068
*                                                                     * 04800068
* EXTERNAL REFERENCE = NONE                                           * 04840068
*                                                                     * 04880068
*    ROUTINES = LOCATE ROUTINE                                        * 04920068
*               GETTIOA ROUTINE (GET TERMINAL OUTPUT AREA)            * 04960068
*               BUOBR ROUTINE (BLOW-UP OBR ROUTINE)                   * 05000068
*               BUMDR ROUTINE (BLOW-UP MDR ROUTINE)                   * 05040068
*                                                                     * 05080068
*    DATA AREAS = NONE                                                * 05120068
*                                                                     * 05160068
*    CONTROL BLOCK = NONE                                             * 05200068
*                                                                     * 05240068
* TABLES = CALENDAR - CONVERT JULIAN DATE TO GREGORIAN DATE TABLE     * 05280068
*          LEAPTBL  - LEAP YEAR CALCULATION TABLE                     * 05320068
*          CCWTABL  - CONVERT 270X COMMAND CODE INTO ENGLISH          * 05360068
*          CSWTABL  - CONVERT LOCAL 327X STATUS OR 270X LINE STATUS   * 05400068
*                     INTO ENGLISH                                    * 05440068
*          SENSTABL - CONVERT 270X LINE SENSE CODE INTO ENGLISH       * 05480068
*          STATSTBL - CONVERT REMOTE 327X STATUS CODE INTO ENGLISH    * 05520068
*          SENS3272 - CONVERT LOCAL 327X SENSE CODE INTO ENGLISH      * 05560068
*          CCW3272  - CONVERT LOCAL 327X COMMAND CODE INTO ENGLISH    * 05600068
*          TPOPTBL  - CONVERT BTAM TP OP CODE INTO ENGLISH            * 05640068
*          IMSPTOP  - CONVERT TCAM TP OP CODE INTO ENGLISH            * 05680068
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 05720068
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 05760068
*                                                                     * 05800068
* MACROS = LINK, SAVE, RETURN, OPEN, READ, CHECK, CLOSE               * 05840068
*                                                                     * 05880068
***********************CHANGE ACTIVITY FOLLOWS:************************ 05920007
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 05920107
* CHANGE 02  03/23/78  BNGHJN MACRO ADDED                             * 05920207
*A109600,142000,353200,387200                                  @OZ31886 05920307
*D113600                                                       @OZ31886 05920407
*                                                                     * 06000068
*********************************************************************** 06040068
*********************************************************************** 06080068
BNGI3270 TITLE 'DISPLAY 3270 MDR AND OBR ENTRIES'                       06120068
*********************************************************************** 06160068
         SPACE                                                          06200068
PCB      DSECT                 MAP OF IMS PROGRAM COMMUNICATION BLOCK   06240068
         USING *,PCBREG          ADDRESS PASSED IN REGISTER 5 BY DISP   06280068
PCBTERMN DS    CL8                 REQUESTING TERMINAL SYMBOLIC NAME    06320068
         DS    CL2                 RESERVED                             06360068
PCBSTAT  DS    CL2                 DL/I STATUS CODE                     06400068
PCBDATE  DS    PL4                 TRANSACTION DATE STAMP 00YYDDDF      06440068
PCBTIME  DS    PL4                 TRANSACTION TIME STAMP HHMMSSTH      06480068
PCBSEQ   DS    F                   TRANSACTION SEQUENCE NUMBER          06520068
PCBMODNM DS    CL8                 MFS MESSAGE OUTPUT DESCRIPTOR NAME   06560068
*********************************************************************** 06600068
COMMAREA DSECT       MAP OF COMMUNICATION AREA PASSED TO THIS PGM       06640068
         USING *,COMMREG      IN REGISTER 12 BY DISP                    06680068
PARM1    DS    D                   1ST INPUT PARM - DEMF                06720068
PARM2    DS    D                   2ND INPUT PARM - 3270                06760068
PARM3    DS    D                   3RD INPUT PARM - LLL OR TTT          06800068
PARM4    DS    D                   4TH INPUT PARM - CC                  06840068
PARM5    DS    D                   5TH INPUT PARM - TT                  06880068
PARM6    DS    D                   6TH INPUT PARM - TT                  06920068
FLDCNT   DS    PL1                 COUNT OF FLD'S KEYED-IN IN INPUT     06960068
SVRELREC DS    CL3           SAVE AREA FOR LINE/CTRL RELATIVE BLOCK NO. 07000068
SAVEBBSS DS    F                   SAVE POINTER TO BLK AND SLOT         07040068
DBLWD    DS    D                   DOUBLEWORD WORK AREA                 07080068
DUBLWD   EQU   DBLWD                                                    07120068
FULLWD   DS    F                   FULLWORD WORK AREA                   07160068
TWATCTID DS    D             SAVE AREA FOR IMS SYMBOLIC LINE POINTER    07200068
* THE FOLLOWING AREAS ARE USED AS INPUT AREA FOR                        07240068
* TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                          07280068
         SPACE                                                          07320068
MSGIN    DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      07360068
TIOATDL  DS    H                   MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   07400068
MSGZ1    DS    X                   FLAG FIELD - USED BY IMS INTERNALLY  07440068
MSGZ2    DS    X                   FLAG FIELD - NON-ZERO IF MFS EDITED  07480068
TIOADBA  DS    0F                  START OF MESSAGE DATA                07520068
MSGTXCD  DS    CL5                                                      07560068
MSGKEYED DS    CL29                                                     07600068
MSGCMDCD DS    CL4                                                      07640068
MSGPGF   DS    C                                                        07680068
MSGID    DS    CL20                                                     07720068
MSGPGB   DS    C                                                        07760068
MSGBBBSS DS    CL15                                                     07800068
MSGNTRY  DS    CL9                                                      07840068
MSGEND   DS    39CL9                                                    07880068
********************************************************************    07920068
         SPACE                                                          07960068
DATASLOT DSECT                 MAP OF MDR AND OBR ENTRIES IN DETL BLK   08000068
         USING *,DATAREG                                                08040068
DATALTH  DS    C                   LTH OF THIS SLOT                     08080068
LINEID   DS    CL6                 LINE AND LIB ADDR                    08120068
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              08160068
         DS    CL3                                                      08200068
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           08240068
         DS    CL3                                                      08280068
DATE     DS    CL4                 DATE OF ERROR - 00YYDDDF             08320068
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             08360068
         DS    CL8                                                      08400068
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 08440068
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              08480068
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 08520068
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   08560068
         DS    CL2                                                      08600068
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    08640068
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  08680068
         DS    CL6                                                      08720068
OBRUCB   DS    C                                                        08760068
         DS    CL3                                                      08800068
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 08840068
OBRCTRL  DS    C                   REMOTE LINE ERRORS UNDER CTRLUNIT    08880068
OBRTERM  DS    C                   REMOTE LINE ERRORS UNDER TERMINAL    08920068
         DS    CL12                                                     08960068
OBRSENSE DS    CL2                 OBR SENSE BYTES                      09000068
         SPACE                                                          09040068
         ORG   DATALTH         MAP OF 16-BYTE SLOT IN CONTROL BLOCK     09080068
CTRLPORT DS    CL6                 PORT & LIB ADDRESS                   09120068
         DS    CL4                 BLOCKS AND HITS                      09160068
CTRLFRST DS    CL3                 REL BLK ADDR 1ST BLK IN CHAIN.       09200068
         DS    CL3                 REL BLK ADDR LAST BLK IN CHAIN       09240068
SLOTLTH  EQU   *-CTRLPORT                                               09280068
FIOADBA  DSECT                 MAP OF 32-BYTE HEADER IN CONTROL BLOCK   09320068
         USING *,FIOABAR                                                09360068
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            09400068
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              09440068
CTRLBACK DS    F                &  BACKWARD PTR IN CTRL BLK CHAIN       09480068
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        09520068
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         09560068
         DS    CL15                FOR FUTURE USE                       09600068
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          09640068
         SPACE                                                          09680068
         ORG   FIOADBA         MAP OF 32-BYTE HEADER IN DETAIL BLOCK    09720068
DATAPORT DS    CL6                 PORT & LIB ADDR                      09760068
DATATIME DS    CL4                 TIME BLOCK CREATED                   09800068
DATADATE DS    CL4                 DATE BLOCK CREATED                   09840068
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   09880068
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   09920068
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         09960068
         DS    CL10                                                     10000068
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               10040068
*********************************************************************** 10080068
BNGI3270 CSECT                                                          10120068
*********************************************************************** 10160068
R1       EQU   1                                                        10200068
BASE1    EQU   2                   1ST PROGRAM BASE REG.                10240068
BASE2    EQU   3                   2ND PROGRAM BASE REG.                10280068
BASE3    EQU   4                   3RD PROGRAM BASE REG.                10320068
PCBREG   EQU   5                PTR TO TP-PCB PASSED HERE               10360068
FIOABAR  EQU   6                   FIOA POINTER.                        10400068
DATAREG  EQU   7                   POINTER TO DATA IN EMF FILE BLOCK.   10440068
DATALOOP EQU   8                   LOOP REG FOR PROCESSING WITH DATAREG 10480068
OUTREG   EQU   9                   POINTER TO VARIABLE AREA IN TIOA.    10520068
OUTLOOP  EQU   10                  LOOP REG FOR PROCESSING WITH OUTREG. 10560068
LINKREG  EQU   11                  LINKAGE TO COMMON SUBROUTINES.       10600068
COMMREG  EQU   12               PTR TO COMMUNICATIONS AREA PASSED HERE  10640068
R13      EQU   13                                                       10680068
*********************************************************************** 10720068
* THIS SECTION DOES PROGRAM INITIALIZATION                              10760068
*********************************************************************** 10800068
         SAVE  (14,12)             SAVE CALLER'S REGISTERS              10880068
         BALR  BASE1,0                                                  10920068
         USING *,BASE1,BASE2,BASE3                                      10960068
BNGI3270 BNGHJN SKIPID                                         @OZ31886 10980007
         LA    BASE2,2048(BASE1)    SET SECOND BASE                     11000068
         LA    BASE2,2048(BASE2)       FROM THE FIRST                   11040068
         LA    BASE3,2048(BASE2)    SET THIRD BASE                      11080068
         LA    BASE3,2048(BASE3)       FROM THE SECOND                  11120068
         LA    14,SAVE             POINT TO OUR SAVE AREA               11160068
         ST    14,8(13)            FORWARD CHAIN FROM OLD               11200068
         ST    13,4(14)            BACKWARD CHAIN TO OLD                11240068
         LR    13,14               FIRST BASE AND S/A FOR OUR REGS      11280068
         B     A001                                                     11320068
SAVE     DS    18F                 SAVE AREA                            11400068
*******                                                                 11440068
*********************************************************************** 11480068
* THIS SECTION  RETURNS TO BNGIDISP  *                                  11520068
         EJECT                                                          11560068
*********************************************************************** 11600068
* THIS IS A COMMON READ SUBROUTINE FOR THIS PROGRAM.                    11640068
*********************************************************************** 11680068
READ     ST    11,SAVE11                                                11720068
         LA    11,PARMADDR         SET UP PARM REG                      11760068
         L     15,=V(BNGIREAD)    POINT TO READ MODULE                  11800068
         BALR  14,15              LINK TO BDAM READ MODULE              11840068
         L     11,SAVE11                                                11880068
         OC    STATUS,STATUS      READ OK?                              11920068
         BZ    0(LINKREG)         YES. RETURN TO CALLER                 11960068
         CLC   STATUS,=C'FF'       WAS EMFILE OPENED?                   12000068
         BE    Z60                 NO.  WRITE 'NOT OPEN' MSG            12040068
         UNPK  DBLWD,STATUS(3)                                          12080068
         MVC   IOERCODE,DBLWD+3                                         12120068
         TR    IOERCODE,HXTOEB     MOVE BDAM RETURN CODE TO I/O ERR MSG 12160068
         UNPK  DBLWD,RELREC(4)                                          12200068
         MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     12240068
         TR    IOERBLK,HXTOEB                                           12280068
         B     Z20                     IF REQUESTED SLOT CAN'T          12320068
*                                        BE FOUND, SEND 'SEARCHING ERR' 12360068
SAVE11   DS    F                                                        12400068
*********************************************************************** 12440068
*********************************************************************** 12480068
A001     CP    FLDCNT,=P'0'        WAS DATA KEYED-IN?                   12520068
         BE    J010                NO. GO EXAMINE INPUT FURTHER.        12560068
A010     XC    RELREC,RELREC       YES. THIS IS A NEW RECAP REQUEST.    12600068
         OC    PARM3,PARM3         WAS LINE ID INPUT?                   12640068
         BZ    Z40                 NO. SEND 'INVALID INPUT' MSG.        12680068
B140     MVC   DUBLWD+5(3),PARM3                                        12720068
         TR    DUBLWD,EBTOHX            GET LINE,                       12760068
         PACK  DUBLWD(3),DUBLWD+5(4)    CONTROL UNIT,                   12800068
         MVC   HEXLINE,DUBLWD           AND                             12840068
         MVC   DUBLWD+5(3),PARM4        TERMINAL                        12880068
         TR    DUBLWD,EBTOHX            ADDRESS                         12920068
         PACK  DUBLWD(2),DUBLWD+5(3)    INTO HEX                        12960068
         MVC   HEXCTRL,DUBLWD           FORMAT                          13000068
         MVC   DUBLWD+5(3),PARM5        FOR COMPARING                   13040068
         TR    DUBLWD,EBTOHX            TO DATA IN                      13080068
         PACK  DUBLWD(2),DUBLWD+5(3)    DISK FILE.                      13120068
         MVC   HEXTERM,DUBLWD                                           13160068
         MVC   LGBBBSS,=C'BBBSSBBBSSBBBSS'   INITIALIZE PAGING BBBSS'S  13200068
         MVC   SMBBBSS,=C'BBBSSBBBSSBBBSS'   INITIALIZE PAGING BBBSS'S  13240068
         BAL   LINKREG,GETTIOA     SETUP NEW OUTPUT AREA WITH HDRS.     13280068
D080     BAL   LINKREG,READ                                             13320068
D190     L     FIOABAR,IOAREA      POINT TO FILE I/O AREA.              13360068
         SR    DATALOOP,DATALOOP   SETUP TO LOOP ON NBR OF              13400068
         IC    DATALOOP,CTRLENTS   ENTRIES IN THIS CNTRL BLK.           13440068
         LTR   DATALOOP,DATALOOP   VERIFY THAT THE DATA SET             13480068
         BZ    Z50                 IS NOT EMPTY. IF SO, WRT NO ERRS MSG 13520068
E030     LA    DATAREG,CTRLSLT1    POINT TO FIRST CTRL SLOT.            13560068
E040     OC    PARM4,PARM4         WAS A CTRL UNIT ADDR INPUT?          13600068
         BNZ   E110                YES. LINE ID IS CORRECT.             13640068
         XC    DUBLWD,DUBLWD       NO. THIS MUST BE RQST FOR LOCAL.     13680068
         MVC   DUBLWD(3),HXLINLIB  ROUND CUA ADDR DOWN                  13720068
         NI    DUBLWD+2,B'11100000'     TO EVEN CHAN ADDR.              13760068
         CLC   DUBLWD(6),CTRLPORT       LOOK FOR EQUAL LINE ADDRESS.    13800068
         B     E120             &                                       13840068
E110     CLC   HXLINLIB,CTRLPORT   IS THIS SLOT = RQSTD LINE ADDR?      13880068
E120     BE    E200                YES. GO READ ITS DATA BLOCK.         13920068
         LA    DATAREG,SLOTLTH(DATAREG)  NO. BUMP TO NEXT CTRL SLOT.    13960068
         BCT   DATALOOP,E040            MORE SLOTS TO LOOK AT?          14000068
         OC    CTRLBACK,CTRLBACK        NO. IS THERE ANOTHER CTRL BLK?  14040068
         BZ    Z50                           NO. SEND 'NO ERRS' MSG.    14080068
         MVC   RELREC,CTRLBACK+1        YES. SAVE NEXT BLOCK ADDR.      14120068
         B     D080                                                     14160068
E200     MVC   RELREC,CTRLFRST     MOVE DATA BLOCK ADDR.                14200068
         OC    RELREC,RELREC       IS THERE ANY DATA BLOCKS ?  @OZ31886 14210007
         BZ    T190                NO, WRITE 'NO DATA BLKS MSG'@OZ31886 14220007
F020     DS    0H                                                       14240068
         BAL   LINKREG,READ                                             14280068
F050     L     FIOABAR,IOAREA      POINT TO DATA BLOCK.                 14320068
         XC    TWASLOT,TWASLOT     INITIALIZE SLOT COUNT TO 1.          14360068
         LH    DATALOOP,BLKLTH     SETUP TO LOOP ON NBR BYTES IN REC.   14400068
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM.            14440068
F080     SR    14,14                                                    14480068
         IC    14,TWASLOT          PUT SLOT COUNT IN REG 14             14520068
         LA    14,1(14)            ADD 1 TO SLOT COUNT                  14560068
         STC   14,TWASLOT          STORE BACK                           14600068
F090     CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN MDR RECORD?         14640068
         BNE   H060                NO. TEST FURTHER.                    14680068
         CLI   MDRTYPE,X'03'       YES. IS IT A 3270?                   14720068
         BE    G060                YES. TEST FURTHER.                   14760068
F120     SR    1,1                 NO. BUMP                             14800068
         IC    1,0(DATAREG)        TO NEXT DATA ITEM.                   14840068
         LTR   1,1                 PREVENT ENDLESS LOOP                 14880068
         BZ    F240                IN CASE GARBAGE IN RECORD.           14920068
         AR    DATAREG,1                                                14960068
         SR    DATALOOP,1          ALL DONE WITH THIS BLOCK?            15000068
         LTR   DATALOOP,DATALOOP                                        15040068
         BP    F080                NO. PROCESS NEXT ITEM.               15080068
         OC    DATAFWD,DATAFWD     YES. IS THERE ANOTHER BLOCK?         15120068
         BZ    F240                NO. GO WIND UP OUTPUT.               15160068
         MVC   RELREC,DATAFWD      YES. GET CHAIN ADDR AND              15200068
         B     F020                GO READ NEXT BLOCK.                  15240068
*********************************************************************** 15280068
*    PREPARE TO WRITE SCREEN AND RETURN                   ************* 15320068
*********************************************************************** 15360068
F240     CLI   OUTSWCH,X'FF'       WAS ANY OUTPUT CREATED?              15400068
         BNE   Z50                 NO. SEND 'NO ERRS' MSG.              15440068
G020     CALL  ASMTDLI,(ISRT,(PCBREG),MSG3270,S3270),VL                 15480068
CHECKST  CLC   PCBSTAT,DLIOK       DID ISRT GO OK?                      15520068
         BNE   ABEND1              IF NOT, ABEND, ELSE RETURN TO CALLER 15560068
         L     R13,4(R13)          RESTORE INCOMING SAVE AREA ADDRESS   15600068
         RETURN (14,12)            RELINQUISH CONTROL                   15640068
ABEND1   ABEND 666,DUMP                                                 15680068
*********************************************************************** 15720068
G060     CLC   MDRCTRL,HEXCTRL     IS THIS MDR FOR RQSTED CTRL UNIT?    15760068
         BNE   F120                NO. SKIP IT.                         15800068
         CLC   MDRTERM,HEXTERM     YES. IS IT FOR REQUESTED TERML?      15840068
         BNE   F120                NO. SKIP IT.                         15880068
         MVC   0(MDRLTH,OUTREG),MDRHDR   YES. SETUP BUILD 1 MDR LINE.   15920068
         UNPK  DUBLWD,MDRSTATS(3)                                       15960068
         TR    DUBLWD,HXTOEB       FILL IN REMOTE STATUS BYTES.         16000068
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                      16040068
G100     UNPK  DUBLWD,RELREC(4)                                         16080068
         TR    DUBLWD,HXTOEB       FILL IN THIS BLK NBR.                16120068
         MVC   (MDRBBBSS-MDRHDR)(3,OUTREG),DUBLWD+4                     16160068
         UNPK  DUBLWD,TWASLOT(2)                                        16200068
         TR    DUBLWD,HXTOEB       FILL IN THIS SLOT NBR.               16240068
         MVC   (MDRBBBSS+3-MDRHDR)(2,OUTREG),DUBLWD+5                   16280068
         LA    14,LGBBBSS       POINT TO OUTPUT PAGING BBBSS FIELDS.    16320068
         CLC   0(5,14),=C'BBBSS' IS 'FIRST' FILLED IN?                  16360068
         BNE   G200             YES. SKIP IT.                           16400068
         MVC   0(5,14),(MDRBBBSS-MDRHDR)(OUTREG) NO. DO IT.             16440068
         CLC   10(5,14),=C'BBBSS' HOW ABOUT 'PREV'?                     16480068
         BNE   G200             ALREADY THERE; SKIP IT.                 16520068
         MVC   10(5,14),0(14)  NO. USE 'FIRST'                          16560068
G200     MVC   5(5,14),(MDRBBBSS-MDRHDR)(OUTREG)  FILL IN 'LAST' BBBSS  16600068
         CLI   QUITSW,X'FF'       IS 3277-1 SCREEN FULL?                16640068
         BE    G220               YES.                                  16680068
         MVC   SMBBBSS,LGBBBSS    NO. SO DO SAME FOR 3277-1 PAGE BBBSS  16720068
G220     UNPK  DUBLWD,TIME                                              16760068
         MVC   (MDRHRS-MDRHDR)(2,OUTREG),DUBLWD+1   FILL IN HOURS       16800068
         MVC   (MDRMINS-MDRHDR)(2,OUTREG),DUBLWD+3     AND MINUTES.     16840068
G230     MVI   OUTSWCH,X'FF'       INDICATE SOME OUTPUT WAS CREATED.    16880068
         CP    DATE,PCBDATE        DID THIS ERROR HAPPEN TODAY?         16920068
         BE    G240                YES,BR HIGH INTENSITY                16960068
         MVC   DATDATE,PCBDATE     MOVE PCB DATE TO WORK AREA           17000068
         SP    DATDATE,=P'1'       MAKE DATE YESTERDAY                  17040068
         CP    DATE,DATDATE        DID IT HAPPEN YESTERDAY              17080068
         BNE   G230A               NO,BR LEAVE INTENSITY NORMAL         17120068
         CLC   TIME,PCBTIME        IS IT OLDER THAN 24 HRS?             17160068
         BNL   G240                NO,BR MAKE IT HIGH INTENSITY         17200068
G230A    LA    R1,LEAPTBL                                               17240068
G231     CLC   DATE+1(1),0(1)      SEE IF                               17280068
         BE    G232                ERROR HAPPENED                       17320068
         LA    R1,1(R1)            IN LEAP YEAR                         17360068
         CLI   0(R1),X'FF'         IS IT END OF TABLE                   17400068
         BNE   G231                NO,BR TRY NEXT YEAR                  17440068
         ZAP   CALENDAR+8(2),=P'28' NOT LEAP YEAR                       17480068
         B     G233                CONTINUE                             17520068
G232     ZAP   CALENDAR+8(2),=P'29' YES,LEAP YEAR                       17560068
G233     LA    15,CALENDAR                                              17600068
G234     MVN   DATE+3(1),=X'0C'    MAKE SURE SIGN IS CORRECT            17640068
         CLC   DATE+2(2),3(15)    COMPUTE MONTH                         17680068
         BNH   G235                AND DAY FROM                         17720068
         SP    DATE+2(2),3(2,15)  DAY NUMBER                            17760068
         LA    15,5(15)                                                 17800068
         B     G234                                                     17840068
G235     MVC   (MDRHRS-MDRHDR)(3,OUTREG),0(15)  MOVE MONTH AND          17880068
         UNPK  (MDRMINS-MDRHDR)(2,OUTREG),DATE+2(2)   DAY TO OUTPUT     17920068
         OI    (MDRMINS+1-MDRHDR)(OUTREG),X'F0'                         17960068
         B     H030                                                     18000068
G240     MVC   0(2,OUTREG),PHN     YES. MAKE IT HIGH INTENSITY.         18040068
         MVC   3(2,OUTREG),UHA       YES. MAKE IT HIGH INTENSITY.       18080068
         MVC   14(2,OUTREG),PHN        YES. MAKE IT HIGH INTENSITY.     18120068
H030     LA    OUTREG,MDRLTH(OUTREG)    BUMP TO NEXT OUTPUT SLOT.       18160068
         BCT   OUTLOOP,F120        MORE TIOA ROOM LEFT?                 18200068
         CLI   QUITSW,X'FF'        OUTPUT AREA FILLED FOR 3277-2?       18240068
         BE    G020                YES. GO WIND UP OUTPUT               18280068
         MVI   QUITSW,X'FF'        NO. TURN ON OUTPUTING-FOR-3277-2 SW. 18320068
         LA    OUTLOOP,33          SET UP OUTPUT COUNTER                18360068
         LA    14,SMBBBSS          FILL IN 'LAST' BLK & SLOT ADDR       18400068
         UNPK  DUBLWD,RELREC(4)       FOR 3277-1                        18440068
         TR    DUBLWD,HXTOEB                                            18480068
         MVC   5(3,14),DUBLWD+4                                         18520068
         UNPK  DUBLWD,TWASLOT(2)                                        18560068
         TR    DUBLWD,HXTOEB                                            18600068
         MVC   8(2,14),DUBLWD+5                                         18640068
         B     F120                GO PROCESS MORE SLOTS.               18680068
*********************************************************************** 18720068
H060     CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                18760068
         BE    F120                NO. SKIP IT.                         18800068
         CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?               18840068
         BNE   H080                NO. BYPASS CHECKING POLL CHARS       18880068
         CLC   OBRCTRL,HEXCTRL     IS IT THE REQUESTED CTRL UNIT ?      18920068
         BNE   F120                NO. SKIP IT.                         18960068
         CLC   OBRTERM,HEXTERM     IS IT THE REQUESTED TERMINAL ?       19000068
         BNE   F120                NO. SKIP IT.                         19040068
H080     CLC   OBRCUA,HEXLINE      YES. IS IT THE REQUESTED CUA ADDR?   19080068
         BNE   F120                NO. SKIP IT.                         19120068
         MVC   0(MDRLTH,OUTREG),MDRHDR  YES. SETUP COMMON MDR/OBR HDR.  19160068
         UNPK  DUBLWD,OBRCSW+4(3)                                       19200068
         TR    DUBLWD,HXTOEB       FILL IN CSW BYTES                    19240068
         MVC   (OBRSNS-MDRHDR)(4,OUTREG),DUBLWD+3                       19280068
         UNPK  DUBLWD,OBRSENSE(3)                                       19320068
         TR    DUBLWD,HXTOEB       FILL IN SENSE BYTES.                 19360068
         MVC   (MDRSTAT-MDRHDR)(4,OUTREG),DUBLWD+3                      19400068
         NI    OBRCCW+5,X'3F'      CLEAN UP TP OP CODE.                 19440068
         UNPK  DUBLWD,OBRCCW+5(2)                                       19480068
         TR    DUBLWD,HXTOEB       FILL IN TP OP CODE.                  19520068
         MVC   (OBRTPOP+1-MDRHDR)(2,OUTREG),DUBLWD+5                    19560068
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'B'                          19600068
         CLI   ENTRYTYP,X'34'      IS THIS A TCAM OBR?                  19640068
         BNE   J005                NO. LEAVE 'B' IN FOR BTAM            19680068
         MVI   (OBRTPOP-1-MDRHDR)(OUTREG),C'T'    T=TCAM                19720068
J005     UNPK  DUBLWD,OBRCCW(2)                                         19760068
         TR    DUBLWD,HXTOEB       FILL IN CHANL COMMAND.               19800068
         MVC   (OBRCMD-MDRHDR)(2,OUTREG),DUBLWD+5                       19840068
         B     G100                GO FILL IN DATA COMMON TO MDR/OBR.   19880068
*********************************************************************** 19920068
*     THIS SECTION DOES PAGING                         **************** 19960068
*********************************************************************** 20000068
J010     CLC   MSGNTRY(4),=C'BITS'   IS THIS A RETURN FROM BITS         20040068
*                                       PROMPTER SCREEN.                20080068
         BE    J140                  YES.                               20120068
J050     CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            20160068
         BNE   L160                NO. MUST BE 'BLOWUP' REQUEST.        20200068
         CLC   PARM5(7),=C'FORWARD'      IS IT PAGE FORWARD?            20240068
         BNE   J190                NO. MUST BE PAGE BACKWARD.           20280068
*********************************************************************** 20320068
*      PAGE FORWARD SECTION                       ********************* 20360068
*********************************************************************** 20400068
J080     MVC   LGBBBSS(5),MSGBBBSS+5    PROMOTE LAST & FIRST FROM OLD   20440068
         MVC   LGBBBSS+10(5),MSGBBBSS        TO NEW FIRST & PREVIOUS.   20480068
         MVC   SMBBBSS,LGBBBSS       DO THE SAME FOR SMALL BBBSS'S      20520068
         TR    MSGBBBSS+5(5),EBTOHX     GET OLD 'LAST' BLK              20560068
         PACK  DUBLWD,MSGBBBSS+5(6)                 AND SLOT IN HEX.    20600068
J110     MVC   RELREC,DUBLWD+3     SETUP TO READ APPROPRIATE BLK.       20640068
         MVC   TWASLOT(1),DUBLWD+6  SETUP TO LOCATE APPROPRIATE SLOT.   20680068
         B     K010       GO READ BLK WHERE DISPLAY WILL RESUME.        20720068
*********************************************************************** 20760068
*      RECREATE PREVIOUS SCREEN FROM BITS PROMPTER      *************** 20800068
*********************************************************************** 20840068
J140     MVC   LGBBBSS(5),MSGBBBSS    RESTORE OLD 'FIRST' AND           20880068
         MVC   LGBBBSS+10(5),MSGBBBSS+10       PREVIOUS.                20920068
         MVC   SMBBBSS,LGBBBSS       DO THE SAME FOR SMALL BBBSS'S      20960068
         TR    MSGBBBSS(5),EBTOHX      GET OLD 'FIRST' ADDRESS          21000068
         PACK  DUBLWD,MSGBBBSS(6)           AND SLOT IN HEX.            21040068
         B     J110                                                     21080068
*********************************************************************** 21120068
*      PAGE BACKWARD SECTION                      ********************* 21160068
*********************************************************************** 21200068
J190     MVC   LGBBBSS(5),MSGBBBSS+10  OLD 'PREVIOUS' NOW BECOMES NEW   21240068
         MVC   LGBBBSS+10(5),LGBBBSS       'FIRST' AND 'PREVIOUS'       21280068
         MVC   SMBBBSS,LGBBBSS       DO THE SAME FOR SMALL BBBSS'S      21320068
         TR    MSGBBBSS+10(5),EBTOHX    GET OLD 'PREVIOUS'              21360068
         PACK  DUBLWD,MSGBBBSS+10(6)             IN HEX.                21400068
         B     J110                                                     21440068
*********************************************************************** 21480068
*      LOCATE SLOT FOR PAGING                     ********************* 21520068
*********************************************************************** 21560068
K010     BAL   LINKREG,LOCATE      LOCATE SLOT TO RESUME AT.            21600068
         XC    PARM4(16),PARM4     ZERO OUT INPUT PARMS.                21640068
         CLI   ENTRYTYP,X'91'     IS THIS AN MDR?                       21680068
         BE    K020               YES. LINE ADDR IS OK.                 21720068
         XC    HXLINLIB,HXLINLIB  NO. DON'T USE ROUNDED DOWN ADDR.      21760068
         MVC   HXLINLIB+1(2),OBRCUA  GET ACTUAL CUA INSTEAD.            21800068
         B     K030                                                     21840068
K020     MVC   HXLINLIB,LINEID                                          21880068
K030     UNPK  DUBLWD,HEXLINE(3)   RESTORE LINE NBR FROM DATA           21920068
         TR    DUBLWD,HXTOEB       BLOCK AS IF IT HAD BEEN KEYED IN.    21960068
         MVC   PARM3(3),DUBLWD+4                                        22000068
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR RECORD?               22040068
         BNE   L110                NO. SKIP POLLING CHARS.              22080068
         MVC   HEXCTRL,MDRCTRL     YES.                                 22120068
         MVC   HEXTERM,MDRTERM     RESTORE CTRL UNIT ADDR               22160068
         UNPK  DUBLWD,HEXCTRL(3)   AND TERMINAL ADDR                    22200068
         TR    DUBLWD,HXTOEB       AS IF THEY HAD                       22240068
         MVC   PARM4(2),DUBLWD+3   BEEN KEYED IN.                       22280068
         MVC   PARM5(2),DUBLWD+5                                        22320068
         B     L130                                                     22360068
L110     CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?               22400068
         BNE   L130                NO. SKIP POLL CHARS                  22440068
         MVC   HEXCTRL,OBRCTRL     YES.                                 22480068
         MVC   HEXTERM,OBRTERM     RESTORE CTRL UNIT ADDR               22520068
         UNPK  DUBLWD,HEXCTRL(3)   AND TERMINAL ADDR                    22560068
         TR    DUBLWD,HXTOEB       AS IF THEY HAD                       22600068
         MVC   PARM4(2),DUBLWD+3   BEEN KEYED IN.                       22640068
         MVC   PARM5(2),DUBLWD+5                                        22680068
L130     BAL   LINKREG,GETTIOA     SETUP OUTPUT AREA WITH HEADERS.      22720068
         B     F090                   GO BUILD ANOTHER PAGE.            22760068
*********************************************************************** 22800068
*     BITS PROMPTER OR COMPANION REQUEST?     ************************* 22840068
*********************************************************************** 22880068
L160     CLC   PARM2(4),=C'TERM'   IS THIS A 'COMPANION' INPUT?         22920068
         BE    L200                YES. GO HUNT FOR CTRL & LINE ADDR.   22960068
*                                                                       23000068
*     BITS PROMPTER  REQUEST      *************************             23040068
*                                                                       23080068
         OC    MSGNTRY+4(5),MSGNTRY+4    WAS ANY ERRORS SELECTED?       23120068
         BZ    J080                       NO. DO A PAGE FORWARD.        23160068
         TR    MSGNTRY+4(5),EBTOHX     YES. GET REQUESTED ITEM ADDR.    23200068
         PACK  DUBLWD,MSGNTRY+4(6)            AND SLOT NUMBER.          23240068
         MVC   RELREC,DUBLWD+3                INTO HEX.                 23280068
         MVC   TWASLOT(1),DUBLWD+6                                      23320068
         BAL   LINKREG,LOCATE      LOCATE APPROPRIATE SLOT IN DATA BLK. 23360068
         B     M010                                                     23400068
*********************************************************************** 23440068
*      PREPARE TO DO 3270 SCREEN FROM COMPANION 'CTRL' DISPLAY    ***** 23480068
*********************************************************************** 23520068
L200     TR    MSGBBBSS,EBTOHX  MSGBBBSS IS BBBSS OF CTRL UNIT DISPLAY. 23560068
         PACK  DUBLWD,MSGBBBSS(6)  GET ITS BLK & SLT IN HEX.            23600068
         MVC   RELREC,DUBLWD+3                                          23640068
         MVC   TWASLOT(1),DUBLWD+6                                      23680068
         BAL   LINKREG,LOCATE      LOCATE BLK & SLOT OF PREVIOUS DISPLY 23720068
         XC    PARM3,PARM3         ERASE BBBSS GARBAGE.                 23760068
         UNPK  PARM3(4),DATAPORT+1(3)   MOVE LINE ADDR FROM RECORD.     23800068
         MVI   PARM3+3,X'00'                                            23840068
         TR    PARM3,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   23880068
         XC    PARM4,PARM4         INDICATE A LOCAL TERMINAL IF OBR.    23920068
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR?                      23960068
         BNE   L280                NO. SKIP POLLING CHARACTERS.         24000068
         UNPK  PARM4(3),MDRCTRL(2)  GET CTRL UNIT POLL CHAR.            24040068
         MVI   PARM4+2,X'00'                                            24080068
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   24120068
         XC    PARM5,PARM5         ZERO-OUT PARM5                       24160068
         MVC   PARM5(2),MSGNTRY+4  MAKE PARM5 LIKE IT WAS KEYED IN      24200068
         B     A010                                                     24240068
L280     CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?               24280068
         BE    L290                YES.                                 24320068
         MVC   PARM3,MSGNTRY+4     UNROUND TERML ADDRESS-A LOCAL TERM   24360068
         B     A010                                                     24400068
L290     UNPK  PARM4(3),OBRCTRL(2) GET CTRL UNIT POLL CHAR.             24440068
         MVI   PARM4+2,X'00'                                            24480068
         TR    PARM4,HXTOEB        MAKE IT LOOK LIKE IT WAS KEYED IN.   24520068
         XC    PARM5,PARM5         ZERO-OUT PARM5                       24560068
         MVC   PARM5(2),MSGNTRY+4  MAKE PARM5 LIKE IT WAS KEYED IN      24600068
         B     A010                                                     24640068
*********************************************************************** 24680068
*      PREPARE 'TIME AND DATE' FOR BITS PROMPTER SCREEN       ********* 24720068
*********************************************************************** 24760068
M010     MVI   MSGBDATA,C' '                                            24800068
         MVC   MSGBDATA+1(219),MSGBDATA   CLEAR OUTPUT AREA 320 BYTES   24840068
         MVC   MSGBDATA+220(100),MSGBDATA   FINISH CLEARING OUTPUT      24880068
         MVC   BITBBBSS,MSGBBBSS          MOVE BBBSS TO BITS PROMPTER   24920068
         MVC   MSGBID,MSGID               MOVE MSGID TO BITS PROMPTER   24960068
         XC    PARM3(24),PARM3            CLEAR PARMS FOR HDWR ADDR     25000068
         UNPK  PARM3(4),DATAPORT+1(3)     MOVE LINE ADDR                25040068
         MVI   PARM3+3,X'00'                                            25080068
         TR    PARM3,HXTOEB               MAKE IT READY FOR OUTPUT      25120068
         CLI    ENTRYTYP,X'91'             IS THIS AN MDR?              25160068
         BNE    M020                       NO. SKIP POLLING CHARS       25200068
         UNPK   PARM4(3),MDRCTRL(2)         GET CTRL UNIT POLL CHAR     25240068
         MVI    PARM4+2,X'00'                                           25280068
         TR     PARM4,HXTOEB               MAKE IT READY FOR OUTPUT     25320068
         UNPK   PARM5(3),MDRTERM(2)        GET TERMINAL POLL CHAR       25360068
         MVI    PARM5+2,X'00'                                           25400068
         TR     PARM5,HXTOEB          MAKE IT READY FOT OUTPUT          25440068
         B      M050                                                    25480068
M020     CLI    OBRUCB,X'40'          IS THIS A REMOTE OBR ?            25520068
         BNE    M030                  NO. SKIP POLL CHARS               25560068
         UNPK   PARM4(3),OBRCTRL(2)         GET CTRL UNIT POLL CHAR     25600068
         MVI    PARM4+2,X'00'                                           25640068
         TR     PARM4,HXTOEB               MAKE IT READY FOR OUTPUT     25680068
         UNPK   PARM5(3),OBRTERM(2)        GET TERMINAL POLL CHAR       25720068
         MVI    PARM5+2,X'00'                                           25760068
         TR     PARM5,HXTOEB          MAKE IT READY FOT OUTPUT          25800068
         B      M050                                                    25840068
M030     UNPK   PARM3(4),OBRCUA(3)   GET UNROUNDED LOCAL TERM ADDR      25880068
         MVI    PARM3+3,X'00'                                           25920068
         TR     PARM3,HXTOEB          MAKE IT READY FOR OUTPUT          25960068
M050     LA     OUTREG,MSBRECAP       POINT TO BITS RECAP HDR           26000068
         MVC    0(HDR4LTH,OUTREG),HDR4     MOVE RECAP HDR TO OUTPUT     26040068
         OC     PARM5,PARM5           TEST TERMINAL ADDR INPUT?         26080068
         BZ     M055                                                    26120068
         MVC    (HDR4TERM-HDR4)(2,OUTREG),PARM5    FILL IN TERML ADDR   26160068
         MVC    (HDR4CTRL-HDR4)(2,OUTREG),PARM4    FILL IN CTRL ADDR    26200068
M055     MVC    (HDR4LINE-HDR4)(3,OUTREG),PARM3    FILL IN LINE ADDR    26240068
         CLC    (HDR4TERM-HDR4)(2,OUTREG),=C'  '   IS TERML BLANK?      26280068
         BNE    M060                   NO.  LET IT GO.                  26320068
         MVC    6(6,OUTREG),=C'LOCAL '    YES.  CHANGE TO               26360068
         MVC   12(3,OUTREG),PARM3          LOCAL FORMAT.                26400068
         MVC   15(24,OUTREG),=24C' '                                    26440068
M060     LA    OUTREG,MSGBDATA          POINT TO  OUTAREA.              26480068
         UNPK  DUBLWD,TIME         MOVE TIME OF                         26520068
         MVC   0(2,OUTREG),DUBLWD+1     ERROR TO OUTPUT.                26560068
         MVI   2(OUTREG),C':'                                           26600068
         MVC   3(2,OUTREG),DUBLWD+3                                     26640068
         LA    1,LEAPTBL                                                26680068
M090     CLC   DATE+1(1),0(1)           FIGURE OUT IF                   26720068
         BE    M100                     ERROR HAPPENED                  26760068
         LA    1,1(1)                   DURING LEAP YEAR.               26800068
         CLI   0(1),X'FF'                                               26840068
         BNE   M090                                                     26880068
         ZAP   CALENDAR+8(2),=P'28'                                     26920068
         B     M110                                                     26960068
M100     ZAP   CALENDAR+8(2),=P'29'                                     27000068
M110     LA    15,CALENDAR                                              27040068
M120     MVN   DATE+3(1),=X'0C'    PROTECT AGAINST GARBAGE IN PACKED    27080068
         CLC   DATE+2(2),3(15)     FIELD.  COMPUTE MONTH AND            27120068
         BNH   M130                     DAY FROM DAY NUMBER.            27160068
         SP    DATE+2(2),3(2,15)                                        27200068
         LA    15,5(15)                                                 27240068
         B     M120                                                     27280068
M130     MVC   6(3,OUTREG),0(15)        MOVE MONTH TO OUTPUT.           27320068
         UNPK  9(2,OUTREG),DATE+2(2)    MOVE DAY TO OUTPUT.             27360068
         OI    10(OUTREG),X'F0'                                         27400068
         MVC   LINESZ,=H'40'                                            27440068
         MVC   LINELOOP,=H'4'                                           27480068
M140     CLI   ENTRYTYP,X'91'      IS THIS ENTRY AN OBR?                27520068
         BNE   M160                YES.                                 27560068
         BAL   LINKREG,BUMDR       NO. BLOW UP AN MDR ENTRY.            27600068
M150     MVC   MSGBSM(220),MSGBDATA     MOVE BITS SCREEN DATA TO        27640068
         MVC   MSGBSM+220(100),MSGBDATA+220   SMALL SCREEN OUTPUT AREA  27680068
         CALL  ASMTDLI,(ISRT,(PCBREG),MSGBITS,BITSCR),VL                27720068
         B     CHECKST                                                  27760068
*********************************************************************** 27800068
*     BLOWUP OF 'OBR' ERRORS                  ************************* 27840068
*********************************************************************** 27880068
M160     BAL   LINKREG,BUOBR       BLOWUP AN OBR ENTRY.                 27920068
         B     M150                                                     27960068
BUOBR    MVC   13(5,OUTREG),=C'TP-OP'   MOVE THE                        28000068
         UNPK  DUBLWD,OBRCCW+5(2)       TP OP CODE                      28040068
         TR    DUBLWD,HXTOEB            TO OUTPUT AREA.                 28080068
         MVC   19(2,OUTREG),DUBLWD+5                                    28120068
         LA    15,TPOPTBL                                               28160068
         CLI   ENTRYTYP,X'34'       IS THIS A TCAM OBR?                 28200068
         BNE   O060                 NO. REG 15 POINTS AT BTAM           28240068
         L     15,=A(TCAMTPOP)      YES. POINT TO TCAM TPOP TABLE       28280068
O060     CLC   0(2,15),DUBLWD+5                                         28320068
         BE    O120                                                     28360068
         CLC   0(2,15),=X'FFFF'                                         28400068
         BE    O120                                                     28440068
         LA    15,20(15)                                                28480068
         B     O060                                                     28520068
O120     MVC   22(18,OUTREG),2(15) MOVE EXPLANATION OF TP OP CODE.      28560068
         AH    OUTREG,LINESZ       BUMP TO NEXT LINE OF OUTPUT.         28600068
O170     MVC   0(11,OUTREG),=C'DATA LENGTH'                             28640068
         UNPK  DUBLWD,OBRCCW+6(3)                                       28680068
         TR    DUBLWD,HXTOEB       MOVE DATA LENGTH.                    28720068
         MVC   12(4,OUTREG),DUBLWD+3                                    28760068
         MVC   21(14,OUTREG),=C'RESIDUAL COUNT'                         28800068
         UNPK  DUBLWD,OBRCSW+6(3)                                       28840068
         TR    DUBLWD,HXTOEB                                            28880068
         MVC   36(4,OUTREG),DUBLWD+3                                    28920068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            28960068
         MVC   0(15,OUTREG),=C'CHANNEL COMMAND'                         29000068
         UNPK  DUBLWD,OBRCCW(2)                                         29040068
         TR    DUBLWD,HXTOEB       MOVE THE CHANNEL COMMAND.            29080068
         MVC   16(2,OUTREG),DUBLWD+5                                    29120068
         LA    15,CCWTABL                                               29160068
         CLI   OBRUCB,X'40'     IS THIS A REMOTE?                       29200068
         BE    P070             YES. USE 270X COMMANDS.                 29240068
         L     15,=A(CCW3272)   NO. USE THE 3272 COMMANDS.              29280068
P070     CLC   0(2,15),DUBLWD+5                                         29320068
         BE    P130                                                     29360068
         CLC   0(2,15),=X'FFFF'                                         29400068
         BE    P130                                                     29440068
         LA    15,20(15)                                                29480068
         B     P070                                                     29520068
P130     MVC   19(18,OUTREG),2(15) MOVE CCW EXPLANATION.                29560068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            29600068
         MVC   4(5,OUTREG),=C'SENSE'    MOVE SENSE & STATUS HEADERS.    29640068
         MVC   24(6,OUTREG),=C'STATUS'                                  29680068
         UNPK  DUBLWD,OBRSENSE(3)  MOVE OBR SENSE                    XH 29720068
         TR    DUBLWD,HXTOEB           BYTES                         XH 29760068
         MVC   10(4,OUTREG),DUBLWD+3     TO OUTPUT AREA              XH 29800068
         UNPK  DUBLWD,OBRCSW+4(3)  MOVE OBR STATUS                   XH 29840068
         TR    DUBLWD,HXTOEB           BYTES                         XH 29880068
         MVC   31(4,OUTREG),DUBLWD+3     TO OUTPUT AREA              XH 29920068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUTLINE.             29960068
         LR    14,OUTREG           TEMPORARY POINTER TO SENSE OUTPUT.   30000068
         LH    1,LINELOOP          LIMIT DISPLAY IF MOD 1 SCREEN.       30040068
         LA    15,SENSTABL                                              30080068
         CLI   OBRUCB,X'40'     IS THIS REMOTE?                         30120068
         BE    P200             YES, USE 270X SENSE                     30160068
         L     15,=A(SENS3272)   NO, USE 3272 SENSE                     30200068
P200     MVC   DUBLWD(1),OBRSENSE  SETUP TO TEST SENSE BITS.            30240068
         NC    DUBLWD(1),0(15)                                          30280068
         CLC   DUBLWD(1),0(15)                                          30320068
         BE    Q050                                                     30360068
Q010     LA    15,19(15)           BUMP TO NEXT SLOT IN SENSE TABL.     30400068
         CLI   0(15),X'FF'                                              30440068
         BNE   P200                                                     30480068
         B     Q080                                                     30520068
Q050     MVC   0(18,14),1(15)      MOVE EXPLANATION OF 1 SENSE BIT.     30560068
         AH    14,LINESZ           BUMP TO NEXT SENSE OUTPUT AREA.      30600068
         BCT   1,Q010              ANY TIOA ROOM LEFT?                  30640068
Q080     ST    14,SAVE14                                                30680068
         LR    14,OUTREG           NO. SETUP TO LOOK AT STATUS BITS.    30720068
         LH    1,LINELOOP                                               30760068
         LA    15,CSWTABL                                               30800068
Q110     MVC   DUBLWD(2),OBRCSW+4                                       30840068
         NC    DUBLWD(2),0(15)                                          30880068
         CLC   DUBLWD(2),0(15)                                          30920068
         BE    Q180                                                     30960068
Q150     LA    15,20(15)                                                31000068
         CLI   0(15),X'FF'                                              31040068
         BNE   Q110                                                     31080068
         B     Q210                                                     31120068
Q180     MVC   20(18,14),2(15)     MOVE EXPLANATION OF 1 CSW STATUS BIT 31160068
         AH    14,LINESZ           BUMP TO NEXT OUTPUT SLOT             31200068
         BCT   1,Q150              ANY TIOA ROOM LEFT?                  31240068
Q210     C     14,SAVE14           NO.                                  31280068
         BH    R010                                                     31320068
         L     14,SAVE14           SET OUTPUT REG TO HIGHER             31360068
R010     LR    OUTREG,14           OUTPUT ADDRESS (SENSE OR STATUS).    31400068
         BR    LINKREG                                                  31440068
*********************************************************************** 31480068
*     BLOWUP OF 'MDR' ERRORS                  ************************* 31520068
*********************************************************************** 31560068
BUMDR    MVC   24(6,OUTREG),=C'SENSE'  MOVE STATUS HDR.                 31600068
         UNPK  DUBLWD,MDRSTATS(3)  MOVE MDR                          XH 31640068
         TR    DUBLWD,HXTOEB          STATUS BYTES                   XH 31680068
         MVC   31(4,OUTREG),DUBLWD+3     TO OUTPUT AREA              XH 31720068
         AH    OUTREG,LINESZ       BUMP TO NEXT OUTPUT LINE.            31760068
         LR    14,OUTREG                                                31800068
         LH    1,LINELOOP                                               31840068
         AR    1,1                 LIMIT MOD 1 TO 7 BITS MAX.           31880068
         BCTR  1,0                                                      31920068
         LA    15,STATSTBL                                              31960068
R080     MVC   DUBLWD(2),MDRSTATS  SETUP TO LOOK AT REMOTE STATUS TBL.  32000068
         NC    DUBLWD(2),0(15)                                          32040068
         CLC   DUBLWD(2),0(15)                                          32080068
         BE    R170                                                     32120068
R120     LA    15,20(15)                                                32160068
         CLI   0(15),X'FF'                                              32200068
         BNE   R080                                                     32240068
         B     R200                                                     32280068
R170     MVC   20(18,14),2(15)     MOVE EXPLANATION OF 1 REMOTE STATUS  32320068
         AH    14,LINESZ           BUMP TO NEXT OUTPUT AREA             32360068
         BCT   1,R120              ANY TIOA ROOM LEFT?                  32400068
R200     LR    OUTREG,14           NO. SETUP TO COMPUTE DATA LTH.       32440068
         BR    LINKREG             RETURN TO MAIN LINE.                 32480068
*********************************************************************** 32520068
*   THIS IS THE LOCATE ROUTINE                                          32560068
*********************************************************************** 32600068
LOCATE   ST    11,SAVE11                                                32640068
         LA    11,PARMADDR         SET UP PARM REG                      32680068
         L     15,=V(BNGIREAD)    POINT TO READ MODULE                  32720068
         BALR  14,15              LINK TO BDAM READ MODULE              32760068
         L     11,SAVE11                                                32800068
         OC    STATUS,STATUS      READ OK?                              32840068
         BZ    S030               YES.                                  32880068
         CLC   STATUS,=C'FF'       WAS EMFILE OPENED?                   32920068
         BE    Z60                 NO.  WRITE 'NOT OPEN' MSG            32960068
*        UNPK  DBLWD,STATUS(3)                                          33000068
*        MVC   IOERCODE,DBLWD+3                                         33040068
*        TR    IOERCODE,HXTOEB     MOVE BDAM RETURN CODE TO I/O ERR MSG 33080068
*        UNPK  DBLWD,RELREC(4)                                          33120068
*        MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     33160068
*        TR    IOERBLK,HXTOEB                                           33200068
         B     Z90                     IF REQUESTED SLOT CAN'T          33240068
*                                        BE FOUND, SEND 'SEARCHING ERR' 33280068
S030     L     FIOABAR,IOAREA      POINT TO DATA BLK.                   33320068
         LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       33360068
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             33400068
         MVC   WRKSLOT,TWASLOT     MOVE SLOT COUNT TO WORK AREA         33440068
S060     CLI   WRKSLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      33480068
         BL    0(LINKREG)          GO RESUME DISPLAY BUILDING.          33520068
         SR    1,1                                                      33560068
         IC    1,WRKSLOT           DECREMENT SLOT COUNT BY 1.           33600068
         BCTR  1,0                                                      33640068
         STC   1,WRKSLOT                                                33680068
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   33720068
         LTR   1,1                                                      33760068
         BZ    S190                PREVENT LOOP IF GARBAGE INPUT.       33800068
         AR    DATAREG,1                                                33840068
         SR    DATALOOP,1                                               33880068
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  33920068
         BP    S060                                                     33960068
S190     MVC   ERRDATA(MSG5LTH),MSG5   IF REQUESTED SLOT CAN'T          34000068
ERRISRT  CALL  ASMTDLI,(ISRT,(PCBREG),ERROUT,LGERR),VL                  34040068
         B     CHECKST                                                  34080068
*********************************************************************** 34120068
GETTIOA  MVC   MSGOID,=CL20' '        CLEAR MSG ID AREA                 34160068
         OC    TWATCTID,TWATCTID   IF NO INPUT WAS SPECIFIED,           34200068
         BZ    T130                SHOW USER HIS TERMINAL ID.           34240068
         MVC   MSGOID(10),=C'   IMS ID='                                34280068
         MVC   MSGOID+10(8),TWATCTID                                    34320068
T130     LA    OUTREG,MSGRECAP     POINT TO RECAP OUTPUT HEADER         34360068
         MVC   0(HDR4LTH,OUTREG),HDR4    MOVE RECAP HEADER TO OUTPUT    34400068
         OC    PARM5,PARM5         IF NO TERM ADDR INPUT, SHOW ONLY LIN 34440068
         BZ    T150                                                     34480068
         MVC   (HDR4TERM-HDR4)(2,OUTREG),PARM5   FILL IN THE            34520068
         MVC   (HDR4CTRL-HDR4)(2,OUTREG),PARM4     ID OF THIS TERML     34560068
T150     DS    0H                                                       34600068
         MVC   (HDR4LINE-HDR4)(3,OUTREG),PARM3    CTRL UNIT, AND LINE.  34640068
         CLC   (HDR4TERM-HDR4)(2,OUTREG),=C'  '  IS TERML BLANK?        34680068
         BNE   T160                      NO. LET IT GO.                 34720068
         MVC   6(6,OUTREG),=C'LOCAL '    YES, CHANGE TO                 34760068
         MVC   12(3,OUTREG),PARM3        LOCAL FORMAT.                  34800068
         MVC   15(24,OUTREG),=24C' '                                    34840068
T160     LA    OUTREG,MGODAT1A     SETUP OUTPUT REG TO POINT AT DATA    34880068
         MVC   MSGHDR1,HDR6        MOVE COLUMN HEADERS                  34920068
         MVC   MSGHDR2,HDR6         TO OUTPUT.                          34960068
         LA    OUTLOOP,7           SETUP TO SHOW 7 ITEMS ON MOD 1.      35000068
         LA    14,40               SETUP TO INITIALIZE OUTPUT ENTRIES   35040068
         LA    15,MGODAT1A         POINT TO FIRST ENTRY IN OUTPUT.      35080068
T170     MVC   0(7,15),=X'00B04000B0403F'  SET TO UNPROT,NORM,ALPHA     35120068
         MVC   14(4,15),=X'00B0403F'          AND ERASE FIELDS ON SCR   35160068
         LA    15,43(15)           BUMP TO NEXT ENTRY                   35200068
         BCT   14,T170             BRANCH IF MORE ENTRIES TO CLEAR      35240068
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FOR-3277-2 SWITCH    35280068
T180     BR    LINKREG             RETURN TO MAIN LINE.                 35320068
T190     OC    PARM3,=CL8' '            INSURE NO X'00'        @OZ31886 35328007
         MVC   MSG13LN,PARM3            MOVE LINE NO. INTO MSG @OZ31886 35336007
         MVC   ERRDATA(MSG13LTH),MSG13  MOVE MESSAGE           @OZ31886 35344007
         B     ERRISRT                  GO WRITE MESSAGE       @OZ31886 35352007
Z10      MVC   ERRDATA(MSG4LTH),MSG4                                    35360068
         B     ERRISRT                                                  35400068
Z20      MVC   ERRDATA(MSG1LTH),MSG1                                    35440068
         B     ERRISRT                                                  35480068
Z30      MVC   ERRDATA(MSG3LTH),MSG3                                    35520068
         B     ERRISRT                                                  35560068
Z40      MVC   ERRDATA(MSG6LTH),MSG6                                    35600068
         B     ERRISRT                                                  35640068
Z50      CLI   PARM4,X'00'          IS FULL ADDRESS AVAILABLE ?         35680068
         BE    Z50A                 NO. JUST SHOW TERMINAL ADDR         35720068
         CLC   PARM4(2),=C'00'                                          35760068
         BE    Z50A                 NO. JUST SHOW TERMINAL ADDR         35800068
         MVC   ERRDATA(MSG11LTH),MSG11   MOVE 'NO ERRS' MSG TO OUTPUT   35840068
         OC    PARM3(24),=CL24' '   CHANGE  X'00'  TO  X'40'            35880068
         LA    15,ERRDATA           POINT TO OUTPUT AREA                35920068
         MVC   (MSG11TRM-MSG11)(2,15),PARM5  MOVE TERML TO OUTPUT       35960068
         MVC   (MSG11CU-MSG11)(2,15),PARM4   MOVE CTRL UNIT TO OUTPUT   36000068
         MVC   (MSG11LIN-MSG11)(3,15),PARM3  MOVE LINE      TO OUTPUT   36040068
         CLI   TWATCTID,X'00'           SYMBOLIC ADDR PRESENT ?         36080068
         BE    Z50C                     NO.  WRITE MSG                  36120068
         MVC   (MSG11ID-MSG11)(10,15),=C'   IMS ID='                    36160068
         MVC   (MSG11ID+10-MSG11)(8,15),TWATCTID                        36200068
         B     Z50C                                                     36240068
Z50A     OC    PARM3,=CL8' '          CHANGE  X'00'  TO  X'40'          36280068
         MVC   MSG12TRM,PARM3         MOVE TERML TO OUTPUT              36320068
         LA    15,MSG12ID             POINT TO END OF ADDRESS           36360068
         MVC   MSG12ID,=CL20' '       CLEAR OUT SYMBOLIC ID AREA        36400068
         CLI   TWATCTID,X'00'         SYMBOLIC NAME PRESENT ?           36440068
         BE    Z50B                   NO.                               36480068
         MVC   0(10,15),=C'   IMS ID='                                  36520068
         MVC   10(8,15),TWATCTID                                        36560068
Z50B     MVC   ERRDATA(MSG12LTH),MSG12 MOVE MSG12 TO OUTPUT AREA        36600068
Z50C     B     ERRISRT                                                  36640068
Z60      MVC   ERRDATA(MSG9LTH),MSG9                                    36680068
         B     ERRISRT                                                  36720068
Z90      MVC   ERRDATA(MSG5LTH),MSG5                                    36760068
         B     ERRISRT                                                  36800068
         EJECT                                                          36840068
ERROUT   DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      36880068
ERROLL   DC    H'121'              MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   36920068
ERROZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  36960068
ERROZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  37000068
ERRDATA  DS    CL117               START OF MESSAGE DATA                37040068
MSG1     DC    CL39'BNG001A I I/O ERR READING SYS1.DEMFLOG '            37080068
         DC    CL28'    THE BDAM RETURN CODE IS'                        37120068
IOERCODE DC    CL4'0'                                                   37160068
         DC    CL7' '                                                   37200068
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS '                 37240068
IOERBLK  DC    CL3'0'                                                   37280068
         DC    C'  '                                                    37320068
MSG1LTH  EQU   *-MSG1                                                   37360068
MSG3     DC    C'BNG003I I NO ERRORS RECORDED '                         37400068
MSG3LTH  EQU   *-MSG3                                                   37440068
MSG4     DC    C'BNG004I I NO ERRORS RECORDED FOR LINE '                37480068
NOLINE   DC    CL3' '                                                   37520068
MSG4LTH  EQU   *-MSG4                                                   37560068
MSG5     DC    CL39'BNG005I I ERROR NOT FOUND ON FILE FOR '             37600068
         DC    C'THE SELECTED ITEM '                                    37640068
MSG5LTH  EQU   *-MSG5                                                   37680068
MSG6     DC    C'BNG006I I INVALID FORMAT--CHECK PAGE 2'                37720068
         DC    C'OF MENU FOR CORRECT FORMATS'                           37760068
MSG6LTH  EQU   *-MSG6                                                   37800068
MSG9     DC    C'BNG009A I SYS1.DEMFLOG FILE NOT OPEN   '               37840068
MSG9LTH  EQU   *-MSG9                                                   37880068
MSG10    DC    AL2(MSG10LTH-4),X'0000'                                  37920068
         DC    CL10'BNG010I I '                                         37960068
MSG10ID  DC    CL8' ',CL21' IS A VTAM TERMINAL. '                       38000068
         DC    CL39'FOR INQUIRY,GIVE DEMF HARDWARE ADDRESS.'            38040068
MSG10LTH EQU   *-MSG10                                                  38080068
MSG11    DC    CL39'BNG011I I NO ERRORS RECORDED FOR REMOTE'            38120068
         DC    CL9'TERMINAL '                                           38160068
MSG11TRM DC    CL2' '                                                   38200068
         DC    CL20'       ON CTRL UNIT '                               38240068
MSG11CU  DC    CL2' '                                                   38280068
         DC    CL14'      ON LINE '                                     38320068
MSG11LIN DC    CL3' '                                                   38360068
         DC    CL8' '                                                   38400068
MSG11ID  DC    CL20' '          IMS SYMBOLIC NAME                       38440068
MSG11LTH EQU   *-MSG11                                                  38480068
MSG12    DC    CL39'BNG012I I NO ERRORS RECORDED FOR LOCAL '            38520068
         DC    CL9'TERMINAL '                                           38560068
MSG12TRM DC    CL3' '                                                   38600068
         DC    CL7' '                                                   38640068
MSG12ID  DC    CL20' '          IMS SYMBOLIC NAME                       38680068
MSG12LTH EQU   *-MSG12                                                  38720068
MSG13    DC    CL39'BNG013A I NO DATA BLOCKS AVAILABLE FOR '   @OZ31886 38725007
         DC    CL5'LINE '                                      @OZ31886 38730007
MSG13LN  DC    CL3' '                                          @OZ31886 38735007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31886 38740007
         DC    CL39'MUST ALLOCATE MORE BLOCKS THAN LINES'      @OZ31886 38745007
MSG13LTH EQU   *-MSG13                                         @OZ31886 38750007
********************************************************************    38760068
DTLENTRY DC    C' (? ) '                                                38800068
DTLITEM  DC    CL8' '                                                   38840068
DTLCOUNT DC    CL4'0001'                                                38880068
DTLLTH   EQU   *-DTLENTRY                                               38920068
ITEMLTH  EQU   DTLITEM-DTLENTRY                                         38960068
COUNTLTH EQU   DTLCOUNT-DTLENTRY                                        39000068
*********************************************************************** 39040068
CLRNTRY  DC    XL14'3F'             USED TO CLEAR FIELDS FOR OUTPUT     39080068
         DC    XL4'403F3F3F'                                            39120068
CLRLTH   EQU   *-CLRNTRY                                                39160068
*********************************************************************** 39200068
*  THE FUNCTION/COMPANION TABLE DETERMINES WHICH PROGRAM IS TO WRITE    39240068
*   THE REQUESTED DISPLAY AND PROVIDES THE CORRECT SCREEN AND COLUMN    39280068
*   HEADERS FOR THAT DISPLAY.                                           39320068
*********************************************************************** 39360068
* STORAGE AND WORK AREA DEFINITIONS                                     39400068
*********************************************************************** 39440068
QUITSW   DS    C             USED TO SETUP PAGING BBBSS FOR 3277-1      39480068
PARMADDR DS    0F                                                       39520068
IOAREA   DC    A(0)                ADDR OF RECORD READ PASSED HERE      39560068
RELREC   DC    XL3'0'              REL BLK ADDR TO BE READ              39600068
STATUS   DC    CL2'  '             STATUS OF READ PASSED HERE           39640068
ISRT     DC    CL4'ISRT'           INSERT FUNCTION - OUTPUT TO TERMINAL 39680068
DLIOK    DC    CL2' '              DL/I STATUS SAYS OPERATION PERFORMED 39720068
S3270    DC    CL8'BNGIO327'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   39760068
LGERR    DC    CL8'BNGIOERR'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   39800068
BITSCR   DC    CL8'BNGIOBIT'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   39840068
DATDATE  DS    F                   WORK AREA FOR DATE                   39880068
*********************************************************************** 39920068
* THE FOLLOWING AREA IS USED AS OUTPUT AREA                             39960068
* FOR TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                      40000068
*********************************************************************** 40040068
MSG3270  DS    0D              MAP OF 3270 TRANSACTION MESSAGE          40080068
MSGOLL   DC    AL2(MSGLTH)         MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   40120068
MSGOZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  40160068
MSGOZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  40200068
MSGODATA DS    0F                  START OF MESSAGE DATA                40240068
MSGOID   DS    CL20             CONTAINS IMS SYMBOLIC NAME              40280068
LGBBBSS  DS    CL15             PAGING BBBSS'S FOR 3277-2               40320068
SMBBBSS  DS    CL15             PAGING BBBSS'S FOR 3277-1               40360068
MSGRECAP DS    CL39             RECAP HEADER LINE                       40400068
MSGHDR1  DS    CL39             FILE/STATUS/SENSE/TPOP/CMD/ HEADER      40440068
MSGHDR2  DS    CL39             FILE/STATUS/SENSE/TPOP/CMD/ HEADER      40480068
MGODAT1A DS    CL2         ATTR   *  THESE FIELDS FORM THE REPEATING    40520068
MSGODAT1 DS    CL1         DATA   *  OUTPUT PATTERN WHEREIN THE FIRST   40560068
MGODAT2A DS    CL2         ATTR   * TWO BYTES ARE USED TO SET ATTRIBUTE 40600068
MSGODAT2 DS    CL9         DATA   * BYTES AND THE NEXT FIELD IS DATA    40640068
MGODAT3A DS    CL2         ATTR   * --- IN ALL,43 BYTES ARE REQUIRED    40680068
MSGODAT3 DS    CL27        DATA   *                                     40720068
MSGOREST DS    39CL43      MORE   **  39 MORE OF THE ABOVE TYPE FIELDS  40760068
MSGLTH   EQU   *-MSG3270                                                40800068
FILLER   DC    16X'FF'                                                  40840068
*********************************************************************** 40880068
* THE FOLLOWING AREA IS USED AS OUTPUT AREA                             40920068
* FOR TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                      40960068
*********************************************************************** 41000068
MSGBITS  DS    0D              MAP OF BITS PROMPTER TRANSACTION MESSAGE 41040068
MSGBLL   DC    AL2(MSGBLTH)        MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   41080068
MSGBZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  41120068
MSGBZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  41160068
MSGDATAS DS    0F                  START OF MESSAGE DATA                41200068
MSGBID   DS    CL20             CONTAINS IMS SYMBOLIC NAME              41240068
BITBBBSS DS    CL15             PAGING BBBSS'S FOR 3277-2 AND 3277-1    41280068
MSBRECAP DS    CL38             RECAP HEADER LINE                       41320068
MSGBDATA DS    8CL40            FILE/STATUS/SENSE/TPOP/CMD/ INFO        41360068
MSGBSM   DS    8CL40            FILE/STATUS/SENSE/TPOP/CMD SMALL        41400068
MSGBLTH  EQU   *-MSG3270                                                41440068
********************************************************************    41480068
UNA      DC    X'0080'             UNPROT,NORMAL,ALPHA                  41520068
UHA      DC    X'0088'             UNPROT,HI,ALPHA                      41560068
PNN      DC    X'00B0'             PROT,NORMAL,NUMERIC                  41600068
PHN      DC    X'00B8'             PROT,HI,NUMERIC                      41640068
********************************************************************    41680068
HDR4     DC    C'RECAP REMOTE '                                         41720068
HDR4TERM DC    CL2'  ',C' ON CU '                                       41760068
HDR4CTRL DC    CL2'  ',C' ON LINE '                                     41800068
HDR4LINE DC    CL3'999',CL2' '                                          41840068
HDR4LTH  EQU   *-HDR4                                                   41880068
********************************************************************    41920068
HDR6     DC    CL39'      FILE#  TIME SENSE STATUS TPOP CMD'            41960068
********************************************************************    42000068
*     DETAIL ENTRY WITH ATTRIBUTE BYTES     TOTAL = 43 BYTES            42040068
********************************************************************    42080068
MDRHDR   DS    0F                                                       42120068
MDRATTR1 DC    XL2'00B0'                                                42160068
         DC    C'('                                                     42200068
MDRATTR2 DC    XL2'0080'                                                42240068
         DC    C'? ) '                                                  42280068
MDRBBBSS DC    CL5'BBBSS'                                               42320068
MDRATTR3 DC    XL2'00B0'                                                42360068
MDRHRS   DC    CL2'24',C':'                                             42400068
MDRMINS  DC    CL2'60',C'  '                                            42440068
MDRSTAT  DC    CL4'XXXX',C'   '                                         42480068
OBRSNS   DC    CL4'    ',C'  '                                          42520068
OBRTPOP  DC    CL2'  ',C'  '                                            42560068
OBRCMD   DC    CL2'  ',C' '                                             42600068
MDRLTH   EQU   *-MDRHDR                                                 42640068
********************************************************************    42680068
         LTORG                                                          42720068
CALENDAR DC    C'JAN',PL2'31'                                           42760068
         DC    C'FEB',PL2'28'                                           42800068
         DC    C'MAR',PL2'31'                                           42840068
         DC    C'APR',PL2'30'                                           42880068
         DC    C'MAY',PL2'31'                                           42920068
         DC    C'JUN',PL2'30'                                           42960068
         DC    C'JUL',PL2'31'                                           43000068
         DC    C'AUG',PL2'31'                                           43040068
         DC    C'SEP',PL2'30'                                           43080068
         DC    C'OCT',PL2'31'                                           43120068
         DC    C'NOV',PL2'30'                                           43160068
         DC    C'DEC',PL2'31'                                           43200068
LEAPTBL  DC    X'768084889296FF'                                        43240068
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      43280068
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     43320068
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  43360068
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     43400068
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  43440068
         DC    X'000000000000000000000000FF000000'     50-5F    TO      43480068
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   43520068
         DC    X'00000000000000000000000000000000'     70-7F   AND      43560068
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   43600068
         DC    X'00000000000000000000000000000000'     90-9F    TO      43640068
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   43680068
         DC    X'00000000000000000000000000000000'     B0-BF    AND     43720068
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      43760068
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   43800068
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     43840068
         DC    X'00010203040506070809000000000000'     F0-FF            43880068
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   43920068
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           43960068
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           44000068
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            44040068
CCWTABL  DC    CL20'00TEST IO'                                          44080068
         DC    CL20'01WRITE'                                            44120068
         DC    CL20'02READ'                                             44160068
         DC    CL20'03NO OP'                                            44200068
         DC    CL20'04SENSE'                                            44240068
         DC    CL20'05WRITE WRAP'                                       44280068
         DC    CL20'06READ PREPARE'                                     44320068
         DC    CL20'09WRITE POLL'                                       44360068
         DC    CL20'0AREAD INHIBIT'                                     44400068
         DC    CL20'0DWRITE BREAK'                                      44440068
         DC    CL20'0EREAD SEARCH'                                      44480068
         DC    CL20'13SAD ZERO'                                         44520068
         DC    CL20'17SAD ONE'                                          44560068
         DC    CL20'1BSAD TWO'                                          44600068
         DC    CL20'1EADDRESS PREPARE'                                  44640068
         DC    CL20'1FSAD THREE'                                        44680068
         DC    CL20'23SET MODE'                                         44720068
         DC    CL20'27ENABLE'                                           44760068
         DC    CL20'29WRITE DIAL'                                       44800068
         DC    CL20'2FDISABLE'                                          44840068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           44880068
TPOPTBL  DC    CL20'00ON LINE TEST'                                     44920068
         DC    CL20'01DISABLE'                                          44960068
         DC    CL20'02WRITE EOA EOT EOT'                                45000068
         DC    CL20'03WRT POLL/ADDR CHRS'                               45040068
         DC    CL20'04WRITE SPACE'                                      45080068
         DC    CL20'05RD RSP TO POLLING'                                45120068
         DC    CL20'06RD RSP TO ADDRESSING'                             45160068
         DC    CL20'07READ ID RESPONSE'                                 45200068
         DC    CL20'08WRITE EOA'                                        45240068
         DC    CL20'09NOP OR TIC'                                       45280068
         DC    CL20'0AREAD INDEX'                                       45320068
         DC    CL20'0BREAD INQUIRY'                                     45360068
         DC    CL20'0CRD RSP TO INQUIRY'                                45400068
         DC    CL20'10WRT LINE ADDRESS'                                 45440068
         DC    CL20'11RD OR WRT TEXT'                                   45480068
         DC    CL20'12RD SKIP OR TIC'                                   45520068
         DC    CL20'13WRITE DLE ETX'                                    45560068
         DC    CL20'20RD RSP TO TEXT'                                   45600068
         DC    CL20'21ALL RESET COMMANDS'                               45640068
         DC    CL20'22READ SKIP'                                        45680068
         DC    CL20'23WRITE BREAK'                                      45720068
         DC    CL20'24OPEN LOPEN CLOSE'                                 45760068
         DC    CL20'25RD RSP TO TEXT'                                   45800068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           45840068
CSWTABL  DC    B'1000000000000000',CL18'ATTENTION'                      45880068
         DC    B'0100000000000000',CL18'STATUS MODIFIER'                45920068
         DC    B'0010000000000000',CL18'CTRL UNIT END'                  45960068
         DC    B'0001000000000000',CL18'BUSY'                           46000068
         DC    B'0000100000000000',CL18'CHANNEL END'                    46040068
         DC    B'0000010000000000',CL18'DEVICE END'                     46080068
         DC    B'0000001000000000',CL18'UNIT CHECK'                     46120068
         DC    B'0000000100000000',CL18'UNIT EXCEPTION'                 46160068
         DC    B'0000000010000000',CL18'PGRM CTRLD INTRPT'              46200068
         DC    B'0000000001000000',CL18'INCORRECT LENGTH'               46240068
         DC    B'0000000000100000',CL18'PROGRAM CHECK'                  46280068
         DC    B'0000000000010000',CL18'PROTECTION CHECK'               46320068
         DC    B'0000000000001000',CL18'CHANL DATA CHECK'               46360068
         DC    B'0000000000000100',CL18'CHANL CTRL CHECK'               46400068
         DC    B'0000000000000010',CL18'INTFACE CTRL CK'                46440068
         DC    B'0000000000000001',CL18'CHAINING CHECK'                 46480068
         DC    X'FF'                                                    46520068
SENSTABL DC    B'10000000',CL18'COMMAND REJECT'                         46560068
         DC    B'01000000',CL18'INTERVENTION REQD'                      46600068
         DC    B'00100000',CL18'BUS OUT CHECK'                          46640068
         DC    B'00010000',CL18'EQUIPMENT CHECK'                        46680068
         DC    B'00001000',CL18'DATA CHECK'                             46720068
         DC    B'00000100',CL18'OVERRUN'                                46760068
         DC    B'00000010',CL18'LOST DATA'                              46800068
         DC    B'00000001',CL18'TIMEOUT'                                46840068
         DC    X'FF'                                                    46880068
STATSTBL DC    B'0010000000000000',CL18'RESERVED'                       46920068
         DC    B'0001000000000000',CL18'RESERVED'                       46960068
         DC    B'0000100000000000',CL18'DEVICE BUSY'                    47000068
         DC    B'0000010000000000',CL18'UNIT SPECIFY'                   47040068
         DC    B'0000001000000000',CL18'DEVICE END'                     47080068
         DC    B'0000000100000000',CL18'TRANSMISSION CHECK'             47120068
         DC    B'0000000000100000',CL18'COMMAND REJECT'                 47160068
         DC    B'0000000000010000',CL18'INTERVENTION REQD'              47200068
         DC    B'0000000000001000',CL18'EQUIPMENT CHECK'                47240068
         DC    B'0000000000000100',CL18'DATA CHECK'                     47280068
         DC    B'0000000000000010',CL18'CONTROL CHECK'                  47320068
         DC    B'0000000000000001',CL18'OPERATION CHECK'                47360068
         DC    X'FF'                                                    47400068
SENS3272 DC B'10000000',CL18'COMMAND REJECT'                            47440068
         DC B'01000000',CL18'INTERVENTION REQD'                         47480068
         DC B'00100000',CL18'BUS OUT CHECK'                             47520068
         DC B'00010000',CL18'EQUIPMENT CHECK'                           47560068
         DC B'00001000',CL18'DATA CHECK'                                47600068
         DC B'00000100',CL18'UNIT SPECIFY'                              47640068
         DC B'00000010',CL18'CONTROL CHECK'                             47680068
         DC B'00000001',CL18'OPERATION CHECK'                           47720068
         DC    X'FF'                                                    47760068
CCW3272  DC    CL20'01WRITE'                                            47800068
         DC    CL20'05ERASE WRITE'                                      47840068
         DC    CL20'02READ BUFFER'                                      47880068
         DC    CL20'06READ MODIFIED'                                    47920068
         DC    CL20'0BSELECT'                                           47960068
         DC    CL20'0FERASE ALL PROTECTD'                               48000068
         DC    CL20'03NO OP'                                            48040068
         DC    CL20'04SENSE'                                            48080068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           48120068
TCAMTPOP DC    CL20'01WRT EOT FOR SELECT'                               48160068
         DC    CL20'02OPEN TP OP CODE'                                  48200068
         DC    CL20'03WRITE POLL CHARS'                                 48240068
         DC    CL20'04RD RSPNS TO POLL'                                 48280068
         DC    CL20'05WRITE PAD CHARS'                                  48320068
         DC    CL20'06ENABLE DIAL LINE'                                 48360068
         DC    CL20'07WRT ADDR SEQUENCE'                                48400068
         DC    CL20'08READ RSPNS TO ADDR'                               48440068
         DC    CL20'09WRITE EOA SEQUENCE'                               48480068
         DC    CL20'0ARD RSPNS EOB/ETB'                                 48520068
         DC    CL20'0BWRITE CPU ID'                                     48560068
         DC    CL20'0CREAD ENQ'                                         48600068
         DC    CL20'0DWRITE ENQ'                                        48640068
         DC    CL20'0ERD RSPNS TO ENQ'                                  48680068
         DC    CL20'0FWRITE DLE EOT'                                    48720068
         DC    CL20'10READ ID (TSO)'                                    48760068
         DC    CL20'11NON-R/W CCW'                                      48800068
         DC    CL20'12WRITE BREAK (TSO)'                                48840068
         DC    CL20'13WRT ENQ AFTER SEL'                                48880068
         DC    CL20'14READ LCOUT'                                       48920068
         DC    CL20'15WRT RSP BEFOR TXT'                                48960068
         DC    CL20'16WRITE RESPONSE'                                   49000068
         DC    CL20'17WRITE TONE'                                       49040068
         DC    CL20'18BSC READ ID ENQ'                                  49080068
         DC    CL20'1ABSC READ ID ACK'                                  49120068
         DC    CL20'1CABORT SEND/RECIEV'                                49160068
         DC    CL20'1EREAD TWX ID'                                      49200068
         DC    CL20'20BUF TRM RESET BLK'                                49240068
         DC    CL20'22CLOSE SDR RECRDNG'                                49280068
         DC    CL20'24WRT RESET AFT SEL'                                49320068
         DC    CL20'51READ SKIP LOOP'                                   49360068
         DC    CL20'53WRT IDLES LOOP'                                   49400068
         DC    CL20'57WRT DLE STX'                                      49440068
         DC    CL20'59WRT DLE ETB(ETX)'                                 49480068
         DC    CL20'5BWRT ENQ RSP TO TXT'                               49520068
         DC    CL20'FFTEXT CCW'                                         49560068
         DC    X'FFFF',CL18'NO KNOWN MEANING'                           49600068
TWASLOT  DC    X'00'               SLOT COUNTER.                        49640068
WRKSLOT  DS    C                   SLOT CTR WORKAREA FOR LOCATE RTN     49680068
SAVE14   DS    F                   SAVE AREA.                           49720068
TWAOUT   DS    F                   SAVE OUTPUT HDR ADDR                 49760068
LINELOOP DS    H                   NBR LINE ITEMS PER LINESZ.           49800068
OUTSWCH  DS    C                                                        49840068
LINESZ   DS    H                   LINE SIZE                            49880068
HXLINLIB DS    0CL6                LINE ADDRESS INCLUDING               49920068
         DS    C                                                        49960068
HEXLINE  DS    CL2                      VTAM LIB ADDR                   50000068
HEXLIB   DS    CL3                      IN HEX FORMAT.                  50040068
HEXCTRL  DS    C                   CTRL UNIT POLL CHAR.                 50080068
HEXTERM  DS    C                   TERML POLL CHAR.                     50120068
NEWFIRST DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    50160068
NEWPREV  DS    CL5                 SAVE AREA FOR OLD BLK & SLOT NBR.    50200068
         END   BNGI3270                                                 50240068
