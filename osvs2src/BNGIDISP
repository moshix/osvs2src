         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGIDISP                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME =  IMS DEMF DISPLAY CONTROL MODULE                 * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) READS INPUT MESSAGE FROM IMS MESSAGE QUEUE;           * 00550000
*            2) EDITS THE INPUT INTO 6 PARM FIELDS WITH LEFT JUSTIFY; * 00600000
*            3) DOES SYNTAX CHECK ON DEMF COMMANDS AND PARAMETERS;    * 00650000
*            4) DETERMINES WHETHER THE REQUEST IS FOR MENU,REMOTE,    * 00700000
*               LOCAL OR 3270 SCREEN ERROR DISPLAY AND LINKS          * 00750000
*               TO BNGTMENU,BNGTRMOT,BNGTLOCL OR BNGT3270 SEGMENT     * 00800000
*               ACCORDINGLY WITH PARAMETERS;                          * 00850000
*            5) HANDLES ALL,LINE AND CTRL ERROR DISPLAY REQUEST AND   * 00900000
*               WRITES ITS ERROR INFORMATION TO THE 3270 DISPLAY      * 00950000
*               TERMINAL AND ISSUES SOME OF THE DISPLAY MESSAGES;     * 01000000
*            6) LINKS TO BNGIREAD TO READ SYS1.DEMFLOG FOR ALL,LINE,  * 01050000
*               CTRL ERROR DISPLAY REQUESTS;                          * 01100000
*            7) WHEN THE INPUT MESSAGE HAS BEEN PROCESSED, BNGIDISP   * 01150000
*               READS ANOTHER MESSAGE. THIS PROCESS CONTINUES UNTIL   * 01200000
*               THE MESSAGE QUEUE IS EXHAUSTED. THEN BNGIDISP RETURNS * 01250000
*               CONTROL TO IMS.                                       * 01300000
*                                                                     * 01350000
* NOTES = NONE                                                        * 01400000
*                                                                     * 01450000
*    DEPENDENCIES = NONE                                              * 01500000
*                                                                     * 01550000
*    RESTRICTIONS = NONE                                              * 01600000
*                                                                     * 01650000
*    REGISTER CONVENTIONS :                                           * 01700000
*    --------------------                                             * 01750000
*                                                                     * 01800000
*    ALL DEMF RECORDING DISPLAY COMPONENTS USE STANDARD REGISTER      * 01850000
*    CONVENTIONS WITH THE EXCEPTION OF THE IMS DISPLAY COMPONENTS.    * 01900000
*    CERTAIN IMS MODULES USE ADDITIONAL REGISTERS AND THE LINK MACRO  * 01950000
*    FOR PASSING OR RETRIEVING DATA PARAMETER INFORMATION AND ARE     * 02000000
*    DETAILED BELOW:                                                  * 02050000
*                                                                     * 02100000
*     MODULE    REGISTER    CONTENTS.                                 * 02150000
*    --------   --------    ------------------------------------      * 02200000
*    BNGIDISP     R5        PASSES ADDRESS OF IMS PROGRAM             * 02250000
*                           COMMUNICATION BLOCK (PCB) TO              * 02300000
*                           BNGI3270, BNGIMENU, BNGILOCL, AND         * 02350000
*                           BNGIRMOT.                                 * 02400000
*                                                                     * 02450000
*                 R11       PASSES TO BNGIREAD THE ADDRESS OF A       * 02500000
*                           PARAMETER LIST CONTAINING:                * 02550000
*                                                                     * 02600000
*                          1) 4-BYTES - ADDRESS OF I/O AREA FROM      * 02650000
*                                       BNGIREAD                      * 02700000
*                                                                     * 02750000
*                          2) 3-BYTES - RELATIVE BLOCK ADDRESS TO     * 02800000
*                                       BE READ BY BNGIREAD           * 02850000
*                                                                     * 02900000
*                          3) 2-BYTES - STATUS OF READ FROM           * 02950000
*                                       BNGIREAD                      * 03000000
*                                                                     * 03050000
*                 R12      FOR BNGI3270, PASSES THE ADDRESS OF A      * 03100000
*                          COMMUNICATION AREA CONTAINING              * 03150000
*                          UP TO SIX EDITTED PARM FIELDS, SAVE        * 03200000
*                          AND WORK AREAS, AND THE INPUT MESSAGE.     * 03250000
*                                                                     * 03300000
*                          FOR BNGILOCL, BNGIRMOT, AND BNGIMENU;      * 03350000
*                          PASSES THE ADDRESS OF THE INPUT MESSAGE.   * 03400000
*                                                                     * 03450000
*    BNGIREAD    LINK TO BNGIDCBA       RETRIEVES THE ADDRESS OF THE  * 03500000
*                (ALIAS FOR BNGISIMS)   ADDRESS OF THE SYS1.DEMFLOG   * 03550000
*                                       DCB.                          * 03600000
*                                                                     * 03650000
*                 R11      RECEIVES ADDRESS OF PARAMETER LIST         * 03700000
*                          (SEE BNGIDISP R11 FOR LIST).               * 03750000
*                                                                     * 03800000
*    BNGI3270     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 03850000
*                                                                     * 03900000
*                 R11     PASSES TO BNGIREAD THE ADDRESS OF A         * 03950000
*                         PARAMETER LIST (SEE BNGIDISP R11 FOR LIST)  * 04000000
*                                                                     * 04050000
*                 R12     RECEIVES FROM BNGIDISP THE ADDRESS OF THE   * 04100000
*                         COMMUNICATION AREA (SEE BNGIDISP R12 FOR    * 04150000
*                         CONTENTS OF AREA).                          * 04200000
*                                                                     * 04250000
*    BNGIMENU     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04300000
*                                                                     * 04350000
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04400000
*                         BNGIDISP.                                   * 04450000
*                                                                     * 04500000
*    BNGILOCL     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04550000
*                                                                     * 04600000
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04650000
*                         BNGIDISP.                                   * 04700000
*                                                                     * 04750000
*    BNGIRMOT     R5      RECEIVES ADDRESS OF IMS PCB FROM BNGIDISP   * 04800000
*                                                                     * 04850000
*                 R12     RECEIVES ADDRESS OF INPUT MESSAGE FROM      * 04900000
*                         BNGIDISP.                                   * 04950000
*                                                                     * 05000000
*                                                                     * 05050000
*    PATCH LABEL = NONE                                               * 05100000
*                                                                     * 05150000
* MODULE TYPE = IMS DISPLAY CONTROL                                   * 05200000
*                                                                     * 05250000
*    PROCESSOR = ASSEMBLER H                                          * 05300000
*                                                                     * 05350000
*    MODULE SIZE = 9047 DECIMAL BYTES                                 * 05400000
*                                                                     * 05450000
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 05500000
*                                                                     * 05550000
* ENTRY POINT = BNGIDISP                                              * 05600000
*                                                                     * 05650000
*    PURPOSE = SEE FUNCTION                                           * 05700000
*                                                                     * 05750000
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 05800000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 05850000
*              R15 LOADED WITH ENTRY POINT                            * 05900000
*                                                                     * 05950000
* INPUT = PARAM LIST ITEMS USED ARE :  MSGIN  (LABEL)                 * 06000000
*                                                                     * 06050000
* OUTPUT = PARAM LIST ITEMS USED ARE : MSGOUT (LABEL)                 * 06100000
*                                                                     * 06150000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 06200000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 06250000
*                                                                     * 06300000
* EXIT-ERROR  = NONE                                                  * 06350000
*                                                                     * 06400000
* EXTERNAL REFERENCE = BNGILOCL,BNGIRMOT,BNGIMENU,BNGI3270 & BNGIREAD * 06450000
*                                                                     * 06500000
*    ROUTINES = LOCATE ROUTINE                                        * 06550000
*               MOD1SCAN ROUTINE                                      * 06600000
*               MOD1 TABLE BUILD (AT LABEL S215) ROUTINE              * 06650000
*                                                                     * 06700000
*    DATA AREAS = NONE                                                * 06750000
*                                                                     * 06800000
*    CONTROL BLOCK = NONE                                             * 06850000
*                                                                     * 06900000
* TABLES = TABLE    - FUNCTION/COMPANION TABLE                        * 06950000
*          MOD1TAB  - 3277 MODEL 1 TABLE                              * 07000000
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 07050000
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 07100000
*          LOTOUP   - LOWER TO UPPER CASE CHARS TABLE                 * 07150000
*                                                                     * 07200000
* MACROS = SAVE, RETURN, CALL(FOR GET/PUT MSG), ABEND                 * 07250000
*          (HARD CODED LINK)                                          * 07300000
*                                                                     * 07350000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 07400000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 07400107
* CHANGE 02  02/22/77  BNGHJN MACRO ADDED                             * 07400207
*D122000,128500-129000                                         @OZ29912 07400307
*C181500                                                       @OZ29912 07400407
*A123500,614000,635000                                         @OZ29912 07400507
*A489500                                                       @OZ31883 07400607
*D417500-418500                                                @OZ31879 07400707
*C420000-421000,505500-506000,553000-554000,555500-559000      @OZ31879 07400807
*C560500-563000                                                @OZ31879 07400907
*A373500,614200,635400                                         @OZ31886 07401007
*                                                                     * 07500000
*********************************************************************** 07550000
*********************************************************************** 07600000
*                                                                     * 07650000
BNGIDISP TITLE 'DISPLAY AUDITS INPUT AND DISPLAYS ALL LINES,LINE, CTRL' 07700000
*                                                                     * 07750000
*********************************************************************** 07800000
         SPACE                                                          07850000
PCB      DSECT                 MAP OF IMS PROGRAM COMMUNICATION BLOCK   07900000
         USING *,PCBREG                                                 07950000
PCBTERMN DS    CL8                 REQUESTING TERMINAL SYMBOLIC NAME    08000000
         DS    CL2                 RESERVED                             08050000
PCBSTAT  DS    CL2                 DL/I STATUS CODE                     08100000
PCBDATE  DS    PL4                 TRANSACTION DATE STAMP 00YYDDDF      08150000
PCBTIME  DS    PL4                 TRANSACTION TIME STAMP HHMMSSTH      08200000
PCBSEQ   DS    F                   TRANSACTION SEQUENCE NUMBER          08250000
PCBMODNM DS    CL8                 MFS MESSAGE OUTPUT DESCRIPTOR NAME   08300000
FIOADBA  DSECT                                                          08350000
         USING *,FIOABAR                                                08400000
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            08450000
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              08500000
CTRLBACK DS    F                   BACKWARD PTR IN CTRL BLK CHAIN       08550000
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        08600000
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         08650000
         DS    CL15                FOR FUTURE USE                       08700000
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          08750000
         ORG   FIOADBA                                                  08800000
DATAPORT DS    CL6                 PORT & LIB ADDR                      08850000
DATATIME DS    CL4                 TIME BLOCK CREATED                   08900000
DATADATE DS    CL4                 DATE BLOCK CREATED                   08950000
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   09000000
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   09050000
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         09100000
         DS    CL10                                                     09150000
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               09200000
SLOTS    DSECT           MAP OF ENTRIES IN CONTROL BLOCK                09250000
         USING *,DATAREG                                                09300000
SLOTLINE DS    CL6                CHANNEL ADDRESS(PORT OR LIB)          09350000
SLOTNBC  DS    CL2                NUMBER OF BLOCKS IN THIS CHAIN        09400000
SLOTHITS DS    CL2                TOTAL HITS ON THIS LINE               09450000
SLOTRFB  DS    CL3                RELATIVE ADDRESS FIRST BLOCK IN CHAIN 09500000
SLOTRLB  DS    CL3                RELATIVE ADDRESS LAST BLOCK IN CHAIN  09550000
SLOTLTH  EQU   *-SLOTS                                                  09600000
         ORG   SLOTS         MAP OF MDR AND OBR IN DETAIL BLOCKS        09650000
DATALTH  DS    C                   LTH OF THIS SLOT                     09700000
LINEIDA  DS    CL6                 LINE AND LIB ADDR                    09750000
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              09800000
         DS    CL3                                                      09850000
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           09900000
         DS    CL3                                                      09950000
DATE     DS    CL4                 DATE OF ERROR - 00YY0DDF             10000000
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             10050000
         DS    CL8                                                      10100000
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 10150000
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              10200000
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 10250000
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   10300000
         DS    CL2                                                      10350000
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    10400000
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  10450000
         DS    CL6                                                      10500000
OBRUCB   DS    C                                                        10550000
         DS    CL3                                                      10600000
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 10650000
OBRCTRL  DS    C                                                        10700000
OBRTERM  DS    C                                                        10750000
         DS    CL12                                                     10800000
OBRSENSE DS    CL2                 OBR SENSE BYTES                      10850000
*********************************************************************** 10900000
BNGIDISP CSECT                                                          10950000
R1       EQU   1                                                        11000000
BASE1    EQU   2             BASE REGISTER ONE = 0-4095                 11050000
BASE2    EQU   3             BASE REGISTER TWO = 4096-8191              11100000
BASE3    EQU   4             BASE REGISTER THREE = 8192-12287           11150000
PCBREG   EQU   5             IMS PGM COMM BLOCK BASE                    11200000
FIOABAR  EQU   6             POINTS TO FIOA                             11250000
PARMREG  EQU   6             POINTS TO PARM AREA                        11300000
OUTREG   EQU   7             POINTS TO DATA IN TIOA AREA                11350000
OUTLOOP  EQU   8             USED FOR LOOPING THRU DATA IN TIOA AREA    11400000
DATAREG  EQU   9             POINTS TO DATA IN FIOA AREA                11450000
DATALOOP EQU   10            USED FOR LOOPING THRU DATA IN FIOA AREA    11500000
TABLEREG EQU   11            POINTS TO FUNCTION/COMPANION TABLE AND     11550000
*                              VTAM DSECT.                              11600000
LINKREG  EQU   11                  SUBROUTINE LINKAGE                   11650000
R11      EQU   11                                                       11700000
MOD1REG  EQU   12            POINTS TO MOD-1 TABLE                      11750000
R13      EQU   13                                                       11800000
R14      EQU   14                                                       11850000
R15      EQU   15                                                       11900000
*********************************************************************** 11950000
*                                                                     * 12000000
*        THIS SECTION DOES PROGRAM INITIALIZATION                     * 12050000
*                                                                     * 12100000
*********************************************************************** 12150000
         SAVE  (14,12)             SAVE CALLER'S REGISTERS              12250000
         BALR  BASE1,0                                                  12300000
         USING *,BASE1,BASE2,BASE3                                      12350000
BNGIDISP BNGHJN SKIPID                                         @OZ29912 12370007
         LA    BASE2,2048(BASE1)    SET SECOND BASE                     12400000
         LA    BASE2,2048(BASE2)       FROM THE FIRST                   12450000
         LA    BASE3,2048(BASE2)    SET THIRD BASE                      12500000
         LA    BASE3,2048(BASE3)       FROM THE SECOND                  12550000
         LA    14,SAVE             POINT TO OUR SAVE AREA               12600000
         ST    14,8(13)            FORWARD CHAIN FROM OLD               12650000
         ST    13,4(14)            BACKWARD CHAIN TO OLD                12700000
         LR    13,14               FIRST BASE AND S/A FOR OUR REGS      12750000
         B     GO                                                       12800000
SAVE     DS    18F                 SAVE AREA                            12950000
GO       DS    0H                                                       13000000
         MVC   IOPCB+1(3),1(R1)     SAVE IOPCB ADDRESS                  13050000
*********************************************************************** 13100000
*                                                                     * 13150000
*        THIS SECTION  GETS A TRANSACTION                             * 13200000
*                                                                     * 13250000
*********************************************************************** 13300000
GETRANS  DS    0H                                                       13350000
         MVI   MOD1TABL,C' '       BLANK OUT MOD-1 TABLE AREA           13400000
         MVC   MOD1TABL+1(63),MOD1TABL                                  13450000
         MVI   MOD1SW,X'00'        SET MOD-1 SWITCH OFF                 13500000
         MVI   ERRDATA,C' '        BLANK OUT ERROR MESSAGE AREA         13550000
         MVC   ERRDATA+1(116),ERRDATA  *                                13600000
         L     PCBREG,IOPCB        POINT TO IOPCB                       13650000
         CALL  ASMTDLI,(GU,(PCBREG),MSGIN),VL     GET INPUT MSG         13700000
         CLC   PCBSTAT,DLIOK       MESSAGE SEGMENT OBTAINED?            13750000
         BE    A100                GO RESPOND TO MESSAGE IF SO          13800000
         CLC   PCBSTAT,DLIQC       NO MORE TRANSACTIONS AVAILABLE?      13850000
         BNE   ABEND1              INFORM SOMEONE IF UNKNOWN STATUS     13900000
         L     R13,4(R13)          RESTORE INCOMING SAVE AREA ADDRESS   13950000
         RETURN (14,12),T,RC=0     RELINQUISH CONTROL                   14000000
ABEND1   ABEND 666,DUMP                                                 14050000
CHECKST  CLC   PCBSTAT,DLIOK       DID ISRT GO OK?                      14100000
         BE    GETRANS             IF SO, GET ANOTHER MESSAGE           14150000
ABENDMSG ABEND 444,DUMP                                                 14200000
         EJECT                                                          14250000
*********************************************************************** 14300000
*                                                                     * 14350000
*        THIS SECTION EDITS THE INPUT MESSAGE.                        * 14400000
*                                                                     * 14450000
*********************************************************************** 14500000
A100     ZAP   FLDCNT,=P'0'        SET KEYED-IN FIELD COUNTER TO ZERO.  14550000
         XC    PARM1(48),PARM1     ZERO OUT PARM FIELDS                 14600000
         MVC   PARM1(4),MSGTXCD    MOVE TRANSACTION CODE 'DEMF'         14650000
         LH    DATAREG,TIOATDL     SET DATAREG = LNGTH OF INPUT         14700000
         CH    DATAREG,=H'9'       'DEMF ' ONLY ENTERED FROM CLEAR SCR? 14750000
         BNH   D28                 YES. GOTO BNGIMENU                   14800000
         CLC   MSGKEYED,=CL29' '   WAS REQUEST KEYED IN?                14850000
         BNE   A150                YES.                                 14900000
         CLC   MSGCMDCD,=C'MENU'   IS INPUT ENTERED ON PAGE1?           14950000
         BNE   A115                NO.                                  15000000
         CLC   MSGDPRSS,=C'DEPRESS'     IS INPUT ENTERED FROM PAGE 1?   15050000
         BNE   D28                      NO.  GO TO BNGIMENU RTN         15100000
         CLI   MSGALL,C' '         IS ALL CHECKED?                      15150000
         BNE   A100ALL             YES.                                 15200000
         CLI   MSG3270,C' '        IS 3270 CHECKED?                     15250000
         BNE   A150                YES.                                 15300000
         CLI   MSGRMOT,C' '        IS REMOTE CHECKED?                   15350000
         BNE   A100RMOT            YES.                                 15400000
         CLI   MSGLOCL,C' '        IS LOCAL CHECKED?                    15450000
         BNE   A100LOCL            YES.                                 15500000
         B     D28                 GO CALL BNGIMENU RTN                 15550000
A100ALL  MVC   PARM2(3),=C'ALL'    MOVE CMND TO PARM2                   15600000
         B     D10                                                      15650000
A100RMOT MVC   PARM2(4),=C'REMO'   MOVE CMND TO PARM2                   15700000
         B     D10                                                      15750000
A100LOCL MVC   PARM2(4),=C'LOCA'   MOVE CMND TO PARM2                   15800000
         B     D10                                                      15850000
A115     MVC   PARM2(4),MSGCMDCD   MOVE COMMAND ALL, LINE, CTRL,        15900000
*                                                3270, OR MENU          15950000
         MVC   SAVEBBSS,MSGBBBSS   SAVE BBBSS FOR LINKED-TO PGM         16000000
         CLI   MSGPGF,C' '         IS THIS A PAGE FORWARD REQUEST?      16050000
         BNE   A120                YES.                                 16100000
         CLI   MSGPGB,C' '         IS THIS A PAGE BACKWARD REQUEST?     16150000
         BE    A140                NO.  MUST BE COMPANION REQUEST       16200000
         MVC   PARM4(4),=C'PAGE'                                        16250000
         MVC   PARM5(7),=C'BACKWRD'                                     16300000
         B     D10                 CONT NORMAL PROCESSING               16350000
A120     MVC   PARM4(4),=C'PAGE'                                        16400000
         MVC   PARM5(7),=C'FORWARD'                                     16450000
         B     D10                                                      16500000
A140     CLC   MSGCMDCD,=C'3270'   IS THIS FROM 3270 SCREEN?            16550000
         BNE   A145                NO.                                  16600000
         CLC   MSGNTRY(4),=C'BITS' IS THIS FROM BITS PRMPTR SCR?        16650000
         BE    D10                 YES. GOTO BNGI3270 PGM               16700000
A145     MVC   PARM3,MSGNTRY+4     MOVE X'ED-IN DATA TO PARM3           16750000
         OC    PARM3,PARM3         WAS ANYTHING X'ED?                   16800000
         BZ    D28                 NO. GOTO BNGIMENU                    16850000
         B     C109                YES. CK FOR COMPANION REQUEST        16900000
A150     LA    DATAREG,MSGKEYED    POINT TO KEYED-IN DATA               16950000
         LR    DATALOOP,DATAREG    SETUP DATA LOOP                      17000000
         AH    DATALOOP,=H'29'                                          17050000
         LA    PARMREG,PARM2       POINT TO PARMS.                      17100000
         LR    14,PARMREG                                               17150000
         MVI   NEWPARM,C'1'        TURN ON 'NEW PARM' SWITCH.           17200000
         MVI   CTRPARM,X'00'       SET PARM CHAR CTR = 0                17250000
A160     CLI   0(DATAREG),X'FF'    IS THIS BYTE A X'FF'?                17300000
         BNE   A210                NO.                                  17350000
         CLI   PARM3,X'00'         YES. IS PARM3 = SYMNAME ?            17400000
         BE    A155                NO. GO SET SYMNAME FROM PCBTERMN     17450000
         MVC   TWALINE(8),PARM3    YES. SET SYMNAME FROM PARM3          17500000
         B     A156                AND LOAD LLLCCTT/TTT IN PARMS        17550000
A155     MVC   TWALINE(8),PCBTERMN MOVE DEFAULT SYMNAME IN TWALINE      17600000
A156     XC    PARM3(32),PARM3     CLEAR PARMS FOR HARDWARE ADDR        17650000
         MVC   PARM3(3),1(DATAREG) LOAD PARM3 = LLL OR TTT              17700000
         MVC   PARM4(2),4(DATAREG) LOAD PARM4 = CC                      17750000
         MVC   PARM5(2),6(DATAREG) LOAD PARM5 = TT                      17800000
         CLC   PARM4(2),=C'00'     IF PARM4 = ZEROS                     17850000
         BNE   A158                   THEN ZERO-OUT PARM4               17900000
         XC    PARM4(16),PARM4                    & PARM5.              17950000
A158     AP    FLDCNT,=P'1'          INDICATE TO BNGI3270 PGM THAT      18000000
*                                    DATA WAS KEYED IN                  18050000
         B     D10                                                      18100000
A210     CLI   0(DATAREG),X'FE'    IS THIS BYTE A 'FE' ?       @OZ29912 18150007
         BNE   A250                NO.                         @OZ29912 18158007
         MVC   MSG10NAM,1(DATAREG) YES.MOVE VTAM NAME TO ERRMSG@OZ29912 18166007
         B     Z100                GO WRITE ERR MSG.           @OZ29912 18174007
A250     CLI   0(DATAREG),C'A'     IS IT AN 'A' OR HIGHER?     @OZ29912 18182007
         BL    B80                 NO. CHECK NEW PARM SWITCH.           18200000
         CLI   NEWPARM,C'1'        IS FIRST CHAR FOR PARM(X)?           18250000
         BNE   B10                 NO.                                  18300000
         MVI   NEWPARM,C'0'        YES. SET FIRST CHAR IN FOR PARM      18350000
         MVI   CTRPARM,X'00'       SET PARM CHAR CTR = 0                18400000
B10      IC    R11,CTRPARM         LOAD R11 = CTRPARM                   18450000
         LA    R11,1(R11)          ADD CTRPARM = CTRPARM + 1            18500000
         STC   R11,CTRPARM         STORE NEW CTR BACK CTRPARM           18550000
         CLI   CTRPARM,X'08'       IS CHAR COUNT IN PARM OVER 8 ?       18600000
         BNH   B20                 NO.                                  18650000
         CLC   PARM2(6),=C'REMOTE' IS THIS A REMOTE SCREEN ?            18700000
         BE    B40                 YES. CONTINUE                        18750000
         B     Z40                 NO. ISSUE INVALID FORMAT MSG         18800000
B20      MVC   0(1,14),0(DATAREG)  PUT THIS BYTE IN THIS PARM           18850000
         CLI   PARM6+7,X'00'       ARE ALL PARMS USED UP?               18900000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    18950000
         LA    14,1(14)            BUMP PARM POINTER WORKREG.           19000000
B40      LA    DATAREG,1(DATAREG)  BUMP TIOA POINTER.                   19050000
         CR    DATAREG,DATALOOP    IS THERE MORE DATA IN TIOA?          19100000
         BL    A160                YES. GO PROCESS MORE DATA.           19150000
         B     C10                 NO. GOTO SYNTAX CHECKING ROUTINE     19200000
B80      CLI   NEWPARM,C'1'        IS NEW-PARM SWITCH ON?               19250000
         BE    B40                 YES. CHECK FOR MORE DATA.            19300000
         CLI   PARM6,X'00'         NO. ARE ALL PARMS USED UP?           19350000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    19400000
         AP    FLDCNT,=P'1'        ONE  FIELD ENTERED INTO PARM         19450000
         LA    PARMREG,8(PARMREG)  NO. BUMP TO NEXT NEW PARM.           19500000
         LR    14,PARMREG          POINT WORK REG TO NEXT PARM.         19550000
         MVI   NEWPARM,C'1'        TURN ON NEW-PARM SWICH.              19600000
         B     B40                 GO CHECK FOR MORE DATA.              19650000
*********************************************************************** 19700000
*                                                                     * 19750000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 19800000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 19850000
*                                                                     * 19900000
*********************************************************************** 19950000
         EJECT                                                          20000000
*********************************************************************** 20050000
*                                                                     * 20100000
*        SYNTAX CHECKING ROUTINE                                      * 20150000
*                                                                     * 20200000
*********************************************************************** 20250000
C10      CLC   PARM2(5),=X'D4C5D5E400' IS PARM2=MENU ?                  20300000
         BNE   C20                     NO                               20350000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  20400000
         BE    D28                     YES. GOTO BNGIMENU               20450000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  20500000
C20      CLC   PARM2(4),=X'C1D3D300'   IS PARM2 = ALL ?                 20550000
         BNE   C30                     NO                               20600000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  20650000
         BE    D10                     YES.GO SCHEDULE APPROPRIATE PGM  20700000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  20750000
C30      CLC   PARM2(6),=X'D3D6C3C1D300'  IS PARM2 = LOCAL ?            20800000
         BNE   C40                        NO                            20850000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  20900000
         BE    D10                     YES.GO SCHEDULE APPROPRIATE PGM  20950000
         CLC   PARM3+1(2),=C'SS'       IS LOCAL/REMOTE SCREEN ?         21000000
         BE    D10                     YES.                             21050000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  21100000
C40      CLC   PARM2(6),=X'D9C5D4D6E3C5' IS PARM2 = REMOTE ?            21150000
         BNE   C50                     NO.                              21200000
         CLC   PARM2+7(1),=C'S'        IS REMOTE SCREEN ?               21250000
         BE    C45                     YES.                             21300000
         CLI   PARM2+6,X'00'           IS REMOTE SYNTAX ERROR ?         21350000
         BNE   Z40                     YES. GO ISSUE INVALID FORMAT MSG 21400000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  21450000
         BE    D10                     YES.GO SCHEDULE APPROPRIATE PGM  21500000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  21550000
C45      CLI   PARM3,X'00'             IS REMOTE SCREEN ?               21600000
         BNE   D10                     YES.                             21650000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  21700000
C50      CLC   PARM2(5),=X'D3C9D5C500' IS PARM2 = LINE ?                21750000
         BNE   C60                     NO                               21800000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  21850000
         BNE   Z40                     NO. GO ISSUE INVALID FORMAT MSG  21900000
C55      CLI   PARM3+3,X'00'           LINE ADDR = 4 OR MORE ?          21950000
         BNE   Z40                     YES.                             22000000
         CLI   PARM3+2,X'00'           LINE ADDR = 2 OR LESS ?          22050000
         BE    Z40                     YES.                             22100000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             22150000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          22200000
C57      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         22250000
         BNL   C59                     YES. IT IS NUMERIC               22300000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          22350000
         BH    Z40                     YES. IT IS INVALID FORMAT        22400000
C59      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       22450000
         BCT   DATALOOP,C57            LOOP                             22500000
         B     D10                     NO. GO SCHEDULE APPROPRIATE PGM  22550000
C60      CLC   PARM2(5),=X'C3E3D9D300' IS PARM2 = CTRL ?                22600000
         BNE   C70                     NO                               22650000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  22700000
         BNE   Z40                     NO.                              22750000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  22800000
         BE    C55                     YES.                             22850000
C65      CLI   PARM4+2,X'00'           CTRL ADDR = 3 OR MORE ?          22900000
         BNE   Z40                     YES.                             22950000
         CLI   PARM4+1,X'00'           CTRL ADDR = 1 OR LESS ?          23000000
         BE    Z40                     YES.                             23050000
C66      LA    DATALOOP,2              SET FOR SCAN 2 CHARS             23100000
         LA    DATAREG,PARM4           SET DATAREG = PARM4 PTR          23150000
C67      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         23200000
         BNL   C69                     YES. IT IS NUMERIC               23250000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          23300000
         BH    Z40                     YES. IT IS INVALID FORMAT        23350000
C69      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       23400000
         BCT   DATALOOP,C67            LOOP                             23450000
         B     C55                     NO. GO CHECK LINE ADDR (PARM3)   23500000
C70      CLC   PARM2(5),=X'F3F2F7F000' IS PARM2 = 3270 ?                23550000
         BNE   Z40                     NO.                              23600000
         CLI   PARM6,X'00'             IS PARM6 = 00 ?                  23650000
         BNE   Z40                     NO.                              23700000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  23750000
         BE    C75                     YES.                             23800000
         CLI   PARM5+2,X'00'           IS TERMINAL ADDR = 3 OR MORE ?   23850000
         BNE   Z40                     YES.                             23900000
         CLI   PARM5+1,X'00'           IS TERMINAL ADDR = 1 OR LESS ?   23950000
         BE    Z40                     YES.                             24000000
         LA    DATALOOP,2              SET FOR SCAN 2 CHARS             24050000
         LA    DATAREG,PARM5           SET DATAREG = PARM5 PTR          24100000
C72      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         24150000
         BNL   C74                     YES. IT IS NUMERIC               24200000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          24250000
         BH    Z40                     YES. IT IS INVALID FORMAT        24300000
C74      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       24350000
         BCT   DATALOOP,C72            LOOP                             24400000
         B     C65                     NO. GO CHK LINE AND CTRL         24450000
C75      CLI   PARM4,X'00'             IS PARM4 = 00 ?                  24500000
         BNE   Z40                     NO.                              24550000
         CLI   PARM3+3,X'00'           IS TERM/LINE = 4 OR MORE ?       24600000
         BNE   Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   24650000
         CLI   PARM3+2,X'00'           IS TERM/LINE = 2 OR LESS ?       24700000
         BE    Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   24750000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             24800000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          24850000
C77      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         24900000
         BNL   C79                     YES. IT IS NUMERIC               24950000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          25000000
         BH    Z70                     YES. IT IS SYMBOLIC ERROR        25050000
C79      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       25100000
         BCT   DATALOOP,C77            LOOP                             25150000
         B     D10                     NO SYMBOLIC ERROR FOUND          25200000
*********************************************************************** 25250000
         EJECT                                                          25300000
*********************************************************************** 25350000
*                                                                     * 25400000
*        AT THIS POINT, THE REQUEST IS FOR A BLOWUP OF AN ENTRY OF ONE* 25450000
*        OF THE DISPLAYS. THE FUNCTION/COMPANION TABLE IS SEARCHED FOR* 25500000
*        THE NAME OF THE PROGRAM TO PERFORM THE NEXT DISPLAY.         * 25550000
*                                                                     * 25600000
*********************************************************************** 25650000
C109     LA    TABLEREG,TABLE      POINT AT FUNCTION/COMPANION TABLE.   25700000
C110     CLC   0(4,TABLEREG),PARM2 PGRM NAME IN TABLE?                  25750000
         BE    C170                YES.                                 25800000
         CLC   0(3,TABLEREG),=C'END'    END OF TABLE?                   25850000
         BE    D28                 YES. GO CK FOR MENU REQUEST       PH 25900000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY.         25950000
         B     C110                GO CH NEXT ENTRY.                    26000000
C170     OC    4(4,TABLEREG),4(TABLEREG)   IS THERE A COMPANION PGRM?   26050000
         BZ    D10                               NO.                    26100000
         MVC   PARM2(4),4(TABLEREG)     MOVE COMPANION NAME TO PARM2.   26150000
         CLC   PARM2(4),=C'TERM'  IS THIS A TERML ERROR REQUEST?        26200000
         BNE   D10                 NO.                                  26250000
         L     15,=V(BNGI3270)    LINK TO BNGI3270 PGM.                 26300000
         B     D75                                                      26350000
*********************************************************************** 26400000
*                                                                     * 26450000
*        THIS SECTION SCHEDULES THE APPROPRIATE DISPLAY PROGRAM:      * 26500000
*        ALL LINES, LINE, CTRL, 3270, OR MENU                         * 26550000
*                                                                     * 26600000
*********************************************************************** 26650000
D10      L     TABLEREG,=A(TABLE)  POINT AT FUNCTION/COMPANION TABLE.   26700000
D20      CLC   0(4,TABLEREG),PARM2        PROGRAM NAME IN TABLE?        26750000
         BE    D25                        YES.                          26800000
         CLC   0(3,TABLEREG),=C'END'      END OF TABLE?                 26850000
         BE    D28                        YES. GO TO MENU REQUEST       26900000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY.         26950000
         B     D20                GO CHECK NEXT ENTRY.                  27000000
D25      CLI   4(TABLEREG),X'00'  IS THERE A PGRM NAME TO XCTL TO?      27050000
         BNE   E10                NO.                                   27100000
         L     15,=V(BNGI3270)                                          27150000
         CLC   8(8,TABLEREG),=C'BNGI3270'                               27200000
         BE    D75                                                      27250000
         L     15,=V(BNGILOCL)                                          27300000
         CLC   8(8,TABLEREG),=C'BNGILOCL'                               27350000
         BE    D50                                                      27400000
         L     15,=V(BNGIRMOT)                                          27450000
         CLC   8(8,TABLEREG),=C'BNGIRMOT'                               27500000
         BE    D50                                                      27550000
D28      DS    0H                                                       27600000
         L     15,=V(BNGIMENU)                                          27650000
D50      DS    0H                                                       27700000
         LA    12,MSGIN            SET UP COMMUNICATION'S POINTER FOR   27750000
*                                     BNGILOCL AND BNGIRMOT             27800000
         B     D100                LINK TO MODULE                       27850000
D75      DS    0H                                                       27900000
         LA    12,COMMAREA         SET UP COMMUNICATION POINTER         27950000
D100     BALR  14,15               LINK TO APPROPRIATE MODULE           28000000
         B     GETRANS             GET ANOTHER MESSAGE                  28050000
         EJECT                                                          28100000
*********************************************************************** 28150000
*                                                                     * 28200000
*        AT THIS POINT IT HAS BEEN DETERMINED THAT THE REQUEST IS FOR * 28250000
*        ALL LINES, LINE, OR CTRL. THIS MODULE HANDLES THOSE DISPLAYS.* 28300000
*                                                                     * 28350000
*********************************************************************** 28400000
*********************************************************************** 28450000
*                                                                     * 28500000
*        THIS SECTION CREATES THE COMMON HEADER FOR                   * 28550000
*        ALL LINES, ONE LINE, AND CTRL.                               * 28600000
*                                                                     * 28650000
*********************************************************************** 28700000
E10      MVC   MSGCMD,0(TABLEREG)     MOVE NAME OF THIS                 28750000
*                                     DISPLAY TO OUTPUT                 28800000
         OC    MSGCMD,=CL4' '         CHANGE ALL'00' TO ALL' '          28850000
         MVC   MSGPG,HDRPG                                              28900000
         MVC   MSGRECAP,18(TABLEREG)  MOVE RECAP HEADER TO TIOA         28950000
         MVC   MSGHDR1,59(TABLEREG)   MOVE COLUMN HEADER TO TIOA.       29000000
         MVC   MSGHDR2,59(TABLEREG)   MOVE COLUMN HEADER AGAIN          29050000
         MVC   LGBBBSS,=C'BBBSSBBBSSBBBSS' SETUP OUTPUT BBBSS           29100000
         MVC   SMBBBSS,LGBBBSS             SETUP OUTPUT BBBSS           29150000
         LA    OUTREG,MSGHDR2+39      POINT TO FIRST ENTRY IN OUTPUT    29200000
         LA    OUTLOOP,14             SETUP 14 LINE ITEMS FOR MOD 1     29250000
*                                     ADJUST FOR MOD 2 AFTER            29300000
*                                     MOD 1 ITEMS ENTERED IN OUTPUT     29350000
*********************************************************************** 29400000
*                                                                     * 29450000
*        THIS SECTION BUILDS THE APPROPRIATE DISPLAY                  * 29500000
*                                                                     * 29550000
*********************************************************************** 29600000
F150     CP    FLDCNT,=P'0'      FIELD'S KEYED-IN?                      29650000
         BE    R10                NO. GO TO BLOWUP/PAGING SECTION       29700000
F180     XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        29750000
*        DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=G120,DATASET=EMFILE       29800000
         BAL   LINKREG,READ        GET FIRST CONTROL BLOCK.             29850000
         B     G120                                                     29900000
*********************************************************************** 29950000
*                                                                     * 30000000
*        THIS IS A COMMON READ SUBROUTINE FOR THIS PROGRAM.           * 30050000
*                                                                     * 30100000
*********************************************************************** 30150000
READ     ST    11,SAVE11                                                30200000
         LA    11,PARMADDR         SET UP PARM REG                      30250000
         L     15,=V(BNGIREAD)    POINT TO READ MODULE                  30300000
         BALR  14,15              LINK TO BDAM READ MODULE              30350000
         L     11,SAVE11                                                30400000
         OC    STATUS,STATUS      READ OK?                              30450000
         BZ    0(LINKREG)         YES. RETURN TO CALLER                 30500000
         CLC   STATUS,=C'FF'       WAS EMFILE OPENED?                   30550000
         BE    Z60                 NO.  WRITE 'NOT OPEN' MSG            30600000
         UNPK  DBLWD,STATUS(3)                                          30650000
         MVC   IOERCODE,DBLWD+3                                         30700000
         TR    IOERCODE,HXTOEB     MOVE BDAM RETURN CODE TO I/O ERR MSG 30750000
         UNPK  DBLWD,RELREC(4)                                          30800000
         MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     30850000
         TR    IOERBLK,HXTOEB                                           30900000
         B     Z20                     IF REQUESTED SLOT CAN'T          30950000
*                                        BE FOUND, SEND 'SEARCHING ERR' 31000000
SAVE11   DS    F                                                        31050000
*********************************************************************** 31100000
*                                                                     * 31150000
*********************************************************************** 31200000
G120     L     FIOABAR,IOAREA      POINT TO FIOA AREA.                  31250000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    31300000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           31350000
         SR    DATALOOP,DATALOOP                                        31400000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      31450000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        31500000
         CLC   PARM2(3),=C'ALL'    DOES PARM2 = ALL?                    31550000
         BE    J10                 YES.                                 31600000
         OC    PARM3,PARM3         WAS A LINE ADDRESS ENTERED?          31650000
         BZ    Z40                 NO. WRITE 'NO LINE ENTERED'      PH  31700000
         MVC   LINENAME,PARM3           MOVE LINE ADDRESS TO SAVE AREA  31750000
         MVC   CLUSNAME,PARM4           MOVE CONTROL UNIT NAME TO SAVE  31800000
         MVC   MSG7CTRL,PARM4           MOVE CONTROL UNIT NAME TO SAVE  31850000
         OC    MSG7CTRL,=CL2' '            FOR CONTROL UNIT COMMAND     31900000
         MVC   MSG4LN,PARM3        MOVE LINE ADDRESS TO 'NO ERROR' MSG  31950000
         OC    MSG4LN,=CL3' '                                           32000000
         MVC   MSG7LINE,MSG4LN     MOVE LINE ADDRESS TO 'NO ERROR' MSG  32050000
*                                       FOR CONTROL UNIT COMMAND        32100000
H40      TR    PARM3(3),EBTOHX     CHANGE F0C6F2 TO 000F02 ETC.         32150000
         PACK  DBLWD,PARM3(4)      PACK   000F02 TO 0000F2 ETC.         32200000
         MVC   LINEID(3),DBLWD+4   MOVE GOOD PORTION TO SAVE AREA       32250000
         MVC   LINEID+3(3),=XL3'000000'                                 32300000
H80      CLC   SLOTLINE,LINEID     IS THIS CONTROL SLOT FOR OUR LINE?   32350000
         BE    L60                 YES. GO GET DETAIL BLOCK.            32400000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           32450000
         BCT   DATALOOP,H80        CHECK NEXT SLOT.                     32500000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 32550000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        32600000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        32650000
         BAL   LINKREG,READ                                             32700000
*        DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=H180,DATASET=EMFILE       32750000
         L     FIOABAR,IOAREA      POINT TO INPUT RECORD AREA           32800000
         SR    DATALOOP,DATALOOP                                        32850000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                32900000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 32950000
         B     H80                                                      33000000
         EJECT                                                          33050000
*********************************************************************** 33100000
*                                                                     * 33150000
*        THIS SECTION FORMATS 'ALL LINE' ENTRIES                      * 33200000
*                                                                     * 33250000
*********************************************************************** 33300000
J10      LA    14,LGBBBSS          LOAD SAVED ADDR OF BLK/SLOT TIOA.    33350000
         MVC   LGBBBSS(5),=C'00001'   MOVE 00001 TO FIRST AND           33400000
         MVC   LGBBBSS+10(5),LGBBBSS    PREVIOUS BBBSS'S                33450000
         MVC   SMBBBSS,LGBBBSS     DO THE SAME FOR SMALL SCREEN         33500000
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL SWITCH          33550000
J40      UNPK  DBLWD,SLOTLINE(4)        UNPK LINE ADDR IN WORKAREA      33600000
         TR    DBLWD+4(3),HXTOEB        CONVERT TO EBCDIC               33650000
         MVC   DTLITEM,=CL8' '     CLEAR DETAIL LINE ITEM               33700000
         MVC   DTLITEM(3),DBLWD+4  PUT LINE ADDR IN DETAIL ENTRY        33750000
J150     LH    14,SLOTHITS         PUT LINE ERRORS IN REG.              33800000
         CVD   14,DBLWD            CONVERT TO DECIMAL                   33850000
         UNPK  DTLCOUNT,DBLWD+5(3)      PUT LINE ERROR COUNT            33900000
         OI    DTLCOUNT+3,X'F0'         IN OUTPUT                       33950000
         MVC   0(DTLLTH,OUTREG),DTLENTRY   MOVE DETAIL ENTRY TO OUTPUT  34000000
         MVC   DTLCOUNT,=C'0001'      RESTORE PROGRAM CONSTANT.         34050000
         LA    OUTREG,DTLLTH(OUTREG)    UPDATE OUTPUT POINTER           34100000
         BCT   DATALOOP,K100       MORE SLOTS IN THIS CTRL BLK?         34150000
         CLC   CTRLFWD,=F'0'       NO. MORE CTRL BLKS?                  34200000
         BE    K120                NO. PREPARE TO EXIT.                 34250000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        34300000
         BAL   LINKREG,READ                                             34350000
*        DFHFC TYPE=GET,RDIDADR=RELREC,NORESP=K50,DATASET=EMFILE        34400000
         L     FIOABAR,IOAREA      POINT TO INPUT RECORD                34450000
         SR    DATALOOP,DATALOOP                                        34500000
         IC    DATALOOP,CTRLENTS   SET LOOP CONTROL.                    34550000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT                  34600000
         B     J40                                                      34650000
K100     LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           34700000
         BCT   OUTLOOP,J40         OUTPUT COUNTER EMPTY?                34750000
         CLI   QUITSW,X'FF'        OUTPUT AREA FILLED FOR 3277-2?       34800000
         BE    K120                YES.                                 34850000
         MVI   QUITSW,X'FF'        NO. TURN ON OUTPUT-FULL SWITCH       34900000
         LA    OUTLOOP,66          SETUP OUTPUT COUNTER                 34950000
         L     15,=A(SMBBBSS)      POINT TO SMALL BLK/SLT AREA IN OUPUT 35000000
         UNPK  DBLWD,RELREC(4)     STORE BDAM RELATIVE                  35050000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   35100000
         MVC   5(3,15),DBLWD+4     (LAST BBBSS) IN OUTPUT               35150000
         SR    14,14                                                    35200000
         IC    14,CTRLENTS         GET ORIGINAL COUNT OF SLOTS          35250000
         SR    14,DATALOOP         DETERMINE LAST SLOT READ.            35300000
         STC   14,DBLWD+6          STORE                                35350000
         UNPK  DBLWD(3),DBLWD+6(2) SLOT NUMBER                          35400000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         35450000
         MVC   8(2,15),DBLWD       IN OUTPUT.                           35500000
         MVC   MSGENDSM,MSGODAT2+12 STOR ERRS FOR LAST ENTRY FOR SM SCR 35550000
         B     J40                 GO PROCESS MORE SLOTS                35600000
K120     L     15,=A(LGBBBSS)     POINT TO LARGE BLK/SLT AREA IN OUTPUT 35650000
         UNPK  DBLWD,RELREC(4)     STORE BDAM RELATIVE                  35700000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   35750000
         MVC   5(3,15),DBLWD+4     (LAST BBBSS) IN OUTPUT               35800000
         SR    14,14                                                    35850000
         IC    14,CTRLENTS         GET ORIGINAL COUNT OF SLOTS          35900000
         SR    14,DATALOOP         DETERMINE LAST SLOT READ.            35950000
         STC   14,DBLWD+6          STORE                                36000000
         UNPK  DBLWD(3),DBLWD+6(2) SLOT NUMBER                          36050000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         36100000
         MVC   8(2,15),DBLWD       IN OUTPUT.                           36150000
K200     CLC   SMBBBSS+5(5),=C'BBBSS'    SMALL SCREEN FULL?             36200000
         BNE   K230                      YES.                           36250000
         MVC   SMBBBSS+5(5),LGBBBSS+5    NO. SMALL BBBSS NEVER SET      36300000
         LA    14,80                  SINCE THE ENTRIES NEVER FILLED    36350000
         SR    14,OUTLOOP             A SMALL SCREEN AREA, OUTLOOP      36400000
         LR    OUTLOOP,14             MUST BE ADJUSTED                  36450000
K230     LTR   OUTLOOP,OUTLOOP        OUTPUT ALREADY CLEARED?           36500000
         BZ    K250                   YES.                              36550000
K240     MVC   0(CLRLTH,OUTREG),CLRNTRY         NO. CLEARING            36600000
*                                               OUTPUT FIELDS           36650000
         LA    OUTREG,CLRLTH(OUTREG)    UPDATE OUTPUT POINTER           36700000
         BCT   OUTLOOP,K240       MORE ENTRIES TO CLEAR IN OUTPUT       36750000
K250     L     PCBREG,IOPCB       POINT TO IOPCB                        36800000
         CALL  ASMTDLI,(ISRT,(PCBREG),MSGOUT,LGALL),VL                  36850000
         B     CHECKST                                                  36900000
*********************************************************************** 36950000
*                                                                     * 37000000
*        THIS SECTION PREPARES THE 'LINE' OR 'CTRL' DISPLAY           * 37050000
*                                                                     * 37100000
*********************************************************************** 37150000
L60      MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.             37200000
         ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0          37250000
         MVC   RELREC,SLOTRFB      SAVE POINTER TO DETAIL BLK           37300000
L140     MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                37350000
         OC    RELREC,RELREC       IS THERE ANY DATA BLOCKS ?  @OZ31886 37360007
         BZ    Z130                NO, WRITE 'NO DATA BLKS MSG'@OZ31886 37370007
         BAL   LINKREG,READ                                             37400000
L170     L     FIOABAR,IOAREA      POINT TO INPUT RECORD AREA           37450000
         SR    DATALOOP,DATALOOP                                        37500000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                37550000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 37600000
L210     MVI   SLOTCNT,X'00'       ZERO OUT DETAIL SLOT COUNTER.        37650000
         OC    LINENAME,=CL8' '                                         37700000
         OC    CLUSNAME,=CL8' '                                         37750000
L220     L     1,=A(MSGRECAP)           POINT TO RECAP HEADER           37800000
         CLC   PARM2(4),=C'LINE'        PARM2 = LINE?                   37850000
         BE    L230                         YES.                        37900000
         CLC   PARM4,=CL8' '            IS PARM4 BLANK?                 37950000
         BE    L225                     YES. MUST BE LOCAL.             38000000
         OC    PARM4,PARM4              OR IS PARM4 ZEROS?              38050000
         BZ    L225                     YES. MUST BE LOCAL ALSO         38100000
         MVC   19(2,1),CLUSNAME         MOVE CONTROL UNIT TO HEADER     38150000
         MVC   21(9,1),=C' ON LINE '                                    38200000
         MVC   31(7,1),LINENAME         MOVE LINE ADDR. TO HEADER       38250000
         B     M10                                                      38300000
L225     MVC   9(19,1),=C'LOCAL CONTROL UNIT '                          38350000
         MVC   28(8,1),LINENAME         MOVE CTRL UNIT TO HEADER        38400000
         B     M10                                                      38450000
L230     MVC   19(8,1),LINENAME         MOVE LINE ADDR. TO HEADER       38500000
*********************************************************************** 38550000
*                                                                     * 38600000
*        THIS SECTION FORMATS A 'LINE' ITEM OR A 'CTRL' ITEM.         * 38650000
*                                                                     * 38700000
*********************************************************************** 38750000
M10      MVC   CTRLNAME,=D'0'      ZERO  OUT CONTROL UNIT WORK AREA.    38800000
         MVC   TERMNAME,=CL8' '    BLANK OUT TERMINAL WORK AREA.        38850000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           38900000
         MVC   TBARG,=CL2' '       CLEAR MOD-1 TABLE ARGUMENT           38950000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                39000000
         BE    N10                 YES.                                 39050000
         CLI   ENTRYTYP,X'30'      IS IT A BTAM OBR?                    39100000
         BE    N80                 YES.                                 39150000
         CLI   ENTRYTYP,X'34'      IS IT A TCAM OBR?                    39200000
         BE    N80                 YES.                                 39250000
         B     M140                                                     39300000
M100     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            39350000
         BE    N150                YES.                                 39400000
         OC    CTRLNAME,=CL8' '    CHANGE X'00' TO X'40'                39450000
         OC    PARM4,=CL8' '       CHANGE X'00' TO X'40'                39500000
         CLC   PARM4,CTRLNAME      PARM4 = CONTROL UNIT NAME?           39550000
         BE    N150                YES.                                 39600000
         CLI   PARM4,X'40'         IS PARM4 BLANK ?                  PH 39650000
         BNE   M140                NO. MUST BE REMOTE--BYPASS CK LOCAL  39700000
         OC    LINENAME,=CL8' '    CHANGE X'00' TO X'40'                39750000
         CLC   LINENAME,CTRLNAME   CONTROL UNIT = LINE?                 39800000
         BE    N150                YES. MUST BE LOCAL CONTROL UNIT      39850000
M140     SR    15,15                                                    39900000
         IC    15,SLOTCNT          ADD ONE                              39950000
         AH    15,=H'1'            TO                                   40000000
         STC   15,SLOTCNT          SLOT COUNTER.                        40050000
M160     SR    14,14                                                    40100000
         IC    14,DATALTH          PUT LTH OF SLOT IN WORK REG.         40150000
         AR    DATAREG,14          POINT TO NEXT DETAIL SLOT            40200000
         SR    DATALOOP,14         MORE SLOTS IN THIS DETAIL BLK?       40250000
         BP    M10                 YES.                                 40300000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  40350000
         BNE   L140                YES.                                 40400000
M240     ZAP   WORKCNT,ITEMCNT     ANY ITEMS IN TIOA?                   40450000
         BZ    Z50                 NO. WRITE 'NO ERRS' MSG FOR CTRLUNIT 40500000
         CLC   SMBBBSS+5(5),=C'BBBSS'   IS SMALL 'BBBSS' FILLED IN ?    40550000
         BNE   M260                     YES.   BYPASS FILLING IT IN     40600000
         MVC   SMBBBSS+5(5),LGBBBSS+5   NO. FILL IT IN                  40650000
M260     MVC   MSGENDSM,MSGODAT2+12 STOR ERRS FOR LAST ENTRY FOR SM SCR 40700000
         B     K200                                                     40750000
N10      CLI   MOD1SW,X'00'           MOD-1 SW ON ?                     40800000
         BE    N30                    NO. BYPASS MOD-1 SCANNER CK.      40850000
         CLC   PARM2(4),=C'CTRL'      IS THIS A 'CTRL' DISPLAY ?        40900000
         BE    N20                    YES. USE REMOTE TERMINAL ADDR     40950000
         MVC   TBARG(1),MDRCTRL       PASS REMOTE CTRL UNIT TO MOD-1    41000000
         B     N25                    GO CK ADDR AGAINST MOD-1 TABLE    41050000
N20      MVC   TBARG(1),MDRTERM       PASS REMOTE TERM ADDR TO MOD-1    41100000
N25      BAL   LINKREG,MOD1SCAN       CK IF REMOTE CU OR TERMINAL       41150000
         CLC   TBARG,=X'0000'           IN MOD-1 TABLE ?                41200000
         BE    M140                   YES. BYPASS THIS ERROR ENTRY      41250000
N30      UNPK  CTRLNAME(3),MDRCTRL(2)   MDR - PUT CONTROL UNIT          41300000
         TR    CTRLNAME(2),HXTOEB       NAME                            41350000
         MVI   CTRLNAME+2,X'00'         IN WORK AREA.                   41400000
         UNPK  TERMNAME(3),MDRTERM(2)   PUT TERMINAL                    41450000
         TR    TERMNAME(2),HXTOEB       NAME                            41500000
         MVI   TERMNAME+2,C' '          IN WORK AREA.                   41550000
         B     M100                                                     41600000
N80      CLI   OBRUCB,X'10'        IS THIS A LOCAL?                     41650000
         BE    N110                YES. GO MOVE 3-BYTE ADDR             41700000
N85      CLI   MOD1SW,X'00'           MOD-1 SW ON ?                     41900000
         BE    N95                    NO. BYPASS MOD-1 SCANNER CK.      41950000
         CLC   PARM2(4),=C'CTRL'      IS THIS A 'CTRL' DISPLAY?@OZ31879 42000007
         BE    N88                    YES. USE REMOTE TERM ADDR@OZ31879 42010007
         MVC   TBARG(1),OBRCTRL       PASS REMOTE CU TO MOD-1  @OZ31879 42020007
         B     N90                    GO CK ADDR AGAINST MOD-1 @OZ31879 42030007
N88      MVC   TBARG(1),OBRTERM       PASS REMOTE TERM ADDR    @OZ31879 42040007
*                                     TO MOD-1                 @OZ31879 42050007
N90      BAL   LINKREG,MOD1SCAN       CK IF REMOTE CU OR TERM  @OZ31879 42060007
         CLC   TBARG,=X'0000'           IN MOD-1 TABLE ?                42150000
         BE    M140                   YES. BYPASS THIS ERROR ENTRY      42200000
N95      UNPK  DBLWD,OBRCTRL(2)    OBR - MOVE 1-BYTE REMOTE CU ADDR     42250000
         TR    DBLWD+4(3),HXTOEB                                        42300000
         MVC   CTRLNAME(2),DBLWD+5      TO WORK AREA.                   42350000
         UNPK  DBLWD,OBRTERM(2)         MOVE 1-BYTE REMOTE TERML ADDR   42400000
         TR    DBLWD+4(3),HXTOEB                                        42450000
         MVC   TERMNAME(2),DBLWD+5      WORK AREA.                      42500000
         B     M100                                                     42550000
N110     UNPK  DBLWD,LINEIDA(4)    OBR - MOVE 3-BYTE CONTROL UNIT       42600000
         TR    DBLWD+4(3),HXTOEB        ADDRESS(POSSIBLY ROUNDED)       42650000
         MVC   CTRLNAME(3),DBLWD+4      TO WORK AREA.                   42700000
         CLI   MOD1SW,X'00'           MOD-1 SW ON ?                     42750000
         BE    N130                   NO. BYPASS MOD-1 SCANNER CK.      42800000
         MVC   TBARG,OBRCUA           PASS LOCAL TERMINAL TO MOD-1      42850000
*                                       SCANNER                         42900000
         BAL   LINKREG,MOD1SCAN       CK IF LOCAL TERMINAL              42950000
         CLC   TBARG,=X'0000'           IN MOD-1 TABLE ?                43000000
         BE    M140                   YES. BYPASS THIS ERROR ENTRY      43050000
N130     UNPK  DBLWD,OBRCUA(3)          MOVE REAL 3-BYTE CONTROL        43100000
         TR    DBLWD+4(3),HXTOEB        UNIT ADDRESS                    43150000
         MVC   TERMNAME(3),DBLWD+4      WORK AREA.                      43200000
         B     M100                                                     43250000
N150     OC    CTRLNAME,=CL8' '    CHANGE ZEROS TO BLANKS.              43300000
         LA    14,MSGHDR2+39       POINT TO FIRST ITEM IN TIOA          43350000
         ZAP   WORKCNT,ITEMCNT     ANY ITEMS IN TIOA?                   43400000
         BZ    P90                 NO. ADD NEW ITEM.                    43450000
N170     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            43500000
         BE    P20                 YES.                                 43550000
         CLC   TERMNAME,ITEMLTH(14)     WORKTERMINAL = TIOA TERMINAL?   43600000
         BE    P40                 YES.                                 43650000
N230     LA    14,DTLLTH(14)       BUMP TO NEXT ITEM                    43700000
         SP    WORKCNT,=PL2'1'     SUBT ONE FROM ITEM COUNTER.          43750000
         BZ    P90     ANY ITEMS?  NO. ADD NEW ITEM.                    43800000
         B     N170                                                     43850000
P20      CLC   CTRLNAME,ITEMLTH(14)     WORK CTRL = TIOA CTRL?          43900000
         BNE   N230                NO.                                  43950000
P40      PACK  FULLWD(3),COUNTLTH(4,14)  ADD                            44000000
         AP    FULLWD(3),=P'1'          ONE                             44050000
         UNPK  COUNTLTH(4,14),FULLWD(3)  TO                             44100000
         OI    COUNTLTH+3(14),X'F0'     COUNT FIELD.                    44150000
         B     M140                GO CHECK NEXT SLOT.                  44200000
P90      CLC   PARM2(4),=C'LINE'        IS THIS A 'LINE' DISPLAY?       44250000
         BE    P170                     YES.                            44300000
         MVC   DTLITEM,TERMNAME    NO. MOVE TERMINAL                    44350000
P120     MVC   0(DTLLTH,OUTREG),DTLENTRY  TO OUTPUT                     44400000
         LA    OUTREG,DTLLTH(OUTREG)    UPDATE OUTPUT POINTER.          44450000
         AP    ITEMCNT,=P'1'       ADD 1 TO COUNT OF OUTPUT ITEMS.      44500000
         SR    15,15                                                    44550000
         IC    15,SLOTCNT          ADD ONE                              44600000
         AH    15,=H'1'               TO                                44650000
         STC   15,SLOTCNT             SLOT COUNTER                      44700000
         L     15,=A(LGBBBSS)      POINT TO LARGE BLK/SLT AREA IN OUPUT 44750000
         UNPK  DBLWD,SVRELREC(4)   STORE BDAM RELATIVE                  44800000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   44850000
         MVC   5(3,15),DBLWD+4     (LAST BBBSS) IN OUTPUT               44900000
         UNPK  DBLWD(3),SLOTCNT(2)     STORE SLOT NUMBER IN             44950000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         45000000
         MVC   8(2,15),DBLWD       IN OUTPUT.                           45050000
         CP    ITEMCNT,=P'1'       IS THIS THE FIRST ITEM IN TIOA ?     45100000
         BNE   P140                NO. BYPASS UPDATE OF BBBSS'S         45150000
         MVC   LGBBBSS(5),LGBBBSS+5   UPDATE (FIRST BBBSS) FOR LG SCR   45200000
         MVC   SMBBBSS(5),LGBBBSS     UPDATE (FIRST BBBSS) FOR SM SCR   45250000
         CLC   LGBBBSS+10(5),=C'BBBSS'  IS PREV BBBSS FILLED IN ?       45300000
         BNE   P140                     YES. DON'T UPDATE.              45350000
         MVC   LGBBBSS+10(5),LGBBBSS  UPDATE (PREVIOUS BBBSS) FOR LGSCR 45400000
         MVC   SMBBBSS+10(5),LGBBBSS  UPDATE (PREV  BBBSS) FOR SM SCR   45450000
P140     BCT   OUTLOOP,M160        MORE ROOM IN TIOA?                   45500000
         CLI   QUITSW,X'FF'        OUTPUT AREA FILLED FOR 3277-2?       45550000
         BE    M240                YES.                                 45600000
         MVI   QUITSW,X'FF'        NO. TURN ON OUTPUT-FULL SWITCH       45650000
         LA    OUTLOOP,66          SETUP OUTPUT COUNTER                 45700000
         MVC   SMBBBSS+5(5),LGBBBSS+5    ADD (LAST BBBSS) TO SMBBBSS    45750000
         B     M160                GO PROCESS MORE SLOTS                45800000
P170     MVC   DTLITEM,CTRLNAME    SETUP CONTROL UNIT ADDRESS           45850000
         B     P120                     FOR OUTPUT.                     45900000
         EJECT                                                          45950000
*********************************************************************** 46000000
*                                                                     * 46050000
*        THIS SECTION PREPARES FOR AN ENTRY BLOWUP OR FOR PAGING.     * 46100000
*                                                                     * 46150000
*********************************************************************** 46200000
R10      CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            46250000
         BE    S010                YES. CK FOR FWD OR BACK.             46300000
         CLC   PARM2(4),=C'LINE'   NO. THIS MUST BE COMPANION REQUEST.  46350000
         BNE   R010                IF NOT LINE DISPLAY, GO READ RECORD. 46400000
         MVC   PARM3,MSGNTRY+4     IS LINE, MOVE THE X'D FIELD TO PRM3. 46450000
         MVC   LINENAME,MSGNTRY+4       MOVE LINE ADDRESS TO SAVE AREA  46500000
         XC    PARM4(16),PARM4      AS IF LINE ID HAD BEEN KEYED IN.    46550000
         B     F180                GO DO LINE DISPLAY AS IF THIS WERE   46600000
*                                  AN INITIAL 'LINE' INPUT.             46650000
R010     MVC   CLUSNAME,MSGNTRY+4       MOVE CONTROL UNIT ADDR TO SAVE  46700000
         MVC   PARM4,MSGNTRY+4     MOVE X'D CTRL UNIT TO PARM4 AS IF    46750000
         XC    PARM5,PARM5           IT HAD BEEN KEYED IN.              46800000
R140     TR    MSGBBBSS(3),EBTOHX  GET BLOCK NUMBER OF                  46850000
         PACK  DBLWD,MSGBBBSS(4)      REQUESTED LINE INTO HEX.          46900000
         MVC   RELREC,DBLWD+4                                           46950000
         BAL   LINKREG,READ                                             47000000
R170     L     FIOABAR,IOAREA          POINT TO INPUT RECORD AREA       47050000
         XC    PARM3,PARM3                                              47100000
         UNPK  DBLWD,DATAPORT(4)        MOVE LINE ID                    47150000
         TR    DBLWD+4,HXTOEB           FROM PREVIOUS BLOCK             47200000
         MVC   LINENAME(3),DBLWD+4     TO PARM3 AS IF IT HAD BEEN       47250000
         MVC   PARM3(3),LINENAME        KEYED IN.                       47300000
         CLC   PARM3(3),PARM4      IS THIS A LOCAL CTRL UNIT?           47350000
         BNE   F180                NO. GO TO PROCESS REMOTE.            47400000
         XC    PARM4,PARM4         YES. CLEAR REDUNDANT CU ADDR         47450000
         B     F180                GO DO A 'CTRL' DISPLAY AS IF ABOVE   47500000
*                                  CTRL & LINE HAD BEEN TYPED IN.       47550000
S010     DS    0H                                                       47600000
         MVC   WORK15,MSGBBBSS     CONVERT BBBSS'S TO HEX               47650000
         TR    WORK15,EBTOHX                                            47700000
         CLC   PARM5(4),=C'FORW'   IS IT A 'PAGE FORWARD' REQUEST?      47750000
         BE    S110                YES.                                 47800000
         PACK  DBLWD,WORK15+10(6)                                       47850000
         MVC   RELREC,DBLWD+3      THE 'PREVIOUS' BLOCK.                47900000
         MVC   TWASLOT,DBLWD+6     AND SLOT TO RESUME AT.               47950000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                   48000000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                    48050000
         MVC   LGBBBSS(5),MSGBBBSS+10   OLD PREVIOUS NOW BECOMES NEW    48100000
         MVC   LGBBBSS+10(5),MSGBBBSS+10    FIRST AND PREVIOUS.         48150000
         MVC   SMBBBSS,LGBBBSS      DO SAME FOR 3277-1 BBBSS            48200000
         B     S180                                                     48250000
S110     DS    0H                                                       48300000
         PACK  DBLWD,WORK15+5(6)                                        48350000
         MVC   RELREC,DBLWD+3      PLACE TO PAGE FORWARD FROM           48400000
         MVC   TWASLOT,DBLWD+6                                          48450000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                   48500000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                    48550000
         MVC   LGBBBSS(5),MSGBBBSS+5     OLD LAST IS NEW FIRST AND      48600000
         MVC   LGBBBSS+10(5),MSGBBBSS    OLD FIRST IS NEW PREVIOUS.     48650000
         MVC   SMBBBSS,LGBBBSS      DO SAME FOR 3277-1 BBBSS            48700000
S180     BAL   LINKREG,LOCATE      LOCATE PROPER BLOCK & SLOT.          48750000
         CLC   PARM2(3),=C'ALL'                                         48800000
         BE    J40                 GO RESUME WHERE LEFT OFF AT (ALL)    48850000
         B     S215                 YES. PREPARE MOD-1 TABLE        XXH 48900000
S190     ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0          48950000
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.    @OZ31883 48970007
         SR    15,15                                                    49000000
         IC    15,DBLWD+6              UPDATE SLOT COUNTER              49050000
         SH    15,=H'1'                    FOR PAGING IN                49100000
         STC   15,SLOTCNT              LINE OR CTRL DISPLAYS.           49150000
         UNPK  DBLWD,LINEIDA(4)        MOVE LINE ADDRESS                49200000
         TR    DBLWD+4(3),HXTOEB                TO                      49250000
         MVC   LINENAME(3),DBLWD+4     SAVE AREA FOR RECAP HDR.         49300000
         MVC   LINENAME+3(5),=CL5' '        CLEAR OUT GARBAGE           49350000
         XC    PARM4,PARM4                                              49400000
         CLI   ENTRYTYP,X'91'          IS THIS AN MDR ENTRY?            49450000
         BE    S210                         YES.                        49500000
         CLI   OBRUCB,X'40'            IS THIS A REMOTE OBR ?           49550000
         BNE   S200                         NO.                         49600000
         UNPK  CLUSNAME(3),OBRCTRL(2)       MOVE MDR DUMMY LINE ADDR    49650000
         TR    CLUSNAME(2),HXTOEB                TO                     49700000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR.    49750000
         MVC   PARM4(2),CLUSNAME              MOVE  ADDR  TO PARM4      49800000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   49850000
S200     MVC   CLUSNAME,LINENAME       MOVE OBR CTRL ADDR. TO SAVE AREA 49900000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   49950000
S210     UNPK  CLUSNAME(3),MDRCTRL(2)       MOVE MDR CTRL ADDR.         50000000
         TR    CLUSNAME(2),HXTOEB                TO                     50050000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR.    50100000
         MVC   PARM4(2),CLUSNAME       MOVE MDR CTRL ADDR. TO PARM4     50150000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   50200000
*********************************************************************** 50250000
*                                                                     * 50300000
*   THIS IS THE MOD-1 'LINE' AND 'CTRL' TABLE BUILD ROUTINE           * 50350000
*                                                                     * 50400000
*********************************************************************** 50450000
S215     CLI   ENTRYTYP,X'91'      IS THIS AN MDR?                  XXH 50500000
         BE    S218                YES. SAVE MDR CTRL UNIT     @OZ31879 50550007
         CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?      @OZ31879 50560007
         BNE   S220                NO. BYPASS SAVING CTRL UNIT @OZ31879 50570007
         MVC   TBCTRL,OBRCTRL      YES. SAVE REMOTE OBR CU     @OZ31879 50580007
         B     S220                                            @OZ31879 50590007
S218     MVC   TBCTRL,MDRCTRL      SET TBCTRL = MDRCTRL        @OZ31879 50600007
S220     MVC   TBLINE,LINEIDA      SAVE CURRENT LINE ID                 50650000
         XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        50700000
         BAL   LINKREG,READ        GET FIRST CONTROL BLOCK.             50750000
         L     FIOABAR,IOAREA      POINT TO FIOA AREA.                  50800000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    50850000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           50900000
         SR    DATALOOP,DATALOOP                                        50950000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      51000000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        51050000
S220A    CLC   TBLINE,SLOTLINE     IS THIS CONTROL SLOT FOR OUR LINE?   51100000
         BE    S222                YES. GO GET DETAIL BLOCK.            51150000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           51200000
         BCT   DATALOOP,S220A      CHECK NEXT SLOT.                     51250000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 51300000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        51350000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        51400000
         BAL   LINKREG,READ                                             51450000
         L     FIOABAR,IOAREA      POINT TO INPUT RECORD AREA           51500000
         SR    DATALOOP,DATALOOP                                        51550000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                51600000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 51650000
         B     S220A                                                    51700000
S222     ZAP   TABLECNT,=P'0'      SET CTR OF TABLE ITEMS = 0           51750000
         LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 51800000
         MVC   RELREC,SLOTRFB      MOVE POINTER TO DETAIL BLK           51850000
S222A    MVC   SVRELREC,RELREC     SAVE FOR COMPARE TO TABLE RELREC     51900000
         BAL   LINKREG,READ                                             51950000
         L     FIOABAR,IOAREA      POINT TO INPUT RECORD AREA           52000000
         SR    DATALOOP,DATALOOP                                        52050000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                52100000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 52150000
         MVI   SLOTCNT,X'01'       SET COUNT OF DETAIL BLK SLOTS=1      52200000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           52250000
S222B    CLC   SVRELREC,TBRELREC   IS THIS THE RIGHT DETL BLK ?         52300000
         BNE   S222B10             NO. CONTINUE SCAN                    52350000
         CLC   SLOTCNT,TBSLOT      IS THIS THE RIGHT ENTRY ?            52400000
         BNE   S222B10             NO. CONTINUE SCAN                    52450000
S222B03  MVI   MOD1SW,X'FF'        TURN MOD-1 SWITCH ON                 52500000
S222B05  MVC   RELREC,TBRELREC     RESTORE PAGING 'BBB'                 52550000
         MVC   TWASLOT,TBSLOT      RESTORE PAGING 'SS'                  52600000
         BAL   LINKREG,LOCATE      LOCATE STARTING 'BBBSS' FOR DISP     52650000
         B     S190                RESUME PAGING SETUP                  52700000
S222B10  LA    14,MOD1TABL         POINT OT MOD-1 TABLE                 52750000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                52800000
         BE    S222C               YES.                                 52850000
         CLI   ENTRYTYP,X'30'      IS IT A BTAM OBR?                    52900000
         BE    S222D               YES.                                 52950000
         CLI   ENTRYTYP,X'34'      IS IT A TCAM OBR?                    53000000
         BE    S222D               YES.                                 53050000
S222B20  SR    15,15                                                    53100000
         IC    15,SLOTCNT          ADD ONE                              53150000
         AH    15,=H'1'            TO                                   53200000
         STC   15,SLOTCNT          SLOT COUNTER.                        53250000
         SR    14,14                                                    53300000
         IC    14,DATALTH          PUT LTH OF SLOT IN WORK REG.         53350000
         AR    DATAREG,14          POINT TO NEXT DETAIL SLOT.           53400000
         SR    DATALOOP,14         MORE SLOTS IN THIS DETAIL BLK?       53450000
         BP    S222B               YES.                                 53500000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  53550000
         BNE   S222A               YES.                                 53600000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN MOD-1 TABLE?            53650000
         BZ    S222B05             NO. EXIT BUT DON'T TURN ON MOD-1 SW. 53700000
         B     S222B03             YES. EXIT NORMALLY                   53750000
S222C    CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?           53800000
         BE    S222C50             YES.  USE TERMINAL ADDR ONLY         53850000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 53900000
         BZ    S222C30             NO. ADD NEW ITEM                     53950000
S222C10  CLC   0(1,14),MDRCTRL     IS THIS CTRL UNIT IN THE TABLE ?     54000000
         BE    S222B20             YES.  BYPASS THIS ENTRY              54050000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   54100000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT         54150000
         BZ    S222C30             BRANCH IF NO MORE ITEMS TO CK        54200000
         B     S222C10                                                  54250000
S222C30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             54300000
         BE    S222B03             YES.                                 54350000
         MVC   0(1,MOD1REG),MDRCTRL     STORE IN TABLE                  54400000
         B     S228                                                     54450000
S222C50  CLC   TBCTRL,MDRCTRL      DOES CTRLUNIT ENTRY = REQSTED CU?XXH 54500000
         BNE   S222B20             NO. BYPASS PUTTING TERM IN TABLE XXH 54550000
         ZAP   WKTBLCNT,TABLECNT                                    XXH 54600000
         BZ    S222C70                                                  54650000
S222C60  CLC   0(1,14),MDRTERM     IS THIS TERMINAL IN THE TABLE ?      54700000
         BE    S222B20             YES. BYPASS THIS ENTRY               54750000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   54800000
         SP    WKTBLCNT,=PL2'1'                                         54850000
         BZ    S222C70                                                  54900000
         B     S222C60                                                  54950000
S222C70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             55000000
         BE    S222B03             YES.                                 55050000
         MVC   0(1,MOD1REG),MDRTERM    PUT REMOTE TERMINAL INTO TABLE   55100000
         B     S228                                                     55150000
S222D    CLI   OBRUCB,X'10'        IS THIS A LOCAL?                     55200000
         BE    S222G               YES. GO MOVE 3-BYTE ADDR             55250000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?  @OZ31879 55300007
         BE    S222D50             YES.  USE TERMINAL ADDR ONLY@OZ31879 55305007
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31879 55310007
         BZ    S222D30             NO. ADD NEW ITEM            @OZ31879 55315007
S222D10  CLC   0(1,14),OBRCTRL     IS THIS CTRL UNIT IN TABLE? @OZ31879 55320007
         BE    S222B20             YES.  BYPASS THIS ENTRY     @OZ31879 55325007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31879 55330007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT@OZ31879 55335007
         BZ    S222D30             BRANCH IF NO MORE ITEMS     @OZ31879 55340007
         B     S222D10                                         @OZ31879 55345007
S222D30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31879 55350007
         BE    S222B03             YES.                        @OZ31879 55355007
         MVC   0(1,MOD1REG),OBRCTRL     STORE IN TABLE         @OZ31879 55360007
         B     S228                                            @OZ31879 55365007
S222D50  CLC   TBCTRL,OBRCTRL      DOES CU ENTRY = REQSTED CU? @OZ31879 55370007
         BNE   S222B20             NO. DON'T PUT TERM IN TBL   @OZ31879 55375007
         ZAP   WKTBLCNT,TABLECNT                               @OZ31879 55380007
         BZ    S222D70                                         @OZ31879 55385007
S222D60  CLC   0(1,14),OBRTERM     IS THIS TERMINAL IN THE TBL?@OZ31879 55390007
         BE    S222B20             YES. BYPASS THIS ENTRY      @OZ31879 55395007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31879 55400007
         SP    WKTBLCNT,=PL2'1'                                @OZ31879 55405007
         BZ    S222D70                                         @OZ31879 55410007
         B     S222D60                                         @OZ31879 55415007
S222D70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31879 55420007
         BE    S222B03             YES.                        @OZ31879 55425007
         MVC   0(1,MOD1REG),OBRTERM   PUT REMOTE TERM IN TABLE @OZ31879 55430007
         B     S228                                            @OZ31879 55435007
S222G    CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY ?           55450000
         BE    S222B20             YES. BYPASS THIS ERROR DATA          55500000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31879 55550007
         BZ    S225                NO. ADD NEW ITEM TO TABLE   @OZ31879 55600007
S224     CLC   0(2,14),OBRCUA      ARG MATCH TABLE ENTRY ?     @OZ31879 55650007
         BE    S222B20             YES.  BYPASS THIS ARGUMENT  @OZ31879 55700007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT  @OZ31879 55750007
         BZ    S225                NO MORE ITEMS TO CK--SO ADD @OZ31879 55800007
*                                  THIS NEW ITEM TO TABLE               55950000
         LA    14,2(14)            BUMP TO NEXT TABLE ENTRY             56000000
         B     S224                GO CK ANOTHER ENTRY         @OZ31879 56050007
S225     CP    TABLECNT,=P'32'     MORE THAN 33 ENTRIES--USER  @OZ31879 56090007
*                                  MUST BE PAGING FROM MOD-2   @OZ31879 56130007
         BE    S222B03             PREPARE TO EXIT ROUTINE.    @OZ31879 56170007
         MVC   0(2,MOD1REG),OBRCUA ADD CTRL UNIT TO MOD-1 TABLE@OZ31879 56210007
S228     LA    MOD1REG,2(MOD1REG)  UPDATE TABLE POINTER.       @OZ31879 56250007
         AP    TABLECNT,=P'1'      ADD 1 TO COUNT OF TABLE ITEMS        56350000
         B     S222B20             GO CK ANOTHER ENTRY                  56400000
*********************************************************************** 56450000
*                                                                     * 56500000
*   THIS IS THE MOD-1 TABLE SCANNER ROUTINE                           * 56550000
*                                                                     * 56600000
*********************************************************************** 56650000
MOD1SCAN LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 56700000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 56750000
         BZ    MOD1EXIT            NO. EXIT AND LEAVE TBARG = ADDR.     56800000
MOD1LOOP CLC   0(2,MOD1REG),TBARG  ARG MATCH TABLE ENTRY ?              56850000
         BE    MOD1PASS            YES.  BYPASS THIS ARGUMENT           56900000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT           56950000
         BZ    MOD1EXIT            NO MORERE ITEMS TO CK--SO EXIT       57000000
         LA    MOD1REG,2(MOD1REG)  BUMP TO NEXT TABLE ENTRY             57050000
         B     MOD1LOOP            GO CHECK ANOTHER ENTRY               57100000
MOD1PASS MVC   TBARG,=X'0000'      CLEAR ARGUMENT = DO NOT USE          57150000
MOD1EXIT BR    LINKREG             RETURN TO CALLER                     57200000
*********************************************************************** 57250000
*                                                                     * 57300000
*        THIS IS THE LOCATE ROUTINE                                   * 57350000
*                                                                     * 57400000
*********************************************************************** 57450000
LOCATE   ST    11,SAVE11                                                57500000
         LA    11,PARMADDR         SET UP PARM REG                      57550000
         L     15,=V(BNGIREAD)    POINT TO READ MODULE                  57600000
         BALR  14,15              LINK TO BDAM READ MODULE              57650000
         L     11,SAVE11                                                57700000
         OC    STATUS,STATUS      READ OK?                              57750000
         BZ    S230               YES.                                  57800000
         CLC   STATUS,=C'FF'       WAS EMFILE OPENED?                   57850000
         BE    Z60                 NO.  WRITE 'NOT OPEN' MSG            57900000
*        UNPK  DBLWD,STATUS(2)                                          57950000
*        MVC   IOERCODE,DBLWD+5                                         58000000
*        TR    IOERCODE,HXTOEB     MOVE BDAM RETURN CODE TO I/O ERR MSG 58050000
*        UNPK  DBLWD,RELREC(4)                                          58100000
*        MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     58150000
*        TR    IOERBLK,HXTOEB                                           58200000
         B     Z90                     IF REQUESTED SLOT CAN'T          58250000
*                                        BE FOUND, SEND 'SEARCHING ERR' 58300000
*********************************************************************** 58350000
S230     L     FIOABAR,IOAREA      POINT TO DATA BLK.                   58400000
         MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                58450000
         CLC   PARM2(3),=C'ALL'    IS THIS 'ALL' BEING CONTINUED?       58500000
         BNE   S250                NO. GO SETUP FOR DATA BLOCK.         58550000
         CLC   TWASLOT,CTRLENTS    YES. SETUP FOR CNTRL BLOCK.          58600000
         BH    S290                QUIT IF GARBAGE KEYED IN.            58650000
         LA    DATAREG,CTRLSLT1                                         58700000
         SR    DATALOOP,DATALOOP   LOOP THRU CONTROL                    58750000
         IC    DATALOOP,CTRLENTS   BLOCK TILL REQUESTED SLOT NBR        58800000
         SR    1,1                 IS SATISFIED.                        58850000
         IC    1,TWASLOT                                                58900000
S235     BCT   1,S240                                                   58950000
         BR    LINKREG                                                  59000000
S240     BCTR  DATALOOP,0                                               59050000
         LA    DATAREG,SLOTLTH(DATAREG)                                 59100000
         B     S235                                                     59150000
S250     LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       59200000
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             59250000
S260     CLI   TWASLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      59300000
         BL    0(LINKREG)          GO RESUME DISPLAY BUILDING.          59350000
         SR    1,1                                                      59400000
         IC    1,TWASLOT           DECREMENT SLOT COUNT BY 1.           59450000
         BCTR  1,0                                                      59500000
         STC   1,TWASLOT                                                59550000
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   59600000
         LTR   1,1                                                      59650000
         BZ    S290                PREVENT LOOP IF GARBAGE INPUT.       59700000
         AR    DATAREG,1                                                59750000
         SR    DATALOOP,1                                               59800000
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  59850000
         BP    S260                                                     59900000
S290     MVC   ERRDATA(MSG5LTH),MSG5   IF REQUESTED SLOT CAN'T          59950000
ERRISRT  L     PCBREG,IOPCB              BE FOUND, SEND 'SEARCHING ERR' 60000000
         CALL  ASMTDLI,(ISRT,(PCBREG),ERROUT,LGERR),VL                  60050000
         B     CHECKST                                                  60100000
*********************************************************************** 60150000
Z10      CLC   PARM2(4),=C'CTRL'      IS PARM2 = CTRL ?                 60200000
         BE    Z50                    YES.                              60250000
         MVC   ERRDATA(MSG4LTH),MSG4                                    60300000
         B     ERRISRT                                                  60350000
Z20      MVC   ERRDATA(MSG1LTH),MSG1                                    60400000
         B     ERRISRT                                                  60450000
Z30      MVC   ERRDATA(MSG3LTH),MSG3                                    60500000
         B     ERRISRT                                                  60550000
Z40      MVC   ERRDATA(MSG6LTH),MSG6                                    60600000
         B     ERRISRT                                                  60650000
Z50      CLC   MSG7CTRL,=CL2' '       REMOTE CTRL UNIT PRESENT?         60700000
         BE    Z80                    NO. IT MUST BE LOCAL CTRL UNIT    60750000
         MVC   ERRDATA(MSG7LTH),MSG7                                    60800000
         B     ERRISRT                                                  60850000
Z60      MVC   ERRDATA(MSG9LTH),MSG9                                    60900000
         B     ERRISRT                                                  60950000
Z70      MVC   MSG2TERM,PARM3         MOVE SYMBOLIC NAME TO ERROR MSG   61000000
         OC    MSG2TERM,=CL8' '       CONVERT X'00' TO BLANK            61050000
         MVC   ERRDATA(MSG2LTH),MSG2                                    61100000
         B     ERRISRT                                                  61150000
Z80      MVC   MSG8CTRL,MSG7LINE      MOVE LOCAL LINE TO CTRL ADDR      61200000
         MVC   ERRDATA(MSG8LTH),MSG8  SINCE CTRL ADDR=LINE ADDR (LOCL)  61250000
         B     ERRISRT                                                  61300000
Z90      MVC   ERRDATA(MSG5LTH),MSG5                                    61350000
         B     ERRISRT                                                  61400000
Z100     MVC   ERRDATA(MSG10LTH),MSG10                         @OZ29912 61410007
         B     ERRISRT                                         @OZ29912 61420007
Z130     MVC   MSG13LN,MSG7LINE                                @OZ31886 61427007
         MVC   ERRDATA(MSG13LTH),MSG13                         @OZ31886 61434007
         B     ERRISRT                                         @OZ31886 61441007
         EJECT                                                          61450000
ERROUT   DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      61500000
ERROLL   DC    H'121'              MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   61550000
ERROZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  61600000
ERROZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  61650000
ERRDATA  DS    CL117               START OF MESSAGE DATA                61700000
MSG1     DC    CL39'BNG001A I I/O ERR READING SYS1.DEMFLOG '            61750000
         DC    CL28'    THE BDAM RETURN CODE IS'                        61800000
IOERCODE DC    CL4'0'                                                   61850000
         DC    CL7' '                                                   61900000
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS '                 61950000
IOERBLK  DC    CL3'0'                                                   62000000
         DC    C'  '                                                    62050000
MSG1LTH  EQU   *-MSG1                                                   62100000
MSG2     DC    CL39'BNG002I I UNABLE TO CONVERT SYMBOLIC '              62150000
         DC    C'TERMINAL NAME '                                        62200000
MSG2TERM DC    CL8' '                                                   62250000
MSG2LTH  EQU   *-MSG2                                                   62300000
MSG3     DC    CL39'BNG003I I NO ERRORS RECORDED '                      62350000
MSG3LTH  EQU   *-MSG3                                                   62400000
MSG4     DC    CL39'BNG004I I NO ERRORS RECORDED FOR   '                62450000
         DC    C'LINE '                                                 62500000
MSG4LN   DC    CL3' '                                                   62550000
MSG4LTH  EQU   *-MSG4                                                   62600000
MSG5     DC    CL39'BNG005I I ERROR NOT FOUND ON FILE FOR '             62650000
         DC    C'THE SELECTED ITEM '                                    62700000
MSG5LTH  EQU   *-MSG5                                                   62750000
MSG6     DC    CL39'BNG006I I INVALID FORMAT--CHECK PAGE 2 '            62800000
         DC    C'OF MENU FOR CORRECT FORMATS'                           62850000
MSG6LTH  EQU   *-MSG6                                                   62900000
MSG7     DC    CL39'BNG007I I NO ERRORS RECORDED FOR REMOTE'            62950000
         DC    C'LINE '                                                 63000000
MSG7LINE DC    CL3' '                                                   63050000
         DC    C'    CONTROL UNIT '                                     63100000
MSG7CTRL DC    CL2' '                                                   63150000
MSG7LTH  EQU   *-MSG7                                                   63200000
MSG8     DC    CL39'BNG008I I NO ERRORS RECORDED FOR    '               63250000
         DC    C'LOCAL CONTROL UNIT '                                   63300000
MSG8CTRL DC    CL3' '                                                   63350000
MSG8LTH  EQU   *-MSG8                                                   63400000
MSG9     DC    C'BNG009A I SYS1.DEMFLOG FILE NOT OPEN   '               63450000
MSG9LTH  EQU   *-MSG9                                                   63500000
MSG10    DC    CL10'BNG010I I '                                @OZ29912 63508007
MSG10NAM DC    CL8' '                                          @OZ29912 63516007
         DC    CL21' IS A VTAM TERMINAL. '                     @OZ29912 63524007
         DC    CL39'FOR INQUIRY, GIVE DEMF HARDWARE ADDRESS'   @OZ29912 63532007
MSG10LTH EQU   *-MSG10                                         @OZ29912 63540007
MSG13    DC    CL39'BNG013A I NO DATA BLOCKS AVAILABLE FOR '   @OZ31886 63541007
         DC    CL5'LINE '                                      @OZ31886 63542007
MSG13LN  DC    CL3' '                                          @OZ31886 63543007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31886 63544007
         DC    CL39'MUST ALLOCATE MORE BLOCKS THAN LINES'      @OZ31886 63545007
MSG13LTH EQU   *-MSG13                                         @OZ31886 63546007
*********************************************************************** 63550000
DTLENTRY DC    C' (? ) '                                                63600000
DTLITEM  DC    CL8' '                                                   63650000
DTLCOUNT DC    CL4'0001'                                                63700000
DTLLTH   EQU   *-DTLENTRY                                               63750000
ITEMLTH  EQU   DTLITEM-DTLENTRY                                         63800000
COUNTLTH EQU   DTLCOUNT-DTLENTRY                                        63850000
*********************************************************************** 63900000
CLRNTRY  DC    XL14'3F'             USED TO CLEAR FIELDS FOR OUTPUT     63950000
         DC    XL4'403F3F3F'                                            64000000
CLRLTH   EQU   *-CLRNTRY                                                64050000
*********************************************************************** 64100000
*   THE FUNCTION/COMPANION TABLE DETERMINES WHICH PROGRAM IS TO WRITE * 64150000
*   THE REQUESTED DISPLAY AND PROVIDES THE CORRECT SCREEN AND COLUMN  * 64200000
*   HEADERS FOR THAT DISPLAY.                                         * 64250000
*********************************************************************** 64300000
TABLE    DS    0F                  FUNCTION/COMPANION TABLE             64350000
         DC    C'ALL',X'00',C'LINE',XL8'00',AL2(0)                      64400000
         DC    CL39'    RECAP OF ALL LINES HAVING ERRORS',AL2(0)        64450000
         DC    CL39'       LINEID  ERRS        LINEID  ERRS'            64500000
SLOT2    DC    C'ALL',X'40',C'LINE',XL8'00',AL2(0)                      64550000
         DC    CL39'    RECAP OF ALL LINES HAVING ERRORS',AL2(0)        64600000
         DC    CL39'       LINEID  ERRS        LINEID  ERRS'            64650000
         DC    C'LINECTRL',XL8'00',AL2(0)                               64700000
         DC    CL39'    RECAP OF LINE',AL2(0)                           64750000
         DC    CL39'      CTRLUNIT ERRS       CTRLUNIT ERRS'            64800000
         DC    C'CTRLTERM',XL8'00',AL2(0)                               64850000
         DC    CL39'RECAP OF CTRL UNIT',AL2(0)                          64900000
         DC    CL39'       TERMID  ERRS        TERMID  ERRS'            64950000
         DC    C'3270',XL4'00',C'BNGI3270',CL82' '                      65000000
         DC    C'LOCA',XL4'00',C'BNGILOCL',CL82' '                      65050000
         DC    C'REMO',XL4'00',C'BNGIRMOT',CL82' '                      65100000
         DC    C'END'                                                   65150000
TABLELTH EQU   *-TABLE                                                  65200000
TABLENTY EQU   SLOT2-TABLE                                              65250000
HDRPG    DC    C'(?) PAGE FORWARD'                                      65300000
         DC    C'(?) PAGE BACKWRD'                                      65350000
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   65400000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           65450000
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           65500000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            65550000
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      65600000
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     65650000
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  65700000
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     65750000
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  65800000
         DC    X'00000000000000000000000000000000'     50-5F    TO      65850000
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   65900000
         DC    X'00000000000000000000000000000000'     70-7F   AND      65950000
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   66000000
         DC    X'00000000000000000000000000000000'     90-9F    TO      66050000
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   66100000
         DC    X'00000000000000000000000000000000'     B0-BF    AND     66150000
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      66200000
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   66250000
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     66300000
         DC    X'00010203040506070809000000000000'     F0-FF            66350000
*********************************************************************** 66400000
MOD1TABL DS    CL64          MAX OF 32 ENTRIES FOR MOD-1 TABLE          66450000
*                              LOCAL TERM = 2-BYTES                     66500000
*                              REMOTE CU AND TERM = 2-BYTES             66550000
TBRELREC DS    CL3           SAVE AREA FOR PAGING 'BBB'                 66600000
TBSLOT   DS    C             SAVE AREA FOR PAGING 'SS'                  66650000
TBCTRL   DS    C             SAVE AREA FOR MDR CTRL UNIT                66700000
TBLINE   DS    CL6           SAVE AREA FOR LINE ADDR OF PAGE            66750000
TBARG    DS    CL2           SAVE AREA FOR TABLE ARGUMENT               66800000
TABLECNT DS    PL2           COUNT OF ENTRIES IN TABLE                  66850000
WKTBLCNT DS    PL2           WORK AREA FOR COUNT OF TABLE ENTRIES       66900000
MOD1SW   DS    X             00 = OFF    FF = ON                        66950000
*                            IF ON, PERFORM MOD1 TABLE SCAN             67000000
*********************************************************************** 67050000
LINEID   DS    XL6                 HARDWARE LINE ADDRESS                67100000
LINENAME DS    CL8           LINE NAME SAVE AREA FOR RECAP HEADER       67150000
CTRLID   DS    X                   HARDWARE CONTROL UNIT ADDRESS        67200000
CTRLNAME DS    CL8           CTRL/CLUSTER NAME WORK AREA FOR OUTPUT     67250000
TERMNAME DS    CL8                 TERML/LOGICAL UNIT NAME WORK AREA    67300000
CLUSNAME DS    CL8           CTRL/CLUSTER NAME SAVE AREA FOR RECAP HDR. 67350000
NEWPARM  DS    C                   NEW-PARM SWITCH                      67400000
CTRPARM  DS    C                   COUNTER OF CHARS STORED IN PARM(X)   67450000
SAVETIOA DS    F                   SAVE AREA FOR ORIGINAL TIOA          67500000
TWASLOT  DS    C                   INPUT SLOT COUNT IN HEX              67550000
*                                  DISPLACEMENTS IN TIOA                67600000
SAVERCAP DS    F                   SAVEAREA FOR POINTER TO RECAP LINE   67650000
SAVEITEM DS    F                   SAVEAREA FOR POINTER TO FIRST LINE   67700000
*                                  AND CTRL DISPLAYS                    67750000
SLOTCNT  DS    C                   COUNT OF DETAIL SLOTS READ           67800000
ITEMCNT  DS    PL2                 COUNT OF OUTPUT ITEMS IN LINE        67850000
WORKCNT  DS    PL2                 ITEM WORK COUNTER                    67900000
WORK15   DS    CL15                                                     67950000
QUITSW   DS    C             USED TO STOP EDIT OF INPUT ON 3RD SBA      68000000
*                             IF 2ND SBA = L1P7                         68050000
*********************************************************************** 68100000
         EJECT                                                          68150000
FINISH   DC    AL2(FINISHE-FINISH),XL2'0',C'FUNCTION COMPLETE'          68200000
FINISHE  EQU   *                                                        68250000
* PATCH AREA AND PROGRAM CONSTANTS                                      68300000
         SPACE                                                          68350000
         DC    C'PATCH AREA S-CONS:',256S(*)                            68400000
EPSAVE   DS    F                                                        68450000
PARMADDR DS    0F                                                       68500000
IOAREA   DC    A(0)                                                     68550000
RELREC   DC    XL3'0'                                                   68600000
STATUS   DC    CL2'  '                                                  68650000
IOPCB    DC    F'0'                                                     68700000
SAVEDCB  DC    F'0'                                                     68750000
GU       DC    CL4'GU'             GET UNIQUE FUNCTION - GET MSG/RECORD 68800000
ISRT     DC    CL4'ISRT'           INSERT FUNCTION - OUTPUT TO TERMINAL 68850000
DLIOK    DC    CL2' '              DL/I STATUS SAYS OPERATION PERFORMED 68900000
DLIQC    DC    CL2'QC'             DL/I STATUS SAYS NO MORE TRANSACTION 68950000
LGALL    DC    CL8'BNGIOALL'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   69000000
LGERR    DC    CL8'BNGIOERR'       MFS MESSAGE OUTPUT DESCRIPTOR NAME   69050000
* STORAGE AND WORK AREA DEFINITIONS                                     69100000
COMMAREA DS    0D                                                       69150000
PARM1    DC    D'0'                1ST INPUT PARM - DEMF                69200000
PARM2    DC    D'0'                2ND INPUT PARM - ALL/LINE/CTRL/      69250000
*                                                    3270 AND MENU      69300000
PARM3    DC    D'0'                3RD INPUT PARM                       69350000
PARM4    DC    D'0'                4TH INPUT PARM                       69400000
PARM5    DC    D'0'                5TH INPUT PARM                       69450000
PARM6    DC    D'0'                6TH INPUT PARM                       69500000
FLDCNT   DC    P'0'                COUNT OF FLD'S IN INPUT              69550000
SVRELREC DC    CL3' '        SAVE AREA FOR LINE/CTRL RELATIVE BLOCK NO. 69600000
SAVEBBSS DS    F                   SAVE POINTER TO BLK AND SLOT         69650000
DBLWD    DC    D'0'                DOUBLEWORD WORK AREA                 69700000
DUBLWD   EQU   DBLWD                                                    69750000
FULLWD   DC    F'0'                FULLWORD WORK AREA                   69800000
TWALINE  DC    D'0'          SAVE AREA FOR  IMS SYMBOLIC LINE POINTER   69850000
* THE FOLLOWING INPUT AREA IS USED FOR DEMF                             69900000
* TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                          69950000
         SPACE                                                          70000000
MSGIN    DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      70050000
TIOATDL  DS    H                   MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   70100000
MSGZ1    DS    X                   FLAG FIELD - USED BY IMS INTERNALLY  70150000
MSGZ2    DS    X                   FLAG FIELD - NON-ZERO IF MFS EDITED  70200000
TIOADBA  DS    0F                  START OF MESSAGE DATA                70250000
MSGTXCD  DS    CL5                    DEMF                              70300000
MSGKEYED DS    CL29                   29-BYTE KEY-IN AREA               70350000
MSGCMDCD DS    CL4                    ALL /LINE/CTRL/3270/MENU          70400000
MSGPGF   DS    C                      PAGE FORWARD                      70450000
MSGID    DS    CL20                   IMS SYMBOLIC NAME FOR RQSD TERMNL 70500000
MSGPGB   DS    C                      PAGE BACKWARD                     70550000
MSGBBBSS DS    CL15                   BLOCK AND SLOT INFO               70600000
MSGNTRY  DS    CL12                START OF X'ED-IN DATA                70650000
MSGEND   DS    79CL12                                                   70700000
MSGENDC  EQU   *                                                        70750000
         ORG   MSGPGF              MAP OF BNGIMENU OPTIONS              70800000
MSGALL   DS    C                        ALL LINES SCREEN                70850000
MSG3270  DS    C                        3270 SCREEN                     70900000
MSGRMOT  DS    C                        REMOTE SENSE/STATUS INFO        70950000
MSGLOCL  DS    C                        LOCAL SENSE/STATUS INFO         71000000
MSGDPRSS DS    CL7                   DEPRESS FOR PAGE 2 OF MENU         71050000
         ORG   MSGENDC                                                  71100000
*                                                                       71150000
*   FROM HERE UP MUST REMAIN IN THAT ORDER                              71200000
*                                                                       71250000
*********************************************************************** 71300000
* THE FOLLOWING AREA IS USED AS OUTPUT AREA                             71350000
* FOR TRANSACTION MESSAGES, WITH MAPPING AS SHOWN.                      71400000
MSGOUT   DS    0D              MAP OF TRANSACTION MESSAGE SEGMENT:      71450000
MSGOLL   DC    AL2(MSGLTH)         MESSAGE LENGTH INCL. LL,Z1,Z2,DATA   71500000
MSGOZ1   DC    X'00'               FLAG FIELD - USED BY IMS INTERNALLY  71550000
MSGOZ2   DC    X'00'               FLAG FIELD - NON-ZERO IF MFS EDITED  71600000
MSGODATA DS    0F                  START OF MESSAGE DATA                71650000
MSGCMD   DS    CL4                                                      71700000
MSGPG    DS    CL32                                                     71750000
LGBBBSS  DS    CL15                                                     71800000
SMBBBSS  DS    CL15                                                     71850000
MSGRECAP DS    CL39                                                     71900000
MSGHDR1  DS    CL39                                                     71950000
MSGHDR2  DS    CL41                                                     72000000
MSGODAT1 DS    13CL18                                                   72050000
MSGODAT2 DS    66CL18                                                   72100000
MSGODAT3 DS    CL12                                                     72150000
MSGENDLG DS    CL4                                                      72200000
MSGENDSM DS    CL4                                                      72250000
MSGLTH   EQU   *-MSGOUT                                                 72300000
         LTORG                                                          72350000
         END   BNGIDISP                                                 72400000
