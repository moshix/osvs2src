         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGTDISP                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME = TCAM DEMF DISPLAY CONTROL MODULE                 * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) EDITS THE INPUT INTO 6 PARM FIELDS WITH LEFT JUSTIFY; * 00550000
*            2) DOES SYNTAX CHECK ON DEMF COMMANDS AND PARAMETERS;    * 00600000
*            3) DETERMINES WHETHER THE REQUEST IS FOR MENU,REMOTE,    * 00650000
*               LOCAL OR 3270 SCREEN ERROR DISPLAY AND PASSES CONTROL * 00700000
*               TO BNGTMENU,BNGTRMOT,BNGTLOCL OR BNGT3270 SEGMENT     * 00750000
*               ACCORDINGLY WITH PARAMETERS;                          * 00800000
*            4) HANDLES ALL,LINE AND CTRL ERROR DISPLAY REQUEST AND   * 00850000
*               WRITES ITS ERROR INFORMATION TO THE 3270 DISPLAY      * 00900000
*               TERMINAL AND ISSUES SOME OF THE DISPLAY MESSAGES;     * 00950000
*            5) ACCESSES SYS1.DEMFLOG DATA FILE FOR ALL,LINE AND CTRL * 01000000
*               ERROR DISPLAY REQUEST.                                * 01050000
*                                                                     * 01100000
* NOTES = NONE                                                        * 01150000
*                                                                     * 01200000
*    DEPENDENCIES = NONE                                              * 01250000
*                                                                     * 01300000
*    RESTRICTIONS = NONE                                              * 01350000
*                                                                     * 01400000
*    REGISTER CONVENTIONS = R10 RECEIVES ADDRESS OF I/O MESSAGE AREA  * 01450000
*                           FROM BNGTQEMF                             * 01500000
*                                                                     * 01550000
*    PATCH LABEL = NONE                                               * 01600000
*                                                                     * 01650000
* MODULE TYPE = TCAM DISPLAY CONTROL                                  * 01700000
*                                                                     * 01750000
*    PROCESSOR = ASSEMBLER H                                          * 01800000
*                                                                     * 01850000
*    MODULE SIZE = 9821 DECIMAL BYTES                                 * 01900000
*                                                                     * 01950000
*    ATTRIBUTES = SERIALLY REUSABLE                                   * 02000000
*                                                                     * 02050000
* ENTRY POINT = BNGTDISP                                              * 02100000
*                                                                     * 02150000
*    PURPOSE = SEE FUNCTION                                           * 02200000
*                                                                     * 02250000
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 02300000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 02350000
*              R15 LOADED WITH ENTRY POINT                            * 02400000
*                                                                     * 02450000
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 02500000
*         IN MESSAGE ADDRESS  = TCAMFLDS (R10)                        * 02550000
*         IN MESSAGE COUNT    = VARIABLE (MAXIMUM=117 BYTES)          * 02600000
*                                                                     * 02650000
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 02700000
*         OUT MESSAGE ADDRESS = TIOADBAO (R10)                        * 02750000
*         OUT MESSAGE COUNT   = VARIABLE (MAXIMUM=2008 BYTES)         * 02800000
*                                                                     * 02850000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 02900000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 02950000
*                                                                     * 03000000
* EXIT-ERROR  = SYNAD ROUTINE AT LABEL - F190                         * 03050000
*                                                                     * 03100000
* EXTERNAL REFERENCE = BNGTLOCL,BNGTRMOT,BNGTMENU AND BNGT3270        * 03150000
*                                                                     * 03200000
*    ROUTINES = LOCATE ROUTINE                                        * 03250000
*               MOD1SCAN ROUTINE                                      * 03300000
*               MOD1 TABLE BUILD (AT LABEL S215) ROUTINE              * 03350000
*                                                                     * 03400000
*    DATA AREAS = SEE INPUT AND OUTPUT ABOVE                          * 03450000
*                                                                     * 03500000
*    CONTROL BLOCK = DCB (AT LABEL EMFILE)                            * 03550000
*                                                                     * 03600000
* TABLES = TABLE    - FUNCTION/COMPANION TABLE                        * 03650000
*          MOD1TAB  - 3277 MODEL 1 TABLE                              * 03700000
*          HXTOEB   - HEX CHARS TO EBCDIC CHARS TABLE                 * 03750000
*          EBTOHX   - EBCDIC CHARS TO HEX CHARS TABLE                 * 03800000
*          LOTOUP   - LOWER TO UPPER CASE CHARS TABLE                 * 03850000
*                                                                     * 03900000
* MACROS = LINK, SAVE, RETURN, OPEN, READ, CHECK, CLOSE               * 03950000
*                                                                     * 04000000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 04050000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 04050107
* CHANGE 02  02/22/78  BNGHJN MACRO ADDED                             * 04050207
*A091000                                                       @OZ30479 04050307
*D097500                                                       @OZ30479 04050407
*C152500,157000-159000                                         @OZ30479 04050507
*C477500                                                       @OZ30478 04050607
*C097000                                                       @OZ30675 04050707
*A490500                                                       @OZ31880 04050807
*D411500-412500                                                @OZ31877 04050907
*C414000-414500,506500-507000,554000-555000,556500-560000      @OZ31877 04051007
*C561500-564000                                                @OZ31877 04051107
*A369500,613000,636500                                         @OZ31884 04051207
*                                                                     * 04150000
*********************************************************************** 04200000
  TITLE 'DISPLAY AUDITS INPUT AND DISPLAYS ALL LINES,LINE, CTRL'        04250000
TCAMFLDS DSECT                                                          04300000
         USING *,10                                                     04350000
TIOATDL  DC    X'0000'      TERMINAL DATA LENGTH                        04400000
TCTTETT  DS    CL1    91=REMOTE  99=LOCAL 3270                          04450000
TCTTETM  DS    CL1      F1= MODEL 1  F2=MODEL 2 3270                    04500000
TCTTEGU  DS    0H                                                       04550000
TCTTELRN DS CL3     LINE ADDRESS REL LINE #                             04600000
TCTTETA  DS    CL1      CONTROL UNIT ADDRESS                            04650000
         DS    CL1     TERMINAL ADDRESS REMOTE                          04700000
TIOADBA  DS    CL100          TERMINAL INPUT AREA                       04750000
TCTTETI  DS CL8      TCAM SYMBOLIC ADDRESS                              04800000
TIOWCC   DS    CL1        C2 CHARACTER FULL SCREEN WRTIE                04850000
TIOADBAO DS    CL2000    TERMINAL OUTPUT AREA                           04900000
DECB     DSECT                     USED IN FILE I/O ERROR ROUTINE       04950000
         DS    CL1                                                      05000000
EXCPBITS DS    CL2                 ADR OD EXCP BITS PLACED BY SUPVR     05050000
         DS    CL1                                                      05100000
SLOTS    DSECT           MAP OF ENTRIES IN CONTROL BLOCK                05150000
         USING SLOTS,DATAREG                                            05200000
SLOTLINE DS    CL6                CHANNEL ADDRESS(PORT OR LIB)          05250000
SLOTNBC  DS    CL2                NUMBER OF BLOCKS IN THIS CHAIN        05300000
SLOTHITS DS    CL2                TOTAL HITS ON THIS LINE               05350000
SLOTRFB  DS    CL3                RELATIVE ADDRESS FIRST BLOCK IN CHAIN 05400000
SLOTRLB  DS    CL3                RELATIVE ADDRESS LAST BLOCK IN CHAIN  05450000
SLOTLTH  EQU   *-SLOTS                                                  05500000
         ORG   SLOTS         MAP OF MDR AND OBR IN DETAIL BLOCKS        05550000
DATALTH  DS    C                   LTH OF THIS SLOT                     05600000
LINEIDA  DS    CL6                 LINE AND LIB ADDR                    05650000
ENTRYTYP DS    C                   ENTRY TYPE - MDR OR OBR              05700000
         DS    CL3                                                      05750000
MDRTYPE  DS    C                   TYPE HDWE - 03 EQUALS 3270           05800000
         DS    CL3                                                      05850000
DATE     DS    CL4                 DATE OF ERROR - 00YY0DDF             05900000
TIME     DS    CL4                 TIME OF ERROR - HHMMSSHH             05950000
         DS    CL8                                                      06000000
MDRCUA   DS    CL2                 MDR CHAN & UNIT ADDR                 06050000
MDRCTRL  DS    C                   MDR CTRL UNIT POLL ADDR              06100000
MDRTERM  DS    C                   MDR TERMIL POLL ADDR                 06150000
MDRSTATS DS    CL2                 REMOTE 3270 STATUS                   06200000
         DS    CL2                                                      06250000
OBRCCW   DS    CL8                 LAST CCW EXECUTED                    06300000
OBRCSW   DS    CL8                 CHANNEL STATUS WORD                  06350000
         DS    CL6                                                      06400000
OBRUCB   DS    C                                                        06450000
         DS    CL3                                                      06500000
OBRCUA   DS    CL2                 OBR CHAN & UNIT ADDR                 06550000
OBRCTRL  DS    C                                                        06600000
OBRTERM  DS    C                                                        06650000
         DS    CL12                                                     06700000
OBRSENSE DS    CL2                 OBR SENSE BYTES                      06750000
*********************************************************************** 06800000
SBA      EQU   X'11'          SET BUFFER ADDRESS                        06850000
SF       EQU   X'1D'          START FIELD                               06900000
IC       EQU   X'13'          INSERT CURSOR                             06950000
UNA      EQU   X'40'          UNPROTECTED,NORMAL INTENSITY, ALPHAMERIC  07000000
UMN      EQU   X'41'               UNPROT,NORMAL,MODIFIED               07050000
PNA      EQU   X'60'          PROTECTED, NORMAL INTENSITY, ALPHAMERIC   07100000
PHA      EQU   X'E8'              PROTECTED, HIGH INTENSITY, ALPHAMERIC 07150000
MNP      EQU   X'61'               PROT,MODIFIED,NORMAL                 07200000
PIA      EQU   X'6D'               PROTECTED,MODIFIED,INVISIBLE,ALPHA   07250000
L1P1     EQU   X'4040'        LINE 1, POSITION 1  BUFFER ADDRESS.       07300000
L1P7     EQU   X'40C6'        LINE 1, POSITION 7  BUFFER ADDRESS.       07350000
L1P36    EQU   X'40E3'        LINE 1, POSITION 36 BUFFER ADDRESS.       07400000
L2P1     EQU   X'C150'        LINE 2, POSITION 1  BUFFER ADDRESS.       07450000
L2P4     EQU   X'C1D3'                                                  07500000
L2P44    EQU   X'C17B'                                                  07550000
L3P1     EQU   X'C260'                                                  07600000
L3P4     EQU   X'C1D3'                                                  07650000
L4P1     EQU   X'C3F0'       LINE 4, POSITION 1  BUFFER ADDRESS.        07700000
L4P4     EQU   X'C17B'                                                  07750000
L6P26    EQU   X'C6E9'       LINE 6 POS 26 BUFFER ADDRESS               07800000
R0       EQU   0             USED IN FILE I/O ERROR ROUTINE             07850000
R1       EQU   1                                                        07900000
REG1     EQU   1                                                        07950000
BASE1    EQU   3             BASE REGISTER ONE = 0-4095                 08000000
BASE2    EQU   4             BASE REGISTER TWO = 4096-8191              08050000
BASE3    EQU    12           BASE REGISTER THREE 8192 - 12287           08100000
TIOABAR  EQU   5             POINTS TO TIOA                             08150000
MOD1REG  EQU   5             POINTS TO MOD-1 TABLE (MOD1TABL)           08200000
FIOABAR  EQU   6             POINTS TO FIOA                             08250000
PARMREG  EQU   6             POINTS TO PARM AREA                        08300000
OUTREG   EQU   7             POINTS TO DATA IN TIOA AREA                08350000
OUTLOOP  EQU   8             USED FOR LOOPING THRU DATA IN TIOA AREA    08400000
R8       EQU   8             USED IN FILE I/O ERROR ROUTINE             08450000
DATAREG  EQU   9             POINTS TO DATA IN FIOA AREA                08500000
DATALOOP EQU   2             USED FOR LOOPING THRU DATA IN FIOA AREA    08550000
TABLEREG EQU   11                 POINTS TO FUNCTION/COMPANION TABLE    08600000
LINKREG  EQU   11                 SUBROUTINE LINKAGE                    08650000
R11      EQU   11                                                       08700000
R13      EQU   13                                                       08750000
R14      EQU   14                                                       08800000
R15      EQU   15                                                       08850000
*********************************************************************** 08900000
BNGTDISP CSECT                                                          08950000
         SAVE  (14,12)             SAVE CALLERS REGS                    09000000
         BALR  BASE1,0             ADDRESS ABILITY                      09050000
         USING *,BASE1,BASE2,BASE3                                      09100000
BNGTDISP BNGHJN SKIPID                                         @OZ30479 09120007
         ST     R13,SAVREG      SAVE CALLERS SAVE REG                   09150000
         LA    R13,SAVAREA                                              09200000
         LA    BASE2,2048(BASE1)                                        09250000
         LA    BASE2,2048(BASE2)                                        09300000
         LA    BASE3,2048(BASE2)                                        09350000
         LA    BASE3,2048(BASE3)                                        09400000
         LA    TIOABAR,TIOADBA       LOAD ADDRESS OF INPUT AREA         09450000
         ST    TIOABAR,TCTTEDA       SAVE INPUT AREA ADDRESS            09500000
         LA    FIOABAR,FIOADBA       LOAD ADDRESS OF FILE AREA          09550000
         ST    R14,TCAFCAAA        STORE RETURN ADDRESS IN  THIS FIELD  09600000
         ST    FIOABAR,TCAFCAA                                          09650000
         LA    BASE1,EMFILE             POINT R3 TO EMFILE     @OZ30675 09700007
         B     PROGSTRT                                        @OZ30675 09709007
         DROP  BASE1                                           @OZ30675 09718007
***************************************************************@OZ30675 09727007
* NOTE: ANY CHANGE BETWEEN THIS POINT AND LABLE 'PROGSTRT'     @OZ30675 09736007
*      REQUIRES A LIKE CHANGE TO BNGTDISP DSECT IN BNGT3270,   @OZ30675 09745007
*      BNGTMENU, BNGTLOCL, AND IN BNGTRMOT.                    @OZ30675 09754007
***************************************************************@OZ30675 09763007
         USING EMFILE,BASE1                                    @OZ30675 09772007
EMFILE DCB DDNAME=EMFILE,DSORG=DA,MACRF=(RIC),OPTCD=R,                 X09800000
               RECFM=F,SYNAD=F190                                       09850000
SAVREG   DS    A                   RETURN SAVE AREA ADDRESS             09900000
SAVAREA  DS    18F                 DEMFDISP SAVE AREA                   09950000
TCAFCAAA DS    A                   TCAM RETURN ADDRESS                  10000000
TCTTEDA  DS    A                   ADDRESS OF PASSED FIELD              10050000
TCAPCPI  DC    CL8'00'        SYMBOLIC PROGRAM NAME TO LINK TO          10100000
TCAFCAA  DS    A                   FILE I/O AREA                        10150000
         DS    0H                                                       10200000
* INSERT PARM1 AND OTHER DC'S HERE                                      10250000
PARM1    DS    D                   1ST INPUT PARM - DEMF                10300000
PARM2    DS    D                   2ND INPUT PARM - ALL/LINE/CTRL/      10350000
*                                       TERM   24230000                 10400000
PARM3    DS    D                   3RD INPUT PARM                       10450000
PARM4    DS    D                   4TH INPUT PARM                       10500000
PARM5    DS    D                   5TH INPUT PARM                       10550000
PARM6    DS    D                   6TH INPUT PARM                       10600000
SBACNT   DS    PL1                 COUNT OF SBA'S IN INPUT              10650000
RELREC   DS    CL3                 BDAM RELATIVE BLOCK ADDRESS          10700000
SVRELREC DS    CL3           SAVE AREA FOR LINE/CTRL RELATIVE BLOCK NO. 10750000
DBLWD    DS    D                   DOUBLEWORD WORK AREA                 10800000
DUBLWD   EQU   DBLWD                                                    10850000
FULLWD   DS    F                   FULLWORD WORK AREA                   10900000
TWALINE  DS     F          SAVE AREA FOR TCAM SYMBOLIC LINE POINTER     10950000
*   THE TWA FROM HERE UP MUST REMAIN IN THAT ORDER TO MATCH TWALINE     11000000
*         WITH TWATCTID IN THE 3270 PROGRAM.                            11050000
LINEID   DS    XL6                 HARDWARE LINE ADDRESS                11100000
LINENAME DS    CL8           LINE NAME SAVE AREA FOR RECAP HEADER       11150000
CTRLID   DS    X                   HARDWARE CONTROL UNIT ADDRESS        11200000
CTRLNAME DS    CL8           CTRL/CLUSTER NAME WORK AREA FOR OUTPUT     11250000
TERMNAME DS    CL8                 TERML/LOGICAL UNIT NAME WORK AREA    11300000
CLUSNAME DS    CL8           CTRL/CLUSTER NAME SAVE AREA FOR RECAP HDR. 11350000
NEWPARM  DS    C                   NEW-PARM SWITCH                      11400000
CTRPARM  DS    C                   COUNTER OF CHARACTERS IN PARM(X)     11450000
SAVETIOA DS    F                   SAVE AREA FOR ORIGINAL TIOA          11500000
SAVEBBSS DS    F                   SAVE POINTER TO BLK AND SLOT         11550000
TWASLOT  DS    C                   INPUT SLOT COUNT IN HEX              11600000
*                                  DISPLACEMENTS IN TIOA                11650000
SAVERCAP DS    F                   SAVEAREA FOR POINTER TO RECAP LINE   11700000
SAVEITEM DS    F                   SAVEAREA FOR POINTER TO FIRST LINE   11750000
*                                  AND CTRL DISPLAYS                    11800000
SLOTCNT  DS    C                   COUNT OF DETAIL SLOTS READ           11850000
ITEMCNT  DS    PL2                 COUNT OF OUTPUT ITEMS IN LINE        11900000
WORKCNT  DS    PL2                 ITEM WORK COUNTER                    11950000
WORK15   DS    CL15                                                     12000000
QUITSW   DS    C             USED TO STOP EDIT OF INPUT ON 3RD SBA      12050000
*                             IF 2ND SBA = L1P7 OR L6P26  ***ALSO*** XH 12100000
*                            USED AS MOD-1 OUTPUT-FULL-SWITCH        XH 12150000
*                               00 = NOT FULL   FF = OUTPUT FULL BUT XH 12200000
*             CONTINUE SCANNINGDATABASEFOR CORRECT ERROR COUNTSXH       12250000
         DC    C'FILE I/O AREA'                                         12300000
         CNOP  0,4                                                      12350000
         USING *,FIOABAR                                                12400000
DFHFIOA  DS    0H      FILE I/O AREA ADDRESS                            12450000
FIOADBA  DC    4096X'00'             FILE INPUT AREA                    12500000
ENDDATA  DC    X'FFFFFFFF'         MARK END OF FILE RECORD              12550000
         ORG FIOADBA                                                    12600000
CTRLLAST DS    F                   LAST USED ADDR IN DATASET            12650000
CTRLTOTL DS    F                   TOTAL BLOCKS IN DATASET              12700000
CTRLBACK DS    F                   BACKWARD PTR IN CTRL BLK CHAIN       12750000
CTRLFWD  DS    F                   FORWARD PTR IN CTRL BLK CHAIN        12800000
CTRLENTS DS    C                   NBR ENTRIES IN THIS CTRL BLK         12850000
         DS    CL15                FOR FUTURE USE                       12900000
CTRLSLT1 DS    0C                  START OF CTRL SLOT NBR ONE.          12950000
         ORG   FIOADBA                                                  13000000
DATAPORT DS    CL6                 PORT & LIB ADDR                      13050000
DATATIME DS    CL4                 TIME BLOCK CREATED                   13100000
DATADATE DS    CL4                 DATE BLOCK CREATED                   13150000
DATAFWD  DS    CL3                 FORWARD CHAIN ADDR                   13200000
DATABACK DS    CL3                 BACKWAD CHAIN ADDR                   13250000
BLKLTH   DS    CL2                 NBR BYTES USED IN THIS BLOCK         13300000
         DS    CL10                                                     13350000
DATASLT1 DS    0C                  START OF 1ST DATA SLOT               13400000
         ORG   ENDDATA+8                                                13450000
PROGSTRT EQU    *                                                       13500000
         L     TIOABAR,TCTTEDA                                          13550000
         ZAP   SBACNT,=P'0'        SET SBA COUNTER TO ZERO.             13600000
         TR    TIOADBA(80),LOTOUP  TRANSLATE LOWER CASE TO UPPER CASE.  13650000
         LA    DATAREG,TIOADBA      POINT TO 1ST BYTE IN TIOA.          13700000
         LR    DATALOOP,DATAREG    SETUP DATA LOOP                      13750000
         AH    DATALOOP,TIOATDL    DATALOOP = INPUT END POINTER         13800000
         LA    PARMREG,PARM1       POINT TO PARMS.                      13850000
         XC    PARM1(48),PARM1     ZERO OUT PARM FIELDS                 13900000
         LR    R14,PARMREG                                              13950000
         MVI   QUITSW,X'00'        INIT QUITSW = 00                     14000000
         MVI   NEWPARM,C'1'        TURN ON 'NEW PARM' SWITCH.           14050000
         MVI   CTRPARM,X'00'       INIT PARM COUNTER = ZERO             14100000
A160     CLI   0(DATAREG),SBA      IS THIS BYTE AN SBA?                 14150000
         BNE   A210                NO. CHECK IT FURTHER.                14200000
         CLI   QUITSW,X'FF'            QUIT SWITCH ON?                  14250000
         BE    C10                          YES.  QUIT EDIT.            14300000
         CLC   1(2,DATAREG),=AL2(L1P7)  IS 2ND SBA = LINE 1 POSN 7      14350000
         BE    A170                NO,CONTINUE EDIT                     14400000
         CLC   1(2,DATAREG),=AL2(L6P26) IS 2ND SBA = LINE 6 POS 26      14450000
         BNE   A180                              NO. CONTINUE EDIT      14500000
A170     MVI   QUITSW,X'FF'        TURN QUIT SWITCH ON                  14550000
A180     AP    SBACNT,=P'1'        YES. ADD TO TO SBA COUNTER.          14600000
         LA    DATAREG,2(DATAREG)  BUMP TIOA POINTER BY 2.              14650000
         B     B80                                                      14700000
A210     CLI   0(DATAREG),C'A'     IS IT AN 'A' OR HIGHER?              14750000
         BL    B80                 NO. CHECK NEW PARM SWITCH.           14800000
         CLI   NEWPARM,C'1'        IS FIRST CHAR FOR PARM(X)?           14850000
         BNE   B10                 NO.                                  14900000
         MVI   NEWPARM,C'0'        YES. SET FIRST CHAR IN FOR PARM      14950000
         MVI   CTRPARM,X'00'       SET PARM CHAR CTR = 0                15000000
B10      IC    R11,CTRPARM         LOAD R11 = CTRPARM                   15050000
         LA    R11,1(R11)          ADD CTRPARM = CTRPARM + 1            15100000
         STC   R11,CTRPARM         STORE NEW CTR BACK CTRPARM           15150000
         CLI   CTRPARM,X'08'       IS CHAR COUNT IN PARM OVER 8 ?       15200000
         BH    B50                 YES.                        @OZ30479 15250007
         MVC   0(1,14),0(DATAREG)  PUT THIS BYTE IN THIS PARM           15300000
         CLI   PARM6+7,X'00'       ARE ALL PARMS USED UP?               15350000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    15400000
         LA    14,1(14)            BUMP PARM POINTER WORKREG.           15450000
B40      LA    DATAREG,1(DATAREG)  BUMP TIOA POINTER.                   15500000
         CR    DATAREG,DATALOOP    IS THERE MORE DATA IN TIOA?          15550000
         BL    A160                YES. GO PROCESS MORE DATA.           15600000
         B     C10                 NO. GOTO SYNTAX CHECKING ROUTINE     15650000
B50      CLC   PARM2(5),=X'F3F2F7F000'  IS THIS 3270 INPUT ?   @OZ30479 15700007
         BNE   B40                      NO.                    @OZ30479 15740007
         CP    SBACNT,=P'2'        IS THIS NON-XED INPUT ?     @OZ30479 15780007
         BH    B40                 NO.                         @OZ30479 15820007
         B     Z40                 SEND INVALID SYNTAX MSG.    @OZ30479 15860007
B80      CLI   NEWPARM,C'1'        IS NEW-PARM SWITCH ON?               15950000
         BE    B40                 YES. CHECK FOR MORE DATA.            16000000
         CLI   PARM6,X'00'         NO. ARE ALL PARMS USED UP?           16050000
         BNE   C10                 YES. GOTO SYNTAX CHECKING ROUTINE    16100000
         LA    PARMREG,8(PARMREG)  NO. BUMP TO NEXT NEW PARM.           16150000
         LR    14,PARMREG          POINT WORK REG TO NEXT PARM.         16200000
         MVI   NEWPARM,C'1'        TURN ON NEW-PARM SWICH.              16250000
         B     B40                 GO CHECK FOR MORE DATA.              16300000
*********************************************************************** 16350000
*                                                                     * 16400000
*        SYNTAX CHECKING ROUTINE                                      * 16450000
*                                                                     * 16500000
*********************************************************************** 16550000
C10      CLI   QUITSW,X'FF'            IS SBA QUIT SWT ON ?             16600000
         BE    C15                     YES. DATA ENTERED FROM 29 AREA   16650000
         CP    SBACNT,=P'1'            NO. IS SBACNT > 1 ?              16700000
         BH    CC10                    YES. BYPASS SYNTAX CHECK         16750000
         CLI   PARM2,X'00'             IS PARM2 BLANK ?                 16800000
         BE    D80                     YES. GOTO BNGTMENU               16850000
C15      CLC   PARM2(5),=X'D4C5D5E400' IS PARM2=MENU ?                  16900000
         BNE   C20                     NO                               16950000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  17000000
         BE    D80                     YES. GOTO BNGTMENU               17050000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  17100000
C20      CLC   PARM2(4),=X'C1D3D300'   IS PARM2 = ALL ?                 17150000
         BNE   C30                     NO                               17200000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  17250000
         BE    CC10                    YES.GO SCHEDULE APPROPRIATE PGM  17300000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  17350000
C30      CLC   PARM2(6),=X'D3D6C3C1D300'  IS PARM2 = LOCAL ?            17400000
         BNE   C40                        NO                            17450000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  17500000
         BE    CC10                    YES.GO SCHEDULE APPROPRIATE PGM  17550000
         CLC   PARM3+1(2),=C'SS'       IS LOCAL/REMOTE SCREEN ?         17600000
         BE    CC10                    YES.                             17650000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  17700000
C40      CLC   PARM2(6),=X'D9C5D4D6E3C5' IS PARM2 = REMOTE ?            17750000
         BNE   C50                     NO.                              17800000
         CLC   PARM2+7(1),=C'S'        IS REMOTE SCREEN ?               17850000
         BE    C45                     YES.                             17900000
         CLI   PARM2+6,X'00'           IS REMOTE SYNTAX ERROR ?         17950000
         BNE   Z40                     YES. GO ISSUE INVALID FORMAT MSG 18000000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  18050000
         BE    CC10                    YES.GO SCHEDULE APPROPRIATE PGM  18100000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18150000
C45      CLI   PARM3,X'00'             IS REMOTE SCREEN ?               18200000
         BNE   CC10                    YES.                             18250000
         B     Z40                     NO. GO ISSUE INVALID FORMAT MSG  18300000
C50      CLC   PARM2(5),=X'D3C9D5C500' IS PARM2 = LINE ?                18350000
         BNE   C60                     NO                               18400000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  18450000
         BNE   Z40                     NO. GO ISSUE INVALID FORMAT MSG  18500000
C55      CLI   PARM3+3,X'00'           LINE ADDR = 4 OR MORE ?          18550000
         BNE   Z40                     YES.                             18600000
         CLI   PARM3+2,X'00'           LINE ADDR = 2 OR LESS ?          18650000
         BE    Z40                     YES.                             18700000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             18750000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          18800000
C57      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         18850000
         BNL   C59                     YES. IT IS NUMERIC               18900000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          18950000
         BH    Z40                     YES. IT IS INVALID FORMAT        19000000
C59      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       19050000
         BCT   DATALOOP,C57            LOOP                             19100000
         B     CC10                    NO. GO SCHEDULE APPROPRIATE PGM  19150000
C60      CLC   PARM2(5),=X'C3E3D9D300' IS PARM2 = CTRL ?                19200000
         BNE   C70                     NO                               19250000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  19300000
         BNE   Z40                     NO.                              19350000
         CLI   PARM4,X'00'             IS PARM4 = 00 ?                  19400000
         BE    C55                     YES.                             19450000
C65      CLI   PARM4+2,X'00'           CTRL ADDR = 3 OR MORE ?          19500000
         BNE   Z40                     YES.                             19550000
         CLI   PARM4+1,X'00'           CTRL ADDR = 1 OR LESS ?          19600000
         BE    Z40                     YES.                             19650000
C66      LA    DATALOOP,2              SET FOR SCAN 2 CHARS             19700000
         LA    DATAREG,PARM4           SET DATAREG = PARM4 PTR          19750000
C67      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         19800000
         BNL   C69                     YES. IT IS NUMERIC               19850000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          19900000
         BH    Z40                     YES. IT IS INVALID FORMAT        19950000
C69      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       20000000
         BCT   DATALOOP,C67            LOOP                             20050000
         B     C55                     NO. GO CHECK LINE ADDR (PARM3)   20100000
C70      CLC   PARM2(5),=X'F3F2F7F000' IS PARM2 = 3270 ?                20150000
         BNE   Z40                     NO.                              20200000
         CLI   PARM6,X'00'             IS PARM6 = 00 ?                  20250000
         BNE   Z40                     NO.                              20300000
         CLI   PARM5,X'00'             IS PARM5 = 00 ?                  20350000
         BE    C75                     YES.                             20400000
         CLI   PARM5+2,X'00'           IS TERMINAL ADDR = 3 OR MORE ?   20450000
         BNE   Z40                     YES.                             20500000
         CLI   PARM5+1,X'00'           IS TERMINAL ADDR = 1 OR LESS ?   20550000
         BE    Z40                     YES.                             20600000
         LA    DATALOOP,2              SET FOR SCAN 2 CHARS             20650000
         LA    DATAREG,PARM5           SET DATAREG = PARM5 PTR          20700000
C72      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         20750000
         BNL   C74                     YES. IT IS NUMERIC               20800000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          20850000
         BH    Z40                     YES. IT IS INVALID FORMAT        20900000
C74      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       20950000
         BCT   DATALOOP,C72            LOOP                             21000000
         B     C65                     NO. GO CHK LINE AND CTRL         21050000
C75      CLI   PARM4,X'00'             IS PARM4 = 00 ?                  21100000
         BNE   Z40                     NO.                              21150000
         CLI   PARM3,X'00'             IS PARM3 = 00 ?                  21200000
         BE    D10                     YES. BRANCH TO BNGT3270          21250000
         CLI   PARM3+3,X'00'           IS TERM/LINE = 4 OR MORE ?       21300000
         BNE   Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   21350000
         CLI   PARM3+2,X'00'           IS TERM/LINE = 2 OR LESS ?       21400000
         BE    Z70                     YES. GO ISSUE SYMBOLIC ERR MSG   21450000
         LA    DATALOOP,3              SET FOR SCAN 3 CHARS             21500000
         LA    DATAREG,PARM3           SET DATAREG = PARM3 PTR          21550000
C77      CLI   0(DATAREG),X'F0'        IS BYTE(PARM3) >= C'0' ?         21600000
         BNL   C79                     YES. IT IS NUMERIC               21650000
         CLI   0(DATAREG),X'C6'        IS BYTE(PARM3) > C'F' ?          21700000
         BH    Z70                     YES. IT IS SYMBOLIC ERROR        21750000
C79      LA    DATAREG,1(DATAREG)      BUMP TO NEXT BYTE OF PARM3       21800000
         BCT   DATALOOP,C77            LOOP                             21850000
*        B     CC10                    NO SYMBOLIC ERROR FOUND          21900000
*********************************************************************** 21950000
*                                                                     * 22000000
*        AT THIS POINT UP TO 5 PARMS HAVE BEEN EDITED AND             * 22050000
*        ARE LEFT JUSTIFIED WITH TRAILING X'00'S                      * 22100000
*                                                                     * 22150000
*********************************************************************** 22200000
CC10     CP    SBACNT,=P'3'        CNT OF SBA LESS THAN THREE           22250000
         BL    D10                 YES,THIS IS INIT ENTRY               22300000
*********************************************************************** 22350000
*                                                                     * 22400000
*        ENTRY IS FROM A FORMATTED SCREEN. THEREFORE,                 * 22450000
*        THIS SECTION TRANSFERS CONTROL TO APPROPRIATE                * 22500000
*        COMPANION PROGRAM.                                           * 22550000
*                                                                     * 22600000
*********************************************************************** 22650000
         CLC   PARM2(4),=C'MENU'   IS THIS MENU SCREEN ?                22700000
         BE    D32                 YES. GO CHECK MENU PARAMETERS        22750000
         CLI   TIOADBA+35,C'%'     IS THIS FROM BITS PROMPTER SCR ?  XH 22800000
         BE    C190                YES. GOTO BNGT3270                XH 22850000
         CLI   PARM4,X'00'         IS PARM4 BLANK ?                     22900000
         BE    D80                 YES. USER DID NOT X ANY ENTRIES      22950000
         CLC   TIOADBA+15(2),=X'C1D3'   IS THIS A PAGE FORWARD-LG    XH 23000000
*                                            OR A PAGE BACKWARD-SM?  XH 23050000
         BNE   CC40                YES.                              XH 23100000
         CLI   TCTTETM,X'F1'       IS THIS A 3277-1?                 XH 23150000
         BE    CC60                YES. DO PAGE BACKWARD-SM.         XH 23200000
         B     CC50                NO. DO PAGE FORWARD-LG.           XH 23250000
CC40     CLC   TIOADBA+15(2),=X'C17B'   IS THIS A PAGE BACKWRD-LG?   XH 23300000
         BE    CC60                YES.                              XH 23350000
         CLC   TIOADBA+15(2),=X'406B'   IS THIS A PAGE FORWARD-SM?   XH 23400000
         BNE   C109                NO. MUST BE BLOWUP REQUEST        XH 23450000
CC50     MVC   PARM4(4),=C'PAGE'    SET UP PARMS FOR PAGING          XH 23500000
         MVC   PARM5(7),=C'FORWARD'     FORWARD.                     XH 23550000
         B     D10                  GO TO APPROPRIATE PGM.           XH 23600000
CC60     MVC   PARM4(4),=C'PAGE'    SET UP PARMS FOR PAGING          XH 23650000
         MVC   PARM5(7),=C'BACKWRD'     BACKWARD.                    XH 23700000
         B     D10                  GO TO APPROPRIATE PGM.           XH 23750000
C109     LA    TABLEREG,TABLE      POINT AT FUNCT/COMP TABLE            23800000
C110     CLC   0(4,TABLEREG),PARM2  PROGRAM NAME IN TABLE               23850000
         BE    C170                YES,PROGRAM NAME FOUND               23900000
         CLC   0(3,TABLEREG),=C'END' END OF TABLE                       23950000
         BE    D30                 YES,GO TO MENU                       24000000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY          24050000
         B     C110                GO CHECK NEXT ENTRY                  24100000
C170     OC    4(4,TABLEREG),4(TABLEREG)  IS THERE A COMPANION PROGRAM  24150000
         BZ    D10                 NO                                   24200000
         MVC   PARM2(4),4(TABLEREG)  MOVE COMPANION NAME TO PARM2       24250000
         CLC   PARM2(4),=C'TERM'     WAS IT TERL AS COMPANION?          24300000
         BNE   D10                   NO,GO SEARCH TABLE AGAIN           24350000
C190     LINK  EP=BNGT3270           YES,GO TO TERMINAL PROGRAM      XH 24400000
         L     R13,SAVREG                                               24450000
         RETURN  (14,12)             RETURN TO IEDQEMF                  24500000
*********************************************************************** 24550000
*                                                                     * 24600000
*      THIS SECTION TRANSFERS CONTROL TO THE APPROPRIATE PROGRAM.     * 24650000
*                                                                     * 24700000
*********************************************************************** 24750000
D10      LA    TABLEREG,TABLE      POINT AT FUNCT/COMPANION TABLE       24800000
D20      CLC   0(4,TABLEREG),PARM2  PROGRAM NAME IN TABLE               24850000
         BE    D25                 YES                                  24900000
         CLC   0(3,TABLEREG),=C'END'  END OF TABLE                      24950000
         BE    D30                 YES,GO TO MENU PROGRAM               25000000
         LA    TABLEREG,TABLENTY(TABLEREG)  BUMP TO NEXT ENTRY          25050000
         B     D20                 GO CHECK NEXT ENTRY OF TABLE         25100000
D25      CLI   4(TABLEREG),X'00'           IS THERE A PROG NAME TO XCTL 25150000
         BNE   E10                 NO.USE THIS PROGRAM DEMFDISP         25200000
         MVC   TCAPCPI,8(TABLEREG)      STORE NAME IN TCA.              25250000
         LINK  EPLOC=TCAPCPI                                            25300000
         L     R13,SAVREG    POINT TO TCAM SAVAREA                      25350000
         RETURN  (14,12)                                                25400000
D30      CLC   PARM2(4),=C'MENU'   IS IT FROM MENU                      25450000
         BNE   D80                 NO,BR                                25500000
D32      CLI   TCTTETM,X'F1'       IS THIS 1 3277 MOD1?                 25550000
         BE    D50                 YES,BR                               25600000
         CLC   TIOADBA+15(2),=X'4AD6'   LARGE MENU 'ALL' = L9P23        25650000
         BE     D40                YES,BR                               25700000
         CLC   TIOADBA+15(2),=X'4BE6'   LARGE MENU '3270'= L10P23       25750000
         BE    D41                 YES,BR                               25800000
         CLC   TIOADBA+15(2),=X'4CF6'   LARGE MENU 'REMOT' = L11P23     25850000
         BE    D42                 YES,BR                               25900000
         CLC   TIOADBA+15(2),=X'4FD6'   LARGE MENU 'LOCL' = L13P23      25950000
         BNE   D80                 NO,MUST BE FOR MENU                  26000000
D35      LINK  EP=BNGTLOCL          ***************                     26050000
         L     R13,SAVREG                                               26100000
         RETURN   (14,12)                                               26150000
D40      MVC   PARM2(3),=C'ALL'    SET UP TO                            26200000
         LA    TABLEREG,TABLE          DO                               26250000
         ZAP   SBACNT,=P'1'        ALL LINES                            26300000
         B     E10                                                      26350000
D41      XC    PARM2(32),PARM2     CLEAR PARMS FOR XFER                 26400000
         MVC   PARM2(4),=C'3270'   SET UP TO DO                         26450000
         ZAP   SBACNT,=P'1'        3270 DISPLAY                         26500000
         LINK  EP=BNGT3270                                              26550000
         L     R13,SAVREG                                               26600000
         RETURN   (14,12)                                               26650000
D42      LINK   EP=BNGTRMOT                                             26700000
         L     R13,SAVREG                                               26750000
         RETURN   (14,12)                                               26800000
D50      CLC   TIOADBA+15(2),=X'C17A'   SMALL MENU 'ALL' = L4P3         26850000
         BE    D40                 YES,BR                               26900000
         CLC   TIOADBA+15(2),=X'C2E2'   SMALL MENU '3270' = L5P3        26950000
         BE    D41                 YES,BR                               27000000
         CLC   TIOADBA+15(2),=X'C34A'   SMALL MENU 'RMOT' = L6P3        27050000
         BE    D42                 YES,BR                               27100000
         CLC   TIOADBA+15(2),=X'C45A'   SMALL MENU 'LOCL' = L8P3        27150000
         BE    D35                 YES,BR                               27200000
D80      LINK   EP=BNGTMENU                                             27250000
         L     R13,SAVREG                                               27300000
         RETURN  (14,12)                                                27350000
*********************************************************************** 27400000
*                                                                     * 27450000
*        AT THIS POINT IT HAS BEEN DETERMINED THAT THE REQUEST IS FOR * 27500000
*        ALL LINES, LINE, OR CTRL.THIS MODULE HANDLES THOSE DISPLAYS. * 27550000
*                                                                     * 27600000
*********************************************************************** 27650000
         EJECT                                                          27700000
*********************************************************************** 27750000
*                                                                     * 27800000
*        THIS SECTION CREATES THE COMMON HEADER FOR                   * 27850000
*        ALL LINES, ONE LINE, AND CTRL.                               * 27900000
*                                                                     * 27950000
*********************************************************************** 28000000
E10      MVC   SAVETIOA,TCTTEDA    SAVE ORIGINAL TIOA ADDRESS.          28050000
* THIS FIVE LINES OF CODE RE INITIALIZES T I/O AREA TO 40'S             28100000
         LA    0,TIOADBAO          FIELD TO BE CLEARED                  28150000
         LA    1,2000              LENGTH OF FIELD TO BE CLEARED        28200000
         L     DATAREG,=X'40000001'   LENGTH AND PADDING CHARACTER      28250000
         LA    OUTLOOP,FORTY       LOAD FILL CHARACTERS                 28300000
         MVCL  0,OUTLOOP           MOVE 2000 BLANKS TO TIOA             28350000
*  NOW FIELD SHOULD BE ALL X'40'S                                       28400000
         LA    TIOABAR,TIOADBAO    OUTPUT TIOA                          28450000
         ST    TIOABAR,TCTTEDA     POINT TO NEW TIOA                    28500000
         LA    OUTREG,TIOADBAO     POINT TO START OF OUTPUT DATA AREA   28550000
         MVC   0(HDR1LTH,OUTREG),HDR1  MOVE STANDARD FIRST LINE.        28600000
         MVC   HDR1LTH(4,OUTREG),0(TABLEREG)  MOVE NAME OF THIS         28650000
*                                       DISPLAY TO TIOA.                28700000
         OC    HDR1LTH(4,OUTREG),=CL4' '   CHANGE ALL'00' TO ALL' '     28750000
         LA    OUTREG,HDR1LTH+4(OUTREG)  UPDATE DATA POINTER.           28800000
         CLI   TCTTETM,X'F1'       IS THIS A 3277 MODEL 1?              28850000
         BE    E150                YES.                                 28900000
         MVC   0(3,OUTREG),HDR1X   MOVE SBA L2P1 FOR MOD 2.             28950000
         LA    OUTREG,3(OUTREG)                                         29000000
E150     MVC   0(HDR2LTH,OUTREG),HDR2   MOVE PAGE-FOWARD HEADER TO TIOA 29050000
         MVC   HDR2LTH(HDR3LTH,OUTREG),HDR3  MOVE PAGE-BACK HEADER      29100000
         LA    OUTREG,HDR2LTH+HDR3LTH-15(OUTREG)                        29150000
         ST    OUTREG,SAVEBBSS     SAVE POINTER TO BBBSS IN TIOA        29200000
         LA    OUTREG,15(OUTREG)                                        29250000
         ST    OUTREG,SAVERCAP     SAVE POINTER TO RECAP LINE           29300000
         MVC   0(41,OUTREG),16(TABLEREG)  MOVE RECAP HEADER TO TIOA     29350000
         LA    OUTREG,41(OUTREG)                                        29400000
         CLI   TCTTETM,C'1'        IS THIS A MODEL 1?                   29450000
         BE    F30                 YES.                                 29500000
         MVC   0(3,OUTREG),HDR3X   MOVE SBA L4P1 FOR MOD 2.             29550000
         LA    OUTREG,3(OUTREG)                                         29600000
F30      MVC   0(41,OUTREG),57(TABLEREG)   MOVE COLUMN HEADER TO TIOA.  29650000
         LA    OUTREG,41(OUTREG)                                        29700000
         ST    OUTREG,SAVEITEM     SAVE POINTER TO FIRST LINE ITEM      29750000
         CLI   TCTTETM,X'F1'       IS THIS A MODEL 1?                   29800000
         BE    F130                YES.                                 29850000
         MVC   0(41,OUTREG),57(TABLEREG)   MOVE COLUMN HEADER AGAIN     29900000
         LA    OUTREG,41(OUTREG)                                        29950000
         ST    OUTREG,SAVEITEM     SAVE POINTER TO FIRST LINE ITEM      30000000
         LA    OUTLOOP,80          SETUP FOR 80 LINE ITEMS FOR MOD 2    30050000
         B     F150                                                     30100000
F130     LA    OUTLOOP,R14         SETUP FOR 14 LINE ITEMS FOR MOD 1    30150000
*********************************************************************** 30200000
*        THIS SECTION BUILDS THE APPROPRIATE DISPLAY                    30250000
*********************************************************************** 30300000
F150     CP    SBACNT,=P'2'        IS COUNT OF SBA'S LESS THAN 3?       30350000
         BH    R10                 NO. GO TO CONTINUATION SCREEN.       30400000
F180     XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        30450000
         OPEN  (EMFILE,(INPUT))                                         30500000
         READ  ECB1,DI,EMFILE,FIOADBA,4096,0,RELREC                     30550000
         CHECK ECB1                                                     30600000
         CLOSE EMFILE                                                   30650000
         B     G120                                                     30700000
F190     LR    R8,R0               DECB ADDRESS IN REG8                 30750000
         USING DECB,R8                                                  30800000
         UNPK  DBLWD,EXCPBITS(3)   ERROR BITS IN DECB                   30850000
         DROP  R8                                                       30900000
         MVC   IOERCODE,DBLWD+3                                         30950000
         TR     IOERCODE,HXTOEB    MOVE TCAM RETURN CODE TO I/O ERR MSG 31000000
         UNPK  DBLWD,RELREC(4)                                          31050000
         MVC   IOERBLK,DBLWD+4     MOVE BLK NBR THAT WAS BEING READ     31100000
         TR    IOERBLK,HXTOEB                                           31150000
         MVC   TIOADBAO(IOERLTH),IOERMSG                                31200000
         LA    R8,IOERLTH                                               31250000
         STH   R8,TIOATDL                                               31300000
         CLOSE  EMFILE                                                  31350000
F240     L     R13,SAVREG          RETURN TO WRIITE SCREEN              31400000
         RETURN   (14,12)                                               31450000
FORTY    DC    X'40404040'                                              31500000
IOERMSG  DC    AL1(SBA),AL2(L1P1),AL1(SF,UNA),C'DEMF ',AL1(IC)          31550000
         DC    CL34' ',AL1(SF,PNA),CL39' '                              31600000
         DC    CL39'BNG001A T I/O ERR READING SYS1.DEMFLOG '            31650000
         DC    CL28'    THE BDAM RETURN CODE IS '                       31700000
IOERCODE DC    CL4'0000'                                                31750000
         DC    CL8' '                                                   31800000
         DC    CL34'THE BDAM RELATIVE BLOCK NUMBER IS '                 31850000
IOERBLK  DC    CL3'000'                                                 31900000
IOERLTH  EQU   *-IOERMSG                                                31950000
G120     L     FIOABAR,TCAFCAA     POINT TO FIOA AREA.                  32000000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    32050000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           32100000
         SR    DATALOOP,DATALOOP                                        32150000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      32200000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        32250000
         CLC   PARM2(3),=C'ALL'    DOES PARM2 = ALL?                    32300000
         BE    J10                 YES.                                 32350000
         OC    PARM3,PARM3         WAS A LINE ADDRESS ENTERED?          32400000
         BZ    Z40                 NO. WRITE 'NO LINE ENTERED'          32450000
         MVC   LINENAME,PARM3      MOVE LINE ADDRESS TO SAVE AREA       32500000
         MVC   CLUSNAME,PARM4      MOVE CONTROL UNIT NAME TO SAVE       32550000
         MVC   MSG7CTRL(2),PARM4   MOVE CTRL ADDR TO ERR MSG AREA       32600000
         OC    MSG7CTRL(2),=CL2' ' MAKE IT UPPER CASE                   32650000
         MVC   NOLINE,PARM3        MOVE LINE ADDRESS TO 'NO ERROR' MSG  32700000
         OC    NOLINE,=CL8' '                                           32750000
         MVC   MSG7LINE(3),NOLINE  MOVE LINE ADDR TO NO ERR FOR CONTROL 32800000
H40      TR    PARM3(3),EBTOHX     CHANGE F0C6F2 TO 000F02 ETC.         32850000
         PACK  DBLWD,PARM3(4)      PACK LINE ADDRESS                    32900000
         MVC   LINEID(3),DBLWD+4   MOVE GOOD PORTION TOSAVE AREA        32950000
         MVC   LINEID+3(3),=XL3'000000'                                 33000000
H80      CLC   SLOTLINE,LINEID     IS THIS CONTROL SLOT FOR OUR LINE?   33050000
         BE    L60                 YES. GO GET DETAIL BLOCK.            33100000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           33150000
         BCT   DATALOOP,H80        CHECK NEXT SLOT.                     33200000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 33250000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        33300000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        33350000
         OPEN  (EMFILE,(INPUT))                                         33400000
         READ  ECB2,DI,EMFILE,FIOADBA,4096,0,RELREC                     33450000
         CHECK ECB2                                                     33500000
         CLOSE EMFILE                                                   33550000
H180     L     FIOABAR,TCAFCAA     POINT TO FIOA                        33600000
         SR    DATALOOP,DATALOOP                                        33650000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                33700000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 33750000
         B     H80                                                      33800000
         EJECT                                                          33850000
*********************************************************************** 33900000
*        THIS SECTION FORMATS 'ALL LINE' ENTRIES                        33950000
*********************************************************************** 34000000
J10      L     R14,SAVEBBSS        LOAD SAVED ADDR OF BLK/SLOT TIOA.    34050000
         MVC   0(5,R14),=C'00001'  MOVE 00001 TO FIRST AND              34100000
         MVC   10(5,R14),0(R14)    PREVIOUS BBBSS'S                     34150000
J40      MVC   PARM1(6),SLOTLINE   SETUP LINE ADDRESS FOR               34200000
J110     UNPK  DBLWD,SLOTLINE(4)        UNPK LINE ADDR IN WORKAREA      34250000
         TR    DBLWD+4(3),HXTOEB        CONVERT TO EBCDIC               34300000
         MVC   DTLITEM,=CL8' '     CLEAR DETAIL LINE ITEM               34350000
         MVC   DTLITEM(3),DBLWD+4  PUT LINE ADDR IN DETAIL ENTRY        34400000
J150     LH    R14,SLOTHITS        PUT LINE ERRORS IN REG.              34450000
         CVD   R14,DBLWD           CONVERT TO DECIMAL                   34500000
         UNPK  DTLCOUNT,DBLWD+5(3)      PUT LINE ERROR COUNT            34550000
         OI    DTLCOUNT+3,X'F0'         IN OUTPUT                       34600000
         MVC   0(DTLLTH,OUTREG),DTLENTRY   MOVE DETAIL ENTRY TO OUTPUT  34650000
         MVC   DTLCOUNT,=C'0001'      RESTORE PROGRAM CONSTANT.         34700000
         LA    OUTREG,DTLLTH(OUTREG)    UPDATE OUTPUT POINTER           34750000
         BCT   DATALOOP,K100       MORE SLOTS IN THIS CTRL BLK?         34800000
         CLC   CTRLFWD,=F'0'       NO. MORE CTRL BLKS?                  34850000
         BE    K120                NO. PREPARE TO EXIT.                 34900000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        34950000
         OPEN  (EMFILE,(INPUT))                                         35000000
         READ  ECB3,DI,EMFILE,FIOADBA,4096,0,RELREC                     35050000
         CHECK ECB3                                                     35100000
         CLOSE EMFILE                                                   35150000
K50      L     FIOABAR,TCAFCAA     POINT TO FIOA                        35200000
         SR    DATALOOP,DATALOOP                                        35250000
         IC    DATALOOP,CTRLENTS   SET LOOP CONTROL.                    35300000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT                  35350000
         B     J40                                                      35400000
K100     LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           35450000
         BCT   OUTLOOP,J40         ROOM LEFT IN TIOA?                   35500000
K120     L     R15,SAVEBBSS        NO. POINT TO BLK/SLT AREA IN TIOA.   35550000
         UNPK  DBLWD,RELREC(4)     STORE BDAM RELATIVE                  35600000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                   35650000
         MVC   5(3,R15),DBLWD+4    (LAST BBBSS) IN OUTPUT               35700000
         SR    R14,R14                                                  35750000
         IC    R14,CTRLENTS        GET ORIGINAL COUNT OF SLOTS          35800000
         SR    R14,DATALOOP        DETERMINE LAST SLOT READ.            35850000
         STC   R14,DBLWD+6         STORE                                35900000
         UNPK  DBLWD(3),DBLWD+6(2) SLOT NUMBER                          35950000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                         36000000
         MVC   8(2,R15),DBLWD      IN OUTPUT.                           36050000
K230     LA    R14,TIOADBAO         COMPUTE LENGTH OF                   36100000
         SR    OUTREG,R14          DATA IN TIOA.                        36150000
         STH   OUTREG,TIOATDL      STORE LENGTH IN TIOA                 36200000
         L     R13,SAVREG                                               36250000
         RETURN   (14,12)            WRITE TO TCAM                      36300000
*********************************************************************** 36350000
*  THIS SECTION PREPARES THE 'LINE' OR 'CTRL' DISPLAY                   36400000
*********************************************************************** 36450000
L60      MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.          XH 36800000
         ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0          36850000
         MVC   RELREC,SLOTRFB      SAVE POINTER TO DETAIL BLK           36900000
L140     MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                36950000
         OC    RELREC,RELREC       IS THERE ANY DATA BLOCKS ?  @OZ31884 36960007
         BZ    Z130                NO, WRITE 'NO DATA BLKS MSG'@OZ31884 36970007
         OPEN  (EMFILE,(INPUT))                                         37000000
         READ  ECB4,DI,EMFILE,FIOADBA,4096,0,RELREC                     37050000
         CHECK ECB4                                                     37100000
         CLOSE EMFILE                                                   37150000
L170     L     FIOABAR,TCAFCAA     POINT TO FIOA                        37200000
         SR    DATALOOP,DATALOOP                                        37250000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                37300000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 37350000
L210     MVI   SLOTCNT,X'00'       ZERO OUT DETAIL SLOT COUNTER.        37400000
         OC    LINENAME,=CL8' '                                         37450000
         OC    CLUSNAME,=CL8' '                                         37500000
L220     L     1,SAVERCAP               POINT TO RECAP HEADER           37550000
         CLC   PARM2(4),=C'LINE'        PARM2 = LINE?                   37600000
         BE    L230                         YES.                        37650000
         CLC   PARM4,=CL8' '       IS PARM4 BLANK                       37700000
         BE    L225                YES,MUST BE LOCAL                    37750000
         OC    PARM4,PARM4         OR IS PARM4 ZERO                     37800000
         BE    L225                YES,MUST BE LOACL                    37850000
         MVC   22(3,1),CLUSNAME         MOVE CONTROL UNIT TO HEADER     37900000
         MVC   25(8,1),=C'ON LINE '                                     37950000
         MVC   33(3,R1),LINENAME        MOVE LINE ADDR. TO HEADER       38000000
         B     M10                                                      38050000
L225     MVC   11(19,R1),=C'LOCAL CONTROL UNIT '                        38100000
         MVC   30(8,R1),LINENAME   MOVE CNTRL UNIT TO HEADER            38150000
         B     M10                                                      38200000
L230     MVC   21(8,R1),LINENAME        MOVE LINE ADDR. TO HEADER       38250000
*********************************************************************** 38300000
*    THIS SECTION FORMATS A 'LINE' ITEM OR A 'CTRL' ITEM.               38350000
*********************************************************************** 38400000
M10      MVC   CTRLNAME,=D'0'      ZERO  OUT CONTROL UNIT WORK AREA.    38450000
         MVC   TERMNAME,=CL8' '    BLANK OUT TERMINAL WORK AREA.        38500000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           38550000
         MVC   TBARG,=CL2' '       CLEAR MOD-1 TABLE ARGUMENT        XH 38600000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                38650000
         BE    N10                 YES.                                 38700000
         CLI   ENTRYTYP,X'30'      IS IT AN OBR ENTRY?                  38750000
         BE    N80                 YES.                                 38800000
         CLI   ENTRYTYP,X'34'      IS IT TCAM OBR?                      38850000
         BE    N80                 YES,BR                               38900000
M100     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            38950000
         BE    N150                YES.                                 39000000
         OC    CTRLNAME,=CL8' '                                         39050000
         OC    PARM4,=CL8' '                                            39100000
         CLC   PARM4,CTRLNAME      IS PARM 4 = REMOTE CTRL UNIT NAME?   39150000
         BE    N150                YES. PROCESS ENTRY                   39200000
         CLI   PARM4,X'40'         IS PARM4 ZERO ?                      39250000
         BNE   M140                NO. MUST BE REMOTE--BYPASS CK LOCAL  39300000
         OC    LINENAME,=CL8' '                                         39350000
         CLC   LINENAME,CTRLNAME   IS LINENAME = LOCAL CTRL UNIT ?      39400000
         BE    N150                YES. PROCESS ENTRY                   39450000
M140     SR    R15,R15                                               XH 39500000
         IC    R15,SLOTCNT         ADD ONE                           XH 39550000
         AH    R15,=H'1'           TO                                XH 39600000
         STC   R15,SLOTCNT         SLOT COUNTER.                     XH 39650000
M160     SR    R14,R14                                               XH 39700000
         IC    R14,DATALTH         PUT LTH OF SLOT IN WORK REG          39750000
         AR    DATAREG,R14         POINT TO NEXT DETAIL SLOT.           39800000
         SR    DATALOOP,R14        MORE SLOTS IN THIS DETAIL BLK?       39850000
         BP    M10                 YES.                                 39900000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  39950000
         BNE   L140                YES.                                 40000000
M240     ZAP   WORKCNT,ITEMCNT                                          40050000
         BZ    Z50                                                      40100000
         B     K230                                                     40150000
N10      CLI   MOD1SW,X'00'        MOD-1 SWITCH OFF ?                XH 40200000
         BE    N30                 YES. BYPASS MOD-1 SCANNER CHECK   XH 40250000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?        XH 40300000
         BE    N20                 YES. USE REMOTE TERMINAL ADDR     XH 40350000
         MVC   TBARG(1),MDRCTRL    SET TBARG = REMOTE CTRL UNIT      XH 40400000
         B     N25                 GO CK ADDR AGAINST MOD-1 TABLE    XH 40450000
N20      MVC   TBARG(1),MDRTERM    SET TBARG = REMOTE TERMINAL       XH 40500000
N25      BAL   LINKREG,MOD1SCAN    CK IF REMOTE CU OR TERMINAL       XH 40550000
         CLC   TBARG,=X'0000'        IN MOD-1 TABLE?                 XH 40600000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 40650000
N30      UNPK  CTRLNAME(3),MDRCTRL(2)   MDR - PUT CONTROL UNIT       XH 40700000
         TR    CTRLNAME(2),HXTOEB       NAME                            40750000
         MVI   CTRLNAME+2,X'00'         IN WORK AREA.                   40800000
         UNPK  TERMNAME(3),MDRTERM(2)   PUT TERMINAL                    40850000
         TR    TERMNAME(2),HXTOEB       NAME                            40900000
         MVI   TERMNAME+2,C' '          IN WORK AREA.                   40950000
         B     M100                                                     41000000
N80      CLI   OBRUCB,X'10'        IS THIS A LOCAL                      41050000
         BE    N110                YES, GO MOVE 3 BYTE ADDRESS          41100000
N85      CLI   MOD1SW,X'00'        IS MOD-1 SWITCH OFF ?             XH 41300000
         BE    N95                 YES. BYPASS MOD-1 SCANNER CHECK   XH 41350000
         CLC   PARM2(4),=C'CTRL'      IS THIS A 'CTRL' DISPLAY?@OZ31877 41400007
         BE    N88                    YES. USE REMOTE TERM ADDR@OZ31877 41410007
         MVC   TBARG(1),OBRCTRL       PASS REMOTE CU TO MOD-1  @OZ31877 41420007
         B     N90                    GO CK ADDR AGAINST MOD-1 @OZ31877 41430007
N88      MVC   TBARG(1),OBRTERM       PASS REMOTE TERM ADDR    @OZ31877 41440007
*                                     TO MOD-1                 @OZ31877 41450007
N90      BAL   LINKREG,MOD1SCAN       CK IF REMOTE CU OR TERM  @OZ31877 41460007
         CLC   TBARG,=X'0000'        ADDR FOR REMOTE LINE ERRORS     XH 41500000
*                                    IS IN MOD-1 TABLE ?             XH 41550000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 41600000
N95      UNPK  DBLWD,OBRCTRL(2)    OBR - MOVE 1 BYTE REMOTE CU ADR   XH 41650000
         TR    DBLWD+4(3),HXTOEB                                        41700000
         MVC   CTRLNAME(2),DBLWD+5 TO WORK AREA                         41750000
         UNPK  DBLWD,OBRTERM(2)    MOVE 1-BYTE REMOTE TERML ADDR        41800000
         TR    DBLWD+4(3),HXTOEB                                        41850000
         MVC   TERMNAME(2),DBLWD+5 WORK AREA.                           41900000
         B     M100                                                     41950000
N110     CLI   MOD1SW,X'00'        IS MOD-1 SWITCH OFF ?             XH 42000000
         BE    N130                YES. BYPASS MOD-1 SCANNER CHECK   XH 42050000
         MVC   TBARG,OBRCUA        SET TBARG = LOCAL TERMINAL ADDR   XH 42100000
         BAL   LINKREG,MOD1SCAN    CK IF LOCAL TERMINAL IS IN        XH 42150000
         CLC   TBARG,=X'0000'           MOD-1 TABLE ?                XH 42200000
         BE    M140                YES. BYPASS THIS ERROR ENTRY      XH 42250000
N130     UNPK  DBLWD,LINEIDA(4)    OBR - MOVE 3-BYTE CONTROL UNIT    XH 42300000
         TR    DBLWD+4(3),HXTOEB        ADDRESS(POSSIBLY ROUNDED)       42350000
         MVC   CTRLNAME(3),DBLWD+4      TO WORK AREA.                   42400000
         UNPK  DBLWD,OBRCUA(3)          MOVE REAL 3-BYTE CONTROL        42450000
         TR    DBLWD+4(3),HXTOEB        UNIT ADDRESS                    42500000
         MVC   TERMNAME(3),DBLWD+4      WORK AREA.                      42550000
         B     M100                                                     42600000
N150     OC    CTRLNAME,=CL8' '                                         42650000
         L     R14,SAVEITEM        POINT TO FIRST ITEM IN TIOA          42700000
         ZAP   WORKCNT,ITEMCNT     ANY ITEMS IN TIOA?                   42750000
         BZ    P50         NO,ADD NEW ITEM          WAS B P90 111111    42800000
N170     CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY?            42850000
         BE    P20                 YES.                                 42900000
         CLC   TERMNAME,ITEMLTH(R14)    WORKTERMINAL = TIOA TERMINAL?   42950000
         BE    P40                 YES.                                 43000000
N230     LA    R14,DTLLTH(R14)     BUMP TO NEXT ITEM                    43050000
         SP    WORKCNT,=PL2'1'     SUBT ONE FROM ITEM COUNTER.          43100000
         BZ    P90     ANY ITEMS?  NO. ADD NEW ITEM.                    43150000
         B     N170                                                     43200000
P20      CLC   CTRLNAME,ITEMLTH(R14)    WORK CTRL = TIOA CTRL?          43250000
         BNE   N230                NO.                                  43300000
P40      PACK  FULLWD(3),COUNTLTH(4,R14) ADD                            43350000
         AP    FULLWD(3),=P'1'          ONE                             43400000
         UNPK  COUNTLTH(4,R14),FULLWD(3) TO                             43450000
         OI    COUNTLTH+3(R14),X'F0'    COUNT FIELD.                    43500000
         B     M140                GO CHECK NEXT SLOT.                  43550000
P50      CLC   PARM2(4),=C'LINE'   IS IT LINE                  11111    43600000
         BE    P170                YES,BR                      11111    43650000
         SR    R15,R15                                         11111    43700000
         IC    R15,SLOTCNT                                     11111    43750000
         AH    R15,=H'1'                                       11111    43800000
         STC   R15,SLOTTTR                                     11111    43850000
         L     R15,SAVEBBSS                                    11111    43900000
         UNPK  DBLWD(3),SLOTTTR(2)                             11111    43950000
         TR    DBLWD,HXTOEB                                    11111    44000000
         MVC   3(2,R15),DBLWD                                  11111    44050000
P90      CLI   QUITSW,X'FF'        MOD-1 OUTPUT-FULL-SW ON ?         XH 44100000
         BE    M140                YES. BYPASS PUTTING ADDR IN OUTPUTXH 44150000
         CLC   PARM2(4),=C'LINE'        IS THIS A 'LINE' DISPLAY?    XH 44200000
         BE    P170                     YES.                            44250000
         MVC   DTLITEM,TERMNAME    NO. MOVE TERMINAL                    44300000
P120     MVC   0(DTLLTH,OUTREG),DTLENTRY  TO OUTPUT                     44350000
         LA    OUTREG,DTLLTH(OUTREG)    UPDATE OUTPUT POINTER.          44400000
         AP    ITEMCNT,=P'1'       ADD 1 TO COUNT OF OUTPUT ITEMS.      44450000
         SR    R15,R15                                               XH 44500000
         IC    R15,SLOTCNT         ADD ONE                           XH 44550000
         AH    R15,=H'1'           TO                                XH 44600000
         STC   R15,SLOTCNT         SLOT COUNTER.                     XH 44650000
         L     R15,SAVEBBSS        NO. POINT TO BLK/SLT AREA IN TIOA.XH 44700000
         UNPK  DBLWD,SVRELREC(4)   STORE BDAM RELATIVE               XH 44750000
         TR    DBLWD,HXTOEB        CONTROL BLK NUMBER                XH 44800000
         MVC   5(3,R15),DBLWD+4    (LAST BBBSS) IN OUTPUT            XH 44850000
         SR    R14,R14                                               XH 44900000
         UNPK  DBLWD(3),SLOTCNT(2)      STORE SLOT NUMBER IN         XH 44950000
         TR    DBLWD,HXTOEB        (LAST BBBSS)                      XH 45000000
         MVC   8(2,R15),DBLWD      IN OUTPUT.                        XH 45050000
         CP    ITEMCNT,=P'1'       IS THIS THE FIRST ITEM IN TIOA ?  XH 45100000
         BNE   P140                NO. BYPASS UPDATING FIRST BBBSS   XH 45150000
         MVC   0(5,15),5(15)       SET FIRST BBBSS = LAST BBBSS      XH 45200000
         CLC   10(5,15),=C'BBBSS'  IS PREV BBBSS FILLED IN ?         XH 45250000
         BNE   P140                YES. BYPASS UPDATING PREV BBBSS   XH 45300000
         MVC   10(5,15),0(15)      SET PREV BBBSS = FIRST BBBSS      XH 45350000
P140     BCT   OUTLOOP,M160        MORE ROOM IN TIOA?                XH 45400000
         CLI   TCTTETM,X'F2'       IS THIS A 3270-2 ?                XH 45450000
         BE    M240                YES. PREPARE TO EXIT              XH 45500000
         MVI   QUITSW,X'FF'        TURN ON OUTPUT-FULL-SW FOR MOD-1  XH 45550000
         B     M160                CONTINUE SCANNING REST OF DATABASEXH 45600000
P170     MVC   DTLITEM,CTRLNAME    SETUP CONTROL UNIT ADDRESS           45650000
         B     P120                     FOR OUTPUT.                     45700000
         EJECT                                                          45750000
*********************************************************************** 45800000
*     THIS SECTION PREPARES FOR AN ENTRY BLOWUP OR FOR PAGING.          45850000
*********************************************************************** 45900000
R10      L     R14,SAVETIOA        RESTORE POINTER TO INPUT DATA.       45950000
         CLC   PARM4(4),=C'PAGE'   IS THIS A 'PAGE' REQUEST?            46000000
         BE    S010                YES,BR CK FOR FWD OR BACK            46050000
         OC    PARM5,PARM5         MAKE SURE A FIELD WAS X'ED   22222   46100000
         BZ    Z40                 BR,ZERO NO FIELD WAS X'ED    22222   46150000
         CLC   PARM2(4),=C'LINE'   NO. THIS MUST BE COMPANION REQUEST.  46200000
         BNE   R010                IF NOT LINE DISPLAY, GO READ RECORD. 46250000
         MVC   PARM3,PARM5         IS LINE, MOVE THE X'D FIELD TO PRM3. 46300000
         MVC   LINENAME,PARM5           MOVE LINE ADDRESS TO SAVE AREA  46350000
         XC    PARM4(16),PARM4      AS IF LINE ID HAD BEEN KEYED IN.    46400000
         B     F180                GO DO LINE DISPLAY AS IF THIS WERE   46450000
*                                  AN INITIAL 'LINE' INPUT.             46500000
R010     MVC   CLUSNAME,PARM5           MOVE CONTROL UNIT ADDR TO SAVE  46550000
         MVC   PARM4,PARM5         MOVE X'D CTRL UNIT TO PARM4 AS IF    46600000
         XC    PARM5,PARM5           IT HAD BEEN KEYED IN.              46650000
         MVC   PARM1,PARM4         PUT CTRL NAME IN PARM1 FOR TABLE     46700000
         OC    PARM1,=CL8' '                                            46750000
         TR    17(3,R14),EBTOHX    GET BLOCK NUMBER OF                  46800000
         PACK  DBLWD,17(4,R14)        REQUESTED LINE INTO HEX.          46850000
         MVC   RELREC,DBLWD+4                                           46900000
         OPEN  (EMFILE,(INPUT))                                         46950000
         READ  ECB5,DI,EMFILE,FIOADBA,4096,0,RELREC                     47000000
         CHECK ECB5                                                     47050000
         CLOSE EMFILE                                                   47100000
R170     L     FIOABAR,TCAFCAA                                          47150000
         XC    PARM3,PARM3                                              47200000
         UNPK  DBLWD,DATAPORT(4)        MOVE LINE ID                    47250000
         TR    DBLWD+4,HXTOEB           FROM PREVIOUS BLOCK             47300000
         MVC   LINENAME(3),DBLWD+4     TO PARM3 AS IF IT HAD BEEN       47350000
         MVC   PARM3(6),LINENAME        KEYED IN.                       47400000
         CLC   PARM3,PARM4         IS THIS A LOCAL CTRL UNIT?           47450000
         BNE   F180                NO,BR GO TO PROCESS REMOTE           47500000
         XC    PARM4,PARM4         YES,CLEAR REDUDANT CU ADR            47550000
         B     F180                GO DO A 'CTRL' DISPLAY AS IF ABOVE   47600000
*                                  CTRL & LINE HAD BEEN TYPED IN.       47650000
S010     DS    0H                                                       47700000
         CLC   19(2,R14),=X'C1D3'  IS THIS A PAGE FORWARD-LG   @OZ30478 47750007
*                                       OR A PAGE BACKWARD-SM? @OZ30478 47755007
         BE    S090                YES.                        @OZ30478 47760007
         CLC   19(2,R14),=X'C17B'  IS THIS A PAGE BACKWRD-LG?  @OZ30478 47765007
         BE    S090                YES.                        @OZ30478 47770007
         CLC   19(2,R14),=X'406B'  IS THIS A PAGE FORWARD-SM?  @OZ30478 47775007
         BNE   S100                NO OTHER PAGE REQUEST       @OZ30478 47780007
S090     LA    R14,4(14)             BUMP WORK REG BY 4        @OZ30478 47785007
S100     MVC   WORK15,21(R14)      CONVERT BBBSS'S TO HEX      @OZ30478 47790007
         TR    WORK15,EBTOHX                                            47800000
         CLC   PARM5(4),=C'FORW'   IS IT A 'PAGE FORWARD' REQUEST?      47850000
         BE    S110                YES.                                 47900000
         PACK  DBLWD,WORK15+10(6)                                       47950000
         MVC   RELREC,DBLWD+3      THE 'PREVIOUS' BLOCK.                48000000
         MVC   TWASLOT,DBLWD+6     AND SLOT TO RESUME AT.               48050000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                XH 48100000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                 XH 48150000
         L     R15,SAVEBBSS        POINT TO NEW OUTPUT HEADER.          48200000
         MVC   0(5,R15),31(R14)    OLD PREVIOUS NOW BECOMES NEW      XH 48250000
         MVC   10(5,R15),31(R14)   FIRST AND PREVIOUS.               XH 48300000
         B     S180                                                     48350000
S110     DS    0H                                                       48400000
         PACK  DBLWD,WORK15+5(6)                                        48450000
         MVC   RELREC,DBLWD+3      PLACE TO PAGE FORWARD FROM           48500000
         MVC   TWASLOT,DBLWD+6                                          48550000
         MVC   TBRELREC,RELREC     SAVE CURRENT 'BBB'                XH 48600000
         MVC   TBSLOT,TWASLOT      SAVE CURRENT 'SS'                 XH 48650000
         L     R15,SAVEBBSS        POINT TO NEW OUTPUT HEADER.          48700000
         MVC   0(5,R15),26(R14)    OLD LAST IS NEW FIRST AND         XH 48750000
         MVC   10(5,R15),21(R14)   OLD FIRST IS NEW PREVIOUS.        XH 48800000
S180     BAL   LINKREG,LOCATE      LOCATE PROPER BLOCK & SLOT.          48850000
         CLC   PARM2(3),=C'ALL'                                         48900000
         BE    J40                 GO RESUME WHERE LEFT OFF AT (ALL)    48950000
         B     S215                PERFORM MOD-1 TABLE BUILD         XH 49000000
S190     ZAP   ITEMCNT,=P'0'       SET CTR OF OUTPUT ITEMS = 0       XH 49050000
         MVI   QUITSW,X'00'        TURN OFF OUTPUT-FULL-SW.    @OZ31880 49070007
         SR    R15,R15                                                  49100000
         IC    R15,DBLWD+6             UPDATE SLOT COUNTER              49150000
         SH    R15,=H'1'                   FOR PAGING IN                49200000
         STC   R15,SLOTCNT             LINE OR CTRL DISPLAYS.           49250000
S200     UNPK  DBLWD,LINEIDA(4)        MOVE LINE ADDRESS                49300000
         TR    DBLWD+4(3),HXTOEB                TO                      49350000
         MVC   LINENAME(3),DBLWD+4     SAVE AREA FOR RECAP HDR.         49400000
         MVC   LINENAME+3(5),=CL5' '        CLEAR OUT GARBAGE           49450000
         XC    PARM4,PARM4                                              49500000
         CLI   ENTRYTYP,X'91'          IS THIS AN MDR ENTRY?            49550000
         BE    S210                         YES.                        49600000
         CLI   OBRUCB,X'40'            IS THIS A REMOTE OBR ?        XH 49650000
         BNE   S205                         NO.                      XH 49700000
         UNPK  CLUSNAME(3),OBRCTRL(2)       MOVE MDR DUMMY LINE ADDR XH 49750000
         TR    CLUSNAME(2),HXTOEB                TO                  XH 49800000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR. XH 49850000
         MVC   PARM4(2),CLUSNAME              MOVE  ADDR  TO PARM4   XH 49900000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)XH 49950000
S205     MVC   CLUSNAME,LINENAME       MOVE OBR CTRL ADDR. TO SAVE ARXH 50000000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)XH 50050000
S210     UNPK  CLUSNAME(3),MDRCTRL(2)       MOVE MDR CTRL ADDR.         50100000
         TR    CLUSNAME(2),HXTOEB                TO                     50150000
         MVC   CLUSNAME+2(6),=CL6' '        SAVE AREA FOR RECAP HDR.    50200000
         MVC   PARM4(2),CLUSNAME       MOVE MDR CTRL ADDR. TO PARM4     50250000
         B     L220        GO RESUME WHERE LEFT OFF AT (LINE OR CTRL)   50300000
*********************************************************************** 50350000
*                                                                     * 50400000
*   THIS IS THE MOD-1 'LINE' AND 'CTRL' TABLE BUILD ROUTINE           * 50450000
*                                                                     * 50500000
*********************************************************************** 50550000
S215     CLI   ENTRYTYP,X'91'      IS THIS AN MDR ?                     50600000
         BE    S218                YES. SAVE MDR CTRL UNIT     @OZ31877 50650007
         CLI   OBRUCB,X'40'        IS THIS A REMOTE OBR ?      @OZ31877 50660007
         BNE   S220                NO. BYPASS SAVING CTRL UNIT @OZ31877 50670007
         MVC   TBCTRL,OBRCTRL      YES. SAVE REMOTE OBR CU     @OZ31877 50680007
         B     S220                                            @OZ31877 50690007
S218     MVC   TBCTRL,MDRCTRL      SET TBCTRL = MDRCTRL        @OZ31877 50700007
S220     MVC   TBLINE,LINEIDA      SAVE CURRENT LINE ID                 50750000
         XC    RELREC,RELREC       POINT TO FIRST CONTROL BLOCK.        50800000
         BAL   LINKREG,READ        GET FIRST CONTROL BLOCK.             50850000
         L     FIOABAR,TCAFCAA     POINT TO FIOA AREA.                  50900000
         OC    CTRLENTS,CTRLENTS   ANY LINE ENTRIES?                    50950000
         BZ    Z30                 NO. WRITE 'NO LINE ERRORS'           51000000
         SR    DATALOOP,DATALOOP                                        51050000
         IC    DATALOOP,CTRLENTS   SET LOOP CTR FOR READING SLOTS.      51100000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT IN BLOCK.        51150000
S220A    CLC   TBLINE,SLOTLINE     IS THIS CONTROL SLOT FOR OUR LINE?   51200000
         BE    S222                YES. GO GET DETAIL BLOCK.            51250000
         LA    DATAREG,SLOTLTH(DATAREG)   POINT TO NEXT SLOT.           51300000
         BCT   DATALOOP,S220A      CHECK NEXT SLOT.                     51350000
         CLC   CTRLFWD,=F'0'       MORE CONTROL BLOCKS?                 51400000
         BE    Z10                 NO. GO WRITE 'NO LINE ERRORS'        51450000
         MVC   RELREC,CTRLFWD+1    POINT TO NEXT BLK TO BE READ.        51500000
         BAL   LINKREG,READ                                             51550000
         L     FIOABAR,TCAFCAA     POINT TO INPUT RECORD AREA           51600000
         SR    DATALOOP,DATALOOP                                        51650000
         IC    DATALOOP,CTRLENTS   SET SLOT LOOP CONTROL                51700000
         LA    DATAREG,CTRLSLT1    POINT TO FIRST SLOT.                 51750000
         B     S220A                                                    51800000
S222     ZAP   TABLECNT,=P'0'      SET CTR OF TABLE ITEMS = 0           51850000
         LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 51900000
         MVC   RELREC,SLOTRFB      MOVE POINTER TO DETAIL BLK           51950000
S222A    MVC   SVRELREC,RELREC     SAVE FOR COMPARE TO TABLE RELREC     52000000
         BAL   LINKREG,READ                                             52050000
         L     FIOABAR,TCAFCAA     POINT TO INPUT RECORD AREA           52100000
         SR    DATALOOP,DATALOOP                                        52150000
         LH    DATALOOP,BLKLTH     SET SLOT LOOP CONTROL                52200000
         LA    DATAREG,DATASLT1    POINT FOR FIRST SLOT                 52250000
         MVI   SLOTCNT,X'01'       SET COUNT OF DETAIL BLK SLOTS=1      52300000
         MVC   RELREC,DATAFWD      SAVE NEXT DETAIL BLK ADDR.           52350000
S222B    CLC   SVRELREC,TBRELREC   IS THIS THE RIGHT DETL BLK ?         52400000
         BNE   S222B10             NO. CONTINUE SCAN                    52450000
         CLC   SLOTCNT,TBSLOT      IS THIS THE RIGHT ENTRY ?            52500000
         BNE   S222B10             NO. CONTINUE SCAN                    52550000
S222B03  MVI   MOD1SW,X'FF'        TURN MOD-1 SWITCH ON                 52600000
S222B05  MVC   RELREC,TBRELREC     RESTORE PAGING 'BBB'                 52650000
         MVC   TWASLOT,TBSLOT      RESTORE PAGING 'SS'                  52700000
         BAL   LINKREG,LOCATE      LOCATE STARTING 'BBBSS' FOR DISP     52750000
         B     S190                RESUME PAGING SETUP                  52800000
S222B10  LA    14,MOD1TABL         POINT OT MOD-1 TABLE                 52850000
         CLI   ENTRYTYP,X'91'      IS THIS AN MDR ENTRY?                52900000
         BE    S222C               YES.                                 52950000
         CLI   ENTRYTYP,X'30'      IS IT A BTAM OBR?                    53000000
         BE    S222D               YES.                                 53050000
         CLI   ENTRYTYP,X'34'      IS IT A TCAM OBR?                    53100000
         BE    S222D               YES.                                 53150000
S222B20  SR    15,15                                                    53200000
         IC    15,SLOTCNT          ADD ONE                              53250000
         AH    15,=H'1'            TO                                   53300000
         STC   15,SLOTCNT          SLOT COUNTER.                        53350000
         SR    14,14                                                    53400000
         IC    14,DATALTH          PUT LTH OF SLOT IN WORK REG.         53450000
         AR    DATAREG,14          POINT TO NEXT DETAIL SLOT.           53500000
         SR    DATALOOP,14         MORE SLOTS IN THIS DETAIL BLK?       53550000
         BP    S222B               YES.                                 53600000
         OC    RELREC,RELREC       MORE DETAIL BLOCKS?                  53650000
         BNE   S222A               YES.                                 53700000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN MOD-1 TABLE?            53750000
         BZ    S222B05             NO. EXIT BUT DON'T TURN ON MOD-1 SW. 53800000
         B     S222B03             YES. EXIT NORMALLY                   53850000
S222C    CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?           53900000
         BE    S222C50             YES.  USE TERMINAL ADDR ONLY         53950000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 54000000
         BZ    S222C30             NO. ADD NEW ITEM                     54050000
S222C10  CLC   0(1,14),MDRCTRL     IS THIS CTRL UNIT IN THE TABLE ?     54100000
         BE    S222B20             YES.  BYPASS THIS ENTRY              54150000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   54200000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT         54250000
         BZ    S222C30             BRANCH IF NO MORE ITEMS TO CK        54300000
         B     S222C10                                                  54350000
S222C30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             54400000
         BE    S222B03             YES.                                 54450000
         MVC   0(1,MOD1REG),MDRCTRL     STORE IN TABLE                  54500000
         B     S228                                                     54550000
S222C50  CLC   TBCTRL,MDRCTRL      DOES CTRL UNIT ENTRY = REQUESTED CU? 54600000
         BNE   S222B20             NO. BYPASS PUTTING TERMINAL IN TABLE 54650000
         ZAP   WKTBLCNT,TABLECNT                                        54700000
         BZ    S222C70                                                  54750000
S222C60  CLC   0(1,14),MDRTERM     IS THIS TERMINAL IN THE TABLE ?      54800000
         BE    S222B20             YES. BYPASS THIS ENTRY               54850000
         LA    14,2(14)            BUMP TO NEXT ENTRY                   54900000
         SP    WKTBLCNT,=PL2'1'                                         54950000
         BZ    S222C70                                                  55000000
         B     S222C60                                                  55050000
S222C70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?             55100000
         BE    S222B03             YES.                                 55150000
         MVC   0(1,MOD1REG),MDRTERM    PUT REMOTE TERMINAL INTO TABLE   55200000
         B     S228                                                     55250000
S222D    CLI   OBRUCB,X'10'        IS THIS A LOCAL?                     55300000
         BE    S222G               YES. GO MOVE 3-BYTE ADDR             55350000
         CLC   PARM2(4),=C'CTRL'   IS THIS A 'CTRL' DISPLAY ?  @OZ31877 55400007
         BE    S222D50             YES.  USE TERMINAL ADDR ONLY@OZ31877 55405007
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31877 55410007
         BZ    S222D30             NO. ADD NEW ITEM            @OZ31877 55415007
S222D10  CLC   0(1,14),OBRCTRL     IS THIS CTRL UNIT IN TABLE? @OZ31877 55420007
         BE    S222B20             YES.  BYPASS THIS ENTRY     @OZ31877 55425007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31877 55430007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM COUNT@OZ31877 55435007
         BZ    S222D30             BRANCH IF NO MORE ITEMS     @OZ31877 55440007
         B     S222D10                                         @OZ31877 55445007
S222D30  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31877 55450007
         BE    S222B03             YES.                        @OZ31877 55455007
         MVC   0(1,MOD1REG),OBRCTRL     STORE IN TABLE         @OZ31877 55460007
         B     S228                                            @OZ31877 55465007
S222D50  CLC   TBCTRL,OBRCTRL      DOES CU ENTRY = REQSTED CU? @OZ31877 55470007
         BNE   S222B20             NO. DON'T PUT TERM IN TBL   @OZ31877 55475007
         ZAP   WKTBLCNT,TABLECNT                               @OZ31877 55480007
         BZ    S222D70                                         @OZ31877 55485007
S222D60  CLC   0(1,14),OBRTERM     IS THIS TERMINAL IN THE TBL?@OZ31877 55490007
         BE    S222B20             YES. BYPASS THIS ENTRY      @OZ31877 55495007
         LA    14,2(14)            BUMP TO NEXT ENTRY          @OZ31877 55500007
         SP    WKTBLCNT,=PL2'1'                                @OZ31877 55505007
         BZ    S222D70                                         @OZ31877 55510007
         B     S222D60                                         @OZ31877 55515007
S222D70  CP    TABLECNT,=P'32'     IS THIS THE 33TH ENTRY ?    @OZ31877 55520007
         BE    S222B03             YES.                        @OZ31877 55525007
         MVC   0(1,MOD1REG),OBRTERM   PUT REMOTE TERM IN TABLE @OZ31877 55530007
         B     S228                                            @OZ31877 55535007
S222G    CLC   PARM2(4),=C'LINE'   IS THIS A 'LINE' DISPLAY ?           55550000
         BE    S222B20             YES. BYPASS THIS ERROR DATA          55600000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?        @OZ31877 55650007
         BZ    S225                NO. ADD NEW ITEM TO TABLE   @OZ31877 55700007
S224     CLC   0(2,14),OBRCUA      ARG MATCH TABLE ENTRY ?     @OZ31877 55750007
         BE    S222B20             YES.  BYPASS THIS ARGUMENT  @OZ31877 55800007
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT  @OZ31877 55850007
         BZ    S225                NO MORE ITEMS TO CK--SO ADD @OZ31877 55900007
*                                  THIS NEW ITEM TO TABLE               56050000
         LA    14,2(14)            BUMP TO NEXT TABLE ENTRY             56100000
         B     S224                GO CK ANOTHER ENTRY         @OZ31877 56150007
S225     CP    TABLECNT,=P'32'     MORE THAN 33 ENTRIES--USER  @OZ31877 56190007
*                                  MUST BE PAGING FROM MOD-2   @OZ31877 56230007
         BE    S222B03             PREPARE TO EXIT ROUTINE.    @OZ31877 56270007
         MVC   0(2,MOD1REG),OBRCUA ADD CTRL UNIT TO MOD-1 TABLE@OZ31877 56310007
S228     LA    MOD1REG,2(MOD1REG)  UPDATE TABLE POINTER.       @OZ31877 56350007
         AP    TABLECNT,=P'1'      ADD 1 TO COUNT OF TABLE ITEMS        56450000
         B     S222B20             GO CK ANOTHER ENTRY                  56500000
*********************************************************************** 56550000
**                                                                      56600000
*   THIS IS A COMMON READ SUBROUTINE FOR MOD-1 CHANGE                 * 56650000
**                                                                      56700000
*********************************************************************** 56750000
READ     OPEN  (EMFILE,(INPUT))                                         56800000
         READ  ECB9,DI,EMFILE,FIOADBA,4096,0,RELREC                     56850000
         CHECK ECB9                                                     56900000
         CLOSE EMFILE                                                   56950000
         BR    LINKREG                                                  57000000
*********************************************************************** 57050000
*                                                                     * 57100000
*   THIS IS THE MOD-1 TABLE SCANNER ROUTINE                           * 57150000
*                                                                     * 57200000
*********************************************************************** 57250000
MOD1SCAN LA    MOD1REG,MOD1TABL    POINT TO MOD-1 TABLE                 57300000
         ZAP   WKTBLCNT,TABLECNT   ANY ITEMS IN TABLE ?                 57350000
         BZ    MOD1EXIT            NO. EXIT AND LEAVE TBARG = ADDR.     57400000
MOD1LOOP CLC   0(2,MOD1REG),TBARG  ARG MATCH TABLE ENTRY ?              57450000
         BE    MOD1PASS            YES.  BYPASS THIS ARGUMENT           57500000
         SP    WKTBLCNT,=PL2'1'    SUBTRACT ONE FROM ITEM CNT           57550000
         BZ    MOD1EXIT            NO MORERE ITEMS TO CK--SO EXIT       57600000
         LA    MOD1REG,2(MOD1REG)  BUMP TO NEXT TABLE ENTRY             57650000
         B     MOD1LOOP            GO CHECK ANOTHER ENTRY               57700000
MOD1PASS MVC   TBARG,=X'0000'      CLEAR ARGUMENT = DO NOT USE          57750000
MOD1EXIT BR    LINKREG             RETURN TO CALLER                     57800000
*********************************************************************** 57850000
*   THIS IS THE LOCATE ROUTINE                                          57900000
*********************************************************************** 57950000
LOCATE   OPEN  (EMFILE,(INPUT))                                         58000000
         READ  ECB6,DI,EMFILE,FIOADBA,4096,0,RELREC                     58050000
         CHECK ECB6                                                     58100000
         CLOSE EMFILE                                                   58150000
S230     L     FIOABAR,TCAFCAA     POINT TO DATA BLK.                   58200000
         MVC   SVRELREC,RELREC     SAVE FOR LAST BBBSS'S                58250000
         CLC   PARM2(3),=C'ALL'    IS THIS 'ALL' BEING CONTINUED?       58300000
         BNE   S250                NO. GO SETUP FOR DATA BLOCK.         58350000
         CLC   TWASLOT,CTRLENTS    YES. SETUP FOR CNTRL BLOCK.          58400000
         BH    S290                QUIT IF GARBAGE KEYED IN.            58450000
         LA    DATAREG,CTRLSLT1                                         58500000
         SR    DATALOOP,DATALOOP   LOOP THRU CONTROL                    58550000
         IC    DATALOOP,CTRLENTS   BLOCK TILL REQUESTED SLOT NBR        58600000
         SR    1,1                 IS SATISFIED.                        58650000
         IC    1,TWASLOT                                                58700000
S235     BCT   1,S240                                                   58750000
         BR    LINKREG                                                  58800000
S240     BCTR  DATALOOP,0                                               58850000
         LA    DATAREG,SLOTLTH(DATAREG)                                 58900000
         B     S235                                                     58950000
S250     LH    DATALOOP,BLKLTH     SETUP LOOP NBR BYTES THIS BLK.       59000000
         LA    DATAREG,DATASLT1    POINT TO FIRST DATA ITEM             59050000
S260     CLI   TWASLOT,2           IF RQSTED SLOT = 1, THIS IS IT.      59100000
         BLR    LINKREG         GO RESUME DISPLAY BUILDING TO MAIN LINE 59150000
         SR    1,1                                                      59200000
         IC    1,TWASLOT           DECREMENT SLOT COUNT BY 1.           59250000
         BCTR  1,0                                                      59300000
         STC   1,TWASLOT                                                59350000
         IC    1,0(DATAREG)        BUMP TO NEXT SLOT.                   59400000
         LTR   1,1                                                      59450000
         BZ    S290                PREVENT LOOP IF GARBAGE INPUT.       59500000
         AR    DATAREG,1                                                59550000
         SR    DATALOOP,1                                               59600000
         LTR   DATALOOP,DATALOOP   VERIFY SLOT NBR VALID FOR THIS BLK.  59650000
         BP    S260                                                     59700000
S290     MVC   TIOADBAO(MSG5LTH),MSG5   IF RQSTED SLOT CAN'T            59750000
         MVC   TIOATDL,=AL2(MSG5LTH)    BE FOUND, SEND 'INVALID INPUT'  59800000
         L     R13,SAVREG                                               59850000
         RETURN (14,12)              WRITE SCREEN TO TCAM               59900000
*********************************************************************** 59950000
Z10      CLC   PARM2(4),=C'CTRL'     IS THIS A CTRL DISPLAY?            60000000
         BE    Z50                   YES. GOTO CTRL ERROR MSG           60050000
         MVC   TIOADBAO(MSG4LTH),MSG4                                   60100000
         LA    R8,MSG4LTH            ONE ADDED FOR BOUNDRY ALIGNMENT    60150000
         B     Z80                   GO WRITE SCREEN ON TCAM            60200000
Z30      MVC   TIOADBAO(MSG3LTH),MSG3                                   60250000
         LA    R8,MSG3LTH                                               60300000
         B     Z80                   GO WRITE SCREEN ON TCAM            60350000
Z40      MVC   TIOADBAO(MSG6LTH),MSG6                                   60400000
         LA    R8,MSG6LTH                                               60450000
         B     Z80                   GO WRITE SCREEN ON TCAM            60500000
Z50      CLC   MSG7CTRL,=CL2' '                                         60550000
         BNE   Z60                                                      60600000
         MVC   MSG8CTRL,MSG7LINE     LOAD LOCAL CTRL UNIT ADDR          60650000
         MVC   TIOADBAO(MSG8LTH),MSG8                                   60700000
         LA    R8,MSG8LTH                                               60750000
         B     Z80                   GO WRITE SCREEN ON TCAM            60800000
Z60      MVC   TIOADBAO(MSG7LTH),MSG7                                   60850000
         LA    R8,MSG7LTH                                               60900000
         B     Z80                   GO WRITE SCREEN ON TCAM            60950000
Z70      MVC   MSG1TERM,PARM3        MOVE SYMBOLIC NAME TO ERROR MSG    61000000
         OC    MSG1TERM,=CL8' '      CONVERT X'00' TO BLANK             61050000
         MVC   TIOADBAO(MSG1LTH),MSG1                                   61100000
         LA    R8,MSG1LTH                                               61150000
Z80      STH   R8,TIOATDL            SET MSG LNGTH FOR TCAM MSG HANDLR  61200000
         L     R13,SAVREG            RESTORE REG                        61250000
         RETURN (14,12)              GO WRITE SCREEN ON TCAM            61300000
Z130     MVC   MSG13LN,MSG7LINE                                @OZ31884 61310007
         MVC   TIOADBAO(MSG13LTH),MSG13                        @OZ31884 61320007
         LA    R8,MSG13LTH                                     @OZ31884 61330007
         B     Z80                                             @OZ31884 61340007
*                                                                       61350000
MSG1     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    61400000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           61450000
         DC    C'BNG002I T UNABLE TO CONVERT SYMBOLIC '                 61500000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           61550000
         DC    C'TERMINAL NAME '                                        61600000
MSG1TERM DC    CL8' '                                                   61650000
MSG1LTH  EQU   *-MSG1                                                   61700000
MSG3     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    61750000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           61800000
         DC    C'BNG003I T NO ERRORS RECORDED'                          61850000
MSG3LTH  EQU   *-MSG3                                                   61900000
MSG4     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    61950000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           62000000
         DC    C'BNG004I T NO ERRORS RECORDED FOR '                     62050000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           62100000
         DC    C'LINE '                                                 62150000
NOLINE   DC    CL3' '                                                   62200000
MSG4LTH  EQU   *-MSG4                                                   62250000
MSG5     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    62300000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           62350000
         DC    C'BNG005I T ERROR NOT FOUND ON FILE FOR '                62400000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           62450000
         DC    C'THE SELECTED ITEM '                                    62500000
MSG5LTH  EQU   *-MSG5                                                   62550000
MSG6     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    62600000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           62650000
         DC    C'BNG006I T INVALID FORMAT--CHECK PAGE 2 '               62700000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           62750000
         DC    C'OF MENU FOR CORRECT FORMATS'                           62800000
MSG6LTH  EQU   *-MSG6                                                   62850000
MSG7     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    62900000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           62950000
         DC    C'BNG007I T NO ERRORS RECORDED FOR REMOTE'               63000000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           63050000
         DC    C'LINE '                                                 63100000
MSG7LINE DC    CL3' '                                                   63150000
         DC    C'    CONTROL UNIT '                                     63200000
MSG7CTRL DC    CL2' '                                                   63250000
MSG7LTH  EQU   *-MSG7                                                   63300000
MSG8     DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    63350000
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                           63400000
         DC    C'BNG008I T NO ERRORS RECORDED FOR '                     63450000
         DC    AL1(SBA),AL2(L3P1),AL1(SF,PNA)                           63500000
         DC    C'LOCAL CONTROL UNIT '                                   63550000
MSG8CTRL DC    CL3' '                                                   63600000
MSG8LTH  EQU   *-MSG8                                                   63650000
MSG13    DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF',AL1(SF,UNA,IC)    63655007
         DC    AL1(SBA),AL2(L2P1),AL1(SF,PNA)                  @OZ31884 63660007
         DC    CL39'BNG013A T NO DATA BLOCKS AVAILABLE FOR '   @OZ31884 63665007
         DC    CL5'LINE '                                      @OZ31884 63670007
MSG13LN  DC    CL3' '                                          @OZ31884 63675007
         DC    CL31':  DATA BASE IN DEGRADED MODE. '           @OZ31884 63680007
         DC    CL39' MUST ALLOCATE MORE BLOCKS THAN LINES'     @OZ31884 63685007
MSG13LTH EQU   *-MSG13                                         @OZ31884 63690007
********************************************************************    63700000
HDR3X    DC    AL1(SBA),AL2(L4P1)                                       63750000
HDR1X    DC    AL1(SBA),AL2(L2P1)                                       63800000
DTLENTRY DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'? ) '                     63850000
DTLITEM  DC    CL8' '                                                   63900000
         DC    AL1(SF,PNA)                                              63950000
DTLCOUNT DC    CL4'0001'                                                64000000
DTLLTH   EQU   *-DTLENTRY                                               64050000
ITEMLTH  EQU   DTLITEM-DTLENTRY                                         64100000
COUNTLTH EQU   DTLCOUNT-DTLENTRY                                        64150000
*********************************************************************** 64200000
*  THE FUNCTION/COMPANION TABLE DETERMINES WHICH PROGRAM IS TO WRITE    64250000
*   THE REQUESTED DISPLAY AND PROVIDES THE CORRECT SCREEN AND COLUMN    64300000
*   HEADERS FOR THAT DISPLAY.                                           64350000
*********************************************************************** 64400000
TABLE    DS    0C                  FUNCTION/COMPANION TABLE             64450000
         DC    C'ALL',X'00',C'LINE',XL8'00',AL1(SF,PNA)                 64500000
         DC    CL39'    RECAP OF ALL LINES HAVING ERRORS',AL1(SF,PNA)   64550000
         DC    CL39'       LINEID  ERRS        LINEID  ERRS'            64600000
SLOT2    DC    C'LINECTRL',XL8'00',AL1(SF,PNA)                          64650000
         DC    CL17'    RECAP OF LINE',AL1(SF,PNA),CL20' ',AL1(SF,PNA)  64700000
         DC    CL39'      CTRLUNIT ERRS       CTRLUNIT ERRS'            64750000
         DC    C'CTRLTERM',XL8'00',AL1(SF,PNA)                          64800000
         DC    CL18'RECAP OF CTRL UNIT',AL1(SF,PNA),CL19' ',AL1(SF,PNA) 64850000
         DC    CL39'       TERMID  ERRS        TERMID  ERRS'            64900000
         DC      C'3270',XL4'00',C'BNGT3270',CL82' '                    64950000
         DC    C'LOCA',XL4'00',C'BNGTLOCL',CL82' '                      65000000
         DC    C'REMO',XL4'00',C'BNGTRMOT',CL82' '                      65050000
         DC    C'END'                                                   65100000
TABLELTH EQU   *-TABLE                                                  65150000
TABLENTY EQU   SLOT2-TABLE                                              65200000
HDR1     DS    0C                                                       65250000
         DC    AL1(SBA),AL2(L1P1),AL1(SF,MNP),C'DEMF'                   65300000
         DC    AL1(SF,UNA,IC),AL1(SBA),AL2(L1P36),AL1(SF,MNP)           65350000
HDR1LTH  EQU   *-HDR1                                                   65400000
HDR2     DS    0C                                                       65450000
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        65500000
         DC    AL1(SF,PNA),C') PAGE FORWARD'                            65550000
         DC    AL1(SF,PNA)                                              65600000
         DC    CL20' '                                                  65650000
HDR2LTH  EQU   *-HDR2                                                   65700000
HDR3     DS    0C                                                       65750000
         DC    AL1(SF,PNA),C'(',AL1(SF,UNA),C'?'                        65800000
         DC    AL1(SF,PNA),C') PAGE BACKWRD'                            65850000
         DC    AL1(SF,PNA)                                              65900000
         DC    CL4' '                                                   65950000
         DC    AL1(SF,PIA)                                              66000000
         DC    CL15'BBBSSBBBSSBBBSS'     BBBSSBBBSSBBBSS BLOCK &SLOT    66050000
HDR3LTH  EQU   *-HDR3                                                   66100000
*********************************************************************** 66150000
MOD1TABL DC    CL64' '       MAX OF 32 ENTRIES FOR MOD-1 TABLE          66200000
*                              LOCAL TERM = 2-BYTES                     66250000
*                              REMOTE CU AND TERM = 2-BYTES             66300000
TBRELREC DS    CL3           SAVE AREA FOR PAGING 'BBB'                 66350000
TBSLOT   DS    C             SAVE AREA FOR PAGING 'SS'                  66400000
TBCTRL   DS    C             SAVE AREA FOR MDR CTRL UNIT                66450000
TBLINE   DS    CL6           SAVE AREA FOR LINE ADDR OF PAGE            66500000
TBARG    DS    CL2           SAVE AREA FOR TABLE ARGUMENT               66550000
TABLECNT DC    PL2'0'        COUNT OF ENTRIES IN TABLE                  66600000
WKTBLCNT DC    PL2'0'        WORK AREA FOR COUNT OF TABLE ENTRIES       66650000
MOD1SW   DC    X'00'         00 = SWT OFF    FF = SWT ON                66700000
*                            IF ON, PERFORM MOD1 TABLE SCAN             66750000
*********************************************************************** 66800000
         DS    0H                                                       66850000
HXTOEB   DC    4XL16'00',C' ',XL15'00',7XL16'00'  THIS TABLE CONVERTS   66900000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  HEX CHARS           66950000
         DC    2XL16'00'                CHARS FA-THRU-FF BACK           67000000
         DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'  A THRU F            67050000
EBTOHX   DC    X'00000000000000000000000000000000'     00-0F  THIS      67100000
         DC    X'00000000000000000000000000000000'     10-1F  TABLE     67150000
         DC    X'00000000000000000000000000000000'     20-2F  CONVERTS  67200000
         DC    X'00000000000000000000000000000000'     30-3F  INPUT     67250000
         DC    X'00000000000000000000000000000000'     40-4F  A THRU F  67300000
         DC    X'00000000000000000000000000000000'     50-5F    TO      67350000
         DC    X'00000000000000000000000000000000'     60-6F  0A - 0F   67400000
         DC    X'00000000000000000000000000000000'     70-7F   AND      67450000
         DC    X'00000000000000000000000000000000'     80-8F  F0 - F9   67500000
         DC    X'00000000000000000000000000000000'     90-9F    TO      67550000
         DC    X'00000000000000000000000000000000'     A0-AF  00 - 09   67600000
         DC    X'00000000000000000000000000000000'     B0-BF    AND     67650000
         DC    X'000A0B0C0D0E0F000000000000000000'     C0-CF     *      67700000
         DC    X'00000000000000000000000000000000'     D0-DF   BECOME   67750000
         DC    X'00000000000000000000000000000000'     E0-EF    FF.     67800000
         DC    X'00010203040506070809000000000000'     F0-FF            67850000
LOTOUP   DS    0C          LOWER CASE TO UPPER CASE TR TABLE            67900000
         DC    X'000102030405060708090A0B0C0D0E0F'                      67950000
         DC    X'101112131415161718191A1B1C1D1E1F'                      68000000
         DC    X'202122232425262728292A2B2C2D2E2F'                      68050000
         DC    X'303132333435363738393A3B3C3D3E3F'                      68100000
         DC    X'404142434445464748494A4B4C4D4E4F'                      68150000
         DC    X'505152535455565758595A5B5C5D5E5F'                      68200000
         DC    X'606162636465666768696A6B6C6D6E6F'                      68250000
         DC    X'707172737475767778797A7B7C7D7E7F'                      68300000
         DC    X'80C1C2C3C4C5C6C7C8C98A8B8C8D8E8F'                      68350000
         DC    X'90D1D2D3D4D5D6D7D8D99A9B9C9D9E9F'                      68400000
         DC    X'A0A1E2E3E4E5E6E7E8E9AAABACADAEAF'                      68450000
         DC    X'F0F1F2F3F4F5F6F7F8F9BABBBCBDBEBF'                      68500000
         DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      68550000
         DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      68600000
         DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      68650000
         DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      68700000
SLOTTTR  DC    C' '                                                     68750000
         LTORG                                                          68800000
CSECTIED DC    C'BNGTDISP END'                                          68850000
         END                                                            68900000
