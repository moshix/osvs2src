         PRINT OFF                                                      00050007
         MACRO                                                          00050407
&NAME    BNGHJN &LABEL,&HJN                                             00050807
         LCLC  &HJA,&HJB                                                00051207
&HJA     SETC  '&SYSPARM'(1,4)                                          00051607
&HJB     SETC  '&SYSPARM'(5,4)                                          00052007
         AIF   ('&LABEL' EQ '').NOBRNCH                                 00052407
         B     &LABEL .                 BR AROUND CONSTANTS             00052807
         SPACE 2                                                        00053207
.NOBRNCH ANOP                                                           00053607
         AIF   ('&NAME' EQ '').NOLABEL                                  00054007
         DC    C'&NAME' .              MODULE IDENTIFIER                00054407
.NOLABEL ANOP                                                           00054807
         DC    X'&HJA' .                DATE OF MODIFICATION            00055207
         AIF   ('&HJN' NE 'HJN').DATE                                   00055607
         DC    X'&HJB' .                HJN OF MODIFICATION             00056007
.DATE    ANOP                                                           00056407
         AIF   ('&LABEL' EQ '').NOLBL                                   00056807
         SPACE 2                                                        00057207
&LABEL   DS    0H                                                       00057607
.NOLBL   ANOP                                                           00058007
         MEND                                                           00058407
         PRINT ON                                                       00058807
*********************************************************************** 00059207
*                                                                     * 00100000
* MODULE NAME = BNGTQEMA                                              * 00150000
*                                                                     * 00200000
* DESCRIPTIVE NAME = TCAM DEMF QUEUE CONTROL MODULE                   * 00250000
*                                                                     * 00300000
* COPYRIGHT = NONE                                                    * 00350000
*                                                                     * 00400000
* STATUS = RELEASE 1, LEVEL 1                                         * 00450000
*                                                                     * 00500000
* FUNCTION = 1) DETERMINES WHETHER THE REQUEST PASSED OVER FROM MCP   * 00550000
*               IS 'DEMF' REQUEST, IF NOT, PASS CONTROL BACK TO MCP   * 00600000
*               WITH ERROR INDICATION;                                * 00650000
*            2) IF THE REQUEST IS 'DEMF', FORWARD DEMF MESSAGE QUEUE  * 00700000
*               TO MCP WHEN PASSING CONTROL BACK TO IT;               * 00750000
*            3) INITIATES SOME MESSAGE REQUESTS TO BNGTQEMF MODULE    * 00800000
*               FOR BEING DISPLAYED TO THE 3270 DISPLAY TERMINAL.     * 00850000
*                                                                     * 00900000
* NOTES = NONE                                                        * 00950000
*                                                                     * 01000000
*    DEPENDENCIES = NONE                                              * 01050000
*                                                                     * 01100000
*    RESTRICTIONS = NONE                                              * 01150000
*                                                                     * 01200000
*    REGISTER CONVENTIONS = SEE REGISTERS EQU'S BELOW                 * 01250000
*                                                                     * 01300000
*    PATCH LABEL = PATCH                                       @OY20942 01350007
*                                                                     * 01400000
* MODULE TYPE =  TCAM DISPLAY                                         * 01450000
*                                                                     * 01500000
*    PROCESSOR = ASSEMBLER H                                          * 01550000
*                                                                     * 01600000
*    MODULE SIZE =  972 DECIMAL BYTES                                 * 01650000
*                                                                     * 01700000
*    ATTRIBUTES =                                                     * 01750000
*                                                                     * 01800000
* ENTRY POINT = BNGTQEMA                                              * 01850000
*                                                                     * 01900000
*    PURPOSE = SEE FUNCTION                                           * 01950000
*                                                                     * 02000000
*    LINKAGE = R1  LOADED WITH THE PARAM LIST POINTER                 * 02050000
*              R14 LOADED WITH THE RETURN ADDR (USED BY SUBROUTINE)   * 02100000
*              R15 LOADED WITH ENTRY POINT                            * 02150000
*                                                                     * 02200000
* INPUT = PARAM LIST ITEMS USED ARE :                                 * 02250000
*                                                                     * 02300000
* OUTPUT = PARAM LIST ITEMS USED ARE :                                * 02350000
*                                                                     * 02400000
* EXIT-NORMAL = REGISTER 15 RETURN CODE RETURNED TO CALLER :          * 02450000
*               00 - OPERATION PERFORMED AS REQUESTED                 * 02500000
*                                                                     * 02550000
* EXIT-ERROR  = NONE                                                  * 02600000
*                                                                     * 02650000
* EXTERNAL REFERENCE = NONE                                           * 02700000
*                                                                     * 02750000
*    ROUTINES =                                                       * 02800000
*                                                                     * 02850000
*    DATA AREAS =                                                     * 02900000
*                                                                     * 02950000
*    CONTROL BLOCK = DCB                                              * 03000000
*                                                                     * 03050000
* TABLES = NONE                                                       * 03100000
*                                                                     * 03150000
* MACROS = RETURN                                                     * 03200000
*                                                                     * 03250000
* CHANGE ACTIVITIES AS FOLLOWS:                                       * 03300000
* CHANGE 01  11/15/77  PROLOGUE ADDED                                 * 03300107
* CHANGE 02  02/22/78  BNGHJN MACRO ADDED                             * 03300207
*C061000-062500,197000                                         @OZ29913 03300307
*A226500                                                       @OZ29913 03300407
*D198500                                                       @OZ29913 03300507
*C081000-085000,172500                                         @OZ29899 03300607
*C173500-174000                                                @OZ29898 03300707
*C013500                                                       @OY20942 03300807
*A088000,226820                                                @OY20942 03300907
*                                                                     * 03400000
*********************************************************************** 03450000
BNGTQEMA CSECT                                                          03500000
**********************************************************************  03550000
* THIS MODULE IS LINKED WITH THE USER MCP BY ISSUING THE MACRO          03600000
* DEMF IN A MESSAGE HANDLER.  IT IS PASSED A PARM FIELD IN THE          03650000
* DEMF MACRO,WHICH IT USES TO PASS TO THE DEMF DISPLAY PROGRAMS         03700000
* THE LINE ADDRESS THE MODEL TYPE AND WHETHER THE TERMINAL IS A         03750000
* LOCAL OR REMOTE DEVICE.                                               03800000
*  INPUT   REGISTER ONE ADDRESS OF PARM FIELD IN MCP                    03850000
*          ADDRESS OF BUFFER AT AVTADBUF IN AVT                         03900000
*  OUTPUT  HARDWARE ADDRESS, MODEL AND TYPE IN PARM FIELD IF DEMF       03950000
*  RETURN CODES                                                         04000000
*     NOT A DEMF REQUEST   RC8 BR TO NSI                                04050000
*     DEMF REQUEST         RC0 BR TO NSI +4                             04100000
**********************************************************************  04150000
R0       EQU   0                                                        04200000
R1       EQU   1                                                        04250000
R2       EQU   2                                                        04300000
RWK      EQU   2                                                        04350000
RSCB     EQU   3                   TCAM SCB REG                         04400000
RLCB     EQU   4                   TCAM LCB REG                         04450000
RWK2     EQU   5                                                        04500000
RBFR     EQU   6                   TCAM BUFFER REG                      04550000
R7       EQU   7                                                        04600000
R8       EQU   8                   EMF PARM REG                         04650000
RAVT     EQU   9                   TCAM AVT REG                         04700000
R10      EQU   10                                                       04750000
R11      EQU   11                                                       04800000
RBASE    EQU   12                  BASE REGISTER                        04850000
R13      EQU   13                                                       04900000
R14      EQU   14                                                       04950000
R15      EQU   15                                                       05000000
M3270    EQU   X'04'                                                    05050000
EMF327L  EQU   X'02'                                                    05100000
ENTKY    EQU   X'7D'                                                    05150000
SBA      EQU   X'11'                                                    05200000
RC8      EQU   8                   RETURN CODE WHEN DENO DEMF           05250000
R3270    EQU   X'91'                                                    05300000
L3270    EQU   X'99'                                                    05350000
MODONE   EQU   X'F1'                                                    05400000
UCBMONE  EQU   X'11'                                                    05450000
CVTOFF   EQU   16                                                       05500000
SOH      EQU   X'02'                                                    05550000
FOX0     EQU   240                                                      05600000
FOXONE   EQU   241                                                      05650000
FOXFOX   EQU   255                                                      05700000
MODTWO   EQU   242                                                      05750000
TERMSK   EQU   224                 MASK FOR TERMINAL IN TRM ENTRY       05800000
TRMLGB   EQU   128                 MASK FOR LGB INSTEAD OF TRM          05850000
TRMVTAM  EQU   16                  MASK FOR VTAM OR NCP TERMINAL ENTRY  05900000
         EJECT                                                          05950000
****  FOLLOWING IS INITILAZATION CODE FOR PROGRAM                       06000000
         USING BNGTQEMA,R15                                             06050000
BNGTQEMA BNGHJN GO                                             @OZ29913 06100007
         STM   R14,RBASE,12(R13)       SAVE CALLERS REGISTERS           06300000
         L     RAVT,CVTOFF             LOAD CVT ADDRESS                 06350000
         L     RAVT,AVTCVTPT(,RAVT)    LOAD TCX ADDRESS                 06400000
         L     RAVT,AVTZERO(,RAVT)     LOAD AVT ADDRESS                 06450000
         USING IEDQAVTD,RAVT                                            06500000
         LR    RBASE,R13              LOAD CALLERS ADDRESS              06550000
         LA    R13,72(R13)            LOAD MY SAVE ADDRESS              06600000
         ST    RBASE,4(R13)           CONTENTS OF RAVT STORED           06650000
         ST    R13,8(RBASE)           STORE SAVE ADDRESS                06700000
         L     RBFR,AVTADBUF          INIT BUFFER REG                   06750000
         USING IEDQPRF,RBFR                                             06800000
         L     RLCB,PRFLCB-1          INIT LCB REG                      06850000
         USING IEDQLCB,RLCB                                             06900000
         L     RSCB,LCBSCBA-1         SET UP SCB REG                    06950000
         USING IEDQSCB,RSCB                                             07000000
         LR    RBASE,R15              SWITCH BASE REGS                  07050000
         USING BNGTQEMA,RBASE                                           07100000
         DROP  R15                                                      07150000
         LR    R8,R1                  LOAD PARM REG                     07200000
         USING EMF,R8                                                   07250000
         EJECT                                                          07300000
****  FOLLOWING DETERMINES IF THIS IS A DEMF REQUEST AND IF SO, IS      07350000
****  IT FROM A 3270 TERMINAL.                                          07400000
         XC    0(10,R8),0(R8)         CLEAR PARM AREA                   07450000
         TM    PRFSTAT1,PRFTSMSG+PRFNHDRN   TSO OR TXT BFR?             07500000
         BNZ   NODEMF                 RETURN IF EITHER                  07550000
         TM    SCBSTATE,SCBLCK1N       IS TERMINAL LOCKED ?             07600000
         BO    NODEMF                  RETURN IF IT IS                  07650000
         LH    R1,PRFSRCE              GET SOURCE INDEX                 07700000
         N     R1,AVTCLRHI           IS IT ZERO                         07750000
         BZ    NODEMF                  RETURN IF SO                     07800000
         L     R15,AVTRNMPT            LOAD TNT LOOK-UP ADDRESS         07850000
         BALR  R14,R15                 DO TNT LOOK-UP                   07900000
         SR    R15,R15                 ZERO WORK REG                    07950000
         IC    R15,16(R1)              GET CH TABLE INDES               08000000
         BCTR  R15,0                   SUBTRACT ONE                     08050000
         SR    RWK2,RWK2               CLEAR REG               @OZ29899 08100007
         LA    RWK2,4                  LOAD REG WITH A FOUR (4)@OZ29899 08140007
         SR    RAVT,RWK2               BACK AVT UP FOUR (4)    @OZ29899 08180007
         CLI   2(RAVT),X'C1'           IS IT C'A' = TCAM10 ?   @OZ29899 08220007
         BE    TCAM10                  YES, BRANCH             @OZ29899 08260007
         SLL   R15,2                   NO, TCAM9, MULT BY FOUR @OZ29899 08300007
         B     CONT                                            @OZ29899 08340007
TCAM10   MH    R15,=H'6'               TCAM10, MULT BY SIX     @OZ29899 08380007
CONT     AR    RAVT,RWK2               RESTORE RAVT BACK       @OZ29899 08420007
         A     R15,AVTCSTCS            ADD TO START OF TABLE            08550000
         TM    1(R15),M3270            IS IT A 3270 ?                   08600000
         BZ    NODEMF                  NO, RETURN                       08650000
         TM    11(R1),TRMVTAM      IS THIS A NCP TERMINAL?              08700000
         BO    NODEMF              YES,DO NOT HONOR REQUEST             08750000
         LA    RWK,14                  LOAD MAX DISL TO SCAN            08800000
         SR    RWK2,RWK2                CLEAR REG FOR WORK     @OY20942 08805007
         LH    RWK2,PRFSIZE             GET LENGTH OF BUFFER   @OY20942 08810007
         CH    RWK2,MAXSIZE             MORE DATA THAN WE NEED @OY20942 08815007
         BH    DEFLEN                   YES, TAKE DEFAULT      @OY20942 08820007
         SH    RWK2,X1E                 REDUCE BY BUFFER HDR   @OY20942 08825007
         BNP   DEFLEN                     LENGTH FOR DATA LEN  @OY20942 08830007
         LR    RWK,RWK2                 SET UP SCAN REG        @OY20942 08835007
DEFLEN   EQU   *                                               @OY20942 08840007
         SR    RWK2,RWK2               CLEAR WORK REG                   08850000
         IC    RWK2,LCBISZE            GET IDLES                        08900000
         AR    RWK2,RBFR               ADD BUFFER ADDRESS               08950000
         LA    RWK2,42(0,RWK2)         ADD SIZE OF TCAM HDR             09000000
SECCMP   CLI   0(RWK2),ENTKY     IS THIS ENTER KEY                      09050000
         BE    FIRSTCMP            YES,BR                               09100000
         LA    RWK2,1(0,RWK2)      BUMP UP SCAN ADDRESS                 09150000
         BCT   RWK,SECCMP          DEC AND CONTINUE SCAN FOR ENTER KEY  09200000
         B     NODEMF              DID NOT HIT ENTER KEY                09250000
FIRSTCMP CLC   0(4,RWK2),DEMFCON       IS THIS EMF REQUEST              09300000
         BE    FNDEMF                  YES BR CONTINUE                  09350000
         CLC   0(4,RWK2),DEMFLOW       MAYBE IN LOWER CASE              09400000
         BE    FNDEMF                  YES,BR                           09450000
         LA    RWK2,1(0,RWK2)                                           09500000
         BCT   RWK,FIRSTCMP                                             09550000
         B     NODEMF                                                   09600000
         EJECT                                                          09650000
FNDEMF   EQU   *                                                        09700000
* AT THIS POINT WE HAVE DETERMINED THAT THIS MESSAGE IS A REQUEST       09750000
* FOR DEMF.  THIS MODULE WILL NOW INSERT CERTAIN INFORMATION IN THE     09800000
* PARM FIELD OF THE DEMF MACRO FOR THIS REQUEST                         09850000
*         IF THE REQUEST IS FROM A LOCAL 3270                           09900000
*             1. THE LINE ADDRESS                                       09950000
*             2. MODEL TYPE                                             10000000
*          IF THE REQUEST IS FROM A REMOTE 3270                         10050000
*              1. THE LINE ADDRESS                                      10100000
*              2. THE CONTROL UNIT POLL CHAR                            10150000
*              3. THE TERMINAL POLL CHAR                                10200000
* IF THE REQUEST IS FOR TERMINAL INFORMATION BY SYMBOLIC NAME, CHECKS   10250000
* ARE MADE IF THE REQUESTED INFORMATION IS FOR A TCAM TERMINAL WHOSE    10300000
* LINE IS OPENED AND NOT NCP.  IF SO, THE PARM FIELD OF THE DEMF MACRO  10350000
* IS OVERLAYED WITH THE HARDWARE ADDRESS AND MODEL TYPE OF THE REQUEST  10400000
**********************************************************************  10450000
         OC    0(4,RWK2),FORTY         MAKE IT UPPERCASE                10500000
         MVI   EMFSTAT,R3270           TURM ON REMOTE FLAG              10550000
         TM    2(R15),EMF327L          IS THIS A LOCAL                  10600000
         BZ    RMT3270                 NO BR ITS A REMOTE               10650000
         MVI   EMFSTAT,L3270           TURN ON LOCAL FLAG               10700000
*********    DETERMINE LINE ADDRESS AND STORE IT     *********          10750000
*********    IN PARM FIELD OF IEDEMFCB                          *****   10800000
RMT3270  SR    R7,R7                   CLEAR REGISTER                   10850000
         IC    R7,LCBUCBX              RELATIVE LINE NUMBER             10900000
         L     RWK,LCBDCBPT            GET DCB ADR                      10950000
         L     RWK,44(RWK)             LOAD ADR OF DEB                  11000000
         LA    RWK,32(RWK)             POINT TO LIST OF UCB             11050000
         LA    R7,1(R7)                BUMP BY ONE FOR BCT              11100000
DO574    BCT   R7,DO576                                                 11150000
         B     DO578                                                    11200000
DO576    LA    RWK,4(RWK)              BCT TO RLN UCB                   11250000
         B     DO574                                                    11300000
DO578    L     RWK,0(RWK)              POINT TO UCB                     11350000
         MVC   EMFLADR(3),13(RWK)      MOVE LINE ADR                    11400000
*********   FOLLOWING CODE FINDS MODEL TYPE OF 3270 FROM UCB   ****     11450000
         MVI   EMFMODEL,MODTWO         ASSUME 3277 MODEL TWO            11500000
         CLI   EMFSTAT,R3270           IS INPUT FROM A REMOTE 3270      11550000
         BE    MODEL2                  YES,BR MODEL NOT IN UCB          11600000
         TM    16(RWK),UCBMONE         IS IT A 3277 MODEL ONE           11650000
         BNO   MODEL2                  BR, IT IS A MODEL TWO            11700000
         MVI   EMFMODEL,MODONE         MAKE IT A MODEL ONE              11750000
MODEL2   EQU   *                                                        11800000
         EJECT                                                          11850000
*********  DETERMINE IF USER ENTERED TERMINAL SYMBOLIC NAME   ***       11900000
*********  AND IF SO CONVERT IT TO HARDWARE ADDRESS           ***       11950000
         LA    R7,12(0,RBFR)       BUFFER ADR PLUS PREFIX               12000000
         AH    R7,PRFSIZE          ADD DATA SIZE                        12050000
         SR    R7,RWK2             LGTH OF DATA ENTERED IN R7           12100000
         BNP   DO579               BR,IF R7 NOT PLUS NO DATA ENTERED    12150000
         STH   R7,LTHSAVE          SAVE LTH OF DATA ENTERED             12200000
         CLI   LTHSAVE+1,10        WAS MORE THAN 10 CHAR ENTERED        12250000
         BNH   DO579               BR,LESS THAN 11 CHAR ENTERED         12300000
         CLI   4(RWK2),SBA         IS IT FROM FORMATTED SCREEN?         12350000
         BNE   DO5781              BR,NO                                12400000
         LA    RWK2,2(0,RWK2)      ADD TWO FOR THE CU TERM POLL CHARS   12450000
         BCTR  R7,R0               SUBTRACT                             12500000
         BCTR  R7,R0               TWO FROM LTH ENTERED                 12550000
         STH   R7,LTHSAVE          SAVE IT                              12600000
         CLI   LTHSAVE+1,10        IS LTH GREATER THAN 10               12650000
         BNH   DO579               BR,NO NOT SYMBOLIC NAME CONVERT      12700000
DO5781   EQU   *                                                        12750000
         CLC   5(4,RWK2),=C'3270'  IS 3270 2ND PARM                     12800000
         BNE   DO579               BR,NO NEED TO CONVERT NAME           12850000
         CLI   10(RWK2),240        WAS A NUMERICAL LINE ENTERED         12900000
         BNL   DO579               BR,YES DO NOT CONVERT                12950000
         CLI   9(RWK2),SBA         IS IT SBA                            13000000
         BE    DO579               YES,BR DID NOT ENTER SYMBOLIC NAME   13050000
         LA    R11,10(0,RWK2)      POINT R11 TO SYMBOLIC NAME           13100000
         LA    RBFR,0(0,RBFR)      CLEAR HIGH ORDER BYTE                13150000
         SR    R11,RBFR            R11 HAS AMOUNT OF DATE TO SYM NAME   13200000
         LA    R10,12(0)           BUFFER PREFIX LGTH IN R10            13250000
         AH    R10,PRFSIZE         PLUS LGTH OF DATA ENTERED            13300000
         SR    R10,R11             MINUS LENGTH UP TO SYMBOLIC NAME     13350000
*                                 EQUALS LENGTH OF SYMBOLIC NAME IN R10 13400000
         BNP   DO579               BR, IF NOT PLUS DID NOT ENTER        13450000
*                                  SYMBOLIC NAME.  IF R10 IS PLUS IT    13500000
*                                  CONTAINS LENGTH OF NAME PLUS ANY     13550000
*                                  SPACES PLUS TRAILING LINE CONTROL    13600000
***   GETTING TO THIS POINT MEANS USER ENTERED A DEMF REQUEST BY        13650000
***   SYMBOLIC NAME. SO CHECK IT TO SEE IF WE CAN CONVERT IT TO A       13700000
***   HARDWARE ADDRESS.                                                 13750000
         SR    R7,R7               CLEAR FOR LATER USE                  13800000
         LA    R10,1(0,R10)        SET R10 UP ONE FOR BCT               13850000
         LA    RWK,10(0,RWK2)      POINT RWK TO SYMBOLIC NAME           13900000
RFOUND   L     R11,AVTRNMPT        TNT ADDRESS                          13950000
         USING IEDQTNT,R11         R11 WILL HAVE TNT PREFIX             14000000
         SR    R15,R15             CLEAR REG                            14050000
         IC    R15,TNTENLEN        MAXIMUM TERMNAME LTH IN R15          14100000
         CLR   R15,R10             IS MAX LTH GREATER THAN DATA ENTERED 14150000
         BNL   AGAIN               YES,BR LEAVE R10 AS IS               14200000
         LR    R10,R15             LIMIT SEARCH TO MAX TERMNAME LENGTH  14250000
AGAIN    LA    R7,1(0,R7)          ADD ONE TO LENGTH OF NAME ENTERED    14300000
         CLI   0(RWK),90           IS IT A VALID CHAR                   14350000
         BNL   NOTFOUND            BR,HAVE NOT FOUND LAST CHAR          14400000
         B     FOUND                                                    14450000
NOTFOUND LA    RWK,1(0,RWK)        LOOK AT NEXT CHAR                    14500000
         BCT   R10,AGAIN           BR,STILL GOT DATA TO LOOK AT         14550000
FOUND    BCTR  R7,R0               SUBTRACT ONE FOR EXEC MOVE           14600000
         BCTR  R7,R0               ONE MORE                             14650000
         CLR   R15,R7              MAKE SURE NAME ENTERED IS NOT        14700000
         BNL   NOREV               LONGER THAN MAXIMUM LENGTH           14750000
         LR    R7,R15              OF TERMINAL NAMES IN TCAMS TNT       14800000
         BCTR  R7,R0                                                    14850000
NOREV    EQU   *                                                        14900000
         MVC   SYMNAME,FORTY       CLEAR TO BLANKS                      14950000
         EX    R7,MVNAME           OR NAME INTO FIELD INTO UPPER CASE   15000000
         STC   R7,R7SAVE           SAVE LENGTH OF NAME FOR LATER USE    15050000
         ST    RWK2,RWK2SAVE       SAVE ADR OF DATA ENTERED FOR LATER   15100000
         SR    RWK,RWK             CLEAR                                15150000
         LH    RWK2,TNTLEN         GET NUMBER OF TERMINAL ENTRIES       15200000
         N     RWK2,AVTCLRHI       CLEAR LEFT HALF OF REGISTER          15250000
         SR    R10,R10             CLEAR                                15300000
         IC    R10,TNTENLEN        MAXIMUM TERMNAME LENGTH              15350000
         BCTR  R10,R0              SUB ONE FOR EXEC                     15400000
         LA    R7,TNTFIRST         GET FIRST ENTRY ADDRESS              15450000
         DROP  R11                                                      15500000
TESTTRM  EQU   *                                                        15550000
         LA    RWK,1(RWK)          UPDATE OFFSET CNTR                   15600000
         CR    RWK,RWK2            END OF TNT                           15650000
         BH    DO590               NO SYMBOLIC NAME IN TCAM TNT         15700000
         EX    R10,COMPNAME        COMPARE NAMES                        15750000
         BE    NAMEMAT             NAME                                 15800000
         LA    R7,4(R10,R7)        POINT TO NEXT ENTRY                  15850000
         B     TESTTRM             CHECK NEXT ENTRY                     15900000
NAMEMAT  EQU   *                                                        15950000
***   GETTING TO HERE MEANS USER ENTERED A SYMBOLIC NAME THAT IS IN     16000000
***   TCAM TERMINAL NAME TABLE.  SO CHECK TO SEE IF IT IS A TCAM        16050000
***   TERMINAL THAT WE CAN CONVERT TO A HARDWARE ADDRESS.               16100000
         LA    R7,0(R7,R10)        ADD LENGTH TO GET ADR OF TRM         16150000
         MVC   TERMADR,0(R7)       MOVE ADR TO WORD FOR LOAD            16200000
         L     R10,TERMADR         TERMINAL TRM IN REG10                16250000
*              CHECK TO ENSURE THIS IS A TERMINAL ENTRY                 16300000
         CLI   5(R10),TRMLGB       IS THIS A NCP LGB                    16350000
         BE    FO2                 BR,YES A NCP TERMINAL DONOT CONVERT  16400000
         TM    11(R10),TRMVTAM     IS THIS A VTAM TERMINAL ENTRY        16450000
         BO    FO3                 BR,YES DO NOT CONVERT                16500000
         TM    0(R10),TERMSK       IS THIS A TCAM TERMINAL ENTRY        16550000
         BNE   DO590               BR,NO NOT A TERMINAL ENTRYSO IT      16600000
*                                  WILL NOT HAVE ADDRESSING CHARACTERS  16650000
         L     R7,0(R10)           QCB ADR IN R7                        16700000
         L     RWK2,32(R7)         DCB OR LGB ADR IN RWK2               16750000
         CLI   27(RWK2),64         IS THIS A DCB, IS IT NON NCP         16800000
         BNE   FO3                 BR IT IS A NCP TERMINAL,NO CONVERT   16850000
         TM    48(RWK2),16       IS THE DCB OPENED?                     16900000
         BNO   FO5                 BR,NO CAN NOT FIND LINE ADR          16950000
***  GETTING TO HERE MEANS WE HAVE A TCAM TERMINAL ENTRY THAT WE        17000000
***  WILL CONVERT TO A REAL HARDWARE ADDRESS.                           17050000
         SR    R15,R15                                                  17100000
         IC    R15,16(R10)         GET CH TABLE INDEX                   17150000
         BCTR  R15,0               SUB ONE                              17200000
         SR    RWK2,RWK2               CLEAR REG               @OZ29899 17250007
         LA    RWK2,4                  LOAD REG WITH A FOUR (4)@OZ29899 17255007
         SR    RAVT,RWK2               BACK AVT UP FOUR (4)    @OZ29899 17260007
         CLI   2(RAVT),X'C1'           IS IT C'A' = TCAM10 ?   @OZ29899 17265007
         BE    TCAM10A                 YES, BRANCH             @OZ29899 17270007
         SLL   R15,2                   NO, TCAM9, MULT BY FOUR @OZ29899 17275007
         B     CONTA                                           @OZ29899 17280007
TCAM10A  MH    R15,=H'6'               TCAM10, MULT BY SIX     @OZ29899 17285007
CONTA    AR    RAVT,RWK2               RESTORE RAVT BACK       @OZ29899 17290007
         A     R15,AVTCSTCS        ADD TO START OF TABLE                17300000
         TM    1(R15),M3270        IS IT A 3270 ?              @OZ29898 17350007
         BZ    FO6                 NO, DO NOT CONVERT          @OZ29898 17380007
         MVI   STATSW,R3270        TURN ON REMOTE                       17450000
         TM    2(R15),EMF327L      IS IT A LOCAL                        17500000
         BZ    UPFOUR              NO,BR IT IS A REMOTE                 17550000
         MVI   STATSW,L3270                                             17600000
UPFOUR   EQU   *                                                        17650000
         SR    RWK2,RWK2           CLEAR                                17700000
         IC    RWK2,32(R7)         RELATIVE LINE NUM IN R7              17750000
         L     RWK,32(0,R7)        LOAD ADR OF DCB IN RWK               17800000
         L     RWK,44(0,RWK)       LOAD ADR OF DEB IN RWK               17850000
*                                  FOLLOWING CHECKS TO SEE IF THE LINE  17900000
*                                  IS OPEN. AT X'10' IN THE DEB IS THE  17950000
*                                  NUMBER OF EXTENTS, SO A COMPARISION  18000000
*                                  IS MADE BETWEEN THE NO. OF EXTENTS   18050000
*                                  AND THE REL. LINE NO.  THE REL LINE  18100000
*                                  NO. BEING HIGHER MEANS THE LINE IS   18150000
*                                  NOT OPEN AND WE CAN NOT GET LINE ADR 18200000
         SR    R11,R11             CLEAR                                18250000
         IC    R11,16(0,RWK)       INSERT NO. EXTENT IN R11 FROM DEB    18300000
         CR    R11,RWK2            COMPARE NO. EXTENTS TO REL LINE NO.  18350000
         BL    FO7                 BR, CANNOT CONVERT TO HARDWARE ADR   18400000
*                                  BECAUSE LINE IS NOT OPENED.          18450000
*                                  ***       END OF ROUTINE      ***    18500000
         LA    RWK,32(RWK)         POINT TO LIST OF UCBS                18550000
CO574    BCT   RWK2,CO576                                               18600000
         B     CO578                                                    18650000
CO576    LA    RWK,4(RWK)          BCT TO RLN                           18700000
         B     CO574                                                    18750000
CO578    SR    R7,R7               CLEAR                                18800000
         IC    R7,R7SAVE           RESTORE SYMBOLIC NAME LTH IN R7      18850000
         LA    R7,FOX0(0,R7)       TURN ON F0 BITS TO INDICATE SWITCH   18900000
         STC   R7,EMFSIZE          STORE IT IN SIZE FIELD FOR QEMF      18950000
         L     RWK,0(RWK)          POINT TO UCB                         19000000
         MVC   EMFLADR(3),13(RWK)  MOVE LINE ADR                        19050000
         MVC   EMFSTAT,STATSW      MOVE LOCAL-REMOTE INDICATOR          19100000
         CLI   STATSW,L3270       IS IT A LOCAL 3270                    19150000
         BE    DO590               YES,BR ALL FINISHED CONVERTING       19200000
         TM    0(R10),2            ARE OPTIONS FIELDS USED              19250000
         BZ    NOOPT               BR,NO OPTIONS FIELDS                 19300000
         SR    R7,R7               CLEAR                                19350000
         IC    R7,17(0,R10)        GET NO. OF OPTION FIELDS             19400000
         LA    R7,3(R10,R7)        ADD OFFSET                           19450000
NOOPT    EQU   *                   REG7 POINTS INTO TRM AT-17 BEFORE    19500000
*                                  ADDRESSING CHARACTERS                19550000
         SR    RWK,RWK             CLEAR                                19600000
         IC    RWK,18(0,R7)        GET CTRL UNIT ADR                    19650000
         LA    RWK,CUTBL(RWK)           POINT TO CU ADDR CHAR  @OZ29913 19700007
         MVC   EMFCTADR(1),0(RWK)       STORE IT IN EMF PARM   @OZ29913 19710007
         IC    RWK,20(0,R7)        GET TERMINAL ADR                     19750000
         STC   RWK,EMFCUADR        STORE IT IN EMF PARM                 19800000
         B     DO590               FINISHED CONVERT RETURN              19900000
DO579    CLI   EMFSTAT,L3270           IS IT A 3270 LOCAL               19950000
         BE    DO590                   YES, BR                          20000000
*  IT IS A REMOTE 3270 SO GET TERMINAL  ADDRESSING CHARACTERS INTO PAR  20050000
         SR    RWK2,RWK2               CLEAR                            20100000
         IC    RWK2,LCBISZE            GET IDLES                        20150000
         AR    RWK2,RBFR               ADD BUFFER ADDRESS               20200000
         LA    RWK2,42(0,RWK2)         ADD SIZE OF HEADER               20250000
*        RWK2 POINTS TO FIRST DATA BYT E                                20300000
         CLI   0(RWK2),X'02'           IS IT STX                        20350000
         BNE   DO580                   NO MUST BE ADDRESS               20400000
         LA    RWK2,1(0,RWK2)          POINT TO ADDRESS                 20450000
DO580    MVC   EMFCTADR(2),0(RWK2)     MOVE ADR TO PARM                 20500000
DO590    EQU   *                                                        20550000
         L     RWK,4(R13)          LOAD WORK REG TO BUMP RETURN         20600000
         L     RWK2,12(RWK)        PLUS FOUR FOR GOOD RETURN            20650000
         LA    RWK2,4(0,RWK2)                                           20700000
         ST    RWK2,12(RWK)                                             20750000
RETURN   EQU   *                                                        20800000
         L     R13,4(R13)           ADR OF PREVIOUS SACE AREA           20850000
         L     R14,12(R13)          LOAD RET ADR                        20900000
         LM    R2,RBASE,28(R13)     RESTORE REST OF REGS                20950000
         MVI   12(R13),X'FF'        SER BYTE                            21000000
         BR    R14                     RETURN                           21050000
NODEMF   EQU   *                                                        21100000
         MVI   EMFRTCD,RC8         MOVE RET CODE ON NO DEMF             21150000
         B     RETURN                                                   21200000
FOO      STC   RWK,EMFLADR+1       STORE IT IN PARM FIELD               21250000
         MVI   EMFLADR,FOXFOX      INDICATE EMFLADR IS A SWITCH         21300000
         MVC   EMFLADR+2(1),R7SAVE MOVE TRM LNGTH TO PARM               21350000
         B     DO590               GET OUT,FINISHED                     21400000
FO2      LA    RWK,2(0)            INSERT ERROR CODE  NCP LGB           21450000
         B     FOO                                                      21500000
FO3      LA    RWK,3(0)                               VTAM TERMINAL     21550000
         B     FOO                                                      21600000
FO5      LA    RWK,5(0)                               DCB NOT OPENED    21650000
         B     FOO                                                      21700000
FO6      LA    RWK,6(0)                               NOT A 3270 TRM    21750000
         B     FOO                                                      21800000
FO7      LA    RWK,7(0)                               LINE NOT OPENED   21850000
         B     FOO                                                      21900000
MVNAME   OC    SYMNAME(0),10(RWK2)    EX INST MOVE TERM NAME            21950000
COMPNAME CLC   SYMNAME(0),0(R7)  EX INST                                22000000
R7SAVE   DC    CL1' '                                                   22050000
STATSW   DC    CL1' '                                                   22100000
         DC    CL2' '                                                   22150000
DEMFCON  DC    C'DEMF'                                                  22200000
DEMFLOW  DC    X'84859486'             LOWER CASE DEMF                  22250000
FORTY    DC    CL8' '                  USED TO MAKE UPPER CASE          22300000
SYMNAME  DC    CL8' '              WORK SPACE FOR CONVERT ROUTINE       22350000
         DC    CL4'0000'                                                22400000
         CNOP  0,4                                                      22450000
TERMADR  DC    CL4' '              THESE TWO WORDS MUST BE ON WORD      22500000
RWK2SAVE DC    CL4' '              BOUNDRY FOR LOAD AND STORE INSTS     22550000
LTHSAVE  DC    XL2'00'                                                  22600000
         CNOP   0,4                                                     22650000
CUTBL    DC    X'00000000000000000000000000000000'             @OZ29913 22652007
         DC    X'00000000000000000000000000000000'             @OZ29913 22654007
         DC    X'20215E24243C262928292A2B2E202E41'             @OZ29913 22656007
         DC    X'264A4B4C4D4E4F5051525D3B3C3B2B21'             @OZ29913 22658007
         DC    X'2A4142434445464748494A4B4C4D4E4F'             @OZ29913 22660007
         DC    X'50515242434445464748495B5C5D5E28'             @OZ29913 22662007
         DC    X'40C100000000000000004A4B4C4D4E4F'             @OZ29913 22664007
         DC    X'000000000000000000005A5B5C5D5E5F'             @OZ29913 22666007
         DC    X'00000000000000000000000000000000'             @OZ29913 22668007
         DC    X'00000000000000000000000000000000'             @OZ29913 22670007
         DC    X'00000000000000000000000000000000'             @OZ29913 22672007
         DC    X'00000000000000000000000000000000'             @OZ29913 22674007
         DC    X'00C1C2C3C4C5C6C7C8C9000000000000'             @OZ29913 22676007
         DC    X'00D1D2D3D4D5D6D7D8D9000000000000'             @OZ29913 22678007
         DC    X'0000C2C3C4C5C6C7C8C9000000000000'             @OZ29913 22680007
         DC    X'50D1D2D3D4D5D6D7D8D9000000000000'             @OZ29913 22682007
         DS    0F                                              @OY20942 22685007
MAXSIZE  DC    X'002C'                                         @OY20942 22688007
X1E      DC    X'001E'                                         @OY20942 22691007
PATCH    DS    20F                                             @OY20942 22694007
EMF      DSECT                                                          22700000
EMFSIZE  DS    CL2                                                      22750000
EMFSTAT  DS    CL1                                                      22800000
EMFMODEL DS    CL1                                                      22850000
EMFLADR  DS    CL3                                                      22900000
EMFCTADR DS    CL1                                                      22950000
EMFCUADR DS    CL1                                                      23000000
EMFRTCD  DS    CL1                                                      23050000
*****    FOLLOWING DSECTS ARE TCAM RELEASE DEPENDENT. WHENEVER A        23100000
*****    NEW LEVEL OF TCAM IS INSTALLED THESE DSECTS SHOULD BE          23150000
*****    CHECKED TO SEE IF THEY HAVE CHANGED.                           23200000
IEDQAVTD DSECT                                                          23250000
AVTDUM   DS    82F                 NOT USED FILLER ONLY                 23300000
AVTCSTCS DS    F                                                        23350000
AVTDUM1  DS    23F                 NOT USED FILLER ONLY                 23400000
AVTRNMPT DS    A                                                        23450000
AVTDUM2  DS    72F                                                      23500000
AVTCLRHI DS    2X                                                       23550000
AVTDUM3  DS    XL2                                                      23600000
AVTADBUF DS    A                                                        23650000
AVTZERO  EQU   00                                                       23700000
AVTCVTPT EQU   240                                                      23750000
IEDQLCB  DSECT                                                          23800000
LCBDUM1 DS 7F                                                           23850000
LCBISZE  DS  XL1                                                        23900000
LCBDUM2  DS XL3                                                         23950000
LCBDUM3  DS 5F                                                          24000000
LCBDCBPT DS A                                                           24050000
LCBDUM5  DS 2F                                                          24100000
LCBUCBX  DS    XL1                                                      24150000
LCBDUM6  DS    XL3                                                      24200000
LCBDUM7  DS    6F                                                       24250000
LCBDUM4  DS XL1                                                         24300000
LCBSCBA  DS AL3                                                         24350000
IEDQPRF DSECT                                                           24400000
PRFDUM DS 3F                                                            24450000
PRFDUM1 DS XL1                                                          24500000
PRFLCB DS  AL3                                                          24550000
PRFSRCE DS H                                                            24600000
PRFSIZE DS H                                                            24650000
PRFSTAT1 DS XL1                                                         24700000
PRFTSMSG EQU X'10'                                                      24750000
PRFNHDRN EQU X'01'                                                      24800000
IEDQTNT  DSECT                                                          24850000
TNTDUM1  DS    CL40                                                     24900000
TNTENLEN DS    CL1                                                      24950000
TNTDUM2  DS    CL3                                                      25000000
TNTLEN   DS    H                                                        25050000
TNTDUM3  DS    CL36                                                     25100000
TNTFIRST DS    C                                                        25150000
IEDQSCB DSECT                                                           25200000
SCBSTATE DS XL1                                                         25250000
SCBLCK1N EQU X'20'                                                      25300000
         END                                                            25350000
