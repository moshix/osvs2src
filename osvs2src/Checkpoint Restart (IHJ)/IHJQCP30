         TITLE 'IHJQCP30  MVT CHECKMAIN  IGC0F06C'                      00700018
         COPY  LCGASMSW                                                 00750000
         AIF   ('&LIB' EQ 'LIB1').LIB1BA1  TEST FOR LIB1(OS)            00900000
CP30     TITLE 'IHJQCP30 AOS/2 CHECKMAIN 1 ROUTINE - IGC0F06C'          00950000
*                                                                       01000000
* NAME - CHECKMAIN 1 - IHJQCP30 - IGC0F06C                              01050000
*                                                                       01100000
* STATUS                                                                01150000
*                                                                       01200000
*    CHANGE LEVEL=0                                                     01250000
*                                                                       01300000
* FUNCTION                                                              01350000
*                                                                       01360000
*         CHECKMAIN 1 CREATES A RECORD (ASR) OF THE EXTENTS OF THE      01370000
*         ALLOCATED REGION STORAGE PAGES ON THE CHECKPOINT DATA SET     01380000
*         AND COPIES THE ALLOCATED (VALID) PAGES DESCRIBED BY THE ASR   01390000
*         AS CORE IMAGE RECORDS (CIR) ONTO THE CHECKPOINT DATA SET.     01392000
*         THIS ASR/CIR SEQUENCE IS REPEATED UNTIL ALL VALID REGION      01394000
*         STORAGE PAGES HAVE BEEN CHECKPOINTED.                         01396000
*                                                                       01398000
* ENTRY POINTS                                                          01398400
*                                                                       01398800
*         CHECKMAIN 1 IS ENTERED VIA XCTL FROM THE PREVIOUS CHECKPOINT  01399200
*         LOAD MODULE AT ENTRY POINT IGC0F06C.                          01399600
*                                                                       01399700
* INPUT                                                                 01399800
*                                                                       01399900
*         GPR1- ADDRESS OF CHECKPOINT WORK AREA                         01449900
*                                                                       01451902
* OUTPUT                                                                01453902
*                                                                       01455902
*         GPR1- ADDRESS OF CHECKPOINT WORK AREA                         01457902
*                                                                       01458302
*         CHECKPOINT DATA SET- ASR'S AND CIR'S DESCRIBING ALL USER      01458702
*         ALLOCATED SPACE WITHIN HIS REGION                             01459102
*                                                                       01459502
* EXTERNAL REFERENCES                                                   01459602
*                                                                       01459702
*         NONE                                                          01459802
*                                                                       01459900
* EXITS, NORMAL                                                         01469900
*                                                                       01479900
*               - TO CHECKMAIN 2 AT ENTRY IGC0G06C VIA XCTL TO          01489900
*                 CHECKPOINT THE SUPERVISOR CONTROL BLOCKS AS SUR'S.    01491900
*                 UPON EXIT THE PARAMETERS ARE AS FOLLOWS-              01493900
*                 GPR 12 - ADDRESS OF CHKWA                             01495900
*                 GPR13 - ADDRESS OF STANDARD SAVE AREA                 01497900
*                                                                       01498300
* EXITS, ERROR                                                          01498700
*                                                                       01499100
*               1) TO RESUME I/O ROUTINE (IGC0N06C) VIA XCTL TO         01499500
*                  PROVIDE ITS NORMAL FUNCTIONS AND TO PASS AN ERROR    01499600
*                  CODE TO THE CHECKPOINT EXIT ROUTINE INDICATING THAT  01499700
*                  AN I/O ERROR HAS OCCURRED.                           01499800
*                  UPON EXIT THE PARAMETERS ARE AS FOLLOWS-             01549800
*                  GPR 1 - ADDRESS OF CHKWA                             01559800
*                  CHKWA - AN ERROR CODE OF X'0C' IS PASSED IN THE      01569800
*                          LAST BYTE OF THE CKRETCOD FIELD.             01579800
*                                                                       01589800
*              2)  TO RESUME I/O ROUTINE (IGC0N06C) VIA XCTL TO         01591800
*                  PROVIDE ITS NORMAL FUNCTIONS AND TO PASS AN ERROR    01593800
*                  CODE TO THE CHECKPOINT EXIT ROUTINE THAT AN          01595800
*                  UNRECOVERABLE EOV CONDITION (TWO RETRIES HAVE        01597800
*                  OCCURRED ON TAPE, OR THE DATA SET IS ON A DIRECT     01598200
*                  ACCESS DEVICE)HAS OCCURRED.                          01598600
*                  UPON EXIT THE PARAMETERS ARE THE SAME AS FOR CASE 1  01599000
*                  EXCEPT THAT THE LAST BYTE OF THE CKRETCOD FIELD      01599400
*                  CONTAINS AN X'08'.                                   01599500
*                                                                       01599600
*              3)  TO CHECKPOINT HOUSEKEEPING ROUTINE (IGC0206C) TO     01599700
*                  ATTEMPT REPROCESSING ON A NEW TAPE WHEN AN EOV       01633100
*                  HAS OCCURRED FOR THE FIRST TIME ON TAPE.             01643100
*                                                                       01653100
* TABLES/WORK AREAS                                                     01663100
*                                                                       01665100
*         DCB  DCBSYNAD                                                 01665500
*              DCBNCP                                                   01665900
*              DCBDEBAD                                                 01666300
*                                                                       01666400
*         DEB  DEBNMEXT                                                 01666500
*                                                                       01677600
*         DECB RECORD LENGTH FIELD                                      01687600
*                                                                       01688000
*         TCB  TCBPQE                                                   01688400
*                                                                       01688800
*         DPQE PQEFPQE                                                  01692500
*                                                                       01694500
*         PQE  PQEREGN                                                  01694900
*              PQEFBQE                                                  01695300
*              PQESIZE                                                  01695700
*                                                                       01696100
*         FBQE FWDPTR                                                   01696200
*              SIZE                                                     01746200
*              FBQAREA                                                  01756200
*                                                                       01766200
* ATTRIBUTES                                                            01776200
*                                                                       01786200
*         KEY 0, SUPERVISOR STATE, ENABLED, TYPE 4 SVC.                 01788200
*                                                                       01790200
*         APPLICABILITY                                                 01792200
*                                                                       01794200
*              AOS/2                                                    01794600
*                                                                       01795000
*         MODULE CHARACTERISTICS                                        01795400
*                                                                       01795800
*              TYPE - LOAD MODULE                                       01795900
*                                                                       01796000
*              RESIDENCE - SYSTEM LINK PACK AREA                        01796100
*                                                                       01812800
*         DEPENDENCIES                                                  01822800
*                                                                       01824800
*         - THE CHECKPOINT DATA SET MUST BE POSITIONED TO ACCEPT THE    01826800
*           FIRST ASR RECORD.                                           01828800
*         - THE CHKWA MUST BE OBTAINED FROM LSQA (SP253) AND PROPERLY   01829200
*           INITIALIZED BY THE CHECKPOINT HOUSEKEEPING ROUTINE.         01829300
*         - THE CHECKPOINT PRESERVE ROUTINE MUST GIVE CONTROL TO        01829400
*           CHECKMAIN 1 WITH KEY 0, SUPERVISOR STATE, AND INTERRUPS     01835000
*           ENABLED.                                                    01837000
*                                                                       01839000
* NOTES                                                                 01839400
*                                                                       01839800
*         OPERATION                                                     01840200
*                                                                       01840300
*                                                                       01840400
*         INITIALIZATION PROCESSING                                     01840500
*                                                                       01890500
*         THE MODULE RECEIVES CONTROL FROM THE SCHEDULAR PORTION OF     01900500
*         CHECKPOINT VIA XCTL. UPON RECEIVING CONTROL THE MODULE        01910500
*         ESTABLISHES ADDRESSABILITY FOR THE CODE AND FOR CHECKPOINT    01920500
*         WORK AREA (CHKWA) PASSED IN GPR 1. GPR 12 IS USED AS THE BASE 01930500
*         FOR THE WORK AREA. INITIALIZATION IS PERFORMED FOR THE I/O    01932500
*         OPERATIONS USED TO WRITE OUT THE REGION. THIS CONSISTS OF     01934500
*         SETTING GPR 13 TO THE ADDRESS OF AN 18 WORD REGISTER SAVE     01936500
*         AREA (CKREGSAV) CONTAINED IN THE CHKWA. THIS SAVE AREA IS     01938500
*         USED BY THE BSAM/BPAM WRITE AND CHECK ROUTINES. THE ADDRESS   01938900
*         OF THE CHECKMAIN 1 SYNAD ROUTINE (CM2E320) IS PLACED IN THE   01939300
*         DCBSYNAD FIELD OF THE DCB. THE TWO DECB'S CONTAINED IN THE    01939700
*         CHKWA ARE INITIALIZED TO A BUFFER LENGTH OF 2048 (2K) BYTES.  01940100
*         THEN IF THE NUMBER OF CHANNEL PROGRAMS AS SPECIFIED IN THE    01940200
*         DCBNCP FIELD OF THE CHECKPOINT DCB IS 1, A SWITCH IS SET IN   01940300
*         THE CHKWA TO INDICATE THAT SINGLE BUFFERING IS TO BE USED.    01940400
*         INITIALIZATION IS THEN PERFORMED FOR THE MAPPING OF THE USER  01957100
*         REGION.                                                       01967100
*                                                                       01969100
*         THE ADDRESS OF THE USER TCB IS OBTAINED FROM THE CHKTCBAD     01971100
*         FIELD OF THE CHKWA. THE STARTING ADDRESS OF THE REGION IS     01973100
*         OBTAINED VIA THE PQE AND IS SET AS THE FIRST ELEMENT START    01973500
*         ADDRESS. THE 2K ASR BUFFER IS ESTABLISHED IN THE 4K SUR/SSCR  01973602
*         BUFFER AND THE ASR HEADER IS INTIALIZED TO 0.                 01980602
*                                                                       01983902
*         MAPPING THE EXTENTS OF ALLOCATED USER STORAGE                 01987202
*                                                                       01990502
*         1)   THE ADDRESS OF THE FIRST/NEXT FBQE IS OBTAINED FROM      01993802
*              THE PREVIOUS FBQE/PQE FORWARD POINTER FIELD. A TEST      01997102
*              TO DETERMINE IF AN FBQE EXISTS IS PERFORMED, AND IF      02000402
*              NOT, PROCESSING CONTINUES WITH STEP 3. IF THERE IS       02003702
*              AN FBQE, THE FREE AREA STARTING ADDRESS IS COMPARED      02007002
*              TO THE CURRENT ELEMENT STARTING ADDRESS. IF THEY ARE     02010302
*              EQUAL,PROCESSING CONTINUES WITH STEP 2. IF THEY ARE      02013600
*              NOT EQUAL, THE CURRENT ELEMENT ENDING ADDRESS IS SET     02023600
*              EQUAL TO THE FREE AREA STARTING ADDRESS, AND A CALL      02033600
*              IS MADE TO THE 'SETASRE' ROUTINE. UPON RETURN FROM       02035600
*              SETASRE PROCESSING CONTINUES WITH STEP 2.                02037600
*                                                                       02039600
*         2)   A TEST IS PERFORMED TO DETERMINE IF THE REST OF THE      02041600
*              REGION IS FREE. THE ADDRESS OF THE END OF THE REGION     02042000
*              IS COMPARED TO THE ADDRESS OF THE END OF THE FREE AREA   02042100
*              DESCRIBED BY THE FBQE. IF THEY ARE EQUAL, PROCESSING     02042200
*              CONTINUES WITH STEP 4. IF THE REST OF THE REGION IS      02042300
*              NOT FREE, THE CURRENT ELEMENT START ADDRESS IS SET       02051900
*              EQUAL TO THE END OF THE FREE AREA DESCRIBED BY THE       02053900
*              FBQE, AND PROCESSING CONTINUES WITH STEP 1.              02055900
*                                                                       02057900
*         3)   WHEN THERE ARE NO MORE FBQE'S, IT IS ASSUMED THAT THE    02059900
*              REST OF THE REGION IS ALLOCATED. THEREFORE, THE CURRENT  02060300
*              ELEMENT ENDING ADDRESS IS SET EQUAL TO THE REGION        02060700
*              ENDING ADDRESS, AND A CALL IS MADE TO THE SETASRE        02061100
*              ROUTINE. UPON RETURN FROM SETASRE, PROCESSING CONTINUES  02061500
*              WITH STEP 4.                                             02071100
*                                                                       02073100
*         4)   WHEN THERE ARE NO FBQE'S THE LAST ASR FLAG IS SET IN     02075100
*              THE ASR HEADER, AND PROCESSING CONTINUES AS DESCRIBED    02077100
*              UNDER 'WRITING THE ASR AND CIR'S.                        02079100
*                                                                       02079500
*         FORMATTING THE ASR - SETASRE                                  02079900
*                                                                       02080300
*         1)   UPON ENTRY, A TEST IS PERFORMED TO DETERMINE IF THE      02080700
*              ASR BUFFER IS FULL (IE. IF THE ASRE COUNT IN THE ASR     02130700
*              HEADER IS EQUAL TO 255). IF SO, PROCESSING CONTINUES     02140700
*              WITH STEP 1 UNDER THE HEADING 'WRITING THE ASR AND       02150700
*              CIR'S. IF THE ASR BUFFER IS NOT FULL, PROCESSING         02160700
*              CONTINUES WITH STEP 2.                                   02170700
*                                                                       02172700
*         2)   THE EXTENTS OF THE ALLOCATED AREA ARE PLACED INTO THE    02174700
*              NEXT ASRE SLOT IN THE ASR BUFFER. THIS SLOT IS DEFINED   02176700
*              AS  (ASR BUFFER STARTING ADDRESS+(8*(ASRE COUNT+1))).    02178700
*              THE ASRE COUNT IS UPDATED BY 1, AND RETURN IS MADE TO    02179100
*              THE CALLER.                                              02179500
*                                                                       02179900
*         WRITING THE ASR AND CIR'S.                                    02180300
*                                                                       02180400
*         1)   UPON ENTRY, A CALL IS MADE TO THE WRITERTN SUBROUTINE    02180500
*              TO OUTPUT THE COMPLETED ASR. UPON RETURN, THE ASRE       02180600
*              COUNT IS CHECKED FOR A 0 VALUE. IF 0, IT IS ASSUMED      02197300
*              THAT THIS IS THE LAST ASR, AND PROCESSING CONTINUES      02207300
*              WITH STEP 2. IF THE ASRE COUNT IS NOT 0, THE COUNT IS    02209300
*              USED AS A LOOP COUNT. EACH ASRE IS RETRIEVED FROM THE    02211300
*              ASR RECORD (ASRE LENGTH = 8 BYTES). THE STORAGE          02213300
*              DESCRIBED BY THE ELEMENT IS WRITTEN IN 2K BLOCKS BY      02213700
*              SUCCESSIVE CALLS TO THE WRITERTN SUBROUTINE. AFTER THE   02213800
*              THE LAST ASRE HAS BEEN PROCESSED, THE LAST ASR FLAG      02213900
*              IS TESTED. IF ON, PROCESSING CONTINUES WITH STEP 2.      02219500
*              IF NOT ON, THE ASR HEADER IS RE-INITIALIZED TO 0, AND    02221500
*              PROCESSING CONTINUES WITH STEP 2 UNDER THE HEADING       02223500
*              'FORMATTING THE ASRE'.                                   02223900
*                                                                       02224300
*         2)   IF THE LAST WRITE HAS NOT BEEN CHECKED, A CALL IS MADE   02224700
*              TO THE CHECK SUBROUTINE AND THE CHECK FOR EOV SUBRTN.    02224800
*              UPON RETURN, OR IF THE LAST WRITE HAD BEEN CHECKED, AN   02224900
*              XCTL IS PERFORMED TO THE NEXT LOAD OF CHECKMAIN.         02225000
*                                                                       02238900
*                                                                       02248900
*         REGISTER USAGE WITHIN MODULE                                  02250900
*                                                                       02251300
*         0    PARAMETER REGISTER, WORK REGISTER                        02251700
*         1    PARAMETER REGISTER, WORK REGISTER                        02252100
*         2    BASE FOR DCB, RETURN REGISTER FOR WRITERTN               02252500
*         3    BASE FOR PQE AND FBQE                                    02252600
*         4    BASE FOR TCB, AND ASR BUFFER POINTER                     02252700
*         5    RETURN REG FOR CKEOVOL, CKWRITE1                         02252800
*         6    RETURN REG FOR SETASRE                                   02257400
*         7    ASRE INDEX REG                                           02259400
*         8    ELEMENT COUNT REG                                        02261400
*         9    (UNUSED)                                                 02261800
*         A    BUFFER ADDRESS TO WRITE FROM (PARAM FOR SETASRE)         02261900
*         B    BASE FOR CODE                                            02262000
*         C    BASE FOR CHKWA                                           02262100
*         D    ADDRESS OF SAVE AREA FOR ACCESS METHOD USE               02266700
*         E    RETURN FOR CMSYNAD, IMPLICITLY USED BY ACCESS METHODS    02268700
*         F    WORK REGISTER, ACCUMULATOR, TEMPORARY STORAGE            02270700
         EJECT                                                          02271100
IGC0F06C CSECT                                                          02271200
*                                                                YM2776 02283701
         BALR  RB,R0               ESTABLISH BASE                       02296401
         USING *,RB                                                     02308901
         B     BEGIN               BRANCH AROUND CSECT NAME             02321400
         DC    H'0'                PAD TO DOUBLEWORD BOUNDARY           02331400
         DC    C'IGC0F06C'         CSECT NAME                           02341400
BEGIN    LR    RC,R1               BASE FOR CHECKPOINT WORK AREA        02351400
         USING CHKWA,RC                                                 02361400
         LA    RD,CKREGSAV         GET ADDRESS OF SAVE AREA FOR I/O     02363400
         L     R2,CKDCBAD          GET CHKPT. DCB ADDRESS               02365400
         USING IHADCB,R2                                                02367400
         LA    RF,CM2E320          GET ADDRESS OF SYNAD RTN             02369400
         STCM  RF,M7,DCBSYNAD+N1   STORE ADDRESS IN DCB (3 BYTES)       02369800
         XC    CMWA(CMWAEND-CMWA),CMWA  CLEAR THE WORK AREA, SWITCHES   02370200
         LA    RF,N2048            INITIALIZE BUFFER SIZE IN DECB'S     02370600
         STH   RF,CKLNGTH1         DECB1 TO 2K                          02371000
         STH   RF,CKLNGTH2         DECB2 TO 2K                          02371100
         CLI   DCBNCP,N1           IS 1 CHANNEL PROGRAM SPECIFIED       02371200
         BH    CM2E050             NO- USE 2 CHANNEL PROGRAMS           02371300
         OI    SWITCH,CMSINGLE     INDICATE 1 CHANNEL PROGRAM           02388000
CM2E050  MVC   CKMXLIST(N8),CMN40NM MOVE IN DEFAULT NAME OF NEXT MODULE 02398000
         L     R4,CKTCBAD          GET ADDRESS OF USER'S TCB            02400000
         USING TCB,R4                                                   02402000
         L     R3,TCBPQE           GET POINTER TO DPQE-8                02404000
         USING PQESECT,R3                                               02404400
         DROP  R4                  STOP USING R4 AS TCB POINTER         02404500
         L     R3,PQEFPQE          GET ADDRESS OF REGION PQE            02404600
         L     RF,PQEREGN          GET START ADDRESS OF REGION          02410200
         LA    RF,Z(RF)            CLEAR HIGH ORDER BYTE TO 0.          02412200
         ST    RF,CMCESA           SET-ELEMENT START ADDR = REG. START  02414200
         MVC   CMRGEND,CKPPE       SET CMRGEND EQUAL TO CKPPE    Y02076 02414602
         DROP  R3                  STOP USING R3 AS PQE BASE            02415400
         USING FBQESECT,R3         START USING IT AS AN FBQE POINTER    02415500
         STCM  R3,M7,CMPQEAD+N1    SAVE THE PQE ADDRESS FOR COMPARES    02415600
         LR    R1,RC               GET ADDR OF                   Y02076 02425602
         A     R1,CKBFOFST         SUR/SSCR BUFFER               Y02076 02427602
         STCM  R1,M7,CMASRAD+N1    SAVE THE ASR BUFFER ADDRESS          02429600
         XC    Z(N8,R1),Z(R1)      ZERO OUT THE ASR HEADER AND FLAGS    02439600
         SPACE 3                                                        02441600
*        START OF REGION MAPPING                                        02442000
         SPACE 2                                                        02442400
CM2E100  CLC   CMPQEAD+N1(N3),FWDPTR+N1 IS THERE AN FBQE                02442800
         BE    CM2E130             NO, FWD PTR POINTS TO PQE            02443200
         L     R3,FWDPTR           GET ADDR OF NEXT FBQE FROM PREV.     02443300
         CLC   FBQAREA+N1(N3),CMCESA+N1 DOES ELEM. START = FREE START   02443400
         BE    CM2E120             YES, GO TEST FOR END OF REGION       02443500
         MVC   CMCEEA+N1(N3),FBQAREA+N1 SET ELEMENT END=FREE AREA START 02448100
         BAL   R6,SETASRE          BUILD AN ASRE                        02450100
CM2E120  L     RF,SIZE             GET SIZE OF FREE AREA                02452100
         A     RF,FBQAREA          CALCULATE END OF FREE AREA           02452500
         C     RF,CMRGEND          IS FREE AREA END = REGION END        02452600
         BNL   CM2E140             YES, GO WRITE OUT CURRENT ASR        02452702
         ST    RF,CMCESA           SET CURR. ELEM. START= FREE AREA END 02452800
         B     CM2E100             GO SEARCH FOR NEXT FREE AREA         02457400
         SPACE                                                          02459400
*        THE REST OF THE REGION IS ALLOCATED                            02461400
         SPACE                                                          02461800
CM2E130  MVC   CMCEEA(N4),CMRGEND  SET ELEM.END = REGION END            02461900
         BAL   R6,SETASRE          BUILD THE LAST ASRE                  02462000
CM2E140  L     R4,CMASRAD          GET ADDRESS OF ASR BUFFER            02462100
         USING ASRHDR,R4                                                02512100
         OI    ASRFLG1,ASRLAST     SET LAST ASR FLAG IN ASR HEADER      02522100
CM2E150  DS    0H                  LABEL                                02532100
         LR    RA,R4               SET TO WRITE FROM ASR BUFFER         02542100
         TM    CKFLAG1,CKVEQR      IS THIS TASK V=R?             YM2776 02544101
CKVEQR   EQU   8                        V=R BIT IN W. A.        YA00258 02544502
         BNO   CKNOVEQR            NO, GO ON                     YM2776 02546101
         LRA   RA,0(,RA)           LOAD REAL ADDRESS OF ASR      YM2776 02548101
CKNOVEQR DS    0H                                                YM2776 02550102
         BAL   R2,WRITERTN         WRITE OUT THE ASR BUFFER             02552100
         SPACE 3                                                        02554100
* WRITE OUT THE ALLOCATED STORAGE DESCRIBED BY THIS ASR RECORD          02556100
         SPACE                                                          02558100
         LH    R8,ASRCOUNT         GET ELEMENT COUNT FROM ASR BUFFER    02560100
         LTR   R8,R8               IS COUNT 0                           02560500
         BZ    CM2E190             YES, GO PREPARE TO EXIT              02560900
         SR    R7,R7               CLEAR ASRE INDEX                     02561300
CM2E170  LA    R7,N8(R0,R7)        SET ASRE INDEX = ASRE INDEX + 8      02561700
         L     RA,N0(R7,R4)        SET CIR BUFFER START=ELEMENT START   02561800
CM2E180  BAL   R2,WRITERTN         WRITE THE CIR                        02561900
         LA    RA,N2048(R0,RA)     UP CIR BUFFER START BY 2K            02562000
         C     RA,N4(R4,R7)        HAS ALLOCATED AREA WRITTEN           02578700
         BL    CM2E180             NO, WRITE MORE                       02588700
         BCT   R8,CM2E170          BRANCH IF MORE ASRE'S LEFT           02590700
         TM    ASRFLG1,ASRLAST     IS THIS LAST ASR                     02592700
         ST    R8,ASRHDR           RESET ASR HEADER TO 0 (GPR8 IS 0)    02594700
         BZ    CM2E220             NOT LAST ASR SO RETURN TO SETASRE    02595100
CM2E190  DS    0H                  LABEL                                02595200
         TM    SWITCH,CMWRITE1     HAS LAST WRITE BEEN CHECKED          02595300
         BZ    CM2E200             YES, GO FREE THE BUFFER AND LEAVE    02600900
         BAL   R5,CKWRITE1         NO, CHECK THE WRITE                  02602900
         BAL   R5,CKEOVOL          CHECK FOR END OF VOLUME              02604900
         SPACE 3                                                        02605300
CM2E200  DS    0H                  LABEL                                02606102
         LR    R1,RC               PUT CHKWA ADDRESS BACK IN GPR1.      02606200
         LA    RF,CKMXLIST         GET ADDRESS OF MODULE NAME           02606300
         ST    RF,CKMN40AD         PUT IT IN THE WORK AREA              02606400
         LA    RF,CKMN40AD         GET ADDR OF ADDR                     02620300
         XCTL  SF=(E,(15))         XCTL TO NEXT LOAD                    02630300
         SPACE 3                                                        02632300
*        SETASRE ROUTINE - BUILDS AN ASR ENTRY AND WRITES OUT THE       02632700
*              ASR RECORD AND ITS DESCRIBED STORAGE IF THE ASR IS FULL  02633100
         SPACE                                                          02633500
SETASRE  DS    0H                                                       02633900
CM2E210  L     R4,CMASRAD          GET ADDRESS OF ASR HEADER            02634000
         USING ASRHDR,R4                                                02634100
         CLI   ASRCOUNT+N1,N255    IS ASR BUFFER FULL                   02634200
         BNL   CM2E150             YES, GO WRITE THE ASR AND CIR'S      02638800
CM2E220  DS    0H                  LABEL                                02640800
         LH    RF,ASRCOUNT         GET THE NUMBER OF ASRE'S IN BUFFER   02642800
         LA    RF,N1(R0,RF)        ADD 1                                02643200
         STH   RF,ASRCOUNT         UPDATE THE COUNT IN THE ASR HEADER   02643300
         SLL   RF,N3               MULTIPLY BY 8 TO GET INDEX VALUE     02643400
         AR    RF,R4               GENERATE POINTER TO ASRE             02643500
         MVC   Z(N8,RF),CMCESA     MOVE IN AREA START AND END ADDRESSES 02648100
         BR    R6                  RETURN TO CALLER                     02650100
         EJECT                                                          02652100
*                                                                       02652500
*        WRITE RTN - CHECKMAIN 1 WRITE ROUTINE                          02652600
*                                                                       02652700
WRITERTN DS    0H                                                       02652800
CM2E240  TM    SWITCH,CMWRITE1     WAS LAST WRITE ON DECB 1             02702800
         BZ    CM2E260             NO, GO USE DECB 1                    02712800
         TM    SWITCH,CMSINGLE     WAS SINGLE BUFFERING REQUESTED       02722800
         BO    CM2E250             YES, GO CHECK THE WRITE              02732800
         WRITE CKDECB2,SF,,(RA),,MF=E  WRITE AN ASR/CIR WITH DECB 2.    02742800
         BAL   R5,CKWRITE1         GO CHECK DECB1                       02744800
         CHECK CKDECB2             NOW CHECK DECB2                      02746800
         CLI   CKRETIO,CKIOERR     WAS THERE AN I/O ERROR               02748800
         BE    CM2E280             YES, GO STOP THE CHECKPOINT          02750800
         NI    SWITCH,ON-CMWRITE1  NO, TURN OFF THE DECB 1 SWITCH       02751200
         BAL   R5,CKEOVOL          GO CHECK FOR END OF VOLUME.          02751600
         BR    R2                  RETURN TO CALLER                     02752000
         SPACE 2                                                        02752400
CM2E250  BAL   R5,CKWRITE1         DECB 1                               02752500
         BAL   R5,CKEOVOL          CHECK FOR EOV                        02752600
CM2E260  DS    0H                                                       02762602
         WRITE CKDECB1,SF,,(RA),,MF=E WRITE ASR/CIR WITH DECB1          02766600
         OI    SWITCH,CMWRITE1     SET SWITCH FOR DECB1.                02769400
         BR    R2                  RETURN TO CALLER                     02779400
         SPACE                                                          02781400
CM2E280  MVI   CKMXLIST+N4,CHARN   CAUSE XCTL TO IGC0N06C               02783400
         B     CM2E200             GO FREE THE BUFFER AND RETURN.       02785400
         SPACE 3                                                        02785800
*        CKWRITE1 ROUTINE                                               02785900
         SPACE 1                                                        02786000
*              THIS ROUTINE PERFORMS THE CHECK FOR DECB 1.              02791600
CKWRITE1 EQU   *                   CHECK RTN FOR DECB                   02793600
CK2E270  CHECK CKDECB1                                                  02795600
         CLI   CKRETIO,CKIOERR     Q. I/O ERROR                         02796000
         BCR   NOTEQ,R5            A. NO. RETURN TO CALLER              02796400
         B     CM2E280             A. YES. GO XCTL TO IGC0N06C   Y02076 02796802
         SPACE 3                                                        02796900
*        SYNAD ROUTINE FOR CHECKMAIN1                                   02797000
         SPACE 1                                                        02797100
*              THIS ROUTINE SETS THE ERROR CODE AND MSG NUMBER IN THE   02811000
*              CHECKPOINT WORK AREA.  THE CHECK ROUTINES WILL TEST      02821000
*              THE FLAG AND TERMINATE PROCESSING.                       02823000
CMSYNAD  EQU   *                   SYNAD RTN                            02823400
CM2E320  MVI   CKRETIO,CKIOERR     SET FLAG OF 12 FOR I/O ERROR         02823800
         LA    R0,NX317            SET MESSAGE NUMBER/ERROR CODE        02824200
         STH   R0,CKMSGCOD         INTO WORK AREA                       02824600
         RETURN                                                         02824700
*        CKEOVOL - THIS SUBROUTINE DETERMINES IF AN END OF VOLUME       02824800
*                  CONDITION IS PENDING.                                02824900
CKEOVOL  EQU   *                   END OF VOLUME ROUTINE                02829500
CM2E290  TM    CKFLAG1,CKTAPE      Q. IS CHECKPOINT DATA SET ON TAPE    02831500
         BZ    CM2E300             NO. IT IS A DIRECT ACCESS DEVICE     02833500
         L     RF,CKTSTEOV         GET ADDR OF VOL. SEQUENCE NUMBER     02833900
         CLC   Z(N4,RF),CKEOVCMR   Q. DID EOV OCCUR (HAS IT CHANGED)    02834000
         BCR   EQ,R5               A. NO RETURN TO CALLER               02834100
         TM    CKFLAG2,CKEOV       EOV ON PREVIOUS TAPE                 02834200
         BO    CM2E310             YES, GO CANCEL THE CHECKPOINT        02838800
         OI    CKFLAG2,CKEOV       TURN ON THE EOV INDICATOR            02840800
         MVI   CKMXLIST+N4,CHAR2   SET REG TO CAUSE XCTL TO IGC0206C    02842800
         B     CM2E200             GO FREE THE ASR BUFFER AND TRY AGAIN 02843200
*        EOV ON DASD                                                    02843300
         SPACE                                                          02843400
CM2E300  L     RF,CKDCBAD          GET DCB ADDRESS                      02843500
         USING IHADCB,RF                                                02874800
         L     RF,DCBDEBAD         GET DEB ADDRESS                      02884800
         DROP  RF                                                       02894800
         USING DEBBASIC,RF                                              02904800
         CLC   DEBNMEXT(N1),CKTSTEOV    EOV ON DASD                     02905200
         BCR   EQ,R5                    NO, RETURN TO CALLER            02905600
         DROP  RF                                                       02906000
         SPACE                                                          02916400
*        AN EOV ON DASD OR SECOND EOV ON TAPE HAS OCCURRED              02926400
         SPACE                                                          02926800
CM2E310  MVI   CKRETIO,CKEOVCOD    SET UP RETURN CODE OF 8.             02926900
         MVI   CKMXLIST+N4,CHARN   SET TO GO TO IGC0N06C                02930400
         LA    RF,CKERIO7          SET UP EOV ERROR                     02932400
         STH   RF,CKMSGCOD              MESSAGE CODE                    02932800
         B     CM2E200             GO FREE ASR BUFFER AND EXIT          02933200
         EJECT                                                          02933600
*              CONSTANTS FOR CHECKMAIN 1.                               02933700
         SPACE 3                                                        02933800
CMN40NM  DC    C'IGC0G06C'         NAME OF CHECKMAIN2 (IHJVCP40)        02942500
         SPACE 3                                                        02944500
*              MASK EQUATES                                             02946500
         SPACE 3                                                        02948500
M7       EQU   7                   MASK FOR ICM/STCM INSTRUCTIONS.      02950500
NOTEQ    EQU   7                   MASK TO BRANCH ON NOT EQUAL COMPARE  02950900
EQ       EQU   8                   MASK TO BRANCH ON EQUAL COMPARE      02951000
ON       EQU   255                 MASK FOR BIT RESET                   02951102
         SPACE 3                                                        02951200
*              GENERAL EQUATES                                          02960900
         SPACE 3                                                        02962900
Z        EQU   0                   ZERO                                 02964900
N0       EQU   0                   NUMBER 0                             02966900
N1       EQU   1                   NUMBER 1                             02968900
N3       EQU   3                   NUMBER 3                             02969300
N4       EQU   4                   NUMBER 4                             02969700
N7       EQU   7                   NUMBER 7                             02970100
N8       EQU   8                   NUMBER 8                             02970500
N2048    EQU   2048                2K BLOCK SIZE                        02970600
N255     EQU   255                 MAX. NO. OF ASRE'S IN AN ASR RECORD  02970700
         SPACE 3                                                        02970800
*              ERROR MESSAGE CODES/RETURN CODES                         03020800
         SPACE 3                                                        03030800
CKEOVCOD EQU   8                   RETURN CODE FOR END OF VOLUME        03040800
NX317    EQU   X'317'              ERROR CODE FOR I/O ERROR             03050800
CKERIO7  EQU   X'31B'              MESSAGE CODE FOR END OF VOLUME       03060800
CHAR2    EQU   C'2'                EBCDIC 2                             03062800
CHARN    EQU   C'N'                EBCDIC N                             03064800
         SPACE 3                                                        03066800
*              PATCH AREA FOR MAINTENANCE                               03068800
         SPACE 3                                                        03069200
PATCH    EQU   *                   END OF MODULE                        03069600
CM1LEN   EQU   PATCH-IGC0F06C      LENGTH OF CSECT                      03070000
PATCHLEN EQU   CM1LEN/10           LENGTH OF PATCH AREA                 03070400
CMIPATCH DS    CL(PATCHLEN)        PATCH AREA OF 10 PERCENT.            03070500
         EJECT                                                          03070600
*              DSECT  USED FOR ASR HEADER                               03070700
         SPACE 3                                                        03087400
ASRHDR   DSECT                                                          03097400
ASRCOUNT DS    H                   NUMBER OF ENTRIES IN ASR RECORD      03099400
ASRFLG1  DS    X                   ASR FLAG BYTE                        03101400
ASRLAST  EQU   X'80'               LAST ASR RECORD                      03103400
ASRRESV  DS    5X                  RESERVED                             03103800
         EJECT                                                          03103900
         IEEVCHWA  VER=3           USE VERSION 3 OF WA                  03104000
CMWA     DS    0D                  START OF CHECKMAIN WORK AREA         03109600
CKRETIO  EQU   CKRETCOD+1          CELL FOR RETURN CODE                 03111600
CKTSTEOV EQU   CKUNIT              EOV TEST 1                           03113602
CKEOVCMR EQU   CKUNIT+4            EOV TEST 2                           03114002
* THE ORDER OF THE NEXT TWO FIELDS MUST BE CMCESA, CMCEEA               03114400
CMCESA   DS    F                   CURRENT ELEMENT START ADDRESS        03114800
CMCEEA   DS    F                   CURRENT ELEMENT ENDING ADDRESS       03114900
SWITCH   DS    F                   SWITCH WORD                          03115000
CMWRITE1 EQU   2                   INDICATES WRITE1 WAS LAST WRITE      03115100
CMSINGLE EQU   1                   INDICATES SINGLE BUFFERING           03129000
CKMN40AD DS    F                   SET TO ADDRESS OF CKMXLIST FOR XCTL  03139000
CKMXLIST DS    2F                  NAME OF NEXT MODULE TO GET CONTROL   03141000
CMRGEND  DS    F                   REGION END ADDRESS                   03141400
CMASRAD  DS    F                   ADDRESS OF START OF ASR BUFFER       03141800
CMPQEAD  DS    F                   ADDRESS OF THE PQE FOR REGION        03142200
CMWAEND  EQU   *                   END OF CHECKMAIN WORK AREA           03142600
         EJECT                                                          03142700
         IKJTCB                                                         03142800
         EJECT                                                          03142900
         IHAPQE                                                         03147500
         EJECT                                                          03149500
         IHAFBQE                                                        03151500
         EJECT                                                          03151900
         IHADCB DSORG=(BS,PO),DEVD=(DA,TA)                              03152000
         EJECT                                                          03152100
         IEZDEB                                                         03152200
.LIB1BA1 ANOP                                                           03156800
         AIF   ('&LIB' EQ 'LIB2').LIB2BA1  TEST FOR LIB2(AOS)           03158800
*                                                                       03161600
*0000501000-516000,540000-543000,549000                          A38515 03166200
*   STATUS ... CHANGE LEVEL 001                                         03170800
*                                                                       03220800
*   FUNCTION ...                                                        04000017
*                                                                       05000017
*        WRITES CORE IMAGE RECORDS (CIR'S) OF THE REGION              * 06000017
*        ON CHKPT DATA SET, AND TRANSFERS CONTROL TO THE NEXT LOAD OF   07000017
*        CHECKPOINT.                                                    08000017
*                                                                       09000017
*   ENTRY ...                                                           10000017
*                                                                       11000017
*        CHKMAIN IS ENTERED VIA A TRANSFER CONTROL FROM THE PREVIOUS    12000017
*        CHECKPOINT LOAD AT ENTRY POINT IGC0F06C                        16000017
*                                                                       16300017
*   INPUT ...                                                           16600017
*                                                                       16900017
*   ..   DATA SET UP BY PREVIOUS LOADS OF CHECKPOINT AND MADE AVAILABLE 17200017
*        TO CHKMAIN IN THE CHKPT WORK AREA (W.A.).                      17500017
*   ..   THE ADDRESS OF THE CHKPT W.A. IS PASSED IN GENERAL REGISTER 1  17800017
*        BY THE PREVIOUS LOAD OF CHECKPOINT.                            18100017
*   ..   THE FOLLOWING DATA, RESIDING IN THE CHKPT W.A. IS USED BY THE  18400017
*        CHKMAIN ROUTINE.                                               18700017
*              CKWAOFST - OFFSET TO BEGINNING OF CHKMAIN AND CHKPT W.A. 19000017
*              CKBFOFST - OFFSET TO BEGINNING OF CHKPT'S BUFFER         19300017
*              CKDCBAD  - POINTER TO CHKPT DATA SET DCB                 19600017
*              CKWACL   - LENGTH OF CHKPT W.A.                          19900017
*              CKBUFL   - LENGTH OF CHKPT BUFFER                        20200017
*              CKTCBAD  - POINTER TO PP TCB                             20500017
*              CKPPM    - POINTER TO FIRST BYTE IN PP AREA              20800017
*              CKPPE    - POINTER TO LAST BYTE IN PP AREA               21100017
*              CKDECB1  - POINTER TO DECB FOR WRITE 1                   21400017
*              CKDECB2  - POINTER TO DECB FOR WRITE 2                   21700017
*                                                                       22000017
*   OUTPUT ...                                                          22300017
*                                                                       22600017
*   ..   OUTPUT CONSISTS OF CORE IMAGE RECORDS OF CHKPT DATA SET      * 22900017
*                                                                       23200017
*   EXITS ...                                                           23500017
*                                                                       23800017
*   NORMAL- XCTL TO IGC0G06C (NEXT LOAD OF RESTART)                   * 24100017
*   ERROR                                                             * 24400017
*   (1)UNRECOVERABLE EOV ON CKPT DATA SET- XCTL TO IGC0N06C WITH      * 24700017
*      RETURN CODE OF 8                                               * 25000017
*   (2)RECOVERABLE EOV ON CKPT DATA SET- XCTL TO IGC0206C             * 25300017
*   (3)I/O ERROR- XCTL TO IGC0N06C WITH RETURN CODE OF 12             * 25600017
*                                                                     * 25900017
*                                                                     * 26200017
*                                                                       26500017
*   WORK AREAS ...                                                      26800017
*                                                                       27100017
*   ..   CHKMAIN USES THE FOLLOWING WORK AREAS WHICH ARE BUILT BY THE   27400017
*        FIRST LOAD OF CHECKPOINT.                                      27700017
*                                                                       28000017
*              CHKWA - CHKPT W.A. BUILT BY CHKPT CONTAINING DATA TO BE  28300017
*                      UTILIZED BY SUBSEQUENT LOADS OF CHECKPOINT.      28600017
*              CMWA  - WORK AREA ALLOCATED BY CHKPT FOR USE BY THE      28900017
*                      CHKDCB AND CHKMAIN ROUTINES.                     29200017
*                                                                       29500017
         EJECT                                                          29800018
*                                                                       30100017
*                                                                       30400017
*       THIS ROUTINE WRITES OUT THE PROBLEM PROGRAM STORAGE.            30700017
*                                                                       31000017
*                                                                       31300017
IGC0F06C CSECT                                                          33300017
*2841010000-020000,298000,384000,444000-447000,471000,513000,           33370018
*    552000-558000,585000,627000,657000-663000,672000,786000,801000,    33440018
*    825000,837000-846000                                               33510018
         BALR  RB,R0          ESTABLISH BASE                            33600017
         USING *,RB                                                     33900017
         USING CHKWA,RC       ADDRESS CHKPT W.A.                        34200017
         USING IHADCB,R2      ADDRESS CHKPT DCB.                        34500017
         LR    RC,R1          GET ADDR OF CHKPT W.A.                    34800017
         LA    RD,CKREGSAV    GET ADDR OF REG S.A.                      35100017
         L     R2,CKDCBAD     GET CHKPT DCB ADDR                        35400017
         LA    RF,CM2A2       GET ADDR OF CHKMAIN SYNAD ROUTINE         35700017
         ST    RF,CMSYSA                                                36000017
         MVC   DCBSYNAD+N1(N3),CMSYSA+N1     PUT ADR. OF CM2A2          36300017
*                                            IN SYNAD FIELD             36600017
         MVI   SWITCH,X0      INITIALIZE SWITCHES                       36900017
         CLI   DCBNCP,X1      Q.  IS SINGLE BUFFERING INDICATED         37200017
         BH    CM2E1          NO-MULTIPLE BUFFERING SPECIFIED.          37500017
         OI    SWITCH,CMS1    SET CMS1 ON- SINGLE BUFFERING             37800017
CM2E1    EQU   *                                                        38100017
         L     RA,CKPPE       CALCULATE LOW AND HIGH BOUNDS OF          38700017
         LTR   RA,RA               Q. W.A. IN H0                   I283 38760019
         BNE   CM2E2               A. YES  SKIP H1 W.A. CODE       I283 38820019
         L     RA,CKPPEL           A. NO  W.A. IS IN H1            I283 38880019
CM2E2    EQU   *                                                   I283 38940019
         LR    R9,RC          AREA ABOVE W.A.                           39000017
         A     R9,CKWACL                                                39300017
         BAL   R8,CMINTW      GO TO WRITE OUT CORE ABOVE W.A.           39600017
         LA    RA,CHKWA       GET LOW AND HIGH BOUNDS OF                39900017
         BCTR  RA,R0          DECREMENT COUNT                           40200017
         L     R9,CKPPM       AREA ABOVE W.A.                           40500017
         LTR   R9,R9               Q. W.A. IN H0                   I283 40560019
         BNE   CM2E3               A. YES  SKIP H1 W.A. CODE       I283 40620019
         L     R9,CKPPML           A. W.A. IS IN H1               M2811 40680019
CM2E3    EQU   *                                                   I283 40740019
         BAL   R8,CMINTW      GO TO WRITE OUT CORE BELOW W.A.           40800017
         L     RA,CKPPEL      GET HIGH BOUNDARY OF HIERARCHY ONE.       41100017
         LTR   RA,RA          Q. DOES THIS REGION HAVE A HIERARCHY      41400017
         BZ    CMSKP          NO                                        41700017
         L     R9,CKPPE            SET UP TEST FOR H0 SEGMENT      I283 41770019
         LTR   R9,R9               Q. IS THERE AN H0 SEGMENT       I283 41840019
         BE    CMSKP               A. NO  H1 ALREADY WRITTEN       I283 41910019
         L     R9,CKPPML      GET LOW BOUNDARY OF HIERARCHY ONE.        42000017
         BAL   R8,CMINTW      GO TO WRITE OUT HIERARCHY ONE CORE.       42300017
CMSKP    EQU   *                                                        42600017
         TM    SWITCH,CMS2    Q. HAS LAST WRITE BEEN CHECKED            42900017
         BZ    CMSKP2         YES-SKIP CODE TO CHECK.LAST WRITE         43200017
         BAL   R5,CMCHK1      GO TO CHECK LAST WRITE                    43500017
         BAL   R5,CMEOV       GO TO SEE IF EOV OCCURRED                 43800017
CMSKP2   EQU   *                                                        44100017
         MVC   CKMXLIST(N8),CKMN40      XCTL PARAMETER                  44500018
CMXCTL   EQU   *                                                        45000017
         LR    R1,RC          LOAD PARM REG WITH ADDR OF W.A.           45300017
         LA    RF,CKMXLIST                                              45600017
         ST    RF,CKMN40AD                                              45900017
         LA    RF,CKMN40AD                                              46200017
         XCTL  SF=(E,(15))   XCTL TO NEXT LOAD                          46500017
*                                                                       46620018
*        REPMAIN SYNAD ROUTINE                                          46680018
*                                                                       46740018
CM2A2    EQU   *                                                        46800017
         MVI   CKRETIO,CKIOERR     ERROR CODE INTO WORK AREA            47100018
         LA    R0,NX317                                                 47400017
         STH   R0,CKMSGCOD                                              47700017
         RETURN                                                         48000017
*                                                                       48070018
*        END OF VOLUME                                                  48140018
*                                                                       48210018
CMEOV    EQU   *                                                        48300017
         TM    CKFLAG1,CKTAPE   Q. CHKPT DATA SET ON TAPE               48600017
         BZ    CMEOVDA        DIRECT ACCESS EOV                         48900017
         L     RF,CKTSTEOV                                              49200017
         CLC   N0(N4,RF),CKEOVCMR       Q.   DID  EOV OCCUR             49500017
         BE    N0(R5)                   A.   NO  CONTINUE PROCESS       49800017
         MVI   CKRETCOD+N1,X'14'   YES - SET EOV ERR CODE - 14   A38515 50300021
         LA    RF,CKTPEOV     INDICATE TAPE EOV ERROR            A38515 50800021
         B     CMEOVER             GO TO EXIT ROUTINE            A38515 51300021
CMEOVDA  EQU   *                                                        51900017
         USING IHADCB,RF                                                52200017
         L     RF,CKDCBAD    GET ADR. OF CHKPT DCB                      52500017
         L     RF,DCBDEBAD   GET ADR. OF CHKPT DEB                      52800017
         DROP  RF                                                       53100017
         CLC   DEBNMEXT(N1,RF),CKTSTEOV      Q.  EOV ON DA DEVICE       53400017
         BE    N0(R5)                        NO CONTINUE PROCESS        53700017
         MVI   CKRETCOD+N1,CKPGMERR SET RETURN CODE TO 8         A38515 53800021
         LA    RF,CKERIO7     INDICATE DISK EOV ERROR            A38515 54000021
CMEOVER  EQU   *                                                 A38515 54200021
         STH   RF,CKMSGCOD                                              54600017
         B     CMIORE                   XCTL INTERFACE                  56100017
         EJECT                                                          56160018
*                                                                       56220018
*        DOUBLE BUFFERING                                               56280018
*                                                                       56340018
CMSMBUF  EQU   *                                                        56400017
         TM    SWITCH,CMS1    Q. SINGLE BUFFERING                       56700017
         BO    CMSBUF         YES                                       57000017
         STH   R6,CKLNGTH2    PUT LENGTH OF CIR IN DECB.                57300017
         WRITE CKDECB2,SF,,(RA),,MF=E   WRITE A CIR.                    57600017
         BAL   R5,CMCHK1      GO TO CHECK WRITE 1.                      57900017
         CHECK CKDECB2                                                  58200017
         CLI   CKRETIO,CKIOERR     Q.  I/O ERROR                        58500018
         BE    CMIORE                   XCTL INTERFACE                  58800017
         XI    SWITCH,CMS2    TURN OFF SWITCH INDICATING THAT           59100017
*                             LAST WRITE USED DECB1.                    59400017
         BAL   R5,CMEOV       GO TO SEE IF EOV OCCURRED.                59700017
         BR    R3                  RETURN TO CALLER                     60000017
*                                                                       60070018
*        SINGLE BUFFERING                                               60140018
*                                                                       60210018
CMSBUF   EQU   *                                                        60300017
         BAL   R5,CMCHK1      GO TO CHECK WRITE 1.                      60600017
         BAL   R5,CMEOV       GO TO SEE IF EOV OCCURRED.                60900017
         B     CMCOMW         GO TO WRITE OUT A CIR.                    61200017
CMWRTO   EQU   *                                                        61500017
         TM    SWITCH,CMS2 Q. DID LAST WRITE USE DECB1                  61800017
         BO    CMSMBUF        YES                                       62100017
CMCOMW   EQU   *                                                        62400017
         BAL   R5,CMWRT1           DO WRITE 1                           62700018
         OI    SWITCH,CMS2    TURN ON INDICATION THAT LAST WRITE        63000017
*                             USED DECB1.                               63300017
         BR    R3                  RETURN TO CALLER                     63600017
CMWRT1   EQU   *                                                        63900017
         STH   R6,CKLNGTH1    PUT LENGTH OF CIR IN DECB1.               64200017
         WRITE CKDECB1,SF,,(RA),,MF=E   WRITE A CIR.                    64500017
         BR    R5                  RETURN TO CALLER                     64800017
CMCHK1   EQU   *                                                        65100017
         CHECK CKDECB1                                                  65400017
         CLI   CKRETIO,CKIOERR     Q.  I/O ERROR                        65800018
         BCR   NOTEQ,R5            A.  NO  RETURN TO CALLER             66200018
CMIORE   EQU   *                                                        66600017
         MVC   CKMXLIST(N8),CKMN40      SET UP XCTL PARM. LIST          66900017
         MVI   CKMXLIST+N4,CHARN        FOR I/O RESUME                  67200018
         B     CMXCTL              XCTL INTERFACE                       67500017
*                                                                       67570018
*        WRITE INTERFACE                                                67640018
*                                                                       67710018
CMLSWT   EQU   *                                                        67800017
         CH    R7,NOISE    Q. WOULD CIR BE MISTAKEN FOR NOISE           68100017
         BL    CMNOISE     YES                                          68400017
         LR    R6,R7          GET LENGTH OF CIR.                        68700017
CMCOM    EQU   *                                                        69000017
         LR    RA,R9          GET ADDR OF BEGINNING OF CIR.             69300017
         BAL   R3,CMWRTO      GO TO WRITE LAST CIR FOR THIS AREA.       69600017
         B     N0(R8)         RETURN TO CALLER                          69900017
CMNOISE  EQU   *                                                        70200017
         LH    R6,NOISE       INSURE CIR IS AT LEAST MINIMUM LENGTH.    70500017
         B     CMCOM          GO TO WRITE CIR                           70800017
CMINTW   EQU   *                                                        71100017
         LA    RA,N1(R0,RA)       INCREMENT HIGH BOUND PTR.             71400017
         LR    R7,RA          CALCULATE LENGTH OF AREA                  71700017
         SR    R7,R9          TO BE WRITTEN OUT.                        72000017
         L     R6,CKBUFL      GET BLKSIZE                               72300017
CMWAGN   EQU   *                                                        72600017
         LTR   R7,R7          Q. ANY MORE TO BE WRITTEN OUT.            72900017
         BZ    N0(R8)         NO RETURN                                 73200017
         CR    R7,R6          Q. LENGTH TO BE WRITTEN LESS THAN BLKSIZE 73500017
         BNH   CMLSWT         YES- WRITE OUT SHORT BLOCK                73800017
         SR    RA,R6          GET ADDR OF BEGINNING OF CIR.             74100017
         SR    R7,R6          COMPUTE LENGTH OF AREA THAT WILL BE LEFT. 74400017
         BAL   R3,CMWRTO      GO TO WRITE A CIR.                        74700017
         B     CMWAGN         PROCESS NEXT CIR                          75000017
         EJECT                                                          75060018
*                                                                       75120018
*        DEFINED CONSTANTS                                              75180018
*                                                                       75240018
NOISE    DC    H'18'     MINIMUM LENGTH FOR CHKPT RECORD.               75300017
CKMN40   DC    CL8'IGC0G06C'  NAME OF NEXT LOAD OF RESTART              75600017
         SPACE 4                                                        75700018
         IEEVCHWA                  OS VERSION OF WA                     75950000
CKTSTEOV EQU CKUNIT                                                     76200017
CKEOVCMR EQU CKUNIT+4                                                   76500017
CMADEOV  DS    F    SAVE AREA FOR INFORMATION NEEDED                    76800017
CMNEOV   DS    F    TO TEST IF EOV OCCURRED.                            77100017
SWITCH   DS    F     SWITCH                                             77400017
CMS1     EQU   1    INDICATES SINGLE BUFFERING.                         77700017
CMS2     EQU   2    INDICATES WRITE 1 WAS LAST WRITE.                   78000017
CKMXLIST DS    2F   NAME OF NEXT MODULE TO RECEIVE CONTROL.             78300017
CKMN40AD DS    F       CHECKMAIN                                        78600018
CMSYSA   DS    F     SYSTEM                                             78900017
         IHBABCTL                                                       79200017
         DCBD  DSORG=(BS,PO),DEVD=(DA,TA)                               79500017
         EJECT                                                          79530018
*                                                                       79560018
*        GENERAL EQUATES                                                79590018
*                                                                       79620018
CKRETIO  EQU   CKRETCOD+1                                               79650018
CHARN    EQU   C'N'                                                     79680018
CHAR2    EQU   C'2'                                                     79710018
NOTEQ    EQU   7                                                        79740018
SURL     EQU   200  LENGTH OF SUR BUFFER.                               79800017
X0       EQU   X'0'                                                     79900018
X1       EQU   X'01'                                                    80000018
NX317    EQU   X'317'                                                   80100018
CKERIO7  EQU   X'031B'                                                  80400017
CKTPEOV  EQU   X'031C'        TAPE EOV ERROR                     A38515 80500021
DEBNMEXT EQU   16     NUMBER OF EXTENTS FOR THIS DEB                    80700017
*                                                                       81000017
*        EQUATES FOR GENERAL DISPLACEMENTS                              81300017
*                                                                       81600017
N0       EQU   0                                                        81900017
N1       EQU   1                                                        82200017
N3       EQU   3                                                        82800017
N4       EQU   4                                                        83100017
N8       EQU   8                                                        83400017
.LIB2BA1 ANOP                                                           83450000
         END                                                            84900017
