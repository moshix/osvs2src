         TITLE 'IHJQCP32 CHECKMAIN 3 ROUTINE - IGC0H06C'                00370002
*                                                                       00380000
* STATUS                                                                00390000
*                                                                       00392000
* FUNCTION                                                              00394000
*                                                                       00396000
*    CHECKMAIN 3 CREATES A RECORD (SUR) OF CERTAIN USER RELATED         00398000
*    AND DATA MANAGEMENT CONTROL BLOCKS AND OUTPUTS THIS                00398400
*    RECORD TO THE CHECKPOINT DATA SET. FOLLOWING ARE THE        Y02076 00398802
*    RECORDS, LENGTHS, AND ASSOCIATED SUR CODES IN THE ORDER     Y02076 00399002
*    THEY ARE BUILT AND WRITTEN TO THE CHECKPOINT DATA SET BY    Y02076 00399102
*    THIS MODULE:                                                Y02076 00399202
*                                                                Y02076 00399402
*    RECORD TYPE             LENGTH      SUR CODE                Y02076 00399602
*                                                                Y02076 00399702
*    TCBUSER FIELD              4         X'0F'                  Y02076 00399802
*    TCBCAUF FIELD              4         X'0F'                @ZA32921 00399937
*    TCBFSA FIELD               4         X'0F'                  Y02076 00400037
*    CHECKPOINT DCB ADDR        4         X'0F'                  Y02076 00400237
*    CHECKPOINT DCB SYNAD       4         X'0F'                  Y02076 00400302
*    CHECKPOINT DCB BLKSIZE     2         X'0F'                  Y02076 00400402
*    REGISTERS (G.P.)          64         X'10'                  Y02076 00400502
*    DEB (NON-ISAM)          VARIABLE     X'80'                  Y02076 00400602
*    DEB (ISAM)              VARIABLE     X'81'                  Y02076 00400702
*    DEB (DUMMY)             VARIABLE     X'82'                  Y02076 00400802
*    IRB                     VARIABLE     X'12'                  Y02076 00401002
*    DEB EXTENSION           VARIABLE     X'20'                  Y02076 00401102
*    REGISTERS (FLOATING)      32         X'13'                  Y02076 00401202
*    TIOT                    VARIABLE     X'14'                  Y02076 00401302
*    DSAB RECORD (NON-LAST)    22         X'04'                  Y02076 00401402
*    DSAB RECORD (LAST)        22         X'44'                  Y02076 00401502
*    SPIE SSCR               VARIABLE    X'0102'                 Y02076 00401702
*                                                                       00401902
* ENTRY POINTS                                                          00402102
*                                                                       00402302
*    IGC0H06C -ENTERED FROM THE CHECKMAIN 2 ROUTINE                     00402502
*                                                                       00402702
* INPUT                                                                 00416600
*    GPR12- ADDRESS OF CHECKPOINT WORK AREA                             00426600
*                                                                       00428600
* OUTPUT                                                                00430600
*    GPR1-CONTAINS ADDRESS OF CHKWA                                     00432600
*                                                                       00433000
* EXTERNAL REFERENCES                                                   00433100
*    NONE                                                               00433200
*                                                                       00438800
* EXITS, NORMAL                                                         00440800
*    TO I/O RESUME TO INDICATE NORMAL COMPLETION OF                     00442800
*    THE CHECKMAIN FUNCTIONS                                            00443200
*                                                                       00443600
* EXITS, ERROR                                                          00444000
*    TO RESUME I/O ROUTINE (IGC0N06C) VIA XCTL TO                       00444102
*    PROVIDE ITS NORMAL FUNCTIONS AND TO PASS AN ERROR                  00444200
*    CODE TO THE CHECKPOINT EXIT ROUTINE INDICATING THAT                00444300
*    AN I/O ERROR HAS OCCURRED.                                         00458200
*    UPON EXIT THE PARAMETERS ARE AS FOLLOWS-                           00468200
*    GPR 1 - ADDRESS OF CHKWA                                           00470200
*    CHKWA - AN ERROR CODE OF X'0C' IS PASSED IN THE                    00470600
*             LAST BYTE OF THE CKRETCOD FIELD.                          00471000
*                                                                       00471400
*    2) TO RESUME I/O ROUTINE (IGC0N06C) VIA XCTL TO                    00471800
*    PROVIDE ITS NORMAL FUNCTIONS AND TO PASS AN ERROR                  00471900
*    CODE TO THE CHECKPOINT EXIT ROUTINE THAT AN                        00472000
*    UNRECOVERABLE EOV CONDITION (TWO RETRIES HAVE                      00472100
*    OCCURRED ON TAPE, OR THE DATA SET IS ON A DIRECT                   00476700
*    ACCESS DEVICE) HAS OCCURRED.                                       00478700
*    UPON EXIT THE PARAMETERS ARE THE SAME AS FOR CASE 1                00480700
*    EXCEPT THAT THE LAST BYTE OF THE CKRETCOD FIELD                    00481100
*    CONTAINS AN X'08'.                                                 00481200
*                                                                       00481300
*    3) TO CHECKPOINT HOUSEKEEPING ROUTINE (IGC0206C) TO                00481400
*    ATTEMPT REPROCESSING ON A NEW TAPE WHEN AN EOV                     00486000
*    HAS OCCURRED FOR THE FIRST TIME ON TAPE                            00488000
*                                                                       00490000
* TABLES/WORK AREAS                                                     00490400
*    CHKWA                                                              00490500
*                                                                       00490600
*    DCB   DCBDEBAD                                                     00490700
*    .     DCBSYNAD                                                     00512500
*    .     DCBMACRF                                                     00522500
*    .     DCBDSORG                                              Y02076 00522702
*                                                                       00532500
*    DEB   DEBDCBAD                                              Y02076 00534502
*    .     DEBNNEXT                                                     00541800
*    .     DEBAPPG                                                      00545800
*    .     DEBAPPAD                                              Y02076 00546002
*    .     DEBDEBAD                                              Y02076 00546202
*    .     DEBXSCL                                               Y02076 00546402
*    .     DEBFIEAD                                              Y02076 00546602
*    .     DEBFLGS1                                              Y02076 00546802
*    .     DEBIRBAD                                              Y02076 00547002
*    .     DEBLNGTH                                              Y02076 00547202
*    .     DEBXTNP                                               Y02076 00547402
*                                                                       00547800
*    DEBX  DEBXLNGH                                              Y02076 00548002
*                                                                       00548600
*    RB    RBIQE                                                        00549000
*    .     RBNEXAV                                                      00556300
*    .     RBREGSAVE                                             Y02076 00556502
*    .     RBSIZE                                                Y02076 00556702
*    .     RBSTAB2                                               Y02076 00556902
*                                                                       00558300
*    TCB   TCBUSER                                                      00560300
*    .     TCBTIO                                                       00562700
*    .     TCBDEB                                                       00563100
*    .     TCBFSA                                                       00563500
*    .     TCBOTC                                                       00570800
*    .     TCBRBP                                                       00572800
*    .     TCBJSCB                                               Y02076 00573202
*                                                                Y02076 00573402
*    JSCB  JSCDSABQ                                              Y02076 00573602
*                                                                Y02076 00573802
*    QDB   QDBFELMP                                              Y02076 00574002
*                                                                Y02076 00574202
*    DSAB  DSABDCBM                                              Y02076 00574402
*    .     DSABFCHN                                              Y02076 00574602
*    .     DSABFLG1                                              Y02076 00574702
*    .     DSABFLG2                                              Y02076 00574902
*    .     DSABFLG4                                              Y02076 00575002
*    .     DSABOPCT                                              Y02076 00575202
*    .     DSABORG                                               Y02076 00575302
*    .     DSABTCBP                                              Y02076 00575502
*    .     DSABTIOT                                              Y02076 00575602
*                                                                Y02076 00575802
*    TIOT  TIOEDDNM                                              Y02076 00575902
*                                                                       00576302
* ATTRIBUTES                                                            00576800
*    KEY 0, SUPERVISOR STATE, ENABLED.                                  00577200
*                                                                       00577600
* CHARACTER CODE DEPENDENCY                                             00578000
*    NONE                                                               00578100
*                                                                       00615000
* NOTES                                                                 00625000
*    APPLICABILITY-VS2-2                                                00635002
*    MODULE CHARACTERISTICS-WRITTEN TO A 4K DESIGN POINT                00645000
*    TYPE- LOAD, RESIDENCE- SYSTEM LINK PACK AREA                       00647000
*                                                                       00649000
* VS2/3 CHANGES/DELETIONS                                               00649437
*013044                                                         ZA03159 00649837
*008883-009137,009535,009692-009710,013044-013055              @ZA03659 00650237
*007856-007860                                                 @ZA03659 00650637
*C814002,820402                                                @ZA06111 00650837
*A00817013,00817023,01355503                                   @ZA06140 00650937
*A888604-888607                                                @ZA06667 00651037
*A00882503-00882504                                            @ZA08283 00651137
*C008827                                                       @ZA10272 00651237
*C00912803                                                     @ZA12190 00651337
*A00882704-00882705                                            @ZA11565 00651437
*C007980-007996,A007997-007998,A013003                         @ZA17960 00651537
*A008840-008845                                                @ZA27047 00651637
*A009713-009733,013006                                         @ZA28860 00652137
*A007260-007280                                                @ZA32921 00652237
*                                                                       00652637
         EJECT                                                          00653637
IGC0H06C CSECT                                                          00654637
*                                                                YM2776 00655637
         BALR  RB,E0               ESTABLISH BASE REGISTER              00656637
         USING *,RB                BASE REGISTER 11                     00662637
         USING CHKWA,RC            BASE FOR CHECKPOINT WORK AREA        00663637
         USING TCB,R4              BASE FOR TCB                         00664600
         USING IHADCB,R2           DCB                                  00674600
         CNOP  4,8                 ALIGN EYE-CATCHER TO DOUBLE WORD     00676602
         B     C10A1               BRANCH AROUND CSECT NAME CONSTANT    00676702
         DC    CL8'IGC0H06C'       CSECT NAME                           00676800
         DC    CL8'@ZA32921'       LAST CODE SHIP                       00676937
         DC    CL8'&SYSDATE'       LAST DATE SHIP                       00677937
C10A1    L     R2,CKDCBAD          CHKPT. DCB ADDRESS                   00678937
         LA    R7,C13B5            ADDRESS OF SYNAD ROUTINE             00681000
         STCM  R7,E7,DCBSYNAD+E1   STORE ADDRESS IN DCB                 00683000
         MVC   CKMN40(E8),CKMN40A  SET XCTL DEFAULT EXIT TO IGC0N06C    00685000
         MVI   CKLNT+E3,E4         INIT CKLNT TO 4                      00685100
         L     R4,CKTCBAD          GET JOB STEP TCB                     00695300
         DROP  R2                  DCB                                  00705300
         SPACE 2                                                        00709001
*                                                                       00710601
*        SAVE TCB FIELDS AND PREVIOUS CHECKPOINT DATA                   00712201
*        THE USER BLKSIZE WILL BE WRITTEN IN THE SUR                    00713801
*                                                                       00715401
*        THIS ROUTINE WILL CHECKPOINT VARIOUS TCB FIELDS                00717002
*        NECESSARY FOR RESTART.                                         00718602
         SPACE 2                                                        00720201
         LA    R3,TCBUSER          ADDRESS OF TCBUSER FIELD             00721801
         MVI   CKCODE,E15          CODE=X'0F'                           00723401
         BAL   RD,C13A1            LINK TO BUFFER HANDLER RTN           00725001
         L     R3,TCBEXT2          GET THE ADDRESS OF TCB XTN  @ZA32921 00726037
         LA    R3,20(R3)           POINT TO CICS AUTH AREA     @ZA32921 00727037
         BAL   RD,C13A1            PUT IT OUT                  @ZA32921 00728037
         LA    R3,TCBFSA           ADDR OF FIRST PP SAVE AREA           00731401
         BAL   RD,C13A1            LINK TO BUFFER H.R.                  00733001
         LA    R3,CKDCBAD          CHECKPOINT DCB ADDRS                 00744201
         BAL   RD,C13A1            LINK TO BUFFER H.R.                  00745801
         LA    R3,CKSYNAD          GET USER'S CHKPT SYNAD ADDRESS       00747400
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00757400
         LA    R3,CKDCBSI          GET ADDR OR USER'S BLKSIZE           00757500
         MVI   CKLNT+E3,E2         LENGTH OF FIELD                      00757600
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00757700
         L     R3,TCBRBP           GET ADDR OF CHKPT SVRB               00757800
         LA    R3,RBGRSAVE-RBSECT(R3) G.P. REGISTERS                    00757902
         MVI   CKCODE,E16          CODE=X'10'                           00759600
         MVI   CKLNT+E3,E64        LENGTH OF USER'S GPR'S               00761600
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00762000
         EJECT                                                          00762400
*        CHECKPOINTING THE P/P DEB'S AND IRB'S - THIS ROUTINE WILL      00762802
*        CHECKPOINT ALL NORMAL,DUMMY, AND ISAM DEB'S ASSOCIATED WITH    00762902
*        THE P/P TCB AS WELL AS ANY IRG'S ASSOCIATED WITH THE DEB'S.    00763000
*        SUR CODES ASSIGNED ARE ISAM DEB (X'81'), DUMMY DEB (X'82'),    00767000
*        NON-ISAM DEB (X'80'), IRB (X'12').                             00769000
         SPACE 3                                                        00769400
*                                                                       00769800
*        START OF DEB PROCESSING                                        00770200
*                                                                       00770600
         L     R8,TCBDEB           GET DEB ADDRESS FORM TCB             00770700
         USING DEBBASIC,R8         DEB                                  00770800
C12F1    LR    R3,R8               SAVE ADDRESS OF DEBBASIC             00770900
         S     R3,KDEBAVTL         GET ADDRESS OF DEB APPENDAGE TABLE   00774600
         SR    RF,RF               CLEAR WORKREG                        00776600
         IC    RF,DEBLNGTH-DEB(R3) GET LENGTH OF DEB IN DBLE WORDS      00777000
         SLL   RF,E3               GET LENGTH IN BYTES                  00777400
         LR    R0,RF               GET DEB LENGTH                YM7807 00778802
         ICM   R0,M8,SP253         INSERT SUBPOOL NUMBER         YM7807 00779202
         ST    R0,CKERAS04         SAVE R0 FOR FREEMAIN          YM7807 00779602
         GETMAIN R,LV=(0)          GET CORE FOR DEB WORK SPACE   YM7807 00780002
         LH    RF,CKERAS04+E2      RESTORE DEB LENGTH            YM7837 00781602
         ST    R1,CKERAS05         SAVE R1 FOR FREEMAIN          YM7807 00785202
         LA    R7,DEBAVTLN(R1)          CALC DEBBASIC WA ADR   @ZA03659 00785637
         ST    R7,CKERAS07              SAVE FOR PURGE/RESTORE @ZA03659 00786037
         ST    R3,CKERAS06         SAVE DEB ADDRESS              YM7807 00786802
         LR    R7,R8               GET DEB ADDR FOR CALC         YM5720 00788402
         LA    R9,DEBPRFLN         GET LENGTH OF PREFIX          YM5720 00790002
         SR    R7,R9               POINT TO DEB PREFIX           YM5720 00791602
         USING DEBPREFX,R7         ADDRESS DEB PREFIX            YM5720 00793202
         L     R9,DEBXTNP          GET DEB EXTENSION ADDR        YM5720 00794802
         USING DEBXTN,R9           ADDRESS DEB EXTENSION         YM5720 00796402
         CLC   DEBDEVED(2),ABLEV   IS THIS A SAM DUMMY DEB     @ZA17960 00798037
         BE    DUMMY               BRANCH AHEAD IF YES         @ZA17960 00798637
         CLI   DEBEXSCL,X'00'      POSSIBLE SUBSYSTEM DEB      @ZA17960 00799237
         BNE   C12F2               BRANCH IF NOT               @ZA17960 00799837
DUMMY    EQU   *                                               @ZA17960 00800437
         LA    R3,DEBPREFX-DEB(R3) POINT TO BEGINNING OF DUMMY DEB      00801202
         MVI   CKCODE,E130         CODE= X'82' FOR DUMMY DEB            00802802
         L     R7,DEBXDSAB         FETCH DSAB ADDRESS            YM5720 00804402
         USING DSAB,R7             ADDRESS DSAB                  YM5720 00806002
         L     R7,DSABTIOT         FETCH TIOT ENTRY ADDRESS      YM5720 00807602
         USING TIOENTRY,R7         ADDRESS TIOT ENTRY            YM5720 00809202
         TM    TIOELINK,TIOESSDS   SUBSYSTEM DATA SET            YM5720 00810802
         DROP  R7                  TIOT ENTRY ADDRESSABILITY     YM5720 00812402
         BZ    C12F41              IF NOT, BRANCH              @ZA06111 00814037
         LA    R3,E8(,R3)          ADJUST SUBSYSTEM DEB PREFIX   YM5720 00815037
*                                  ADDRESS (PREFIX=8 BYTES)      YM5720 00816037
         MVI   CKCODE,EX83         CODE X'83' = SUBSYSTEM DEB    YM5720 00817037
         LA    R7,DEBPRLSS(R1)     LOAD SUBSYSTEM PREFIX       @ZA06140 00817337
         ST    R7,CKERAS07         SAVE FOR PURGE RESTORE      @ZA06140 00817637
         B     C12F41              BR TO PUT DEB IN BUFFER     @ZA06111 00818037
C12F2    EQU   *                                                 Y02049 00822002
         TM    DEBXDSO1,DCBDSGIS   IS THIS AN ISAM DATA SET      Y02049 00823602
         BZ    C12F4               NO - BRANCH                          00825202
         TM    DEBXMCF1,DCBMRECP   IS THIS VALID ISAM DCB        Y02049 00826802
         BNZ   C12F4               NO, IT IS AN EXCP DCB. BR.           00828402
         DROP  R9                                                Y02049 00830002
         LA    R7,DEBAPPAD         GET PTR TO ISAM EXTENT PTRS          00831602
         LA    R9,CMSYSA+E2        GET PTR TO TEMP SAVE AREA            00833202
         LA    R6,E4               LOOP COUNT=4                         00834802
C12F3    LA    R7,E4(R7)           POINT TO NEXT (FIRST) ONE            00836400
         LA    R9,E2(R9)           BUMP TEMP SAVE AREA PTR              00846402
         L     R2,E0(R7)           GET FIRST PTR                        00846800
         LA    R2,E0(R2)           ZERO HI BYTE                         00847200
         LTR   R2,R2               PTR IS ZERO                          00847300
         BZ    C12F7               YES BRANCH                           00847400
         SR    R2,R8               GET RELATIVE TRACK OFFSET            00857600
C12F7    STH   R2,E0(R9)           SAVE RELATIVE OFFSET IN CHKWA        00867702
         BCT   R6,C12F3            DECREMENT COUNT                      00871100
         MVI   CKCODE,E129         CODE=X'81' FOR ISAM DEB              00873100
         B     C12F41              CONTINUE PROCESSING           YM7807 00873502
C12F4    MVI   CKCODE,E128         CODE=X'80' FOR NON ISAM DEB          00874302
*                                                                       00874402
*        SINCE THE TIOT IS A SERIALLY REUSABLE RESOURCE, THE     YM7807 00875102
*        ORDER OF THE UCB ENTRIES FOR ANY DD ENTRY CANNOT BE     YM7807 00877102
*        EXPECTED TO REFLECT THE STATUS OF ANY PARTICULAR DCB    YM7807 00877302
*        OR DEB.  THEREFORE, WHEN THE DEB'S ARE WRITTEN TO THE   YM7807 00877702
*        CHECKPOINT DATA SET, THE UCB ADDRESSES WILL BE REPLACED YM7807 00877802
*        BY VOLUME SERIAL NUMBERS IN THE FOLLOWING MANNER:       YM7807 00878202
*                                                                       00878702
*      0 +++++++++++                                             YM7807 00878802
*        + VOL SER +      VOL SER NO.= VOLUME SERIAL NUMBER      YM7807 00878902
*      4 +++++++++++                                             YM7807 00879102
*        + NO.+ CC +      CCHH = EXTENT INFORMATION IN DEB       YM7807 00879502
*      8 +++++++++++                                             YM7807 00879602
*        + *H + CC +      * = SAVE AREA FOR OVERLAYED FILE MASK  YM7807 00879702
*     12 +++++++++++                                             YM7807 00879802
*        + HH + TT +      TT = NUMBER OF TRACKS IN EXTENT        YM7807 00879902
*     16 +++++++++++                                             YM7807 00880002
*                                                                       00880102
*        THE RESTART MOUNT VERIFICATION PROCESSOR (IGC0M05B)     YM7807 00880202
*        WILL RESTORE THE DEB EXTENTS AT RESTART TIME.           YM7807 00880602
*                                                                       00881002
C12F41   EQU   *                                                 YM7807 00881702
         STM   R4,R7,CKERAS00      SAVE MOVE-LONG REGS           YM7807 00881802
         L     R4,CKERAS05         LOAD TO-ADDRESS               YM7807 00881902
         LR    R6,R3               LOAD FROM-ADDRESS             YM7807 00882002
         LR    R5,RF               LOAD TO-LENGTH                YM7807 00882102
         LR    R7,RF               LOAD FROM-LENGTH              YM7807 00882202
         MVCL  R4,R6               MOVE DEB TO GOTTEN AREA       YM7807 00882302
         L     R3,CKERAS05         GET NEW DEB POINTER           YM7807 00882402
         LM    R4,R7,CKERAS00      RESTORE MOVE-LONG REGS        YM7807 00882502
         CLI   CKCODE,E130         IS THIS A DUMMY DEB         @ZA08283 00882637
         BE    C12F5               YES BYPASS NEXT TESTS       @ZA10272 00882737
         CLI   CKCODE,EX83         IS THIS A SUBSYSTEM DEB     @ZA11565 00882837
         BE    C12F5               YES BYPASS NEXT TESTS       @ZA11565 00882937
         CLC   DEBAPPB-DEB(E3,R3),CKERAS06+E1  DOES APP VECTOR   YM7807 00883037
*                                  TABL PTR POINT TO DEBAVT?     YM7807 00883137
         BNE   C12F42              NO, GET VOL SER NUMBER        YM7807 00883237
         XC    DEBAPPB-DEB(E3,R3),DEBAPPB-DEB(R3) ZERO OUT AVT   YM7807 00883337
*                                  POINTER IN DEB                YM7807 00883437
C12F42   EQU   *                                                 YM7807 00883537
         CLI   DEBEXSCL-DEB(R3),E4 IS THIS A DA DEB?             YM7807 00883637
         BNE   C12F5               NO, BYPASS DA PROCESSING      YM7807 00883737
         CLI   DEBAMTYP-DEB(R3),E1 IS THIS A VSAM DEB?           YM7837 00883837
         BE    C12F5               YES, BYPASS PROCESSING        YM7837 00883937
         CLI   CKCODE,E129         IS THIS AN ISAM DEB?        @ZA27047 00884037
         BNE   NOTISAM             NO,BYPASS NEXT TEST         @ZA27047 00884137
         TM    DEBFLGS1-DEB(R3),DEBCINDI IS THIS AN ISAM (CI)  @ZA27047 00884237
*                                  COMPATABILITY INTERFACE DEB @ZA27047 00884337
         BO    C12F5               YES, BYPASS DA PROCESSING   @ZA27047 00884437
NOTISAM  EQU   *                                               @ZA27047 00884537
         STM   R4,R6,CKERAS00      SAVE REGISTERS                YM7807 00884637
         SR    R4,R4               CLEAR COUNT REGISTER          YM7807 00884737
         IC    R4,DEBNMEXT-DEB(R3) INSERT NO. OF EXTENTS         YM7807 00884837
         LA    R5,DEBBASND-DEB(R3) POINT TO DASD SECTION OF DEB  YM7807 00884937
         USING DEBDASD,R5          DA EXTENT SECTION OF DEB      YM7807 00885037
         USING UCBOB,R6            UCB ADDRESSABILITY            YM7807 00885137
         CLI   CKCODE,E129         IS THIS AN ISAM DEB?          YM7807 00885237
         BE    C12F44              YES, BYPASS FIRST(PHONY) XTNT YM7807 00885337
C12F43   EQU   *                                                 YM7807 00885437
         L     R6,DEBUCBAD         POINT TO UCB                  YM7807 00885537
         STCM  R6,M8,DEBSTRHH      DEBDVMOD TO FIRST BYTE OF     YM7807 00885637
*                                  STARTING HH (TEMP. HOLD AREA) YM7807 00885737
         MVC   DEBUCBAD(E6),UCBVOLI MOVE VOL SER TO DEB EXTENT   YM7807 00885837
C12F44   EQU   *                                                 YM7807 00886002
         LA    R5,E16(,R5)         POINT TO NEXT EXTENT          YM7807 00886402
         BCT   R4,C12F43           BRANCH IF MORE EXTENTS        YM7807 00886802
         LM    R4,R6,CKERAS00      RESTORE REGISTERS             YM7807 00887202
         DROP  R5,R6                                             YM7807 00887302
*                                                                       00887437
*    IF A PURGE LIST (PIRL) IS TO BE SAVED - ADDR OF PIRL (DEBUSRPG)    00887537
*    IS SAVED IN CKERAS09 FOR USE WHEN STORING PIRL (X'21') IN          00887637
*    SUR BUFFER.  THEN THE LENGTH OF THE PIRL IS STORED IN THE          00887737
*    DEBUSRPG FIELD (BEFORE DEB GOES TO SUR BUFFER) SO THAT IT          00887937
*    IS AVAILABLE AT RESTART TIME.                             @ZA03659 00888337
*                                                                       00888437
C12F5    ST    RF,CKLNT            PLACE DEB LENGTH IN CKLNT            00888637
         XC    CKERAS08(E8),CKERAS08 ZERO ERAS08,09 FOR PIRO   @ZA03659 00888737
         CLI   CKCODE,E130         IS THIS A DUMMY DEB         @ZA06667 00889137
         BE    C12F5A              YES NO PIRL ACTIVITY        @ZA06667 00889637
         CLI   CKCODE,EX83         IS THIS A SUBSYSTEM DEB     @ZA06667 00890537
         BE    C12F5A              YUP BYPASS PIRL ACTIVITY    @ZA06667 00891437
         DROP  R8                                              @ZA03659 00893237
         L     RD,CKERAS07              GET DEB WORK AREA ADR  @ZA03659 00894137
         USING DEBBASIC,RD                                     @ZA03659 00895037
         CLC   DEBUSRPG+E1(E3),PURG00   WAS I/O PURGED         @ZA03659 00895937
         BE    C12F5A                   BR IF NO               @ZA03659 00896837
         CLC   DEBUSRPG+E1(E3),PURGFF   IS I/O TO BE RESTORED  @ZA03659 00897737
         BE    C12F5A                   BR IF NO               @ZA03659 00898937
         MVC   CKERAS09+E1(E3),DEBUSRPG+E1 SAVE PIRL LIST ADR  @ZA03659 00908937
         L     RF,CVTPTR                ADR CVT-GET IOCOM ADR  @ZA03659 00910937
         USING CVTMAP,RF                  FOR GETTING PIRL LNG @ZA03659 00911737
         L     RF,CVTIXAVL              PTR TO IOS COM AREA    @ZA03659 00912537
         LH    RF,X00(RF)               GET NO. I/O DRIVERS    @ZA03659 00912637
         SLL   RF,E3                    MULT BY 8              @ZA03659 00912737
         LA    RF,X'10'(RF)             ADD 16 FOR HEADER      @ZA12190 00912837
         STH   RF,DEBUSRPG+E2           SAVE LNGTH FOR RESTART @ZA03659 00912937
         STH   RF,CKERAS08              ALSO IN CKERAS08       @ZA03659 00913337
         DROP  RD                                              @ZA03659 00913437
         USING DEBBASIC,R8                                     @ZA03659 00913537
C12F5A   EQU   *                        GO PUT DEB IN SUR BUFR @ZA03659 00913737
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00914337
         LM    R0,R1,CKERAS04      LOAD FREEMAIN REGISTERS       YM7807 00914737
         FREEMAIN R,LV=(0),A=(1)   FREE DEB WORK AREA            YM7807 00915137
         CLI   CKCODE,E130         IS IT DUMMY DEB               Y02076 00916337
         BE    C12F10              YES-BYPASS IRB PROC.          Y02076 00917537
         CLI   CKCODE,EX83         SUBSYSTEM DEB                 YM5720 00918737
         BE    C12F10              YES-BYPASS IRB PROC           YM5720 00919937
         LR    R6,R8               ADR OF DEB BASIC              YM7573 00921137
         LA    R9,DEBPRFLN         GET LENGTH OF PREFIX          YM7573 00922337
         SR    R6,R9               POINT TO DEB PREFIX           YM7573 00923537
         USING DEBPREFX,R6         ADDRESS DEB PREFIX            YM7573 00924737
         CLI   DEBAMTYP,TCAMAP     TCAM WITH KEY 6 IRB           YM7573 00925937
         BE    C12F10              YES, NO IRB SAVE REQ          YM7573 00927137
         DROP  R6                                                YM7573 00928337
         L     R7,DEBIRBAD         DEB'S IRB ADDRESS                    00929537
*                                                                       00930737
*        START OF IRB PROCESSING                                        00931937
*                                                                       00933137
         LA    R7,E0(R7)           CLEAR HI BYTE                        00934337
         LTR   R7,R7               IRB ADDRESS=0                        00935537
         BZ    C12F10              NO - BRANCH                          00936737
         USING RBSECT,R7           RB                                   00937937
         LR    R3,R7               SET R3=IRB ADDRESS                   00939137
         SR    R6,R6               CLEAR WORK REG                       00940337
         LH    R6,RBSIZE           LOAD SIZE OF RB                      00941537
         SLL   R6,E3               GET LENGTH IN BYTES                  00942737
         S     R3,KRBPRFXL         ADDRESS OF IRB PREFIX                00943937
         MVI   CKCODE,E18          CODE=X'12'                           00945137
         ST    R6,CKLNT            PLACE IRB LENGTH IN CKLNT            00946337
         BAL   RD,C13A1            LINK TO BUFFER HDLR RTN              00947537
*                                                                Y02076 00948737
*        ROUTINE TO SAVE DEB EXTENSIONS                          Y02076 00949937
*                                                                Y02076 00951137
C12F10   TM    DEBFLGS1,DEBXTNIN   DEB EXTENSION PRESENT         Y02076 00952337
         BZ    C12F12A             IF NOT, BR                  @ZA03659 00953537
         LA    R3,DEBBASIC-DEBPREFX GET ADDR                     Y02076 00954737
         LNR   R3,R3               OF                            Y02076 00955937
         AR    R3,R8               DEB PREFIX                    Y02076 00957137
         USING DEBPREFX,R3         ADDR DEB PREFIX               Y02076 00958337
         L     R3,DEBXTNP          GET DEB EXTENSION ADDR        Y02076 00959537
         USING DEBXTN,R3           ADDR DEB EXTENSION            Y02076 00960737
         LH    R7,DEBXLNGH         GET LENGTH OF DEB EXT         Y02076 00961937
         ST    R7,CKLNT            STORE IN WORKAREA             Y02076 00963137
         MVI   CKCODE,X20          SET DEB EXTENSION CODE        Y02076 00964337
         BAL   RD,C13A1            LINK TO BUFFER HANDLER        Y02076 00965537
         DROP  R3                  DROP DEB EXTENSION            Y02076 00966737
*                                                                       00967837
*    IF PIRL (RESTORE I/O LIST) IS TO BE CHECKPOINTED - ADDRESS         00968437
*    OF PIRL WOULD HAVE BEEN SAVED (FROM DEBUSRPG) IN CKERAS09          00968837
*    BEFORE DEB WAS CHECKPOINTED                               @ZA03659 00969237
*                                                                       00969337
C12F12A  EQU   *                        PROCESS PIRL           @ZA03659 00969437
         L     R3,CKERAS09              GET @ PIRL IF ONE      @ZA03659 00969537
         LTR   R3,R3                    DOES ONE EXIST         @ZA03659 00969837
         BZ    C12F12                   BR IF NOT              @ZA03659 00969937
         MVI   CKCODE,X21               SET PIRL ID CODE       @ZA03659 00970037
         LH    RF,CKERAS08              GET LNGTH OF PIRL      @ZA03659 00970137
         ST    RF,CKLNT                 LNGTH FOR BUFF HNDLER  @ZA03659 00970537
         BAL   RD,C13A1                 LINK TO BUFR HNDLR     @ZA03659 00971037
EPCB     EQU   *                                               @ZA28860 00971337
* WE WILL CHECKPOINT EPCBS OFF OF THE PIRL HERE.               @ZA28860 00971437
* THE FIRST EPCB WILL HAVE A CODE OF X'22' AND                 @ZA28860 00971537
* ALL SUBSEQUENT EPCBS WILL HAVE CODE X'23'                    @ZA28860 00971637
*                                                              @ZA28860 00971737
         L     R3,24(R3)           GET THE FIRST EPCB          @ZA28860 00971837
         LA    R3,0(R3)            CLEAR THE HIGH ORDER BYTE   @ZA28860 00971937
         LTR   R3,R3               ARE THERE ANY EPCBS ???     @ZA28860 00972037
         BZ    C12F12              NO BRANCH                   @ZA28860 00972137
         MVI   CKCODE,X'22'        SET CODE FOR FIRST EPCB     @ZA28860 00972237
EPCBN    EQU   *                                               @ZA28860 00972337
         L     R7,0(R3)            GET NEXT EPCB LINK POINTER  @ZA28860 00972437
         LH    RF,EPCBLEN          SET EPCP LENGTH             @ZA28860 00972537
         ST    RF,CKLNT            SAVE THE LENGTH             @ZA28860 00972637
         BAL   RD,C13A1            WRITE OUT EPCB              @ZA28860 00972737
         LA    R3,0(R7)            SET UP NEXT EPCB            @ZA28860 00972837
         LTR   R3,R3               ANY MORE EPCBS ?????        @ZA28860 00972937
         BZ    C12F12              NO BRANCH                   @ZA28860 00973037
         MVI   CKCODE,X'23'        SET UP CODE FOR EPCB + N    @ZA28860 00973137
         B     EPCBN               BRANCH TO PROCESS           @ZA28860 00973237
*                                                              @ZA28860 00973337
C12F12   L     R8,DEBDEBAD         GET NEXT DEB                         00973437
         LA    R8,E0(R8)           CLEAR HI BYTE                        00973537
         LTR   R8,R8               IS THERE ANOTHER DEB                 00973637
         BP    C12F1               YES LOOP TO PROCESS IT               00973737
         DROP  R7,R8               RB,DEB                               00973837
*                                                                       00975037
*        ROUTINE TO SAVE FLOATING POINT REGISTERS                       00975137
*                                                                       00976337
C12K1    STD   R0,FLTPTSAV         STORE                                00977537
         STD   R2,FLTPTSAV+E8      FLOATING                             00978737
         STD   R4,FLTPTSAV+E16     POINT                                00979937
         STD   R6,FLTPTSAV+E24     REGISTERS                            00981137
         LA    R3,FLTPTSAV         GET ADDR OF FLT. PT. REGS            00982337
         MVI   CKCODE,E19          CODE=X'13'                           00983537
         MVI   CKLNT+E3,E32        LENGTH                               00984737
         BAL   RD,C13A1            LINK TO BUFFER HANDLER               00985937
*                                                                       00987137
*        SAVE THE TIOT                                           Y02076 00988337
*                                                                       00989537
         L     R3,TCBTIO           GET ADDR OF TIOT FROM TCBTIO         00990737
         MVI   CKCODE,E20          CODE=X'14'                           00991937
         MVC   CKLNT(E4),CKTIOLN   LENGTH OF TIOT                       00993137
         BAL   RD,C13A1            LINK TO BUFFER HANDLER               00994602
*                                                                Y02076 00996302
*        SAVE SELECTIVE DSAB INFORMATION                         Y02076 00996737
*                                                                Y02076 00997937
C12L1    LA    R3,SURL(,RC)        ADDR CORE TO BUILD            Y02076 00999137
         A     R3,CKBFOFST         DSAB RECORDS                  Y02076 01000337
         L     R8,TCBJSCB          GET JSCB ADDR                 Y02076 01001537
         USING IEZJSCB,R8          ADDR JSCB                     Y02076 01002737
         L     R8,JSCDSABQ         GET ADDR OF DSAB QDB          Y02076 01003937
         USING QDB,R8              ADDR QDB                      Y02076 01005137
         L     R8,QDBFELMP         GET ADDR OF 1ST DSAB          Y02076 01006337
         USING DSAB,R8             ADDR DSAB                     Y02076 01007537
         USING XDSAB,R3            ADDR DSAB INFO                Y02076 01008737
C12L2    MVC   XDSAOPCT,DSABOPCT   SAVE OPEN COUNT               Y02076 01009937
         MVC   XDSABORG,DSABORG    SAVE DSORG                    Y02076 01011137
         MVC   XDSAFLG1(L'DSABFLG1+L'DSABFLG2),DSABFLG1 SAVE     Y02076 01012337
*                                  FLAGS 1 AND 2                 Y02076 01013537
         MVC   XDSAFLG4,DSABFLG4   SAVE ONLY CKDS AND CKSI OF    Y02076 01014737
         NI    XDSAFLG4,DSABCKDS+DSABCKSI FLAG 4                 Y02076 01015937
         MVC   XDSADCBM,DSABDCBM   SAVE DCB MODIFICATION MASK    Y02076 01017137
         MVI   XDSAFLGS,X00        INIT DSAB PROCESS FLAGS       Y02076 01018337
         OC    DSABTCBP,DSABTCBP   IS TCB ADDR PRESENT           Y02076 01019537
         BZ    C12L4               IF NOT, BR                    Y02076 01020737
         OI    XDSAFLGS,XDSATCBP   SET TCB ADDR INDICATOR        Y02076 01021937
C12L4    L     R2,DSABTIOT         GET DD ENTRY ADDR             Y02076 01023137
         USING TIOENTRY,R2         ADDR DD ENTRY                 Y02076 01024337
         CLI   TIOEDDNM,BLANK      BLANK DD NAME                 Y02076 01025537
         BE    C12L6               IF BLANK, BR                  Y02076 01026737
         MVC   XDSADDNM,TIOEDDNM   SAVE DD NAME                  Y02076 01027937
         B     C12L8               SKIP BLANK DD PROCESSING      Y02076 01029137
         DROP  R2                  DROP TIOT ENTRY               Y02076 01030337
C12L6    OI    XDSAFLGS,XDSACCAT   SET CONCATENATION INDICATOR   Y02076 01031537
C12L8    MVI   CKCODE,X04          SET DSAB BLK ID               Y02076 01032737
*********************************************************************** 01033937
*    IF DATA SET IS AN IMPLIED VSAM PRIVATE CATALOG - DDNAME CANNOT     01035137
*    BE GUARANTEED TO BE THE SAME BETWEEN CHECKPOINT AND RESTART -      01036337
*    THEREFORE SET CODE X'24' FOR THOSE TYPES OF DATA SETS      ZA00103 01037537
*********************************************************************** 01038737
         TM    DSABFLG3,DSABCATL   IS IT A CATL DATA SET        ZA00103 01039937
         BZ    C12L9               BRANCH IF NOT                ZA00103 01041137
         CLC   XDSADDNM(E4),PRIVCATL  IS DDNAME GENERATED       ZA00103 01042337
         BNE   C12L9               BRANCH IF NOT                ZA00103 01043537
         OI    CKCODE,X24          SET X'24' DSAB BLK CODE      ZA00103 01044737
C12L9    ICM   R8,E15,DSABFCHN     FETCH/TEST NEXT DSAB ADDR    ZA00103 01045937
         BNZ   C12L10              BR IF NOT LAST                Y02076 01047137
         OI    CKCODE,X44          SET LAST BSAB BLK INDICATOR  ZA00103 01048337
C12L10   LA    R2,XDSABSIZ         SET DSAB BLK SIZE             Y02076 01049537
         ST    R2,CKLNT            FOR BUFFER HANDLER            Y02076 01050737
         BAL   RD,C13A1            CALL BUFFER HANDLER           Y02076 01051937
         LTR   R8,R8               TEST NEXT DSAB ADDR           Y02076 01053137
         BNZ   C12L2               IF ANOTHER, GO PROCESS        Y02076 01054337
         DROP  R3,R8               XDSAB AND DSAB                Y02076 01055537
*                                                                Y02076 01056737
*        FLUSH SUR BUFFER BEFORE SAVING SPIE DATA                Y02076 01057937
*                                                                Y02076 01059137
C12M1    CLC   CMBUF(E4),CKBFSTAD  ANY DATA LEFT IN BUFFER       Y02076 01060337
         BE    C12D2               NO- BRANCH                    YM6584 01061537
         L     RA,CKBFSTAD         LOAD NEXT BYTE IN BUFFER      Y02076 01062737
         LA    RD,CKREGSAV         GET ADDR OF REG SAVE AREA     Y02076 01063937
         BAL   R7,C13B2A           WRITE OUT REMAINING DATA      Y02076 01065137
*                                                                Y02076 01066337
*        INTERFACE WITH SUPERVISOR FOR SPIE DATA                 Y02076 01067537
*                                                                Y02076 01068737
C12D2    EQU   *                   FLUSH BYPASS ENTRY            YM6584 01069937
         L     RF,CVTPTR           GET CVT ADDR                  Y02076 01071137
         USING CVTMAP,RF           CVT                           Y02076 01072337
         L     RF,CVTCSPIE         ADDR OF SPIE CHKPT RTN        Y02076 01073537
         DROP  RF                  CVT                           Y02076 01074737
         LR    R1,RC               GET ADDR OF                   Y02076 01075937
         A     R1,CKBFOFST         4K SUR AREA FOR SPIE          Y02076 01077137
         USING SSCR,R1             SSCR                          Y02076 01078337
         MVC   SSCRID(N4),CKSSCRID INIT SSCR HDR                 Y02076 01079537
         XC    SSCRFCHN(SSCRDCBA-SSCRFCHN),SSCRFCHN              Y02076 01080737
         OI    SSCRFLG1,SSCRCKRS   SET CHKPT INDICATOR           Y02076 01081937
         LA    RD,CKREGSAV         SAVE AREA ADDRESS             Y02076 01083137
         BALR  RE,RF               GO TO SPIE CHKPT RTN          Y02076 01084337
         SR    R2,R2               CLEAR REG                     Y02076 01085537
         ICM   R2,M3,SSCRDATL      GET & TEST DATA LENGTH        Y02076 01086737
         BZ    C12D4               IF NO DATA, EXIT              Y02076 01087937
         AH    R2,SSCRHDRL         GET TOTAL RECORD LENGTH       Y02076 01089137
         STH   R2,CKLNGTH1         STORE LENGTH IN DECB          Y02076 01090337
         BAL   R7,C13B2A           WRITE OUT SSCR                Y02076 01091537
*                                                                       01092737
*        XCTL  FOR ALL EXITS                                            01093937
*                                                                       01095137
C12D4    LR    R1,RC               LOAD R1 WITH CHKPT W.A. ADDRESS      01096337
         LA    RF,CKMN40           LOAD ADDR OF NEXT LOAD               01097537
         ST    RF,CK40XCTL         ST IN WORKAREA                       01098737
         LA    RF,CK40XCTL         ADDR OF WORKAREA FIELD               01099937
         XCTL  SF=(E,(15))         XCTL TO NEXT LOAD                    01101137
         EJECT                                                          01102337
*                                                                       01103537
*        ROUTINE TO HANDLE OUTPUT BUFFER                                01104737
*                                                                       01105937
* THIS ROUTINE WILL MOVE DATA FROM AN ADDRESSED AREA TO THE NEXT        01107137
* AVAILABLE BLOCK IN THE SUR BUFFER. IF THERE IS NO ROOM IN THE         01108337
* BUFFER,THE BUFFER WILL BE WRITTEN OUT, AND THE BLOCK MOVED TO         01109537
* THE NOW FREE BUFFER.                                                  01110737
*                                                                       01111937
* REGISTER INPUT-                                                       01113137
*                                                                       01114337
*        R3    ADDRESS OF BLOCK TO BE MOVED                             01115537
*        RD    RETURN ADDRESS                                           01116737
*                                                                       01117937
C13A1    STM   R2,RD,CKOBHSAV      SAVE REGISTERS IN CHKWA              01119137
         LA    RD,CKREGSAV         GET ADDR OF SAVE AREA FOR            01120337
*                                  WRITE/CHECK IN GPR 13                01121537
         LR    R8,R3               SAVE ADDRESS OF BLOCK                01122737
         L     RA,CKBFSTAD         NEXT BYTE IN BUFFER TO BE FILLED     01123937
         L     R3,CKLNT            GET LENGTH OF BLOCK                  01125137
         L     R4,CKBFLWA          GET REMAINING BYTES IN BUFFER        01126337
         LA    R3,E1(R3)           ALLOW FOR CODE BYTE                  01127537
         CR    R3,R4               ENOUGH BYTES LEFT FOR BLOCK          01128737
         BL    C13C2               YES-BRANCH                           01129937
         C     RA,CMBUF            IS BUFFER PTR ALREADY AT START       01131137
         BE    C13C2               YES - BRAN                           01132337
         BAL   R7,C13B2            NO,WRITE OUT BUFFER.                 01133537
C13C2    MVC   E0(E1,RA),CKCODE    MOVE IN CODE BYTE                    01134737
         LA    RA,E1(RA)           INCREMENT BUFFER POINTER             01135937
         BCTR  R3,E0               DECREMENT BUFFER LENGTH              01137137
         BCTR  R4,E0               DECREMENT AMT BYTES LEFT IN BUFFER   01138337
C13C3    LTR   R3,R3               ANY MORE BYTES IN BLOCK              01139537
         BZ    C13E3               NO - BRANCH                          01140737
         CR    R3,R4               Q. ARE THERE MORE BYTES LEFT IN      01141937
*                                  THE BLOCK THAN IN THE BUFFER         01143137
         BNH   C13F1               A. NO USE BLOCK AS COUNTER           01144337
         LR    R2,R4               A. YES USE BUFFER AS COUNTER         01145537
         B     C13E1               MOVE SUR INTO BUFFER                 01146737
C13F1    LR    R2,R3               USE BLOCK LENGTH AS COUNTER          01147937
*                                                                       01149137
*        MOVE BLOCK INTO BUFFER                                         01150337
*        SPECIAL HANDLING FOR DEB'S AND IRB'S                           01151537
*        LINK TO C13B2A TO WRITE OUT BUFFER                             01152737
*        BRANCH TO C13C3 TO PROCESS REST OF BLOCK                       01153937
*                                                                       01155137
         USING DEBBASIC,R7         DEB                                  01156337
         USING RBSECT,R8           RB                                   01157537
C13E1    STM   R4,R7,CKERAS00      SAVE MOVE-LONG REGS           YM7357 01158737
         LR    R4,RA               GET TO-ADDRESS                YM7357 01159937
         LR    R6,R8               GET FROM-ADDRESS              YM7357 01161137
         LR    R5,R2               GET TO-LENGTH                 YM7357 01162337
         LR    R7,R2               GET FROM-LENGTH               YM7357 01163537
         MVCL  R4,R6               DATA TO SUR                   YM7357 01164737
         LM    R4,R7,CKERAS00      RESTORE MOVE-LONG REGS        YM7357 01166102
C13E2    TM    CKCODE,EX80         IS THIS A DEB                        01167702
         BZ    C13E4               NO CHECK FOR IRB                     01169302
         CLI   CKCODE,E130         IS THIS A DUMMY DEB                  01170902
         BE    C13E5               BRANCH IF YES                        01172502
         CLI   CKCODE,EX83         IS THIS A SUBSYSTEM DEB       YM5720 01174102
         BE    C13E5               BRANCH IF YES                 YM5720 01175702
CKDEBAD1 CLI   CKCODE,E129         ISAM DEB                             01177302
         MVI   CKCODE,EX7F         INSURE ONLY ONCE THRU                01177400
         BNE   C13E5               BRANCH IF NO                         01178400
         LA    RE,DEBFIEAD-DEB(RA) ADDR OF ISAM PTRS                    01180400
         MVC   E2(E2,RE),CMSYSA+E4  MOVE                                01180500
         MVC   E6(E2,RE),CMSYSA+E6  POSITIONAL                          01183700
         MVC   E10(E2,RE),CMSYSA+E8 POINTERS                            01185700
         MVC   E14(E2,RE),CMSYSA+E10 TO DEB                             01186102
         B     C13E5               CONTINUE BUFFER HDLR                 01187700
C13E4    CLI   CKCODE,EX12         IS THIS AN IRB                       01190102
         BNE   C13E5               NO CONTINUE BUFFER HANDLING          01190200
         MVI   CKCODE,EX7F         INSURE ONLY ONCE THROUGH             01192600
         L     R8,CKOBHSAV+E20     ADDR OF IRB BASIC SECTION            01194600
         TM    RBSTAB2,EX0C        ANY IQE'S                            01196600
         BC    E12,C13E5           NO-SKIP NEXT CODE                    01197000
         L     RE,RBNEXAV          COMPUTE OFFSET TO NEXT AVAILABLE IQE 01197400
         SR    RE,R8               GET OFFSET                           01197500
         STCM  RE,E15,RBNEXAV+RBPRFLNA-RBSECT(RA) PUT OFFSET IN IRB     01201202
*                                  IN BUFFER                            01203202
         L     RE,RBIQE            COMPUTE OFFSET                       01203600
         SR    RE,R8               TO LIST ORIGIN OF IQE'S              01204002
         STCM  RE,E7,RBIQE1+RBPRFLNA-RBSECT(RA) STORE IN IRB            01204402
C13E5    AR    RA,R2               INCREMENT BUFFER PTR          YM7357 01205002
         SR    R3,R2               GET REMAINING BYTES IN BLOCK         01210000
         SR    R4,R2               GET REMAINING BYTES IN BUFFER        01212000
         AR    R8,R2               INCREMENT ADDRS OF BLOCK             01214000
         LTR   R4,R4               ANY MORE BYTES IN BUFFER             01214400
         BH    C13C3               YES- CHECK BLOCK LENGTH              01214800
         BAL   R7,C13B2A           NO - WRITE OUT BUFFER                01214900
         B     C13C3               PUT REMAINDER OF BLOCK THROUGH LOOP  01220300
C13E3    LA    R3,E4               RESET LENGTH TO FOUR                 01224302
         ST    R3,CKLNT            STORE IN W.A.                        01224700
         ST    R4,CKBFLWA          REINITIALIZE BYTES LEFT IN BUFFER    01225100
         ST    RA,CKBFSTAD         RE-INITIALIZE STARTING ADR OF BUFFER 01225500
         LM    R2,RD,CKOBHSAV      RESTORE REGS                         01225600
         BR    RD                  RETURN                               01225700
         EJECT                                                          01225802
*                                                                       01229600
*        ROUTINE TO WRITE OUT BUFFER                                    01229700
*                                                                       01229800
C13B2    LTR   R4,R4               ARE BYTES LEFT IN BUFFER=0           01229900
         BZ    C13B2A              YES-BRANCH                           01234900
         MVI   E0(RA),E0           SET END OF USABLE DATA BYTE          01236900
C13B2A   L     RA,CMBUF            INIT START OF BUFFER                 01239302
         TM    CKFLAG1,CKVEQR      IS THIS TASK V=R?             YM2776 01239401
CKVEQR   EQU   8                   V=R FLAG IN W.A.             YA00258 01239502
         BNO   CKNOVEQR            NO, GO ON                     YM2776 01239602
         LRA   RA,0(,RA)           GET REAL ADDRESS OF BUFFER    YM2776 01241101
CKNOVEQR WRITE CKDECB1,SF,,(RA),MF=E WRITE SUR                          01242702
         CHECK CKDECB1             CHECK SUR                            01245302
         TM    CKFLAG1,CKTAPE      CHKPT DATA SET ON TAPE               01246200
         BZ    CMEOVDA             BRANCH IF NO                         01247100
         L     RF,CKTSTEOV         LOAD ADDR OF DEB VOL COUNT           01248002
         CLC   E0(E4,RF),CKEOVCMR  DID EOV OCCUR                        01248900
         BNE   CMEOV               BRANCH IF YES                        01249800
CMTIOTST CLI   CKRETCOD+E1,CKIOERR I/O ERROR                            01251602
         BE    C12D4               BRANCH TO XCTL RTN                   01252601
         L     RA,CMBUF            INIT START OF BUFFER          YM2776 01253501
         ST    RA,CKBFSTAD         RE-INIT BUFFER PTR                   01253701
         LA    R4,SURL             GET LENGTH OF SUR                    01254801
         ST    R4,CKBFLWA          RE-INIT REMAINING BYTES IN BUFFER    01255901
         BR    R7                  RETURN TO BUFFER HANDLER             01257001
*                                  OR XCTL INTERFACE                    01258101
         EJECT                                                          01259201
*                                                                       01260301
*        END OF VOLUME TESTING                                          01261401
*                                                                       01262501
CMEOV    TM    CKFLAG2,CKEOV       2ND EOV FOR THIS REQUEST             01264702
         BO    CMEOVER             YES- PREPARE TO GO TO EXIT RTN       01265801
         OI    CKFLAG2,CKEOV       TURN ON EOV INDICATOR                01266901
         MVI   CKMN40+E4,C2        SET MOD NAME TO IGC0206C             01268002
         B     C12D4               XCTL INTERFACE                       01269101
         USING IHADCB,RF           DCB                                  01271302
CMEOVDA  L     RF,CKDCBAD          GET ADR. OF CHKPT DCB                01272402
         L     RF,DCBDEBAD         GET ADR. OF CHKPT DEB                01273501
         DROP  RF                  DCB                                  01274601
         USING DEBBASIC,RF         DEB                                  01275701
         CLC   DEBNMEXT(E1),CKTSTEOV DID EOV OCCUR ON DA DEVICE         01276802
         BE    CMTIOTST            NO- CONTINUE PROCESSING              01279001
         DROP  RF                  DEB                                  01280101
CMEOVER  LA    RF,CKERIO7          INDICATE EOV ERROR                   01282302
         STH   RF,CKMSGCOD         PUT IN W.A.                          01283401
         MVI   CKRETCOD+E1,E8      PUT IN RETURN CODE ERROR             01284501
         B     C12D4               XCTL INTERFACE                       01285601
*                                                                       01286701
*        CHECKMAIN SYNAD ROUTINE                                        01287801
*                                                                       01288901
C13B5    MVI   CKRETCOD+E1,CKIOERR  I/O ERROR                           01291102
         LA    R7,CKIOEROR         I/O ERROR CODE                       01292201
         STH   R7,CKMSGCOD         STORE IN WORK AREA                   01293301
         BR    RE                  RETURN                               01294401
         EJECT                                                          01295501
*                                                                       01296601
*        GENERAL CONSTANTS                                              01297701
*                                                                       01298801
         DS    0F                                                       01299901
PRIVCATL DC    CL4'SYS0'           GENERATED DDNAME-1ST 4 CHAR. ZA00103 01300302
ABLEV    DC    CL2'AV'             DUMMY DEB MODULE            @ZA17960 01300537
EPCBLEN  DC    XL2'00BC'           LENGTH OF AN EPCB           @ZA28860 01300637
         DS    0F                                                       01300737
CKMN40A  DC    CL8'IGC0N06C'       ADDR OF NEXT LOAD                    01301001
KRBPRFXL DC    AL4(RBPRFLNA)       ADDR OF IRB LENGTH                   01302100
KDEBAVTL DC    AL4(DEBAVTLN)       ADDR OF DEB LENGTH                   01304100
CKSSCRID DC    X'01',X'02',AL2(SSCRDATA-SSCRID) SSCR HDR         Y02076 01304302
SP253    DC    AL1(253)                 SUBPOOL 253 CONSTANT    ZA03159 01304437
PURG00   DC    XL3'000000'              PURGE/RESTORE TESTS    @ZA03659 01305137
PURGFF   DC    XL3'FFFFFF'              PURGE/RESTORE TESTS    @ZA03659 01305537
PATCH    EQU   *                   PATCH START                          01306937
CM3LN    EQU   PATCH-IGC0H06C      LENGTH OF CSECT                      01307637
CM3PALN  EQU   CM3LN/10            GET LENGTH OF PATCH AREA             01308337
CM3PATCH DC    XL(CM3PALN)'00'     10 PERCENT ALLOWANCE FOR PATCH AREA  01309037
*                                                                       01310700
*        GENERAL  EQUATES                                               01311100
*                                                                       01311500
E0       EQU   0                   DISPLACEMENT                         01311900
E1       EQU   1                   1                                    01312537
E2       EQU   2                   2                                    01313237
E3       EQU   3                   3                                    01313937
E4       EQU   4                   4                                    01314637
N4       EQU   4                   4 CONSTANT                    Y02076 01315337
X04      EQU   X'04'               NONLAST DSAB RCD CODE         Y02076 01316037
E5       EQU   5                   DISPLACEMENT FOR W.A. SAVE AREA      01316737
E6       EQU   6                   6                                    01318600
E7       EQU   7                   7                                    01319000
E8       EQU   8                   8                                    01319400
M8       EQU   8                   MASK FOR HIGH ORDER BYTE      YM7807 01319502
E9       EQU   9                   9                                    01320237
E10      EQU   10                  10                                   01320737
E12      EQU   12                  BRANCH CONDITION CODE                01321937
E14      EQU   14                  DISPLACEMENT                         01323137
E15      EQU   15                  CODE FOR USE FIELD                   01326300
E16      EQU   16                  CODE FOR USER'S GPR'S                01327400
E18      EQU   18                  CODE FOR IRB                         01328500
E19      EQU   19                  CODE FOR FLOATING PT REG             01329600
E20      EQU   20                  CODE FOR TIOT                        01330700
E21      EQU   21                  CODE FOR PIE                         01331800
E24      EQU   24                  FIELD DISPLACEMENT                   01332900
X24      EQU   X'24'               IMPLIED PRIV. CATL DSAB CODE ZA00103 01333302
E32      EQU   32                  LENGTH OF FLOATING POINT REGS        01334000
X20      EQU   X'20'               DEB EXTENSION CODE            Y02076 01335137
X21      EQU   X'21'               RESTORE LIST(PIRL) CODE     @ZA03659 01336537
E64      EQU   64                  LENGTH OF G.P. REG                   01337337
X44      EQU   X'44'               LAST DSAB RCD CODE            Y02076 01337537
X00      EQU   X'00'               0 CONSTANT                    Y02076 01338737
E128     EQU   128                 CODE FOR NON- ISAM DEB               01339937
E129     EQU   129                 CODE FOR ISAM DEB                    01341137
E130     EQU   130                 CODE FOR DUMMY DEB                   01342337
EX0C     EQU   X'0C'               MASK FOR IQE                         01343537
EX12     EQU   X'12'               CODE FOR IRB                         01344737
EX80     EQU   X'80'               CODE FOR NON-ISAM DEB                01345937
EX83     EQU   X'83'               CODE FOR SUBSYSTEM DEB        YM5720 01347137
EXFF     EQU   X'FF'               BIT RESET MASK                       01348337
EX7F     EQU   X'7F'               CODE RESET MASK                      01349537
C2       EQU   C'2'                CONSTANT OF 2                        01350737
BLANK    EQU   C' '                BLANK CONSTANT                Y02076 01351937
M3       EQU   3                   REG MASK FOR BYTES 2 & 3      Y02076 01353137
TCAMAP   EQU   X'84'               TCAM DEB WITH KEY 6 IRB       YM7573 01354337
DEBPRLSS EQU   X'08'               DEB PURGE RESTORE SUBSYSTEM @ZA06140 01355537
*        EQUATES FOR LENGTHS AND CODES                                  01356737
*                                                                       01357937
SURL     EQU   400                 LENGTH OF SUR                 YM7049 01359137
DEBPRFLN EQU   16                  LENGTH OF DEB PREFIX          Y02049 01360337
CKERIO7  EQU   X'031B'             ERROR MSG CODE FOR EOV               01361537
CKIOEROR EQU   X'0317'             ERROR MSG CODE FOR I/O ERROR         01362737
         EJECT                                                          01363937
         IEEVCHWA VER=3            AOS2 VERSION OF WA                   01365137
CKTSTEOV EQU   CKUNIT              EOV TEST 1                           01366337
CKEOVCMR EQU   CKUNIT+4            EOV TEST 2                           01367537
CMADEOV  DS    F                   SAVE AREA FOR INFO NEEDED            01368737
CMNEOV   DS    F                   TO TEST IF EOV OCCURRED              01369937
CKBFLWA  DS    F                   REMAINING BYTES IN BUFFER            01371137
CKBFSTAD DS    F                   NEXT BYTE IN BUFFER TO BE FILLED     01372337
CMBUF    DS    F                   BUFFER                               01373537
CKMN40   DS    2F                  SAVE AREA                            01374737
CK40XCTL DS    F'0'                SAVE AREA FOR XCTL                   01375937
CKOBHSAV DS    12F                 SAVE AREA                            01377137
CME2     DS    CL1                 BIG BLOCK SWITCH                     01378337
CKCODE   DS    CL1                 SUR CODE                             01379537
CKLNT    DS    F                   SUR LENGTH                           01380737
CMSYSA   DS    F                   SWITCHES                             01381937
FLTPTSAV DS    4D                  FLOATING POINT SAVE AREA             01383137
         EJECT                                                          01384337
*                                                                Y02076 01385537
*        DSECT FOR DSAB SUR RECORD                               Y02076 01386737
*                                                                Y02076 01387937
XDSAB    DSECT                     DSAB BLK DSECT                Y02076 01389137
XDSAOPCT DS    CL2                 DCB OPEN COUNT                Y02076 01390337
XDSABORG DS    CL2                 DATA SET ORG                  Y02076 01391537
XDSAFLG1 DS    CL1                 DSAB FLAG 1                   Y02076 01392737
XDSAFLG2 DS    CL1                 DSAB FLAG 2                   Y02076 01393937
XDSAFLG4 DS    CL1                 DSAB FLAG 4                   Y02076 01395137
XDSADCBM DS    CL6                 DCB MODIFICATION MASK         Y02076 01396337
XDSADDNM DS    CL8                 DD NAME                       Y02076 01397537
XDSAFLGS DS    CL1                 DSAB PROCESS FLAGS            Y02076 01398737
XDSACCAT EQU   X'80'               DSAB IS CONCATENATED          Y02076 01399937
XDSATCBP EQU   X'40'               DSAB HAS TCB ADDR             Y02076 01401137
XDSABSIZ EQU   *-XDSAB             DSAB BLK SIZE                 Y02076 01402337
         TITLE 'IHJQCP32 - JSCB'                                        01403537
         IEZJSCB                                               , Y02076 01404737
         TITLE 'IHJQCP32 - QDB'                                         01405937
         IHAQDB                                                , Y02076 01407137
         TITLE 'IHJQCP32 - DSAB'                                        01408337
         IHADSAB                                               , Y02076 01409537
         TITLE 'IHJQCP32 - TIOT'                                        01410737
         IEFTIOT1                                              , Y02076 01411937
         TITLE 'IHJQCP32 - CVT'                                  Y02076 01413137
         CVT   DSECT=YES,PREFIX=YES,LIST=YES                     Y02076 01414337
         TITLE 'IHJQCP32 - SPIE CHKPT BLOCK'                     Y02076 01415537
* SPIE CHKPT BLOCK                                               Y02076 01416737
         IHJSSCR                                               , Y02076 01417937
         TITLE 'IHJQCP32 - TASK CONTROL BLOCK'                          01419137
* TASK CONTROL BLOCK                                                    01420337
         IKJTCB                                                         01421537
         TITLE 'IHJQCP32 - REQUEST BLOCK - S.V.R.B., I.R.B.'            01422737
* REQUEST BLOCK - S.V.R.B.,I.R.B.'                                      01423937
         IKJRB                                                          01425137
         TITLE 'IHJQCP32 - DATA EVENT BLOCK'                            01426337
* DATA EVENT BLOCK                                                      01427537
         IEZDEB                                                         01428737
DEBAVTLN EQU   DEBBASIC-DEBAVT     AVT LENGTH                           01429937
         TITLE 'IHJQCP32 - DATA CONTROL BLOCK'                          01431137
* DATA CONTROL BLOCK                                                    01432337
         IHADCB DSORG=(PO,PS),DEVD=(DA,TA)                              01433502
         TITLE 'IHJQCP32 - UNIT CONTROL BLOCK'                          01483502
* UNIT CONTROL BLOCK                                                    01533502
         IEFUCBOB                                                       01583502
         END                                                            81400017
