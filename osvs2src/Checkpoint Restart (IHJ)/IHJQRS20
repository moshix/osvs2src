RS20     TITLE 'IHJQRS20 AOS/2 REPMAIN 1 ROUTINE - IGC0505B'            01050000
*                                                                       01060003
*   VS2/REL3 CHANGES/DELETIONS                                          01070003
*31775,33318-33338,35199-35260,37451-37463,37534-37538         @ZM33369 01080003
*A030698-030751,030852-030997,031035-031055                     ZA02207 01090037
* APAR OZ31478 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01092037
*C037379,037408,037419,037526,037538,039248,039312,039363,     @ZSUT222 01093037
*C039808                                                       @ZSUT222 01094037
*A036964-036979,037626                                         @ZSUT222 01096037
*                                                                       01100000
* NAME - REPMAIN 1 - IHJQRS20 -IGC0505B                                 01150000
*                                                                       01200000
* STATUS                                                                01250000
*                                                                       01300000
*         CHANGE LEVEL=0                                                01350000
*                                                                       01400000
* FUNCTION                                                              01450000
*                                                                       01500000
*         THIS MODULE OF THE RESTART FACILITY RECREATES THE USER REGION 01550000
*         AS IT EXISTED AT CHECKPOINT TIME, AND REESTABLISHES THE       01560000
*         VIRTUAL STORAGE MANAGEMENT CONTROL BLOCKS TO REFLECT THE      01570000
*         STATUS OF THE REGION.                                         01580000
*                                                                       01590000
* ENTRY POINTS                                                          01592000
*                                                                       01594000
*         REPMAIN 1 IS ENTERED FROM RESTART HOUSEKEEPING (IGC0205B)     01596000
*         TO RECREATE THE USER REGION.                                  01598000
*                                                                       01598400
* INPUT                                                                 01598800
*                                                                       01599200
*         GPR 1 - CONTAINS THE ADDRESS OF THE RESTART WORK AREA         01599602
*                                                                       01599802
* OUTPUT                                                         Y02076 01600002
*                                                                Y02076 01600102
*         GPR 1 - CONTAINS THE ADDRESS OF THE RESTART WORK AREA  Y02076 01600302
*                                                                Y02076 01600502
* EXTERNAL REFERENCES                                            Y02076 01600602
*                                                                Y02076 01600702
*         NONE                                                   Y02076 01600902
*                                                                Y02076 01601002
* EXITS, NORMAL                                                         01601102
*                                                                       01601302
*               - TO REPMAIN 2 (IGC0605B) TO RESTORE CONTENTS           01649900
*                 SUPERVISION AND TASK MANAGEMENT CONTROL BLOCKS.       01659900
*                 UPON EXIT THE PARAMETERS ARE AS FOLLOWS-              01669900
*                 GPR 12 - CONTAINS ADDRESS OF RSTWA.                   01679900
*                 DECB USED FOR READING THE RESTART DATA SET IS         01689900
*                 INITIALIZED TO READ THE SUR'S.                        01691900
*                 THE ADDRESS OF THE NEXT SUR IN THE BUFFER, AND        01693900
*                 THE NUMBER OF BYTES LEFT IN THE BUFFER ARE PASSED     01695900
*                 IN THE RSTWA.                                         01697900
*                                                                       01698300
* EXITS, ERROR                                                          01698700
*                                                                       01699100
*              -  TO REPMAIN 5 (IGC0905B) TO FREE ANY CONTROL BLOCKS    01699500
*                 USED BY RESTART AND TO RE-INITIALIZE THE REGION       01699600
*                 FOR TERMINATION. REPMAIN 5 IS GIVEN CONTROL IN THE    01699700
*                 EVENT OF AN I/O ERROR.                                01699800
*                 UPON EXIT THE PARAMETERS ARE AS FOLLOWS-              01749800
*              (1)ERROR CODE OF 035 TO INDICATE AN I/O ERROR.  @ZSUT222 01759837
*              (2)ERROR CODE OF 041 TO INDICATE WRONG LENGTH   @ZSUT222 01759937
*                 RECORD DETECTED READING THE CHECKPOINT D/S.  @ZSUT222 01760037
*              (3)ERROR CODE OF 202 TO INDICATE A SETLOCK      @ZSUT222 01760137
*                 ERROR.                                       @ZSUT222 01760237
*                                                                       01769800
* TABLES/WORK AREAS                                                     01779800
*                                                                       01789800
*         RSTWA                                                         01791800
*                                                                       01793800
*         RPMWA1                                                        01795800
*                                                                       01797800
*         DCB   DCBSYNAD                                         Y02076 01798202
*                                                                       01798600
*         TCB   TCBPKF                                           Y02076 01799002
*               TCBPQE                                                  01799400
*                                                                       01799500
*         PQE   PQEREGN                                                 01799702
*               PQEFPQE                                                 01849700
*                                                                       01859700
*         SPQE  SPQEPTR                                                 01869700
*               SPDQEPTR                                                01879700
*               SPQEFLGS                                                01889700
*               SPQEID                                                  01891700
*               SPQEAD                                           Y02076 01891902
*               SPQEKEY                                          Y02076 01892102
*                                                                       01893700
*         DQE   DQFQEPTR                                                01895700
*               DQEPTR                                                  01897700
*                                                                       01898100
*         FQE   FQEPTR                                                  01898500
*                                                                       01899400
* ATTRIBUTES                                                            01899500
*                                                                       01899600
*         KEY 0, SUPERVISOR STATE, ENABLED                              01949600
*                                                                       01959600
*         APPLICABILITY                                                 01969600
*                                                                       01979600
*               AOS/2                                                   01989600
*                                                                       01991600
*         MODULE CHARACTERISTICS                                        01993600
*                                                                       01995600
*              TYPE - LOAD MODULE                                       01997600
*                                                                       01998000
*              RESIDENCE - SYSTEM LINK PACK AREA                        01998400
*                                                                       01998800
*         DEPENDENCIES                                                  01999200
*                                                                       01999300
*              SIZE AND FORMATS OF CONTROL BLOCKS FORMATTED             01999400
*                                                                       01999500
*              REGION MUST BE COMPLETLY ALLOCATED TO SUBPOOL 0.         02049500
*                                                                       02059500
*         INTERFACES                                                    02069500
*                                                                       02079500
*              READ/CHECK MACROS                                        02089500
*                                                                       02091500
*              FREEMAIN/GETMAIN                                         02093500
*                                                                       02095500
* NOTES                                                                 02097500
*                                                                       02097900
*         OPERATION                                                     02098300
*                                                                       02098700
*         THIS ROUTINE RE-INSTATES THE USER REGION CHECKPOINTED BY      02099100
*         CHECKMAIN 1. IT ALSO RECREATES THE VIRTUAL STORAGE MANAGEMENT 02099200
*         CONTROL BLOCKS CHECKPOINTED BY CHECKMAIN 2. UPON ENTRY, THE   02099300
*         THE FOLLOWING INITIALIZATION PROCESSING TAKES PLACE.          02099400
*                                                                       02149400
*              GPR 12 IS SET AS BASE FOR THE RESTART WORK AREA (RSTWA), 02159400
*              AND THE ADDRESS OF THE REPMAIN WORK AREA (RPMWA1) IS     02169400
*              OBTAINED.                                                02179400
*                                                                       02189400
*              THE REPMAIN SYNAD ROUTINE ADDRESS IS PLACED IN THE       02191400
*              RESTART DCB.                                             02193400
*                                                                       02195400
*              THE DEFAULT XCTL EXIT ROUTINE NAME IS SET TO REPMAIN 2   02197400
*              (IGC0605B).                                              02197800
*                                                                       02199100
*              THE ADDRESS OF THE RESTART PQE IS OBTAINED FROM THE      02199200
*              P/P TCB ADDRESSED BY THE RSTWA.                          02199300
*                                                                       02249300
*              THE REGION BOUNDS (START/END) ARE OBTAINED FROM THE      02259300
*              RSTWA AND THE CURRENT POSITION POINTER WITHIN THE        02269300
*              REGION IS SET EQUAL TO THE BEGINNING OF THE REGION.      02279300
*                                                                       02289300
*              A 2K BLOCK OF THE RESTART WORK AREA IS USED       Y02076 02291502
*              FOR THE ASR BUFFER.                               Y02076 02291702
*                                                                       02293300
*         PROCESSING THEN CONTINUES AS DESCRIBED UNDER THE HEADING      02295300
*         'RESTORING THE USER REGION STORAGE'.                          02297300
*                                                                       02297700
*         RESTORING THE USER REGION STORAGE                             02298100
*                                                                       02298500
*         1.   THE ASR RECORD IS READ INTO THE ASR BUFFER               02298900
*                                                                       02299000
*         2.   THE FIRST/NEXT ASRE IS OBTAINED FROM THE ASR, AND A      02299100
*              TEST IS PERFORMED TO DETERMINE IF THE CURRENT REGION     02299200
*              POINTER IS EQUAL TO THE ASRE START POINTER. IF SO,       02332800
*              PROCESSING CONTINUES WITH STEP 3. IF NOT, THEN THE       02342800
*              AREA FROM THE CURRENT REGION POINTER TO THE ASRE START   02352800
*              POINTER IS FREE REGION STORAGE, AND A FREEMAIN FOR       02362800
*              SP250 IS ISSUED. THIS FREEMAIN CREATES AN FBQE FOR       02364800
*              THE FREE STORAGE, AS WELL AS PERFORMING ALL NECESSARY    02365200
*              INTERFACES WITH THE PAGING SUPERVISOR. PROCESSING THEN   02365600
*              CONTINUES WITH STEP 3.                                   02366000
*                                                                       02366100
*         3.   THE CURRENT REGION POINTER IS UPDATED TO POINT TO THE    02366200
*              END OF THE STORAGE BLOCK DESCRIBED BY THE ASRE. THE      02366300
*              STORAGE DESCRIBED BY THE ASRE IS THEN READ DIRECTLY      02377500
*              TO ITS VIRTUAL STORAGE LOCATION BY SUCCESSIVE READS      02387500
*              FROM THE RESTART DATA SET. AFTER THE LAST READ HAS       02387900
*              BEEN PERFORMED, A TEST IS MADE TO DETERMINE IF THE       02388300
*              ASR HAS ANY MORE ASRE'S. IF SO, PROCESSING CONTINUES     02388700
*              WITH STEP 2. IF NOT, A TEST IS MADE TO DETERMINE IF      02392400
*              THIS IS THE LAST ASR. IF NOT, PROCESSING CONTINUES       02394400
*              WITH STEP 1, OTHERWISE, IF THE CURRENT REGION POINTER    02394800
*              IS NOT EQUAL TO THE REGION ENDING ADDRESS, A FREEMAIN    02395200
*              IS ISSUED FOR THE REMAINDER OF THE REGION.        Y02076 02395602
*              PROCESSING THEN CONTINUES AS DESCRIBED UNDER THE  Y02076 02396102
*              HEADING 'RESTORING THE VSM CONTROL BLOCK QUEUES'. Y02076 02396202
*                                                                       02446200
*         RESTORING THE VSM CONTROL BLOCK QUEUES                        02456200
*                                                                       02466200
*         THIS ROUTINE WILL RESTORE THE VSM CONTROL BLOCKS (SPQE, DQE,  02476200
*         FQE) FOR SYSTEM TASK CONTROL (STC), INITIATOR, AND PROBLEM    02486200
*         PROGRAM TASKS. IT INITIALIZES THE I/O CONTROL BLOCKS FOR      02488200
*         READING SUR RECORDS, AND CAUSES THE FIRST SUR TO BE READ IN.  02490200
*         PROCESSING THEN CONTINUES WITH STEP 1.                        02492200
*                                                                       02494200
*         1.   THE STC TCB ADDRESS IS OBTAINED, AND A COUNTER IS SET    02494600
*              TO 2 TO INDICATE THAT THE INIT AND P/P HAVE NOT BEEN     02495000
*              PROCESSED. PROCESSING THEN CONTINUES WITH STEP 2.        02495400
*                                                                       02495800
*         2.   THE BLOCK LENGTH USED BY THE BUFFER HANDLER AND          02495900
*              GETMAIN ROUTINES IS SET TO THE LENGTH OF AN SPQE,        02496000
*              AND A CALL IS MADE TO THE RSGET ROUTINE WHICH WILL       02496100
*              GET STORAGE FOR THE SPQE, AND MOVE THE SPQE TO THE       02512800
*              CORE OBTAINED. UPON RETURN, THE STORAGE PROTECT   Y02076 02523002
*              KEY OF THE SPQE IS TESTED AND IF GREATER THAN 8,  Y02076 02523202
*              IT IS UPDATED TO THE KEY OF THE PP TCB (TCBPKF).  Y02076 02523402
*              THEN, A SWITCH IS SET TO                          Y02076 02523602
*              INDICATE THAT THIS IS THE LAST SPQE IF THE LAST SPQE     02524800
*              FLAG IS SET IN THE SPQE. THEN, THE SPID IS CHECKED       02526800
*              FOR SUBPOOL 0. IF NOT, PROCESSING CONTINUES WITH STEP    02528800
*              3. IF SO, SPECIAL PROCESSING IS ENTERED TO HANDLE THE    02529200
*              SHARED SP 0. IF THE TASK CURRENTLY BEING RESTORED IS     02529300
*              THE STC, THE ADDRESS OF THE SPQE IS SAVED, AND           02529400
*              PROCESSING CONTINUES WITH STEP 3. IF NOT, THE ADDRESS    02535000
*              OF THE STC SP0 SPQE IS PLACED IN THE SPQEDQE FIELD       02537000
*              TO CONNECT THE SPQE TO THE OWNER OF THE SUBPOOL, AND     02539000
*              PROCESSING CONTINUES WITH STEP 3.                        02539400
*                                                                       02539800
*         3.   THE SPQE IS PLACED ON THE CHAIN OF RESTORED SPQE'S       02540200
*              FOR THE TASK IN THE RPMWA. THE ADDRESS OF THE NEXT       02540300
*              DATA BLOCK IS OBTAINED. THE BLOCK LENGTH IS SET TO       02540400
*              THE SIZE OF AN FQE/DQE (16 BYTES) AND A TEST IS          02540500
*              PERFORMED TO DETERMINE IF THIS IS A DQE. IF NOT,         02590500
*              PROCESSING CONTINUES AS DESCRIBED BY STEP 6.             02600500
*                                                                       02610500
*         4.   IF THIS IS A DQE, A CALL IS MADE TO RSGET TO GET AND     02620500
*              MOVE THE BLOCK TO A DQE IN LSQA. UPON RETURN, THE        02630500
*              DQE IS CHAINED TO THE SPQE AND PROCESSING CONTINUES      02632500
*              WITH STEP 5.                                             02634500
*                                                                       02636500
*         5.   THE ADDRESS OF THE NEXT DATA BLOCK IS OBTAINED, AND      02638500
*              A TEST IS MADE TO DETERMINE IF IT IS AN FQE. IF NOT,     02638900
*              PROCESSING CONTINUES WITH STEP 4. OTHERWISE, THE         02639300
*              RSGET ROUTINE IS CALLED, AND THE FQE IS PLACED ON        02639700
*              THE DQE. PROCESSING THEN CONTINUES WITH STEP 5.          02640100
*                                                                       02640200
*         6.   IF THE LAST SPQE SWITCH IS NOT ON, PROCESSING            02640300
*              CONTINUES WITH STEP 2. IF ON, THE SWITCH IS TURNED       02640400
*              OFF, AND THE COUNTER, SET TO 2 AT INITIALIZATION         02657100
*              TIME, IS DECREMENTED BY 1. DEPENDING ON THE COUNTER      02667100
*              VALUES, THE FOLLOWING PROCESSING TAKES PLACE.            02669100
*                                                                       02671100
*                   COUNTER = 1    THE INITIATOR SPQE CHAIN MUST        02673100
*                                  BE PROCESSED AND PROCESSING          02673500
*                                  CONTINUES WITH STEP 2.               02673600
*                                                                       02673700
*                   COUNTER = 0    THE P/P SPQE CHAIN MUST BE           02679300
*                                  PROCESSED AND PROCESSING             02681300
*                                  CONTINUES WITH STEP 2.               02683300
*                                                                       02683700
*                   COUNTER = NEG. ALL SPQE CHAINS HAVE BEEN            02684100
*                                  PROCESSED, GPR 1 IS SET TO           02684500
*                                  POINT TO THE RSTWA AND EXIT IS       02684600
*                                  MADE VIA XCTL TO REPMAIN 2.          02684700
         EJECT                                                          02684800
IGC0505B CSECT                                                          02734800
         BALR  RB,R0               EST. ADDRESSABILITY                  02744800
         USING *,RB                ADDRESS CODE                         02754802
         B     BEGIN               GO AROUND ID                         02764800
         DC    H'0'                ALIGN TO DOUBLE WORD BDY             02774800
         DC    CL8'IGC0505B'       MODULE NAME                 @ZSUT222 02776837
         DC    CL8'&SYSDATE'       LAST DATE SHIPPED           @ZSUT222 02776937
         DC    CL8'@ZSUT222'       LAST CODE SHIPPED           @ZSUT222 02777037
BEGIN    LR    RC,R1               GET ADDR OF RESTART WORK AREA        02778800
         USING RSTWA,RC            ADDRESS WORKAREA                     02780802
         LR    RA,RC               COMPUTE ADDR OF                      02782802
         A     RA,RSMWOFST         REPMAIN WORK AREA                    02783202
         USING RPMWA1,RA           ADDRESS REPMAIN WORKAREA             02783602
         LA    RD,RSREGSAV         GET SAVE AREA ADDR FOR ACCESS METH.  02784000
         XC    LOCLOCK,LOCLOCK     CLEAR LOCAL LOCK SWITCH     @Z30ESHP 02785603
*                                                                YM6541 02787803
*        FREEMAIN TO RELEASE ANY RESIDUAL SUBPOOL 252            YM6541 02789403
*        ALLOCATIONS - NAMELY THE CHECKPOINT D/S IOB             YM6541 02791003
*                                                                YM6541 02792603
         FREEMAIN R,SP=252                                       YM6541 02794203
*                                                                YM7523 02795803
*        GET 2K CORE USED BY OPEN IN 005B                        YM7523 02797403
*                                                                YM7523 02799003
         LA    R0,TWOKBLK               2K                       YM7523 02800603
         ICM   R0,M8,RMSP250            SP250                    YM7523 02802203
         GETMAIN R,LV=(R0)                                       YM7523 02803803
         LA    R2,RSBDCB           GET ADDRESS OF RESTART DCB           02805402
         USING IHADCB,R2           ADDRESS DCB                          02806602
         LA    RF,SYNAD            GET ADDRESS OF RM1 SYNAD ROUTINE     02807802
         STCM  RF,M7,DCBSYNAD+N1   PUT SYNAD ADDRESS IN DCB.            02809002
         XC    RPMWA1(RPMWAEND-RPMWA1),RPMWA1   CLEAR THE WORK AREA     02810202
         LA    RF,N2048            SET UP RECORD LENGTH FOR CIR'S       02811400
         STH   RF,RSLNGTH1         PUT IT IN DECB 1                     02813400
         MVC   RPMXLIST(N8),RM2NAME SET DEFAULT XCTL NAME        Y02076 02813602
         SPACE 3                                                        02823600
*        START OF ASRE PROCESSING                                       02825600
         SPACE 3                                                        02827600
RM2E100  L     R4,RSTCBAD          GET ADDRESS OF P/P TCB               02828000
         USING TCB,R4              ADDRESS TCB                          02828402
         L     R4,TCBPQE           GET ADDR OF DPQE                     02828800
         DROP  R4                  TCB                                  02828902
         USING PQESECT,R4          ADDRESS PQE                          02829002
         L     R4,PQEFPQE          GET ADDR OF PQE                      02829100
         L     RF,PQEREGN          GET START ADDR OF REGION             02879100
         ST    RF,RPMCESA          SET CURRENT START = REGION START     02889100
         A     RF,RSPPE            CALCULATE END OF REGION       Y02076 02899102
         ST    RF,RPMRGEND         SAVE IT FOR LATER COMPARES           02909100
         DROP  R4                  FREE R4 FOR OTHER USE                02919100
         LR    R6,RC               GET ADDRESS OF                Y02076 02919302
         A     R6,RSBFOFST         SUR/SSCR BUFFER               Y02076 02919502
         USING ASRHDR,R6           ADDRESS ASR                          02925102
RM2E110  LR    R9,R6               SET UP TO READ INTO ASR BUFFER       02927100
         BAL   R8,READRTN          READ AN ASR RECORD                   02927500
         SR    R4,R4               SET ASRE COUNTER = 0                 02927900
         SR    R5,R5               SET ASRE INDEX = 0                   02928300
RM2E120  CH    R4,ASRCOUNT         HAVE ALL ASRE'S BEEN PROCESSED       02928700
         BNL   RM2E150             YES, GO SEE IF ANY MORE ASR'S.       02928800
         LA    R4,N1(R4)           UP COUNT BY 1.                       02928900
         LA    R5,N8(R5)           UP INDEX BY 8 TO POINT TO NEXT ASRE  02929000
         L     R9,ASRHDR(R5)       GET ELEMENT START FROM ASRE          02945700
         C     R9,RPMCESA          IS ELEM. START = CURRENT START       02955700
         BE    RM2E130             YES, GO SET CURR START EQ ELEM. END  02957700
         L     R1,RPMCESA          GET START OF AREA TO FREEMAIN        02959700
         LR    R0,R9               CALCULATE LENGTH TO FREE             02961700
         S     R0,RPMCESA          IE. ENTRY START - CURRENT START      02962100
         ICM   R0,M8,RMSP250       SET UP SUBPOOL NUMBER                02962200
         FREEMAIN R,LV=(0),A=(1)   CREATE APPROPRIATE FBQE.             02962300
RM2E130  L     RF,ASRHDR+N4(R5)    SET THE CURRENT START ADDRESS        02967900
         ST    RF,RPMCESA          = THE ELEMENT END ADDRESS            02969900
         SPACE                                                          02971900
*        NOTE THAT THE READ BUFFER ADDRESS (R9) IS = ELEMENT START      02972300
         SPACE                                                          02972700
RM2E140  BAL   R8,READRTN          READ CIR INTO REGION                 02973100
         LA    R9,N2048(R9)        BUMP READ ADDRESS BY CIR REC. SIZE   02973200
         C     R9,RPMCESA          HAS READ ADDRESS REACHED ELEM. END   02973300
         BL    RM2E140             NO, CONTINUE TO READ.                02973400
         B     RM2E120             YES, GO PROCESS NEXT ASRE, IF ANY.   03023400
         SPACE 3                                                        03033400
*        ALL ENTRIES OF AN ASR RECORD HAVE BEEN PROCESSED.              03043400
*        DETERMINE IF ANY MORE ASR RECORDS REMAIN.  IF NOT,             03053400
*        THE REGION HAS BEEN RESTORED.                                  03063400
         SPACE 3                                                        03065400
RM2E150  TM    ASRFLG1,ASRLAST     IS THIS LAST ASR RECORD              03067400
         BZ    RM2E110             NO, GO READ NEXT ASR                 03069400
         STM   RE,RC,RSREGSAV+12   SAVE REGISTERS               ZA02207 03069837
         L     R4,RSTCBAD          GET TCB ADDR                 ZA02207 03070237
         USING TCB,R4                                           ZA02207 03070637
         L     R4,TCBMSS           GET SUBPOOL PTR              ZA02207 03071037
         DROP  R4                                               ZA02207 03071137
         USING SPQESECT,R4         MAP SPQE                     ZA02207 03071237
         L     R3,RPMRGEND         GET REGION END               ZA02207 03071337
         S     R3,RPMCESA          GET SIZE TO FREE             ZA02207 03071437
RM2E152  EQU   *                                                ZA02207 03075137
         CLC   RPMCESA(N4),RPMRGEND IS CURR. START = REG. END           03079437
         BNL   RM2E161             YES, END OF REGION WAS ALLOCATED     03083237
RM2E153  EQU   *                                                ZA02207 03085237
         TM    SPQEFLGS,SPSHARE    SHARED SPQE?                 ZA02207 03085637
         BNO   RM2E154             NO, BRANCH                   ZA02207 03086037
         L     R4,SPDQEPTR         PTR TO OWNED SPQE            ZA02207 03086437
RM2E154  EQU   *                                                ZA02207 03086837
         CLI   SPQEID,SP0          IS SUBPOOL ZERO?             ZA02207 03086937
         BE    RM2E156             YES, BRANCH                  ZA02207 03089637
         L     R4,SPQEAD           GET NEXT SPQE                ZA02207 03091637
         B     RM2E153             GO CHECK FOR SP00            ZA02207 03092037
RM2E156  EQU   *                                                ZA02207 03092137
         L     R5,SPDQEPTR         GET DQE PTR                  ZA02207 03092237
         USING DQESECT,R5          MAP DQE                      ZA02207 03093037
RM2E157  EQU   *                                                ZA02207 03093437
         CLC   DQEBLKAD+1(3),RPMCESA+1  STARTING ADDR TO FREE?  ZA02207 03093837
         BE    RM2E158             YES, BRANCH                  ZA02207 03094237
         L     R5,DQEPTR           GET NEXT DQE PTR             ZA02207 03094337
         B     RM2E157             YES, BRANCH                  ZA02207 03094437
RM2E158  EQU   *                                                ZA02207 03094537
         L     R7,DQELNTH          GET LENGTH OF DQE            ZA02207 03095237
         LR    R0,R7               LENGTH TO FREE               ZA02207 03095637
         CR    R7,R3               FREE WHAT IS NEEDED          ZA02207 03096037
         BNH   RM2E159             YES, BRANCH                  ZA02207 03096437
         LR    R0,R3               LENGTH TO FREE               ZA02207 03096837
         LR    R7,R3               LENGTH TO ADD RPMCESA        ZA02207 03096937
RM2E159  EQU   *                                                ZA02207 03097737
         L     R1,DQEBLKAD         ADRESS TO FREE               ZA02207 03099737
         ICM   R0,M8,RMSP250       SET UP SUBPOOL NUMBER                03102237
         FREEMAIN R,LV=(0),A=(1)   FREE THE END OF THE REGION           03103137
         SR    R3,R7              DECREMENT LENGTH TO FREE      ZA02207 03103537
         BZ    RM2E161             ZERO TO FREE                 ZA02207 03103937
         A     R7,RPMCESA          ADD TO ADDR TO FREE NEXT     ZA02207 03104337
         ST    R7,RPMCESA          SAVE ADDR TO FREE NEXT       ZA02207 03104737
         B     RM2E152             NEXT DQE TO FREE             ZA02207 03104837
RM2E161  LM    RE,RC,RSREGSAV+12   RESTORE REGS                 ZA02207 03105137
         DROP  R4,R5                                            ZA02207 03105537
         SPACE 3                                                        03106000
*        THIS IS THE END OF CIR PROCESSING. THE REGION HAS BEEN         03108537
*        RESTORED.                                                      03111237
         DROP  R6                  BASE FOR ASR HEADER                  03113937
         EJECT                                                          03116637
*        THE FOLLOWING PROCESSING RESTORES THE VSM CONTROL BLOCKS       03119337
         SPACE 3                                                        03122037
         L     R6,RSBFOFST         GET OFFSET TO SUR BUFFER      Y02076 03124737
         AR    R6,RC               CALCULATE ADDRESS OF SUR BUFFER      03127437
         ST    R6,RSAREA1          SET ADDR OF SUR BUFFER INTO DECB1    03130137
         LA    RF,SURL             SET READ LENGTH = TO                 03132837
         STH   RF,RSLNGTH1         SUR BUFFER LEN                       03135537
         ST    R6,RSBFSTAD         INIT  BUFFER PTR TO START OF BUFFER  03138200
         SR    R3,R3               SET BLOCK LENGTH TO 0 FOR RPM500     03148200
         ST    R3,RSBFLWA          SET NO. OF BYTES LEFT IN BUF=0.      03158200
*                                  TO FORCE A READ ON FIRST CALL.       03158600
         BAL   RE,RPM500           READ IN FIRST SUR                    03158700
         SPACE 3                                                        03158800
*        START OF VSM CONTROL BLOCK PROCESSING                          03158900
         SPACE 3                                                        03165700
RPM600A  L     RF,CVTADDR(N0,N0)   GET CVT ADDR                @Z30ESHP 03166103
         USING CVTMAP,RF                                       @Z30ESHP 03166503
         L     R7,CVTTCBP          GET PTR TO NEXT TCB         @Z30ESHP 03166903
         LA    R7,CURASOFS(R7)     GET ADR OF CURR ASCB ADR    @Z30ESHP 03167303
         L     R7,N0(R7)           GET ADR OF CURR ASCB        @Z30ESHP 03167403
         ST    R7,USERASCB         SAVE FOR USE IN FREEMAIN    @Z30ESHP 03167503
         BAL   R7,LOCKGET          OBTAIN LOCAL LOCK           @ZM33369 03177503
         LA    R6,N2               SET COUNTER TO 2 TO SIGNIFY STC      03178103
*                                  SPQE/DQE/FQE'S BEING RESTORED        03179403
         NI    SWITCH,ON-LSPQE     RESET LAST SPQE SWITCH               03180503
         LA    R8,RPMMSS1          INIT. SPQE ANCHOR ADDRESS TO STC     03183603
*                                  CHAIN.                               03186703
RPM600   MVI   RMBLKSIZ+N3,SPQESIZE SET UP TO GM AN SPQE                03189803
         BAL   RD,RSGETA           GET CORE FOR AN SPQE        @Z30ESHP 03192903
         USING SPQESECT,R1         ADDRESS SPQE                         03196003
         CLI   SPQEKEY,KEY8        LOOK AT SPQE KEY              Y02076 03199103
         BL    RPM605              BR IF LESS THAN 8             Y02076 03202203
*                                  KEY IS NOT SUBJECT TO CHANGE  Y02076 03205303
         L     RF,RSTCBAD          GET TCB ADDRESS               Y02076 03208403
         USING TCB,RF              TCB                           Y02076 03211503
         MVC   SPQEKEY,TCBPKF      UPDATE PROTECT KEY            Y02076 03214603
         DROP  RF                  TCB                           Y02076 03217703
RPM605   TM    SPQEFLGS,LASTSPQE   IS IT LAST SPQE FOR TASK      Y02076 03220803
         BZ    RPM610              NO, CONTINUE                         03223903
         OI    SWITCH,LSPQE        YES, SET FLAG TO GO TO NEXT TASK     03227003
RPM610   CLI   SPQEID,SP0          IS SPQE FOR SP 0.                    03230103
         BNE   RPM620              NO, CONTINUE                         03233203
CKSP0LS  LA    RF,N1               CHECK TO SEE IF PROCESSING IS YM5714 03236302
         CR    R6,RF                 FOR THE INIT TCB            YM5714 03246302
         BNL   SAVLSPQ             YES, GO SAVE THE ADDRESS      YM5714 03256302
RPM6H4   MVC   SPDQEPTR,RSSTCSP0   POINT THIS SPQE TO INIT SPQE  YM5714 03266302
         DROP  R1                  SPQE                                 03276302
         USING SPQESECT,R8         ADDRESS SPQE                         03278302
RPM620   ST    R1,SPQEAD           CHAIN TO ANCHOR OR PREV SPQE  Y02076 03280302
         LR    R8,R1               UPDATE SPQE CHAIN REG                03282300
         LR    R4,R1               INIT. DQE CHAIN ANCHOR               03284300
         LA    R3,SPQESIZE         SPECIFY LENGTH OF PREVIOUS BLOCK     03284700
         BAL   RE,RPM500           GET NEXT INPUT BLOCK                 03285100
         MVI   RMBLKSIZ+N3,DQFQSIZE SET UP FOR SIZE OF DQE OR FQE       03285502
RPM6J3   CLI   N0(R3),DQECODE      IS IT A DQE                          03285900
         BE    PROCDQE             YES, GO PROCESS DQE'S                03286000
RPM6A5   TM    SWITCH,LSPQE        WAS THIS LAST SPQE FOR THE TASK      03286100
         BZ    RPM600              NO, PROCESS THIS NEXT SPQE           03286200
RPM6E42  NI    SWITCH,ON-LSPQE     YES, TURN OFF THE SWITCH             03302900
         BCTR  R6,R0               DECREMENT COUNTER BY 1.              03312900
         LTR   R6,R6               SEE WHICH TASK IS NEXT               03314900
         BP    RPM6E70             INITIATOR NEXT                       03316900
         BM    RPM504A             ALL DONE GO XCTL TO NEXT LOAD        03318900
         LA    R8,RPMMSS3          P/P NEXT, UPDATE CHAIN ANCHOR ADDR.  03319300
         B     RPM600              GO PROCESS P/P VSM BLOCKS            03319400
         SPACE                                                          03319500
RPM6E70  LA    R8,RPMMSS2          UPDATE CHAIN ANCHOR ADDR             03325100
         B     RPM600              GO PROCESS INITIATOR VSM BLOCKS      03327100
         SPACE                                                          03329100
RPM504A  LR    R1,RC               SET RSTWA ADDR TO GPR1               03329500
         L     RF,LOCLOCK          CHECK IF LOCK HELD          @Z30ESHP 03329603
         LTR   RF,RF               IS IT HELD                  @Z30ESHP 03329703
         BZ    RPM504B             BR IF NO                    @Z30ESHP 03329803
         BAL   R7,LOCKREL          RELEASE LOCAL LOCK          @ZM33369 03331803
         XC    LOCLOCK,LOCLOCK     CLEAR LOCAL LOCK SWITCH     @ZM33369 03333803
RPM504B  LA    RF,RPMXLIST         GET ADDR OF MODULE NAME     @Z30ESHP 03339503
         ST    RF,RPMN40AD         SAVE THE ADDRESS                     03342003
         LA    RF,RPMN40AD         GET THE ADDRESS OF THE ADDRESS       03344503
         XCTL  SF=(E,(15))         PASS CONTROL TO NEXT MODULE          03347003
         SPACE 3                                                        03349503
SAVLSPQ  ST    R1,RSSTCSP0         SAVE ADDR OF SUBPOOL 0 SPQE   YM5714 03352003
         B     RPM620              GO QUEUE THE SPQE.                   03354500
         DROP  R8                  SPQE                                 03356502
         SPACE 3                                                        03356900
*                    DQE/FQE PROCESSING                                 03357300
         SPACE 3                                                        03357700
         USING DQESECT,R4          R4 POINTS TO DQE OR SPQE. CHAIN FLD  03358100
*                                  WILL BE AT +4 REGARDLESS.            03358200
PROCDQE  BAL   RD,RSGETA           GET CORE AND MOVE DQE       @Z30ESHP 03358303
         STCM  R1,M7,DQEPTR+N1     PUT DQE ON CHAIN OFF SPQE            03358400
         LR    R4,R1               UPDATE DQE CHAIN PTR                 03363000
         LR    R9,R1               INIT. FQE CHAIN ANCHOR REG.          03365000
         USING FQESECT,R9          R9 POINTS TO DQE OR FQE. CHAIN FLD.  03367000
*                                  WILL BE AT +0 REGARDLESS.            03367400
RPMGE4   LA    R3,DQFQSIZE         SPECIFY LENGTH OF PREV. BLOCK        03367500
         BAL   RE,RPM500           GET NEXT INPUT BLOCK                 03367600
         CLI   N0(R3),FQECODE      IS IT AN FQE                         03367700
         BNE   RPM6J3              NO, GO BACK AND SEE IF IT'S A DQE    03372300
         BAL   RD,RSGETA           YES, GET CORE AND MOVE FQE  @Z30ESHP 03374303
         STCM  R1,M7,FQEPTR+N1     CHAIN FQE ON FQE CHAIN OFF DQE       03376300
         LR    R9,R1               UPDATE THE FQE CHAIN PTR             03376700
         B     RPMGE4              GO GET NEXT BLOCK.                   03376800
         DROP  R9,R4               FQE AND DQE                          03376902
         EJECT                                                          03377000
*        SUR BUFFER HANDLING ROUTINE.                                   03427000
*                                                                       03437000
*              ASSUMES R3 CONTAINS LENGTH OF PREVIOUS BLOCK.            03447000
*              RETURNS WITH ADDRESS OF CODE BYTE OF NEXT BLOCK IN R3    03457000
*              RETURNS ON RE.                                           03467000
*                                                                       03469000
*              SAVES AND RESTORES GPR'S 4 THRU E.                       03471000
*              RESTORES GPR1 FROM RSCORE TO PRESERVE ADDR OF LAST BLOCK 03473000
*              GETMAINED.                                               03475000
         SPACE                                                          03475400
RPM500   DS    0H                  SUR BUFFER DEBLOCKING ROUTINE        03475800
         STM   R4,RE,RMSAVAR       SAVE REGS IN REPMAIN SAVE AREA       03476200
         LA    RD,RSREGSAV         GET ADDRESS OF S/A FOR READ/CHECK    03476600
         L     R4,RSBFLWA          GET NO. OF BYTES LEFT IN SUR BUF     03476700
         LA    R3,N1(R3)           ADD 1 TO BLOCK LEN. FOR CTL CHAR.    03476800
         SR    R4,R3               COMPUTE NO. OF BYTES LEFT IN BUF.    03476900
         BNP   RPM505              BR. IF NO BYTES LEFT IN BUFFER       03493600
         A     R3,RSBFSTAD         COMPUTE NEXT BLOCK ADDRESS           03503600
         CLI   N0(R3),N0           IS THIS AN IDENTIFIER BYTE           03505600
         BE    RPM505              NO, GO READ THE NEXT RECORD          03507600
RPM506   ST    R3,RSBFSTAD         SAVE ADDRESS OF NEW DATA             03509600
         ST    R4,RSBFLWA          SAVE NO. OF BYTES LEFT IN BUFFER     03510000
         L     R1,RSCORE           RESTORE PTR TO LAST CORE OBTAINED    03510100
         LM    R4,RE,RMSAVAR       RESTORE REGS.                        03510200
         BR    RE                  RETURN TO CALLER                     03515800
         SPACE 3                                                        03517800
RPM505   L     R9,RSAREA1          GET ADDRESS OF SUR BUFFER FROM DECB  03519800
         L     R8,LOCLOCK          GET LOCAL LOCK SWITCH       @ZM33369 03519903
         LTR   R8,R8               IS LOC LOCK HELD            @ZM33369 03520003
         BZ    RPM505A             BRANCH IF NO                @ZM33369 03520103
         BAL   R7,LOCKREL          GO RELEASE LOC LOCK         @ZM33369 03521903
RPM505A  BAL   R8,READRTN          GO READ A RECORD            @ZM33369 03524403
         L     R8,LOCLOCK          DO WE NEED LOCK             @ZM33369 03524803
         LTR   R8,R8               FOR GETMAIN(P)              @ZM33369 03525203
         BZ    RPM505B             BRANCH IF NO                @ZM33369 03525603
         BAL   R7,LOCKGET          GO GET LOCK                 @ZM33369 03526003
RPM505B  LR    R3,R9               SET BLOCK ADDR = START OF BUFFER     03526203
         LA    R4,SURL             INITIALIZE BUFFER LENGTH             03528003
         B     RPM506              CLEAN UP AND RETURN                  03529803
         EJECT                                                          03531603
*        RSGET SUBROUTINE                                               03533403
*              INPUT= SIZE OF BLOCK AND ADDRESS OF DATA TO BE MOVED     03535200
*              OUTPUT= @ OF CORE OBTAINED AND DATA MOVED                03545200
*                                                                       03547200
*        RMSAVAR - CONTAINS LENGTH OF BLOCK TO BE GM'D AND MOVED.       03547600
*        R3 -  ADDRESS OF BLOCK TO BE MOVED - 1.                        03548000
*        RD -  RETURN REG                                               03548400
         SPACE                                                          03548800
RSGET    L     R0,RMBLKSIZ         GET LENGTH TO BE GM'D                03548900
         ICM   R0,M8,RMSP255       SPECIFY SUBPOOL 255                  03549000
         GETMAIN R,LV=(0)          GET THE CORE FROM 255                03549100
RSGETB   ST    R1,RSCORE           SAVE ADDRESS OF GM'D CORE   @Z30ESHP 03553703
         L     RF,RMBLKSIZ         GET THE LENGTH OF THE BLOCK          03555700
         BCTR  RF,R0               ADJUST FOR EXECUTE OF MOVE           03557700
         EX    RF,RM1MOVE          MOVE THE BLOCK                       03558100
         BR    RD                  RETURN TO CALLER                     03558200
RM1MOVE  MVC   N0(N1,R1),N1(R3)    BLOCK MOVER                          03558300
*                                                                       03565203
*   ENTRY PT FOR GETMAIN OF 16 BYTE CELLS FOR VSM BLOCKS       @Z30ESHP 03567203
*                                                                       03569203
RSGETA   IC    R0,RMSP255          SUBPOOL 255 IN BYTE 0       @Z30ESHP 03571203
         L     R7,USERASCB         GET USER'S ASCB ADR         @Z30ESHP 03571703
         GETMAIN P,SP=(R0),BRANCH=YES   GET 16 BYTE CELL       @Z30ESHP 03572003
         B     RSGETB              GO TO SAVE ADR              @Z30ESHP 03579803
         EJECT                                                          03587703
         SPACE 3                                                        03595103
*        READRTN - REPMAIN 1 I/O ROUTINE                                03602503
*                                                                       03609903
*              RETURNS ON GPR 8.                                        03617303
*              ASSUMES ADDRESS OF AREA TO BE READ INTO IS IN GPR 9.     03624703
         SPACE 3                                                        03632103
READRTN  DS    0H                                                Y02076 03639503
         READ  RSDECB1,SF,,(R9),,MF=E READ CIR/SUR               Y02076 03646903
         SPACE 3                                                        03654303
*        CKREAD1 SUBROUTINE - USED TO CHECK DECB1 AND TEST FOR ERROR.   03661700
         SPACE 3                                                        03661902
CKREAD1  CHECK RSDECB1             CHECK IT                             03666500
         CLI   RSRETCOD+N1,ZERO    WAS THERE AN ERROR           YA00153 03666902
         BNE   READER              YES, GO XCTL TO IGC0905B     YA00153 03667302
         BR    R8                  RETURN                               03667502
         SPACE 3                                                        03667600
*        AN I/O ERROR HAS BEEN ENCOUNTERED                              03684300
         SPACE 3                                                        03694300
READER   MVI   RPMXLIST+N4,CHAR9   MAKE XCTL GO TO REPMAIN 5.           03696300
         MVC   RSREGSAV(8),MODID   SAVE NAME OF MODULE THAT    @ZSUT222 03696437
*                                  HAS DETECTED THE ERROR      @ZSUT222 03696837
         STM   0,15,RSREGSAV+8     SAVE CURRENT REGISTERS      @ZSUT222 03697937
         B     RPM504A             GO XCTL.                             03698300
         SPACE 3                                                        03712000
*        REPMAIN 1 SYNAD ROUTINE                                        03725900
         SPACE 3                                                        03735900
SYNAD    MVI   RSRETCOD+N1,ERR035       SET I/O ERROR CODE     @ZSUT222 03737937
         L     R1,RSIOBPT1              GET ADDR OF IOB         YA00153 03738937
         TM    N13(R1),WLR              IS THIS WRONG LEN ERR   YA00153 03739937
         BCR   ZEROES,RE                NO - RETURN             YA00153 03740937
         MVI   RSRETCOD+N1,ERR041       SET WRONG LEN IND      @ZSUT222 03741937
         RETURN                                                         03744302
*                                                                       03744703
*    ROUTINE FOR GETTING LOCAL LOCK FOR GETMAIN/FREEMAIN (P)   @ZM33369 03745103
*                                                                       03745503
LOCKGET  LA    RF,RSREGSAV         GET ADDR REG SAV AREA       @ZM33369 03746303
         STM   RB,RE,N0(RF)        SAV REGS 11-14              @Z30ESHP 03746703
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @Z30ESHP,03746803
               RELATED=(LOCREL,(IGC0505B,LOCKREL))             @Z30ESHP 03749703
         LTR   RD,RD               SETLOCK SUCCESSFUL          @Z30ESHP 03751703
         LM    RB,RE,N0(RF)        RESTORE REGS                @Z30ESHP 03752103
         BZ    RPM600C             BR IF YES                   @Z30ESHP 03752503
         MVI   RSRETCOD+N1,ERR202  SET ERROR CODE 202          @ZSUT222 03752637
         B     READER              BR TO ERROR EXIT            @Z30ESHP 03753037
RPM600C  ST    RF,LOCLOCK          SET LOC LOCK SWITCH         @Z30ESHP 03753237
         BR    R7                  RETURN TO CALLER            @ZM33369 03753403
*                                                                       03753503
*  ROUTINE TO RELEASE LOCAL LOCK BEFORE ENTERING READ ROUTINE  @ZM33369 03753603
*                                                                       03753703
LOCKREL  LA    RF,RMSAVAR+44       GET REG SAV AREA ADDR       @ZSUT222 03753837
         STM   RB,RE,N0(RF)        SAVE REGS 11-14             @Z30ESHP 03754203
         SETLOCK RELEASE,TYPE=LOCAL,                           @Z30ESHP,03754603
               RELATED=(LOCSET,(IGC0505B,LOCKGET))             @ZM33369 03755203
         LM    RB,RE,N0(RF)        RESTORE REGS                @Z30ESHP 03755603
         BR    R7                  RETURN TO CALLER            @ZM33369 03756203
         EJECT                                                          03756703
*        CONSTANTS                                                      03757303
         SPACE 3                                                        03758703
RM2NAME  DC    C'IGC0605B'         NAME OF REPMAIN2                     03761603
MODID    DC    CL8'IGC0505B'       MODULE ID                   @ZSUT222 03762637
RMSP250  DC    AL1(250)            SP NO. TO FREE PIECES OF REGION      03764503
RMSP255  DC    AL1(255)            SUBPOOL 255                          03767403
         SPACE 3                                                        03770302
*        PATCH AREA FOR MAINTENANCE OF 10%                              03772902
         SPACE 3                                                        03775502
PATCH    EQU   *                   END OF MODULE                        03778102
RM1LEN   EQU   PATCH-IGC0505B      LENGTH OF MODULE                     03780702
PATCHLEN EQU   RM1LEN/10           LENGTH OF PATCH AREA REQUIRED        03783302
RM1PATCH DS    CL(PATCHLEN)        PATCH AREA FOR MAINTENANCE           03785902
         SPACE 3                                                        03788502
*        REGISTER EQUATES                                               03791102
         SPACE 3                                                        03793702
R0       EQU   0                   REGISTER 0                           03796302
R1       EQU   1                   REGISTER 1                           03798902
R2       EQU   2                   REGISTER 2                           03801502
R3       EQU   3                   REGISTER 3                           03804102
R4       EQU   4                   REGISTER 4                           03806700
R5       EQU   5                   REGISTER 5                           03816700
R6       EQU   6                   REGISTER 6                           03826700
R7       EQU   7                   REGISTER 7                           03836700
R8       EQU   8                   REGISTER 8                           03846700
R9       EQU   9                   REGISTER 9                           03848700
RA       EQU   10                  REGISTER 10                          03850700
RB       EQU   11                  REGISTER 11                          03852700
RC       EQU   12                  REGISTER 12                          03854700
RD       EQU   13                  REGISTER 13                          03854800
RE       EQU   14                  REGISTER 14                          03854900
RF       EQU   15                  REGISTER 15                          03855000
         SPACE 3                                                        03871100
*        GENERAL EQUATES                                                03881100
         SPACE 3                                                        03883100
N0       EQU   0                   0                                    03885100
N1       EQU   1                   1                                    03887100
N2       EQU   2                   2                                    03887200
N3       EQU   3                   3                                    03892600
N4       EQU   4                   4                                    03894600
N6       EQU   6                   CONSTANT OF 6                 Y02076 03894802
N8       EQU   8                   8                                    03896600
N13      EQU   13                       CONSTANT 13             YA00153 03896702
N16      EQU   16                  16 - SIZE OF DQE/FQE                 03897000
N2048    EQU   2048                2048 - SIZE OF CIR AND ASR RECORDS   03897400
M7       EQU   7                   MASK FOR STORING 3 LO BYTES OF REG   03897800
M8       EQU   8                   MASK FOR ICM TO BYTE 0 OF REG.       03897900
TWOKBLK  EQU   2048                2K CORE                       YM7523 03907902
SPQESIZE EQU   16                  SIZE OF AN SPQE               Y02076 03911302
DQFQSIZE EQU   16                  SIZE OF DQE OR FQE                   03921300
FQECODE  EQU   X'02'               SUR CODE FOR FQE                     03923300
SPQECODE EQU   X'06'               SUR CODE FOR SPQE                    03923700
DQECODE  EQU   7                   SUR CODE FOR DQE                     03924100
ON       EQU   255                 ALL ONES.                            03924500
SURL     EQU   400                 LENGTH OF THE SUR BUFFER      YM7049 03924602
CHAR9    EQU   C'9'                EBCDIC 9                             03924700
ERR035   EQU   35                  I/O ERROR CODE              @ZSUT222 03924837
SP0      EQU   0                   SUBPOOL 0.                           03929300
KEY8     EQU   8                   CONSTANT FOR KEY 8            Y02076 03929502
ZERO     EQU   0                        0 FOR TESTING RET CODE  YA00153 03929902
ZEROES   EQU   8                        COND FOR BCR            YA00153 03930302
WLR      EQU   X'40'                    WRONG LNGTH RECORD      YA00153 03930702
*                                       INDICATION IN IOB       YA00153 03931102
ERR041   EQU   41                       ERROR CODE FOR WRONG   @ZSUT222 03931237
*                                       LENGTH RECORD WHILE     YA00153 03933702
*                                       READING CHKPT DATA SET  YA00153 03935702
CVTADDR  EQU   X'10'               CVT ADDR                    @Z30ESHP 03936103
CURASOFS EQU   X'0C'               OFFSET FOR CURRENT ASCB     @Z30ESHP 03936203
ERR202 EQU     202                 SETLOCK ERROR CODE          @ZSUT222 03936337
         EJECT                                                          03936502
*              DESCRIPTION OF REPMAIN WORK AREA                         03939002
         SPACE 3                                                        03941502
RPMWA1   DSECT                     REPMAIN WORK AREA DSECT              03944002
RPMERAS1 DS    F                   TEMP SAVE AREA                Y02076 03946502
RMNEOV   DS    A                   RESERVED                             03949002
RSBFSTAD DS    A                   BUFFER POINTERS                      03951502
RSBFLWA  DS    A                   *                                    03954000
RPMMSS1  DS    A                   ADDRESS OF NEW STC MSS CHAIN         03964000
RPMMSS2  DS    A                   ADDRESS OF NEW INIT MSS CHAIN        03964400
RPMMSS3  DS    A                   ADDRESS OF NEW P/P MSS CHAIN         03964800
RPMRB    DS    A                   ADDRESS OF RESTORED RB CHAIN         03965200
RPMLLE   DS    A                   ADDRESS OF RESTORED LLE CHAIN        03965600
RPMCDE   DS    A                   ADDRESS OF RESTORED CDE CHAIN        03965700
RPMDEB   DS    A                   ADDRESS OF RESTORED DEB CHAIN        03969500
RPMFOE   DS    A                   ADDRESS OF RESTORED FOE CHAIN        03971500
RSCORE   DS    A                   ADDRESS OF CORE ACQUIRED BY LAST GM  03971900
RSW001   DS    F                   *                                    03972300
RSW002   DS    F                   *                                    03972700
RPMSQE   DS    A                   ADDRESS OF DEQUEUED SPQE CHAIN       03973100
SWITCH   DS    F                   I/O SWITCH WORD                      03973200
LSPQE    EQU   4                   LAST SPQE FOR THIS TASK FLAG         03979100
RPMN40AD DS    A                   SET TO ADDRESS OF RPMXLIST           03979500
RPMXLIST DS    2F                  NAME OF NEXT MODULE TO GET CONTROL   03979900
RPMCESA  DS    F                   CURRENT ENTRY START ADDRESS          03980300
RPMRGEND DS    F                   ADDRESS OF END OF REGION             03980700
RMSAVAR  DS    15F                 REG SAVE FOR RPM500 RTN     @ZSUT222 03980837
RMBLKSIZ DS    F                   SIZE OF BLOCK TO BE GETMAINED.       03983737
RSSTCSP0 DS    F                   ADDR OF STC SPQE FOR SP 0.           03984700
RPMWAEND EQU   *                   END OF REPMAIN WORK AREA             03986700
         EJECT                                                          03987100
*              DSECT USED FOR ASR HEADER                                03987500
         SPACE 3                                                        03987900
ASRHDR   DSECT                                                          03988300
ASRCOUNT DS    H                   NUMBER OF ENTRIES IN ASR RECORD      03988400
ASRFLG1  DS    X                   ASR FLAG BYTE                        03988500
ASRLAST  EQU   X'80'               LAST ASR RECORD                      04023700
ASRRESV  DS    5X                  RESERVED                             04033700
         EJECT                                                          04043700
         IEEVRSWA                                                       04053700
USERASCB EQU   RSERAS00            USER ASCB ADDR              @Z30ESHP 04054103
LOCLOCK  EQU   RSERAS01            LOCAL LOCK HELD SWITCH      @Z30ESHP 04054503
         EJECT                                                          04055700
         IHAPSA                                                @Z30ESHP 04055803
         CVT                                                   @Z30ESHP 04056103
         IHAGDA                                                @Z30ESHP 04056503
         IHALDA                                                @Z30ESHP 04057303
         IHAWSAVT                                              @Z30ESHP 04057403
         IKJTCB                                                         04057700
         EJECT                                                          04058100
         IHAPQE                                                         04058500
         SPACE 5                                                        04058900
         IHASPQE                                                        04059000
         SPACE 5                                                        04059100
         IHADQE                                                         04070800
         SPACE 5                                                        04080800
         IHAFQE                                                         04081200
         EJECT                                                          04081600
         IHADCB DSORG=(BS,PO),DEVD=(DA,TA)                              04082000
         END                                                            04082437
