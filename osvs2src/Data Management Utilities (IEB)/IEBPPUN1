         TITLE 'IEBPPUN109--ROOT SEGMENT OF IEBPTPCH'                   00020000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 00040000
*                                                                     * 00060000
* IEBPPUN1     ROOT SEGMENT OF PRINT/PUNCH                              00080000
*                                                                       00100000
* THE PRINT-PUNCH PROGRAM IS BROKEN DOWN INTO FIVE MODULES WHICH IN     00120000
* TURN ARE PUT IN AN OVERLAY STRUCTURE. THE ROOT SEGMENT IS MADE UP OF  00140000
* TWO MODULES: IEBPPUN1,WHICH GETS INITIAL CONTROL; AND IEBPPMSG, WHICH 00160000
* IS THE ERROR MESSAGE MODULE. ONE LEG OF THE OVERLAY TREE IS MADE UP   00180000
* OF TWO MODULES: IEBPPALI, WHICH IS THE CONTROL CARD ANALYSER ROUTINE; 00200000
* AND IEBCCS02, WHICH IS THE CONTROL CARD SCAN ROUTINE. THE OTHER LEG   00220000
* OF THE OVERLAY TREE IS THE MAIN PROCESSING MODULE IEBPPCH1.           00240000
*                                                                       00260000
* IEBPPUN1                                                              00280000
*                                                                       00300000
* THIS MODULE GETS INITIAL CONTROL, AND THEREFORE DOES ALL THE INVOKER  00320000
* CHECKING. IF THE PROGRAM IS INVOKED, THIS MODULE DIAGNOSES THE THREE  00340000
* POSSIBLE PARAMETER LISTS THAT CAN BE PASSED. THEN THIS MODULE CALLS   00360000
* THE CONTROL CARD SCAN ROUTINE WHICH IN CONJUNCTION WITH THE CONTROL   00380000
* CARD ANALYSER PROCESSES THE CONTROL STATEMENTS FOR PRINT/PUNCH.       00400000
* RETURN COMES TO IEBPPUN1 WHICH IN TURN CALLS THE MAIN PROCESSING      00420000
* MODULE OF PRINT PUNCH. THE FINAL RETURN TO THE SCHEDULER IS DONE FROM 00440000
* THIS MODULE. IEBPPUN1 CONTAINS ALL SYSPRINT INFORMATION AND PROVIDES  00460000
* FOR WRITING ALL ERROR MESSAGES. THIS MESSAGE WRITER ALSO INCLUDES THE 00480000
* FACILITIES TO PRINT A HEADER ON EACH PAGE WITH ASCENDING PAGE         00500000
* NUMBERS. TO USE THIS MESSAGE WRITER, THE FOLLOWING LINKAGE CONVENTION 00520000
* MUST BE FOLLOWED.                                                     00540000
* REGISTER 0 MUST CONTAIN THE LENGTH OF THE MESSAGE.                    00560000
* REGISTER 1 MUST CONTAIN THE ADDRESS OF THE MESSAGE.                   00580000
* BAL 14,ZZPR MUST BE USED TO LINK TO ZZPR WHICH IS THE NAME OF THE     00600000
* MESSAGE WRITER ROUTINE.                                               00620000
* THIS MODULE ALSO CONTAINS A DUMMY DCB AND THE DCB FOR SYSPRINT.       00640000
*                                                                       00660000
*                                                                       00680000
*        ENTRY POINT     IEBPTPCH                                       00700000
*                                                                       00720000
*        INPUT           IF INVOKED, THIS MODULE WILL SET UP THE        00740000
*                        DDLIST AND SET THE APPROPRIATE SWITCHES.       00760000
*                                                                       00780000
*        OUTPUT          ALL DIAGNOSTICS AND INFORMATIONAL MESSAGES     00800000
*                        ARE PRINTED.                                   00820000
*                                                                       00840000
*        EXTERNAL RTNS   THIS MODULE CALLS THE CONTROL CARD ANALYSER    00860000
*                        MODULE AND THE MAIN PROCESSOR MODULE.          00880000
*                                                                       00900000
*        EXITS           THIS MODULE DOES A FINAL RETURN AT EOJ.        00920000
*                                                                       00940000
*        WORK AREAS      THIS MODULE OBTAINS CORE FOR AN INFORMATION    00960000
*                        TABLE TO BE SET UP BY THE ANALYSER AND USED BY 00980000
*                        THE MAIN PROCESSOR.                            01000000
*                                                                       01020000
*        ATTRIBUTES      NON-REUSABLE                                   01040000
*                                                                       01060000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 01080000
         EJECT                                                          01100000
IEBPTPCH CSECT                                                          01120000
*0118088800-091000,091600,094000,095600-095800                     BS0H 01130017
*037000,054600                                                    24304 01131019
*093000                                                           29476 01132019
*094920-094950,095800                                             27715 01135019
*A030300                                                         A38794 01137421
*C031200,032000,066200                                           A38794 01137821
*D030400,030600,030800                                           A38794 01138221
*A041760-041780,041900                                           A41816 01139021
*D041760                                                         A41816 01139521
*C041706                                                        OY01168 01139716
*C078600-079000,079800,086000,093600                           @ZA07383 01139899
*D085000,085200                                                @ZA07383 01139999
         ENTRY PRPCH                                                    01140000
*                                                                       01160000
R0       EQU   0                                                        01180000
RZ       EQU   0                                                        01200000
R1       EQU   1                                                        01220000
R2       EQU   2                                                        01240000
R3       EQU   3                                                        01260000
R4       EQU   4                                                        01280000
DCBREG   EQU   5                                                        01300000
RLEN     EQU   7                                                        01320000
R8       EQU   8                                                   BS0H 01330017
BASER    EQU   9                                                        01340000
R13      EQU   13                                                       01360000
R14      EQU   14                                                       01380000
R15      EQU   15                                                       01400000
*                                                                       01420000
DDU1     EQU   58                                                       01440000
DDU2     EQU   66                                                       01460000
DDIN     EQU   34                                                       01480000
DDPR     EQU   42                                                       01500000
*                                                                       01520000
PRPCH    SAVE  (14,12),T,IEBPPUN1-JULY-1966                             01540000
         BALR  BASER,R0                                                 01560000
         USING *,BASER             ESTABLISH ADDRESSABILITY             01580000
         ST    R13,SAVEREG+4                                            01600000
         LA    R1,SAVEREG               GET PTR TO SAVE AREA            01620000
         ST    R1,8(R13)                STORE PTR TO S.A. IN SAVE AREA  01640000
         L     R1,24(R13)               RESTORE R1                      01660000
         LA    R13,SAVEREG         SET UP SAVE AREA FOR CALLED ROUTINE  01680000
         MVI   PPTBLE,X'0'         INITIALIZE PRINT/PUNCH TABLE         01700000
         MVC   PPTBLE+1(PPTLEN-1),PPTBLE  TO ZEROES                     01720000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 01740000
*                                                                       01760000
* THIS ROUTINE CHECKS THE PARAMETER LISTS PASSED WHEN THE PROGRAM IS    01780000
* INVOKED. REGISTER 1 POINTS TO A THREE FULL WORD AREA IN CORE WHICH    01800000
* CONTAINS ADDRESSES OF THE THREE POSSIBLE PARAMETER LISTS. THE HIGH    01820000
* ORDER BYTE OF EACH OF THE FULL WORDS MUST BE EITHER HEX 00 OR HEX     01840000
* 80. THE 80 SIGNIFIES THAT THIS IS THE LAST PARAMETER LIST POINTER.    01860000
* THE FIRST POINTER IS TO THE LIST THAT EQUALS THE PARM VALUES FOUND ON 01880000
* THE EXECUTE CARD, AND IT DOES NOT APPLY TO THIS UTILITY. THE SECOND   01900000
* POINTER IS TO THE DDNAME LIST WHICH MUST BEGIN ON A HALF WORD         01920000
* BOUNDARY THAT IS NOT ALSO A FULL WORD BOUNDARY. THE TWO HIGH ORDER    01940000
* BYTES CONTAIN A COUNT OF THE NUMBER OF BYTES IN THE REMAINDER OF THE  01960000
* LIST. ALL ENTRIES IN THE LIST HAVE A MAXIMUM LENGTH OF EIGHT BYTES    01980000
* AND ARE LEFT JUSTIFIED AND PADDED WITH BLANKS. IF A NAME IS OMITTED   02000000
* WITHIN THE LIST, THE EIGHT-BYTE ENTRY MUST CONTAIN BINARY ZEROES.     02020000
* NAMES ARE OMITTED FROM THE END BY SHORTENING THE LIST. THE SEQUENCE   02040000
* OF THE ENTRIES IS AS FOLLOWS:                                         02060000
*                                                                       02080000
*              ENTRY 1    00000000                                      02100000
*                    2    00000000                                      02120000
*                    3    00000000                                      02140000
*                    4    00000000                                      02160000
*                    5    SYSIN                                         02180000
*                    6    SYSPRINT                                      02200000
*                    7    00000000                                      02220000
*                    8    SYSUT1                                        02240000
*                    9    SYSUT2                                        02260000
*                                                                       02280000
* THE THIRD PARAMETER LIST PERTAINS TO HEADER INFORMATION               02300000
*                                                                       02320000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 02340000
         TM    0(R1),X'80'         IS THIS THE LAST PARAMETER LIST PTR  02360000
         BO    PPHDRS              YES, THIS IS THE LAST PARAMETER LIST 02380000
*                                  PTR, AND ZEROES NOT CHECKED          02400000
         L     R2,4(R1)            OBTAIN ADDRESS OF DDNAME LIST        02420000
         LH    RLEN,0(R2)          PUT LENGTH OF DDNAME LIST IN REG     02440000
         LTR   RLEN,RLEN           IS LENGTH EQUAL TO ZERO              02460000
         BE    TESTEND             YES, PROCEED TO CHECK FOR A THIRD    02480000
*                                  PARAMETER LIST PTR                   02500000
         CH    RLEN,PH40           IS LENGTH LESS THAN OR EQUAL TO 40   02520000
         BL    TESTEND             YES, CHECK FOR THIRD PARAMETER LIST  02540000
         CLI   DDIN(R2),X'00'      IS THERE A SYSIN DDNAME              02560000
         BE    PPRDD4    NO, CONTINUE TO TEST SECOND                    02580000
*                                  PARAMETER LIST                       02600000
         MVC   PPSYSI(8),DDIN(R2)  MOVE SYSIN DDNAME TO PPDDNAM+24      02620000
PPRDD4   CH    RLEN,PH48           IS LENGTH LESS THAN OR EQUAL TO 48   02640000
         BL    TESTEND             YES, CHECK FOR THIRD PARAMETER LIST  02660000
         CLI   DDPR(R2),X'00'      IS THERE A SYSPRINT DDNAME           02680000
         BE    PPRDD8              NO, CONTINUE TO TEST SECOND          02700000
*                                  PARAMETER LIST                       02720000
         LA    DCBREG,PPOUT        LOAD REGISTER WITH ADDRESS OF DCB    02740000
         MVC   DDNAM(8,DCBREG),DDPR(R2) MOVE DDNAME FROM LIST TO DCB    02760000
PPRDD8   CH    RLEN,PH64           IS THERE A SYSUT1 DDNAME             02780000
         BL    TESTEND             NO, CHECK FOR THIRD PARAMETER LIST   02800000
         MVC   PPUT1(8),DDU1(R2)   MOVE SYSUT1 DDNAME TO TABLE          02820000
         CH    RLEN,PH72           IS THERE A SYSUT2 DDNAME             02840000
         BL    TESTEND             NO, CHECK FOR THIRD PARAMETER LIST   02860000
         MVC   PPUT2(8),DDU2(R2)   MOVE SYSUT2 DDNAME TO TABLE          02880000
TESTEND  TM    4(R1),X'80'         IS THIS THE LAST PARAMETER LIST PTR  02900000
         BO    PPHDRS              YES, BRANCH TO HEADER ROUTINE        02920000
         MVC   PPHEADER(120),PPHDRBL CLEAR HEADER                       02940000
         L     R2,8(R1)            LOAD ADDRESS OF HEADER INFORMATION   02960000
         LH    RLEN,0(R2)          LOAD LENGTH OF HEADER INTO REGISTER  02980000
         LTR   RLEN,RLEN           IS LENGTH EQUAL TO ZERO              03000000
         BE    PPHDRS              NO, REDUCE LENGTH BY ONE             03020000
          B     PPHNMOV       BRANCH TO HEADE ROUTINE            A38794 03030021
PPHDRS   SR    RLEN,RLEN           INITIALIZE LENGTH REGISTER TO ZERO   03100000
PPHNMOV  MVC   PPHEADER(32),PHDR   SET UP STANDARD HEADER        A38794 03120021
         MVC   PPHDPAGE(9),PAGE    SET UP PAGE NUMBER                   03140000
         CH    RLEN,PH4                 IS LENGTH LESS THAN 4           03160000
         BL    PPROPEN             YES, BRANCH TO OPEN OUTPUT           03180000
         MVC   PPHDNO(4),2(R2)         SET UP HEADER NUMBER      A38794 03200021
PPROPEN  OPEN  (PPOUT,OUTPUT)      OPEN PRINTER DCB                     03220000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 03240000
* IF THE SYSPRINT DCB HAS NOT BEEN OPENED, RETURN WITH A CONDITION CODE 03260000
* OF 12 AND NO ERROR MESSAGE. ALL INFORMATION NUMBERS EXCEPT HEADER     03280000
* INFORMATION NUMBERS ARE LESS THAN 512. WHEN THE REGISTERS ARE SAVED   03300000
* IN ZZPR, TWO BYTES FROM RZ ARE STORED IN ZZSW. IF 512 WAS PUT IN RZ   03320000
* TO INDICATE HEADER INFORMATION, THIS WILL APPEAR AS X'02' IN ZZSW.    03340000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 03360000
         LA    R1,PPOUT            LOAD ADDRESS OF PTR DCB              03380000
         TM    OFLGS(R1),X'10'     WAS DCB OPENED                       03400000
         BZ    DDERROR             NO, BRANCH TO ERROR ROUTINE          03420000
         TM    DFLG,X'10'               IS BLKSIZE ERROR FLAG SET  BS0H 03426017
         BC    1,DDERROR                YES, BRANCH TO ERROR RTN   BS0H 03432017
         LA    R1,PPHEADER         YES, LOAD HEADER ADDRESS IN REGISTER 03440000
         LA    RZ,HEADER           LOAD MESSAGE LENGTH INTO REGISTER    03460000
         BAL   R14,ZZPR            BRANCH TO MESSAGE WRITER             03480000
         L     R1,SAVEREG+4                                             03500000
         L     R1,24(R1)           RESTORE REGISTER 1                   03520000
         TM    0(R1),X'80'         IS THIS LAST PARAMETER LIST PTR      03540000
         BO    CALLANAL            YES, BRANCH                          03560000
*                                                                       03580000
         LH    RLEN,0(R2)          IS THERE CONTROL INFORMATION         03600000
         LTR   RLEN,RLEN                                                03620000
         BNH   CALLANAL            THERE ARE CONTROL CARDS              03640000
         CLC   2(2,R2),PPINT       ARE THERE INTERNAL PARAMETERS        03660000
         BE    PPINTERN            YES, BRANCH                          03680000
CALLANAL LA    1,FREECORE          GET ADDRESS OF FREECORE TABLE   4304 03690019
         ST    1,FREE@             SAVE ADDR AND PASS IT TO PPAL1  4304 03700019
         CALL  IEBPPAL1,(PPSYSI,FREE@)    CALL ANALYZER ROUTINE    4304 03710019
*                                                                       03720000
         LTR   R15,R15             IS THERE A RETURN CODE               03740000
         BE    POSTSCAN            NO MESSAGES                          03760000
         STC   R15,PPCONCD         STORE RETURN CODE                    03780000
         CLI   PPCONCD,X'0C'       HAS THE DCB BEEN OPENED PROPERLY     03800000
         BNL   PPTERM              NO, CLOSE AND RETURN                 03820000
*                                                                       03840000
POSTSCAN ST    R1,PPTBLEAD         STORE MESSAGE ADDRESS                03860000
*                                                                       03880000
PRECALL  MVC   N1DD(8,R1),PPUT1    PREPARE PARAMETER TABLE BY MOVING    03900000
         MVC   N2DD(8,R1),PPUT2    DDNAMES SYSUT1 AND SYSUT2            03920000
*                                                                       03940000
         CALL  IEBPPCH1            CALL PRINT/PUNCH ROUTINE             03960000
*                                                                       03980000
         SR    R4,R4               INITIALIZE REGISTER TO ZERO          04000000
         IC    R4,PPCONCD          ENTER PRINT/PUNCH CONDITION CODE     04020000
         CR    R4,R15              IS CONDITION CODE RETURNED FROM      04040000
*                                  PRPUN LESS THAN THE CONDITION CODE   04060000
*                                  RETURNED FROM PPANAL                 04080000
         BC    10,PPTERM           NO, CLOSE AND RETURN                 04100000
PPDDTERM STC   R15,PPCONCD         YES, STORE NEW CONDITION CODE        04120000
*                                                                       04140000
PPTERM   TM    GOTMAIN,X'10'       TEST FOR STORAGE GOTTEN         4304 04140919
         BC    8,PPTERM1           NO - SKIP FREEMAIN              4304 04141819
         L     RZ,AREASIZE         GET TBLE SIZE TO FREEE          4304 04142719
         L     R1,PPTBLEAD         GET TBLE ADDR TO FREE           4304 04143619
         FREEMAIN  R,A=(1),LV=(0)  FREE DYNAMIC CORE               4304 04144519
PPTERM1   TM   GOTMAIN1,X'10'      TEST FOR GET MAIN               4304 04145419
         BC    8,PPRET2            IF NO BRANCH                    4304 04146319
         L     RZ,DTBLENG          GET LENGTH IN REG 0             4304 04147219
         L     R1,DTBADDR          GET DTBLE ADDR TO FREE          4304 04148119
         MVI   GOTMAIN1,X'00'      RESET SWITCH                    4304 04149019
         FREEMAIN   R,A=(1),LV=(0)    FREE DTBLE CORE              4304 04149919
PPRET2   TM    GOTMAIN2,X'10'      TEST FOR GET MAIN               4304 04150819
         BC    8,PPRET3            IF NO - BRANCH                  4304 04151719
         L     RZ,GS1LENG          GET LENGTH IN REG               4304 04152619
         L     R1,MNTADD2          GET ADDRESS IN REGISTER         4304 04153519
         MVI   GOTMAIN2,X'00'      RESET SWITCH TO FREE            4304 04154419
         FREEMAIN  R,A=(1),LV=(0)     FREE MNT CORE                4304 04155319
PPRET3   TM    GOTMAIN3,X'10'      TEST FOR MCB GET MAIN           4304 04156219
         BC    8,PPRET4            IF NO THEN BRANCH               4304 04157119
         L     RZ,MCBLEN2          GET LENGTH OF MCB AREA          4304 04158019
         L     R1,MCBADD2          GET ADDR OF MCB AREA            4304 04158919
         MVI   GOTMAIN3,X'00'      RESET SWITCH TO FREE            4304 04159819
         FREEMAIN  R,A=(1),LV=(0)    FREE MCB CORE                 4304 04160719
PPRET4   TM    GOTMAIN4,X'10'      TEST FOR LITERAL GET MAIN       4304 04161619
         BC    8,PPRET5            IF NONE BYPASS FREE             4304 04162519
         L     RZ,LITSAV           GET LENGTH OF LITS IN REG 0     4304 04163419
         L     R1,LITADD2          GET ADDR OF LITS IN REG 1       4304 04164319
         MVI   GOTMAIN4,X'00'      RESET SWITCH FOR FREED          4304 04165219
         FREEMAIN   R,A=(1),LV=(0)     FREE LITERALS AREA          4304 04166119
PPRET5   TM    GOTMAIN5,X'10'      TEST FOR TITLE GET MAIN         4304 04167019
         BC    8,PPRET6            IF NONE THEN BYPASS FREE        4304 04167919
         L     R1,TITLADD2         GET TITLE ADDR IN REG 1         4304 04168819
         MVI   GOTMAIN5,X'00'      SET SWITCH TO FREE              4304 04169719
         FREEMAIN   R,A=(1),LV=144     FREE TITLE CORE          OY01168 04170616
PPRET6   TM    GOTMAIN6,X'10'      TEST FOR  SUBTITLE STORAGE      4304 04171519
         BC    8,PPRET7            IF NONE BYPASS FREE             4304 04172419
         L     R1,STITLADD         ELSE GET ADDR OF SUBTITLE       4304 04173319
         MVI   GOTMAIN6,X'00'      TURN OFF SWITCH                 4304 04174219
         FREEMAIN  R,A=(1),LV=120      FREE SUBTITLE CORE          4304 04175119
PPRET7   LA    R1,PPOUT            LOAD ADDR. OF OUTP. DCB       A41816 04176021
         TM    OFLGS(R1),X'10'     WAS DCB OPENED ?              A41816 04176521
         BZ    RETSYS              NO, DO NOT CLOSE              A41816 04177021
         CLOSE (PPOUT)             CLOSE OUTPUT DCB              A41816 04177521
         FREEPOOL  PPOUT           FREEPOOL PPOUT BUFFER CORE    A41816 04178021
*                                                                       04180000
RETSYS   EQU   *                                                 A41816 04190021
         SR    R15,R15             CLEAR REGISTER 15 AND                04200000
         IC    R15,PPCONCD         ENTER THE STORED CONDITION CODE      04220000
         L     R13,SAVEREG+4       RESTORE REGISTERS AND RETURN CONTROL 04240000
         RETURN (14,12),RC=(15)    TO THE CALLING PROGRAM               04260000
*                                                                       04280000
DDERROR  MVI   PPCONCD,X'0C'       SET CONDITION CODE TO 12             04300000
         B     PPTERM              CLOSE AND RETURN                     04320000
*                                                                  BS0H 04321017
*                         DCB EXIT ROUTINE                         BS0H 04322017
*                                                                  BS0H 04323017
DCBEXIT  LA    R1,PPOUT                                            BS0H 04324017
         USING IHADCB,R1                                           BS0H 04325017
         CLI   DCBLRECL+1,X'00'   IS LRECL FILLED IN               1825 04325421
         BNE   *+8                YES.. GO ON                      1825 04325821
         MVI   DCBLRECL+1,X'79'   GET DEFAULT VALUE                1825 04325921
         LH    R3,DCBBLKSI              LOAD SYSPRINT BLOCKSIZE    BS0H 04326017
         LTR   R3,R3                                               BS0H 04327017
         BC    2,TESTBLK                TEST BLOCKSIZE             BS0H 04328017
         MVI   DCBBLKSI+1,X'79'         INSERT DCB BLKSIZE         BS0H 04329017
         BCR   15,R14                   RETURN                     BS0H 04330017
TESTBLK  SR    R2,R2                    TEST FOR MODULAR BLOCKSIZE BS0H 04331017
         LA    R4,121                                              BS0H 04332017
         DR    R2,R4                                               BS0H 04333017
         LTR   R2,R2                                               BS0H 04334017
         BCR   8,R14                    IF MODULAR, RETURN         BS0H 04335017
         MVI   DFLG,X'10'               SET BLKSIZE ERROR FLAG     BS0H 04336017
         MVC   DCBBLKSI(2),DCBLRECL     MOVE LRECL TO BLKSIZE      BS0H 04337017
         DROP  R1                                                  BS0H 04338017
         RETURN                                                         04339017
*                                                                       04340000
*                                                                       04360000
*        PROCESS INTERNAL PARAMETER LIST                                04380000
*                                                                       04400000
         ENTRY PPDDTERM                                                 04420000
*                                                                       04440000
PPINTERN LA    R4,10                                                    04460000
         SR    RLEN,R4             SUBTRACT 10 FROM RECORD LENGTH       04480000
         LA    RZ,UTBLEN           OBTAIN TABLE LENGTH                  04500000
         CR    RLEN,RZ             IS RECORD LENGTH GREATER THAN        04520000
*                                  TABLE LENGTH                         04540000
         BNH   PPNO                NO, INVALID TABLE LENGTH             04560000
         ST    RZ,AREASIZE         STORE SIZE OF GET MAIN AREA     4304 04570019
         MVI   GOTMAIN,X'10'       SET SWITCH FOR LATER FREE       4304 04580019
         GETMAIN   R,LV=(0)           OBTAIN  CORE FOR WORKAREA    4304 04590019
         ST    R1,PPTBLEAD         STORE ADDRESS OF AREA ACQUIRED       04600000
         LA    R2,10(R2)           UPDATE POINTER TO INTERNAL PARAMETER 04620000
         USING DUTBLE,R2           ESTABLISH ADDRESSABILITY TO TABLES   04640000
         USING DTABLE,R1                                                04660000
*                                                                       04680000
         MVI   TABLE,0             INITIALIZE TABLE TO ZEROES           04700000
         MVC   TABLE+1(TABLEN-1),TABLE                                  04720000
         EJECT                                                          04740000
*                                                                       04760000
*        CONSTRUCT TABLE TO BE EXAMINED BY IEBPPCH1                     04780000
*                                                                       04800000
         MVC   EXLSTADD(4),UEXLADD SET EXIT LIST ADDRESS                04820000
         MVC   LITADD(4),ULITADD   MOVE IN USER LITERAL POOL ADDRESS    04840000
         MVC   MNTADD(4),UMNTADD   MOVE IN MEMBER NAME TABLE ADDRESS    04860000
         L     R4,URCBADD          LOAD ADDRESS OF SWITCHES TO TEST     04880000
         MVC   RCB(RCBLEN),0(R4)   MOVE IN SWITCHES TO TEST             04900000
         L     R4,UTCBADD          LOAD ADDRESS OF TABLE CONTROL BLOCK  04920000
         MVC   TCB(TCBLEN),0(R4)   MOVE IN TABLE CONTROL BLOCK          04940000
*                                                                       04960000
         L     R4,MNTADD           LOAD MEMBER NAME TABLE ADDRESS       04980000
         L     R4,0(R4)            OBTAIN FIRST WORD OF TABLE           05000000
         TM    TYPORG,X'02'        TEST TYPE ORGANIZATION               05020000
         BZ    PPINTA              NO NAMED PDS                         05040000
         LTR   R4,R4               IS THIS A PARTIAL PDS                05060000
         BNH   PPNO                YES, NO NAMED MEMBERS, BRANCH        05080000
         B     PPINTB              NO, BRANCH                           05100000
PPINTA   LTR   R4,R4               IS THIS A TOTAL PDS                  05120000
         BH    PPNO                YES, BRANCH                          05140000
*                                                                       05160000
PPINTB   SR    R4,R4               INITIALIZE REGISTER TO ZERO          05180000
         LA    R3,120              LOAD RECORD LENGTH INTO REGISTER     05200000
         CH    R4,TCB1             IS THERE A TITLE                     05220000
         BE    PPINTC              NO, BRANCH                           05240000
         LH    R2,TCB1             DETERMINE THE LENGTH OF              05260000
         AH    R2,TCB1+2           THE TITLE                            05280000
         CR    R2,R3               IS TITLE LENGTH GREATER THAN 120     05300000
         BH    PPNO                YES, INVALID TITLE                   05320000
PPINTC   CH    R4,TCB2             IS THERE A SUBTITLE                  05340000
         BE    PPINTD              NO, BRANCH                           05360000
         LH    R2,TCB2             DETERMINE LENGTH OF SUBTITLE         05380000
         AH    R2,TCB2+2                                                05400000
         CR    R2,R3               IS SUBTITLE LENGTH GREATER THAN 120  05420000
         BH    PPNO                YES, INVALID SUBTITLE                05440000
PPINTD   LA    1,FREECORE          GET ADDR OF FREECOR TABLE       4304 05450019
         ST    1,FREE@             SAVE ADDR AND PASS IT TO PPAL1  4304 05460019
         CALL  IEBPPAL1,(PPSYSI,FREE@),VL     ANALYZE CONTROL CARDS4304 05470019
         L     R1,PPTBLEAD         LOAD ADDRESS OF PRINT/PUNCH TABLE    05480000
         B     PRECALL             BRANCH                               05500000
*                                                                       05520000
PPNO     LA    R1,PPINVLD          LOAD POINTER                         05540000
         SLL   R1,8                MOVE POINTER TO ALLOW SPACE FOR ID   05560000
         LA    RZ,PPINVAL          LOAD ID CODE                         05580000
         AR    R1,RZ               PUT ID CODE IN SAME REG AS POINTER   05600000
         LA    R15,PPMSGWRT        OBTAIN ADDRESS OF MESSAGE WRITER     05620000
         BALR  R14,R15             PRINT OUT THE APPROPRIATE MESSAGE    05640000
         MVI   PPCONCD,X'0C'       SET CONDITION CODE                   05660000
         B     PPTERM              CLOSE AND RETURN                     05680000
         EJECT                                                          05700000
*                                                                       05720000
*                                                                       05740000
PHMOV    MVC   PPHEADER(1),2(R2)   MOVE HEADER INFORMATION              05760000
*                                                                       05780000
*        FORMAT FOR HEADER LABEL                                        05800000
PPHDRBL  DC    C' '                CONTROL INDICATOR                    05820000
PPHEADER DC    2C' '                                                    05840000
         DC    3CL32' '                                                 05860000
PPHDPAGE DC    C'PAGE '                                                 05880000
PPHDNO   DC    CL17'0001'                                               05900000
*                                                                       05920000
*                                                                       05940000
PAGE     DC    C'PAGE 0001'                                             05960000
PHDR     DC    CL32'PRINT/PUNCH DATA SET UTILITY'                       05980000
SAVEREG  DS    18F                 SAVE AREA                            06000000
*                                                                       06020000
PPTBLEAD DS    F'0'                PRINT/PUNCH TABLE ADDRESS            06040000
FREE@    DC    F'0'          FREE CORE TABLE ADDR PASSED TO PPAL1  4304 06040719
GOTMAIN  DC    X'00'         INDICATES  GETMAIN DONE IN PPUN1           06041419
AREASIZE DC    F'0'          SIZE OF TABLE IN PPUN1                4304 06042119
*                                                                  4304 06042819
*   FREECORE TABLE CONTAINS DATA TO FREE MAIN STORAGE FOR DTABLE   4304 06043519
*                                                                  4304 06044219
FREECORE DS    0F                                                  4304 06044919
DTBLENG  DC    F'0'                LENGTH OF DTABLE                4304 06045619
DTBADDR  DC    F'0'                ADDRESS OF DTABLE               4304 06046319
GS1LENG  DC    F'0'                MNT LENGTH                      4304 06047019
MNTADD2  DC    F'0'                ADDRESS OF MNT                  4304 06047719
MCBLEN2  DC    F'0'                LENGTH OF MCB                   4304 06048419
MCBADD2  DC    F'0'                ADDR OF MCB                     4304 06049119
LITSAV   DC    F'0'                LENGTH OF LITERALS              4304 06049819
LITADD2  DC    F'0'                ADDRESS OF LITERALS             4304 06050519
TITLADD2 DC    F'0'                ADDRESS OF TITLE                4304 06051219
STITLADD DC    F'0'                ADDRESS OF SUBTITLE             4304 06051919
*                                                                  4304 06052619
*        SWITCHES TO INDICATE WHICH GETMAINS WERE EXECUTED         4304 06053319
*                                                                  4304 06054019
GOTMAIN1 DC    X'00'          DTABLE                               4304 06054719
GOTMAIN2 DC    X'00'          MNT                                  4304 06055419
GOTMAIN3 DC    X'00'          MCB                                  4304 06056119
GOTMAIN4 DC    X'00'          LITERALS                             4304 06056819
GOTMAIN5 DC    X'00'          TITLE                                4304 06057519
GOTMAIN6 DC    X'00'          SUBTITLE                             4304 06058219
*                                                                       06060000
PPTBLE   DS    0X                                                       06080000
PPDDNAM  DS    4D                  DDNAME LIST IN PRINT/PUNCH TABLE     06100000
PPCONCD  DC    X'0'                CONDITION CODE INDICATOR             06120000
PPTLEN   EQU   *-PPTBLE            LENGTH OF PRINT/PUNCH TABLE          06140000
*                                                                       06160000
PPINT    DC    C'IN'                                                    06180000
PPUT1    EQU   PPDDNAM                                                  06200000
PPUT2    EQU   PPDDNAM+8                                                06220000
PPSYSI   EQU   PPDDNAM+24                                               06240000
*                                                                       06260000
*        CONSTANTS USED TO DETERMINE DDNAME LIST LENGTH                 06280000
PH4      DC    H'4'                                                     06300000
PH40     DC    H'40'                                                    06320000
PH48     DC    H'48'                                                    06340000
PH64     DC    H'64'                                                    06360000
PH72     DC    H'72'                                                    06380000
         EJECT                                                          06400000
*                                                                       06420000
         USING *,R15                                                    06440000
*                                                                       06460000
         ENTRY PPMNMSG                                                  06480000
PPMNMSG  LR    RZ,R1               PRESERVE CONTENTS OF REGISTER 1      06500000
         LA    R1,MNPTER           *LOCATE THE 18TH ERROR MESSAGE BY    06520000
         SLL   R1,5                *ADDING THE ADDRESS OF THE 1ST MSG   06540000
         A     R1,PPMSGADD         *TO THE LENGTH OF THE FIRST 17 MSGS  06560000
         MVC   PPERRMSG(32),0(R1)  *AND MOVE MSG INTO WORK AREA         06580000
         LR    R1,RZ               RESTORE REGISTER 1                   06600000
         MVC   PPERRMSG+7(8),0(R1) MOVE PROPER NAME INTO MESS.   A38794 06620021
         MVC   PPMIDN(2),MERR      MOVE PROPER MSG NUMBER INTO MSG      06640000
         LA    RZ,39               PUT MSG LENGTH INTO REGISTER 0       06660000
         LA    R1,PPMAREA          PUT MSG ADDRESS NTO REGISTER 1       06680000
         B     ZZPR                BRANCH TO MSG WRITER ROUTINE         06700000
*                                                                       06720000
         ENTRY PPMSGWRT                                                 06740000
         USING *,15                                                     06760000
PPMSGWRT LR    RZ,R1               PRESERVE CONTENTS OF REGISTER 1      06780000
         SLL   RZ,24               CLEAR THE THREE HIGH ORDER BYTES     06800000
         SRL   RZ,24               BY SHIFTING TO BRING IN ZEROES       06820000
         SRL   R1,8                * LOCATE THE APPROPRIATE ERROR       06840000
         SLL   R1,5                * MESSAGE AND                        06860000
         A     R1,PPMSGADD         * MOVE INTO THE ERROR MESSAGE        06880000
         MVC   PPERRMSG(32),0(R1)  *WORK AREA                           06900000
         CVD   RZ,DBLWD            CONVERT TO DECIMAL THE MSG NUMBER    06920000
         UNPK  PPMIDN(2),DBLWD+6(2) AND SUPPLY APPROPRIATE              06940000
         OI    PPMIDN+1,X'F0'      MESSAGE NUMBER                       06960000
         LA    RZ,39               PUT MESSAGE LENGTH IN REGISTER 0     06980000
         LA    R1,PPMAREA          PUT MESSAGE ADDRESS IN REGISTER 1    07000000
         B     ZZPR                BRANCH TO MSG WRITER ROUTINE         07020000
         DROP  R15                                                      07040000
*                                                                       07060000
         ENTRY CCWRITE                                                  07080000
         USING *,R15                                                    07100000
CCWRITE  LA    RZ,79               LOAD MESSAGE LENGTH INTO REGISTER 0  07120000
         B     ZZPR                BRANCH TO MSG WRITER ROUTINE         07140000
         DROP  R15                                                      07160000
*                                                                       07180000
         EXTRN PPMSGES                                                  07200000
PPMSGADD DC    A(PPMSGES)                                               07220000
*                                                                       07240000
PPMAREA  DS    0X                                                       07260000
PPMID    DC    C'IEB4'             * NUMBER GIVEN TO ERROR MESSAGE      07280000
PPMIDN   DC    C'00I '             *                                    07300000
PPERRMSG DS    32C                 * ERROR MESSAGE WORK AREA            07320000
*                                                                       07340000
PPINVAL  EQU   X'00'                                                    07360000
MERR     DC    C'08'               PART OF ERROR MESSAGE NUMBER         07380000
*                                                                       07400000
IOMSG    EQU   13                  * NUMBERS USED TO LOCATE             07420000
MNPTER   EQU   17                  * THE APPROPRIATE                    07440000
PPINVLD  EQU   18                  * ERROR MESSAGES                     07460000
*                                                                       07480000
DBLWD    DS    D                   WORK AREA FOR DECIMAL CONVERSION     07500000
         EJECT                                                          07520000
*                                                                       07540000
*****   *****   *****   *****   *******   *****   *****   *****   ***** 07560000
* THIS GENERALIZED MESSAGE WRITER INCLUDES THE FACILITY TO PRINT A      07580000
* HEADER ON EACH PAGE WITH ASCENDING PAGE NUMBERS. THE FOLLOWING        07600000
* LINKAGE CONVENTIONS MUST BE OBSERVED:                                 07620000
*              REGISTER 0 MUST CONTAIN THE MESSAGE LENGTH,              07640000
*              REGISTER 1 MUST CONTAIN THE MESSAGE ADDRESS,             07660000
*              AND ZZPR MUST BE INVOKED BY A BAL 14, ZZPR.              07680000
*****   *****   *****  *****    *******   *****   *****   *****   ***** 07700000
*                                                                       07720000
         ENTRY ZZPR                                                7034 07740000
ZZPR     BALR  R15,R0                                                   07760000
         USING *,R15               ESTABLISH ADDRESSABILITY             07780000
         STM   R14,R2,ZZSAVE       SAVE REGISTERS FOR CALLING ROUTINE   07800000
         TM    ZZSW,X'02'          IS THIS A HEADER                     07820000
         BO    ZZHEAD              YES, BRANCH TO HEADER ROUTINE        07840000
         CLC   ZZLINES(R1),ZZLINCNT IS NUMBER OF LINES PRINTED @ZA07383 07860099
*                                  EQUAL TO 60?                @ZA07383 07880099
         BNH   ZZSKIP              YES, SKIP TO NEW PAGE       @ZA07383 07900099
         TM    ZZSW,X'01'          IS THIS A CLEAR                      07920000
         BO    ZZSKIP              NO, PROCEED TO PRINT                 07940000
         B     ZZCLEAR             YES, BRANCH TO CLEAR ROUTINE         07960000
ZZHEAD   MVC   ZZHDSAVE(120),0(R1) MOVE MSG INTO PRINT AREA    @ZA07383 07980099
         MVI   ZZHDSAVE-1,C'-'     INDICATE TRIPLE SPACE                08000000
ZZSKIP   MVI   ZZCTRL,C'1'         SKIP TO CHANNEL 1                    08020000
         MVI   ZZPRINT,C' '        CLEAR PRINT AREA TO BLANKS           08040000
         MVC   ZZPRINT+1(119),ZZPRINT                                   08060000
         BAL   R14,ZZWRITE         BRANCH TO WRITE ROUTINE              08080000
         USING *,R14                                                    08100000
         DROP  R15                                                      08120000
         MVC   ZZCTRL(121),ZZHDSAVE-1    MOVE HEADER INTO PRINT AREA    08140000
         MVI   ZZLINCNT,X'04'      SET INCREMENT TO FOUR                08160000
         BAL   R14,ZZWRITE         BRANCH TO WRITE ROUTINE              08180000
         USING *,R14                                                    08200000
         PACK  ZZCONVRT(8),ZZPGNO(4)                                    08220000
         CVB   R15,ZZCONVRT        CONVERT TO BINARY                    08240000
         LA    R15,1(R15)          INCREMENT BY ONE                     08260000
         CVD   R15,ZZCONVRT        CONVERT TO DECIMAL                   08280000
         UNPK  ZZPGNO(4),ZZCONVRT(8)                                    08300000
         OI    ZZPGNO+3,X'F0'          SET INDICATOR BITS               08320000
         TM    ZZSAVE+11,X'FF'     IS THIS A CLEAR                      08340000
         BM    ZZCLEAR             YES                                  08360000
         LM    R14,R2,ZZSAVE       RESTORE REGISTERS                    08380000
         BR    R14                 RETURN                               08400000
*                                                                       08420000
ZZCLEAR  BALR  R1,R0                                                    08440000
         DROP  R14                                                      08460000
         USING *,R1                                                     08480000
         IC    R14,ZZLINCNT                                             08540000
         LA    R14,1(R14)              INCREMENT LINCNT BY ONE          08560000
         STC   R14,ZZLINCNT                                             08580000
         MVI   ZZPRINT,C' '        CLEAR THE PRINT ARES        @ZA07383 08600099
         MVC   ZZPRINT+1(119),ZZPRINT                                   08620000
         LM    R14,R15,ZZSAVE+8    RESTORE REGISTERS 14 AND 15          08640000
         CLC   4(2,R15),FOXZERO    IS THERE AN INFORMATION MSG          08660000
         BNE   ZZEX                NO                                   08680000
         S     R14,CONS7           IGNORE MSG NUMBER AND LOAD THE       08700000
         LA    R15,7(R15)          ADDRESS OF THE MESSAGE ITSELF        08720000
ZZEX     EX    R14,ZZMOVE          MOVE MESSAGE INTO PRINT AREA         08740000
         MVI   ZZCTRL,C' '         SET CONTROL INDICATOR                08760000
         L     R14,ZZSAVE          RESTORE REGISTER 14                  08780000
         B     ZZWRITE             BRANCH TO WRITE ROUTINE              08800000
*                                                                       08820000
ZZMOVE   MVC   ZZPRINT(1),0(R15)   MOVE MESSAGE INTO PRINT AREA         08840000
*                                                                       08860000
ZZWRITE  BALR  R8,R0                    ESTABLISH ADDRESSABILITY   BS0H 08890017
         DROP  R1                                                  BS0H 08920017
         USING *,R8                                                BS0H 08950017
         ST    R14,REGSAVE              SAVE REGISTER 14           BS0H 08980017
         PUT   ZZDCB,ZZCTRL                                        BS0H 09010017
         L     14,REGSAVE                                          BS0H 09040017
         L     R2,ZZSAVE+16                                             09120000
         BR    R14                 RETURN TO CALLING ROUTINE            09140000
         DROP  R8                                                  BS0H 09160017
         EJECT                                                          09180000
         DS    0D                                                       09200000
*                                                                       09220000
ZZSAVE   DS    10X                 SAVE AREA                            09240000
ZZSW     DS    10X                 CONTROL INFORMATION                  09260000
ZZCTRL   DS    1X                  CONTROL BYTE                         09280000
ZZPRINT  DS    143C' '        SYSPRINT BUFFER                      9476 09300019
ZZHDSAVE DS    120X                WORK AREA                            09320000
ZZCONVRT EQU   ZZSAVE+32                                                09340000
ZZLINES  DC    X'3C'               LINES PER PAGE              @ZA07383 09360099
ZZLINCNT DS    1X                  LINE COUNT                           09380000
HEADER   EQU   512                                                      09420000
ZZPGNO   EQU   ZZHDSAVE+103                                             09440000
FOXZERO  DC    X'F0F0'                                                  09460000
CONS7    DC    F'7'                                                     09480000
OPT      DC    X'85'                                               BS0H 09483017
         DC    AL3(DCBEXIT)                                        BS0H 09486017
DFLG     DC    X'00'                                               BS0H 09489017
REGSAVE  DC    F'0'                                                BS0H 09492017
SPSYNAD  SYNADAF  ACSMETH=QSAM                                     7715 09492219
         MVC   WTOMG1+23(26),49(R1)     GET PART OF I/O ERR MSG    7715 09492419
         MVC   WTOMG2+13(53),75(R1)     GET PART OF I/O ERR MSG    7715 09492619
         SYNADRLS                                                  7715 09492819
         LA    1,WTOMG1                 GET ADDR FOR PRINTING MSG  7715 09493019
         WTO   MF=(E,(1))               WRITE THIS PORTION OF MSG  7715 09493219
         LA    1,WTOMG2                 GET  ADDR OF 2ND MSG PART  7715 09493419
         WTO   MF=(E,(1))               WRITE SECOND PORTION       7715 09493619
         RETURN                                                         09493819
WTOMG1   WTO   'IEB421I I/O ERROR                           ',MF=L,    X09494019
               ROUTCDE=11,DESC=7                                   7715 09494219
WTOMG2   WTO   'IEB421I                                                X09494419
                               ',MF=L,ROUTCDE=11,DESC=7            7715 09494619
         DS    0D                                                  BS0H 09495017
         EJECT                                                          09500000
*                                                                       09520000
         ENTRY   PPOUT                                             7034 09540000
PPOUT    DCB   DDNAME=SYSPRINT,RECFM=FBA,DSORG=PS,MACRF=(PM),      BS0H*09560017
               EXLST=OPT,SYNAD=SPSYNAD                             7715 09580019
*                                                                       09600000
*                                                                       09620000
ZZDCB    EQU   PPOUT                                                    09640000
*                                                                       09660000
         EJECT                                                          09680000
*                                                                       09700000
         DCBD  DSORG=PS                                                 09720000
*                                                                       09740000
DDNAM    EQU   DCBDDNAM-IHADCB                                          09760000
*                                                                       09780000
         EJECT                                                          09800000
*                                                                       09820000
DTABLE   DSECT                                                          09840000
TABLE    DS    0F                                                       09860000
DDN1     DS    CL8                 * DDNAME WORK AREAS                  09880000
DDN2     DS    CL8                 *                                    09900000
EXLSTADD DS    F                   EXIT LIST ADDRESS                    09920000
LITADD   DS    F                   USER LITERAL POOL ADDRESS            09940000
MNTADD   DS    F                   MEMBER NAME TABLE ADDRESS            09960000
RCB      DS    0X                                                       09980000
TYPORG   DS    0X                  BIT INDICATORS                       10000000
         DS    16X                                                      10020000
RCBLEN   EQU   *-RCB                                                    10040000
TCB      DS    0F                                                       10060000
TCB1     DS    2F                  TITLE INFORMATION                    10080000
TCB2     DS    2F                  SUBTITLE INFORMATION                 10100000
TCBLEN   EQU   *-TCB                                                    10120000
PREFORMT DS    X'0'                PREFORMAT SWITCH FOR ALLIGNMENT      10140000
TABLEN   EQU   *-TABLE                                                  10160000
N1DD     EQU   DDN1-DTABLE                                              10180000
N2DD     EQU   DDN2-DTABLE                                              10200000
*                                                                       10220000
DUTBLE   DSECT                                                          10240000
UTBEG    DS    0F                                                       10260000
UEXLADD  DS    F                   EXIT LIST ADDRESS                    10280000
URCBADD  DS    F                   RCB ADDRESS                          10300000
UTCBADD  DS    F                   TCB ADDRESS                          10320000
ULITADD  DS    F                   USER LITERAL POOL ADDRESS            10340000
UMNTADD  DS    F                   MEMBER NAME TABLE ADDRESS            10360000
UTBLEN   EQU   *-UTBEG                                                  10380000
OFLGS    EQU   DCBOFLGS-IHADCB                                          10400000
*                                                                       10420000
         END   IEBPTPCH                                                 10440000
