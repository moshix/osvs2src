         TITLE 'IECTSCAN - SUBROUTINE TO CHANGE ALPHA-NUMERIC (SCAN)   *00001000
                        '                                               00002000
IECTSCAN CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IECTSCAN  77.006'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  ST    @14,12(,@13)                                        0001 00010000
         STM   @01,@12,24(@13)                                     0001 00011000
         BALR  @11,0                                               0001 00012000
@PSTART  DS    0H                                                  0001 00013000
         USING @PSTART,@11                                         0001 00014000
         LR    9,1                                                      00015000
*/**************************************************************/  0032 00016000
*/**************************************************************/  0032 00017000
*/*                                                            */  0032 00018000
*/*                                                            */  0032 00019000
*/* SCAN INITIAL HOUSKEEPING - THE FOLLOWING CODE SETS UP      */  0032 00020000
*/*     ADDRESSABILITY FOR THE SOURCE AREA, THE SINK AREA,     */  0032 00021000
*/*     ESTABLISHES WHETHER THE DEVICE IS REMOTE AND SETS      */  0032 00022000
*/*     RMTDV (DACFLG, BIT 7) ON IF IT IS REMOTE. IF THE       */  0032 00023000
*/*     DEVICE IS REMOTE THE SOURCE IS CHECKED FOR AN STX,     */  0032 00024000
*/*     AND IF PRESENT STXHER (DACFLG, BIT 6) IS SET ON        */  0032 00025000
*/*     AND THE STX PLACED IN THE SINK. LAST, IT IS            */  0032 00026000
*/*     DETERMINED WHETHER THIS IS A READ OR A WRITE OP,       */  0032 00027000
*/*     AND CONTROL IS PASSED TO SUBROUTINE READ OR WRITE.     */  0032 00028000
*/*                                                            */  0032 00029000
*/**************************************************************/  0032 00030000
*/**************************************************************/  0032 00031000
*           SINKAD = DACSINAD;        /*SINK ADDRESSABILIT     */  0032 00032000
         L     SINKAD,DACSINAD(,DACAD)                             0032 00033000
*           SOURAD = DACSRCAD;        /*SOURCE ADDRESSABIL     */  0033 00034000
         L     SOURAD,DACSRCAD(,DACAD)                             0033 00035000
*           IF SOURCE(DACSRCLN) = '03'X /*LAST CHARACTER ETX ? */  0034 00036000
*               THEN                  /*SET REMOTE FLAG ON     */  0034 00037000
         LH    @12,DACSRCLN(,DACAD)                                0034 00038000
         ALR   @12,SOURAD                                          0034 00039000
         BCTR  @12,0                                               0034 00040000
         CLI   SOURCE(@12),X'03'                                   0034 00041000
         BNE   @RF00034                                            0034 00042000
*                 DO;                 /*AND                    */  0035 00043000
*/**************************************************************/  0036 00044000
*/*                                                            */  0036 00045000
*/* BACKGO     FROM      WRTETX, RDETX                         */  0036 00046000
*/*      REPROCESS DATA STREAM AS REMOTE, ETX ENCOUNTERED AND  */  0036 00047000
*/* RMTDV IN DACFLG (BIT 7) WAS NOT ON                         */  0036 00048000
*/**************************************************************/  0036 00049000
*BACKGO:              RMTDV = '1'B;   /*TEST TO SEE IF AN      */  0036 00050000
BACKGO   OI    RMTDV(DACAD),B'00000001'                            0036 00051000
*                     DACIND = '02'X;                              0037 00052000
         MVI   DACIND(DACAD),X'02'                                 0037 00053000
*                     IF SOURCE(1) = '02'X /*IS STX FIRST ?    */  0038 00054000
*                         THEN        /*CHAR IN DATA STRM      */  0038 00055000
         CLI   SOURCE(SOURAD),X'02'                                0038 00056000
         BNE   @RF00038                                            0038 00057000
*                           DO;       /*SET STXHER ON AND      */  0039 00058000
*                               SOURAD = SOURAD + 1;               0040 00059000
         AH    SOURAD,@CH00061                                     0040 00060000
*                                     /*INCREMENT SOURCE POINTR*/  0041 00061000
*/**************************************************************/  0041 00062000
*/*                                                            */  0041 00063000
*/* STXPLUG    FROM     STXPLUG                                */  0041 00064000
*/*      INSERT AN STX IN THE SINK                             */  0041 00065000
*/**************************************************************/  0041 00066000
*                              STXHER = '1'B; /*MOVE STX       */  0041 00067000
         OI    STXHER(DACAD),B'00000010'                           0041 00068000
*                               DACIND = '03'X;                    0042 00069000
         MVI   DACIND(DACAD),X'03'                                 0042 00070000
*                                     /*SET INDICATOR BYTE     */  0043 00071000
*STXPLUG:;                                                         0043 00072000
STXPLUG  DS    0H                                                  0044 00073000
*                               SINK(1) = '02'X;                   0044 00074000
         MVI   SINK(SINKAD),X'02'                                  0044 00075000
*                                     /*FROM SOURCE TO SIN     */  0045 00076000
*                              SINKAD = SINKAD + 1;                0045 00077000
         AH    SINKAD,@CH00061                                     0045 00078000
*                                     /*INCREMENT SINK PTR     */  0046 00079000
*                           END;      /*IF NO STX              */  0046 00080000
*                ELSE                                              0047 00081000
*                     GO TO STXPLUG;  /*SET AN STX             */  0047 00082000
*                 END;                /*IF NO ETX OR ETB       */  0048 00083000
*               ELSE;                 /*RMTDX NOT SET ON       */  0049 00084000
@RF00034 DS    0H                                                  0050 00085000
*           IF RMTDV = '1'B                                        0050 00086000
*                THEN                                              0050 00087000
         TM    RMTDV(DACAD),B'00000001'                            0050 00088000
         BNO   @RF00050                                            0050 00089000
*                  DO;                                             0051 00090000
*                     GEN  REFS(DACAD) SETS(DACIND,SPECAR) SEQFLOW ;    00091000
         SR    SPECAR,SPECAR                                            00092000
         IC    SPECAR,DACIND(DACAD)                     Y02947          00093000
         AH    SPECAR,HAF3                                              00094000
         STC   SPECAR,DACIND(DACAD)                     Y02947          00095000
*                  END;                                            0053 00096000
*                ELSE DACIND = '03'X;                              0054 00097000
         B     @RC00050                                            0054 00098000
@RF00050 MVI   DACIND(DACAD),X'03'                                 0054 00099000
*           GEN REFS(DACOPTYP,DACAD) FLOWS(READ) SEQFLOW  /*Y02947*/ ;  00100000
@RC00050 DS    0H                                                  0055 00101000
         TM    DACOPTYP(DACAD),X'07'         IS IT A READ OPTYPE        00102000
         BNZ   READ                  YES GO TO READ, NO FALL            00103000
*           GEN;                                                   0056 00104000
         EJECT                                                          00105000
*/*     FOLLOWING ARE THE FLOW CHARTING STATEMENTS FOR THE     */  0057 00106000
*/*     PRECEDING CODE:                                        */  0057 00107000
*/*IECTSCAN: CHART                                             */  0057 00108000
*/* HEADER                                                         0057 00109000
*/*        IECTSCAN - SUBROUTINE TO CHANGE ALPHA-NUMERIC (SCAN)    0057 00110000
*/*                                            PAGE #          */  0057 00111000
*/*IECTSCAN:     E SCAN ENTRY (AND ENTRY - INITIAL                 0057 00112000
*/*                HOUSEKEEPING)                               */  0057 00113000
*/*              P ESTABLISH SINK, SOURCE, AND DACA                0057 00114000
*/*                ADDRESSABILITY                              */  0057 00115000
*/*              D (NO,%RMTDV,YES,) IS ETX LAST                    0057 00116000
*/*                CHARACTER IN SOURCE ?                       */  0057 00117000
*/*BACKGO:       P SET RMTDV ON, SET DACIND TO '02'X           */  0057 00118000
*/*              D (NO,STXPLUG,YES,) IS STX FIRST                  0057 00119000
*/*                CHARACTER IN SOURCE ?                       */  0057 00120000
*/*              P BUMP SOURCE ONE                             */  0057 00121000
*/*STXPLUG:      P SET STXHER ON, SET DACIND TO '03'X, MOVE        0057 00122000
*/*                STX TO SINK, BUMP SINK                      */  0057 00123000
*/*%RMTDV:       D (NO,%NORMTDV,YES,) IS RMTDV ON ?            */  0057 00124000
*/*              P (,%WHATOP) ADD THREE TO DACIND              */  0057 00125000
*/*%NORMTDV:     P SET DACIND TO THREE                         */  0057 00126000
*/*%WHATOP:      D (RD,READ,WR,WRITE) IS IT A READ OR A WRITE      0057 00127000
*/*                OPERATION ?                                 */  0057 00128000
*        GEN;                                                      0057 00129000
         EJECT                                                          00130000
*/**************************************************************/  0058 00131000
*/**************************************************************/  0058 00132000
*/*                                                            */  0058 00133000
*/*                                                            */  0058 00134000
*/* WRITE MAJOR ENTRY FROM HOUSEKEEPING TO PROCESS ALL         */  0058 00135000
*/*      OUTPUT DATA STREAMS. THIS INITIAL CODE PERFORMS       */  0058 00136000
*/*      THOSE HOUSEKEEPING FUNCTIONS SPECIFICALLY RELATED     */  0058 00137000
*/*      TO OUTPUT DATA STREAMS. IT INSERTS THE OPENING        */  0058 00138000
*/*      ORDERS AND CONTROL NESSECARY FOR THE 3270. THE        */  0058 00139000
*/*      INSERTIONS ARE BASED UPON THE CONDITION OF RMTDV      */  0058 00140000
*/*      (DACFLG, BIT 7) AND DACOPTYP (WHICH TYPE OF WRITE     */  0058 00141000
*/*      OPERATION TO BE DEALT WITH).                          */  0058 00142000
*/*       THIS SECTION ALSO MAKE THE DETERMINATION TO (AND     */  0058 00143000
*/*      INSERTS IF NEEDED) PLACE ORDER TO NULL AN             */  0058 00144000
*/*      EXISTING START OF MESSAGE ON THE 3270 SCREEN IN       */  0058 00145000
*/*      THE DATA STREAM. THIS IS BASED ON THE CONDITION       */  0058 00146000
*/*      OF SHRD (DACFLAG, BIT 1) AND DACSOMAD (ALL ONES       */  0058 00147000
*/*      OR A VALID ADDRESS). THE SCREEN IS SET TO BLANKS      */  0058 00148000
*/*      IF RVOID = NO WAS SPECIFIED ON A WRITE ERASE (IE:     */  0058 00149000
*/*      DACFLG, BIT 0 SET TO 0). CONTROL IS THEN PASSED       */  0058 00150000
*/*      TO WRITENT.                                           */  0058 00151000
*/*                                                            */  0058 00152000
*/**************************************************************/  0058 00153000
*/**************************************************************/  0058 00154000
*WRITE:;                              /*ENTRY FOR OUTPUTS      */  0058 00155000
WRITE    DS    0H                                                  0059 00156000
*           IF RMTDV = '1'B           /*IS IT REMOTE           */  0059 00157000
*                THEN                 /*YES, PUT ESCAPE        */  0059 00158000
         TM    RMTDV(DACAD),B'00000001'                            0059 00159000
         BNO   @RF00059                                            0059 00160000
*                  DO;                /*SEQUENCE IN SINK       */  0060 00161000
*                     SINK(1) = '27'X; /*AND INCREMENT THE     */  0061 00162000
         MVI   SINK(SINKAD),X'27'                                  0061 00163000
*                     SINKAD = SINKAD + 1; /*SINK PTR          */  0062 00164000
         LA    @12,1                                               0062 00165000
         ALR   SINKAD,@12                                          0062 00166000
*                     IF EWR = '1'B   /*ERASE WRITE ?          */  0063 00167000
*                          THEN       /*YES, PUT COMMAND       */  0063 00168000
         TM    EWR(DACAD),B'00001000'                              0063 00169000
         BNO   @RF00063                                            0063 00170000
*                            DO;      /*CODE OF 5 IN SINK      */  0064 00171000
*                               SINK(1) = 'F5'X; /*INCREMENT   */  0065 00172000
         MVI   SINK(SINKAD),X'F5'                                  0065 00173000
*                               SINKAD = SINKAD + 1;               0066 00174000
         ALR   SINKAD,@12                                          0066 00175000
*/**************************************************************/  0067 00176000
*/*                                                            */  0067 00177000
*/* REMTEWR    FROM      RTASET                                */  0067 00178000
*/*      ESTABLISH WCC, SCREEN FORMATTING ORDERS FOR AN ERASE  */  0067 00179000
*/* WRITE OPERATION TYPE                                       */  0067 00180000
*/**************************************************************/  0067 00181000
*REMTEWR:;                            /*THE SINK PTR           */  0067 00182000
REMTEWR  DS    0H                                                  0068 00183000
*           GEN SETS(SPECAR) REFS(ANWIDE,DACAD) SEQFLOW  /*Y02947*/ ;   00184000
         SR    SPECAR,SPECAR          CLEAR A WORK REG                  00185000
         IC    SPECAR,ANWIDE(DACAD)       PICK UP ANWIDE                00186000
         SRL   SPECAR,6               MAKE AN ARGUMENT                  00187000
         LA    SPECAR,1(SPECAR)       PREVENT ZERO ARGUMENT             00188000
*                               SINK(1) = WCCTAB(SPECAR);          0069 00189000
         LA    @12,WCCTAB-1(SPECAR)                                0069 00190000
         MVC   SINK(1,SINKAD),0(@12)                               0069 00191000
*                                     /* PUT WCC               */  0070 00192000
*                                     /*IN THE SINK AND        */  0070 00193000
*                               SINKAD = SINKAD + 1;               0070 00194000
         AH    SINKAD,@CH00061                                     0070 00195000
*                                     /*INCREMENT THE SINK     */  0071 00196000
*/**************************************************************/  0071 00197000
*/*                                                            */  0071 00198000
*/* RTASET     FROM      (NO REFERENCES)                       */  0071 00199000
*/*      REPEAT TO ADDRESS ORDER INSERTION, TO CLEAR SCREEN    */  0071 00200000
*/* TO BLANKS IF RVOID = NO                                    */  0071 00201000
*/**************************************************************/  0071 00202000
*RTASET:;                             /*NULL OR BLANK SCREEN ? */  0071 00203000
RTASET   DS    0H                                                  0072 00204000
*                               IF RVOID = '1'B /*NULL ?       */  0072 00205000
*                                    THEN GO TO WRITENT;           0072 00206000
         TM    RVOID(DACAD),B'10000000'                            0072 00207000
         BO    @RT00072                                            0072 00208000
*                                     /*ALREADY NULLS          */  0074 00209000
*                                    ELSE; /*SET UP TO         */  0074 00210000
*           GEN SETS(REG0,SPECAR) REFS(BLNK,BUILDEND) SEQFLOW      0075 00211000
*                                       /*Y02947*/   ;             0075 00212000
         SR    REG0,REG0                                                00213000
         IC    REG0,BLNK                                                00214000
         LA    SPECAR,BUILDEND                                          00215000
*RTABUILD:;                                                        0076 00216000
RTABUILD DS    0H                                                  0077 00217000
*           GEN REFS(DACDSSCR,ANWIDE,ANLINE,REG0,DACOPTYP)         0077 00218000
*             SETS(WORKREG1,WORKREG2,WORKREG3,WORKREG4,CURSAD)     0077 00219000
*                FLOWS(BUILDEND,WITCH4)                  /*02947*/  ;   00220000
         LA    WORKREG1,480                  GET MAX RTA LENGTH         00221000
         SR    WORKREG2,WORKREG2              CLEAR A WORK REGISTER     00222000
         IC    WORKREG2,DSLINE(DACAD)       PICK UP 2260 LINE COUNT     00223000
         SR    WORKREG4,WORKREG4             CLEAR A WORK REGISTER      00224000
         IC    WORKREG4,ANWIDE(DACAD)            PICK UP 3270 WIDTH     00225000
         SR    WORKREG3,WORKREG3              CLEAR A WORK REGISTER     00226000
         IC    WORKREG3,ANLINE(DACAD)         PICK UP 3270 LINE COUNT   00227000
         SR    CURSAD,CURSAD           CLEAR CURSOR FOR SET UP          00228000
         LTR   REG0,REG0                     RTA TO END OF 3270 ?       00229000
         BNZ   UPPER                   NO, THEN BLANK 2260              00230000
         SR    WORKREG3,WORKREG2              GET EXCESS LINE COUNT     00231000
         B     CALC1                   GO SEE HOW MUCH TO RTA           00232000
UPPER    EQU   *                       WANTS TO BLANK 2260              00233000
         LR    WORKREG3,WORKREG2       GET 2260 LINE COUNT              00234000
CALC1    EQU   *                       COMPUTE RTA COUNT                00235000
         MR    WORKREG4,WORKREG4           LINES TIMES WIDTH            00236000
         LTR   REG0,REG0               RTA 2260 SCREEN TO BLANK ?       00237000
         BNZ   CALC2                   YES, GO FIGURE NUMBER RTAS       00238000
         TM    DACOPTYP(DACAD),X'40'   PROT = YES SPECIFIED ?           00239000
         BNO   CALC2                   NO, GO FIGURE NUMBER RTAS        00240000
         BCTR  WORKREG3,0              REDUCE COUNT FOR ATTRIBUTE       00241000
CALC2    EQU   *                       FIGURE NUMBER OF RTAS            00242000
         SR    WORKREG4,WORKREG4       CLEAR HIGH HALF OF DIVIDEND      00243000
         DR    WORKREG4,WORKREG1           480 INTO COUNT               00244000
         LR    WORKREG1,WORKREG4           SAVE THE REMAINDER           00245000
         LR    WORKREG2,WORKREG3                   SAVE THE QUOTIENT    00246000
         LTR   REG0,REG0               RTA TO END OF 3270 ?             00247000
         BNZ   UPHLF                   NO, GO SET TO BLNK 2260          00248000
         SR    WORKREG4,WORKREG4           CLEAR A WORK REGISTER        00249000
         IC    WORKREG4,DSLINE(DACAD)    PICK 2260 LINE COUNT           00250000
         SR    WORKREG3,WORKREG3       CLEAR A WORK REGISTER            00251000
         IC    WORKREG3,ANWIDE(DACAD)  PICK UP 3270 WIDTH               00252000
         MR    WORKREG4,WORKREG4           GET END OF 2260 IN BUFFER    00253000
         BCTR  WORKREG3,0              ACCOUNT FOR FIRST POS 0  YA01253 00254000
         LR    CURSAD,WORKREG3         SAVE FINAL RTA ADDRESS           00255000
         B     LOWHLF                  GO PREPARE TO NULL 3270          00256000
UPHLF    EQU   *                       WANTS TO BLANK 2260              00257000
         LTR   WORKREG2,WORKREG2       RTA COUNT 480 OR MORE ?          00258000
         BNZ   PAT                     YES, GENERATE RTAS               00259000
         LTR   WORKREG1,WORKREG1       ANY REMAINING COUNT ?            00260000
         BZ    RETBCK                  NO, RETURN TO CALLER             00261000
         AR    CURSAD,WORKREG1         YES, BUMP THE CURSOR             00262000
         B     SETORD                  GO DO ONE RTA                    00263000
LOWHLF   EQU   *                       WANTS TO NULL 3270               00264000
         LTR   WORKREG2,WORKREG2       RTA COUNT 480 OR MORE ?          00265000
         BNZ   ONTST                   YES, CONTINUE SET UP             00266000
         SR    CURSAD,CURSAD           RTA ADDRESS TO BUFFER ZERO       00267000
         B     SETORD                  GO DO ONE RTA TO ZERO            00268000
ONTST    EQU   *                       MORE THAN 480 AT BOTTOM          00269000
         BCT   WORKREG2,UPPIT          MORE THAN 960 GO TO UPPIT        00270000
         LTR   WORKREG1,WORKREG1       ANY REMAINING COUNT ?            00271000
         BNZ   UPPITY                  YES, CONTINUE SET UP             00272000
         SR    CURSAD,CURSAD           SET ADDRESS TO BUFFER ZERO       00273000
         B     SETORD                  GO DO ONE RTA TO ZERO            00274000
UPPIT    EQU   *                       960 OR MORE TO DO AT BOTTOM      00275000
         LTR   WORKREG1,WORKREG1       ODD COUNT REMAINING ?            00276000
         BZ    PAT                     NO, GO DO RTAS                   00277000
UPPITY   EQU   *                       480 + TO DO AT BOTTOM            00278000
         LA    WORKREG2,1(WORKREG2)    PUT RTA COUNT BACK               00279000
PAT      EQU   *                       INITIAL ENTRY TO LOOP            00280000
         LA    WORKREG2,1(WORKREG2)    BUMP COUNT FOR LOOP              00281000
RAT      EQU   *                       LOOP ITERATION ENTRY             00282000
         BCT   WORKREG2,LOOP           MORE 480 BYTE RTAS TO DO ?       00283000
         B     LOOPDONE                NO, DO FINAL SET UP              00284000
LOOP     EQU   *                       CONSTRUCT RTA SEQUENCES          00285000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                        00286000
*                                    ARE THE SCREENS EQUAL  ?   YA01253 00287000
         BNE   LOOP1                   NO, GO SET UP RTA        YA01253 00288000
         LTR   WORKREG1,WORKREG1       MORE RTAS AFTER THIS ?   YA01253 00289000
         BNZ   LOOP1                   YES, GO SET UP RTA       YA01253 00290000
         C     WORKREG2,ONE            MORE RTAS AFTER THIS ?   YA01253 00291000
         BH    LOOP1                   YES, GO SET UP RTA       YA01253 00292000
         XR    CURSAD,CURSAD           CURSOR AT ZERO          @YA02151 00293000
         B     SETORD                  DO RTA TO ZERO           YA01253 00294000
LOOP1    EQU   *                                                YA01253 00295000
         LA    CURSAD,480(CURSAD)      SET RTA ADDRESS                  00296000
SETORD   EQU   *                       ENTRY FOR SINGLE RTA             00297000
*                                      REG 12 MUST BE ZERO              00298000
         MVI   0(SINKAD),X'3C'         INSERT RTA ORDER IN SINK         00299000
         LA    SINKAD,1(SINKAD)        BUMP SINK POINTER                00300000
         BAL   CARADD,OUTVERT          GO COMPUTE ADDRESS IN 3270       00301000
         SR    CARADD,CARADD           CLEAR LINK REG                   00302000
         STC   REG0,0(SINKAD)          PUT REPEATED CHARACTER           00303000
         LA    SINKAD,1(SINKAD)        BUMP SINK POINTER                00304000
         LTR   WORKREG2,WORKREG2       LOOP COUNTER AT ZERO ?           00305000
         BNZ   RAT                     NO, STAY IN LOOP                 00306000
RETBCK   EQU   *                       RETURN TO CALLER                 00307000
         BR    SPECAR                  GO TO ADDRESS IN SPECAR          00308000
LOOPDONE EQU   *                       ALL 480 BYTE RTAS DONE           00309000
         LTR   REG0,REG0               DOING 2260 SCREEN ?              00310000
         BZ    LOWHLF                  NO, GO SEE IF MORE AT BOTTOM     00311000
         B     UPHLF                   YES, GO SEE IF MORE 2260         00312000
*BUILDEND:;                                                        0078 00313000
BUILDEND DS    0H                                                  0079 00314000
*                               SINK(1) = '11'X;                   0079 00315000
         MVI   SINK(SINKAD),X'11'                                  0079 00316000
*                                     /*SET BUFFER TO FRST     */  0080 00317000
*                               SINKAD = SINKAD + 1;               0080 00318000
         AH    SINKAD,@CH00061                                     0080 00319000
*                                     /*OF 3270 SCREEN         */  0081 00320000
*                               SINK(1) = '40'X;                   0081 00321000
         MVI   SINK(SINKAD),X'40'                                  0081 00322000
*                               SINK(2) = '40'X;                   0082 00323000
         MVI   SINK+1(SINKAD),X'40'                                0082 00324000
*                               SINKAD = SINKAD + 2;               0083 00325000
         AH    SINKAD,@CH00059                                     0083 00326000
*                               DACSOMAD = ALLONE;                 0084 00327000
         MVC   DACSOMAD(2,DACAD),ALLONE                            0084 00328000
*                                     /*SET NO SOM INDICAT     */  0085 00329000
*                               GO TO WRITENT;                     0085 00330000
         B     WRITENT                                             0085 00331000
*                            END;                                  0086 00332000
*                          ELSE       /*IF NOT ERASE WRITE     */  0087 00333000
*                            DO;      /*PLUG COMMAND CODE      */  0087 00334000
@RF00063 DS    0H                                                  0088 00335000
*                               SINK(1) = 'F1'X; /* OF ONE     */  0088 00336000
         MVI   SINK(SINKAD),X'F1'                                  0088 00337000
*                               SINKAD = SINKAD + 1;               0089 00338000
         AH    SINKAD,@CH00061                                     0089 00339000
*                                     /*INCREMENT SINK PTR     */  0090 00340000
*                               GO TO LOCLWR;                      0090 00341000
         B     LOCLWR                                              0090 00342000
*                            END;                                  0091 00343000
*                  END;                                            0092 00344000
*                ELSE;                                             0093 00345000
@RF00059 DS    0H                                                  0094 00346000
*           IF EWR = '1'B             /*IS IT ERASE WRITE      */  0094 00347000
*                THEN GO TO REMTEWR;  /*PROCESS IT             */  0094 00348000
         TM    EWR(DACAD),B'00001000'                              0094 00349000
         BO    @RT00094                                            0094 00350000
*                ELSE;                /*NO, SET NORMAL         */  0096 00351000
*/**************************************************************/  0097 00352000
*/*                                                            */  0097 00353000
*/* LOCLWR     FROM      RTASET                                */  0097 00354000
*/*      ESTABLISH WCC, SCREEN FORMATTING ORDERS FOR WRITE TO  */  0097 00355000
*/* CURSOR, WRITE TO LINE ADDRESS OPERATION TYPES              */  0097 00356000
*/**************************************************************/  0097 00357000
*LOCLWR:;                             /*NOT ERASE WRITE        */  0097 00358000
LOCLWR   DS    0H                                                  0098 00359000
*           GEN SETS(SPECAR) REFS(DACAD,ANWIDE) SEQFLOW  /*Y02947*/ ;   00360000
         SR    SPECAR,SPECAR          CLEAR A WORK REG                  00361000
         IC    SPECAR,ANWIDE(DACAD)       PICK UP ANWIDE                00362000
         SRL   SPECAR,6               MAKE AN ARGUMENT                  00363000
         LA    SPECAR,1(SPECAR)       PREVENT ZERO ARGUMENT             00364000
*           SINK(1) = WCCTAB(SPECAR); /* PUT WCC IN SINK       */  0099 00365000
         LA    @12,WCCTAB-1(SPECAR)                                0099 00366000
         MVC   SINK(1,SINKAD),0(@12)                               0099 00367000
*           SINKAD = SINKAD + 1;      /*INCREMENT SINK PTR     */  0100 00368000
         LA    @12,1                                               0100 00369000
         ALR   SINKAD,@12                                          0100 00370000
*           IF SHRD = '0'B            /*LAST READ NOT SHOR     */  0101 00371000
*           & DACSOMAD ^= ALLONE      /*AND SOM PRESENT        */  0101 00372000
*                THEN                 /*THEN SET UP TO         */  0101 00373000
         TM    SHRD(DACAD),B'01000000'                             0101 00374000
         BNZ   @RF00101                                            0101 00375000
         LH    @10,DACSOMAD(,DACAD)                                0101 00376000
         CH    @10,ALLONE                                          0101 00377000
         BE    @RF00101                                            0101 00378000
*                  DO;                /*NULL PREVIOUS SOM      */  0102 00379000
*                     SINK(1) = '11'X; /* ON 3270 SCREEN       */  0103 00380000
         MVI   SINK(SINKAD),X'11'                                  0103 00381000
*                     SINKAD = SINKAD + 1;                         0104 00382000
         ALR   SINKAD,@12                                          0104 00383000
*                                     /*INCREMENT SINK PTR     */  0105 00384000
*                     CURSAD = DACSOMAD;                           0105 00385000
         LR    CURSAD,@10                                          0105 00386000
*                                     /*PICK UP SOM PTR        */  0106 00387000
*                     GEN;                                         0106 00388000
         BAL   CARADD,OUTVERT         AND CONVERT TO 3270               00389000
*                     SINK(1) = '40'X;                             0107 00390000
         MVI   SINK(SINKAD),X'40'                                  0107 00391000
*                     SINKAD = SINKAD + 1;                         0108 00392000
         LA    @12,1                                               0108 00393000
         ALR   SINKAD,@12                                          0108 00394000
*                                     /*INCREMENT SINK PTR     */  0109 00395000
*                     SINK(1) = '11'X; /* PREPARE FOR DATA     */  0109 00396000
         MVI   SINK(SINKAD),X'11'                                  0109 00397000
*                     SINKAD = SINKAD + 1;                         0110 00398000
         ALR   SINKAD,@12                                          0110 00399000
*                                     /*INCREMENT SINK PTR     */  0111 00400000
*                  END;                                            0111 00401000
*                ELSE                 /*IF NO NEED TO CLER     */  0112 00402000
*                  DO;                /*SOM, THEN PREPARE      */  0112 00403000
         B     @RC00101                                            0112 00404000
@RF00101 DS    0H                                                  0113 00405000
*                     SINK(1) = '11'X; /* FOR DATA             */  0113 00406000
         MVI   SINK(SINKAD),X'11'                                  0113 00407000
*                     SINKAD = SINKAD + 1;                         0114 00408000
         AH    SINKAD,@CH00061                                     0114 00409000
*                                     /*INCREMENT SINK PTR     */  0115 00410000
*                  END;                                            0115 00411000
*           GEN;                                                   0116 00412000
@RC00101 DS    0H                                                  0116 00413000
         EJECT                                                          00414000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0117 00415000
*/*     PRECEDING CODE -                                       */  0117 00416000
*/*WRITE:        D (NO,%NOTRMT,YES,) IS RMTDV ON ?             */  0117 00417000
*/*              P PUT ESCAPE BYTE IN SINK, BUMP SINK          */  0117 00418000
*/*              D (NO,%NOTEWR,YES,) IS THIS AN ERASE WRITE        0117 00419000
*/*                OPERATION ?                                 */  0117 00420000
*/*              P PUT COMMAND CODE OF FIVE IN SINK, BUMP          0117 00421000
*/*                SINK                                        */  0117 00422000
*/*REMTEWR:      P PUT WRITE CONTROL CHARACTER IN SINK, BUMP       0117 00423000
*/*                SINK                                        */  0117 00424000
*/*RTASET:       D (YES,WRITENT,NO,) IS RVOID = YES SPECIFIED ?*/  0117 00425000
*/*              S RTABUILD:BUILD RTA(S) TO BLANK 2260 SCREEN  */  0117 00426000
*/*RTABUILD: CHART                                             */  0117 00427000
*/*RTABUILD:     E CONSTRUCT RTA ORDERS                        */  0117 00428000
*/*              P SET UP WORK REGISTERS                       */  0117 00429000
*/*              D (YES,UPPER,NO,) RTA FOR 2260 PORTION ?      */  0117 00430000
*/*              P (,CALC1) SET TO COMPUTE 3270 PORTION        */  0117 00431000
*/*UPPER:        P SET TO COMPUTE 2260 PORTION                 */  0117 00432000
*/*CALC1:        P COMPUTE TOTAL BYTES SPANNED BY RTA          */  0117 00433000
*/*              D (YES,CALC2,NO,) RTA FOR 2260 PORTION ?      */  0117 00434000
*/*              D (NO,CALC2,YES,) PROT = YES ?                */  0117 00435000
*/*              P MODIFY RTA SPAN MINUS ONE                   */  0117 00436000
*/*CALC2:        P COMPUTE NUMBER OF RTAS NEEDED               */  0117 00437000
*/*              D (YES,UPHLF,NO,) RTA FOR 2260 PORTION ?      */  0117 00438000
*/*              P COMPUTE ADDRESS OF END OF 2260 PORTION      */  0117 00439000
*/*              P (,LOWHLF) SAVE ADDRESS IN CURSAD            */  0117 00440000
*/*UPHLF:        D (YES,PAT,NO,) AT LEAST ONE 480 BYTE RTA ?   */  0117 00441000
*/*              D (NO,RETBCK,YES,) ANY REMAINDER ?            */  0117 00442000
*/*              P (,SETORD) BUMP THE CURSOR BY THE REMAINDER  */  0117 00443000
*/*LOWHLF:       D (YES,ONTST,NO,) AT LEAST ONE 480 BYTE RTA ? */  0117 00444000
*/*              P (,SETORD) SET ADDRESS IN CURSAD TO ZERO     */  0117 00445000
*/*ONTST:        D (YES,UPPIT,NO,) AT LEAST TWO 480 BYTE RTAS ?*/  0117 00446000
*/*              D (YES,UPPITY,NO,) ANY REMAINDER ?            */  0117 00447000
*/*              P (,SETORD) SET ADDRESS IN CURSAD TO ZERO     */  0117 00448000
*/*UPPIT:        D (NO,PAT,YES,) ANY REMAINDER ?               */  0117 00449000
*/*UPPITY:       P MODIFY COUNT OF 480 BYTE RTAS               */  0117 00450000
*/*PAT:          P BUMP RTA COUNT TO COMPENSATE LOOP           */  0117 00451000
*/*RAT:          D (NO,LOOPDONE,YES,) RTA COUNT > ONE ?        */  0117 00452000
*/*LOOP:         P BUMP ADDRESS IN CURSAD BY 480               */  0117 00453000
*/*SETORD:       P PUT RTA IN SINK, BUMP SINK                  */  0117 00454000
*/*              S OUTVERT:CONVERT HEXADECIMAL TO 3270 BUFFER  */  0117 00455000
*/*              P PUT CHARACTER IN SINK, BUMP SINK            */  0117 00456000
*/*              D (YES,RAT,NO,) ANY 480 BYTE RTAS LEFT ?      */  0117 00457000
*/*RETBCK:       R BRANCH ON SPECAR                            */  0117 00458000
*/*LOOPDONE:     D (YES,UPHLF,NO,LOWHLF) RTA FOR 2260 PORTION ?*/  0117 00459000
*/*RTABUILD: END                                               */  0117 00460000
*/*IECTSCAN: CHART                                             */  0117 00461000
*/*BUILDEND:     P PUT A SET BUFFER ADDRESS ORDER IN SINK,         0117 00462000
*/*                BUMP SINK                                   */  0117 00463000
*/*              P (,WRITENT) PUT 3270 BUFFER ADDRESS ZERO         0117 00464000
*/*                IN SINK, BUMP SINK TWO, DACSOMAD =              0117 00465000
*/*                ALLONES                                     */  0117 00466000
*/*%NOTEWR:      P (,LOCLWR) PUT COMMAND CODE ONE IN SINK,         0117 00467000
*/*                BUMP SINK                                   */  0117 00468000
*/*%NOTRMT:      D (YES,REMTEWR,NO,) IS THIS ERASE WRITE           0117 00469000
*/*                OPERATION ?                                 */  0117 00470000
*/*LOCLWR:       P PUT WRITE CONTROL CHARACTER IN SINK, BUMP       0117 00471000
*/*                SINK                                        */  0117 00472000
*/*              D (NO,%NOSOM,YES,) IS AN SOM ON THE SCREEN        0117 00473000
*/*                ?                                           */  0117 00474000
*/*              P PUT SET BUFFER ADDRESS ORDER IN SINK,           0117 00475000
*/*                BUMP SINK, PICK UP SOM POINTER              */  0117 00476000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0117 00477000
*/*              P PUT A BLANK IN THE SINK, BUMP THE SINK      */  0117 00478000
*/*              P (,WRITENT) PUT A SET BUFFER ADDRESS ORDER       0117 00479000
*/*                IN THE SINK, BUMP THE SINK                  */  0117 00480000
*/*%NOSOM:       P PUT A SET BUFFER ADDRESS ORDER IN THE           0117 00481000
*/*                SINK, BUMP THE SINK                         */  0117 00482000
*        GEN;                                                      0117 00483000
         EJECT                                                          00484000
*/**************************************************************/  0118 00485000
*/**************************************************************/  0118 00486000
*/*                                                            */  0118 00487000
*/*                                                            */  0118 00488000
*/* WRITENT ENTRY PROCESSING FOR ALL OUTPUT DATA STREAMS.      */  0118 00489000
*/*      THIS CODE ESTABLISHES THE CURRENT 2260 LINE           */  0118 00490000
*/*      (MAINTAINED IN REGISTER CURLIN), THE CURRENT 2260     */  0118 00491000
*/*      CURSOR POSITION (MAINTAINED IN REGISTER CURSAD),      */  0118 00492000
*/*      AND COMPUTES THE GROUP OF CHARACTERS IN THE           */  0118 00493000
*/*      SOURCE AREA TO BE INITIALLY DEALT WITH (KEPT IN       */  0118 00494000
*/*      REGISTER LINGRO), FOR THE VARIOUS OUTPUT OP TYPES     */  0118 00495000
*/*       FOR WRITE TO CURSOR AND WRITE TO LINE ADDRESS,       */  0118 00496000
*/*      THE 3270 BUFFER POSITION OF THE FIRST CHARACTER       */  0118 00497000
*/*      POSITION IS INSERTED IN THE SINK FOLLOWING THE        */  0118 00498000
*/*      SBA PLACED THERE BY WRITE. FOR ERASE WRITE THE        */  0118 00499000
*/*      3270 BUFFER IS ALREADY AT POSITION ZERO.              */  0118 00500000
*/*       CONTROL IS PASSED TO WITCH1.                         */  0118 00501000
*/*                                                            */  0118 00502000
*/**************************************************************/  0118 00503000
*/**************************************************************/  0118 00504000
*WRITENT:;                                                         0118 00505000
WRITENT  DS    0H                                                  0119 00506000
*           IF EWR = '1'B             /*IS THIS ERASE WRIT     */  0119 00507000
*                THEN                 /*YES, ESTABLISH         */  0119 00508000
         TM    EWR(DACAD),B'00001000'                              0119 00509000
         BNO   @RF00119                                            0119 00510000
*                  DO;                /*INITIAL VALUES         */  0120 00511000
*                     CURLIN = CURLIN - CURLIN;                    0121 00512000
         SLR   CURLIN,CURLIN                                       0121 00513000
*                                     /*LINE # TO ZERO         */  0122 00514000
*                     CURSAD = CURSAD - CURSAD;                    0122 00515000
         SLR   CURSAD,CURSAD                                       0122 00516000
*                                     /*CURSOR TO ZERO         */  0123 00517000
*                     LINGRO = DSWIDE;/*GROUP TO 2260 LINE     */  0123 00518000
         SLR   LINGRO,LINGRO                                       0123 00519000
         IC    LINGRO,DSWIDE(,DACAD)                               0123 00520000
*                     GO TO WITCH1;   /*GO PROCESS DATA        */  0124 00521000
         B     WITCH1                                              0124 00522000
*                  END;               /*IF NOT ERASE WRITE     */  0125 00523000
*                ELSE;                /*IS IT WRITE TO         */  0126 00524000
@RF00119 DS    0H                                                  0127 00525000
*           IF WRCRS = '1'B           /*CURSOR                 */  0127 00526000
*                THEN                 /*YES, ESTABLISH         */  0127 00527000
         TM    WRCRS(DACAD),B'00100000'                            0127 00528000
         BNO   @RF00127                                            0127 00529000
*                  DO;                /*INITIAL VALUES         */  0128 00530000
*                     CURSAD = DACCRS;/*PICK UP CURSOR ADR     */  0129 00531000
         LH    CURSAD,DACCRS(,DACAD)                               0129 00532000
*                     SPECAR = ANWIDE;/*GET SCREEN WIDTH       */  0130 00533000
         SLR   SPECAR,SPECAR                                       0130 00534000
         IC    SPECAR,ANWIDE(,DACAD)                               0130 00535000
*/*  THE FOLLOWING 2 STATEMENTS ARE IN COMMENTS TO             */  0131 00536000
*/*  DOCUMENT THE FOLLOWING GENERATE                           */  0131 00537000
*/*                   CURLIN = CURSAD / SPECAR;                */  0131 00538000
*                                     /*DETERMINE LINE #       */  0131 00539000
*/*                   SPECAR = CURSAD // SPECAR;               */  0131 00540000
*           GEN SETS(WORKREG4,WORKREG3,CURLIN,SPECAR) REFS(CURSAD) 0131 00541000
*                                       SEQFLOW  /*Y02947*/ ;      0131 00542000
         LR    WORKREG4,CURSAD                                          00543000
         SRDA  WORKREG4,32                                              00544000
         DR    WORKREG4,SPECAR                                          00545000
         LR    CURLIN,WORKREG3                                          00546000
         LR    SPECAR,WORKREG4                                          00547000
*                                     /*CHECK TO SEE IF        */  0132 00548000
*                                     /*ANY EXCESS BEYOND      */  0132 00549000
*                     IF SPECAR = FULL0 /*LINE BOUNDRY         */  0132 00550000
*                          THEN       /* NO, SET GROUP TO      */  0132 00551000
         C     SPECAR,FULL0                                        0132 00552000
         BNE   @RF00132                                            0132 00553000
*                            DO;      /*2260 SCREEN WIDTH      */  0133 00554000
*                               LINGRO = DSWIDE;                   0134 00555000
         SLR   LINGRO,LINGRO                                       0134 00556000
         IC    LINGRO,DSWIDE(,DACAD)                               0134 00557000
*                               GO TO OP1;                         0135 00558000
         B     OP1                                                 0135 00559000
*                            END;     /*YES, SET GROUP TO      */  0136 00560000
*                          ELSE       /*REMAINDER OF LINE      */  0137 00561000
*                                  LINGRO = DSWIDE - SPECAR;       0137 00562000
@RF00132 SLR   LINGRO,LINGRO                                       0137 00563000
         IC    LINGRO,DSWIDE(,DACAD)                               0137 00564000
         SLR   LINGRO,SPECAR                                       0137 00565000
*                     GO TO OP1;      /*CURSOR TO 3270         */  0138 00566000
         B     OP1                                                 0138 00567000
*                  END;               /*NOT WRITE TO CURSR     */  0139 00568000
*                ELSE;                /*THEN MUST BE WRITE     */  0140 00569000
@RF00127 DS    0H                                                  0141 00570000
*           IF SOURCE(1) > 'FB'X | SOURCE(1) < 'F0'X               0141 00571000
*                THEN GO TO OUTERR;                                0141 00572000
         CLI   SOURCE(SOURAD),X'FB'                                0141 00573000
         BH    @RT00141                                            0141 00574000
         CLI   SOURCE(SOURAD),X'F0'                                0141 00575000
         BL    @RT00141                                            0141 00576000
*                ELSE;                                             0143 00577000
*           GEN SETS(CURLIN) REFS(SOURAD) SEQFLOW   /*Y02947*/  ;  0144 00578000
         SR    CURLIN,CURLIN                                            00579000
         IC    CURLIN,0(SOURAD)                                         00580000
         SLL   CURLIN,28           SHIFT OUT ZONES             @YA02150 00581000
         SRL   CURLIN,28           REPOSITION VALUE            @YA02150 00582000
*           SPECAR = ANWIDE;          /*GET 3270  WIDTH        */  0145 00583000
         SLR   SPECAR,SPECAR                                       0145 00584000
         IC    SPECAR,ANWIDE(,DACAD)                               0145 00585000
*           CURSAD = CURLIN * SPECAR; /*CALCULATE BUFFER       */  0146 00586000
         LR    @15,SPECAR                                          0146 00587000
         MR    @14,CURLIN                                          0146 00588000
         LR    CURSAD,@15                                          0146 00589000
*                                     /*POSITION OF LINE       */  0147 00590000
*           SOURAD = SOURAD + 1;      /*INCREMENT SOURCE       */  0147 00591000
         AH    SOURAD,@CH00061                                     0147 00592000
*           LINGRO = DSWIDE;          /*GROUP TO 2260 LINE     */  0148 00593000
         SLR   LINGRO,LINGRO                                       0148 00594000
         IC    LINGRO,DSWIDE(,DACAD)                               0148 00595000
*/**************************************************************/  0149 00596000
*/*                                                            */  0149 00597000
*/* OP1        FROM      WRITENT                               */  0149 00598000
*/*      INVOKE OUTVERT TO CALCULATE 3270 BUFFER POSITION FOR  */  0149 00599000
*/* BEGINNING OF WRITE OPERATION                               */  0149 00600000
*/**************************************************************/  0149 00601000
*OP1:;                                /*USE OUTVERT ROUTNE     */  0149 00602000
OP1      DS    0H                                                  0150 00603000
*           GEN;                                                   0150 00604000
         BAL   CARADD,OUTVERT         TO CALCULATE BUFFER               00605000
*                                     /*POSITION               */  0151 00606000
*        GO TO WITCH1;                /*GO PROCESS DATA        */  0151 00607000
         B     WITCH1                                              0151 00608000
*           GEN ;                                                  0152 00609000
         EJECT                                                          00610000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0153 00611000
*/*     PRECEDING CODE -                                       */  0153 00612000
*/*WRITENT:      D (NO,%EWRNOT,YES,) IS THIS AN ERASE WRITE        0153 00613000
*/*                OPERATION ?                                 */  0153 00614000
*/*              P (,WITCH1) CLEAR CURLIN, CURSAD,SET LINGRO TO    0153 00615000
*/*                2260 SCREEN WIDTH                           */  0153 00616000
*/*%EWRNOT:      D (YES,%WLA,NO,) IS THIS A WRITE TO LINE          0153 00617000
*/*                ADDRESS OPERATION ?                         */  0153 00618000
*/*              P PICK UP CURSOR FROM DACCRS, GET 3270            0153 00619000
*/*                SCREEN WIDTH, FIGURE LINE NUMBER            */  0153 00620000
*/*              D (YES,%LINBDY,NO,) EXCESS BEYOND LINE            0153 00621000
*/*                BOUNDRY ?                                   */  0153 00622000
*/*              P (,OP1) SET LINGRO TO 2260 SCREEN WIDTH      */  0153 00623000
*/*%LINBDY:      P (,OP1) SET LINGRO TO REMAINDER OF 2260          0153 00624000
*/*                LINE                                        */  0153 00625000
*/*%WLA:         D (YES,%OK,NO,OUTERR) LINE ADDRESS CHARACTER      0153 00626000
*/*                VALID ?                                     */  0153 00627000
*/*%OK:          P SET CURLIN TO LINE NUMBER, COMPUTE              0153 00628000
*/*                ADDRESS FROM LINE NUMBER                    */  0153 00629000
*/*OP1:          S (,WITCH1) OUTVERT: CONVERT HEXIDECIMAL TO       0153 00630000
*/*                3270 BUFFER                                 */  0153 00631000
*        GEN;                                                      0153 00632000
         EJECT                                                          00633000
*/**************************************************************/  0154 00634000
*/**************************************************************/  0154 00635000
*/*                                                            */  0154 00636000
*/*                                                            */  0154 00637000
*/*WITCH INITIALIZATION, TERMINATION, AND DATA STREAM          */  0154 00638000
*/*    PROCESSING (NOT INVOLVING SPECIAL CHARACTERS) WHICH     */  0154 00639000
*/*    IS SPECIFICALLY RELATED TO THE DATA.                    */  0154 00640000
*/*    WITCH3, WITCH4, AND NOCHAR, WHICH ARE DESCRIBED         */  0154 00641000
*/*      WITCH CONTAINS FIVE SECTIONS, WITCH1, WITCH2,         */  0154 00642000
*/*    IN THE FOLLOWING TEXT -                                 */  0154 00643000
*/*                                                            */  0154 00644000
*/*    WITCH1 IS ENTERED FROM WRITENT, WITCH4, AND SETTLE      */  0154 00645000
*/*    (IN WRSPCHAR). WITCH1 VERIFIES THE SINK, IF TOO         */  0154 00646000
*/*    SMALL IT PASSES CONTROL TO OUTSINK, VERIFIES THE        */  0154 00647000
*/*    SIZE OF THE GROUP OF DATA UNDER CONSIDERATION (IN       */  0154 00648000
*/*    REGISTER LINGRO), IF ZERO IT PASSES CONTROL TO WIT.     */  0154 00649000
*/*    THE PRIME FUNCTION OF WITCH1 IS TO SEARCH FOR           */  0154 00650000
*/*    CERTAIN CHARACTERS WHICH REQUIRE UNIQUE PROCESSING.     */  0154 00651000
*/*    THIS IS ACCOMPLISHED BY EXECUTING A TRANSLATE AND       */  0154 00652000
*/*    TEST (XLATE) AGAINST THE DATA GROUP USING TABLE.        */  0154 00653000
*/*    THE SECONDARY FUNCTION IS TO MOVE ALL CHARACTERS        */  0154 00654000
*/*    WHICH ARE NOT FOUND BY XLATE TO THE SINK AREA. IF       */  0154 00655000
*/*    A UNIQUE CHARACTER IS DISCOVERED, ONLY THOSE            */  0154 00656000
*/*    CHARACTERS PRECEDING IT IN THE DATA GROUP ARE MOVED     */  0154 00657000
*/*    TO THE SINK AREA, AND SPECIAL PROCESSING TAKES          */  0154 00658000
*/*    FOR THE SELECTED CHARACTER. A BRANCH IS MADE INTO       */  0154 00659000
*/*    WRSPCHAR TO ACCOMPLICH THIS PROCESSING. THE BRANCH      */  0154 00660000
*/*    ADDRESS IS DETERMINED BY THE FUNCTION BYTE SELECTED     */  0154 00661000
*/*    FROM TABLE BY XLATE. IF NO SPECIAL PROCESSING IS        */  0154 00662000
*/*    NEEDED, CONTROL PASSES TO NOCHAR.                       */  0154 00663000
*/*                                                            */  0154 00664000
*/*    NOCHAR 7OVES THE ENTIRE DATA GROUP TO THE SINK,         */  0154 00665000
*/*    INCREMENTS THE SINK AND SOURCE POINTERS AND THE         */  0154 00666000
*/*    CURSOR, CHECKS TO SEE IF ALL OF THE DATA HAS BEEN       */  0154 00667000
*/*    PROCESSED AND PASSES CONTROL TO WIT IF IT HAS. IF       */  0154 00668000
*/*    MORE DATA REMAINS, CONTROL IS PASSED TO WITCH2.         */  0154 00669000
*/*                                                            */  0154 00670000
*/*    WITCH2 INCREMENTS THE CURRENT LINE AND TESTS FOR        */  0154 00671000
*/*    SCREEN WRAP. IF WRAP EXISTS, CONTROL IS PASSED TO       */  0154 00672000
*/*    WALL. IF WRAP DOES NOT EXIST, THE CURSOR IS             */  0154 00673000
*/*    ADJUSTED TO THE BEGINNING OF THE NEXT 3270 LINE.        */  0154 00674000
*/*    THE 2260 AND 3270 SCREENS ARE COMPARED AND IF NOT       */  0154 00675000
*/*    EQUAL CONTROL IS PASSED TO WITCH3. IF THE 2260 AND      */  0154 00676000
*/*    3270 SCREEN ARE EQUAL, CONTROL IS PASSED TO WITCH4.     */  0154 00677000
*/*    WITCH2 MAY BE ENTERED FROM NOCHAR, WRTNEWL (IN          */  0154 00678000
*/*    WRSPCHAR).                                              */  0154 00679000
*/*                                                            */  0154 00680000
*/*    WITCH3 INSERTS A REPEAT TO ADDRESS ORDER TO NULL        */  0154 00681000
*/*    THE EXCESS 3270 SCREEN OVER THE 2260 IMAGE. CONTROL     */  0154 00682000
*/*    PASSES TO WITCH4.                                       */  0154 00683000
*/*                                                            */  0154 00684000
*/*    WITCH4 SETS THE GROUPING TO EQUAL THE 2260 WIDTH.       */  0154 00685000
*/*    CONTROL IS PASSED TO WITCH1.                            */  0154 00686000
*/*                                                            */  0154 00687000
*/**************************************************************/  0154 00688000
*/**************************************************************/  0154 00689000
*WITCH1:    GEN SETS(DACSRCAD) REFS(DACAD) SEQFLOW  /*Y02947*/  ;  0154 00690000
WITCH1   DS    0H                                                  0154 00691000
         MVI   DACSRCAD(DACAD),X'00'   INSURE HIGH BYTE CLEAR   YA01252 00692000
*           IF DACSRCAD + DACSRCLN <= SOURAD + LINGRO              0155 00693000
*                THEN                                              0155 00694000
         LH    @12,DACSRCLN(,DACAD)                                0155 00695000
         AL    @12,DACSRCAD(,DACAD)                                0155 00696000
         LR    @10,SOURAD                                          0155 00697000
         ALR   @10,LINGRO                                          0155 00698000
         CR    @12,@10                                             0155 00699000
         BH    @RF00155                                            0155 00700000
*                  DO;                                             0156 00701000
*                     LINGRO = DACSRCAD + DACSRCLN - SOURAD;       0157 00702000
         SLR   @12,SOURAD                                          0157 00703000
         LR    LINGRO,@12                                          0157 00704000
*                     IF LINGRO = FULL0                            0158 00705000
*                          THEN GO TO WRTEND;                      0158 00706000
         C     LINGRO,FULL0                                        0158 00707000
         BE    @RT00158                                            0158 00708000
*                          ELSE;                                   0160 00709000
*                  END;                                            0161 00710000
*                ELSE;                                             0162 00711000
@RF00155 DS    0H                                                  0163 00712000
*           IF DACSINAD + DACSINLN <= SINKAD + LINGRO              0163 00713000
*                THEN GO TO OUTSINK;                               0163 00714000
         LH    @12,DACSINLN(,DACAD)                                0163 00715000
         AL    @12,DACSINAD(,DACAD)                                0163 00716000
         LR    @10,SINKAD                                          0163 00717000
         ALR   @10,LINGRO                                          0163 00718000
         CR    @12,@10                                             0163 00719000
         BNH   @RT00163                                            0163 00720000
*                ELSE;                                             0165 00721000
*           GEN SETS(SPECAR,CARADD,LINGRO,WORKREG4,DACSRCAD)       0166 00722000
*             REFS(XLATE,SOURAD,DACAD) FLOWS(NOCHAR) SEQFLOW       0166 00723000
*                                                       /*Y02947*/  ;   00724000
         SR    SPECAR,SPECAR                                            00725000
         SR    CARADD,CARADD                                            00726000
         BCTR  LINGRO,0                 MAKE IT VALID LENGTH            00727000
         EX    LINGRO,XLATE                                             00728000
         BC    8,NOCHAR                                                 00729000
         SR    WORKREG4,WORKREG4     CLEAR A WORK REGISTER       CODE2  00730000
         LR    WORKREG4,CARADD       PICK UP CHARACTER ADDRESS   CODE2  00731000
         SR    WORKREG4,SOURAD       REDUCE BY START ADDRESS     CODE2  00732000
         SR    LINGRO,WORKREG4       CALCULATE REMAINDER         CODE2  00733000
         STC   LINGRO,DACSRCAD(DACAD)     SAVE VALUE             CODE2  00734000
*           LINGRO = CARADD - SOURAD; /*GROUP PRIOR TO SPECIAL */  0167 00735000
         LR    LINGRO,CARADD                                       0167 00736000
         SLR   LINGRO,SOURAD                                       0167 00737000
*           IF LINGRO ^= FULL0                                     0168 00738000
*                THEN                                              0168 00739000
         C     LINGRO,FULL0                                        0168 00740000
         BE    @RF00168                                            0168 00741000
*                  DO;                                             0169 00742000
*           GEN SETS(LINGRO) REFS(MYMOV) SEQFLOW   /*Y02947*/  ;   0170 00743000
         BCTR  LINGRO,0                                                 00744000
         EX    LINGRO,MYMOV                                             00745000
         LA    LINGRO,1(LINGRO)                                         00746000
*                     SINKAD = SINKAD + LINGRO;                    0171 00747000
         ALR   SINKAD,LINGRO                                       0171 00748000
*                     SOURAD = SOURAD + LINGRO;                    0172 00749000
         ALR   SOURAD,LINGRO                                       0172 00750000
*                  END;                                            0173 00751000
*                ELSE;                                             0174 00752000
@RF00168 DS    0H                                                  0175 00753000
*           GEN SETS (SPECAR) FLOWS (NOCHAR,WRTNLL,WRTNEWL,        0175 00754000
*            WRTSOM,WRTEOM,WRTETX) NOSEQFLOW  ;              /*Y02947*/ 00755000
         SLL   SPECAR,2                 MULTIPLY BY FOUR                00756000
         B     BRANTAB(SPECAR)          BRANCH ON ARGUMENT              00757000
*********************************************************************** 00758000
*                                                                       00759000
*   BRANTAB    FROM      PREVIOUS INSTRUCTION ONLY                      00760000
*        BRANCH UPON ARGUMENT IN SPECAR TO APPROPRIATE UNIQUE           00761000
*   CHARACTER HANDLING ROUTINE                                          00762000
*********************************************************************** 00763000
BRANTAB  EQU   *                        BRANCH TABLE FOR                00764000
*                                       EXIT FROM TRANSLATE             00765000
*                                       AND TEST, IF CONDT'N            00766000
*                                       CODE IS NOT ZERO                00767000
         B     NOCHAR                   UNUSED POSITION                 00768000
         B     WRTNLL                   NULL IN OUTPUT DATA             00769000
         B     WRTNEWL                  NEW LINE IN DATA                00770000
         B     WRTNLL                EM 3270 IN OUTPUT DATA             00771000
*                                       THIS IS INVALID AND             00772000
*                                       A BLANK WILL GO IN              00773000
         B     WRTSOM                   SOM IN OUTPUT DATA              00774000
         B     WRTNLL                AN ! IN OUTPUT DATA                00775000
*                                       THIS IS INVALID AND             00776000
*                                       A BLANK WILL GO IN              00777000
         B     WRTEOM                   EOM IN OUTPUT DATA              00778000
         B     WRTETX                   END FRAMING DETECTED            00779000
*/**************************************************************/  0176 00780000
*/*                                                            */  0176 00781000
*/* NO CHAR    FROM      WITCH1                                */  0176 00782000
*/*      DATA GROUPS WITH NO UNIQUE CHARACTERS                 */  0176 00783000
*/**************************************************************/  0176 00784000
*NOCHAR:;                                                          0176 00785000
NOCHAR   DS    0H                                                  0177 00786000
*           GEN SETS(LINGRO) REFS(MYMOV) SEQFLOW   /*Y02947*/  ;   0177 00787000
         EX    LINGRO,MYMOV                                             00788000
         LA    LINGRO,1(LINGRO)         PUT LINGRO BACK                 00789000
*           SINKAD = SINKAD + LINGRO;                              0178 00790000
         ALR   SINKAD,LINGRO                                       0178 00791000
*           SOURAD = SOURAD + LINGRO;                              0179 00792000
         ALR   SOURAD,LINGRO                                       0179 00793000
*           CURSAD = CURSAD + LINGRO;                              0180 00794000
         ALR   CURSAD,LINGRO                                       0180 00795000
*WRTDONE:;                                                         0181 00796000
WRTDONE  DS    0H                                                  0182 00797000
*           IF SOURAD >= DACSRCAD + DACSRCLN                       0182 00798000
*                THEN                                              0182 00799000
         LH    @12,DACSRCLN(,DACAD)                                0182 00800000
         AL    @12,DACSRCAD(,DACAD)                                0182 00801000
         CR    SOURAD,@12                                          0182 00802000
         BL    @RF00182                                            0182 00803000
*                  DO;                                             0183 00804000
*WRTEND:;                                                          0184 00805000
WRTEND   DS    0H                                                  0185 00806000
*                     GEN SETS(WORKREG4,WORKREG3,REG0,DACFLG)      0185 00807000
*                      REFS(ANWIDE,DACAD,DSWIDE,DSLINE) FLOWS(WIT) 0185 00808000
*                                           NOSEQFLOW  /*Y02947*/ ;     00809000
         SR    WORKREG4,WORKREG4               GET A WORK REGISTER      00810000
         SR    WORKREG3,WORKREG3               GET A WORK REGISTER      00811000
         SR    REG0,REG0                     GET A WORK REGISTER        00812000
         LR    WORKREG3,CURSAD               GET CURSOR ADDRESS         00813000
         IC    REG0,ANWIDE(DACAD)             GET 3270 WIDTH            00814000
         DR    WORKREG4,REG0                    FIND WHERE ON 3270      00815000
         IC    REG0,DSWIDE(DACAD)     PICK UP 2260 WIDTH       @YA02150 00816000
         CR    WORKREG4,REG0       CURSOR BEYOND MAX COLUMN ?  @YA02150 00817000
         BNL   SETBLAT             YES, GO SET FLAG            @YA02150 00818000
         IC    REG0,DSLINE(DACAD)     PICK UP 2260 LINE COUNT  @YA02150 00819000
         CR    WORKREG3,REG0       CURSOR BEYOND MAX VALUE ?   @YA02150 00820000
         BNL   SETBLAT             YES, GO SET FLAG            @YA02150 00821000
         B     WIT                 NO, CURSOR OK               @YA02150 00822000
SETBLAT  EQU   *                   SET CURSOR ADJUST FLAG      @YA02150 00823000
         OI    DACFLG(DACAD),B'10000000' SET THE 'BLAT' FLAG   @YA02150 00824000
         B     WIT                 GO DO WRITE CLEANUP         @YA02150 00825000
*                  END;                                            0186 00826000
*                ELSE;                  /*FINALIZE             */  0187 00827000
@RF00182 DS    0H                                                  0188 00828000
*/**************************************************************/  0188 00829000
*/*                                                            */  0188 00830000
*/* WITCH2     FROM      WRTNEWL                               */  0188 00831000
*/*      AT THE END OF A 2260 LINE - PERTINENT PROCESSING      */  0188 00832000
*/**************************************************************/  0188 00833000
*WITCH2:    CURLIN = CURLIN + ONE;                                 0188 00834000
WITCH2   AL    CURLIN,ONE                                          0188 00835000
*           GEN SETS(SPECAR) REFS(DSLINE,DACAD) SEQFLOW   /*Y02947*/ ;  00836000
         SR    SPECAR,SPECAR                                            00837000
         IC    SPECAR,DSLINE(DACAD)                                     00838000
*           IF CURLIN = SPECAR                                     0190 00839000
*                THEN GO TO WALL;                                  0190 00840000
         CR    CURLIN,SPECAR                                       0190 00841000
         BE    @RT00190                                            0190 00842000
*                ELSE;                                             0192 00843000
*          GEN SETS(SPECAR) REFS(ANWIDE,DACAD) SEQFLOW  /*Y02947*/  ;   00844000
         IC    SPECAR,ANWIDE(DACAD)                                     00845000
*          CURSAD = CURLIN * SPECAR;                               0194 00846000
         LR    @15,SPECAR                                          0194 00847000
         MR    @14,CURLIN                                          0194 00848000
         LR    CURSAD,@15                                          0194 00849000
*          GEN SETS(CARADD) REFS(DSWIDE,DACAD) SEQFLOW   /*Y02947*/  ;  00850000
         SR    CARADD,CARADD                                            00851000
         IC    CARADD,DSWIDE(DACAD)                                     00852000
*GENA:;                                                            0196 00853000
GENA     DS    0H                                                  0197 00854000
*             /* GERMAN EXTENDED NETWORK ACCESS METHOD */          0197 00855000
*             /* FIXED INTERFACE ENTRY  10/06/72 STB   */          0197 00856000
*          GEN;                                                    0197 00857000
         ENTRY GENA                                                     00858000
*          IF  SPECAR ^= CARADD                                    0198 00859000
*                THEN                                              0198 00860000
         CR    SPECAR,CARADD                                       0198 00861000
         BE    @RF00198                                            0198 00862000
*                  DO;                                             0199 00863000
*/**************************************************************/  0200 00864000
*/*                                                            */  0200 00865000
*/* WITCH3     FROM      WALL, WALL2                           */  0200 00866000
*/*      END OF LINE RTA ORDER, SCREEN WRAP ENTRY              */  0200 00867000
*/**************************************************************/  0200 00868000
*WITCH3:;                                                          0200 00869000
WITCH3   DS    0H                                                  0201 00870000
*           GEN SETS(CURSAD,REG0,SPECAR) REFS(WITCH4)              0201 00871000
*                     FLOWS(RTABUILD) SEQFLOW    /*Y02947*/ ;      0201 00872000
         LTR   CURSAD,CURSAD           RTA FOR SCREEN WRAP ?            00873000
         BNZ   NOBUILD                 NO, DO NORMAL RTA                00874000
         SR    REG0,REG0               CLEAR A WORK REG                 00875000
*                                      LEAVE A NULL IN REG 0            00876000
         LA    SPECAR,WITCH4           SET UP RETURN POINT              00877000
         B     RTABUILD                                                 00878000
*NOBUILD:;                                                         0202 00879000
NOBUILD  DS    0H                                                  0203 00880000
*                     SINK(1) = '3C'X; /*PUT RTA ORDER IN SINK */  0203 00881000
         MVI   SINK(SINKAD),X'3C'                                  0203 00882000
*                     SINKAD = SINKAD + ONE;                       0204 00883000
         AL    SINKAD,ONE                                          0204 00884000
*           GEN;                                                   0205 00885000
         BAL   CARADD,OUTVERT                                           00886000
*                     SINK(1) = '00'X; /*REPEAT A NULL         */  0206 00887000
         MVI   SINK(SINKAD),X'00'                                  0206 00888000
*                     SINKAD = SINKAD + ONE;                       0207 00889000
         AL    SINKAD,ONE                                          0207 00890000
*                  END;                                            0208 00891000
*                ELSE;                                             0209 00892000
@RF00198 DS    0H                                                  0210 00893000
*/**************************************************************/  0210 00894000
*/*                                                            */  0210 00895000
*/* WITCH4     FROM      WALL1                                 */  0210 00896000
*/*      END OF LINE, SCREEN WRAP ENTRY, EQUAL SCREENS         */  0210 00897000
*/**************************************************************/  0210 00898000
*WITCH4:;                                                          0210 00899000
WITCH4   DS    0H                                                  0211 00900000
*             IF DACDSSCR = DACANSCR & CURLIN = DSLINE - 1         0211 00901000
*                & PROT = '1'B                                     0211 00902000
*                  THEN LINGRO = DSWIDE - 1;                       0211 00903000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0211 00904000
         BNE   @RF00211                                            0211 00905000
         SLR   @12,@12                                             0211 00906000
         IC    @12,DSLINE(,DACAD)                                  0211 00907000
         BCTR  @12,0                                               0211 00908000
         CR    CURLIN,@12                                          0211 00909000
         BNE   @RF00211                                            0211 00910000
         TM    PROT(DACAD),B'01000000'                             0211 00911000
         BNO   @RF00211                                            0211 00912000
         SLR   LINGRO,LINGRO                                       0212 00913000
         IC    LINGRO,DSWIDE(,DACAD)                               0212 00914000
         BCTR  LINGRO,0                                            0212 00915000
*                  ELSE LINGRO = DSWIDE;                           0213 00916000
         B     @RC00211                                            0213 00917000
@RF00211 SLR   LINGRO,LINGRO                                       0213 00918000
         IC    LINGRO,DSWIDE(,DACAD)                               0213 00919000
*          GO TO WITCH1;                                           0214 00920000
         B     WITCH1                                              0214 00921000
*           GEN;                                                   0215 00922000
         EJECT                                                          00923000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0216 00924000
*/*     PRECEDING CODE -                                       */  0216 00925000
*/*WITCH1:       D (NO,%SINKOK,YES,) DOES LINGRO EXTEND PAST       0216 00926000
*/*                SOURCE ?                                    */  0216 00927000
*/*              P SET LINGRO TO REMAINDER OF SOURCE           */  0216 00928000
*/*              D (NO,%SINKOK,YES,WIT) IS LINGRO = ZERO ?     */  0216 00929000
*/*%SINKOK:      D (NO,%GOON1,YES,OUTSINK) WILL LINGRO EXCEDE THE  0216 00930000
*/*                SINK ?                                      */  0216 00931000
*/*%GOON1:       P USE 'XLATE' TO CHECK FOR UNIQUE                 0216 00932000
*/*                CHARACTERS                                  */  0216 00933000
*/*              D (NO,NOCHAR,YES,) ANY UNIQUE CHARACTER ?     */  0216 00934000
*/*              P CALCULATE COUNT PRECEDING THE UNIQUE            0216 00935000
*/*                CHARACTER                                   */  0216 00936000
*/*              D (NO,%BRAN,YES,) ARE THERE ANY CHARACTERS        0216 00937000
*/*                TO MOVE ?                                   */  0216 00938000
*/*              P MOVE THE PRECEDING CHARACTERS, BUMP THE         0216 00939000
*/*                SINK AND SOURCE                             */  0216 00940000
*/*%BRAN:        D (NULL,WRTNLL,NL,WRTNEWL,EM,WRTNLL,SOM,          0216 00941000
*/*                WRTSOM,!,WRTNLL,EOM,WRTEOM,ETX,                 0216 00942000
*/*                WRTETX) GO PROCESS UNIQUE CHARACTER         */  0216 00943000
*/*NOCHAR:       P MOVE FULL GROUP TO SINK, BUMP SINK AND          0216 00944000
*/*                SOURCE BY GROUP COUNT                       */  0216 00945000
*/*              P INCREMENT CURSAD BY GROUP COUNT             */  0216 00946000
*/*              D (NO,WITCH2,YES,WIT) SOURCE EXPENDED ?       */  0216 00947000
*/*WITCH2:       P INCREMENT CURLIN BY ONE                     */  0216 00948000
*/*              D (NO,%SETCURS,YES,WALL) LAST LINE ON 2260 ?  */  0216 00949000
*/*%SETCURS:     P SET CURSAD TO BEGINNING OF NEXT LINE        */  0216 00950000
*/*              D (YES,WITCH4,NO,WITCH3) ARE THE SCREENS          0216 00951000
*/*                EQUAL ?                                     */  0216 00952000
*/*WITCH3:       D (YES,NOBUILD,NO,) SINGLE LINE RTA ?         */  0216 00953000
*/*              P SET RETURN TO WITCH4, CHARACTER TO NULL     */  0216 00954000
*/*              S (,WITCH4) RTABUILD:CONSTRUCT RTA ORDER(S)   */  0216 00955000
*/*NOBUILD:      P PUT A REPEAT TO ADDRESS ORDER IN THE SINK       0216 00956000
*/*                AND BUMP THE SINK                           */  0216 00957000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0216 00958000
*/*              P PUT A NULL IN THE SINK AND BUMP SINK        */  0216 00959000
*/*WITCH4:       P (,WITCH1) SET LINGRO TO 2260 WIDTH          */  0216 00960000
*        GEN;                                                      0216 00961000
         EJECT                                                          00962000
*/**************************************************************/  0217 00963000
*/**************************************************************/  0217 00964000
*/*                                                            */  0217 00965000
*/*                                                            */  0217 00966000
*/* WALL ENTERED IF WRAP AROUND IS DETECTED, FROM WITCH2       */  0217 00967000
*/*    (IN WITCH). WALL HANDLES THE FUNCTION OF FORMATTING     */  0217 00968000
*/*    THE 3270 SCREEN SO AS TO MAINTAIN THE 2260 IMAGE.       */  0217 00969000
*/*    WALL CALCULATES THE DISPLACEMENT FOR AND INSERTS        */  0217 00970000
*/*    THE PROTECTED ATTRIBUTE IF PROT = YES. WALL PUTS        */  0217 00971000
*/*    A REPEAT TO ADDRESS OF NULLS TO SCREEN POSITION         */  0217 00972000
*/*    ZERO IF  THE 3270 DOES NOT EQUAL THE 2260 BY            */  0217 00973000
*/*    SETTING THE CURSOR TO ZERO AND PASSING CONTROL TO       */  0217 00974000
*/*    WITCH3. IF NO RTA IS NEEDED, CONTROL IS PASSED TO       */  0217 00975000
*/*    WITCH4. IN ANY CASE, THE CURRENT LINE IS SET TO         */  0217 00976000
*/*    ZERO, AND THE CURSOR IS SET TO ZERO.                    */  0217 00977000
*/*                                                            */  0217 00978000
*/**************************************************************/  0217 00979000
*/**************************************************************/  0217 00980000
*WALL:;                                                            0217 00981000
WALL     DS    0H                                                  0218 00982000
*           IF PROT = '1'B                                         0218 00983000
*                THEN                                              0218 00984000
         TM    PROT(DACAD),B'01000000'                             0218 00985000
         BNO   @RF00218                                            0218 00986000
*                  DO;                                             0219 00987000
*                     IF DACDSSCR = DACANSCR                       0220 00988000
*                          THEN                                    0220 00989000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0220 00990000
         BNE   @RF00220                                            0220 00991000
*                            DO;                                   0221 00992000
*           GEN SETS(CARADD,SPECAR) REFS(DACAD,ANWIDE,ANLINE)      0222 00993000
*                               SEQFLOW      /*Y02947*/  ;         0222 00994000
         SR    CARADD,CARADD                                            00995000
         SR    SPECAR,SPECAR                                            00996000
         IC    CARADD,ANWIDE(DACAD)                                     00997000
         IC    SPECAR,ANLINE(DACAD)                                     00998000
*                               CURSAD = SPECAR * CARADD - 1;      0223 00999000
         LR    @15,CARADD                                          0223 01000000
         MR    @14,SPECAR                                          0223 01001000
         BCTR  @15,0                                               0223 01002000
         LR    CURSAD,@15                                          0223 01003000
*                            END;                                  0224 01004000
*                          ELSE                                    0225 01005000
*                            DO;                                   0225 01006000
         B     @RC00220                                            0225 01007000
@RF00220 DS    0H                                                  0226 01008000
*           GEN SETS(CARADD,SPECAR) REFS(DACAD,ANWIDE,DSWIDE)      0226 01009000
*                               SEQFLOW        /*Y02947*/  ;       0226 01010000
         SR    CARADD,CARADD                                            01011000
         SR    SPECAR,SPECAR                                            01012000
         IC    CARADD,ANWIDE(DACAD)                                     01013000
         IC    SPECAR,DSWIDE(DACAD)                                     01014000
*                               CURSAD = CARADD * (CURLIN - ONE) + 0227 01015000
*                                SPECAR;                           0227 01016000
         LR    @15,CURLIN                                          0227 01017000
         SL    @15,ONE                                             0227 01018000
         MR    @14,CARADD                                          0227 01019000
         ALR   @15,SPECAR                                          0227 01020000
         LR    CURSAD,@15                                          0227 01021000
*                            END;                                  0228 01022000
*                     SINK(1) = '11'X;                             0229 01023000
@RC00220 MVI   SINK(SINKAD),X'11'                                  0229 01024000
*                     SINKAD = SINKAD + 1;                         0230 01025000
         AH    SINKAD,@CH00061                                     0230 01026000
*                     GEN;                                         0231 01027000
         BAL   CARADD,OUTVERT                                           01028000
*                               SINK(1) = '1D'X; /*SF ORDER    */  0232 01029000
         MVI   SINK(SINKAD),X'1D'                                  0232 01030000
*                               SINKAD = SINKAD + ONE;             0233 01031000
         AL    SINKAD,ONE                                          0233 01032000
*                               SINK(1) = '60'X; /*PROT ATTRIB */  0234 01033000
         MVI   SINK(SINKAD),X'60'                                  0234 01034000
*                               SINKAD = SINKAD + 1;               0235 01035000
         AH    SINKAD,@CH00061                                     0235 01036000
*/**************************************************************/  0236 01037000
*/*                                                            */  0236 01038000
*/* WALL2      FROM      WALL                                  */  0236 01039000
*/*      SCREEN WRAP PROCESSING, PROT = NO SPECIFIED           */  0236 01040000
*/**************************************************************/  0236 01041000
*WALL2:;                                                           0236 01042000
WALL2    DS    0H                                                  0237 01043000
*           CURLIN = CURLIN - CURLIN;                              0237 01044000
         SLR   CURLIN,CURLIN                                       0237 01045000
*           CURSAD = CURSAD - CURSAD;                              0238 01046000
         SLR   CURSAD,CURSAD                                       0238 01047000
*           IF DACDSSCR = DACANSCR                                 0239 01048000
*                THEN GO TO WITCH4;                                0239 01049000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0239 01050000
         BE    @RT00239                                            0239 01051000
*                ELSE GO TO WITCH3;                                0241 01052000
         B     WITCH3                                              0241 01053000
*                  END;                                            0242 01054000
*                ELSE                                              0243 01055000
*                GO TO WALL2;                                      0243 01056000
*           GEN;                                                   0244 01057000
         EJECT                                                          01058000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0245 01059000
*/*     PRECEDING CODE -                                       */  0245 01060000
*/*WALL:         D (NO,WALL2,YES,) PROT = YES SPECIFIED IN         0245 01061000
*/*                DACA ?                                      */  0245 01062000
*/*              D (NO,%NOTEQ,YES,) 3270 SIZE = 2260 SIZE          0245 01063000
*/*                ?                                           */  0245 01064000
*/*              P (,%SETSBA) SET CURSAD TO POINT TO LAST          0245 01065000
*/*                POSITION OF 2260 SCREEN                     */  0245 01066000
*/*%NOTEQ:       P SET CURSAD TO POINT ONE PAST LAST 2260          0245 01067000
*/*                SCREEN POSITION                             */  0245 01068000
*/*%SETSBA:      P SET BUFFER ADDRESS ORDER IN SINK AND            0245 01069000
*/*                BUMP SINK                                   */  0245 01070000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0245 01071000
*/*              P START FIELD, PROTECTED ATTRIBUTE IN             0245 01072000
*/*                SINK, BUMP SINK TWO                         */  0245 01073000
*/*              P SET CURLIN TO ZERO, CURSAD TO ZERO          */  0245 01074000
*/*              D (NO,WITCH3,YES,WALL1) 3270 SIZE = 2260 SIZE?*/  0245 01075000
*/*WALL1:        P (,WITCH4) CLEAR CURLIN, CURSAD TO ZERO      */  0245 01076000
*/*WALL2:        D (YES,WALL1,NO,) 3270 SIZE = 2260 SIZE ?     */  0245 01077000
*/*              P (,WITCH3) CLEAR CURLIN, CURSAD TO ZERO      */  0245 01078000
*        GEN;                                                      0245 01079000
         EJECT                                                          01080000
*/**************************************************************/  0246 01081000
*/**************************************************************/  0246 01082000
*/*                                                            */  0246 01083000
*/*                                                            */  0246 01084000
*/* WRSPCHAR A COLLECTION OF SUBROUTINES TO DEAL WITH          */  0246 01085000
*/*    CHARACTERS REQUIRING SPECIAL ACTION. EACH               */  0246 01086000
*/*    SUBROUTINE IS AN INDIVIDUAL ENTITY, AND NOT             */  0246 01087000
*/*    SPECIFICALLY RELATED TO ANY OTHER. SETTLE IS A          */  0246 01088000
*/*    HOUSEKEEPING FACILITY USED BY SEVERAL, BUT NOT ALL,     */  0246 01089000
*/*    OF THE SUBROUTINES. ALL ARE ENTERED FROM WITCH.         */  0246 01090000
*/*    THE SUBROUTINES ARE:                                    */  0246 01091000
*/*                                                            */  0246 01092000
*/*       WRTNEWL NEW LINE CHARACTER DETECTED IN DATA          */  0246 01093000
*/*          ADJUST CURSOR TO NEXT LINE                        */  0246 01094000
*/*          REPEAT BLANKS (NULLS IF RVOID = YES) TO END       */  0246 01095000
*/*          OF 2260 LINE                                      */  0246 01096000
*/*          PASS CONTROL TO WITCH2                            */  0246 01097000
*/*                                                            */  0246 01098000
*/*       WRTSOM START OF MESSAGE SYMBOL DETECTED IN DATA      */  0246 01099000
*/*          SET A FIELD (UNPROTECTED)                         */  0246 01100000
*/*          PASS CONTROL TO SETTLE                            */  0246 01101000
*/*                                                            */  0246 01102000
*/*       WRTEOM END OF MESSAGE SYMBOL DETECTED IN DATA        */  0246 01103000
*/*          PUT AN EXCLAIMATION POINT IN SINK                 */  0246 01104000
*/*          SET A 3270 END OF MESSAGE                         */  0246 01105000
*/*          PASS CONTROL TO SETTLE                            */  0246 01106000
*/*                                                            */  0246 01107000
*/*       WRTETX ETX DETECTED IN DATA                          */  0246 01108000
*/*          IF REMOTE IS KNOWN, PASS CONTROL TO WIT           */  0246 01109000
*/*          IF NOT KNOWN, REPROCESS AS REMOTE BY RESET        */  0246 01110000
*/*          OF SINK AND SOURCE POINTERS AND PASSING           */  0246 01111000
*/*          CONTROL TO BACKGO (IN HOUSEKEEPING)               */  0246 01112000
*/*                                                            */  0246 01113000
*/*       WRTNLL NULL DETECTED IN DATA STREAM                  */  0246 01114000
*/*          INSERT BLANK IN SINK                              */  0246 01115000
*/*          PASS CONTROL TO SETTLE                            */  0246 01116000
*/*                                                            */  0246 01117000
*/*       SETTLE HOUSEKEEPING FACILITY                         */  0246 01118000
*/*          ADJUST SOURCE POINTER                             */  0246 01119000
*/*          ADJUST CURSOR                                     */  0246 01120000
*/*          IF FROM WRTSOM, SAVE SOM POSITION                 */  0246 01121000
*/*          PASS CONTROL TO WITCH1                            */  0246 01122000
*/*                                                            */  0246 01123000
*/**************************************************************/  0246 01124000
*/**************************************************************/  0246 01125000
*/**************************************************************/  0246 01126000
*/*                                                            */  0246 01127000
*/* WRTNEWL    FROM      BRANTAB                               */  0246 01128000
*/*      NEW LINE CHARACTER PROCESSING                         */  0246 01129000
*/**************************************************************/  0246 01130000
*WRTNEWL:;                                                         0246 01131000
WRTNEWL  DS    0H                                                  0247 01132000
*                      SINK(1) = '1E'X;                            0247 01133000
         MVI   SINK(SINKAD),X'1E'                                  0247 01134000
*                      SINKAD = SINKAD + 1;                        0248 01135000
         AH    SINKAD,@CH00061                                     0248 01136000
*                      GEN REFS(DACSRCAD,DACAD) FLOWS(ENDSCRN)     0249 01137000
*                          SEQFLOW ;     /*Y02947*/                0249 01138000
         CLI   DACSRCAD(DACAD),X'00'  THIS LINE GROUP EXPENDED?  CODE2  01139000
         BNH   ENDSCRN             YES, NO SBA NEEDED           YA01253 01140000
*WRTNEW1:;                                                  /*YA02152*/ 01141000
WRTNEW1  DS    0H                                                  0251 01142000
*                      CURSAD = (CURLIN + 1) * ANWIDE;             0251 01143000
         LA    @15,1                                               0251 01144000
         ALR   @15,CURLIN                                          0251 01145000
         SLR   CURSAD,CURSAD                                       0251 01146000
         IC    CURSAD,ANWIDE(,DACAD)                               0251 01147000
         MR    @14,CURSAD                                          0251 01148000
         LR    CURSAD,@15                                          0251 01149000
*          CTLCOMP:   IF CURLIN + 1 = DSLINE                       0252 01150000
*                          THEN DO;                                0252 01151000
CTLCOMP  LA    @12,1                                               0252 01152000
         ALR   @12,CURLIN                                          0252 01153000
         SLR   @10,@10                                             0252 01154000
         IC    @10,DSLINE(,DACAD)                                  0252 01155000
         CR    @12,@10                                             0252 01156000
         BNE   @RF00252                                            0252 01157000
*                            IF ANWIDE = DSWIDE                    0254 01158000
*                                THEN DO;                   /*YA03264*/ 01159000
         CLC   ANWIDE(1,DACAD),DSWIDE(DACAD)                       0254 01160000
         BNE   @RF00254                                            0254 01161000
*                                 IF ANLINE^= DSLINE        /*YA03264*/ 01162000
*                                  THEN GO TO ENDSCRN;      /*YA03264*/ 01163000
         CLC   ANLINE(1,DACAD),DSLINE(DACAD)                       0256 01164000
         BNE   @RT00256                                            0256 01165000
*                                    ELSE DO;               /*YA03264*/ 01166000
*                                   CURSAD = CURSAD         /*YA03264*/ 01167000
*                                         - CURSAD;         /*YA03264*/ 01168000
         SLR   CURSAD,CURSAD                                       0259 01169000
*                                  BLAT = '1'B;             /*YA03264*/ 01170000
         OI    BLAT(DACAD),B'10000000'                             0260 01171000
*                                  END;                     /*YA03264*/ 01172000
*                          END;                             /*YA03264*/ 01173000
*                                 ELSE;                            0263 01174000
@RF00254 DS    0H                                                  0264 01175000
*                               END;                               0264 01176000
*                          ELSE;                                   0265 01177000
@RF00252 DS    0H                                                  0266 01178000
*PLUGSBA:;                                                         0266 01179000
PLUGSBA  DS    0H                                                  0267 01180000
*                      SINK(1) = '11'X;                            0267 01181000
         MVI   SINK(SINKAD),X'11'                                  0267 01182000
*                      SINKAD = SINKAD + 1;                        0268 01183000
         AH    SINKAD,@CH00061                                     0268 01184000
*                      SPECAR = CURSAD;                            0269 01185000
         LR    SPECAR,CURSAD                                       0269 01186000
*                IF BLAT = '1'B                                    0270 01187000
*                   THEN GO TO WRTNEW2;                            0270 01188000
         TM    BLAT(DACAD),B'10000000'                             0270 01189000
         BO    @RT00270                                            0270 01190000
*                   ELSE;                                          0272 01191000
*                      CURSAD = CURSAD - ANWIDE + DSWIDE;          0273 01192000
         LR    @12,CURSAD                                          0273 01193000
         SLR   @10,@10                                             0273 01194000
         IC    @10,ANWIDE(,DACAD)                                  0273 01195000
         SLR   @12,@10                                             0273 01196000
         SLR   @10,@10                                             0273 01197000
         IC    @10,DSWIDE(,DACAD)                                  0273 01198000
         ALR   @12,@10                                             0273 01199000
         LR    CURSAD,@12                                          0273 01200000
*WRTNEW2:;                                                  /*YA02152*/ 01201000
WRTNEW2  DS    0H                                                  0275 01202000
*                      GEN;                                        0275 01203000
         BAL   CARADD,OUTVERT                                           01204000
*                      CURSAD = SPECAR;                            0276 01205000
         LR    CURSAD,SPECAR                                       0276 01206000
*ENDSCRN:;                                                         0277 01207000
ENDSCRN  DS    0H                                                  0278 01208000
*                IF BLAT = '1'B                             /*YA02152*/ 01209000
*                   THEN  GO TO SETTLE1;                           0278 01210000
         TM    BLAT(DACAD),B'10000000'                             0278 01211000
         BO    @RT00278                                            0278 01212000
*                   ELSE;                                          0280 01213000
*                      BLAT = '1'B;                                0281 01214000
         OI    BLAT(DACAD),B'10000000'                             0281 01215000
*                GEN REFS(DACSRCAD,DACAD) FLOWS(SETTLE1)           0282 01216000
*                 SEQFLOW ;    /*Y02947*/                          0282 01217000
         CLI   DACSRCAD(DACAD),X'00' THIS LINE GROUP EXPENDED?  YA02152 01218000
         BNE   SETTLE1             NO, NO SBA NEEDED            YA02152 01219000
*                IF (1 + LINGRO + CURSAD) // DSWIDE ^= FULL0       0283 01220000
*                   THEN GO TO WRTNEW1;                     /*YA02152*/ 01221000
         LA    @12,1                                               0283 01222000
         LR    @10,LINGRO                                          0283 01223000
         ALR   @10,@12                                             0283 01224000
         ALR   @10,CURSAD                                          0283 01225000
         LR    @14,@10                                             0283 01226000
         SRDA  @14,32                                              0283 01227000
         SLR   @10,@10                                             0283 01228000
         IC    @10,DSWIDE(,DACAD)                                  0283 01229000
         DR    @14,@10                                             0283 01230000
         C     @14,FULL0                                           0283 01231000
         BNE   @RT00283                                            0283 01232000
*                   ELSE;                                          0285 01233000
*                CURSAD = (CURLIN + 1) * ANWIDE;                   0286 01234000
         LR    @15,@12                                             0286 01235000
         ALR   @15,CURLIN                                          0286 01236000
         SLR   CURSAD,CURSAD                                       0286 01237000
         IC    CURSAD,ANWIDE(,DACAD)                               0286 01238000
         MR    @14,CURSAD                                          0286 01239000
         LR    CURSAD,@15                                          0286 01240000
*                      GO TO SETTLE1;                              0287 01241000
         B     SETTLE1                                             0287 01242000
*/**************************************************************/  0288 01243000
*/*                                                            */  0288 01244000
*/* WRTSOM     FROM      BRANTAB                               */  0288 01245000
*/*      START OF MESSAGE SYMBOL PROCESSING                    */  0288 01246000
*/**************************************************************/  0288 01247000
*WRTSOM:;                                                          0288 01248000
WRTSOM   DS    0H                                                  0289 01249000
*                      SINK(1) = '1D'X; /*PUT SF ORDER IN SINK */  0289 01250000
         MVI   SINK(SINKAD),X'1D'                                  0289 01251000
*                     SINKAD = SINKAD + ONE;                       0290 01252000
         L     @12,ONE                                             0290 01253000
         ALR   SINKAD,@12                                          0290 01254000
*                      SINK(1) = 'C1'X; /*PUT ATTRIBUTE IN SINK*/  0291 01255000
         MVI   SINK(SINKAD),X'C1'                                  0291 01256000
*                     SINKAD = SINKAD + ONE;                       0292 01257000
         ALR   SINKAD,@12                                          0292 01258000
*                     SOMP = '1'B;                                 0293 01259000
         OI    SOMP(DACAD),B'00100000'                             0293 01260000
*                     GO TO SETTLE;                                0294 01261000
         B     SETTLE                                              0294 01262000
*/**************************************************************/  0295 01263000
*/*                                                            */  0295 01264000
*/* WRTEOM     FROM      BRANTAB                               */  0295 01265000
*/*      END OF MESSAGE CHARACTER PROCESSING                   */  0295 01266000
*/**************************************************************/  0295 01267000
*WRTEOM:;                                                          0295 01268000
WRTEOM   DS    0H                                                  0296 01269000
*                      SINK(1) = '5A'X; /*PUT A ! IN THE SINK  */  0296 01270000
         MVI   SINK(SINKAD),X'5A'                                  0296 01271000
*                     SINKAD = SINKAD + ONE;                       0297 01272000
         L     @12,ONE                                             0297 01273000
         ALR   SINKAD,@12                                          0297 01274000
*                      SINK(1) = '19'X; /*PUT EM IN SINK       */  0298 01275000
         MVI   SINK(SINKAD),X'19'                                  0298 01276000
*                     SINKAD = SINKAD + ONE;                       0299 01277000
         ALR   SINKAD,@12                                          0299 01278000
*                          GO TO SETTLE;                           0300 01279000
         B     SETTLE                                              0300 01280000
*/**************************************************************/  0301 01281000
*/*                                                            */  0301 01282000
*/* WRTETX     FROM      BRANTAB                               */  0301 01283000
*/*      END TRANSMISSION CHARACTER PROCESSING                 */  0301 01284000
*/**************************************************************/  0301 01285000
*WRTETX:;                             /* END FRAMING CHAR      */  0301 01286000
WRTETX   DS    0H                                                  0302 01287000
*           IF RMTDV = '1'B                                        0302 01288000
*                THEN                                              0302 01289000
         TM    RMTDV(DACAD),B'00000001'                            0302 01290000
         BNO   @RF00302                                            0302 01291000
*                  DO;                                             0303 01292000
*                     IF CURSAD = FULL0                            0304 01293000
*                          THEN                                    0304 01294000
         C     CURSAD,FULL0                                        0304 01295000
         BNE   @RF00304                                            0304 01296000
*                            DO;                                   0305 01297000
*                               BLAT = '1'B;                       0306 01298000
         OI    BLAT(DACAD),B'10000000'                             0306 01299000
*                               CURLIN = DSLINE - 1;               0307 01300000
         SLR   CURLIN,CURLIN                                       0307 01301000
         IC    CURLIN,DSLINE(,DACAD)                               0307 01302000
         BCTR  CURLIN,0                                            0307 01303000
*                            END;                                  0308 01304000
*                          ELSE;                                   0309 01305000
@RF00304 DS    0H                                                  0310 01306000
*                     GO TO WIT;                                   0310 01307000
         B     WIT                                                 0310 01308000
*                  END;                                            0311 01309000
*                ELSE                                              0312 01310000
*                  DO;                                             0312 01311000
@RF00302 DS    0H                                                  0313 01312000
*                     SOURAD = DACSRCAD;                           0313 01313000
         L     SOURAD,DACSRCAD(,DACAD)                             0313 01314000
*                     SINKAD = DACSINAD;                           0314 01315000
         L     SINKAD,DACSINAD(,DACAD)                             0314 01316000
*                     GO TO BACKGO;                                0315 01317000
         B     BACKGO                                              0315 01318000
*                  END;                                            0316 01319000
*/**************************************************************/  0317 01320000
*/*                                                            */  0317 01321000
*/* WRTNLL     FROM      BRANTAB                               */  0317 01322000
*/*      NULL OR INVALID CHARACGER PROCESSING                  */  0317 01323000
*/**************************************************************/  0317 01324000
*WRTNLL:;                                                          0317 01325000
WRTNLL   DS    0H                                                  0318 01326000
*                          SINK(1) = '40'X; /*PUT BLANK IN SINK*/  0318 01327000
         MVI   SINK(SINKAD),X'40'                                  0318 01328000
*                          SINKAD = SINKAD + ONE;                  0319 01329000
         AL    SINKAD,ONE                                          0319 01330000
*/**************************************************************/  0320 01331000
*/*                                                            */  0320 01332000
*/* SETTLE     FROM      WRTSOM, WRTEOM, WRTNLL                */  0320 01333000
*/*      RETURN ROUTE TO MAIN DATA STREAM PROCESSING           */  0320 01334000
*/**************************************************************/  0320 01335000
*SETTLE:;                                                          0320 01336000
SETTLE   DS    0H                                                  0321 01337000
*                      CURSAD = CURSAD + LINGRO + 1;               0321 01338000
         LR    @12,CURSAD                                          0321 01339000
         ALR   @12,LINGRO                                          0321 01340000
         AH    @12,@CH00061                                        0321 01341000
         LR    CURSAD,@12                                          0321 01342000
*SETTLE1:;                                                         0322 01343000
SETTLE1  DS    0H                                                  0323 01344000
*                      SOURAD = SOURAD + 1;                        0323 01345000
         AH    SOURAD,@CH00061                                     0323 01346000
*           GEN SETS(LINGRO,DACSRCAD) REFS(DACAD) SEQFLOW ; /*Y02947*/  01347000
         SR    LINGRO,LINGRO       CLEAR MOVED VALUE OUT        CODE2   01348000
         IC    LINGRO,DACSRCAD(DACAD) PICK UP REMAINING VALUE   A58221  01349000
         XC    DACSRCAD(1,DACAD),DACSRCAD(DACAD) CLEAR SAVE BYTE A58221 01350000
*           IF SOMP = '1'B                                         0325 01351000
*                THEN                                              0325 01352000
         TM    SOMP(DACAD),B'00100000'                             0325 01353000
         BNO   @RF00325                                            0325 01354000
*                  DO;                                             0326 01355000
*                     SOMADD = CURSAD - ONE;                       0327 01356000
         LR    SOMADD,CURSAD                                       0327 01357000
         SL    SOMADD,ONE                                          0327 01358000
*                     SOMP = '0'B;                                 0328 01359000
*                     SOMHER = '1'B;                               0329 01360000
         OI    SOMHER(DACAD),B'00001000'                           0329 01361000
         NI    SOMP(DACAD),B'11011111'                             0329 01362000
*                  END;                                            0330 01363000
*                ELSE;                                             0331 01364000
@RF00325 DS    0H                                                  0332 01365000
*                 IF BLAT ='1'B                                    0332 01366000
*                      THEN DO;                                    0332 01367000
         TM    BLAT(DACAD),B'10000000'                             0332 01368000
         BNO   @RF00332                                            0332 01369000
*                        BLAT = '0'B;                              0334 01370000
         NI    BLAT(DACAD),B'01111111'                             0334 01371000
*                        IF LINGRO <= FULL0                        0335 01372000
*                             THEN GO TO WRTDONE;                  0335 01373000
         C     LINGRO,FULL0                                        0335 01374000
         BNH   @RT00335                                            0335 01375000
*                             ELSE GO TO WITCH2;                   0337 01376000
         B     WITCH2                                              0337 01377000
*                           END;                                   0338 01378000
*                      ELSE;                                       0339 01379000
@RF00332 DS    0H                                                  0340 01380000
*                 IF LINGRO <= FULL0                               0340 01381000
*                      THEN GO TO WRTDONE;                         0340 01382000
         C     LINGRO,FULL0                                        0340 01383000
         BNH   @RT00340                                            0340 01384000
*                      ELSE GO TO WITCH1;                          0342 01385000
         B     WITCH1                                              0342 01386000
*           GEN;                                                   0343 01387000
         EJECT                                                          01388000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0344 01389000
*/*     PRECEDING CODE -                                       */  0344 01390000
*/*WRTNEWL:      P SET CURSAD TO BEGINNING OF NEXT LINE        */  0344 01391000
*/*              D (NO,%NOTLAST,YES,) LAST POSITION IN 2260        0344 01392000
*/*                LINE ?                                      */  0344 01393000
*/*              P (,WITCH2) BUMP SOURCE, PUT FM IN SINK,          0344 01394000
*/*                BUMP SINK                                   */  0344 01395000
*/*%NOTLAST:     P PUT FIELD MARK IN SINK, BUMP SINK, PUT          0344 01396000
*/*                SBA IN SINK, BUMP SINK                      */  0344 01397000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0344 01398000
*/*              P (,WITCH2) BUMP SOURCE                       */  0344 01399000
*/*WRTSOM:       P PUT START FIELD, ATTRIBUTE IN SINK, BUMP        0344 01400000
*/*                SINK TWO                                    */  0344 01401000
*/*              P (,SETTLE) SET SOMP FLAG ON                  */  0344 01402000
*/*WRTEOM:       P (,SETTLE) PUT !, END MESSAGE IN SINK,           0344 01403000
*/*                BUMP SINK TWO                               */  0344 01404000
*/*WRTETX:       D (NO,%RMTDVNO,YES,WIT) IS RMTDV ON ?         */  0344 01405000
*/*%RMTDVNO:     P (,BACKGO) RESET SOURCE, SINK TO BEGINNING   */  0344 01406000
*/*WRTNLL:       P PUT BLANK IN SINK, BUMP SINK                */  0344 01407000
*/*SETTLE:       P BUMP SOURCE, INCREMENT CURSAD, SET LINGRO       0344 01408000
*/*                TO REMAINING PART                           */  0344 01409000
*/*              D (NO,%OUT,YES,) IS SOMP ON ?                 */  0344 01410000
*/*              P SET SOMADD TO BUFFER ADDRESS OF SF, SET         0344 01411000
*/*              SOMP OFF, SET SOMHER ON                       */  0344 01412000
*/*%OUT:         D (YES,WITCH2,NO,WITCH1) IS LINGRO = 0 ?      */  0344 01413000
*        GEN;                                                      0344 01414000
         EJECT                                                          01415000
*/**************************************************************/  0345 01416000
*/**************************************************************/  0345 01417000
*/*                                                            */  0345 01418000
*/*                                                            */  0345 01419000
*/* WIT TERMINATION OF SCAN PROCESSING FOR OUTPUT DATA.        */  0345 01420000
*/*    WIT IS ENTERED FROM WITCH1, NOCHAR (IN WITCH), AND      */  0345 01421000
*/*    WRETX (IN WRSPCHAR). WIT TESTS PROT AND IF YES, WIT     */  0345 01422000
*/*    ASCERTAINS THAT AN SOM (START FIELD, UNPROTECTED)       */  0345 01423000
*/*    IS ON THE SCREEN. WIT SETS AN INSERT CURSOR ORDER       */  0345 01424000
*/*    FOLLOWING THE LAST DATA. IF IT IS A REMOTE DATA         */  0345 01425000
*/*    STREAM, WIT PLACES AN ETX AT THE END. CONTROL IS        */  0345 01426000
*/*    PASSED TO OUTNORM.                                      */  0345 01427000
*/*                                                            */  0345 01428000
*/**************************************************************/  0345 01429000
*/**************************************************************/  0345 01430000
*WIT:       IF DACSINAD + DACSINLN <= SINKAD + 10                  0345 01431000
*                THEN GO TO OUTSINK;                               0345 01432000
WIT      LH    @12,DACSINLN(,DACAD)                                0345 01433000
         AL    @12,DACSINAD(,DACAD)                                0345 01434000
         LA    @10,10                                              0345 01435000
         ALR   @10,SINKAD                                          0345 01436000
         CR    @12,@10                                             0345 01437000
         BNH   @RT00345                                            0345 01438000
*                ELSE                                              0347 01439000
*                  DO;                                             0347 01440000
*                     IF SOMHER = '0'B /*IF NO SOM EXISTS      */  0348 01441000
*                     & PROT = '1'B   /*AND PROT = YES AND     */  0348 01442000
*                     & SHRD = '0'B   /*NOT SHORT READ ON      */  0348 01443000
*                     | SOMHER = '0'B /*IF NO SOM EXISTS       */  0348 01444000
*                     & RVOID = '1'B  /*AND RVOID = YES        */  0348 01445000
*                     & SHRD = '0'B   /*AND NOT SHORT READ ON  */  0348 01446000
*                          THEN                                    0348 01447000
         TM    SOMHER(DACAD),B'00001000'                           0348 01448000
         BNZ   @GL00005                                            0348 01449000
         TM    PROT(DACAD),B'01000000'                             0348 01450000
         BNO   @GL00005                                            0348 01451000
         TM    SHRD(DACAD),B'01000000'                             0348 01452000
         BZ    @RT00348                                            0348 01453000
@GL00005 TM    SOMHER(DACAD),B'00001000'                           0348 01454000
         BNZ   @RF00348                                            0348 01455000
         TM    RVOID(DACAD),B'10000000'                            0348 01456000
         BNO   @RF00348                                            0348 01457000
         TM    SHRD(DACAD),B'01000000'                             0348 01458000
         BNZ   @RF00348                                            0348 01459000
@RT00348 DS    0H                                                  0349 01460000
*                            DO;                                   0349 01461000
*                               SINK(1) = '1D'X; /*SF IN SINK  */  0350 01462000
         MVI   SINK(SINKAD),X'1D'                                  0350 01463000
*                               SINK(2) = 'C1'X; /*ATTR IN SINK*/  0351 01464000
         MVI   SINK+1(SINKAD),X'C1'                                0351 01465000
*                               SINKAD = SINKAD + 2;               0352 01466000
         AH    SINKAD,@CH00059                                     0352 01467000
*                               SOMHER = '1'B;                     0353 01468000
         OI    SOMHER(DACAD),B'00001000'                           0353 01469000
*                               SOMADD = CURSAD;                   0354 01470000
         LR    SOMADD,CURSAD                                       0354 01471000
*                               CURSAD = CURSAD + 1;               0355 01472000
         AH    CURSAD,@CH00061                                     0355 01473000
*                            END;                                  0356 01474000
*                          ELSE;                                   0357 01475000
@RF00348 DS    0H                                                  0358 01476000
*                     IF BLAT = '1'B                               0358 01477000
*                          THEN                                    0358 01478000
         TM    BLAT(DACAD),B'10000000'                             0358 01479000
         BNO   @RF00358                                            0358 01480000
*                             DO;                                  0359 01481000
*                                BLAT = '0'B;                      0360 01482000
         NI    BLAT(DACAD),B'01111111'                             0360 01483000
*                                IF CURLIN = DSLINE - 1            0361 01484000
*                                     THEN                         0361 01485000
         SLR   @12,@12                                             0361 01486000
         IC    @12,DSLINE(,DACAD)                                  0361 01487000
         BCTR  @12,0                                               0361 01488000
         CR    CURLIN,@12                                          0361 01489000
         BNE   @RF00361                                            0361 01490000
*                                      DO;                         0362 01491000
*                                         CURLIN = CURLIN - CURLIN;     01492000
         SLR   CURLIN,CURLIN                                       0363 01493000
*                                         CURSAD = CURSAD - CURSAD;     01494000
         SLR   CURSAD,CURSAD                                       0364 01495000
*                                         IF SOMHER = '1'B         0365 01496000
*                                         & SOMADD = FULL0         0365 01497000
*                                         | DACSOMAD = HAF0        0365 01498000
*                                           THEN CURSAD = CURSAD + 1;   01499000
         TM    SOMHER(DACAD),B'00001000'                           0365 01500000
         BNO   @GL00010                                            0365 01501000
         C     SOMADD,FULL0                                        0365 01502000
         BE    @RT00365                                            0365 01503000
@GL00010 CLC   DACSOMAD(2,DACAD),HAF0                              0365 01504000
         BNE   @RF00365                                            0365 01505000
@RT00365 DS    0H                                                  0366 01506000
         AH    CURSAD,@CH00061                                     0366 01507000
*                                           ELSE;                  0367 01508000
@RF00365 DS    0H                                                  0368 01509000
*                                         SINK(1) = '11'X;/*SBA*/  0368 01510000
         MVI   SINK(SINKAD),X'11'                                  0368 01511000
*                                         SINKAD = SINKAD + 1;     0369 01512000
         AH    SINKAD,@CH00061                                     0369 01513000
*                                           GEN;                   0370 01514000
         BAL   CARADD,OUTVERT                                           01515000
*                                      END;                        0371 01516000
*                                     ELSE                         0372 01517000
*                                      DO;                         0372 01518000
         B     @RC00361                                            0372 01519000
@RF00361 DS    0H                                                  0373 01520000
*                                         CURLIN = CURLIN + 1;     0373 01521000
         LA    @12,1                                               0373 01522000
         ALR   CURLIN,@12                                          0373 01523000
*                                         CURSAD = ANWIDE * CURLIN;     01524000
         LR    @15,CURLIN                                          0374 01525000
         SLR   CURSAD,CURSAD                                       0374 01526000
         IC    CURSAD,ANWIDE(,DACAD)                               0374 01527000
         MR    @14,CURSAD                                          0374 01528000
         LR    CURSAD,@15                                          0374 01529000
*                                         SINK(1) = '11'X;/*SBA*/  0375 01530000
         MVI   SINK(SINKAD),X'11'                                  0375 01531000
*                                         SINKAD = SINKAD + 1;     0376 01532000
         ALR   SINKAD,@12                                          0376 01533000
*                                         GEN;                     0377 01534000
         BAL   CARADD,OUTVERT                                           01535000
*                                      END;                        0378 01536000
*                             END;                                 0379 01537000
*                          ELSE;                                   0380 01538000
@RF00358 DS    0H                                                  0381 01539000
*                     SINK(1) = '13'X; /*INSERT CURSOR IN SINK */  0381 01540000
@RC00358 MVI   SINK(SINKAD),X'13'                                  0381 01541000
*                     SINKAD = SINKAD + ONE;                       0382 01542000
         AL    SINKAD,ONE                                          0382 01543000
*                     SPECAR = CURSAD;                             0383 01544000
         LR    SPECAR,CURSAD                                       0383 01545000
*              GEN SETS(DACCRS) REFS(DACAD,CURSAD) SEQFLOW ; /*Y02947*/ 01546000
         STH   CURSAD,DACCRS(DACAD)  STORE CURSOR POSITION        GENA  01547000
*                     IF DACANSCR = DACDSSCR                       0385 01548000
*                          THEN                                    0385 01549000
         CLC   DACANSCR(2,DACAD),DACDSSCR(DACAD)                   0385 01550000
         BNE   @RF00385                                            0385 01551000
*                            DO;                                   0386 01552000
*                     SINK(1) = '11'X; /*PUT SBA ORDER IN SINK */  0387 01553000
         MVI   SINK(SINKAD),X'11'                                  0387 01554000
*                     SINKAD = SINKAD + 1;                         0388 01555000
         AH    SINKAD,@CH00061                                     0388 01556000
*                               CURSAD = ANWIDE * ANLINE - 1;      0389 01557000
         SLR   @15,@15                                             0389 01558000
         IC    @15,ANLINE(,DACAD)                                  0389 01559000
         SLR   CURSAD,CURSAD                                       0389 01560000
         IC    CURSAD,ANWIDE(,DACAD)                               0389 01561000
         MR    @14,CURSAD                                          0389 01562000
         BCTR  @15,0                                               0389 01563000
         LR    CURSAD,@15                                          0389 01564000
*                               GEN;                               0390 01565000
         BAL   CARADD,OUTVERT                                           01566000
*                               GO TO SETPROT;                     0391 01567000
         B     SETPROT                                             0391 01568000
*                            END;                                  0392 01569000
*                          ELSE                                    0393 01570000
*                            DO;                                   0393 01571000
@RF00385 DS    0H                                                  0394 01572000
*                               IF ANWIDE = DSWIDE                 0394 01573000
*                                    THEN                          0394 01574000
         CLC   ANWIDE(1,DACAD),DSWIDE(DACAD)                       0394 01575000
         BNE   @RF00394                                            0394 01576000
*                                      DO;                         0395 01577000
*                                         SINK(1) = '11'X;/*SBA*/  0396 01578000
         MVI   SINK(SINKAD),X'11'                                  0396 01579000
*                                         SINKAD = SINKAD + 1;     0397 01580000
         AH    SINKAD,@CH00061                                     0397 01581000
*                                         CURSAD = ANWIDE *        0398 01582000
*                                         DSLINE;                  0398 01583000
         SLR   @15,@15                                             0398 01584000
         IC    @15,DSLINE(,DACAD)                                  0398 01585000
         SLR   CURSAD,CURSAD                                       0398 01586000
         IC    CURSAD,ANWIDE(,DACAD)                               0398 01587000
         MR    @14,CURSAD                                          0398 01588000
         LR    CURSAD,@15                                          0398 01589000
*                                         GEN;                     0399 01590000
         BAL   CARADD,OUTVERT                                           01591000
*                                         GO TO SETPROT;           0400 01592000
         B     SETPROT                                             0400 01593000
*                                      END;                        0401 01594000
*                                    ELSE;                         0402 01595000
@RF00394 DS    0H                                                  0403 01596000
*                               IF CURLIN = DSLINE                 0403 01597000
*                                    THEN CURLIN = CURLIN - 1;     0403 01598000
         SLR   @12,@12                                             0403 01599000
         IC    @12,DSLINE(,DACAD)                                  0403 01600000
         CR    CURLIN,@12                                          0403 01601000
         BNE   @RF00403                                            0403 01602000
         BCTR  CURLIN,0                                            0404 01603000
*                                    ELSE;                         0405 01604000
@RF00403 DS    0H                                                  0406 01605000
*/**************************************************************/  0406 01606000
*/*                                                            */  0406 01607000
*/* CLERLOOP   FROM      CLERLOOP                              */  0406 01608000
*/*      END OF DATA STREAM LINE CLEANUP LOOP POINT            */  0406 01609000
*/**************************************************************/  0406 01610000
*CLERLOOP:;                                                        0406 01611000
CLERLOOP DS    0H                                                  0407 01612000
*                               SINK(1) = '11'X; /*SBA IN SINK */  0407 01613000
         MVI   SINK(SINKAD),X'11'                                  0407 01614000
*                               SINKAD = SINKAD + 1;               0408 01615000
         AH    SINKAD,@CH00061                                     0408 01616000
*                               CURSAD = CURLIN * ANWIDE + DSWIDE; 0409 01617000
         SLR   @15,@15                                             0409 01618000
         IC    @15,ANWIDE(,DACAD)                                  0409 01619000
         MR    @14,CURLIN                                          0409 01620000
         SLR   CURSAD,CURSAD                                       0409 01621000
         IC    CURSAD,DSWIDE(,DACAD)                               0409 01622000
         ALR   @15,CURSAD                                          0409 01623000
         LR    CURSAD,@15                                          0409 01624000
*                               GEN;                               0410 01625000
         BAL   CARADD,OUTVERT                                           01626000
*                               CURLIN = CURLIN + 1;               0411 01627000
         LA    @12,1                                               0411 01628000
         ALR   CURLIN,@12                                          0411 01629000
*                               IF CURLIN = DSLINE                 0412 01630000
*                                    THEN GO TO SETPROT;           0412 01631000
         SLR   @10,@10                                             0412 01632000
         IC    @10,DSLINE(,DACAD)                                  0412 01633000
         CR    CURLIN,@10                                          0412 01634000
         BE    @RT00412                                            0412 01635000
*                                    ELSE                          0414 01636000
*                                      DO;                         0414 01637000
*                                         SINK(1) = '3C'X;/*RTA*/  0415 01638000
         MVI   SINK(SINKAD),X'3C'                                  0415 01639000
*                                         SINKAD = SINKAD + 1;     0416 01640000
         ALR   SINKAD,@12                                          0416 01641000
*                                         CURSAD = CURLIN * ANWIDE;     01642000
         SLR   @15,@15                                             0417 01643000
         IC    @15,ANWIDE(,DACAD)                                  0417 01644000
         MR    @14,CURLIN                                          0417 01645000
         LR    CURSAD,@15                                          0417 01646000
*                                         GEN;                     0418 01647000
         BAL   CARADD,OUTVERT                                           01648000
*                                         SINK(1) = '00'X;         0419 01649000
         MVI   SINK(SINKAD),X'00'                                  0419 01650000
*                                         SINKAD = SINKAD + 1;     0420 01651000
         AH    SINKAD,@CH00061                                     0420 01652000
*                                         GO TO CLERLOOP;          0421 01653000
         B     CLERLOOP                                            0421 01654000
*                                      END;                        0422 01655000
*                            END;                                  0423 01656000
*/**************************************************************/  0424 01657000
*/*                                                            */  0424 01658000
*/* SETPROT    FROM      WIT, CLERLOOP                         */  0424 01659000
*/*      ESTABLISH PROTECTED FIELD IF PROT = YES               */  0424 01660000
*/**************************************************************/  0424 01661000
*SETPROT:;                                                         0424 01662000
SETPROT  DS    0H                                                  0425 01663000
*                     IF PROT = '1'B                               0425 01664000
*                          THEN                                    0425 01665000
         TM    PROT(DACAD),B'01000000'                             0425 01666000
         BNO   @RF00425                                            0425 01667000
*                            DO;                                   0426 01668000
*                               SINK(1) = '1D'X; /*SF IN SINK  */  0427 01669000
         MVI   SINK(SINKAD),X'1D'                                  0427 01670000
*                               SINK(2) = '60'X; /*PROT ATTR IN*/  0428 01671000
         MVI   SINK+1(SINKAD),X'60'                                0428 01672000
*                               SINKAD = SINKAD + 2;               0429 01673000
         AH    SINKAD,@CH00059                                     0429 01674000
*                               CURSAD = SPECAR;                   0430 01675000
         LR    CURSAD,SPECAR                                       0430 01676000
*                            END;                                  0431 01677000
*                          ELSE CURSAD = SPECAR;                   0432 01678000
         B     @RC00425                                            0432 01679000
@RF00425 LR    CURSAD,SPECAR                                       0432 01680000
*                     IF DACDSSCR ^= DACANSCR                      0433 01681000
*                          THEN                                    0433 01682000
@RC00425 CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                   0433 01683000
         BE    @RF00433                                            0433 01684000
*                            DO;                                   0434 01685000
*           GEN SETS(REG0,SPECAR) FLOWS(RTABUILD) SEQFLOW ; /*Y02947*/  01686000
         SR    REG0,REG0                     CLEAR A WORK REGISTER      01687000
*                                      LEAVE A NULL IN REG 0            01688000
         BAL   SPECAR,RTABUILD                                          01689000
*                            END;                                  0436 01690000
*                          ELSE;                                   0437 01691000
@RF00433 DS    0H                                                  0438 01692000
*                     IF RMTDV = '0'B                              0438 01693000
*                          THEN GO TO OUTNORM;                     0438 01694000
         TM    RMTDV(DACAD),B'00000001'                            0438 01695000
         BZ    @RT00438                                            0438 01696000
*                          ELSE                                    0440 01697000
*                            DO;                                   0440 01698000
*                     SINK(1) = '03'X; /*PUT AN ETX IN THE SINK*/  0441 01699000
         MVI   SINK(SINKAD),X'03'                                  0441 01700000
*                     SINKAD = SINKAD + 1;                         0442 01701000
         AH    SINKAD,@CH00061                                     0442 01702000
*                               GO TO OUTNORM;                     0443 01703000
         B     OUTNORM                                             0443 01704000
*                            END;                                  0444 01705000
*                  END;                                            0445 01706000
*           GEN;                                                   0446 01707000
         EJECT                                                          01708000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0447 01709000
*/*     PRECEDING CODE -                                       */  0447 01710000
*/*WIT:          D (NO,%NUF,YES,OUTSINK) WILL EXCEDE SINK ?    */  0447 01711000
*/*%NUF:         D (NO,%SOMOK,YES,) IS PROT OR RVOID ON & SOMHER   0447 01712000
*/*                OFF & SHRD OFF ?                            */  0447 01713000
*/*              P PUT SET FIELD, ATTRIBUTE IN SINK, BUMP          0447 01714000
*/*                SINK, SET SOMHER ON                         */  0447 01715000
*/*              P SAVE ADDRESS OF SF IN SOMADD, INCREMENT         0447 01716000
*/*                CURSAD                                      */  0447 01717000
*/*%SOMOK:       D (NO,%NOBLAT,YES,) IS BLAT ON ?              */  0447 01718000
*/*              P TURN BLAT OFF                               */  0447 01719000
*/*              D (YES,,NO,%MIDDLE) AT END OF 2260 ?          */  0447 01720000
*/*              P SET CURLIN TO 0, CURSAD TO 0                */  0447 01721000
*/*              D (YES,,NO,%NOSOM0) SOM IN POSITION 0 ?       */  0447 01722000
*/*              P INCREMENT CURSAD ONE POSITION               */  0447 01723000
*/*%NOSOM0:      P PUT SBA ORDER IN SINK, BUMP SINK            */  0447 01724000
*/*              S (,%NOBLAT) OUTVERT:CONVERT HEXIDECIMAL TO       0447 01725000
*/*                3270 BUFFER                                 */  0447 01726000
*/*%MIDDLE:      P INCREMENT CURLIN, SET CURSAD TO NEXT LINE   */  0447 01727000
*/*              P PUT SBA ORDER IN SINK, BUMP SINK            */  0447 01728000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0447 01729000
*/*%NOBLAT:      P PUT INSERT CURSOR IN SINK, BUMP SINK        */  0447 01730000
*/*              D (NO,%EQSCRN,YES,) 3270 SIZE = 2260 SIZE         0447 01731000
*/*                ?                                           */  0447 01732000
*/*              P PUT SBA IN SINK, BUMP SINK, SET CURSAD TO       0447 01733000
*/*                LAST 2260 POSITION                          */  0447 01734000
*/*              S (,SETPROT) OUTVERT:CONVERT HEXIDECIMAL TO       0447 01735000
*/*                3270 BUFFER                                 */  0447 01736000
*/*%EQSCRN:      D (NO,%EQWIDE,YES,) ANWIDE = DSWIDE ?         */  0447 01737000
*/*              P PUT SBA IN SINK, BUMP SINK                  */  0447 01738000
*/*              P SET CURSAD ONE PAST 2260 PORTION            */  0447 01739000
*/*              S (,SETPROT) OUTVERT:CONVERT HEXIDECIMAL TO       0447 01740000
*/*                3270 BUFFER                                 */  0447 01741000
*/*%EQWIDE:      D (YES,,NO,CLERLOOP) CURLIN = MAXIMUM 2260        0447 01742000
*/*                LINE ?                                      */  0447 01743000
*/*              P DECREMENT CURLIN ONE                        */  0447 01744000
*/*CLERLOOP:     P PUT SBA IN SINK, BUMP SINK, CURSAD = END        0447 01745000
*/*                OF CURRENT 2260 LINE                        */  0447 01746000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0447 01747000
*/*              P BUMP CURLIN                                 */  0447 01748000
*/*              D (YES,SETPROT,NO,) CURLIN = MAXIMUM 2260         0447 01749000
*/*                LINE ?                                      */  0447 01750000
*/*              P SET RTA IN SINK, BUMP SINK, CURSAD TO           0447 01751000
*/*                BEGINNING OF NEXT LINE                      */  0447 01752000
*/*              S OUTVERT:CONVERT HEXIDECIMAL TO 3270 BUFFER  */  0447 01753000
*/*              P (,CLERLOOP) PUT NULL IN SINK                */  0447 01754000
*/*SETPROT:      D (NO,%NOPROT,YES,) PROT = YES SPECIFIED          0447 01755000
*/*                ?                                           */  0447 01756000
*/*              P PUT SF, PROTECTED ATTRIBUTE IN SINK, BUMP       0447 01757000
*/*                SINK TWO                                    */  0447 01758000
*/*              P (,%SOPROT) RESTORE CURSAD                   */  0447 01759000
*/*%NOPROT:      P RESTORE CURSAD                              */  0447 01760000
*/*%SOPROT:      D (NO,%NOTEQU,YES,) 3270 SIZE = 2260 SIZE ?   */  0447 01761000
*/*              P SET CHARACTER TO NULL, RETURN TO NEXT           0447 01762000
*/*                SEQUENTIAL INSTRUCTION                      */  0447 01763000
*/*              S RTABUILD:BUILD RTA(S) TO POSITION ZERO      */  0447 01764000
*/*%NOTEQU:      D (NO,%REMOT,YES,OUTNORM) IS RMTDV OFF ?      */  0447 01765000
*/*%REMOT:       D (NO,OUTSINK,YES,%ETX) ONE BYTE LEFT IN SINK?*/  0447 01766000
*/*%ETX:         P (,OUTNORM) PUT ETX IN SINK, BUMP SINK       */  0447 01767000
*        GEN;                                                      0447 01768000
         EJECT                                                          01769000
*/**************************************************************/  0448 01770000
*/**************************************************************/  0448 01771000
*/* READ INITIAL ENTRY FROM HOUSEKEEPING FOR INPUT DATA        */  0448 01772000
*/*     STREAMS. ENTRY READ1 IS USED WHEN PROCESSING READ      */  0448 01773000
*/*     BUFFER, AS THE PROCESSING LOOP ENTRY. READ1 IS         */  0448 01774000
*/*     ENTERED FROM RDLAT (MORTST), AND KERF (INCREM).        */  0448 01775000
*/*      READ TESTS FOR AN SOH AND IF PRESENT PASSES           */  0448 01776000
*/*     CONTROL TO OUTERR. IF THE DEVICE IS REMOTE, THE        */  0448 01777000
*/*     CONTENT OF DACDSAD REPLACES THE 3270 DEVICE ADDRESS.   */  0448 01778000
*/*     THE AID IS TESTED FOR PA1,2,3 OR THE CLEAR KEY         */  0448 01779000
*/*     BEING DEPRESSED. IF SO, THE AID IS PLACED IN THE       */  0448 01780000
*/*     SINK, AN END FRAMING CHARACTER IS INSERTED IF          */  0448 01781000
*/*     NEEDED, AND CONTROL IS PASSED TO OUTSPEC. FOR A        */  0448 01782000
*/*     READ BUFFER OPERATION, PROCESSING IS INITIATED         */  0448 01783000
*/*     IN READ1 ON A LINE AT A TIME BASIS, CONTROL IS         */  0448 01784000
*/*     PASSED TO RDLAT. READ1 TESTS ON SUBSEQUENT             */  0448 01785000
*/*     ENTRIES FOR THE CURRENT PROCESSING LINE BEING EQUAL    */  0448 01786000
*/*     TO THE LAST 2260 LINE AND IF SO, BRANCHES TO           */  0448 01787000
*/*     READOUT IN SOURTST. FOR READ TYPES OTHER THAN          */  0448 01788000
*/*     READ BUFFER, THE CURSOR POSITION IS RELATED TO A       */  0448 01789000
*/*     TRUE CORE ADDRESS. IF AN SBA SEQUENCE IS PRESENT       */  0448 01790000
*/*     THE FIELD POSITION IS RELATED TO A TRUE CORE           */  0448 01791000
*/*     ADDRESS. IF NO SBA SEQUENCE IS PRESENT, THE DATA       */  0448 01792000
*/*     STREAM IS SEARCHED FOR AN X'4A' () AND IF FOUND,      */  0448 01793000
*/*     ITS POSITION BECOMES THE FIELD POSITION. IF THE        */  0448 01794000
*/*     SBA SEQUENCE IS PRESENT, SOURTST RECEIVES CONTROL.     */  0448 01795000
*/*     IF THE SBA IS NOT PRESENT, CKSMI IN SOURTST RECEIVES   */  0448 01796000
*/*     CONTROL.                                               */  0448 01797000
*/*                                                            */  0448 01798000
*/**************************************************************/  0448 01799000
*/**************************************************************/  0448 01800000
*READ:;                                                            0448 01801000
READ     DS    0H                                                  0449 01802000
*           IF SOURCE(1) = '01'X       /*IF THIS IS ERROR MSG  */  0449 01803000
*                THEN GO TO OUTERR;                                0449 01804000
         CLI   SOURCE(SOURAD),X'01'                                0449 01805000
         BE    @RT00449                                            0449 01806000
*                ELSE;                                             0451 01807000
*           IF RMTDV = '1'B                                        0452 01808000
*                THEN                                              0452 01809000
         TM    RMTDV(DACAD),B'00000001'                            0452 01810000
         BNO   @RF00452                                            0452 01811000
*                  DO;                                             0453 01812000
*                     SINK(1) = DACDSAD;                           0454 01813000
         MVC   SINK(1,SINKAD),DACDSAD(DACAD)                       0454 01814000
*                     SINKAD = SINKAD + 1; /*INCREMENT         */  0455 01815000
         AH    SINKAD,@CH00061                                     0455 01816000
*                     SOURAD = SOURAD + 2; /*INCREMENT 2       */  0456 01817000
         AH    SOURAD,@CH00059                                     0456 01818000
*                  END;                                            0457 01819000
*                ELSE;                                             0458 01820000
@RF00452 DS    0H                                                  0459 01821000
*           IF SOURCE(1) = '6C'X | SOURCE(1) = '6E'X | SOURCE(1) = 0459 01822000
*              '6B'X | SOURCE(1) = '6D'X | SOURCE(1) = '60'X       0459 01823000
*                THEN                                              0459 01824000
         CLI   SOURCE(SOURAD),X'6C'                                0459 01825000
         BE    @RT00459                                            0459 01826000
         CLI   SOURCE(SOURAD),X'6E'                                0459 01827000
         BE    @RT00459                                            0459 01828000
         CLI   SOURCE(SOURAD),X'6B'                                0459 01829000
         BE    @RT00459                                            0459 01830000
         CLI   SOURCE(SOURAD),X'6D'                                0459 01831000
         BE    @RT00459                                            0459 01832000
         CLI   SOURCE(SOURAD),X'60'                                0459 01833000
         BNE   @RF00459                                            0459 01834000
@RT00459 DS    0H                                                  0460 01835000
*                  DO;                                             0460 01836000
*                     SINK(1) = SOURCE(1);                         0461 01837000
         MVC   SINK(1,SINKAD),SOURCE(SOURAD)                       0461 01838000
*                     IF RMTDV = '1'B                              0462 01839000
*                          THEN                                    0462 01840000
         TM    RMTDV(DACAD),B'00000001'                            0462 01841000
         BNO   @RF00462                                            0462 01842000
*                            DO;                                   0463 01843000
*                               SINK(2) = SOURCE(4);               0464 01844000
         MVC   SINK+1(1,SINKAD),SOURCE+3(SOURAD)                   0464 01845000
*                     SINKAD = SINKAD + 2;                         0465 01846000
         AH    SINKAD,@CH00059                                     0465 01847000
*                            END;                                  0466 01848000
*                          ELSE SINKAD = SINKAD + ONE;             0467 01849000
         B     @RC00462                                            0467 01850000
@RF00462 AL    SINKAD,ONE                                          0467 01851000
*                     GO TO OUTSPEC;                               0468 01852000
         B     OUTSPEC                                             0468 01853000
*                  END;                                            0469 01854000
*                ELSE;                                             0470 01855000
@RF00459 DS    0H                                                  0471 01856000
*           IF RDBUF = '1'B                                        0471 01857000
*                THEN                                              0471 01858000
         TM    RDBUF(DACAD),B'00000001'                            0471 01859000
         BNO   @RF00471                                            0471 01860000
*                  DO;                                             0472 01861000
*                     IF SOURCE(4) = '11'X                         0473 01862000
*                          THEN SOURAD = SOURAD + 6;               0473 01863000
         CLI   SOURCE+3(SOURAD),X'11'                              0473 01864000
         BNE   @RF00473                                            0473 01865000
         AH    SOURAD,@CH00283                                     0474 01866000
*                          ELSE SOURAD = SOURAD + 3;               0475 01867000
         B     @RC00473                                            0475 01868000
@RF00473 AH    SOURAD,@CH00102                                     0475 01869000
*                     SHRD = '0'B;                                 0476 01870000
@RC00473 NI    SHRD(DACAD),B'10111111'                             0476 01871000
*                     CURLIN = CURLIN - CURLIN;                    0477 01872000
         SLR   CURLIN,CURLIN                                       0477 01873000
*/**************************************************************/  0478 01874000
*/*                                                            */  0478 01875000
*/* READ1      FROM      MORTST, INCREM                        */  0478 01876000
*/*      READ BUFFER SETUP FOR PASS THROUGH RDLAT              */  0478 01877000
*/**************************************************************/  0478 01878000
*READ1:;                              /*READ BUFFER            */  0478 01879000
READ1    DS    0H                                                  0479 01880000
*                     LINGRO = DSWIDE; /*GET 2260 WIDTH        */  0479 01881000
         SLR   LINGRO,LINGRO                                       0479 01882000
         IC    LINGRO,DSWIDE(,DACAD)                               0479 01883000
*                     SPECAR = DSLINE; /*GET 2260 LINE CNT     */  0480 01884000
         SLR   SPECAR,SPECAR                                       0480 01885000
         IC    SPECAR,DSLINE(,DACAD)                               0480 01886000
*                     IF CURLIN = SPECAR                           0481 01887000
*                          THEN GO TO READOUT;                     0481 01888000
         CR    CURLIN,SPECAR                                       0481 01889000
         BE    @RT00481                                            0481 01890000
*                          ELSE GO TO RDLAT;                       0483 01891000
         B     RDLAT                                               0483 01892000
*                  END;                                            0484 01893000
*                ELSE                                              0485 01894000
*                  DO;                                             0485 01895000
@RF00471 DS    0H                                                  0486 01896000
*                     SOURAD = SOURAD + ONE;                       0486 01897000
         AL    SOURAD,ONE                                          0486 01898000
*                     GEN SETS(CURSAD,CARADD,SOURAD) FLOWS(INVERT) 0487 01899000
*                       SEQFLOW ;  /*Y02947*/                      0487 01900000
         SR    CURSAD,CURSAD            CLEAR REGISTER                  01901000
         IC    CURSAD,0(SOURAD)                                         01902000
         SLL   CURSAD,8                                                 01903000
         IC    CURSAD,1(SOURAD)                                         01904000
         BAL   CARADD,INVERT            GO CONVERT ADDRESS              01905000
         LA    CARADD,0(CARADD)                                         01906000
         LA    SOURAD,2(SOURAD)         INCREMENT SOURCE                01907000
*           GEN REFS (CURSAD,DACAD,ANWIDE,DSLINE,DSWIDE)           0488 01908000
*               SETS(DACCRS,WORKREG4,WORKREG3,REG0)                0488 01909000
*                 FLOWS(OUTCURS) SEQFLOW;                    /*Y02947*/ 01910000
         SR    WORKREG4,WORKREG4           CLEAR A WORK REGISTER        01911000
         LR    WORKREG3,CURSAD           PICK UP CURSOR POSITION        01912000
         SR    REG0,REG0              CLEAR A WORK REGISTER             01913000
         IC    REG0,ANWIDE(DACAD)         PICK UP 3270 WIDTH            01914000
         DR    WORKREG4,REG0            GET ROW COLUMN OF CURSOR        01915000
         IC    REG0,DSLINE(DACAD)         PICK UP MAX 2260 LINE         01916000
         CR    WORKREG3,REG0          IS CURSOR BEYOND MAX 2260 LINE    01917000
         BNL   OUTCURS             YES, RETURN WITH CODE X'10'          01918000
         IC    REG0,DSWIDE(DACAD)         PICK UP MAX 2260 COLUMN       01919000
         CR    WORKREG4,REG0            IS CURSOR BEYOND MAX COLUMN     01920000
         BNL   OUTCURS             YES, RETURN WITH CODE X'10'          01921000
         STH   CURSAD,DACCRS(DACAD)                                     01922000
*RDSBATST:;                                                        0489 01923000
RDSBATST DS    0H                                                  0490 01924000
*           SOMADD = CURSAD;                                       0490 01925000
         LR    SOMADD,CURSAD                                       0490 01926000
*           IF SOURCE(1) = '11'X                                   0491 01927000
*                          THEN                                    0491 01928000
         CLI   SOURCE(SOURAD),X'11'                                0491 01929000
         BNE   @RF00491                                            0491 01930000
*                            DO;                                   0492 01931000
*           GEN SETS(SPECAR,DACIND) REFS(DACAD,HAF3)               0493 01932000
*                       SEQFLOW ; /*Y02947*/                       0493 01933000
         SR    SPECAR,SPECAR                                            01934000
         IC    SPECAR,DACIND(DACAD)                                     01935000
         AH    SPECAR,HAF3                                              01936000
         STC   SPECAR,DACIND(DACAD)                                     01937000
*                               SOMHER = '1'B;                     0494 01938000
         OI    SOMHER(DACAD),B'00001000'                           0494 01939000
*          GEN SETS(CURSAD,SOURAD,CARADD,REG0,WORKREG4,WORKREG3)   0495 01940000
*                REFS(ANWIDE,DACAD,DSLINE,DSWIDE)                  0495 01941000
*                      FLOWS(INVERT,RDOPTST)  SEQFLOW ; /*Y02947*/ 0495 01942000
         SR    CURSAD,CURSAD                                            01943000
         IC    CURSAD,1(SOURAD)                                         01944000
         SLL   CURSAD,8                                                 01945000
         IC    CURSAD,2(SOURAD)                                         01946000
         LA    SOURAD,3(SOURAD)                                         01947000
         BAL   CARADD,INVERT                                            01948000
         SR    REG0,REG0           CLEAR A WORK REGISTER        CODE2   01949000
         SR    WORKREG4,WORKREG4    CLEAR EVEN OF EVEN/ODD PAIR  CODE2  01950000
         SR    WORKREG3,WORKREG3   CLEAR ODD OF EVEN/ODD PAIR    CODE2  01951000
         IC    REG0,ANWIDE(DACAD)   PICK UP 3270 WIDTH           CODE2  01952000
         IC    WORKREG3,DSLINE(DACAD)  PICK UP 2260 LINE COUNT   CODE2  01953000
         MR    WORKREG4,REG0        COMPUTE END OF 2260 PLUS     CODE2  01954000
*                                  THE DIFFERENCE 3270-2260      CODE2  01955000
         SR    WORKREG4,WORKREG4   CLEAR A WORK REGISTER         CODE2  01956000
         IC    WORKREG4,DSWIDE(DACAD)  PICK UP THE 2260 WIDTH    CODE2  01957000
         SR    REG0,WORKREG4        GET SCREEN WIDTH DIFFERENCE  CODE2  01958000
         SR    WORKREG3,REG0       GET END OF 2260 SCREEN + 1    CODE2  01959000
*                                  IN 3270 BUFFER UNITS         CODE2   01960000
         CR    CURSAD,WORKREG3     SOM POINT 1 PAST END OF 2260 CODE2   01961000
         BNE   RDOPTST             NO, GO AHEAD AND USE IT      CODE2   01962000
         SR    CURSAD,CURSAD       YES, POINT IT TO FIRST       CODE2   01963000
*                                  POSITION OF SCREEN           CODE2   01964000
*RDOPTST:                       SPECAR = CURSAD;                   0496 01965000
RDOPTST  LR    SPECAR,CURSAD                                       0496 01966000
*                               CURSAD = SOMADD;                   0497 01967000
         LR    CURSAD,SOMADD                                       0497 01968000
*           CARADD = SPECAR // DSWIDE;                             0498 01969000
         SLR   @12,@12                                             0498 01970000
         IC    @12,DSWIDE(,DACAD)                                  0498 01971000
         LR    @00,SPECAR                                          0498 01972000
         SRDA  @00,32                                              0498 01973000
         DR    @00,@12                                             0498 01974000
         LR    CARADD,@00                                          0498 01975000
*           IF CARADD ^= FULL0                                     0499 01976000
*                THEN                                              0499 01977000
         C     CARADD,FULL0                                        0499 01978000
         BE    @RF00499                                            0499 01979000
*                  DO;                                             0500 01980000
*           CARADD = DSWIDE - CARADD;                              0501 01981000
         SLR   @12,CARADD                                          0501 01982000
         LR    CARADD,@12                                          0501 01983000
*           GEN SETS(LINGRO,DACIND) REFS(DACAD,CARADD)             0502 01984000
*                  SEQFLOW ;   /*Y02947*/                          0502 01985000
         SR    LINGRO,LINGRO                                            01986000
         IC    LINGRO,DACIND(DACAD)                                     01987000
         AR    LINGRO,CARADD                                            01988000
         STC   LINGRO,DACIND(DACAD)                                     01989000
*                  END;                                            0503 01990000
*                ELSE;                                             0504 01991000
@RF00499 DS    0H                                                  0505 01992000
*                            END;                                  0505 01993000
*                          ELSE;                                   0506 01994000
@RF00491 DS    0H                                                  0507 01995000
*                     IF RDMI = '1'B                               0507 01996000
*                          THEN SHRD = '0'B;                       0507 01997000
         TM    RDMI(DACAD),B'00000100'                             0507 01998000
         BNO   @RF00507                                            0507 01999000
         NI    SHRD(DACAD),B'10111111'                             0508 02000000
*                          ELSE SHRD = '1'B;                       0509 02001000
         B     @RC00507                                            0509 02002000
@RF00507 OI    SHRD(DACAD),B'01000000'                             0509 02003000
*                  END;                                            0510 02004000
@RC00507 DS    0H                                                  0511 02005000
*           IF SOMHER = '1'B                                       0511 02006000
*                THEN                                              0511 02007000
         TM    SOMHER(DACAD),B'00001000'                           0511 02008000
         BNO   @RF00511                                            0511 02009000
*                  DO;                                             0512 02010000
*                     LINGRO = LINGRO - LINGRO;                    0513 02011000
         SLR   LINGRO,LINGRO                                       0513 02012000
*           GEN;                                                   0514 02013000
         EJECT                                                          02014000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0515 02015000
*/*     PRECEDING CODE -                                       */  0515 02016000
*/*READ:         D (YES,OUTERR,NO,%REMTST) IS SOH FIRST ?      */  0515 02017000
*/*%REMTST:      D (YES,,NO,%GO002) RMTDV ON ?                 */  0515 02018000
*/*              D (YES,OUTSINK,NO,%GO001) SINK EXPENDED ?     */  0515 02019000
*/*%GO001:       P (,%AIDTST) PUT 2260 DEVICE ADDRESS IN SINK      0515 02020000
*/*                AND BUMP SOURCE BY TWO, SINK BY ONE         */  0515 02021000
*/*%GO002:       D (YES,OUTSINK,NO,%AIDTST) SINK EXPENDED ?    */  0515 02022000
*/*%AIDTST:      D (YES,,NO,%RDBUF) AID FROM PA1,2,3 OR CLEAR ?*/  0515 02023000
*/*              P PUT AID IN SINK                             */  0515 02024000
*/*              D (YES,,NO,%GO003) RMTDV ON ?                 */  0515 02025000
*/*              P (,OUTSPEC) PUT END FRAMING IN SINK, BUMP        0515 02026000
*/*                SINK BY TWO                                 */  0515 02027000
*/*%GO003:       P (,OUTSPEC) BUMP SINK BY ONE                 */  0515 02028000
*/*%RDBUF:       D (YES,,NO,%GO006) READ BUFFER OPERATION ?    */  0515 02029000
*/*              D (YES,,NO,%NOSBA) SBA NEXT IN SOURCE ?       */  0515 02030000
*/*              P (,%GO004) BUMP SOURCE BY SIX                */  0515 02031000
*/*%NOSBA:       P BUMP SOURCE BY THREE                        */  0515 02032000
*/*%GO004:       P SET SHRD OFF, SET CURLIN TO ZERO            */  0515 02033000
*/*READ1:        D (YES,READOUT,NO,RDLAT) ALL 2260 LINES DONE ?*/  0515 02034000
*/*%GO006:       P INCREMENT SOURCE, GET CURSOR ADDRESS IN         0515 02035000
*/*                CURSAD                                      */  0515 02036000
*/*              S INVERT:CONVERT 3270 BUFFER TO HEXADECIMAL   */  0515 02037000
*/*              D (YES,RDSBATST,NO,OUTCURS) CURSOR ON 2260 ?  */  0515 02038000
*/*RDSBATST:     P SAVE CURSAD TEMPORARILY IN SOMAOD           */  0515 02039000
*/*              D (YES,,NO,%GO007) SBA NEXT IN SOURCE ?       */  0515 02040000
*/*              P BUMP DACIND BY THREE, SET SOMHER ON, GET        0515 02041000
*/*                FIRST DATA ADDRESS                          */  0515 02042000
*/*              S INVERT:CONVERT 3270 BUFFER TO HEXIDECIMAL   */  0515 02043000
*/*RDOPTST:      P SAVE SOM ADDRESS IN SPECAR, RESTORE CURSAD  */  0515 02044000
*/*              P CALCULATE OFFSET TO FIRST INTEGRAL LINE         0515 02045000
*/*                BOUNDRY, BUMP DACIND BY OFSET               */  0515 02046000
*/*%GO007:       D (YES,,NO,%GO008) READ MI OPERATION ?        */  0515 02047000
*/*              P  (,%GO009) SET SHRD OFF                     */  0515 02048000
*/*%GO008:       P  SET SHRD ON                                */  0515 02049000
*/*%GO009:       D (YES,%GO009A,NO,CKSMI) IS SOMHER ON ?       */  0515 02050000
*/*%GO009A:      P (,SOURTST) SET LINGRO TO ZERO               */  0515 02051000
*        GEN;                                                      0515 02052000
         EJECT                                                          02053000
*/**************************************************************/  0516 02054000
*/**************************************************************/  0516 02055000
*/*                                                            */  0516 02056000
*/* SOURTST ENTERED FROM READ FOR THE PURPOSE OF ESTABLISHING  */  0516 02057000
*/*     THE BOUNDRIES OF DATA CONVERSION. SOURTST IS ALSO      */  0516 02058000
*/*     ENTERED FROM CKSMI (IN SOURTST) AFTER LOCATING AN      */  0516 02059000
*/*     SMI () IN THE DATA STREAM. SOURTST INCREMENTS         */  0516 02060000
*/*     DACIND TO POINT TO THE FIRST LINE BOUNDRY IN THE       */  0516 02061000
*/*     DATA STREAM, PLACES THE LENGTH TO BE PROCESSED         */  0516 02062000
*/*     IN LINGRO (SCREEN WRAP IS CONSIDERED), AND BRANCHES    */  0516 02063000
*/*     TO RDLAT.                                              */  0516 02064000
*/*                                                            */  0516 02065000
*/*         CKSMI IS ENTERED FROM READ IF NO SBA SEQUENCE      */  0516 02066000
*/*     EXISTS IN THE DATA STREAM. ITS PURPOSE IS TO           */  0516 02067000
*/*     LOCATE AN X'4A' () IN THE DATA STREAM. IF THE SMI     */  0516 02068000
*/*     IS LOCATED CONTROL IS PASSED TO SOURTST. IF NO         */  0516 02069000
*/*     SMI CAN BE FOUND, THE NO SMI PRESENT BIT IS SET ON     */  0516 02070000
*/*     IN DACFLG AND CONTROL IS PASSED TO OUTNORM (IN         */  0516 02071000
*/*     OUTPROC). THIS IS ACCOMPLISHED BY READOUT.             */  0516 02072000
*/*                                                            */  0516 02073000
*/*         READOUT IS THE ROUTE TAKEN BY THE READ             */  0516 02074000
*/*     PROCESSING ROUTINES FOR NORMAL EXIT. READOUT           */  0516 02075000
*/*     INSERTS AN ETX IF NEEDED, AND BRANCHES TO OUTNORM      */  0516 02076000
*/*     (IN OUTPROC).                                          */  0516 02077000
*/*                                                            */  0516 02078000
*/**************************************************************/  0516 02079000
*/**************************************************************/  0516 02080000
*SOURTST:;                                                         0516 02081000
SOURTST  DS    0H                                                  0517 02082000
*                     SOMADD = SPECAR;  /*SAVE SOM ADDRESS     */  0517 02083000
         LR    SOMADD,SPECAR                                       0517 02084000
*                GEN SETS(WORKREG4,WORKREG3,REG0,SPECAR,DACSINAD,BLAT,  02085000
*                            CARADD,CURSAD,DACFLG,LINGRO,SOMADD,LNGDT)  02086000
*                    REFS(DACAD,DACOPTYP,PROT,DACDSSCR,            0518 02087000
*                            DACANSCR,SOMHER)                      0518 02088000
*                    FLOWS(SOURTST,READOUT) SEQFLOW  ;    /*Y02947*/    02089000
         SR    WORKREG4,WORKREG4    CLEAR EVEN                  CODE2   02090000
         CR    CURSAD,SOMADD       SOM RELATIVE TO CURSOR ?     CODE2   02091000
         BL    WRAP                WE HAVE SCREEN WRAPAROUND    CODE2   02092000
         BE    READOUT             WE HAVE NO DATA              CODE2   02093000
         LR    WORKREG3,CURSAD     GET CURSOR POINTER           CODE2   02094000
         SR    REG0,REG0           CLEAR A WORK REGISTER        CODE2   02095000
         IC    REG0,ANWIDE(DACAD)  PICK UP 3270 WIDTH           CODE2   02096000
         DR    WORKREG4,REG0        LINE HOLDING CURSOR - 1     CODE2   02097000
         LR    SPECAR,WORKREG3     SAVE CURSORS LINE            CODE2   02098000
         SR    WORKREG4,WORKREG4       CAN THE REMAINDER        CODE2   02099000
         LR    WORKREG3,SOMADD     PICK UP THE SOM POINTER      CODE2   02100000
         DR    WORKREG4,REG0         LINE HOLDING SOM - 1       CODE2   02101000
         LR    CURLIN,WORKREG3    SAVE SOMS LINE                YA01252 02102000
         SR    SPECAR,WORKREG3    GET THE LINE DIFFERENCE       CODE2   02103000
         LTR   LINGRO,LINGRO           DO WE HAVE SCREEN WRAP?  YA01252 02104000
         BZ    SOURTST1            NO, CONTINUE SETUP           YA01252 02105000
         TM    DACFLG(DACAD),X'80' WRAP WITH OPERATOR SMI ?     YA01252 02106000
         BZ    SOURTST1            NO, CONTINUE SETUP           YA01252 02107000
         SR    WORKREG4,WORKREG4       CLEAR                    YA01252 02108000
         IC    WORKREG4,DSLINE(DACAD)  PICK UP 2260 LINE COUNT  YA01252 02109000
         SR    WORKREG4,WORKREG3     GET DIFFERENCE             YA01252 02110000
         LA    WORKREG4,0(WORKREG4)  INSURE HIGH BYTE CLEAR     YA01252 02111000
         STC   WORKREG4,DACSINAD(DACAD) SAVE VALUE              YA01252 02112000
SOURTST1 EQU   *                   NOT SMI WRAP AND COMMON      YA01252 02113000
         SR    WORKREG4,WORKREG4    CAN THE REMAINDER           YA01252 02114000
         IC    WORKREG4,DSWIDE(DACAD)  PICK UP THE 2260 WIDTH   CODE2   02115000
         SR    REG0,WORKREG4      GET SCREEN WIDTH DIFFERENCE   CODE2   02116000
         SR    WORKREG4,WORKREG4    CLEAR EVEN OF EVEN/ODD PAIR YA01252 02117000
         LR    WORKREG3,SPECAR     GET THE LINE DIFFERENCE      CODE2   02118000
         MR    WORKREG4,REG0       RIGHT BYTES LOST TO NULLS    CODE2   02119000
         LR    CARADD,CURSAD       KEEP CURSAD INTACT           CODE2   02120000
         SR    CARADD,SOMADD       3270 SCREEN POSITIONS SPANND CODE2   02121000
         SR    CARADD,WORKREG3     REDUCE BY LOST NULL COUNT    CODE2   02122000
         LTR   LINGRO,LINGRO                                            02123000
         BZ    NOWRAP                                                   02124000
         TM    DACOPTYP(DACAD),X'40'                                    02125000
         BNO   PROTWRAP                                                 02126000
         CLC   DACDSSCR(2,DACAD),DACANSCR(DACAD)                        02127000
         BNE   PROTWRAP                                                 02128000
         BCTR  CARADD,0                                                 02129000
*********************************************************************** 02130000
*                                                                       02131000
*   PROTWRAP   FROM      FIXIT                                          02132000
*        ADJUST FOR PROTECTED FIELD DURING SCREEN WRAP ON A             02133000
*   READ OPERATION                                                      02134000
*********************************************************************** 02135000
PROTWRAP EQU   *                                                        02136000
         SR    WORKREG4,WORKREG4                                        02137000
         SR    WORKREG3,WORKREG3                                        02138000
         IC    WORKREG4,DSLINE(DACAD)                                   02139000
         IC    WORKREG3,ANLINE(DACAD)                                   02140000
         SR    WORKREG3,WORKREG4                                        02141000
         SR    WORKREG4,WORKREG4                                        02142000
         IC    WORKREG4,DSWIDE(DACAD)                                   02143000
         MR    WORKREG4,WORKREG4                                        02144000
         SR    CARADD,WORKREG3                                          02145000
         TM    DACFLG(DACAD),X'80' WRAP WITH OPERATOR SMI ? LD @ZA00540 02146000
         BZ    PROTWRAX            NO, DON'T ADJUST FOR WRAP    CODE2   02147000
         SR    REG0,REG0           CLEAR A WORK REGISTER        CODE2   02148000
         SR    WORKREG4,WORKREG4   CLEAR EVEN OF EVEN/ODD PAIR  CODE2   02149000
         SR    WORKREG3,WORKREG3   CLEAR ODD OF EVEN/ODD PAIR   CODE2   02150000
         IC    REG0,ANWIDE(DACAD)   GET 3270 WIDTH              CODE2   02151000
         IC    WORKREG3,DSLINE(DACAD)  GET 2260 LINE COUNT      CODE2   02152000
         MR    WORKREG4,REG0        END ADDRESS OF LAST 3270    CODE2   02153000
*                                  LINE CONTAINING A 2260 LINE  CODE2   02154000
         SR    WORKREG4,WORKREG4    CLEAR A WORK REGISTER       YA01252 02155000
         IC    WORKREG4,DSWIDE(DACAD)  GET 2260 WIDTH           CODE2   02156000
         SR    REG0,WORKREG4       DIFFERENCE 3270 - 2260 WIDTH CODE2   02157000
         SR    15,0                LAST 2260 SCREEN POSITION    CODE2   02158000
*                                  PLUS ONE                     CODE2   02159000
         LR    CARADD,WORKREG3     SAVE                         CODE2   02160000
         SR    WORKREG3,WORKREG3   CLEAR                        YA01252 02161000
         IC    WORKREG3,DACSINAD(DACAD)  PICK UP DIFFERENCE     YA01252 02162000
         XC    DACSINAD(1,DACAD),DACSINAD(DACAD) CLEAR BYTE     YA01252 02163000
         MR    WORKREG4,REG0        COMPUTE BYTES LOST          YA01252 02164000
         SR    CARADD,WORKREG3     REDUCE COUNT                 YA01252 02165000
         SR    CARADD,SOMADD       COMPUTE DATA LENGTH          CODE2   02166000
PROTWRAX EQU   *                                                CODE2   02167000
         LR    CURSAD,CARADD                                            02168000
         AR    CURSAD,SOMADD                                            02169000
*********************************************************************** 02170000
*                                                                       02171000
*   NOWRAP     FROM      FIXIT, PROTWRAP                                02172000
*        SET LENGTH FOR PROCESSING READ DATA                            02173000
*********************************************************************** 02174000
NOWRAP   EQU   *                                                        02175000
         TM    21(DACAD),X'80'     CHECK RVOID=YES             @YA03964 02176000
         BZ    NOWRAP2             BR IF NO                    @YA03964 02177000
         LR    WORKREG3,SOURAD     LOAD CURRENT SOURCE ADR     @YA03964 02178000
         L     WORKREG4,4(DACAD)   LOAD ORIGINAL SOURCE ADR    @YA03964 02179000
         LA    WORKREG4,0(WORKREG4)     CLEAR HI ORDER BYTE    @YA03964 02180000
         SR    WORKREG3,WORKREG4   GET PROCESSED LENGTH        @YA03964 02181000
         LH    CARADD,12(DACAD)    LOAD ORIG. SOURCE LENGTH    @YA03964 02182000
         SR    CARADD,WORKREG3     REMAINDER IN CARADD         @YA03964 02183000
NOWRAP2  EQU   *                                               @YA03964 02184000
         LR    WORKREG3,CARADD                                          02185000
         LA    WORKREG4,255               EXCEDES 255 BYTES             02186000
         CR    WORKREG3,WORKREG4          IF NO                         02187000
         BNH   UND256                   GO SET ACTUAL IF YES            02188000
         LA    LINGRO,255               SET AT 255                      02189000
         OI    DACFLG(DACAD),X'10'      SET LONG DATA FLAG              02190000
         B     OVR256                   GO SET IT UP                    02191000
*********************************************************************** 02192000
*                                                                       02193000
*   WRAP       FROM      SOURTST                                        02194000
*        SCREEN WRAP ON A READ (CURSOR POSITION LESS THAN SOM           02195000
*********************************************************************** 02196000
WRAP     EQU   *                        WRAPAROUND PRESENT              02197000
         TM    DACFLG(DACAD),X'08' SOMHER FLAG ON (SBA IN DATA) CODE2   02198000
         BO    WRAP1               YES, NOT OPERATOR SMI        CODE2   02199000
         OI    DACFLG(DACAD),X'80' SET BLAT FLAG TO INDICATE    CODE2   02200000
*                                  WRAP WITH OPERATOR SMI       CODE2   02201000
WRAP1    EQU   *                   CODE2                                02202000
         SR    LINGRO,LINGRO            CLEAR FOR SET GROUP             02203000
         IC    LINGRO,ANLINE(DACAD)         GET 3270 LINE COUNT         02204000
         SR    CARADD,CARADD            CLEAR FOR WORK                  02205000
         IC    CARADD,ANWIDE(DACAD)         GET 3270  WIDTH             02206000
         TM    DACOPTYP(DACAD),X'40'                                    02207000
         BO    TOPLOST                                                  02208000
         LR    WORKREG3,CARADD                PUT IN WORK AND           02209000
         MR    WORKREG4,LINGRO                CALCULATE LAST            02210000
         LR    LINGRO,WORKREG3                SAVE                      02211000
         AR    CURSAD,LINGRO            MOVE CURSOR BY SCREN            02212000
         B     SOURTST                  GO BACK AND TRY 'GIN            02213000
TOPLOST  EQU   *                                                        02214000
         IC    LINGRO,DSLINE(DACAD)                                     02215000
         IC    WORKREG3,DSWIDE(DACAD)                                   02216000
         MR    WORKREG4,LINGRO                                          02217000
         LR    CURSAD,WORKREG3                                          02218000
         SR    LINGRO,LINGRO                                            02219000
         B     SOURTST                                                  02220000
*********************************************************************** 02221000
*                                                                       02222000
*   UND256     FROM      NOWRAP                                         02223000
*        SET CALCULATED LENGTH IN LINGRO                                02224000
*********************************************************************** 02225000
UND256   EQU   *                        LESS THAN 256 BYTES             02226000
         LR    LINGRO,WORKREG3                SET REAL LENGTH           02227000
*********************************************************************** 02228000
*                                                                       02229000
*   OVR256     FROM      NOWRAP, UND256                                 02230000
*        OUT TO RDLAT AFTER READ DATA LENGTH SET                        02231000
*********************************************************************** 02232000
OVR256   EQU   *                        MORE THAN 256                   02233000
         SR    SOMADD,SOMADD       SOM TO ZERO FOR PROCESSING   YA01253 02234000
         LR    CURSAD,CARADD       SAVE REAL LENGTH IN CURSAD   YA01252 02235000
*                  END;                                            0519 02236000
*                ELSE                                              0520 02237000
*                  DO;                                             0520 02238000
         B     @RC00511                                            0520 02239000
@RF00511 DS    0H                                                  0521 02240000
*/**************************************************************/  0521 02241000
*/*                                                            */  0521 02242000
*/* CKSMI      FROM      READ1, NOSTART                        */  0521 02243000
*/*      SBA SEQUENCE NOT FOUND, SEARCH FOR SMI                */  0521 02244000
*/**************************************************************/  0521 02245000
*CKSMI:;                                /*SET UP LEN YO BE     */  0521 02246000
CKSMI    DS    0H                                                  0522 02247000
*           GEN SETS(WORKREG3,WORKREG4,LINGRO)                     0522 02248000
*                 REFS(DACSRCAD,DACSRCLN,DACAD,SOURAD,FULL0)       0522 02249000
*                      FLOWS(SMILOOP,NOSTART) SEQFLOW ; /*Y02947*/ 0522 02250000
         LA    WORKREG3,255                   SEARCHED IN ATTEMPT       02251000
         L     WORKREG4,DACSRCAD(DACAD)       TO FIND AN SMI            02252000
         AH    WORKREG4,DACSRCLN(DACAD)       CHARACTER-GET TRUE        02253000
         SR    WORKREG4,SOURAD            REMAINING SOURCE              02254000
         CR    WORKREG3,WORKREG4          IS IT LESS THAN 256           02255000
         BNL   UNDER256                 YES, SET UP REST                02256000
         LA    LINGRO,255               NO, SET UP MAXIMUM              02257000
         B     SMILOOP                  GO LOOK FOR SMI                 02258000
*********************************************************************** 02259000
*                                                                       02260000
*   UNDER256   FROM      CKSMI                                          02261000
*        TOTAL SEARCH LENGTH IS 255 OR LESS                             02262000
*********************************************************************** 02263000
UNDER256 EQU   *                                                        02264000
         LR    LINGRO,WORKREG4                SET UP REMAINDER          02265000
         C     LINGRO,FULL0                                             02266000
         BNH   NOSTART                                                  02267000
*/**************************************************************/  0523 02268000
*/*                                                            */  0523 02269000
*/* SMILOOP    FROM      CKSMI, NOTSMI, UNDER256               */  0523 02270000
*/*      SEARCH FOR SMI ()                                    */  0523 02271000
*/**************************************************************/  0523 02272000
*SMILOOP:;                              /*LOOK FOR SMI         */  0523 02273000
SMILOOP  DS    0H                                                  0524 02274000
*           GEN DEFS(NOSTART) FLOWS(SOURTST,BACKGO,CKSMI) SEQFLOW  0524 02275000
*                SETS(LINGRO,SOURAD,SPECAR,CARADD,WORKREG3,        0524 02276000
*                     WORKREG4,SINKAD,SOURAD,DACFLG,NOSMI)         0524 02277000
*                REFS(DACAD,DACSRCAD,RMTDV,STXHER,DSWIDE,ANWIDE,   0524 02278000
*                     FULL0,DACSINAD,DACSRCLN)    ;      /*Y02947*/     02279000
         BCTR  LINGRO,0                 TRUE COUNT FOR XLATE            02280000
         EX    LINGRO,XLATE             TRANS AND TEST SOURC            02281000
         BC    8,NOSTART1               BRANCH IF TEST FAILS            02282000
         AR    LINGRO,SOURAD            SET GROUP TO UNTESTD            02283000
         SR    LINGRO,CARADD            PORTION                         02284000
         LA    SOURAD,1(CARADD)         SET ON PAST CHARACT             02285000
         CLI   0(CARADD),X'03'                                          02286000
         BE    ENDAT                                                    02287000
         CLI   0(CARADD),X'4A'          IS IT AN SMI                    02288000
         BNE   NOTSMI                   NO, GO SEE IF MORE              02289000
         L     SPECAR,DACSRCAD(DACAD)    PICK UP CORE ADDRESS           02290000
         LA    SPECAR,3(SPECAR)         OF FIRST DATA BYTE              02291000
         SR    CARADD,SPECAR            COMPUTE BUFFER POSIT            02292000
         LA    SPECAR,1(CARADD)        OF SMI                           02293000
         TM    DACFLG(DACAD),X'01'                                      02294000
         BNO   ADJUST                  NO, GO COMPUTE LOST NULLS        02295000
         BCTR  SPECAR,0                 DECREMENT FOR TWO               02296000
         BCTR  SPECAR,0                 BYTE 3270 ADDRESS               02297000
         TM    DACFLG(DACAD),X'02'                                      02298000
         BNO   ADJUST                 NO, GO COMPUTE LOST NULLS         02299000
         BCTR  SPECAR,0                 DECREMENT FOR STX               02300000
*********************************************************************** 02301000
*                                                                       02302000
*   ADJUST     FROM     SMILOOP                                         02303000
*        COMPUTE LOST NULLS AND ADJUST SMI POSITION                     02304000
*********************************************************************** 02305000
ADJUST   EQU   *                      COMPUTE LOST NULLS                02306000
         SR    CARADD,CARADD          CLEAR A REG FOR WORK              02307000
         IC    CARADD,DSWIDE(DACAD)       PICK UP DSWIDE                02308000
         CR    SPECAR,CARADD          SMI IN FIRST LINE ?               02309000
         BL    ADJUST1                                                  02310000
         LR    WORKREG3,SPECAR              SAVE THE DISPLACEMENT       02311000
         SR    WORKREG4,WORKREG4                  CLEAR EVEN REG        02312000
         DR    WORKREG4,CARADD              DIVIDE BY DSWIDE            02313000
         SR    WORKREG4,WORKREG4                  CLEAR EVEN REG        02314000
         IC    WORKREG4,ANWIDE(DACAD)           PICK UP ANWIDE          02315000
         SR    WORKREG4,CARADD              GET SCREEN DIFFERENCE       02316000
         MR    WORKREG4,WORKREG4                  COMPUTE LOST NULLS    02317000
         AR    SPECAR,WORKREG3              ADD TO DISPLACEMENT         02318000
ADJUST1  EQU   *                                                        02319000
         SR    LINGRO,LINGRO                                            02320000
         B     SOURTST                                                  02321000
*********************************************************************** 02322000
*                                                                       02323000
*   NOTSMI     FROM      SMILOOP                                        02324000
*        CHARACTER FOUND IS NOT AN SMI                                  02325000
*********************************************************************** 02326000
NOTSMI   C     LINGRO,FULL0             ANY LEFT                        02327000
         BE    NOSTART                  NO, CHECK REST                  02328000
         B     SMILOOP                  YES, DO REST                    02329000
ENDAT    EQU   *                                                        02330000
         TM    DACFLG(DACAD),X'01'                                      02331000
         BO    NOTSMI                                                   02332000
         L     SOURAD,DACSRCAD(DACAD)                                   02333000
         L     SINKAD,DACSINAD(DACAD)                                   02334000
         B     BACKGO                                                   02335000
*********************************************************************** 02336000
*                                                                       02337000
*   NOSTART1   FROM      SMILOOP                                        02338000
*        NO CHARACTERS SELECTED BY TEST                                 02339000
*********************************************************************** 02340000
NOSTART1 AR    SOURAD,LINGRO            INCREMENT BEGINNING             02341000
*********************************************************************** 02342000
*                                                                       02343000
*   NOSTART    FROM      NOSTART1, NOTSMI                               02344000
*        TEST FOR ADDITIONAL SOURCE TO TEST                             02345000
*********************************************************************** 02346000
NOSTART  EQU   *                        SMI NOT FOUND                   02347000
         LH    WORKREG3,DACSRCLN(DACAD)       COMPUTE CORE              02348000
         A     WORKREG3,DACSRCAD(DACAD)       ADDRESS OF LAST           02349000
         BCTR  WORKREG3,0                     CHARACTER IN SOURCE       02350000
         CR    WORKREG3,SOURAD                ARE WE THERE              02351000
         BH    CKSMI                                                    02352000
         OI    DACFLG(DACAD),X'04'                                      02353000
*/**************************************************************/  0525 02354000
*/*                                                            */  0525 02355000
*/* READOUT    FROM      READ1, MORTST, RDETX, SOURTST         */  0525 02356000
*/*      NORMAL EXIT PROCESSING FOR READ OPERATIONS            */  0525 02357000
*/**************************************************************/  0525 02358000
*RVOIDOUT:;                                                        0525 02359000
RVOIDOUT DS    0H                                                  0526 02360000
*        GEN SETS(LNGDT,DACFLG) REFS(DACAD) SEQFLOW ;      /*Y02947*/   02361000
         NI    DACFLG(DACAD),X'EF' TURN OFF LONG DATA FLAG     YA01252  02362000
*READOUT:;                                                         0527 02363000
READOUT  DS    0H                                                  0528 02364000
*           GEN SETS(SINK,SINKAD,DACFLG,BLAT,SOURAD,CURSAD,        0528 02365000
*                   SPECAR,LINGRO)                                 0528 02366000
*               REFS(DACAD,RMTDV,DACSRCAD,STXHER,DACCRS)           0528 02367000
*               FLOWS(OUTNORM,SOURTST) NOSEQFLOW ;         /*Y02947*/   02368000
         TM    DACFLG(DACAD),X'80'  WRAP WITH OPERATOR SMI ?    CODE2   02369000
         BO    READOUT1            YES, SET UP TO RETURN TO     CODE2   02370000
*                                  FIRST OF DATA STREAM TO      CODE2   02371000
*                                  PICK UP LAST OF DATA         CODE2   02372000
         TM    DACFLG(DACAD),X'01'                                      02373000
         BZ    OUTNORM               NO, GO CLEAN OUT                   02374000
         MVI   0(SINKAD),X'03'                                          02375000
         LA    SINKAD,1(SINKAD)                                         02376000
         B     OUTNORM                  GO CLEAN OUT                    02377000
READOUT1 EQU   *                                                CODE2   02378000
         NI    DACFLG(DACAD),X'7F'   TURN OFF BLAT FLAG         CODE2   02379000
         L     SOURAD,DACSRCAD(DACAD)   GET SOURCE ORIGIN       CODE2   02380000
         LA    SOURAD,3(SOURAD)    POINT TO FIRST DATA BYTE     CODE2   02381000
         TM    DACFLG(DACAD),X'01'   REMOTE DEVICE ?            CODE2   02382000
         BZ    READOUT3            NO, SOURAD IS CORRECT        CODE2   02383000
         LA    SOURAD,2(SOURAD)    BUMP PAST ADDRESS BYTES      CODE2   02384000
         TM    DACFLG(DACAD),X'02'   STX IN DATA STREAM ?       CODE2   02385000
         BNO   READOUT3            NO, SOURAD IS CORRECT        CODE2   02386000
         LA    SOURAD,1(SOURAD)    BUMP PAST STX                CODE2   02387000
READOUT3 EQU   *                                                CODE2   02388000
         LH    CURSAD,DACCRS(DACAD)  RESTORE CURSOR TO ORIGINAL CODE2   02389000
         LA    SPECAR,256          MAX LENGTH                   YA01252 02390000
         CR    SPECAR,CURSAD       256 LEFT ?                   YA01252 02391000
         BH    READOUT4            YES, CONTINUE SETUP          YA01252 02392000
         BCTR  CURSAD,0            REDUCE BY ONE                YA01252 02393000
READOUT4 EQU   *                                                YA01252 02394000
         SR    SPECAR,SPECAR       SET SOM POINTER TO ZERO      CODE2   02395000
         SR    LINGRO,LINGRO       CLEAR WRAP INDICATION        CODE2   02396000
         B     SOURTST             GO SET UP SECOND PASS        CODE2   02397000
*                  END;                                            0529 02398000
*           GEN;                                                   0530 02399000
@RC00511 DS    0H                                                  0530 02400000
         EJECT                                                          02401000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0531 02402000
*/*     PRECEDING CODE -                                       */  0531 02403000
*/*SOURTST:      P SAVE SOM ADDRESS IN SOMADD                  */  0531 02404000
*/*              D (LOW,WRAP,EQ,READOUT,HI,) CURSOR ADDRESS        0531 02405000
*/*                RELATIVE TO SOM ?                           */  0531 02406000
*/*              P CALCULATE TOTAL SCREEN DIFFERENCE BETWEEN       0531 02407000
*/*                SOM AND CURSOR                              */  0531 02408000
*/*              P TEMPORARILY SAVE VALUE IN CARADD            */  0531 02409000
*/*              P PICK UP DACIND AND DECREMENT BY THREE       */  0531 02410000
*/*              D (YES,,NO,REMOTST) SOMHER ON ?               */  0531 02411000
*/*              P DECREMENT MODIFIED DACIND BY THREE          */  0531 02412000
*/*REMOTST:      D (YES,,NO,FIXIT) RMTDV ON ?                  */  0531 02413000
*/*              P DECREMENT MODIFIED DACIND BY TWO            */  0531 02414000
*/*              D (YES,,NO,FIXIT) STXHER ON ?                 */  0531 02415000
*/*              P DECREMENT MODIFIED DACIND BY ONE            */  0531 02416000
*/*FIXIT:        P INCREMENT DIFFERENCE BY OFFSET FROM SOM TO      0531 02417000
*/*                FIRST LINE BOUNDRY                          */  0531 02418000
*/*              P DIVIDE RESULT BY 3270 SCREEN WIDTH TO GET       0531 02419000
*/*                NUMBER OF LINES SPANNED                     */  0531 02420000
*/*              P COMPUTE DIFFERENCE BETWEEN 2260 AND 3270        0531 02421000
*/*                SCREEN WIDTHS                               */  0531 02422000
*/*              P MULTIPLY WIDTH DIFFERENCE BY NUMBER OF LINES    0531 02423000
*/*                SPANNED                                     */  0531 02424000
*/*              P DECREMENT CARADD BY RESULT                  */  0531 02425000
*/*              D (YES,NOWRAP,NO,) LINGRO = ZERO ?            */  0531 02426000
*/*              D (YES,,NO,PROTWRAP) PROT = YES SPECIFIED ?   */  0531 02427000
*/*              D (YES,,NO,PROTWRAP) SCREENS EQUAL ?          */  0531 02428000
*/*              P DECREMENT CARADD BY ONE                     */  0531 02429000
*/*PROTWRAP:     P CALCULATE LINE DIFFERENCE BETWEEN 2260 AND      0531 02430000
*/*                3270                                        */  0531 02431000
*/*              P MULTIPLY BY 2260 WIDTH                      */  0531 02432000
*/*              P DECREMENT CARADD BY RESULT                  */  0531 02433000
*/*NOWRAP:       D (YES,,NO,UND256) STREAM OVER 255 BYTES ?    */  0531 02434000
*/*              P (,OVR256) SET LINGRO TO 255, TURN ON LNGDT  */  0531 02435000
*/*WRAP:         P (,SOURTST) INCREMENT CURSAD BY 3270 SCREEN      0531 02436000
*/*                SIZE, SET LINGRO NON ZERO                   */  0531 02437000
*/*UND256:       P SET LINGRO TO ACTUAL DATA LENGTH            */  0531 02438000
*/*OVR256:       P (,RDLAT) CLEAR CURLIN                       */  0531 02439000
*/*CKSMI:        P CALCULATE REMAINING SOURCE LENGTH - NOT         0531 02440000
*/*                INCLUDING AID, SBA, ETC.                    */  0531 02441000
*/*              D (YES,UNDER256,NO,) LENGTH LESS THAN 256 ?   */  0531 02442000
*/*              P (,SMILOOP) SET LINGRO TO 256                */  0531 02443000
*/*UNDER256:     P SET LINGRO TO ACTUAL LENGTH                 */  0531 02444000
*/*              D (YES,NOSTART,NO,) IS LINGRO ZERO ?          */  0531 02445000
*/*SMILOOP:      D (NO,NOSTART1,YES,) ANY SPECIAL CHARACTERS ? */  0531 02446000
*/*              P SET LINGRO TO UNTESTED PORTION              */  0531 02447000
*/*              D (YES,ENDAT,NO,) IS IT AN ETX ?              */  0531 02448000
*/*              D (NO,NOTSMI,YES,) IS IT AN SMI ?             */  0531 02449000
*/*              P COMPUTE BUFFER POSITION OF SMI              */  0531 02450000
*/*              D (NO,ADJUST,YES,) IS RMTDV ON ?              */  0531 02451000
*/*              P DECREMENT BY TWO TO REMOTE ADDRESS          */  0531 02452000
*/*              D (NO,ADJUST,YES,) IS STXHER ON ?             */  0531 02453000
*/*              P (,ADJUST) DECREMENT BY ONE FOR STX          */  0531 02454000
*/*ADJUST:       D (NO,,YES,ADJUST1) IS SMI IN FIRST LINE ?    */  0531 02455000
*/*              P DIVIDE DISPLACEMENT OF SMI INTO SOURCE BY       0531 02456000
*/*                DSWIDE                                      */  0531 02457000
*/*              P MULTIPLY QUOTIENT BY ANWIDE-DSWIDE TO GET       0531 02458000
*/*                NUMBER OF LOST NULLS                        */  0531 02459000
*/*              P ADD NUMBER OF LOST NULLS                        0531 02460000
*/*                TO DISPLACEMENT INTO SOURCE OF SMI          */  0531 02461000
*/*ADJUST1:      P (,SOURTST) CLEAR LINGRO TO ZERO             */  0531 02462000
*/*NOTSMI:       D (NO,SMILOOP,YES,NOSTART) IS LINGRO ZERO ?   */  0531 02463000
*/*ENDAT:        D (YES,NOTSMI,NO,) RMTDV ON ?                 */  0531 02464000
*/*              P (,BACKGO) RESTORE SOURCE, SINK TO BEGINNING */  0531 02465000
*/*NOSTART1:     P INCREMENT SOURAD BY LINGRO                  */  0531 02466000
*/*NOSTART:      D (NO,CKSMI,YES,) SOURAD POINT TO LAST BYTE ? */  0531 02467000
*/*              P TURN ON NOSMI FLAG                          */  0531 02468000
*/*READOUT:      D (NO,OUTNORM,YES,%REMT) IS RMTDV ON ?        */  0531 02469000
*/*%REMT:        P (,OUTNORM) PUT ETX IN SINK, BUMP SINK       */  0531 02470000
*        GEN;                                                      0531 02471000
         EJECT                                                          02472000
*/**************************************************************/  0532 02473000
*/**************************************************************/  0532 02474000
*/*                                                            */  0532 02475000
*/* RDLAT PROCESSING OF INPUT DATA STREAMS NOT INVOLVING       */  0532 02476000
*/*     UNIQUE CHARACTERS. TESTING IS DONE FOR UNIQUE          */  0532 02477000
*/*     CHARACTERS AND IF FOUND, RDLAT MOVES THAT              */  0532 02478000
*/*     PORTION OF THE SOURCE WHICH PRECEDES THE UNIQUE        */  0532 02479000
*/*     CHARACTER INTO THE SINK. CONTROL IS THEN PASSED TO     */  0532 02480000
*/*     THE APPROPRIATE SPECIAL PROCESSING CODE IN KERF.       */  0532 02481000
*/*     CONTROL IS PASSED THROUGH A BRANCH TABLE BASED         */  0532 02482000
*/*     UPON AN ARGUMENT SELECTED FROM 'TABLE' BY XLATE.       */  0532 02483000
*/*                                                            */  0532 02484000
*/*       RDMOV (RNOCHAR) MOVES THE ENTIRE GROUP TO THE        */  0532 02485000
*/*     SINK, ADJUSTS THE GROUP, AND PASSES CONTROL TO         */  0532 02486000
*/*     MORTST IF NO UNIQUE CHARACTER IS FOUND.                */  0532 02487000
*/*                                                            */  0532 02488000
*/*       MORTST VERIFYS THAT THERE IS SOURCE LEFT TO          */  0532 02489000
*/*     PROCESS, IF NOT CONTROL IS PASSED TO READOUT IN        */  0532 02490000
*/*     SOURTST. IF ITS A READ BUFFER OPERATION, THE SOURCE    */  0532 02491000
*/*     POINTER IS SET TO THE BEGINNING OF THE NEXT LINE,      */  0532 02492000
*/*     THE CURRENT LINE IS INCREMENTED, AND CONTROL IS        */  0532 02493000
*/*     PASSED TO READ1 IN READ. FOR OTHER OPTYPES, THE        */  0532 02494000
*/*     LENGTH IS ESTABLISHED AT 255 OR ALL REMAINING,         */  0532 02495000
*/*     AND CONTROL IS PASSED TO RDLAT.                        */  0532 02496000
*/*                                                            */  0532 02497000
*/**************************************************************/  0532 02498000
*/**************************************************************/  0532 02499000
*RDLAT:     GEN SETS(SPECAR,CARADD,LINGRO)                         0532 02500000
*                REFS(DACSRCAD,DACAD,SOMADD)                       0532 02501000
*                 FLOWS(RNOCHAR) SEQFLOW  ;        /*Y02947*/      0532 02502000
RDLAT    DS    0H                                                  0532 02503000
         SR    SPECAR,SPECAR                                            02504000
         SR    CARADD,CARADD                                            02505000
         BCTR  LINGRO,0                 SET COUNT FOR XLATE             02506000
         EX    LINGRO,XLATE                                             02507000
         LA    LINGRO,1(LINGRO)         PUT COUNT BACK                  02508000
         BC    8,RNOCHAR                                                02509000
         STC   SPECAR,DACSRCAD(DACAD)     SAVE THE ARGUMENT             02510000
         LR    SPECAR,SOMADD          SAVE THE SOM ADDRESS              02511000
*           SOMADD = LINGRO - CARADD + SOURAD - 1;                 0533 02512000
         LR    SOMADD,LINGRO                                       0533 02513000
         SLR   SOMADD,CARADD                                       0533 02514000
         ALR   SOMADD,SOURAD                                       0533 02515000
         BCTR  SOMADD,0                                            0533 02516000
*           LINGRO = CARADD - SOURAD;                              0534 02517000
         LR    LINGRO,CARADD                                       0534 02518000
         SLR   LINGRO,SOURAD                                       0534 02519000
*                     SPECAR = SPECAR + LINGRO + 1;                0535 02520000
         LR    @12,SPECAR                                          0535 02521000
         ALR   @12,LINGRO                                          0535 02522000
         AH    @12,@CH00061                                        0535 02523000
         LR    SPECAR,@12                                          0535 02524000
*           IF DACSINAD + DACSINLN < SINKAD + LINGRO               0536 02525000
*                THEN GO TO OUTSINK;                               0536 02526000
         LH    @12,DACSINLN(,DACAD)                                0536 02527000
         AL    @12,DACSINAD(,DACAD)                                0536 02528000
         LR    @10,SINKAD                                          0536 02529000
         ALR   @10,LINGRO                                          0536 02530000
         CR    @12,@10                                             0536 02531000
         BL    @RT00536                                            0536 02532000
*                ELSE;                                             0538 02533000
*           IF LINGRO ^= FULL0                                     0539 02534000
*                THEN                                              0539 02535000
         C     LINGRO,FULL0                                        0539 02536000
         BE    @RF00539                                            0539 02537000
*                  DO;                                             0540 02538000
*           GEN SETS(LINGRO) SEQFLOW ;               /*Y02947*/    0541 02539000
         BCTR  LINGRO,0                                                 02540000
         EX    LINGRO,MYMOV                                             02541000
         LA    LINGRO,1(LINGRO)                                         02542000
*                     SINKAD = SINKAD + LINGRO;                    0542 02543000
         ALR   SINKAD,LINGRO                                       0542 02544000
*                     SOURAD = CARADD;                             0543 02545000
         LR    SOURAD,CARADD                                       0543 02546000
*                  END;                                            0544 02547000
*                ELSE;                                             0545 02548000
@RF00539 DS    0H                                                  0546 02549000
*                     GEN SETS (CARADD,SPECAR,DACSRCAD)            0546 02550000
*                            REFS(DACAD,DACOPTYP,RDBUF)            0546 02551000
*          FLOWS (RNOCHAR,RDNULL,RDFLDMK,RDSMI,RDEOM,              0546 02552000
*                 RDETX,RDSOM,RDBFM,RDBSMI,RDBEOM,RDBSOM)          0546 02553000
*          NOSEQFLOW ;                                       /*Y02947*/ 02554000
         LR    CARADD,SPECAR          SAVE THE SOM ADDRESS              02555000
         SR    SPECAR,SPECAR          CLEAR SPECAR                      02556000
         IC    SPECAR,DACSRCAD(DACAD)        RESTORE THE ARGUMENT       02557000
         XC    DACSRCAD(1,DACAD),DACSRCAD(DACAD) CLEAR 1 BYTE SAVE AREA 02558000
         SLL   SPECAR,2                 MULTIPLY BY FOUR                02559000
         TM    DACOPTYP(DACAD),X'01'      READ BUFFER OPERAT'N          02560000
         BZ    RDTAB(SPECAR)          NO, PROCEDE                       02561000
         LA    SPECAR,40(SPECAR)        YES, PUT INTO READ              02562000
*                                       BUFFER SECTION                  02563000
         B     RDTAB(SPECAR)            BRANCH ON ARGUMENT              02564000
*********************************************************************** 02565000
*                                                                       02566000
*   RDTAB      FROM      RDLAT                                          02567000
*        BRANCH UPON ARGUMENT IN SPECAR TO APPROPRIATE UNIQUE           02568000
*   CHARACTER HANDLING ROUTINE                                          02569000
*********************************************************************** 02570000
RDTAB    EQU   *                        BRANCH TABLE FOR                02571000
*                                       EXIT FROM TRANSLATE             02572000
*                                       AND TEST, IF CONDT'N            02573000
*                                       CODE IS NOT ZERO                02574000
         B     RNOCHAR                  UNUSED POSITION                 02575000
         B     RDNULL                NL IN INPUT DATA   THIS            02576000
*                                       IS INVALID AND A                02577000
*                                       BLANK WILL GO IN                02578000
         B     RDNULL                   NULL IN DATA                    02579000
         B     RDFLDMK                  FIELD MARK IN DATA              02580000
         B     RDSMI                                                    02581000
         B     RDEOM                    EOM IN DATA - X'5A'             02582000
         B     RDNULL                EOM IN DATA - X'6A'                02583000
*                                       THIS IS INVALID AND             02584000
*                                       A BLANK WILL GO IN              02585000
         B     RDETX                    END FRAMING DETECTED            02586000
         B     RDSOM                    SOM IN DATA                     02587000
         B     RNOCHAR                  UNUSED POSITION                 02588000
RDBUFTAB EQU   *                        IF READ BUFFER OPTYP            02589000
         B     RNOCHAR                  UNUSED POSITION                 02590000
         B     RDNULL                   NULL IN DATA                    02591000
         B     RDNULL                NL IN INPUT DATA   THIS            02592000
*                                       IS INVALID AND A                02593000
*                                       BLANK WILL GO IN                02594000
         B     RDBFM                    FIELD MARK IN DATA              02595000
         B     RDBSMI                                                   02596000
         B     RDBEOM                   EOM IN DATA - X'5A'             02597000
         B     RDNULL                EOM IN DATA - X'6A'                02598000
*                                       THIS IS INVALID AND             02599000
*                                       A BLANK WILL GO IN              02600000
         B     RDETX                    END FRAMING DETECTED            02601000
         B     RDBSOM                   SOM IN DATA                     02602000
*/**************************************************************/  0547 02603000
*/*                                                            */  0547 02604000
*/* RNOCHAR    FROM      RDLAT                                 */  0547 02605000
*/*      DATA GROUPS WITH NO UNIQUE CHARACTERS                 */  0547 02606000
*/**************************************************************/  0547 02607000
*RNOCHAR:;                                                         0547 02608000
RNOCHAR  DS    0H                                                  0548 02609000
*           GEN SETS(SOMADD,WORKREG4,WORKREG3,LINGRO,SINKAD,SOURAD)     02610000
*                 REFS(DACSINAD,DACAD,DACSINLN)                    0548 02611000
*                    FLOWS(OUTSINK) SEQFLOW  ;       /*Y02947*/    0548 02612000
         AR    SOMADD,LINGRO                                            02613000
         LR    WORKREG4,SINKAD                                          02614000
         AR    WORKREG4,LINGRO                                          02615000
         L     WORKREG3,DACSINAD(DACAD)                                 02616000
         AH    WORKREG3,DACSINLN(DACAD)                                 02617000
         BCTR  WORKREG3,0                                               02618000
         CR    WORKREG3,WORKREG4                                        02619000
         BL    OUTSINK                                                  02620000
         BCTR  LINGRO,0                                                 02621000
         EX    LINGRO,MYMOV                                             02622000
         LA    LINGRO,1(LINGRO)                                         02623000
         AR    SINKAD,LINGRO                                            02624000
         AR    SOURAD,LINGRO                                            02625000
*/**************************************************************/  0549 02626000
*/*                                                            */  0549 02627000
*/* MORTST     FROM      RNOCHAR, DATLNTST                     */  0549 02628000
*/*      SETUP FOR CONTINUED PROCESSING, IF MORE DATA LEFT     */  0549 02629000
*/**************************************************************/  0549 02630000
*MORTST:;                                                          0549 02631000
MORTST   DS    0H                                                  0550 02632000
*           IF LNGDT = '0'B                                        0550 02633000
*                THEN                                              0550 02634000
         TM    LNGDT(DACAD),B'00010000'                            0550 02635000
         BNZ   @RF00550                                            0550 02636000
*                  DO;                                             0551 02637000
*                     IF RDBUF = '0'B                              0552 02638000
*                          THEN GO TO READOUT;                     0552 02639000
         TM    RDBUF(DACAD),B'00000001'                            0552 02640000
         BZ    @RT00552                                            0552 02641000
*                          ELSE                                    0554 02642000
*                            DO;                                   0554 02643000
*                               SOURAD = SOURAD + ANWIDE -         0555 02644000
*                               DSWIDE;                            0555 02645000
         LR    @12,SOURAD                                          0555 02646000
         SLR   @10,@10                                             0555 02647000
         IC    @10,ANWIDE(,DACAD)                                  0555 02648000
         ALR   @12,@10                                             0555 02649000
         SLR   @10,@10                                             0555 02650000
         IC    @10,DSWIDE(,DACAD)                                  0555 02651000
         SLR   @12,@10                                             0555 02652000
         LR    SOURAD,@12                                          0555 02653000
*                               CURLIN = CURLIN + ONE;             0556 02654000
         AL    CURLIN,ONE                                          0556 02655000
*                               GO TO READ1;                       0557 02656000
         B     READ1                                               0557 02657000
*                            END;                                  0558 02658000
*                  END;                                            0559 02659000
*                ELSE;                                             0560 02660000
@RF00550 DS    0H                                                  0561 02661000
*           GEN SETS(LINGRO,WORKREG4,DACFLG,LNGDT)                 0561 02662000
*                REFS(CURSAD,SOMADD,DACAD)                         0561 02663000
*                   FLOWS(READOUT,RDLAT) SEQFLOW ;     /*Y02947*/  0561 02664000
         LR    LINGRO,CURSAD           PICK UP REAL LENGTH      YA01252 02665000
         SR    LINGRO,SOMADD                                            02666000
         BNP   READOUT                 WE HAVE PASSED CURSOR            02667000
         LA    WORKREG4,255                   THAN 256                  02668000
         CR    LINGRO,WORKREG4                                          02669000
         BNH   LOW256                   LEAVE REMAINDER                 02670000
         LA    LINGRO,255               ELSE PLUG 255 AS                02671000
         B     RDLAT                    GROUP AND GO PROCESS            02672000
*********************************************************************** 02673000
*                                                                       02674000
*   LOW256     FROM      MORTST                                         02675000
*        LESS  THAN 256 BYTES OF SOURCE LEFT                            02676000
*********************************************************************** 02677000
LOW256   EQU   *                        SET THE LONG DATA               02678000
         NI    DACFLG(DACAD),X'EF'          FLAG OFF                    02679000
*           GO TO RDLAT;                                           0562 02680000
         B     RDLAT                                               0562 02681000
*           GEN;                                                   0563 02682000
         EJECT                                                          02683000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0564 02684000
*/*     PRECEDING CODE -                                       */  0564 02685000
*/*RDLAT:        D (NO,RNOCHAR,YES,) ANY UNIQUE CHARACTERS ?   */  0564 02686000
*/*              P SAVE THE BRANCH ARGUMENT, SAVE SOMADD       */  0564 02687000
*/*              P SOMADD TO REMAINING PORTION OF STREAM       */  0564 02688000
*/*              P LINGRO TO TESTED PORTION LESS ONE           */  0564 02689000
*/*              P BUMP SOM BY LINGRO                          */  0564 02690000
*/*              D (NO,OUTSINK,YES,%MOVIT) SINK HOLD LINGRO ?  */  0564 02691000
*/*%MOVIT:       D (NO,,YES,%SETBR) LINGRO = ZERO ?            */  0564 02692000
*/*              P MOVE TESTED PORTION LESS UNIQUE CHARACTER TO    0564 02693000
*/*                SINK                                        */  0564 02694000
*/*              P BUMP SINK BY LINGRO, SOURAD EQUAL UNIQUE        0564 02695000
*/*                CHARACTER'S ADDRESS                         */  0564 02696000
*/*%SETBR:       P SAVE SOM ADDRESS IN CARADD, RESTORE THE         0564 02697000
*/*                BRANCH ARGUMENT                             */  0564 02698000
*/*              D (NO,,YES,%BUFBR) IS THIS A READ BUFFER ?    */  0564 02699000
*/*              D (NL,RDNULL,NULL,RDNULL,FM,RDFLDMK,SMI,          0564 02700000
*/*                RDSMI,!,RDEOM,EOM,RDNULL,ETX,RDETX,SOM,         0564 02701000
*/*                RDSOM) WHAT IS CHARACTER ?                  */  0564 02702000
*/*%BUFBR:       D (NO,RDNULL,NULL,RDNULL,FM,RDBFM,SMI,            0564 02703000
*/*                RDBSMI,!,RDBEOM,EOM,RDNULL,ETX,RDETX,           0564 02704000
*/*                SOM,RDBSOM) WHAT IS CHARACTER ?             */  0564 02705000
*/*RNOCHAR:      P BUMP SOM ADDRESS BY LINGRO                  */  0564 02706000
*/*              D (NO,OUTSINK,YES,%DOMOV) SINK HOLD LINGRO ?  */  0564 02707000
*/*%DOMOV:       P MOVE THE TESTED GROUP TO THE SINK, BUMP THE     0564 02708000
*/*                SINK BY LINGRO                              */  0564 02709000
*/*MORTST:       D (NO,%GO011,YES,) IS LNGDT OFF ?             */  0564 02710000
*/*              D (YES,%GO010,NO,READOUT) READ BUFFER OPTYPE ?*/  0564 02711000
*/*%GO010:       P POINT SOURAD TO BEGINNING OF NEXT 2260 LINE */  0564 02712000
*/*              P (,READ1) INCREMENT CURLIN BY ONE            */  0564 02713000
*/*%GO011:       D (YES,,NO,LOW256) 256 BYTES LEFT ?           */  0564 02714000
*/*              P (,RDLAT) SET LINGRO TO 255                  */  0564 02715000
*/*LOW256:       P (,RDLAT) TURN OFF LNGDT IN DACFLG           */  0564 02716000
*        GEN;                                                      0564 02717000
         EJECT                                                          02718000
*/**************************************************************/  0565 02719000
*/**************************************************************/  0565 02720000
*/*                                                            */  0565 02721000
*/* KERF A COLLECTION OF SUBROUTINES TO DEAL WITH              */  0565 02722000
*/*     CHARACTERS REQUIRING SPECIAL ACTION. EACH              */  0565 02723000
*/*     SUBROUTINE IS AN INDIVIDUAL AND NOT NECESSARILY        */  0565 02724000
*/*     RELATED TO ANY OTHER. DATLNTST AND INCREM ARE          */  0565 02725000
*/*     FACILITIES USED BY SOME OF THE SUBROUTINES TO          */  0565 02726000
*/*     EFFECT RETURN TO MAIN DATA STREAM PROCESSING.          */  0565 02727000
*/*                                                            */  0565 02728000
*/*        RDSOM START FIELD DECTECTED IN DATA                 */  0565 02729000
*/*            INCREMENT SOURCE POINTER                        */  0565 02730000
*/*            FALL INTO RDSMI                                 */  0565 02731000
*/*                                                            */  0565 02732000
*/*        RDSMI OPERATOR ENTERED SOM 'X'4A') DETECTED         */  0565 02733000
*/*            POINT SINK TO BEGINNING                         */  0565 02734000
*/*            INCREMENT SOURCE                                */  0565 02735000
*/*            BRANCH TO DATLNTST                              */  0565 02736000
*/*                                                            */  0565 02737000
*/*        RDEOM END OF MESSAGE DETECTED                       */  0565 02738000
*/*            PUT 2260 EOM IN SINK                            */  0565 02739000
*/*            INCREMENT SINK AND SOURCE                       */  0565 02740000
*/*            BRANCH TO DATLNTST                              */  0565 02741000
*/*                                                            */  0565 02742000
*/*        RDFLDMK 3270 FIELD MARK DETECTED                    */  0565 02743000
*/*            PUT 2260 NEW LINE IN SINK                       */  0565 02744000
*/*            INCREMENT SINK AND SOURCE                       */  0565 02745000
*/*            SET LINGRO, SOURCE POINTER IF REQUIRED          */  0565 02746000
*/*            BRANCH TO DATLNTST                              */  0565 02747000
*/*                                                            */  0565 02748000
*/*        RDETX ETX DETECTED                                  */  0565 02749000
*/*            IF THIS IS REMOTE, BRANCH TO READOUT            */  0565 02750000
*/*                IN SOURTST                                  */  0565 02751000
*/*            IF THIS IS NOT REMOTE, RESET SOURCE             */  0565 02752000
*/*                AND SINK TO BEGINNING AND BRANCH            */  0565 02753000
*/*                TO BACKGO IN HOUSEKEEPING                   */  0565 02754000
*/*                                                            */  0565 02755000
*/*        RDBSOM START FIELD DETECTED                         */  0565 02756000
*/*            INCREMENT SOURCE                                */  0565 02757000
*/*            FALL INTO RDBSMI                                */  0565 02758000
*/*                                                            */  0565 02759000
*/*        RDBSMI OPERATOR ENTERED SOM 'X'4A') DETECTED        */  0565 02760000
*/*            PUT 2260 SOM IN SINK                            */  0565 02761000
*/*            BRANCH TO INCREM                                */  0565 02762000
*/*                                                            */  0565 02763000
*/*        RDBEOM END OF MESSAGE DETECTED                      */  0565 02764000
*/*            PUT 2260 EOM IN SINK                            */  0565 02765000
*/*            INCREMENT THE SOURCE                            */  0565 02766000
*/*            BRANCH TO INCREM                                */  0565 02767000
*/*                                                            */  0565 02768000
*/*        RDBFM FIELD MARK DETECTED                           */  0565 02769000
*/*            PUT NEW LINE IN SINK                            */  0565 02770000
*/*            BRANCH TO INCREM                                */  0565 02771000
*/*                                                            */  0565 02772000
*/*        RDNULL NULL OR INVALID CHARACTER DETECTED           */  0565 02773000
*/*            PUT A BLANK IN SINK                             */  0565 02774000
*/*            IF READ BUFFER OP, BRANCH TO INCREM             */  0565 02775000
*/*            IF NOT, BRANCH TO DATLNTST                      */  0565 02776000
*/*                                                            */  0565 02777000
*/*        DATLNTST NORMAL READ RETURN                         */  0565 02778000
*/*            IF REMAINING GROUP IS ZERO, BRANCH              */  0565 02779000
*/*                TO MORTST                                   */  0565 02780000
*/*            OTHERWISE BRANCH TO RDLAT                       */  0565 02781000
*/*                                                            */  0565 02782000
*/*        INCREM READ BUFFER RETURN                           */  0565 02783000
*/*            INCREMENT SINK AND SOURCE                       */  0565 02784000
*/*            IF REMAINING GROUP IS ZERO, POINT SOURCE        */  0565 02785000
*/*                TO NEXT LINE, INCREMENT LINE,               */  0565 02786000
*/*                BRANCH TO READ1 IN READ                     */  0565 02787000
*/*            OTHERWISE BRANCH TO RDLAT                       */  0565 02788000
*/*                                                            */  0565 02789000
*/*                                                            */  0565 02790000
*/**************************************************************/  0565 02791000
*/**************************************************************/  0565 02792000
*/**************************************************************/  0565 02793000
*/*                                                            */  0565 02794000
*/* RDSOM      FROM      RDTAB                                 */  0565 02795000
*/*      PROCESS START FIELD ORDER                             */  0565 02796000
*/**************************************************************/  0565 02797000
*RDSOM:;                                                           0565 02798000
RDSOM    DS    0H                                                  0566 02799000
*           SOURAD = SOURAD + 1;                                   0566 02800000
         AH    SOURAD,@CH00061                                     0566 02801000
*/**************************************************************/  0567 02802000
*/*                                                            */  0567 02803000
*/* RDSMI      FROM      RDTAB                                 */  0567 02804000
*/*      PROCESS OPERATOR ENTERED START OF MESSAGE             */  0567 02805000
*/**************************************************************/  0567 02806000
*RDSMI:;                                                           0567 02807000
RDSMI    DS    0H                                                  0568 02808000
*           IF RMTDV = '1'B                                        0568 02809000
*                THEN SINKAD = DACSINAD + 2;                       0568 02810000
         TM    RMTDV(DACAD),B'00000001'                            0568 02811000
         BNO   @RF00568                                            0568 02812000
         LA    SINKAD,2                                            0569 02813000
         AL    SINKAD,DACSINAD(,DACAD)                             0569 02814000
*                ELSE SINKAD = DACSINAD;                           0570 02815000
         B     @RC00568                                            0570 02816000
@RF00568 L     SINKAD,DACSINAD(,DACAD)                             0570 02817000
*           SOURAD = SOURAD + 1;                                   0571 02818000
@RC00568 LA    @12,1                                               0571 02819000
         ALR   SOURAD,@12                                          0571 02820000
*           CARADD = CARADD + 1;                                   0572 02821000
         ALR   CARADD,@12                                          0572 02822000
*/**************************************************************/  0573 02823000
*/*                                                            */  0573 02824000
*/* DATLNTST   FROM      RDSMI, RDEOM, RDFLDMK, LINBOUND,      */  0573 02825000
*/*                      RDNULL                                */  0573 02826000
*/*      EXIT TO NORMAL DATA STREAM PROCESSING FOR READ MI     */  0573 02827000
*/* AND SHORT READ MI                                          */  0573 02828000
*/**************************************************************/  0573 02829000
*DATLNTST:;                                                        0573 02830000
DATLNTST DS    0H                                                  0574 02831000
*           LINGRO = SOMADD;                                       0574 02832000
         LR    LINGRO,SOMADD                                       0574 02833000
*           SOMADD = CARADD;          /*RESTORE SOM ADDRES     */  0575 02834000
         LR    SOMADD,CARADD                                       0575 02835000
*           IF LINGRO <= FULL0                                     0576 02836000
*                THEN GO TO MORTST;                                0576 02837000
         C     LINGRO,FULL0                                        0576 02838000
         BNH   @RT00576                                            0576 02839000
*                ELSE GO TO RDLAT;                                 0578 02840000
         B     RDLAT                                               0578 02841000
*/**************************************************************/  0579 02842000
*/*                                                            */  0579 02843000
*/* RDEOM      FROM      RDTAB                                 */  0579 02844000
*/*      PROCESS END OF MESSAGE CHARACTER                      */  0579 02845000
*/**************************************************************/  0579 02846000
*RDEOM:;                                                           0579 02847000
RDEOM    DS    0H                                                  0580 02848000
*                     SINK(1) = '6A'X; /*PUT EOM IN SINK       */  0580 02849000
         MVI   SINK(SINKAD),X'6A'                                  0580 02850000
*                     SINKAD = SINKAD + ONE;                       0581 02851000
         L     @12,ONE                                             0581 02852000
         ALR   SINKAD,@12                                          0581 02853000
*                     SOURAD = SOURAD + ONE;                       0582 02854000
         ALR   SOURAD,@12                                          0582 02855000
*                     GO TO DATLNTST;                              0583 02856000
         B     DATLNTST                                            0583 02857000
*/**************************************************************/  0584 02858000
*/*                                                            */  0584 02859000
*/* RDFLDMK    FROM      RDTAB                                 */  0584 02860000
*/*      PROCESS FIELD MARK CHARACTER (NL)                     */  0584 02861000
*/**************************************************************/  0584 02862000
*RDFLDMK:;                                                         0584 02863000
RDFLDMK  DS    0H                                                  0585 02864000
*           SINK(1) = '15'X;           /*PUT NEW LINE IN SINK  */  0585 02865000
         MVI   SINK(SINKAD),X'15'                                  0585 02866000
*           SINKAD = SINKAD + ONE;                                 0586 02867000
         L     @12,ONE                                             0586 02868000
         ALR   SINKAD,@12                                          0586 02869000
*           SOURAD = SOURAD + ONE;                                 0587 02870000
         ALR   SOURAD,@12                                          0587 02871000
*           IF RVOID = '1'B                                        0588 02872000
*                THEN DO;                                          0588 02873000
         TM    RVOID(DACAD),B'10000000'                            0588 02874000
         BNO   @RF00588                                            0588 02875000
*                GEN SETS(REG0,WORKREG4,WORKREG3,CURLIN,SOMADD)    0590 02876000
*                    REFS(DSLINE,DACAD,ANWIDE,DACCRS)              0590 02877000
*                    FLOWS(RVOIDOUT,DATLNTST) NOSEQFLOW ; /*Y02947*/    02878000
         SR    REG0,REG0          CLEAR WORK REGISTER           YA01252 02879000
         IC    REG0,DSLINE(DACAD)   PICK UP MAX LINE            YA01252 02880000
         BCTR  REG0,0             REDUCE MINUS ONE              YA01252 02881000
         CR    REG0,CURLIN        MAX LINE TO CURRENT LINE      YA01252 02882000
         BNH   RVOIDOUT            JUST PROCESSED LINE MAX      YA01252 02883000
         SR    WORKREG4,WORKREG4  CLEAR REG                     YA01252 02884000
         IC    REG0,ANWIDE(DACAD)  PICK UP 3270 WIDTH          @ZA14059 02885000
         LH    WORKREG3,DACCRS(DACAD) PICK UP CURSOR POSITION  @ZA14059 02886000
         DR    WORKREG4,REG0       GET CURSOR'S LINE LESS ONE  @ZA14059 02887000
*                                  REMAINDER IS IN 14 FOR      @ZA14059 02888000
*                                  LATER USE                   @ZA14059 02889000
         LTR   WORKREG3,WORKREG3   FIRST LINE?                 @ZA14059 02890000
         BNZ   NOTFIRST            BRANCH IF NOT FIRST LINE    @ZA14059 02891000
         LTR   CURLIN,CURLIN       END OF DATA MOVED ON        @ZA14059 02892000
*                                  FIRST LINE?                 @ZA14059 02893000
         BZ    RVOIDOUT            YES,DONE IN THIS ROUTINE    @ZA14059 02894000
NOTFIRST EQU   *                                               @ZA14059 02895000
         CR    WORKREG3,CURLIN     CURSOR'S LINE TO CURRENT?   @ZA14059 02896000
         BNE   RDMKC               BR IF NO                    @YA03965 02897000
         BCTR  SINKAD,0            REDUCE SINK BY ONE          @YA03965 02898000
         B     RVOIDOUT            FINISHED PROCESSING         @YA03965 02899000
RDMKC    EQU   *                                               @YA03965 02900000
         LR    WORKREG3,LINGRO     GET LENGTH OF DATA JUST     @ZA14059 02901000
*                                  MOVED                       @ZA14059 02902000
         SR    WORKREG4,WORKREG4   CLEAR REG                   @ZA14059 02903000
         DR    WORKREG4,REG0       DETERMINE NUMBER OF FULL    @ZA14059 02904000
*                                  LINES OF DATA MOVED         @ZA14059 02905000
         AR    CURLIN,WORKREG3     ADJUST CURLIN BY AMOUNT OF  @ZA14059 02906000
*                                  DATA JUST MOVED             @ZA14059 02907000
         LA    CURLIN,1(CURLIN)   BUMP CURRENT LINE POINTER     YA01252 02908000
         LH    WORKREG3,DACCRS(DACAD) PICK UP CURSOR POSITION  @ZA14059 02909000
         SR    WORKREG4,WORKREG4  AND DEVELOP THE REMAINDER    @ZA14059 02910000
         DR    WORKREG4,0         OF DATA ON THE CURSORS LINE  @ZA14059 02911000
         CR    WORKREG3,CURLIN    NEXT LINE CURSORS LINE ?      YA01252 02912000
         BNE   DATLNTST            NO, GO DO ANOTHER            YA01252 02913000
         LR    SOMADD,WORKREG4    YES, SET TO DO REMAINDER      YA01252 02914000
         LTR   SOMADD,SOMADD       ANY ON CURSOR'S LINE TO DO?  YA01252 02915000
         BZ    RVOIDOUT            NO, DONE                     YA01252 02916000
         B     DATLNTST            YES, GO DO LAST LINE         YA01252 02917000
*              END;                                                0591 02918000
*                ELSE                                              0592 02919000
*                  DO;                                             0592 02920000
@RF00588 DS    0H                                                  0593 02921000
*           GEN SETS(WORKREG4,WORKREG3,SOURAD,CARADD,SOMADD,REG0)  0593 02922000
*               REFS(DACSRCAD,DACAD,DACIND,DSWIDE)                 0593 02923000
*               FLOWS(DATLNTST) NOSEQFLOW ;        /*Y02947*/      0593 02924000
         LCR   WORKREG4,SOURAD   SUBTRACT SOURCE POINTER FROM   CODE2   02925000
         A     WORKREG4,DACSRCAD(DACAD)  SOURCE BASE PLUS DACINDCODE2   02926000
         SR    WORKREG3,WORKREG3   CLEAR A WORK REGISTER        CODE2   02927000
         IC    WORKREG3,DACIND(DACAD)   PICK UP DACIND          CODE2   02928000
         AR    WORKREG4,WORKREG3    INTRODUCE DACIND            CODE2   02929000
         LTR   WORKREG4,WORKREG4    CHECK RELATION TO LINE BDRY CODE2   02930000
         BZ    DATLNTST            WE HAVE COINCIDENCE          CODE2   02931000
         BM    LINBOUND            WE ARE PAST FIRST BOUNDRY    CODE2   02932000
*********************************************************************** 02933000
*                                                                       02934000
*   RAPON      FROM      RDFLDMK                                        02935000
*        PROCESS NEW LINE NOT IN FIRST 2260 LINE                        02936000
*********************************************************************** 02937000
RAPON    EQU   *                                                        02938000
         AR    SOURAD,WORKREG4      BUMP SOURCE TO NEXT LINE    CODE2   02939000
         AR    CARADD,WORKREG4      BUMP SOM BUFFER UNITS       CODE2   02940000
         SR    SOMADD,WORKREG4      REDUCE RESIDUAL COUNT       CODE2   02941000
         B     DATLNTST            GO SET UP FOR NEXT PASS      CODE2   02942000
*********************************************************************** 02943000
*                                                                       02944000
*   LINBOUND   FROM      RAPON                                          02945000
*        ADJUST LINE GROUPING                                           02946000
*********************************************************************** 02947000
LINBOUND EQU   *                                                        02948000
         LR    WORKREG4,SOURAD      COMPUTE OFFSET TO NEXT LINE CODE2   02949000
         S     WORKREG4,DACSRCAD(DACAD)   REDUCE BY BEGINNING   CODE2   02950000
         SR    WORKREG4,WORKREG3    REDUCE BY DACIND            CODE2   02951000
         LR    WORKREG3,WORKREG4    PUT IN ODD OF EVEN/ODD PAIR CODE2   02952000
         SR    WORKREG4,WORKREG4    CLEAR EVEN                  CODE2   02953000
         SR    REG0,REG0            CLEAR WORK FOR DIVISOR      CODE2   02954000
         IC    REG0,DSWIDE(DACAD)   PICK UP 2260 WIDTH          CODE2   02955000
         DR    WORKREG4,REG0        COUNT INTO THIS LINE        CODE2   02956000
         LTR   WORKREG4,WORKREG4    ARE WE ON A LINE BOUNDRY    CODE2   02957000
         BZ    DATLNTST            YES, POINTERS NOW OK         CODE2   02958000
         SR    REG0,WORKREG4        REMAINDER OF LINE           CODE2   02959000
         LR    WORKREG4,REG0        PUT REMAINDER IN WORK       CODE2   02960000
         B     RAPON               GO UPDATE POINTERS           CODE2   02961000
*                  END;                                            0594 02962000
*/**************************************************************/  0595 02963000
*/*                                                            */  0595 02964000
*/* RDETX      FROM      RDTAB                                 */  0595 02965000
*/*      PROCESS ETX CHARATER                                  */  0595 02966000
*/**************************************************************/  0595 02967000
*RDETX:;                                                           0595 02968000
RDETX    DS    0H                                                  0596 02969000
*           IF RMTDV = '1'B                                        0596 02970000
*                THEN GO TO READOUT;                               0596 02971000
         TM    RMTDV(DACAD),B'00000001'                            0596 02972000
         BO    @RT00596                                            0596 02973000
*                ELSE                                              0598 02974000
*                  DO;                                             0598 02975000
*                     SOURAD = DACSRCAD;                           0599 02976000
         L     SOURAD,DACSRCAD(,DACAD)                             0599 02977000
*                     SINKAD = DACSINAD;                           0600 02978000
         L     SINKAD,DACSINAD(,DACAD)                             0600 02979000
*                     GO TO BACKGO;                                0601 02980000
         B     BACKGO                                              0601 02981000
*                  END;                                            0602 02982000
*RDBSOM:;                                                          0603 02983000
RDBSOM   DS    0H                                                  0604 02984000
*/**************************************************************/  0604 02985000
*/*                                                            */  0604 02986000
*/* RDBSOM     FROM      RDTAB                                 */  0604 02987000
*/*      PROCESS START FIELD ORDER (READ BUFFER ONLY)          */  0604 02988000
*/**************************************************************/  0604 02989000
*           SOURAD = SOURAD + 1;                                   0604 02990000
         AH    SOURAD,@CH00061                                     0604 02991000
*/**************************************************************/  0605 02992000
*/*                                                            */  0605 02993000
*/* RDBSMI     FROM      RDTAB                                 */  0605 02994000
*/*      PROCESS OPERATOR ENTERED SOM () (READ BUFFER ONLY)   */  0605 02995000
*/**************************************************************/  0605 02996000
*RDBSMI:;                                                          0605 02997000
RDBSMI   DS    0H                                                  0606 02998000
*           SINK(1) = '4A'X;           /*PUT SOM IN SINK       */  0606 02999000
         MVI   SINK(SINKAD),X'4A'                                  0606 03000000
*           GO TO INCREM;                                          0607 03001000
         B     INCREM                                              0607 03002000
*/**************************************************************/  0608 03003000
*/*                                                            */  0608 03004000
*/* RDBEOM     FROM      RDTAB                                 */  0608 03005000
*/*      PROCESS END OF MESSAGE (READ BUFFER ONLY)             */  0608 03006000
*/**************************************************************/  0608 03007000
*RDBEOM:;                                                          0608 03008000
RDBEOM   DS    0H                                                  0609 03009000
*           SINK(1) = '6A'X;           /*PUT EOM IN SINK       */  0609 03010000
         MVI   SINK(SINKAD),X'6A'                                  0609 03011000
*           SOURAD = SOURAD + 1;                                   0610 03012000
         AH    SOURAD,@CH00061                                     0610 03013000
*           GO TO INCREM;                                          0611 03014000
         B     INCREM                                              0611 03015000
*/**************************************************************/  0612 03016000
*/*                                                            */  0612 03017000
*/* RDBFM      FROM      RDTAB                                 */  0612 03018000
*/*      PROCESS FIELD MARK (READ BUFFER ONLY)                 */  0612 03019000
*/**************************************************************/  0612 03020000
*RDBFM:;                                                           0612 03021000
RDBFM    DS    0H                                                  0613 03022000
*           SINK(1) = '15'X;           /*PUT NEW LINE IN SINK  */  0613 03023000
         MVI   SINK(SINKAD),X'15'                                  0613 03024000
*           GO TO INCREM;                                          0614 03025000
         B     INCREM                                              0614 03026000
*/**************************************************************/  0615 03027000
*/*                                                            */  0615 03028000
*/* RDNULL     FROM      RDTAB                                 */  0615 03029000
*/*      PROCESS NULL OR INVALID CHARACTERS                    */  0615 03030000
*/**************************************************************/  0615 03031000
*RDNULL:;                                                          0615 03032000
RDNULL   DS    0H                                                  0616 03033000
*           SINK(1) = '40'X;           /*PUT BLANK IN SINK     */  0616 03034000
         MVI   SINK(SINKAD),X'40'                                  0616 03035000
*           IF RDBUF = '1'B                                        0617 03036000
*                THEN GO TO INCREM;                                0617 03037000
         TM    RDBUF(DACAD),B'00000001'                            0617 03038000
         BO    @RT00617                                            0617 03039000
*                ELSE GO TO DATLNTST;                              0619 03040000
         B     DATLNTST                                            0619 03041000
*/**************************************************************/  0620 03042000
*/*                                                            */  0620 03043000
*/* INCREM     FROM      RDBSMI, RDBEOM, RDBFM, RDNULL         */  0620 03044000
*/*      EXIT TO NORMAL DATA STREAM PROCESSING                 */  0620 03045000
*/**************************************************************/  0620 03046000
*INCREM:;                                                          0620 03047000
INCREM   DS    0H                                                  0621 03048000
*           SINKAD = SINKAD + ONE;                                 0621 03049000
         L     @12,ONE                                             0621 03050000
         ALR   SINKAD,@12                                          0621 03051000
*           SOURAD = SOURAD + ONE;                                 0622 03052000
         ALR   SOURAD,@12                                          0622 03053000
*           LINGRO = SOMADD;                                       0623 03054000
         LR    LINGRO,SOMADD                                       0623 03055000
*           SOMADD = CARADD;          /*RESTORE SOM ADDRES     */  0624 03056000
         LR    SOMADD,CARADD                                       0624 03057000
*           IF LINGRO = FULL0                                      0625 03058000
*                THEN                                              0625 03059000
         C     LINGRO,FULL0                                        0625 03060000
         BNE   @RF00625                                            0625 03061000
*                  DO;                                             0626 03062000
*                     SOURAD = SOURAD + ANWIDE - DSWIDE;           0627 03063000
         LR    @12,SOURAD                                          0627 03064000
         SLR   @10,@10                                             0627 03065000
         IC    @10,ANWIDE(,DACAD)                                  0627 03066000
         ALR   @12,@10                                             0627 03067000
         SLR   @10,@10                                             0627 03068000
         IC    @10,DSWIDE(,DACAD)                                  0627 03069000
         SLR   @12,@10                                             0627 03070000
         LR    SOURAD,@12                                          0627 03071000
*                     CURLIN = CURLIN + 1;                         0628 03072000
         AH    CURLIN,@CH00061                                     0628 03073000
*                     GO TO READ1;    /*GO SEE WHATS LEFT      */  0629 03074000
         B     READ1                                               0629 03075000
*                  END;                                            0630 03076000
*                ELSE;                                             0631 03077000
@RF00625 DS    0H                                                  0632 03078000
*           GO TO RDLAT;                                           0632 03079000
         B     RDLAT                                               0632 03080000
*           GEN;                                                   0633 03081000
         EJECT                                                          03082000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0634 03083000
*/*     PRECEDING CODE -                                       */  0634 03084000
*/*RDSOM:        P INCREMENT SOURAD BY ONE                     */  0634 03085000
*/*RDSMI:        D (NO,%GO012,YES,) IS RMTDV ON ?              */  0634 03086000
*/*              P (,%GO013) SET SINKAD TO DACSINAD PLUS TWO   */  0634 03087000
*/*%GO012:       P SET SINK TO DACSINAD                        */  0634 03088000
*/*%GO013:       P BUMP SOURCE                                 */  0634 03089000
*/*DATLNTST:     P LINGRO = REMAINING DATA, RESTORE SOMADD     */  0634 03090000
*/*              D (NO,RDLAT,YES,MORTST) LINGRO = ZERO ?       */  0634 03091000
*/*RDEOM:        P (,DATLNTST) PUT EOM IN SINK, BUMP SINK          0634 03092000
*/*                AND SOURCE                                  */  0634 03093000
*/*RDFLDMK:      P PUT NL IN SINK, BUMP SINK AND SOURCE        */  0634 03094000
*/*              D (YES,DATLNTST,NO,) DATA REMAINING = ZERO ?  */  0634 03095000
*/*              D (YES,DATLNTST,NO,) RVOID = YES SPECIFIED ?  */  0634 03096000
*/*              P INCREMENT CURLIN                            */  0634 03097000
*/*              D (NO,RAPON,YES,) ARE IN FIRST 2260 LINE ?    */  0634 03098000
*/*              P CALCULATE COUNT TO BE SKIPPED               */  0634 03099000
*/*              P DECREMENT REMAINING COUNT BY COUNT TO BE        0634 03100000
*/*                SKIPPED                                     */  0634 03101000
*/*              P LINGRO = REMAINDER                          */  0634 03102000
*/*              P (,DATLNTST) SET SOURAD TO POINT TO FIRST        0634 03103000
*/*                CHARACTER OF NEXT LINE                      */  0634 03104000
*/*RAPON:        P CALCULATE DIFFERENCE FROM FIRST LINE BOUNDRY    0634 03105000
*/*                TO FM                                       */  0634 03106000
*/*              P DIVIDE IT BY THE 2260 WIDTH, SPECAR =           0634 03107000
*/*                QUOTIENT                                    */  0634 03108000
*/*              P LINGRO = THE REMAINDER                      */  0634 03109000
*/*LINBOUND:     P POINT SOURAD TO BEGINNING OF NEXT LINE      */  0634 03110000
*/*              P (,DATLNTST) SET CURLIN TO ONE PAST SPECAR,      0634 03111000
*/*                SOMADD TO REMAINING DATA PORTION            */  0634 03112000
*/*RDETX:        D (YES,READOUT,NO,%GO015) IS RMTDV ON ?       */  0634 03113000
*/*%GO015:       P (,BACKGO) RESET SOURCE, SINK TO BEGINNING   */  0634 03114000
*/*RDBSOM:       P BUMP SOURCE                                 */  0634 03115000
*/*RDBSMI:       P (,INCREM) PUT SOM IN SINK                   */  0634 03116000
*/*RDBEOM:       P (,INCREM) PUT EOM IN SINK, BUMP SOURCE      */  0634 03117000
*/*RDBFM:        P (,INCREM) PUT NL IN SINK                    */  0634 03118000
*/*RDNULL:       P PUT A BLANK IN SINK                         */  0634 03119000
*/*              D (YES,INCREM,NO,DATLNTST) READ BUFFER ?      */  0634 03120000
*/*INCREM:       P BUMP SINK, SOURCE, LINGRO = SOMADD, RESTORE     0634 03121000
*/*                SOMADD                                      */  0634 03122000
*/*              D (YES,,NO,RDLAT) IS LINGRO = ZERO ?          */  0634 03123000
*/*              P (,READ1) SOURAD TO BEGINNING OF NEXT LINE,      0634 03124000
*/*                BUMP CURLIN                                 */  0634 03125000
*        GEN;                                                      0634 03126000
         EJECT                                                          03127000
*/**************************************************************/  0635 03128000
*/**************************************************************/  0635 03129000
*/*                                                            */  0635 03130000
*/* INVERT ROUTINE TO CONVERT INCOMING ADDRESSES TO HEX        */  0635 03131000
*/*     INVERT IS USED BY VIRTUALLY ALL PHASES OF THE READ     */  0635 03132000
*/*     DATA STREAM PROCESSING TO CONVERT 3270 ADDRESSES TO    */  0635 03133000
*/*     HEXADECIMAL. NORMAL ENTRY IS VIA A BRANCH AND LINK     */  0635 03134000
*/*     ON REGISTER CARADD. RETURN IS VIA A BRANCH REGISTER    */  0635 03135000
*/*     CARADD.                                                */  0635 03136000
*/*                                                            */  0635 03137000
*/**************************************************************/  0635 03138000
*/**************************************************************/  0635 03139000
*INVERT:  GEN SETS(SPECAR,CURSAD) REFS(MASK,SINKAD,CARADD) ; /*Y02947*/ 03140000
INVERT   DS    0H                                                  0635 03141000
         SLDL  SPECAR,24                                                03142000
         SRL   CURSAD,24                                                03143000
         N     SPECAR,MASK                                              03144000
         N     CURSAD,MASK                                              03145000
         SLL   SPECAR,6                                                 03146000
         AR    SPECAR,CURSAD                                            03147000
         STC   SPECAR,1(SINKAD)                                         03148000
         SRL   SPECAR,8                                                 03149000
         STC   SPECAR,0(SINKAD)                                         03150000
         IC    CURSAD,0(SINKAD)                                         03151000
         SLL   CURSAD,8                                                 03152000
         IC    CURSAD,1(SINKAD)                                         03153000
         BR    CARADD                                                   03154000
*           GEN;                                                   0636 03155000
         EJECT                                                          03156000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0637 03157000
*/*     PRECEDING CODE -                                       */  0637 03158000
*/*INVERT: CHART                                               */  0637 03159000
*/* HEADER                                                         0637 03160000
*/*        SCAN - CONVERSION OF INCOMING 3270 BUFFER ADDRESSES TO HEX   03161000
*/*                                            PAGE #          */  0637 03162000
*/*INVERT:       E READ ADDRESS CONVERSION                     */  0637 03163000
*/*              P CONVERT 3270 TO HEX                         */  0637 03164000
*/*              R BR CARADD                                   */  0637 03165000
*/*INVERT: END                                                 */  0637 03166000
*           GEN;                                                   0637 03167000
         EJECT                                                          03168000
*/**************************************************************/  0638 03169000
*/**************************************************************/  0638 03170000
*/*                                                            */  0638 03171000
*/* OUTVERT ROUTINE TO CONVERT OUTGOING ADDRESSES TO 3270      */  0638 03172000
*/*     OUTVERT IS USED BY VIRTUALLY ALL PHASES OF THE WRITE   */  0638 03173000
*/*     DATA STREAM PROCESSING TO CONVERT HEXADECIMAL          */  0638 03174000
*/*     ADDRESSES TO 3270. NORMAL ENTRY IS VIA A BRANCH AND    */  0638 03175000
*/*     LINK ON REGISTER CARADD. RETURN IS VIA A BRANCH        */  0638 03176000
*/*     REGISTER CARADD.                                       */  0638 03177000
*/*                                                            */  0638 03178000
*/**************************************************************/  0638 03179000
*/**************************************************************/  0638 03180000
*OUTVERT:   GEN SETS(SINK,CURSAD,SINKAD) REFS(CARADD) ;   /*Y02947*/    03181000
OUTVERT  DS    0H                                                  0638 03182000
         STC   CURSAD,2(SINKAD)                                         03183000
         SRL   CURSAD,8                                                 03184000
         STC   CURSAD,3(SINKAD)                                         03185000
         SLL   CURSAD,8                                                 03186000
         IC    CURSAD,2(SINKAD)                                         03187000
         STC   CURSAD,1(SINKAD)                                         03188000
         NI    1(SINKAD),X'3F'                                          03189000
         SRL   CURSAD,6                                                 03190000
         STC   CURSAD,0(SINKAD)                                         03191000
         NI    0(SINKAD),X'1F'                                          03192000
         TR    0(2,SINKAD),ADDRTAB                                      03193000
         IC    CURSAD,3(SINKAD)                                         03194000
         SLL   CURSAD,8                                                 03195000
         IC    CURSAD,2(SINKAD)                                         03196000
         LA    SINKAD,2(SINKAD)                                         03197000
         BR    CARADD                                                   03198000
*           GEN;                                                   0639 03199000
         EJECT                                                          03200000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0640 03201000
*/*     PRECEDING CODE -                                       */  0640 03202000
*/*OUTVERT: CHART                                              */  0640 03203000
*/* HEADER                                                         0640 03204000
*/*        SCAN - CONVERSION OF OUTGOING ADDRESSES TO 3270 BUFFER  0640 03205000
*/*                                            PAGE #          */  0640 03206000
*/*OUTVERT:      E WRITE ADDRESS CONVERSION                    */  0640 03207000
*/*              P CONVERT HEX TO 3270, USING ADDRTAB          */  0640 03208000
*/*              P BUMP SINK POINTER BY TWO                    */  0640 03209000
*/*              R BR CARADD                                   */  0640 03210000
*/*OUTVERT: END                                                */  0640 03211000
*        GEN;                                                      0640 03212000
         EJECT                                                          03213000
*/**************************************************************/  0641 03214000
*/**************************************************************/  0641 03215000
*/* XLATE TRANSLATE AND TEST INSTRUCTION, MOVE CHARACTERS      */  0641 03216000
*/*     INSTRUCTION                                            */  0641 03217000
*/*     THESE INSTRUCTIONS ARE UTILIZED VIA EXECUTE            */  0641 03218000
*/*     INSTRUCTIONS AT VARIOUS POINTS THROUGH SCAN. THE       */  0641 03219000
*/*     TRT TRANSLATES SOME PORTION OF THE SOURCE AGAINST      */  0641 03220000
*/*     'TABLE'. THE MVC MOVES SOME PORTION OF THE SOURCE      */  0641 03221000
*/*     INTO THE SINK.                                         */  0641 03222000
*/*                                                            */  0641 03223000
*/**************************************************************/  0641 03224000
*/**************************************************************/  0641 03225000
*XLATE:     GEN;                                                   0641 03226000
XLATE    DS    0H                                                  0641 03227000
         TRT   0(1,SOURAD),TABLE                                        03228000
*MYMOV:;                                                           0642 03229000
MYMOV    DS    0H                                                  0643 03230000
*           GEN;                                                   0643 03231000
         MVC   0(1,SINKAD),0(SOURAD)                                    03232000
*           GEN;                                                   0644 03233000
         EJECT                                                          03234000
*/**************************************************************/  0645 03235000
*/**************************************************************/  0645 03236000
*/*                                                            */  0645 03237000
*/* OUTPROC THE VARIOUS EXITS FROM SCAN                        */  0645 03238000
*/*     OUTPROC IS ACTUALY A COLLECTION OF CONDITION RETURN    */  0645 03239000
*/*     PROCESSORS. EACH MAY PERFORM SOME SPECIAL FUNCTION,    */  0645 03240000
*/*     THEN WILL LOAD REGISTER 15 WITH X'10' (16) AND BRANCH  */  0645 03241000
*/*     TO THE POINT IN GOBACK WHICH WILL LEAVE THE REQUIRED   */  0645 03242000
*/*     RETURN CODE IN REGISTER 15. EACH SUCCESSIVE STEP       */  0645 03243000
*/*     THROUGH GOBACK DECREMENTS REGISTER 15 BY FOUR. HENCE,  */  0645 03244000
*/*     FOR RETURN CODE OF 0, A BRANCH TO GOBACK00 IS          */  0645 03245000
*/*     REQUIRED, OF 4, A BRANCH TO GOBACK04, ETC. THE         */  0645 03246000
*/*     CURSOR IS SAVED IN DACCRS ONLY FOR GOBACK00. THE       */  0645 03247000
*/*     LENGTH OF SINK IS CALCULATED IN GOBACK08, SO GOBACK00  */  0645 03248000
*/*     AND GOBACK04 ALSO RESULT IN SINK LENGTH BEING PASSED   */  0645 03249000
*/*     IN REGISTER 0. THE DACFLG IS CLEARED EXCEPT FOR        */  0645 03250000
*/*     BITS 0 AND 1 FOR ALL EXITS. DACIND IS CLEARED FOR      */  0645 03251000
*/*     ALL EXITS.                                             */  0645 03252000
*/*                                                            */  0645 03253000
*/*       OUTNORM CHECKS FOR THE NO SMI BIT IN DACFLG AND IF   */  0645 03254000
*/*     ON BRANCHES TO OUTNSMI. IF THIS IS A WRITE AND THE     */  0645 03255000
*/*     SOM HERE BIT IN DACFLG IS ON, OUTNORM SAVES THE SOM    */  0645 03256000
*/*     ADDRESS IN DACSOMAD. IF SOM HERE IS OFF OUTNORM        */  0645 03257000
*/*     CHECKS THE SHORT READ FLAG. IF THE SHORT READ FLAG     */  0645 03258000
*/*     IF OFF, A HALFWORD OF ONES IS STORED IN DACSOMAD.      */  0645 03259000
*/*     OTHERWISE DACSOMAD IS NOT ALTERED. LOADS REG 15 WITH   */  0645 03260000
*/*     16 AND BRANCHES TO GOBACK00.                           */  0645 03261000
*/*                                                            */  0645 03262000
*/*       OUTSPEC LOADS REG 15 WITH 16 AND BRANCHES TO         */  0645 03263000
*/*     GOBACK04.                                              */  0645 03264000
*/*                                                            */  0645 03265000
*/*       OUTSINK LOADS REG 15 WITH 16 AND BRANCHES TO         */  0645 03266000
*/*     GOBACK08.                                              */  0645 03267000
*/*                                                            */  0645 03268000
*/*       OUTNSMI LOADS REG 15 WITH 16 AND BRANCHES TO         */  0645 03269000
*/*     GOBACK0C.                                              */  0645 03270000
*/*                                                            */  0645 03271000
*/*       OUTERR LOADS REG 15 WITH 16 AND BRANCHES TO          */  0645 03272000
*/*     GOBACK10.                                              */  0645 03273000
*/*                                                            */  0645 03274000
*/**************************************************************/  0645 03275000
*/**************************************************************/  0645 03276000
*/**************************************************************/  0645 03277000
*/*                                                            */  0645 03278000
*/* OUTNORM    FROM      SETPROT, OUTTST                       */  0645 03279000
*/*      NORMAL EXIT FROM SCAN                                 */  0645 03280000
*/**************************************************************/  0645 03281000
*OUTNORM:;                                                         0645 03282000
OUTNORM  DS    0H                                                  0646 03283000
*           IF NOSMI = '1'B                                        0646 03284000
*                THEN GO TO OUTNSMI;                               0646 03285000
         TM    NOSMI(DACAD),B'00000100'                            0646 03286000
         BO    @RT00646                                            0646 03287000
*                ELSE;                                             0648 03288000
*           IF WRCRS = '1'B           /*IF THIS IS A WRITE     */  0649 03289000
*           | WRLA = '1'B             /*OPERATION - CHECK      */  0649 03290000
*           | EWR = '1'B              /*TO SEE IF AN SOM       */  0649 03291000
*                THEN                                              0649 03292000
         TM    WRCRS(DACAD),B'00111000'                            0649 03293000
         BZ    @RF00649                                            0649 03294000
*                  DO;                                             0650 03295000
*                     IF SOMHER = '1'B                             0651 03296000
*                          THEN                                    0651 03297000
         TM    SOMHER(DACAD),B'00001000'                           0651 03298000
         BNO   @RF00651                                            0651 03299000
*                            DO;                                   0652 03300000
*                               GEN SETS(DACSOMAD) REFS(SOMADD,DACAD)   03301000
*                                ; /*Y02947*/                      0653 03302000
         STH   SOMADD,DACSOMAD(DACAD)                                   03303000
*                            END;                                  0654 03304000
*                          ELSE                                    0655 03305000
*                            DO;                                   0655 03306000
         B     @RC00651                                            0655 03307000
@RF00651 DS    0H                                                  0656 03308000
*                               IF SHRD = '1'B                     0656 03309000
*                                   THEN;                          0656 03310000
         TM    SHRD(DACAD),B'01000000'                             0656 03311000
         BO    @RT00656                                            0656 03312000
*                                   ELSE DACSOMAD = ALLONE;        0658 03313000
         MVC   DACSOMAD(2,DACAD),ALLONE                            0658 03314000
*                            END;                                  0659 03315000
*                  END;                                            0660 03316000
*                ELSE;                                             0661 03317000
@RF00649 DS    0H                                                  0662 03318000
*           GEN;                                                   0662 03319000
@RC00649 DS    0H                                                  0662 03320000
         LA    WORKREG3,RETCONST                                        03321000
*           GO TO GOBACK00;                                        0663 03322000
         B     GOBACK00                                            0663 03323000
*/**************************************************************/  0664 03324000
*/*                                                            */  0664 03325000
*/* OUTSPEC    FROM      READ                                  */  0664 03326000
*/*      EXIT FOR PA1,2,3 AND CLEAR AID RECIEVED               */  0664 03327000
*/**************************************************************/  0664 03328000
*OUTSPEC:   GEN;                                                   0664 03329000
OUTSPEC  DS    0H                                                  0664 03330000
         LA    WORKREG3,RETCONST                                        03331000
*           GO TO GOBACK04;                                        0665 03332000
         B     GOBACK04                                            0665 03333000
*/**************************************************************/  0666 03334000
*/*                                                            */  0666 03335000
*/* OUTSINK    FROM      WITCH1, WIT, SETPROT, READ, RDLAT,    */  0666 03336000
*/*                      RDMOV                                 */  0666 03337000
*/*      EXIT FOR EXPIRATION OF SINK                           */  0666 03338000
*/**************************************************************/  0666 03339000
*OUTSINK:   GEN;                                                   0666 03340000
OUTSINK  DS    0H                                                  0666 03341000
         LA    WORKREG3,RETCONST                                        03342000
*           GO TO GOBACK08;                                        0667 03343000
         B     GOBACK08                                            0667 03344000
*/**************************************************************/  0668 03345000
*/*                                                            */  0668 03346000
*/* OUTNSMI    FROM      OUTNORM                               */  0668 03347000
*/*      EXIT FOR NO START OF MESSAGE FOUND                    */  0668 03348000
*/**************************************************************/  0668 03349000
*OUTNSMI:;                                                         0668 03350000
OUTNSMI  DS    0H                                                  0669 03351000
*           GEN;                                                   0669 03352000
         LA    WORKREG3,RETCONST                                        03353000
*           GO TO GOBACK0C;                                        0670 03354000
         B     GOBACK0C                                            0670 03355000
*/**************************************************************/  0671 03356000
*/*                                                            */  0671 03357000
*/* OUTERR     FROM      READ                                  */  0671 03358000
*/*      EXIT FOR SOH ERROR OR TEST REQUEST DETECTED           */  0671 03359000
*/**************************************************************/  0671 03360000
*OUTERR:;                                                          0671 03361000
OUTERR   DS    0H                                                  0672 03362000
*           GEN;                                                   0672 03363000
         LA    WORKREG3,RETCONST                                        03364000
*           GO TO GOBACK10;                                        0673 03365000
         B     GOBACK10                                            0673 03366000
*OUTCURS:;                                                         0674 03367000
OUTCURS  DS    0H                                                  0675 03368000
*           GEN;                                                   0675 03369000
         LA    WORKREG3,RETCONST                                        03370000
*           GO TO GOBACK14;                                        0676 03371000
         B     GOBACK14                                            0676 03372000
*/**************************************************************/  0677 03373000
*/*                                                            */  0677 03374000
*/* GOBACK00   FROM      OUTNORM                               */  0677 03375000
*/*      SET UP RETURN CODE 0                                  */  0677 03376000
*/**************************************************************/  0677 03377000
*GOBACK00:;                                                        0677 03378000
GOBACK00 DS    0H                                                  0678 03379000
*           GEN;                                                   0678 03380000
         SH    WORKREG3,HAF4                                            03381000
*/**************************************************************/  0679 03382000
*/*                                                            */  0679 03383000
*/* GOBACK04   FROM      OUTSPEC                               */  0679 03384000
*/*      SET UP RETURN CODE 4                                  */  0679 03385000
*/**************************************************************/  0679 03386000
*GOBACK04:;                                                        0679 03387000
GOBACK04 DS    0H                                                  0680 03388000
*           GEN;                                                   0680 03389000
         SH    WORKREG3,HAF4                                            03390000
*/**************************************************************/  0681 03391000
*/*                                                            */  0681 03392000
*/* GOBACK08   FROM      OUTSINK                               */  0681 03393000
*/*      SET UP RETURN CODE 8                                  */  0681 03394000
*/**************************************************************/  0681 03395000
*GOBACK08:;                                                        0681 03396000
GOBACK08 DS    0H                                                  0682 03397000
*           GEN SETS(REG0,WORKREG3) REFS(SINKAD,DACSINAD,DACAD,HAF4)    03398000
*                SEQFLOW  ;                      /*Y02947*/        0682 03399000
         LR    REG0,SINKAD                                              03400000
         S     REG0,DACSINAD(DACAD)                                     03401000
         SH    WORKREG3,HAF4                                            03402000
*/**************************************************************/  0683 03403000
*/*                                                            */  0683 03404000
*/* GOBACK0C   FROM      OUTNSMI                               */  0683 03405000
*/*      SET UP RETURN CODE 12                                 */  0683 03406000
*/**************************************************************/  0683 03407000
*GOBACK0C:;                                                        0683 03408000
GOBACK0C DS    0H                                                  0684 03409000
*           GEN;                                                   0684 03410000
         SH    WORKREG3,HAF4                                            03411000
*/**************************************************************/  0685 03412000
*/*                                                            */  0685 03413000
*/* GOBACK10   FROM      OUTERR                                */  0685 03414000
*/*      SET UP RETURN CODE 16                                 */  0685 03415000
*/**************************************************************/  0685 03416000
*GOBACK10:;                                                        0685 03417000
GOBACK10 DS    0H                                                  0686 03418000
*           GEN;                                                   0686 03419000
         SH    WORKREG3,HAF4                                            03420000
*GOBACK14:;                                                        0687 03421000
GOBACK14 DS    0H                                                  0688 03422000
*           GEN SETS(DACFLG,SHRD,DACIND) REFS(DACAD) ; /*Y02947*/  0688 03423000
         NI    DACFLG(DACAD),X'40'                                      03424000
         NI    DACIND(DACAD),X'00'                                      03425000
*           RETURN;                                                0689 03426000
@EL00001 DS    0H                                                  0689 03427000
@EF00001 DS    0H                                                  0689 03428000
@ER00001 L     @14,12(,@13)                                        0689 03429000
         LM    @01,@12,24(@13)                                     0689 03430000
         BR    @14                                                 0689 03431000
*           GEN;                                                   0690 03432000
         EJECT                                                          03433000
*/*     FOLLOWING ARE THE FLOWCHARTING STATEMENTS FOR THE      */  0691 03434000
*/*     PRECEDING CODE -                                       */  0691 03435000
*/*IECTSCAN: CHART                                             */  0691 03436000
*/*OUTNORM:      D (YES,OUTNSMI,NO,) IS NSMI ON ?              */  0691 03437000
*/*              D (YES,,NO,%GO020) IS THIS A WRITE ?          */  0691 03438000
*/*              D (YES,,NO,%GO019) IS SOMHER ON ?             */  0691 03439000
*/*              P (,%GO020) STORE THE SOM ADDRESS IN DACSOMAD */  0691 03440000
*/*%GO019:       D (YES,%GO020,NO,) IS SHRD ON ?               */  0691 03441000
*/*              P SET DACSOMAD TO X'FFFF'                     */  0691 03442000
*/*%GO020:       P (,GOBACK00) PUT RETCONST IN REG 15          */  0691 03443000
*/*OUTSPEC:      P (,GOBACK04) PUT RETCONST IN REG 15          */  0691 03444000
*/*OUTSINK:      P (,GOBACK08) PUT RETCONST IN REG 15          */  0691 03445000
*/*OUTNSMI:      P (,GOBACK0C) PUT RETCONST IN REG 15          */  0691 03446000
*/*OUTERR:       P (,GOBACK10) PUT RETCONST IN REG 15          */  0691 03447000
*/*OUTCURS:      P (,GOBACK14) PUT RETCONST IN REG 15          */  0691 03448000
*/*GOBACK00:     P STORE CURSOR IN DACCRS, DECREMENT 15 BY FOUR*/  0691 03449000
*/*GOBACK04:     P DECREMENT 15 BY FOUR                        */  0691 03450000
*/*GOBACK08:     P SET REG 0 TO SINK USED, DECREMENT 15 BY FOUR*/  0691 03451000
*/*GOBACK0C:     P DECREMENT 15 BY FOUR                        */  0691 03452000
*/*GOBACK10:     P DECREMENT 15 BY FOUR                        */  0691 03453000
*/*GOBACK14:     P TURN OFF ALL FLAGS BUT PRIEN, SHRD          */  0691 03454000
*/*              R RETURN TO CALLER                            */  0691 03455000
*/*IECTSCAN: END                                               */  0691 03456000
*           GEN;                                                   0691 03457000
RETCONST EQU   20                                                       03458000
*              1 LINE DELETED                                    Y02947 03459000
*        END;                                                      0692 03460000
         B     @EL00001                                            0692 03461000
@DATA    DS    0H                                                       03462000
@CH00061 DC    H'1'                                                     03463000
@CH00059 DC    H'2'                                                     03464000
@CH00102 DC    H'3'                                                     03465000
@CH00283 DC    H'6'                                                     03466000
@DATD    DSECT                                                          03467000
         DS    0F                                                       03468000
IECTSCAN CSECT                                                          03469000
         DS    0F                                                       03470000
@DATD    DSECT                                                          03471000
         DS    0D                                                       03472000
@ENDDATD EQU   *                                                        03473000
IECTSCAN CSECT                                                          03474000
         NOPR  ((@ENDDATD-@DATD)*16)                                    03475000
         DS    0F                                                       03476000
@SIZDATD DC    AL1(0)                                                   03477000
         DC    AL3(@ENDDATD-@DATD)                                      03478000
         DS    0D                                                       03479000
DUM      DC    XL4'5B7B4B00'                                            03480000
FULL0    DC    XL4'00000000'                                            03481000
ONE      DC    XL4'00000001'                                            03482000
MASK     DC    XL4'0000003F'                                            03483000
ALLONE   DC    XL2'FFFF'                                                03484000
HAF0     DC    XL2'0000'                                                03485000
HAF3     DC    XL2'0003'                                                03486000
HAF4     DC    XL2'0004'                                                03487000
ADDRTAB  DS    CL64                                                     03488000
         ORG   ADDRTAB                                                  03489000
BLNK     DC    X'40'                                                    03490000
@NM00009 DC    X'C1C2C3C4C5C6C7C8C94A4B4C4D4E4F'                        03491000
@NM00010 DC    X'50D1D2D3D4D5D6D7D8D95A5B5C5D5E5F'                      03492000
@NM00011 DC    X'6061E2E3E4E5E6E7E8E96A6B6C6D6E6F'                      03493000
@NM00012 DC    X'F0F1F2F3F4F5F6F7F8F97A7B7C7D7E7F'                      03494000
         ORG   ADDRTAB+64                                               03495000
TABLE    DS    CL256                                                    03496000
         ORG   TABLE                                                    03497000
@NM00013 DC    X'01000007000000000000040000000000'                      03498000
@NM00014 DC    X'00000000000200000000000000080300'                      03499000
@NM00015 DC    X'00000000000007000000000000000000'                      03500000
@NM00016 DC    X'00000000000000000000000000000000'                      03501000
@NM00017 DC    X'00000000000000000000040000000000'                      03502000
@NM00018 DC    X'00000000000000000000050000000000'                      03503000
@NM00019 DC    X'00000000000000000000060000000000'                      03504000
@NM00020 DC    X'00000000000000000000000000000000'                      03505000
@NM00021 DC    X'00000000000000000000000000000000'                      03506000
@NM00022 DC    X'00000000000000000000000000000000'                      03507000
@NM00023 DC    X'00000000000000000000000000000000'                      03508000
@NM00024 DC    X'00000000000000000000000000000000'                      03509000
@NM00025 DC    X'00000000000000000000000000000000'                      03510000
@NM00026 DC    X'00000000000000000000000000000000'                      03511000
@NM00027 DC    X'00000000000000000000000000000000'                      03512000
@NM00028 DC    X'00000000000000000000000000000000'                      03513000
         ORG   TABLE+256                                                03514000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       03515000
@01      EQU   01                                                       03516000
@02      EQU   02                                                       03517000
@03      EQU   03                                                       03518000
@04      EQU   04                                                       03519000
@05      EQU   05                                                       03520000
@06      EQU   06                                                       03521000
@07      EQU   07                                                       03522000
@08      EQU   08                                                       03523000
@09      EQU   09                                                       03524000
@10      EQU   10                                                       03525000
@11      EQU   11                                                       03526000
@12      EQU   12                                                       03527000
@13      EQU   13                                                       03528000
@14      EQU   14                                                       03529000
@15      EQU   15                                                       03530000
DACAD    EQU   @09                                                      03531000
SOMADD   EQU   @08                                                      03532000
CURLIN   EQU   @07                                                      03533000
SOURAD   EQU   @06                                                      03534000
SINKAD   EQU   @05                                                      03535000
LINGRO   EQU   @04                                                      03536000
CURSAD   EQU   @03                                                      03537000
SPECAR   EQU   @02                                                      03538000
CARADD   EQU   @01                                                      03539000
REG0     EQU   @00                                                      03540000
WORKREG1 EQU   @10                                                      03541000
WORKREG2 EQU   @12                                                      03542000
WORKREG3 EQU   @15                                                      03543000
WORKREG4 EQU   @14                                                      03544000
DACA     EQU   0                                                        03545000
DACCRS   EQU   DACA                                                     03546000
DACSOMAD EQU   DACA+2                                                   03547000
DACSRCAD EQU   DACA+4                                                   03548000
DACSINAD EQU   DACA+8                                                   03549000
DACSRCLN EQU   DACA+12                                                  03550000
DACSINLN EQU   DACA+14                                                  03551000
DACDSSCR EQU   DACA+16                                                  03552000
DSLINE   EQU   DACDSSCR                                                 03553000
DSWIDE   EQU   DACDSSCR+1                                               03554000
DACANSCR EQU   DACA+18                                                  03555000
ANLINE   EQU   DACANSCR                                                 03556000
ANWIDE   EQU   DACANSCR+1                                               03557000
DACDSAD  EQU   DACA+20                                                  03558000
DACOPTYP EQU   DACA+21                                                  03559000
RVOID    EQU   DACOPTYP                                                 03560000
PROT     EQU   DACOPTYP                                                 03561000
WRCRS    EQU   DACOPTYP                                                 03562000
WRLA     EQU   DACOPTYP                                                 03563000
EWR      EQU   DACOPTYP                                                 03564000
RDMI     EQU   DACOPTYP                                                 03565000
RDBUF    EQU   DACOPTYP                                                 03566000
DACFLG   EQU   DACA+22                                                  03567000
BLAT     EQU   DACFLG                                                   03568000
SHRD     EQU   DACFLG                                                   03569000
SOMP     EQU   DACFLG                                                   03570000
LNGDT    EQU   DACFLG                                                   03571000
SOMHER   EQU   DACFLG                                                   03572000
NOSMI    EQU   DACFLG                                                   03573000
STXHER   EQU   DACFLG                                                   03574000
RMTDV    EQU   DACFLG                                                   03575000
DACIND   EQU   DACA+23                                                  03576000
SOURCE   EQU   0                                                        03577000
SINK     EQU   0                                                        03578000
WCCTAB   EQU   DUM                                                      03579000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    03580000
NNAME    EQU   SINK                                                     03581000
NONAME   EQU   SOURCE                                                   03582000
@NM00008 EQU   DACIND                                                   03583000
@NM00007 EQU   DACIND                                                   03584000
@NM00006 EQU   DACIND                                                   03585000
@NM00005 EQU   DACIND                                                   03586000
@NM00004 EQU   DACIND                                                   03587000
@NM00003 EQU   DACIND                                                   03588000
@NM00002 EQU   DACIND                                                   03589000
@NM00001 EQU   DACIND                                                   03590000
SRDMI    EQU   DACOPTYP                                                 03591000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      03592000
@RF00038 EQU   STXPLUG                                                  03593000
@RT00072 EQU   WRITENT                                                  03594000
@RT00094 EQU   REMTEWR                                                  03595000
@RT00141 EQU   OUTERR                                                   03596000
@RT00158 EQU   WRTEND                                                   03597000
@RT00163 EQU   OUTSINK                                                  03598000
@RT00190 EQU   WALL                                                     03599000
@RC00211 EQU   WITCH1                                                   03600000
@RT00239 EQU   WITCH4                                                   03601000
@RF00239 EQU   WITCH3                                                   03602000
@RF00218 EQU   WALL2                                                    03603000
@RT00256 EQU   ENDSCRN                                                  03604000
@RT00270 EQU   WRTNEW2                                                  03605000
@RT00278 EQU   SETTLE1                                                  03606000
@RT00283 EQU   WRTNEW1                                                  03607000
@RT00335 EQU   WRTDONE                                                  03608000
@RF00335 EQU   WITCH2                                                   03609000
@RT00340 EQU   WRTDONE                                                  03610000
@RF00340 EQU   WITCH1                                                   03611000
@RT00345 EQU   OUTSINK                                                  03612000
@RC00361 EQU   @RC00358                                                 03613000
@RT00412 EQU   SETPROT                                                  03614000
@RT00438 EQU   OUTNORM                                                  03615000
@RT00449 EQU   OUTERR                                                   03616000
@RC00462 EQU   OUTSPEC                                                  03617000
@RT00481 EQU   READOUT                                                  03618000
@RF00481 EQU   RDLAT                                                    03619000
@RT00536 EQU   OUTSINK                                                  03620000
@RT00552 EQU   READOUT                                                  03621000
@RT00576 EQU   MORTST                                                   03622000
@RF00576 EQU   RDLAT                                                    03623000
@RT00596 EQU   READOUT                                                  03624000
@RT00617 EQU   INCREM                                                   03625000
@RF00617 EQU   DATLNTST                                                 03626000
@RT00646 EQU   OUTNSMI                                                  03627000
@RC00651 EQU   @RC00649                                                 03628000
@RT00656 EQU   @RC00649                                                 03629000
@ENDDATA EQU   *                                                        03630000
         END   IECTSCAN,(C'PLS1241',0701,77006)                         03631000
