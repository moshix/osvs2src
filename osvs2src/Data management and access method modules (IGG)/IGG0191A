191A TITLE  'IGG0191A -- VALIDITY CHECKING RTN FOR ACCESS METHODS'      00100000
IGG0191A CSECT                                                          00200020
*                                                                       00300020
*MODULE NAME - IGG0191A                                          Y02072 00350002
*                                                                       00360002
*DESCRIPTIVE NAME - FIRST LOAD OF THE OPEN EXECUTORS FOR SAM,    Y02072 00370002
*                   PAM, AND EXCP USERS                          Y02072 00372002
*                                                                       00380002
*COPYRIGHT - NONE                                                Y02072 00390002
*                                                                       00392002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00394002
*                                                                       00396002
*          VS1 RELEASE 2 DELETIONS                                      00398002
*D156000,156004-156148,234500-235000                            SA61537 00398402
*                                                                       00400020
*          VS2 RELEASE 2 DELETIONS                                      00450002
*012000,023000-023500,109000,110000,112000,113000-114000,115000, Y02072 00500002
*188000,189000,210600,211000,212000,213000-222000,234600,234800, Y02072 00550002
*234900,330100-339000,339500,489600-494000,499000390000,478000,  Y02072 00600002
*482000,505000,589000,261000-289000                              Y02072 00650002
*                                                                YM4640 00650102
*                                                                YM6578 00650202
*                                                                       00700203
*          VS2 RELEASE 3 DELETIONS                                      00700303
*          VS2 RELEASE 03 CHANGES/DELETIONS                             00750203
*                                                              @Z30TSMI 00752203
*A234984-234988                                                 ZA00631 00760203
*C246466,249046                                                 ZA00631 00770200
*A156886-156926,235728-235799,235933,235991-235995,237500       ZA00732 00772203
*C246540                                                        ZA00737 00774203
*A23599513,23599523                                            @ZA08893 00777237
*A23599113                                                     @ZA11099 00780237
*C235998                                                       @ZA16001 00786237
*A300575,300585                                                @ZA16001 00792237
*C23564020                                                     @ZA18297 00795237
*C300765                                                       @ZA20474 00797237
*A246726-246732                                                @ZAXXXXX 00798137
*D247344-247349                                                @ZAXXXXX 00799037
*          RELEASE 21 DELETIONS                                         00800020
*1394                                                            M1803  00800121
*1394                                                            A46863 00800421
*1394                                                            A44114 00800821
*1394075000,210600,215000,222000,230000-231000,233000,246050,    S21042 00801021
*1394247740,295000-297000,480000,499000,589000-590000            S21042 00802021
*D300000,330020                                                 SA53194 00805021
*1394                                                            M0062  00807021
*1394001000,010995,019000-022000,036000-105000,123000-127000,    A37507 00810021
*1394131000-140000,143000,146000,179000,246260,249046,266000,    A37507 00820021
*1394299000-454000,489000,497000                                 A37507 00830021
*1394246130,246672-246676                                        A42897 00850021
*1394348000-455000,496000-502000                                 M0091  00870021
*          RELEASE 20 DELETIONS                                         00900020
*    IGG0191A RESEQUENCED IN RELEASE 20                                 01000020
*0970246140                                                      M6478  01000220
*                                                                A38122 01000520
*0970298300-298600                                               M0693  01001020
*0970246340-246540                                               A34919 01002020
*0970                                                            A33682 01005020
*0970                                                            A34428 01010020
*0970                                                            S20038 01020020
*0970                                                            S20016 01050020
*0970105000                                                      A31590 01070020
*0970247000-248000,251000-254000                                 A31304 01080020
*0970233200-233600,246210-246910                                 M0639  01090020
*0970                                                            M0654  01095020
*0970249400                                                      M0678  01097020
*0970224000                                                      S20201 01097120
*0970118000-122000,124000-126000,129000-130000,132000-134000,    2670   01097320
*0970136000,138000-139000,141000,150500-151000,246340            2670   01097620
*0970249400                                                      M1506  01098020
*0970                                                            M2699  01099020
*                                                                M2882  01099620
*                                                                M3296  01099720
*0970                                                            M1565  01099820
*                                                                       01100020
*                                                                       01250002
*  CHANGES IDENTIFIED BY 'DM0D' IN COLUMNS 68-71 INSERTED          DM0D 01300020
*  IN SUPPORT OF CHECKPOINT/RESTART - RELEASE 17                   DM0D 01400020
*                                                                  DM0D 01500020
*  THIS MODULE WAS SPLIT INTO IGG0196A FOR RELEASE 19                   01600020
*  THIS MODULE WAS SPLIT AGAIN IN REL 21 INTO IGG0196I                  01630021
*  MOD FLOW  IGG0191A - IGG0196I - IGG0196A                             01660021
*                                                                       01700020
*FUNCTION  THIS EXECUTOR IS ENTERED FOR USERS OF SAM AND EXCP           01800020
*          DURING OPEN FOR VALIDITY CHECKING OF USER SPECIFIED          01820021
*          PARAMETERS WHEN CODING THE DCB.                              01840021
*          CONFLICTING DCB PARAMETERS:                                  01860021
*          - DCBMACRF OPPOSITE OF OPEN OPTION                           01880021
*          - IF USER SPECIFIED DCBBUFL & IT IS LESS THAN DCBBLKSI       01900021
*          - DCBBLKSI NOT AT LEAST 4 BYTES LARGER THAN DCBLRECL FOR     01920021
*            VARIABLE LENGTH RECORDS                                    01940021
*          - DCBBLKSI NOT EQUAL TO DCBLRECL FOR FIXED LEN DATA SETS     01960021
*            WHEN BOTH ARE SPECIFIED                                    01980021
*          - DCBBLKSI NOT SPECIFIED FOR FIXED LEN DATA SETS      A44114 01990021
*          - FOR QSAM FIXED BLOCKED DATA SETS:                          02000021
*            - DCBLRECL NOT SPECIFIED                                   02020021
*            - DCBBLKSI NOT MULT OF DCBLRECL                     Y02072 02040002
*            - DCBBLKSI LESS THAN LRECL FOR UNSPANNED RECORDS           02100002
*                                                                       02120021
*          TESTING IS DONE TO SEE IF MERLIN/ZEUS CAN BE SUPPORTED WHEN  02140021
*          SPECIFIED.                                                   02160021
*                                                                       02180021
*ENTRY POINT--IGG0191A                                                  02400020
*                                                                       02500020
*          ENTEREDFROM  IGG0190M   VIA XCTL                             02600020
*                        IGG0190P                                       02700020
*                                                                       02800020
*INPUT--  DCB ADDRESS                                                   02900020
*          WORK AREA ADDRESS                                            03000020
*          WHERE TO GO TABLE                                            03100020
*          PARAMETER LIST                                               03200020
*          CURRENT ENTRY IN WHERE TO GO TABLE                           03300020
*          CURRENT PARAMETER (DCB)                                      03400020
*                                                                       03500020
*EXITS - NORMAL XCTL TO IGG0196I TO CONTINUE PROCESSING                 05500021
*        ABNORMAL - XCTL TO PROB DET (IGG0196M) FOR WTP AND 013 ABEND   07500021
*                                                                       10600020
*TABLES/WORKAREA - SEE DSECTS AT END OF LISTING.                        10700020
*                                                                       10800020
*ATTRIBUTES- RE-ENTRANT- RE-USABLE- RUNS IN DATA MANAGEMENT KEY  Y02072 10900002
*            UNLESS OTHERWISE SPECIFIED, RUNS IN SUPER STATE     Y02072 10950002
*                                                                       11100020
*MACROS : MAPPING - IFEFUBOB, DCBD, CVT, IECDSECS                Y02072 11150002
*       : ACTION - DMABCOND, XCTL, MODESET                       Y02072 11200002
         EJECT                                                          11500002
*                                                                       11600020
* MASK'S TO TEST PARAMETER LIST WITH                                    11700020
COMMUTAB EQU   16                                                       12800020
BFTEKR   EQU   X'20'                    DCBBFTEK=R               S19015 14200020
RECFMB   EQU   X'10'                    BLOCKED RECORD FORMAT    S19015 14400020
*                                       BIT                      S19015 14500020
PS       EQU   X'40'               PHYSICAL SEQUENTIAL           I19119 14700020
EXCP     EQU   X'80'               EXCP                          I19119 14800020
BSAM     EQU   X'20'               BSAM                          I19119 14900020
QSAMBIT  EQU   X'01'               QSAM INDICATOR BIT            I19119 15000020
SYS      EQU   X'20'               SYSIN/SYSOUT                  I19119 15200020
OUTPUT   EQU   X'0F'               OUTPUT FLAG                   I19119 15300020
BLKSZMRG EQU   X'10'               BLOCKSIZE MERGE BIT IN        I19119 15400020
*                                       JFCBMASK+2               I19119 15500020
TIOTTERM EQU   X'20'                    DEVICE IS TERMINAL (TSO) S20016 15550020
UORVREC  EQU   X'40'                   RECFM UNDEFIN OR VARIABLE M0639  15570020
UREC     EQU   X'C0'               FORMAT U RECS                 2670   15580020
VREC     EQU   X'40'               FORMAT V RECS                 2670   15590020
MICR3890 EQU   X'16'                    3890 DEVICE TYPE        XL03123 15600102
SHIFTCON EQU   4                        SHIFT CONSTANT          XL03123 15610102
LRECLMIN EQU   12                       LRECL CONSTANT          XL03123 15612102
LRECLMAX EQU   48                       LRECL CONSTANT          XL03123 15614102
D0       EQU   0                        DISPLACEMENT OF ZERO     S20201 15615020
D6       EQU   6                        SIX BYTE DISPLACEMENT    S20201 15620020
SDOPT    EQU   X'04'                    SEARCH DIR MASK IN DCB   S20201 15625020
INOUTIN  EQU   X'03'                    MASK FOR OUTIN OR INOUT  S20201 15630020
NOTEPT   EQU   X'04'                    NOTE - POINT MASK        S20201 15635020
SAMPAM   EQU   X'42'                    SAM & PAM MASK           S20201 15640020
QSAM     EQU   X'40'                    QSAM GET BIT             S20201 15645020
SDFLAG   EQU   X'08'                    S.D. FLAG IN JFCB        S20201 15650020
PCI      EQU   X'20'                    PCI TEST MASK            S20201 15655020
TRKOVFLO EQU   X'20'                    TRK OVERFLO MASK         S20201 15660020
UTRKOVFL EQU   X'E0'                    U - TRK OVFLO MASK       S20201 15665020
FBTRKOV  EQU   X'B0'                    FB - TRK OVFLO MASK      S20201 15670020
FSTDREC  EQU   X'08'                    F STANDARD MASK          S20201 15675020
RDBACK   EQU   X'01'                    OPEN OPTION - READ BACK SA49404 15677002
OUTIN    EQU   X'07'                    OPEN OPTION - OUTPUT    SA48921 15679002
*                                         AND THEN INPUT        SA48921 15679802
UCBOCR85 EQU   X'1A'                    DEVICE ID FOR 1285 OCR   YM6578 15679902
UCBOCR88 EQU   X'1C'                    DEVICE ID FOR 1288 OCR   YM6578 15686602
SDOFF    EQU   X'F7'                    MASK USED TO TURN OFF   ZA00732 15688603
*                                       THE SEARCH DIRECT BIT   ZA00732 15690603
*                                       IN THE JFCB             ZA00732 15692603
*                                                                       15693302
*                                                                     * 15700020
******************************           ****************************** 15800020
*                                                                       15900020
*                                                                       16000020
*                                                                       16100020
*                                                                       16200020
*                                                                       16300020
*REGISTERS ARE REFERENCED SYMBOLICALLY WHERE APPROPRIATE                16400020
*                                                                       16500020
RDCB     EQU   2         DCB REGISTER                                   16600020
RBASE    EQU   3         BASE REGISTER                                  16700020
RCORE    EQU   4         WORK AREA ADDRESS                              16800020
RPAR     EQU   5         TOP OF PARAMETER LIST                          16900020
RWTG     EQU   6         TOP OF WTG TABLE                               17000020
RPARC    EQU   7         CURRENT PARAMETER                              17100020
RWTGC    EQU   8         CURRENT TRANS LOAD                             17200020
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    17300020
RWK1     EQU   RTIOT                    WORK REGISTER            Y02072 17350002
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       17400020
RDEB     EQU   11        DEB ADDRESS                                    17500020
RB       EQU   12        WORK REG1  **                                  17600020
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          17700020
RD       EQU   14        WORK REG3  **                                  17800020
RJ       EQU   15                       WORK REG4                M1803  17850021
RE       EQU   0         WORK REG5                                      18000020
R0       EQU   RE                       USED TO PASS INTERNAL   SA51107 18050002
*                                         CODE TO PROB DETER    SA51107 18060002
RF       EQU   1         WORK REG6                                      18100020
*                                                                       18200020
*                                                                       18300020
ASCII    EQU   X'08'                    ASCII TAPE               S20038 18350020
*                                                                       18400020
*********************************************************************** 18500020
*                                                                       18600020
*                                                                       18700020
OABD056  EQU   56                                                S21042 18710021
OABD057  EQU   57                                                S21042 18720021
OABD058  EQU   58                                                S21042 18730021
OABD072  EQU   72                                                S21042 18740021
OABD083  EQU   83                                                S21042 18750021
OABD114  EQU   114                      INTERNAL CODE 114       XL03123 18752002
OABD115  EQU   115                      INTERNAL CODE 115       XL03123 18754002
OABD117  EQU   117                      INTERNAL CODE 117       XL03123 18756002
VSRDBK   EQU   221                      ERROR CODE, VAR SPAN    SA49404 18760002
*                                         AND READ BACK         SA49404 18770002
OUTINOUT EQU   222                      ERROR CODE, OUTIN/INOUT SA51107 18780002
         EJECT                                                          18800002
         BALR  RBASE,0                                                  19000020
         USING PO,RBASE                                                 19100020
         USING IHADCB,RDCB                                              19200020
         USING FORCORE,RCORE                                            19300020
         USING DEB,RDEB                                                 19400020
         USING   TCB,RD                                                 19500020
         USING TIOT,RTIOT                                               19600020
         USING UCBOB,RUCB                                               19700020
*                                                                       19800020
*                                                                       19900020
*                                                                       20000020
*                                                                       20100020
PO       EQU   *                                                        20200020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 20200102
         DC    C'IGG0191A'              MODULE NAME              YM4640 20200202
         DC    C'@ZA20474'              LAST SHIP CODE         @Z30TSMI 20200337
         DC    C'&SYSDATE'              LAST SHIP DATE         @Z30TSMI 20220337
BEGIN    DS    0H                       END OF MODULE ID         YM4640 20280037
*                                                                       20300020
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 20400020
*   NEXT INSTRUCTION IS USED AS AN INLINE CONSTANT OF FOUR              20430021
FOUR     EQU   *+2                                               A37507 20460021
         L     RCORE,4(RWTGC)           GET WORK AREA                   20500020
*                                                                       20510002
*SET A BIT IN COMMON OPENS AUDIT TRAIL INDICATING TO FORCE       Y02072 20520002
*CLOSE AND PROBLEM DETERMINATION NOT TO REFRESH THE USERS DCB    Y02072 20530002
*FROM THE KEY 5 DCB BEFORE TAKING ANY USER EXITS.                Y02072 20540002
*                                                                       20542002
         OI    DXATCOM1,DXATREFR        DO NOT REFRESH DCB       Y02072 20544002
         SR    RWK1,RWK1                PREPARE TO ZERO FIELD    Y02072 20550002
         ST    RWK1,DXMSGADR            INDICATE MSG CSECT NOT   Y02072 20560002
*                                         LOADED                 Y02072 20570002
         L     RD,COMMUTAB         CALCULATE TCB ADDRESS                20600020
         L     RD,0(0,RD)                                               20700020
         L     RD,4(0,RD)               TCB  ADDR                       20800020
         L     RTIOT,TCBTIO                                             20900020
         AH    RTIOT,DCBTIOT       RESET TIOT POINTER                   21000020
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 21030020
         BO    GETUCBAD                 YES, BR AROUND LOADING   Y02072 21080002
*                                         THE UCB ADDRESS        Y02072 21130002
         L     RUCB,DXUCBADR            GET UCB ADDRESS          Y02072 21180002
GETUCBAD EQU   *                        TEST FOR INVALID PARMS   Y02072 21230002
         TM    DCBMACRF,EXCP            EXCP A. M.               A26010 22300020
         BO    NOSDIR                   YES                      S20201 22400020
         TM    0(RPARC),X'07'           DCB OPENED FOR INPUT,    A26010 22500020
*                                       RDBACK, INOUT, OR UPDAT         22600020
         BO    TSTWP                    NO, MUST BE OUTPUT OR    A26010 22700020
*                                       OUTIN                    A26010 22800020
         TM    DCBMACRF,X'60'           GET OR READ SPECIFIED    A26010 22900020
         BNZ   A26010A                  YES, CONTINUE            S21042 22960021
         LA    RE,OABD057               PUT INTERNAL CODE IN REG S21042 23020021
*                                       0                        S21042 23080021
         B     CALLPD                   CALL PROB DET            S21042 23140021
TSTWP    TM    DCBMACRF+1,X'60'         WRITE OR PUT SPECIFIED   A26010 23200020
         BNZ   TSTOCR                   YES, CONTINUE            YM5516 23240002
         LA    RE,OABD058               PUT INTERNAL CODE IN REG S21042 23280021
*                                       0                        S21042 23320021
         B     CALLPD                                            S21042 23360021
A26010A  EQU   *                                                 A26010 23400020
         TM    0(RPARC),RDBACK          BIT ON FOR READ BACK    SA49404 23410002
         BZ    TSTOCR                   NO, BYPASS VAR SPAN TST SA49404 23420002
         TM    0(RPARC),X'0F'-RDBACK    BITS OFF FOR READ BACK   YM5516 23430002
         BNZ   TSTOCR                   IF OFF, TEST FOR OCR     YM5516 23440002
         TM    DCBRECFM,DCBRECV+DCBRECSB  VAR SPANNED RECS      SA49404 23442002
         BNO   TSTOCR                   NO, BYPASS DMABCOND     SA49404 23444002
         LA    R0,VSRDBK                SET INTERNAL CODE       SA49404 23446002
         B     CALLPD                   GO TO PROB LDET RTN     SA49404 23448002
TSTOCR   EQU   *                                                SA61537 23498002
         TM    TIOELINK,TIOTTERM        IS THIS TSO             ZA00631 23498403
         BO    NOSDIR                   YES, BRANCH             ZA00631 23498803
         CLI   UCBTBYT4,UCBOCR85        IF LESS THAN X'1A', NOT  YM6578 23500002
*                                         AN OCR DEVICE         SA61537 23500402
         BL    TSTDSORG                 NOT AN OCR DEVICE       SA61537 23500802
         CLI   UCBTBYT4,UCBOCR88        IF HIGHER THAN X'1C',    YM6578 23501202
*                                         NOT AN OCR DEVICE     SA61537 23501602
         BNH   OCRQSAM                  YES, AN OCR DEVICE      SA61537 23501702
TSTDSORG EQU   *                                                SA61537 23501802
         TM    DCBDSORG,SAMPAM          SAM OR PAM               S20201 23502020
         BZ    NOSDIR                   SCH DIR NOT ALLOWED      S20201 23504020
         TM    DCBOPTCD,SDOPT           IF THE SCH DIR OPTION IS S20201 23506020
         BNO   NOSDIR                    SPECIFIED IN THE DCB    S20201 23508020
         TM    UCBTBYT3,UCB3DACC         TEST TO SEE IF IT'S     S20201 23510020
         BNO   NOSDIR                    SUPPORTABLE             S20201 23512020
         TM    D0(RPARC),OUTPUT         OUTPUT ONLY IS NOT       S20201 23514020
         BO    NOSDIR                   SUPPORTED                S20201 23516020
         BZ    CHKMORE                  FOR INPUT ONLY BR        S20201 23518020
         TM    D0(RPARC),INOUTIN        IF ITS NOT INOUT OR      S20201 23520020
         BNO   NOSDIR                   OUTIN, DONT SET THE BIT  S20201 23522020
CHKMORE  EQU   *                                                 S20201 23524020
         TM    DCBRECFM,FSTDREC         IF THE FORMAT IS F STD   S20201 23526020
         BO    TESTMORE                 THEN TEST FURTHER        S20201 23528020
         TM    DCBRECFM,UTRKOVFL        ELSE TEST FOR U          S20201 23530020
*                                       FORMAT WITH TRKOVFLO            23532020
         BO    NOSDIR                   IN WHICH CASE DONT SET   S20201 23534020
*                                       THE S.D. BIT.                   23536020
         TM    DCBRECFM,FBTRKOV         FB - TRK OVFLO IS ALSO   S20201 23538020
         BO    NOSDIR                   NOT SUPPORTED            S20201 23540020
         B     OK                       BRANCH TO CONTINUE       S20201 23542020
*                                       TESTING                  S20201 23544020
TESTMORE EQU   *                                                 S20201 23546020
         TM    DCBRECFM,TRKOVFLO        NOW UNLESS IT'S FIXED    S20201 23548020
*                                       STD                      S20201 23550020
         BZ    NOSDIR                   WITH TRKOVFLO, DONT      S20201 23552020
*                                       PROVIDE SR.DIR.                 23554020
OK       EQU   *                                                 S20201 23556020
         TM    DCBOPTCD,PCI               NOR IS PCI             S20201 23558020
         BO    NOSDIR                   SO BR AROUND FOR THEM    S20201 23560020
         TM    DCBMACRF,QSAM            QSAM USED                S20201 23562020
         BO    PDSTST                   BRANCH IF YES          @ZA18297 23564037
         TM    DCBMACRF,NOTEPT          NOTE - POINT IS NOT      S20201 23566020
         BO    NOSDIR                     SUPPORTED ---          S20201 23568020
         TM    DCBBFTEK,BFTEKR          OFFSET RD                S20201 23570020
         BO    NOSDIR                   BRANCH IF YES            S20201 23572020
****************************************************************ZA00732 23572403
* SEARCH DIRECT CHANNEL PROGRAMS ARE NOT DESIGNED TO SUPPORT    ZA00732 23572803
* PROCESSING THAT BEGINS AT OTHER THAN R0 OF A TRACK. THEREFORE ZA00732 23573203
* WHEN A USER REQUESTS THAT THE NOTE/POINT ROUTINES BE LOADED   ZA00732 23573603
* OR OPENS TO A MEMBER (BY SPECIFYING THE MEMBER NAME IN THE    ZA00732 23573703
* JCL), A SEARCH DIRECT CHANNEL PROGRAM WILL NOT BE BUILT.      ZA00732 23573803
****************************************************************ZA00732 23573903
PDSTST   TM    JFCBIND1,JFCPDS          IS DATA SET A PDS MEMBERZA18297 23576837
         BNO   SOP235X                  IF NOT, BRANCH          ZA00732 23578803
         CLI   JFCBELNM,C' '            MEMBER NAME IN JCL      ZA00732 23579203
         BNE   NOSDIR                   IF SO, BRANCH, THE 1ST  ZA00732 23579603
*                                       CHARACTER OF THE MEMBER ZA00732 23579703
*                                       WILL BE OTHER THAN A    ZA00732 23579803
*                                       BLANK                   ZA00732 23579903
*                                                                       23580003
SOP235X  EQU   *                                                 S20201 23582620
*                                                                       23585520
*                                                                       23588420
         OI    JFCBMASK+D6,SDFLAG       SET S.D. FLAG IN JFCB    S20201 23591320
         B     BLKTEST                                          ZA00732 23593303
*                                                                       23594220
NOSDIR   EQU   *                                                 S20201 23597120
         NI    JFCBFLG2,SDOFF           TURN OFF SEARCH DIRECT  ZA00732 23599103
         TM    TIOELINK,TIOTTERM        IS THIS TSO?           @ZA11099 23599537
         BO    BLKTEST                  YES, BRANCH            @ZA11099 23599637
         CLI   UCBTBYT4,MICR3890        DEVICE A 3890 ?        @ZA08893 23599737
         BE    OCRQSAM                  YES-BRANCH             @ZA16001 23599837
*                                                                       23600020
* BSAM - QSAM BLOCKSIZE TEST                                            23700020
BLKTEST  EQU  *                                                 ZA00732 23750003
         TM    DCBDSORG,PS         PHYSICAL SEQUENTIAL SPECIFIED I19119 23800020
         BNO   CONTINUE            BRANCH IF NOT PS              I19119 23900020
         TM    DCBMACRF,EXCP       TEST FOR EXCP                 I19119 24000020
         BO    CONTINUE            BRANCH IF EXCP                I19119 24100020
         TM    DCBMACRF,BSAM       TEST FOR BSAM INPUT           I19119 24200020
         BO    TSTBLKSZ            BRANCH IF BSAM INPUT          I19119 24300020
         TM    DCBMACRF+1,BSAM     TEST FOR BSAM OUTPUT          I19119 24400020
         BO    TSTBLKSZ            BRANCH IF BSAM OUTPUT         I19119 24500020
         OI    DCBCIND2,QSAMBIT    SET QSAM INDICATOR            I19119 24600020
*                                                                       24600402
*TEST FOR INVALID QSAM OPEN OPTIONS.                            SA51107 24600802
*                                                                       24600902
         TM    0(RPARC),OUTPUT          PREPARE TO TEST FOR     SA51107 24602902
*                                         INOUT/OUTIN           SA51107 24603302
         BO    AROUND                   ALL ON, CAN'T BE EITHER SA51107 24603702
         TM    0(RPARC),INOUTIN         BITS ON FOR INOUT/OUTIN SA51107 24604602
         BNO   AROUND                   NOT ON, VALID           SA51107 24606602
         LA    R0,OUTINOUT              INTERNAL ABEND CODE     SA51107 24609402
         B     CALLPD                   GO ISSUE DMABCOND       SA51107 24609502
AROUND   CLC   DCBBUFL(2),ZEROO        DID USER SPECIFY BUF LEN? M0639  24609602
         BE    TEST                    NO,  BR AROUND TEST       M0639  24613302
         CLC   DCBBLKSI(2),DCBBUFL     TEST TO SEE IF BLKSIZE IS M0639  24617002
*                                         GREATER THAN BUF LEN          24620702
         LA    RE,OABD072               LOAD INTERNAL ABEND CODE S21042 24624402
         BH    CALLPD                   CALL PROB DET            S21042 24628102
TEST     EQU   *                                                 M0639  24631802
         TM    DCBOPTCD,ASCII      ASCII TAPE?       S20038      A31304 24635502
         BO    CONTINUE                YES - BRANCH              A42897 24639202
         TM    TIOELINK,TIOTTERM        IS THIS TSO              M0693  24642902
         BO    MOVEID                  BRANCH IF YES            ZA00631 24646603
         TM    DCBRECFM,UREC       ARE RECS FORMAT U?            2670   24650302
         BNM   CONTINUE             YES, BRANCH                 ZA00737 24654003
         TM    DCBRECFM,VREC       ARE RECS FORMAT V?            2670   24655020
         BC    8,FIXREC            NO, BR AROUND TEST FOR FORMAT 2670 S 24656020
*                                       V REC                    2670   24657020
         TM    DCBRECFM,X'08'          ARE SPANNED RECS BEING    M2699  24657220
*                                       USED?                    M2699  24657420
         BC    1,CONTINUE              YES, LRECL CAN BE LARGER  M2699  24657620
*                                        THAN BLKSIZE-BR AROUND TEST    24657820
*                                                                       24658020
*   FOR VAR LEN RECORDS, BLKSIZE MUST BE AT LEAST 4 BYTES GREATER THAN  24659020
*   LRECL.                                                              24660020
*                                                                       24661020
         LH    RE,DCBLRECL         GET LRECL FOR TEST            2670   24662020
         AH    RE,FOUR             ADD 4 BYTES FOR BDW LENGTH    2670   24663020
         CH    RE,DCBBLKSI         LRECL EQUAL OR LESS THAN      2670   24664020
*                                       BLKSIZE?                 2670   24665020
         BNH   CONTINUE            YES, CONTINUE PROCESSING      2670   24666020
         B     DCBERROR            NO, ABEND                     2670   24667020
FIXREC   EQU   *                                                 2670   24668020
         CLI   UCBTBYT4,MICR3890        DEVICE A 3890 ?         XL03123 24670002
         BE    MICRDEV                  YES,BYPASS RECFM TEST   XL03123 24672002
         CLC   DCBBLKSI,ZEROO           IS BLKSIZE EQ ZERO?     WJXXXXX 24672637
         BE    DCBERROR                 YES - ABEND             WJXXXXX 24673037
         TM    DCBRECFM,RECFMB         RECFM BLOCKED?            M0639  24674020
         BC    1,TSTBLKSZ              YES,  TEST LRECL MULT     M0639  24694020
*                                       BLKSI                    M0639  24714020
*                  RECFM IS FIXED UNBLOCKED                             24734020
* USER DOES NOT HAVE TO SPECIFY LRECL FOR RECFM=F. BLOCKSIZE IS ASSUMED 24736020
* THEREFORE WE SHOULD TEST TO SEE IF USER SPECIFIED LRECL BEFORE MAKING 24738020
* FOLLOWING TEST.                                                       24740020
         CLC   DCBLRECL(2),ZEROO       DID USER SPECIFY LRECL?   M0654  24742020
         BE    CONTINUE                NO,  DO NOT TEST EQ TO    M0654  24744020
*                                       BLKSIZE                  M0654  24746020
         CLC   DCBLRECL(2),DCBBLKSI    LRECL EQ BLKSIZE?         M0639  24754020
         LA    RE,OABD083               LOAD INTERNAL ABEND CODE S21042 24764021
         BNE   CALLPD                   CALL PROB DET            S21042 24774021
         B     CONTINUE                LRECL O.K.                M0639  24794020
TSTBLKSZ EQU   * TEST BLOCKSIZE AS A MULTIPLE OF LRECL           I19119 24900020
*  THE FOLLOWING TEST ALSO FIXES APAR NO. 34919                         24901020
*  THE FOLLOWING TEST FOR V RECS IS MADE TO KEEP BLKSIZE FROM BEING     24902020
*  ADJUSTED TO A MULTIPLE OF LRECL FOR VARIABLE & UNDEFINED RECS        24903020
*                                                                       24904020
         TM    TIOELINK,TIOTTERM        IS THIS TSO              M1565  24904320
         BO    MOVEID                  BRANCH IF YES            ZA00631 24904600
         TM    DCBRECFM,UORVREC        ARE RECS U OR V?          M0654  24905020
         BC    1,CONTINUE              YES,  BYPASS LRECL TESTS  M0654  24906020
         LH    RC,DCBBLKSI             LOAD BLKSIZE FOR DIVIDE   M0639  24910020
         LH    RE,DCBLRECL             LOAD LRECL FOR DIVIDE     M0639  24920020
         LTR   RE,RE                   TEST FOR LRECL SPECIFIED  M0639  24930020
         BZ    QSAMTEST                BRANCH IF LRECL NOT              24940020
*                                       SPECIFIED                M0639  24950020
         SR    RB,RB               CLEAR REGISTER FOR DIVIDE     I19119 25000020
         DR    RB,RE               DIVIDE BLOCKSIZE BY LRECL     I19119 25500020
         LTR   RB,RB               TEST BLOCKSIZE MULTIPLE OF    I19119 25600020
*                                       LRECL                    I19119 25700020
         BZ    CONTINUE            BRANCH IF EVEN MULTIPLE       I19119 25800020
*                                                                       25900020
*** OCIP 294 *** THIS CODE REMOVED BECAUSE HASP HANDLES SYSOUT   Y02072 26000002
*                                                                       29000020
QSAMTEST EQU   * ABEND IF QSAM - CONTINUE IF BSAM                I19119 29100020
         TM    DCBCIND2,QSAMBIT    TEST FOR QSAM OR BSAM         I19119 29200020
         BNO   CONTINUE            BRANCH IF BSAM                I19119 29300020
*                                                                       29400020
DCBERROR EQU   *                                                 S21042 29450021
         LA    RE,OABD056               PUT INTERNAL CODE IN R0  S21042 29500002
CALLPD   EQU   *                                                 S21042 29600021
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES      S21042X29650021
                                        GO TO PROB DET FOR 013 ABEND    29700021
         B     TCTLRTN                                           S21042 29750021
CONTINUE EQU   *                                                        29750402
         CLI   UCBTBYT4,MICR3890        DEVICE A 3890 ?         XL03123 29752002
         BNE   MOVEID                   NO-BRANCH               XL03123 29754002
MICRDEV  EQU   *                                                        29754402
         TM    DCBRECFM,UORVREC         RECFM=F ?               XL03123 29756002
         BO    RECFMERR                 NO-BRANCH               XL03123 29758002
         OI    DCBRECFM,RECFMB          FORCE RECFM=FB          XL03123 29758402
         SR    RB,RB                    CLEAR RB REGISTER       XL03123 29758802
         LA    RB,LRECLMIN              LOAD LRECL CONSTANT     XL03123 29759202
         CH    RB,DCBLRECL              TEST LRECL LENGTH       XL03123 29759602
         BH    LRECLERR                 LRECL TOO LOW-BRANCH    XL03123 29759702
         LA    RB,LRECLMAX              LOAD LRECL CONSTANT     XL03123 29759802
         CH    RB,DCBLRECL              TEST LRECL LENGTH       XL03123 29759902
         BL    LRECLERR                 LRECL TOO HIGH-BRANCH   XL03123 29763202
         LH    RB,DCBLRECL              LOAD LRECL TO RB REG    XL03123 29765202
         SLL   RB,SHIFTCON              MULTIPLY LRECL BY 16    XL03123 29765602
         LH    RC,DCBBUFL               LOAD BUFL INTO RC       XL03123 29766002
         LTR   RC,RC                    DCBBUFL SPECIFIED ?     XL03123 29766402
         BZ    TSTBLKSI                 NO-BRANCH               XL03123 29766502
         CR    RB,RC                    TEST DCBBUFL            XL03123 29766602
         BH    BUFLERR                  BUFL TOO SMALL-BRANCH   XL03123 29769902
TSTBLKSI EQU   *                                                XL03123 29771902
         LH    RC,DCBBLKSI              LOAD BLKSIZE INTO RC    XL03123 29772302
         LTR   RC,RC                    BLKSIZE SPECIFIED ?     XL03123 29772702
         BZ    SUPBLKSI                 NO-BRANCH               XL03123 29773102
         CR    RB,RC                    TEST BLKSIZE            XL03123 29773202
         BH    BLKSIERR                 TOO SMALL-BRANCH        XL03123 29773302
         B     MOVEID                   XCTL OUT                XL03123 29776602
SUPBLKSI EQU   *                                                XL03123 29778602
         STH   RB,DCBBLKSI              STORE GENERATED BLKSIZE XL03123 29779002
         B     MOVEID                   XCTL OUT                XL03123 29779402
RECFMERR EQU   *                                                XL03123 29779802
         LA    RE,OABD115               LOAD ABEND CODE         XL03123 29779902
         B     CALLPD                   CALL PROBLEM DETECT     XL03123 29780002
LRECLERR EQU   *                                                XL03123 29814502
         LA    RE,OABD117               LOAD ABEND CODE         XL03123 29824502
         B     CALLPD                   CALL PROBLEM DETECT     XL03123 29834502
BUFLERR  EQU   *                                                XL03123 29844502
BLKSIERR EQU   *                                                XL03123 29846502
         LA    RE,OABD114               LOAD ABEND CODE         XL03123 29848502
         B     CALLPD                   CALL PROBLEM DETECT     XL03123 29848902
*                                                                       29849502
*  SET QSAM INDICATOR FOR OCR/QSAM DATA SETS                    SA55577 29884002
*                                                                       29918502
OCRQSAM  TM    DCBMACF1,DCBMRRD         BSAM INPUT BEING USED   SA55577 29953002
         BO    CONTINUE                 YES, DON'T SET QSAM BIT SA55577 29987502
         TM    DCBMACF2,DCBMRRD         BSAM OUTPUT BEING USED  SA55577 30022002
         BO    CONTINUE                 YES, DON'T SET QSAM BIT SA55577 30056502
         TM    DCBMACRF,EXCP            EXCP USED              @ZA16001 30066537
         BO    MOVEID                   YES, BRANCH            @ZA20474 30076537
         OI    DCBCIND2,DCBCNQSM        INDICATE QSAM DATA SET  SA55577 30091002
MOVEID   EQU   *                                                        30101002
         USING WTGENTRY,RWTGC                                    Y02072 30160002
         MVC   WTGIDTTR,MOD196I         MOD 196I NEXT          @Z30TSMI 30200003
*                                                                       45600020
*********************************************************************   45700020
*                                                                       45800020
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     UPDATE WHERE TO GO ENTRY        45900020
         LA    RPARC,PLOFF(0,RPARC)     UPDATE PARA LIST ENTRY          46000020
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            46100020
         BCR   8,RBASE                  YES BR BACK TO BEGINNING        46200020
*                                                                       46300020
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    46400020
         BC    7,RELOOP                 NO BRANCH                       46500020
*                                                                       46600020
         LR    RPARC,RPAR                                               46700020
         LA    RWTGC,WAOFF(0,RWTG)      RE INIT  WTG LIST               46800020
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           46900020
         BC    7,TCTLRTN                NO XCTL                         47000020
*                                                                       47100020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  47200020
         LA    RPARC,PLOFF(0,RPARC)                                     47300020
         BC    15,ZCHEK                                                 47400020
*                                                                       47500020
TCTLRTN  EQU   *                                                        47600020
         USING WTG,RWTG                                                 47650003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*48200003
               MODID=WTGENTRY                                  @Z30TSMI 48220003
        DROP  RWTGC,RWTG                                                48250003
*                                                                       48300020
WAOFF    EQU   32                  OFFSET OF FIRST ENTRY IN WTG TABLE   48400020
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                48500020
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                48600020
ZEROO    DC    X'0000'                 CONSTANT FOR BUFL TEST    M0639  48650002
OPIDCNST DC    C'0S'                                                    48700020
AMIDCNST DC    C'1A'                                                    48800020
MOD196I  DC    C'6I',VL3(IGG0196I)      NEXT EXECUTOR            Y02072 48850003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROBLEM DETERMINATION    Y02072 48900003
         SPACE                                                          48950002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 49000002
END      EQU   *                        END OF MOUDULE           Y02072 49050002
         EJECT                                                          49500002
SRT      DSECT                                                          50400020
         IEFUCBOB  PREFIX=YES                                    Y02072 50500002
*                                                                       50600020
         EJECT                                                          50700020
           DCBD  DSORG=PS                                               50800020
CVT      DSECT                                                          50900020
         CVT                                                            51000020
*   TASK CONTROL BLOCK                                                  51100020
         CNOP  0,4                                                      51200020
TCB      DSECT                                                          51300020
TCBRBP   DS    F                       PO9NTER TO EXECUTING RB          51400020
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   51500020
TCBDEB   DS    F                       POINTER TO DEB QUEUE             51600020
TCBTIO   DS    F                       POINTER TO TIOT                  51700020
TCBCMP   DS    F                       TASK COMPLETION CODE             51800020
TCBTRN   DS    F                       TESTRAN FIELD                    51900020
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 52000020
TCBPKF   DS    CL1                     RESERVED FOR FUTURE USE          52100020
TCBFLGS  DS    FL5                     FLAG BYTES                       52200020
TCBLMP   DS    CL1                     RESERVED FOR FUTURE USE          52300020
TCBDSP   DS    CL1                     RESERVED FOR FUTURE USE          52400020
TCBLLS   DS    F                       POINTER TO LOAD LIST             52500020
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            52600020
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  52700020
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       52800020
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             52900020
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  53000020
TCBTCB   DS    F                       RESERVED FOR FUTURE USE          53100020
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         53200020
         DS    CL24                                                     53300020
TIOT     DSECT                                                          53400020
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       53500020
TIOESTTA DS    CL1                           STATUS -A-                 53600020
TIOERLOC DS    CL2                           REL. LOC OF POOL           53700020
TIOEDDNM DS    2F                            DDNAME                     53800020
TIOEJFCB DS    1F                            JFCB DISK ADDR             53900020
TIOESTTB DS    0CL1                                                     54000020
TIOEFSRT DS    CL4                                                      54100020
         DS    CL1                                                      54200020
*        TIOT POOL ENTRY                                                54300020
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       54400020
         DS    CL1                                                      54500020
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      54600020
*                                             SLOTS)                    54700020
TIOPPOOL DS    CL8                           POOL NAME                  54800020
TIOPSTTB DS    XL1                           STATUS OF SLOT             54900020
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  55000020
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      55100020
TIOELINK EQU   TIOERLOC+1                                        S20016 55150020
         SPACE 1                                                        55200020
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          55300020
DEB      DSECT                                                          55400020
DEBNMSUB DS    0CL1                                                     55500020
DEBTCBAD DS    CL4                                                      55600020
DEBAMLNG DS    0CL1                                                     55700020
DEBDEBAD DS    CL4                                                      55800020
DEBOFLGS DS    0CL1                                                     55900020
DEBIRBAD DS    CL4                                                      56000020
DEBOPATB DS    0CL1                                                     56100020
DEBSYSPG DS    CL4                                                      56200020
DEBNMEXT DS    0CL1                                                     56300020
DEBUSRPG DS    CL4                                                      56400020
DEBPRIOR DS    0CL1                                                     56500020
DEBECBAD DS    CL4                                                      56600020
DEBPROTG DS    0CL1                                                     56700020
DEBDEBID DS    0CL1                                                     56800020
DEBDCBAD DS    CL4                                                      56900020
DEBEXSCL DS    0CL1                                                     57000020
DEBAPPAD DS    CL4                                                      57100020
DEBDVMOD DS    0CL1                                                     57200020
DEBUCBAD DS    CL4                                                      57300020
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     57400020
DEBBINUM DS    CL2                                                      57500020
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   57600020
DEBSTRCC DS    CL2                                                      57700020
DEBSTRHH DS    CL2                                                      57800020
DEBENDCC DS    CL2                                                      57900020
DEBENDHH DS    CL2                                                      58000020
DEBNMTRK DS    CL2                                                      58100020
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          58200020
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              58300020
DEBVOLSQ DS    H                                                        58400020
DEBVOLNM DS    H                                                        58500020
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     58600020
DEBSUBID DS    H                                                        58700020
         TITLE 'IGG0191A - FORMAT OF GOTTEN CORE'                       58800002
         IECDSECS (MAIN,(IOB,NO)),WTG,PREFX,EXPAND=YES                  58900003
CCWOFSET EQU   DXCCW12-FORCORE     CCW RELOCATABLE OFF SET FOR DXCCW12  59100020
DCBOFSET EQU   DCBDEBAD-IHADCB     DEB RLCATBL OFFSET IN DCB            59200020
           END                                                          59300020
