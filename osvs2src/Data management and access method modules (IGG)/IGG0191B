         TITLE 'IGG0191B  MAIN EXECUTOR'                                00020000
IGG0191B CSECT                                                          00021000
*                                                                       00021402
*MODULE NAME - IGG0191B                                          Y02072 00021502
*                                                                       00023302
*DESCRIPTIVE NAME - DETERMINES PATH THROUGH OPEN EXECS           Y02072 00025302
*                                                                       00025702
*COPYRIGHT - NONE                                                Y02072 00025802
*                                                                       00025902
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00026002
*                                                                       00026402
*          VS1 RELEASE 3 CHANGES/DELETIONS                              00026502
*                                                                XA2865 00026602
*          VS2 RELEASE 2 CHANGES/DELETIONS                              00026802
*011200,034700,034900-034960,000584-000710,113800,056370,058600, Y02072 00027202
*073820,074399,099000,105000-105400,106000,110400                Y02072 00027602
*                                                                YM6518 00027702
*                                                                       00029903
*          VS2 RELEASE 3 DELETIONS                                      00031903
*                                                              @Z30TSCF 00032303
*          VS2 RELEASE 3.7 CHANGES                                      00032537
*A070344-070351                                                @ZA16011 00032937
*A017370,063000-063160,063220-063240                           @ZA26771 00033037
*C063220-0633240                                               @ZA30524 00033137
*D063000-063160,063220-063240                                  @ZA32889 00033637
*          RELEASE 21 DELETIONS/CHANGES                                 00034137
*0297062200                                                      A47713 00035403
*0297070320-070360                                               M1802  00037603
*0297053000,053600,054020-054160                                 M1306  00039803
*0297053000,053600                                               A43247 00042003
*0297004800,030700,035320,056200,056380-056384,056392-056396,    S21042 00044203
*0297105600,107800,108000-108100,108200,113200,117000            S21042 00046403
*0297                                                            A44469 00048603
*D037300-042800                                                 SA53194 00050803
*REFER TO CODE FLAGGED XA2865                                   SA65964 00053003
*         RELEASE 20 DELETIONS/CHANGES                                  00055203
*1331036400,117800-121800                                        S20016 00057403
*1331000237,036066                                               M0001  00059603
*1331045030-045090                                               M0006  00061803
*1331125500                                                      M0005  00064003
*1331000220                                                      A32172 00066203
*1331027050,033060,036000-036180,133460                          M1227  00068403
*1331                                                            M3415  00070603
*                                                                       00072802
*STATUS CHANGE LEVEL 010                                                00074602
*                                                                       00075002
*FUNCTION/OPERATION: THIS ROUTINE SUPPLEMENTS THE INITIAL OPEN ROUTINE. 00076402
*      IT PERFORMS GENERAL AND SPECIFIC FUNCTIONS FOR THE SEQUENTIAL    00078202
*      ACCESS METHOD(QSAM,BSAM,EXCP).                                   00080000
*      IT SETS INDICATORS FOR THE APPROPRIATE ACCESS METHOD AND DEVICE  00100000
*      CLASS.                                                           00120000
*                                                                       00180000
*ENTRY POINT-IGG0191B  ENTERED FROM IGG0191A BY USE OF THE XCTL MACRO.  00200000
*                                                                       00220000
*INPUT: SEE DESCRIPTION OF REGISTERS.                                   00240000
*OUTPUT: SEE DESCRIPTION OF REGISTERS.                                  00260000
*EXTERNAL ROUTINES: NONE.                                               00280000
*EXITS - NORMAL XCTL TO IGG0196B                                        00330019
*        IGG0191B WAS SPLIT INTO IGG0196B FOR REL 19                    00380019
*                                                                       00430019
*EXITS - ERROR XCTL TO PROBLEM DETERMINATION (IGG0196M)                 00460021
*              TO ISSUE WTP AND 013 ABEND                               00490021
*                                                                       00540000
*TABLES/WORKAREAS: WHERE TO GO TABLE(WTG)                               00560000
*      BYTE  0-7  NAME                                                  00580000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00600000
*      BYTE 11    CONCATENATION NUMBER                                  00620000
*      BYTE 12    ZERO                                                  00640000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00660000
*                        ALIAS INDICATOR 1 BIT                          00680000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00700000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00720000
*      BYTE 17    ZERO                                                  00740000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00760000
*      BYTE 20    TRANSLATION TABLE                                     00780000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00800000
*      BYTE 22-23 ATTRIBUTES                                            00820000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00840000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00860000
*      BYTE 29    LENGTH OF WTG TABLE(IN DOUBLE WORDS)                  00880000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00900000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       00920000
*      BYTE 35    ADDRESS OF STORAGE FOR DCB                            00940000
*      BYTE 36-39 TABLE OF IDTTR'S                                      00960000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB (3 BYTES)           00980000
*                   ADDRESS OF STORAGE FOR DCB      (1 BYTE )           01000000
*                   IDTTR OF LAST ROUTINE LOAD      (3 BYTES)           01020000
*                   NOT USED                        (1 BYTE )           01040000
*                                                                       01060000
*      WORKAREA- SEE 'FORCORE DSECT' (IECDSECT) IN THIS LISTING         01080000
*                                                                       01100000
*ATTRIBUTES: REENTRANT, REUSABLE, SUPERVISOR STATE,              Y02072 01120002
*            RUNS IN DATA MANAGEMENT KEY                         Y02072 01130002
*                                                                       01132002
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01240000
*                                                                       01260000
*********************************************************************** 01280000
*                                                                       01300000
*                                                                       01320000
RE       EQU   0                       WORK/PARAMETER REGISTER          01340000
R0       EQU   RE                      INPUT REG TO BLDL AND     YM1167 01350002
*                                        CONVERT ROUTINE         YM1167 01352002
RF       EQU   1                       WORK/PARAMETER REGISTER          01360000
RWK1     EQU   RF                      WORK REGISTER             YM1167 01370002
RDCB     EQU   2                       ADDR OF USERS DCB                01380000
RBASE    EQU   3                       BASE REGISTER                    01400000
RCORE    EQU   4                       ADDR OF OPEN WORK AREA           01420000
RPAR     EQU   5                       PARAMETER LIST                   01440000
RWTG     EQU   6                       START OF WTG                     01460000
RPARC    EQU   7                       CURRENT ENTRY IN PARAMETER LIST  01480000
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       01500000
RTIOT    EQU   9                       TIOT ADDR/WORK REGISTER          01520000
RUCB     EQU   10                      UCB ADDR/WORK REGISTER           01540000
RDEB     EQU   11                      DEB ADDRESS                      01560000
RA       EQU   11                                                       01580000
RB       EQU   12                      WORK REGISTER                    01600000
RC       EQU   13                      WORK REGISTER                    01620000
RD       EQU   14                      WORK/PARAMETER REGISTER          01640000
RJ       EQU   15                      WORK/PARAMETER REGISTER          01660000
* MASK'S TO TEST PARAMETER LIST WITH                                    01680000
*                                                                       01700000
OUTP       EQU   X'0F'                                                  01720000
INPUT    EQU   X'0F'                    INPUT MASK               A27549 01725019
VOLFULL  EQU   X'20'                    VOLUME FULL MASK         A27549 01730019
DISPNEW  EQU   X'C0'                    DATA SET STATUS MASK     A27549 01735019
*                                                                       01740000
*********************************************************************   01760000
*                                                                       01780000
*                                                                       01800000
* OFFSET FOR PARAMETER TESTS                                            01820000
*                                                                       01840000
DISPSN     EQU   X'0'                                                   01860000
*                                                                       01880000
*                                                                       01900000
*********************************************************************   01920000
*                                                                       01940000
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              01960000
*                                                                       01980000
*                                                                       02000000
*                                                                       02020000
DOUBLE     EQU   X'01'                                                  02040000
P2       EQU   2                        CONSTANT OF 2            M0006  02046020
DEBLRECL EQU   46                       OFFSET OF LRECL IN DEB   M0006  02052020
PORG     EQU   X'02'                    MASK FOR DSORG=PO IN DCB   DM0P 02090018
STOWB      EQU   X'80'                                                  02100000
OVRFLO     EQU   X'20'                                                  02120000
PCI        EQU   X'20'                                                  02140000
CONCAT     EQU   X'FF'                                                  02160000
*                                                                       02180000
*******************************************************************DM0P 02181018
*                                                                  DM0P 02182018
* MASKS USED TO TEST OPTION FIELDS IN DSCB                         DM0P 02183018
*                                                                  DM0P 02184018
POFILTYP EQU   X'02'                    MASK FOR FILE TYPE         DM0P 02185018
*                                                                  DM0P 02186018
*******************************************************************DM0P 02187018
*                                                                  DM0P 02188018
* MASKS USED TO TEST OPTION FIELDS IN JFCB                         DM0P 02189018
*                                                                  DM0P 02190018
NORECRDY EQU   X'20'                     NON-RECORD-READY BIT    A44469 02190421
JFCBMEM  EQU   X'40'                    MASK FOR MEMBER NAME       DMOP 02191018
*                                                                  DMOP 02192018
*********************************************************************   02200000
*                                                                       02220000
* MASKS FOR ACCESS METHODS IN SAM                                       02240000
*                                                                       02260000
PAM        EQU   X'02'                                                  02280000
PSAM       EQU   X'42'                                                  02300000
QSAMB      EQU   X'01'                                                  02320000
*                                                                       02340000
*                                                                       02360000
* MASKS FOR MACRO'S TO BE USED                                          02380000
*                                                                       02400000
GETB       EQU   X'40'                                                  02420000
PUTB       EQU   X'40'                                                  02440000
READB      EQU   X'20'                                                  02460000
WRITEB     EQU   X'20'                                                  02480000
POINTB     EQU   X'04'                                                  02500000
CNTRLB     EQU   X'02'                                                  02520000
*                                                                       02540000
*                                                                       02560000
*********************************************************************   02580000
*                                                                       02600000
* MASKS FOR DEVICES TO BE SUPPORTED                                     02620000
*                                                                       02640000
T3525    EQU   X'4C'               3525 DEVICE                  SA53194 02650021
PRTPCH   EQU   X'30'               PRT/PCH ASSOC. D.S           SA53194 02652021
RDPCH    EQU   X'60'               RD/PCH ASSOC. D.S            SA53194 02654021
RDPRT    EQU   X'50'               RD/PRT ASSOC. D.S            SA53194 02656021
ASSOCDS  EQU   X'04'               3525 ASSOCIATED D.S.         SA53194 02658021
DABIT    EQU   X'20'                                                    02660000
URBIT    EQU   X'40'                                                    02680000
TAPEB    EQU   X'80'                                                    02700000
MICR3890 EQU   X'56'                    DCBDEVT CODE FOR 3890   XL03123 02702002
*                                       DEVC                     S20016 02710020
TIOTTERM EQU   X'20'                    DEVICE IS TERMINAL       S20016 02715020
*                                                                       02720000
*                                                                       02740000
* MASKS FOR BUFFER TECHNIQUE'S                                          02760000
*                                                                       02780000
EXCHANGB   EQU   X'10'                                                  02800000
LRECIND  EQU   X'20'                    LOGICAL RECORD INTERFACE S19015 02810019
*                                                                       02820000
*********************************************************************   02840000
*                                                                       02860000
*                                                                       02880000
* MODES OF OPERATION FOR QSAM                                           02900000
*                                                                       02920000
LOCATEB    EQU   X'08'                                                  02940000
MOVEB      EQU   X'10'                                                  02960000
*                                                                       02980000
*                                                                       03000000
*********************************************************************   03020000
*                                                                       03040000
* MASKS USED FOR NEW BUFFER CONTROL BLOCK                               03042019
*                                                                       03044019
FLGOFFST EQU   4                        OFFSET TO FLAG BYTE IN   S19015 03046019
*                                       BCB                      S19015 03048019
RAFLAG   EQU   X'80'                    RECORD AREA PRESENT      S19015 03050019
*                                                                       03052019
*********************************************************************** 03054019
*                                                                       03060000
OABD053  EQU   53                       INTERNAL CODE 53         S21042 03066021
OABD094  EQU   94                       INTERNAL CODE 94         S21042 03072021
         EJECT                                                          03140002
         BALR  RBASE,0                                                  03160000
         USING PO,RBASE                                                 03180000
         USING IHADCB,RDCB                                              03200000
         USING FORCORE,RCORE                                            03220000
         USING DEB,RDEB                                                 03240000
         USING   TCB,RD                                                 03260000
         USING CVT,RTIOT                                                03280000
         USING UCBOB,RUCB                                               03300000
         USING TIOT,RC                                           S20016 03312020
*                                                                       03320000
*                                                                       03340000
*                                                                       03360000
*                                                                       03380000
PO       EQU   *                                                        03400000
*                                                                       03420000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 03430002
         DC    C'IGG0191B'              MODULE NAME              Y02072 03432002
         DC    C'@ZA32889'              LAST SHIP CODE         @ZA30534 03434037
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZA26771 03435037
BEGIN    EQU   *                                                 Y02072 03438002
         L     RDCB,0(RPARC)           GET DCBADDRESS                   03440000
         L     RCORE,4(RWTGC)           GET WORK AREA                   03460000
         L     RDEB,DCBDEBAD            GET DEB ADDRESS                 03480000
*                                                                       03500000
         L     RUCB,DEBUCBAD            GET UCB ADDRESS                 03520000
*                                                                       03520520
* FOR A TSO DCB, DCBEDVT IS SET TO X'4F' IN IGG0190L                    03521020
*                                                                       03521520
         L     RTIOT,CVTPTR             GET COMM VECTOR ADDR     M1227  03522020
         L     RD,CVTTCBP               GET TCB POINTER          M1227  03522520
         L     RD,4(RD)                 GET ADDR OF CURRENT TCB  M1227  03523020
         L     RC,TCBTIO                GET ADDR OF TIOT         M1227  03523520
         AH    RC,DCBTIOT               GET ADDR OF THIS DD      M1227  03524020
*                                       ENTRY                    M1227  03524520
         TM    TIOELINK,TIOTTERM        IS THIS A TSO DCB        M1227  03525020
         BO    GOGOGO                   BRANCH IF YES            M1227  03525520
         LA    RE,OABD094               LOAD INTERNAL CODE 94    S21042 03525721
         CLI   UCBTBYT3,X'40'           COMMUNICATIONS DEVICE?   A32172 03526020
         BE    CALLPD                   CALL PROB DET            S21042 03533021
         MVC   DCBDEVT(1),UCBTBYT3      STORE DEVICE CLASS              03540000
         NI    DCBDEVT,X'F7'            TURN OFF UR BIT IF ON           03560000
         OC    DCBDEVT(1),UCBTBYT4      STORE DEVICE NUMBER             03580000
*******************************************************************     03618620
         TM    UCBTBYT3,X'08'           UR EQ BEING USED                03620000
         BZ    GOGOGO                   BRANCH IF NOT            S20016 03640020
*                                                                       03660000
         OI    DCBDEVT,X'40'            FAKE UR BIT IN DCB              03680000
*                                                                       04500000
GOGOGO   EQU   *                                                 M0006  04500920
*                                                                       04501820
*     THIS SECTION WILL SAVE DCBLRECL FIELD IN THE DEB FOR QSAM/BSAM  * 04502720
*                                                                       04503620
         TM    DCBDSORG,DCBDSGPO        PARTIONED ORGANIZATION   XA2865 04504002
         BO    SOP100                   YES, BR, DEBLRECL DOES   XA2865 04504402
*                                         NOT EXIST              XA2865 04506702
         SR    RB,RB                    CLEAR REGISTER           M0006  04510102
         IC    RB,DEBNMEXT              PICK UP NO. OF EXTENTS   M0006  04512402
         SLL   RB,P2                    MULTIPLY BY 4 FOR NON-DA M0006  04514702
         TM    TIOELINK,TIOTTERM        IS THIS A TSO DCB        M3415  04517002
         BO    SOP90                    BRANCH IF YES            M3415  04519302
         TM    UCBTBYT3,DABIT           DIRECT ACCESS DEVICE     M0006  04521602
         BNO   SOP90                    NO, BRANCH               M0006  04523902
         SLL   RB,P2                    MULTIPLY BY 4 FOR DA     M0006  04526202
SOP90    AR    RB,RDEB                  ADD DEB ADDRESS          M0006  04528502
         MVC   DEBLRECL(P2,RB),DCBLRECL SAVE DCBLRECL IN DEB     M0006  04530802
SOP100   EQU   *                                                 XA2865 04535102
         MVC   DXCCW6(1),DCBEROPT       SAVE QSAM ERROR OPTIONS         04537702
         XC    DCBCNTRL(4),DCBCNTRL     CLEAR PARA PASSAGE VECTOR       04540000
*                                                                       04560000
         TM    DCBDEVT,X'20'            D. A. DEVICE BEING USED         04580000
         BO    A0020                    YES, BRANCH                     04590021
         OI    JFCBMASK+6,NORECRDY      SET NON-RECORD-READY BIT  M1802 04600021
*                                       FOR ALL NON-DIRECT ACCESS       04610021
*                                       DEVICES                         04612021
         B     PAM6                     BRANCH AROUND             M1802 04614021
*                                                                       04620000
A0020    EQU   *                                                        04640000
         XC    DCBRELAD(4),DCBRELAD     INITIALIZE RELAD                04660000
         L     RTIOT,CVTPTR(0,0)        GET COMM VECTOR ADDRESS         04680000
         L     RB,CVTZDTAB             DEVICE CONSTANT TABLE ADDRESS    04700000
         IC    RF,DCBDEVT              GET DEVICE CHARACTERISTICS       04720000
         N     RF,DEVTCNST             CLEAR HI 28 BYTES                04740000
         IC    RF,0(RF,RB)             ADD ID TO TABLE ADDRESS          04760000
         LA    RB,0(RF,RB)             ADD CONST AT THIS LOC-PNT DEV    04780000
         IC    RC,DCBDVTBL             SAVE POSSABLE REC NO.R           04800000
         ST    RB,DCBDVTBL             STORE ADDRESS OF DEVICE TABLE    04820000
         STC   RC,DCBDVTBL             RESTORE RECORD NUMBER            04840000
         SR    RC,RC                   CLEAR REG                        04860000
*                                                                       04880000
*                                                                       04900000
         CLI   DCBKEYLE,1              ARE KEYS SPECIFIED               04920000
         BC    10,DEVCN1               YES BRANCH OVERHEAD INCLUDED     04940000
*                                                                       04960000
DEVCNO   IC    RC,8(RB)                GET KEY OVERHEAD                 04980000
*                                                                       05000000
DEVCN1   STC   RC,DCBRELAD+4           STORE EITHER OVHEAD OR ZERO      05020000
*                                                                       05040000
         MVC   DCBTRBAL(2),4(RB)       INITILIZE TRACK BALANCE          05060000
DEVCN2   EQU   *                                                        05080000
*                                                                       05100000
PAM1     EQU   *                                                        05120000
*                                                                       05140000
         TM    0(RPARC),X'07'           DCB OPENED FOR OUTPUT OR OUTIN  05160000
         BC    1,PAM3                  YES BRANCH                       05180000
*                                                                       05220000
*  FIND MEMBER NAME STORE IN DEB ISSUE A BLDL MACRO TO FIND EXTENT      05240000
*                                                                       05260000
         TM    JFCBIND1,X'01'           DCB FOR PDS                     05280000
         BZ    PAM5                     NO BRANCH                M1306  05290021
         CLI   JFCBELNM,X'40'           IS THIS A MEMBER                05340000
         BZ    PAM5                     NO BRANCH                M1306  05360021
         TM    DSCFILTY,X'02'           DSCB SET UP FOR P. O.           05380000
         BC    8,DCBERROR               NO ABEND -- DIAGNOSTIC TEST     05400000
         MVC   BLDLLDF,BLDLCNST         FILL IN LIST DESC FIELD  YM1167 05450002
         MVC   BLDLMNAM,JFCBELNM        MEMBER NAME TO LIST      YM1167 05500002
         LA    R0,BLDLLIST              INPUT REG TO BLDL        YM1167 05510002
*                                                                       05540000
         BLDL  0(RDCB),(0)                                              05560000
*                                                                       05580000
         LTR   RJ,RJ                    HAS AN ERROR OCCURED IN BLDL    05600000
         BZ    PAM2                     NO ERROR HAS OCCURRED    S21042 05610021
*                                       IF RETURN CODE FROM BLDL IS     05630021
*                                       4, THEN INTERNAL CODE IS 54     05632021
*                                       IF RETURN CODE IS 8,            05634021
*                                       THEN INTERNAL CODE IS 55        05636021
         LA    RE,OABD053               LOAD CODE 53 INTO REG    S21042 05637621
         SRL   RJ,2                     DIVIDE BLDL RETURN CODE  S21042 05638221
*                                       BY 4                     I21042 05638821
         AR    RE,RJ                    CALCULATE INTERNAL CODE  S21042 05639221
         B     CALLPD                                            S21042 05639621
*                                                                       05640000
*                                                                       05660000
*                                                                       05680000
PAM2     EQU   *                                                        05700000
*                                                                       05720000
*                                                                       05740000
         SR    RWK1,RWK1                PREPARE REG FOR IC INST  YM1167 05790002
         IC    RWK1,BLDLR               GET R FROM TTRN          YM1167 05840002
         BCTR  RWK1,0                   DECREMENT R VALUE BY 1   YM1167 05850002
         STC   RWK1,BLDLR               NEW R VALUE TO TTRN      YM1167 05860002
         L     R0,BLDLTTRN              INPUT REG TO CNVRT RTN   YM1167 05870002
         B     PAM4                     GO CONVERT IT                   05880000
*                                                                       05900000
PAM3     EQU   *                                                        05920000
*                                                                       05940000
         TM    JFCBIND1,X'01'           DCB FOR PDS                     05960000
         BZ    PAM3D                    NO BRANCH                  DM0P 05961018
         CLI   JFCBELNM,JFCBMEM         OPENING TO A MEMBER        DM0P 05962018
         BE    PAM3D                    NO BRANCH                  DM0P 05963018
         TM    DSCFILTY,POFILTYP        DSCB SET UP FOR P.O.       DM0P 05964018
         BZ    DCBERROR                 NO ABEND                   DM0P 05965018
         B     PAM3C                    YES BRANCH                 DM0P 05966018
*                                                                  DM0P 05967018
PAM3D    EQU   *                                                   DM0P 05968018
*                                                                  DM0P 05969018
         TM    DCBDSORG,PORG            DCB SET UP FOR P.O.        DM0P 05970018
         BZ    PAM3A                    NO BRANCH                  DM0P 05971018
         TM    DSCFILTY,POFILTYP        DSCB SET FOR P.O.          DM0P 05972018
         BZ    DCBERROR                 NO ABEND                   DM0P 05973018
*                                                                       06100000
PAM3A    EQU   *                                                        06120000
*                                                                       06140000
         TM    DEBOFLGS,X'C0'           NEW DATA SET OPENING            06160000
         BC    1,PAM3B                  YES BRANCH                      06180000
         TM    DEBOFLGS,X'80'           DATA SET BEING MODIFIED         06200000
         BZ    PAM3B                   IF NOT, BRANCH AROUND     A47713 06220021
*                                       NEXT                     A47713 06222021
         OI    DCBOFLGS,X'80'          IF YES, TURN ON           A47713 06224021
*                                       LAST-IO-WAS-             A47713 06226021
*                                      WRITE BIT. TRKBAL FILLED IN      06228021
*                                      FROM DSCB; NO SVC 25 NEEDED      06230021
         B     PAM3C                   BR TO MV IN FDAD & TRKBAL A47713 06232021
*                                                                       06240000
PAM3B    EQU   *                                                        06260000
*                                                                       06280000
         TM    DCBDSORG,X'02'           DCB SET UP FOR P. O.            06300037
         BC    8,PAM5                   NO BRANCH                       06310037
*                                                                       06340000
*                                                                       06360000
*                                                                       06380000
PAM3C    EQU   *                                                        06400000
*                                                                       06420000
         MVC   DCBTRBAL(2),DSCLSTAR+3   STORE TRACK BAL OF LAST WRT     06440000
         MVC   DCBRELAD+1(3),DSCLSTAR   MOVE TTR TO WORK AREA           06460000
         L     RE,DCBRELAD              GET TTR IN REG 0                06480000
         SLL   RE,8                     SET TTR UP FOR CONVERT          06500000
         LA    RF,256                                                   06520000
         AR    RF,RE                    SET UP FOR IMPLIED NOTE         06540000
         ST    RF,DCBRELAD              IMPLIED NOTE R+1                06560000
*                                                                       06580000
PAM4     EQU   *                                                        06600000
*                                                                       06620000
         LR    RF,RDEB                  GET DEB ADDR IN PROPER REG.     06640000
         STM   2,13,DXCCW7              SAVE REGS                       06660000
         LA    RDCB,DCBFDAD             GET DCB DISK FIELD              06680000
         L     RTIOT,CVTPTR(0,0)        GET COMM VECTOR                 06700000
         L     RJ,CVTPCNVT              GET CONVERT RT ADDRESS          06720000
         BALR  RD,RJ                    TO CONVT RT.                    06740000
*                                                                       06760000
         LM    2,13,DXCCW7              RESTORE REGS                    06780000
*                                                                       06800000
         B     PAM6                                                     06820000
PAM5     EQU   *                                                        06840000
*********************************************************************** 06860000
*********************************************************************** 06880000
         XC    DCBFDAD(8),DCBFDAD      CLEAR FDAD FIELD                 06900000
         MVC   DCBFDAD+1(6),DEBBINUM    INITILIZE FDAD FIELD            06920000
         TM    DCBCIND1,X'20'           Q-DUMMY EXTENT                  06940000
         BZ    PAM6                     NO-BRANCH                       06960000
*                                                                       06980000
         MVI   DCBFDAD+3,X'FF'          FORCE ILLEGAL FDAD              07000000
PAM6     EQU   *                                                        07020000
*       ****************************************************            07030037
*       **  TURN OFF TRACK OVERFLOW INDICATOR IN DCBRECFM **            07030737
*       **  IF SPECIFIED FOR A TAPE DATA SET              **            07031437
*       ****************************************************            07032137
*                                                                       07032837
        TM    DCBDEVT,TAPEB            TAPE DEVICE?            @ZA16011 07033537
        BNO   PAM6A                    BRANCH IF NO            @ZA16011 07034337
        TM    DCBRECFM,OVRFLO          DFORMAT REC OR OVERFLOW @ZA16011 07035137
        BNO   PAM6A                    BRANCH IF NEITHER       @ZA16011 07035937
        TM    DCBRECFM,X'C0'           DFORMAT REC OR OVERFLOW @ZA16011 07036737
        BZ    PAM6A                    BRANCH IF DFORMAT REC   @ZA16011 07037537
        NI    DCBRECFM,X'FF'-OVRFLO    TURN OFF TRK OVERFLOW   @ZA16011 07038337
PAM6A   EQU   *                                                @ZA16011 07039137
        TM    DCBDEVT,X'40'            UNIT RCD EQUIP USED              07040000
        BC    8,AMOP15                 NO BRANCH                        07060000
*                                                                       07080000
        TM    DEBOPATB,X'0F'           DCB FOR INPUT ONLY               07100000
        BC    8,AMOP14                 YES BRANCH                       07120000
*                                                                       07140000
        TM    DCBMACRF+1,POINTB        NOTE/POINT USED                  07160000
        BC    1,AMOP14A                YES BRANCH                       07180000
*                                                                       07200000
        TM    DEBOPATB,X'0F'           DCB FOR INOUT OR OUTIN           07220000
        BC    1,AMOP15                 NO BRANCH                        07240000
*                                                                       07260000
AMOP14  EQU   *                                                         07280000
        TM    DCBMACRF,POINTB          NOTE POINT TO BE USED            07300000
        BC    8,AMOP15                 NO BRANCH                        07320000
AMOP14A EQU   *                                                         07340000
        MVI   DCBCNTRL+1,10            STORE ID OF DUMMY RTNE           07360000
*                                                                       07370002
*  THE FOLLOWING WILL ADJUST LRECL FOR FIXED UNBLOCKED RECORDS,  XA2865 07372002
*  UNDEFINED LENGTH RECORDS, AND VARIABLE LENGTH UNSPANNED       XA2865 07374002
*  RECORDS. FOR FIXED BLOCKED RECORDS, IGG0191A INSURES LRECL    XA2865 07376002
*  IS VALID.                                                     XA2865 07378002
*                                                                       07378402
AMOP15  EQU   *                                                         07380000
         CLI   DCBDEVT,MICR3890         DEVICE A 3890 ?         XL03123 07390002
         BE    POPEND                   YES-BRANCH              XL03123 07392002
         SR    RWK1,RWK1                CLEAR REG TO ZERO        YM6518 07470802
         CH    RWK1,DCBLRECL            LRECL = ZERO             YM6518 07472802
         BNE   POPEND                   BRANCH IF NOT ZERO       YM6518 07473102
         TM    DCBCIND2,DCBCNQSM        ADJUST FOR QSAM ONLY     XA2865 07475102
         BZ    POPEND                   BR NOT QSAM              XA2865 07477102
         LH    RWK1,DCBBLKSI            ADJUST USING BLKSIZE     XA2865 07479102
         TM    DCBRECFM,DCBRECU         RECFM UNDEFINED          XA2865 07479502
         BNM   NOTVARBL                 YES, GO ADJUST LRECL     XA2865 07479902
         TM    DCBRECFM,DCBRECF         RECFM FIXED              XA2865 07486602
         BO    NOTVARBL                 YES, GO ADJUST LRECL     XA2865 07488602
         TM    DCBRECFM,DCBRECSB        RECFM VAR SPANNED        XA2865 07490602
         BO    POPEND                   YES, BYPASS ADJUSTMENT   XA2865 07492602
         SH    RWK1,BDWLEN              SUB BDW LENGTH           XA2865 07493002
NOTVARBL EQU   *                                                 XA2865 07493102
         STH   RWK1,DCBLRECL            ADJUST LRECL             XA2865 07493202
POPEND   EQU   *                                                        07493302
*                                                                       07500000
****************************************************************** DM0B 09896016
*                                                                  DM0B 09897016
XCTLGOGO EQU   *                                                   DM0B 09898016
         LA    RF,SO6B                  ADDR OF NEXT LOAD ID     S19033 09898519
         USING WTGENTRY,RWTGC                                    Y02072 09898902
         MVC   WTGIDTTR,0(RF)           ID TO WTG ENTRY        @Z30TSCF 09904103
*                                                                       09920000
*                                                                       09940000
*                                                                       09960000
*                                                                       09980000
*                                                                       10000000
*                                                                       10020000
*********************************************************************** 10040000
*                                                                       10060000
*********************************************************************** 10080000
*                                                                       10100000
RELOOP   EQU   *                                                        10120000
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     10140000
         LA    RPARC,PLOFF(0,RPARC)    INCR CURRENT DCB ENTRY PTR       10160000
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            10180000
         BCR   8,RBASE                 RETURN TO INITIALIZE ANOTHER DCB 10200000
*                                                                       10220000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    10240000
         BC    7,RELOOP                 NO, CHECK NEXT ENTRY            10260000
*                                                                       10280000
         LR    RPARC,RPAR                                               10300000
         LA    RWTGC,WAOFF(0,RWTG)     REINITIALIZE WTG LIST PTR        10320000
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           10340000
         BC    7,TCTLRTN           IF NOT TRANSFER CONTROL              10360000
*                                                                       10380000
         LA    RWTGC,WGOFF(0,RWTGC)    GET NEXT ENTRY                   10400000
         LA    RPARC,PLOFF(0,RPARC)                                     10420000
         BC    15,ZCHEK                                                 10440000
*                                                                       10460000
TCTLRTN  EQU   *                                                        10480000
         USING WTG,RWTG                                                 10570003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*10572003
               MODID=WTGENTRY                                  @Z30TSCF 10574003
         DROP  RWTGC,RWTG                                      @Z30TSCF 10576003
**                                                                      10620000
DCBERROR EQU   *                                                        10760000
         LA    RE,OABD053                                        S21042 10770021
*                                       0                        I21042 10790021
CALLPD   EQU   *                                                 S21042 10797021
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES      S21042X10804021
                                        013 ABEND                       10811021
         B     TCTLRTN                  GO XCTL                  S21042 10831021
         EJECT                                                          10860002
WAOFF    EQU   32                  OFFSET OF FIRST ENTRY IN WTG TABLE   10940000
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                10960000
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                10980000
*                                                                       10990002
*  MODULE ID'S                                                          10992002
*                                                                       10994002
SO6B     DC    C'6B',VL3(IGG0196B)                             @Z30TSCF 10996003
PDLOAD   DC    C'6M',VL3(IGG0196M)                             @Z30TSCF 10998003
OPIDCNST DC    C'0S'                                                    11000000
AMIDCNST DC    C'1B'                                                    11020000
*                                                                       11070002
*  OTHER CONSTANTS                                                      11120002
*                                                                       11170002
DEVTCNST DC    F'15'                                                    11180000
BLDLCNST DC    X'0001',X'000C'          1 ENTRY, 12 BYTE LIST    YM1167 11182002
BDWLEN   DC    H'0004'                  LEN OF A BLK DESC WORD   XA2865 11182402
         SPACE                                                          11184002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 11186002
END      EQU   *                        END OF MODULE            Y02072 11192002
         EJECT                                                          11200002
           DCBD  DSORG=PS                                               11640000
*                                                                       11660000
*                                                                       11680000
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @Z30TSCF 11710003
         ORG   WTGIDTTR                                          Y02072 11720002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 11722002
FORCORE  DSECT                                                   YM1167 11732002
         ORG   DXCCW                                             YM1167 11734002
BLDLLIST DS    0CL12                    LENGTH OF BLDL LIST      YM1167 11736002
BLDLLDF  DS    0CL4                     BLDL LIST DESCRIPTION    YM1167 11738002
*                                         FIELD                  YM1167 11738402
BLDLNENT DS    CL2                      NUM OF ENTRIES IN LIST   YM1167 11738802
BLDLLEN  DS    CL2                      LEN OF BLDL LIST FIELD   YM1167 11739202
BLDLMNAM DS    CL8                      MEMBER NAME              YM1167 11739602
BLDLTTRN DS    0CL4                     TTRN                     YM1167 11739702
BLDLTT   DS    CL2                      RELATIVE TRACK NUM OF    YM1167 11739802
*                                         BEGINNING OF DATA SET  YM1167 11739902
*                                         MEMBER                 YM1167 11746602
BLDLR    DS    C                        RELATIVE BLOCK NUMBER    YM1167 11748602
*                                         RELATING TO TT         YM1167 11750602
BLDLN    DS    C                        CONCATINATION NUMBER OF  YM1167 11752602
*                                         DATA SET               YM1167 11753002
         EJECT                                                          11753102
*    COMMUNICATION VECTOR TABLE  (SSS)                                  11753302
*   TASK CONTROL BLOCK                                                  11760000
TIOT     DSECT                                                          12200000
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       12220000
TIOESTTA DS    CL1                           STATUS -A-                 12240000
TIOERLOC DS    CL2                           REL. LOC OF POOL           12260000
TIOEDDNM DS    2F                            DDNAME                     12280000
TIOEJFCB DS    1F                            JFCB DISK ADDR             12300000
TIOESTTB DS    0CL1                                                     12320000
TIOEFSRT DS    CL4                                                      12340000
         DS    CL1                                                      12360000
*        TIOT POOL ENTRY                                                12380000
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       12400000
         DS    CL1                                                      12420000
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      12440000
*                                             SLOTS)                    12460000
TIOPPOOL DS    CL8                           POOL NAME                  12480000
TIOPSTTB DS    XL1                           STATUS OF SLOT             12500000
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  12520000
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      12540000
TIOELINK EQU   TIOERLOC+1                                        M0005  12550020
         SPACE 1                                                        12560000
SRT      DSECT                                                          12580000
         IEFUCBOB                                                       12600000
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          12620000
DEB      DSECT                                                          12640000
DEBNMSUB DS    0CL1                                                     12660000
DEBTCBAD DS    CL4                                                      12680000
DEBAMLNG DS    0CL1                                                     12700000
DEBDEBAD DS    CL4                                                      12720000
DEBOFLGS DS    0CL1                                                     12740000
DEBIRBAD DS    CL4                                                      12760000
DEBOPATB DS    0CL1                                                     12780000
DEBSYSPG DS    CL4                                                      12800000
DEBNMEXT DS    0CL1                                                     12820000
DEBUSRPG DS    CL4                                                      12840000
DEBPRIOR DS    0CL1                                                     12860000
DEBECBAD DS    CL4                                                      12880000
DEBPROTG DS    0CL1                                                     12900000
DEBDEBID DS    0CL1                                                     12920000
DEBDCBAD DS    CL4                                                      12940000
DEBEXSCL DS    0CL1                                                     12960000
DEBAPPAD DS    CL4                                                      12980000
DEBDVMOD DS    0CL1                                                     13000000
DEBUCBAD DS    CL4                                                      13020000
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     13040000
DEBBINUM DS    CL2                                                      13060000
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   13080000
DEBSTRCC DS    CL2                                                      13100000
DEBSTRHH DS    CL2                                                      13120000
DEBENDCC DS    CL2                                                      13140000
DEBENDHH DS    CL2                                                      13160000
DEBNMTRK DS    CL2                                                      13180000
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          13200000
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              13220000
DEBVOLSQ DS    H                                                        13240000
DEBVOLNM DS    H                                                        13260000
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     13280000
DEBSUBID DS    H                                                        13300000
CVT      DSECT                                                          13320000
         CVT                                                            13340000
         IKJTCB                                                , S20016 13352020
           END                                                          13360000
