  TITLE  'IGG0191G - OPEN EXECUTOR - STAGE 2 - UR, MAG AND PAPER TAPE'  00002010
IGG0191G CSECT                                                          00004003
*MODULE NAME - IGG0191G                                          Y02072 00012002
*                                                                       00014002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00016002
*                                                                       00018002
*COPYRIGHT - NONE                                                Y02072 00020002
*                                                                       00020402
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00020802
*                                                                       00021202
*          RELEASE 20 DELETIONS                                       * 00022000
*2380121680                                                      S20038 00023020
*          RELEASE 21 DELETIONS                                       * 00024000
*2590065960                                                      M0129  00024121
*2590000020,001200,002000-002200,002400-002600,003000,004600,    A37507 00024221
*2590011800,015600,019800-020000,021600-021800,022200,024200-    A37507 00024421
*2590024400,025200-027000,027800-028000,028400,029600-029800,    A37507 00024621
*2590030200-030600,032200,034400-035400,036800,037800-038400,    A37507 00024821
*2590039200-043800,045600-047000,065600,073000-073600,074800,    A37507 00025021
*2590088800-117600,118400-118600,121000-121600,132800            A37507 00025221
*2590065800-066000,066200                                        A37507 00025421
*2590                                                            M0063  00025621
*2590132700-134200                                               M0091  00025821
*          VS2 RELEASE 2 DELETIONS                                      00025902
*000400,011400,060800,065415,065420,065425,065600,067800,068600, Y02072 00026602
*069000,085800,135200-135490,135500,135510-135570,133800,118800  Y02072 00027002
*121620,121720,123800,129000,129800                              Y02072 00027402
*                                                                YM4697 00027802
*C80200,C80400                                                 @ZA27760 00027937
*                                                                       00028002
*          VS2 RELEASE 3 DELETIONS                                      00038010
*                                                              @Z30TSMI 00038403
*          VS2 RELEASE 4 DELETIONS                                      00038510
*                                                              @Z40MSMI 00038610
*C08840000                                                     @ZM40309 00038810
*A06686000,06692000,09840000                                   @ZM40309 00039210
*                                                                       00039610
*STATUS CHANGE LEVEL 007                                                00040002
*                                                                       00060000
*FUNCTION/OPERATION: THIS ROUTINE WILL GET CORE(GETMAIN) TO SET UP THE  00080000
*      NECESSARY IOB'S. IT WILL CLEAR THE CORE AND LINK THE IOB'S       00100000
*      TOGETHER FOR TAPE & UNIT RECORD. (FOR UNIT RECORD, THEN GO       00110010
*      TO IGG0196K. FOR TAPE CONTINUE PROCESSING).                      00120021
*      IT WILL SET UP THE NECESSARY BUFFERS IF NOT AVAILABLE.           00140000
*      IT WILL CONNECT THE DCB AND IOB.                                 00160000
*      IT WILL DETERMINE WHAT ROUTINES ARE NEEDED FOR PROPER EXECUTION  00180000
*      AND SET A CODE IN THE DCBCNTRL FIELD OF THE DCB.                 00210021
*      IT WILL SET UP CCW'S FOR TAPE.                                   00220021
*      IT SETS AN AUDIT TRAIL BIT IN THE OPEN WORKAREA           Y02072 00222002
*      INDICATING TO FORCE CLOSE THAT THE CORE GETMAINED FOR THE Y02072 00224002
*      IOB'S CAN BE FREEMAINED.                                  Y02072 00226002
*                                                                       00230021
*      THIS MODULE WAS SPLIT INTO IGG0196K FOR REL 21.                  00240021
*                                                                       00280000
*ENTRY POINTS: ENTERED FROM IGG0196B, IGG0193I, IGG0191T, IGG0191U,     00285021
*              IGG0191V, IGG0196Q  (NORMAL CONDITIONS)                  00290010
*              ENTERED FROM IGG0191F, IGG0191Q, IGG0191R -              00305021
*              (ABNORMAL CONDITIONS - CHAINED SCHEDULING UNSUPPORTABLE) 00310010
*                                                                       00320000
*INPUT: SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00340000
*                                                                       00360000
*OUTPUT: SEE DESCRIPTION OF REGISTERS, IOB(USERS), DCB(USERS).          00380000
*                                                                       00400000
*EXTERNAL ROUTINES: IFG019RA.                                           00420010
*                                                                       00440000
*EXITS- NORMAL: IGG0196K FOR UNIT RECORD AFTER GETMAIN                  00450010
*             : IGG01910, IGG01912, IGG01915 TO LOAD                    00460010
*               ACCESS METHOD ROUTINES                                  00470021
*EXITS-ERROR: NONE.                                                     00480000
*                                                                       00500000
*MACROS - ACTION : MODESET, GETMAIN, IECRES                             00510010
*                                                                       00520000
*TABLES/WORKAREAS-  SEE DSECTS AT THE END OF THIS LISTING               00540010
*                                                                       00560000
*                                                                       01100000
*                                                                       01120000
*ATTRIBUTES: REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY           01140010
*            UNLESS OTHERWISE SPECIFIED, SUPERVISOR STATE               01150010
*                                                                       01160000
*NOTES: THIS ROUTINE GETS CORE FOR MAG & PAPER TAPE AND UNIT RECORD.    01168021
*       GOES TO IGG0196K TO CONSTRUCT IOB'S FOR UNIT RECORD.            01176010
*       THIS MODULE SAVES THE NUMBER OF IOB'S TO BE BUILT IN THE        01184021
*       HIGH ORDER BYTE OF DCBIOBA FOR MODULE IGG0196K.                 01192021
*       FOR THE 3886 OCR DEVICE, ADDITIONAL CORE IS GOTTEN FOR          01194002
*       A 152 BYTE BUFFER ALONG WITH THE IOB.                           01196002
*                                                                       01200000
*       FOR A 3800 PRINTER(@Z40MSMI) WHEN OPTCD=J (DYNAMIC TRANSLATE    01202010
*       TABLE SELECTION) HAS BEEN REQUESTED, THE CHANNEL PROGRAM        01206010
*       AREA MUST BE INCREASED TO ACCOMODATE THE EXTRA SELECT           01208010
*       TRANSLATE TABLE CCW. THE CHANNEL PROGRAM WILL BE:               01210010
*              NOP/ASA CNTRL                                            01212010
*              NOP/SEL TRANS TBL                                        01214010
*              WRITE                                                    01216010
*       THE LEADING NOP IS STILL REQUIRED AND CANNOT BE USED FOR        01218010
*       THE SELECT BECAUSE OF PRINT OVERFLOW SUPPORT WHICH CHANGES      01218410
*       THE NOP TO A SKIP-TO-ONE WHEN REQUESTED.                        01218810
*                                                                       01220000
*                                                                       01240000
*********************************************************************** 01260000
*                                                                       01280000
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01300000
*                                                                       01320000
*********************************************************************** 01340000
*                                                                       01360000
RDCB     EQU   2         DCB REGISTER                                   01380000
RBASE    EQU   3         BASE REGISTER                                  01400000
RCORE    EQU   4         WORK AREA ADDRESS                              01420000
RPAR     EQU   5         TOP OF PARAMETER LIST                          01440000
RWTG     EQU   6         TOP OF WTG TABLE                               01460000
RPARC    EQU   7         CURRENT PARAMETER                              01480000
RWTGC    EQU   8         CURRENT TRANS LOAD                             01500000
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    01520000
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       01540000
RWK1     EQU   11                       WORK REGISTER            Y02072 01550002
RB       EQU   12        WORK REG1  **                                  01580000
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01600000
RWK2     EQU   RC                       WORK REGISTER            Y02072 01610002
RD       EQU   14        WORK REG3  **                                  01620000
RJ       EQU   15        WORK REG4                                      01640000
RE       EQU   0         WORK REG5                                      01660000
RF       EQU   1         WORK REG6                                      01680000
*                                                                       01700000
*                                                                       01760000
PARAR    EQU   RPARC                                         @ZA27760   01766010
DISPSN   EQU   X'0'                                          @ZA27760   01772010
*********************************************************************** 01780000
*                                                                       01800000
*                                                                       01820000
*                                                                       01840000
* MASKS FOR DEVICES TO BE SUPPORTED                                     01860000
*                                                                       01880000
*                                                                       01900000
*                                                                       01920000
TAPEB    EQU   X'80'                                                    01940000
URBITS   EQU   X'40'                                                    01960000
*                                                                       02040000
*                                                                       02060000
*********************************************************************   02280000
*                                                                       02300000
*          OPERATIONS                                                   02320000
*                                                                       02340000
WRITE      EQU   X'01'                                                  02360000
READ       EQU   X'02'                                                  02380000
READBACK   EQU   X'0C'                                                  02400000
EOR        EQU   X'04'                  END OF RECORD              DM0I 02460000
*                                                                       02480000
*********************************************************************   02500010
* GENERAL EQUATES                                                       02520010
*                                                                       02540010
ECBNORM  EQU   X'7F'                    NORMAL COMPLETION CODE          02560010
MULT8    EQU   3                        SHIFT VALUE TO DIV OR MULT BY 8 02640010
OCRIBSZ  EQU   216                      SIZE FOR 3886 OCR       XL03127 04736002
*                                       IOB&BUFR (40+24+152)    XL03127 04738002
*********************************************************************   04740000
         EJECT                                                          04762010
         BALR  RBASE,0                  SET BASE                   DM0I 04820010
         USING SOP5,RBASE                                               04840000
         USING WTG,RWTG                                                 04882010
         USING WTGENTRY,RWTGC                                           04884010
         USING PARML,RPARC                                              04886010
*                                                                       04900000
*                                                                       04920000
SOP5     EQU   *                                                        04940000
*                                                                       04960000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 04970002
         DC    C'IGG0191G'              MODULE NAME              Y02072 04972002
         DC    C'@ZA27760'              LAST SHIP CODE         @Z40MSMI 04974010
         DC    C'11/08/77'              LAST DATE MODIFIED     @Z40MSMI 04975010
BEGIN    DS    0H                                                YM4697 04978002
         SR    RE,RE                    INITIALIZE                      04980000
         L     RDCB,PARDCBAD            GET DCB ADDRESS                 05000010
         USING IHADCB,RDCB                                              05004010
         LA    RDCB,IHADCB              CLEAR HI BYTE                   05020010
         L     RCORE,WTGCORE-1          GET WRK AREA ADDRESS            05040010
         USING FORCORE,RCORE                                            05044010
         LA    RF,IOBEXTEN-IOBQSAMN+L'CCW  SIZE OF IOB + CCW            05060010
*                                                                       05080000
         TM    DCBDEVT,TAPEB            DCB USING TAPE                  05100000
         BO    SOP52                    YES BRANCH                      05120010
*                                       NO MUST BE UNIT RECORD          05140010
*                                                                       05140810
*   IF THE DEVICE IS THE 3886 OCR, ESTABLISH SIZE FOR THE IOB   XL03127 05141610
*   AND SPECIAL CONTIGUOUS BUFFER. 40(BASIC)+24(CP)+152(BUFR)   XL03127 05142410
*                                                                       05143210
         CLI   DCBDEVT,DCBDVOR9         IS DEVICE A 3886        XL03127 05143310
         BNE   SOP50                    NO,BRANCH AROUND        XL03127 05143410
         LA    RF,OCRIBSZ               YES,SET REQ'D SIZE      XL03127 05143510
         B     SOP55                    GO DO GETMAIN           XL03127 05144710
*                                                                       05147510
*                                                                       05148710
*    IF THE DEVICE IS A 3800 PRINTER AND OPTCD=J (DYNAMIC SELECTION     05149910
*    OF TRANSLATE TABLES) HAS BEEN REQUESTED, THEN AN ADDITIONAL 8      05152010
*    BYTES MUST BE GETMAINED IN THE CHANNEL PROGRAM AREA                05156010
*    FOR THE SELECT TRANSLATE TABLE CCW.                                05156810
*                                                                       05157610
SOP50    EQU   *                        NOT 3886                XL03127 05157710
         CLI   DCBDEVT,DCBDVPR5         IS THIS A 3800         @Z40MSMI 05158410
         BNE   SOP51                    NO - CONTINUE          @Z40MSMI 05159210
         TM    DCBOPTCD,DCBOPTJ         OPTCD=J SPECIFIED      @Z40MSMI 05159310
         BZ    SOP54                    NO - ADD 1 CCW         @Z40MSMI 05159510
         B     SOP53                    YES - ADD 2 CCW'S      @Z40MSMI 05159610
SOP51    EQU   *                        NOT 3800               @Z40MSMI 05159710
         TM    PAROPT,PAROUTPT          TEST OPEN OPTIONS               05160010
         BO    SOP54                    OUTPUT ADD 1 CCW                05180010
         BM    SOP53                    IN/OUT OUT/IN ADD 2 CCW'S       05184010
*                                                                       05200000
         TM    DCBMACF1,DCBMRCRL        IS THE CNTRL MACRO USED         05220010
         BO    SOP54                    YES ADD ONE CCW                 05240010
         B     SOP55                    ADD 0 CCW'S                     05260010
*                                                                       05360000
*                                                                       05380000
*********************************************************************** 05400000
*                                                                       05404010
*                 TAPE                                                  05408010
*                                                                       05412010
SOP52    TM    PAROPT,PAROUTPT-PARRDBCK DCB FOR IN/OUT                  05420010
         BM    SOP54                    IN/OUT OUT/IN ADD 1 CCW         05440010
         B     SOP55                    OUTPUT-INPUT-RDBACK ADD 0 CCW'S 05460010
*                                                                       05480000
SOP53    LA    RF,L'CCW(RF)             ADD 8 TO IOB SIZE               05500010
SOP54    LA    RF,L'CCW(RF)             ADD 8 TO IOB SIZE               05520010
SOP55    EQU   *                                                        05560000
         SRL   RF,MULT8                 DIVIDE BY 8                     05580010
         STC   RF,DCBIOBL               STORE LENGTH                    05600000
         SLL   RF,MULT8                 RESET                           05620010
*                                                                       05640000
SOP56    TM    DCBCIND2,DCBCNQSM        DCB USING QSAM                  05660010
         BO    SOP57                    YES BRANCH                      05680010
*                                                                       05700000
         IC    RE,DCBNCP                GET NO. BUFFER TO GEN           05720000
         LTR   RE,RE                    HAS NO. BEEN SPEC.              05740000
         BNZ   SOP58                    YES BRANCH                      05760010
*                                                                       05780000
         LA    RE,1                     SUPPLY 1 IOB                    05800000
         B     SOP58                    SKIP TO NEXT               DM0I 05840000
*                                                                       05860000
SOP57    IC    RE,DCBBUFNO              GET NO OF IOBS TO BUILD         05880000
*                                                                       05900000
*                                                                       05920000
SOP58    LR    RUCB,RE                  SAVE NO AS COUNTER              05940000
         MR    RE,RE                    COMPUTE SPACE REQUIRED          05960000
         LR    RB,RF                    SAVE FOR FUTURE USE             05980000
*                                                                       06000000
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE IOBS YM4697 06010002
*  IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE CLOSE EXECUTOR.  YM4697 06012002
*                                                                       06020000
         ST    RF,DXATEXC2              SAVE LENGTH              YM4697 06030002
*********************************************************************** 06040000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 06050002
*                                                                       06060000
         GETMAIN R,LV=(RF),SP=0                                  Y02072 06080002
*                                                                       06100000
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06110002
*********************************************************************** 06120000
*                                                                       06140000
*                                                                       06160000
         ST    RF,DCBIOBA               SAVE FIRST IOB ADDR             06200000
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 06202002
         LR    RC,RF                   SAVE IOB ADDRESS          A37507 06210021
         LR    RD,RF                    SAVE IOB ADDRESS         M0129  06215021
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 06242002
*********************************************************************** 06262010
*                                                                       06280010
*                   CLEAR GETMAINED AREA                                06300010
*                                                                       06320010
         SR    RJ,RJ                    SET FROM LENGTH TO ZERO         06340010
         LR    RE,RF                    SET ADDRESS TO AREA OBTAINED    06360010
         LR    RF,RB                    SET LENGTH                      06380010
         MVCL  RE,RD                    CLEAR AREA                      06400010
*                                                                       06500000
*                                                                       06520000
*********************************************************************** 06540000
         CH    RUCB,ONE                 ONE IOB?                 A37507 06540510
         BNE   NTONEIOB                 NO - BRANCH              A37507 06541010
         USING IOBQSAMN,RWK2            ADDRESSABILITY FOR DSECT        06541510
         OI    IOBFLAG1,IOBUNREL        YES - SET UNRELATED FLG  Y02072 06542010
         DROP  RWK2                                                     06542502
NTONEIOB EQU   *                                                 A37507 06543021
         CLI   DCBDEVT,DCBDVOR9         DCB FOR 3886 OCR?       XL03127 06543410
         BE    SOP500                   YES,GOTO UR EXEC        XL03127 06543802
         TM    DCBDEVT,DCBDVPTP         DCB FOR PAPER TAPE?      A37507 06544010
         BO    SOP505                   YES, CONTINUE            A37507 06548010
         TM    DCBDEVT,URBITS           DCB FOR UNIT RECORD?     A37507 06552010
         BZ    SOP505                   NO, CONTINUE             A37507 06556010
SOP500   EQU   *                                                 Y02072 06558002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06558102
         MVC   WTGIDTTR,SOPUNREC        YES, LOAD ID OF UNIT   @Z30TSMI 06560010
*                                       RECORD MODULE IGG0196K   A37507 06564010
         STC   RUCB,DCBIOBA             SAVE NO. OF IOB'S FOR    M0063  06569010
*                                       MOD IGG0196K             M0063  06570010
         B     RELOOP                                            A37507 06572021
SOP505   EQU   *                                                 A37507 06576021
         LR    RB,RD                    SAVE IOB ADDRESS         M0129  06586021
         B     SOP512                   MUST BE AT LEAST ONE     A37507 06606010
*                                       IOB, THEREFORE BYPASS    A37507 06616010
*                                       FOLLOWING TEST           A37507 06626010
SOP510   EQU   *                        BEGINNING OF IOB BUILD LOOP     06640010
*                                                                       06680000
         LTR   RUCB,RUCB                TEST FOR LAST IOB      @ZM40309 06686010
         BC    7,SOP512                 BRANCH IF NOT LAST IOB @ZM40309 06692010
         L     RB,DCBIOBA               GET FIRST IOB ADDR              06700000
         USING IOBQSAMN,RD                                              06710010
         ST    RB,IOBNIOBA              LINK FIRST IOB TO LAST          06720010
         DROP  RD                                                       06725010
         USING IOBQSAMN,RB                                              06730010
         OI    IOBNFLG1,IOBFIRST        SET INDICATOR                   06740010
         DROP  RB                                                       06745010
         USING IOBQSAMN,RD                                              06746010
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06750002
         TM    JFCBTSDM,JFCSDS          SYSIN OR SYSOUT                 06760010
         BZ    SOP5180                  NO BRANCH                       06780010
         CLI   DCBRTN2,RTN6             NOTE/POINT SPECIFIED            06800010
         BE    SOP511                   YES BRANCH                      06820010
         CLI   DCBRTN1,RTN9             CONTROL SPECIFIED               06840010
         BNE   SOP5180                  NO BRANCH                       06860010
*                                                                       06880000
SOP511   EQU   *                                                        06890002
         MVI   DCBRTN2,RTN10            STORE DUMMY ID                  06900010
         B     SOP5180                  CHECK FOR QSAM             DM0I 06920000
*                                                                       06940000
*                                                                       06960000
SOP512   EQU   *                                                        06980000
*                                                                       07000000
         ST    RB,IOBNIOBA              LINK THIS IOB TO LAST           07020010
         LR    RD,RB                    UPDATE WORK REG                 07040000
         LA    RB,IOBNECB               POINT TO ECB                    07060010
         OI    IOBNECB,ECBNORM          SET ECB COMPLETE WITHOUT ERROR  07080010
         ST    RB,IOBECBPT              STORE ECB IN POINTER            07100010
         LA    RB,IOBEXTEN              POINT TO CHANNEL PROGRAM (CP)   07160010
         ST    RB,IOBSTART              STORE CP ADDRESS IN IOB         07180010
         L     RWK1,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 07190002
         ST    RWK1,IOBDCBPT            DCB ADDR TO IOB          Y02072 07210002
         MVI   IOBINCAM+1,1             STORE INCREMENT AMOUNT          07220010
*                                                                       07240000
*                                                                       07260000
         LR    RC,RB                    UPDATE REG                      07280000
         USING CCW,RB                                                   07285010
*                                                                       07380000
*********************************************************************** 07400000
*                                                                       07420000
*      THIS SECTION DEALS WITH MAG AND PAPER TAPE CHANNEL PROGRAMS      07440010
*                                                                       07444010
*********************************************************************** 07460000
*                                                                       07470021
*                                                                       07480021
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07482002
         MVI   DCBRTN4,RTN2             EGP2 ID NUMBER                  07500010
         MVI   DCBWCPO,IOBEXTEN-IOBQSAMN STORE FIRST OFFSET             07520010
         MVC   DCBWCPL(3),DCBWCPO       STORE REMAINING TREE            07540000
         MVI   DCBWCPL,1                CHANNEL PROG.IN DOUBLE WORDS    07560010
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 07562002
         TM    PAROPT,PAROUTPT          DCB FOR OUTPUT ONLY             07580010
         BO    SOP523                   YES BRANCH                      07600010
*                                                                       07620000
         TM    DCBRECFM,DCBRECU         U RECORDS USED                  07640010
         BNM   SOP520E                  YES,BRANCH                 DM0I 07660010
         TM    DCBDEVT,DCBDVPTP         TEST FOR DEVICE CODE       DM0I 07680010
         BNO   SOP5201                  NO ,BRANCH                 DMOI 07700010
         TM    DCBCIND2,DCBCNQSM        TEST                       DM0I 07720010
         BZ    SOP5201                  NO,BRANCH                  DM0I 07740010
         TM    DCBCODE,X'FE'-DCBPTCDN   TEST FOR TRANSLATE REQUEST DMOI 07760010
         BZ    SOP5201                  NO                         DM0I 07780000
         B     SOP520M                  YES                        DM0I 07800000
*                                       REMARKS                    DM0I 07820000
SOP520E  EQU   *                        ZERO                       DM0I 07840000
         TM    DCBDEVT,DCBDVPTP         PAPER TAPE                 DM0I 07860010
         BNO   SOP520M                  NO                         DM0I 07880010
         OI    CCWCOMCD,EOR             SET BIT IN READ CCW        DM0I 07900010
SOP520M  EQU   *                        HERE AGAIN                 DM0I 07920000
         OI    CCWFLGS,CCWSLI           SET SLI BIT FOR TYPE 4 REC.DM0I 07940010
*                                       PAPER TAPE FIXED TRANSLATE.     07980010
SOP5201  EQU   *                                                        08000000
         TM    DISPSN(PARAR),X'03'     BACKWARDS INPUT       @ZA27760   08020037
         BNM   SOP521                  BRANCH NOT MIXED      @ZA27760   08030037
*                                                                       08060000
         MVI   CCWCOMCD,READBACK        STORE RD BACK CMD BYTE          08080010
*                                                                       08100000
         B     SOP521AA                                                 08120010
*                                                                       08140000
SOP521   EQU   *                                                        08160000
         OI    CCWCOMCD,READ            SET READ OP CODE                08180010
SOP521AA EQU   *                                                        08181010
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 08182002
         TM    DCBMACF1,DCBMRPT1        NOTE-POINT NEEDED               08200010
         BZ    SOP521A                  NO  BRANCH TO TEST CONTROL      08220010
         TM    DCBDEVT,DCBDVPTP         DCB FOR PAPER TAPE              08240010
         BO    SOP522                   YES,  LEAVE DUMMY ID            08260010
*                                       IN DCBCNTRL+1                   08280000
         MVI   DCBRTN2,RTN6             TAPE NOTE/POINT ID              08300010
         B     SOP522                   GO ON                      DM0I 08320000
SOP521A  EQU   *                                                        08340000
         TM    DCBMACF1,DCBMRCRL        CNTRL FOR TAPE NEEDED           08360010
         BZ    SOP522                   NO BRANCH                       08380010
         MVI   DCBRTN1,RTN9             CNTRL TAPE ID NUMBER            08400010
*                                                                       08420000
SOP522   LA    RB,L'CCW(RB)             UPDATE CP.ADDRESS               08440010
         TM    PAROPT,PAROUTPT-PARRDBCK DCB FOR IN/OUT                  08460010
         BZ    SOP524                   NO BRANCH                       08480010
*                                                                       08500000
         MVI   DCBRTN3,RTN2             SECOND EOB RT (IN-OUT)          08520010
         MVI   DCBWCPO,IOBEXTEN-IOBQSAMN+L'CCW UPDATE OFFSETS           08540010
         MVI   DCBOFFSW,IOBEXTEN-IOBQSAMN+L'CCW                         08560010
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 08570002
SOP523   EQU   *                                                 Y02072 08574002
         MVI   CCWCOMCD,WRITE           STORE WRT CMD BYTE              08580010
         OI    CCWFLGS,CCWSLI           SET SLI FLAG IN WRT CCW         08600010
         LA    RB,L'CCW(RB)             UPDATE TO NEXT IOB              08620010
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 08622002
         TM    DCBMACF2,DCBMRPT2        NOTE-POINT NEEDED               08640010
         BZ    SOP523A                  NO BR TO TEST FOR CNTRL         08660010
         MVI   DCBRTN2,RTN6             NPT2 ID NUMBER                  08680010
         B     SOP524                   GO ON                      DM0I 08700000
SOP523A  TM    DCBMACF2,DCBMRCTL        CNTRL MACRO USED                08720010
         BZ    SOP524                   NO BRANCH                       08740010
         MVI   DCBRTN1,RTN9             CNTRL TAPE ID NUMBER            08760010
*                                                                       08780000
SOP524   EQU   *                                                        08800000
*                                                                       08820000
         MODESET  KEYADDR=DXUKEY,WORKREG=11 GET INTO USER KEY    Y02072 08822002
         BCTR  RUCB,0                   DECREMENT IOB COUNTER  @ZM40309 08840010
         B     SOP510                   GO BUILD NEXT IOB      @ZM40309 09840010
*                                                                       11780000
SOP5180  EQU   *                                                        11800000
*                                                                       11820000
         MODESET EXTKEY=DATAMGT                                         11870010
         MVC   WTGIDTTR,SOPSLDFT        XCTL TO LOAD 1910      @Z30TSMI 11970010
         TM    DCBRECFM,DCBRECF         FIX FORMAT                 DM0I 12164010
         BO    SOP5STOP                 YES, BRANCH                DM0I 12166000
         TM    DCBRECFM,DCBRECV+DCBRECD V OR D FORMAT RECORDS    S20038 12168010
         BZ    SOP5STOP                 NO, BRANCH                 DM0I 12170000
         MVC   WTGIDTTR,SOPSLDVT        XCTL TO LOAD 1915      @Z30TSMI 12170410
SOP5STOP EQU   *                                                        12280000
*                                                                       12300000
         TM    DCBDEVT,DCBDVPTP         PAPER TAPE DEVICE               12340010
         BNO   RELOOP                   BRANCH ON NO                    12360010
         MVC   WTGIDTTR,SOPPTLD         YES, USE ALTER LOAD ID @Z30TSMI 12370003
         MVI   DCBPTFLG,0               INITIALIZE PAPER TAPE FLAGS     12400010
*                                                                       12420000
*                                                                       12440000
*********************************************************************** 12460000
*                                                                       12480000
*                                                                       12500000
RELOOP   LA    RWTGC,WTGEND             INCREMENT CURR WTG ENTRY        12520010
         LA    RPARC,L'PARDCBAD(0,RPARC) INCR CURRENT DCB ENTRY PRTR    12540010
         CLC   WTGID,AMIDCNST           THIS RT NEEDED AGAIN            12560010
         BER   RBASE                    BACK TO OPEN CONTROL ROUTINDM0I 12580010
*                                                                       12600000
         CLC   WTGID,OPIDCNST           END OF TABLE                    12620010
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             12640010
*                                                                       12660000
         LR    RPARC,RPAR               REINITIALIZA PARM LIST PTR      12680010
         DROP  RWTGC                                                    12690010
         LA    RWTGC,WTGENTRY           REINITIALIZE WTG LIST PTR       12700010
         USING WTGENTRY,RWTGC                                           12710010
ZCHEK    CLI   WTGENTRY,0               ENTRY COMPLETE             DM0I 12720010
         BNE   TCTLRTN                  IF NOT TRANSFER CONTROL         12740010
*                                                                       12760000
         LA    RWTGC,WTGEND             GET NEXT ENTRY                  12780010
         LA    RPARC,L'PARDCBAD(0,RPARC) GET NEXT PARM ENTRY            12800010
         B     ZCHEK                    ZERO CHECK                 DM0I 12820000
*                                                                       12840000
TCTLRTN  EQU   *                                                        12860000
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSMI*12930003
               MODID=WTGENTRY           GO TO NEXT ROUTINE     @Z30TSMI 12980003
**                                                                      13000000
*                                                                       13020000
*********************************************************************   13040000
*                                                                       13060000
OPIDCNST DC    C'0S'                    ID                         DM0I 13140000
AMIDCNST DC    C'1G'                    ID                         DM0I 13160000
SOPUNREC DC    C'6K',VL3(IGG0196K)      UNIT REC EXECUTOR      @Z30TSMI 13162003
SOPSLDVT DC    C'15',VL3(IGG01915)      VAR LEN RECORDS        @Z30TSMI 13164003
SOPSLDFT DC    C'10',VL3(IGG01910)      FIXED LEN RECORDS      @Z30TSMI 13166003
SOPPTLD  DC    C'12',VL3(IGG01912)      PAPER TAPE             @Z30TSMI 13168003
ONE      DC    H'1'                     USED FOR ONE IOB TEST    A37507 13168810
PATCH    DC    25H'0'                   PATCH AREA               Y02072 13188810
END      EQU   *                                                        13200010
         EJECT                                                          13300010
         IHACCW                                                         13400010
         EJECT                                                          13500010
CVT      DSECT                                                          13600010
         CVT                                                            13700010
         EJECT                                                          13800010
         DCBD  DSORG=PS                                                 13900010
         ORG   DCBCNTRL                                                 14000010
DCBRTN1  DS    X                                                        14100010
DCBRTN2  DS    X                                                        14200010
DCBRTN3  DS    X                                                        14300010
DCBRTN4  DS    X                                                        14400010
RTN1     EQU   1                        ROUTINE 1 ID                    14500010
RTN2     EQU   2                        ROUTINE 2 ID                    14600010
RTN3     EQU   3                        ROUTINE 3 ID                    14700010
RTN4     EQU   4                        ROUTINE 4 ID                    14800010
RTN5     EQU   5                        ROUTINE 5 ID                    14900010
RTN6     EQU   6                        ROUTINE 6 ID                    15000010
RTN7     EQU   7                        ROUTINE 7 ID                    15100010
RTN8     EQU   8                        ROUTINE 8 ID                    15200010
RTN9     EQU   9                        ROUTINE 9 ID                    15300010
RTN10    EQU   10                       ROTUINE 10 ID                   15400010
         EJECT                                                          15500010
         IECDSECS (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES              15600010
         ORG   WTGIDTTR                                                 15700010
WTGID    DS    CL2                                                      15800010
         EJECT                                                          15900010
FORCORE  DSECT                                                          15920010
         IHAFCAUD ORG=YES                                               16000010
         EJECT                                                          16100010
         IGGPARML                                                       16200010
         END                                                            16300010
