         TITLE 'IGG0191S, LEVEL 2 EXEC FOR D.A. WITH TRACK OVERFLOW.'   00030002
         MACRO                                                          00032002
&NAME    IF    &A,&IS=,&ISNOT=,&GOTO=                                   00040000
         LCLB  &NOERR                                                   00060000
&NOERR   SETB  1                                                        00080000
         AIF   ('&A' NE '').SKIP                                        00100000
         MNOTE 'TEST  ADDRESS NOT SPECIFIED.'                           00120000
&NOERR   SETB  0                                                        00140000
.SKIP    AIF   ('&GOTO' NE '').SKIP2                                    00160000
         MNOTE 'BRANCH ADDRESS MISSING.'                                00180000
&NOERR   SETB  0                                                        00200000
.SKIP2   AIF   ('&IS' NE '' OR '&ISNOT' NE '').SKIP3                    00220000
         MNOTE 'TEST CONDITION NOT SPECIFIED.'                          00240000
&NOERR   SETB  0                                                        00260000
.SKIP3   AIF   (&NOERR).SKIP4                                           00280000
         MEXIT                                                          00300000
.SKIP4   AIF   ('&IS' EQ '').NOIS                                       00320000
***                                                                     00340000
&NAME    TM    &A,&IS                                                   00360000
         BO    &GOTO                                                    00380000
***                                                                     00400000
         MEXIT                                                          00420000
.NOIS    ANOP                                                           00440001
***                                                                     00460000
&NAME    TM    &A,&ISNOT                                                00480000
         BZ    &GOTO                                                    00500000
***                                                                     00520000
         MEND                                                           00540000
IGG0191S CSECT                                                          00560000
*MODULE NAME - IGG0191S                                          Y02072 00560402
*                                                                       00560802
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00561202
*                                                                       00561602
*COPYRIGHT - NONE                                                Y02072 00561702
*                                                                       00561802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00561902
*                                                                       00562002
*        VS 1 RELEASE 3 DELETIONS/CHANGES                               00562102
*                                                                XA2992 00562202
*        VS2 RELEASE 2 DELETIONS                                 Y02072 00562402
*005520,006000,043120,043300-043360,069780-069800,079580,70400,  Y02072 00562802
*70700,74600,75600,104400,104600                                 Y02072 00564802
*                                                                YM4697 00566802
*                                                                       00568803
*        VS2 RELEASE 3 DELETIONS                                        00569203
*                                                              @Z30TSCF 00569603
*        OS RELEASE 21 DELETIONS                                 Y02072 00570302
*0083079040-080000                                               A37507 00577802
*   REFER TO CODE FLAGGED XA2992                                SA62479 00578202
*        OS RELEASE 20 DELETIONS                                        00579802
*3004058400,061800,067800-068200,068600,068800-069800,070600,    S20201 00585202
*3004079000,080000                                               S20201 00592602
*A3540100,A5000100-5000900 OX20778 FLAGGED AS------------------@ZA29383 00593637
*                                                                       00594637
*                                                                       00595637
*STATUS CHANGE LEVEL 003                                                00600002
* THIS EXECUTOR RUNS IN TANDEM WITH IGG0191H, WHICH GETS CORE FOR AND   00620000
* COMPLETES BUILDING THE IOB/CP'S.                                      00640000
*                                                                       00660000
* THE MAJOR FUNCTIONS OF THIS EXEC ARE-                                 00680000
*                                                                       00700000
* 1. STORE THE ID'S FOR THE EOB, NOTE/POINT ROUTINES REQ'D.             00720000
* 2. COMPLETE THE DCB FIELDS KNOWN PRIOR TO GETTING CORE FOR IOB/CP'S.  00740000
* 3. REPEAT FOR EACH DCB BEING OPENED.                                  00760000
* 4. CALCULATE AMOUNT OF CORE NEEDED FOR IOB'S AND GETMAIN IT    Y02072 00770002
* 5. SET AN AUDIT TRAIL BIT IN THE OPEN WORKAREA INDICATING      Y02072 00772002
*    TO FORCE CLOSE THAT THE CORE GETMAINED FOR THE IOB'S CAN    Y02072 00774002
*    BE FREEMAINED.                                              Y02072 00776002
*                                                                       00780000
* ENTRY POINTS- FROM IGG0191B BY XCTL.                                  00800000
*                                                                       00820000
* EXITS- TO IGG0191H BY XCTL                                            00840000
*        TO IGG0199K IF SEARCH DIRECT                                   00850020
*                                                                       00860000
*INPUT-REGISTERS WITH THE ADDRESSES OF THE FOLLOWING-                   00880000
*   THE PARAMETER LIST  (POINTERS TO TOP AND CURRENT ENTRY).            00900000
*   THE WHERE-TO-GO TABLE (WTG) (POINTERS TO TOP AND CURRENT).          00920000
* EXTERNAL ROUTINES- NONE.                                              00940000
* ATTRIBUTES- REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY   Y02072 00960002
*             UNLESS OTHERWISE SPECIFIED, RUNS IN SUPER STATE    Y02072 00970002
* TABLES/WORKAREAS-                                                     00980000
*                                                                       00990002
*MACROS : ACTION - MODESET, XCTL, XCTLTABL, GETMAIN              Y02072 00992002
*                                                                       01000000
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              01020000
*      BYTE  0-7  NAME                                                  01040000
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            01060000
*      BYTE 11    CONCATENATION NUMBER                                  01080000
*      BYTE 12    ZERO                                                  01100000
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       01120000
*                        ALIAS INDICATOR 1 BIT                          01140000
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      01160000
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              01180000
*      BYTE 17    ZERO                                                  01200000
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      01220000
*      BYTE 20    TRANSLATION TABLE                                     01240000
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            01260000
*      BYTE 22-23 ATTRIBUTES                                            01280000
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     01300000
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           01320000
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 01340000
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        01360000
*      BYTE 32-34 IDTTR OF EXECUTOR FOR FIRST DCB                       01380000
*      BYTE 35    WORKAREA ADDRESS FOR FIRST DCB                        01400000
*      BYTE 36-39 TABLE OF IDTTR'S                                      01420000
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR  N TH DCB  (3 BYTES)          01440000
*                   WORKAREA ADDRESS FOR N TH DCB    (1 BYTE )          01460000
*                   IDTTR OF LAST ROUTINE LOAD       (3 BYTES)          01480000
*                   NOT USED                         (1 BYTE)           01500000
*                                                                       01520000
*    WORKAREA- SEE 'FORCORE DSECT' (IECDSECT) IN THIS LISTING           01540000
*                                                                       01560000
*TABLES/WORKAREAS- PARAMETER LIST                                       01580000
*                                                                       01600000
*WORD ZERO                                                              01620000
*      BYTE  0    OPEN ATTRIBUTE  (INPUT, OUTPUT, UPDATE, IN/OUT,       01640000
*                                  OUT/IN, READ BACKWD, LEAVE , REREAD) 01660000
*      BYTES 1-3  DCB ADDRESS FOR FIRST DCB BEING OPENED.               01680000
*                                                                       01700000
*THE PARAMETER LIST HAS A ONE WORD ENTRY FOR EACH DCB BEING OPENED. THE 01720000
*FORMAT IS THE SAME AS WORD ZERO.                                       01740000
*END PARAMETER LIST.                                                    01760000
*                                                                       01780000
* REGISTER CONVENTIONS USED IN ALL OF OPEN-                             01800000
*                                                                       01820000
RDCB     EQU   2                        DCB REGISTER                    01840000
RBASE    EQU   3                        BASE REGISTER                   01860000
RCORE    EQU   4                        I/O SUPPORT WORK AREA           01880000
RA       EQU   RCORE                    USED FOR WORK REG UNTIL RCORE   01900000
*                                       IS NEEDED IN WTG LOGIC.         01920000
RVALCHK  EQU   RA                       VALIDITY CHECK CP BASEREG,      01940000
*                                       USES 'VCMAP' DSECT.             01960000
RPAR     EQU   5                        TOP OF PARAMETER LIST           01980000
RWTG     EQU   6                        TOP OF WTG TABLE                02000000
RPARC    EQU   7                        CURRENT PARAMETER               02020000
RWTGC    EQU   8                        CURRENT LOAD IN TRANSIENT AREA  02040000
RTIOT    EQU   9                        USED AS A WORK REG              02060000
RIOB     EQU   RTIOT                    USED AS IOB BASE REG WITH THE   02080000
*                                       IOB OVERLAY FROM FORECORE.      02100000
RUCB     EQU   10                       USED AS A WORK REG              02120000
RCPSIZE  EQU   RUCB                     USED TO CALCULATE AND HOLD THE  02140000
*                                       CHANNEL PGM SIZE.               02160000
RDEB     EQU   11                       DEB BASE REG.                   02180000
RB       EQU   12                       WORK REG.                       02200000
RCPBASE  EQU   RB                       CHANNEL PGM BASE REG USED WITH  02220000
*                                       'CPSEGMAP' DUMMY SECTION.       02240000
RC       EQU   13                       WORK REG.                       02260000
RSTEPPER EQU   RC                       POINTS TO THE CURRENT SEARCH    02280000
*                                       ADDRESS OR COUNT FIELD BEING    02300000
*                                       USED FOR CP CONSTRUCTION. WHEN  02320000
*                                       POINTING TO A COUNT FLD THE     02340000
*                                       'COUNTFLD' DUMMY SECTION IS     02360000
*                                       USED BASED ON THIS REG.         02380000
*                                                                       02400000
RE       EQU   0                        WORK REG. VOLATILE ACCROSS SVC. 02420000
RF       EQU   1                        WORK REG. VOLATILE ACCROSS SVC. 02440000
RD       EQU   14                       WORK REG. VOLATILE ACCROSS SVC. 02460000
RJ       EQU   15                       WORK REG. VOLATILE ACCROSS SVC. 02480000
*                                                                       02500000
*                                                                       02520000
* MASK CONFIGURATIONS FOR TESTING THE HI ORDER BYTE OF EACH PARAMETER   02540000
* LIST ENTRY. SIGNIFICANCE IS THE SAME AS THE DEB OPEN ATTRIBUTE FIELD. 02560000
*                                                                       02580000
INPUT    EQU   X'0F'                    TEST MASKED BITS FOR ZEROS.     02600000
OUTPUT   EQU   X'0F'                    TEST MASKED BITS FOR ONES.      02620000
INOUT    EQU   X'03'                                                    02640000
OUTIN    EQU   X'07'                                                    02660000
RDBACK   EQU   X'01'                                                    02680000
UPDAT    EQU   X'04'                                                    02700000
LEAVE    EQU   X'10'                                                    02720000
REREAD   EQU   X'30'                                                    02740000
*                                                                       02760000
* COMMAND CODES FOR THE 2841 CONTROL UNIT.                              02780000
*                                                                       02800000
SRCHEQ   EQU   X'31'                    SEARCH EQUAL ID.                02820000
SRCHEQMT EQU   X'B1'                    SEARCH EQUAL ID IN MULTI-TRACK. 02840000
TIC      EQU   X'08'                    TRANSFER IN CHANNEL.            02860000
WCKD     EQU   X'1D'                    WRITE COUNT, KEY, AND DATA.     02880000
WSCKD    EQU   X'01'                    WRITE SPECIAL, COUNT,KEY,DATA.  02900000
SEEKCYL  EQU   X'0B'                    SEEK CYLINDER.                  02920000
READDATA EQU   X'06'                    READ DATA SINGLE TRACK.         02940000
RDDATAMT EQU   86                       MULTI-TRACK READ DATA.          02960000
READKD   EQU   14                       READ KEY AND DATA.              02980000
READCT   EQU   X'92'                    READ COUNT M/T MODE.            03000000
*                                                                       03020000
* CHANNEL COMMAND WORD FLAGS.                                           03040000
*                                                                       03060000
SKIP     EQU   X'10'                    SKIP FLAG.                      03080000
SILI     EQU   X'20'                    SUPPRESS INCORRECT LENGTH IND.  03100000
CC       EQU   X'40'                    COMMAND CHAIN.                  03120000
DC       EQU   X'80'                    DATA CHAIN.                     03140000
SILICC   EQU   X'60'                    SILI AND CC TOGETHER            03160000
SILICCSK EQU   X'70'                    SILI, CC, AND SKIP.             03180000
* END CCW FLAGS.                                                        03200000
*                                                                       03220000
*                                                                       03240000
* MISCELLANEOUS ITEMS.                                                  03260000
*                                                                       03280000
COMPNOER EQU   X'7F'                   USED TO INIT. ECB.               03300000
DCANDCC  EQU   X'C0'                    USED TO SET IOBFLAG1.           03320000
IDLENGTH EQU   X'05'                    NMBR OF BYTES IN A 'CCHHR'.     03340000
POINT    EQU   X'04'                    DCBMACRF IF NOTE/POINT USED.    03360000
QSAM     EQU   X'01'                    QSAM BIT IN DCBIND2.            03380000
*                                                                       03400000
NPD2     EQU   5                        NOTE/POINT FOR PCI,UPD,T.O.     03420000
EPDT     EQU   9                        EOB FOR T.O.                    03440000
EGP2     EQU   8                        EOB FOR D.A. INPUT.             03460000
*                                                                       03480000
*                                                                       03500000
VALCHK   EQU   X'80'                    MASK TO DETERMINE IF WRITE      03520000
*                                       VALIDITY CHECK OPTION CALLED.   03540000
TBOVHD   EQU   X'08'                    FLAG FOR 2 BYTE OVERHD @ZA29383 03550037
IOBSIZE  EQU   48                       LENGTH OF A STANDARD IOB WITH   03560000
*                                       BSAM/QSAM/BPAM EXTENSION.       03580000
IOBDBLWD EQU   6                        NMBR OF DBL WDS IN IOB.         03600000
OFFSW    EQU   24                       OFFSET OF CCW THAT WRITES DATA. 03620000
OFFSR    EQU   32                       OFFSET OF THE READ CCW THAT     03640000
*                                       RECEIVES THE BLOCK LENGTH TO    03660000
*                                       BE READ.                        03680000
CPSEGLEN EQU   32                       LENGTH OF ONE CP SEGMENT.       03700000
NOTZERO  EQU   7                        CONDITION MASK USED AFTER       03720000
*                                       ARITHMETIC INSTRUCTIONS FOR THE 03740000
*                                       NOT-ZERO TEST.                  03760000
BBCCHH   EQU   6                        MIN. SEEK LENGTH.               03780000
*                                                                       03800000
ZERO     EQU   X'00'                    AN IMMEDIATE BYTE OF ZERO'S.    03820000
TWO      EQU   2                        NO. OF CCWS FOR RCD      S20201 03820820
*                                       READY                    S20201 03821620
*                                       READY FEATURE PER SEGMENT       03822420
THREE    EQU   3                        NO. OF DW REQUIRED FOR   S20201 03823220
*                                       RCD                      S20201 03824020
D0       EQU   0                        NO DISPLACEMENT          S20201 03824820
D1       EQU   1                        DISPLACEMENT OF ONE      S20201 03825620
D2       EQU   2                        DISP AND COUNT OF TWO    S20201 03826420
WDLEN    EQU   4                        DISPLACEMENT OF ONE WD   S20201 03827220
B5       EQU   5                        BYTE COUNT OF FIVE       S20201 03828020
D6       EQU   6                        DISPLACEMENT OF SIX      S20201 03828820
SXTN     EQU   16                       ADDED LENGTH OF A CHP    S20201 03829620
*                                       SEG-                     S20201 03830420
*                                       MENT IF RCD READY USED          03831220
B24      EQU   24                       ADDITIONAL BYTES IN RD   S20201 03832020
*                                       PROG                     S20201 03832820
*                                       FOR RECORD READY FEATURE        03833620
*                                                                       03834420
NORCDRY  EQU   X'20'                    NO RCD READY MASK        S20201 03835220
SDOPT    EQU   X'01'                    SEARCH DIRCT OPTION MASK S20201 03836020
SDFLG    EQU   X'08'                    SEARCH DIRECT INDICATOR  S20201 03836820
*                                                                       03837620
MAX      EQU   256                      MAX COUNT FOR SS INST    S20201 03838420
EIGHT    EQU   8                        LENGTH OF A COUNT FIELD.        03840000
ANYZERO  EQU   14                       MASK FOR MIXED OR ZEROS.        03860000
FIRST    EQU   X'01'                    USED TO SET IOB FLAG IN FIRST   03880000
*                                       IOB AND INIT. 'R'.              03900000
READCPL  EQU   40                       NMBR OF BYTES IN READ CP.       03920000
RCPDBLWD EQU   5                        NMBR OF DBL WDS IN RCP.         03940000
REMNANT  EQU   READCPL-OFFSR            OFFSR+REMNANT=READCPL.          03960000
OPCODE   EQU   0                        OFFSET OF CCW OPCODE(IN CCW).   03980000
ADDRESS  EQU   0                        OFFSET OF ADDRESS IN CCW        04000000
*                                       (IMPLIES THAT THE ADDRESS MUST  04020000
*                                       BE PUT IN BEFORE THE OP CODE)   04040000
FLAGS    EQU   4                        CCW FLAG BYTE.                  04060000
LENFLD   EQU   6                        START OF LENGTH FLD IN CCW.     04080000
U        EQU   X'C0'                    CODE FOR DCBRECFM=U             04100000
UNRELFLG EQU   X'02'                   IOB UNRELATED FLAG        A37507 04110021
*                                                                       04120000
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY.       04140000
         USING SOP1S,RBASE                                              04160000
         USING FORCORE,RCORE                                     Y02072 04170002
*                                                                       04180000
         USING IHADCB,RDCB              DCB ADDRESSABILITY.             04200000
*                                                                       04220000
*                                                                       04240000
SOP1S    EQU   *                                                        04260000
*                                                                       04280000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 04290002
         DC    C'IGG0191S'              MODULE NAME              Y02072 04292002
         DC    C'@ZA29393'              LAST SHIP CODE         @Z30TSCF 04294037
         DC    C'01/18/78'              LAST DATE MODIFIED     @Z30TSCF 04295037
BEGIN    DS    0H                                                Y02072 04298002
*                                                                       04298402
         L     RDCB,0(RPARC)            GET DCB ADDRESS FROM PARM. LIST 04300000
         L     RCORE,WDLEN(RWTGC)       COMMON WORK AREA         S20201 04310020
         L     RDEB,DCBDEBAD            DEB ADDRESSABILITY.             04320000
         USING DEB,RDEB                                                 04340000
         TM    DCBRECFM,U               U FORMAT                 S20201 04343020
         BM    OKRR                     BRANCH IF NO             S20201 04346020
         OI    JFCBMASK+D6,NORCDRY      ASSURE RCD READY NOT     S20201 04349020
*                                       USED                     S20201 04352020
OKRR     EQU   *                                                 S20201 04355020
         XC    DCBCNTRL,DCBCNTRL        CLEAR FOR LATER USE      XA2992 04355402
*                                                                       04357002
*  ISURE NOTE/POINT ROUTINE GETS LOADED FOR BPAM                 XA2992 04359002
*                                                                       04359402
         IF    DCBDSORG,ISNOT=DCBDSGPO,GOTO=CHKQSAM              XA2992 04359802
         MVI   DCBCNTRL+1,NPD2          NOTE/POINT INDEX ID      XA2992 04359902
         B     OUTTEST                  BYPASS QSAM TEST FOR PO  XA2992 04366602
CHKQSAM  EQU   *                                                 XA2992 04368602
         IF    DCBCIND2,ISNOT=QSAM,GOTO=OUTTEST                  XA2992 04373302
ISQSAM   IF    DEBOPATB,ISNOT=OUTPUT,GOTO=RCPONLY                       04380000
         B     SOMEOUT                  NOTE/POINT NOT REQ'D.           04400000
OUTTEST  IF    DEBOPATB,IS=OUTPUT,GOTO=PEROUT                           04440000
PERIN    IF    DCBMACRF,ISNOT=POINT,GOTO=INTEST                         04460000
         MVI   DCBCNTRL+1,NPD2          SET NOTE/POINT FOR DISK ID.     04480000
INTEST   IF    DEBOPATB,ISNOT=OUTPUT,GOTO=RCPONLY                       04500000
PEROUT   IF    DCBMACRF+1,ISNOT=POINT,GOTO=SOMEOUT                      04520000
         MVI   DCBCNTRL+1,NPD2          NOTE/POINT LOAD ID.             04540000
SOMEOUT  EQU   *                        NPD2 ID SET AS REQ'D.           04560000
*                                                                       04580000
* OPEN ATTRIBUTES SPECIFY SOME FORM OF OUTPUT (OUTPUT, IN/OUT, OUT/IN). 04600000
* GET A POINTER TO THE DEVICE CHARACTERISTICS TABLE ENTRY FOR THE       04620000
* DEVICE BEING USED.                                                    04640000
*                                                                       04660000
         L     RD,DCBDVTBL              RD POINTS TO THE TABLE ENTRY    04680000
*                                       FOR DEVICE USED.                04700000
*                                                                       04720000
         USING DEVTAB,RD                DEVICE TABLE ADDRESSABILITY.    04740000
*                                                                       04760000
* THE DIRECT ACCESS DEVICE TABLE OVERLAY APPLIES TO THE ENTRY BASED ON  04780000
* REGISTER RD.                                                          04800000
*                                                                       04820000
*CALCULATE THE MAXIMUM NUMBER OF RECORD SEGMENTS REQUIRED TO WRITE THE  04840000
* SPECIFIED BLOCKSIZE. APPLIES TO BSAM AND QSAM.                        04860000
*                                                                       04880000
*                                                                       04900037
         SR    RE,RE                                                    04907037
         LH    RF,DCBBLKSI              GET BLOCKSIZE FROM DCB.         04914037
*                                                                       04921037
* CALCULATE MAXIMUM TRACK CAPACITY BY SUBTRACTING OUT OVERHEAD @ZA29383 04928037
*                                                                       04935037
         LH    RJ,TRKCAP          GET TRACK CAP. FROM DEV TABLE.        04942037
         SR    RB,RB              CLEAR REGISTER               @ZA29383 04949037
         IC    RB,OVERK           GET KEY OVERHEAD             @ZA29383 04956037
         AR    RJ,RB              ADD KEY OVERHD TO TRKCAP     @ZA29383 04963037
         IC    RB,OVERL           GET LAST BLOCK OVERHEAD      @ZA29383 04970037
         TM    DEVFLAG,TBOVHD     IS THIS 2 BYTE OVERHEAD?     @ZA29383 04977037
         BNO   MZ0050             BRANCH IF NO                 @ZA29383 04984037
         LH    RB,OVERI           GET 2 BYTE OVERHEAD          @ZA29383 04991037
MZ0050   EQU   *                                                        04998037
         SR    RJ,RB              SUBTRACT LAST BLOCK OVERHD   @ZA29383 05005037
*                                                                       05020000
* DEVICE TABLE ADDRESSABILITY MAY BE RELINQUISHED                       05040000
*                                                                       05060000
         DROP  RD                                                       05080000
*                                                                       05100000
* DIVIDE BLOCKSIZE BY TRACK CAPACITY.                                   05106037
* REGS RE/RF MUST BE EVEN/ODD PAIR.                                     05112037
*                                                                       05120000
         DR    RE,RJ                    BLOCKSIZE/TRACK-CAPACITY.       05140000
*                                       RF = QUOTIENT.                  05160000
*                                       RE = REMAINDER                  05180000
*                                                                       05200000
* IF REMAINDER IS GREATER THAN 1, ROUND UP THE QUOTIENT.  QUOTIENT      05220000
* VALUE WILL BE ONE LESS THAN MAXIMUM NUMBER OF RECORD SEGMENTS REQ'D.  05240000
*                                                                       05260000
         CH    RE,ONE                   REMAINDER GREATER THAN ONE.     05280000
         BNH   GETCORE                  NO. BRANCH AROUND THE ROUND-UP. 05300000
*                                                                       05320000
         LA    RF,1(RF)                 ROUND UP THE QUOTIENT.          05340000
*                                                                       05360000
GETCORE  EQU   *                                                        05380000
*                                                                       05400000
         LA    RCPSIZE,1(RF)            RF+1 = MAX NMBR OF SEGMENTS.    05420000
*                                                                       05440000
         IF    DCBOPTCD,ISNOT=VALCHK,GOTO=GETCPSIZ                      05460000
*                                                                       05480000
         LA    RCPSIZE,1(RCPSIZE)       ADJUST FOR WRT CHECK SEGMENT.   05500000
*                                                                       05520000
GETCPSIZ EQU   *                                                        05540000
*                                                                       05560000
* RCPSIZE CONTAINS THE MAX NUMBER OF RECORD SEGMENTS, ADJUSTED FOR WRT  05580000
* CHECK OPTION. THIS NUMBER OF CHANNEL PROGRAM SEGMENTS WILL BE BUILT.  05600000
* THE  METHOD WORKS SO LONG AS ALL CHANNEL PROGRAM SEGMENTS ARE EQUAL   05620000
* LENGTHS.                                                              05640000
* RF, THE UNADJUSTED VALUE, IS KEPT FOR USE IN CALCULATING S.A. AND     05660000
* COUNT FIELD CORE SIZE.                                                05680000
*                                                                       05700000
* COMPUTE THE AMOUNT OF CORE (EXPRESSED IN DOUBLE WORDS) NEEDED FOR     05720000
* THE CHANNEL PROGRAM SEGMENTS (FOR ONE IOB).  DONE BY-                 05740000
* (SEGMENT SIZE) TIMES (NMBR OF SEGMENTS) DIVIDED BY 8. SINCE SEGMENT   05760000
* SIZE IS A MULTIPLE OF 8 (4 CCW'S = 32 BYTES) IT SIMPLIFIES TO         05780000
* 32/8 TIMES (NMBR OF SEGMENTS)= SHIFT NMBR OF SEGMENTS LEFT 2 PLACES.  05800000
         SLA   RCPSIZE,2                WRITE CP LENGTH (DBL WDS).      05820000
         LA    RJ,IOBSIZE               STARTING POINT FOR BUILDING     05860000
*                                       VARIOUS OFFSETS                 05880000
         STC   RJ,DCBWCPO               PUT OFFSET IN DCB        S20201 05881020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 05882020
*                                       READY                    S20201 05883020
         BO    NOTRR2A                  BRANCH IF NO             S20201 05884020
         LA    RJ,EIGHT(RJ)             INCREMENT OFFSET PTR     S20201 05885020
         LA    RCPSIZE,D2(RCPSIZE)      INCR IOB SIZE            S20201 05886020
         TM    DCBOPTCD,VALCHK          RCD READY AND VALIDITY   S20201 05887020
*                                       CHK                      S20201 05888020
         BZ    NOTRR2A                  BRANCH IF NO             S20201 05889020
         LA    RCPSIZE,D1(RCPSIZE)      INCR FOR FEAT IN VAL CHK S20201 05890020
NOTRR2A  EQU   *                                                 S20201 05891020
         STC   RCPSIZE,DCBWCPL          PUT LENGTH IN DCB        S20201 05892020
         IF    DEBOPATB,IS=OUTPUT,GOTO=OUTONLY                          05900000
* OPENED FOR IN/OUT OR OUT/IN.                                          05920000
*                                                                       05940000
         MVI   DCBCNTRL+3,EGP2          EOB ID FOR NON-F INPUT.         05960000
         MVI   DCBCNTRL+2,EPDT          EOB ID FOR T.O. OUTPUT.         05980000
         LA    RJ,OFFSR(RJ)             CCW THAT RECEIVES BLOCK LENGTH. 06000000
         STC   RJ,DCBOFFSR              SAVE IT.                        06020000
         LA    RJ,REMNANT(RJ)           MOVE POINTER (RJ) TO WCP.       06040000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06043020
*                                       READY                    S20201 06046020
         BO    NOTRR2C                  BRANCH IF NO             S20201 06049020
         LA    RJ,EIGHT(RJ)             INCR OFFSET PTR          S20201 06052020
NOTRR2C  EQU   *                                                 S20201 06055020
         STC   RJ,DCBWCPO               SAVE IT.                        06060000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06062020
*                                       READY                    S20201 06064020
         BO    NOTRR2G                  BRANCH IF NO             S20201 06066020
         LA    RJ,EIGHT(RJ)             INCR OFFSET PTR          S20201 06068020
         LA    RCPSIZE,D2(RCPSIZE)      INCR IOB SIZE            S20201 06070020
NOTRR2G  EQU   *                                                 S20201 06072020
         LA    RJ,OFFSW(RJ)             CCW THAT RECEIVES BLOCK LENGTH. 06080000
         LA    RCPSIZE,RCPDBLWD(RCPSIZE) ADD NMBR OF CCW'S IN RCP.      06100000
         B     STOREWRT                                                 06120000
OUTONLY  EQU   *                                                        06140000
         MVI   DCBCNTRL+3,EPDT          TRK OVFLO OUTPUT EOB ID.        06160000
         LA    RJ,OFFSW(RJ)             CCW THAT RECEIVES BLOCK LENGTH. 06200000
         STC   RJ,DCBOFFSR              BYPASSED IF RCP PRESENT.        06220000
STOREWRT STC   RJ,DCBOFFSW                                              06240000
         LA    RCPSIZE,IOBDBLWD(RCPSIZE) ADD NMBR OF DBL WDS IN IOB.    06260000
* RCPSIZE HAS IOBL/8+WCPL/8+(READCPL/8 IF REQ'D).                       06280000
* SEARCH ADDRESSES (S.A.) AND COUNT FIELDS ARE 8 BYTES EACH. THERE IS   06300000
* ONE S.A. AND COUNT FIELD FOR EACH C.P. SEGMENT EXCEPT THE FIRST,      06320000
* WHOSE S.A. IS THE IOB FDAD.                                           06340000
* CALCULATE CORESIZE FOR S.A.'S AND COUNT FIELDS AS FOLLOWS-            06360000
*   CALL THE VALUE IN REG RF 'N'. (MAX NMBR OF SEGMENTS MINUS 1)        06380000
*   THERE ARE 2N+1 S.A.'S & COUNT FIELDS (NONE REQ'D FOR VAL CHK).      06400000
*   BUILD THE CORESIZE VALUE IN REG 1 (=RF)                             06420000
*                                                                       06440000
         SLA   RF,1                     MULTIPLY BY 2 = 2N.             06460000
         LA    RF,1(RF)                 ADD 1 GIVES 2N+1                06480000
* ADD THE IOB LENGTH AND CP SIZE (IN DBL WDS) TO THE NUMBER OF S.A.'S   06500000
* AND COUNT FIELDS.                                                     06520000
*                                                                       06540000
         AR    RF,RCPSIZE               (IOB+CP)/8+(2N+1)               06560000
*                                       RE IS FREED.                    06580000
* MULITPLICATION BY 8 EXPRESSES THE IOB/CP SIZE IN BYTES, AND           06600000
* MULTIPLIES THE THE NMBR OF S.A.'S AND COUNT FIELDS BY THEIR SIZE.     06620000
*                                                                       06640000
         B     TIMES8                                                   06660000
RCPONLY  EQU   *                                                        06680000
         MVI   DCBCNTRL+3,EGP2          EOB ID FOR NON-F INPUT.         06700000
* FILL IN DCB FIELDS REQ'D FOR READING ONLY.                            06720000
* DCBOFFSR  (SET DCBOFFSW THE SAME).                                    06740000
* DCBIOBL                                                               06760000
         MVI   DCBOFFSR,IOBSIZE+OFFSR   PUT OFFSET IN DCB        S20201 06800020
         LA    RF,IOBDBLWD+RCPDBLWD     GET NMBR OF DBL WD FOR IOB+CP.  06840000
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06842020
*                                       READY                    S20201 06844020
         BO    NOTRR2K                  BRANCH IF NO             S20201 06846020
         LA    RF,D2(RF)                INCR IOB DW SIZE         S20201 06848020
         MVI   DCBOFFSR,IOBSIZE+OFFSR+EIGHT  PUT NEW OFFSET IN   S20201 06850020
*                                       IOB                      S20201 06852020
NOTRR2K  EQU   *                                                 S20201 06854020
TIMES8   EQU   *                                                 S20201 06855020
         TM    DEBOPATB,OUTPUT          IF OUT ONLY THEN         S20201 06856020
         BO    NOSDIR                   DONT INCR OFFSETS        S20201 06857020
         TM    JFCBMASK+D6,SDFLG        IS SCH DIR SPECIFIED     S20201 06858020
         BZ    NODIRECT                 IF NOT, DONT INCR FOR 2  S20201 06859020
*                                       DOUBLE WORDS                    06860020
         LA    RF,D2(RF)                NEED TWO MORE CCWS       S20201 06861020
         SR    RE,RE                    CLEAR REGISTER           S20201 06862020
         IC    RE,DCBOFFSR              GET READ OFFSET          S20201 06863020
         SH    RE,CON8                  BACK UP A DW             S20201 06864020
         STC   RE,DCBOFFSR              RETURN TO DCB            S20201 06865020
         IC    RE,DCBWCPO               FOR INOUT OT OUTIN (INPU S20201 06866020
         AH    RE,SDINCR16              T ONLY DOESNT MATTER) PT S20201 06867020
         STC   RE,DCBWCPO               TO WRT CP MUST BE INCR   S20201 06868020
*                                       OVER THE 2 DWS SET ASIDE        06869020
*                                       FOR THE S.D. FEATURE.           06870020
*                                       THEY FOLLOW THE RD C.P.         06871020
         IC    RE,DCBOFFSW                  INCREMENT THE OFFSET S20201 06872020
         AH    RE,SDINCR16              TO THE WRITE CHANNEL PGM S20201 06873020
         STC   RE,DCBOFFSW              IF SEARCH DIRECT IS USED S20201 06874020
NOSDIR   EQU   *                                                 S20201 06875020
NODIRECT EQU   *                                                 S20201 06876020
         SR    RE,RE                    REMOVE GARBAGE           S20201 06877020
         STC   RF,DCBIOBL               PUT IOB LENGTH IN DCB    S20201 06878020
         SLL   RF,THREE                 MULTIPLY BY EIGHT        S20201 06880020
         IC    RE,DCBNCP                GET IOB COUNT            S20201 06882020
         TM    DCBCIND2,QSAM            QSAM USED                S20201 06884020
*                                                                       06886020
         BZ    MULT                     BRANCH IF YES            S20201 06888020
         IC    RE,DCBBUFNO              GET CONT FROM BUFR NO    S20201 06890020
MULT     EQU   *                                                 S20201 06892020
         LTR   RE,RE                    IOB CNT SPECIFIED        S20201 06894020
         BP    SPECIF                   BRANCH IF YES            S20201 06896020
         LA    RE,D1                    OTHERWISE FURNISH ONE    S20201 06898020
SPECIF   EQU   *                                                 S20201 06900020
         LR    RIOB,RE                 SAVE NO IOB'S             A37507 06901021
         MR    RE,RE                    MULTIPLY IOB CNT TIMES   S20201 06902020
*                                       NO                       S20201 06904020
*                                                                       06906020
* CHECK FOR RCD READY AND IF USED GET DW FOR THETA VALUES               06908020
*                                                                       06910020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD      S20201 06912020
*                                       READY                    S20201 06914020
         BO    NORRM                    BRANCH IF YES            S20201 06916020
         LA    RF,EIGHT(RF)             INCR SIZE FOR RCD READY  S20201 06918020
NORRM    EQU   *                                                 S20201 06920020
         LR    RC,RF                    SAVE AMT FOR CLEARING    S20201 06922020
         DROP  RDEB                                              Y02072 06922102
*                                                                       06922402
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE IOBS YM4697 06922802
*  IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE CLOSE EXECUTOR.  YM4697 06923202
*                                                                       06923602
         ST    RF,DXATEXC2              SAVE LENGTH              YM4697 06923702
*                                                                       06924020
* GET MAIN FOR IOBS,  RF=RC=AMOUNT                                      06926020
*                                                                       06928020
         MODESET  KEYADDR=DXUKEY,WORKREG=12 GET INTO USER KEY    Y02072 06928402
         GETMAIN R,LV=(RF),SP=0                                  Y02072 06930002
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 06930402
         ST    RF,DCBIOBA               PUT FIRST IOB ADDR IN    S20201 06932020
*                                       DCB                      S20201 06934020
         OI    FCAOPEN,FCAOIOB          INDIC IOB'S CAN BE FREED Y02072 06936102
         MODESET  KEYADDR=DXUKEY,WORKREG=12 GET INTO USER KEY    Y02072 06940202
         USING DEB,RDEB                                          Y02072 06942302
         LR    RB,RF                    COPY ADDR USE TO CLR     S20201 06944402
*                                                                       06946502
* CLEAR OF RECEIVED CORE    RB=ADDRESS,  RC=AMOUNT                      06948602
*                                                                       06950702
         LR    RJ,RC                    COPY AMOUNT              S20201 06952802
         LA    RD,MAX                   CONSTANT OF 256          S20201 06954902
         B     CLEAR                    BRANCH                   S20201 06957002
SOP1SLO  XC    D0(D1,RB),D0(RB)         CLEARS REMAINING BYTES   S20201 06959102
SOP1SHI  XC    D0(MAX,RB),D0(RB)        CLEARS 256 BYTES         S20201 06961202
         AR    RB,RD                    ADD 256 TO ADDR          S20201 06963302
CLEAR    SR    RC,RD                    SUB 256 FROM AMT         S20201 06965402
         BH    SOP1SHI                  IF AMT GT 256 BRANCH     S20201 06967502
         AR    RC,RD                    CORRECT AMT              S20201 06969602
         BCTR  RC,RE                    REDUCE BY ONE BYTE, RE=0 S20201 06971702
         EX    RC,SOP1SLO               CLEAR REMAING BYTES      S20201 06973802
*                                                                       06975902
* SET UP THETA ADDRS, MAY BE USED LATER                                 06978002
*                                                                       06980102
         AR    RJ,RF                    GET AREA + 1 ADDR        S20201 06982202
         LA    RD,EIGHT                 CONSTANT OF EIGHT        S20201 06984302
         SR    RJ,RD                    BACKUP ONE DW            S20201 06986402
         CH    RIOB,ONE                ONE IOB?                  A37507 06988502
         BNE   NTONEIOB                NO - BRANCH               A37507 06990602
         USING SAMSIOB,RF              ADDRESSABILITY FOR DSECT  A37507 06992702
         OI    IOBFLAG1,UNRELFLG       YES - TURN ON IOB         A37507 06994802
*                                       UNRELATED FLG            A37507 06996902
         DROP  RF                                                A37507 06999002
NTONEIOB EQU   *                                                 A37507 07001102
*                                                                       07003202
* WTG LOGIC GOES HERE                                                   07005302
*                                                                       07007402
STOPSOP6 EQU   *                                                 S20201 07009502
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 07011602
         DROP  RDEB                                              S20201 07013702
         ST    RJ,DXCCW11               SAVE SECTOR ADDRESS      Y02072 07015802
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESSABILITY.   07017902
         USING FORCORE,RCORE                                     Y02072 07020002
         USING WTGENTRY,RWTGC                                    Y02072 07030002
         MVC   WTGIDTTR,NEXTEXEC        GET NEXT EXEC ID.      @Z30TSCF 07032003
         TM    JFCBMASK+D6,SDFLG        IF SCH DIRECT IS NOT     S20201 07048020
         BZ    NODERECT                  SPECIFIED OR IF DCB IS  S20201 07052020
         TM    DEBOPATB,OUTPUT           OPENED FOR OUTPUT ONLY, S20201 07056020
         BO    NODERECT                  THEN GO XCTL TO MODULE  S20201 07060020
*                                       IGG0191H, ELSE TO MOD           07064020
*                                        IGG0199K                       07068020
         MVC   WTGIDTTR,SDEXEC          SEARCH DIRECT EXEC     @Z30TSCF 07070003
NODERECT EQU   *                                                 S20201 07076020
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY.    07080000
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY PTR 07100000
         CLC   0(2,RWTGC),AMIDCNST      IS THIS RTN NEEDED AGAIN?       07120000
         BCR   8,RBASE                                                  07140000
*                                                                       07160000
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE?                   07180000
         BC    7,RELOOP                 NO, CHECK NEXT ENTRY.           07200000
*                                                                       07220000
         LR    RPARC,RPAR                                               07240000
         LA    RWTGC,WAOFF(0,RWTG)      REINIT. WTG LIST PTR.           07260000
ZCHEK    CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETE?         07280000
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL.        07300000
*                                                                       07320000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY.                 07340000
         LA    RPARC,PLOFF(0,RPARC)                                     07360000
         BC    15,ZCHEK                                                 07380000
*                                                                       07400000
TCTLRTN  EQU   *                                                        07420000
         USING WTG,RWTG                                                 07470003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*07520003
               MODID=WTGENTRY                                  @Z30TSCF 07570003
         DROP  RWTGC,RWTG                                      @Z30TSCF 07572003
*                                                                       07580000
* END WTG LOGIC. *****                                                  07600000
*                                                                       07620000
ONE      DC    H'1'                     G.P. CONSTANT.                  07640000
*                                                                       07660000
*                                                                       07680000
* WTG CONSTANTS AND EQUATES.                                            07700000
*                                                                       07720000
WAOFF    EQU   32                                                       07740000
PLOFF    EQU   4                                                        07760000
WGOFF    EQU   8                                                        07780000
OPIDCNST  DC   C'0S'                                                    07800000
AMIDCNST DC    C'1S'                    IDTTRL                          07820000
*                                                                       07840000
* END WTG CONSTANTS.                                                    07860000
*                                                                       07880000
CON8     DC    H'8'                     CONSTANT OF EIGHT        S20201 07886020
SDINCR16 DC    H'16'                    TWO DWS FOR S.D. COUNT   S20201 07892020
*                                         FIELD INCREMENT               07898020
SDEXEC   DC    C'9K',VL3(IGG0199K)     SEARCH DIRECT EXECUTOR  @Z30TSCF 07908003
NEXTEXEC DC    C'1H',VL3(IGG0191H)      NON-SEARCH DIRECT      @Z30TSCF 07918003
         SPACE 2                                                        07928002
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 07938002
END      EQU   *                        END OF MODULE            Y02707 07940002
         EJECT                                                          07948002
*                                                                       08020000
* READ CHANNEL PROGRAM OVERLAY.  CCW FIELDS ARE ACCESSED BY ABSOLUTE    08040000
* OFFSETS FROM THE CCW NAME.                                            08060000
*                                                                       08080000
RCPOVLAY DSECT                                                          08100000
*        SEARCH (CCWA)                                                  08120000
SRCHCCW  DS    D                                                        08140000
*        TIC    (CCWB)                                                  08160000
TICCCW   DS    D                                                        08180000
*        READ DATA WITH SKIP  (CCWC)                                    08200000
SKIPCCW  DS    D                                                        08220000
*        READ COUNT (CCWD)                                              08240000
RDCTCCW  DS    D                                                        08260000
*        READ DATA (CCWE)                                               08280000
RDCCW    DS    D                                                        08300000
*        READ KEY AND DATA (ALTERNATE CCWE)                             08320000
RKDCCW   EQU   RDCCW                                                    08340000
* END READ CP CCW DEFINITION                                            08360000
* FOLLOWING IS A MAP OF A WRITE CHANNEL PROGRAM (WCP) SEGMENT.          08380000
*                                                                       08400000
WCPMAP   DSECT                                                          08420000
*                                                                       08440000
*        SEARCH  (CCW1 OR 5)                                            08460000
*                                                                       08480000
SRCHADDR DS    F                                                        08500000
SRCHOPCD EQU   SRCHADDR                 OP CODE IS HI ORDER BYTE.       08520000
SRCHFLAG DS    XL1                                                      08540000
         DS    CL2                                                      08560000
SRCHLEN  DS    XL1                      LENGTHS NORMALLY FIT IN 1 BYTE. 08580000
*                                                                       08600000
*        TIC   (CCW2 OR 6)                                              08620000
*                                                                       08640000
TICADDR  DS    F                                                        08660000
TICOPCD  EQU   TICADDR                                                  08680000
UNUSED   DS    F                        ONLY REQUIRES BITS 37-39 = 0.   08700000
PARASITE EQU   UNUSED                   MAY BE USED TO STORE AN ADDRESS 08720000
*                                       BUT THE ABOVE RESTRICTION       08740000
*                                       LIMITS THE OP CODES THAT MAY    08760000
*                                       BE STORED IN THE HI BYTE.       08780000
*                                                                       08800000
*        WRITE  (CCW3)                                                  08820000
*                                                                       08840000
COUNTADR DS    F                        COUNT FIELD ADDRESS.            08860000
WRTOPCD  EQU   COUNTADR                                                 08880000
WRTFLAG  DS    XL1                      FLAG FIELD.                     08900000
         DS    CL2                      SPACER.                         08920000
COUNTLEN DS    XL1                      COUNT FIELD LENGTH (NORMALLY 8) 08940000
*                                                                       08960000
*        NULL OP CODE  (CCW4)           OP PROPAGATED FROM WRITE CCW.   08980000
*                                                                       09000000
DATAADDR DS    F                        ADDRESS OF BLOCK OF DATA TO BE  09020000
*                                       WRITTEN.                        09040000
NULLOPCD EQU   DATAADDR                 USED AS A FLAG TO SIGNAL LAST   09060000
*                                       SEGMENT.                        09080000
NULLFLAG DS    XL1                                                      09100000
         DS    XL1                      SPACER.                         09120000
DATALEN  DS    H                        2 BYTES HOLDS DATA LENGTH.      09140000
*                                                                       09160000
*                                                                       09180000
* FOLLOWING IS THE VALIDITY CHECK CHANNEL PROGRAM OVERLAY.              09200000
*                                                                       09220000
VCMAP    DSECT                                                          09240000
*        SEEK  (CCW7)                                                   09260000
SEEKADDR DS    F                                                        09280000
SEEKOPCD EQU   SEEKADDR                                                 09300000
SEEKFLAG DS    XL1                                                      09320000
         DS    CL2                                                      09340000
SEEKLEN  DS    XL1                                                      09360000
*                                                                       09380000
*        SEARCH (CCW8)                  LABELS PREFIXED BY 'VC' (VAL    09400000
VCSRCH   EQU   *                        CHECK).                         09420000
VCSRCHAD DS    F                                                        09440000
VCSRCHOP EQU   VCSRCHAD                                                 09460000
VCSRCHFL DS    XL1                      FLAGS.                          09480000
         DS    CL2                                                      09500000
VCSRCHLE DS    XL1                      LENGTH.                         09520000
*                                                                       09540000
*        TIC   (CCW9)                                                   09560000
VCTICAD  DS    F                                                        09580000
VCTICOP  EQU   VCTICAD                                                  09600000
NOTUSED  DS    F                                                        09620000
*                                                                       09640000
*        READ DATA (CCW10)                                              09660000
VCRDAD   DS    F                                                        09680000
VCRDOP   EQU   VCRDAD                                                   09700000
VCRDFLAG DS    XL1                      NORMALLY SKIP.                  09720000
VCRDLEN  DS    FL3                                                      09740000
*                                                                       09760000
* FOLLOWING IS AN OVERLAY OF THE COUNT FIELD.                           09780000
*                                                                       09800000
COUNTFLD DSECT                                                          09820000
*                                                                       09840000
CYLINDER DS    H                        CYLINDER ADDRESS (CC).          09860000
HEAD     DS    H                        HEAD ADDRESS     (HH).          09880000
RECORD   DS    XL1                      RECORD NUMBER    (R).           09900000
KEYLENTH DS    XL1                      KEY LENGTH       (KL).          09920000
DLDL     DS    H                        DATA LENGTH      (DLDL).        09940000
*                                                                       09960000
* END COUNT FIELD. (CCHHRKDD)                                           09980000
*                                                                       10000000
*                                                                       10020000
* DIRECT ACCESS DEVICE TABLE OVERLAY                                    10040000
*                                                                       10060000
DEVTAB   DSECT                                                          10080000
DEVSIZE  DS    F                       MAX SIZ FOR DEVICE.              10100000
TRKCAP   DS    H                       TRACK CAPACITY.                  10120000
OVERI    DS    XL1                     OVERHEAD FOR NOT-LAST RECORD.    10140000
OVERL    DS    XL1                     OVERHEAD FOR LAST RECORD.        10160000
OVERK    DS    XL1                     OVERHEAD REDUCTION FOR NON-KEY   10180000
*                                      RECORDS.                         10200000
DEVFLAG  DS    XL1                                                      10220000
TOLER    DS    H                       TOLERANCE/512 USED FOR VARIABLE  10240000
*                                       GAP LENGTH CALCULATIONS.        10260000
* END DEVTAB OVERLAY.                                                   10280000
*                                                                       10300000
*                                                                       10320000
         DCBD  DSORG=PS                                                 10340000
*                                                                       10360000
*                                                                       10380000
*                                                                       10400000
*                                                                       10420000
         EJECT                                                          10430003
CVT      DSECT                                                 @Z30TSCF 10440003
         CVT                                                   @Z30TSCF 10450003
         IECDSECS  MAIN,WTG,PREFX,EXPAND=YES                   @Z30TSCF 10470003
         ORG   WTGIDTTR                                          Y02072 10472002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 10474002
         EJECT                                                          10476002
FORCORE  DSECT                                                   Y02072 10478002
         IHAFCAUD  ORG=YES                                       Y02072 10478402
         EJECT                                                          10478802
*                                                                       10480000
* IOB OVERLAY                                                           10500000
* THE FORECORE DSECT IOB OVERLAY IS USED WITH THE FOLOWING ADDITIONS-   10520000
*                                                                       10540000
* BSAM/BPAM/QSAM IOB EXTENSION-                                         10560000
SAMSIOB  EQU   DXIOB-8                  START OF SAM'S IOB.             10580000
LINK     EQU   SAMSIOB                  FORWARD CHAIN FIELD (TO NEXT    10600000
*                                       IOB).                           10620000
FLAG     EQU   LINK                     HI BYTE OF LINK USED AS FLAG.   10640000
ECB      EQU   DXIOB-4                                                  10660000
* END EXTENSION DEFINITIONS                                             10680000
*                                                                       10700000
IOBSEEK EQU DXDAADDR                                                    10720000
CHANPGM  EQU   DXDAADDR+8               START OF CHANNEL PROGRAM.       10740000
*                                       LENGTH MAY VARY.                10760000
* END IOB DEFINITIONS.                                                  10780000
*                                                                       10800000
DEB      EQU   DXDEB                                                    10820000
DEBOPATB EQU   DXDEBSYS                                                 10840000
         END                                                            10860000
