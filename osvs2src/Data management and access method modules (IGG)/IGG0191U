191U  TITLE 'IGG0191U - UCS IMAGE RETRIEVAL'                            00100003
IGG0191U CSECT                                                          00200000
*                                                                       00250002
*MODULE NAME - IGG0191U                                          Y02072 00300002
*                                                                       00350002
*DESCRIPTIVE NAME - UCS IMAGE RETRIEVAL                          Y02072 00400002
*                                                                       00450002
*COPYRIGHT - NONE                                                Y02072 00500002
*                                                                       00550002
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00560002
*                                                                       00570002
*          RELEASE 20 DELETIONS                                         00600000
*3364511000,514000                                               M5149  00605020
*3364305400-306200,319000,337000-340000,344000,347000,377000,    A33665 00610020
*3364386000,396000,445000,466000,478000,507000-508000            A33665 00620020
*3364412500,774000,783600                                        A33684 00650020
*3364013000-016000,040000,044000-045000,051000-058000,066000-    S20202 00660020
*3364067000,139000,140000-141000,195000,202000-205000,241000,    S20202 00670020
*3364249000,314000-315000,354000-365000,479000-495000,530000-    S20202 00680020
*3364576000,582000-592000,604000,719000-750000                   S20202 00690020
*3364475000                                                      A34950 00695020
*          RELEASE 21 DELETIONS                                         00700000
*1033361800,603930,791000-799000,811000-816000                   S21042 00750021
*                                                                       00760002
*        VS 2 RELEASE 02 DELETIONS                                      00770002
*001200-001800,012000,048000,064000,109200-109600,113000-115000, Y02072 00780002
*150000,163500-164800,245000-277000,289000-291000,295000-300000, Y02072 00790002
*304000-305250,411000-415000,646060-646840,662050-662600,        Y02072 00792002
*769000-775000,783300-804000,810000,812000,814000,003000-005500  Y02072 00794002
*008000-011000,681000,713000,717000,812000,620000,765000         Y02072 00794402
*                                                                YM7889 00794802
*                                                                       00795203
*        VS2 RELEASE 3 DELETIONS                                        00795603
*                                                              @Z30TSCF 00795703
*        VS2 RELEASE 4 CHANGES                                          00795903
*C782600-783000                                                @ZA01357 00796003
*                                                                       00796103
*LAST DATE CHANGED - JULY 2, 1975                                       01200003
*                                                                       01250002
*FUNCTION/OPERATION - ISSUE BLDL MACRO TO LOCATE THE UCS IMAGE          01300002
*                     IN SYS1.IMAGELIB                                  01400003
*                   - DISPLAY IEC120 MESSAGE TO REQUEST AN OPERATOR     01700000
*                     MOUNT THE CHAIN IF NECESSARY                      01800002
*                   - WHEN IMAGE NOT IN SYS1.IMAGELIB DISPLAY MESSAGE   01950003
*                     IEC122 TO REQUEST OPERATOR SPECIFY AN             02000002
*                     ALTERNATE CHAIN.                                  02100000
*                   - ANALIZE REPLY MADE BY AN OPERATOR                 02200000
*                                                                       02500000
*ENTRY POINT - ENTERED FROM IGG0191T BY THE USE OF XCTL MACRO           02600000
*                                                                       02700000
*INPUT - DCB ADDRESS                                                    02800000
*      - OPEN WORK AREA ADDRESS                                         02900000
*      - WHERE-TO-GO TABLE                                              03000000
*      - PARAMETER LIST                                                 03100000
*      - CURRENT ENTRY IN W-T-G TABLE                                   03200000
*      - CURRENT PARAMETER(DCB)                                         03300000
*      - REPLY IN OPEN WORK AREA BY OPERATOR                            03400000
*      - ADDRESS OF SYS1.IMAGELIB DCB IN OPEN WORKAREA(DXCCW8)          03450020
*                                                                       03500000
*OUTPUT - TO REQUEST AN OPERATOR MOUNT PROPER CHAIN                     03600000
*         'IEC120A M XXX,YYYY' MESSAGE IS DISPLAYED                     03700000
*       - TO REQUEST AN OPERATOR SPECIFY AN ALTERNATE UCS IMAGE.        03800000
*         'IEC122D XXX,YYYY IMAGE NOT FOUND' MESSAGE IS DISPLAYED       03900000
*       - MESSAGE IEC125A - ERROR - REPEAT REPLY, WHEN OPERATOR  Y02072 03950002
*         REPLY IS INVALID                                       Y02072 03960002
*       - THE ADDRESS OF UCS IMAGE RETRIEVED FROM SYS1.IMAGELIB         04000003
*                                                                       04100000
*EXTERNAL REFERENCES - MESSAGE CSECT                             Y02072 04200002
*                                                                       04300000
*EXIT - NORMAL - XCTL TO IGG0191V TO LOAD IMAGE                  Y02072 04350002
*                                                                       05180020
*EXIT - ERROR - XCTL TO IGG0191V FOR THE FOLLOWING:              Y02072 05230002
*               *PERMANENT I/O ERROR OCCURED DURING BLDL                05630002
*               *OPERATOR ISSUED CANCEL FOR MESSAGE IEC120,IEC122,OR    05720020
*                IEC123                                                 05810002
*                                                                       05900000
*TABLES/WORK AREAS - WHERE-TO-GO TABLE(SEE LISTING OF EXECUTOR          06000000
*                                      IGG0191B)                        06100000
*                  - OPEN WORK AREA (SEE IECDSECT IN THIS LISTING)      06200000
*                                                                       06300000
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY   Y02072 06400002
*             UNLESS OTHERWISE SPECIFIED, SUPER STATE            Y02072 06450002
*                                                                       06452002
*MACROS-MAPPING:IGGMSG, CVT, IEFUCBOB, IECDSECS(WTG,MAIN), DCBD, Y02072 06460002
*               IGGSCW                                           Y02072 06470002
*                                                                       06500000
*NOTES - BLDL SVC IS ISSUED TO LOCATE UCS IMAGE IN SYS1.IMAGELIB        06600020
*      - WTO/WTOR SVC IS USED TO REQUEST OPERATOR REPLY.                06800000
*      - THE REPLY IS ORED TO ALLOW LOWER CASE ALPHA                    07000000
*      - BEFORE ISSUING A WTO/WTOR, THE MESSAGE TEXT MUST FIRST  Y02072 07060002
*        BE EXTRACTED FROM A MESSAGE CSECT.                      Y02072 07070002
*                                                                       07100000
*********************************************************************** 07200000
*                                                                       07300000
         EJECT                                                          07400000
*                                                                       07500000
*********************************************************************** 07600000
*                                                                       07700000
*   REGISTER CONVENTIONS                                                07800002
*                                                                       07900000
*********************************************************************** 08000000
*                                                                       08100000
*                                                                       08200000
RE       EQU   0                        WORK/PARAMETER REGISTER         08300000
RWK1     EQU   RE                       WORK REGISTER            Y02072 08350002
RF       EQU   1                        WORK/PARAMETER REGISTER         08400000
RWK2     EQU   RF                       WORK REGISTER            Y02072 08450002
RDCB     EQU   2                        ADDR OF USER'S DCB              08500000
RBASE    EQU   3                        BASE REGISTER                   08600000
RCORE    EQU   4                        ADDR OF OPEN WORK AREA          08700000
RPAR     EQU   5                        PARAMETER LIST                  08800000
RWTG     EQU   6                        START OF WTG                    08900000
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 09000000
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      09100000
RTIOT    EQU   9                        TIOT ADDR/WORK REGISTER         09200000
RWK3     EQU   RTIOT                    WORK REGISTER            Y02072 09250002
RUCB     EQU   10                       UCB ADDR/WORK REGISTER          09300000
RDEB     EQU   11                       DEB ADDR                        09400000
RWK4     EQU   RDEB                     WORK REGISTER            Y02072 09450002
RB       EQU   12                       WORK REGISTER/BREG FOR DSECT    09500000
RWK5     EQU   RB                       WORK REGISTER            Y02072 09550002
RC       EQU   13                       WORK REGISTER                   09600000
RWK6     EQU   RC                       WORK REGISTER            Y02072 09650002
RD       EQU   14                       WORK/PARAMETER REGISTER         09700000
RJ       EQU   15                       WORK/PARAMETER REGISTER         09800000
RWK7     EQU   RJ                       WORK REGISTER            Y02072 09850002
*                                                                       09900000
*********************************************************************** 10000000
*                                                                       10100000
*                                                                       10200000
*   EQUATE WTG OFFSET                                                   10300000
*                                                                       10400000
WGOFF    EQU   8                        OFFSET OF CURRENT WTG ENTRIES   10500000
PLOFF    EQU   4                        OFFSET OF CURRENT DCB ENTRIES   10600000
WAOFF    EQU   32                       OFFSET OF 1ST ENTRY IN WTG TBL  10700000
*                                                                       10800000
*  THE FOLLOWING MESSAGE NUMBERS ARE EQUAL TO THEIR POSITION     Y02072 10850002
*  IN THE MESSAGE CSECT (RELATIVE TO ZERO), MULT BY 2 (LENGTH    Y02072 10860002
*  OF AN INDEX)                                                  Y02072 10870002
*                                                                       10900000
MSG120I3 EQU   4*2                      MESSAGE NO IN MSG CSECT  Y02072 10950002
MSG120I4 EQU   5*2                      MESSAGE NO IN MSG CSECT  Y02072 10960002
MSG120I5 EQU   6*2                      MESSAGE NO IN MSG CSECT  Y02072 10970002
MSG120I6 EQU   7*2                      MESSAGE NO IN MSG CSECT  Y02072 10980002
MSG122   EQU   8*2                      MESSAGE NO IN MSG CSECT  Y02072 10990002
MSG125   EQU   9*2                      MESSAGE NO IN MSG CSECT  Y02072 10992002
UCSIMLNG EQU   4                        LENGTH OF UCS IMAGE NAME Y02072 10994002
VERIFY   EQU   X'10'                    VERIFY                          11100000
BLDL     EQU   X'80'                    BLDL IS REQUIRED                11600000
IEC120   EQU   X'40'                    IEC120 MESSAGE IS REQUIRED      11700000
IEC123RQ EQU   X'80'                    IF ON, MUST ISSUE IEC123 Y02072 11750002
LOAD     EQU   X'20'                    LOAD FROM SYS1.IMGLIB IS REQUIR 11800002
ALPHAF   EQU   X'C6'                    C'F'                            12100000
NULL     EQU   X'00'                    X'00' MASK                      12600000
EXCP     EQU   X'10'                    EXCP TO LOAD UCSB        Y02072 12650002
FOLDMASK EQU   X'40'                    FOLD MASK                       12800000
COMMA    EQU   X'6B'                    C','                            12900002
BLANK    EQU   X'40'                    C' '                            13000000
REPEATNO EQU   5                        NO OF REPEAT IN REPLYRTN        13100000
BLANKMSK EQU   X'40'                    C' '                            13200000
NOVERLAP EQU   X'FD'                    RESET OVERLAP BIT               13400000
FOUR     EQU   X'04'                    X'04'                           13500000
NODELETE EQU   X'7F'                    NO DELETE IS REQUIRED           13600000
ABEND    EQU   X'FF'                    ABEND CODE OR SWITCH     S20202 13820020
PRTM3211 EQU   X'09'                    MASK FOR 3211 PRINTER    S20202 13986020
TWOCON   EQU   C'2'                                              S20202 14016020
OABD070  EQU   70                                                S21042 14180021
OABD071  EQU   71                                                S21042 14182021
         EJECT                                                          14184002
         BALR  RBASE,0                                                  14400000
         USING GOGOGO,RBASE                                             14500000
         USING FORCORE,RCORE                                            14600000
         USING UCBOB,RUCB                                               14700000
         USING IHADCB,RDCB                                              14800000
         USING DEB,RDEB                                                 14900000
*                                                                       15100000
*********************************************************************** 15200000
*                                                                       15300000
GOGOGO   EQU   *                                                        15400000
*                                                                       15500000
         B     BEGIN                    BR AROUND CONSTANTS      Y02072 15550002
         DC    C'IGG0191U'              MODULE NAME              Y02072 15560002
         DC    C' OZ01357'              LAST SHIP CODE                  15570003
         DC    C' 7/02/75'              LAST DATE MODIFIED              15580003
BEGIN    DC    0H'0'                                                    15590003
*                                                                       15592002
*********************************************************************** 15600000
*                                                                       15700000
*   INITIALIZE REGISTERS                                                15800000
*                                                                       15900000
*********************************************************************** 16000000
*                                                                       16100000
         L     RDCB,0(RPARC)            LOAD CURRENT DCB ADDR           16200000
         L     RCORE,4(RWTGC)           LOAD CURRENT WORK AREA ADDR     16300000
         L     RDEB,DCBDEBAD            LOAD DEB ADDR                   16400000
         L     RUCB,DEBUCBAD            LOAD UCB ADDR                   16500000
         DROP  RDEB                                              Y02072 16550002
         L     RTIOT,CVTPTR(0)          LOAD CVT ADDR                   16600000
*                                                                       16700000
*********************************************************************** 16800000
*                                                                       16900000
TSTENTRY EQU   *                                                        17000000
*                                                                       17100000
*********************************************************************** 17200000
*                                                                       17300000
*   TEST THE ENTRY SWITCH TO DETERMINE REQUIRED OPERATION. (DXUCSSW1)   17400002
*                                                                       17850002
*********************************************************************** 17900000
*                                                                       18000000
         TM    DXUCSSW1,IEC123RQ        IF ON, GO WAIT ON        Y02072 18002002
*                                         MSG IEC123             Y02072 18100002
         BO    RETURN                   GO ISSUE WAIT            Y02072 18150002
*                                                                       19000000
BLDLRTN  EQU   *                                                        19100000
*                                                                       19200000
*********************************************************************** 19300000
*                                                                       19400000
*   BLDL ROUTINE IS USED TO LOCATE UCS IMAGE IN SYS1.IMAGELIB           19500002
*                                                                       19600000
*********************************************************************** 19700000
*                                                                       19800000
         MVC   DXBLDL,BLDLCNST          MOVE BLDL LEN TO LIST    Y02072 19850002
         MVC   DXBLDLIM,UCSCONST        MOVE 'UCS1' TO LIST      Y02072 19860002
         CLI   UCBTBYT4,PRTM3211        CK IF DCB BEING OPENED   S20202 20010020
*                                       FOR 3211                 S20202 20020003
         BNE   CONTBLDL                 NO GO CONTINUE WITH BLDL S20202 20030020
         MVI   DXBLDLIM+3,TWOCON        CHANGE UCS ID PREFIX TO  Y02072 20032002
*                                       UCS2                     S20202 20050020
*                                                                       20060020
CONTBLDL EQU   *                                                 S20202 20070020
*                                                                       20080020
         MVC   DXIMGNAM,DXUCSID         MOVE UCS NAME FROM JFCB  Y02072 20150002
*                                                                       20170020
*   GET ADDRESS OF IMAGELIB DCB                                         20240003
*                                                                       20310020
         L     RF,DXIMGDCB              GET ADDR OF IMGLIB       Y02072 20360002
*                                       DCB                      S20202 20450020
*                                                                       20520020
         LA    RE,DXBLDL                LOAD BLDL LIST ADDR      Y02072 20570002
*                                                                       20700000
         BLDL  (1),(0)                  BLDL THE UCS SET                20800000
*                                                                       20900000
*                                                                       21000000
*   TEST RETURN CODE FOR THE ABOVE FIND IN RJ                           21100000
*               X'00'--- FOUND                                          21200000
*               X'04'--- NOT FOUND                                      21300000
*               X'08'--- PERMANENT I/O ERROR                            21400000
*                                                                       21500000
         LA    RD,FOUR                  LOAD X'04' TO TEST RETURN CODE  21600000
         CLR   RJ,RD                    TEST RETURN CODE                21700000
         BC    2,ABEND08                IF X'08',GOTO ABEND ROUTINE     21800000
*                                                                       21900000
         BC    8,WTOR122                IF X'04',GOTO WTOR IEC122       22000000
*                                                                       22100000
*********************************************************************** 22200000
*                                                                       22300000
CHCK120  EQU   *                                                        22400000
*                                                                       22500000
*********************************************************************** 22600000
*                                                                       22700000
*   WHEN THE IMAGE IS FOUND,TEST IF MESSAGE IEC120 IS REQUIRED          22800000
*                                                                       22900000
*********************************************************************** 23000000
*                                                                       23100000
         TM    DXUCSSW1,IEC120          TEST IF IEC120 REQ       Y02072 23150002
         BNO   XCTL191V                 IF NOT, GO LOAD IMAGE    Y02072 23200002
*                                                                       23400000
*********************************************************************** 23500000
*                                                                       23600000
WTOR120  EQU   *                                                        23700000
*                                                                       23800000
*********************************************************************** 23900000
*                                                                       24000000
*   WHEN UCS IS FOUND IN SYS1.IMAGELIB BY BLDL                          24100020
*   WTOR 'IEC120A M XXX,YYYY' TO REQUEST MOUNTING SPECIFIED CHAIN       24200003
*                                                                       24300000
*********************************************************************** 24400000
         LA    RWK6,W120RET             RETURN ADDRESS           Y02072 24450002
         TM    DXUCSOPT,FOLDMASK+VERIFY  FOLD OR VERIFY SPEC     Y02072 24500002
         LA    RWK5,MSG120I5            MSG NO FOR FOLD AND VER  Y02072 24550002
         BO    WTORTN                   YES, BRANCH TO GET MSG   Y02072 24600002
         LA    RWK5,MSG120I3            MSG NO FOR NEITHER FOLD  Y02072 24650002
*                                         OR VERIFY SPECIFIED    Y02072 24700002
         BZ    WTORTN                   NO, BRANCH TO GET MSG    Y02072 24750002
         TM    DXUCSOPT,FOLDMASK        FOLD SPECIFIED           Y02072 24800002
         LA    RWK5,MSG120I6            MSG NO FOR FOLD SPEC     Y02072 24850002
         BO    WTORTN                   YES, BRANCH TO GET MSG   Y02072 24900002
         LA    RWK5,MSG120I4            MSG NO FOR VERIFY SPEC   Y02072 24950002
         B     WTORTN                   BRANCH TO GET MESSAGE    Y02072 24960002
W120RET  EQU   *                        FILL IN VAR FLD 2        Y02072 25010002
         USING MSGENTRY,RWK2                                     Y02072 25020002
         IC    RWK7,MSGOFF2             OFFSET TO SECOND VAR FLD Y02072 25060002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF SEC VAR FLD   Y02072 25110002
         MVC   0(UCSIMLNG,RWK3),DXUCSID  UCS IMAGE TO MSG        Y02072 25160002
         B     STVARFLD                 GO STORE VAR FLD 1       Y02072 25210002
*                                                                       27900000
WTOR122  EQU   *                                                        28000000
*                                                                       28100000
*********************************************************************** 28200000
*                                                                       28300000
*   WTOR 'IEC122D XXX,YYY IMAGE NOT FOUND' TO REQUEST FOR ALTERNATE     28400000
*   CHAIN SET                                                           28500000
*                                                                       28600000
*********************************************************************** 28700000
*                                                                       28800000
         LA    RWK5,MSG122              MESSAGE NO               Y02072 28810002
         BAL   RWK6,WTORTN              GO GET MESSAGE           Y02072 28820002
         NI    DXUCSSW1,NODELETE        RESET BLDL BIT TO INDIC  Y02072 28822002
*                                       NO IMAGE HAS BEEN LOADED        28840002
         IC    RWK7,MSGOFF2             OFFSET TO SECOND VAR FLD Y02072 28840402
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF SEC VAR FLD   Y02072 28840802
         MVC   0(UCSIMLNG,RWK3),DXUCSID  UCS IMAGE TO MSG        Y02072 28841202
         XC    DXUCSID,DXUCSID          RESET UCS IMAGE ID       Y02072 28841602
STVARFLD EQU   *                        STORE VARIABLE FIELD     Y02072 28850002
         IC    RWK7,MSGOFF1             OFFSET TO FIRST VAR FLD  Y02072 28950002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF FIRST VAR FLD Y02072 29050002
         MVC   0(L'UCBNAME,RWK3),UCBNAME  MOVE DEV NAME TO MSG   Y02072 29100002
         DROP  RWK2                                              Y02072 29180002
*                                                                       30100000
*   WTOR ROUTINE                                                        30200000
*                                                                       30300000
MESSAGO  EQU   *                                                 A27331 30530019
         MVI   RPLY,BLANK                                        A33665 30620020
         MVC   RPLY+1(19),RPLY          CLEAR REPLY AREA         A33665 30710020
         MVI   RPLYECB,NULL             CLEAR REPLY ECB          A33665 30800020
*                                                                       30900000
         LA    RF,REPLYLTH              LOAD WTOR ADDR                  31000000
*                                                                       31100000
         SVC   35                       ISSUE WTOR SVC                  31200000
*                                                                       31300000
*                                                                       31600000
RETURN   EQU   *                                                        31700000
*                                                                       31800000
         LA    RF,RPLYECB               LOAD REPLY ECB ADDRESS   A33665 31900020
*                                                                       32000000
         WAIT  ECB=(1),LONG=YES         WAIT ON REPLY            Y02072 32100002
*                                                                       32500000
GOREPLY  EQU   *                                                        32600000
*                                                                       32700000
*********************************************************************** 32800000
*                                                                       32900000
*   REPLY ANALYSIS                                                      33000000
*   (1) 'U' - USE THE ONE ON THE PRINTER                                33100000
*   (2) 'CANCEL' - CHAIN SET NOT AVAILABLE                              33200000
*   (3) 'UCS-ID' - UCS ID                                               33300000
*                                                                       33400000
*********************************************************************** 33500000
*                                                                       33600000
         OC    RPLY(8),LOMASK           OR IN X'40' TO ALLOW     A33665 33700020
         OC    RPLY+8(8),LOMASK         REPLY IN LOWER CASE      A33665 33800020
         CLC   RPLY(2),UBLANK           TEST IF REPLY = 'U'      A33665 33900020
         BE    BLDLSETU                 IF YES, GO TO SET UP     Y02072 33950002
*                                         FOR BLDL               Y02072 34300002
         CLC   RPLY(6),CANCELCN         TEST IF REPLY = 'CANCEL' A33665 34400020
         BC    8,CANCELGO               IF YES,GOTO CANCEL ROUTINE      34500000
         CLC   RPLY(2),CBLANK           TEST IF REPLY = 'C'      A33665 34700020
         BC    7,TSTUCSID               IF NOT,GOTO UCS ID TEST         34800000
*                                                                       34900000
*********************************************************************** 35000000
*                                                                       35100000
CANCELGO EQU   *                                                        35200000
*                                                                       35300000
*********************************************************************** 35380020
*                                                                       35460020
*   SINCE THE SPECIFIED UCS CHAIN IS NOT AVAILABLE,JOB STEP IS          35540020
*   CANCELLED BY OPERATOR. THE ABEND SWITCH AND CODE-X'04'- IS          35620020
*   SET,AND A XCTL IS MADE TO IGG0191V TO ABEND,CHECK IF IMAGE ID WAS   35700002
*   SPECIFIED CORRECTLY, OR ADD IMAGE TO SYS1.IMAGELIB                  35780020
*                                                                       35860020
*********************************************************************** 35940020
*                                                                       36020020
*                                                                       36100020
         MVI   DXABRETC,OABD071         MOVE INTERNAL CODE TO    Y02072 36110002
*                                       WKAREA                   S21042 36200021
         MVI   DXABEND,ABEND            SET ABEND FLAG           Y02072 36250002
         B     XCTL191V                 GO XCTL TO IGG0191V      S20202 36340020
*                                                                       36420020
*                                                                       36600000
*********************************************************************** 36700000
*                                                                       36800000
TSTUCSID EQU   *                                                        36900000
*                                                                       37000000
*********************************************************************** 37100000
*                                                                       37200000
*   ANALYZE REPLY UCS PARAMETERS                                        37300000
*                                                                       37400000
*********************************************************************** 37500000
*                                                                       37600000
         LA    RD,RPLY                  LOAD REPLY ADDRESS       A33665 37700020
         LA    RJ,REPEATNO              LOAD 5 IN REG. RJ               37800000
*                                                                       37900000
         CLI   0(RD),COMMA              TEST IF 1ST CHAR=','            38000000
         BC    8,ERRORTN                IF YES,GOTO ERROR ROUTINE       38100000
*                                                                       38200000
         CLI   0(RD),BLANKMSK           TEST IF 1ST CHAR=BLANK          38300000
         BC    8,ERRORTN                IF YES,GOTO ERROR ROUTINE       38400000
*                                                                       38500000
         MVI   MCSMASK,NULL             SET LOAD MODE BIT =      A33665 38540020
*                                       X'00'                    A33665 38580020
         MVC   UCSID(4),BLANKS          BLANK OUT AREA TO MOVE   A33665 38620020
*                                       REPLY ID INTO                   38660020
*                                                                       38700000
TSTREPLY EQU   *                                                        38800000
*                                                                       38900000
         CLI   0(RD),BLANKMSK           TEST IF CHAR=BLANK              39000000
         BC    8,TSTNAME                IF YES,GOTO TEST IMAGE IDS.     39100000
*                                                                       39200000
         CLI   0(RD),COMMA              TEST IF CHAR=','                39300000
         BC    8,TSTOPT                 IF YES,GOTO OPTION TEST ROUTINE 39400000
*                                                                       39500000
         MVC   UCSID-RPLY(1,RD),0(RD)                            A33665 39600020
*                                                                       39700000
         LA    RD,1(RD)                 MODIFY REPLY ADDR               39800000
*                                                                       39900000
         BCT   RJ,TSTREPLY              GO BACK TO REPLY UCS ID ANALY   40000000
*                                                                       40100000
*********************************************************************** 40200000
*                                                                       40300000
ERRORTN  EQU   *                                                        40400000
*                                                                       40500000
*********************************************************************** 40600000
*                                                                       40700000
*   REPLY ERROR ROUTINE                                                 40800000
*                                                                       40900000
*********************************************************************** 41000000
         LA    RWK6,MESSAGO             RETURN ADDRESS           Y02072 41050002
         LA    RWK5,MSG125              MESSAGE NO FOR MSG RTN   Y02072 41100002
         B     WTORTN                   GO GET AND ISSUE MSG     Y02072 41150002
*********************************************************************** 41600000
*                                                                       41700000
TSTOPT   EQU   *                                                        41800000
*                                                                       41900000
*********************************************************************** 42000000
*                                                                       42100000
*   TEST FOLD/VERIFY SPECIFIED                                          42200000
*                                                                       42300000
*********************************************************************** 42400000
*                                                                       42500000
         CLI   1(RD),COMMA              TEST IF NEXT CHAR=','           42600000
*                                                                       42700000
         BC    8,TSTVRFY                IF YES,GOTO TEST 'VERIFY'       42800000
*                                                                       42900000
         CLC   1(4,RD),FOLDCN           TEST IF FOLD IS SPECIFIED       43000000
         BC    7,TSTALPHF               IF NOT,GOTO TEST IF 'F'         43100000
         LA    RD,4(RD)                 IF YES,SET POINTER TO NEXT WORD 43200000
         BC    15,SETFOLD               GOTO SET FOLD BIT               43300000
*                                                                       43400000
TSTALPHF EQU   *                                                        43500000
*                                                                       43600000
         CLI   1(RD),ALPHAF             TEST IF 'F' IS SPECIFIED        43700000
         LA    RD,1(RD)                 SET POINTER TO NEXT WORD        43800000
         BC    7,ERRORTN                IF NOT,GOTO ERROR RTN           43900000
*                                                                       44000000
SETFOLD  EQU   *                                                        44100000
*                                                                       44200000
*                                                                       44300000
*                                                                       44400000
         MVI   MCSMASK,FOLDMASK         SET LOAD MODE = FOLD     A33665 44500020
*                                                                       44600000
         CLI   1(RD),COMMA              TEST IF C',' FOLLOWS AFTER FOLD 44700000
         BC    8,TSTVRFY                IF YES,GOTO TEST VERIFY RTN     44800000
*                                                                       44900000
         CLI   1(RD),BLANKMSK           TEST IF A BLANK FOLLOWS         45000000
         BC    8,TSTNAME                IF YES,GOTO TEST NAME ROUTINE   45100000
*                                                                       45200000
         BC    15,ERRORTN               IF NOT,GOTO ERROR ROUTINE       45300000
*                                                                       45400000
TSTVRFY  EQU   *                                                        45500000
*                                                                       45600000
*   TEST VERIFY IS SPECIFIED                                            45700000
*                                                                       45800000
         CLC   2(6,RD),VERIFYCN         TEST IF 'VERIFY' SPECIFIED      45900000
         BC    8,SETVRFY                IF YES,GOTO SET VERIFY BIT      46000000
         CLC   2(2,RD),VBLANK           TEST IF REPLY='V'               46100000
         BC    7,ERRORTN                IF NOT,GOTO ERROR ROUTINE       46200000
*                                                                       46300000
SETVRFY  EQU   *                                                        46400000
*                                                                       46500000
         OI    MCSMASK,VERIFY           SET VERIFY = YES         A33665 46600020
*                                                                       46700000
*********************************************************************** 46800000
*                                                                       46900000
TSTNAME  EQU   *                                                        47000000
*                                                                       47100000
*********************************************************************** 47200000
*                                                                       47300000
*   TEST IF REPLY ID = REQUESTED ID                                     47400000
*        YES - TEST TO SEE IF OPERATOR SPECIFIED VERIFICATION OF A34950 47430020
*              IMAGE. (OPERATORS OPTIONS MIGHT BE DIFFERENT THAN A34950 47460020
*              USERS OPTIONS). IF NO, GO TO 191V. IF YES, FOLLOW A34950 47490020
*              SAME PATH AS IF NEW IMAGE.                        A34950 47520020
*                                                                A34950 47550020
*********************************************************************** 47600000
*                                                                       47700000
         CLC   DXUCSID,UCSID            CK FOR SAME ID'S         Y02072 47710002
         BE    XCTL191V                 IF EQUAL, GO LOAD IMAGE  Y02072 47720002
         MVC   DXUCSOPT,MCSMASK         SET LODE MODE            Y02072 50670002
         MVC   DXUCSID,UCSID            MOVE REPLIED UCS NAME    Y02072 50672002
         MVI   DXUCSSW1,0               RESET SWITCH             Y02072 50682002
         B     BLDLRTN                  GO ISSUE BLDL TO FIND IM Y02072 50772002
*                                                                       50822002
*********************************************************************** 50872002
*                                                                       50882002
*   WHEN OPERATOR REPLIES 'U', THE IMAGE CURRENTLY LOADED IS TO BE      50922002
*   USED.  GET THE IMAGE ID AND IMAGE OPTIONS FROM THE UCB AND          50972002
*   SET UP THE BLDL PARM LIST.                                          51022002
*                                                                       51032002
*********************************************************************** 51072002
*                                                                       51122002
BLDLSETU EQU   *                                                 Y02072 51172002
*                                                                       51222002
         L     RWK7,UCBXTADR            GET ADDR OF UCB/UCS XTN  Y02072 51272002
         USING UCBUCS,RWK7                                       Y02072 51322002
         MVC   DXUCSID,UCBUCSID         UCS IMAGE ID TO WORKAREA Y02072 51372002
         MVC   DXUCSOPT,UCBUCSOP        UCS OPTIONS TO WORKAREA  Y02072 51422002
         MVI   DXUCSSW1,0               RESET SWITCH             Y02072 51432002
         DROP  RWK7                                              Y02072 51472002
         B     CONTBLDL                 GO ISSUE BLDL            Y02072 51522002
*                                                                       60351020
ABEND08  EQU   *                                                 S20202 60354020
*                                                                       60357020
*********************************************************************** 60360020
*                                                                     * 60363020
*   PERMANENT I/O ERROR WAS FOUND WHEN BLDL WAS ISSUED TO LOCATE AN   * 60366020
*   UCS IMAGE IN SYS1.IMAGELIB RETURN CODE=X'08' IS STORED              60369020
*   ABEND SWITCH IS SET AND A XCTL IS MADE TO IGG0191V TO ABEND.      * 60372003
*   IF THE ERROR PERSISTS, RUN DIAGNOSTICS ON IMAGELIB VOLUME.        * 60378003
*   +368(REG.4) POINTS TO THE BLDL LIST                               * 60381020
*                                                                     * 60384020
*********************************************************************** 60387020
*                                                                       60390020
         MVI   DXABRETC,OABD070         MOVE INTERNAL CODE TO    Y02072 60390402
*                                       WKAREA                   S21042 60394021
         MVI   DXABEND,ABEND            SET ABEND FLAG           Y02072 60394402
*                                                                       60399020
*                                                                       60402020
*                                                                       60405020
XCTL191V EQU   *                                                 S20202 60408020
*                                                                       60411020
*********************************************************************** 60414020
*                                                                       60417020
*   XCTL TO NEXT EXECUTOR IGG0191V                                      60420020
*                                                                       60423020
*********************************************************************** 60426020
*                                                                       60429020
         LA    RF,MODNM1V               LOAD IDTTR NEXT EXECUTOR S20202 60432020
*                                                                       67200000
MVEIDTTR EQU   *                                                        67300000
*                                                                       67400000
*********************************************************************** 67500000
*                                                                       67600000
*   MOVE IDTTR TO XCTL WTG TABLE                                        67700000
*                                                                       67800000
*********************************************************************** 67900000
*                                                                       68000000
         USING WTGENTRY,RWTGC                                    Y02072 68050002
         MVC   WTGIDTTR,0(RF)           ST NEXT MOD ID IN WTG  @Z30TSCF 68060003
*                                                                       68200000
*********************************************************************** 68300000
*                                                                       68400000
RELOOP   EQU   *                                                        68500000
*                                                                       68600000
*********************************************************************** 68700000
*                                                                       68800000
*   UPDATE WTG TABLE AND XCTL TO NEXT MODULE                            68900000
*                                                                       69000000
*********************************************************************** 69100000
*                                                                       69200000
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     69300000
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY     69400000
         CLC   0(2,RWTGC),AMIDCNST      IS THE RTN NEEDED AGAIN         69500000
         BCR   8,RBASE                  IF YES,RETURN TO PROCESS        69600000
*                                                                       69700000
         CLC   0(2,RWTGC),OPIDCNST      TEST END OF WTG TABLE           69800000
         BC    7,RELOOP                 IF NOT,CHECK NEXT ENTRY         69900000
*                                                                       70000000
         LR    RPARC,RPAR               RESET REG TO '0'                70100000
         LA    RWTGC,WAOFF(0,RWTG)      RESET WTG REG TO POINT +32(WTG) 70200000
ZCHECK   CLI   0(RWTGC),X'00'           TEST IF THIS ENTRY COMPLETE     70300000
         BC    7,TCTLRTN                IF NOT,XCTL                     70400000
*                                                                       70500000
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY OF WTG TABLE     70600000
         LA    RPARC,PLOFF(0,RPARC)     GET NEXT ENTRY OF DCB           70700000
         BC    15,ZCHECK                GOTO TEST COMPLETION            70800000
*                                                                       70900000
TCTLRTN  EQU   *                                                        71000000
*                                                                       71100000
         USING WTG,RWTG                                                 71150003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*71200003
               MODID=WTGENTRY                                  @Z30TSCF 71250003
         DROP  RWTGC,RWTG                                      @Z30TSCF 71300003
*                                                                       71800000
         EJECT                                                          75100002
*********************************************************************** 75200000
*  'WTORTN' SUBROUTINE                                           Y02072 75250002
*  THIS SUBROUTINE EXTRACTS THE REQUIRED MESSAGE FROM THE MSG    Y02072 75300002
*  CSECT AND MOVES IT TO THE WTO/WTOR AREA.                      Y02072 75350002
*                                                                       75400002
*    INPUT TO THIS ROUTINE:                                      Y02072 75450002
*      REG 12 - MESSAGE NUMBER IN CSECT                          Y02072 75460002
*      REG 13 - RETURN ADDRESS                                   Y02072 75470002
*                                                                       75480002
*    OUTPUT FROM THIS ROUTINE:                                   Y02072 75490002
*      REG 1 - POINTER TO MESSAGE ENTRY IN THE MESSAGE CSECT     Y02072 75492002
*      MESSAGE TEXT IN WTO/WTOR AREA                             Y02072 75494002
*********************************************************************** 75500000
WTORTN   EQU   *                        ENTRY POINT, MSG RTN     Y02072 75550002
         L     RWK7,DXMSGADR            GET ADDR OF MSG CSECT    Y02072 75560002
         LH    RWK2,0(RWK7,RWK5)        GET INDEX TO MESSAGE     Y02072 75570002
         LA    RWK2,0(RWK7,RWK2)        ADDR OF MESSAGE ENTRY    Y02072 75580002
         USING MSGENTRY,RWK2                                     Y02072 75590002
         SR    RWK3,RWK3                PREPARE REGISTER         Y02072 75592002
         IC    RWK3,MSGOFF              GET OFFSET TO TEXT IN    Y02072 75594002
*                                         ENTRY                  Y02072 75596002
         LA    RWK3,0(RWK2,RWK3)        ADDR OF MESSAGE TEXT     Y02072 75598002
         USING MSGTXTD,RWK3                                      Y02072 75598402
         SR    RWK7,RWK7                PREPARE REG FOR RETURN   Y02072 75598802
         IC    RWK7,MSGLNG              LEN OF MSG - 1           Y02072 75599202
         EX    RWK7,MVCINST             MOVE MESSAGE TO AREA     Y02072 75599602
         BR    RWK6                     RETURN                   Y02072 75599702
MVCINST  MVC   MSGAREA(0),MSGTXT        EXECUTED BY A EX INST    Y02072 75599802
         EJECT                                                          75599902
*                                                                       75600000
*   CONSTANTS                                                           75700000
*                                                                       75800000
*********************************************************************** 75900000
*                                                                       76000000
*   FOR WTG TABLE                                                       76100000
*                                                                       76200000
OPIDCNST DC    C'0S'                                                    76300000
AMIDCNST DC    C'1U'                                                    76400000
*                                                                       76600000
*   MESSAGE TEXT                                                        76700000
*                                                                       76800000
VERIFYCN DC    C'VERIFY'                REPLY=UCS,,VERIFY               77600000
FOLDCN   DC    C'FOLD'                  REPLY=UCS,FOLD                  77700000
CANCELCN DC    C'CANCEL'                REPLY='CANCEL'                  77800000
UBLANK   DC    C'U '                    REPLY = 'U'                     77900000
CBLANK   DC    C'C '                    REPLY = 'C'                     78000000
VBLANK   DC    C'V '                    VERIFY='V'                      78100000
UCSCONST DC    C'UCS1'                  UCS IMAGE ID PREFIX             78200000
BLANKS   DC    4C' '                    FOUR BLANKS              A33665 78250020
*   THE FIRST TWO BYTES OF A BLDL PARAMETER LIST IS THE NUMBER OF       78260003
*   ENTRIES THAT FOLLOW AND THE NEXT TWO BYTES SHOW THE LENGTH OF       78270003
*   EACH ENTRY.  IT MUST BE LONG ENOUGH FOR A 'LOAD' MACRO, BUT         78280003
*   NOT LONG ENOUGH TO OVERLAY OUR IMAGELIB DCB ADDRESS.                78290003
BLDLCNST DC    0CL4' ',YL2(1),YL2(DXIMGDCB-(DXBLDL+4))         @ZA01357 78300003
*                                                                       78400000
*********************************************************************** 78500000
*                                                                       78600000
*   XCTL TABLE                                                          78700000
*                                                                       78800000
*********************************************************************** 78900000
*                                                                       79000000
MODNM1V  DC    C'1V',VL3(IGG0191V)      MODULE IGG0191V        @Z30TSCF 79160003
         SPACE                                                          79180002
PATCH    DC    25H'0'                   PATCH AREA               Y02072 79190002
END      EQU   *                        END OF MOKULE            Y02072 79192002
         IECDSECS  DCB,EXPAND=YES                                Y02072 80950002
         EJECT                                                          80960002
         IECDSECS MAIN,EXPAND=YES                                Y02072 81200002
         ORG   REPLYLTH+52                                       A33665 81640020
RPLY     DS    20C                                               A33665 81680020
RPLYECB  DS    F                                                 A33665 81720020
MCSMASK  DS    H                                                 A33665 81760020
LOMASK   DS    8C                                                A33665 81800020
UCSID    DS    4C                                                A33665 81840020
         ORG   MSGLSTSZ                                          Y02072 81850002
MSGAREA  DS    0CL64                    AREA TO MOVE 64 BYTES    Y02072 81860002
*                                         TO FOR WOT/WTOR'S      Y02072 81870002
         EJECT                                                          81880002
         IGGSCW                                                  Y02072 81882002
         EJECT                                                          81890002
         IGGMSG                                                  Y02072 81890402
         EJECT                                                          81890802
         IECDSECS  WTG,PREFX,EXPAND=YES                        @Z30TSCF 81892003
         ORG   WTGIDTTR                                          Y02072 81894002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 81896002
*                                                                       81900000
*********************************************************************** 82000000
*                                                                       82100000
SRT      DSECT                                                          82200000
         IEFUCBOB                                                       82300000
*                                                                       82400000
*********************************************************************** 82500000
*                                                                       82600000
CVT      DSECT                                                          82700000
         CVT                                                            82800000
*                                                                       82900000
*********************************************************************** 83000000
*                                                                       83100000
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          83200000
DEB      DSECT                                                          83300000
DEBNMSUB DS    0CL1                                                     83400000
DEBTCBAD DS    CL4                                                      83500000
DEBAMLNG DS    0CL1                                                     83600000
DEBDEBAD DS    CL4                                                      83700000
DEBOFLGS DS    0CL1                                                     83800000
DEBIRBAD DS    CL4                                                      83900000
DEBOPATB DS    0CL1                                                     84000000
DEBSYSPG DS    CL4                                                      84100000
DEBNMEXT DS    0CL1                                                     84200000
DEBUSRPG DS    CL4                                                      84300000
DEBPRIOR DS    0CL1                                                     84400000
DEBECBAD DS    CL4                                                      84500000
DEBPROTG DS    0CL1                                                     84600000
DEBDEBID DS    0CL1                                                     84700000
DEBDCBAD DS    CL4                                                      84800000
DEBEXSCL DS    0CL1                                                     84900000
DEBAPPAD DS    CL4                                                      85000000
DEBDVMOD DS    0CL1                                                     85100000
DEBUCBAD DS    CL4                                                      85200000
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     85300000
DEBBINUM DS    CL2                                                      85400000
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   85500000
DEBSTRCC DS    CL2                                                      85600000
DEBSTRHH DS    CL2                                                      85700000
DEBENDCC DS    CL2                                                      85800000
DEBENDHH DS    CL2                                                      85900000
DEBNMTRK DS    CL2                                                      86000000
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          86100000
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              86200000
DEBVOLSQ DS    H                                                        86300000
DEBVOLNM DS    H                                                        86400000
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     86500000
DEBSUBID DS    H                                                        86600000
*                                                                       86700000
*********************************************************************** 86800000
         IKJTCB                                                         86840001
*                                                                       86900000
         END                                                            87000000
