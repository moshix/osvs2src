         TITLE 'IGG0191Z OPEN EXECUTOR  D/A UPDATE RECORD READY CHANNEL*00010021
                PROGRAMS'                                               00012021
IGG0191Z CSECT                                                          00014020
*MODULE NAME - IGG0191Z                                          Y02072 00016002
*                                                                       00018002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00020002
*                                                                       00022002
*COPYRIGHT - NONE                                                Y02072 00022402
*                                                                       00022802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00023202
*                                                                       00024002
*          VS 2 RELEASE 2 DELETIONS                              Y02072 00024402
*000947,010800,034000,034400,039800-040800,053060-053100,        Y02072 00024802
*058600,060420-060440,070950,109500,112500-112540,122000-129170  Y02072 00024902
*109000,116800,118000,120800,15400,83600-83800,84200-84400       Y02072 00030602
*                                                                YM4640 00030702
*C24200,70880,81800                                              YM5362 00032702
*                                                                YM7595 00034702
*                                                                       00035103
*          VS2 RELEASE 3 DELETIONS                                      00035503
*                                                              @Z30TSCF 00035903
*          RELEASE 20 DELETIONS                                         00036702
*                                                                S20201 00042402
*          RELEASE 21 DELETIONS                                         00048102
*0335120500-121600                                               A37507 00053802
*0335112040-112200                                               A40538 00059502
*0335029129,088060,088860,098060                                 M1760  00065202
*0335019449-019480,019720,019920,070100-070500,070800,080400,    A31983 00070902
*0335080600,087600-087800                                        A31983 00076602
*0335088120,088920,098120                                        M1779  00082302
*                                                               SA53268 00088002
*                                                                XM6306 00093701
* STATUS LEVEL = 002                                                    00094702
*                                                                       00121221
*    THIS MODULE SPLIT INTO IGG01923 FOR RELEASE 21                     00171221
*                                                                       00221221
*FUNCTION/OPERATION - INITIALIZE AND LINK IOB'S                         00231221
*        BEGINS CONSTRUCTION OF CHANNEL PROGRAMS FOR RECORD READY       00241221
*        DEVICES WITH OPTIONS OF WRITE CHECK AND TRACK OVERFLOW         00251221
*        IF SPECIFIED                                                   00253221
*        CHANNEL PROGRAM FORMAT--                                       00255221
*              - WRITE SECTION                                          00257221
*              - WRITE CHECK SECTION                                    00259221
*              - READ SECTION                                           00259621
*                                                                       00259721
*ENTRY POINTS- ENTERED FROM IGG0191P BY USE OF THE XCTL MACRO.          00260020
*                                                                       00280020
*INPUT- SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       00300020
*                                                                       00320020
*OUTPUT & IOB(USER)- SEE DESCRIPTION OF REGISTERS, DCB(USERS).          00340020
*                                                                       00360020
*EXTERNAL ROUTINES- NONE.                                               00380020
*                                                                       00400020
*EXITS-NORMAL-XCTL TO IGG01923 TO CONTINUE BUILDING CHAN PGMS           00420021
*                                                                       00440020
*EXITS-ERROR- NONE.                                                     00460020
*                                                                       00480020
*TABLES/WORKAREAS- WHERE TO GO TABLE (WTG)                              00500020
*                                                                       00520020
*      BYTE  0-7  NAME                                                  00540020
*      BYTE  8-10 RELATIVE DISK ADDRESS(TTR) OF FIRST RECORD            00560020
*      BYTE 11    CONCATENATION NUMBER                                  00580020
*      BYTE 12    ZERO                                                  00600020
*      BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR.       00620020
*                        ALIAS INDICATOR 1 BIT                          00640020
*                        NUMBER OF TTRS IN USERS DATA FIELD 2 BITS      00660020
*      BYTE 14-16 TTR OF FIRST TEXT RECORD                              00680020
*      BYTE 17    ZERO                                                  00700020
*      BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                      00720020
*      BYTE 20    TRANSLATION TABLE                                     00740020
*      BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST            00760020
*      BYTE 22-23 ATTRIBUTES                                            00780020
*      BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE     00800020
*      BYTE 27-28 LENGTH OF FIRST TEXT RECORD                           00820020
*      BYTE 29    LENGTH OF WTG TABLE (IN DOUBLE WORDS)                 00840020
*      BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                        00860020
*      BYTE 32-36 IDTTR OF EXECUTOR FOR FIRST DCB                       00880020
*      BYTE 37-39 WORKAREA ADDRESS FOR FIRST DCB                        00900020
*      BYTE 40-   TABLE OF IDTTR'S                                      00920020
*      BYTE 32+N(8) IDTTR OF EXECUTOR FOR N TH DCB   (5 BYTES)          00940020
*                   WORKAREA ADDRESS FOR N TH DCB    (3 BYTES)          00960020
*                   IDTTR OF LAST ROUTINE LOAD       (5 BYTES)          00980020
*                   NOT USED                         (3 BYTES)          01000020
*                                                                       01020020
*      SEE DEVICETB DSECT                                               01040020
*                                                                       01060020
*MACROS - ACTION : MODESET, XCTL, XCTLTABL                       Y02072 01070002
*                                                                       01070402
*MACROS - MAPPING : IEZDEB, IHACCW, IECDSECS(MAIN, IOB, WTG),    YM5362 01070802
*                   DCBD, IGGBCB                                 YM5362 01071202
*                                                                       01072002
*ATTRIBUTES- REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY    Y02072 01080002
*            UNLESS OTHERWISE SPECIFIED, SUPER STATE             Y02072 01090002
*                                                                       01100020
*NOTE - SECTOR VALUES PASSED BY IGG0191P IN OPEN WORK AREA              01110021
*     - DCBREAD AND DCBCHECK FIELDS OF DCB USED TO PASS PARAMETERS      01112021
*       TO MODULE IGG01923                                              01114021
*     - IOB CSW FIELD USED TO PASS BUFFER ADDRESSES TO 1923      YM7595 01116002
*                                                                       01120020
*********************************************************************** 01140020
*                                                                       01160020
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                01180020
*                                                                       01200020
*********************************************************************** 01220020
*                                                                       01240020
RDCB     EQU   2         DCB REGISTER                                   01260020
RBASE    EQU   3         BASE REGISTER                                  01280020
RCORE    EQU   4         WORK AREA ADDRESS                              01300020
RPAR     EQU   5         TOP OF PARAMETER LIST                          01320020
RWTG     EQU   6         TOP OF WTG TABLE                               01340020
RPARC    EQU   7         CURRENT PARAMETER                              01360020
RWTGC    EQU   8         CURRENT TRANS LOAD                             01380020
RBUFADR  EQU   9         ADDR OF BUFFER                          YM7595 01390002
RUCB     EQU   10        COUNTER IN IOB GENERATION                      01420020
RDEB     EQU   11        DEB ADDRESS                                    01440020
RB       EQU   12        WORK REG1  **                                  01460020
RWK2     EQU   RB                       WORK REGISTER            Y02072 01470002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          01480020
RWK3     EQU   RC                       WORK REGISTER            Y02072 01490002
RD       EQU   14        WORK REG3  **                                  01500020
RBRNCH   EQU   15                       SUBROUTINE BR REGISTER   YM5362 01520002
RWK1     EQU   RBRNCH     WORK REGISTER                          YM7595 01530002
RWK5     EQU   0         WORK REG5                               Y02072 01540002
RF       EQU   1         WORK REG6                                      01560020
RWK4     EQU   RF                       WORK REGISTER            Y02072 01570002
*                                                                       01580020
* MASKS FOR ACCESS METHODS IN SAM                                       01640020
QSAMB    EQU   X'01'                                                    01680020
* DCB OFFSET CONSTANTS                                                  01900020
WCPO     EQU   48                                                       01940020
WCWCPL   EQU  8                         WRITE CP LEN WITH WRTCK  A31983 01950021
WCTOWCPL EQU  9                         WRITE CP LEN WITH WRTCK  A31983 01950421
*                                          AND TRK OVFLOW        A31983 01950821
THREECCW EQU  24                        LEN OF 3 CCW'S           A31983 01951221
WCPL     EQU   4                        NORMAL WRITE CP LENGTH          01952020
*        THE READ CCW OFFSET IN THE DCBOFFSR FIELD IS THE OFFSET        01956020
*        OF THE READ DATA CCW FROM THE BEGINNING OF THE SAM IOB         01960020
*        PREFIX                                                         01964020
OFFSR    EQU   X'80'                    NORMAL RD CCW OFFSET     XM6306 01968001
OFFSW    EQU   X'48'                    WRITE CCW OFFSET                01976020
WCOSRQ   EQU  X'A0'                     READ CCW OFFSET FOR WRT  A31983 01990021
*                                          CHK WITH QSAM         A31983 01992021
TOWCOSRQ EQU  X'A8'                     READ CCW OFFSET FOR WRT  A31983 01994021
*                                          CHK + TRK OV FOR QSAM A31983 01994421
WCWTOCCW EQU   46                       OFFSET FOR COUNT FIELD          01994521
WCCCW    EQU   38                       WRT CHK - NO TRK OV             01994621
EIGHT    EQU   8                        EIGHT                           01996020
FIVE     EQU   5                        FIVE                            02012020
SIX      EQU   6                        CONSTANT OF SIX                 02014021
FOUR     EQU   X'4'                     FOUR                            02016020
SETSECTR EQU   X'23'                    COMMAND CODE                    02032020
ZERO     EQU   0                        ZERO                            02036020
TWO      EQU   2                                                        02040020
THREE    EQU   3                        THREE                           02044020
SEVEN    EQU   7                        SEVEN                           02048020
D7       EQU   SEVEN                    CONST OF SEVEN                  02052021
TWELVE   EQU   12                       CONSTANT OF 12                  02056020
SIXTY5   EQU   65                       CONSTANT OF 65                  02084020
C20      EQU   20                       CONSTANT OF 20                  02088020
C23      EQU   23                       CONSTANT OF 23                  02138021
* MASKS USED TO TEST OPTION FIELDS IN DCB                               02160020
WRTCK    EQU   X'80'                                                    02220020
TRKOVFLB EQU   X'20'                    TRACK OVERFLOW OPTION           02260020
* COMMAND BYTES FOR THE 2841 CONTROL UNIT                               02340021
SEEK     EQU   X'1B'                    SEEK HEAD OP CODE        YM5362 02420002
NOP      EQU   X'03'                    NO-OPERATION OP CODE     YM5362 02430002
SRCHE      EQU   X'31'                                                  02440020
RDD        EQU   X'86'                                                  02480020
RDDX     EQU   X'06'                                                    02500020
TIC        EQU   X'08'                                                  02520020
WRTD       EQU   X'05'                                                  02540020
WRTKD    EQU   X'0D'                                                    02560020
RDKD     EQU   X'8E'                                                    02580020
*   CHANNEL CONTROL WORD FLAGS                                          02660020
SLI        EQU   X'20'                                                  02700020
CC         EQU   X'40'                                                  02720020
SLICCSK  EQU   X'70'                                                    02780020
* MASKS FOR RECORD FORMATS                                              02860020
FORMATF  EQU   X'40'                    NON FORMAT F MASK               02906020
* OFFSET FOR PARAMETER TESTS                                            02980020
ONE      EQU   1                                                        03020020
NOT      EQU   X'FF'                                                    03040020
* MASKS FOR STATUS BITS TO BE TESTED                                    03120020
SEEKCYHD EQU   X'18'                    IF BOTH ON IN FILE MASK, YM5362 03170002
*                                         INHIBIT ALL SEEKS      YM5362 03172002
READONLY EQU   X'20'                    IOB READ ONLY INDICATOR         03180020
UNRELFLG EQU   X'02'                   IOB UNRELATED FLAG        A37507 03190021
NULL     EQU   0                        ZERO DISPLACEMENT        S19015 03254020
IDLEN    EQU   5                        LENGTH OF IDTTR          S19015 03256020
*                                                                       03260020
*********************************************************************** 03270021
*                                                                       03320020
         BALR  RBASE,0                  REG 3 IS BASE                   03340020
         USING SOPB,RBASE                                               03360020
         USING IHADCB,RDCB              REG 2 IS DCB                    03380020
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDRESS      03420020
         USING DEBBASIC,RDEB                                     YM5362 03470002
         SPACE 3                                                        03472002
SOPB     EQU   *                                                        03480020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 03485002
         DC    C'IGG0191Z'              MODULE NAME              YM4640 03490002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 03495003
         DC    C'10/22/74'              LAST SHIP DATE         @Z30TSCF 03496003
BEGIN    DS    0H                       END OF MODULE ID         YM4640 03497002
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 03500020
         LA    RDCB,0(RDCB)             CLEAR HI BYTE                   03520020
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          YM5362 03530002
         L     RCORE,4(RWTGC)           GET WORK AREA ADDRESS           03560020
         L     RB,DCBIOBA               GET ADDR OF GETMAIN AREA        03680020
         LR    RD,RB                    GET ADDR OF FIRST IOB           03780020
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 03830002
         USING IOBQSAMN,RB                                       Y02072 03840002
         L     RWK3,IOBNECB             GET SECTOR ADDR          Y02072 03850002
         DROP  RB                                                Y02072 03860002
         L     RUCB,ZERO(RB)            GET IOB COUNT                   03880020
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 03890002
         STC   RUCB,DCBREAD+ONE         SAVE NO OF BUFFERS FOR IGG01923 03930021
         ST    RWK3,SECTORAD            SAVE SECTOR ADDR         Y02072 03980002
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 03990002
         XC    ZERO(TWELVE,RB),ZERO(RB)  ZERO OUT FIRST 12 BYTES        04180020
*                                       WHICH WERE USED TO PASS         04280020
*                                       INFORMATION FROM IGG0191P       04380020
         L     RWK5,SECTORAD            INIT REG TO FIRST SECTOR Y02072 04530002
*                                         ADDRESS                Y02072 04580002
         CH    RUCB,ONEIOB             ONE IOB?                  A37507 05302021
         BNE   NTONEIOB                NO - BRANCH               A37507 05304021
         USING IOBQSAMN,RB             ADDRESSABILITY FOR DSECT  Y02072 05306002
         OI    IOBFLAG1,IOBUNREL       YES - SET UNRELATED FLAG  Y02072 05308002
         DROP  RB                                                Y02072 05310002
         B     NTONEIOB                 BYPASS NEXT IOB FUNCTION        05312002
NEXTIOB  EQU   *                                                        05314021
         SR    RF,RF                    ZERO REG                        05364021
         IC    RF,DCBIOBL               IOB LENGTH IN DOUBLE WORDS      05414021
         SLL   RF,THREE                 IOB LENGTH IN BYTES             05424021
         LA    RB,ZERO(RF,RD)           ADDR OF NEXT IOB                05434021
*                                                                       05460020
*********************************************************************** 05480020
*                                                                       05500020
*    REGISTER USEAGE FOR CHANNEL PROGRAM CONSTRUCTION                   05520020
*       RB - RD/WRT SEQUENCE POINTER                                    05540020
*       RC - FDA POINTER                                                05560020
*       RD - CURRENT IOB POINTER                                        05580020
*       RJ - LINK REG TO INTERNAL SUBROUTINE                            05600020
*       RF - PARAREG FOR INTERNAL SUBROUTINE                            05620020
*       RE - INTERNAL POINTER IN READ SEQUENCE                          05640020
*                                                                       05660020
*********************************************************************** 05680020
*                                                                       05700020
NTONEIOB EQU   *                                                        05710021
         AH    RWK5,NXTSECSV            INCRE TO NEXT SECTOR     Y02072 05720002
         ST    RB,0(RD)                 LINK NEW IOB TO LAST ONE BUILT  05740020
         OI    0(RD),READONLY           IOB FOR READ ONLY         22484 05750020
         LR    RD,RB                    UPDATE CURRENT IOB POINTER      05760020
         OI    8(RD),CC                 INDICATE COMMAND CHAINING 21282 05790020
         LA    RB,4(RB)                 POINT TO ECB SLOT               05800020
         OI    0(RB),X'7F'              SET ECB COMPLETE WITHOUT ERROR  05820020
         ST    RB,12(RD)                STORE ECB ADDR IN IOB           05840020
         L     RWK4,DXUDCBAD            GET USERS DCB ADDRESS    Y02072 05850002
         USING IOBQSAMN,RD                                       Y02072 05860002
         ST    RWK4,IOBDCBPT            DCB ADDRESS TO IOB       Y02072 05870002
         DROP  RD                                                Y02072 05872002
*                                                                       05880020
*********************************************************************** 05900020
*                                                                       05920020
*     CONSTRUCTION OF CHANNEL PROGRAM FOLLOWS                           05940020
*                                                                       05960020
*********************************************************************** 05980020
*                                                                       06000020
         LA    RB,48(RD)                UPDATE TO WRITE SEQUENCE        06040020
         USING CCW,RWK2                                          Y02072 06042002
         ST    RWK5,CCWADDRA            SECT ADDR TO CCW         Y02072 06042402
         DROP  RWK2                                              Y02072 06044402
         MVI   ZERO(RB),SETSECTR        MOVE IN COMMAND CODE            06046020
         OI    FOUR(RB),CC              TURN ON COMMAND CHAIN           06048020
         MVI   D7(RB),ONE               STORE LENGTH                    06050020
         LA    RB,EIGHT(RB)             BUMP COUNTER BY EIGHT           06052020
*                                         SET SECTOR CCW GENERATED      06054021
         LA    RC,43(RD)                POINT TO CCHHR FIELD IN IOB     06060020
         ST    RC,0(RB)                 STORE ADDR IN SRCH CCW          06080020
         MVI   0(RB),SRCHE              STORE CMD BYTE                  06100020
         MVI   7(RB),X'05'              STORE COUNT OF 5 IN CCW         06120020
         OI    4(RB),CC                 SET CMD CHAIN FLAG ON           06140020
         ST    RB,8(RB)                 STORE IN TIC CCW                06160020
         MVI   8(RB),TIC                STORE TIC CMD BYTE              06180020
*                                                                       06200020
*********************************************************************** 06220020
*     SRCH AND TIC CCWS HAVE BEEN GENERATED AT THIS POINT               06260020
*     CONSTRUCTION OF WRITE CHANNEL PROGRAMS FOLLOW                     06340020
*********************************************************************** 06380020
*                                                                       06420020
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 06422002
         MVI   DCBWCPO,WCPO             WRITE CHANNEL PROGRAM OFFSET    06440020
         MVI   DCBWCPL,WCPL             STORE NORMAL WRT CP LEN.        06460020
         MVI   DCBOFFSW,OFFSW           WRITE CCW OFFSET                06480020
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 06482002
         TM    DCBRECFM,FORMATF         FORMAT F USED                   06520020
         BNO   SOPB50                   BRANCH YES                      06540020
         OI    20(RB),SLI               SET SILI FLAG ON                06560020
SOPB50   EQU   *                                                        06600020
         OI    20(RB),CC                SET COMMAND CHAIN FLAG ON       06620020
         MVI   16(RB),WRTD              STORE WRITE DATA CMD OP         06660020
         TM    DCBCIND2,QSAMB           IS QSAM USED                    06700020
         BO    SOPB505                  YES, BRANCH                     06720021
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         06760020
         BC    4,SOPB52                 NO, BRANCH                      06780020
         MVI   16(RB),WRTKD             STORE WRT KEY & DATA CMD BYTE   06820020
         B     SOPB52                                                   06840020
SOPB505  EQU   *                                                        06880021
         LA    RF,16(RB)                POINT TO ACTUAL WRT CCW         06900020
*                                                                       06950021
*        THE FOLLOWING CODE SETS UP THE CCW WITH LENGTH AND BUF ADDR    06952021
*                                                                       06954021
         TM    DCBOPTCD,WRTCK           WRITE CHECK USED?               06956021
         BNO   SOPB51                   NO, BRANCH                      06958021
         TM    DCBRECFM,TRKOVFLB        TRK OV?                         06958421
         BZ    NOTRKOV                  NO, BR                          06958821
         MVC   WCWTOCCW(TWO,RF),DCBBLKSI  COUNT OTHER THAN ZERO         06959221
         B     SOPB51                   BR AROUND                       06959621
NOTRKOV  EQU   *                                                        06959721
         MVC   WCCCW(TWO,RF),DCBBLKSI   COUNT OTHER THAN ZERO           06959821
SOPB51   EQU   *                                                        06959921
         L     RWK1,DCBBUFCB            ADDR BUF CNTRL BLOCK     YM7595 06969902
         USING BCBLK,RWK1                                               06971902
         L     RBUFADR,BCBBUFPT         ADDR OF NEXT AVAIL BUF   YM7595 06972302
         USING BUFFER,RBUFADR                                           06972702
         MVC   BCBBUFAD,BUFNXPTB        UPDATE WITH NEXT AVAIL   YM7595 06973102
         USING CCW,RF                                                   06973202
         STCM  RBUFADR,B'0111',CCWADDRB  BUFFER ADDR TO CCW      YM7595 06979902
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM7595 06981902
         USING IOBQSAMN,RD                                              06983902
         ST    RBUFADR,IOBFLAG3         SAVE BUFF ADDR FOR 1923  YM7595 06985902
         DROP  RD,RF,RWK1,RBUFADR                                       06986302
SOPB52   EQU   *                                                        06986602
         TM    DCBOPTCD,WRTCK           IS WRITE VALIDITY CHECK SPEC    06993302
         BC    14,SOPB53               NO. BRANCH                       07000020
         LA   RB,THREECCW(RB)           ADD FOR WRT CHK CCW'S    A31983 07002021
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 07002102
         MVI  DCBWCPL,WCWCPL            WRITE CP LEN, WRT CHK    A31983 07004021
         TM   DCBRECFM,TRKOVFLB         TRK OVFLOW SPECIFIED?    A31983 07006021
         BNO  NOTRKOV1                  NO, DON'T UPDATE CP LEN  A31983 07008021
         MVI  DCBWCPL,WCTOWCPL          WRITE CP LEN, WRT CHK    A31983 07058021
*                                          + TRK OVFLOW          A31983 07068021
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 07070002
         LA    RF,41(RD)                POINT TO BBCCHHR IN       18445 07082020
*                                       IOBSEEK FIELD             18445 07084020
         ST    RF,0(RB)                 STORE SEEK ADDRESS        18445 07086020
         BAL   RBRNCH,SOPB700           GO GET PROPER OP CODE    YM5362 07088002
         MVI   4(RB),CC                 SET COMMAND CHAIN FLAG ON 18445 07090020
         MVI   7(RB),X'06'              STORE COUNT OF 6 IN CCW   18445 07092020
         LA    RB,8(RB)                 UPDATE RB TO NEXT CCW     18445 07094020
         B     SOPB52A                  BR AROUND MODESET        Y02072 07094102
NOTRKOV1 EQU  *                                                  A31983 07094421
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 07094502
         USING CCW,RB                                            Y02072 07095202
SOPB52A  ST    RWK5,CCWADDRA            SECTOR ADDR TO CHAN PGM  Y02072 07107502
         DROP  RB                                                Y02072 07119502
         MVI   ZERO(RB),SETSECTR        MOVE IN COMMAND CODE            07131402
         MVI   FOUR(RB),CC              MOVE IN LENGTH                  07143302
         MVI   SEVEN(RB),ONE            INCREASE POINTER BY CCW LEN     07155202
         LA    RB,EIGHT(RB)                                             07167102
         OI    C20(RB),SLICCSK          SET SILI AND CC FLAGS ON        07179020
         ST    RC,0(RB)                 SAVE ADDRESS IN SRCH CCW        07260020
         MVI   0(RB),SRCHE              STORE SRCHE CMD BYTE            07280020
         OI    4(RB),CC                 SET CMD CHAIN FLAG ON           07300020
         MVI   7(RB),X'05'              STORE COUNT OF 5 IN CCW         07320020
         ST    RB,8(RB)                 SRCH ADDR IN TIC CCW            07340020
         MVI   8(RB),TIC                STORE TIC CMD BYTE              07360020
         MVI   16(RB),RDD               STORE READ DATA CMD OP          07380020
         MVI   C23(RB),ONE              SET READ VERIFY LENGTH ONE      07390020
         TM    DCBCIND2,QSAMB           QSAM SPECIFIED                  07400020
         BO    SOPB55                   YES, BRANCH                     07420020
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         07460020
         BC    4,SOPB53                 NO, BRANCH                      07480020
         MVI   16(RB),RDKD              STORE RD KEY & DATA CMD BYTE    07520020
SOPB53   EQU   *                                                        07560020
         TM    DCBCIND2,QSAMB           QSAM USED                       07580020
         BC    1,SOPB55                 YES, BRANCH                     07600020
         NI    20(RB),NOT-CC            CLEAR COMMAND CHAIN FOR BSAM    07620020
         LA    RB,16(RB)                POINT TO BSAM OFFSET            07660020
         B     SOPB56                                                   07680020
SOPB55   EQU   *                                                        07720020
         LA    RB,24(RB)                POINT TO READ SEQ.              07740020
*                                                                       07760020
*********************************************************************** 07780020
*    THIS SECTION GENERATES READ CHANNEL PROGRAMS                       07820020
*********************************************************************** 07860020
*                                                                       07880020
SOPB56   EQU   *                                                        07900020
         LA    RC,8(RB)                 POINT TO SRCH CCW OF RD SEQ     07940020
         ST    RC,24(RD)                STORE CP STARTAD IN IOB         07960020
         TM    DCBCIND2,QSAMB           QSAM USED?                      07970021
         BNO   SOPB60                   NO, BR                          07972021
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 07972402
         MVI   DCBOFFSR,OFFSR           STORE NORMAL RD CCW OFFSET      07980020
         TM    DCBOPTCD,WRTCK           IS WRITE VALIDITY CHECK SPEC    08000020
         BC    14,SOPB60                NO, BRANCH                      08020020
         MVI  DCBOFFSR,WCOSRQ           READ CCW OFFSET FOR QSAM A31983 08030021
*                                          WITH WRT CHK          A31983 08040021
         TM   DCBRECFM,TRKOVFLB         TRK OVFLOW SPECIFIED?    A31983 08050021
         BNO  SOPB60                    NO, DON'T UPDATE OFFSET  A31983 08052021
         MVI  DCBOFFSR,TOWCOSRQ         YES, READ CCW OFFSET FOR A31983 08054021
*                                          QSAM WITH WRTCK + TKOVA31983 08056021
SOPB60   EQU   *                                                        08080020
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET INTO USER KEY    Y02072 08082002
         LA    RC,SIXTY5(RB)            POINT TO BBCCHH FIELD           08100020
         TM    DCBCIND2,QSAMB           QSAM SPECIFIED                  08120020
         BZ    SOPB601                  NO. BRANCH                      08140020
         ST    RC,0(RB)                 STORE ADDR IN SEEK CCW          08160020
         BAL   RBRNCH,SOPB700           GO GET PROPER OP CODE    YM5362 08180002
         MVI   7(RB),X'06'              STORE COUNT OF 6 IN CCW         08200020
         OI    4(RB),CC                 SET COMMAND CHAIN FLAG ON       08220020
SOPB601  EQU   *                                                        08240020
         LA    RB,EIGHT(RB)             BUMP COUNTER BY CCW LENGTH      08243020
         MVC   ONE(THREE,RB),DXCCW11+ONE  MOVE IN ADDR OF SECTOR        08246020
         MVI   ZERO(RB),SETSECTR        MOVE IN COMMAND CODE            08249020
         OI    FOUR(RB),CC              TURN ON COMMAND CHAIN           08252020
         MVI   SEVEN(RB),ONE            MOVE IN LENGTH                  08255020
         LA    RC,2(RC)                 POINT TO CCHH FIELD             08260020
         ST    RC,8(RB)                 STORE ADDR IN SRCH CCW          08280020
         MVI   8(RB),SRCHE              STORE SEARCH COMMAND BYTE       08300020
         MVI   15(RB),X'05'             STORE COUNT OF 5 IN CCW         08320020
         OI    12(RB),CC                SET COMMAND CHAIN FLAG ON       08340020
         LA    RWK4,L'CCW(RB)           GET ADDR OF SEARCH CCW   Y02072 08350002
         ST    RWK4,2*L'CCW(RB)         STORE IN TIC CCW         Y02072 08352002
         MVI   16(RB),TIC               STORE TIC COMMAND BYTE          08400020
         LA    RWK4,4*L'CCW(RB)         GET ADDR OF RD COUNT CCW Y02072 08410002
         ST    RWK4,3*L'CCW(RB)         ST IN TIC CCW            Y02072 08412002
         MVI   24(RB),TIC               STORE TIC COMMAND BYTE          08460020
         TM    DCBRECFM,TRKOVFLB        TRACK OVERFLOW SPECIFIED        08480020
         BZ    SOPB605                  NO, BRANCH                      08500020
*                                       YES, CHANGE TIC CCW TO RD DATA  08520020
         MVI   24(RB),RDDX              READ DATA CMD OP FOR T/O        08540020
         MVI   28(RB),SLICCSK           SKIP, SILI, CC FLAGS            08560020
         MVI   31(RB),50                NON-ZERO LENGTH                 08580020
SOPB605  EQU   *                                                        08620020
         BCT   RUCB,NEXTIOB             GO BUILD NEXT IOB               08670021
         L     RWK4,DCBIOBA             GET FIRST IOB ADDR       Y02072 08720002
         USING IOBQSAMN,RD                                       Y02072 08730002
         ST    RWK4,IOBNIOBA            LINK FIRST TO LAST       Y02072 08770002
         OI    IOBNFLG1,IOBREAD         READ ONLY BIT            Y02072 08820002
         DROP  RD                                                Y02072 08830002
         MODESET EXTKEY=DATAMGT         BACK TO DATA MANAG KEY   Y02072 08840002
         USING WTGENTRY,RWTGC                                    Y02072 08890002
         MVC   WTGIDTTR,IGG01923        ID TO WTG TABLE        @Z30TSCF 08940003
         MVC   DCBCHCKA,SECTORA         SAVE SECTOR ADDRESS      Y02072 10950002
         SR    RB,RD                    GET OFFSET INTO IOB FOR         11000021
*                                          IGG01923                     11050021
         STC   RB,DCBREAD+TWO           SAVE OFFSET                     11100021
         SR    RC,RD                    OFFSET FOR IGG01923             11150021
         STC   RC,DCBREAD+THREE         SAVE OFFSET                     11200021
RELOOP   EQU   *                                                        11260020
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURR WTG ENTRY        11280020
         LA    RPARC,PLOFF(0,RPARC)     INCR CURRENT DCB ENTRY PRTR     11300020
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            11320020
         BCR   8,RBASE                                                  11340020
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    11380020
         BC    7,RELOOP                 NO,CHECK NEXT ENTRY             11400020
         LR    RPARC,RPAR                                               11440020
         LA    RWTGC,WAOFF(0,RWTG)      REINITIALIZE WTG LIST PTR       11460020
ZCHEK    EQU   *                                                        11500020
         CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           11520020
         BC    7,TCTLRTN                IF NOT TRANSFER CONTROL         11540020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  11560020
         LA    RPARC,PLOFF(0,RPARC)                                     11580020
         BC    15,ZCHEK                                                 11600020
TCTLRTN  EQU   *                                                        11640020
         USING WTG,RWTG                                                 11690003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*11740003
               MODID=WTGENTRY                                  @Z30TSCF 11790003
         DROP  RWTGC,RWTG                                      @Z30TSCF 11840003
         EJECT                                                          11850002
*                                                                       11860002
*  THE FOLLOWING WILL SET UP THE NEXT CCW AS A SEEK HEAD OR A    YM5362 11870002
*  NOP DEPENDING ON THE DEB FILE MAS FOR PERFORMANCE REASONS.    YM5362 11880002
*  IF THE FILE MASK INDICATES ALLOCATION IN CYLINDERS, SET CCW   YM5362 11890002
*  OP CODE TO A SEEK HEAD. IF ALLOCATION IS BY TRACKS, SET TO A  YM5362 11892002
*  NOP. THIS WILL PREVENT FILE MASK VIOLATIONS DURING I/O        YM5362 11894002
*  OPERATIONS AND THUS LESS ERROR PROCESSING BY APPENDAGES,      YM5362 11896002
*  EXCP, AND THE ERP.                                            YM5362 11898002
*                                                                       11900020
SOPB700  EQU   *                                                 YM5362 11910002
         LA    RWK4,DEBBASND            ADDR OF DEB FILE MASK    YM5362 11912002
         USING DEBDASD,RWK4                                      YM5362 11914002
         USING CCW,RB                                            YM5362 11916002
         MVI   CCWCOMCD,SEEK            ASSUME ALLOC IN CYLS     YM5362 11918002
         TM    DEBDVMOD,SEEKCYHD        IS ALLOCATION IN CYLS    YM5362 11918402
         BNOR  RBRNCH                   YES, SEEK HEAD OP CD OK  YM5362 11918802
         MVI   CCWCOMCD,NOP             NO, MAKE OP CD A NOP     YM5362 11919202
         BR    RBRNCH                   RETURN MAINLINE          YM5362 11919602
         DROP  RB,RWK4                                           YM5362 11924702
         SPACE 6                                                        11929802
WAOFF    EQU   32                                                       11934902
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           11940020
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           11960020
OPIDCNST DC    C'0S'                                                    11980020
AMIDCNST DC    C'1Z'                    THIS MODULES ID                 12000020
ONEIOB   DC    H'1'                    FOR NO OF IOB'S TEST      A37507 12030021
NXTSECSV EQU   ONEIOB                   LEN OF A SECTOR SAVE AR  Y02072 12032002
IGG01923 DC    C'23',VL3(IGG01923)      NEXT MOD               @Z30TSCF 12040003
PATCH    DC    0H'0',50X'00'            PATCH AREA               Y02072 12050002
END      EQU   *                        END OF MODULE            Y02072 12100002
         EJECT                                                          12102003
CVT      DSECT                                                 @Z30TSCF 12104003
         CVT                                                   @Z30TSCF 12106003
         EJECT                                                          12110002
         IGGBCB  TYPE=SAM                                               12112002
         EJECT                                                          12114002
         IEZDEB                                                         12120002
         EJECT                                                          12130002
         DCBD  DSORG=PS                                                 12150002
         TITLE 'IGG0191Z - FORMAT OF GOTTEN CORE'                       12820002
*                                                                       12840020
         IECDSECS  (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES    @Z30TSCF 12890003
         ORG   WTGIDTTR                                          Y02072 12892002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 12894002
FORCORE  DSECT                                                   Y02072 12896002
         ORG   DXCCW11                                           Y02072 12900002
SECTORAD DS    0F                       SAVE AREA FOR SECTOR AD  Y02072 12910002
         DS    X                        FILLER                   Y02072 12912002
SECTORA  DS    AL3                                               Y02072 12914002
         EJECT                                                          12914402
         IHACCW  DSECT=YES                                       Y02072 12916002
           END                                                          12920020
