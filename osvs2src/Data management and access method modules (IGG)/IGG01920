         TITLE 'IGG01920-VALIDATE FORMAT2 DSCB FOR SCAN AND BISAM'      00080020
IGG01920 CSECT                                                          00081002
*                                                                       00082002
*********************************************************************** 00083002
*                                                                     * 00084002
* MODULE-NAME = IGG01920                                              * 00085002
*                                                                     * 00086002
* DESCRIPTIVE-NAME = ISAM OPEN, FIXED LENGTH VALIDATION ROUTINE       * 00087002
*                                                                     * 00088002
* COPYRIGHT = NONE                                                    * 00089002
*                                                                     * 00090002
*        VS2 RELEASE 3 CHANGES                                          00090402
* A227500-227980,D505500                                        ZM01121 00090802
*   PTM ZM01121 IS THE EQUIVALENT OF APAR ZA00957               ZA00957 00140802
* C227700                                                      @ZA10616 00190837
* A227100-227400,C660300                                       @ZA17080 00200837
* A227340-227400,227420,661300                                 @ZA25348 00210837
* D227420,C227410                                              @ZA30618 00215837
* A506700                                                      @ZA30069 00220837
* A227361-227366                                               @ZA29046 00230837
*             CHANGES SINCE VS2-3.7                                   * 00233837
*A227970                                                       @ZA33836 00236837
* STATUS = RELEASE OS/VS2-02, LEVEL 0                                 * 00240802
*                                                                     * 00290802
* FUNCTION = IF DCB IS OPENED FOR SHARE, AND M OF DFALPDA IS NOT 0,   * 00340802
*            XCTL TO NEXT EXECUTOR; OTHERWISE INITIALIZE CP VXCCW1A   * 00390802
*            TO READ EOF OR END OF LPDA TRACK FOR PRIME DATA, AND     * 00440802
*            UPF ENDDS2LPRAD AND DS2STIND IF INCORRECT.  GET CORE FOR * 00490837
*            BUFFER FROM SUBPOOL 229 IN PROTECT KEY 5 (FETCH          * 00540802
*            PROTECTED), SET FILE MASK TO PROHIBIT HEAD SEEKS, AND    * 00590802
*            TEST FOR PADDING IN LAST BLOCK IF LAST BLOCK AND LAST    * 00640802
*            TRACK FULL BITS AREN'T ON.  FREE SUBPOOL 229 CORE BEFORE * 00690802
*            EXIT.  IF SCAN OR BISAM, DCB OPENED FOR SHARE, AND M OF  * 00740802
*            DFALPDA IS 0, MERGE F2 DSCB FIELDS INTO FIELD AREA.      * 00790802
*                                                                     * 00840802
* NOTES = THE FORMAT 2 VALIDATION MODULE IS SPLIT INTO IGG01920 AND   * 00890802
*         IGG01922.  THEY RUN IN TANDEM, AND ALWAYS TOGETHER.         * 00940802
*         IGG01920 VALIDATES FIELDS FOR PRIME DATA, AND IGG01922      * 00990802
*         DOES THE SAME FOR OVERFLOW.  THE EOF CHANNEL PROGRAM IS     * 01040802
*         PREPARED BY IGG01920 AND USED TO READ IN DATA BLOCKS FOR    * 01090802
*         LAST BLOCK FULL VERIFICATION.                               * 01140802
*                                                                     * 01190802
*    DEPENDENCIES = NONE                                              * 01240802
*                                                                     * 01290802
*    RESTRICTIONS = NONE                                              * 01340802
*                                                                     * 01390802
*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                     * 01440802
*                                                                     * 01490802
*    PATCH-LABEL = PATCH, A DC STATEMENT.                             * 01540802
*                                                                     * 01590802
* MODULE-TYPE = OPEN EXECUTOR                                         * 01640802
*                                                                     * 01690802
*    PROCESSOR = ASSEMXF-370R                                         * 01740802
*                                                                     * 01790802
*    MODULE-SIZE = 988 DECIMAL BYTES                                  * 01840802
*                                                                     * 01890802
*    ATTRIBUTES = PRIVILEGED, REENTRANT                               * 01940802
*                                                                     * 01990802
* ENTRY-POINT = IGG01920                                              * 02040802
*                                                                     * 02090802
*    PURPOSE = SEE FUNCTION                                           * 02140802
*                                                                     * 02190802
*    LINKAGE = RECEIVES CONTROL FROM RESTART MODULE IGC0W05B IF       * 02240802
*              RESTART IS IN CONTROL, OTHERWISE FROM ISAM OPEN        * 02290802
*              EXECUTOR IGG01921 IF RESUME LOAD, OR IGG0192C FOR SCAN * 02340802
*              OR BISAM MODE.  RECEIVES CONTROL IN STORAGE PROTECT    * 02390802
*              KEY 5 AND PRIVILEGED STATE.                            * 02440802
*                                                                     * 02490802
* INPUT = REGISTERS ESTABLISHED UPON ENTRY ARE                        * 02540802
*         REG 5 (RPAR) POINTS TO THE DCB COPY PARAMETER LIST          * 02590802
*         REG 6 (RWTG) POINTS TO THE O/C/EOV WHERE-TO-GO TABLE        * 02640802
*         REG 7 (RPARC) POINTS TO THE CURRENT ENTRY IN THE DCB COPY   * 02690802
*               PARAMETER LIST                                        * 02740802
*         REG 8 (RWTGC) POINTS TO THE CURRENT ENTRY IN THE WTG TABLE  * 02790802
*                                                                     * 02840802
*         HOWEVER, IF ENTERED FROM RESTART, REGISTERS ARE ESTABLISHED * 02890802
*         AS FOLLOWS:                                                 * 02940802
*         REG 1 (R1) POINTS TO THE RESTART AREA                       * 02990802
*         REG 4 (RCORE) POINTS TO THE OPEN WORK AREA                  * 03040802
*         REG 7 (RPARC) IS ZERO                                       * 03090802
*         REG 8 (RWTGC) POINTS TO THE RESTART TABLE                   * 03140802
*         REG 9 (RDEB) POINTS TO THE CURRENT RESTART ENTRY            * 03190802
*                                                                     * 03240802
* OUTPUT = REGISTERS 5 THROUGH 8 WILL BE IN THE SAME CONDITION AS     * 03290802
*          UPON ENTRY TO THIS MODULE                                  * 03340802
*                                                                     * 03390802
* EXIT-NORMAL = XCTL TO IGC0W05B IF RESTART IS IN CONTROL, OTHERWISE  * 03440802
*               TO ISAM OPEN EXECUTOR IGG01922 IN STORAGE PROTECT KEY * 03490802
*               5.                                                    * 03540802
*                                                                     * 03590802
* EXIT-ERROR = ABEND CODES:                                           * 03640802
*              033 - I/O ERROR TRYING TO READ EOF                     * 03690802
*                                                                     * 03740802
*              IF RESTART ENTERED THIS MODULE, DO NOT ISSUE ABEND,    * 03790802
*              BUT XCTL TO IGC0W05B WITH ABEND CODE IN REGISTER 1.    * 03840802
*                                                                     * 03890802
* EXTERNAL-REFERENCES = SEE BELOW                                     * 03940802
*                                                                     * 03990802
*    ROUTINES = NONE                                                  * 04040802
*                                                                     * 04090802
*    DATA-AREAS = AREAS REFERENCED ARE:                               * 04140802
*                 FORCORE - OPEN WORK AREA                            * 04190802
*                                                                     * 04240802
*    CONTROL-BLOCKS = DCB, DCB COPY, DCBFA, DEB, DSCB, ECB, AND IOB.  * 04290802
*                                                                     * 04340802
* TABLES = NONE                                                       * 04390802
*                                                                     * 04440802
* MACROS = GETMAIN, FREEMAIN, EXCP, AND WAIT.                         * 04490802
*                                                                     * 04540802
* CHANGE-ACTIVITY = AS FOLLOWS:                                       * 04590802
*                                                                     * 04640802
*                                                                     * 07806002
*********************************************************************** 07807002
         EJECT                                                          07808002
DS2DSECT DSECT           FORMAT 2 DSCB                                  07809002
         DS    0D                                                       07810019
DS2KEY   DS    CL44                                                     07815019
DS2FMTID DS    CL1                                                      07820019
DS2NOLEV DS    CL1                                                      07825019
DS2DVIND DS    CL1                                                      07830019
DS21RCYL DS    CL3                                                      07835019
DS2LTCYL DS    CL2                                                      07840019
DS2CYLOV DS    CL1                                                      07845019
DS2HIRIN DS    CL1                                                      07850019
DS2HIRPR DS    CL1                                                      07855019
DS2HIROV DS    CL1                                                      07860019
DS2RSHTR DS    CL1                                                      07865019
DS2HIRTI DS    CL1                                               O19113 07870019
DS2HIIOV DS    CL1                                               O19113 07875019
DS2TAGDT DS    CL2                                                      07880019
DS2RORG3 DS    CL3                                                      07885019
DS2NOBYT DS    CL2                                                      07890019
DS2NOTRK DS    CL1                                                      07895019
DS2PRCTR DS    CL4                                                      07900019
DS2STIND DS    CL1                                                      07905019
DS2CYLAD DS    CL7                                                      07910019
DS2ADLIN DS    CL7                                                      07915019
DS2ADHIN DS    CL7                                                      07920019
DS2LPRAD DS    CL8                                                      07925019
DS2LTRAD DS    CL5                                                      07930019
DS2LCYAD DS    CL5                                                      07935019
DS2LMSAD DS    CL5                                                      07940019
DS2LOVAD DS    CL8                                                      07945019
DS2BYOVL DS    CL2                                                      07950019
DS2RORG2 DS    CL2                                                      07955019
DS2OVRCT DS    CL2                                                      07960019
DS2RORG1 DS    CL2                                                      07965019
FORCORE  DSECT                                                          08000000
         IECDSECT                                                       08200000
*                       CP TO READ TO EOF                        A25984 10200019
         ORG   DXCCW                                             A25984 12200019
VXCCW1   CCW   SIDEQ,0,CC,5              ARG=LPDA+3              A30485 12500020
VXCCW2   CCW   TIC,VXCCW1-VXCCW1,0,0   TIC CCW1                  A30485 12800020
VXCCW2A  CCW   TIC,VXCCW3A-VXCCW1,0,0   1ST TIME TIC FOR SEARCH  A30485 13100020
*                                       DIRECT                   A30485 13400020
VXCCW3   CCW   MT+RDCNT,VXCCW6-VXCCW1,CC,8                       A30485 13700020
VXCCW3A  CCW   RDATA,0,CC+SILI,0         LEN=BLKSIZE             A30485 14000020
VXCCW4   CCW   MT+RDCNT,VXCCW7-VXCCW1,CC,8                       A30485 14300020
VXCCW4A  CCW   RDATA,0,CC+SILI,0         LEN=BLKSIZE             A30485 14600020
VXCCW5   CCW   TIC,VXCCW3-VXCCW1,0,0                             A30485 14900020
VXCCW6   DC    2F'0000'                 COUNT FLD    CCHHRKDD    A30485 15200020
VXCCW7   DC    2F'0000'                 COUNT FLD    CCHHRKDD    A30485 15500020
VXCCW8   DS    CL8                       NEW MBBCCHHR            A30485 15800020
SAVEREG  DS    CL8                     REG. SAVE AREA                   16840000
         DS    CL4                     OLD TTR                          16880000
SAVER2   DS    CL2                     NEW R VALUE                      16920000
SAVER1   DS    CL2                     OLD R VALUE                      16960000
         DCBD  DSORG=IS                                          O19113 16980019
SIDEQ    EQU   X'31'                                             A30485 16990020
TIC      EQU   X'08'                                             A30485 17000020
RDCNT    EQU   X'12'                                             A30485 17010020
RCKD     EQU   X'1E'                                             A30485 17020020
MT       EQU   X'80'                                             A30485 17030020
RDATA    EQU   X'06'                                             A30485 17040020
DC       EQU   X'80'                                             A30485 17050020
CC       EQU   X'40'                                             A30485 17060020
BLOCKED  EQU   X'10'                    DCBRECFM CODE FOR BLKED ZM01121 17070002
DCBFA     IGGDCBFA                                                      17080020
         EJECT                                                          17090002
IHADEB   IGGDEBD                                                 Y02072 17100002
         EJECT                                                          17130002
R0       EQU   0                        WORK REG                        17200000
RVAL     EQU   1                        BASE REG FOR VALIDATE CP        17400000
RDSCB    EQU   2                        BASE REG FOR DSCB FORMAT 2      17600000
RBASE    EQU   3                        BASE REG FOR THIS MODULE        17800000
RCORE    EQU   4                        BASE REG FOR OPEN WORK AREA     18000000
RPAR     EQU   5         *              ADDR OF PARAMETER TABLE         18200000
RWTG     EQU   6         *              ADDR OF WHERE-TO-GO TABLE       18400000
RPARC    EQU   7         *              CURRENT PARAMETER ENTRY         18600000
RWTGC    EQU   8         *              CURRENT WHERE-TO-GO ENTRY       18800000
RRSTC    EQU   9                        CURRENT RESTART ENTRY    A44475 18900021
RDEB     EQU   9                        DEB PTR                         19000000
RA       EQU   10                       WORK REG                        19200000
RB       EQU   11                       WORK REG                        19400000
RC       EQU   12                       WORK REG                        19600000
RD       EQU   13                       WORK REG                        19800000
RE       EQU   14                       WORK REG                        20000000
RF       EQU   15                       WORK REG                        20200000
RJ       EQU   15                                                       20400000
R1       EQU   1                                                        20600000
*                                                                       20800000
*                                                                       21000000
L3BYTE   EQU   7                        STORE 3 LOW ORDER BYTES  Y02072 21050002
SHR      EQU   X'80'                    TEST FOR DISP EQ SHR     Y02072 21200002
SUB229   EQU   229                      SUBPOOL 229 FOR BUFFER   Y02072 21202002
SILI     EQU   X'20'                                             A30485 21208020
SKIP     EQU   X'10'                                             A30485 21216020
EQ       EQU   8                                                 A30485 21224020
LO       EQU   4                                                 A30485 21232020
LBF      EQU   X'02'                                             A30485 21240020
LTF      EQU   X'01'                                             A30485 21248020
REC1     EQU   X'01'                    RECORD NO IS 1                  21258002
TWO      EQU   2                        *                               21258402
         EJECT                                                   A25984 21260019
IGG01920 CSECT                                                   A25984 21320019
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        21400000
         USING *,RBASE                                                  21600000
         USING FORCORE,RCORE                                            21800000
         USING DS2DSECT,RDSCB                                           22000000
         USING IHADCB,RB                                         A25984 22030019
         LTR   RPARC,RPARC              CHECK FOR RESTART ENTRY  A25984 22060019
         BNZ   OPEN                     BRANCH IF NOT            A25984 22090019
         STM   RDSCB,RA,DXDSCB          SAVE REG 2-10 IN F1 DSCB A25984 22120019
         L     RB,0(RRSTC)              GET CURRENT DCB ADDR     A44475 22150021
         LA    RDSCB,DXJBF              POINT TO FORMAT 2 DSCB   A25984 22180019
         B     COMMON                                            A25984 22210019
OPEN     EQU   *                                                 A25984 22240019
         USING IHADCB,RB                                         O19113 22300019
         L     RB,0(RPARC)              SET DCB ADDR                    22400000
         L     RCORE,4(RWTGC)           SET OPEN WK AREA ADDR           22600000
         L     RDSCB,DSCCORE            SET PTR TO F2 DSCB       A25984 22700019
         CLC   DCBKEYLE,DSCKEYL         IS KEY EQUAL ?         @ZA17080 22710037
         BNE   AB03B                    NO ABEND               @ZA17080 22713037
         CLI   DCBRECFM,X'00'           IS RECFM 0?            @ZA17080 22716037
         BE    AB03B                    YES, ABEND             @ZA17080 22719037
         IC    RF,DCBRECFM              SAVE RECFM             @ZA17080 22722037
         NI    DCBRECFM,X'FE'           RESET KEYL  BIT        @ZA17080 22725037
         CLC   DCBRECFM,DSCRECFM        DOES DCB RECFM EQUAL   @ZA17080 22728037
*                                       DSCB1 RECFM ??         @ZA17080 22731037
         BE    TESTRECL                 YES-GO TEST LRECL      @ZA25348 22734037
         CLI   DCBRECFM,X'90'           NO-IS DCB FB?          @ZA25348 22735037
         BE    FBDCB                    YES-GO TEST DSCB       @ZA25348 22736037
         TM    DCBRECFM,X'80'           IS DCB F?              @ZA29046 22736137
         BZ    ABORT                    NO-GO ABEND            @ZA29046 22736237
         TM    DSCRECFM,X'90'           IS DSCB FB?            @ZA29046 22736337
         BNO   ABORT                    NO-GO ABEND            @ZA29046 22736437
         CLC   DCBBLKSI,DCBLRECL        BLOCKING FACTOR OF 1?  @ZA29046 22736537
         BE    TESTRECL                 YES-GO TEST MORE       @ZA29046 22736637
ABORT    STC   RF,DCBRECFM              RESTORE RECFM          @ZA25348 22737037
         B     AB03B                    AND ABEND              @ZA25348 22738037
FBDCB    CLI   DSCRECFM,X'80'           IS DSCB F?             @ZA25348 22739037
         BNE   ABORT                    NO-GO ABEND            @ZA25348 22740037
TESTRECL STC   RF,DCBRECFM              RESTORE RECFM          @ZA30618 22741037
         CLC   DCBLRECL,DSCLRECL        DOES LRECL EQ FMT1      ZM01121 22750037
         BNE   AB03B                    NO,ABEND                ZM01121 22760002
         TM    DSCRECFM,BLOCKED         RECORDS BLOCKED?       @ZA10616 22770037
         BNO   COMMON                   NO, BRANCH              ZM01121 22780002
         CLC   DCBBLKSI,DSCBLKL         DOES DCB BLKSIZE EQUAL  ZM01121 22790002
*                                       DSCB BLKSIZE?           ZM01121 22792002
         BE    COMMON                   YES, BRANCH - AOK       ZM01121 22794002
AB03B    EQU   *                                                        22796002
         LR    RDSCB,RB                 DCB PTR FOR PROB DETER @ZA33836 22797037
         ABEND X'03B',DUMP,,SYSTEM      EXECUTE 03B ABEND       ZM01121 22798002
COMMON   EQU   *                                                 A25984 22800019
         L     RDEB,DCBDEBAD            SET DEB BASE             A44475 22803021
         USING IHADEB,RDEB              DEB ADDRESSABILITY       Y02072 22805002
         L     RA,DEBEXPTR              ADDR OF DEB EXTENSION    Y02072 22805402
         USING DEBEXT,RA                USING ON DEB EXTENSION   Y02072 22805802
*                                                                       22807020
*   IF DATA SET HAS BEEN OPENED FOR SHR, DEBDCBFA WILL CONTAIN          22814002
*        A POINTER TO THE DCBFA.                                        22821002
*                                                                       22835020
         TM    DEBDCBFA,SHR             TEST FOR DISP=SHR        Y02072 22842002
         BZ    CNTINU                   BR TO CONTINUE RTN IF    A35340 22849020
*                                       NOT                      A35340 22856020
         L     RA,DEBDCBFA              ADDR OF DCBFA            Y02072 22860002
         USING DCBFA,RA                                          A37175 22864020
         CLI   DFALPDA,X'00'            IS M IN DCBLPDA ZERO     A37175 22868020
         BNE   NEXTEXEC                 IF NOT,VALID             A37175 22872020
CNTINU   EQU   *                                                 A35340 22877020
*                                                                       22884020
         SR    RVAL,RVAL                CLEAR REGISTER           O19113 23020019
*                                                                       23200000
         LA    RVAL,DXCCW1              POINT TO WORKAREA CCWS   A25984 24100019
         ST    RB,IOBWGHT               SET DCB ADDR IN PHONY IOB       25000000
*INITIALIZE CHANNEL PROG TO READ EOF                                    25200000
*                                                                       25400000
         LM    RA,RF,VALCCW1           PICK UP CCW'S 1,2,2A      A30485 25460020
         DROP  RB                                                A30485 25520020
         LA    R0,DXDAADDR+3            SET ADDR IN CCW1 TO CCHHR 21684 25600018
         ALR   RA,R0                       IN DS2LPRAD                  25800000
         ALR   RC,RVAL                  RELOCATE ADDR FLDS IN           26000000
         ALR   RE,RVAL                     CCW2 AND CCW2A        A30485 26040020
         STM   RA,RF,VXCCW1             INIT.VXCCW1,2,2A         A30485 26080020
         LR    RA,RVAL                   SAVE RELOC. CONST.      A30485 26120020
         L     RB,IOBWGHT                ESTABLISH DCB ADDRESS   A30485 26160020
         USING IHADCB,RB                                         A30485 26200020
         LH    R0,DCBBLKSI               SIZE OF BUFFER TO       A30485 26240020
*                                       VERIFY                   A30485 26280020
*                                        LAST BLK FULL. (LBF)           26320020
         LA    RB,SUB229                SUBPOOL 229              Y02072 26330002
         SLL   RB,24                    SHIFT TO HIGH BYTE       Y02072 26340002
         OR    R0,RB                    PACK LENGTH AND SUBPOOL  Y02072 26350002
         GETMAIN R,LV=(0)                GET BUFFER TO VALIDATE  A30485 26360020
*                                       LBF.                     A30485 26400020
         LA    R1,0(,R1)                 CLEAR HI BYTE.          A30485 26440020
*                                        R1=RVAL=BUFFER ADDR            26480020
         LR    R0,RA                     R0= RELOC. CONST.       A30485 26520020
         LM    RA,RF,VALCCW3             PICK UP CCW'S 3,3A,4    A30485 26560020
         DROP RB                                                 A30485 26600020
         OR    RC,R1                     BUFFER ADDR TO CCW3A    A30485 26640020
         ALR   RA,R0                    RELOC CCW3               A30485 26680020
         ALR   RE,R0                    RELOC CCW4               A30485 26720020
         L     R1,IOBWGHT                ESTABLISH DCB ADDRESS   A30485 26760020
         USING  IHADCB,R1                                        A30485 26800020
         LH    R1,DCBBLKSI               GET BUFFER SIZE         A30485 26840020
         DROP  R1                                                A30485 26880020
         OR    RD,R1                     BUFFER SIZE TO CCW3A    A30485 26920020
         STM   RA,RF,VXCCW3              PUT CCW'S 3,3A,4 IN     A30485 26960020
*                                       WORK AREA                A30485 27000020
         STM   RC,RD,VXCCW4A            PUT CCW4A IN W.A.        A30485 27040020
*                                       (CCW3A=CCW4A             A30485 27080020
         LM    RA,RB,VALCCW5             PICK UP CCW5            A30485 27120020
         ALR   RA,R0                     RELOC. TIC ADDR         A30485 27160020
         STM   RA,RB,VXCCW5              PUT IN WORK AREA        A30485 27200020
*                                                                       27400000
         MVC   DXDAADDR,DS2LPRAD        SET UP IOB SEEK ADDR            27600000
*                                                                       27800000
*                                                                 16068 27810016
* SET UP DEB TO MAKE THE CP STOP AT THE END OF TRACK              16068 27820016
         MVC   VXCCW5+4(1),36(RDEB)     SAVE NO. PRIME DATA EXT   16068 27830016
         MVC   36(1,RDEB),DS2LPRAD      SET EQ M OF LPDA          16068 27840016
*                                                                 16068 27850016
         SR    RA,RA                    CLEAR WORK REG.           16068 27860016
         IC    RA,DXDAADDR              GET M                     16068 27870016
         SLL   RA,4                     M X 16                    16068 27880016
         LA    RA,32(RA,RDEB)           POINT TO EXT OF M         16068 27890016
         MVC   VXCCW5+5(1),0(RA)        SAVE FILE MASK            16068 27900016
         MVI   0(RA),X'18'              SET FILE MASK TO PROHIBIT 16068 27910016
*                                         HH SEEKS                16068 27920016
         MVC   VXCCW2+4(4),10(RA)      SAVE END CCHH              16068 27930016
         MVC   10(4,RA),DXDAADDR+3     SET END CCHH EQ LPRAD CCHH 16068 27940016
*                                                                 16068 27950016
         BAL   RC,EOTREAD               GO READ PRIME DATA EOT   A35340 27956020
*                                                                 16068 27970016
         MVC   36(1,RDEB),VXCCW5+4      RESTORE NO. PRIME EXT.    16068 27980016
         MVC   0(1,RA),VXCCW5+5         FILE MASK                 16068 27990016
         MVC   10(4,RA),VXCCW2+4        END CCHH                  16068 28000016
*                                                                 16068 28010016
         TM    IOBSTAT0,X'01'           END OF FILE                     28200000
         BO    SETLPDA                 YES                              28400000
         CLI   IOBECBPT,X'42'           TEST END OF EXTENT        16068 28600016
         BNE   GOABEND                  BRANCH IF NO, PERM ERROR A25984 29300019
*                                                                       30000000
SETLPDA  LA    RB,SETLPDA2                                              30200000
         BAL   RF,STOPCHK                                               30600000
* SET UP NEW MBBCCHHR                                                   30800000
*                                                                       31000000
SETLPDA1 MVC   VXCCW8+3(5),VXCCW6       CCHHR FROM 1ST CT FLD           31200000
         B     SETLPDA3                                                 31400000
SETLPDA2 EQU   *                                                 A42899 31480021
         NC    VXCCW7(5),VXCCW7         TEST A COUNT READ        A42899 31560021
         BZ    OKDCBST1                 IF NOT LEAVE LPRAD SAME  M1775  31640021
         MVC   VXCCW8+3(5),VXCCW7       CCHHR FROM IND CNT FLD   A42899 31720021
SETLPDA3 MVC   VXCCW8(3),DS2LPRAD       MBB INIT.SAME AS DSCB           31800000
         MVC   DS2LPRAD,VXCCW8          UPDATE DS2LPRAD          A30485 32000020
         XC    VXCCW8+1(2),VXCCW8+1    ZERO BB                          32200000
OKDCBST1 EQU   *                        *                        M1775  32204021
         TM    DS2STIND,X'03'           WERE BOTH LAST TRK AND    MC0P  32210000
*                                       BLK FULL BITS ON          MC0P  32220000
         BO    OKDCBST                  YES, DCBST BITS OK        MC0P  32230000
* TEST LAST BLOCK FOR PADDING. SET LAST BLOCK FULL IF NONE FOUND.       32230620
         NI    DS2STIND,255-(LBF+LTF)    RESET BOTH FOR CLEANUP. A30485 32231220
         L     RA,VXCCW3A                BUFFER ADDR OF LAST BLK A30485 32231820
         LR    RB,RA                     BUILD STOPPING ADDR     A30485 32232420
         AH    RB,VXCCW3A+6              RB=BUFFER ADDR+BLKSIZE  A30485 32233020
PADLOOP  CR    RA,RB                     CHECK FOR END OF BUFFER A30485 32233620
         BL    PADTEST                   BIF NOT EOB             A30485 32234220
         B     NOPAD                     NO PADDING FOUND        A30485 32234820
PADTEST  CLI   0(RA),X'FF'               FIRST BYTE MUST BE ONES A30485 32235420
         BNE   PADBUMP                   GO CHECK NEXT LRECL     A30485 32236020
         L     RC,IOBWGHT                ESTABLISH DCB ADDRESS   A30485 32236620
         USING IHADCB,RC                                         A30485 32237220
         LH    RC,DCBLRECL               INCREMENT THRU BUFFER   A30485 32237820
*                                       BY LREC                  A30485 32238420
         DROP  RC                                                A30485 32239020
         BCTR  RC,R0                     DECREMENT FOR COMPARE   A30485 32239620
*                                       USE                      A30485 32240220
         LA    RD,255                    COMPARE LENGTH          A30485 32240820
PADCOMP  CLR   RC,RD                     REMAINING LEN GT 255?   A30485 32241420
         BNH   PADLAST                   BIF NOT.  LAST PASS.    A30485 32242020
         CLC   0(255,RA),1(RA)           COMPARE 255 BYTES TO    A30485 32242620
*                                       X'FF'                    A30485 32243220
         BNE   PADBUMP                   BIF NOT PADDING         A30485 32243820
         SR    RC,RD                     DECREMENT LEN BY 255    A30485 32244420
         AR    RA,RD                     INCREMENT ADDR BY 255   A30485 32245020
         B     PADCOMP                   CONTINUE TO END OF      A30485 32245620
*                                       LRECL                    A30485 32246220
PADLAST  BCTR  RC,R0                     ADJUST REMAINDER FOR    A30485 32246820
*                                       EX'D COM                 A30485 32247420
         EX    RC,COMPARE                COMPARE LT 255 BYTES TO A30485 32248020
*                                       X'FF'                    A30485 32248620
         BE    PADDING                   PADDING FOUND           A30485 32249220
PADBUMP  L     RC,IOBWGHT                ESTABLISH DCB ADDRESS   A30485 32249820
         USING IHADCB,RC                                         A30485 32250420
         AH    RA,DCBLRECL               INCREMENT BUFFER PTR TO A30485 32251020
*                                       NEXT                     A30485 32251620
*                                        LRECL TO BE CHECKED.           32252220
         B     PADLOOP                   TEST NEXT LECREL FOR    A30485 32252820
*                                       PADDING                  A30485 32253420
         DROP  RC                                                A30485 32254020
COMPARE  CLC   0(0,RA),1(RA)             COMPARE FEWER THAN 255  A30485 32254620
*                                       BYTES                    A30485 32255220
NOPAD    EQU   *                                                 A30485 32255820
         OI    DS2STIND,LBF              SET LAST BLK FULL IND.  A30485 32256420
PADDING  EQU   *                                                 A30485 32257020
         CLC   VXCCW8+5(2),DS21RCYL     HH = FIRSH HH ?          A36764 32258020
         BNE   NOTSHR                   NO, NOT SHARED TRK       A36764 32259020
         CLI   DS21RCYL+TWO,REC1        FIRSH R = 1 ?           SA61635 32260002
         BE    NOTSHR                   YES, NOT SHARED TRK      A36764 32261020
         LA    R1,DS2RSHTR        SHARED TRACK - HI R            A36764 32262020
         B     TESTFULL           BR TO TEST IF FULL TRK         A36764 32263020
NOTSHR   LA    R1,DS2HIRPR              PRIME TRACK - HI R       A36764 32264020
TESTFULL CLC   VXCCW8+7(1),0(R1)        IS LAST TRACK FULL ?     A36764 32265020
         BNE   TRKNFULL                 NO, BRANCH                MC0P  32270000
         OI    DS2STIND,X'01'           SET LAST TRK FULL SWITCH  MC0P  32280000
*                                       ON                        MC0P  32290000
TRKNFULL EQU   *                                                  MC0P  32300000
OKDCBST  EQU   *                                                  MC0P  32310000
         LH    R0,VXCCW3A+6              BUFFER LEN              A30485 32350020
         LA    R1,SUB229                SUBPOOL 229              Y02072 32360002
         SLL   R1,24                    SHIFT TO HIGH BYTE       Y02072 32370002
         OR    R0,R1                    PACK SUBPOOL AND LNGTH   Y02072 32380002
         L     R1,VXCCW3A                BUFFER ADDR             A30485 32390020
         FREEMAIN R,LV=(0),A=(1)         FREE BUFFER USED TO SET A30485 32430020
*                                       LBF                      A30485 32470020
         B     NOEXEC1                  BR TO FILL DCBFA FIELDS  A37175 32530020
*                                                                       32600000
*                                                                       47400000
* DETERMINE WHICH CCW THE CHANNEL PROG STOPPED ON;THE ONLY VALID STOPS  47600000
* ARE ON CCW'S 3,3A,4,4A, ACCORDING TO THE FOLLOWING CHART              47630020
*                                                                       47660020
*                             STOPS                USE COUNT FIELD      47690020
*                      ----------------------------------------------   47720020
*                        EOF        EOT                                 47750020
*       CCW3                         X                   2              47780020
*       CCW3A             X                              2              47810020
*       CCW4                         X                   1              47840020
*       CCW4A             X                              1              47870020
*                                                                       47900020
*                                                                       48000000
*                                                                       48200000
STOPCHK  L     RC,IOBCOMAD              ADDR OF NXT CCW TO BE EXEC.     48400000
         LA    RC,0(RC)                 CLEAR HI ORDER BYTE             48600000
         LA    RD,VXCCW3                                         A30485 48640020
         CR    RC,RD                     CHECK FOR STOP ON CCW1  A30485 48680020
*                                       OR 2                     A30485 48720020
         BNH   GOABEND                   ABEND IF STOP ON EITHER A30485 48760020
         LA    RD,VXCCW4                ADDR OF CCW4                    48800000
         CR    RC,RD                    NXT CCW IS VXCCW4               49000000
         BH    SNDSTOP                   BIF NO STOP ON CCW3 OR  A30485 49100020
*                                       3A                       A30485 49200020
FRSTOUT  BR    RB                       NO,UPDATE DSCB PTR TO 2ND CNT   49800000
SNDSTOP  LA    RD,VXCCW5                ADDR OF CCW5                    50000000
         CR    RC,RD                    NXT CCW IS VXCCW5               50200000
         BC    EQ+LO,SNDOUT              YES, UPDATE DSCB PTR    A30485 50270020
*                                       WITH                     A30485 50340020
*                                        FIRST COUNT FIELD.             50410020
GOABEND  EQU   *                        COME HERE IF ERROR       A25984 50500019
         LTR   RPARC,RPARC              IS RESTART IN CONTROL    A25984 50600019
         BZ    RESTARTX                 DON'T ABEND IF SO        A25984 50650019
         L     RCORE,DXUDCBAD           USERS DCB ADDRESS      @ZA30069 50670037
         ABEND X'033',DUMP,,SYSTEM      SYSTEM 033 ABEND         Y02072 50700002
SNDOUT   BR    RF                       UPDATE DSCB PTR TO 1ST   A30485 50900020
*                                       COUNT                    A30485 51100020
EOTREAD  MVC   DXDAADDR+1(2),4(RA)      MOVE BB INTO IOB          16068 52300016
         XC    VXCCW6(16),VXCCW6        INIT.VXCCW6,7 TO ZERO    A35340 52400020
         MVC   VXCCW6(5),DXDAADDR+3     SET 1ST COUNT FLD =      A30485 52530020
*                                       IOBSEEK                  A30485 52560020
         LR    RB,RVAL                  SAVE REG.1                      52600000
         MVC   SAVEREG(4),28(RDEB)      SAVE APP VECT TBL PTR    A25984 52730019
         MVC   29(3,RDEB),DXDEBAPP+1    POINT TO DUMMY VECT TBL  A25984 52760019
         L     RVAL,IOBWGHT             DCB COPY ADDRESS         Y02072 52770002
         STCM  RVAL,L3BYTE,DEBDCBAD+1   DEB PT TO COPY DCB       Y02072 52780002
*                                                                       52800000
         EXCP  DXIOB                    READ TO EOF                     53000000
         WAIT  1,ECB=DXECB                                              53200000
         L     RVAL,DXUDCBAD            USERS DCB ADDRESS        Y02072 53250002
         STCM  RVAL,L3BYTE,DEBDCBAD+1   DEB PT TO USER DCB       Y02072 53270002
         MVC   28(4,RDEB),SAVEREG       RESTORE VECTOR TABLE PTR A25984 53300019
         LR    RVAL,RB                  RESTORE REG.1                   53400000
         BR    RC                                                A35340 53600020
         USING IHADCB,RB                                         A30485 54600020
NOEXEC1  EQU   *                                                 A35340 57009020
         LTR   RPARC,RPARC              TEST IF RESTART          A37175 57012020
         BNZ   NOEXEC                   B IF NOT TO TEST SHR     A37175 57015020
         LA    RWTG,DXCCW6              GET ADDRESS OF NAME AREA        57018000
         MVC   0(8,RWTG),IGG01922       NEXT LOAD MODULE         A37175 57021000
         B     RESTRTX2                 BR TO XCTL               A37175 57024020
NOEXEC   EQU   *                                                 A37175 57027020
         L     RB,0(RPARC)              RESET DCB ADDRESS        A37175 57030020
         L     RA,DEBEXPTR              DEB EXTENSION ADDRESS    Y02072 57033002
         USING DEBEXT,RA                EXTNSION ADDRESSABILITY  Y02072 57035002
         TM    DEBDCBFA,SHR             TEST FOR DISP EQ SHR     Y02072 57035402
         BNO   NEXTEXEC                 BR IF NOT SHR TO XCTL    A37175 57036020
         L     RA,DEBDCBFA              FIELD AREA ADDRESS       Y02072 57045002
         USING DCBFA,RA                                          A35340 57054020
         CLI   DFALPDA,X'00'                                     A37175 57057020
         BNZ   NEXTEXEC                                          A37175 57060020
         MVC   DFARORG3+L'DFARORG3-L'DS2RORG3(L'DS2RORG3),DS2RORG3      57072021
         MVC   DFANREC,DS2PRCTR                                  A35340 57081020
         MVC   DFAST,DS2STIND                                    A35340 57090020
         MVC   DFALPDA,DS2LPRAD                                  A35340 57099020
         MVC   DFARORG1,DS2RORG1                                 A35340 57126020
NEXTEXEC EQU   *                                                 A37175 57626020
         MVC   0(L'LOAD22,RWTGC),LOAD22 NEXT LOAD IS IGG01922    Y02072 58126002
*                                                                       58176002
*********************************************************************** 58800000
RELOOP   LA    RWTGC,8(RWTGC)           INCREMENT WTG CURNT ENTRY       59000000
         LA    RPARC,4(RPARC)           INCREMENT DCB CURNT ENTRY       59200000
         CLC   0(2,RWTGC),THISLOAD                                      59400000
         BCR   8,RBASE                  BRANCH=BEGINNING OF THIS MODULE 59600000
         CLC   0(2,RWTGC),OPNLOD7       TEST FOR END OF WTG TABLE       59800000
         BC    7,RELOOP                 BRANCH=NOT AT END               60000000
ATEND    LR    RPARC,RPAR               INITIALIZE REPARC               60200000
         LA    RWTGC,32(RWTG)           INITIALIZE RWTGC                60400000
ZCHECK   CLI   0(RWTGC),X'00'           TEST FOR ENTRY = 0              60600000
         BC    7,TCTLRTN                BRANCH = NOT ZERO               60800000
ITSZERO  LA    RWTGC,8(RWTGC)                                           61000000
         LA    RPARC,4(RPARC)                                           61200000
         B     ZCHECK                                                   61400000
TCTLRTN  EQU   *                                                        61600000
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID                         61800000
         LA    RJ,DXCCW12                                               62200000
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) XCTL TO NEXT LOAD  Y02072 62400002
RESTARTX EQU   *                                                 A42870 62440021
         LA    RWTG,DXDSCB+464          SET UP WORKAREA FOR XCTL A25984 62490019
         MVC   0(8,RWTG),IGC0W05B       RESTART MODULE NAME      A25984 62500019
         ST    RWTG,DXDSCB+16           SAVE RWTG FOR RESTORE           62501200
         LM    RDSCB,RA,DXDSCB                                   A42870 62502021
RESTRTX2 EQU   *                                                 M3540  62505020
         LA    RJ,8(RWTG)               SET UP REG FOR XCTL      A25984 62510019
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) RETURN TO RESTART  Y02072 62520002
* CONSTANTS                                                             62600000
THISLOAD DC    C'20'                                                    62800000
OPNLOD7  DC    C'0S'                                                    63000000
IGC0W05B DC    C'IGC0W05B'              ISAM RESTART MODULE      A25984 63200019
IGG01922 DC    C'IGG01922'              NEXT OPEN LOAD           M3540  63300020
         DS    0F                                                A25984 63400019
VALCCW1  CCW   SIDEQ,0,CC,5              ARG=LPDA+3              A30485 64300020
VALCCW2  CCW   TIC,VALCCW1-VALCCW1,0,0   TIC CCW1                A30485 64400020
VALCCW2A CCW   TIC,VALCCW3A-VALCCW1,0,0  1ST TIME TIC FOR SEARCH A30485 64500020
*                                       DIREC                    A30485 64600020
VALCCW3  CCW   MT+RDCNT,VALCCW6-VALCCW1,CC,8                     A30485 64700020
VALCCW3A CCW   RDATA,0,CC+SILI,0         LEN=BLKSIZE             A30485 64800020
VALCCW4  CCW   MT+RDCNT,VALCCW7-VALCCW1,CC,8                     A30485 64900020
VALCCW4A CCW   RDATA,0,CC+SILI,0         LEN=BLKSIZE             A30485 65000020
VALCCW5  CCW   TIC,VALCCW3-VALCCW1,0,0                           A30485 65100020
VALCCW6  DC    D'0'                                              A30485 65200020
VALCCW7  DC    D'0'                                              A30485 65300020
*                                                                       66000000
LOAD22   DC    C'22'                    ID OF MODULE IGG01922    Y02072 66010002
*                                                                       66020002
MODID    DC    CL8'IGG01920'            MODULE NAME            @ZA17080 66030037
DATE     DC    CL8'&SYSDATE'            DATE LAST CHANGED      @ZA17080 66080037
FIX      DC    C'OZ33836 '              LATEST FIX             @ZA25348 66130037
PATCH    DC    XL50'00'                 ZEROED PATCH AREA      @ZA17080 66180037
         END                                                            66230037
