         TITLE 'IGG01922-VALIDATE FORMAT2 DSCB FOR SCAN AND BISAM'      00080002
IGG01922 CSECT                                                          00081002
*                                                                       00082002
*********************************************************************** 00083002
*                                                                     * 00084002
* MODULE-NAME = IGG01922                                              * 00085002
*                                                                     * 00086002
* DESCRIPTIVE-NAME = ISAM OPEN, FIXED LENGTH VALIDATION ROUTINE       * 00087002
*                                                                     * 00088002
* COPYRIGHT = NONE                                                    * 00089002
*                                                                     * 00090002
* STATUS = RELEASE OS/VS2-02, LEVEL 01                                * 00091002
*                                                                     * 00092002
* FUNCTION = INITIALIZE DCB HIIOV.  IF DCB OPENED FOR SHR, AND M OF   * 00093002
*            DFALIOV IS NOT 0, OR INDEPENDENT OVERFLOW NOT SPECIFIED, * 00095002
*            RETURN TO RESTART, OR XCTL TO NEXT OPEN EXECUTOR.        * 00096002
*            OTHERWISE INITIALIZE CP VXCCW1B TO READ EOF OR END OF    * 00097002
*            LOVAD TRACK FOR INDEPENDENT OVERFLOW RECORDS, AND UPDATE * 00098002
*            DS2RORG2, DS2OVRCT, AND DS2LOVAD.  IF DCB OPENED FOR SHR * 00099002
*            AND M OF DFALIOV IS 0, MERGE F2 DSCB FIELDS INTO FIELD   * 00100002
*            AREA.                                                    * 00101002
*                                                                     * 00102002
* NOTES = SEE BELOW                                                   * 00103002
*                                                                     * 00104002
*    DEPENDENCIES = NONE                                              * 00105002
*                                                                     * 00106002
*    RESTRICTIONS = NONE                                              * 00107002
*                                                                     * 00108002
*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                     * 00109002
*                                                                     * 00110002
*    PATCH-LABEL = PATCH, A DC STATEMENT.                             * 00111002
*                                                                     * 00112002
* MODULE-TYPE = OPEN EXECUTOR                                         * 00113002
*                                                                     * 00114002
*    PROCESSOR = ASSEMXF-370R                                         * 00115002
*                                                                     * 00116002
*    MODULE-SIZE = 930 DECIMAL BYTES                                  * 00117002
*                                                                     * 00118002
*    ATTRIBUTES = PRIVILEGED, REENTRANT                               * 00119002
*                                                                     * 00120002
* ENTRY-POINT = IGG01922                                              * 00121002
*                                                                     * 00122002
*    PURPOSE = SEE FUNCTION                                           * 00123002
*                                                                     * 00124002
*    LINKAGE = RECEIVES CONTROL FROM ISAM OPEN EXECUTOR IGG01920 FOR  * 00125002
*              FIXED LENGTH RECORDS (FLR) ONLY.  RECEIVES CONTROL IN  * 00126002
*              STORAGE PROTECT KEY 5 AND PRIVILEGED STATE.            * 00126202
*                                                                     * 00128002
* INPUT = REGISTERS ESTABLISHED UPON ENTRY ARE                        * 00129002
*         REG 5 (RPAR) POINTS TO THE DCB COPY PARAMETER LIST          * 00130002
*         REG 6 (RWTG) POINTS TO THE O/C/EOV WHERE-TO-GO TABLE        * 00131002
*         REG 7 (RPARC) POINTS TO THE CURRENT ENTRY IN THE DCB COPY   * 00132002
*               PARAMETER LIST                                        * 00133002
*         REG 8 (RWTGC) POINTS TO THE CURRENT ENTRY IN THE WTG TABLE  * 00134002
*                                                                     * 00134202
*         HOWEVER, IF IGG01920 WAS ENTERED FROM RESTART, REGISTERS    * 00134402
*         ARE ESTABLISHED AS FOLLOWS:                                 * 00134602
*         REG 4 (RCORE) POINTS TO THE OPEN WORK AREA                  * 00134802
*         REG 7 (RPARC) IS ZERO                                       * 00134902
*         REG 8 (RWTGC) POINTS TO THE CURRENT WHERE-TO-GO ENTRY       * 00135202
*         REG 9 (RDEB) POINTS TO THE DEB                              * 00135402
*                                                                     * 00135702
* OUTPUT = REGISTERS 5 THROUGH 8 WILL BE IN THE SAME CONDITION AS     * 00136002
*          UPON ENTRY TO THIS MODULE                                  * 00137002
*                                                                     * 00138002
* EXIT-NORMAL = XCTL TO IGC0W05B IF RESTART ENTERED IGG01920;         * 00139002
*               OTHERWISE TO ISAM OPEN EXECUTOR IGG0196C FOR LOAD     * 00139202
*               MODE, IGG01928 FOR SCAN MODE, OR IGG0192H FOR BISAM.  * 00139402
*                                                                     * 00140002
* EXIT-ERROR = ABEND CODES:                                           * 00141002
*              033 - I/O ERROR TRYING TO READ EOF                     * 00142002
*                                                                     * 00143002
*              IF RESTART ENTERED IGG01920, DO NOT ISSUE ABEND, BUT   * 00144002
*              XCTL TO IGC0W05B WITH ABEND CODE IN REGISTER 1         * 00145002
*                                                                     * 00146002
* EXTERNAL-REFERENCES = SEE BELOW                                     * 00147002
*                                                                     * 00148002
*    ROUTINES = RESIDENT CONVERT ROUTINE                              * 00149002
*                                                                     * 00151002
*    DATA-AREAS = AREAS REFERENCED ARE:                               * 00152002
*                 FORCORE - OPEN WORK AREA                            * 00153002
*                                                                     * 00155002
*    CONTROL-BLOCKS = DCB, DCB COPY, DCBFA, DEB, DSCB, IOB, AND CVT.  * 00156002
*                                                                     * 00157002
* TABLES = NONE                                                       * 00158002
*                                                                     * 00159002
* MACROS = ABEND, EXCP, WAIT, AND XCTL                                * 00160002
*                                                                     * 00161002
* CHANGE-ACTIVITY = AS FOLLOWS:                                       * 00162002
*                                                                     * 00163002
*          RELEASE OS/VS2-02 DELETIONS                                * 00213002
*                                                               YM03922 00263002
*         CHANGES TO VS2-030                                            01263037
*A624160,624730,624760                                         @ZA06668 02263037
*C624240                                                       @ZA06668 03263037
*         CHANGES SINCE VS2-037                                         04263037
*A506700                                                       @ZA30069 04313037
*                                                                       04363037
*                                                                     * 07806002
*********************************************************************** 07807002
         EJECT                                                          07808002
DS2DSECT DSECT           FORMAT 2 DSCB                                  07809002
         DS    0D                                                       07810020
DS2KEY   DS    CL44                                                     07815020
DS2FMTID DS    CL1                                                      07820020
DS2NOLEV DS    CL1                                                      07825020
DS2DVIND DS    CL1                                                      07830020
DS21RCYL DS    CL3                                                      07835020
DS2LTCYL DS    CL2                                                      07840020
DS2CYLOV DS    CL1                                                      07845020
DS2HIRIN DS    CL1                                                      07850020
DS2HIRPR DS    CL1                                                      07855020
DS2HIROV DS    CL1                                                      07860020
DS2RSHTR DS    CL1                                                      07865020
DS2HIRTI DS    CL1                                               O19113 07870020
DS2HIIOV DS    CL1                                               O19113 07875020
DS2TAGDT DS    CL2                                                      07880020
DS2RORG3 DS    CL3                                                      07885020
DS2NOBYT DS    CL2                                                      07890020
DS2NOTRK DS    CL1                                                      07895020
DS2PRCTR DS    CL4                                                      07900020
DS2STIND DS    CL1                                                      07905020
DS2CYLAD DS    CL7                                                      07910020
DS2ADLIN DS    CL7                                                      07915020
DS2ADHIN DS    CL7                                                      07920020
DS2LPRAD DS    CL8                                                      07925020
DS2LTRAD DS    CL5                                                      07930020
DS2LCYAD DS    CL5                                                      07935020
DS2LMSAD DS    CL5                                                      07940020
DS2LOVAD DS    CL8                                                      07945020
DS2BYOVL DS    CL2                                                      07950020
DS2RORG2 DS    CL2                                                      07955020
DS2OVRCT DS    CL2                                                      07960020
DS2RORG1 DS    CL2                                                      07965020
FORCORE  DSECT                                                          08000020
         IECDSECT                                                       08200020
*                       CP TO READ TO EOF                        A25984 10200020
         ORG   DXCCW                                             A25984 12200020
VXCCW1   CCW   X'31',000,X'40',5        SRCH ID EQ   LPDA+3,5,CC        12700020
VXCCW2   CCW   X'08',000,X'00',0        TIC          VALCCW1            13200020
VXCCW3   CCW   X'9E',040,X'60',8       RD CKD(MT) VALCCW6,8,CC,SK       13700020
VXCCW4   CCW   X'9E',048,X'60',8       RD CKD(MT) VALCCW7,8,CC,SK       14200020
VXCCW5   CCW   X'08',016,X'00',0        TIC          VALCCW3            14700020
VXCCW6   DC    2F'0000'                 COUNT FLD    CCHHRKDD           15200020
VXCCW7   DC    2F'0000'                 COUNT FLD    CCHHRKDD           15700020
VXCCW8   DC    2F'0000'                NEW MBBCCHHR                     16200020
SAVEREG  DS    CL8                     REG. SAVE AREA                   16840020
         DS    CL4                     OLD TTR                          16880020
SAVER2   DS    CL2                     NEW R VALUE                      16920020
SAVER1   DS    CL2                     OLD R VALUE                      16960020
         DCBD  DSORG=IS                                          O19113 16980020
SIDEQ    EQU   X'31'                                                    16987020
TIC      EQU   X'08'                                                    16994020
RDCNT    EQU   X'12'                                                    17001020
RCKD     EQU   X'1E'                                                    17008020
MT       EQU   X'80'                                                    17015020
RDATA    EQU   X'06'                                                    17022020
DC       EQU   X'80'                                                    17029020
CC       EQU   X'40'                                                    17036020
SILI     EQU   X'20'                                                    17043020
SKIP     EQU   X'10'                                                    17050020
EQ       EQU   8                                                        17057020
LO       EQU   4                                                        17064020
         EJECT                                                          17074002
IHADEB   IGGDEBD                                                 Y02072 17076002
DCBFA     IGGDCBFA                                                      17080020
R0       EQU   0                        WORK REG                        17200020
RVAL     EQU   1                        BASE REG FOR VALIDATE CP        17400020
RDSCB    EQU   2                        BASE REG FOR DSCB FORMAT 2      17600020
RBASE    EQU   3                        BASE REG FOR THIS MODULE        17800020
RCORE    EQU   4                        BASE REG FOR OPEN WORK AREA     18000020
RPAR     EQU   5         *              ADDR OF PARAMETER TABLE         18200020
RWTG     EQU   6         *              ADDR OF WHERE-TO-GO TABLE       18400020
RPARC    EQU   7         *              CURRENT PARAMETER ENTRY         18600020
RWTGC    EQU   8         *              CURRENT WHERE-TO-GO ENTRY       18800020
RRSTC    EQU   9                        CURRENT RESTART ENTRY    A44475 18900021
RDEB     EQU   9                        DEB PTR                         19000020
RA       EQU   10                       WORK REG                        19200020
RB       EQU   11                       WORK REG                        19400020
RC       EQU   12                       WORK REG                        19600020
RD       EQU   13                       WORK REG                        19800020
RE       EQU   14                       WORK REG                        20000020
RF       EQU   15                       WORK REG                        20200020
RJ       EQU   15                                                       20400020
R1       EQU   1                                                        20600020
*                                                                       20800020
*                                                                       21000020
CVTPTR   EQU   16                       LOCATION OF THE CVT PTR         21200020
SHR      EQU   X'80'                    TEST FOR DISP EQ SHR     Y02072 21240002
L3BYTE   EQU   7                        STORE 3 LOW ORDER BYTES  Y02072 21250002
         EJECT                                                   A25984 21260020
IGG01922 CSECT                                                   A25984 21330020
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        21400020
         USING *,RBASE                                                  21600020
         USING FORCORE,RCORE                                            21800020
         USING DS2DSECT,RDSCB                                           22000020
         USING IHADCB,RB                                         A25984 22030020
         LTR   RPARC,RPARC              CHECK FOR RESTART ENTRY  A25984 22060020
         BNZ   OPEN                     BRANCH IF NOT            A25984 22090020
         L     RRSTC,DXDSCB+28          GET CURRENT TBL ENTRY PT A44475 22130021
         L     RB,0(RRSTC)              GET CURRENT DCB ADDR     A44475 22150021
         LA    RDSCB,DXJBF              POINT TO FORMAT 2 DSCB   A25984 22180020
         B     COMMON                                            A25984 22210020
OPEN     EQU   *                                                 A25984 22240020
         USING IHADCB,RB                                         O19113 22300020
         L     RB,0(RPARC)              SET DCB ADDR                    22400020
         L     RCORE,4(RWTGC)           SET OPEN WK AREA ADDR           22600020
         L     RDSCB,DSCCORE            SET PTR TO F2 DSCB       A25984 22700020
COMMON   EQU   *                                                 A25984 22800020
*                                                                       22807020
*                                                                       22884020
         L     RDEB,DCBDEBAD            SET DEB BASE             A25984 22900020
         USING IHADEB,RDEB              DEB ADDRESSABILITY       Y02072 22950002
         SR    RVAL,RVAL                CLEAR REGISTER           O19113 23020020
         IC    RVAL,DS2HIIOV            RVAL=HI R FOR IND OVFLOW O19113 23040020
         LTR   RVAL,RVAL                TEST IF ZERO             O19113 23060020
         BNZ   OVMERGE                  BRANCH IF NOT            O19113 23080020
         IC    RVAL,DS2HIROV            RVAL=HI R FOR OVERFLOW   O19113 23100020
OVMERGE  STC   RVAL,DCBHIIOV            HIIOV=HI R IND OVFLOW    O19113 23120020
*                                                                       23200020
         ST    RB,IOBWGHT               SET DCB ADDR IN PHONY IOB       26200020
*                                                                       26400020
*    IF DATA SET HAS BEEN OPENED FOR  SHR, DEBDCBFA WILL CONTAIN        26600002
*         A POINTER TO THE DCBFA.  IF THE M BYTE IN DFALIOV IS          26650002
*         nonzERO, WILL NOT VALIDATE DCBFIELDS AS IT HAS BEEN           26700002
*         done.                                                         26750002
*                                                                       27200020
         L     RB,DEBEXPTR              ADDRESS OF DEB EXTNSION  Y02072 27400002
         USING DEBEXT,RB                USING ON DCB EXTENSION   Y02072 27500002
         TM    DEBDCBFA,SHR             TEST FOR DISP EQ SHR     Y02072 27550002
         BZ    CNTINU                   BR IF NOT TO CONTINUE    A37175 27600020
         L     RB,DEBDCBFA              FIELD AREA ADDRESS       Y02072 27800002
         USING DCBFA,RB                                          A43189 27900021
         CLI   DFALIOV,X'00'            TEST IF ALREZDY VALID    A43189 28000021
         BNZ   NOOVRFL                  B IF SO TO END           A43189 28100021
         DROP  RB                                                A43189 28200021
CNTINU   EQU   *                                                 A37175 28400020
         CLI   DS2LOVAD,X'00'          IS THERE INDEPENDENT OVFL        29200020
         BE    NOOVRFL                 NO                               33000020
* VALIDATE PTR TO LAST REC IN INDEPENDENT O VRFLO                       33200020
         LA    RVAL,DXCCW1              POINT TO WORKAREA CCWS   A25984 33210020
*INITIALIZE CHANNEL PROG TO READ EOF                                    33220020
*                                                                       33230020
         LM    RA,RF,VALCCW1                                            33240020
         LA    R0,DXDAADDR+3            SET ADDR IN CCW1 TO CCHHR 21684 33250020
         ALR   RA,R0                       IN DS2LPRAD                  33260020
         ALR   RC,RVAL                  RELOCATE ADDR FLDS IN           33270020
         ALR   RE,RVAL                     CCW2 AND CCW3                33280020
         STM   RA,RF,VXCCW1             INIT.VXCCW1,2,3                 33290020
         LM    RA,RD,VALCCW4                                            33300020
         ALR   RA,RVAL                  RELOCATE ADDR FLDS IN           33310020
         ALR   RC,RVAL                     CCW4 AND CCW5                33320020
         STM   RA,RD,VXCCW4             INIT.VXCCW4,5                   33330020
*                                                                       33340020
         XC    VXCCW6(VXCCW7-VXCCW6+8),VXCCW6 CLEAR VXCCW6&7     A41406 33370021
*                                                                       33400020
*                                                                       34400020
         MVC   DXDAADDR,DS2LOVAD        SET UP IOB SEEK ADDR            34600020
*                                                                       34800020
         BAL   RC,EOFREAD               GO READ EOF FOR          A35340 34900020
*                                       INDEPENDENT              A35340 35000020
*                                         OVERFLOW                      35200020
TESTIO   EQU   *                                                  21684 35300020
         TM    IOBSTAT0,X'01'           END OF FILE                     35400020
         BO    SETLOVAD                 YES                             35600020
         CLI   IOBECBPT,X'42'           TEST FOR END OF EXTENT    21684 35660020
         BNE   GOABEND                  NO END OF FILE AND NO END 21684 35720020
*                                       OF EXTENT IMPLIES AN I/O  21684 35780020
*                                       ERROR.                    21684 35840020
*                                                                 21684 35900020
*  GO TO NEXT INDEPENDENT OVERFLOW EXTENT.                        21684 35960020
*                                                                 21684 36020020
         SR    RA,RA                                              21684 36080020
         IC    RA,DXDAADDR              GET M FROM IOB            21684 36140020
         LA    RA,1(R0,RA)              ADD ONE FOR NEXT EXTENT   21684 36200020
         STC   RA,DXDAADDR              PUT M+1 IN IOBSEEK        21684 36260020
         CLC   DXDAADDR(1),16(RDEB)     DEBNMEXT VS NEXT M        21684 36320020
         BE    NOOVRFL                  EXIT--EXTENTS EXHAUSTED   21684 36380020
         SLL   RA,4                     M TIMES 16                21684 36440020
         LA    RA,32(RA,RDEB)           POINT TO NEW EXTENT       21684 36500020
         MVC   DXDAADDR+3(4),6(RA)      MOVE CCHH INTO IOB        21684 36560020
         MVI   DXDAADDR+7,X'00'         START AT FIRST RECORD     21684 36620020
         BAL   RC,EOTREAD               CHECK NEXT EXTENT        A35340 36660020
*                                        2168                    A35340 36700020
         B     TESTIO                   CHECK RESULT OF CP        21684 36740020
*                                                                       36800020
SETLOVAD LA    RB,SETLIOV2                                              37000020
         LA    RE,NOOVRFL                                               37200020
         BAL   RF,STOPCHK                                               37400020
*                                                                       37600020
* SET UP NEW MBBCCHHR                                                   37800020
SETLIOV1 MVC   VXCCW8+3(5),VXCCW6       CCHHR FROM 1ST CT FLD           38000020
         B     SETLIOV3                                                 38200020
SETLIOV2 MVC   VXCCW8+3(5),VXCCW7       CCHHR FROM 2ND CT FLD           38400020
SETLIOV3 MVC   VXCCW8(3),DXDAADDR       MBB SAME AS IN IOBSEEK    21684 38700020
*                                                                       39000020
NEWADDR  L     RC,CVTPTR               LOAD CVT POINTER                 39200020
         L     RF,32(RC)               LOAD ADDR OF CONVERT RT          39400020
         STM   RDSCB,RBASE,SAVEREG     SAVE REG.2,3                     39500020
         LR    RBASE,RVAL              SAVE REG.1                       39600020
         LR    R1,RDEB                  SET PTR TO DEB                  39800020
         LA    RDSCB,DS2LOVAD           SET PTR TO MBBCCHHR INPUT       40000020
         BALR  RE,RF                    CONVERT MBBCCHHR TO TTR         40200020
         LR    RDEB,R1                 RESTORE DEB PTR.                 40300020
         LR    RVAL,RBASE              RESTORE REG.1                    40400020
         ST    R0,SAVEREG+8            SAVE OLD TTR                     40500020
         LA    RDSCB,VXCCW8             SET PTR TO MBBCCHHR INPUT       40800020
         LR    R1,RDEB                 SET DEB PTR FOR CONVERT RT       40850020
         L     RC,CVTPTR               LOAD CVT PTR                     40900020
         L     RF,32(RC)               LOAD ADDR OF CONVERT RT          40950020
         BALR  RE,RF                    CON VERT MBBCCHHR TO TTR        41000020
         LR    RVAL,RBASE              RESTORE REG.1                    41100020
         LM    RDSCB,RBASE,SAVEREG     RESTORE REG.2,3                  41200020
         L     RA,SAVEREG+8             RA=OLD TTR. R0=NEW TTR          41400020
* UPDATE # OF UNUSED TRKS IN INDEPENDENT OVRFLO                         41600020
*                                                                       41800020
         STH   R0,SAVER2                SAVE NEW R VALUE                42000020
         STH   RA,SAVER1                SAVE OLD R VALUE                42200020
         SRL   R0,16                    SHIFT TO LOW ORDER TWO    MC0P  42270020
*                                       BYTES                     MC0P  42340020
         SRL   RA,16                    SHIFT TO LOW ORDER TWO    MC0P  42410020
*                                       BYTES                     MC0P  42480020
         SLR   R0,RA                    R0= NEW TT - OLD TT       MC0P  42550020
         LR    RC,R0                   LOAD RC WITH DIFF.OF TTS         42660020
         LH    RB,DS2RORG2             OLD NO.UNUSED TRKS               42720020
         CLC   SAVER2(1),SAVER1        NEW R EQUAL OLD R                42780020
         BE    UPDATE1                 YES                              42840020
         CLC   SAVER2(1),DS2HIIOV       NEW R = HI R FOR OVFLOW  O19113 42900020
         BNE   UPDATE1                 NO                               42960020
         LA    RC,1(RC)                ADD1 TO DIFFERENCE               43020020
UPDATE1  SR    RB,RC                   SUBTRACT DIFF, FROM NO. OF       43080020
*                                         UNUSED TRKS                   43140020
         STH   RB,DS2RORG2              UPDATE DS2RDRG2                 43200020
*                                                                       43400020
* UPDATE # OF RECORDS IN INDEPENDENT OVRFLO                             43600020
*                                                                       43800020
         LR    RD,R0                    RD=# TRKS DIFF.                 44000020
         SR    RC,RC                    CLEAR REG                       44200020
         IC    RC,DS2HIIOV              RC = NO. RECS/TRACK      O19113 44400020
         MR    RC,RC                    RD=NO.REC.DIFFERENCE            44600020
         SR    RA,RA                    CLEAR REG                       44800020
         SR    RB,RB                                                    45000020
         IC    RA,SAVER2                PICK UP R2                      45200020
         IC    RB,SAVER1                PICK UP R1                      45400020
         SR    RA,RB                    RA=NO.REC.DIFFERENCE            45600020
         AR    RD,RA                    RD=TOTAL NO.REC.DIFF.           45800020
         LH    RC,DS2OVRCT                                              46000020
         AR    RC,RD                   ADD TO NO OF REC IN OVRFLO       46200020
         STH   RC,DS2OVRCT              UPDATE DS2OVRCT                 46400020
*                                                                       46600020
         XC    VXCCW8+1(2),VXCCW8+1    ZERO BB                          46800020
         MVC   DS2LOVAD,VXCCW8          UPDATE DS2LOVAD                 47000020
         B     NOOVRFL                                                  47200020
*                                                                       47400020
* DETERMINE WHICH CCW THE CHANNEL PROG STOPPED ON;THE ONLY VALID STOPS  47600020
* ARE ON CCW4 OR CCW5                                                   47800020
*                                                                       48000020
*                                                                       48200020
STOPCHK  L     RC,IOBCOMAD              ADDR OF NXT CCW TO BE EXEC.     48400020
         LA    RC,0(RC)                 CLEAR HI ORDER BYTE             48600020
         LA    RD,VXCCW4                ADDR OF CCW4                    48800020
         CR    RC,RD                    NXT CCW IS VXCCW4               49000020
         BNE   SNDSTOP                  NO                              49200020
         NC    VXCCW7(8),VXCCW7         2ND COUNT FLD EMPTY             49400020
         BCR   8,RE                     YES,DSCB PTR CORRECT     A35340 49600020
FRSTOUT  BR    RB                       NO,UPDATE DSCB PTR TO 2ND CNT   49800020
SNDSTOP  LA    RD,VXCCW5                ADDR OF CCW5                    50000020
         CR    RC,RD                    NXT CCW IS VXCCW5               50200020
         BCR   8,RF                     YES,UPDATE DSCB PTR TO   A35340 50300020
*                                       1ST CNT                         50400020
GOABEND  EQU   *                        COME HERE IF ERROR       A25984 50500020
         L     R1,ABENDCD               PERMANENT ERROR          A25984 50550020
         LTR   RPARC,RPARC              IS RESTART IN CONTROL    A25984 50600020
         BZ    RESTARTX                 DON'T ABEND IF SO        A25984 50650020
         L     RCORE,DXUDCBAD           USERS DCB ADDRESS      @ZA30069 50670037
         ABEND X'033',DUMP,,SYSTEM      SYSTEM 033 ABEND         Y02072 50700002
EOFREAD  SR    RA,RA                    CLEAR WORK REG.           16068 51400020
         IC    RA,DXDAADDR              GET M FROM IDB                  51800020
         SLL   RA,4                     M X 16                          52000020
         LA    RA,32(RA,RDEB)           POINT TO EXTENT OF M            52200020
EOTREAD  MVC   DXDAADDR+1(2),4(RA)      MOVE BB INTO IOB          16068 52300020
         XC    VXCCW6(16),VXCCW6        INIT.VXCCW6,7 TO ZERO    A35340 52400020
*                                        1606                    A35340 52500020
         LR    RB,RVAL                  SAVE REG.1                      52600020
         MVC   SAVEREG(4),28(RDEB)      SAVE APP VECT TBL PTR    A25984 52730020
         MVC   29(3,RDEB),DXDEBAPP+1    POINT TO DUMMY VECT TBL  A25984 52760020
         L     RVAL,IOBWGHT             ADDR OF COPY DCB         Y02072 52770002
         STCM  RVAL,L3BYTE,DEBDCBAD+1   DEB PT TO COPY DCB       Y02072 52780002
*                                                                       52800020
         EXCP  DXIOB                    READ TO EOF                     53000020
         WAIT  1,ECB=DXECB                                              53200020
         L     RVAL,DXUDCBAD            USERS DCB ADDRESS        Y02072 53250002
         STCM  RVAL,L3BYTE,DEBDCBAD+1   DEB PT TO USER DCB       Y02072 53252002
         MVC   28(4,RDEB),SAVEREG       RESTORE VECTOR TABLE PTR A25984 53300020
         LR    RVAL,RB                  RESTORE REG.1                   53400020
         BR    RC                                                A35340 53600020
* RESTORE IOB TO ORIGINAL FORM                                          56200020
NOOVRFL  EQU   *                                                 A25984 56500020
         L     RB,IOBWGHT               RESTORE DCB ADDRESS      A35340 56600020
         USING IHADCB,RB                                         A43189 56610021
         L     RA,DEBEXPTR              ADDR OF DEB EXTENSION    Y02072 56630002
         USING DEBEXT,RA                USING ON DEB EXTENSION   Y02072 56640002
         TM    DEBDCBFA,SHR             TEST FOR DISP EQ SHR     Y02072 56650002
         BZ AROUND                      BR IF NOT TO CONTINUE    A37175 56660020
         L     RA,DEBDCBFA              ADDRESS OF FIELD AREA    Y02072 56690002
         USING DCBFA,RA                                          A43189 56695021
         CLI   DFALIOV,X'00'            VALIDATED?               A43189 56700021
         BNZ   AROUND                   B IF SO TO END           A43189 56705021
         MVC   DFANBOV,DS2BYOVL         NO. BYTES REMAINING ON  YM03922 56710002
*                                       CURRENT OVERFLOW TRACK  YM03922 56710402
         MVC   DFARORG2,DS2RORG2        FREE TRKS IN IND OVRFLW YM03922 56712002
         MVC   DFANOREC,DS2OVRCT        NO. RCDS IN OVERFLOW    YM03922 56714002
         MVC   DFALIOV,DS2LOVAD         IF NOT, SET UP LIOV      A43189 56715021
AROUND   EQU   *                                                 A37175 56750020
         LA    RA,DXDCB                 ADDR OF PHONY DCB               56800020
         ST    RA,IOBWGHT                                               57000020
NOEXEC1  EQU   *                                                 A35340 57009020
         LTR   RPARC,RPARC              IF REGISTER IS ZERO,     A35340 57153020
*                                       A2598                    A35340 57162020
         BZ    RESTART                  ENTRY WAS FROM RESTART   A35340 57171020
*                                       A2598                    A35340 57180020
         TM    DCBMACRF+1,X'18'         LOAD MODE                A25984 57660020
         BZ    TESTSCAN                                           P4701 57720020
         MVC   0(L'LOAD6C,RWTGC),LOAD6C RESUME LOAD - IGG0196C   Y02072 57780002
         B     RELOOP                                             P4701 57840020
TESTSCAN TM    DCBMACRF,X'40'           TEST IF GET              A25984 57920020
         BO    SCANNEXT                 YES, SCAN MODE                  58000020
         MVC   0(L'LOAD2H,RWTGC),LOAD2H INITIALIZE WHERE-TO-GO   Y02072 58200002
         B     RELOOP                                                   58400020
SCANNEXT MVC   0(L'LOAD28,RWTGC),LOAD28 INITIALIZE WHERE-TO-GO   Y02072 58600002
*********************************************************************** 58800020
RELOOP   LA    RWTGC,8(RWTGC)           INCREMENT WTG CURNT ENTRY       59000020
         LA    RPARC,4(RPARC)           INCREMENT DCB CURNT ENTRY       59200020
         CLC   0(2,RWTGC),THISLOAD                                      59400020
         BCR   8,RBASE                  BRANCH=BEGINNING OF THIS MODULE 59600020
         CLC   0(2,RWTGC),OPNLOD7       TEST FOR END OF WTG TABLE       59800020
         BC    7,RELOOP                 BRANCH=NOT AT END               60000020
ATEND    LR    RPARC,RPAR               INITIALIZE REPARC               60200020
         LA    RWTGC,32(RWTG)           INITIALIZE RWTGC                60400020
ZCHECK   CLI   0(RWTGC),X'00'           TEST FOR ENTRY = 0              60600020
         BC    7,TCTLRTN                BRANCH = NOT ZERO               60800020
ITSZERO  LA    RWTGC,8(RWTGC)                                           61000020
         LA    RPARC,4(RPARC)                                           61200020
         B     ZCHECK                                                   61400020
TCTLRTN  EQU   *                                                        61600020
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID                         61800020
*                                                                       62000002
         LA    RJ,DXCCW12                                               62200020
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) XCTL TO NEXT LOAD  Y02072 62400002
RESTART  SR    RVAL,RVAL                ZERO RETURN CODE         A25984 62410020
         MODESET  KEYADDR=DXUKEY,WORKREG=1  CHANGE TO USER KEY @ZA06668 62416037
         L     RDEB,DXDSCB+28           GET CURRENT TBL ENTRY PT M3874  62420037
         L     RB,DXUDCBAD              GET USER DCB ADDR      @ZA06668 62424037
         MVC   DCBLPDA(8),DS2LPRAD      MERGE FORMAT 2 FIELDS    A25984 62430020
         MVC   DCBST(1),DS2STIND        INTO DCB.                A25984 62440020
         MVC   DCBLIOV(8),DS2LOVAD                               A25984 62450020
         MVC   DCBNOREC(2),DS2OVRCT                              A25984 62460020
         MVC   DCBRORG2(2),DS2RORG2                              A25984 62470020
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY @ZA06668 62473037
         SR    RVAL,RVAL                RESTORE REG 1          @ZA06668 62476037
RESTARTX EQU   *                                                 A42870 62480021
         LA    RWTG,DXDSCB+464          SET UP WORKAREA FOR XCTL A25984 62490020
         MVC   0(8,RWTG),IGC0W05B       RESTART MODULE NAME      A25984 62500020
         ST    RWTG,DXDSCB+16           SAVE RWTG FOR RESTORE           62502000
         LM    RDSCB,RA,DXDSCB                                   A42870 62505021
         LA    RJ,8(RWTG)               SET UP REG FOR XCTL      A25984 62510020
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) RETURN TO RESTART  Y02072 62520002
* CONSTANTS                                                             62600020
VALCCW1  CCW   X'31',000,X'40',5        SRCH ID EQ   LPDA+3,5,CC        62650020
VALCCW2  CCW   X'08',000,X'00',0        TIC          VALCCW1            62700020
VALCCW3  CCW   X'9E',040,X'60',8       RD CKD(MT) VALCCW6,8,CC,SK       62750020
VALCCW4  CCW   X'9E',048,X'60',8       RD CKD(MT) VALCCW7,8,CC,SK       62800020
VALCCW5  CCW   X'08',016,X'00',0        TIC          VALCCW3            62850020
THISLOAD DC    C'22'                                                    62900020
OPNLOD7  DC    C'0S'                                                    63000020
LOAD2H   DC    C'2H'                    BISAM MODULE IGG0192H    Y02072 63050002
LOAD28   DC    C'28'                    SCAN MODULE IGG01928     Y02072 63100002
LOAD6C   DC    C'6C'                    RESUME LOAD - IGG0196C   Y02072 63150002
IGC0W05B DC    C'IGC0W05B'              ISAM RESTART MODULE      A25984 63200020
         DS    0F                                                A25984 63400020
ABENDCD  DC    X'80033000'             ABEND 33, DUMP OPTION ON         63600020
*                                                                       64200020
*                                                                       64240002
MODID    DC    C'IGG01922'             MODULE NAME             @ZA30069 64242037
DATE     DC    CL8'&SYSDATE'           COMPILATION DATE        @ZA30069 64292037
FIX      DC    C'OZ30069'              LATEST FIX              @ZA30069 64342037
PATCH    DC    XL50'00'                ZEROED PATCH AREA         Y02072 64392037
         END                                                            64442037
