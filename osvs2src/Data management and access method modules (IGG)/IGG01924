 TITLE 'IGG01924 - THIRD AND LAST SCAN MODE OPEN MODULE'         A35340 00150020
IGG01924 CSECT                                                          00151002
*                                                                       00152002
*********************************************************************** 00153002
*                                                                     * 00154002
* MODULE-NAME = IGG01924                                              * 00155002
*                                                                     * 00156002
* DESCRIPTIVE-NAME = ISAM OPEN, SCAN MODE                             * 00157002
*                                                                     * 00158002
* COPYRIGHT = NONE                                                    * 00159002
*                                                                     * 00160002
* STATUS = RELEASE OS/VS2-02, LEVEL 01                                * 00161002
*                                                                     * 00162002
* FUNCTION = MERGE F2 DSCB FIELDS INTO DCB.  CALCULATE W1ICNOT (USED  * 00163002
*            FOR SCHEDULING I/O).  IF ANY PART OF THE DATA SET        * 00164002
*            EXISTS ON AN RPS DEVICE, OR IF IN A VIRTUAL ENVIRONMENT, * 00165002
*            LOAD RPS SIO MODULE, IGG019HA.  FIGURE LIMITS FOR OVER-  * 00166002
*            FLOW RECORDS.  CREATE IRB FOR ASYNCHRONOUS MODULE, USING * 00167002
*            ADDRESS IN DXCCW7, SAVED BY IGG01928.  FINISH WA         * 00168002
*            INITIALIZATION.  REFRESH USER DCB FROM COPY DCB.         * 00169002
*                                                                     * 00172002
* NOTES = SEE BELOW                                                   * 00173002
*                                                                     * 00174002
*    DEPENDENCIES = NONE                                              * 00175002
*                                                                     * 00176002
*    RESTRICTIONS = NONE                                              * 00177002
*                                                                     * 00178002
*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                     * 00179002
*                                                                     * 00180002
*    PATCH-LABEL = PATCH, A DC STATEMENT.                             * 00181002
*                                                                     * 00182002
* MODULE-TYPE = OPEN EXECUTOR                                         * 00183002
*                                                                     * 00184002
*    PROCESSOR = ASSEMXF-370R                                         * 00185002
*                                                                     * 00186002
*    MODULE-SIZE = 826 DECIMAL BYTES                                  * 00187002
*                                                                     * 00188002
*    ATTRIBUTES = PRIVILEGED, REENTRANT                               * 00189002
*                                                                     * 00190002
* ENTRY-POINT = IGG01924                                              * 00191002
*                                                                     * 00192002
*    PURPOSE = SEE FUNCTION                                           * 00193002
*                                                                     * 00194002
*    LINKAGE = RECEIVES CONTROL FROM ISAM OPEN EXECUTOR IGG01929 IN   * 00195002
*              STORAGE PROTECT KEY 5 AND PRIVILEGED STATE.            * 00196002
*                                                                     * 00198002
* INPUT = REGISTERS ESTABLISHED UPON ENTRY ARE                        * 00199002
*         REG 5 (RPAR) POINTS TO THE DCB COPY PARAMETER LIST          * 00200002
*         REG 6 (RWTG) POINTS TO THE O/C/EOV WHERE-TO-GO TABLE        * 00201002
*         REG 7 (RPARC) POINTS TO THE CURRENT ENTRY IN THE DCB COPY   * 00202002
*               PARAMETER LIST                                        * 00203002
*         REG 8 (RWTGC) POINTS TO THE CURRENT ENTRY IN THE WTG TABLE  * 00204002
*                                                                     * 00205002
* OUTPUT = REGISTERS 5 THROUGH 8 WILL BE IN THE SAME CONDITION AS     * 00206002
*          UPON ENTRY TO THIS MODULE                                  * 00207002
*                                                                     * 00208002
* EXIT-NORMAL = RETURN TO COMMON OPEN, LOAD 7, VIA XCTL IN STORAGE    * 00209002
*               PROTECT KEY 5.  THIS IS THE LAST OF THE ISAM OPEN     * 00209202
*               EXECUTORS FOR SCAN MODE.                              * 00209402
*                                                                     * 00210002
* EXIT-ERROR = NONE                                                   * 00211002
*                                                                     * 00216002
* EXTERNAL-REFERENCES = SEE BELOW                                     * 00217002
*                                                                     * 00218002
*    ROUTINES = NONE                                                  * 00219002
*                                                                     * 00221002
*    DATA-AREAS = AREAS REFERENCED ARE:                               * 00222002
*                 FORCORE - OPEN WORK AREA                            * 00223002
*                 IGGSCAN - ISAM SCAN MODE WORK AREA                  * 00224002
*                                                                     * 00225002
*    CONTROL-BLOCKS = DCB, DCB COPY, DEB, DSCB, AND CVT               * 00226002
*                                                                     * 00227002
* TABLES = DEVICE TABLE                                               * 00228002
*                                                                     * 00229002
* MACROS = MODESET, LOAD, CIRB, AND XCTL                              * 00230002
*                                                                     * 00231002
* CHANGE-ACTIVITY = AS FOLLOWS:                                       * 00232002
*                                                                     * 00233002
*          RELEASE OS/VS2-02 DELETIONS                                * 00283002
*D053400                                                        YM01159 00333002
*D                                                              YM02867 00383002
*          RELEASE VS2-030 CHANGES                             @ZA12254 01083037
*C077500                                                       @ZA12254 01783037
*                                                              @ZA12254 02483037
*                                                                     * 03301002
*********************************************************************** 03302002
         EJECT                                                          03303002
         USING IHADCB,RDCB                                              03304002
         USING SISWORK1,RUCB                                            03400018
         BALR  RBASE,0                                                  03500018
         USING *,RBASE                                                  03600018
R15      EQU   15                                                       03700018
RE       EQU   0                                                        03800018
RF       EQU   1                                                        03900018
RDCB     EQU   2                                                        04000018
RBASE    EQU   3                                                        04100018
RG       EQU   4                                                        04200018
RPAR     EQU   5                                                        04300018
RWTG     EQU   6                                                        04400018
RPARC    EQU   7                                                        04500018
RWTGC    EQU   8                                                        04600018
RTIOT    EQU   9                                                        04700018
RUCB     EQU   10                                                       04800018
RA       EQU   11                                                       04900018
RB       EQU   12                                                       05000018
RC       EQU   13                                                       05100018
RD       EQU   14                                                       05200018
RJ       EQU   15                                                       05300018
TWO      EQU   2                        LEN OF EXCEPTION FIELD   A35399 05300520
K1       EQU   1                        CONSTANT                 S20201 05302020
RPS      EQU   X'E0'                    RPS IDENTIFIER           S20201 05305020
K2       EQU   2                        CONSTANT                 S20201 05306020
L2       EQU   2                        CONSTANT                 S20201 05307020
COMP     EQU   X'40'                    IOB COMPLETE INDICATOR   S20201 05309020
DEBSIOAD EQU   4                        DEB SIO APPENDAGE ENTRY  A35340 05320020
IGG019HA EQU   C'A'                     IGG019HA - RPS SIO MODULE       05360300
VIRTUAL  EQU   X'80'                    VIRTUAL NE REAL INDICATOR       05372001
THIRTY   EQU   30                       LIMIT FOR BUFFERS USED          05390001
         SPACE 2                                                        05400018
*        INITIALIZE REGISTERS                                           05500018
SIS05A2  L     RDCB,0(RPARC)                                            05600018
         SPACE 2                                                        05800018
         L     RUCB,DCBWKPT1                                            05900018
         L     RG,4(RWTGC)              ADDRESSABILITY ON OPEN   A35340 05902020
         USING FORCORE,RG               *    WORK AREA           A35340 05904020
*        LOCATE DSCB                                                    05906020
         L     RA,DSCCORE                                        A35340 05908020
         USING DSCBFRM2,RA                                       A35340 05910020
         STM   RPAR,RWTGC,DXCCW1        SAVE REGS 5-8            Y02072 05910402
         DROP  RG                       END OPEN WA ADDR         Y02072 05910802
         LR    RPAR,RG                  GET OPEN WA ADDR         Y02072 05911202
         USING FORCORE,RPAR             EST OPEN WA ADDR         Y02072 05911602
         SPACE 3                                                 A35340 05912002
*        WHEN  DSCB IS LOCATED MOVE DSCB FIELDS TO DCB                  05914020
         SPACE 2                                                 A35340 05916002
         MVC   DCBNREC(4),D2NREC        NUMBER OF PRIME RECORDS  A35340 05936020
         MVC   DCBNOREC,D2NOREC         NUMBER OF OFL RECORDS   OZ05938 05936437
*                                       A2735                    A35340 05938020
         SR    RB,RB                    STATUS BITS              A35340 05940020
         IC    RB,D2ST                                           A35340 05942020
         SRL   RB,6                                              A35340 05944020
         STC   RB,DCBST                                          A35340 05946020
         MVC   DCBLPDA,D2LPDA           LAST PRIME DATA RCD OF   A35340 05952020
*                                       SET                      A35340 05954020
         MVC   DCBNOREC,D2NOREC         NUMBER OF OVERFLOW RECORDS      05970401
         MVC   DCBLIOV,D2LIOV           LAST IND OVFL RECORD            05970601
         XC    DCBEXCD1(TWO),DCBEXCD1   ZERO EXCEPTION FLAGS     A35399 05971020
         L     RG,DCBDEBAD              ADDRESSABILITY ON DEB    A35340 05972020
         USING SISDEB,RG                                         A35340 05974020
* SET UP BB FOR 2321 IN LPDA                                            05974221
         SR    R15,R15                                           A36373 05974421
         IC    R15,DCBLPDA              GET EXTENT NUMBER        A36373 05974621
         SLL   R15,4                    TIMES 16                 A36373 05974821
         LA    R15,DEBUCBAD(R15)        GET EXTENT ADDRESS       A36373 05975021
         MVC   DCBLPDA+1(2),4(R15)      SET UP BB                A36373 05975221
         SPACE 3                                                 A35340 05976002
*        FIND ICNOT = SMALLEST INTEGER THAT WILL CONTAIN BUFNO/2        06000018
         MODESET  KEYADDR=DXUKEY,WORKREG=14  SET USERS KEY       Y02072 06050002
         SPACE 2                                                        06100018
         LH    RD,W1FREEC               BUFFER NUMBER                   06200018
         SRL   RD,1                     DIVIDE BY 2                     06300018
         TM    W1FREEC+1,X'01'          IS BUFFER NUMBER ODD            06400018
         BZ    SIS05A3                  NO                              06500018
         LA    RD,1(RD)                 IF ODD, ADD 1            A35340 06600020
SIS05A3  STC   RD,W1ICNOT                                               06700018
         CLC   W1ICNOT,DCBHIRPD         FOR FIXED ICNOT MUST NOT        06800018
         BNH   SIS05A4                  EXCEED HI R OF PRIME DATA       06900018
         MVC   W1ICNOT,DCBHIRPD         SET ICNOT                       07000018
SIS05A4  EQU   *                                                 A35340 07050020
*   LIMIT NUMBER OF BUFFERS TO STOP OVERSIZED CHANNEL PROGRAMS.         07070001
         CLI   W1ICNOT,THIRTY           TOO MANY BUFFERS POSS           07080001
         BNH   NOTOOBIG                 NO - O.K.                       07090001
         MVI   W1ICNOT,THIRTY           YES - SET TOO LIMIT             07100001
NOTOOBIG EQU   *                        *                               07110001
         EJECT                                                          07150020
*                                                                       07250020
*   DETERMINE IF ANY OF THE EXTENTS ARE ON AN RPS DEVICE, IF SO         07350020
*   LOAD A START I/O MODULE FOR RPS.  THE SIO MODULE MUST ALSO BE       07450002
*   IF IN VIRTUAL ENVIRONMENT FOR SPLITTING SELF-MODIFYING CHANNEL      07550002
*   PROGRAMS (WHETHER OR NOT ANY RPS DEVICES USED).                     07600002
*                                                                       07610002
         L     RA,DEBAPPAD              DEB APPENDAGE ADDRESS   YM02867 07620002
         USING DEBAVT,RA                DEB AVT ADDRESSABILITY  YM02867 07630002
*                                                                       07640002
         TM   DEBRPSID,RPS              RPS DEVICE PRESENT       S20201 07650020
         BNZ  LOADSIO                   YES - LOAD SIO MODULE  @ZA12254 07750037
*                                       NO - TEST FOR VIRTUAL ENV.      07850002
         TM    DEBSIOA,VIRTUAL          IS IT VIRTUAL ENVIRON.   Y02072 07920002
         BZ    NORPSDEV                 BRANCH IF REAL           Y02072 07930002
*                                                                       07950002
LOADSIO  L     RTIOT,CVTPTR             ADDRESS OF CVT          YM01159 08050002
         USING CVT,RTIOT                CVT ADDRESSABILITY      YM01159 08100002
         L     RTIOT,CVTLINK            ADDRESS OF LINKLIB DCB  YM01159 08110002
         DROP  RTIOT                    END CVT ADDRESSABILITY  YM01159 08120002
*                                                                       08150002
*   LOAD THE START I/O MODULE IGG019HA.                                 08250020
*                                                                       08250102
*                                                                       08250202
         MODESET  EXTKEY=DATAMGT        SET DATA MGMT KEY        Y02072 08283402
*                                                                       08293402
         MVC   DXCCW6,IGG019            MAKE SIO MODULE NAME     Y02072 08316802
         LOAD  EPLOC=DXCCW6,DCB=(RTIOT)                          Y02072 08350002
*                                                                       08450002
         L     RB,DXCCW5                PTR TO NEXT SPOT IN DEB  Y02072 08670002
         TM    DEBSIOA,VIRTUAL          DOES VIRTUAL = REAL             08730001
         BO    NOTREAL1                 NO - VIRTUAL                    08790001
         ST    RE,DEBSIOA               SAVE SIO ADDRESS IN AVT         08910001
         B     NOTVIRT1                 DONE                            09030001
NOTREAL1 EQU   *                                                 Y02072 09090002
         ST    RE,DEBSIOA               SAVE SIO ADDRESS IN AVT  Y02072 09140002
         OI    DEBSIOA,VIRTUAL          RESET VIRTUAL INDICATOR  Y02072 09190002
         L     RA,DEBEXPTR              ADDRESSABILITY ON ISAM SECTION  09280000
         USING DEBEXT,RA                *                               09290000
         ST    RE,DEBRPSS               SAVE RPS SIO PTR                09300000
NOTVIRT1 EQU   *                        *                               09390001
*                                                                       09440002
*   PLACE ID FOR SIO MODULE ON THE SUBROUTINE NAME LIST                 09650020
*                                                                       09700002
         MVC   0(L'RPSSIOID,RB),RPSSIOID MODULE ID TO DEB        Y02072 09750002
*                                                                       09800002
* SET UP THE SIO PREFIXES.                                              09850020
*                                                                       09860002
         MODESET  KEYADDR=DXUKEY,WORKREG=11  SET USERS KEY       Y02072 09900002
*                                                                       09910002
*    TEST IF RPS DEVICE USED, IF NOT SKIP RPS INITIALIZTAION CODE.      09920002
*                                                                       09930002
         TM    DEBRPSID,RPS             RPS DEVICE PRESENT       Y02072 09940002
         BZ    NORPSDEV                 BR IF NO RPS DEVICES     Y02072 09942002
*                                                                       09944002
         MVC   W1ICPEXT(48),SIOCCWS     MOVE IN SKELETON         M5092  09950020
         LA    RA,W1ISECT               PT TO SECTOR             S20201 10050020
         A     RA,W1ICPEXT              AD OP CODE               S20201 10150020
         ST    RA,W1ICPEXT              INPUT EXTENSION          S20201 10250020
         LA    RA,K1(RA)                PT TO SECTOR             S20201 10350020
         ST    RA,W1OCPEXT              OUTPUT EXTENSION         S20201 10450020
         MVI   W1OCPEXT,SETSECT         OPCODE = SETSECTOR       S20201 10550020
         LA    RA,W1ISECT               READ SECTOR OF OVERFLOW  M5092  10552020
         A     RA,W1RDSECT              * RECORDS FOR PUTX.      M5092  10554020
         ST    RA,W1RDSECT              *                        M5092  10556020
*   FIND MINIMUM OVERFLOW LENGTH AND RECORD LENGTH                      10558020
         LH    RB,DCBBLKSI              BLOCKSIZE FIXED          M5092  10560020
         LH    RA,DCBLRECL              RECORD LENGTH            M5092  10562020
FIXED    EQU   X'80'                    FIXED LENGTH SW          M5092  10564020
         SR    RC,RC                                             M5092  10566020
         IC    RC,DCBKEYLE              KEY LENGTH               M5092  10568020
         TM    DCBRECFM,FIXED           FLR                      M5092  10570020
         BO    RPS001                   LENGTH O.K.              M5092  10572020
         LA    RA,4(RC)                 4+KEYLENGTH              M5092  10574020
         AH    RA,DCBRKP                +RKP                     M5092  10576020
         SH    RB,DCBLRECL              BLKSIZE-LRECL            M5092  10578020
         CR    RA,RB                    BLKSI-LRECL BIGGER       M5092  10580020
         BNH   RPS001                   YES - USE IT             M5092  10582020
         LR    RB,RA                    NO - USE 4+KL+RKP        M5092  10584020
RPS001   EQU   *                        SAVE LENGTHS             M5092  10586020
         LA    RA,10(RA)                ALLOW FOR OVERFLOW CHAIN M5092  10588020
         STH   RA,W1OVLEN               MINIMUM OVERFLOW LENGTH  M5092  10590020
         AR    RB,RC                    LENGTH EACH PRIME        M5092  10592020
         STH   RB,W1RECLEN              SAVE IT                  M5092  10594020
*   FIND LIMITS FOR ESTIMATING OVERFLOW SECTORS.                        10596020
         IC    RC,DCBDEVT               FIND LIMITS FOR CYL OVFL M5092  10598020
         BAL   RF,RPS002                LINK TO SUBRTN           M5092  10600020
         MVC   W1RPSC1(2),W1RPSI1       SAVE LIMITS              M5092  10602020
*                                                                       10604020
         IC    RC,DCBOVDEV              FIND LIMITS FOR IND OVFL M5092  10606020
*                                                                       10608020
RPS002   EQU   *                        ROUTINE TO CALC LIMITS   M5092  10610020
         L     RB,CVTPTR                CVT ADDRESS              M5092  10612020
         L     RB,DEVTBL(RB)            PTR TO DEV TABLE         M5092  10614020
DEVTBL   EQU   64                       DEV TABLE                M5092  10616020
         SR    RA,RA                                             M5092  10618020
         IC    RA,0(RC,RB)              GET DISPLACEMENT         M5092  10620020
         LA    RA,0(RB,RA)              DEV TBL ADDRESS          M5092  10622020
         LH    RG,W1OVLEN               OVERFLOW LENGTH          M5092  10624020
         LH    RB,TRKL(RA)              TRACK LENGTH             M5092  10626020
TRKL     EQU   4                        DISP TO TRK LEN          M5092  10628020
         SR    RC,RC                                             M5092  10630020
         IC    RC,DCBKEYLE              KEY LENGTH               M5092  10632020
         AR    RG,RC                    ENTRY + KEYLEN           M5092  10634020
         IC    RC,6(RA)                 OVERHEAD NONZEUS         M5092  10636020
         TM    9(RA),X'08'              ZEUS                     M5092  10638020
         BZ    RPS003                   NO - OVERHEAD O.K.       M5092  10640020
         LH    RC,6(RA)                 OVERHEAD - ZEUS          M5092  10642020
RPS003   EQU   *                        *                        M5092  10644020
         AR    RG,RC                    TOTAL LENGTH RECORD      M5092  10646020
         SRDL  RB,33                    TRK/2                    M5092  10648020
         DR    RB,RG                    TRK/2/LENGTH             M5092  10650020
         STC   RC,W1RPSI2               SAVE LIMIT               M5092  10652020
         IC    RC,DCBKEYLE              KEY LEN                  M5092  10654020
         LH    RG,DCBLRECL              RECORD LENGTH MINUS      M5092  10656020
         SR    RG,RC                    MIN RECORD LENGTH EQUALS M5092  10658020
         SH    RG,DCBRKP                DEVIATION = DELTA        M5092  10660020
         MVI   W1RPSI1,X'FF'            SET IN CASE DEV=0        M5092  10662020
         LTR   RG,RG                    DEVIATION=0              M5092  10664020
         BZ    RPS0031                  YES THEN LIMIT=MAX       M5092  10666020
         LH    RB,TRKL(RA)              TRK LENGTH/2             M5092  10668020
         SRDL  RB,33                    *                        M5092  10670020
         DR    RB,RG                    TRK / DELTA / 2          M5092  10672020
         CH    RC,HEXFFHW               IS R TO HIGH             M1825  10672621
         BNL   RPS0031                  YES - THEN X'FF' IS GOOD M1825  10673221
         STC   RC,W1RPSI1               LOWER LIMIT              M5092  10674020
RPS0031  EQU   *                        *                        M5092  10676020
         SR    RC,RC                    CLEAR WORK REG           M1825  10677021
         BALR  RF,RF                    DO INDEPENDANT IF NOT    M5092  10678020
*                                       DONE ALREADY                    10680020
*   CALCULATE RUNNING TRACK TOTAL TO FIRST SHARED                       10682020
         IC    RC,DCBKEYLE              KEY LENGTH               M5092  10684020
         LA    RG,10(RC)                +10 = SHARED LENGTH      M5092  10686020
         IC    RC,DCBFIRSH+2            S-1                      M5092  10688020
         BCTR  RC,0                     *                        M5092  10690020
         MR    RB,RG                    (S-1)* LENGTH            M5092  10692020
         STH   RC,W1FSTSH               TOTAL TO FIRST SHARED    M5092  10694020
NORPSDEV EQU   *                        *                        M5092  10696020
         EJECT                                                          10750020
*                                                                       12100020
*   FINISH INITIALIZING THE WORK AREA                                   17100020
*                                                                       22100020
SIS05J4  OI    W1ECBI,X'40'             SET ECB COMPLETE BITS ON A35340 27100020
         OI    W1ECBO,X'40'                                             32300018
         OI    W1IF1,X'42'              SET CC BIT IN FLAG 1 AND ISAM   32400018
         OI    W1OF1,X'C2'               O/P SET ON DC BIT          BIT 32500018
         LA    RC,W1ECBI                SET ECB POINTERS                32600018
         ST    RC,W1IECBAD                                              32700018
         LA    RC,W1ECBO                                                32800018
         ST    RC,W1OECBAD                                              32900018
         L     RC,DXUDCBAD              SET DCB POINTERS IN      Y02072 33000002
         ST    RC,W1IDCBAD              INPUT IOB AND            Y02072 33100002
         ST    RC,W1ODCBAD              OUTPUT IOB               Y02072 33200002
         LH    RC,DCBLRECL              INITIALIZE W1CURLEN             33300018
         STH   RC,W1CURLEN                                              33400018
         SPACE 4                                                        33500018
         L     RC,DXCCW7                ASYCHRONOUS ROUTINE      Y02072 33600002
         CIRB  EP=(RC),KEY=PP,MODE=SUPR,STAB=RE   CREATE REUSABLE IRB   33700018
         SPACE 2                                                        33710002
*        REFRESH USERS DCB                                       Y02072 33720002
         SPACE 2                                                        33730002
         L     RPARC,DXUDCBAD           USERS DCB ADDR           Y02072 33740002
         LH    RWTG,DXUDCBML            NO OF BYTES TO MOVE      Y02072 33742002
         BCTR  RWTG,0                   LENGTH MINUS 1 FOR MOVE  Y02072 33742402
         EX    RWTG,COPYDCB             UPDATE USERS DCB         Y02072 33744002
         SPACE 2                                                        33746002
         MODESET  EXTKEY=DATAMGT        SET DATA MGMT KEY        Y02072 33750002
*                                                                       33760002
         L     RG,DCBDEBAD             SET DEB BASE                     33800018
         IC    RD,DEBOFLGS                   PUT IRB ADDRESS IN DEB     33900018
         ST    RF,DEBIRBAD                                              34000018
         STC   RD,DEBOFLGS                                              34100018
         SPACE 5                                                        34200018
*                   FINISHED WITH THIS DCB.                             34300018
*                                                                       34400018
*                   SET NAME PORTION OF WTG ENTRY TO ZERO               34500018
*                                       SINCE NEXT LOAD IS OPEN LOAD 7  34600018
         LR    RG,RPAR                  GET OPEN WA ADDR         Y02072 34650002
         DROP  RPAR                     END OPEN WA ADDR         Y02072 34660002
         USING FORCORE,RG               EST OPEN WA ADDR         Y02072 34670002
         LM    RPAR,RWTGC,DXCCW1        RESTORE REGISTERS 5-8    Y02072 34680002
SIS05END XC    0(5,RWTGC),0(RWTGC)                               A35340 34700020
RELOOP   LA    RWTGC,8(RWTGC)           INCREMENT WTG CURRENT ENTRY     36300018
         LA    RPARC,4(RPARC)           INCREMENT DCB CURRENT ENTRY     36400018
         CLC   0(2,RWTGC),THISLOAD                                      36500018
         BCR   8,RBASE                  BRANCH = BEGINNING OF THIS MOD  36600018
         CLC   0(2,RWTGC),OPNLOD7       TEST FOR END OF WTG TABLE       36700018
         BNE   RELOOP                   BRANCH NOT =, NOT AT END        36800018
ATEND    LR    RPARC,RPAR               INITIALIZE RPARC                36900018
         LA    RWTGC,32(RWTG)           INITIALIZE RWTGC                37000018
ZCHECK   CLI   0(RWTGC),X'00'           TEST FOR ENTRY = 0              37100018
         BNE   TCTLRTN                  BRANCH = NOT ZERO               37200018
ITSZERO  LA    RWTGC,8(RWTGC)                                           37300018
         LA    RPARC,4(RPARC)                                           37400018
         B     ZCHECK                                                   37500018
TCTLRTN  MVC   6(2,RWTG),0(RWTGC)       MOVE ID                         37600018
         LA    RJ,DXCCW12               WA ADDRESS               Y01021 37800000
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) XCTL TO NEXT LOAD  Y02072 37900002
         SPACE 2                                                        37910002
*        UPDATE USERS DCB                                        Y02072 37920002
         SPACE 1                                                        37930002
COPYDCB  MVC   DCBKEYLE-IHADCB(0,RPARC),DCBKEYLE  UPDATE         Y02072 37940002
         SPACE 2                                                        37942002
*        CONSTANTS                                                      37944002
         SPACE 1                                                        37946002
HEXFFHW  DC    H'255'                   MAXIMUM RECORD VALUE     M1825  37950021
THISLOAD DC    C'24'                                                    38100018
OPNLOD7  DC    C'0S'                                                    38200018
*   START I/O MODULE IDENTIFIER FOR LOAD INSTRUCTION                    38210020
IGG019   DC    C'IGG019'                MODULE ID FOR RPS SIO    Y02072 38220002
RPSSIOID DC    C'HA'                    MODULE IGG019HA          Y02072 38230002
*   SIO PREFIX CCWS                                                     38240020
SIOCCWS  CCW   SETSECT,0,CC+SILI,1      OUTPUT EXTENSION         S20201 38250020
         CCW   TIC,0,0,0                TIC TO CP                S20201 38260020
         CCW   SETSECT,0,CC+SILI,1      OUTPUT EXTENSION         S20201 38270020
         CCW   TIC,0,0,0                TIC TO CP                S20201 38280020
         CCW   RDCNT,0,CC+SKIP+SILI,8   POSITION TO NEXT RECORD  M5092  38286020
         CCW   RDSECT,0,0,1             READ SECTOR OF NEXT REC  M5092  38292020
         SPACE 3                                                        38300018
PATCH    DC    XL50'00'                 ZEROED PATCH AREA        Y02072 38350002
         EJECT                                                          39100018
SISDEB   IGGDEBD                                                        39200020
         EJECT                                                          42900018
SISWORK1 IGGSCAN                SCAN MODE WORK AREA              A35340 43000020
         EJECT                                                          62500018
         DCBD  DSORG=IS                                                 62600018
         EJECT                                                          62602020
FORCORE  DSECT                                                          62604020
         IECDSECT                                                       62606020
         SPACE 4                                                        62608002
         CVT   DSECT=YES                                        YM01159 62608402
         EJECT                                                          62608802
*                                                                       62610020
*   FORMAT 2 DATA SET CONTROL BLOCK ( DSCB )                            62612020
*                                                                       62614020
DSCBFRM2 DSECT                                                          62616020
         DS    0D                                                A35340 62618020
DSC2KEY  DS    CL1                                               A35340 62620020
D2FTMI2  DS    CL7                      ADR OF 2ND LEVEL MASTER  A35340 62622020
*                                       INDEX                    A35340 62624020
D2LEMI2  DS    CL5                      ADR OF LAST 2ND LEVEL    A35340 62626020
*                                       MASTER                   A35340 62628020
*                                                      INDEX ENTRY      62630020
D2FTMI3  DS    CL7                      ADR OF 3RD LEVEL MASTER  A35340 62632020
*                                       INDEX                    A35340 62634020
D2LEMI3  DS    CL5                      ADR OF LAST 3RD LEVEL    A35340 62636020
*                                       MASTER                   A35340 62638020
*                                                      INDEX ENTRY      62640020
         DS    CL19                     SPARE                    A35340 62642020
* DATA PORTION                                                          62644020
D2FMTID  DS    CL1                      FORMAT ID                A35340 62646020
D2NLEV   DS    CL1                      NUMBER OF LEVELS OF      A35340 62648020
*                                       MASTER IND               A35340 62650020
D2NTM    DS    CL1                      HIGH LEVEL INDX          A35340 62652020
*                                       DEVELOPMNT IND           A35340 62654020
D2FIRSH  DS    CL3                      FIRST DATA RECORD        A35340 62656020
D2LDT    DS    CL2                      LAST DATA RECORD IN      A35340 62658020
*                                       CYLINDER                 A35340 62660020
D2CYLOF  DS    CL1                      NUMBER OF TRACKS FOR CYL A35340 62662020
*                                       OVFLO                    A35340 62664020
D2HIRCM  DS    CL1                      HIGHEST R ON INDEX       A35340 62666020
*                                       ENTRIES                  A35340 62668020
D2HIRPD  DS    CL1                      HIGHEST R ON PRIME       A35340 62670020
D2HIROV  DS    CL1                      HIGHEST R ON OVFLO       A35340 62672020
D2HIRSH  DS    CL1                      R OF LAST DATA RCD ON    A35340 62674020
*                                       SHARED                   A35340 62676020
         DS    CL2                      RESERVED                 A35340 62678020
D2TDC    DS    CL2                      TAG DELETION COUNT       A35340 62680020
D2RORG3  DS    CL3                      NON-FIRST OVFLO REF.     A35340 62682020
*                                       COUNT                    A35340 62684020
D2NCRHI  DS    CL2                      NUM. BYTES FOR HIGHEST   S20201 62714020
*                                       LEV IND                  S20201 62744020
D2NTHI   DS    CL1                      NUM. TRKS FOR HIGHEST    S20201 62774020
*                                       LEV INDX                 S20201 62804020
D2NREC   DS    CL4                      PRIME RECORD COUNT       S20201 62834020
D2ST     DS    CL1                      STATUS INDICATORS        S20201 62864020
D2FTCI   DS    CL7                      ADR OF CYLINDER INDEX    S20201 62894020
D2FTMI1  DS    CL7                      ADR OF LOWEST LEV MASTER S20201 62924020
*                                       INDEX                    S20201 62954020
D2FTHI   DS    CL7                      ADR OF HIGHEST LEV       S20201 62984020
*                                       MASTER INDE              S20201 63014020
D2LPDA   DS    CL8                      LAST PRIME DATA RECORD   S20201 63044020
*                                       ADR                      S20201 63074020
D2LETI   DS    CL5                      LAST TRACK INDEX ENTRY   S20201 63104020
*                                       ADR                      S20201 63134020
D2LECI   DS    CL5                      LAST CYL. INDEX ENTRY    S20201 63164020
*                                       ADR.                     S20201 63194020
D2       DS    CL5                      LAST MSTR INDEX ENTRY    S20201 63224020
*                                       ADR.                     S20201 63254020
D2LIOV   DS    CL8                      LAST INDP. OVFLO RCD     S20201 63284020
*                                       ADR.                     S20201 63314020
D2NBOV   DS    CL2                      BYTES LEFT ON OVFLO      S20201 63344020
*                                       TRACK                    S20201 63374020
D2RORG2  DS    CL2                      NUM. OF INDP. OVFLO      S20201 63404020
*                                       TRACKS                   S20201 63434020
D2NOREC  DS    CL2                      OVERFLO RECORD COUNT     S20201 63464020
D2RORG1  DS    CL2                      CYL. OVERFLO AREA COUNT  S20201 63494020
         DS    CL3                      SPARE                    S20201 63524020
D2NEXT   DS    CL5                      PTS TO NEXT DSCB         S20201 63554020
D2CORE   DS    CL4                      CHAINED CORE ADR         S20201 63584020
         END                                                            63614020
D2NCRHI  DS    CL2                      NUM. BYTES FOR HIGHEST   A35340 63684020
*                                       LEV IND                  A35340 64684020
D2NTHI   DS    CL1                      NUM. TRKS FOR HIGHEST    A35340 65684020
*                                       LEV INDX                 A35340 66684020
D2NREC   DS    CL4                      PRIME RECORD COUNT       A35340 67684020
D2ST     DS    CL1                      STATUS INDICATORS        A35340 68684020
D2FTCI   DS    CL7                      ADR OF CYLINDER INDEX    A35340 69684020
D2FTMI1  DS    CL7                      ADR OF LOWEST LEV MASTER A35340 70684020
*                                       INDEX                    A35340 71684020
D2FTHI   DS    CL7                      ADR OF HIGHEST LEV       A35340 72684020
*                                       MASTER INDE              A35340 73684020
D2LPDA   DS    CL8                      LAST PRIME DATA RECORD   A35340 74684020
*                                       ADR                      A35340 75684020
D2LETI   DS    CL5                      LAST TRACK INDEX ENTRY   A35340 76684020
*                                       ADR                      A35340 77684020
D2LECI   DS    CL5                      LAST CYL. INDEX ENTRY    A35340 78684020
*                                       ADR.                     A35340 79684020
D2       DS    CL5                      LAST MSTR INDEX ENTRY    A35340 80684020
*                                       ADR.                     A35340 81684020
D2LIOV   DS    CL8                      LAST INDP. OVFLO RCD     A35340 82684020
*                                       ADR.                     A35340 83684020
D2NBOV   DS    CL2                      BYTES LEFT ON OVFLO      A35340 84684020
*                                       TRACK                    A35340 85684020
D2RORG2  DS    CL2                      NUM. OF INDP. OVFLO      A35340 86684020
*                                       TRACKS                   A35340 87684020
D2NOREC  DS    CL2                      OVERFLO RECORD COUNT     A35340 88684020
D2RORG1  DS    CL2                      CYL. OVERFLO AREA COUNT  A35340 89684020
         DS    CL3                      SPARE                    A35340 90684020
D2NEXT   DS    CL5                      PTS TO NEXT DSCB         A35340 91684020
D2CORE   DS    CL4                      CHAINED CORE ADR         A35340 92684020
         END                                                            93684020
