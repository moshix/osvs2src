 TITLE 'IGG01928- FIRST SCAN MODE OPEN MODULE'                          00020000
IGG01928 CSECT                                                          00021002
*                                                                       00022002
*********************************************************************** 00023002
*                                                                     * 00024002
* MODULE-NAME = IGG01928                                              * 00025002
*                                                                     * 00026002
* DESCRIPTIVE-NAME = ISAM OPEN, SCAN MODE                             * 00027002
*                                                                     * 00028002
* COPYRIGHT = NONE                                                    * 00029002
*                                                                     * 00030002
* STATUS = RELEASE OS/VS2-02, LEVEL 01                                * 00031002
*                                                                     * 00032002
* FUNCTION = CALCULATE SIZE OF SCAN MODE WORK AREA PLUS CHANNEL       * 00033002
*            PROGRAM SPACE, AND GET CORE FROM SUBPOOL 250.  SAVE WA   * 00034002
*            ADDRESS IN DCBWKPT1 AND LENGTH IN DCBWKPT6.  LOAD        * 00035002
*            APPENDAGE CONTROL RTN AND READ APPENDAGE MODULE,         * 00036002
*            IGG019HG.  SAVE ASYNCHRONOUS ROUTINE ENTRY ADDRESS IN    * 00037002
*            DXCCW7 FOR IGG01924.  INITIALIZE DEBAVT ADDRESSES.  IF   * 00038002
*            PUTX, WITH WRITE CHECK, LOAD IGG019HH; OR IF PUTX,       * 00039002
*            WITHOUT WRITE CHECK, LOAD IGG019HI.  LOAD PROCESSING     * 00040002
*            MODULE IGG019HB FOR FIXED LENGTH RECORDS (FLR), OR       * 00041002
*            IGG019HN FOR VLR.  IF SETL BY KEY, LOAD SETL MODULE      * 00041102
*            IGG019HD AND APPENDAGE IGG019HK.  IF SETL BY ID, LOAD    * 00041202
*            SETL MODULE IGG019HF AND APPENDAGE IGG019HJ.  SET        * 00041402
*            DCBSETL ADDRESS.  LOAD CHANNEL PROGRAM MODULE IGG019HL.  * 00041602
*            MOVE CP24 SKELETON INTO WA; ALSO MOVE ONE COPY OF CP22   * 00041802
*            FOR EACH BUFFER.  IF SETL BY KEY, MOVE CP23 & CP26.  IF  * 00041902
*            SETL BY ID, MOVE CP25. DELETE CP MODULE IGG019HL.        * 00042002
*                                                                     * 00042202
* NOTES = SEE BELOW                                                   * 00043002
*                                                                     * 00044002
*    DEPENDENCIES = NONE                                              * 00045002
*                                                                     * 00046002
*    RESTRICTIONS = NONE                                              * 00047002
*                                                                     * 00048002
*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                     * 00049002
*                                                                     * 00050002
*    PATCH-LABEL = PATCH, A DC STATEMENT.                             * 00051002
*                                                                     * 00052002
* MODULE-TYPE = OPEN EXECUTOR                                         * 00053002
*                                                                     * 00054002
*    PROCESSOR = ASSEMXF-370R                                         * 00055002
*                                                                     * 00056002
*    MODULE-SIZE = 896 DECIMAL BYTES                                  * 00057002
*                                                                     * 00058002
*    ATTRIBUTES = PRIVILEGED, REENTRANT                               * 00059002
*                                                                     * 00060002
* ENTRY-POINT = IGG01928                                              * 00061002
*                                                                     * 00062002
*    PURPOSE = SEE FUNCTION                                           * 00063002
*                                                                     * 00064002
*    LINKAGE = RECEIVES CONTROL FROM ISAM OPEN EXECUTOR IGG01928 FOR  * 00065002
*              FLR, OR IGG01950 FOR VLR.  RECEIVES CONTROL IN         * 00066002
*              STORAGE PROTECT KEY 5 AND PRIVILEGED STATE.            * 00067002
*                                                                     * 00068002
* INPUT = REGISTERS ESTABLISHED UPON ENTRY ARE                        * 00069002
*         REG 5 (RPAR) POINTS TO THE DCB COPY PARAMETER LIST          * 00070002
*         REG 6 (RWTG) POINTS TO THE O/C/EOV WHERE-TO-GO TABLE        * 00071002
*         REG 7 (RPARC) POINTS TO THE CURRENT ENTRY IN THE DCB COPY   * 00072002
*               PARAMETER LIST                                        * 00073002
*         REG 8 (RWTGC) POINTS TO THE CURRENT ENTRY IN THE WTG TABLE  * 00074002
*                                                                     * 00075002
* OUTPUT = REGISTERS 5 THROUGH 8 WILL BE IN THE SAME CONDITION AS     * 00076002
*          UPON ENTRY TO THIS MODULE                                  * 00077002
*                                                                     * 00078002
* EXIT-NORMAL = XCTL TO ISAM OPEN EXECUTOR IGG01929 IN STORAGE        * 00079002
*               PROTECT KEY 5.                                        * 00079202
*                                                                     * 00080002
* EXIT-ERROR = NONE                                                   * 00081002
*                                                                     * 00086002
* EXTERNAL-REFERENCES = SEE BELOW                                     * 00087002
*                                                                     * 00088002
*    ROUTINES = NONE                                                  * 00089002
*                                                                     * 00091002
*    DATA-AREAS = AREAS REFERENCED ARE:                               * 00092002
*                 FORCORE - OPEN WORK AREA                            * 00093002
*                 IGGSCAN - ISAM SCAN MODE WORK AREA                  * 00094002
*                                                                     * 00095002
*    CONTROL-BLOCKS = DCB COPY, DEB, AND CVT                          * 00096002
*                                                                     * 00097002
* TABLES = NONE                                                       * 00098002
*                                                                     * 00099002
* MACROS = GETMAIN, MODESET, LOAD, DELETE, AND XCTL                   * 00100002
*                                                                     * 00101002
* CHANGE-ACTIVITY = AS FOLLOWS:                                       * 00102002
*                                                                     * 00103002
*          RELEASE OS/VS2-02 DELETIONS                                * 00153002
*                                                               YM01159 00203002
*                                                               YM02867 00253002
*                                                                     * 00741002
*********************************************************************** 00742002
         EJECT                                                          00743002
         USING IHADCB,RDCB                                              00744002
         USING SISWORK1,RUCB                                            00760000
         BALR  RBASE,0                                                  00780000
         USING *,RBASE                                                  00800000
         USING FORCORE,RG                                               00840000
R15      EQU   15                                                       00860000
RE       EQU   0                                                        00880000
RF       EQU   1                                                        00900000
RDCB     EQU   2                                                        00920000
RBASE    EQU   3                                                        00940000
RG       EQU   4                                                        00960000
RPAR     EQU   5                                                        00980000
RWTG     EQU   6                                                        01000000
RPARC    EQU   7                                                        01020000
RWTGC    EQU   8                                                        01040000
RTIOT    EQU   9                                                        01060000
RUCB     EQU   10                                                       01080000
RA       EQU   11                                                       01100000
RB       EQU   12                                                       01120000
RC       EQU   13                                                       01140000
RD       EQU   14                                                       01160000
RJ       EQU   15                                                       01180000
RPSID    EQU   X'E0'                    RPS IDENTIFIER           S20201 01182020
K4       EQU   4                        CONSTANT                 S20201 01184020
K2       EQU   2                        CONSTANT                 S20201 01186020
PUTX     EQU   X'04'                    PUTX ID                  S20201 01188020
K7       EQU   7                        CONSTANT                 S20201 01190020
K10      EQU   10                       CONSTANT                 S20201 01192020
VIRTUAL  EQU   X'80'                    VIRTUAL INDICATOR               01193000
WRTCHK   EQU   X'80'                    WRITE CHECK INDICATOR    S21045 01194321
LO3BYTE  EQU   7                        STORE 3 LOW ORDER BYTES YM02867 01194402
ID       EQU   6                        DISP TO ID               S21045 01194621
ONE      EQU   1                        CONSTANT                 S21045 01194921
K8       EQU   8                        CONSTANT                 S21045 01195221
HB       EQU   C'B'                     IGG019HB                 S21045 01195821
HN       EQU   C'N'                     IGG019HN                 S21045 01196121
HD       EQU   C'D'                     IGG019HD                 S21045 01196421
HF       EQU   C'F'                     IGG019HF                 S21045 01196721
HG       EQU   C'G'                     IGG019HG                 S21045 01197021
HH       EQU   C'H'                     IGG019HH                 S21045 01197321
HI       EQU   C'I'                     IGG019HI                 S21045 01197621
HJ       EQU   C'J'                     IGG019HJ                 S21045 01197921
HK       EQU   C'K'                     IGG019HK                 S21045 01198221
HL       EQU   C'L'                     IGG019HL                 S21045 01198521
         SPACE 2                                                        01200000
*        INITIALIZE REGISTERS                                           01220000
SIS04A2  L     RDCB,0(RPARC)                                            01240000
         L     RG,4(RWTGC)                                              01260000
         L     RTIOT,CVTPTR             ADDRESS OF CVT          YM01159 01280002
         USING CVT,RTIOT                CVT ADDRESSABILITY      YM01159 01330002
         L     RTIOT,CVTLINK            ADDRESS OF LINKLIB DCB  YM01159 01340002
         DROP  RTIOT                    END CVT ADDRESSABILITY  YM01159 01342002
         USING FORCORE,RG               EST OPEN WA ADDR         Y02072 01350002
         STM   RPAR,RWTGC,DXCCW1        SAVE REGISTERS 5-8       Y02072 01352002
         LR    RPAR,RG                  SAVE OPEN WA ADDR        Y02072 01354002
         DROP  RG                       END OPEN WA ADDR         Y02072 01356002
         USING FORCORE,RPAR             EST OPEN WA ADDR         Y02072 01358002
         SPACE 4                                                        01840000
*        CALCULATE AMOUNT OF SPACE NEEDED FOR WORK AREA                 01860000
         SPACE 3                                                        01880000
SIS04B2  SR    RD,RD                    GET NUMBER OF BUFFERS           01900000
         IC    RD,DCBBUFNO                                              01920000
         LR    RC,RD                    RC=RD=BUF NUM, MULTIPLY BY LEN  01940000
         M     RB,SIS4CN22              CP22, RC=BYTES FOR ALL CP22'S   01960000
         TM    DCBMACRF+1,X'03'         IS SETL K OR I SPECIFIED        01980000
         BZ    SIS04C2                  EITHER NO SETL OR SETL B        02000000
         LA    RC,CP25LEN(RC)           ASSUME SELI CP           S21045 02010021
         TM    DCBMACRF+1,X'01'         WHICH SETL IS IT                02020000
         BO    SIS04B21                 SETL ID                         02040000
         LA    RC,CP23LEN+CP26LEN-CP25LEN(RC) SETL K CP'S        S21045 02050021
SIS04B21 EQU   *                        *                        S21045 02060021
*                                                                       02070002
*   TEST TO SEE WHAT SIZE THE WORK AREA WILL BE, AND ADD                02086020
*   CORRECT LENGTH TO TOTAL.                                            02089020
*                                                                       02091002
SIS04C2  EQU   *                                                 Y01021 02092000
         L     RG,DCBDEBAD              DEB ADDRESSABILITY       Y01021 02092800
         USING SISDEB,RG                                         A35340 02095020
         L     RA,DEBAPPAD              PTR TO THE AVT           S21045 02096021
         USING DEBAVT,RA                ADDRESSABILITY           S21045 02097021
*                                                                       02098021
*   FIND THE LENGTH OF THE WORK AREA WITHOUT CHANNEL PROGRAMS.          02099002
*                                                                       02100021
         LA    RB,W1VLRLN               BASIC LENGTH             S21045 02101021
*   CHECK FOR RPS LENGTH.                                               02102021
         TM    DEBRPSID,RPSID           IS THIS AN RPS DATA SET  S21045 02103021
         BZ    SISNORPS                 NO - BASIC LENGTH O.K.   S21045 02104021
         LA    RB,W1RPSLN               USE RPS LENGTH           S21045 02105021
SISNORPS EQU   *                                                        02106002
*   TEMPORARILY SAVE WORK AREA LENGTH.                                  02107002
         ST    RB,DEBEOEA               *                        S21045 02108021
         DROP  RA                                                S21045 02109021
         AR    RC,RB                    ADD WORK AREA LENGTH     S21045 02110021
SIS04C21 EQU   *                        TO CHANNEL PGM LENGTH    Y02072 02115002
         GETMAIN R,LV=(RC),SP=250       GET SPACE FOR WORK AREA         02140000
SIS04D2  ST    RF,DCBWKPT1              LOCATION RETURNED IN RF         02160000
         LR    RUCB,RF                 SET BASE FOR DSECT               02180000
         ST    RC,DXCCW6                SAVE LENGTH OF WORK AREA Y02072 02182002
*                                                                       02190002
         MODESET  KEYADDR=DXUKEY,WORKREG=11 SET USERS KEY        Y02072 02200002
*                                                                       02210002
*                                       SET WORK AREA TO ZERO    Y02072 02212002
         LR    RA,RC                    LENGTH TO PAD TO ZERO    Y02072 02220002
         SR    RC,RC                    PAD TO ZERO              Y02072 02230002
         MVCL  RUCB,RB                  ZERO WORK AREA,          Y02072 02250002
*                                       C(RUCB) = ADDRESS OF WA  Y02072 02300002
*                                       C(RA) = LENGTH OF WA     Y02072 02302002
*                                       C(RB) = UNUSED           Y02072 02302402
*                                       C(RC) = PAD CHAR, ZERO   Y02072 02302802
*                                                                       02302902
         LR    RUCB,RF                  RESTORE WORK AREA ADDR   Y02072 02303202
         L     RC,DXCCW6                RESTORE LENGTH OF WA     Y02072 02303602
         MVC   W1DCBFA(4),DCBWKPT5      SET UP ADDR OF DCBFA     M6131  02304020
         STH   RC,W1WPLEN               SAVE WKPT LEN FOR CLOSE         02320000
         STH   RD,W1FREEC              SAVE BUFNO FOR CONVENIENCE       02340000
         L     RA,DEBAPPAD              AVT ADDRESSABILITY       S21045 02343021
         USING DEBAVT,RA                ADDRESSABILITY           S21045 02346021
         L     RB,DEBEOEA               WORK AREA LENGTH         S21045 02349021
         LA    RB,0(RB,RF)              END OF WORKAREA          S21045 02352021
         ST    RB,W1FR1ST               1ST CP 22                S21045 02355021
*                                                                       02357002
         MODESET  EXTKEY=DATAMGT        SET DATA MGMT KEY        Y02072 02358302
*                                                                       02358402
         SR    RA,RA                    CLEAR REGISTER           Y02072 02358802
         ST    RA,DCBWKPT5              ZERO WKPT FOR A35340     Y02072 02358902
         SPACE 3                                                        02359002
         DROP  RA                                                S21045 02381021
*   FIND DEB SUB ID FOR LOAD ROUTINE.                                   02382021
         IC    RA,DEBNMEXT              LENGHT OF EXTENTS =      S21045 02384021
         SLL   RA,K4                    16 * NUMBER              S21045 02385021
         LA    RB,SCANEXT               GET ACS METH LENGTH      S21045 02386021
         STC   RB,DEBAMLNG              INIT DEB                 S21045 02387021
         AR    RA,RB                    ADD AM LEN               S21045 02388021
         LA    RA,DEBMODID(RA)          PTR TO START OF ID LIST  S21045 02389021
         ST    RA,DXCCW5                SAVE IT                  Y02072 02390002
         SPACE 3                                                        02400000
*        FIND WHICH MODULES ARE NEEDED AND LOAD THEM                    02420000
         SPACE 3                                                        02440000
*                             LOAD MODULE CONTAING APPENDAGE CONTROL    02460000
*                             RTN AND READ APPENDAGES                   02480000
         MVC   DXCCW6,IGG019H           PREFORMAT NAME FOR LOAD  Y02072 02490002
         BAL   RA,LOADRTN               LOAD READ APPENDAGE      S21045 02500002
         LR   RD,RE                     SAVE MODULE PTR           M4361 02500400
         L     R15,DEBEXPTR             DEB EXTENSION            S21045 02550021
*                                       ADDRESSABILITY           S21045 02560021
         USING DEBEXT,R15                                        S21045 02570021
*                             SET RD TO BASE OF MODULE                  02580000
         SPACE                                                          02600000
         SPACE                                                          02640000
*                             AT THE BEGINNING OF THIS MODULE IS A      02660000
*                             VECTOR TABLE CONTAINING THE UNRELOCATED   02680000
*                             ADDRESSES OF VARIOUS ENTRY POINTS.        02700000
         L     RA,0(RD)                 CH END READ ENTRY               02720000
         AR    RA,RE                    ADD RELOCATION FACTOR           02740000
         ST    RA,W1CEREAD              MOVE TO CE VECTOR TBL           02760000
         L     RA,4(RD)                 AB END ENTRY READ               02780000
         AR    RA,RE                                                    02800000
         ST    RA,W1ABREAD              MOVE TO AB VECTOR TBL           02820000
         L     RA,8(RD)                 ASYNCHRONOUS RTN ENTRY          02840000
         AR    RA,RE                                                    02860000
         ST    RA,DXCCW7                SAVE FOR IRB IN 1924     Y02072 02880002
         L     RA,12(RD)                IMMEDIATE RETURN                02900000
         AR    RA,RE                                                    02920000
         L     R15,DEBAPPAD             AVT ADDRESSABILITY       S21045 02928021
         USING DEBAVT,R15                                        S21045 02936021
*                                                                       02944021
*   FILL IN APPENDAGE VECTOR TABLE.                                     02952002
         ST    RA,DEBEOEA               END OF EXTENT - BR 14    S21045 02960021
*                                                                       02962002
         STCM  RA,LO3BYTE,DEBSIOA+1     SIO - BR 14             YM02867 02968002
         ST    RA,DEBPCIA               PCI - UNUSED             S21045 02976021
         DROP  R15                      *                        S21045 02984021
         L     RA,16(RD)                APPEN CTL ENTRY FOR CH END      03000000
         AR    RA,RE                                                    03020000
         ST    RA,12(R15)               TO APP VECTOR TBL               03040000
         L     RA,20(RD)                APPEN CTL ENTRY FOR AB END      03060000
         AR    RA,RE                                                    03080000
         ST    RA,16(R15)               TO APP VECTOR TBL               03100000
         SPACE 3                                                        03340000
*                                       IS PUTX SPECIFIED               03360000
         SPACE                                                          03380000
         TM    DCBMACRF+1,PUTX          *                        S20201 03400020
         BZ    SIS04G23                NO FORGET WRITE APPENDAGES       03420000
         MVI   DXCCW6+L'IGG019H,HH     PUTX APPENDAGE NO W/C     Y02072 03430002
SIS04G21 TM    DCBOPTCD,X'80'           YES, IS WRITE CHECK SPEC.       03440000
         BZ    SIS04G22                 N0                              03460000
         MVI   DXCCW6+L'IGG019H,HI      PUTX APPENDAGE W/C       Y02072 03470002
SIS04G22 EQU   *                        *                        S21045 03480021
*                                                                       03490002
*   LOAD PUTX APPENDAGE                                                 03492702
*                                                                       03494500
         BAL   RA,LOADRTN               LOAD PUTX APPENDAGE             03496302
*                                                                       03496702
         LR    R15,RE                   SET R15 TO MODULE BASE          03508502
         L     RB,DEBEXPTR              DEB EXTENSION ADDR       S21045 03510602
         USING DEBEXT,RB                                         S21045 03512702
*   SET UP C.E. VECTORS.                                                03514802
         LA    RB,W1CEWRIT              CE VECTORS               S21045 03516902
         DROP  RB                                                S21045 03519002
         BAL   RC,PUTXRTN               LINK                     S21045 03521102
*   THEN SETUP A.E. VECTORS.                                            03523202
         LA    R15,0(R15,RD)            PT TO NEXT DISPLACEMENTS S21045 03525302
         L     RB,DEBEXPTR              DEB EXTENSION ADDR       S21045 03527402
         USING DEBEXT,RB                                         S21045 03529502
         LA    RB,W1ABWRIT              AB VECTORS               S21045 03531602
         DROP  RB                                                S21045 03533702
PUTXRTN  EQU   *                        *                        S21045 03535802
         SPACE 2                                                        03537902
         SR    RD,RD                    PUT ADDRS OF WRITE CHECKING     03540000
SIS04GA1 L     RA,0(RD,R15)              APPENDAGE ENTRY POINTS IN      03560000
         AR    RA,RE                     THE VECTOR TABLES ALSO         03580000
         ST    RA,0(RB,RD)              SAVE VECTOR              S21045 03590021
         LA    RD,K4(RD)                POINT TO NEXT            S21045 03600021
*                                       DISPLACEMENT             S21045 03610021
         TM    DCBOPTCD,WRTCHK          WRITE CHECK              S21045 03620021
         BZ    PUTXOUT                  NO - ONLY ONE VECTOR     S21045 03630021
         C     RD,SIS4CN16              TABLE OF UNRELOCATED ENTRY      03640000
         BL    SIS04GA1                 POINTS ARE AT THE BEGINNING OF  03660000
PUTXOUT  BALR  RC,RC                    GET OUT IF DONE          S21045 03750021
         SPACE 3                                                        04120000
SIS04G23 EQU   *                        *                        S21045 04127021
         MVI   DXCCW6+L'IGG019H,HB      FIXED PROCESSING MODULE  Y02072 04134002
         TM    DCBRECFM,X'80'           TEST RECORD FORMAT       A35340 04142020
         BO    SISLDGET                 FIXED - BRANCH           A35340 04144020
*                                       VARIABLE - LOAD VARIABLE        04146020
         MVI   DXCCW6+L'IGG019H,HN      VARIABLE PROCESSING      Y02072 04147002
*                                       MODULE                   S21045 04148021
SISLDGET EQU   *                                                 A35340 04150020
         BAL   RA,LOADRTN               LOAD PROCESSING MODULE   S21045 04170002
         IC    RA,DCBOFLGS                                              04200000
         ST    RE,DCBGET                STORE ENTRY POINT               04220000
         STC   RA,DCBOFLGS                                              04240000
         L     RB,DEBEXPTR              DEB EXTENSION ADDR       S21045 04244021
         USING DEBEXT,RB                                         S21045 04248021
         ST    RE,DEBGET                SAVE GET VECTOR IN DEB   S21045 04252021
         DROP  RB                                                S21045 04256021
         LR    R15,RE                   SET R15 WITH MODULE BASE        04260000
         L     RA,40(R15)               CONSTRUCT ESETL ADDRESS AND     04280000
         AR    RA,R15                   PLACE IT IN DCB                 04300000
         ST    RA,DCBESETL                                              04320000
         SPACE 5                                                        04380000
*                        IS A SETL MODULE TO BE LOADED                  04400000
         MVI   DXCCW6+L'IGG019H,HD      SETL K MODULE            Y02072 04406002
         LA    RC,HK                    SETL K APPENDAGE         S21045 04412021
         TM    DCBMACRF+1,X'03'                                         04420000
         BZ    SIS04G27                 NO, SETLB ALREADY IN GET MOD.   04440000
         TM    DCBMACRF+1,X'02'         KEY TYPE OF SETL                04460000
         BO    SIS04G25                 YES                             04480000
         MVI   DXCCW6+L'IGG019H,HF      SETL I MODULE            Y02072 04510002
         LA    RC,HJ                    SETL I APPENDAGE         S21045 04540021
SIS04G25 EQU   *                        *                        S21045 04570021
         SPACE 2                                                        04620000
         BAL   RA,LOADRTN               LOAD SETL MODULE         S21045 04650002
         ST    RE,DCBSETL               SETL ENTRY PT.           S21045 04680021
         STC   RC,DXCCW6+K7             SETL APP ID              Y02072 04710002
*                                                                       04720002
*   LOAD SETL APPENDAGE                                                 04749002
*                                                                       04755000
         BAL   RA,LOADRTN               LOAD SETL APPENDAGE             04761002
*                                                                       04763002
         LR    R15,RE                   POINTER TO SETL MOD      S21045 04770021
         LM    RA,RB,0(R15)             ENTRY POINTS                    04780002
         AR    RA,RE                    ADD RELOCATION FACTOR           04820000
         AR    RB,RE                     TO APPENDAGE ENTRY POINTS      04840000
         L     RG,DEBEXPTR              DEB EXTENSION            S21045 04845021
*                                       ADDRESSABILITY           S21045 04850021
         USING DEBEXT,RG                                         S21045 04855021
*                                                                       04855402
         ST    RA,W1CESETL              STORE IN WORKAREA APPENDAGE     04860000
         ST    RB,W1ABSETL              VECTOR TABLE                    04880000
         B     SIS04A3                                                  04900000
*                                                                       04910002
SIS04G27 L     RA,36(R15)               PUT ADDR OF SETL B IN DCB       04920000
         AR    RA,RE                    SINCE NO SPECIAL SETL WAS       04940000
         ST    RA,DCBSETL               LOADED                          04960000
SIS04A3  MVI   DXCCW6+L'IGG019H,HL      CHANNEL PROGRAM MODULE   Y02072 04970002
*                                                                       04972002
         LOAD  EPLOC=DXCCW6,DCB=(RTIOT) LOAD IT                  S21045 04980002
*                                                                       04982002
         MODESET  KEYADDR=DXUKEY,WORKREG=4  SET USERS KEY        Y02072 05000002
*                                                                       05020002
         LR    RG,RE                    SET BASE FOR TABLE OF CP ADDRS  05040000
         USING FAKEHL,RG                                         S21045 05050021
         MVC   W1CP24,C24               MOVE CP 24 SKELETON      S21045 05080021
         L     RB,DCBBUFCB                                              05160000
         TM    DCBRECFM,X'10'           BLOCKED                         05180000
         BO    SIS04C34                 YES                             05200000
         SR    RC,RC                    NO, IS THERE ROOM IN BUFFER TO  05220000
         IC    RC,DCBKEYLE              HAVE KEY AND DATA               05240000
*   KEYLENGTH + 10 ROUNDED UP TO NEXT DOUBLE WORD                       05260021
         LA    RC,K10+K7(RC)            *                        S21045 05280021
         SRL   RC,3                     DIVIDE BY 8              A35340 05300020
         SLL   RC,3                     MULTIPLY BY 8            A35340 05320020
         ST    RC,W1TEMPSA              SAVE G                   A35340 05350020
         AH    RC,DCBBLKSI              RC = G + BLKSI           A35340 05390020
         CH    RC,6(RB)                 TRUE BUF LEN IS IN BUF CTL BLK  05440000
         BH    SIS04C34                 NOT ROOM FOR KEY AND DATA       05460000
         OI    W1OSBIT3,X'80'           K-D TYPE OF CP WILL BE OK       05480000
         B     SIS04C32                                                 05500000
SIS04C34 MVC   W1TEMPSA,SIS4CN16        USED FOR 'G' FACTOR IN CN7      05520000
         SPACE 3                                                        05540000
SIS04C32 LH    RC,W1FREEC               ONE COPY OF CP22 FOR EACH BUF   05560000
*   FIND FIRST SPACE AFTER WORK AREA TO PUT CHANNEL PROGRAMS            05566020
*   IN.                                                                 05572020
         L     RTIOT,DCBDEBAD           DEB ADDRESABILITY        S20201 05573020
         USING SISDEB,RTIOT                                      S20201 05574020
         L     RD,W1FR1ST               1ST CP 22                S21045 05584021
SIS04C33 MVC   0(CP22LEN,RD),C22        MOVE IN CP22 SKELETON    S21045 05604021
         ST    RD,W1FRLAST              IN CASE THIS IS LAST ONE        05640000
         LA    RD,CP22LEN(RD)           UPDATE TO ADDR FOR NEXT  A35340 05650020
*                                       MOVE                     A35340 05660020
         BCT   RC,SIS04C33              LOOP TILL SUFFICIENT COPIES IN  05680000
         SPACE 2                                                        05700000
SIS04G3  TM    DCBMACRF+1,X'03'         WAS SETL I OR K SPECIFIED       05720000
         BZ    SIS04J3                  NO                              05740000
         TM    DCBMACRF+1,X'02'         YES, WHICH TYPE                 05760000
         BO    SIS04G4                  KEY                             05780000
         ST    RD,W1CP25PT              SET POINTER IN WORKAREA         05840000
         MVC   0(CP25LEN,RD),C25        MOVE CP 25 SKELETON      S21045 05860021
         SPACE 2                                                        05880000
         B     SIS04J3                                                  05900000
         SPACE 5                                                        05920000
*                                  MOVE CP23 AND CP26 TO WORKAREA       05940000
SIS04G4  ST    RD,W1CP23PT                                              05960000
         MVC   0(HALF236,RD),C23        MOVE IN CP 23 AND        S21045 05980021
         MVC   HALF236(HALF236,RD),C23+HALF236 CP 26 SKELETONS   S21045 06000021
*   BREAK CP23.                                                         06002000
         USING CS1,RD                   ADDRESSABILITY ON CP 23 SA52459 06007000
         NI    CS4+K4,X'FF'-CC          BREAK UP CHANNEL PROGRAMSM4505  06008000
         DROP  RD                                               SA52459 06009000
         SPACE 3                                                 S21045 06020021
         LA    RD,CP23LEN(RD)                                    A35340 06040020
         ST    RD,W1CP26PT              SET POINTER                     06060000
         SPACE 3                                                        06180002
SIS04J3  DELETE EPLOC=DXCCW6             DELETE CP MODULE        Y02072 06200002
*                                       NEEDED HAVE BEEN MOVED TO THE   06220000
*                                       WORKAREA                        06240000
         SPACE 3                                                        06260000
*                   FINISHED WITH THIS DCB.                             06280000
*                                                                       06300000
*                   SET WTG ENTRY WITH NAME OF NEXT LOAD                06320000
         LR    RG,RPAR                  SET OPEN WA BASE         Y02072 06330002
         DROP  RPAR                     END OPEN WA ADDR         Y02072 06332002
         USING FORCORE,RG               EST OPEN WA ADDR         Y02072 06334002
         LM    RPAR,RWTGC,DXCCW1        RESTORE REGISTERS 5-8    Y02072 06336002
*                                                                       06336402
         MODESET  EXTKEY=DATAMGT        SET DATA MGMT KEY        Y02072 06338002
*                                                                       06338402
         MVC   0(L'LOAD29,RWTGC),LOAD29 ID OF NEXT LOAD IGG01929 Y02072 06340002
         SPACE 3                                                        06420002
RELOOP   LA    RWTGC,8(RWTGC)           INCREMENT WTG CURRENT ENTRY     06440000
         LA    RPARC,4(RPARC)           INCREMENT DCB CURRENT ENTRY     06460000
         CLC   0(2,RWTGC),THISLOAD                                      06480000
         BCR   8,RBASE                  BRANCH = BEGINNING OF THIS MOD  06500000
         CLC   0(2,RWTGC),OPNLOD7       TEST FOR END OF WTG TABLE       06520000
         BNE   RELOOP                   BRANCH NOT =, NOT AT END        06540000
ATEND    LR    RPARC,RPAR               INITIALIZE RPARC                06560000
         LA    RWTGC,32(RWTG)           INITIALIZE RWTGC                06580000
ZCHECK   CLI   0(RWTGC),X'00'           TEST FOR ENTRY = 0              06600000
         BNE   TCTLRTN                  BRANCH = NOT ZERO               06620000
ITSZERO  LA    RWTGC,8(RWTGC)                                           06640000
         LA    RPARC,4(RPARC)                                           06660000
         B     ZCHECK                                                   06680000
TCTLRTN  MVC   6(2,RWTG),0(RWTGC)       MOVE ID                         06700000
         LA    RJ,DXCCW12                                               06740000
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) XCTL TO NEXT LOAD  Y02072 06760002
         EJECT                                                          06761021
         DROP  RG                       END OPEN WA ADDR         Y02072 06761402
         DROP  RTIOT                                             S21045 06762021
         USING FORCORE,RPAR             EST OPEN WA ADDR         Y02072 06762402
*                                                                       06762802
LOADRTN  EQU   *                        *                        S21045 06763002
*                                                                       06763402
*   SUBROUTINE TO LOAD A MODULE AND PUT ITS ID IN THE DEB.              06764021
*         REG 0 PTS TO NAME OF MODULE.                                  06765021
*                                                                       06765402
         LOAD  EPLOC=DXCCW6,DCB=(RTIOT)    LOAD MODULE           Y02072 06766002
         L     RB,DXCCW5                PTR TO DEB NAME SECTION  Y02072 06767002
         MVC   0(K2,RB),DXCCW6+ID       MOVE IN ID               Y02072 06768002
         LA    RB,K2(RB)                PT TO NEXT SPOT          S21045 06769021
         ST    RB,DXCCW5                SAVE PTR                 Y02072 06770002
         BR    RA                       RETURN                   S21045 06771021
         SPACE 2                                                        06793302
*        CONSTANTS                                                      06800000
SIS4CN16 DC    F'16'                                                    06820000
SIS4CN22 DC    F'56'                    LENGTH OF A CP22                06840000
*                                                                       07040000
* SCAN MODE MODULES                                                     07080000
*                                                                       07100000
IGG019H  DC    CL7'IGG019H'             READ APPEND. AND APPEND. CTL    07180002
         DC    C'G'                     IGG019HG                        07230002
OPNLOD7  DC    C'0S'                                                    07440000
THISLOAD DC    C'28'                                                    07460000
         SPACE 3                                                        07480000
*  TTR TABLE                                                            07500000
LOAD29   DC    C'29'                    ID OF MODULE IGG01929    Y02072 07550002
*                                                                       07600002
PATCH    DC    XL50'00'                 ZEROED PATCH AREA        Y02072 07650002
SCANCPS  DSECT                                                          07664020
         IGGCP22                                                        07666020
         IGGCP25                                                        07668020
         IGGCP23                                                        07670020
         IGGCP26                                                        07672020
*                                                                       07674020
         EJECT                                                          07676020
FORCORE  DSECT                                                          07680000
         IECDSECT                                                       07700000
         EJECT                                                          07720000
SISDEB   IGGDEBD                                                        07728020
DEBMODID EQU   DEBUCBAD                 RELATIVE LOCATION OF     A35340 07736020
*                                       *    SUBROUTINE NAME            07744020
*                                       *    LIST LESS EXTENTS          07752020
         EJECT                                                          08480000
SISWORK1 IGGSCAN                                                        08500020
         EJECT                                                          08700021
FAKEHL   DSECT                                                          08900021
*   PSUEDO CP MODULE IGG019HL.                                          09100021
         DS    5F                                                S21045 09300021
C22      DS    0D                       CP 22                    S21045 09500021
         ORG   *+CP22LEN                                         S21045 09700021
C24      DS    0D                       CP 24                    S21045 09900021
         ORG   *+CP24LEN                                         S21045 10100021
C23      DS    0D                       CP 23                    S21045 10300021
         ORG   *+CP23LEN                                         S21045 10500021
C26      DS    0D                       CP 26                    S21045 10700021
         ORG   *+CP26LEN                                         S21045 10900021
C25      DS    0D                       CP 25                    S21045 11100021
*                                                                       11300021
HALF236  EQU   (CP23LEN+CP26LEN)/2      HALF MOVE FOR CP         S21045 11500021
*                                       SKELETON                 S21045 11700021
         EJECT                                                          11900000
         DCBD  DSORG=IS                                                 11920000
         SPACE 4                                                        11940002
         CVT   DSECT=YES                                        YM01159 11980002
         END                                                            12000000
