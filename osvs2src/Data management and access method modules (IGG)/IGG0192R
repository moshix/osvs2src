         TITLE 'IGG0192R - OPEN, QISAM LOAD MODE,SET UP CP 18,NO WC'    00020000
IGG0192R CSECT                                                          00021002
*                                                                       00022002
*********************************************************************** 00023002
*                                                                     * 00024002
* MODULE-NAME = IGG0192R                                              * 00025002
*                                                                     * 00026002
* DESCRIPTIVE-NAME = ISAM OPEN, LOAD MODE WITHOUT WRITE CHECK         * 00027002
*                                                                     * 00028002
* COPYRIGHT = NONE                                                    * 00029002
*                                                                     * 00030002
* STATUS = RELEASE OS/VS2-02, LEVEL 01                                * 00031002
*                                                                     * 00032002
* FUNCTION = LOAD PUT, APPENDAGE, AND CHANNEL PROGRAM MODULES WHEN NO * 00033002
*            WRITE CHECK IS SPECIFIED.  FOR FIXED LENGTH RECORDS      * 00040002
*            (FLR) LOAD IGG019GA, IGG019GC, AND IGG019GE.  FOR VLR,   * 00040202
*            LOAD IGG019IA, IGG019GC, AND IGG019IE.  FOR FLR WITH     * 00041002
*            FULL TRACK INDEX WRITE (FTIW), LOAD IGG019I1 INSTEAD OF  * 00041202
*            IGG019GA.  ALSO GETMAIN FOR CHANNEL PROGRAMS AND         * 00041402
*            INITIALIZE CP18.                                         * 00041602
*                                                                     * 00042002
* NOTES = FOR FTIW, THE LENGTH OF CP20 IS LEFT IN THE CALCULATION FOR * 00043002
*         THE CHANNEL PROGRAM GETMAIN TO ALLOW ENOUGH SPACE FOR CP91  * 00043202
*         TO OVERLAY CP19.                                            * 00043402
*                                                                     * 00044002
*    DEPENDENCIES = NONE                                              * 00045002
*                                                                     * 00046002
*    RESTRICTIONS = NONE                                              * 00047002
*                                                                     * 00048002
*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                     * 00049002
*                                                                     * 00050002
*    PATCH-LABEL = PATCH, A DC STATEMENT.                             * 00051002
*                                                                     * 00052002
* MODULE-TYPE = OPEN EXECUTOR                                         * 00053002
*                                                                     * 00054002
*    PROCESSOR = ASSEMXF-370R                                         * 00055002
*                                                                     * 00056002
*    MODULE-SIZE = 868 DECIMAL BYTES                                  * 00057002
*                                                                     * 00058002
*    ATTRIBUTES = PRIVILEGED, REENTRANT                               * 00059002
*                                                                     * 00060002
* ENTRY-POINT = IGG0192R                                              * 00061002
*                                                                     * 00062002
*    PURPOSE = SEE FUNCTION                                           * 00063002
*                                                                     * 00064002
*    LINKAGE = RECEIVES CONTROL FROM ISAM OPEN EXECUTOR IGG0195U IF   * 00065002
*              FTIW SPECIFIED; OTHERWISE FROM IGG0192G IF INITIAL     * 00066002
*              LOAD, OR IGG0195D IF RESUME LOAD WITH HIGH-LEVEL       * 00067002
*              INDICES, OR IGG0196G IF RESUME LOAD WITHOUT HIGH-LEVEL * 00067102
*              INDICES.  RECEIVES CONTROL IN STORAGE PROTECT KEY 5    * 00067402
*              AND PRIVILEGED STATE                                   * 00067702
*                                                                     * 00068002
* INPUT = REGISTERS ESTABLISHED UPON ENTRY ARE                        * 00069002
*         REG 5 (RPAR) POINTS TO THE DCB COPY PARAMETER LIST          * 00070002
*         REG 6 (RWTG) POINTS TO THE O/C/EOV WHERE-TO-GO TABLE        * 00071002
*         REG 7 (RPARC) POINTS TO THE CURRENT ENTRY IN THE DCB COPY   * 00072002
*               PARAMETER LIST                                        * 00073002
*         REG 8 (RWTGC) POINTS TO THE CURRENT ENTRY IN THE WTG TABLE  * 00074002
*                                                                     * 00075002
* OUTPUT = REGISTERS 5 THROUGH 8 WILL BE IN THE SAME CONDITION AS     * 00076002
*          UPON ENTRY TO THIS MODULE                                  * 00077002
*                                                                     * 00078002
* EXIT-NORMAL = XCTL TO ISAM OPEN EXECUTOR IGG0192S IN STORAGE        * 00079002
*               PROTECT KEY 5.                                        * 00079202
*                                                                     * 00080002
* EXIT-ERROR = NONE                                                   * 00081002
*                                                                     * 00086002
* EXTERNAL-REFERENCES = SEE BELOW                                     * 00087002
*                                                                     * 00088002
*    ROUTINES = NONE                                                  * 00089002
*                                                                     * 00091002
*    DATA-AREAS = AREAS REFERENCED ARE:                               * 00092002
*                 FORCORE - OPEN WORK AREA                            * 00093002
*                 ISLCOMON - ISAM LOAD MODE WORK AREA                 * 00094002
*                                                                     * 00095002
*    CONTROL-BLOCKS = DCB COPY, DEB, IOB, AND CVT                     * 00096002
*                                                                     * 00097002
* TABLES = NONE                                                       * 00098002
*                                                                     * 00099002
* MACROS = MODESET, LOAD, GETMAIN, AND XCTL                           * 00100002
*                                                                     * 00101002
* CHANGE-ACTIVITY = AS FOLLOWS:                                       * 00102002
*                                                                     * 00103002
*          RELEASE OS/VS2-02 DELETIONS                                * 00153002
*                                                               YM01159 00203002
*                                                                     * 01041002
*********************************************************************** 01042002
         EJECT                                                          01043002
********************                                                    01044002
* DCB REFERENCE    *                                                    01060000
********************                                                    01080000
         DCBD  DSORG=(IS)                                               01100000
         USING IHADCB,R1                                                01120000
         EJECT                                                          01140000
********************                                                    01160000
* DEB REFERENCE    *                                                    01180000
********************                                                    01200000
*                                                                       01220000
IHADEB   IGGDEBD                                                        01230020
         USING IHADEB,R8                                         S20201 01240020
         EJECT                                                          01940000
ISLCOMON IGGLOAD                                                        02030020
         USING ISLCOMON,R12                                      S20201 02120020
         EJECT                                                          03020020
*                                                                       03110020
* * * * * * * * * *  LOAD CHANNEL PROGRAM SOURCE SKELETON * * * * * * * 03120020
LOADCPS  DSECT                                                          03130020
         IGGLDCP                                                        03140020
         SPACE 4                                                        03150002
*                                                                       03160020
*   MASK USED TO DESCRIBE RELATIVE LOCATIONS OF THE CHANNEL PRORAMS.    03170020
CPSTO    DSECT                                                          03180020
CPS1     DS    D                        1ST CCW                  S20201 03190020
CPS2     DS    D                        2ND CCW                  S20201 03200020
CPS3     DS    D                        3RD CCW                  S20201 03210020
CPS4     DS    D                        4TH CCW                  S20201 03220020
CPS5     DS    D                        5TH CCW                  S20201 03230020
*                                                                       03240020
         EJECT                                                          03250020
*                                                                       03260020
* IOBBCT REFERENCE         C(ISLVPTRS+8)=A(IOBBCT)                      03320000
*                                                                       03340000
IOBBCT   DSECT                                                          03360000
         USING IOBBCT,R11                                               03380000
         DS    0D                                                       03400000
IOBFLAGS DS    0CL1                     FLAGS                           03420000
IOBPTRA  DS    A                        PTR A                           03440000
IOBB     DS    0CL1                     B                               03460000
IOBPTRB  DS    A                        PTR B                           03480000
IOBS     DS    0CL1                     S - STATUS FIELD FOR BUF NO 1   03500000
IOBABUF  DS    A                        A(BUF NO 1) - ADR OF BUF NO 1   03520000
         SPACE 4                                                        03540002
********************                                                    03560000
* IOB REFERENCE    *                                                    03580000
********************                                                    03600000
*                                                                       03620000
IHAIOB   DSECT                                                          03640000
         USING IHAIOB,R2                                                03660000
         DS    0D                                                       03680000
IOBFLG1  DS    CL1                      FLAGS 1                         03700000
IOBFLG2  DS    CL1                      FLAGS 2                         03720000
         DS    CL1                                                      03740000
AIOBSENS DS    CL1                      SENSE                           03760000
IOBECBAD DS    A                        ECB POINTER                     03780000
AIOBCSW  DS    CL8                      CHANNEL STATUS WORD             03800000
AIOBSIOC DS    0CL1                     SIO CC                          03820000
IOBCPSAD DS    A                        CHANNEL PROGRAM START ADR       03840000
IOBWT    DS    0CL1                     WEIGHT                          03860000
IOBDCBAD DS    A                        DCB POINTER                     03880000
IOBCPRAD DS    A                        CHANNEL PROGRAM RESTART ADR     03900000
IOBBCTI  DS    CL2                      BLK CTR INCR                    03920000
IOBECT   DS    CL2                      ERROR CTR                       03940000
IOBDADAD DS    CL8                      DIR ACESS DEV ADR MBBCCHHR      03960000
*                                                                       03980000
         EJECT                                                          04000000
****************************                                            04012000
* OPEN WORK AREA REFERENCE *                                            04014000
****************************                                            04016000
FORCORE  DSECT                          OPEN/CLOSE/EOV WORK AREA Y01021 04018000
         IECDSECT                                                Y01021 04018400
         EJECT                                                          04018800
CVTAREA  DSECT                                                          04020000
         CVT                                                            04040000
         USING CVTAREA,R9                                               04060000
         EJECT                                                          04080000
**********************************************************************  04100000
* ISL PUT OPEN #2                                                     * 04120000
**********************************************************************  04140000
*                                                                       04160000
*                                                                       04180000
IGG0192R CSECT                                                          04200000
TSTF800  BALR  R15,0                                                    04220000
         USING *,R15                                                    04240000
BASETAG  L     R1,0(RPARC)                                              04260000
         L     RCORE,4(RWTGC)                                           04280000
         L     R12,DCBWKPT1                                             04300000
         LR    RBASE,R15                                                04320000
         USING FORCORE,RCORE                                     Y02072 04330002
         STM   R0,R15,DXCCW1            SAVE REGISTERS           Y02072 04340002
         L     R8,DCBDEBAD               DEB ADDRESSABILITY      S21045 04372000
         SPACE 2                                                        04374002
         MODESET  KEYADDR=DXUKEY,WORKREG=11  SET USERS KEY       Y02072 04382002
         SPACE 2                                                        04392002
         L     R11,ISLVPTR3             BUFFER CONTROL TABLE            04400000
*                                                                       04420000
* EQUATE SYMBOLIC REGISTERS                                             04440000
*                                                                       04460000
R0       EQU   0                                                        04480000
R1       EQU   1                                                        04500000
R2       EQU   2                                                        04520000
R3       EQU   3                                                        04540000
R4       EQU   4                                                        04560000
R5       EQU   5                                                        04580000
R6       EQU   6                                                        04600000
R7       EQU   7                                                        04620000
R8       EQU   8                                                        04640000
R9       EQU   9                                                        04660000
R10      EQU   10                                                       04680000
R11      EQU   11                                                       04700000
R12      EQU   12                                                       04720000
R13      EQU   13                                                       04740000
R14      EQU   14                                                       04760000
R15      EQU   15                                                       04780000
RBASE    EQU   3                                                        04800000
RCORE    EQU   4                                                        04820000
RPAR     EQU   5                                                        04840000
RWTG     EQU   6                                                        04860000
RPARC    EQU   7                                                        04880000
RWTGC    EQU   8                                                        04900000
RJ       EQU   15                                                       05000000
*                                                                       05040000
L32      EQU   32                       LENGTH                   S20201 05041020
K7       EQU   7                        CONSTANT                 S20201 05042020
BLKED    EQU   X'10'                    DATA SET BLOCKED         S20201 05043020
K0       EQU   0                        CONSTANT                 S20201 05044020
K8       EQU   8                        CONSTANT                 S20201 05045020
K16      EQU   16                       CONSTANT                 S20201 05046020
K40      EQU   40                       CONSTANT                 S20201 05047020
K35      EQU   35                       CONSTANT                 S20201 05048020
K6       EQU   6                        CONSTANT                 S20201 05049020
K4       EQU   4                        CONSTANT                 S20201 05050020
K24      EQU   24                       CONSTANT                 S20201 05051020
L24      EQU   24                       LENGTH                   S20201 05052020
L1       EQU   1                        CONSTANT                 S20201 05053020
L2       EQU   2                        CONSTANT                 S20201 05054020
VIRTUAL  EQU   X'80'                    VIRTUAL=VIRTUAL                 05056401
CEDISP   EQU   4                        CE DISPLACEMENT                 05058201
AEDISP   EQU   12                       AE DISPLACEMENT                 05058801
ID       EQU   6                        DISPLACEMENT TO MODULE ID       05059401
         EJECT                                                          05060000
*                                                                       05080000
         DROP RCORE                     END OPEN WA USING        Y02072 05090002
         LR    R13,RCORE                ADDR OF OPEN WORK AREA   Y02072 05092002
         USING FORCORE,R13              OPEN WA ADDRESSABILITY   Y02072 05094002
*                                                                       05096002
TSTHSK   LA    R2,ISLIOBA               C(R2)=A(IOBA)                   05100000
*                                                                       05120000
* LOAD PUT, APP, AND CP MODULES  (NO WR CHK)                            05140000
*                                                                       05160000
         L     R9,CVTPTR                CVT ADDRESS             YM01159 05180002
         L     R9,CVTLINK               LINKLIB DCB ADDRESS     YM01159 05200002
*                                       FOR LOAD                YM01159 05202002
         DROP  R9                       END CVT ADDRESSABILITY  YM01159 05212002
         LR    R3,R15                   SAVE R15, BASE                  05220000
         LR    R4,R1                    SAVE R1                         05240000
         USING IHADCB,R4                ADDRESSABILITY ON DCB           05241001
         DROP  R1                       *                               05242001
         USING BASETAG,R3               ADDRESSABILITY                  05243001
         DROP  R15                      *                               05244001
         LA    R7,CPVLR-CP              ASSUME VLR                      05246000
         TM    DCBRECFM,X'80'           VLR?                      VLR   05248000
         BNO   LOADPUT                  NO - VLR CORRECT                05250000
         SR    R7,R7                    ASSUME FIXED - NOT FTIW         05250500
         TM    ISLVPTRA,X'C0'           FTIW-SUCCESSFUL GETMAIN  O19110 05250800
         BNO   LOADPUT                  NO - VLR CORRECT                05251200
         LA    R7,CPFTIW-CP             IT IS FIXED - FTIW              05261600
LOADPUT  EQU   *                        LOAD PROCESSING TIME MODULE     05271600
         LH    R5,PROC(R7)              LAST TWO BYTES OF NAME          05273600
         STH   R5,ISLVPTR5              SAVE ID FOR DEB                 05275600
*                                                                       05275702
*   SAVE MACRO TIME MODULE ID FOR DEB.                                  05276001
*                                                                       05276102
         MODESET  EXTKEY=DATAMGT        SET DATA MGMT KEY        Y02072 05276402
         SPACE 1                                                        05276802
         BAL   R10,LOAD                 LOAD PROCESSING MODULE          05277600
         SPACE 2                                                        05278001
         IC    R5,DCBPUT                SAVE O FLAGS                    05280001
         ST    R0,DCBPUT                ADDRESS OF PUT MODULE           05290001
         STC   R5,DCBPUT                RESTORE O FLAGS                 05300001
*                                                                       05300402
*   SAVE PROCESSING MODULE ADDRESS FOR CLOSE - IGG0202I.                05302000
*                                                                       05304002
         L     R5,DEBEXPTR              ADDRESSABILITY DEB EXTENSION    05310000
         USING DEBEXT,R5                *                               05312000
         ST    R0,DEBPUT                SAVE PUT MODULE ADDRESS         05314000
         DROP  R5                                                       05316000
*                                                                       05318002
*   LOAD CHANNEL END AND ABNORMAL END APPENDAGE MODULE - IGG019GC.      05326002
*                                                                       05328002
         LH    R5,APP                   LAST TWO BYTES OF NAME          05336000
         BAL   R10,LOAD                 LOAD APPENDAGE MODULE           05338000
         ST    R0,DCBWKPT5              ADDRESS OF APPENDAGE            05340001
         SPACE 3                                                        05359001
*   LOAD CHANNEL PROGRAM MODULE.                                        05370000
*                                                                       05372002
         LH    R5,CP(R7)                LAST TWO BYTES OF NAME.         05380000
LOAD     EQU   *                        LOAD ANY MODULE                 05390000
         STH   R5,ID(RWTG)              FINISH MODULE NAME              05392000
         LOAD  EPLOC=(RWTG),DCB=(R9)    LOAD CPS                        05396000
*                                                                       05396402
*   SUBROUTINE RETURNS TO LAST BAL OR BALR ISSUED ON R10, THIS          05398000
*   INCLUDES THE BALR INSTRUCTION THAT FOLLOWS.                         05398400
*                                                                       05398502
         BALR  R10,R10                  RETURN TO LOAD NEXT             05398800
*                                                                       05399200
         L     R10,DCBWKPT6             ADDRESSABILITY ISLVPTRS         05399600
         SPACE 1                                                        05404702
         MODESET  KEYADDR=DXUKEY,WORKREG=1   SET USERS KEY       Y02072 05409802
         SPACE 1                                                        05411802
         ST    R0,CL1AD                 PTR TO CP MODULE                05414902
         LR    R15,R3                   RESTORE BASE                    05420000
         LR    R1,R4                    RESTORE R1                      05440000
         USING BASETAG,R15              REVERSE ADDRESSABILITY          05444001
         DROP  R3                       *                               05448001
         USING IHADCB,R1                ADDRESSABILITY ON DCB           05452001
         DROP  R4                       *                               05456001
         L     R6,CL1AD                 C(R6)=ADDR CP18 SKLTN    S20201 05610020
         LA    R6,CP18LEN(R6)           ADD SIZE OF CP18         S20201 05616020
*                                        VLR                     S20201 05622020
         ST    R6,CM1AD                 STORE ADDR CP19 SKLTN    S20201 05628020
*                                        VLR                     S20201 05634020
         LA    R6,CP19LEN(R6)           ADD SIZE OF CP19         S20201 05639020
*                                        VLR                     S20201 05644020
         ST    R6,CQ1AD                 STORE ADDR CP20 SKLTN    S20201 05649020
*                                        VLR                     S20201 05654020
         LA    R6,CP20LEN(R6)           ADD SIZE OF CP20         S20201 05662020
*                                        VLR                     S20201 05670020
         ST    R6,CQ40AD                STORE ADDR CP21 SKLTN           05800000
*                                                                       05820000
* SET UP APPENDAGE VECTOR TABLE IN 5 WORDS ON TOP DEB                   05840000
*                                                                       05860000
         L     R7,DEBAPPAD              C(R7)=A(VECTOR)                 05900000
         USING DEBAVT,R7                ADDRESSABILITY ON AVT           05920001
         L     R3,DCBWKPT5              APPENDAGE ADDRESS               05928001
         SPACE 2                                                        05928402
         MODESET  EXTKEY=DATAMGT        SET DATA MGMT KEY        Y02072 05930002
         SPACE 2                                                        05932002
         ST    R3,DEBEOEA               END OF EXTENT PTR               05936001
         LA    R3,0(R3)                 *                               05952001
         TM    DEBSIOA,VIRTUAL          VIRTUAL = REAL                  05960001
         BO    TSTHSIO                  NO - DON'T OVERLAY SIO PTR      05968001
         ST    R3,DEBSIOA               YES - OVERLAY SIO               05976001
TSTHSIO  EQU   *                        *                               05984001
         LR    R4,R3                    PCI ADDRESS                     06000001
         LA    R5,CEDISP(R3)            CE ADDRESS                      06008001
         LA    R6,AEDISP(R3)            AE ADDRESS                      06016001
         STM   R4,R6,DEBPCIA            STORE APPENDAGE ADDRESS         06032001
         DROP  R7                                                       06072001
*                                                                       06080000
* STORE PUT AND APPENDAGE MODULE IDS BEYOND LAST EXTENT IN DEB          06100000
*                                                                       06120000
         SR    R4,R4                                                    06140000
         IC    R4,DEBNMEXT              NUMBER OF EXTENTS        S20201 06150020
*                                       *  ISAM DEPENDANT SECTION       06160020
         SLL   R4,4                     C(R4)=NO. OF EXTENTS X 16       06280000
         LA    R5,LOADEXT               GET DEB EXTENSION LENGTH S21045 06288021
         STC   R5,DEBAMLNG              DEB EXTENSION=ACS METH   S21045 06296021
*                                       SECTION                  S21045 06304021
         AR    R4,R5                    ADD EXTENSION LENGTH     S21045 06312021
         LA    R5,DEBNIEE(R4)           PT TO ID LIST                   06320001
*   MOVE SAVED ID INTO DEB.                                             06326001
*                                                                       06336002
         MODESET  KEYADDR=DXUKEY,WORKREG=3  SET USER'S KEY       Y02072 06340602
*                                                                       06342602
         LH    R3,ISLVPTR5              PROCESSING MODULE ID     Y02072 06344602
*                                                                       06345002
         MODESET  EXTKEY=DATAMGT        SET DATA MGT KEY         Y02072 06345102
*                                                                       06345202
         STH   R3,0(,R5)                STORE ID IN DEB         Y02072  06345302
         MVC   L2(L'APP,R5),APP         MOVE IN APP ID                  06345402
         SPACE 1                                                        06350001
*                                                                       06360000
*                                                                       06380000
* CALCULATE AMT OF STORAGE NEEDED FOR CHANNEL PROGRAMS (NO WR CHK)      06400000
*                                                                       06420000
         LA    R3,K8                    BASIC CP LENGTH FOR EACH S20201 06430020
*                                       *  BUFFER                       06440020
         TM    DCBRECFM,BLKED           TEST FOR BLOCKED (BIT-3) S20201 06450020
         BC    1,TSTHK081               B IF BLOCKED             S20201 06457020
*                                       *****                    S20201 06464020
         NC    DCBRKP,DCBRKP            DOES RKP = 0             S20201 06471020
         BZ    TSTHK082                 YES - USE BASIC LENGTH   S20201 06480020
*                                       NO - EXTEND BASIC LENGTH        06489020
TSTHK081 LA    R3,K16(R3)               INCREASE LENGTH          S20201 06499020
TSTHK082 SR    R4,R4                                                    06600000
         SPACE 1                                                        06602002
         MODESET  KEYADDR=DXUKEY,WORKREG=5   SET USERS KEY       Y02072 06610002
         SPACE 1                                                        06612002
         SR    R5,R5                                                    06620000
         IC    R5,ISLBUFNO              C(R4+R5) = BUFNO                06640000
         MR    R4,R3                    C(R5) = ZXBUFNO                 06660000
         LA    R5,K40(R5)               C(R5) = 32+(ZXBUFNO)     S20201 06680020
         LR    R3,R5                    C(R3) = SIZE OF CP18            06700000
*                                                                * CP19 06720000
         SR    R4,R4                                             ****** 06740000
         CLI   DCBHIRSH,X'00'           TEST HIRSH VS 0          S20201 06760020
         BNE   TSTHK083                 B NOT 0 = SHARED                06780000
         TM    DCBOPTCD,X'08'           TEST OPTCD BIT 4, CYL OVFL      06800000
         BC    8,TSTHK084               B NOT ON = NO CP19 NEEDED       06820000
*                                                                       06822002
*   ADD LENGTH OF CP 18 AND CP19                                        06830020
*                                                                       06832002
TSTHK083 LA    R5,CP19LEN(R5)                                    S20201 06837020
         LA    R4,CP19LEN(R4)           C(R4)=SIZE CP19          S20201 06844020
*                                       O1911                    S20201 06851020
*                                                                       06858020
*   ADD LENGTH OF CP20 AND CP21                                         06865020
*                                                                       06872020
TSTHK084 LA    R5,CP20LEN+CP21LEN(R5)                            S20201 06882020
*                                                                       07000000
* GET MAIN FOR CHANNEL PROGRAMS                                         07020000
*                                                                       07040000
         ST    R5,32(R10)               STORE SIZE OF CPS FOR DELETE    07060000
         LA    R0,250                   SUBPOOL NO. 250                 07080000
         SLL   R0,24                    C(R0) = P000, P = SUBPOOL NO.   07100000
         OR    R0,R5                    C(R0) = PNNN, NNN = POOL SIZE   07120000
         LR    R6,R1                    SAVE R1                         07140000
         LR    R7,R15                   SAVE R15, BASE                  07160000
*                                                                       07180000
         GETMAIN R,LV=(0)                                               07200000
*                                                                       07220000
         LR    R15,R7                   RESTORE R15                     07240000
         LR    R7,R1                    C(R7)=A(SUBPOOL)                07260000
         LR    R1,R6                    RESTORE R1                      07280000
         LR    R6,R7                    SAVE DESTINATION         S20201 07285020
         LA    R7,K8(R7)                ALLOW FOR RPS            S20201 07290020
*                                       INSTRUCTION              S20201 07295020
*                                                                       07300000
*                                                                       07320000
* SET UP ISLVPTRS FOR CHANNEL PROGRAM ADDRESSES                         07340000
*                                                                       07360000
         ST    R7,12(R10)               A(CP18)                         07380000
         AR    R7,R3                    ADD SIZE OF CP18                07400000
         ST    R7,16(R10)               A(CP19)                         07420000
         AR    R7,R4                    ADD SIZE OF CP19 (MAY BE 0)     07440000
         TM    36(R10),X'C0'            FTIW-SUCCESSFUL GETMAIN  O19110 07445019
         BO    SKPCP20                  BR-DO NOT STORE CP20     O19110 07450019
*                                       ADDR                     O19110 07455019
         ST    R7,20(R10)               A(CP20)                         07460000
SKPCP20  EQU   *                                                 O19110 07470019
         LA    R7,CP20LEN(R7)           ADD SIZE OF CP20         S20201 07480020
         ST    R7,24(R10)               A(CP21)                         07500000
*                                                                       07520000
         EJECT                                                          07540000
*                                                                       07560000
* INITIALIZE CP18                                                       07580000
*                                                                       07600000
         LR    R10,R6                   NEXT DESTINATION         S20201 07610020
         USING CPSTO,R10                                         S20201 07620020
         L     R9,CL1AD                 C(R9)=A(CP18 SKLTN, CL1)        07640000
         USING LOADCPS,R9                                        S20201 07650020
         SR    R3,R3                                                    07660000
         IC    R3,ISLBUFNO              C(R3)=NO OF BUFFRS              07680000
         MVC   CPSTO(L32),0(R9)         MOVE CLO,CL1,CL2,CL3     S20201 07690020
* * CL0 INITIALIZATION                                                  07700020
         LA    R4,ISLRPSSS              SET SECTOR               S20201 07710020
         O     R4,CL0                   *                        S20201 07720020
         ST    R4,CPS1                  *                        S20201 07730020
* * CL1 INITIALIZATION                                                  07740020
         LA    R4,K35(R2)               SEARCH ID EQUAL          S20201 07750020
         O     R4,CL1                   *  I0B+35                S20201 07760020
         ST    R4,CPS2                  *                        S20201 07770020
* * CL2 INITIALIZATION                                                  07780020
         LA    R4,CPS2                  TIC TO CL1               S20201 07790020
         O     R4,CL2                   *                        S20201 07800020
         ST    R4,CPS3                  *                        S20201 07810020
* * CL3 INITIALIZATION                                                  07820020
         LA    R4,CPS5                  TIC TO CL4               S20201 07830020
         ST    R4,CPS4                  *                        S20201 07840020
         MVI   CPS4,TIC                 *                        S20201 07850020
         LA    R10,CPS5                 C(R10)=A(DEST CL4)       S20201 07940020
*                                                                       08040000
         SR    R8,R8                    CLEAR REGISTER 8         O19110 08050019
         SPACE 1                                                        08052001
         MVI   ISLOFFST+3,24            THREE CCWS PER BUFFER    M0170  08053021
         L     R7,0(R11)                1ST AVAILABLE BUFFER            08054001
         MVI   ISLD+3,44                D = 44                   M0170  08056021
         LA    R7,0(R7)                 CLEAR HIGH BYTE                 08056101
         TM    DCBRECFM,X'10'           TEST RECFM BIT 3 FOR BLOCKED    08060000
         BC    1,TSTHK15                B IF 1 = BLOCKED                08080000
*                                                                       08100000
*                                       UNBLOCKED                       08120000
         MODESET  EXTKEY=DATAMGT        SET DATA MGMT KEY        Y02072 08122002
         SPACE 1                                                        08124002
         NC    DCBRKP,DCBRKP            TEST RKP VS 0            S20201 08130020
         SPACE 1                                                        08130402
         MODESET  KEYADDR=DXUKEY,WORKREG=4   SET USERS KEY       Y02072 08132002
         SPACE 1                                                        08134002
         BNZ   TSTHK20                  BR IF RKP NOT 0          S20201 08140020
*                                       O1911                    S20201 08150020
*                                       UNBLOCKED, RKP = 0              08200000
         MVI   ISLOFFST+3,8             IF RECFM=F, RKP=0 ONE    M0170  08206021
         MVI   ISLD+3,28                CCW PER BUFFER           M0170  08212021
         OI    0(R11),X'01'             SET FLAGS BIT 7 = 1 IN BCT      08220000
         IC    R8,DCBKEYLE              C(R8)=KEYLE, 000N = IL          08300000
         AH    R8,DCBLRECL              C(R8)=AL+IL              O19110 08320019
         LA    R8,K8(R8)                C(R8)=AL+IL+8, 00NN      S20201 08330020
*                                                                       08440000
TSTHK09  MVC   CPS1,CL4                 MOVE CL4                 S20201 08450020
         STH   R8,CPS1+K6               LEN FOR WRITE            S20201 08460020
         L     R4,0(R7)                 C(R4)=C(SLOT S)=A(BUF B)        08480000
         LA    R4,0(R4)                                                 08500000
         O     R4,CL4                   *COMBINE OP CODE         S20201 08506020
*                                        1333                    S20201 08512020
         ST    R4,CPS1                  STORE COUNT ADR IN CL4   S20201 08522020
         LA    R10,CPS2                 C(R10)=A(NEXT DEST)      S20201 08552020
         LA    R7,K4(R7)                C(R7)=A(NEXT SLOT)       S20201 08582020
         BCT   R3,TSTHK09               LOOP                            08620000
*                                                                       08640000
         B     TSTHK30                  B TO MOVE CL5                   08660000
*                                                                       08680000
*                                                                       08760000
TSTHK15  EQU   *                                                 O19110 08790019
         LH    R8,DCBBLKSI              C(R8)=BLKSI              O19110 08820019
         SH    R8,DCBLRECL              C(R8)=BLKSI-LRECL        O19110 08850019
*                                                                       08880000
*                                       COMMON RT FOR CL6, CL7, +CL8    08900000
TSTHK20   EQU  *                                                 O19110 08920019
         AH    R8,DCBRKP                C(R8)=REL KEY ADR        O19110 08940019
*                                                                       09060000
TSTHK26  MVC   CPS1(L24),CL6            MOVE CL6, CL7, CL8       S20201 09070020
         MVC   CPS2+K7(L1),DCBKEYLE     LEN FOR WR KEY           S20201 09080020
         MVC   CPS3+K6(L2),DCBBLKSI     LEN FOR WR DATA          S20201 09090020
         L     R4,0(R7)                 C(R4)=C(SLOT S)=A(BUFF B)       09100000
* * CL6 INITIALIZATION                                                  09110020
         IC    R5,CL6                   WRITE COUNT              S20201 09113020
         ST    R4,CPS1                                           S20201 09116020
         STC   R5,CPS1                                           S20201 09119020
* * CL7 INITIALIZATION                                                  09122020
         LA    R4,K8(R4)                PT TO DATA               S20201 09125020
         ST    R4,CPS3                                           S20201 09128020
* * CL8 INITIALIZATION                                                  09131020
         AR    R4,R8                    PT TO HIGH KEY IN BLOCK  S20201 09134020
         ST    R4,CPS2                  WRITE KEY                S20201 09137020
         LA    R10,CPS4                 C(R10)=A(NEXT DEST       S20201 09217020
         LA    R7,K4(R7)                C(R7)=A(NEXT SLOT)       S20201 09267020
         BCT   R3,TSTHK26               LOOP                            09320000
*                                                                       09340000
*                                       MOVE CL5                        09360000
TSTHK30  EQU   *                        FINALE                   S20201 09380020
         MVC   CPS1,K24(R6)             MOVE SAVED TIC ADDRESS   S20201 09400020
*                                                                       09420000
         EJECT                                                          09440000
*                                                                       09460000
* EXIT ********** EXIT ***************** EXIT *********** EXIT ******** 09480000
*                                                                       09500000
         LM    R0,R15,DXCCW1            RESTORE REGISTERS        Y02072 09520002
         DROP  R13                      END WA USING             Y02072 09530002
         SPACE 1                                                        09530402
         MODESET  EXTKEY=DATAMGT        SET DATA MGMT KEY        Y02072 09532002
         SPACE 1                                                        09534002
         USING BASETAG,RBASE                                            09540000
         USING FORCORE,RCORE            ADDRESSABILITY OPEN WORKAREA    09550000
         MVC   0(L'LOAD2S,RWTGC),LOAD2S ID OF MODULE IGG0192S    Y02072 09560002
RELOOP   LA    RWTGC,8(RWTGC)           INCREMENT WTG CURNT ENTRY       09580000
         LA    RPARC,4(RPARC)           INCREMENT DCB CURNT ENTRY       09600000
         CLC   0(2,RWTGC),THISLOAD                                      09620000
         BCR   8,RBASE                  BRANCH=BEGINNING OF THIS MODULE 09640000
         CLC   0(2,RWTGC),OPNLOD7       TEST FOR END OF WTG TABLE       09660000
         BC    7,RELOOP                 BRANCH=NOT AT END               09680000
ATEND    LR    RPARC,RPAR               INITIALIZE RPARC                09700000
         LA    RWTGC,32(RWTG)           INITIALIZE RWTGC                09720000
ZCHECK   CLI   0(RWTGC),X'00'           TEST FOR ENTRY = 0              09740000
         BC    7,TCTLRTN                BRANCH = NOT ZERO               09760000
ITSZERO  LA    RWTGC,8(RWTGC)                                           09780000
         LA    RPARC,4(RPARC)                                           09800000
         B     ZCHECK                                                   09820000
TCTLRTN  EQU   *                                                        09840000
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID                         09860000
         LA    RJ,DXCCW12               PARAMETER LIST                  09900000
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) XCTL TO NEXT LOAD  Y02072 09920002
*                                                                       09940000
*   LAST TWO BYTES OF MODULE NAMES - USED TO CONSTRUCT NAMES.           10010000
         SPACE 5                                                        10030000
*   CHANNEL END AND ABNORMAL END APPENDAGE MODULE.                      10034400
APP      DC    C'GC'                    IGG019GC - LOAD APPENDAGE       10068202
*   CHANNEL PROGRAM MODULES.                                            10078200
CP       DC    C'GE'                    IGG019GE - FIXED NON FTIW       10088202
CPVLR    DC    C'IE'                    IGG019IE - VLR                  10098202
CPFTIW   DC    C'GE'                    IGG019GE - FIXED FTIW           10100202
*   PROCESSING MODULES( MACRO TIME ).                                   10100600
PROC     DC    C'GA'                    IGG019GA - FIXED NON FTIW       10101002
         DC    C'IA'                    IGG019IA - VLR                  10101402
         DC    C'I1'                    IGG019I1 - FIXED FTIW           10101502
         DS    F                        ALIGNMENT                       10111700
THISLOAD DC    C'2R'                                                    10360000
OPNLOD7  DC    C'0S'                                                    10380000
LOAD2S   DC    C'2S'                    ID OF MODULE IGG0192S    Y02072 10430002
*                                                                       10480002
PATCH    DC    XL50'00'                 ZEROED PATCH AREA        Y02072 10530002
         END                                                            10540000
