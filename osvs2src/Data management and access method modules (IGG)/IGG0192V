        TITLE 'IGG0192V - OPEN,QISAM LOAD MODE,SET UP CP20,21,W/WC'     00100000
IGG0192V CSECT                                                          00101002
*                                                                       00102002
*********************************************************************** 00103002
*                                                                     * 00104002
* MODULE-NAME = IGG0192V                                              * 00105002
*                                                                     * 00106002
* DESCRIPTIVE-NAME = ISAM OPEN, LOAD MODE WITH WRITE CHECK            * 00107002
*                                                                     * 00108002
* COPYRIGHT = NONE                                                    * 00109002
*                                                                     * 00110002
* STATUS = RELEASE OS/VS2-02, LEVEL 0                                 * 00111002
*                                                                     * 00112002
* FUNCTION = WHEN WRITE CHECK IS SPECIFIED, INITIALIZE CP20 AND CP21. * 00113002
*            IF FULL TRACK INDEX WRITE (FTIW) IS SPECIFIED,           * 00114002
*            INITIALIZE CP21 ONLY.  DELETE CHANNEL PROGRAM MODULE     * 00114202
*            IGG019GF FOR FIXED LENGTH RECORDS (FLR), OR IGG019IF FOR * 00115002
*            VLR.                                                     * 00116002
*                                                                     * 00122002
* NOTES = SEE BELOW                                                   * 00123002
*                                                                     * 00124002
*    DEPENDENCIES = NONE                                              * 00125002
*                                                                     * 00126002
*    RESTRICTIONS = NONE                                              * 00127002
*                                                                     * 00128002
*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                     * 00129002
*                                                                     * 00130002
*    PATCH-LABEL = PATCH, A DC STATEMENT.                             * 00131002
*                                                                     * 00132002
* MODULE-TYPE = OPEN EXECUTOR                                         * 00133002
*                                                                     * 00134002
*    PROCESSOR = ASSEMXF-370R                                         * 00135002
*                                                                     * 00136002
*    MODULE-SIZE = 1032 DECIMAL BYTES                                 * 00137002
*                                                                     * 00138002
*    ATTRIBUTES = PRIVILEGED, REENTRANT                               * 00139002
*                                                                     * 00140002
* ENTRY-POINT = IGG0192V                                              * 00141002
*                                                                     * 00142002
*    PURPOSE = SEE FUNCTION                                           * 00143002
*                                                                     * 00144002
*    LINKAGE = RECEIVES CONTROL FROM ISAM OPEN EXECUTOR IGG0192S WHEN * 00145002
*              WRITE CHECK IS SPECIFIED.  RECEIVES CONTROL IN STORAGE * 00146002
*              PROTECT KEY 5 AND PRIVILEGED STATE.                    * 00147002
*                                                                     * 00148002
* INPUT = REGISTERS ESTABLISHED UPON ENTRY ARE                        * 00149002
*         REG 5 (RPAR) POINTS TO THE DCB COPY PARAMETER LIST          * 00150002
*         REG 6 (RWTG) POINTS TO THE O/C/EOV WHERE-TO-GO TABLE        * 00151002
*         REG 7 (RPARC) POINTS TO THE CURRENT ENTRY IN THE DCB COPY   * 00152002
*               PARAMETER LIST                                        * 00153002
*         REG 8 (RWTGC) POINTS TO THE CURRENT ENTRY IN THE WTG TABLE  * 00154002
*                                                                     * 00155002
* OUTPUT = REGISTERS 5 THROUGH 8 WILL BE IN THE SAME CONDITION AS     * 00156002
*          UPON ENTRY TO THIS MODULE                                  * 00157002
*                                                                     * 00158002
* EXIT-NORMAL = XCTL TO COMMON OPEN EXECUTOR IGG0190S IN STORAGE      * 00159002
*               PROTECT KEY 5.  THIS CONCLUDES ISAM OPEN OPERATION.   * 00159202
*                                                                     * 00160002
* EXIT-ERROR = NONE                                                   * 00161002
*                                                                     * 00166002
* EXTERNAL-REFERENCES = SEE BELOW                                     * 00167002
*                                                                     * 00168002
*    ROUTINES = NONE                                                  * 00169002
*                                                                     * 00171002
*    DATA-AREAS = AREAS REFERENCED ARE:                               * 00172002
*                 FORCORE - OPEN WORK AREA                            * 00173002
*                 ISLCOMON - ISAM LOAD MODE WORK AREA                 * 00174002
*                                                                     * 00175002
*    CONTROL-BLOCKS = DCB COPY, DEB AND IOB.                          * 00176002
*                                                                     * 00177002
* TABLES = NONE                                                       * 00178002
*                                                                     * 00179002
* MACROS = MODESET, DELETE, AND XCTL.                                 * 00180002
*                                                                     * 00181002
* CHANGE-ACTIVITY = AS FOLLOWS:                                       * 00182002
*                                                                     * 00183002
*                                                                     * 06201002
*********************************************************************** 06202002
         EJECT                                                          06203002
********************                                                    06204002
* DCB REFERENCE    *                                                    06300020
********************                                                    06400020
         DCBD  DSORG=(IS)                                               06500020
         USING IHADCB,R1                                                06600020
         EJECT                                                          06700020
********************                                                    06800020
* DEB REFERENCE    *                                                    06900020
********************                                                    07000020
*                                                                       07100020
IHADEB   DSECT                                                          07200020
         USING IHADEB,R8                                                07300020
         DS    0D                                                       07400020
DEBNMSUB DS    0CL1                                                     07500020
DEBTCBAD DS    A                                                        07600020
DEBAMLNG DS    0CL1                                                     07700020
DEBDEBAD DS    A                                                        07800020
DEBOFLGS DS    0CL1                                                     07900020
DEBIRBAD DS    A                                                        08000020
DEBOPATB DS    0CL1                                                     08100020
DEBSYSPG DS    A                                                        08200020
DEBNMEXT DS    0CL1                                                     08300020
DEBUSRPG DS    A                                                        08400020
DEBPRIOR DS    0CL1                                                     08500020
DEBECBAD DS    A                                                        08600020
DEBPROTG DS    0BL1                                                     08700020
DEBDEBID DS    0BL1                                                     08800020
DEBDCBAD DS    A                                                        08900020
DEBEXSCL DS    0CL1                                                     09000020
DEBAPPAD DS    A                                                        09100020
DEBNIEE  DS    0CL1                                                     09200020
DEBFIEAD DS    A                                                        09300020
DEBNPEE  DS    0CL1                                                     09400020
DEBFPEAD DS    A                                                        09500020
DEBNOEE  DS    0CL1                                                     09600020
DEBFOEAD DS    A                                                        09700020
         DS    CL4                                                      09800020
DEBDVMOD DS    0CL1                                                     09900020
DEBUCBAD DS    A                                                        10000020
DEBBINUM DS    CL2                                                      10100020
DEBSTRCC DS    CL2                                                      10200020
DEBSTRHH DS    CL2                                                      10300020
DEBENDCC DS    CL2                                                      10400020
DEBENDHH DS    CL2                                                      10500020
DEBNMTRK DS    CL2                                                      10600020
         EJECT                                                          10700020
ISLCOMON IGGLOAD                                                        10800020
         USING ISLCOMON,R12                                      S20201 10900020
*                                                                       11900020
* IOBBCT REFERENCE         C(ISLVPTRS+8)=A(IOBBCT)                      12000020
*                                                                       12100020
IOBBCT   DSECT                                                          12200020
         USING IOBBCT,R11                                               12300020
         DS    0D                                                       12400020
IOBFLAGS DS    0CL1                     FLAGS                           12500020
IOBPTRA  DS    A                        PTR A                           12600020
IOBB     DS    0CL1                     B                               12700020
IOBPTRB  DS    A                        PTR B                           12800020
IOBS     DS    0CL1                     S - STATUS FIELD FOR BUF NO 1   12900020
IOBABUF  DS    A                        A(BUF NO 1) - ADR OF BUF NO 1   13000020
         EJECT                                                          13100020
LOADCPS  DSECT                                                          15500020
         IGGLDCP OPTCD=W,RECFM=V                                 S20201 15600020
         EJECT                                                          15700020
FORCORE  DSECT                                                   Y02072 15750002
         IECDSECT                                                Y02072 15760002
         EJECT                                                          15770002
**********************************************************************  15800020
* ISL PUT OPEN #4                                                       15900020
**********************************************************************  16000020
*                                                                       16100020
*                                                                       16200020
IGG0192V CSECT                                                          16300020
TSTF800  BALR  R15,0                                                    16400020
         USING *,R15                                                    16500020
BASETAG  L     R1,0(RPARC)                                              16600020
         L     RCORE,4(RWTGC)                                           16700020
         L     R12,DCBWKPT1                                             16800020
         LR    RBASE,R15                                                16900020
         USING FORCORE,RCORE            OPEN WA ADDR             Y02072 16950002
         STM   R0,R15,DXCCW1            SAVE REGISTERS           Y02072 17000002
         SPACE 2                                                        17010002
         MODESET  KEYADDR=DXUKEY,WORKREG=11  SET USERS KEY       Y02072 17050002
         SPACE 2                                                        17060002
         L     R10,DCBWKPT6                                             17100020
         L     R11,8(R10)                                               17200020
         LR    RD,RCORE                 SAVE OPEN WA ADDR        Y02072 17250002
         DROP  RCORE                    DROP OPEN WA ADDR        Y02072 17260002
*                                                                       17300020
* EQUATE SYMBOLIC REGISTERS                                             17400020
*                                                                       17500020
R0       EQU   0                                                        17600020
R1       EQU   1                                                        17700020
R2       EQU   2                                                        17800020
R3       EQU   3                                                        17900020
R4       EQU   4                                                        18000020
R5       EQU   5                                                        18100020
R6       EQU   6                                                        18200020
R7       EQU   7                                                        18300020
R8       EQU   8                                                        18400020
R9       EQU   9                                                        18500020
R10      EQU   10                                                       18600020
R11      EQU   11                                                       18700020
R12      EQU   12                                                       18800020
R13      EQU   13                                                       18900020
R14      EQU   14                                                       19000020
R15      EQU   15                                                       19100020
RBASE    EQU   3                                                        19200020
RCORE    EQU   4                                                        19300020
RPAR     EQU   5                                                        19400020
RWTG     EQU   6                                                        19500020
RPARC    EQU   7                                                        19600020
RWTGC    EQU   8                                                        19700020
RD       EQU   14                                                       20100020
RJ       EQU   15                                                       20200020
K4       EQU   4                        CONSTANT                 S20201 20400020
BOBSW    EQU   X'08'                                             A34959 20500020
RESLD    EQU   X'20'                                             A34959 20600020
REMCAP   EQU   66                                                A34959 20700020
*                                                                       20800020
K100     EQU   100                      CONSTANT                 S20201 20900020
L100     EQU   K100                     LENGTH                   S20201 21000020
K0       EQU   0                        CONSTANT                 S20201 21100020
K1       EQU   1                        CONSTANT                 S20201 21200020
K2       EQU   2                        CONSTANT                 S20201 21300020
L2       EQU   2                        CONSTANT                 S20201 21400020
K3       EQU   3                        CONSTANT                 S20201 21500020
L3       EQU   3                        LENGTH                   S20201 21600020
K5       EQU   5                        CONSTANT                 S20201 21700020
K6       EQU   6                        CONSTANT                 S20201 21800020
K7       EQU   7                        CONSTANT                 S20201 21900020
K10      EQU   10                       CONSTANT                 S20201 22000020
K18      EQU   18                       CONSTANT                 S20201 22100020
K35      EQU   35                       CONSTANT                 S20201 22200020
         EJECT                                                          22300020
*                                                                       22400020
* SKIP CP20 INITIALIZATION IF FULL TRACK INDEX WRITE.                   22500020
*                                                                       22600020
TSTHSK   XC    TSTWK1C(8),TSTWK1C       CLEAR WORK FIELDS        O19110 22700020
         TM    36(R10),X'C0'            FTIW-SUCCESSFUL GETMAIN  O19110 22800020
         BNO   INITCP20                 NO - INIT CP20           O19110 22900020
         L     R3,12(R10)               C(R3)=A(CP18)            O19110 23000020
         TM    DCBOPTCD,X'80'           WRITE CHECK              O19110 23100020
         BO    CP20C                    YES                      O19110 23200020
         L     R4,20(R10)               C(R4)=A(CP20A)           O19110 23300020
         LTR   R4,R4                    IS THERE A CP20A         O19110 23400020
         BE    CP20B                    NO - CHECK FOR CP20B     O19110 23500020
         L     R4,12(R4)                C(R4)=A(TIC TO CP18)     O19110 23600020
         ST    R3,0(R4)                 A(CP18) STORED IN TIC    O19110 23700020
         MVI   0(R4),X'08'              RESTORE COMMAND CODE     O19110 23800020
CP20B    L     R4,40(R10)               C(R4)=A(CP20B)           O19110 23900020
         LTR   R4,R4                    IS THERE A CP20B         O19110 24000020
         BE    INITCP21                 NO - INITIALIZE CP21     O19110 24100020
         B     STORETIC                 STORE TIC TO CP18        O19110 24200020
CP20C    EQU   *                                                 O19110 24300020
         L     R4,44(R10)               C(R4)=A(CP20C)           O19110 24400020
STORETIC EQU   *                                                 O19110 24500020
         L     R4,12(R4)                C(R4)=A(TIC TO CP18)     O19110 24600020
         ST    R3,0(R4)                 A(CP18) STORED IN TIC    O19110 24700020
         MVI   0(R4),X'08'              RESTORE COMMAND CODE     O19110 24800020
         B     INITCP21                 BR TO INITIALIZE CP21    O19110 24900020
*                                                                       25000020
* INITIALIZE CP20                                                       25100020
*                                                                       25200020
INITCP20 EQU   *                                                 O19110 25300020
         LA    R2,ISLIOBA               C(R2)=A(IOBA)            O19110 25400020
         L     R9,0(R10)                C(R9)=A(AREA Y)                 25500020
         L     R8,CQ1AD                 C(R8)=A(CP20 SKLTN, CQ1)        25600020
         L     R10,20(R10)              C(R10)=A(CP20 DEST, CQ1)        25700020
         SH    R10,TST8                 ALLOW FOR CQ0            S20201 25800020
         USING CQ0,R10                                           S20201 25900020
         MVC   CQ0(L100),0(R8)          MOVE CP20                S20201 26000020
         MVC   CQ0+K100(CP20LEN-L100),K100(R8) *  SKELETON       S20201 26100020
*                                                                       26200020
         L     R6,CQT1AD                C(R6)=A(CP20 WR CK SKLTN, CQT1) 26300020
         MVC   CQT0(CP20WRCK),0(R6)     MOVE CP20 WR CHK FROM    S20201 26700020
*                                       SKLTN                    S20201 26800020
         TM    DCBRECFM,X'80'           IS IT VLR                 VLR   26900020
         BZ    TSTHSKV                  YES, BRANCH               VLR   27000020
*                                                                       27100020
         LA    R4,ISLRPSSS+K2           SECTOR ADDR FOR CP20     A53207 27150100
         BAL   R3,TSTIOB                INITIALIZE CQ1 & CQ2     O19110 27200020
         LA    R4,26(R9)                CQ4                             27300020
         ST    R4,CQ4                   STORE ADR Y+26           S20201 27400020
*                                                                       27500020
         LA    R4,36(R9)                CQ5                             27600020
         O     R4,CQ5                   CQ5                      S20201 27700020
         ST    R4,CQ5                                            S20201 27800020
         LA    R4,CQ5                   CQ6                      S20201 27900020
         O     R4,CQ6                                            S20201 28000020
         ST    R4,CQ6                        STORE ADR CQ5       S20201 28100020
         LA    R4,44(R9)                CQ8                             28200020
         ST    R4,CQ8                        STORE ADR Y+44      S20201 28300020
*                                                                       28400020
         LA    R4,54(R9)                CQ10                            28500020
         O     R4,CQ10                                           S20201 28600020
         ST    R4,CQ10                                           S20201 28700020
         LA    R4,CQ10                  CQ11                     S20201 28800020
         O     R4,CQ11                                           S20201 28900020
         ST    R4,CQ11                                           S20201 29000020
         LA    R4,62(R9)                CQ12                            29100020
         O     R4,CQ12                                           S20201 29200020
         ST    R4,CQ12                                           S20201 29300020
*                                                                       29400020
*   PUT KEYLENGTH BASED CONSTANTS INTO THE CHANNEL PROGRAMS             29500020
*                                                                       29600020
         SR    R4,R4                                             S20201 29700020
         IC    R4,DCBKEYLE              COUNT = KEY LENGTH       S20201 29800020
         STC   R4,CQ3+K7                CQ3                      S20201 29900020
         STC   R4,CQ7+K7                CQ7                      S20201 30000020
         LA    R4,K10(R4)               COUNT = KEY LENGTH + 10  S20201 30100020
         STH   R4,CQ12+K6               CQ12                     S20201 30200020
*                                                                       30300020
         LA    R4,ISLRPSSS+K2           CQ0                      S20201 30400020
TSTCQ13  EQU   *                                                  VLR   30500020
         O     R4,CQ0                        SET SECTOR          S20201 30600020
         ST    R4,CQ0                                            S20201 30700020
         LA    R4,ISLRPSSS+K2           CQ14B,CQT0               S20201 30800020
         O     R4,CQ14B                      SET SECTOR          S20201 30900020
         ST    R4,CQ14B                                          S20201 31000020
         ST    R4,CQT0                                           S20201 31100020
         LA    R4,33(R2)                CQ13                            31200020
         O     R4,CQ13                                           S20201 31300020
         ST    R4,CQ13                                           S20201 31400020
         IC    R5,CQ14                  CQ14                     S20201 31500020
         LA    R4,CQT1                  TIC TO CQT1              S20201 31600020
         ST    R4,CQ14                  *                        S20201 31700020
         STC   R5,CQ14                                           S20201 31800020
*                                                                       31900020
         LA    R4,35(R2)                CQ15                            32000020
         O     R4,CQ15                                           S20201 32100020
         ST    R4,CQ15                       STORE ADR IOBA+35   S20201 32200020
         LA    R4,CQ15                  CQ16                     S20201 32300020
         O     R4,CQ16                                           S20201 32400020
         ST    R4,CQ16                       STORE ADR CQ15      S20201 32500020
         LA    R4,18(R9)                CQ17                            32600020
         O     R4,CQ17                                           S20201 32700020
         ST    R4,CQ17                       STORE ADR Y+18      S20201 32800020
         LA    R4,26(R9)                CQ19                            32900020
         ST    R4,CQ19                       STORE ADR Y+26      S20201 33000020
         LA    R4,36(R9)               CQ21                             33100020
         O     R4,CQ21                                           S20201 33200020
         ST    R4,CQ21                       STORE ADR Y+36      S20201 33300020
         LA    R4,44(R9)                CQ23                            33400020
         ST    R4,CQ23                       STORE ADR Y+44      S20201 33500020
*                                                                       33600020
         LA    R4,54(R9)                CQ25                            33700020
         O     R4,CQ25                                           S20201 33800020
         ST    R4,CQ25                       STORE ADR Y+54      S20201 33900020
         SR    R4,R4                                             S20201 34000020
         IC    R4,DCBKEYLE              COUNT=KEYLENGTH          S20201 34100020
         STC   R4,CQ18+K7               CQ18                     S20201 34200020
         STC   R4,CQ22+K7               CQ22                     S20201 34300020
         LA    R4,K18(R4)               COUNT=KEYLENGTH+18       S20201 34400020
         STH   R4,CQ25+K6               CQ25                     S20201 34500020
         LA    R4,CQ13                  CQ26                     S20201 34600020
         O     R4,CQ26                                           S20201 34700020
         ST    R4,CQ26                       STORE ADR CQ13      S20201 34800020
         LA    R4,CQ30+K3               CQ27                     S20201 34900020
         O     R4,CQ27                                           S20201 35000020
         ST    R4,CQ27                       STORE ADR CQ30+1    S20201 35100020
         LA    R4,CQ27                  CQ28                     S20201 35200020
         O     R4,CQ28                                           S20201 35300020
         ST    R4,CQ28                       STORE ADR CQ27      S20201 35400020
*                                                                       35500020
         LA    R3,TSTFIX3                                        O19110 35600020
         LA    R4,Y18(R9)               CQT1-SRCH ID Y+18        A37537 35670020
         LA    R7,CQT1                  INITIALIZE CQT1 AND CQT2 A37537 35740020
         USING CQT1,R7                  ADDRESSABILITY           A37537 35810020
*                                                                       35900020
*              FOR CP21 - THE ADDRESS OF IOBB+35 WILL BE STORED         36000020
*              IN CQ45, AND THE ADDRESS OF CQ45 WILL BE STORED          36100020
*              IN CQ46.                                                 36200020
*                                                                       36300020
TSTWRCHK EQU   *                                                 O19110 36400020
         O     R4,CQT1                                           S20201 36600020
         ST    R4,CQT1                       STORE ADR IOBA+35   S20201 36700020
*                                        VLR                     S20201 36800020
*                                                                       36900020
TSTFIX1  LA    R4,CQT1                  CQT2                     S20201 37000020
*                                        VLR                     S20201 37100020
         O     R4,CQT2                                           S20201 37200020
         ST    R4,CQT2                       STORE ADR CQT1      S20201 37300020
         SR    R4,R4                    COUNT =                  S20201 37400020
         IC    R4,DCBKEYLE              * KEYLENGTH              S20201 37500020
         BR    R3                       RETURN TO INIT CQ47 FOR  O19110 37600020
         DROP  R7                       *                        A37537 37650020
*                                       CP21 OR CONTINUE W/ CP20        37700020
TSTFIX3  EQU   *                                                 O19110 37800020
         LA    R4,10(R4)                KEYLENGTH + 10           A37537 38000020
         STH   R4,CQT3+K6               COUNT = KEYLEN+10        A37537 38200020
         STH   R4,CQT5+K6               COUNT = KEYLEN+10        S20201 38400020
         STH   R4,CQT6+K6               COUNT = KEYLEN+10        S20201 38500020
*                                                                       38600020
*   CQT5A = TIC TO CQT7 IF INACTIVE ENTRY NOT WRITTEN.                  38620020
*         = NOP IF INACTIVE ENTRY WRITTEN                               38640020
*                                                                       38650002
         LA    R4,CQT7                  *                        A37537 38660020
         ST    R4,CQT5A+4               SAVE TIC ADDRESS         M5864  38670020
         LA    R4,CQT5B                 *                        M5864  38680020
         ST    R4,CQT4A+4               SAVE TIC ADDRESS         M5864  38690020
         LA    R4,CQ14A+K1              CQT7                     S20201 38700020
         O     R4,CQT7                                           S20201 38800020
         ST    R4,CQT7                       STORE ADR CQ14A+1   S20201 38900020
*                                                                       39000020
         LR    R4,R10                                             VLR   39100020
         AH    R4,TST8                  PT TO SCH ID CP20        S20201 39200020
         TM    DCBRECFM,X'80'           IS IT VLR                 VLR   39300020
         BZ    TSTCQT8V                 YES, BRANCH               VLR   39400020
         L     R4,DCBWKPT6              CQT8                            39500020
         L     R4,12(R4)                                                39600020
TSTCQT8V EQU   *                                                  VLR   39700020
         O     R4,CQT8                                           S20201 39800020
         ST    R4,CQT8                       STORE ADR CL1       S20201 39900020
*                                                                       40000020
*   CQT4 + SRCH ID AREA Y + 36, CQT4A = TIC TO CQT4.                    40007020
*                                                                       40009002
         LA    R4,Y36(R9)               *                        A37537 40014020
         LA    R7,CQT4                  *                        A37537 40021020
         BAL   R3,TSTWRCHK              *                        A37537 40028020
*                                                                       40030002
*   CQT5B = SRCH ID AREA Y +54, CQT5C = TIC TO CQT5B.                   40035020
*                                                                       40037002
         LA    R4,Y54(R9)               *                        A37537 40042020
         LA    R7,CQT5B                 *                        A37537 40049020
         BAL   R3,TSTWRCHK              *                        A37537 40056020
*                                                                       40063020
Y18      EQU   18                       AREA Y - NORMAL ENTRY    A37537 40070020
Y36      EQU   36                       AREA Y - OVERFLOW ENTRY  A37537 40077020
Y54      EQU   54                       AREA Y - INACTIVE ENTRY  A37537 40084020
*                                                                       40091020
         EJECT                                                          40100020
*                                                                       40200020
* INITIALIZE CP21                                                       40300020
*                                                                       40400020
INITCP21 EQU   *                                                 O19110 40500020
         LA    R2,ISLIOBB               C(R2)=A(IOBB)            O19110 40600002
         L     R10,DCBWKPT6             C(R10)=A(VPTRS)                 40700020
         L     R9,0(R10)                C(R9)=A(AREA Y)                 40800020
         L     R8,CQ40AD                C(R8)=A(CP21 SKLTN, CQ40)       40900020
         L     R10,24(R10)              C(R10)=A(CP21 DEST, CQ40)       41000020
         USING CQ39A,R10                                         S20201 41100020
         USING DXIOB,R2                 IOB B ADDRESSABILITY     Y02072 41150002
         IC    R5,IOBSIOCC              SAVE SIOCC                      41200020
         ST    R10,IOBSIOCC             STORE A(CP21) IN IOBB    Y02072 41300002
         STC   R5,IOBSIOCC              RESTORE SIOCC                   41400020
         DROP  R2                       END USING ON IOBB        Y02072 41450002
         SH    R10,TST8                 PT TO START OF MODULE    S20201 41500020
         MVC   CQ39A(CP21LEN),0(R8)     MOVE CP21 FROM SKLTN     S20201 41600020
*                                                                       41700020
         L     R6,CQ45AD                C(R6)=A(CP21 WR CK SKLTN, CQ45) 41800020
         MVC   CQ44A(CP21WRCK),0(R6)    MOVE CP21 WR CHK FROM    S20201 42200020
*                                       SKLTN                    S20201 42300020
*                                                                       42400020
         LA    R3,TSTCQ42                                        O19110 42500020
         LA    R4,ISLRPSSS+K3           SECTOR ADDR FOR CP21     A53207 42550100
*                                                                       42600020
*              FOR CP20 - STORE THE ADDRESS OF IOBA+35 IN CQ1           42700020
*                         AND STORE AND ADDRESS OF CQ1 IN CQ2           42800020
*                                                                       42900020
TSTIOB   EQU   *                                                 O19110 43000020
         O     R4,CQ39A                                          S20201 43200020
         ST    R4,CQ39A                      STORE SECTOR        S20201 43300020
*                                       ADDRESS                  S20201 43400020
         LA    R4,K35(R2)               CQ40                     S20201 43500020
         O     R4,CQ40                                           S20201 43600020
         ST    R4,CQ40                  STORE IOB + 30 ADDRESS   S20201 43700020
         LA    R4,CQ40                  CQ41                     S20201 43800020
         O     R4,CQ41                                           S20201 43900020
         ST    R4,CQ41                       STORE ADR CQ40      S20201 44000020
         BR    R3                       RETURN TO INIT CQ3 FOR   O19110 44100020
*                                       CP20 OR CONTINUE W/ CP21        44200020
TSTCQ42  EQU   *                                                 O19110 44300020
         MVC   CQ44A+K1(L3),CQ39A+K1    SET UP CQ44A ADDRESS     S20201 44400020
         LA    R4,0(R9)                 CQ42                     S20201 44500020
         O     R4,CQ42                                           S20201 44600020
         ST    R4,CQ42                       STORE ADR Y         S20201 44700020
         LA    R4,8(R9)                 CQ44                            44800020
         ST    R4,CQ44                       STORE ADR Y+8       S20201 44900020
*                                                                       45000020
         EJECT                                                          45020020
*   CQ45 = SRCH ID IOBB+35,CQ46 = TIC TO CQ45.                          45040020
*                                                                       45050002
         LA    R7,CQ45                  *                        A37537 45060020
         LA    R4,35(R2)                *                        A37537 45080020
         BAL   R3,TSTWRCHK              BR TO INIT CQ45 & 46     O19110 45100020
*                                       COUNT = KEYLENGTH               45200020
         STC   R4,CQ43+K7               *  CQ43                  S20201 45300020
         LA    R4,K18(R4)               COUNT = KEYLENGTH + 180  S20201 45400020
         STH   R4,CQ47+K6              *  CQ47                   S20201 45500020
*                                                                       45600020
         EJECT                                                          45700020
*                                                                       45800020
* EXIT ********** EXIT ***************** EXIT *********** EXIT ******** 45900020
*                                                                       46000020
         MODESET  EXTKEY=DATAMGT        SET DATA MGT KEY         Y02072 46050002
         SPACE 1                                                        46060002
         LA    R6,TSTMOD3               DELETE IGG019GF           VLR   46100020
         TM    DCBRECFM,X'80'           IS IT FIXED               VLR   46200020
         BO    TSTEXIT                  YES, BRANCH               VLR   46300020
         LA    R6,TSTMOD3V              DELETE IGG019IF           VLR   46400020
TSTEXIT  DELETE EPLOC=(R6)              DELETE CPS                VLR   46500020
         USING FORCORE,RD               OPEN WA ADDRESSABILITY   Y02072 46550002
         LM    R0,R15,DXCCW1            RESTORE REGISTERS        Y02072 46600002
*                                                                       46610002
         DROP  RD                       DROP OPEN WA ADDR        Y02072 46650002
         USING FORCORE,RCORE            EST OPEN WA ADDR         Y02072 46660002
         USING BASETAG,RBASE                                            46700020
*                                                                       46750002
         XC    0(5,RWTGC),0(RWTGC)      SET TO ZERO              O19110 46800020
RELOOP   LA    RWTGC,8(RWTGC)           INCREMENT WTG CURNT ENTRY       46900020
         LA    RPARC,4(RPARC)           INCREMENT DCB CURNT ENTRY       47000020
         CLC   0(2,RWTGC),THISLOAD                                      47100020
         BCR   8,RBASE                  BRANCH=BEGINNING OF THIS MODULE 47200020
         CLC   0(2,RWTGC),OPNLOD7       TEST FOR END OF WTG TABLE       47300020
         BC    7,RELOOP                 BRANCH=NOT AT END               47400020
ATEND    LR    RPARC,RPAR               INITIALIZE RPARC                47500020
         LA    RWTGC,32(RWTG)           INITIALIZE RWTGC                47600020
ZCHECK   CLI   0(RWTGC),X'00'           TEST FOR ENTRY = 0              47700020
         BC    7,TCTLRTN                BRANCH = NOT ZERO               47800020
ITSZERO  LA    RWTGC,8(RWTGC)                                           47900020
         LA    RPARC,4(RPARC)                                           48000020
         B     ZCHECK                                                   48100020
TCTLRTN  EQU   *                                                        48200020
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID                         48300020
         LA    RJ,DXCCW12               GET WA ADDR              Y02072 48500002
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) XCTL TO NEXT LOAD  Y02072 48600002
         EJECT                                                          48650002
* VLR INITIALIZATION OF CP20                                            48700020
*                                                                       48750002
         USING CQ0,R10                                           S20201 48800020
*                                                                       48850002
TSTHSKV  EQU   *                                                  VLR   48900020
         LA    R4,CQ0+K5                CQ0                      S20201 49000020
         O     R4,CQ0                                            S20201 49100020
         ST    R4,CQ0                   SET SECTOR TO 0          S20201 49200020
         LA    R4,CQ7                   CQ1                      S20201 49300020
         O     R4,CQ1                                            S20201 49400020
         ST    R4,CQ1                                            S20201 49500020
*                                        VLR                     S20201 49600020
         LA    R4,CQ1                   A(CQ1)                   S20201 49700020
         O     R4,CQ2                                            S20201 49900020
         ST    R4,CQ2                   CQ2                      S20201 50000020
*                                        VLR                     S20201 50100020
         LA    R4,CQ7                   A(CQ7)=YYR OF CAP REC    S20201 50200020
         O     R4,CQ3                   *                        S20201 50400020
         ST    R4,CQ3                   A(CQ7)                   S20201 50500020
         MVC   CQ5(L2),DCBLRECL         SET CP20 TO MAX LRECL    S20201 50600020
         TM    DCBST,RESLD              TEST FOR RESUME LOAD     A34959 50700020
         BNO   INITLOAD                 BR IF NOT                A34959 50800020
*                                                                       50850002
         TM    IOBFLAGS,BOBSW           IS BOB SW ON             A34959 50900020
         BO    INITLOAD                 BR IF ON, TRK CAP REQ'D  A34959 51000020
         MVC   REMCAP(2,R10),ISLWRSAV   REM CAP SAVED FROM 195G  A34959 51100020
         B     TSTCQ130                                          MXXXX  51200000
INITLOAD EQU   *                                                 A34959 51300020
         L     R4,DCBLRAN               LOAD DEV PTR TABLE ENTRY  VLR   51400020
         MVC   CQ9+K2(L2),K4(R4)        MOVE IN TRK CAP          S20201 51500020
TSTCQ130 EQU   *                                                 MXXXX  51550000
         LA    R4,CQ0+K5                CQ0 FOR SET SECTOR       S20201 51600020
         B     TSTCQ13                                            VLR   51700020
         SPACE 2                                                        51800002
         DS    0D                                                       51900020
TSTMOD3  DC    C'IGG019GF'              CPS                             52000020
TSTMOD3V DC    C'IGG019IF'                                        VLR   52100020
TST8     DC    H'8'                     LENGTH OF A CCW          S20201 52200020
*                                                                       52300020
THISLOAD DC    C'2V'                                                    52400020
*                                                                       52450002
OPNLOD7  DC    C'0S'                   ID OF MODULE IGG0190S     Y02072 52500002
*                                                                       52550002
PATCH    DC    XL50'00'                 ZEROED PATCH AREA        Y02072 52600002
         END                                                            53200020
