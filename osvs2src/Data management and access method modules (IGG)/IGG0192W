         TITLE 'OPEN EXECUTOR IGG0192W-VARIABLE FORM OF 2H'             00400018
IGG0192W CSECT                                                          00401002
*                                                                       00402002
*********************************************************************** 00403002
*                                                                     * 00404002
* MODULE-NAME = IGG0192W                                              * 00405002
*                                                                     * 00406002
* DESCRIPTIVE-NAME = ISAM OPEN, BISAM MODE-VLR                        * 00407002
*                                                                     * 00408002
* COPYRIGHT = NONE                                                    * 00409002
*                                                                     * 00410002
* STATUS = RELEASE OS/VS2-02, LEVEL 0                                 * 00411002
*                                                                     * 00412002
* FUNCTION = MERGE REQUIRED FIELDS FROM F2-DSCB INTO DCB.  DEVELOP    * 00413002
*            CODE FOR COMBINATION OF CHANNEL PROGRAMS TO USE.  CHECK  * 00414002
*            SIZE OF USER-SUPPLIED WORK AREA, IF ANY.  DETERMINE SIZE * 00415002
*            OF CORE FOR WORK AREAS AND CP'S; GET IT; ZERO IT; AND    * 00416002
*            INITIALIZE DCB WA.  SAVE POINTER TO WA IN DCBWKPT2, AND  * 00417002
*            CODE FOR CP COMBINATIONS IN DCBWKPT6.                    * 00418002
*                                                                     * 00422002
* NOTES = SEE BELOW                                                   * 00423002
*                                                                     * 00424002
*    DEPENDENCIES = NONE                                              * 00425002
*                                                                     * 00426002
*    RESTRICTIONS = NONE                                              * 00427002
*                                                                     * 00428002
*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                     * 00429002
*                                                                     * 00430002
*    PATCH-LABEL = PATCH, A DC STATEMENT.                             * 00431002
*                                                                     * 00432002
* MODULE-TYPE = OPEN EXECUTOR                                         * 00433002
*                                                                     * 00434002
*    PROCESSOR = ASSEMXF-370R                                         * 00435002
*                                                                     * 00436002
*    MODULE-SIZE = 1058 DECIMAL BYTES                                 * 00437002
*                                                                     * 00438002
*    ATTRIBUTES = PRIVILEGED, REENTRANT                               * 00439002
*                                                                     * 00440002
* ENTRY-POINT = IGG0192W                                              * 00441002
*                                                                     * 00442002
*    PURPOSE = SEE FUNCTION                                           * 00443002
*                                                                     * 00444002
*    LINKAGE = RECEIVES CONTROL FROM ISAM OPEN EXECUTOR IGG01950--FOR * 00445002
*              VLR ONLY--IN STORAGE PROTECT KEY 5 AND PRIVILEGED      * 00446002
*              STATE.                                                 * 00447002
*                                                                     * 00448002
* INPUT = REGISTERS ESTABLISHED UPON ENTRY ARE                        * 00449002
*         REG 5 (RPAR) POINTS TO THE DCB COPY PARAMETER LIST          * 00450002
*         REG 6 (RWTG) POINTS TO THE O/C/EOV WHERE-TO-GO TABLE        * 00451002
*         REG 7 (RPARC) POINTS TO THE CURRENT ENTRY IN THE DCB COPY   * 00452002
*               PARAMETER LIST                                        * 00453002
*         REG 8 (RWTGC) POINTS TO THE CURRENT ENTRY IN THE WTG TABLE  * 00454002
*                                                                     * 00455002
* OUTPUT = REGISTERS 5 THROUGH 8 WILL BE IN THE SAME CONDITION AS     * 00456002
*          UPON ENTRY TO THIS MODULE                                  * 00457002
*                                                                     * 00458002
* EXIT-NORMAL = XCTL TO ISAM OPEN EXECUTOR IGG0192P IF HIGH-LEVEL     * 00459002
*               INDEX SEARCHED IN CORE, OTHERWISE TO IGG0192I.        * 00459202
*                                                                     * 00460002
* EXIT-ERROR = ABEND CODES:                                           * 00461002
*              032 - NEITHER READ NOR WRITE SPECIFIED                 * 00462002
*              034 - AREA FOR INDEX IN CORE TOO SMALL                 * 00463002
*              035 - WKN WORK AREA TOO SMALL                          * 00464002
*                                                                     * 00466002
* EXTERNAL-REFERENCES = SEE BELOW                                     * 00467002
*                                                                     * 00468002
*    ROUTINES = NONE                                                  * 00469002
*                                                                     * 00471002
*    DATA-AREAS = AREAS REFERENCED ARE:                               * 00472002
*                 FORCORE - OPEN WORK AREA                            * 00473002
*                 IGGBISAM - BISAM WORK AREA                          * 00474002
*                 PSA - LOW CORE ADDRESSABILITY                       * 00474202
*                                                                     * 00475002
*    CONTROL-BLOCKS = DCB COPY, DSCB, DEB, UCB, AND CVT.              * 00476002
*                                                                     * 00477002
* TABLES = NONE                                                       * 00478002
*                                                                     * 00479002
* MACROS = MODESET, SETLOCK, GETMAIN, ABEND, AND XCTL.                * 00480002
*                                                                     * 00481002
* CHANGE-ACTIVITY = AS FOLLOWS:                                       * 00482002
*                                                                     * 00483002
*     VS2   RELEASE 3 CHANGES                                  @ZA15656 01483037
*C381000                                                       @ZA15656 02483037
*A393400,393520                                                @ZA15656 03483037
*                                                                     * 04801002
*********************************************************************** 04802002
         EJECT                                                          04803002
R0       EQU   00                                                       04804002
RE       EQU   00                       WORK REG                        05200018
RF       EQU   01                       WORK REG                        05400018
RDCB     EQU   02                       USER'S DCB                      05600018
RBASE    EQU   03                       BASE REG                        05800018
RCORE    EQU   04                       OPEN WORK AREA ADDR      Y02072 06000002
RPAR     EQU   05                  *    PARAMETER LIST ADDRESS          06200018
RWTG     EQU   06                  *    WHERE TO GO TABLE BIGINNING     06400018
RPARC    EQU   07                  *    CURRENT ENTRY,PARAMETER LIST    06600018
RWTGC    EQU   08                  *    CURRENT ENTRY, WTG TABLE        06800018
RG       EQU   09                       WORK REG                 Y02072 07000002
RDSCB    EQU   10                       DSCB BASE REG            Y02072 07200002
RA       EQU   11                       WORK REG                        07400018
RB       EQU   12                       WORK REG                        07600018
RC       EQU   13                       WORK REG                        07800018
RD       EQU   14                       WORK REG                        08000018
R15      EQU   15                       WORK REG                        08200018
*                                                                       08600002
*                   *     MEANS SET BEFORE ENTRY AND BEFORE EXIT        08800018
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        09000018
         USING *,RBASE                                                  09200018
         L     RDCB,0(RPARC)            RDCB=ADDR OF DCB                09400018
         USING IHADCB,RDCB                                              09600018
         L     RCORE,FOUR(,RWTGC)       GET OPEN WORK AREA ADDR  Y01021 09800000
         USING FORCORE,RCORE            RCORE = WORK AREA ADDR   Y01021 09850000
         L     RDSCB,DSCCORE            LOAD ADDRESS OF DSCB     Y02072 10000002
         USING IHADSCB,RDSCB            ADDRESSABILITY, FORMAT 2 Y02072 10052002
         MVC   DCBNREC,DSCBD16                                          13000018
         IC    RB,DCBST                 BITS 5,6,& 7 OF DCBST FROM D17  13200018
         SRL   RB,3                                                     13400018
         IC    RC,DSCBD17                                               13600018
         SLL   RC,29                                                    13800018
         SLDL  RB,3                                                     14000018
         STC   RB,DCBST                                                 14200018
         MVC   DCBLPDA,DSCBD21          * DSCBD21 DCBLETI.              15000000
         MVC   DCBLIOV,DSCBD25                                          15800018
         MVC   DCBNBOV,DSCBD26                                          16000018
         MVC   DCBRORG2,DSCBD27                                         16200018
         MVC   DCBNOREC,DSCBD28                                         16400018
*        MOVE FIELDS FROM DSCBK2, DSCBK3, DSCBK4, AND DSCBK5            16800001
*        TO DCBFTMI2, DCBLEMI2, DCBFTMI3 AND DCBLEMI3.                  16850001
         MVC   DCBFTMI2(TWENTY4),DSCBK2 *                               16900001
OPNO5B2  SR    RA,RA                    RA  CODE FOR COMBINATION OF     17600018
         TM    DCBMAC,X'02'            CHAN PROGS.  9 POSSIBLE          17800018
         BO    OPNO5B1                   COMBINATIONS DEPENDING ON      18000018
         TM    DCBMACRF,X'20'            1. WRITE KN, READ, OR BOTH     18200018
         BO    OPNO5B2A                 2.NLSD=0, =1, OR GR THAN 1      18400018
         TM    DCBMAC,X'04'             3.WRITECHECK OR NOT             18600018
         BZ    ABENDT32                 AND, IF WRITE KN                18800018
OPNO5B2A LA    RA,2(R0)                ADD 2 TO COUNT FOR RU + NO WKN   19000018
         B     OPNO5D31                                                 19200018
*                                                                       19400018
*              COMPUTATION OF PROPER SIZE FOR USER WORK AREA- WKN       19600018
*                                                                       19800018
OPNO5B1  EQU   *                                                 Y01021 19850002
         L     RB,DCBDEBAD              DEB ADDR FROM DCB COPY   Y02072 19900002
         L     RC,36(RB)               RC=DEBFPEAD                      20200018
         L     RB,0(RC)                RB=DEBUCBAD OF PRIME EXTENT      20400018
         SR    RC,RC                                                    20600018
         IC    RC,19(RB)               RC=19TH BYTE IN UCB              20800018
         N     RC,OPNOMASK             USE LOW 4 BITS                   21000018
         SR    RB,RB                                                    21200018
         L     RA,16                   RA=ADDR OF CVT                   21400018
         L     R15,64(RA)              15=ADDR OF I/O DEVICE TABLE      21600018
         IC    RB,0(RC,R15)            RB=OFFSET VALUE                  21800018
         LA    RC,0(R15,RB)            RC=DEVICE TABLE ENTRY ADDRESS    22000018
         SR    RB,RB                                                    22200018
         SR    R0,R0                                                    22400018
         LH    RF,4(RC)                RF=TRACK CAPACITY                22600018
         LH    RA,SIX(RC)               GET I/L IF ZEUS DEV      S20201 22620020
         TM    NINE(RC),EIGHT           IS THIS A ZEUS DEVICE    S20201 22640020
         BO    ZEUSDEV1                 YES, BR--LIDO IS HWORD   S20201 22660020
         SR    RA,RA                                             S20201 22680020
         IC    RA,SEVEN(RC)             RA=LIDO                  S20201 22700020
ZEUSDEV1 SR    RF,RA                    RF = CAP-LIDO            S20201 22720020
         IC    RB,DCBKEYLE                                              23400018
         AH    RB,DCBBLKSI             RB=KL+BLKSIZE                    23600018
         SR    RF,RB                   RF=CAP-L1DO-(KL+BLKSIZE)         23800018
         MH    RB,10(RC)               RB=TOL(KL+BLKSIZE)               24000018
         SRA   RB,9                                                     24200018
         TM    NINE(RC),EIGHT           IS THIS A ZEUS DEVICE    S20201 24260020
         BO    ZEUSDEV2                 YES, BR--RA IS I/L       S20201 24320020
         IC    RA,SIX(RC)               RA = NIDO                S20201 24410020
ZEUSDEV2 AR    RB,RA                   RB=TOL(KL+BLKSIZE)+N1DO   S20201 24500020
         DR    RE,RB                   R IN RE, Q IN RF                 24800018
         SR    RE,RA                   RE=REM-NIDO                      25000018
         SR    RA,RA                                             S20201 25100020
         IC    RA,DCBKEYLE                                              25200018
         SR    RE,RA                   RE=REM-NIDO-KL=AMT OF PARTIAL    25400018
         BNM   PRTLBLK                  BR IF PARTIAL BLK ROOM   S20201 25450020
         SR    RE,RE                    SET NO ROOM              S20201 25500020
PRTLBLK  EQU   *                        PARTIAL BLK QTY GOT      S20201 25550020
         LA    RF,1(RF)                                                 25600018
         MH    RF,DCBBLKSI             RF=AMT FOR FULL BLOCKS           25800018
         AR    RF,RE                   RF=AMT REQUIRED FOR BLOCKS       26000018
         LH    RE,DCBSMSW              RE=SMSW                          26200018
         LTR   RE,RE                    IS VALUE ZERO                   26250018
         BNZ   OPNO5B5                  NO, BRANCH               A27818 26270019
         ST    RE,DCBMSWA               ZERO FLD FOR SWITCH USE  A27818 26290019
OPNO5B5  EQU   *                                                 A27818 26310019
         N     RE,OPNOMSK2              CLEAR HI HALF WD GTR 32K        26350018
         SR    RE,RA                   RE=SMSW-KL                       26400018
         IC    RA,DCBHIRPD             RA=HIRPD                         26600018
         SLL   RA,3                    RA=8(HIRPD)                      26800018
         AH    RA,DCBLRECL             RA=8(HIRPD) + LRECL              27000018
         LA    RA,10(RA)               RA=8(HIRPD) + LRECL+10           27200018
         SR    RE,RA                   RE=AMT OF MSWA USED FOR BLOCKS   27400018
         CLC   DCBMSWA+1(3),ONE         IS DCBMSWA INVALID       M4570  27460019
         BNH   OPNO5B6                  YES, BRANCH              M4570  27520019
         CR    RE,RF                                                    27600018
         BL    ABENDT35                B=SMSW TOO SMALL                 27800018
         STM   R0,R15,DXCCW1            SAVE REGISTERS           Y02072 27810002
*                                                                       27824002
         MODESET  KEYADDR=KEYZERO,WORKREG=13 CHANGE TO KEYZERO   Y02072 27826002
*                                                                       27826402
*    OBTAIN THE LOCAL LOCK. TO BE FREED AT FLCL IN THIS MODULE.         27826802
*                                                                       27827202
GLCL     SETLOCK  OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 Y02072*27828002
               RELATED=('VALIDITY CHECK RTN')                    Y02072 27828402
*                                                                       27828502
         SR    RPARC,RPARC              ERROR INDICATOR          Y02072 27828802
         LR    RWTGC,RCORE              SAVE OPEN WA ADDRESS     Y02072 27829602
         L     RCORE,DCBDEBAD           ADDR OF DEB (A42450)     Y02072 27830002
         L     RCORE,0(RCORE)           ADDR OF TCB (A42450)     Y02072 27840002
         L     RF,DCBMSWA               ADDR TO VALIDATE(A42450) Y02072 27850002
         LA    RF,0(,RF)                CLEAR HIGH ORDER BYTE    Y02072 27850402
         SR    RDCB,RDCB                ZERO RANGE INDICATOR     Y02072 27852002
         L     R15,CVTPTR               ADDR OF CVT (42450)      Y02072 27860002
         USING CVT,R15                  CVT ADDRESSABILITY       Y02072 27870002
         L     R15,CVT0VL00             ADDR OF VALID RTN(42450) Y02072 27880002
         DROP  R15                      (A42450,A52477)          Y02072 27890002
         BALR  RD,R15                   VALIDATE RTN (42450)     Y02072 27900002
         BZ    OPNO5B53                 BR IF VALID ADDR         Y02072 27950002
         LA    RPARC,ERROR(RPARC)       INDICATE ADDR NOT VALID  Y02072 27960002
FLCL     EQU   *                                                        27962002
*                                                                       27964002
*    RELEASE THE LOCAL LOCK, OBTAINED AT GLCL IN THE MODULE.            27966002
*                                                                       27968002
OPNO5B53 SETLOCK  RELEASE,TYPE=LOCAL,                            Y02072*27970002
               RELATED=('VALIDITY CHECK RTN')                    Y02072 27980002
*                                                                       27982002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 27990002
*                                                                       27990402
         LTR   RPARC,RPARC              ADDR VALID               Y02072 27992002
         BNZ   ABENDT34                 ABEND, ADDR INVALID      Y02072 27994002
         LR    RCORE,RWTGC              OPEN WA ADDRESSABILITY   Y02072 27994402
         LM    R0,R15,DXCCW1            RESTORE REGISTERS        Y02072 27996002
         SRDL  RE,32                                                    28000018
OPNO5B55 EQU   *                        VAR PART OF MSWA IN RF   M4570  28100019
         LH    RA,DCBBLKSI                                              28200018
         DR    RE,RA                   RF=Q=NO READ CCWS FOR CP12A      28400018
         SR    RA,RA                                                    28600018
OPNO5E11 TM    DCBMACRF,X'20'                                           28800018
         BO    OPNO5DD3                                                 29000018
         TM    DCBMAC,X'04'                                             29200018
         BZ    OPNO5D31                                                 29400018
OPNO5DD3 LA    RA,1(R0)                ADD 1 TO COUNT FOR RU WITH WKN   29600018
OPNO5D31 SR    RG,RG                    RD NLSD - NO. LVLS.      M0178  29700020
*                                       INDEX                    M0178  29800020
         IC    RG,DCBNLEV                    SRCHED ON DEVICE    M0178  29900020
         CLI   DCBNLEV,X'00'            IF HIGHEST LVL INDEX NOT TRK    30200018
         BE    OPNO5B3                   INDEX, USER MAY SPECIFY AREA   30400018
         CLI   DCBSMSI+1,X'00'           FOR HI LVL INDEX IN CORE       30600018
         BNE   OPNO5B4                  NLSD = NLEV - 1 IF HI LVL IN    30800018
         CLI   DCBSMSI,X'00'             CORE, OTHERWISE NLSD = NLEV    31000018
         BE    OPNO5B3                  BRANCH IF NOT IN CORE           31200018
OPNO5B4  CLC   DCBSMSI,DCBNCRHI         AREA SPECIFIED MUST BE AT LEAST 31400018
         BL    ABENDT34                  AS BIG AS INDEX                31600018
         BCTR  RG,0                                              M0178  31800020
OPNO5B3  STC   RA,DCBWKPT6+2           SAVE COUNT FOR CHOOSING APPEND   32000018
         STH   RF,DCBWKPT6             SAVE Q=NO READ CCWS              32200018
         SR    RB,RB                    CLEAR REGISTER           A27818 32300019
         IC    RB,DCBHIRPD                                       A27818 32400019
         CR    RB,RF                    TEST IF Q GT HIRPD       A27818 32500019
         BNL   OPNOLA1                 B = Q LT HIRPD   OK              32600018
         STH   RB,DCBWKPT6              HIRPD LOW--USE IT        A27818 32800019
OPNOLA1  LA    RB,1                                                     33000018
         CLR   RG,RB                                             M0178  33200020
         BL    OPNO5E3                                                  33400018
         LA    RA,3(RA)                ADD 3 FOR NLSD = 1               33600018
         BE    OPNO5E3                                                  33800018
         LA    RA,3(RA)                ADD 3 FOR NLSD GT 1              34000018
OPNO5E3  SLL   RA,2                     USE CODE IN RA TO SELECT PROPER 34200018
         SR    RE,RE                     WORD FROM SIZE TABLE           34400018
         IC    RE,OPNSIZE(RA)            SIZE NEEDED FOR WORKAREAS,     34600018
         LR    R15,RC                                                   34800018
         SR    RC,RC                     AND CHAN PROGS                 35000018
         IC    RC,OPNSIZE+1(RA)          8(BYTE 1 + HIRPD X BYTE 2 +    35200018
         SR    RB,RB                         NCP X BYTE 3)              35400018
         IC    RB,DCBHIRPD              IF BYTE 4, BIT 0 IS ON, ADD     35600018
         MR    RB,RB                       BLOCKED - KEYLE+RECL+BLKSI   35800018
         AR    RE,RC                       UNBLKED - KEYLE+RECL+10      36000018
         AH    RE,THREE                 ALLOW FOR 1 EXTRA CE4-6  A34921 36100020
         SR    RC,RC                                                    36200018
         CLI   DCBNCP,X'00'             IF NCP IS NOT SPECIFIED, ASSUME 36400018
         BNE   OPN05E3A                   IT IS 1                       36600018
         MVI   DCBNCP,X'01'                                             36800018
OPN05E3A IC    RC,OPNSIZE+2(RA)                                         37000018
         IC    RB,DCBNCP                                                37200018
         MR    RB,RB                                                    37400018
         AR    RE,RC                                                    37600018
         SLL   RE,3                                                     37800018
OPNO5F3  SR    RB,RB                                             A27818 37850019
         TM    DCBMAC,X'02'             WRITE KN                 A27818 37900019
         BZ    OPNO5F4                  NO, BRANCH               A27818 37950019
         CLC   DCBMSWA+1(3),ONE         IS MSWA SPECIFIED        M4570  38000019
         BH    OPNO5F4                  YES, BRANCH              M4570  38050019
         ICM   RB,3,DCBSMSW             OTHERWISE, GET ADDL COR@ZA15656 38100037
OPNO5F4  AR    RB,RE                    SAVE TOTAL NO OF BYTES   A27818 38150019
         LR    RC,R15                                                   38200018
         LA    RE,250                   SET UP SUBPOOL NO.              38250018
         SLL   RE,24                                                    38300018
         OR    RE,RB                                                    38350018
         GETMAIN R,LV=(0)                    GET AREA                   38400018
         USING IHADCW,RF                RF   ADDRESS OF DCB WA          38600018
*                                                                       38850002
         MODESET  KEYADDR=DXUKEY,WORKREG=11  CHANGE TO USER KEY  Y02072 38870002
*                                                                       38872002
         XC    IHADCW(SZAX8),IHADCW     ZERO DCB WA                     38998001
         ST    RG,DCWNLSD-3                                      M0178  39100020
         MVC   DCWDCBFA(4),DCBWKPT5     SET UP DCBFA POINTER IN  A35340 39205020
*                                       WKAREA                   A35340 39210020
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 39212002
*                                                                       39212402
         ST    RF,DCBWKPT2              SET PTR TO WORK AREA     Y02072 39214002
         XC    DCBWKPT5(4),DCBWKPT5     ZERO DCBWKPT5            A35340 39215020
         TM    DCBMAC,X'02'             WRITE KN                 A27818 39220019
         BZ    OPNO5K4                  NO, BRANCH               A27818 39240019
         CLC   DCBMSWA+1(3),ONE         IS MSWA SPECIFIED        M4570  39260019
         BH    OPNO5K4                  YES, BRANCH              M4570  39280019
         LR    RA,RF                    POINT TO GOTTEN CORE     A27818 39300019
         AR    RA,RB                    END OF GOTTEN CORE       A27818 39320019
         XC    DCBMSWA,DCBMSWA          CLEAR FOR SUBTRACT     @ZA15656 39340037
         OC    DCBMSWA+2(2),DCBSMSW     OR IN SIZE TO SUBTRACT @ZA15656 39346037
         S     RA,DCBMSWA               POINT TO 'USER' AREA   @ZA15656 39352037
         ST    RA,DCBMSWA               SAVE ADDRESS             A27818 39360019
*                                                                       39360402
         MODESET  KEYADDR=DXUKEY,WORKREG=11  CHANGE TO USER KEY  Y02072 39362002
*                                                                       39364002
         OI    DCWWKNI,X'02'            SET FLAG SO CLOSE WILL   M4570  39366019
*                                       CLEAR DCBSMSW                   39372019
         B     OPNO5K4A                 SAVE FIELDS              Y02072 39374002
OPNO5K4  EQU   *                                                 A27818 39380019
         MODESET  KEYADDR=DXUKEY,WORKREG=11  CHANGE TO USER KEY  Y02072 39390002
OPNO5K4A EQU   *                                                 Y02072 39392002
         SRL   RB,3                                                     39400018
         STH   RB,DCWSIZE               SAVE NLSD AND SIZE OF AREA      39600018
         MVC   DCWOPCLS,DCBWKPT3        SAVE INFO FOR CLOSE             39800018
         ST    RC,DCWFUPDI              SAVE DEVICE POINTER      Y02072 39850002
*                                                                       39860002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 39900002
*                                                                       39950002
         XC    DCBWKPT3(8),DCBWKPT3                                     40000018
         LA    RB,SZAX8(RF)             SAVE ADDRESS OF FIRST CP        40400018
         ST    RB,DCBWKPT1                                              40600018
*                                                                       40610002
         MODESET  KEYADDR=DXUKEY,WORKREG=11  CHANGE TO USER KEY  Y02072 40650002
*                                                                       40660002
         CLC   DCWNLSD,DCBNLEV          IF HI INDEX IN CORE, SET        40800018
         BE    OPNO5F2                   HIAV BIT 1 ON                  41000018
         OI    DCWHIAV,X'40'                                            41200018
*                                                                       41210002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 41250002
*                                                                       41300002
         MVC   0(L'LOAD2P,RWTGC),LOAD2P IGG0192P IS NEXT LOAD    Y02072 41400002
         B     OPNEND2H                                                 41600018
*                                                                       41796002
OPNO5F2  MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 41800002
*                                                                       41850002
         MVC   0(L'LOAD2I,RWTGC),LOAD2I GO TO IGG0192I           Y02072 41900002
OPNEND2H EQU   *                                                        42000018
*                                                                       42200002
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT NAME ON THE WTG TABLE  42400018
         LA    RPARC,PLOFF(0,RPARC)        AND DCB ON THE PARAM TABLE   42600018
         CLC   0(2,RWTGC),OPNEXNAM      IF NAME ON TABLE SAME ID AS     42800018
         BCR   8,RBASE                   CURRENT LOAD, BRANCH TO REPEAT 43000018
         CLC   0(2,RWTGC),OPIDCNST      IF NOT END OF WTG TABLE BRANCH  43200018
         BNE   RELOOP                    TO TRY NEXT NAME               43400018
         LR    RPARC,RPAR               OTHERWISE, RETURN TO START OF   43600018
         LA    RWTGC,WAOFF(0,RWTG)       BOTH TABLES AND SEARCH FOR     43800018
ZCHECK   CLI   0(RWTGC),ZCNST            FIRST NON-ZERO ID              44000018
         BNE   TCTLRTN                                                  44200018
         LA    RWTGC,WGOFF(00,RWTGC)                                    44400018
         LA    RPARC,PLOFF(0,RPARC)                                     44600018
         B     ZCHECK                                                   44800018
TCTLRTN  MVC   6(2,RWTG),0(RWTGC)       WHEN FOUND, SET UP PARAMETERS   45000018
*                                       TO CALL THAT MODULE             45200002
         LA    R15,DXCCW12                                       Y01021 45400000
TRCTL    XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) XCTL TO NEXT LOAD  Y02072 45600002
WGOFF    EQU   8                        SIZE OF ONE ENTRY ON WTG TABLE  45800018
PLOFF    EQU   4                        SIZE OF ONE ENTRY ON PARAM TAB  46000018
FOURTEEN EQU   14                       14                              46100001
TWENTY4  EQU   24                       24                              46150001
OPNEXNAM DC    C'2W'                   ID THIS OPEN EXECUTOR            46200018
OPIDCNST DC    C'0S'                    ID OF OPEN LOAD B7              46400018
ZCNST    EQU   X'00'                    ZERO - SIGNALS INACTIVE ENTRY   46600018
WAOFF    EQU   32                       SIZE OF WA AT START OF WTG TAB  47200018
ERROR    EQU   1                        IND. ERR IN VALID CHK    Y02072 47250002
*                                                                       47400018
         DS    0H                                                       47450002
ABENDT34 EQU   *                        ABNORMAL RETURN, CODE 34        47600002
         ABEND X'034',DUMP,,SYSTEM      SYSTEM 034 ABEND         Y02072 47800002
ABENDT32 EQU   *                        ABNORMAL RETURN, CODE 32        48000002
         ABEND X'032',DUMP,,SYSTEM      SYSTEM 032 ABEND         Y02072 48200002
ABENDT35 EQU   *                        ABNORMAL RETURN, CODE 35        48400002
         ABEND X'035',DUMP,,SYSTEM      SYSTEM 035 ABEND         Y02072 48600002
OPNO5B6  LCR   RA,RE                    GET KEYLEN+8(HIRPD) ETC  M4570  48620019
         AH    RA,DCBSMSW               ADD IN CASE MSWA WAS     M4570  48640019
*                                       ZERO AND DCBSMSW WAS NOT        48660019
         LA    RE,7(RA,RF)              ADD TWO QTYS + 7         M4570  48680019
         SRL   RE,3                     ROUND TO DOUBLE WORD     A27818 48700019
         SLL   RE,3                                              A27818 48720019
         STH   RE,DCBSMSW               SAVE VALUE IN DCB        A27818 48740019
         SR    RE,RE                    CLEAR FOR DIVIDE         M4570  48750019
         B     OPNO5B55                 RETURN TO MAINLINE       A27818 48760019
THREE    DC    H'3'                                              A34921 48780020
         DS    0F                                                       48800018
OPNOMASK DC    X'0000000F'                                              49600018
OPNOMSK2 DC    X'0000FFFF'                                              49700018
ONE      DC    X'000001'                                         M4570  49750019
KEYZERO  DC    X'00'                    STORAGE PROTECT KEY 0    Y02072 49800002
*                           TABLE FOR TOTAL SIZE OF CP'S AND WA'S       52400018
*                                           CODE  NLSD MACRO FU/B WA WC 52600018
*                                           ****  **** ***** **** ** ** 52800018
OPNSIZE  DC    AL1(SZA+SZD+SZF+SZM+SZQ)          0      WKN  FU   Y  Y  53000018
         DC    AL1(SZN+SZR)                                             53200018
         DC    AL1(0)                                                   53400018
         DC    X'00'                                                    53600018
         DC    AL1(SZA+SZD+SZF+SZM+SZQ)          0      ALL  FU   Y  Y  53800018
         DC    AL1(SZN+SZR)                                             54000018
         DC    AL1(SZT)                                                 54200018
         DC    X'00'                                                    54400018
         DC    AL1(SZA)                      17  0      R+U  ANY  -  Y  54600018
         DC    AL1(0)                                                   54800018
         DC    AL1(SZT)                                                 55000018
         DC    X'00'                                                    55200018
         DC    AL1(SZA+SZD+SZF+SZM+SZQ+SZC)      1      WKN  FU   Y  Y  55400018
         DC    AL1(SZN+SZR)                                             55600018
         DC    AL1(0)                                                   55800018
         DC    X'00'                                                    56000018
         DC    AL1(SZA+SZD+SZF+SZM+SZQ+SZC)      1      ALL  FU   Y  Y  56200018
         DC    AL1(SZN+SZR)                                             56400018
         DC    AL1(SZT)                                                 56600018
         DC    X'00'                                                    56800018
         DC    AL1(SZA+SZC)                  35  1      R+U  ANY  -  Y  57000018
         DC    AL1(0)                                                   57200018
         DC    AL1(SZT)                                                 57400018
         DC    AL1(0)                                                   57600018
         DC    AL1(SZA+SZD+SZF+SZM+SZQ+SZB)      2,3,4  WKN  FU   Y  Y  57800018
         DC    AL1(SZN+SZR)                                             58000018
         DC    AL1(0)                                                   58200018
         DC    X'00'                                                    58400018
         DC    AL1(SZA+SZD+SZF+SZM+SZQ+SZB)      2,3,4  ALL  FU   Y  Y  58600018
         DC    AL1(SZN+SZR)                                             58800018
         DC    AL1(SZT)                                                 59000018
         DC    X'00'                                                    59200018
         DC    AL1(SZA+SZB)                  53  2,3,4  R+U   ANY  - Y  59400018
         DC    AL1(0)                                                   59600018
         DC    AL1(SZT)                                                 59800018
         DC    X'00'                                                    60000018
*                                                                       60040000
LOAD2I   DC    C'2I'                    ID OF MODULE IGG0192I    Y02072 60042002
LOAD2P   DC    C'2P'                    ID OF MODULE IGG0192P    Y02072 60044002
*                                                                       60046002
PATCH    DC    XL50'00'                 ZEROED PATCH AREA        Y02072 60048002
         EJECT                                                          61812000
FORCORE  DSECT                          OPEN/CLOSE/EOV WORK AREA Y01021 61814000
         IECDSECT                                                Y01021 61816000
WTGDSECT DSECT                                                   Y02072 61816402
IDTTRAD  DS    F                        MODULE ID AND TTR        Y02072 61816802
OPENWA   DS    A                        ADDR OF OPEN WORK AREA   Y02072 61817202
         EJECT                                                          61818000
CVT      DSECT                                                          61830021
         CVT                                                            61860021
IHADCW   IGGBISAM OPTCD=VW                                       S20201 61900020
         DCBD  DSORG=(IS)                                               62000018
IHADSCB  DSECT                                                          67400018
DSCBK1   DS    BL1                      X'02'                           67600018
DSCBK2   DS    CL7                      DCBFTMI2                        67800018
DSCBK3   DS    CL5                      DCBLEMI2                        68000018
DSCBK4   DS    CL7                      DCBFTMI3                        68200018
DSCBK5   DS    CL5                      DCBLETI                         68400018
DSCBK6   DS    CL19                     SPARE                           68600018
DSCBD1   DS    CL1                      EBCDIC '2'                      68800018
DSCBD2   DS    CL1                      DCBNLEV                         69000018
DSCBD3   DS    CL1                      DCBNTM                          69200018
DSCBD4   DS    CL3                      DCBFIRSH                        69400018
DSCBD5   DS    CL2                      DCBLDT                          69600018
DSCBD6   DS    CL1                      DCBCYLOF                        69800018
DSCBD7   DS    CL1                      DCBHIRCM                        70000018
DSCBD8   DS    CL1                      DCBHIRPD                        70200018
DSCBD9   DS    CL1                      DCBHIROV                        70400018
DSCBD10  DS    CL1                      DCBHIRSH                        70600018
DSCBD11  DS    CL2                      RESERVED                        70800018
DSCBD12  DS    CL2                      DCBTDC                          71000018
DSCBD13  DS    CL3                      DCBRORG3                        71200018
DSCBD14  DS    CL2                      DCBNCRHI                        71400018
DSCBD15  DS    CL1                      DCBNTHI                         71600018
DSCBD16  DS    CL4                      DCBNREC                         71800018
DSCBD17  DS    BL1                      DCBST                           72000018
DSCBD18  DS    CL7                      DCBFTCI                         72200018
DSCBD19  DS    CL7                      DCBFTMI3                        72400018
DSCBD20  DS    CL7                      DCBFTHI                         72600018
DSCBD21  DS    CL08                     DCBLPDA                         72800018
DSCBD22  DS    CL5                      LAST TRACK INDEX ENTRY ADDRESS  73000018
DSCBD23  DS    CL5                      LAST CYLDR INDEX ENTRY ADDRESS  73200018
DSCBD24  DS    CL5                      LAST MASTR INDEX ENTRY ADDRESS  73400018
DSCBD25  DS    CL8                      DCBLIOV                         73600018
DSCBD26  DS    CL2                      DCBNBOV                         73800018
DSCBD27  DS    CL2                      DCBRORG2                        74000018
DSCBD28  DS    CL2                      DCBNOREC                        74200018
DSCBD29  DS    CL2                      DCBRORG1                        74400018
DSCBD30  DS    CL3                      SPARE                           74600018
DSCBD31  DS    CL5                      POINTER TO FORMAT III    S20201 74610020
*                                       DSCB                     S20201 74620020
IHAWKNCP IGGWKNCP OPTCD=VW                                       S20201 74630020
         ORG      IHAWKNCP              ADDRESSIBILITY AT        S20201 74640020
*                                       BEGINNING                S20201 74650020
         IGGCP12A OPTCD=VW                                       S20201 74660020
         IGGCP12B OPTCD=VW                                       S20201 74670020
         IGGCP123 OPTCD=V                                        S20201 74680020
         ORG      IHAWKNCP              ADDRESSIBILITY AT        S20201 74690020
*                                       BEGINNING                S20201 74700020
IHACP47  IGGCP47  OPTCD=W                                        S20201 74710020
SZA      EQU   (DCWLEN+7)/8             SIZE OF DCB WA IN DBLWDS S20201 74720020
*                                        P470                    S20201 74730020
SZAX8    EQU   DCWLEN                   SIZE OF DCB WA IN BYTES  S20201 74740020
*                                        1751                    S20201 74750020
*            # CCWS TIMES  CHANNEL PROGRAMS      NLSD MACRO FU/B WA WC  74760020
*            ****** *****  ****************      **** ***** **** ** **  74762020
SZB      EQU   SZCP1/8                  1         2,3,4          S20201 74764020
*                                        1751                    S20201 74766020
SZC      EQU   SZCP2/8                  2         1              S20201 74768020
*                                        1751                    S20201 74770020
SZD      EQU   (SZ8+SZ15+SZ16)/8        8,15,16           WKN    S20201 74772020
*                                                                S20201 74774020
*                                                                       74776020
SZF      EQU   (SZ14VW+SZ17W)/8         14W,17W            WKN   S20201 74778020
SZM      EQU   (SZ12AVW+SZ12BVW)/8      12A,12B      WKN    FU   S20201 74780020
*                                          Y                     S20201 74782020
SZN      EQU   4                        HIRPD                    S20201 74784020
SZQ      EQU   SZ123V/8                 123V                     S20201 74786020
SZR      EQU   1                        HIRPD                    S20201 74788020
SZT      EQU   (SZ4+SZ5W+SZ6W+SZ7W)/8   4,5W,6W,7W     R+V    Y  S20201 74790020
*                                        1751                    S20201 74792020
FOUR     EQU   X'04'                    4                        S20201 74794020
SIX      EQU   X'06'                    6                        S20201 74796020
SEVEN    EQU   X'07'                    7                        S20201 74798020
EIGHT    EQU   X'08'                    8                        S20201 74800020
NINE     EQU   X'09'                    9                        S20201 74802020
VIRTUAL  EQU   X'80'                    VIRTUAL MASK                    74802801
IHADEB   IGGDEBD                                                        74803801
         EJECT                                                          74803902
         IHAPSA                                                  Y02072 74853902
         END                                                            74903902
