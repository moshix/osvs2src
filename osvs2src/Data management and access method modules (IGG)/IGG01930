         TITLE 'IGG01930 FIRST LOAD OF TCAM MESSAGE QUEUES OPEN'        00000110
IGG01930 CSECT                                                          00000210
*A-000000-999999                                               @X31X8N0 00010210
         SPACE 2                                                        00020210
*CHANGE-ACTIVITY = AS FOLLOWS:                                   S21903 00030210
******************** MICROFICHE FLAGS *********************** SUPT CODE 00040210
*A430000,459000,473000                                           X01004 00050210
*C087200-088000,213000-214000,467000                             X01004 00060210
*A276000                                                         Y01004 00070210
*A091000,340000,430600                                           X02004 00080210
*A091600,323000,430600                                           Y05330 00090210
*C091400                                                         Y05330 00100210
*D284200-285200                                                  Y05330 00110210
*A247000,275000,459000                                          SA54471 00120210
*A087000,090000                                                  M2318  00210110
*D152000-153000,285000                                           A41033 00210210
*A002000,003000                                                  S21903 00210310
*C085000,299000,308000,314000,460000-464000,471000,              S21903 00210410
*C476000-479000,488000-491000                                    S21903 00210510
*C005000,020000,023000,028000-032500,045000,046000,210000        Y02027 00210610
*C240000,242000,253000,255000,257000-259000,451600               Y02027 00210710
*D089000                                                         Y02027 00210810
*A088000,089600,089700,091040,091060,0259500,340110-340160       Y02027 00210910
*A353180-353900,398400,399400,447000,459050                      Y02027 00211010
*A000002                                                       @Z30X8NM 00211110
*C005000,092000-093400,189000,223000,284000,421000             @Z30X8NM 00211210
*D466000-471000,473000,475000-479000                           @Z30X8NM 00211310
*D322000,323000,340110-340500,430400,430800                    @Z30X8NG 00211410
*D091100-091700                                                  X03039 00211510
*                TCAM LEVEL 10.0 CHANGES                       @G36XRNP 00231510
*C093500,189000,223000                                         @G36XRNP 00251510
*                                                              @G36XRNP 00271510
         SPACE 3                                                        00300010
*********************************************************************** 00310010
*                                                                     * 00320010
*MODULE-NAME = IGG01930   (TCAM,INITIALIZATION)                @G36XRNP 00330010
*                                                                S21903 00340010
*DESCRIPTIVE-NAME = FIRST LOAD OF TCAM MESSAGE QUEUES OPEN       S21903 00350010
*                                                                S21903 00360010
*COPYRIGHTS = 'NONE'                                             S21903 00370010
*                                                                     * 00400010
*STATUS - CHANGE LEVEL 10.0                                    @G36XRNP 00500010
*                                                                     * 00600010
*FUNCTION/OPERATION - THIS ROUTINE GETS MAIN STORAGE FOR AND          * 00700010
*   INITIALIZES A DATA EXTENT BLOCK.IT ANALYZES DEVICE TYPE           * 00800010
*   INFORMATION PROVIDED IN THE UNIT CONTROL BLOCK TO DETERMINE       * 00900010
*   WHAT TYPE OF DIRECT ACCESS DEVICES AREA USED FOR THE MESAGE       * 01000010
*   QUEUES.                                                           * 01100010
*                                                                     * 01200010
*ENTRY POINTS - THIS ROUTINE IS ENTERED AT IGG01930 VIA AN            * 01300010
*   XCTL FROM AN I/O SUPPORT MODULE OR FROM ANOTHER ACCESS            * 01400010
*   METHOD'S OPEN EXECUTOR.  IT MAY ALSO BE RE-ENTERED FROM           * 01500010
*   THE RELOOP PORTION OF THIS ROUTINE IF IT DETERMINES THAT          * 01600010
*   THERE IS ANOTHER DATA CONTROL BLOCK TO BE OPENED.                 * 01700010
*                                                                     * 01800010
*INPUT - THE REGISTERS 5,6,7,AND 8 ARE THE INPUT AS FOLLOWS,          * 01900010
*   5 - THE ADDRESS OF THE WTG TABLE PREFIX                      Y02027 02000010
*   6 -  THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE        * 02200010
*   7 - THE ADDRESS OF THE COPY OF THE CURRENT DCB               Y02027 02300010
*   8 -  THE ADDRESS OF THE CURRENT EXECUTOR'S ENTRY IN THE           * 02500010
*        WHERE-TO-GO TABLE.                                           * 02600010
*                                                                     * 02700010
*OUTPUT                                                          Y02027 02800010
*   REGISTER 7 WILL POINT TO THE ADDRESS OF THE COPY OF          Y02027 02850010
*   THE NEXT DCB TO BE PROCESSED BY THIS OPEN EXECUTOR           Y02027 02900010
*                                                                Y02027 02950010
*   REGISTER 8 WILL POINT TO THE ID OF THE NEXT OPEN             Y02027 03000010
*   EXECUTOR TO BE GIVEN CONTROL                                 Y02027 03050010
*                                                                Y02027 03100010
*   A DEB WILL HAVE BEEN BUILT AND INITIALIZED IN                Y02027 03150010
*   SUBPOOL 230                                                  Y02027 03200010
*                                                                Y02027 03250010
*                                                                     * 03300010
*EXTERNAL ROUTINES - NONE                                             * 03400010
*                                                                     * 03500010
*EXITS - NORMAL                                                       * 03600010
*   THIS ROUTINE EXITS VIA AN XCTL TO THE MODULE IDENTIFIED BY        * 03700010
*   THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE, NAMELY          * 03800010
*   IGG01931                                                          * 03900010
*                                                                     * 04000010
*      - ERROR                                                        * 04100010
*                                                                     * 04200010
*TABLES/WORKAREAS - THE WHERE-TO-GO TABLE CONTAINS THE ID AND         * 04300010
*   TTR OF THE OPEN EXECUTOR LOAD.  THE DATA CONTROL BLOCK            * 04400010
*   COPY LIST CONTAINS THE ADDRESSES OF A COPY OF EACH DCB       Y02027 04500010
*   SPECIFIED IN THE OPEN MACRO INSTRUCTION. THE OPEN WORK AREA  Y02027 04600010
*   DESCRIBES THE CHARACTERISTICS AND UP TO SIXTEEN EXTENTS OF        * 04700010
*   A DATA SET.  THE ADDRESS VECTOR TABLE IS A RESIDENT VECTOR        * 04800010
*   LIST USED TO LOCATE CERTAIN PARAMETERS WHICH ARE NEEDED IN        * 04900010
*   DEB CONSTRUCTION.                                                 * 05000010
*                                                                     * 05100010
*ATTRIBUTES - THIS ROUTINE IS EXECUTED IN THE TRANSIENT AREA AS       * 05200010
*   ENABLED, PRIVILEGED, AND REENTRANT.                               * 05300010
         EJECT                                                          05400010
*       REGISTER USAGE                                                  05500010
*                                                                       05600010
RE       EQU   0                        WORK REGISTER                   05700010
RF       EQU   1                        WORK REGISTER                   05800010
RDCB     EQU   2                        ADDRESS OF THE CURRENT DCB      05900010
RTIOT    EQU   3                        ADDRESS OF THE TIOT             06000010
RCORE    EQU   4                        ADDRESS OF DCB WORK AREA        06100010
RPAR     EQU   5                        ADDRESS OF FIRST ENTRY IN       06200010
*                                         DCB PARAMETER LIST            06300010
RWTG     EQU   6                        ADDRESS OF WHERE-TO-GO TABLE    06400010
RPARC    EQU   7                        ADDRESS OF CURRENT ENTRY IN     06500010
*                                         DCB PARAMETER LIST            06600010
RWTGC    EQU   8                        ADDRESS OF CURRENT ENTRY IN     06700010
*                                         WHERE-TO-GO TABLE             06800010
RAVT     EQU   9                        ADDRESS OF THE AVT              06900010
RUCB     EQU   10                       ADDRESS OF THE CURRENT UCB      07000010
RDEB     EQU   11                       ADDRESS OF THE DEB              07100010
RBASE    EQU   12                       BASE OF THIS ROUTINE            07200010
RC       EQU   13                       WORK REGISTER                   07300010
RD       EQU   14                       WORK REGISTER                   07400010
RJ       EQU   15                       WORK REGISTER                   07500010
*                                                                       07600010
         USING IHADCB,RDCB              DCB DSECT                       07700010
         USING IEDJCIOB,RTIOT           PRIVATE IOB DSECT               07800010
         USING IEDQDEB,RDEB             DATA EXTENT BLOCK DSECT         07900010
         USING IEDQTCB,RC               TCB DSECT                       08000010
         USING IEDQCPB,RD               CPB DSECT                       08100010
         USING FORCORE,RCORE            DCB WORK AREA DSECT             08200010
         USING IEDQAVTD,RAVT            AVT DSECT                       08300010
*                                                                       08400010
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY S21903 08500010
         USING *,RBASE                                                  08600010
*                                                                       08700010
IGG01930 IEDHJN RESTART                                          S22024 08720010
         EJECT                                                   Y02027 08760010
         MODESET EXTKEY=SUPR            GET INTO KEY 0           Y02027 08800010
         SPACE 2                                                        08840010
         L     RCORE,FOUR(RWTGC)        ADDRESS OF WORK AREA     S22024 08950010
         L     RDCB,DXUDCBAD            LOAD THE ADDRESS OF THE  Y02027 08960010
*                                         USER'S DCB             Y02027 08970010
         XC    DXCCW10(FOUR),DXCCW10    CLEAR IN CASE OF         S22024 09000010
*                                       OPEN ERROR               M2318  09060010
         L     RAVT,DCBIOBAD            ADDRESS OF THE AVT              09100010
         SPACE 1                                                 Y02027 09102010
         CLI   DXUKEY,KEY6              IS INVOKER IN KEY 6      Y02027 09104010
         BNE   NOTKEY6                  NO, GO SET ERROR CODE    Y02027 09106010
         SPACE 1                                                 Y02027 09108010
         TM    DCBOPTCD,CHKPOINT        IS THIS CKPOINT DCB    @Z30X8NM 09200010
         BO    DISKQ                    YES, BRANCH            @Z30X8NM 09230010
         TM    DCBOPTCD,CKP3705         3705 CKPOINT DCB       @Z30X8NM 09260010
         BZ    CHKAVTDK                 NO, BRANCH             @G36XRNP 09290010
         XC    AVTEZERO(TWO,RWTGC),AVTEZERO(RWTGC) LAST LOAD   @Z30X8NM 09320010
         B     DISKQ                    3705 CKPT OPEN         @G36XRNP 09350010
CHKAVTDK EQU   *                                               @Z30X8NM 09380010
         TM    AVTBIT1,AVTDISKN         DO WE HAVE THE CORRECT   S22024 09410010
*                                        AVT TO SUPPORT DISK     S22024 09480010
*                                        QUEUEING                S22024 09550010
         BZ    AVTERROR                 NO, BRANCH               S22024 09620010
         CLC   DSCKEYL(ONE),AVTKEYLE+ONE ARE KEYLENGTHS THE SAME S22024 09700010
         BNE   KEYLNGER                 NO, BRANCH                      09800010
         EJECT                                                          09900010
DISKQ    EQU   *                                                        10000010
         L     RC,AVTTCB                LOAD THR TCB ADDRESS            10100010
         L     RF,TIOT(RC)              LOAD THE ADDRESS OF THE         10200010
*                                         TIOT                          10300010
         AH    RF,DCBTIOT               ADD DCB OFFSET TO STARTING      10400010
*                                         ADDRESS OF THE TIOT           10500010
         SR    RE,RE                    CLEAR DD ENTRY LENGTH REG.      10600010
         IC    RE,AVTEZERO(RF)          LOAD LENGTH OF DD ENTRY  S22024 10700010
*                                                                       10800010
         SH    RE,DDLENGTH              SUBTRACR 16 FROM THE LENGTH     10900010
         SRL   RE,SHIFT2                DIVIDE RESULT BY 4 TO GET       11000010
*                                         THE NUMBER OF UCB'S           11100010
         BCTR  RE,0                     REDUCE NUMBER OF UCB'S BY 1     11200010
         AH    RF,DDLENGTH              LOAD POINTER TO FIRST UCB       11300010
         L     RUCB,AVTEZERO(RF)        LOAD POINTER TO THE UCB  S22024 11400010
         LA    RUCB,AVTEZERO(RUCB)      CLEAR HIGH ORDER BYTE    S22024 11500010
*                                                                       11600010
         LA    RD,ONE                   LOAD A COMPARISON VALUE         11700010
         CR    RE,RD                    UCB'S GREATER THAN ONE          11800010
         BL    DEVTEST                  BRANCH TO DEVICE TEST           11900010
*                                                                       12000010
*                                                                       12100010
         MVC   AVTGETMN+THREE(ONE),UCBTYPE(RUCB) MOVE DEVICE     S22024 12200010
*                                        TYPE TO WORK AREA       S22024 12300010
UCBPT    EQU   *                                                        12400010
         LA    RF,FOUR(RF)              LOAD POINTER TO NEXT UCB        12500010
         L     RUCB,AVTEZERO(RF)        LOAD NEXT UCB ADDRESS    S22024 12600010
*                                                                       12700010
         CLC   UCBTYPE(ONE,RUCB),AVTGETMN+THREE TEST DEVICE      S22024 12800010
*                                        CODES FOR EACH UCB      S22024 12900010
         BNE   BADISK                   THE DEVICES ARE NOT ALIKE       13000010
         BCT   RE,UCBPT                 BRANCH TO UPDATE UCB POINTER    13100010
         EJECT                                                          13200010
DEVTEST  EQU   *                                                        13300010
         L     RC,CVT                   LOAD THE ADDRESS OF THE CVT     13400010
         L     RC,DADT(RC)              LOAD THE ADDRESS OF THE         13500010
*                                         DIRECT ACCESS DEVICE          13600010
*                                         TABLE                         13700010
         IC    RF,UCBTYPE(RUCB)         PICK UP THE DIRECT ACCESS       13800010
*                                         TYPE BYTE                     13900010
         N     RF,FULLWORD              REMOVE ALL EXTRANEOUS BITS      14000010
*                                         FROM THE REGISTER             14100010
         IC    RF,AVTEZERO(RF,RC)       USING THE DEVICE TYPE BITS22024 14200010
*                                         AS AN OFFSET, PICK UP A       14300010
*                                         BYTE FROM THE OFFSET          14400010
*                                         TABLE IN THE  DADT            14500010
         LA    RTIOT,AVTEZERO(RF,RC)    LOAD THE ADDRESS OF THE  S22024 14600010
*                                         ENTRY FOR THIS UCB IN THE     14700010
*                                         DEVICE TABLE                  14800010
         LH    RE,TWO(RTIOT)            LOAD THE NUMBER OF              14900010
*                                         TRACKS/CYLINDER FOR THIS      15000010
*                                         PARTICULAR DEVICE             15100010
         EJECT                                                          15400010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     15500010
*                                                                 *     15600010
*             COUNT  NUMBER OF EXTENTS ON THIS DATA SET           *     15700010
*                                                                 *     15800010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     15900010
         SR    RC,RC                    CLEAR EXTENT COUNTER            16000010
         SR    RF,RF                      REGISTERS                     16100010
EXTLOOP  EQU   *                                                        16200010
         IC    RC,DSCNOEXT              PICK UP NUMBER OF EXTENTS       16300010
*                                         ON THIS VOLUME                16400010
         AR    RF,RC                    ADD TO PREVIOUS TOTAL           16500010
         L     RCORE,DSCCORE            LOAD CORE ADDRESS OF THE        16600010
*                                         NEXT DSCB RECORD              16700010
         LTR   RCORE,RCORE              TEST FOR END OF DSCB CHAIN      16800010
         BZ    ENDSCB                   BRANCH IF END OF CHAIN          16900010
TESTDSCB EQU   *                                                        17000010
         CLI   DSCFMTID,FORMAT1         IS NEW DSCB A FORMAT 1   S22024 17100010
         BE    EXTLOOP                  BRANCH IF A FORMAT 1            17200010
*                                                                       17300010
         L     RCORE,DSCCORE+FORM3EXT   LOAD ADDRESS OF NEXT DSCBS22024 17400010
         LTR   RCORE,RCORE              TEST FOR END OF DSCB CHAIN      17500010
         BNZ   TESTDSCB                 IF NOT END BRANCH TO TEST       17600010
*                                         FORMAT OF THIS DSCB           17700010
         EJECT                                                          17800010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     17900010
*                                                                 *     18000010
*        COMPUTE THE NUMBER OF BYTES REQUIRED FOR THE DEB         *     18100010
*                                                                 *     18200010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     18300010
ENDSCB   EQU   *                                                        18400010
         LR    RUCB,RF                  COPY THE NUMBER OF EXTENTS      18500010
         TM    DCBOPTCD,REUS+NONREUS    TEST FOR REUSABLE OR     S22024 18600010
*                                         NON-REUSABLE QUEUEING         18700010
         BNZ   TESTOPCD                 DETERMINE WHICH TYPE            18800010
         TM    DCBOPTCD,CHKPOINT+CKP3705   THIS CHKPOINT DCB   @G36XRNP 18900010
         BNZ   MULTIDEB                 GET THE DEB SIZE         S22024 19000010
         B     BADQUEUE                 BRANCH TO ERROR ROUTINE         19100010
TESTOPCD EQU   *                                                        19200010
         TM    DCBOPTCD,REUS            TEST FOR REUS QUEUEING   S22024 19300010
         BO    *+8                      YES, SKIP NEXT INSTRUCTION      19400010
         LA    RCORE,QUECONST           SET THE QUEUEING CONSTANT       19500010
         ST    RE,AVTTRCYR(RCORE)       STORE TRACKS/CYLINDER           19600010
*                                         VALUE IN THE AVT              19700010
         ST    RF,AVTNOVOR(RCORE)       STORE NUMBER OF EXTENTS         19800010
*                                         THE AVT                       19900010
MULTIDEB EQU   *                                                        20000010
         MH    RF,H20                   MULTIPLY THE NUMBER OF          20100010
*                                         EXTENTS BY 20                 20200010
         LA    RF,DEBSIZE(RF)           ADD 77 TO INITIAL SIZE          20300010
         LR    RC,RF                    COPY DEB SIZE                   20400010
         SRL   RC,SHIFT3                GET NUMBER OF DOUBLE WORDS      20500010
         LA    RE,AVTDOUBL              ADDRESS OF WORD TO HOLD         20600010
*                                         ADDRESS OF THE DEB            20700010
         MVI   AVTOPERT,TCAMER0E        MOVE THE ERROR IDENTIFIER       20800010
*                                         FOR TCAM INTO THE AVT         20900010
         MVI   AVTGETMN+NINE,SP230      SET THE SUBPOOL ID       Y02027 21000010
*                                         PARAMETER LIST                21400010
         BAL   RD,AVTPAR                SET UP PARM LIST IN AVT         21500010
         EJECT                                                          21600010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     21700010
*                                                                 *     21800010
*        INITIALIZATION OF THE DEB AND THE DCB                    *     21900010
*                                                                 *     22000010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     22100010
         L     RDEB,AVTDOUBL            SET DEB BASE REGISTER           22200010
         TM    DCBOPTCD,CHKPOINT+CKP3705   THIS CHKPOINT DCB   @G36XRNP 22300010
         BNZ   DEBINIT                  YES, BRANCH              S22024 22400010
         ST    RDEB,AVTADEBR(RCORE)     STORE DEB ADDRESS IN AVT        22500010
DEBINIT  EQU   *                                                        22600010
         XC    AVTEZERO(SIXTY8,RDEB),AVTEZERO(RDEB) ZERO FIRST   S22024 22700010
*                                        68 BYTES OF THE DEB     S22024 22800010
         L     RF,CVT                   ADDRESS OF THE CVT              22900010
         LA    RF,CVTBRET(RF)           ADDRESS OF THE APPENDAGE S22024 23000010
*                                         BRANCHING ROUTINE             23100010
         ST    RF,DEBEOEA         *********************************     23200010
         ST    RF,DEBSIOA         *********************************     23300010
         ST    RF,DEBPCIA         *********************************     23400010
         ST    RF,DEBCEA                SET CEA ADDRESS TO BR 14 S22024 23450010
         ST    RF,DEBXCEA         *********************************     23500010
         ST    RDEB,DEBEXSCL            STORE APPENDAGE TABLE ADDRESS   23600010
*                                         IN THE  DEB                   23700010
         MVI   DEBEXSCL,DIRACCES        INDICATE THAT THIS DEB IS       23800010
*                                         FOR A DIRECT ACCESS DEVICE    23900010
         LA    RF,DEBNMSUB              LOAD THE ADDRESS OF THE  Y02027 24000010
*                                         BASIC DEB                     24100010
         ST    RF,DCBDEBAD              STORE THE DEB ADDRESS IN Y02027 24200010
*                                         THE DCB                       24300010
         STC   RC,DEBLNGTH              STORE NUMBER OF DOUBLE WORDS    24400010
*                                         IN THE DEB                    24500010
         ST    RC,DEBWKARA              ZERO FIRST 3 BYTES OF WKARA     24600010
*                                          FIELD IN THE DEB             24700010
         L     RCORE,FOUR(,RWTGC)       RESTORE OPEN WORK AREA   S22024 24750010
*                                        ADDRESS                 S22024 24810010
         MVC   DEBWKARA+THREE(FIVE),DXCCW7 MOVE FIVE BYTES FROM  S22024 24870010
*                                        THE SEVENTH CHANNEL WORDS22024 24930010
         STC   RUCB,DEBNMEXT            STORE THE NUMBER OF EXTENTS     25000010
*                                         IN THE DEB                    25100010
         L     RC,AVTTCB                LOAD THE TCB ADDRESS            25200010
         ST    RC,DEBTCBAD              STORE TCB ADDRESS IN THE Y02027 25300010
*                                         DEB                           25400010
         L     RE,TCBDEB                LOAD THE ADDRESS OF THE  Y02027 25500010
*                                         FIRST DEB IN THE QUEUE        25600010
CHAINDEB ST    RE,DEBDEBAD              SAVE THE ADDRESS OF THE  Y02027 25700010
*                                         PREVIOUS DEB IN THIS   Y02027 25750010
         CS    RE,RF,TCBDEB             CHAIN THIS DEB TO THE    Y02027 25800010
*                                         TCB IF TCBDEB HAS NOT  Y02027 25850010
*                                         CHANGED                Y02027 25900010
         BNE   CHAINDEB                 CHECK AGAIN              Y02027 25950010
         SLL   RUCB,SHIFT2              MULTIPLY THE NUMBER OF   S22024 26000010
*                                         EXTENTS BY 4 TO GET THE       26100010
*                                         ACCESS METHOD LENGTH          26200010
         STC   RUCB,DEBAMLNG            STORE THIS LENGTH IN THE        26300010
*                                         DEB                           26400010
         ST    RDCB,DEBPROTG            STORE THE DCB ADDRESS IN        26800010
*                                         THE DEB                       26900010
         MVC   DEBPROTG(ONE),TCBPKF     MOVE PROTECTION TAG OF   S22024 27000010
*                                         TCB TO THE DEB                27100010
         OI    DEBPROTG,OPNDEBID        OR IN THE DEB IDENTIFIER        27200010
         MVC   DEBPRIOR(ONE),TCBDSP     MOVE TCB PRIORITY TO DEB S22024 27300010
         MVC   DEBOPATB(ONE),AVTEZERO(RPARC) MOVE ATTRIBUTES TO  S22024 27400010
*                                         THE DEB                       27500010
         NI    DEBOPATB,ATTRMASK        CLEAR EOL FLAG IF ON    SA54471 27550010
         EJECT                                                          27600010
         SPACE 2                                                        27610010
         DEBCHK (RDCB),TYPE=ADD,AM=TCAM INSERT DEB IN CHAIN      Y01004 27620010
         SPACE 2                                                        27630010
         EJECT                                                          27670010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     27700010
*                                                                 *     27800010
*                  XCTL TO NEXT OPEN EXECUTOR                     *     27900010
*                                                                 *     28000010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     28100010
*                                                                       28200010
ENDLOAD  EQU   *                                                        28300010
         MVC   AVTEZERO(TWO,RWTGC),OPENLD2 ID OF               @Z30X8NM 28400010
*                                        SECOND LOAD             S22024 28500010
         L     RCORE,FOUR(RWTGC)        ADDR OF OPEN WORK AREA   S22024 28600010
RELOOP   EQU   *                                                        28700010
         LA    RWTGC,EIGHT(RWTGC)       INCREMENT POINTER TO NXT S22024 28800010
*                                         ENTRY IN WTG TABLE            28900010
         LA    RPARC,FOUR(RPARC)        INCREMENT POINTER TO NXT S22024 29000010
*                                         DCB IN LIST                   29100010
         CLC   AVTEZERO(TWO,RWTGC),AMIDCNST IS THIS OPEN NEEDED  S22024 29200010
*                                        AGAIN                   S22024 29250010
*                                                                       29300010
         BE    RESTART                  IF YES, RETURN TO BEGINNING     29400010
*                                                                       29500010
*                                                                       29600010
         CLC   AVTEZERO(TWO,RWTGC),OPIDCNST TEST FOR END OF WTG  S22024 29700010
*                                        TABLE                   S22024 29750010
*                                                                       29800010
         BNE   RELOOP                   BRANCH IF NO             S21903 29900010
*                                                                       30000010
         LR    RPARC,RPAR               RESET POINTER TO FIRST OF       30100010
*                                         THE DCB PARAMETER LIST        30200010
         LA    RWTGC,THIRTY2(RWTG)      RESET POINTER TO FIRST OFS22024 30300010
*                                         THE WTG TABLE                 30400010
ZCHEK    EQU   *                                                        30500010
         CLI   AVTEZERO(RWTGC),AVTEZERO IS THE ENTRY ID ZERO     S22024 30600010
*                                                                       30700010
         BNE   XCTLRTN                  XCTL TO NEXT LOAD        S21903 30800010
*                                                                       30900010
         LA    RWTGC,EIGHT(RWTGC)       PICK UP ADDRESS OF NEXT  S22024 31000010
*                                         ENTRY IN WTG TABLE            31100010
         LA    RPARC,FOUR(RPARC)        INCREMENT POINTER TO THE S22024 31200010
*                                         NEXT DCB                      31300010
         B     ZCHEK                    CHECK NEXT ENTRY         S21903 31400010
*        TRANSFER CONTROL TO SYSTEM OPEN                                31500010
*                                                                       31600010
XCTLRTN  EQU   *                                                        31700010
         LA    RJ,DXCCW12               ADDRESS OF A DOUBLE WORD S22024 31800010
*                                                                       31900010
         MVC   SIX(TWO,RWTG),AVTEZERO(RWTGC) MOVE ID TO THE      S22024 32000010
*                                         PARAMETER LIST                32100010
XCTLRTN1 EQU   *                                                 Y05330 32350010
*                                                                       32400010
         XCTL  DE=(RWTG),SF=(E,(15))                                    32500010
         EJECT                                                          32600010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     32700010
*                                                                 *     32800010
*        THIS SECTION OF ERROR CODE IS EXECUTED ONLY WHEN         *     32900010
*        THE USER HAS SPECIFIED AN INCORRECT AVT TO SUPPORT       *     33000010
*                       DISK QUEUEING                                   33100010
*                                                                 *     33200010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     33300010
AVTERROR EQU   *                                                        33400010
         MVI   AVTOPERT,TCAMER0A        MOVE THE ERROR IDENTIFIER       33500010
*                                         FOR TCAM INTO THE AVT         33600010
         B     WTGSETUP                 SET THE WHERE-TO-GO ENTRY       34000010
         SPACE 3                                                 Y02027 34010010
         EJECT                                                          34100010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     34200010
*                                                                 *     34300010
*        THE USER HAS SPECIFIED CONFLICTING KEYLENGTH VALUES      *     34400010
*                                                                 *     34500010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     34600010
KEYLNGER EQU   *                                                        34700010
         MVI   AVTOPERT,TCAMER0B        MOVE THE ERROR IDENTIFIER       34800010
*                                         FOR TCAM INTO THE AVT         34900010
         B     WTGSETUP                 SET THE WHERE-TO-GO ENTRY       35300010
         SPACE 3                                                 Y02027 35309010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *Y02027 35318010
*                                                               *Y02027 35327010
*        THIS SECTION OF CODE IS EXECUTED ONLY WHEN THE         *Y02027 35336010
*        INVOKER IS NOT RUNNING IN PROTECT KEY 6                *Y02027 35345010
*                                                               *Y02027 35354010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *Y02027 35363010
NOTKEY6  EQU   *                                                 Y02027 35372010
         MVI   AVTOPERT,UNAUTHD         SET THE ERROR IDENTIFIER Y02027 35381010
         B     WTGSETUP                 GO TO THE XCTL ROUTINE   Y02027 35390010
         EJECT                                                          35400010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     35500010
*                                                                 *     35600010
*        THE EXTENTS OF THE MESSAGE QUEUES DATA SETS ARE          *     35700010
*        CONTAINED ON DIFFERENT TYPES OF DISK DRIVES              *     35800010
*                                                                 *     35900010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     36000010
BADISK   EQU   *                                                        36100010
         MVI   AVTOPERT,TCAMER0C        MOVE THE ERROR IDENTIFIER       36200010
*                                         FOR TCAM INTO THE AVT         36300010
         B     WTGSETUP                 SET THE WHERE-TO-GO ENTRY       36700010
         EJECT                                                          36800010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     36900010
*                                                                 *     37000010
*        THIS SECTION OF ERROR CODE IS EXECUTED ONLY WHEN AN      *     37100010
*        INVALID TYPE OF QUEUEING IS DETECTED IN THE DCB          *     37200010
*                                                                 *     37300010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     37400010
BADQUEUE EQU   *                                                        37500010
         MVI   AVTOPERT,TCAMER0D        MOVE THE ERROR IDENTIFIER       37600010
*                                         FOR TCAM INTO THE AVT         37700010
         B     WTGSETUP                 SET THE WHERE-TO-GO ENTRY       38100010
         EJECT                                                          38200010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     38300010
*                                                                 *     38400010
*        THIS ROUTINE SETS UP A PARAMETER LIST IN THE AVT.  THIS  *     38500010
*        LIST WILL BE REFERENCED BY ALL GETMAIN MACROS ISSUED     *     38600010
*        IN DISK OPEN.                                            *     38700010
*                                                                 *     38800010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     38900010
*                                                                       39000010
AVTPAR   EQU   *                                                        39100010
         ST    RF,AVTGETMN              STORE BYTE COUNT IN AVT         39200010
*                                         PARAMETER LIST.               39300010
         ST    RE,AVTGETMN+FOUR         STORE ADDR OF WORD IN    S22024 39400010
*                                         SECOND WORD OF AVT            39500010
*                                         PARAMETER LIST.               39600010
         LA    RF,AVTGETMN              LOAD ADDRESS OF AVT             39700010
*                                         PARAMETER LIST.               39800010
         SPACE 2                                                        39820010
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           Y02027 39840010
         SPACE 2                                                        39860010
         GETMAIN   ,MF=(E,(1))          GET AREA FOR CORE QUEUE.        39900010
         SPACE 2                                                        39920010
         MODESET EXTKEY=SUPR            RETURN TO KEY 0          Y02027 39940010
         SPACE 2                                                        39960010
*                                                                       40000010
         LTR   RJ,RJ                    TEST RETURN CODE                40100010
         BNZ   WTGSETUP                 THE GETMAIN FOR THE DEB WAS     40200010
*                                         NOT SUCCESSFUL                40300010
         BR    RD                       RETURN TO THE CALLING POINT     40400010
         EJECT                                                          40500010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     40600010
*                                                                 *     40700010
*        THIS SECTION OF CODE IS USED TO SAVE THE ID OF THE       *     40800010
*        CURRENT OPEN EXECUTOR AND TO MOVE THE ID OF THE          *     40900010
*        ERROR HANDLER INTO THE WHERE-TO-GO PARAMETER             *     41000010
*                            LIST                                 *     41100010
*                                                                 *     41200010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     41300010
WTGSETUP EQU   *                                                        41400010
         L     RCORE,FOUR(RWTGC)        LOAD THE  ADDRESS OF THE        41500010
*                                         OPEN WORK AREA                41600010
         MVC   AVTOPXCL(TWO),AMIDCNST   MOVE THE ID OF THE CURRENT      41700010
*                                         EXECUTOR INTO THE AVT         41800010
*                                         FOR THE RETURN TO THIS        41900010
*                                         EXECUTOR                      42000010
         MVC   AVTEZERO(TWO,RWTGC),OPENERP ID FOR              @Z30X8NM 42100010
*                                         ERROR HANDLER INTO THE        42200010
*                                         WHERE-TO-GO PARAMETER LIST    42300010
         B     XCTLRTN                  BRANCH TO THE XCTL ROUTINE      42400010
         EJECT                                                          42500010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   42600010
*                                                                       42700010
*                  CONSTANTS AND EQUATES                                42800010
*                                                                       42900010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   43000010
ZERO     EQU   0                        CONSTANT                 X01004 43020010
ALL      EQU   15                       MASK FOR ICM OF 4 BYTES  X02004 43060010
ONE      EQU   1                        OFFSET OF ONE            S22024 43100010
TWO      EQU   2                        OFFSET OF TWO            S22024 43170010
THREE    EQU   3                        OFFSET OF THREE          S22024 43250010
SHIFT2   EQU   2                        LOGICAL ARITHMETIC       S22024 43300010
SHIFT3   EQU   3                        LOGICAL ARITHMETIC       S22024 43380010
FOUR     EQU   4                        OFFSET OF 4              S22024 43460010
FIVE     EQU   5                        OFFSET OF 5              S22024 43540010
SIX      EQU   6                        OFFSET OF SIX            S22024 43620010
EIGHT    EQU   8                        OFFSET OF EIGHT          S22024 43640010
NINE     EQU   9                        OFFSET OF NINE           S22024 43660010
TCAMER0A EQU   10                       TCAM ERROR NO. 10        S22024 43700010
TEN      EQU   10                       OFFSET OF TEN            S22024 43800010
TCAMER0B EQU   11                       TCAM ERROR NO. 11        S22024 43900010
TCAMER0C EQU   12                       TCAM ERROR NO. 12        S22024 44000010
TIOT     EQU   12                       VALUE 12                 S22024 44100010
TCAMER0D EQU   13                       TCAM ERROR NO. 13        S22024 44200010
FORMAT3  EQU   13                       VALUE     13             S22024 44300010
FORMAT1  EQU   C'1'                     FORMAT ' DSCB IDENTIFIER S22024 44330010
FOURTEEN EQU   14                       OFFSET OF FOURTEEN       S22024 44360010
TCAMER0E EQU   14                       TCAM ERROR NO. 14        S22024 44400010
CVT      EQU   16                       CVT DISPLACEMENT         S22024 44500010
UCBTYPE  EQU   19                       INDEX BYTE OFFSET        S22024 44600010
QUECONST EQU   24                       NUMERIC CONSTANT                44700010
UNAUTHD  EQU   32                       UNAUTHORIZED INVOKER     Y02027 44750010
NEXTCPB  EQU   32                       VALUE 32                 S22024 44800010
THIRTY2  EQU   32                       OFFSET OF THIRTY-TWO     S22024 44850010
FORM3EXT EQU   44                       VALUE 44                 S22024 44900010
DADT     EQU   64                       DEVICE TABLE OFFSET      S22024 45000010
SIXTY8   EQU   68                       OFFSET OF SIXTY-EIGHT    S22024 45050010
DEBSIZE  EQU   77                       VALUE 77                 S22024 45100010
CVTBRET  EQU   82                       BR 14 INSTRUCTION IN CVT S22024 45130010
SP230    EQU   230                      SUBPOOL FOR DEB          Y02027 45160010
EXERR01  EQU   X'01'                    ERROR NO. 1              S22024 45200010
EXERR02  EQU   X'02'                    ERROR NO. 2              S22024 45300010
EXERR03  EQU   X'03'                    ERROR NO. 3              S22024 45400010
EXERR04  EQU   X'04'                    ERROR NO. 4              S22024 45500010
DIRACCES EQU   X'04'                    VALUE X'04'              S22024 45600010
EXERR05  EQU   X'05'                    ERROR NO. 5              S22024 45700010
OPNDEBID EQU   X'0F'                    IDENTIFIER FOR A DEB            45800010
REUS     EQU   X'01'                    OPTCD=R                  S22024 45900010
KEY6     EQU   X'60'                    PROTECT KEY 6            Y02027 45905010
NONREUS  EQU   X'02'                    OPTCD=L                  S22024 45910010
CKP3705  EQU   X'10'                    OPTCD=I                  S22024 45920010
CHKPOINT EQU   X'20'                    OPTCD=C                  S22024 45930010
ATTRMASK EQU   X'7F'                    HI BIT OFF              SA54471 45950010
FULLWORD DC    F'15'                    NUMERIC CONSTANT         S21903 46000010
HWORD    DC    H'0'                     NUMERIC CONSTANT         S21903 46100010
DDLENGTH DC    H'16'                    NUMERIC CONSTANT         S21903 46200010
H20      DC    H'20'                    NUMERIC CONSTANT         S21903 46300010
OPIDCNST DC    C'0S'                    ID OF LAST OPEN MODULE   S21903 46400010
AMIDCNST DC    C'30'                    ID FOR IGG01930                 46500010
OPENLD2  DC    C'31'                    ID OF THE SECOND OPEN LOAD      47200010
OPENERP  DC    C'33'                    ERROR HANDLER MODULE            47400010
         EJECT                                                          48000010
         TAVTD                          AVT MACRO                       48100010
         EJECT                                                          48200010
         TTCBD                                                          48300010
         EJECT                                                          48400010
         TDEBD                                                          48500010
         EJECT                                                          48600010
*                                                                     * 48620010
* PRIVATE IOB DSECT USED ONLY BY DISK OPEN                            * 48640010
*                                                                     * 48660010
IEDJCIOB DSECT                                                   S22024 48700010
JOBFLAG1 DS    C                        FIRST FLAG BYTE          S21903 48800010
JOBFLAG2 DS    C                        SECOND FLAG BYTE         S21903 48900010
JOBSENSO DS    C                        FIRST SENSE BYTE         S21903 49000010
JOBSENS1 DS    C                        SECOND SENSE BYTE        S21903 49100010
JOBECBCC DS    C                   COMPLETION CODE                      49200010
JOBECBPT DS    AL3                 ADDRESS OF THE ECB                   49300010
JOBFLAG3 DS    C                   I/O ERROR FLAGS                      49400010
JOBCSW   DS    CL7                 CSW                                  49500010
JOBSIOCC DS    C                   SIO CONDITION CODES                  49600010
JOBSTART DS    AL3                 ADDRESS OF CHANNEL PROGRAM           49700010
JOBRSVD  DS    C                   RESERVED                             49800010
JOBDCBPT DS    AL3                 ADDRESS OF THE DCB                   49900010
JOBOPCOD DS    C                   OP CODE                              50000010
JOBRESTR DS    AL3                 RESTART ADDRESS OF IOS               50100010
JOBINCAM DS    H                   BLOCK COUNT                          50200010
JOBERRCT DS    H                   NUMBER OF ERROR RETRIES              50300010
JOBSEEK  DS    CL8                 MBBCCHHR                             50400010
JOBXECB  DS    F                   ECB                                  50500010
JOBXCC   DS    C                   CURRENT ARM POSITION - CYL           50600010
JOBXRETQ DS    AL3                 ADDRESS OF QUEUE OF CPB'S            50700010
*                                    AVAILABLE TO DISK END FOR RETRY    50800010
JOBXLOCK DS    C                   FLAG BITS                            50900010
JOBXNEWQ DS    AL3                 ADDR OF CPB QUE BEING BUILT          51000010
JOBEND   EQU   *                                                        51100010
         EJECT                                                          51200010
         TCPBD                                                          51300010
         EJECT                                                          51400010
FORCORE  DSECT                                                          51500010
         IECDSECT                                                       51600010
         EJECT                                                          51700010
         DCBD  DSORG=TQ                 DCB DSECT                       51800010
         END                                                            51900010
