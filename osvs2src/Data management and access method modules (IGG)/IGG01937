         TITLE 'IGG01937 THIRD LOAD OF LINE GROUP OPEN'                 00100010
IGG01937 CSECT                                                          00200010
         SPACE 3                                                        00200210
*  CHANGE ACTIVITY AS FOLLOWS                                           00200410
******************** MICROFICHE FLAGS *********************** SUPT CODE 00200610
*C002986,238000-239000                                           X01004 00200710
*D081000,091000-222000,519000-533000,553000-553500,556000,602600 X01004 00200810
*C101000-104000,107000,557000-562000,565000-566000,568000        S21903 00201010
*C569000-578000,580000,581000-586000,594000                      S21903 00201110
*C085400,443300,443600                                           S22029 00201210
*A104000,219000                                                  A42373 00201310
*C105000,220000                                                  A42373 00201410
*D221000                                                         A42373 00201510
*A265000                                                         A42381 00201610
*A173300                                                         S22025 00201710
*C085400,466000,471080-471800                                     M1178 00201810
*A365000,471000                                                  A44908 00201910
*C085000,466000-467000                                           A44908 00202010
*D444000-449000                                                  A44908 00202110
*A265210-265260                                                  A51796 00202210
*C085400,265200                                                  A51796 00202310
*A129000                                                         A48258 00202410
*C313000-317000                                                  A48258 00202510
*A010100-010600,223000-229400,265010-265070,340050-340850        S22026 00202610
*A580300-580600,614200-614600                                    S22026 00202710
*A121300-121600,166500,173050,553500,572500                      S22026 00202810
*C010000                                                         S22026 00202910
*C085200-085400,123000-126000,174000,262420,262600,262720        S22026 00203010
*C328000-334000                                                  S22026 00203110
*D223000-230000                                                  S22026 00203210
*D138000-139000,157000-165000,170000-171000,178000-187000        S22026 00203310
*D248000-249000,262060,388000-389000,554000                      S22026 00203410
*A002990                                                         S22025 00203510
*C040000,083000,416000,430000,555000,595000-596000,599000        S22025 00203610
*C601000-602000                                                  S22025 00203710
*A002000                                                         S21903 00203810
*C002010-002992,003000                                           S21903 00203910
*D198000,318000,375000,397000,564000,567000,579000,              S21903 00204010
*D582000,587000,610000                                           S21903 00204110
*A340850                                                        SA57354 00204210
*C003900,019000,022000,028000,043000,044000,045000,059000,071000 Y02027 00204310
*C080000,087000-090000,366000-367000,400000,402000,430500,435000 Y02027 00204410
*C563000                                                         Y02027 00204510
*D073000                                                         Y02027 00204610
*A050010-050040,081000,097000-147000,367500,567000,602200        Y02027 00204710
*A471880                                                       @SA70305 00204810
*C471720                                                       @SA70305 00204910
*D050010-050030                                                @ZA01156 00244910
*C485000                                                       @YA11150 00264910
*A471940                                                       @OY12667 00265010
         SPACE 3                                                        00299210
*********************************************************************** 00300010
*                                                                     * 00309010
*TITLE:  'IGG01937'  THIRD LOAD OF LINE GROUP OPEN                    * 00318010
*                                                                     * 00327010
*  MODULE NAME = IGG01937  (TCAM,INITIALIZATION)               @G36XRNP 00336010
*                                                                     * 00345010
*  DESCRIPTIVE NAME = THIRD LOAD OF LINE GROUP OPEN                   * 00354010
*                                                                     * 00363010
*  COPYRIGHT =  'NONE'                                                * 00372010
*                                                                     * 00381010
*  STATUS = CHANGE LEVEL 10.0                                  @G36XRNP 00390010
*                                                                     * 00400010
*FUNCTION/OPERATION - THIS ROUTINE COMPUTES THE SIZE OF THE           * 00500010
*   ENTIRE LCB AREA REQUIRED FOR THIS LINE GROUP AND ISSUES           * 00600010
*   A GETMAIN MACRO INSTRUCTION FOR THE MAIN STORAGE.  THE            * 00700010
*   ENTIRE AREA IS THEN DIVIDED INTO INDIVIDUAL LCB'S FOR             * 00800010
*   EACH LINE AND THE INDIVIDUAL LCB'S ARE INITIALIZED                * 00900010
*   PRIOR TO BUILDING CHANNEL PROGRAMS FOR THE LCB'S.                 * 01000010
*   THIS ROUTINE ALSO INSERTS THE SEND SCHEDULER STCB INTO THE   S22026 01010010
*   STCB CHAIN OF THE LCB BY PRIORITY.  FOR CONCENTRATORS, THE   S22026 01020010
*   CONCENTRATOR SEND SCHEDULER STCB IS INSERTED INTO THE LCB    S22026 01030010
*   STCB CHAIN.  FOR TERMINALS ATTACHED TO CONCENTRATORS, THE    S22026 01040010
*   CONCENTRATOR SEND SCHEDULER STCB IS INSERTED INTO THE        S22026 01050010
*   ELEMENT CHAIN OF THE DATA READY QUEUE.                       S22026 01060010
*                                                                     * 01100010
*ENTRY POINTS - THIS ROUTINE IS ENTERED AT IGG01937 VIA AN            * 01200010
*   XCTL FROM THE OPEN EXECUTOR IGG01936.  IT MAY ALSO BE             * 01300010
*   RE-ENTERED FROM THE RELOOP PORTION OF THIS ROUTINE IF             * 01400010
*   IT IS DETERMINED THAT THERE IS ANOTHER DATA CONTROL               * 01500010
*   BLOCK TO BE OPENED.                                               * 01600010
*                                                                     * 01700010
*INPUT - THE REGISTERS 5, 6, 7, AND 8 ARE THE INPUT AS FOLLOWS        * 01800010
*   5 - THE ADDRESS OF THE WTG TABLE PREFIX                      Y02027 01900010
*   6 -  THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE.       * 02100010
*   7 - THE ADDRESS OF THE COPY OF THE CURRENT DCB               Y02027 02200010
*   8 -  THE ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO          * 02400010
*        TABLE .                                                      * 02500010
*                                                                     * 02600010
*OUTPUT - REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT            * 02700010
*   ENTRIES IN THE WHERE-TO-GO PREFIX TABLE AND                  Y02027 02800010
*   THE WHERE-TO-GO TABLE RESPECTIVELY.  LINE CONTROL BLOCKS          * 02900010
*   WILL HAVE BEEN BUILT AND INITIALIZED FOR EACH LINE IN             * 03000010
*   THE LINE GROUP                                                    * 03100010
*                                                                     * 03200010
*EXTERNAL ROUTINES - NONE                                             * 03300010
*                                                                     * 03400010
*EXITS - NORMAL                                                       * 03500010
*   THIS ROUTINE EXITS VIA AN XCTL TO THE EXECUTOR IDENTIFIED         * 03600010
*   BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE               * 03700010
*   NAMELY IGG01938                                                   * 03800010
*                                                                     * 03900010
*EXITS - ERROR  NONE                                             S22025 04000010
*                                                                     * 04100010
*TABLES/WORK AREAS - THE WHERE-TO-GO TABLE CONTAINS THE ID AND        * 04200010
*   TTR OF THE OPEN EXECUTORS.  THE WHERE-TO-GO PREFIX           Y02027 04300010
*   TABLE CONTAINS THE ADDRESS OF A COPY OF EACH DCB             Y02027 04400010
*   SPECIFIED IN THE OPEN MACRO INSTRUCTION.                     Y02027 04500010
*                                                                     * 04600010
*ATTRIBUTES - THIS ROUTINE IS EXECUTED IN THE TRANSIENT AREA AS       * 04700010
*   ENABLED, PRIVILEGED, AND RE-ENTRANT.                              * 04800010
*                                                                     * 04900010
*                                                                     * 05000010
*********************************************************************** 05004010
         EJECT                                                          05100010
*REGISTER USAGE                                                         05400010
*                                                                       05500010
RE       EQU   0                        WORK REGISTER                   05600010
RF       EQU   1                        WORK REGISTER                   05700010
RDCB     EQU   2                        ADDRESS OF THE CURRENT DCB      05800010
RTIOT    EQU   3                        ADDRESS OF THE TIOT      Y02027 05900010
RCORE    EQU   4                        ADDRESS OF DCB WORK AREA        06000010
RPAR     EQU   5                        ADDRESS OF FIRST ENTRY IN       06100010
*                                         DCB PARAMETER LIST            06200010
RWTG     EQU   6                        ADDRESS OF WHERE-TO-GO TABLE    06300010
RPARC    EQU   7                        ADDRESS OF CURRENT ENTRY IN     06400010
*                                         DCB PARAMETER LIST            06500010
RWTGC    EQU   8                        ADDRESS OF CURRENT ENTRY IN     06600010
*                                         WHERE-TO-GO TABLE             06700010
RAVT     EQU   9                        ADDRESS OF THE AVT              06800010
RUCB     EQU   10                       ADDRESS OF CURRENT UCB          06900010
RDEB     EQU   11                       ADDRESS OF THE DEB              07000010
RBASE    EQU   12                       BASE REGISTER            Y02027 07100010
RC       EQU   13                       WORK REGISTER                   07200010
RJ       EQU   15                       WORK REGISTER                   07400010
*                                                                       07500010
         USING IEDQAVTD,RAVT            AVT DSECT                       07600010
         USING IHADCB,RDCB              DCB DSECT                       07700010
         USING IEDQTNTD,RJ              TERMINAL NAME TABLE DSECT       07800010
         USING IEDQQCB,RTIOT            QCB DSECT                       07900010
         USING FORCORE,RCORE            OPEN WORK AREA DSECT     Y02027 08000010
         USING IEDQTCX,RF               TCAM CVT EXTENSION DSECT Y02027 08100010
*                                                                       08200010
         BALR  RBASE,0                  ESTABLISH BASE REGISTER  S22025 08300010
         USING *,RBASE                                                  08400010
         SPACE 2                                                        08450010
         B     INIT1937                 BRANCH AROUND ID         A44908 08500010
         DC    CL2'19'                  1ST PART OF MODULE NAME  S22026 08520010
AMIDCNST DC    CL2'37'                  2ND PART OF MODULE NAME  S22026 08530010
         IEDHJN                                                         08540010
*                                                                A44908 08560010
INIT1937 EQU   *                                                 A44908 08580010
RESTART  EQU   *                                                        08600010
         L     RCORE,FOUR(RWTGC)        GET THE ADDRESS OF THE   Y02027 08700010
*                                         OPEN WORK AREA         Y02027 09700010
         L     RDCB,DXUDCBAD            GET THE ADDRESS OF THE   Y02027 10700010
*                                         USER'S DCB             Y02027 11700010
         L     RF,CVT                   GET THE CVT ADDRESS      Y02027 12700010
         L     RF,AVTCVTPT(RF)          GET THE TCX ADDRESS      Y02027 13700010
         L     RAVT,TCXAVT              GET THE AVT ADDRESS      Y02027 14700010
         EJECT                                                          15700010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  S22026 22300010
*                                                             *  S22026 22380010
*        THIS SECTION OF CODE LINKS THE STCB FOR THE SEND     *  S22026 22460010
*        SCHEDULER INTO THE STCB CHAIN OF THE LCB BY          *  S22026 22540010
*        PRIORITY.  FOR TERMINALS ATTACHED TO CONCENTRATORS,  *  S22026 22620010
*        IT LINKS THE CONCENTRATOR SEND SCHEDULER INTO THE    *  S22026 22700010
*        ELEMENT CHAIN OF THE DATA READY QUEUE.               *  S22026 22780010
*                                                             *  S22026 22860010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  S22026 22940010
         L     RJ,AVTRNMPT              ADDRESS OF THE TERMNAME         23100010
*                                         TABLE                         23200010
         LH    RF,TNTLEN                THE NUMBER OF ENTRIES IN THE    23300010
*                                         TERMNAME TABLE                23400010
          LA   RDEB,TNTFIRST            ADDRESS OF FIRST ENTRY          23500010
         SR    RC,RC                    CLEAR LENGTH REGISTER           23600010
          IC   RC,TNTENLEN              LENGTH OF COMPARAND FIELD       23700010
         SR    RUCB,RUCB                CLEAR FOR INSERT         X01004 23800010
         IC    RUCB,DCBEIOBX            GET LENGTH OF LCB        X01004 23900010
TERMAD    EQU  *                                                        24000010
         LA    RDEB,0(RC,RDEB)          TERMINAL TABLE ADDRESS          24100010
         MVC   AVTGETMN+5(THREE),0(RDEB) MOVE THE CURRENT TERMINAL      24200010
*                                          ADDRESS INTO A SCRATCH       24300010
*                                          AREA                         24400010
         L     RTIOT,AVTGETMN+4         LOAD THE TERMINAL ADDRESS       24500010
         L     RTIOT,0(RTIOT)           ADDRESS OF THE DESTINATION      24600010
*                                         QCB                           24700010
         L     RJ,QCBRELLN              LOAD THE ADDRESS OF THE DCB     25000010
         LA    RJ,0(RJ)                 CLEAR THE HIGH ORDER BYTE       25100010
*                                         OF THE ADDRESS                25200010
         LA    RDCB,ZERO(RDCB)          CLEAR THE HIGH ORDER BYTE       25300010
*                                         OF THE DCB ADDRESS            25400010
         CR    RJ,RDCB                  IS THIS THE CORRECT DCB         25500010
         BNE   TERMADL                  GO TO NEXT ENTRY                25600010
         L     RJ,DCBDEBAD              LOAD THE ADDRESS OF THE DEB     25700010
         CLC   EXTNTCNT(ONE,RJ),QCBRELLN    ARE THE NUMBER OF LINES     25800010
*                                           BEING OPENED LESS THAN      25900010
*                                           THE RELATIVE LINE NUMBER    26000010
*                                           OF THIS TERMINAL ENTRY      26100010
         BL    TERMADL                  YES, THEN IGNORE THIS QCB       26200010
         SR    RCORE,RCORE              CLEAR FOR THE RELATIVE LINE     26212010
*                                         NUMBER                        26218010
         IC    RCORE,QCBRELLN           GET THE RELATIVE LINE           26224010
*                                         NUMBER ASSOCIATED WITH        26230010
*                                         THIS LINE                     26236010
         SLL   RCORE,TWO                MULT BY 4                S22026 26242010
         L     RCORE,UCBADDR(RCORE,RJ)  GET THE UCB ADDRESS FOR         26248010
*                                         THIS LINE                     26254010
         LTR   RCORE,RCORE              BRANCH IF THIS LINE      S22026 26260010
         BZ    TERMADL                  ASSOCIATED W/ A DD DUMMY S22026 26266010
*                                       ENTRY; DON'T PUT SEND    S22026 26272010
*                                         SCHEDULER IN THE STCB         26278010
*                                         CHAIN OF THIS QCB             26284010
         USING IEDQTRM,RJ               TERMINAL TABLE DSECT     S22027 26285010
         L     RJ,AVTGETMN+4            LOAD THE ADDRESS OF THE  S22027 26286010
*                                         TERMINAL ENTRY         S22027 26287010
         SR    RCORE,RCORE              CLEAR THE REGISTER       S22027 26288010
         IC    RCORE,TRMCHCIN           GET CHARACTERISTICS INDEXS22027 26289010
         BCTR  RCORE,ZERO1              DECREMENT BY ONE         S22027 26290010
         MH    RCORE,AVTDCTLN           MULTIPLY INDEX BY THE  @G36XRNP 26291010
*                                       SIZE OF A DCT ENTRY    @G36XRNP 26291510
         A     RCORE,AVTCSTCS           DCT BASE                 S22027 26292010
         DROP  RCORE                                           @G36XRNP 26292310
         USING IEDDCT,RCORE             DCT ADDRESSABILITY     @G36XRNP 26292610
         TM    DCTBYTE2,DCTBRDST        IS THIS A BROADCAST TRM@G36XRNP 26293010
         BO    TERMADL                  DO NOT PUT SEND          S22027 26294010
*                                         SCHEDULER IN THE STCB  S22027 26295010
*                                         CHAIN                  S22027 26296010
         LR    RJ,RCORE                 SAVE DCT ADDRESS       @G36XRNP 26298010
         LA    RE,QCBSTVTO              LOAD THE ADDRESS OF THE@G36XRNP 26300010
*                                         SUBTASK VECTOR INDEX          26308010
         ST    RE,AVTGETMN              STORE IT IN THE AVT    @G36XRNP 26316010
         LA    RE,IOBPTR                LOAD THE IOB OFFSET    @G36XRNP 26324010
         L     RCORE,DCBIOBAD           LOAD THE STARTING ADDRESS       26332010
*                                         OF THE IOB                    26340010
         SR    RCORE,RE                 SUBTRACT THE IOB OFFSET@G36XRNP 26348010
*                                       FROM THE IOB START ADDRESS      26356010
         SR    RE,RE                    CLEAR LINE REGISTER             26364010
         IC    RE,QCBRELLN              GET RELATIVE LINE NUMBER        26372010
         DROP  RCORE                    DROP DCT ADDRESSABILITY@G36XRNP 26380010
         USING IEDQLCB,RCORE            LCB ADDRESSABILITY     @G36XRNP 26388010
LCBAD    EQU   *                                                        26400010
         LA    RCORE,ZERO(RUCB,RCORE)   BUMP LCB POINTER                26410010
         BCT   RE,LCBAD                 DECREASE LINE NUMBER            26420010
         TM    DCTBYTE1-IEDDCT(RJ),DCTUMASK IS THIS GEN POLL   @G36XRNP 26430010
*                                       CLUSTER                @G36XRNP 26440010
         BO    SETDCBAD                 YES BYPASS STCB SETUP  @ZM46673 26445010
         CLI   QCBSTVTO,CSVTO           DOES VECTOR TABLE OFFSET S22026 26450010
*                                       POINT TO CONC SCHED      S22026 26460010
         BNE   NOCONC                   BRANCH IF NO             S22026 26503010
         CLI   QCBDSFLG,QCBDRQQ         IS THIS A DATA READY     S22026 26504010
*                                         QUEUE QCB              S22026 26505010
         BNE   NODIAL                   BRANCH IF NO             S22026 26506010
NOCONC   EQU   *                                                 S22026 26507010
         MVI   AVTOPERT,TCAMER16        SET ERROR CODE           S22027 26508010
         CLI   QCBSTPRI,NOTDIAL         DIAL TERMINAL            A42381 26510010
         BNE   DIALINE                  BRANCH YES               A51796 26520010
         TM    LCBSTAT2,LCBDIAL         DIAL LINE                A51796 26521010
         BZ    NODIAL                   BOTH AGREE               A51796 26523010
         B     GETERR                   PASS ERROR ON            A51796 26525010
DIALINE  EQU   *                                                 A51796 26526010
         TM    LCBSTAT2,LCBDIAL         DIAL LINE                A51796 26540010
         BZ    GETERR                   NO, EXIT FOR ERROR WORK  A42381 26550010
NODIAL   EQU   *                                                 A42381 26560010
         CLC   QCBSTCHN(THREE),AVTGETMN+1    IS THIS QCB ALREADY        26600010
*                                            CHAINED OFF THE LCB        26700010
         BNE   SETLINE                  YES, THEN DO NOT RECHAIN        26800010
*                                         THE QCB                       26900010
         EJECT                                                          29200010
         USING IEDQTRM,RJ               TERMINAL TABLE DSECT            29600010
*                                       RE-ASSIGN RJ AS THE BASE        29700010
*                                       FOR THIS DSECT                  29800010
         L     RJ,AVTGETMN+4            LOAD THE ADDRESS OF THE         29900010
*                                         TERMINAL ENTRY                30000010
         TM    TRMDEVFL,BFRDTERM        IS THIS A BUFFERED TERMINAL     30100010
         BZ    SETDUMEL                 NO, BRANCH                      30200010
         MVI   LCBRSKEY,BUFTSCHD        MOVE THE BUFFERED TERMINAL      30300010
*                                         SCHEDULER OFFSET INTO THE     30400010
*                                         LCB                           30500010
         MVI   LCBRSPRI,EQULPRI         FORCE AN EQUAL PRIORITY FOR     30600010
*                                         BUFFERED TERMINALS            30700010
         B     SETUP                    BRANCH TO CHAIN THE STCB'S      30800010
SETDUMEL EQU   *                                                        30900010
         TM    QCBDSFLG,QCBTSQ          TS TERMINAL ON LINE      S22029 30920010
         BZ    NOTTSQ                   BRANCH IF NO             S22029 30940010
         MVI   LCBRSPRI,SENDPRI         FORCE SEND PRIORITY      S22029 30960010
NOTTSQ   EQU   *                                                 S22029 30980010
         TM    LCBSTAT2,LCBDIAL         DIAL LINE                A51796 31000010
         BNZ   DIALOUT1                 BRANCH IF DIAL TO CHAIN  A48258 31300010
*        THE STCB'S FROM THE DIAL OUT CALL QUEUE.  THE SCHEDULAR A48258 31400010
*        PRIORITY HAS BEEN SET ALREADY                           A48258 31500010
         TM    0(RPARC),OUTONLY         IS THIS LINE TO BE OPENED       31900010
*                                         FOR OUTPUT ONLY               32000010
         BNO   CLEARPRI                 NO, BRANCH                      32100010
         MVC   LCBSTCBA(THREE),AVTDELAD+1    MOVE THE ADDRESS OF        32200010
*                                            THE DUMMY LAST ELEMENT     32300010
*                                            INTO THE LCB               32400010
CLEARPRI EQU   *                                                        32500010
         SR    RJ,RJ                    CLEAR A PRIORITY REGISTER       32600010
         IC    RJ,DCBCPRI               PICK UP THE DCB PRIORITY        32700010
         SLA   RJ,FIVE                  SHIFT PRIORITY TO LEFT   S22026 32800010
         BNZ   STCPRI                   BRANCH IF A PRIORITY HAS S22026 32900010
*                                         BEEN SPECIFIED IN DCB  S22026 33000010
         LA    RJ,SENDPRI               NO PRIORITY SPECIFIED,   S22026 33100010
*                                         LOAD DEFAULT VALUE     S22026 33200010
*                                                                S22026 33300010
STCPRI   EQU   *                                                 S22026 33400010
         STC   RJ,LCBRSPRI              SET THE TCAM PRIORITY IN        33500010
*                                         THE LCB                       33600010
SETUP EQU *                                                             33700010
         LA    RJ,LCBRSKEY              SET THE CHAIN POINTER           33800010
         LA    RDCB,LCBPRI              GET THE ADDRESS OF THE LINK     33900010
*                                         FIELD                         34000010
*                                                                S22026 34005010
* IF TERMINAL ATTACHED TO A CONCENTRATOR, SET UP REGISTERS TO    S22026 34010010
* MOVE STCB INTO DATA READY QUEUE ELEMENT CHAIN                  S22026 34015010
*                                                                S22026 34020010
         CLI   QCBSTVTO,CSVTO           DOES VECTOR TABLE OFFSET S22026 34025010
*                                         POINT TO CONC SCHED    S22026 34030010
         BNE   NOCONCX                  BRANCH IF NO             S22026 34035010
         CLI   QCBDSFLG,QCBDRQQ         IS THIS A DATA READY     S22026 34040010
*                                         QUEUE QCB              S22026 34045010
         BE    NOCONCX                  BRANCH IF YES            S22026 34050010
         LR    RJ,RTIOT                 ADDR OF QCB              S22026 34055010
         AH    RJ,QCBEXTO               ADDR OF QCBE             S22026 34060010
         L     RJ,QCBECONC-1-IEDQQCBE(RJ)  ADDR OF CONC TERM     S22026 34065010
         L     RJ,TRMDESTQ-1-IEDQTRM(RJ)  ADDR OF DATA READY Q   S22026 34070010
         LR    RDCB,RJ                  ADDR OF DATA READY Q     S22026 34075010
         SH    RDCB,AVTHA4                MINUS FOUR             S22026 34080010
NOCONCX  EQU   *                                                 S22026 34085010
         TM    ZERO(RPARC),OUTONLY      INPUT ONLY              SA57354 34088010
         BZ    SETDCBAD                 BR YES SKIP SETTING UP  SA57354 34091010
*                                         SEND SCHED STCB       SA57354 34094010
         L     RJ,0(RJ)                 GET THE ADDRESS OF THE          34100010
*                                         FIRST ELEMENT ON THE CHAIN    34200010
COMPRITY EQU   *                                                        34300010
         CLC   FOUR(ONE,RJ),QCBSTPRI    COMPARE THE PRIORITIES OF       34400010
*                                         THE 2 ELEMENTS                34500010
         BL    INSERT                   IF THE CURRENT ELEMENT IS       34600010
*                                         LOW, INSERT THE NEW           34700010
*                                         ELEMENT ABOVE IT ON THE       34800010
*                                         CHAIN                         34900010
         LR    RDCB,RJ                  COPY THE ADDRESS OF THE         35000010
*                                         CURRENT ELEMENT               35100010
         L     RJ,FOUR(RJ)              GET THE ADDRESS OF THE NEXT     35200010
*                                         ELEMENT                       35300010
         B     COMPRITY                 CHECK THE NEXT ELEMENT          35400010
INSERT   EQU   *                                                        35500010
         MVC   FIVE(THREE,RDCB),QCBSTCHN     PUT THE NEW STCB INTO      35600010
*                                              THE CHAIN                35700010
         MVC   QCBSTCHN(THREE),QCBSLINK MOVE THE STCB LINK POINTER      35800010
*                                         INTO THE STCB POINTER IN      35900010
*                                         THE QCB                       36000010
         IC    RE,QCBSTPRI              SAVE THE PRIORITY OF THE        36100010
*                                         NEW ELEMENT                   36200010
         ST    RJ,QCBSTPRI              SET THE ENDING ADDRESS OF       36300010
*                                         THE CHAIN                     36400010
         STC   RE,QCBSTPRI              RESTORE THE SAVED PRIORITY      36500010
SETDCBAD EQU   *                                                 A44908 36550010
         L     RDCB,FOUR(RWTGC)         GET THE ADDRESS OF THE   Y02027 36600010
*                                         OPEN WORK AREA         Y02027 36650010
         L     RDCB,DXUDCBAD-DXDSCB(RDCB)  LOAD THE ADDRESS OF   Y02027 36700010
*                                         THE CURRENT DCB        Y02027 36750010
         EJECT                                                          36800010
SETLINE  EQU   *                                                        36900010
         IC    RE,QCBRELLN              GET THE RELATIVE LINE NUMBER    37000010
         TM    LCBSTAT2,LCBDIAL         DIAL LINE                A51796 37100010
         BNZ   LINENT2                  YES, BRANCH                     37400010
         CLI   QCBSCBOF,X'00'           IS THE SCB OFFSET ZERO          37600010
         BNE   CLEARIT                  NO, BRANCH                      37700010
         NC    QCBEOLDT+1(2),QCBEOLDT+1 IS THE STATION CONTROL     0109 37800010
*                                         BLOCK ADDRESS ALREADY         37900010
*                                         ZERO                          38000010
         BZ    TERMADL                  YES, BRANCH                     38100010
         MVC   LCBSCBDA(3),QCBEOLDT+1   MOVE THE ADDRESS OF THE         38200010
*                                         STATION CONTROL BLOCK         38300010
*                                         DIRECTORY INTO THE LCB        38400010
         MVC   LCBSCBA(3),QCBEOLDT+1   INIT FIRST SCB POINTER           38700010
CLEARIT  EQU   *                                                        39000010
         XC    QCBEOLDT+1(3),QCBEOLDT+1                                 39100010
         MVC   QCBSTAT,QCBLINK+2        SET THE QCB STATUS IN CASE      39130010
*                                         THIS IS A RESTART             39160010
TERMADL  EQU   *                                                        39200010
          LA   RDEB,3(RDEB)             BUMP TERMNAME TABLE ADDRESS     39300010
          BCT  RF,TERMAD                DECREASE ENTRIES BY 1           39400010
*                                                                       39500010
         EJECT                                                          39600010
         MVC   0(5,RWTGC),TCAMLD4       MOVE THE ID TTR AND LENGTH      39800010
*                                         TO THE WHERE-TO-GO TABLE      39900010
         L     RCORE,FOUR(RWTGC)        LOAD THE ADDRESS OF THE  Y02027 40000010
*                                         OPEN WORK AREA                40100010
         STM   RE,RJ,ZERO1(RCORE)       SAVE THE REGISTERS FOR   Y02027 40200010
*                                         IGG01938                      40300010
*                                                                       40400010
RELOOP   EQU   *                                                        40500010
         LA    RWTGC,8(RWTGC)           INCREMENT POINTER TO NEXT       40600010
*                                         ENTRY IN WTG TABLE            40700010
         LA    RPARC,4(RPARC)           INCREMENT POINTER TO NEXT       40800010
*                                         DCB                           40900010
         CLC   0(2,RWTGC),AMIDCNST      IS IGGO1930 REQUIRED AGAIN      41000010
*                                                                       41100010
         BE    RESTART                  NO, GO CHECK FOR END OF THE     41200010
*                                         WTG TABLE                     41300010
         CLC   0(2,RWTGC),OPIDCNST      TEST FOR END OF WTG TABLE       41400010
*                                                                       41500010
         BNE   RELOOP                   BRANCH IF NOT AT THE END S22025 41600010
*                                                                       41700010
         LR    RPARC,RPAR               RESET POINTER TO FIRST OF       41800010
*                                         DCB PARAMETER LIST            41900010
         LA    RWTGC,32(RWTG)           RESET POINTER TO FIRST OF       42000010
*                                         THE WTG TABLE                 42100010
ZCHEK    EQU   *                                                        42200010
         CLI   0(RWTGC),X'00'           IS THIS ENTRY'S ID ZERO         42300010
         BNE   XCTLRTN                  IF NOT, TRANSFER CONTROL        42400010
*                                                                       42500010
         LA    RWTGC,8(RWTGC)           PICK UP ADDRESS OF NEXT         42600010
*                                         ENTRY IN WTG TABLE            42700010
         LA    RPARC,4(RPARC)           BUMP POINTER TO NEXT DCB        42800010
*                                                                       42900010
         B     ZCHEK                    CHECK NEXT ENTRY ID      S22025 43000010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     43005010
*                                                                 *     43010010
*        THIS SECTION OF CODE IS USED TO SAVE THE ID OF THE       *     43015010
*        CURRENT OPEN EXECUTOR AND TO MOVE THE ID OF THE          *     43020010
*        ERROR RECOVERY MODULE INTO THE WHERE-TO-GO PARAMETER     *     43025010
*                            LIST                                 *     43030010
*                                                                 *     43035010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     43040010
GETERR   EQU   *                                                        43045010
         L     RCORE,FOUR(RWTGC)        LOAD THE ADDRESS OF THE  Y02027 43050010
*                                         OPEN WORK AREA                43055010
         MVC   AVTOPXCL(TWO),AMIDCNST   MOVE THE ID OF THE CURRENT      43060010
*                                         EXECUTOR INTO THE AVT FOR     43065010
*                                         THE RETURN TO THIS EXECUTOR   43070010
         MVC   0(FIVE,RWTGC),OPENERP    MOVE THE ID AND TTR FOR THE     43075010
*                                         ERROR MODULE INTO THE         43080010
*                                         WHERE-TO-GO PARAMETER LIST    43085010
*                                                                       43100010
*   TRANSFER CONTROL TO THE OPERATING SYSTEM                            43200010
*                                                                       43300010
XCTLRTN  EQU   *                                                        43400010
         LA    RJ,DXCCW12-DXLBL(RCORE)  LOAD THE ADDRESS OF THE  Y02027 43500010
*                                         LAST DOUBLE WORD IN THE       43600010
*                                         OPEN WORK AREA                43700010
         MVC   6(2,RWTG),0(RWTGC)       MOVE EXECUTOR ID TO             43800010
*                                       PARAMETER LIST                  43900010
         MVC   14(3,RWTG),2(RWTGC)      MOVE TTR TO LIST                44000010
         XCTL  DE=(RWTG),SF=(E,(15))                                    44100010
         EJECT                                                          44200010
DIALOUT1 EQU   *                                                        44300010
         TM    QCBDSFLG,QCBDISK+QCBCORE TSO ONLY QUEUEING        S22029 44330010
         BZ    SETLINE                 YES  BRANCH               S22029 44360010
         L     RJ,DCBIOBAD              LOAD THE IOS ADDRESS OF THE     45000010
*                                         IOB FOR THIS LINE             45100010
         LA    RDCB,IOBPTR              LOAD THE IOB DISPLACEMENT       45200010
         SR    RJ,RDCB                  ACCESS THE IOS ADDRESS OF       45300010
*                                         THE LCB                       45400010
         AR    RJ,RUCB                  LOAD THE BEGINNING ADDRESS      45500010
*                                         OF THE FIRST LCB              45600010
         LA    RDCB,EIGHT               LOAD THE OFFSET TO THE DIAL     45700010
*                                         OUT CALL QUEUE                45800010
         SR    RJ,RDCB                  GET THE BEGINNING ADDRESS       45900010
*                                         OF THE DIAL OUT CALL QUEUE    46000010
         L     RDCB,FOUR(RJ)            GET THE ADDRESS OF THE NEXT     46100010
*                                         ELEMENT ON THE CHAIN          46200010
DIALCOMP EQU   *                                                        46300010
         CLC   ONE(THREE,RJ),FIVE(RDCB) HAVE WE FOUND THE END OF        46400010
*                                         THE CHAIN                     46500010
         BE    TESTART                  YES, TEST FOR RESTART     M1178 46600010
         L     RDCB,FOUR(RDCB)          GET THE ADDRESS OF THE NEXT     46800010
*                                         ELEMENT                       46900010
         B     DIALCOMP                 TEST FOR THE END OF THE         47000010
*                                         CHAIN                         47100010
TESTART  EQU   *                                                  M1178 47108010
         TM    AVTBIT2,AVTSTRTN         IS RESTART IN PROGRESS    M1178 47116010
         BNO   TESTQCB                  IF NOT, CHECK QCB         M1178 47124010
         ST    RTIOT,LCBLINK-ONE        IF SO, SAVE QCB ADDRESS   M1178 47132010
TESTQCB  EQU   *                                                  M1178 47140010
         TM    QCBSTPRI,CLOCK           CALL-UP TIME SPECIFIED    M1178 47164010
         BO    SETDCBAD                 RESTORE DCB ADDRESS    @OY12667 47172010
TESTNO   EQU   *                                               @SA70305 47190010
         NC    QCBMSGCT,QCBMSGCT        FEFO CHAIN EMPTY?      @SA70305 47192010
         BZ    SETDCBAD                 YES,RESTORE DCB ADDR   @SA70305 47194010
         TM    QCBSTPRI,INTERVAL        INTERVAL SPECIFIED     @OY12667 47194510
         BNO   INSERT                   NO, PROCEED            @OY12667 47195010
         OI    QCBLINK+2,QCBSCHDL       SCHEDULE SEND          @OY12667 47195510
         B     INSERT                   NO ,INSERT STCB        @SA70305 47196010
         EJECT                                                          47200010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     47300010
*                                                                 *     47400010
*        THIS SECTION OF CODE COMPUTES THE RELATIVE POSITION      *     47500010
*        IN THE TERMNAME TABLE OF THE LINE ENTRY FOR ANY GIVEN    *     47600010
*                                  LINE                                 47700010
*                                                                 *     47800010
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     47900010
LINENT2  EQU   *                                                        48000010
         L     RJ,AVTGETMN+4            LOAD THE TERMINAL TABLE         48100010
*                                         ADDRESS FOR THIS LINE         48200010
         TM    0(RJ),LINENTRY           IS THIS A LINE ENTRY IN THE     48300010
*                                         TERMINAL TABLE                48400010
         BZ    CLEARIT                  NO,CHECK NEXT ENTRY IN @YA11150 48500010
*                                         THE TERMNAME TABLE            48600010
         LR    RTIOT,RE                 COPY THE RELATIVE LINE          48700010
*                                         NUMBER                        48800010
         L     RJ,DCBDEBAD              LOAD THE ADDRESS OF THE         48900010
*                                         CURRENT DEB                   49000010
         IC    RE,EXTNTCNT(RJ)          GET THE NUMBER OF LINES         49100010
*                                         BEING OPENED BY THIS DCB      49200010
         CR    RTIOT,RE                 IS THE LINE ENTRY NUMBER        49300010
*                                         GREATER THAN THE NUMBER       49400010
*                                         OF LINES                      49500010
         BH    TERMADL                  YES, BRANCH                     49600010
*                                                                       49700010
*                                                                       49800010
         USING IEDQTNTD,RJ                                              49900010
*                                                                       50000010
*                                                                       50100010
         L     RJ,AVTRNMPT              LOAD THE ADDRESS OF THE         50200010
*                                         TERMNAME TABLE                50300010
         LH    RTIOT,TNTLEN             LOAD THE NUMBER OF ENTRIES      50400010
*                                         IN THE TERMNAME TABLE         50500010
         SR    RTIOT,RF                 SUBTRACT FROM THE TOTAL         50600010
*                                         NUMBER OF ENTRIES, THE        50700010
*                                         NUMBER OF UNCHECKED           50800010
*                                         ENTRIES IN THE TABLE          50900010
         LA    RTIOT,1(RTIOT)           ADD 1 TO THE DIFFERENCE         51000010
         STH   RTIOT,LCBLNENT           STORE THE INDEX OF THE          51100010
*                                         LINE ENTRY FOR THIS           51200010
*                                         PARTICULAR LINE IN ITS        51300010
*                                         LCB                           51400010
         B     TERMADL                  CONTINUE CHECKING FOR THE       51500010
*                                         REMAINING LINES IN THIS       51600010
*                                         LINE GROUP                    51700010
         EJECT                                                          51800010
         EJECT                                                          55200010
OPIDCNST DC    C'0S'                    FLAG ENDING WTG TABLE    S22025 55500010
ZERO1    EQU   0                        CONSTANT ZERO            S22027 55650010
ONE      EQU   1                        ONE                      S21903 55700010
TWO      EQU   2                        TWO                      S21903 55800010
THREE    EQU   3                        THREE                    S21903 55900010
FOUR     EQU   4                        FOUR                     S21903 56000010
FIVE     EQU   5                        FIVE                     S21903 56100010
EIGHT    EQU   8                        EIGHT                    S21903 56200010
EXTNTCNT EQU   16                       OFFSET TO NO. OF EXTENTS Y02027 56300010
UCBADDR  EQU   28                       UCB ADDR OFFSET          S21903 56500010
IOBPTR   EQU   32                       IOB OFFSET               S21903 56600010
CVT      EQU   16                       CVT DISPLACEMENT         Y02027 56700010
ZERO     EQU   X'00'                    HEXADECIMAL ZERO         S21903 56800010
BFRDTERM EQU   X'02'                    BUFRED TERM DEVICE FLAG  S21903 56900010
TCAMER08 EQU   X'08'                    ERROR IDENTIFIER         S21903 57100010
NODIALRS EQU   X'0C'                    NON-DIAL REC'V SCHED     S21903 57200010
OUTONLY  EQU   X'0F'                    OUTPUT ONLY LINE         S21903 57300010
GRAPHICS EQU   X'10'                    GRAPHICS DEVICE          S21903 57400010
TIMDELAY EQU   X'14'                    TIME DELAY OFFSET        S21903 57500010
DIALRECV EQU   X'18'                    DIAL REC'V SCHED         S21903 57600010
BUFTSCHD EQU   X'1A'                    BUFRD TERM SCHED         S21903 57700010
LOCALKEY EQU   X'1E'                    LOCAL REC'V SCHED        S21903 57800010
SENDPRI  EQU   X'20'                    SEND PRIORITY            S21903 58000010
CSVTO    EQU   X'20'                    CONC SEND SCHEDULER      S22026 58030010
*                                         VECTOR TABLE OFFSET    S22026 58060010
EQULPRI  EQU   X'40'                    EQUAL PRIORITY           S21903 58100010
INTERVAL EQU   X'70'                    CINTVL PRIORITY          S21903 58300010
CLOCK    EQU   X'80'                    CLOCK PRIORITY           S21903 58400010
LINENTRY EQU   X'80'                    LINE ENTRY               S21903 58500010
DIAL     EQU   X'90'                    DIAL LINE                S21903 58600010
TCAMER16 EQU   X'16'                    CHAR ERR INDICATOR       A42381 58930010
NOTDIAL  EQU   X'40'                    LEASED QCB INDICATOR     A42381 58960010
CBRDCAST EQU   X'40'                    BROADCAST TERMINAL       S22027 58980010
         EJECT                                                          58990010
NENT     EQU   2                                                        59000010
LENGTH   EQU   NENT*6+6                                                 59100010
NODBWDS  EQU   (LENGTH+7)/8                                             59200010
ORGIDTTR EQU   1024-NODBWDS*8                                           59300010
END      EQU   *                                                        59350010
         ORG   IGG01937+ORGIDTTR        ADJUST LOCATION CTR      S21903 59400010
UNUSED   EQU   *-END                                                    59450010
TCAMLD4  DC    C'38'                    MODULE ID SUFFIX         S22025 59500010
         DC    XL4'00'                  TTR AND LENGTH           S22025 59600010
OPENERP  DC    C'33'                    OPEN ERROR HANDLER              59700010
         DC    XL4'0'                     TTR AND LENGTH                59800010
IDEND    DC    X'0000'                  END OF TTR TABLE         S22025 59900010
         CNOP  4,8                                                      60000010
LOADID   DC    C'019'                   TRANSIENT MODULE ID      S22025 60100010
         DC    YL1(X'80'-NODBWDS)       ADJUST MODULE LENGTH TO  S22025 60140010
*                                       X'400' BYTES             S22025 60180010
         EJECT                                                          60188010
FORCORE  DSECT                                                   Y02027 60196010
         IECDSECT                                                Y02027 60204010
         EJECT                                                          60212010
         TTCXD                                                   Y02027 60220010
         EJECT                                                          60230010
         TTRMD                                                          60400010
         EJECT                                                          60500010
         TAVTD                                                          60600010
         EJECT                                                          60700010
         TLCBD                                                          60800010
         EJECT                                                          60900010
         EJECT                                                          61100010
         TTNTD                                                          61200010
         EJECT                                                          61300010
         TQCBD                                                          61400010
         EJECT                                                   S22026 61420010
         TQCBED                                                  S22026 61440010
         EJECT                                                   S22026 61460010
         DCBD  DSORG=TX                                                 61500010
*                                                                       61600010
         EJECT                                                          61630010
         TDCTD                                                 @G36XRNP 61660010
         END                                                            61700010
