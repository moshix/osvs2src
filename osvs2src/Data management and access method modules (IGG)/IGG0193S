 TITLE 'IGG0193S  BTAM LINE GROUP OPEN EXECUTOR - LOAD 4'               00200017
*********************************************************************** 00250002
*                                                                     * 00300002
* MODULE NAME: IGG0193S   (OS/VS)                                     * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME: BTAM LINE GROUP OPEN EXECUTOR - LOAD 4            * 00410002
*                                                                     * 00420002
* COPYRIGHT: NONE                                                     * 00430002
*                                                                     * 00450002
* STATUS: RELEASE 2                                                   * 00700002
*                                                                     * 01000017
* FUNCTION/OPERATION: THIS ROUTINE IS BROUGHT INTO CORE AND GIVEN     * 01200002
*  CONTROL WHEN OPEN EXECUTOR LOAD3 FOR TELECOMMUNICATIONS ISSUES     * 01400017
*  'XCTL' TO IGG0193S.                                                * 01600017
*  THIS ROUTINE LOADS THE REQUIRED OPEN TELECOMMUNICATION MODULES,AND * 01800017
*  STORES THE ID OF THE MODULES AND A COUNT OF MODULES LOADED, INTO   * 02000017
*  THE DEB AND SETS UP TERMINAL TEST MASK IF REQUIRED.                * 02200017
*                                                                     * 02800017
* ENTRY POINT: ENTRY WILL BE TO THE FIRST BYTE OF THE MODULE BY AN    * 03000002
*  'XCTL' TO IGG0193S THE FOURTH BTAM LOAD.                           * 03200002
*                                                                     * 03250002
* INPUT:  THE REGISTERS 5,6,7,8 ARE THE INPUT AS FOLLOWS,             * 03400002
*       5 -   ADDRESS OF THE FIRST ENTRY IN THE COPIED DCB PARAMETER  * 03450002
*             LIST,                                                   * 03500002
*       6 -   BEGINNING OF THE WHERE-TO-GO TABLE                      * 03600017
*       7 -   ADDRESS OF THE CURRENT ENTRY IN THE COPIED DCB          * 03800002
*             PARAMETER LIST,                                         * 03850002
*       8 -   ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO TABLE   * 04000017
*                                                                     * 04800017
* OUTPUT: THE REGISTERS 7,8 WILL BE POSITIONED TO THE NEXT UNFINISHED * 05000002
*  ENTRY, AND THE REQUIRED BTAM MODULES WILL BE LOADED INTO CORE.     * 05200017
*                                                                     * 05250002
* EXTERNAL ROUTINES: NONE                                             * 05400002
*                                                                     * 05600017
* EXIT-NORMAL: THIS ROUTINE TERMINATES BY LOCATING THE NEXT NON-ZERO  * 05800002
*  ENTRY IN THE WHERE-TO-GO TABLE AND EXECUTING AN XCTL TO THAT       * 06000017
*  ROUTINE.                                                           * 06200017
*                                                                     * 06250002
* EXIT-ERRORS:                                                        * 06400002
*     -ERRORS-  THIS ROUTINE EXITS VIA ABEND FOR THE FOLLOWING        * 06450002
*   ERROR CONDITIONS-                                                 * 06500002
*   ABEND CODE ERROR CONDITION                                        * 06550002
*   00097000   THE CURRENT OPEN REQUIRES AN ADDITIONAL ENTRY IN       * 06560002
*              THE DEVICE I/O DIRECTORY.                              * 06570002
*                                                                     * 06600017
* TABLES/WORK AREAS: 1.DCB PARAMETER LIST CONTAINS THE ADDRESS OF EACH* 06800002
*  DCB SPECIFIED IN THE OPEN MACRO INSTRUCTION. 2. THE WHERE-TO-GO    * 07000017
*  TABLE CONTAINS THE ID AND TTR OF THE ROUTINE NEEDED TO PROCESS THE * 07200017
*  DCB WHICH CORRESPONDS TO THIS ENTRY. THE CHNIDTBL CONTAINS THE     * 07400017
*  IDS NEEDED FOR WHERE-TO-GO TABLE AND LOAD OF REQUIRED OPEN MODULES.* 07600017
*                                                                     * 07650002
* ATTRIBUTES: THIS ROUTINE IS EXECUTED IN THE DATA MANAGEMENT KEY OF  * 08200002
*       5 AS ENABLED, PRIVILEGED, AND REENTRANT.                      * 08400002
*                                                                     * 08600017
* NOTES:  THIS ROUTINE COMPLETES THE OPEN PROCESSING FOR              * 08800002
*  TELECOMMUNICATION SO THE WHERE-TO-GO TABLE ENTRY WILL BE SET TO 0. * 09000002
*  THE COPIED DCB WILL BE COPIED TO THE USER'S DCB TO REFLECT ALL     * 09050002
*  CHANGES MADE BY THE BTAM EXECUTORS.                                * 09100002
*                                                                     * 09103000
* CHANGE ACTIVITY AS FOLLOWS:                                         * 09106000
*            APARS                           PTMS                     * 09109000
*       YA02171  (10/5/73)               YM4057  (10/3/73) NO CODE    * 09112000
*       ZA00531  (10/18/74)              YM4072  (10/24/73)           * 09115000
*       ZA00541  (11/18/74)              YM4091  (11/5/73)            * 09118000
*       ZA02349  (02/21/75)              YM5661  (12/11/73)           * 09121000
*       ZA03594  (10/03/75)              YM5663  (12/11/73) PROLOG    * 09124000
*       ZA06376  (10/03/75)              YM5668  (12/14/73) IECRES    * 09127000
*       ZA08768  (04/15/76)              YM5674  (1/3/73)             * 09130000
*       ZA11422  (06/24/76)                                           * 09133000
*       ZA11446  (10/05/76)                                           * 09136000
*       ZA14073  (03/22/77)                                           * 09139000
*       ZA17710  (04/28/77)                                           * 09142000
*       ZA33143  (07/23/77)                                           * 09150000
*********************************************************************** 09160002
         EJECT                                                          09160402
IGG0193S CSECT                                                          09162002
         SPACE 5                                                        09164002
RE       EQU   0                       WORK/PARAMREG                    09200017
RF       EQU   1                       WORK/PARAMREG                    09400017
RDCB     EQU   2                       COPIED DCB ADDRESS        Y02947 09600002
ENDADR   EQU   2                       END ADDR FOR FIX LIST     Y02947 09650002
ASCBFLAG EQU   RDCB                                         L5 @ZA02349 09700000
RBASE    EQU   3                       BASE REGISTER                    09800017
RCORE    EQU   4                       IOB ADDRESS                      10000017
PSAREG   EQU   4                       ADDR OF PSA            LD YM7707 10050000
ASCBREG  EQU   4                       ADDR OF ASCB           LD YM7707 10100000
RPAR     EQU   5                       START OF COPIED DCB       Y02947 10200002
*                                      PARAMETER LIST            Y02947 10250002
RWTG     EQU   6                       START OF WTG                     10400017
RPARC    EQU   7                       CURRENT ENTRY IN COPIED   Y02947 10600002
*                                      DCB PARAMETER LIST        Y02947 10650002
RWTGC    EQU   8                       CURRENT ENTRY IN WTG TABLE       10800017
RTIOT    EQU   9                       TIOT ADDRESS                     11000017
RUCB     EQU   10                      CURRENT UCB                      11200017
RDEB     EQU   11                      DEB ADDRESS                      11400017
RB       EQU   12                      WORK REG                         11600017
ECBREG   EQU   12                      ADDR OF ECB            LD YM7707 11650000
TCBREG   EQU   13                      TCB ADDRESS            LD YM7707 11700000
RC       EQU   13                      WORK REG                         11800017
RD       EQU   14                      WORK/PARAMREG                    12000017
RJ       EQU   15                      WORK/PARAMREG                    12200017
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 12400017
         USING IHADCB,RDCB                                              12800017
         USING IECTDEB,RDEB                                             13000017
         USING WTG,RWTG                 WHERE-TO-GO TABLE        Y02947 13050002
*                                           ADDRESSABILITY       Y02947 13100002
         EJECT                                                          13200017
         BALR  RBASE,0                                                  13400017
         USING *,RBASE                                                  13600017
         SPACE 4                                                 Y02947 13650002
         B     AROUND                   BRANCH AROUND ID         Y02947 13700002
         DC    CL8'IGG0193S'            OPEN ID                  Y02947 13720000
         DC    CL8'** MVS *'                                            13750000
         DC    CL8'&SYSDATE'         DATE LAST ASSEMBLY        @ZA00541 13752000
         DC    XL3'019825'             CURRENT PTF NUMBER               13752800
PATCH    DC    XL50'00'                 PATCH AREA               Y02947 13756002
         DS    0H                                                       13758000
         SPACE 4                                                 Y02947 13760002
AROUND   L     RDCB,0(RPARC)            COPIED DCB ADDRESS       Y02947 13800002
         L     RDEB,DCBDEBAD            LOAD DEB ADDRESS           000D 14000017
         L     RDEB,28(RDEB)            LOAD DEB START FOR DSECT   000D 14200017
         LA    RB,DEBUCBAD             LOAD UCB ADDRESS          A30780 14230020
         SR    RUCB,RUCB               CLEAR REGISTER            A30780 14260020
         IC    RUCB,DEBNMEXT           LOAD NO EXTENTS(UCB'S)    A30780 14290020
         SLL   RUCB,2                                            A30780 14320020
         AR    RUCB,RB                 ADD UCB SECTION SIZE      A30780 14350020
         SR    RTIOT,RTIOT             CLEAR REGISTER            A30780 14380020
         STCM  RUCB,SEVEN,DCBREAD+DISP1      SAVE ACCESS METHOD  Y02947 14440002
*                                            ADDRESS             Y02947 14490002
         IC    RTIOT,DEBAMLNG          LOAD ACCESS METHOD SIZE   A30780 14500020
         AR    RUCB,RTIOT              ADD TO GET SUB-ID AREA    A30780 14530020
         SR    RTIOT,RTIOT              CLEAR REGISTER             000E 14600017
         L     RCORE,DEBIRBAD-1         GET ADDRESS OF POINTERS    000E 14800017
         TM    DCBERROP,TRMTST          TEST FOR ONLINE-TEST       000D 15000017
         BO    ONLTST1                  IF SO, BRANCH TO SET UP    000E 15200017
         SPACE 1                                                        15210002
*********************************************************************** 15212002
*                                                                     * 15214002
*              2740 CODES                                             * 15216002
*        C-CHECKING                                                   * 15218002
*        D-AUTODIAL                                                   * 15218402
*        A-AUTO ANSWER                                                * 15218802
*        S-STATION CONTROL                                            * 15219202
*        P-AUTO POLL                                                  * 15219602
*        T-TRANSMIT CONTROL                                           * 15219702
*                                                                     * 15219802
*********************************************************************** 15219902
         SPACE 1                                                        15223202
TST2741  CLI   DCBDEVTP,INTR1      2741 ?                   LD @ZA00541 15230000
         BE    INTERUPT                                            000I 15240018
         CLI   DCBDEVTP,INTR2      2741 ?                   LD @ZA00541 15260000
         BNE   GRAPHICS            NO BRANCH                   @ZA33143 15263000
*              FOUR LINES OF CODE DELETED BY OZ33143           @ZA33143 15266000
INTERUPT LA    RB,BREAK41                                          000I 15300018
         BAL   RC,LOADROUT                                         000I 15320018
         BAL   RD,BLDIRB                                           000I 15340018
         SPACE 1                                                 Y02947 15350002
         MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 15352002
         SPACE 1                                                 Y02947 15354002
         ST    RF,8(RCORE)                                         000I 15360018
         SPACE 1                                                 Y02947 15370002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 15372002
         SPACE 2                                                        15380018
GRAPHICS LA    RJ,DEBUCBAD         GET UCB TABLE ADDRESS           000E 15400017
         L     RJ,0(RJ)            GET UCB ADDRESS                 000E 15600017
         TM    19(RJ),X'90'        THIS DEVICE BISYNCH             000E 15800017
         BNO   LOADPCI             IF NOT, LOAD PCI APPEND         000E 16000017
         TM    DCBXCODE,GRAPHMSK   TEST FOR 1130/2250              000E 16200017
         BO    GRAPH1                   IF SO, BRANCH TO SET UP    000E 16400017
         B     LOADPCI                  GO LOAD PCI APPENDAGE      000E 16600017
INITIQE  SRL   RTIOT,1                  REDUCE TO NMBR OF EXTENTS  000E 16800017
         SPACE 1                                                 Y02947 16850002
         MODESET EXTKEY=ZERO            KEY OF ZERO              Y02947 16900002
         SPACE 1                                                 Y02947 16950002
         LA    RB,96(RF)                LOAD ADRS OF IQE POINTER   000D 17000017
         LA    RC,4(RB)                 START IQE'S IN NEXT WORD   000D 17200017
         L     RE,DEBTCBAD-1            LOAD ADDRESS OF TCB             17400018
IQEINIT  ST    RC,0(RB)                 STORE ADDRESS OF NEXT IQE  000D 17600017
         ST    RF,8(RC)                 STORE IRB ADDRESS IN IQE   000D 17800017
         ST    RE,12(RC)                STORE TCB ADDRESS               18000018
         MVI   12(RC),X'00'             ZERO OUT HIGH BYTE        23883 18100018
         LR    RB,RC                    SAVE ADDRESS OF THIS IQE   000D 18200017
         LA    RC,16(RC)                STEP TO NEXT               000D 18400017
         BCT   RTIOT,IQEINIT            DECREMENT AND TEST         000D 18600017
         ST    RTIOT,0(RB)              ZERO LAST POINTER          000D 18800017
         SPACE 1                                                 Y02947 18850002
         MODESET EXTKEY=DATAMGT         DATAMGT KEY              Y02947 18900002
         SPACE 1                                                 Y02947 18950002
         BR    RJ                       BRANCH                     000E 19000017
ONLTST1  IC    RTIOT,DCBDEVTP           LOAD DEVICE TYPE           000D 19200017
         LM    RB,RC,ONLTTMSK           LOAD ONLTST MASK           000D 19400017
         SLDL  RB,0(RTIOT)              SHIFT TO DEVICE BIT        000D 19600017
         LTR   RB,RB                    TEST FOR ONLTST SUPPORT    000D 19800017
         BM    TSTOK                    IF BIT=1, BRANCH           000D 20000017
         NI    DCBERROP,MASKALL-TRMTST  TURN OFF TEST BIT          000D 20200017
         B     TST2741                  GO TEST FOR 2741                20400018
TSTOK    LA    RB,ONLTST                LOAD ADDRESS OF MODULE NAME000D 20600017
         BAL   RC,LOADROUT              LINK TO LOAD ROUTINE       000D 20800017
         BAL   RD,BLDIRB                                                20830018
         SPACE 1                                                 Y02947 20840002
         MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 20850002
         SPACE 1                                                 Y02947 20852002
         ST    RF,0(RCORE)              STORE IRB ADRS IN QUEUE         20860018
         SPACE 1                                                 Y02947 20870002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 20880002
         SPACE 1                                                 Y02947 20882002
         B     TST2741                                                  20890018
         SPACE 2                                                        20920018
BLDIRB   EQU   *                                                        20950018
         IC    RTIOT,DEBNMEXT      LOAD NUMBER OF EXTENTS          000E 21000017
         SLL   RTIOT,2                  MULTIPLY BY EIGHT          000D 21200017
         LA    RTIOT,1(RTIOT)           ADD 1 FOR SIZE OF WORKAREA 000D 21400017
         CIRB  EP=(RE),KEY=SUPR,MODE=SUPR,STAB=(RE),WKAREA=(RTIOT) 000D 21600017
         BAL   RJ,INITIQE          LINK TO IQE INIT                000E 21800017
         BR    RD                                                       22100018
GRAPH1   EQU   *                                               @ZA06376 22150000
         SPACE 1                                               @ZA06376 22200000
         MODESET EXTKEY=ZERO      SET KEY OF ZERO              @ZA06376 22250000
         SPACE 1                                               @ZA06376 22300000
         L     RE,12(RCORE)             GET IRB ROUTINE ADDRESS    000E 22350000
         SPACE 1                                               @ZA06376 22400000
         MODESET  EXTKEY=DATAMGT                               @ZA06376 22450000
         SPACE 1                                               @ZA06376 22500000
         IC    RTIOT,DEBNMEXT      LOAD NUMBER OFEXTENTS           000E 22600017
         SLL   RTIOT,2             MULTIPLY BY EIGHT               000E 22800017
         LA    RTIOT,1(RTIOT)      ADD 1 FOR WKAREA SIZE           000E 23000017
         CIRB  EP=(RE),KEY=SUPR,MODE=SUPR,STAB=(RE),WKAREA=(RTIOT),    X23200017
               SVAREA=YES                                          000E 23400017
         BAL   RJ,INITIQE          LINK TO INITIALIZE IQE          000E 23600017
         SPACE 1                                                 Y02947 23650002
         MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 23700002
         SPACE 1                                                 Y02947 23750002
         ST    RF,4(RCORE)         STORE IRB ADDRESS               000E 23800017
         SPACE 1                                                 Y02947 23850002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 23900002
         SPACE 1                                                 Y02947 23950002
LOADPCI  TM    DCBBFTEK,DYNBUF          TEST FOR DYNAMIC BUFFERING 000E 24000017
         BNO   TESTBPM                 NO, DON'T LOAD PCI APP    YM4072 24050002
*             4 LINES DELETED BY THE FOLLOWING PTM               YM4072 24100002
LOADPCI2 EQU   *                                                        24300002
         LA    RB,PCIAPP                LOAD ADDRESS OF IDTTRL ENTRY.   24400017
         BAL   RC,LOADROUT              BRANCH TO LOAD PCI APPENDAGE.   24600017
         ST    RE,DEBPCIA               STORE ADDRESS IN APPENDAGE      24800017
*                                  TABLE.                               25000017
*        B     LOADBPMR             DELETED BY FOLLOWING APAR   YA02171 25200002
TESTBPM  CLI   DEBAMLNG,X'00'           TEST FOR AN ACCESS METHOD       25400017
*    SECTION.  IF NOT, DO NOT LOAD BUFFER ROUTINE.                      25600017
         BZ    LOADCEAP                                                 25800017
LOADBPMR LA    RB,BPMR                  POINT TO IDTTRL TABLE AND       26000017
         BAL   RC,LOADROUT         BRANCH TO LOAD BUFFER POOL           26200017
*                                  MANAGEMENT ROUTINE.                  26400017
         L     RTIOT,DCBREAD           LOAD ACCESS METHOD ADRS   A30780 26600020
         EJECT                                                          26800017
         ST    RE,0(RTIOT)              STORE ADDRESS OF BUFFER POOL    27000017
*    MANAGEMENT ROUTINE IN FIRST WORD OF ACCESS METHOD SECTION OF DEB.  27200017
LOADCEAP EQU   *                                                        27400017
         LA    RB,CHENDAPP             ID AND TTRL FLD NEEDED FOR LOAD  27600017
         BAL   RC,LOADROUT                                              27800017
         ST    RE,DEBCEA                STORE ADDRESS OF CHANNEL END -  28000017
         ST    RE,DEBXCEA          ABNORMAL END APPENDAGE IN APPENDAGE  28200017
*                                  TABLE.                               28400017
         CLI   DCBDEVTP,DEVWTTA         IS THE WORLD TRADE TELETYPE000G 28600017
         BNE   OTHERDEV                 BRANCH IF NOT              000G 28800017
         LA    RB,CEAPPWT               LOAD ADDRESS OF IDTTRL ENTRY00G 29000017
         BAL   RC,LOADROUT              BRANCH TO LOAD CEAPP FOR WTTA.G 29200017
*                                                                       29250003
*        THE PCI APPENDAGE (IGG019MC) AND THE CHANNEL END               29300003
*        APPENDAGE (IGG019MB) ADDRESSES MUST BE MOVED INTO              29350003
*        THE 3RD AND 4TH WORDS IF IGG019PD. OFFSET X'0C'                29400003
*        AND X'10' RESPECTIVELY.                                        29450003
*                                                                       29460003
         USING FORCORE,RJ    WORKAREA ADDRESSABILITY           @ZA03594 29465000
         L     RJ,DISP4(RWTGC)         WORK AREA ADDRESS       @ZA03594 29470000
         SPACE 1                                               @ZA03594 29475000
         MODESET EXTKEY=ZERO          SET SUPERVISOR KEY       @ZA14073 29480000
         SPACE 1                                               @ZA03594 29485000
         DROP  RJ                    DROP WORK AREA ADDRESS    @ZA03594 29490000
         MVC   TWELVE(EIGHT,RB),DEBPCIA  MOVE PCI AND CE    LD @ZA00531 29500003
*                                  APP. ADDRESSES INTO WTTA LD @ZA00531 29510003
*                                  CE APPENDAGE.            LD @ZA00531 29550003
         SPACE 1                                                        29600000
         MODESET  EXTKEY=DATAMGT   BACK TO DATA MGT KEY        @ZA11422 30000000
         SPACE 1                                                        30050000
         ST    RE,DEBPCIA               STORE CEAPP ADDR IN APP. TABLEG 30100000
         MVC   DEBCEA(8),DEBPCIA       CH END AND ABN END ADDR          30150000
OTHERDEV EQU   *                                                   000G 30600017
         LA    RB,SIOAP                LOAD START I/O APPENDAGE         30640002
         BAL   RC,LOADROUT                                              30680002
         ST    RE,DEBSIOA              PUT ADDRESS IN DEB               30720002
         OI    DEBSIOA,PGFXBIT     FLAG PAGE FIX APP IN SIO       3876  30770002
         LA    RB,READWR               ID AND TTRL FLD NEEDED FOR LOAD  30800017
         BAL   RC,LOADROUT             RETURN LINKAGE ESTABLISHED       31000017
*        PROTECT DCBOFLGS FIELD FOR STORE OF READ/WRITE ADDRESS         31200017
*     WHICH DESTROYES HIGH ORDER BYTE-DCBOFLGS.                         31400017
         STCM  RE,SEVEN,DCBREAD+DISP1      ADDRESS OF READ/WRITE Y02947 31800002
*                                          MODULE                Y02947 31850002
         SPACE 2                                                   000M 32040019
         USING FORCORE,RD               WORKAREA ADDRESSABILITY  Y02947 32080002
         L     RD,4(RWTGC)              ADDRESSABILITY FOR WORK ARE000M 32120019
         SPACE 1                                                   000M 32160019
         LR    RCORE,0                 RCORE USED FOR LOCATION OF VD    32200017
         AH    RCORE,VDOFFSET          LOCATE VECTOR DIRECTORY          32400017
         SR    RTIOT,RTIOT             REG USED FOR DEVICE CODE         32600017
         IC    RTIOT,DISP0(RD)  GET DEVICE CODE STORED           Y02947 32800002
*                                         BY MODULE IGG0194N       000M 33000002
         STC   RTIOT,DCBDEVTP          STORE IN DCB                     33400017
         SR    RC,RC         USE LINKREG AS TEMP. COUNT                 33600017
*                                 USED AS A DEVICE COUNT.               33800017
         SPACE 1                                                 Y02947 33850002
RWVDLP   MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 33900002
         SPACE 1                                                 Y02947 33950002
         NC    0(4,RCORE),0(RCORE)     TEST FOR ZERO FIELD              34000002
         BNZ   VD1                     BRANCH IF NOT ZERO FIELD    000A 34200017
         MVI   3(RCORE),X'FF'          MAKE FIELD NON ZERO       A28605 34300019
RWVD1    EQU   *                                                 Y02947 34310002
         SPACE 1                                                 Y02947 34350002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 34400002
         SPACE 1                                                 Y02947 34450002
         LA    RB,WORKTTRL(RD)          RETREIVE I/O MODULE      Y02947 34800002
*                                       ID. (IT WAS PLACED IN    Y02947 34850002
*                                       THE WORKAREA BY OPEN     Y02947 34900002
*                                       LOAD 2 (IGG0194N))       Y02947 34950002
         STC   RC,DCBDEVTP   STORE DEVICE COUNT                         35200017
         BAL   RC,LOADROUT                                              35400017
         DROP  RD                                                  000M 35500019
         SPACE 1                                                 Y02947 35550002
NEXTSP10 MODESET EXTKEY=ZERO           KEY OF ZERO               Y02947 35560002
         SPACE 1                                                 Y02947 35570002
         ST    0,0(RCORE)              STORE VECTOR LIST ADDRESS        35600002
         STC   RTIOT,0(RCORE)          STORE DEVICE CD IN HIGH ORDER    35800017
         SPACE 1                                                 Y02947 35850002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 35900002
         SPACE 2                                                        35908000
ENDLOD4  XC    0(2,RWTGC),0(RWTGC)      CLEAR ID TO INDICATE            35916000
*                                       COMPLETION                      35924000
         SPACE 2                                                 Y02947 35932000
*********************************************************************** 35940000
*        SYSEVENT REQSWAP AND SYSEVENT DONTSWAP, AND THEIR     @ZA17710 35948000
*        RELATED SETLOCK OBTAIN/RELEASE AND REQUIRED GETMAIN/  @ZA17710 35956000
*        FREEMAINS, HAVE BEEN REMOVED AND REPLACED BY SYSEVENT @ZA17710 35964000
*        TRANSWAP MACRO.  TRANSWAP WILL BE ISSUED FOR EACH     @ZA17710 35972000
*        BTAM DCB IF RUNNING V=V.  IF THERE IS NO PREVIOUS     @ZA17710 35980000
*        OUTSTANDING TRANSWAP AGAINST THE ADDRESS SPACE, THE   @ZA17710 35988000
*        ADDRESS SPACE WIL BE SWAPPED OUT AND THEN BACK INTO   @ZA17710 35996000
*        THE PREFERRED AREA OF STORAGE, AND THE ADDRESS SPACE  @ZA17710 36004000
*        WILL BE MADE NON-SWAPPABLE.  ISSUING THE TRANSWAP     @ZA17710 36012000
*        MACRO ELIMINATES THE NECESSITY OF MANIPULATING THE    @ZA17710 36020000
*        ASCBNSWP FLAG AS PREVIOUSLY DONE.                     @ZA17710 36028000
*********************************************************************** 36036000
         SPACE 2                                                        36044000
         SR    PSAREG,PSAREG       CLEAR REG                  LD YM7707 36052000
         USING PSA,PSAREG          PSA ADDRESSABILITY         LD YM7707 36060000
         L     TCBREG,PSATOLD      TCB ADDRESS                LD YM7707 36068000
**************** ONE LINE OF CODE REMOVED BY APAR OZ17710      @ZA17710 36076000
         DROP  PSAREG                                         LD YM7707 36084000
         USING TCB,TCBREG      TCB ADDRESSABILITY              @ZA11446 36092000
         TM    TCBFLGS6,TCBRV  VIRTURE = REAL JOB?             @ZA11446 36100000
         BO    REALIOB    YES, DONT ISSUE TRANSWAP MACRO       @ZA17710 36108000
         DROP  TCBREG                                          @ZA11446 36116000
         SPACE 1                                                        36124000
*********************************************************************** 36132000
*      FIFTY LINES OF CODE HAVE BEEN DELETED AND FIFTEEN       @ZA17710 36140000
*      LINES HAVE BEEN ADDED BY APAR OZ17710, IN ORDER TO      @ZA17710 36148000
*      SUPPORT THE TRANSWAP MACRO.                             @ZA17710 36156000
*********************************************************************** 36164000
         SPACE 1                                               @ZA17710 36172000
TRANSWAP EQU   *                                               @ZA17710 36180000
         USING FORCORE,RJ          WORKAREA ADDRESSABILITY     @ZA17710 36188000
         L     RJ,DISP4(RWTGC)     WORK AREA ADDRESS           @ZA17710 36196000
         XC    DXECB(4),DXECB      CLEAR ECB                   @ZA17710 36204000
         LA    RF,DXECB            GET ADDR ECB FOR TRANSWAP   @ZA17710 36212000
         SPACE 1                                                        36220000
         SYSEVENT TRANSWAP         ISSUE TRANSWAP              @ZA17710 36228000
         SPACE 1                                                        36236000
         N     RF,ZEROFF           MAKE SURE ONLY RC IN REG 1  @ZA17710 36244000
         LTR   RF,RF               IS RETURN CODE ZERO?        @ZA17710 36252000
         BNZ   REALIOB             RC IS NOT ZERO, TRANSWAP    @ZA17710 36260000
*                               WAS SUCCESSFUL, DONT WAIT      @ZA17710 36268000
         L      RJ,DISP4(RWTGC)       WORK AREA ADDRESS        @ZA17710 36276000
         LA    RF,DXECB            GET ADDR ECB FOR WAIT       @ZA17710 36284000
         SPACE 1                                                        36292000
         WAIT  ECB=(1)             WAIT FOR ECB TO BE POSTED   @ZA17710 36300000
         SPACE 1                                                        36308000
         L     RJ,DISP4(RWTGC)       WORK AREA ADDRESS         @ZA17710 36316000
         CLC   DXECB,ECBPOST       WAS ECB POSTED BY TRANSWAP  @ZA17710 36324000
         BE    TRANSWAP         NO, RETRY..OTHERWISE CONTINUE  @ZA17710 36332000
         DROP  RJ                                              @ZA17710 36340000
****************************END OF TRANSWAP CODE************** @ZA17710 36400000
         SPACE 2                                                 YM5674 36673502
REALIOB  L     RDCB,DISP0(RPARC)      GET COPY DCB ADDRESS     @ZA11446 36675500
         L     RCORE,4(RWTGC)           ADDR OF OPEN WORK AREA   Y02947 36684102
         SPACE 2                                                 Y02947 36689402
*    UPDATE THE USER'S DCB TO REFLECT ALL CHANGES MADE BY BTAM        * 36694702
*    OPEN EXECUTORS ON THE COPIED DCB.                                * 36700002
         L     RJ,WTGPREFX                                       Y02947 37060002
         STM   RE,RD,IECREGSV-IECPREFX(RJ)  SAVE REGS            Y02947 37070002
         IECRES INIT,DCBCOPY=FRWKAR                              Y02947 37100002
         LR    RJ,RWTG                  REG SAVEAREA ADDR        YM5668 37110002
         LM    RE,RD,IECREGSV-IECPREFX(RJ)  RESTORE REGS         Y02947 37150002
         SPACE 2                                                 Y02947 37150402
         USING FORCORE,RJ               WORKAREA ADDRESSABILITY  Y02947 37152002
         L     RJ,DISP4(RWTGC)          WORKAREA ADDRESS         Y02947 37162002
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG REGISTER. 37200017
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT PARAMETER     37400017
*                                  LIST REGISTER TO NEXT ENTRY.         37600017
         CLC   0(2,RWTGC),AMIDCNST      IF THE NEXT WTG ENTRY CALLS FOR 37800017
         BCR   8,RBASE                                                  38000017
         CLC   0(2,RWTGC),OPIDCNST      IF NOT, TEST FOR END OF TABLE.  38200017
         BNE   RELOOP              NOT END OF TABLE, RETURN TO CHECK    38400017
*                                  NEXT ENTRY.                          38600017
         LR    RPARC,RPAR               REINITIALIZE CURRENT WTG REG    38800017
         LA    RWTGC,WAOFF(0,RWTG) AND CURRENT PARAMETER LIST REG.      39000017
ZCHECK   CLI   0(RWTGC),X'00'                                           39200017
         BNE   XCTLRTNE            IF NOT ZERO, GO TO TRANSFER CONTROL. 39400017
         LA    RWTGC,WGOFF(0,RWTGC) IF ZERO, GET NEXT ENTRY AND RETURN  39600017
         LA    RPARC,PLOFF(0,RPARC) TO ZCHECK.                          39800017
         B     ZCHECK                                                   40000017
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 40200017
XCTLRTNE EQU   *                                                        40400017
         LA    RJ,DXCCW12           POINT TO DOUBLE WORD LIST.   Y02947 40600002
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID TO NAME FIELD.          40800017
         MVC   14(3,RWTG),2(RWTGC)      MOVE TTR TO WTG TABLE.          41000017
         DROP  RJ                 DROP WORKAREA ADDRESS          Y02947 41050002
         L     RC,SIXT            CVT ADDRESS                    Y02947 41100002
         USING CVT,RC             CVT ADDRESSABILITY             Y02947 41150002
         L     RC,CVTSVDCB        SYS1.SVCLIB DCB                Y02947 41160002
         DROP  RC                 DROP CVT ADDRESS               Y02947 41170002
         XCTL  DE=(RWTG),SF=(E,(15)),DCB=(RC)                    Y02947 41200002
         EJECT                                                          41400017
LOADROUT EQU   *                                                 Y02947 41600002
         MVC   6(2,RWTG),0(RB)         MOVE ID OF LAST 2 BYTES OF NAME  41800017
         MVC   14(3,RWTG),2(RB)        MOVE TTR FROM TABLE              42000017
LOAD     LR    RE,RWTG                  POINT TO PARAMETER LIST.        45200017
         USING CVT,RF                   CVT ADDRESSABILITY       Y02947 45250002
         L     RF,SIXT                  CVT ADDRESS              Y02947 45300002
         L     RF,CVTSVDCB              SYS1.SVCLIB DCB          Y02947 45350002
         DROP  RF                       DROP CVT ADDRESS         Y02947 45400002
         CLC   DISP6(LEN2,RWTG),READWR  READ/WRITE ROUTINE       YM4057 45410002
         BE    LOADMA                   YES, LOAD FROM SVCLIB    YM4057 45420002
         CLC   DISP6(LEN2,RWTG),CHENDAPP CE/ABE APPENDAGE        YM4057 45430002
         BE    LOADMB                   YES, LOAD FROM SVCLIB    YM4057 45440002
         CLC   DISP6(LEN2,RWTG),PCIAPP  PCI APPENDAGE?           Y02947 45450002
         BE    LOADMC                   YES, LOAD FROM SVCLIB    YM4057 45500002
         CLC   DISP6(LEN2,RWTG),CEAPPWT WTTA CE APPENDAGE        YM4057 45510002
         BE    LOADPD                   YES, LOAD FROM SVCLIB    YM4057 45520002
         CLC   DISP6(LEN2,RWTG),ONLTST  ON LINE TEST CONTROL MOD YM4091 45530002
         BE    LOADMR                   YES, LOAD FROM SVCLIB    YM4091 45540002
         CLC   DISP6(LEN2,RWTG),BPMR    BUFFER MANAGEMENT MOD    YM5661 45542002
         BE    LOADMS                   YES, LOAD FROM SVCLIB    YM5661 45544002
         SPACE 1                                                 Y02947 45550002
         LOAD  DE=(0),DCB=(1)                                           46200017
*                                                                       46400017
MOVEID   EQU   *                                                 Y02947 46450002
         MVC   0(2,RUCB),0(RB)         MOVE ID TO DEB                   46600017
         LA    RUCB,2(0,RUCB)           UPDATE POINTER TO SUBROUTINE    46800017
*                                  ID SECTION IN DEB.                   47000017
         IC    RD,DEBNMSUB              GET NMBR ROUTINES LOADED   000E 47200017
         LA    RD,1(RD)                 ADD ONE                    000E 47400017
         STC   RD,DEBNMSUB              STORE COUNT IN DEB         000E 47600017
PAGEFIXR EQU   *                   AOS PAGE FIX FOR APPENDS       3876  47650002
         LR    RB,RE               TEMP SAVE EP ADDRESS           3876  47700002
         SLL   RF,3                CONVERT DOUBLEWORDS TO BYTES   3876  47750002
         LA    RF,PAGESIZE(RF,RB)  BUMP BY PAGE SIZE              3876  47760002
         N     RE,PAGEBDRY         PUT ON PAGE BOUNDRY            3876  47770002
         SLR   RF,RE               REMOVE EXTRA BYTES             3876  47780002
         SRL   RF,PAGESHFT         GET NUMBER OF PAGES            3876  47790002
         SLL   RF,24               POSITION FOR OR INTO ADDRESS   3876  47792002
         LR    RE,RB               RESTORE ADDRESS                3876  47794002
         OR    RE,RF               PUT PAGE FIX COUNT IN          3876  47796002
         BR    RC                       RETURN.                         47800017
LOADMA   LOAD  EPLOC=IGG019MA,DCB=(1)                            YM4057 47810002
         B     MOVEID                   MOVE IN THE ID           YM4057 47820002
         SPACE 1                                                 YM4057 47830002
LOADMB   LOAD  EPLOC=IGG019MB,DCB=(1)                            YM4057 47840002
         B     MOVEID                   MOVE IN THE ID           YM4057 47842002
         SPACE 1                                                 YM4057 47844002
LOADMC   LOAD  EPLOC=IGG019MC,DCB=(1)                            YM4057 47850002
         B     MOVEID                   MOVE IN THE ID           Y02947 47900002
         SPACE 1                                                 YM4057 47950002
LOADPD   LOAD  EPLOC=IGG019PD,DCB=(1)                            YM4057 48000002
         B     MOVEID                   MOVE IN THE ID           YM4057 48050002
         SPACE 1                                                 YM4091 48060002
LOADMR   LOAD  EPLOC=IGG019MR,DCB=(1)   LOAD IGG019MR            YM4091 48070002
         B     MOVEID                   MOVE IN THE ID           YM4091 48080002
         SPACE 1                                                 YM5661 48082002
LOADMS   LOAD  EPLOC=IGG019MS,DCB=(1)   LOAD IGG019MS            YM5661 48090002
         B     MOVEID                   MOVE IN THE ID           YM5661 48092002
         SPACE 1                                                 YM4057 48100002
VD1      CLC   DCBDEVTP(1),0(RCORE)  TEST FOR EQUAL DEVICE CODE: DCBDV  49200017
         BE    RWVD1         VS. VECTOR DIREC. DEVICE TYPE.             49400017
*                                  DEVICE CODE AND VECTOR DIRECTORY TBL 49600017
         SPACE 1                                                 Y02947 49650002
         MODESET EXTKEY=DATAMGT        DATAMGT KEY               Y02947 49700002
         SPACE 1                                                 Y02947 49750002
         CLI   0(RCORE),X'FF'          TEST END OF TABLE           000A 49800017
         BE    VDOVFLER                                            000A 50000017
         LA    RCORE,4(0,RCORE)        BUMP TO GET NEXT VD FIELD        50200017
         AH    RC,ONE        BUMP DEVICE COUNT                          50400017
*                                 VECTOR LIST FIELD NOT ZERO OR EQUAL   50600017
*                                 TO DEVICE CODE TO LOAD PROGRAM.       50800017
         B     RWVDLP                                                   51000017
VDOVFLER L     1,ERR6                  VECTOR DIRECTOR OVERFLOW    000A 51200017
         ABEND (1)                                                 000A 51400017
         CNOP  0,4                                                      51600017
         EJECT                                                          51800017
ONLTTMSK DS    0F                                                  000D 52000017
       DC    BL.51'111111111111111111111111111000000011111111111111111' 52200019
*      1050        *****                                           000J 52400018
*      2740             ******************                         000J 52600018
*      1060                               **                       000J 52800018
*      1030                                 **                     000J 53000018
*      83B3                                   **                   000J 53200018
*      115A                                     **                 000J 53400018
*      TWX                                        ***              000J 53600018
*      2260/2848                                     *             000J 53800018
*      S360/1130/2780/2020                            ********     000J 54000018
*      2741                                                   **   000J 54200018
*      2740/2760                                                ** 000J 54400018
*      1050X                                                      **    54460019
*      2740X                                                        **  54520019
         DS    0F                                                       54600017
ZEROFF   DC    X'000000FF'                                    LD YM7707 54610000
XFF      EQU   X'FF'                                          LD YM7707 54620000
PAGEBDRY DC    X'00FFF800'         AOS2 PAGE BOUNDRY MASK       AS23648 54650002
PAGESHFT EQU   11                  AOS2 PAGE SHIFT COUNT        AS23648 54700002
PAGESIZE EQU   2047                AOS2 PAGE SIZE - 1           AS23648 54750002
ERR6     DC    X'80097000'                                         000A 54800017
TRMTST   EQU   X'10'                    TERMINAL TEST BIT IN ERROP      55400017
         SPACE                                                          55600017
WAOFF    EQU   32                       OFFSET OF FIRST WTG ENTRY FROM  55800017
*                                  START OF WTG.                        56000017
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES.          56200017
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES.          56400017
OPIDCNST DC    C'0S'                    ID OF LAST OPEN LOAD.           56600017
AMIDCNST DC    C'3S'                    ID OF THIS MODULE.         000D 56800017
WORKTTRL EQU   2                                                 Y02947 57000002
DYNBUF   EQU   X'08'                    CODE FOR BFTEK=D IN THE DCB,    57200017
DEVWTTA  EQU   X'2A'                    WTTA OFFSET                000G 57400017
ONE      DC    H'01'                                                    57600017
VDOFFSET DC    H'12'                                                    57800017
GRAPHMSK EQU   X'40'                                               000E 60000017
MASKALL  EQU   X'FF'                    ALL ONES                   000D 60200017
XFE      EQU   X'FE'                                           @ZA08768 60230000
INTR1    EQU   X'2B'                                                    60260018
INTR2    EQU   X'2C'                                                    60320018
INTR3    EQU   X'16'                                        LD @ZA00541 60370003
INTR4    EQU   X'10'                                        LD @ZA00541 60420003
PGFXBIT  EQU   X'C0'                                                    62420002
DISP0    EQU   0                  ZERO DISPLACEMENT              Y02947 62430002
DISP1    EQU   1                  VALUE OF ONE                   Y02947 62470002
DISP4    EQU   4                  DISPLACEMENT OF 4              Y02947 62472002
DISP6    EQU   6                  DISPLACEMENT OF 6              Y02947 62480002
DISP28   EQU   28                 DISPLACEMENT OF 28             Y02947 62482402
LEN2     EQU   2                  LENGTH OF 2                    Y02947 62490002
SIXT     EQU   16                 OFFSET TO CVT                  Y02947 62500002
FOUR     EQU   4                                              LD YM7707 62510000
SEVEN    EQU   7                  MASK FOR STCM INSTRUCTION      Y02947 62520002
*                                 (3 BYTES)                      Y02947 62570002
EIGHT    EQU   8                   DISPLACEMENT OF 8        LD @ZA00531 62580003
TWELVE   EQU   12                  DISPLACEMENT OF 12       LD @ZA00531 62620003
TWENTY   EQU   20                                              @ZA11446 62670000
         SPACE 2                                                        63200017
IGG019MA DC    C'IGG019MA'              READ/WRITE MODULE        YM4057 63360002
IGG019MB DC    C'IGG019MB'              CE/ABE APPENDAGE         YM4057 63370002
IGG019MC DC    C'IGG019MC'              PCI MOD NAME             Y02947 63400002
IGG019PD DC    C'IGG019PD'              WTTA CE APPENDAGE        YM4057 63450002
IGG019MR DC    C'IGG019MR'              ON LINE TEST MODULE      YM4091 63500002
IGG019MS DC    C'IGG019MS'              BUFFER MANAGEMENT MODULE YM5661 63550002
PCIAPP   DC    C'MC'                   PCI APPENDAGE                    66600017
         DC    XL4'0'                  TTRL FIELD                       66800017
ONLTST   DC    C'MR'                    ON-LINE TEST CONTROL MOD   000D 67000017
         DC    XL4'0'                        TTRL FIELD            000D 67200017
BPMR     DC    C'MS'                   BUFFER POOL MANAGEMENT ROUTINE   67400017
         DC    XL4'0'                  TTRL FIELD                       67600017
CHENDAPP DC    C'MB'                   CHANNEL END/ABNORMAL END         67800017
*                                 APPENDAGE                             68000017
         DC    XL4'0'                  TTRL FIELD                       68200017
CEAPPWT  DC    C'PD'                    CHANNEL END/ABNORMAL END   000G 68400017
*                                  APPENDAGE FOR WTTA.             000G 68600017
         DC    XL4'0'                   TTRL FIELD                 000G 68800017
READWR   DC    C'MA'                   READ/WRITE ROUTINE               69000017
         DC    XL4'0'                  TTRL FIELD                       69200017
BREAK41  DC    C'PK',XL4'0'            2741 BREAK MODULE                75200019
SIOAP    DC    C'LP',XL4'0'            SIO APPENDAGE                    78200002
SUBPOOL  DC    X'FA000000'             SUBPOOL 250             @ZA11446 78250000
ECBPOST  DC    X'40000004'    POST CODE FOR ECB FROM TRANSWAP  @ZA17710 78300000
         EJECT                                                   Y02947 78400002
         IHAASCB                                                        78450000
         EJECT                                                          78500000
         DCBD  DSORG=BX,DEVD=BS                                    000E 83000017
         EJECT                                                          83050000
        IECTDEBX                                                        83400017
         EJECT                                                     000M 83420000
         IHAPSA                                                  Y02947 83430002
         EJECT                                                     000M 83440000
         IECDSECS MAIN,WTG,PREFX,CVT,EXPAND=YES                  Y20947 83510002
         EJECT                                                          83560000
         IKJTCB DSECT=YES                                               83570000
         END                                                            83600017
