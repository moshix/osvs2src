         TITLE ' GRAPHICS OPEN EXECUTOR '                               00050002
*********************************************************************** 00100002
*                                                                       00150002
* MODULE NAME:           IGG0193Y (OS/VS2)                              00200002
*                                                                       00250002
* DESCRIPTIVE NAME:      GRAPHICS OPEN EXECUTOR                         00300002
*                                                                       00350002
* COPYRIGHT:             NONE                                           00400002
*                                                                       00450002
* STATUS:                RELEASE 2.0                                    00500002
*                                                                       00550002
* FUNCTION:              THIS MODULE PERFORMS ALL OPEN FUNCTIONS FOR    00600002
*                        THE 2250S AND 2260S SUPPORTED BY GPS.          00650002
*                                                                       00700002
*                        THIS INCLUDES:                                 00750002
*                          1. VALIDITY CHECKS.                          00800002
*                                A. UCB IS A GRAPHICS SUPPORTED DEVICE  00850002
*                                     1. 2250 )   ALL MODELS SUPPORTED  00900002
*                                     2. 2260 )))       AND             00950002
*                                     3. 1053 )   ALL LOCALLY ATTACHED  01000002
*                                B. GNCP RANGE IN DCB IS 1 THRU 99      01050002
*                                C. SAME TASK IN CONTROL IF MULTI DCBS  01100002
*                                     PER DEVICE ARE USED               01150002
*                          2. BUILDING AND INITIALIZING THE REQUIRED    01200002
*                             CONTROL BLOCKS.                           01250002
*                                A. DCB                                 01260002
*                                B. DEB                                 01300002
*                                C. IOB                                 01350002
*                                D. UCB                                 01400002
*                                E. BASIC TEB                           01450002
*                                F. BASIC IRBS & IQES                   01500002
*                                     1. IGG019OE                       01550002
*                                     2. IFFCAN03                       01600002
*                                G. EXPRESS USER POLL LIST              01650002
*                                H. EXPRESS 2250 BUFFER TABLE           01700002
*                          3. LOADING THE NECESSARY I/O AND ATTENTION   01750002
*                             HANDLING MODULES.                         01800002
*                                A. IGG019OA FOR GRAPHICS I/O           01850002
*                                B. IGG019OB     CHANNEL ENDS           01900002
*                                C. IGG019OC     PAGE FIXING            01950002
*                                D. IGG019OE     BASIC ATTN ROUTER      02000002
*                                E. IGG019OJ     BASIC ATTN USER ENTRY  02050002
*                                F. IFFCAN03     BASIC 2250 CANCEL KEY  02100002
*                          4. UNLOCK 2250 KEYBOARDS IF PRESENT.         02150002
*                                                                       02200002
******************* PROLOGUE*CONTINUED*NEXT*PAGE ********************** 02250002
         EJECT                                                          02300002
*********************************************************************** 02350002
* NOTES:                                                                02400002
*                                                                       02450002
*     DEPENDENCIES:      KEY 5 CONTROL IS RECEIVED FROM SYSTEM OPEN.    02500002
*                        USER DCB ADDRESS, KEY AVAIL FROM SYS WORKAREA. 02550002
*                        SYSTEM NUCLEUS, KEY 0, IS NOT FETCH PROTECTED. 02600002
*                        IF FIRST UCB ON TIOT IS GRAPHIC TYPE,          02650002
*                           ALL FOLLOWING UCBS WILL BE GRAPHIC.         02700002
*                                                                       02750002
*     RESTRICTION:       FOR 2250S, ONE DEVICE PER DCB WHICH RESULTS    02800002
*                                   IN ONE UCB PER DEB.                 02850002
*                                                                       02900002
*     RESISTERS:         SEE EQUATE DEFINITIONS FOLLOWING PROLOG        02950002
*                                                                       03000002
*     PATCH LABEL:       PATCH, A 50 BYTE DC AREA AT END OF MODULE      03050002
*                                                                       03100002
* MODULE TYPE:           EXECUTABLE CODE                                03150002
*                                                                       03200002
*    PROCESSOR:          ASSEMBLER XF                                   03250002
*                                                                       03300002
*    MODULE SIZE:        SEE PAGE 1 OF THIS LISTING                     03350002
*                                                                       03400002
*    ATTRIBUTES:                                                        03450002
*       AT ENTRY:        REENTRANT  ENABLED  SUPERVISOR STATE IN KEY 5  03500002
*       ASSUMED KEYS:    0, USER (AS RECORDED IN SYSTEM OPEN WORKAREA)  03550002
*                                                                       03600002
* ENTRY POINT:           IGG0193Y                                       03650002
*                                                                       03700002
*    PURPOSE:            SEE 'FUNCTION' HEADING ABOVE                   03750002
*                                                                       03800002
*    LINKAGE:            SEE 'INPUT', NEXT HEADING                      03850002
*                                                                       03900002
* INPUT:                 REGISTERS 5 THRU 8 AS FOLLOWS:                 03950002
*                          5 ADDR OF: TOP OF DCB LIST BEING PROCESSED   04000002
*                          6          TOP OF WHERE-TO-GO TABLE          04050002
*                          7          CURRENT ENTRY OF DCB LIST         04100002
*                          8          CURRENT ENTRY OF WHERE-TO-GO TAB  04150002
*                            NOTE: 4 CONTAINS A VALID WORKAREA ADDR     04200002
*                               ONLY IF CONTROL RECEIVED FROM SYS OPEN  04250002
*                                                                       04300002
* OUTPUT:                SEE 'FUNCTION' HEADING ABOVE                   04350002
*                                                                       04400002
* EXITS:                                                                04450002
*                                                                       04500002
*    NORMAL:             XCTL, USING WTG TABLE FOR MODULE ID            04550002
*                                                                       04600002
*    ERROR:              XCTL, USING PROBLEM DETERMINATION MACRO        04650002
*                          DMABCOND FOR MODULE ID                       04700002
*                                                                       04750002
******************* PROLOGUE*CONTINUED*NEXT*PAGE ********************** 04800002
         EJECT                                                          04850002
*********************************************************************** 04900002
*                                                                       04950002
* EXTERNAL REFERENCES:                                                  05000002
*                                                                       05050002
*     ROUTINES:          IGC0007A TO ASSIGN EXPRESS 2250 BUFFER         05100002
*                        EXCP        UNLOCK 2250 KEYBOARDS              05150002
*                                                                       05200002
*     DATA AREAS:        SEE DSECT SECTION AT END OF LISTING            05250002
*                                                                       05300002
*     CONTROL BLOCKS:    SEE DSECT SECTION AT END OF LISTING            05350002
*                                                                       05400002
* TABLES:                TABLE OF TCB/ASCB ADDRESSES                    05450002
*                        WHERE-TO-GO TABLE (SEE IECDSECS DSECT)         05500002
*                                                                       05550002
* MACROS:                ASGNBFR       FREEMAIN       SETLOCK           05600002
*                        CIRB          GETMAIN        WAIT              05650002
*                        DEBCHK        LOAD           XCTL              05700002
*                        DMABCOND      MODESET        XCTLTABL          05750002
*                                                                       05800002
* CHANGE ACTIVITY:       MODULE HAS BEEN RESTRUCTURED TO CONSOLIDATE    05850002
*                        THE THREE PREVIOUS OPEN LOADS INTO A SINGLE    05900002
*                        LOAD MODULE.  CSECT FLAGS UPDATED WHERE        05950002
*                        APPROPIATE.                                    06000002
*                                                                       06050002
*                        FIXES DROPPED LIST:                            06100002
*                          SM3010   DEB CALCULATION CODE REWRITTEN      06150002
*                          SA40953  APPLIES TO GRAPHICS 2280 DEVICES    06200002
*                                   WHICH ARE NOT SUPPORTED IN VS       06250002
*                                                                       06300002
*********************************************************************** 06350002
         SPACE 3                                                        06400002
IGG0193Y CSECT                                                          06450002
*   SEE LABEL 'MODID' FOR LAST CHANGE DATE; FORMAT:  NAME.SYSREL.PTF NO 06500000
*A409100                                                      LF YM5685 06510002
*A441000                                                      LF YM5684 06550002
*C402500,A475500-476000                                       LF YM4068 06590002
*C361000,C368000                                              LF YM4054 06640002
*A340000-340500                                              LD YA00809 06690002
*C177500                                                         YM1962 06740002
*A202000                                                         Y01021 06790002
*A111500-112000,274500-277000,278000-282000,479000-486500,5045 LB AOS/1 06840002
*A337000-339500,383000-383500                                   SA40756 06890002
*A492000,495000,497500                                           S21016 06940002
*D445500,A463700-463900                                      LG YM08088 06942000
*A474100-474200                                      LG ZA00500,YM08809 06944000
* C104000,A262600,A362100,C510000,A576600                    LG @ZM2360 06946000
*C336000,A336100-336200,A336520-336670A338300               E12 ZA25969 06947000
*C34050                                                     E12 ZA26129 06948000
          EJECT                                                         06950002
*********************************************************************** 07000002
*                                                                     * 07050002
*                        REGISTER ASSIGNMENTS                         * 07100002
*                                                                     * 07150002
*               TEMPORARY ASSIGNMENTS IN LOW NUMBER REGS              * 07200002
*               PERMANENT ASSIGNMENTS IN HIGH NUMBER REGS             * 07250002
*               INPUT NAMES IDENTICAL TO THOSE IN SYSTEM OPEN         * 07300002
*********************************************************************** 07350002
         SPACE                                                          07400002
RE       EQU   0    TEMPORARY:         ENTRY POINT ADDRESSES            07450002
RSIZE    EQU   0                       GETMAIN SIZES                    07500002
RADR     EQU   1                       ADDR WORK REG                    07550002
RCALC    EQU   1                       CALCULATIONS                     07600002
RBACK    EQU   14                      RETURN ADDRESS FOR LINKAGES      07650002
RLINK    EQU   15                      BRANCH ADDRESS FOR LINKAGES      07700002
RCODE    EQU   15                      RETURN CODES FROM LINKAGES       07750002
         SPACE                                                          07800002
RBASE    EQU   2    CONVENTIONS:       BASE REGISTER                    07850002
RDCB     EQU   3                       DCB ADDRESS REGISTER             07900002
RGMTCB   EQU   4                       TCB   FOR GETMAIN                07950002
RASCB    EQU   7                       ASCB  FOR GETMAIN                08000002
         SPACE                                                          08050002
RDDCTR   EQU   4    CALCULATIONS:      COUNTER OF DD ENTRIES            08100002
RCTR     EQU   4                       GENERAL COUNTER                  08150002
RDEL     EQU   5                       TOT DEVICE ENTRY LENGHT OF TIOT  08200002
RIDX     EQU   5                       UCB INDEX NUMBER                 08250002
RLOC     EQU   5                       LOCATION REG FOR INDEXING        08300002
RLGH     EQU   6                       LENGTH OF DEB IN BYTES           08350002
RDBWD    EQU   7                       LENGTH OF DEB IN DOUBLE WORDS    08400002
RCLR     EQU   8                       DEB LGH TO BE CLEARED IN BYTES   08450002
REXT     EQU   8                       NUMBER OF EXTENTS FOR IQES       08500002
RCOUNT   EQU   10                      LOOP COUNTER FOR NBR OF IQES     08550002
         SPACE                                                          08600002
RCORE    EQU   4   INPUT ADDRESSES:    WORKAREA ONLY IF FROM SYS OPEN   08650002
RPAR     EQU   5                       PARAMETER LIST OF DCB ADDRS      08700002
RWTG     EQU   6                       WTG TABLE, EG. LABEL 'DXXWTG'    08750002
RPARC    EQU   7                       CURRENT PARAMETER LIST ENTRY     08800002
RWTGC    EQU   8                       CURRENT WGT TABLE ENTRY          08850002
         SPACE                                                          08900002
RIRB     EQU   6   ADDRESSES:          IRB BEING INITIALIZED            08950002
RDEB     EQU   9                       DEB BEING CONSTRUCTED            09000002
RTCB     EQU   10                      CURRENT TCB FROM CVT TCB TABLE   09050002
RIOB     EQU   11                      IOB USED TO UNLOCK 2250 KEYBRDS  09060002
RTEB     EQU   11                      TEB BEING CONSTRUCTED/UPDATED    09100002
RTIOT    EQU   11                      TIOT DD ENTRY                    09150002
RUCB     EQU   12                      CURRENT UCB                      09200002
RSAVE    EQU   13                      SAVE AREA FOR OPEN               09250002
RSCB1    EQU   14                      TEMP SYS CB ADDRESSES            09300002
RSCB2    EQU   15                      TEMP SYS CB ADDRESSES            09350002
          EJECT                                                         09400002
*********************************************************************** 09450002
*                                                                     * 09500002
*                        EQUATES                                      * 09550002
*                                                                     * 09600002
*********************************************************************** 09650002
ACURASCB EQU   12     CURRENT ASCB ADDR LOC IN TCB TABLE                09700002
ACURTCB  EQU   4      CURRENT TCB ADDR LOC IN TCB TABLE                 09750002
ADR      EQU   4      ADDR LENGTH IS 4 BYTES                            09800002
BLANK    EQU   X'40'  CHECK FOR BLANK IN NAME FIELD                     09850002
DBLWRD   EQU   7                      ROUND TO DOUBLE WORD BDRY  SM1831 09900002
DBWD     EQU   3      DOUBLE WORD CALCULATIONS                          09950002
DCBADR   EQU   0      CURRENT DCB ADDR FROM INPUT PLIST                 10000002
ECBCC    EQU   X'7F'  ECB COMPLETION CODE FOR SUCCESSFUL I/O            10050002
FULLMASK EQU   X'FF'                   MASK OF ALL ONES         SA25381 10100002
POLSTACT EQU   X'FF'  ACTIVE FLAG FOR POLL LIST IN EXPRESS GRAPHICS     10150002
         SPACE                                                          10200002
DEBSIZE  EQU   79     MINIMUM DEB IS APG+PFX+BASE+ID                    10250002
DECBSIZE EQU   32     DECB USED FOR UNLOCKING 2250 KEYBOARD             10300002
IOBSIZE  EQU   72     MINIMUM IOB IS STD+EXT                            10350002
TEBSZ    EQU   36     SIZE OF TEB IN BYTES                   LG @ZM2360 10400000
         SPACE                                                          10450002
TTROFF   EQU   14                                                       10500002
TIOTOFF  EQU   17                                                       10550002
WAOFF    EQU   32                                                       10600002
WGOFF    EQU   8                                                        10650002
         SPACE                                                          10700002
ZERO     EQU   0      DECIMAL/HEX NUMBERS FOR GENERAL USE               10750002
ONE      EQU   1                                                        10800002
TWO      EQU   2                                                        10850002
THREE    EQU   3                                                        10900002
FOUR     EQU   4                                                        10950002
SIX      EQU   6                                                        11000002
SEVEN    EQU   7                                                        11050002
EIGHT    EQU   8                                                        11100002
SHFT11   EQU   11                      SHIFT COUNT                AOS/1 11150002
SHFT24   EQU   24                      SHIFT COUNT                AOS/1 11200002
         SPACE                                                          11250002
EXCP     EQU   0      SVC NUMBERS                                       11300002
         EJECT                                                          11350002
*********************************************************************** 11400002
*                                                                     * 11450002
*                        INITIALIZATION                               * 11500002
*                                                                     * 11502002
*         1. USING STATEMENTS IDENTIFY DSECT BASE REGISTERS           * 11510002
*         2. BASE ESTABLISHED FOR ADDRESSABILITY OF MODULE            * 11520002
*         3. MODULE EYECATCHER ID FOR RELEASE LEVEL VERIFICATION      * 11530002
*                                                                     * 11550002
*********************************************************************** 11600002
         SPACE 2                                                        11650002
         USING CVT,RSCB1         CVT DSECT INITZ FROM LOC 16            11700002
         USING FORCORE,RCORE     IECDSECS, KEY 5, REFERENCED ONLY       11750002
         USING IHADCB,RDCB       DCB DSECT; KEY 5: COPIED; KEY >7: USER 11800002
         USING IECTDEB,RDEB      DEB DSECT, KEY 5, CREATED BY GAM OPEN  11850002
         USING SAVEAREA,RSAVE    SAVE/WORK AREA, KEY 5, FOR GAM OPEN    11900002
         USING TCB,RTCB          STD DSECTS, KEY 0:  TCB                11950002
         USING TIOENTRY,RTIOT                        TIOT               12000002
         USING UCB,RUCB                              UCB                12050002
         SPACE 3                                                        12100002
         BALR  RBASE,0                                                  12150002
         USING *,RBASE                          SET UP BASE REGISTER    12200002
         B     *+24                                                     12250002
MODID    DC    C'IGG0193Y.VS2R2.14548'         MODULE EYECATCHER ID     12300000
         EJECT                                                          12350002
*********************************************************************** 12400002
*                                                                     * 12450002
*                        INITIALIZATION                               * 12520002
*                                                                     * 12570002
*         4. SAVE/WORK AREA IS USED TO PRESERVE REENTRANT STATUS.     * 12580002
*            INPUT REGS ARE SAVED NOW TO EXPAND NUMBER OF WORK REGS   * 12600002
*            DURING CONTROL BLOCK CONSTRUCTION.                       * 12700002
*         5. ACCESS TIOT DD ENTRY SO DEVICE TYPES CAN BE VALIDATED    * 12750002
*                                                                     * 12800002
*********************************************************************** 12850002
         L     RSIZE,SAVSPSIZ     GET SAVE/WORK AREA FOR GRAPHIC OPEN   12900002
         GETMAIN R,LV=(0)                                               12950002
         LR    RSAVE,RADR                                               13000002
OPEN0010 EQU *                                                          13050002
         STM   RPAR,RWTGC,R5         SAVE INPUT/UPDATED REGS            13100002
         L     RSCB1,CVTPTR          GET CVT ADDR FROM FIXED LOCATION   13150002
         L     RTCB,CVTTCBP          GET ADDRS OF TCB TABLE             13200002
         L     RSCB2,ACURASCB(RTCB)               ASCB                  13250002
         ST    RSCB2,ASCBADR                        KEEP FOR BR ENTRIES 13300002
         L     RTCB,ACURTCB(RTCB)                 CURRENT TCB           13350002
         L     RTIOT,TCBTIO                       TIOT                  13400002
         L     RDCB,DCBADR(RPARC) GET ADDR OF:  DCB TO BE PROCESSED     13450002
         L     RCORE,ADR(RWTGC)                 WORK AREA FOR THIS DCB  13500002
         ST    RCORE,R4                           KEEP AVAIL FOR USE    13550002
         L     RSCB2,DXUDCBAD                   USER'S DCB              13600002
         ST    RSCB2,UDCBADR                      KEEP AVAIL FOR I/O    13650002
         AH    RTIOT,DCBTIOT                    DD ENTRY                13700002
         EJECT                                                          13750002
*********************************************************************** 13800002
*                                                                     * 13850002
*                          VALIDITY CHECKS                            * 13900002
*                                                                     * 13950002
*        1. VALID DEVICE TYPES                                        * 14000002
*              A.  ASSUME ALL UCBS OK IF FIRST IS OK                  * 14050002
*        2. NUMBER OF CHANNEL PROGRAMS                                * 14100002
*        3. MULTIPLE TASKING, DONE LATER DURING ATTN HANDLING INITZ   * 14150002
*                                                                     * 14200002
*********************************************************************** 14250002
         L     RUCB,TIOESTTB     GET FIRST UCB ADDR                     14300002
         LA    RUCB,ZERO(RUCB)                                          14350002
         CLI   UCBTBYT3,UCB3DISP     IS DEVICE GRAPHICS TYPE            14400002
         BNE   IEC158I                  IF NO, ISSUE MSG AND ABEND D13  14450002
         CLI   UCBTBYT4,UCBT2250     IS DEVICE 2250 TYPE                14500002
         BE    OPEN0020                 IF YES,  OK TO PROCESS          14550002
         CLI   UCBTBYT4,UCBT2260     IS DEVICE 2260 TYPE                14600002
         BE    OPEN0020                 IF YES, OK TO PROCESS           14650002
         CLI   UCBTBYT4,UCBT1053     IS DEVICE 1053                     14700002
         BNE   IEC158I                  IF NO, ISSUE MSG AND ABEND D13  14750002
OPEN0020 EQU   *                                                        14800002
         CLI   DCBGNCP,DCBGNCPH      IS GNCP GREATER THAN 99            14850002
         BH    IEC159I                  IF YES, SET UP PD MSG & EXIT    14900002
         CLI   DCBGNCP,DCBGNCPL      IS GNCP LESS OR EQUAL TO 0         14950002
         BNH   IEC159I                  IF YES, SET UP PD MSG & EXIT    15000002
         EJECT                                                          15050002
*********************************************************************** 15100002
*                                                                     * 15150002
*                         DEB CONSTRUCTION                            * 15200002
*                                                                     * 15250002
*        1.   CALCULATE TOTAL DEB SIZE FOR GETMAIN                    * 15300002
*           A. SIZE IS FOUR BYTES PER DEVICE ENTRY PLUS DEB SIZE      * 15350002
*           B. DEB SIZE IS SUM OF PREFIX, BASIC, ETC.                 * 15400002
*                                                                     * 15450002
*********************************************************************** 15500002
         LR    RSCB1,RTIOT       USE TEMP REG FOR ADR CALC              15550002
         DROP RTIOT                                                     15600002
         USING TIOENTRY,RSCB1                                           15650002
         SR    RCALC,RCALC       INITZ FOR  CALC WORK REG               15700002
         SR    RDDCTR,RDDCTR                DD COUNT                    15750002
         SR    RDEL,RDEL                    DD ENTRY LGH IN BYTES       15800002
OPEN0030 LA    RDDCTR,ONE(RDDCTR)       COUNT EACH DD ENTRY             15850002
         IC    RCALC,TIOELNGH           GET LGH OF THIS DD ENTRY        15900002
         AR    RSCB1,RCALC              CALC ADR OF NXT DD ENTRY        15950002
         SH    RCALC,SIXTEEN            CALC LGH OF DEV ENTRIES         16000002
         AR    RDEL,RCALC                ACCUMULATE TOTAL LGH           16050002
         L     RSCB2,TIOELNGH            CK IF END OF TABLE             16100002
         LTR   RSCB2,RSCB2                                              16150002
         BZ    OPEN0040                    IF YES, CONTINUE WITH GM     16200002
         CLI   TIOEDDNM,BLANK              IF NO, CK FOR BLANK NAME     16250002
         BE    OPEN0030                      IF BLANK, COUNT CONCAT DD  16300002
OPEN0040 LA    RLGH,DEBSIZE(RDEL)    LOAD TOTAL DEB SIZE                16350002
         LA    RLGH,DBLWRD(RLGH)   ROUND UP TO DOUBLE WORD BDRY         16400002
         SRL   RLGH,DBWD           SHIFT OUT 7-ADDED FOR DB WD B        16450002
         LR    RDBWD,RLGH          SAVE FOR LATER USE IN DEB INITZ      16500002
         SLL   RLGH,DBWD           ROUND UP TO DB WORD IN BYTES         16550002
         LR    RSIZE,RLGH          KEEP FOR LATER USE IN CLEARING DEB   16600002
         O     RSIZE,DEBSPOOL      SUBPOOL NO INTO HIGH ORDER BYTE      16650002
         GETMAIN R,LV=(0)          DEB SIZE IN REGISTER 0               16700002
         LR    RDEB,RADR           DEB SIZE = 52 + 20 + 7 + UCB         16750002
         DROP  RSCB1               DROP TEMP REG USED FOR ADR CALC      16800002
         USING TIOENTRY,RTIOT                                           16850002
         EJECT                                                          16900002
*********************************************************************** 16950002
*                                                                     * 17000002
*                         DEB CONSTRUCTION                            * 17050002
*                                                                     * 17100002
* 2. CLEAR AND INITIALIZE DEB:                                        * 17150002
*  A. PREFIX SECTION FIRST, THEN BASIC SECTION BY ASCENDING LOCATIONS.* 17200002
*  B. APPENDAGE TABLE IS DONE AFTER DEB IS ADDED USING DEBCHK.        * 17250002
*  C. ID SECTION IS DONE AS MODULES ARE LOADED.                       * 17300002
*                                                                     * 17350002
*     REG CONTENTS:     RDBWD HAS  DEB SIZE IN DOUBLE WORDS           * 17400002
*                       RDEB       ADDR OF DEBEOEA (BEGINING OF APDG) * 17450002
*                       RLGH       DEB SIZE IN BYTES                  * 17500002
*                                                                     * 17550002
*********************************************************************** 17600002
OPEN0050 EQU   *                                                        17650002
         CH    RLGH,HWC256       CK IF DEB SIZE LESS THAN 256 BYTES     17700002
         BNH   OPEN0060             IF YES, SKIP CLEARING LOOP   YM1962 17750002
         LA    RCLR,FULLMASK            LENGTH IN RCLR FOR EX INSTR     17800002
         SH    RLGH,HWC256              SUBTRACT FOR SIZE CLEARED       17850002
         EX    RCLR,CLEAR               EXECUTE CLEAR DEB INSTRUCTION   17900002
         AH    RADR,HWC256              INCREMENT FOR NEXT SECTION      17950002
         B     OPEN0050                 REPEAT TIL DONE                 18000002
OPEN0060 EQU   *                                                        18050002
         BCTR  RLGH,RSIZE             DECREMENT BY 1 FOR EX INSTR       18100002
         EX    RLGH,CLEAR             LAST DEB SIZE CLEARED             18150002
         STC   RDBWD,DEBLNGTH             MOVE IN DOUBLE WORDS OF DEB   18200002
         ST    RTCB,DEBNMSUB              DEBTCBAD OVERLAYS DEBNMSUB    18250002
         SRL   RDEL,2                     DIVIDE UCBS BY 4              18300002
         STC   RDEL,DEBNMEXT              MOVE NO OF EXTENTS INTO DEB   18350002
         EJECT                                                          18400002
*********************************************************************** 18450002
*                                                                     * 18500002
*                         DEB CONSTRUCTION                            * 18550002
*                                                                     * 18600002
*     2. INITIALIZING DEB:                                            * 18650002
*         A. BASIC SECTION, CONT.: CHAIN DEB TO OTHER CONTROL BLOCKS  * 18700002
*           1). DCB           USER DCB FOR DEBCHK MACRO               * 18750002
*           2). TCB           KEY 0 CB                                * 18800002
*                                                                     * 18900002
*********************************************************************** 18950002
         L     RSCB1,UDCBADR          GET USER DCB ADDR                 19000002
         ST    RSCB1,DEBPROTG            USER DCB ADDR TO DEBDCBAD      19050002
         LA    RADR,DEBNMSUB          ACCESS ADDR OF BASIC DEB          19100002
         STCM  RADR,SEVEN,DCBDEBA        CHAIN TO COPIED DCB            19150002
         DROP  RCORE                                                    19200002
         USING FORCORE,RSCB2     IECDSECS, KEY 5, REFERENCED ONLY       19250002
         L     RSCB2,R4     GET ADDR OF WORKAREA                        19300002
         MODESET  KEYADDR=DXUKEY,WORKREG=15                             19350002
         DROP  RDCB                                                     19400002
         USING IHADCB,RSCB1           USER DCB ADDRESSING               19450002
         STCM  RADR,SEVEN,DCBDEBA        CHAIN TO USER DCB              19500002
         DROP  RSCB1                                                    19550002
         USING IHADCB,RDCB            COPY DCB ADDRESSING               19600002
         MODESET  EXTKEY=ZERO                                           19650002
         L     RSCB2,TCBDEB           GET FIRST DEB ADDR                19700002
OPEN0065 LA    RSCB2,ZERO(RSCB2)        INITZ DEBAMLNG TO ZERO          19750002
         ST    RSCB2,DEBAMLNG           STORE AMLNG/DEBPTR              19800002
         CS    RSCB2,RADR,TCBDEB      PUT NEW DEB ON TCB CHAIN          19850002
         BNE   OPEN0065               REPEAT IF FIRST DEB ADDR CHANGED  19900002
         EJECT                                                          19910002
*********************************************************************** 19920002
*                                                                     * 19930002
*                         DEB CONSTRUCTION                            * 19940002
*                                                                     * 19942002
*     2. INITIALIZING DEB:                                            * 19944002
*         A. BASIC SECTION, CONT.: CHAIN DEB TO OTHER CONTROL BLOCKS  * 19946002
*           3). DEB CHAIN     KEY 5 WITH DEBCHK MACRO                 * 19948002
*         B. BASIC SECTION, CONT.: ATTACH UCB ADDRESSES FROM TIOT     * 19948402
*         C. APPENDAGE TABLE, USING IOS RETURN ADDRESS                * 19948802
*                                                                     * 19949202
*********************************************************************** 19949602
         MODESET  EXTKEY=DATAMGT                                        19950002
         MVC   DEBPROTG,TCBPKF         STORAGE KEY TO DEB               20000002
         OI    DEBPROTG,DEBID          PROTECTION TAG FOR DEB ID        20050002
         ST    RDEB,DEBEXSCL             STORE DEB APPENDAGE TABLE ADR  20100002
         MVI   DEBEXSCL,X'02'           MOVE IN 2 FOR NON-DIR ACC DEV   20150002
         DEBCHK (RSCB1),TYPE=ADD,AM=GAM     ADD TO DEB TABLE  LB Y01021 20200002
         LA    RDEL,DEBUCBAD              ACCESS DEBUCB ADDRESS         20750002
OPEN0070 EQU   *                                                        20800002
         SR    RCALC,RCALC                 CLEAR LENGTH REGISTER        20850002
         IC    RCALC,TIOELNGH              LOCATE STARTING TIOT         20900002
         SH    RCALC,SEVNTEEN              UCBS PLUS 1 FOR EX INSTR     20950002
         EX    RCALC,UCBMOVE               MOVE UCBS FROM TIOT TO DEB   21000002
         LA    RDEL,ONE(RDEL,RCALC)        INCREMENT DEB POS BY LENGTH  21050002
         LA    RTIOT,TIOTOFF(RTIOT,RCALC)  INCREMENT TO PT TO NEXT TIOT 21100002
         BCT   RDDCTR,OPEN0070             GO GET NEXT UCB, IF ANY MORE 21150002
         DROP  RTIOT                                                    21200002
         USING CVT,RSCB1                                                21250002
         L     RSCB1,CVTPTR          ACCESS PTR TO CVT                  21300002
         L     RADR,CVTXAPG          LOAD IOS APPENDAGE TABLE ADDR      21350002
         L     RADR,ZERO(RADR)       LOAD IOS RETURN ADDR               21400002
         ST    RADR,DEBEOEA               STORE INTO DEB APPENDAGE      21450002
         ST    RADR,DEBSIOA                                             21500002
         ST    RADR,DEBPCIA                                             21550002
         EJECT                                                          21600002
*********************************************************************** 21650002
*                                                                     * 21700002
*                         IOB CONSTRUCTION                            * 21750002
*                                                                     * 21800002
*        1.   CALCULATE TOTAL IOB SIZE FOR GETMAIN                    * 21850002
*           A. SIZE IS IOBSIZE*(GNCP+1)+ECB IF GNCP<99                * 21900002
*           B. ECB SIZE IS 8 BYTES TO INCL POINTER TO NEXT AVAIL IOB  * 21950002
*                                                                     * 22000002
*********************************************************************** 22050002
         SR    RCTR,RCTR          CLEAR MULTIPLIER REG                  22100002
         SR    RSIZE,RSIZE        CLEAR FOR MULTIPLY PAIR               22150002
         IC    RCTR,DCBGNCP       GET GNCP INTO MULTIPLIER REG          22200002
         CLI   DCBGNCP,DCBGNCPH     IS GNCP EQUAL TO MAXIMUM            22250002
         BE    OPEN0080               IF YES, DON'T BUILD EXTRA IOB     22300002
         LA    RCTR,ONE(RCTR)         IF NO, ADD ONE FOR EXTRA IOB      22350002
OPEN0080 EQU   *                                                        22400002
         LA    RCALC,IOBSIZE      GET MINIMUM IOB SIZE                  22450002
         LR    RLGH,RCALC          SAVE LENGHT FOR LATER USE            22500002
         MR    RSIZE,RCTR          MULTIPLY IOB SIZE BY GNCP            22550002
         LA    RSIZE,EIGHT(RCALC)  TOTAL IOB CORE INTO REG 0            22600002
         MODESET EXTKEY=ZERO                                            22650002
         O     RSIZE,IOBSPOOL         SUBPOOL NO INTO HIGH ORDER BYTE   22700002
         GETMAIN R,LV=(0)           GET CORE FOR IOB S                  22750002
         XC    0(8,RADR),0(RADR)    CLEAR  1ST IOB -8                   22800002
         LA    RADR,EIGHT(RADR)     POINT PAST 1ST AVAIL PTR            22850002
         EJECT                                                          22900002
*********************************************************************** 22950002
*                                                                     * 23000002
*                         IOB CONSTRUCTION                            * 23050002
*                                                                     * 23100002
*       2. CHAIN IOB TO BOTH COPIED AND USER'S DCB (KEY 5 AND >7)     * 23150002
*       3. CLEAR AND INITIALIZE IOB FIELDS                            * 23200002
*  RADR:  IOB ADDRESS FROM GETMAIN AFTER TOP 8 BYTES ALLOCATED TO ECB * 23250002
*                                                                     * 23300002
*********************************************************************** 23350002
         MODESET  EXTKEY=DATAMGT                                        23400002
         ST    RADR,DCBIOBAD          CHAIN IOB TO COPY DCB             23450002
         L     RSCB1,UDCBADR          GET USER DCB ADDR                 23500002
         L     RSCB2,R4     GET ADDR OF WORKAREA                        23550002
         MODESET  KEYADDR=DXUKEY,WORKREG=15                             23600002
         DROP  RDCB                                                     23650002
         USING IHADCB,RSCB1           USER DCB ADDRESSING               23700002
         ST    RADR,DCBIOBAD          CHAIN IOB TO USER DCB             23750002
         DROP  RSCB1                                                    23800002
         USING IHADCB,RDCB            COPY DCB ADDRESSING               23850002
         MODESET  EXTKEY=ZERO                                           23900002
         USING DXIOB,RADR            TEMP BASE FOR IOB INITZ            23950002
         SR    RIDX,RIDX            CLEAR INDEX REGISTER                24000002
         BCTR  RLGH,RSIZE           DECREMENT BY 1 FOR EX INSTR         24050002
OPEN0090 EX    RLGH,CLEAR           CLEAR 1 IOB                         24150002
         MVI   IOBFLAG1,X'C2'       SET BITS 0, 1, AND 6                24200002
         MVI   IOBCSW+4,X'0F'       IND CHANNEL OPERATION COMP          24250002
         LA    RSIZE,IOBCCW1        GET CCW START ADDR                  24300002
         ST    RSIZE,IOBSIOCC       START ADDRESS IN IOB                24350002
         ST    RSCB1,IOBWGHT        STORE DCB ADDRESS                   24400002
         MVI   IOBWGHT,X'00'        CLEAR HIGH ORDER BYTE               24450002
         STC   RIDX,IOBUCBX         INDEX ZERO FOR FIRST UCB            24500002
         LA    RIDX,ONE(RIDX)       INCREMENT UCB INDEX COUNT           24550002
         CH    RCTR,NUMONE            IS THIS LAST IOB                  24610002
         BE    OPEN0100                 IF YES, SKIP UPDATE TO NEXT IOB 24650002
         LA    RSIZE,IOBSIZE(RADR)      IF NO, GET NEXT IOB LINK ADDR   24700002
         ST    RSIZE,IOBNXTPT                  PUT INTO IOB LINK ADR    24750002
OPEN0100 LA    RADR,ONE(RADR,RLGH)  BUMP FOR NEXT IOB CLEAR             24850002
         BCT   RCTR,OPEN0090        CLEAR NEXT IOB, IF ANY              24900002
         DROP  RADR                                                     24910002
         EJECT                                                          24950002
*********************************************************************** 25000002
*                                                                     * 25050002
*                        LOAD GRAPHICS ROUTINES                       * 25100002
*                                                                     * 25150002
*           DONE IN KEY 5 SUPERVISOR STATE FOR DEB SUBID UPDATES      * 25200002
*                AND CORRECT SUBPOOL FOR SYSTEM CLOSE DELETES         * 25250002
*               (SEE FUNCTION HEADING IN PROLOGUE FOR DETAILS)        * 25300002
*                                                                     * 25350002
*         1.     LOAD GIOCR  (MODULE NAME IGG019OA)                   * 25400002
*                                                                     * 25450002
*********************************************************************** 25500002
         MODESET  EXTKEY=DATAMGT                                        25550002
         SR    RCALC,RCALC         CALC LOC OF DEBSUBID FIELDS          25600002
         LA    RLOC,DEBUCBAD            ID SECTION FOLLOWS UCB ADDRS    25650002
         IC    RCALC,DEBNMEXT              GET NBR OF UCBS (EXTENTS)    25700002
         SLL   RCALC,2                     EXTENT SIZE IS 4 BYTES/ENTRY 25750002
         AR    RLOC,RCALC               POINT TO DEBSUBID FOR UPDATES   25800002
         SR    RCTR,RCTR           CLEAR FOR NBR OF RTNS LOADED         25850002
         USING CVT,RSCB1                                                25900002
         L     RSCB1,CVTPTR          GET PTR TO CVT                     25950002
         L     RADR,CVTSVDCB         GET SVC DCB PTR                    26000002
         LOAD  EP=IGG019OA,DCB=(RADR)                                   26050002
         MVC   ZERO(TWO,RLOC),IDGIOCR  MOVE ID TO DEB                   26100002
         LA    RLOC,TWO(RLOC)          POINT TO NEXT DEB SUB ID SECTION 26150002
         LA    RCTR,ONE(RCTR)          INCREMENT ROUTINES LOADED COUNT  26200002
         STCM  RE,SEVEN,DCBGIOCA     PLACE ENTRY POINT IN COPY DCB      26250002
         STCM  RE,SEVEN,R0+1         SAVE GIOCR ADDR FOR TEB LG @ZM2360 26260000
         L     RSCB1,UDCBADR         GET USER DCB ADDR                  26300002
         DROP  RDCB                                                     26350002
         USING IHADCB,RSCB1           USER DCB ADDRESSING               26400002
         L     RSCB2,R4              GET ADDR OF WORKAREA               26450002
         MODESET  KEYADDR=DXUKEY,WORKREG=15                             26500002
         STCM  RE,SEVEN,DCBGIOCA     PLACE ENTRY POINT IN USER DCB      26550002
         DROP  RSCB1,RSCB2                                              26600002
         USING IHADCB,RDCB            ADDRESSING:  COPY DCB             26650002
         USING FORCORE,RCORE                       CURRENT WORK AREA    26700002
         EJECT                                                          26750002
*********************************************************************** 26800002
*                                                                     * 26850002
*                        LOAD GRAPHICS ROUTINES                       * 26900002
*                                                                     * 26950002
*         2.      CHANNEL ENDS (MODULE NAME IGG019OB)                 * 27000002
*         3.      PAGE FIX     (MODULE NAME IGG019OC)                 * 27050002
*                                                                     * 27100002
*********************************************************************** 27150002
         MODESET EXTKEY=DATAMGT                                         27200002
         USING CVT,RSCB1                                                27250002
         L     RSCB1,CVTPTR              GET PTR TO CVT                 27300002
         L     RADR,CVTSVDCB             GET SVC DCB PTR                27350002
         LOAD  EP=IGG019OB,DCB=(RADR)                                   27400002
         MVC   ZERO(TWO,RLOC),IDCEXCE MOVE ID TO DEB              AOS/1 27450002
         LA    RLOC,TWO(RLOC)          NEXT DEB SUB ID SECTION    AOS/1 27500002
         LA    RCTR,ONE(RCTR)          INCR RTNS LOADED COUNT     AOS/1 27550002
         BAL   RBACK,PAGECTR           GO COMPUTE PAGE COUNT      AOS/1 27600002
         ST    RE,DEBCEA               STORE ADDRESS IN DEB AVT   AOS/1 27650002
         ST    RE,DEBXCEA              STORE ADDRESS IN DEB AVT   AOS/1 27700002
         L     RSCB1,CVTPTR               GET PTR TO CVT                27750002
         L     RADR,CVTSVDCB             GET SVC DCB PTR          AOS/1 27800002
         LOAD  EP=IGG019OC,DCB=(RADR)                             AOS/1 27850002
         MVC   ZERO(TWO,RLOC),IDPGFIX     MOVE ID TO DEB                27900002
         LA    RLOC,TWO(RLOC)          POINT TO NEXT DEB SUB ID SECTION 27950002
         LA    RCTR,ONE(RCTR)          INCREMENT ROUTINES LOADED COUNT  28000002
         STC   RCTR,DEBNMSUB             CT FINAL IF EXPR GRAPHICS      28050002
         BAL   RBACK,PAGECTR           GO COMPUTE PAGE COUNT      AOS/1 28100002
         ST    RE,DEBSIOA              STORE ADDRESS                    28150002
         OI    DEBSIOA,DEBPGFX         INDICATE FIX APPNDG THERE  AOS/1 28200002
         TM    DCBGTYPE,DCBGTBAS  IS THIS BASIC ATTN HANDLING           28250002
         BNO   OPEN0110             IF NO, SKIP BASIC LOADS             28300002
         EJECT                                                          28350002
*********************************************************************** 28400002
*                                                                     * 28450002
*                  LOADS FOR BASIC ATTENTION HANDLING                 * 28500002
*                                                                     * 28550002
*         1.     GAR   (MODULE NAME IGG019OE)                         * 28600002
*         2.     GEIR  (MODULE NAME IGG019OJ)                         * 28650002
*                                                                     * 28700002
*********************************************************************** 28750002
         L     RSCB1,CVTPTR               GET PTR TO CVT                28800002
         L     RADR,CVTSVDCB          GET SVC DCB ADDRESS               28850002
         LOAD  EP=IGG019OE,DCB=(1)                                      28900002
         ST    RE,EPGAR                SAVE GAR ADDRESS                 28950002
         MVC   ZERO(TWO,RLOC),IDGAR   MOVE ID TO DEB                    29000002
         LA    RLOC,TWO(RLOC)     POINT TO NEXT DEB SUBID SECTION       29050002
         LA    RCTR,ONE(RCTR)         INCREMENT ROUTINES LOADED COUNT   29100002
         L     RSCB1,CVTPTR               GET PTR TO CVT                29150002
         L     RADR,CVTSVDCB             GET SYSTEM SVC DCB ADDRESS     29200002
         LOAD  EP=IGG019OJ,DCB=(1)                                      29250002
         ST    RE,EPGEIR               SAVE GEIR ADDRESS                29300002
         MVC   ZERO(TWO,RLOC),IDGEIR MOVE ID TO DEB                     29350002
         LA    RLOC,TWO(RLOC)          POINT TO NEXT SUB ID SECTION     29400002
         LA    RCTR,ONE(RCTR)         INCREMENT ROUTINE LOADED COUNT    29450002
         STC   RCTR,DEBNMSUB             STORE COUNT IN DEB             29500002
         EJECT                                                          29550002
*********************************************************************** 29600002
*                                                                     * 29650002
*                  LOADS FOR BASIC ATTENTION HANDLING                 * 29700002
*                      IF DEVICE IS 2250                              * 29750002
*                                                                     * 29800002
*          3.    CANCEL KEY  (MODULE NAME IFFCAN03)                   * 29850002
*                                                                     * 29900002
*********************************************************************** 29950002
         L     RUCB,DEBUCBAD     GET 1ST UCB ADDRESS FROM DEB    SM4218 30000002
         CLI   UCBTBYT4,UCBT2250    IS DEVICE A 2250                    30050002
         BNE   OPEN0110             IF NO, DO NOT LOAD IFFCAN03  SM4218 30100002
         LOAD  EP=IFFCAN03                                              30150002
         ST    RE,EPCAN03              SAVE IFFCAN03 ADDRESS            30200002
*   NOTE:  IFFCAN03 CAN NOT BE RECORDED IN DEBSUBID FOR SYSTEM CLOSE    30250002
*          TO DELETE BECAUSE IGG019 IS AFFIXED TO ID TO OBTAIN NAME.    30300002
         EJECT                                                          30350002
*********************************************************************** 30400002
*                                                                     * 30450002
*                  INCREMENT UCBOPEN USER COUNT                       * 30500002
*                                                                     * 30550002
*                1.  ALSO, IF THIS IS FIRST OPEN FOR DEVICE,          * 30600002
*                      A.  RESET UCBGCB, BITS 6 AND 7, TO ZERO        * 30650002
*                                                                     * 30700002
*     SUPERVISOR KEY 0 AND LOCAL LOCK ARE USED TO UPDATE SYSTEM AND   * 30750002
*        GRAPHIC CONTROL BLOCKS.                                      * 30800002
*                                                                     * 30850002
*********************************************************************** 30900002
OPEN0110 EQU *                                                          30950002
         MODESET EXTKEY=ZERO                                            31000002
LL1OBT   SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(LOCAL,IGG0193Y(X31050002
               LL1REL)),REGS=SAVE                                       31100002
         SR    RCTR,RCTR           CLEAR REG FOR UCB CT INSERT          31150002
         SR    REXT,REXT                     FOR NBR OF UCBS            31200002
         SR    RLOC,RLOC                     FOR INDEXING DEBUCBAD      31250002
         IC    REXT,DEBNMEXT                 INSERT NO. OF UCBS         31300002
OPEN0120 L     RUCB,DEBUCBAD(RLOC)  GET UCB ADDR.                       31350002
         IC    RCTR,UCBOPEN         GET UCB USE CT                      31400002
         LA    RCTR,ONE(RCTR)            INCREMENT USE COUNT            31450002
         STC   RCTR,UCBOPEN         REPLACE NEW USE COUNT               31500002
         CLI   UCBOPEN,ONE           IS USE CT ONE                      31550002
         BNE   OPEN0130                IF NOT FIRST, SKIP EXPRESS CLEAR 31600002
         NI    UCBGCB,UCBGATNB         IF FIRST, RESET BITS 6&7 IN GCB  31650002
OPEN0130 LA    RLOC,ADR(RLOC)          INCREMENT  INDEX                 31700002
         BCT   REXT,OPEN0120        BRANCH IF MORE UCBS TO SERVICE      31750002
         TM    DCBGTYPE,DCBGTBAS    IS THIS BASIC ATTN HANDLING         31800002
         BNO   EAH0310                 IF NO, FINISH WITH EXPRESS       31850002
         EJECT                                                          31900002
*********************************************************************** 31950002
*                                                                     * 32000002
*                     BASIC ATTENTION HANDLING                        * 32050002
*                                                                     * 32100002
*   1.  VALIDITY CHECKS FOR TASK CONTROL OF DEVICE:                   * 32150002
*                                                                     * 32200002
*       IF TEB ALREADY EXISTS FOR THIS DEVICE:                        * 32250002
*                A. VERIFY SAME TASK (IF TCBS MISMATCH, ISSUE IEC158I * 32300002
*                                     AND ABEND C13 THRU SYSTEM OPEN) * 32350002
*                B. SKIP ALL INITIALIZATION                           * 32400002
*                                                                     * 32450002
*********************************************************************** 32950002
         L     RSCB2,UCBTEB             DOES TEB EXIST FOR DEVICE       33000002
         LTR   RSCB2,RSCB2                IF NO, OK TO CONTNUE          33050002
         BZ    BAH0140                    IF YES, TEB TCB AND CUR TCB   33100002
         USING TEB,RSCB2                          MUST BE EQUAL         33150002
         L     RSCB1,TEBTCB                                             33200002
         CR    RSCB1,RTCB                                               33250002
         DROP  RSCB2                                                    33300002
         BNE   IEC157I                      IF NO, USE PD EXIT/MSG C13  33350002
         B     OPEN0240                     IF YES, INITZ DONE          33400002
         EJECT                                                          33410002
*********************************************************************** 33420002
*                                                                     * 33430002
*                     BASIC ATTENTION HANDLING                        * 33440002
*                                                                     * 33442002
*   1.  VALIDITY CHECKS FOR TASK CONTROL OF DEVICE ,CONT.:            * 33444002
*                                                                     * 33446002
*       IF TEB ALREADY EXISTS FOR THIS TASK:                          * 33448002
*           A. SKIP IRB INITIALIZATION SINCE IRBS ALREADY EXIST       * 33448402
*           B. ADD EXTRA IQES TO HANDLE ATTENTIONS FOR THESE UCBS     * 33448802
*                                                                     * 33449202
*                                                                     * 33449602
*          NOTE: TO FIND TASK TEB, SCAN TASK DEB CHAIN FOR OTHER      * 33449702
*                GRAPHIC DEVICES AND SEE IF TEB ADDRESS IS AVAILABLE  * 33449802
*                FROM THEIR UCBS.                                     * 33449902
*                                                                     * 33456602
*********************************************************************** 33466602
BAH0140  L     RSCB2,TCBDEB             DOES TEB EXIST FOR TASK         33470002
         LA    RSCB2,ZERO(RSCB2)          SCAN TASK DEB CHAIN           33500002
         USING DEBNMSUB,RSCB2                                           33550002
BAH0150  SR    RE,RE                 CLR EXTENT REGISTER    E12 ZA25969 33600000
         IC    RE,DEBNMEXT             GET EXTENTS          E12 ZA25969 33610000
         LTR   RE,RE                     ARE THERE ANY      E12 ZA25969 33620000
         BZ    BAH0170                 IF NONE, GET NEXT DEB    SA25381 33650002
         SR    RLOC,RLOC                 CLR DCB REGISTER   E12 ZA25969 33651000
         ICM   RLOC,SEVEN,DEBDCBAD       GET DCB ADDRESS    E12 ZA25969 33653000
         USING IHADCB,RLOC                                  E12 ZA25969 33654000
         TM    DCBDSRG2,DCBDSGGS         GRAPHICS A.M.?     E12 ZA25969 33657000
         DROP  RLOC                                         E12 ZA25969 33659000
         BNO   BAH0170                   NO, GET NEXT DEB   E12 ZA25969 33664000
         SR    RLOC,RLOC               IF YES, INITZ INDEX      SA40756 33700002
BAH0160  L     RUCB,DEBUCBAD(RLOC)  LOAD FIRST UCB ADDRESS      SA40756 33750002
         LA    RUCB,ZERO(RUCB)              CLEAR HIGH BYTE             33800002
         BCT   RE,BAH0170          GET EXTNT-1 IF ZERO NDEB E12 ZA25969 33820000
         LA    RLOC,FOUR(RLOC)      POINT TO NEXT UCB ADDRESS   SA40756 33850002
         LTR   RUCB,RUCB               IS ADDRESS ZERO          SA40756 33900002
         BZ    BAH0160                   IF YES, GET NEXT UCB   SA40756 33950002
         TM    UCBID,FULLMASK            IF NO, CK ID        LD YA00809 34000002
         BNO   BAH0160                  IF NOT ID, GET NXT  E12 ZA26129 34050000
         CLI   UCBTBYT3,UCB3DISP       CHECK IF GRAPHIC UCB             34100002
         BNE   BAH0170                   IF NO, CONTINUE SEARCH         34150002
         CLI   UCBTBYT4,UCBT2250         CK IF GRAPHIC DEVICE           34200002
         BE    BAH0350                     IF YES, CK IF TEB AVAIL      34250002
         CLI   UCBTBYT4,UCBT2260                                        34300002
         BE    BAH0350                                                  34350002
         CLI   UCBTBYT4,UCBT1053                                        34400002
         BE    BAH0350                                                  34450002
BAH0170  L     RSCB2,DEBAMLNG          LOAD DEB LINK FIELD              34500002
         LA    RSCB2,ZERO(RSCB2)       CLEAR HIGH ORDER BYTE            34550002
         LTR   RSCB2,RSCB2             ANY MORE DEBS                    34600002
         BNZ   BAH0150                   IF YES, REPEAT SEARCH          34650002
         DROP  RSCB2                                                    34700002
         EJECT                                                          34750002
*********************************************************************** 34800002
*                                                                     * 34850002
*                     BASIC ATTENTION HANDLING                        * 34900002
*                                                                     * 34950002
*      2. ISSUE GETMAIN FOR TEB SINCE NONE EXISTS FOR THIS TASK       * 35000002
*           A.  USE BRANCH ENTRY SINCE LOCAL LOCK IS HELD             * 35050002
*                                                                     * 35100002
*********************************************************************** 35150002
         L     RSIZE,TEBSIZE    INITZ SIZE                              35200002
         LR    RGMTCB,RTCB            CURRENT TCB ADDR                  35250002
         L     RASCB,ASCBADR          CURRENT ASCB ADDR                 35300002
         GETMAIN  R,LV=(0),BRANCH=YES                                   35350002
         XC    ZERO(TEBSZ,RADR),ZERO(RADR)    CLEAR TE CORE TO ZERO     35400002
         LR    RTEB,RADR                  SAVE TE ADDRESS               35450002
         USING TEB,RTEB                                                 35500002
         EJECT                                                          35550002
*********************************************************************** 35600002
*                                                                     * 35650002
*                     BASIC ATTENTION HANDLING                        * 35700002
*                                                                     * 35750002
*       3. CREATE IRBS FOR GAR AND IFFCAN03; KEEP ADDRESSES IN TEB    * 35800002
*                                                                     * 35850002
*********************************************************************** 35900002
         USING RBBASIC,RADR                                             35950002
         L     RE,EPGAR            LOAD GAR ADDRESS                     36000002
         CIRB  EP=(0),SVAREA=YES,WKAREA=1,MODE=SUPR,KEY=SUPR,BRANCH=YESX36050002
               ,RETIQE=NO,RETRN=YES                           LF YM4054 36100002
         ST    RADR,TEBGARB        STORE GAR IRB ADDRESS IN TE          36150002
         ST    RGMTCB,TEBTCB       STORE CURRENT TCB ADDRESS IN TE      36200002
         MVC   TEBGIOCR(FOUR),R0  STORE GIOCR ADR IN TEB     LG @ZM2360 36210000
         MVC   TEBGEIR(FOUR),EPGEIR  STORE GEIR ADDRESS IN TE           36250002
         OI    TEBFLGS,TEBFLAG       INDICATE THIS IS A TE              36300002
         XC    RBNEXAV(FOUR),RBNEXAV CLEAR IRB FIELD                    36350002
BAH0180  L     RUCB,DEBUCBAD                                     SM4218 36400002
         CLI   UCBTBYT4,UCBT2250   IS THIS A 2250                SM4218 36450002
         BNE   BAH0200              IF NO, SKIP CREATE CAN03 IRB SM4218 36500002
         L     RIRB,TEBCKRB         IF YES, CK IF IRB EXISTS    SA38909 36550002
         LTR   RIRB,RIRB                                                36600002
         BNZ   BAH0190                 IF YES, SKIP CREATE      SA38909 36650002
         L     RE,EPCAN03              LOAD IFFCAN03 ADDRESS    SA38909 36700002
         CIRB  EP=(0),SVAREA=YES,WKAREA=1,MODE=SUPR,KEY=SUPR,BRANCH=YESX36750002
               ,RETIQE=NO,RETRN=YES                           LF YM4054 36800002
         ST    RADR,TEBCKRB             STORE IFFCAN03 IRB ADDR IN TEB  36850002
         XC    RBNEXAV(FOUR),RBNEXAV    CLEAR FIELD IN IRB              36900002
         LR    RIRB,RADR                   KEEP ADDR AND ADD IQE        36910002
         DROP  RADR                                                     36950002
         EJECT                                                          37000002
*********************************************************************** 37050002
*                                                                     * 37100002
*                     BASIC ATTENTION HANDLING                        * 37150002
*                                                                     * 37200002
*     4.  CREATE AND INITIALIZE IQES FOR THE IRBS                     * 37250002
*           A. IF 2250S:  ONE IQE FOR CANCEL KEY'S IRB                * 37300002
*                         THREE IQES FOR GAR'S IRB (THREE ATTN TYPES) * 37350002
*           B. IF 2260S:  ONE IQE FOR GAR'S IRB (ONE ATTN TYPE)       * 37400002
*                                                                     * 37450002
*********************************************************************** 37500002
BAH0190  L     RSIZE,IQESIZE        INITZ SIZE                          37550002
         GETMAIN  R,LV=(0),BRANCH=YES                                   37600002
         USING IQESECT,RADR                                             37650002
         USING RBBASIC,RIRB                                             37700002
         ST    RIRB,IQEIRB            PUT CAN03 IRB INTO IQE            37800002
         MVC   IQELNK(FOUR),RBNEXAV    CHAIN OLD IQE TO NEW IQE         37850002
         ST    RADR,RBNEXAV            PUT IQE ADDR IN IRB              37900002
         XC    IQEPARAM(FOUR),IQEPARAM   ZERO PARM FIELD IN IQE         37950002
         ST    RGMTCB,IQETCB           PUT TCB ADDR INTO IQE            38000002
         LA    RCOUNT,THREE         GAR IQE LOOP COUNT FOR 2250         38050002
BAH0200  SR    REXT,REXT            CLEAR REGISTER                      38100002
         SR    RLOC,RLOC            SET INDEX TO ZERO                   38150002
         IC    REXT,DEBNMEXT         LOAD NUMBER OF UCB EXTENTS         38200002
BAH0210  L     RUCB,DEBUCBAD(RLOC)   LOAD UCB ADDR                      38250002
         LTR   RUCB,RUCB                IS UCB ADDR ZERO        SA40756 38300002
         BZ    BAH0230                     IF YES, CK NEXT UCB  SA40756 38350002
         CLI   UCBTBYT4,UCBT2250     IS DEVICE A 2250           SA35615 38400002
         BE    BAH0220                  IF NO, GET ONE IQE      SA35615 38450002
         EJECT                                                          38500002
*********************************************************************** 38550002
*                                                                     * 38600002
*                     BASIC ATTENTION HANDLING                        * 38650002
*                                                                     * 38700002
*     4.  CREATE AND INITIALIZE IQES FOR THE IRBS, CONT.              * 38750002
*     5.  SET UCB GCB TO INDICATE OK TO PROCESS ATTENTIONS            * 38800002
*                                                                     * 38850002
*********************************************************************** 38900002
         LA    RCOUNT,ONE               GAR IQE LOOP COUNT FOR 2260     38950002
BAH0220  L     RIRB,TEBGARB             REINITIALIZE GAR'S IRB   SM4218 39000002
         L     RSIZE,IQESIZE    INITZ SIZE                              39050002
         GETMAIN  R,LV=(0),BRANCH=YES                                   39100002
         ST    RIRB,IQEIRB              PUT GAR IRB ADDR IN IQE         39150002
         MVC   IQELNK(FOUR),RBNEXAV      CHAIN OLD IQE TO NEW IQE       39200002
         ST    RADR,RBNEXAV              PUT IQE ADDR IN IRB            39250002
         XC    IQEPARAM(FOUR),IQEPARAM    ZERO PARM FIELD IN IQE        39300002
         ST    RGMTCB,IQETCB            PUT TCB ADDR IN IQE             39350002
         BCT   RCOUNT,BAH0220           REPEAT IF MORE IQES FOR DEVICE  39400002
         ST    RTEB,UCBTEB              STORE TE ADDRESS IN UCB         39450002
         OI    UCBGCB,UCBGINIT+UCBGBAS    OK FOR BASIC ATTNS    SA32068 39500002
         L     RCALC,TEBUCBCT              LOAD TE USE COUNT            39550002
         LA    RCALC,ONE(RCALC)              INCREMENT USE COUNT BY ONE 39600002
         ST    RCALC,TEBUCBCT              STORE UPDATED COUNT          39650002
BAH0230  LA    RLOC,ADR(RLOC)     POINT TO NEXT UCB ADDRESS     SA40756 39700002
         BCT   REXT,BAH0210          REPEAT IF MORE 2260S TO SERVICE    39750002
         DROP  RADR,RIRB                                                39800002
         EJECT                                                          39850002
*********************************************************************** 39900002
*                                                                     * 39950002
*                     OPEN I/O PROCESSING FOR 2250S                   * 40000002
*                                                                     * 40050002
*                1. UNLOCK 2250 KEYBOARDS IF PRESENT                  * 40100002
*                                                                     * 40150002
*          NOTE:  BALR TO GIOCR FOR SA19907 HAS BEEN REPLACED         * 40160002
*                 WITH DIRECT I/O (EXCP)                              * 40170002
*                                                                     * 40180002
*********************************************************************** 40200002
OPEN0240 BAL   RBACK,LL1REL          RELEASE LOCAL LOCK       LF YM4068 40250002
         LM    RCORE,RWTGC,R4        RESTORE INPUT REGS & WORK AREA     40300002
         CLI   UCBTBYT4,UCBT2250     IS DEVICE A 2250                   40350002
         BNE   OPEN0270                  IF NO, SKIP KYBRD UNLOCK CODE  40400002
         L     RADR,UCBBTA        LOAD BFR TABLE ADR                    40450002
         LA    RADR,ZERO(RADR)       ZERO HIGH ORDER BYTE               40500002
         LTR   RADR,RADR             CHECK IF A BUFFER TABLE EXISTS     40550002
         BNZ   OPEN0260                IF YES, OK TO UNLOCK KEYBOARD    40600002
OPEN0250 TM    UCBTBYT2,UCBTPFK      IS PFK BIT SET                     40650002
         BNO   OPEN0270                IF NO, SKIP KEYBOARD UNLOCK      40700002
OPEN0260 L     RIOB,DCBIOBAD      GET ADDR OF IOB JUST CREATED  SA19907 40850002
         LM    RSCB1,RSCB2,RMICCW   GET CCW WHILE STILL IN DATAMGT KEY  40900002
         MODESET KEYADDR=DXUKEY,WORKREG=1                     LF YM5685 40910002
         USING DXIOB,RIOB         TEMPORARY BASE FOR IOB I/O            40910402
         TS    IOBAVAIL             SET IOB TO NOT AVAILABLE FOR USE    40912002
         STM   RSCB1,RSCB2,IOBCCW1  IOB FOR I/O IS RENTRANT & USER KEY  40920002
         LA    RSCB1,IOBCCW2         USE CCW2 AS TEMP ECB FOR I/O       40950002
         ST    RSCB1,IOBECBPT          PUT ECB ADDR INTO IOB            41000002
         LA    RSCB1,IOBCCW3         USE CCW3 AS TEMP OUTPUT AREA       41050002
         STCM  RSCB1,SEVEN,IOBCCW1+1   INSERT AREA ADDR INTO CCW LOC    41100002
         LR    RADR,RIOB             PUT IOB ADDR INTO REG 1 &          41110002
         SVC   EXCP                  ISSUE EXCP TO START I/O            41150002
         WAIT  ECB=IOBCCW2                                              41200002
         CLI   IOBCCW2,ECBCC              WAS I/O SUCCESSFUL            41250002
         BNE   IEC158I                     IF NO, ISSUE PD MSG/ABEND    41300002
         DROP  RIOB                                                     41350002
         EJECT                                                          41400002
*********************************************************************** 41450002
*                                                                     * 41500002
*               OPEN CHECK FOR ADDITIONAL DCBS TO PROCESS             * 41550002
*                                                                     * 41600002
*********************************************************************** 41650002
OPEN0270 EQU   *                                                        41700002
         MODESET  EXTKEY=DATAMGT                                        41750002
         XC    ZERO(TWO,RWTGC),ZERO(RWTGC)   CLEAR ID IND COMPLETION    41800002
OPEN0280 EQU   *                                                        41850002
         LA    RWTGC,WGOFF(RWTGC)      BUMP CURRENT WTG REGISTER        41900002
         LA    RPARC,ADR(RPARC)      BUMP CUR PARM REG TO NEXT ENTRY    41950002
         CLC   ZERO(TWO,RWTGC),GIDCNST1     CHECK NEXT WTG ENTRY        42000002
         BE    OPEN0010          YES START AGAIN                        42050002
         SPACE                                                          42100002
         CLC   ZERO(TWO,RWTGC),OPIDCNST    NO TEST FOR END OF TABLE     42150002
         BNE   OPEN0280                 NOT EQUAL CHECK NEXT ENTRY      42200002
         LR    RPARC,RPAR               RESET CURRENT PARM REG          42250002
         LA    RWTGC,WAOFF(RWTG)        RESET CURRENT WTG REG           42300002
OPEN0290 EQU   *                                                        42350002
         CLI   ZERO(RWTGC),ZERO         TEST FOR ZERO ENTRY             42400002
         BNE   OPEN0300                 NOT - XCTL                      42450002
         SPACE                                                          42500002
         LA    RWTGC,WGOFF(RWTGC)      ZERO - GET NEXT ENTRY AND        42550002
         LA    RPARC,ADR(RPARC)      RETURN TO ZCHECK                   42600002
         B     OPEN0290                RETURN                           42650002
         EJECT                                                          42700002
*********************************************************************** 42750002
*                                                                     * 42800002
*              FREE OPEN SAVE AREA AND XCTL TO SYSTEM OPEN            * 42850002
*                   OR ANOTHER ACCESS METHOD EXECUTOR                 * 42900002
*                                                                     * 42950002
*********************************************************************** 43000002
OPEN0300 EQU *                                                          43050002
         LR    RADR,RSAVE         PRIME ADDR REG                        43100002
         L     RSIZE,SAVSPSIZ     GET SAVE/WORK AREA DESCRIPTION        43150002
         FREEMAIN R,LV=(0),A=(1)                                        43200002
         MVC   SIX(TWO,RWTG),ZERO(RWTGC)     MOVE ID TO NAME            43250002
         MVC   TTROFF(THREE,RWTG),TWO(RWTGC)     MOVE TO TTR ROUTINE    43300002
         LA    RLINK,DXCCW12        GET ADDRESS OF NEW NAME FOR XCTL    43350002
         L     RE,DXREG0              RELOAD R0 FOR PD ID               43400002
         XCTL  DE=(RWTG),SF=(E,(RLINK))                                 43450002
         EJECT                                                          43500002
*********************************************************************** 43550002
*                                                                     * 43600002
*                   EXPRESS ATTENTION HANDLING                        * 43650002
*                                                                     * 43700002
*        1. PROCESS POLL LIST OF DCBS USED FOR ATTENTION HANDLING     * 43750002
*           A. IF LIST IS NOT ACTIVE, SET HIGH BYTE TO SHOW INITZ     * 43800002
*           B. ADD DCBS TO LIST AND INDEX, FIRST ENTRY IS 00          * 43850002
*                                                                     * 43900002
*               NOTE:  POLL LIST PROCESSING DONE IN USER'S KEY        * 43950002
*                                                                     * 44000002
*********************************************************************** 44050002
EAH0310  BAL   RBACK,LL1REL         RELEASE LOCAL LOCK        LF YM5684 44100002
         L     RADR,DCBPOLST             GET POLL LIST ADR              44150002
         LA    RADR,ZERO(RADR)              CLEAR HI ORDER BYTE         44200002
         SR    REXT,REXT            CLEAR REG                           44250002
         IC    REXT,DEBNMEXT          INSERT NO. OF UCBS                44300002
         L     RDCB,UDCBADR         GET USER DCB                        44350002
         IC    RDEB,DCBOFLGS        SAVE OFLGS FOR I/O WITH 2250 AND    44400002
         L     RCORE,R4                 GET WORK AREA                   44450002
         MODESET  KEYADDR=DXUKEY,WORKREG=15                             44500002
         LTR   RADR,RADR                 DOES POLL LIST EXIST           44600002
         BE    EAH0340                     IF NO, SKIP PROCESSING       44650002
         SR    RCTR,RCTR           CLEAR REG                            44700002
         TM    ZERO(RADR),POLSTACT   IS LIST ACTIVE (HAS DCB ADDRS)     44750002
         BO    EAH0320                IF YES, KEEP END OF LIST PTR      44800002
         ST    RADR,ZERO(RADR)         IF NO, START IS END OF LIST      44850002
EAH0320  L     RLOC,ZERO(RADR)      GET POLST PTR                       44900002
EAH0330  LA    RLOC,FOUR(RLOC)     BUMP LAST DCB PTR TO NEXT ENTRY      44950002
         ST    RDCB,ZERO(RLOC)     USER DCB ADDRESS TO POLST            45000002
         STC   RCTR,ZERO(RLOC)         INDEX TO POLST                   45050002
         LA    RCTR,ONE(RCTR)            ADJUST INDEX                   45100002
         BCT   REXT,EAH0330            BRANCH IF MULTIPLE DEVICES       45150002
         ST    RLOC,ZERO(RADR)         STORE UPDATED END OF LIST PTR    45200002
         OI    ZERO(RADR),POLSTACT     SHOW LIST IS ACTIVE (HAS ENTRY)  45250002
         EJECT                                                          45300002
*********************************************************************** 45350002
*                                                                     * 45400002
*                   EXPRESS ATTENTION HANDLING                        * 45450002
*                                                                     * 45500002
*      2. ASSIGN 2250 BUFFER IF FEATURE IS ON DEVICE                  * 45550002
*      3. IF 2250 AND NO BUFFER, SEE IF PFKS ARE AVAILABLE AND        * 45600002
*         NEED UNLOCKING                                              * 45650002
*                                                                     * 45700002
*********************************************************************** 45750002
EAH0340  MODESET  EXTKEY=DATAMGT                                        45850002
         LM    RCORE,RWTGC,R4        RESTORE INPUT REGS & WORK AREA     45900002
         CLI   UCBTBYT4,UCBT2250     CHECK FOR 2250 TYPE IN UCB         45950002
         BNE   OPEN0270               IF NOT, SKIP 2250 CODE            46000002
         L     RADR,UCBBTA            IF YES, CHECK FOR BFR TABLE ADDR  46050002
         LA    RADR,ZERO(RADR)                ZERO HIGH ORDER BYTE      46100002
         LTR   RADR,RADR                                                46150002
         BNZ   EAH0345                  IF BFR TAB EXISTS, ASSIGN BFR   46200002
         L     RDCB,DCBADR(RPARC)       IF NONE, GET COPIED DCB &       46300002
         B     OPEN0250                          CK FOR PFKS TO CLEAR   46310002
         USING BUFTAB,RADR                                              46350002
EAH0345  EQU   *                                                        46360000
         MODESET KEYADDR=DXUKEY,WORKREG=14                   LG YM08088 46370000
         MVI   DCBOFLGS,X'12'   MOVE IN DUMMY FLAGS          LG YM08088 46380000
         MODESET EXTKEY=DATAMGT                              LG YM08088 46390000
         LA    RCOUNT,BTEXPSIZ       LOAD ADR OF EXPRESS BUFFER SIZE    46400000
         LA    RADR,SAVEAREA          USE FIRST TWO WORDS AS PLIST      46450002
         ASGNBFR (RDCB),(RCOUNT),MF=(E,(RADR))                          46500002
         MODESET  KEYADDR=DXUKEY,WORKREG=14                             46550002
         STC   RDEB,DCBOFLGS          RESTORE OFLGS                     46600002
         LTR   RCODE,RCODE       BUFFER ASSIGNED OK?                    46650002
         BNZ   IEC158I              IF NO, ISSUE PD MSG/ABEND           46700002
         L     RSCB1,DCBBFRST       IF YES, REFRESH COPY DCB            46750002
         MODESET  EXTKEY=DATAMGT                                        46800002
         L     RDCB,DCBADR(RPARC)      GET ADDR OF COPY DCB             46850002
         ST    RSCB1,DCBBFRST          REFRESH BFR FIELDS               46900002
         B     OPEN0260          END OF EXPRESS PROCESSING; UNLOCK KBRD 46950002
         EJECT                                                          47000002
*********************************************************************** 47050002
*               OUT-OF-LINE CODE AND INTERNAL SUBROUTINES             * 47100002
*********************************************************************** 47150002
         SPACE                                                          47200002
BAH0350  L     RTEB,UCBTEB        LOAD TE FIELD FROM UCB                47250002
         LA    RTEB,ZERO(RTEB)    CLEAR HIGH ORDER BYTE                 47300002
         LTR   RTEB,RTEB            DOES TEB EXIST                      47350002
         BZ    BAH0170                IF NO, CONT SEARCH                47400002
         LR    RGMTCB,RTCB       CURRENT TCB PTR     LG ZA00500,YM08809 47410000
         L     RASCB,ASCBADR     CURRENT ASCB PTR    LG ZA00500,YM08809 47420000
         B     BAH0180                IF YES, SKIP GARIRB/TEB INITZ     47450002
         SPACE                                                          47500002
LL1REL   SETLOCK RELEASE,TYPE=LOCAL,RELATED=(LOCAL,IGG0193Y(LL1OBT)),  X47550002
               REGS=SAVE                                      LF YM4068 47600002
         BR    RBACK                                                    47650002
         SPACE                                                          47700002
*     INTERNAL SUBROUTINE TO DETERMINE NUMBER OF PAGES IN MODULE JUST   47750002
*     LOADED.  NUMBER MUST BE OR'ED INTO HIGH BYTE OF EP IN REG 0       47800002
*     BEFORE SAVING ADDR IN APPENDAGE TABLE.                            47850002
PAGECTR  EQU   *                                                  AOS/1 47900002
* CONVERT MODULE SIZE TO UPPER BOUND                              AOS/1 47950002
         LR    RLGH,RE                 GET LOAD ADDR IN WORK REG  AOS/1 48000002
         SLL   RCALC,THREE               BYTE COUNT= 8* DBLWRCTRS AOS/1 48050002
         AR    RCALC,RLGH                 UPPER BOUND+1           AOS/1 48100002
         BCTR  RCALC,RSIZE                UPPER BOUND-1           AOS/1 48150002
* ROUND LOAD ADDRESS DOWN TO PAGE BOUNDARY                        AOS/1 48200002
         SRL   RLGH,SHFT11                                        AOS/1 48250002
         SLL   RLGH,SHFT11             LOWER PAGE BOUNDARY        AOS/1 48300002
* COMPUTE NUMBER OF PAGES SPANNED BY MODULE                       AOS/1 48350002
         SR    RCALC,RLGH                 BYTES SPANNED BY MODULE AOS/1 48400002
         SRL   RCALC,SHFT11              NUMBER OF PAGE BOUNDS    AOS/1 48450002
         LA    RCALC,ONE(RCALC)            NUMBER OF PAGES        AOS/1 48500002
         SLL   RCALC,SHFT24              SHIFT TO HIGH BYTE       AOS/1 48550002
         OR    RE,RCALC               PREFIX TO LOAD ADDRESS      AOS/1 48600002
         BR    RBACK                   RETURN                     AOS/1 48650002
         EJECT                                                          48700002
*********************************************************************** 48750002
*   ISSUE PROBLEM DETERMINATION MESSAGES THRU SYSTEM OPEN MACRO       * 48800002
*********************************************************************** 48850002
         SPACE 2                                                        48900002
IEC157I  EQU   *                                                        48950002
         BAL   RBACK,LL1REL        RELEASE LOCAL LOCK                   49000002
         MODESET  EXTKEY=DATAMGT                                        49050002
         LM    RCORE,RWTGC,R4        RESTORE INPUT REGS                 49100002
         USING FORCORE,RCORE                                            49150002
         DMABCOND    91,PDLOAD,RES=NO,REGSAVE=YES                S21016 49200002
         ST    RE,DXREG0           SAVE R0 PD ID                        49250002
         B    OPEN0300                                                  49300002
         SPACE 2                                                        49350002
IEC158I  EQU   *                                                        49400002
         MODESET  EXTKEY=DATAMGT                                        49450002
         DMABCOND     92,PDLOAD,RES=NO,REGSAVE=YES               S21016 49500002
         ST    RE,DXREG0           SAVE R0 PD ID                        49550002
         B     OPEN0300                                                 49600002
         SPACE 3                                                        49650002
IEC159I  EQU   *                                                        49700002
         DMABCOND    93,PDLOAD,RES=NO,REGSAVE=YES                S21016 49750002
         ST    RE,DXREG0           SAVE R0 PD ID                        49800002
         B     OPEN0300                                                 49850002
         EJECT                                                          49900002
*********************************************************************** 49950002
*                                                                     * 50000002
*                        CONSTANTS                                    * 50050002
*                                                                     * 50100002
*********************************************************************** 50150002
         SPACE 1                                                        50200002
*                  DEB ID'S FOR MODULES LOADED                          50250002
*         (APPENDED TO IGG019 BY SYSTEM CLOSE FOR DELETION)             50300002
IDGIOCR  DC    C'OA'                                                    50350002
IDCEXCE  DC    C'OB'                                                    50400002
IDPGFIX  DC    C'OC'              ID OF PAGE FIX APPNDG           AOS/1 50450002
IDGAR    DC    C'OE'                                                    50500002
IDGEIR   DC    C'OJ'                                                    50550002
OPIDCNST DC    C'0S'                                                    50600002
GIDCNST1 DC    C'3Y'                                                    50650002
         DS    0F       ALIGN BOUNDARIES FOR LOAD INSTRUCTIONS          50700002
RMICCW   DC    X'0E00000000000003'   CCW FOR RMI I/O TO CLEAR 2250 KBRD 50750002
DEBSPOOL DC    X'E6000000'     SP 230 FOR DEB        LB  AOS/1          50800002
IOBSPOOL DC    X'FA000000'        250     IOB                           50850002
SAVSPSIZ DC    X'E600005C'     SP 230 FOR 92 BYTE SAVE/WORK AREA        50900002
IQESIZE  DC    X'E9000010'     SP 233 FOR 16 BYTE IQE                   50950002
TEBSIZE  DC    X'EB000024'     SP 235 FOR 32 BYTE TEB        LG @ZM2360 51000000
NUMONE   DC    H'01'                                                    51050000
SIXTEEN  DC    H'16'                                                    51100002
HWC256   DC    H'256'                                                   51150002
SEVNTEEN DC    H'17'                                                    51200002
CLEAR    XC    0(1,RADR),0(RADR)                                        51250002
         USING TIOENTRY,RTIOT                                           51300002
UCBMOVE  MVC   0(1,RDEL),TIOESTTB                                       51350002
         SPACE 5                                                        51450002
**********************************************************************  51500002
*                                                                    *  51550002
*                SPECIAL MAINTENANCE PATCH AREA FOR FIELD USE        *  51600002
*                                                                    *  51650002
**********************************************************************  51700002
PATCH    DC    C'IGG0193Y 50 BYTE PATCH AREA.'                          51750002
         DC    C'50 BYTE AREA ENDS HERE'                                51800002
         EJECT                                                          51850002
*********************************************************************** 51900002
*  LENGTH AND PATCH PARAMETERS HAVE BEEN ADDED TO XCTLTABL TO         * 51950002
*  BYPASS PROBLEMS CAUSED BY DEFAULT TO 1K SIZE MODULES               * 52000002
*********************************************************************** 52050002
         XCTLTABL ID=(PDLOAD,6M),SVC=19,LENGTH=3000,PATCH=100           52100002
         EJECT                                                          52150002
*********************************************************************** 52200002
*                                                                     * 52250002
*                        DSECTS                                       * 52300002
*                                                                     * 52310002
*        BUFTAB         FORCORE             TEB                       * 52350002
*        CVT            IQE                 TIOT                      * 52400002
*        DCB            PSA                 UCB                       * 52450002
*        DEB            RB                  SAVEAREA                  * 52500002
*                       TCB                                           * 52550002
*                                                                     * 52560002
*********************************************************************** 52600002
         SPACE 5                                                        52650002
BUFTAB   DSECT                                                          52700002
*                                                                       52750002
BTTOTSEG DS    CL2     HEADER:  TOTAL NUMBER OF 256 BYTE SECTIONS       52800002
BTNUMDEV DS    CL2                              DEVICES SHARING BUFFER  52850002
BTEXPSIZ DS    CL2                              SECTIONS FOR EXPRESS    52900002
BTTOTAVL DS    CL2                              SECTIONS STILL AVAIL    52950002
*                                                                       53000002
BTDVTOTA DS    CL2     DEVICES: TOTAL NUMBER OF SECTIONS AVAIL THIS DEV 53050002
BTDVDISP DS    CL2              DISPL INTO BT FOR THIS DEV ZONE         53100002
BTDVZONE DS    CL2              NBR OF SECTIONS IN THIS DEV ZONE        53150002
BTDVGAR  DS    CL2              NBR OF GUARANTEED SECTIONS FOR THIS DEV 53200002
*                                                                       53250002
BTASGMT  DS    CL56    ASGMT:   ASSIGNMENTS WILL CONTAIN DEVICE IDS     53300002
         EJECT                                                          53350002
*        CVT   DSECT=YES,LIST=YES                                       53400002
         CVT   DSECT=YES                                                53450002
         EJECT                                                          53500002
*********************************************************************** 53550002
*                                                                     * 53600002
*                        DCB DSECT                                    * 53650002
*                                                                     * 53700002
*********************************************************************** 53750002
         SPACE 1                                                        53800002
         DCBD  DSORG=GS                                                 53850002
**********************************************************************  53900002
*                                                                     * 53950002
*                    ADDITIONAL DCB EQUATES FOR DSECT                 * 54000002
*                                                                     * 54050002
*********************************************************************** 54100002
DCBGNCPL EQU   X'00'   LOW END OF RANGE FOR CHANNEL PROGRAMS IS 1       54150002
DCBGNCPH EQU   X'63'   HIGH END OF RANGE FOR CHANNEL PROGRAMS IS 99     54200002
         EJECT                                                          54250002
*********************************************************************** 54300002
*                                                                     * 54350002
*                        GRAPHIC DEB DUMMY SECTION                    * 54400002
*                                                                     * 54450002
*********************************************************************** 54500002
         SPACE 1                                                        54550002
IECTDEB  DSECT                                                          54600002
DEBEOEA  DS    CL4                     END OF EXTENT APP ROUTINE PTR    54650002
DEBSIOA  DS    CL4                     START I/O APP ROUTINE PTR        54700002
DEBPGFX  EQU   X'80'      ADDR AVAILABLE FOR PAGE FIX ENTRY POINT AOS/1 54750002
DEBPCIA  DS    CL4                     PROG CONTROL APP ROUTINE PTR     54800002
DEBCEA   DS    CL4                     CHANNEL END APP ROUTINE PTR      54850002
DEBXCEA  DS    CL4                     EX CHANNEL END APP ROUTINE PTR   54900002
DEBWKARA DS    CL1                     I/O SUPPORT WORK AREA            54950002
DEBDSCBA DS    CL7                     I/O SUPPORT DSCB AREA            55000002
DEBDCBMK DS    CL4                     I/O DCB MODIFICATION MASK        55050002
DEBLNGTH DS    CL4                     DEB LENGTH IN DOUBLE WORDS       55100002
DEBNMSUB DS    CL1                     NO. SUBROUTINES LOADED BY OPEN   55150002
DEBTCBAD DS    CL3                     TCB ADDR OF THIS DEB             55200002
DEBAMLNG DS    CL1                     NO. BYTES IN ACCESS METHOD SECT  55250002
DEBDEBAD DS    CL3                     NEXT DEB PTR IN THIS TASK        55300002
DEBOFLGS DS    CL1                     DATA SET STATUS FLAG             55350002
DEBIRBAD DS    CL3                     IRB ADDR FOR ERROR EXIT          55400002
DEBOPATB DS    CL1                     FILE TYPES                       55450002
DEBSYSPG DS    CL3                     SYSTEM PURGE CHAIN               55500002
DEBNMEXT DS    CL1                     NO. OF EXTENTS BUILT FOR DSCB'S  55550002
DEBUSRPG DS    CL3                     USER PURGE CHAIN                 55600002
DEBPRIOR DS    CL1                     TCB PRIORITY-IOS CH QUEING IOB   55650002
DEBECBAD DS    CL3                     IOS INTERNAL ECB ADDR            55700002
DEBPROTG DS    CL1                     TASK PROTECTION TAG              55750002
DEBID    EQU   X'0F'          DEB ID IN LOW ORDER BITS OF DEBPROTG      55800002
DEBDCBAD DS    CL3                     DCB ADDR                         55850002
DEBEXSCL DS    CL1                     EXTENT SCALE                     55900002
DEBAPPAD DS    CL3                     I/O APP BLOCK PTR                55950002
DEBUCBAD DS    CL4                     UCB PTR FOR GIVEN DATA EXTENT    56000002
         IECDSECS  MAIN,EXPAND=YES                                      56050002
*                                                                       56100002
*        ADDITIONAL IOB LABELS FOR GAM EXTENSION                        56150002
*                                                                       56200002
         ORG   DXIOB                                                    56250002
IOBDX    DS    8F      USE WORK AREA LABELS FOR STD FIELDS              56300002
*       GAM EXTENSION                                                   56350002
IOBUCBX  DS    0CL1    UCB INDEX                                        56400002
IOBADRPT DS    F       ADDRESSING LIST POINTER                          56450002
IOBAVAIL DS    0CL1    BIT 0:  ON IF IOB NOT AVAILABLE FOR USE          56460002
IOBNXTPT DS    F       NEXT IOB POINTER                                 56500002
IOBCCW1  DS    2F      MAX NBR OF CCWS FOR A GRAPHIC CHANNEL PGM IS 4   56550002
IOBCCW2  DS    2F                                                       56600002
IOBCCW3  DS    2F      * USED AS ECB FOR RMI I/O *                      56650002
IOBCCW4  DS    2F      * USED FOR INFO FROM RMI I/O *                   56700002
         EJECT                                                          56750002
         IHAIQE                                                         56800002
         EJECT                                                          56850002
         IHAPSA                                                         56900002
         EJECT                                                          56950002
         IHARB                                                          57000002
         EJECT                                                          57050002
         IKJTCB                                                         57100002
         EJECT                                                          57150002
TEB      DSECT                                                          57200002
TEBCKRB  DS    F       ADDR OF:      IRB FOR CANCEL KEY (IFFCAN03)      57250002
TEBREB   DS    F                     GAM ROUTINE ENTRY BLOCK            57300002
TEBTCB   DS    F                     TCB                                57350002
TEBCKQE  DS    F                     LIST OF CANCEL KEY IQES            57400002
TEBUCBCT DS    F       USE COUNT:    NBR OF UCBS USING THIS TEB         57450002
TEBFLGS  DS    F       FLAG BYTES:                                      57500002
TEBFLAG  EQU   X'80'                 TEB ID FLAG                        57550002
TEBGARB  DS    F       ADDR OF:      IRB FOR GAR (IGG019OE)             57600002
TEBGEIR  DS    F                     GEIR (IGG019OJ) ENTRY POINT        57650002
TEBGIOCR DS    F               GIOCR(IGG0190A) ENTRY POINT   LG @ZM2360 57660000
         EJECT                                                          57700002
TIOT     DSECT                                                          57750002
         IEFTIOT1                                                       57800002
         EJECT                                                          57850002
UCB      DSECT                                                          57900002
*        IEFUCBOB  LIST=YES                                             57950002
         IEFUCBOB                                                       58000002
         EJECT                                                          58050002
**********************************************************************  58100002
*                                                                     * 58150002
*                    ADDITIONAL UCB EQUATES FOR DSECT                 * 58200002
*                                                                     * 58250002
*********************************************************************** 58300002
         SPACE 3                                                        58350002
*          UCBTYP, BYTE 2, BIT SETTINGS                                 58400002
UCBTPFK  EQU   X'10'           UNIT TYPE BIT 3 FOR PFK FEATURE          58450002
         SPACE 3                                                        58500002
*          UCBTYP, BYTE 4, BIT SETTINGS                                 58550002
         SPACE                                                          58600002
UCBT2250 EQU   X'02'           UNIT TYPE ID FOR 2250 DEVICE             58650002
UCBT2260 EQU   X'03'                        FOR 2260                    58700002
UCBT1053 EQU   X'04'                        FOR 1053                    58750002
         SPACE 2                                                        58800002
*          UCBGCB, BIT SETTINGS                                         58850002
         SPACE                                                          58900002
UCBGINIT EQU   X'40'           OK TO ACCEPT ATTNS NOW           SA32068 58950002
UCBGBAS  EQU   X'08'           BASIC ATTENTION HANDLING BEING USED      59000002
UCBGATNB EQU   X'FC'           RESET ATTENTION BITS FOR/FROM EXPRESS    59050002
         EJECT                                                          59100002
*********************************************************************** 59150002
*                                                                     * 59200002
*                        SAVE AREA DSECT                              * 59250002
*                                                                     * 59300002
*********************************************************************** 59350002
SAVEAREA DSECT                                                          59400002
WKSA     DS    5F             WORK WORDS FOR LOCAL LOCK WHEN REGS=SAV   59450002
R0       DS    F                       REG ZERO    *  REGS MAP INTO  *  59520002
