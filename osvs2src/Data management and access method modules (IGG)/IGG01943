1943     TITLE 'IGG01943-RESTART FROM ENVIRONMENT RECORDS'              00100020
IGG01943 CSECT                            *                             00200000
* CHANGE ACTIVITY = AS FOLLOWS:            *                            00200100
*A000000-999999                                                @Y16X5C0 00203100
*C113000,114100,114500,274000,280000,431000      *              SA51078 00206100
*A271000,271500,293005,293345,296500,301500,313100-313700.329800SA51078 00209100
*A377760,438600-458600,489900-490400,493100,494760-494770  *    SA51078 00212100
*D281000-290000,293312-293318,306000-310000,377420-377630  *    SA51078 00215100
*D432000-433000,436200,438600-478000,488400-488600        *     SA51078 00218100
*C348104-348110                                      *           Y06328 00221100
*A494780                                      *                  Y06328 00224100
*A258000,493800                                                 SA53610 00230022
*C114100,252000-254000                                          SA53610 00230105
*A293500                                                         A47151 00230205
*C114100,349000-357000,360000-362000,362720,370000,494000        A47151 00230305
*C370300,370600                                                  S21903 00230405
*D512000                                                         S21903 00230505
*A360200-360800,494750                                          SA57661 00230605
*C110000,113000,114000,137000,293312,293314,293316,293318,306000,S21903 00230705
*D148000                                                        SA57661 00230805
*C307000,308000,377570,392000,399000,503000,504000,507000,509000,S21903 00230905
*C510000,537000,501000,524000,525000,528000,086000,090000        S21903 00231005
*C020000-024000                                                  S21903 00231105
*D280000-290000,293312-293318,299000,306000-310000              SA51078 00231205
*D377420-377630,431000-433000,436200,469000,488400-488600       SA51078 00231305
*C113000,114100,114500                                          SA51078 00231405
*A377340-377355                                                 SA59171 00231505
*A274001-274002                                                 SA59179 00231605
*A377335                                                        SA68676 00231805
*A264000                                                        SA67099 00232054
*C267000                                                        SA67099 00232454
*A348098                                                       @YA04903 00232556
*A404000,407000,494000,494780                                  @XA05305 00232656
*C348300                                                       @XA05305 00232756
*C293110-293130                                                @YA05454 00232856
*A264000,265000                                                @ZA02079 00312857
*D264300-266000,278000-279000,347880-348200                    @Y17XACT 00322800
*C267000,321000                                                @Y17XACT 00332800
*A272500,274002,293450,377060,404000,404600,494795,487000      @Y17XACT 00342800
*C377120,377150,377340,377368,377390,377660                    @Y17XACA 00352800
*A377120,377660                                                @Y17XACA 00362800
*A492500,493100,493200,519000,                                 @G36XRCU 00365800
*C033000,035000,115230,388000,123500,484800                    @G36XRCU 00367800
*D404500-404800,406000,407100-407997,495000-507000             @G36XRCU 00369800
*A157000,259000,348240,374500,376000,377760,408000,494700      @OX16402 00370500
*C257000,259100,259160-259200,293060                           @OX16402 00371200
*D293430-316000 COPIED TO STMT 259000                          @OX16402 00371900
*D378000-399000 COPIED TO STMT 408000                          @OX16402 00372800
*A293405,492000                                                @OZ26495 00372982
*C293060                                                       @OZ26495 00373082
*C437400                                                       @OS80044 00373182
*A484400                                                       @OZ28713 00373282
*A329200                                                       @OZ28740 00373382
*C377590                                                       @OX21106 00373482
*A487420                                                       @OX16402 00376800
         EJECT                                                 @Y17XACL 00381800
*********************************************************************** 00400020
*                                                                     * 00500020
*MODULE-NAME=IGG01943 (TCAM,CHECKPOINT/RESTART)                @Y17XACT 00510000
*                                                                     * 00520022
*DESCRIPTIVE-NAME=RESTART FROM ENVIRONMENT RECORDS                    * 00530022
*                                                                     * 00540022
*COPYRIGHT='NONE'                                                     * 00550022
*                                                                     * 00560022
*STATUS: VERSION 10.0                                          @Y17XACT 00800000
*                                                                     * 00900020
*FUNCTION:THIS MODULE USES THE CHECKPOINT ENVIRONMENT RECORD          * 01000020
*   SEGMENT(S) TO RECONSTRUCT THE MCP ENVIRONMENT AT RESTART TIME. IT * 01100020
*   TURNS ON THE RESTART IN PROGRESS FLAG IN AVTBIT2. IT DETERMINES   * 01200020
*   WHICH ENVIRONMENT RECORD TO USE BY SUBTRACTING THE VALUE OF THE   * 01300020
*   INTRO OPERAND 'RESTART=' FROM THE NUMBER OF THE CURRENT ENVIRON-  * 01400020
*   MENT RECORD.(THIS NUMBER IS MAINTAINED IN THE CHECKPOINT CONTROL  * 01500020
*   RECORD.) IF THE RESULT IS NOT POSITIVE,THE VALUE OF THE INTRO     * 01600020
*   OPERAND 'CPRCDS' (THE TOTAL NUMBER OF ENVIRONMENT RECORDS) IS     * 01700020
*   ADDED TO THE RESULT. IF THE TTR OF THE ENVIRONMENT RECORD(IN THE  * 01800020
*   CONTROL RECORD) IS ZEROED,THE RECORD HAS HAD A DISK ERROR; IN THIS* 01900020
*   CASE, THIS MODULE SETS ERROR INDICATORS IN THE                    * 02000022
*   CHECKPOINT/WORKAREA, SETS UP THE XCTL TO IGG01942 WHICH ISSUES    * 02100022
*   WTO ERROR MESSAGES. THE RESTART IS TERMINATED, AND NO CHECKPOINTS * 02200022
*   ARE TAKEN FOR THE DURATION OF THIS JOB.                           * 02300022
*   THIS MODULE IS BEING MODIFIED TO SUPPORT NEW TCAM 10       @Y17XACT 02330000
*   TTE INFORMATION.                                           @Y17XACT 02360000
*                                                                     * 02400022
*                                                                     * 02500020
*ENTRY POINT:                                                         * 02600020
*                                                                     * 02700020
*        IGG01943                                                     * 02800020
*    PURPOSE - SEE FUNCTION                                    @Y17XACT 02830000
*    LINKAGE - VIA XCTL                                        @Y17XACT 02860000
*                                                                     * 02900020
*INPUT: REGISTERS 2,5,6,7,8 CONTAIN THE FOLLOWING:                    * 03000020
*                                                                     * 03100020
*   2-ADDRESS OF THE CHECKPOINT WORK AREA                             * 03200020
*   5-ADDRESS OF THE BEGINNING OF THE WTG TABLE PREFIX         @G36XRCU 03300000
*   6-ADDRESS OF BEGINNING OF WHERE-TO-GO TABLE                       * 03400020
*   7-ADDRESS OF THE COPY OF THE CURRENT DCB                   @G36XRCU 03500000
*   8-ADDRESS OF CURRENT ENTRY IN WHERE-TO-GO TABLE                   * 03600020
*   THE CHECKPOINT DATA SET-THE FIRST RECORD IS A CONTROL RECORD      * 03700020
*     WHICH POINTS TO THE ENVIRONMENT,CKREQ,AND INCIDENT RECORDS.     * 03800020
*                                                                     * 03900020
*OUTPUT:                                                              * 04000020
*                                                                     * 04100020
*   REGISTERS 5 AND 6 ARE SAME AS INPUT                               * 04200020
*   REGISTERS 7 AND 8 ARE UPDATED TO THE NEXT ENTRIES                 * 04300020
*                                                                     * 04400020
*   CHECKPOINT DATA SET IS NOT CHANGED                                * 04500020
*                                                                     * 04600020
*EXTERNAL ROUTINES:                                                   * 04700020
*                                                                     * 04800020
*        IECPCNVT-CONVERSION OF RELATIVE TRACK ADDRESS TO ABSOLUTE    * 04900020
*        IEDQTNT - CONVERT TTCIN TO TTE                        @Y17XACT 04920000
*        IGG019Q8 - READ SUBROUTINE                            @Y17XACT 04940000
*                 - MOVE DATA TO INVITATION LIST SUBROUTINE    @Y17XACT 04960000
*                                                                     * 05000020
*EXITS-NORMAL: THIS MODULE XCTLS TO THE NEXT OPEN MODULE IN THE       * 05100020
*   WHERE-TO-GO TABLE-IGG01944                                        * 05200020
*                                                                     * 05300020
*EXITS-ERROR:THIS MODULE ISSUES A WTO ERROR MESSAGE,CLEARS AVTCKGET TO* 05400020
*   ZERO AND XCTLS TO THE NEXT MODULE IN THE WHERE-TO-GO TABLE. THE   * 05500020
*   ONLY TIME THIS ERROR EXIT IS TAKEN IS WHEN NO ENVIRONMENT RECORD  * 05600020
*   CAN BE READ BECAUSE THEY ALL HAVE DISK ERRORS.                    * 05700020
*                                                                     * 05800020
*MACROS:                                                       @Y17XACT 05820000
*     XCTL,IEDHJN                                              @Y17XACT 05840000
*                                                              @Y17XACT 05860000
*TABLES/WORK AREAS:                                                   * 05900020
*                                                                     * 06000020
*   CVT                                                               * 06100020
*   AVT (AVTCKGET,AVTNCKPR,AVTVPRCD,AVTOPTPT,AVTCLRHI,AVTRNMPT,       * 06200020
*        AVTBIT3,AVTCKPTB)                                            * 06300020
*   CHECKPOINT WORK AREA                                              * 06400020
*   TCB                                                               * 06500020
*   DEB                                                               * 06600020
*   DCB                                                               * 06700020
*   QCB                                                               * 06800020
*   TERMINAL NAME TABLE                                               * 06900020
*   TERMINAL TABLE                                                    * 07000020
*   INVITATION LIST                                                   * 07100020
*                                                                     * 07200020
*ATTRIBUTES: REENTERABLE                                              * 07300020
*                                                                     * 07400020
*NOTES: THE OPERATION OF THS MODULE DEPENDS UPON AN INTERNAL REPRE-   * 07500020
*   SENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT TO    * 07600020
*   THE ONE USED AT ASSEMBLY TIME. THE CODING HAS BEEN ARRANGED SO    * 07700020
*   THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY, WILL   * 07800020
*   RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.               * 07900020
*                                                                     * 08000020
*    RESTRICTIONS : NONE                                       @Y17XACT 08010000
*    REGISTER CONVENTIONS : SEE REGISTER ASSIGNMENTS           @Y17XACT 08020000
*    PATCH LABEL : ZAPAREA                                     @Y17XACT 08030000
*                                                              @Y17XACT 08040000
*MODULE TYPE: PROCEDURE                                        @Y17XACT 08050000
*    PROCESSOR: ASSEMBLER                                      @Y17XACT 08060000
*    MODULE SIZE: SEE EXTERNAL SYMBOL DICTIONARY               @Y17XACT 08070000
*                                                              @Y17XACT 08080000
*********************************************************************** 08100020
         EJECT                                                 @Y17XACL 08150000
*REGISTER ASSIGNMENTS                                                   08300020
         SPACE                                                          08400020
R0       EQU   0                        TTR                             08500020
R1       EQU   1                        REGISTER EQUATE          S21903 08600022
R2       EQU   2                        ADDRESS OF CKPT WORK AREA       08700020
R3       EQU   3                        OPTION ENTRY LENGTH             08800020
RLCB     EQU   4                        ADDR OF LCB;ADDR OF INVLIST     08900020
R4       EQU   4                        REGISTER EQUATE          S21903 09000022
R5       EQU   5                        BEGINNING OF OPTION ENTRIES     09100020
R6       EQU   6                        ADDR OF TERMNAM TABLE ENTRY     09200020
RQCB     EQU   7                        ADDR OF QCB                     09300020
R7       EQU   7                        REG 7                    S22024 09400022
RTERM    EQU   8                        ADDR OF TERMINAL ENTRY          09500020
R8       EQU   8                        REG 8                    S22024 09600022
RAVT     EQU   9                        ADDR OF AVT                     09700020
RDCB     EQU   10                       ADDR OF DCB;INDEX-OPTION TBL    09800020
R10      EQU   10                       REG 10                   S22024 09900022
R11      EQU   11                       CURRENT LOCATION IN DISKRCD     10000020
R12      EQU   12                       BASE REG            0419 S21101 10050000
RBASE    EQU   12                       BASE REG                        10100020
R13      EQU   13                       BRANCH REG                      10200020
R14      EQU   14                       RCD LEN;TERMNAME LEN;INVLEN     10300020
R15      EQU   15                       OPT TABLE LOCATION;NO.TNT      X10400020
                                        ENTRIES                         10500020
         EJECT                                                 @Y17XACL 10600000
*STANDARD LINKAGE                                                       10800020
         SPACE                                                          10900020
         BALR  RBASE,0                  ESTABLISH BASE           S21903 11000022
         USING *,RBASE                                                  11100020
         B     QMELD                    BRANCH AROUND CONST 0216 S21101 11200000
         DC    CL6'IGG01943'            MODULE ID               SA51078 11300022
QMEXX    DC    CL2'43'                  CONSTANT                 S21903 11400022
         IEDHJN ,                                                S22024 11410022
         SPACE 2                                                        11420000
* LOAD SUBROUTINE FOR EXTRA PROCESSING                      0216 S21101 11430000
         SPACE                                                          11440000
QMELD    DS    0H                       ALIGN                   SA51078 11450022
         SPACE                                                          11500000
         USING IEDQCKPD,R2              BASE FOR CKPT AREA  0216 S21101 11510000
         USING IHADCB,RDCB                                       S22024 11520022
         USING FORCORE,R4               OPEN WORK AREA DSECT   @G36XRCU 11520600
         L     R4,FOUR(R8)              ADDR OF OPEN WORK AREA @G36XRCU 11521200
         L     RDCB,DXUDCBAD            ADDR OF CURRENT DCB    @G36XRCU 11521800
         DROP  R4                                              @G36XRCU 11522400
         L     R2,DCBIOBAD              GET CURRENT WORKAREA ADDRS22024 11526022
         SPACE 2                                               @Y17XACL 11528000
QME00    EQU   *                                                        11600020
         SPACE                                                          11700020
         USING IEDQAVTD,RAVT            BASE FOR AVT                    11800020
         SPACE                                                          11900020
         SPACE                                                          12100020
         LM    R14,R11,CKPSAVE1+12      GET REGS INITIALIZED BY        X12200020
                                        THE PREVIOUS MODULE             12300020
         MVC   0(TWO,R8),QME44          INITLZ FOR NORMAL EXIT @G36XRCU 12350000
         SR    R15,R15                  CLEAR FOR IC             S22024 12360022
         IC    R15,CKPTTRCT             INDEX TO CURRENT ENV TTR S22024 12370022
         EJECT                                                 @Y17XACL 12380000
*DETERMINE THE ENVIRONMENT RECORDS FROM WHICH TO RESTART                12500020
         SPACE                                                          12600020
*R4 HAS THE VALUE OF CKPCPRCD                                           12700020
*R15 HAS THE VALUE OF CKPTTRCT                                          12800020
*R0 HAS THE VALUE OF AVTCKRST                                           12900020
         SPACE                                                          13000020
QME01    EQU   *                                                        13100020
         SR    R15,R0                   SUBTRACT DOWN LEVEL             13200020
         BP    QME03                    BRANCH IF POSITIVE              13300020
         IC    R0,CKPCPRCD              GET NO. OF CKPT ENV RCDS        13400020
QME02    EQU   *                                                        13500020
         AR    R15,R0                   ADD NO. OF RCDS                 13600020
         BC    12,QME02                 BRANCH IF NOT POSITIVE   S21903 13700022
QME03    EQU   *                                                        13800020
         LA    R0,1                     GET DECREMENT VALUE             13900020
         LR    R1,R15                   SAVE                            14000020
         MH    R1,QMEHA5                MULTIPLY BY LN OF TTR419 S21101 14100000
         LA    R13,CKPTTRT1-CKPTTRLN(R1) ADDRESS OF TTR     0503 S21101 14200000
         CLI   2(R13),0                 CHECK FOR DISK ERROR       0728 14300020
         BNE   QME04                    BRANCH IF NO ERROR         0728 14400020
         ST    R15,CKPTRMAD             SAVE REG                        14500020
         BAL   R13,QME9805              WRITE ERROR MSG TO CONSOLE 0728 14600020
         LA    R0,1                     RESTORE REG                     14700020
         LTR   R4,R4                    CHECK FOR ZERO RCDS LEFT   1217 14830020
         BZ    QME035                   BRANCH IF NO MORE RECDS    1217 14860020
         BCT   R4,QME01                 BRANCH IF MORE RCDS AVAILABL    14900020
QME035   EQU   *                                                   1217 14950020
         OI    CKPFLAGS,CKPERR          INDICATE UNRECOVERABLE ERR 0819 15000020
         BAL   R13,QME9806              LOAD ID FOR NEXT MODULE    0208 15100020
         B     QME87                    XCTL TO NEXT MODULE        0208 15200020
QME04    EQU   *                                                        15300020
         LTR   R4,R4                    CHECK FOR LAST ENV  0422 S21101 15310000
         BZ    QME035                   BRANCH IF LAST RCD  0422 S21101 15320000
         BCTR  R4,0                     SUBTRACT 1 FROM COUNT OF RC1022 15350020
         ST    R13,CKPCTTRA             SAVE ADDR OF TTR                15400020
         STM   R14,R4,CKPSAVE1+12       SAVE REGS FOR POSITION     1022 15450020
         MVC   CKPTRMAD+1(3),0(R13)     PUT ON WORD BOUNDARY            15500020
         MVC   CKPSECLT,3(R13)          SAVE TRACK DATA LN  0419 S21101 15550000
         L     R0,CKPTRMAD              GET TTR OF CURRENT ENV RCD      15600020
         BAL   R13,QME8905              READ RECORD                1022 15700020
         NI    CKPFLAGS,AVTEFF-CKPOPNEN  SET FOR QCB SCAN      @OX16402 15750000
         EJECT                                                 @Y17XACL 15800000
         USING IEDQCDRD,R11                                             16000020
*INITIALIZE FOR LOOP THROUGH TERMNAME TABLE                             23100020
         SPACE                                                          23200020
QME17    EQU   *                                                        23300020
         USING IEDQTNTD,R15             SET UP BASE FOR TERM0208 S21101 23350000
         LA    R6,ONE                   FIRST OFFSET IN TNT 0208 S21101 23400000
         L     R15,AVTRNMPT             NAME TABLE          0208 S21101 23450000
         SPACE 3                                                        24100020
*BEGINNING OF LOOP THROUGH TERMNAME TABLE                               24200020
         SPACE                                                          24300020
QME20    EQU   *                                                        24400020
         LR    R1,R6                    OFFSET FOR THIS TERM0208 S21101 24420000
         LR    R7,R0                    SAVE TTR REG        0408 S21101 24440000
         BALR  R14,R15                  GET ADDRESS OF ENTRY0208 S21101 24460000
         LR    R0,R7                    RESTORE TTR         0408 S21101 24480000
         LR    R8,R1                    USE THIS AS BASE    0208 S21101 24500000
         LA    R14,QME52                SET UP BRANCH ADDR  0208 S21101 24520000
         USING IEDNTRM,R8               BASE FOR TERM ENTRY    @Y17XACT 24800000
         SH    R8,TRMBCKUP              POINT TO NEG PREFIX    @Y17XACT 24810000
         L     R7,TRMDESTQ-1            ADDRESS OF QCB             1109 24830020
         USING IEDQQCB,R7               BASE FOR QCB               1109 24860020
         SPACE 3                                                        24900020
*CHECK TYPE OF TERMINAL ENTRY. UPDATE QCB'S AND INVITATION LISTS        25000020
         SPACE 1                                                        25020022
         TM    TRMDSORG,TRMLGB          IS THIS A LINE GROUP     S22024 25040022
         BCR   ONE,R14                  YES, HAS NO QCB          S22024 25060022
         SPACE                                                          25100020
         TM    TRMSTATE,TRMLIST         IS THE LIST BIT ON      SA53610 25200022
         BNO   QME22                    IF NOT, RESTORE ENTRY   SA53610 25300022
         TM    TRMSTATE,TRMLOG          IS THIS LOGTYPE         SA53610 25400022
         BCR   NOTONES,R14              IF NOT, DO NOT RESTORE  SA53610 25500022
         EJECT                                                 @Y17XACL 25550000
QME22    EQU   *                                               @OX16402 25700000
         TM    CKPFLAGS,CKPOPNEN        TERMINAL SCAN          @OX16402 25720000
         BO    QME2201                  YES, SKIP QCB SCAN     @OX16402 25740000
         SPACE 3                                               @OX16402 25760000
* THE FOLLOWING INSTRUCTIONS HAVE BEEN MOVED TO UPDATE THE     @OX16402 25766000
* QCB FIELDS BEFORE THE TERMINAL ENTRY FIELDS. THIS IS FOR     @OX16402 25772000
* RESTART SO THAT IT CAN BE SURE THAT THE SEQUENCE NUMBER HAS  @OX16402 25778000
* BEEN UPDATED TO WHAT THE DISK POINTERS INDICATE.             @OX16402 25784000
*RESTORE MASTER QCB FIELDS                                              25790000
         SPACE                                                          25903000
QME34    EQU   *                                                   1106 25906000
         TM    TRMSTATE,TRMPROC         PROCESS ENTRY?         @Y17XACT 25909000
         BO    AROUND5                  YES, BR AROUND.        @Y17XACT 25912000
         TM    TRMSTATE,TRMPREF         3705 ENTRY??           @Y17XACT 25915000
         BNO   AROUND5                  NO, BR AROUND.         @Y17XACT 25918000
         CLI   TRMTYPE,TRMSSCP          SSCP ENTRY   ??        @Y17XACT 25921000
         BE    QME52                    YES, NO PROCESSING *   @Y17XACT 25924000
AROUND5  EQU   *                                               @Y17XACT 25927000
         L     R7,TRMDESTQ-1            ADDRESS OF QCB             1109 25930000
         L     R10,QCBDCBAD-1           ADDRESS OF DCB FOR LINE    1109 25933000
         SR    R4,R4                    CLEAR                      1109 25936000
         IC    R4,QCBRELLN              RELATIVE LINE NUMBER       1109 25939000
         BCTR  R4,0                     DECREMENT BY ONE         A47151 25942000
         SLL   R4,2                     MULTIPLY BY 4              1109 25945000
         TM    QCBDSFLG,QCBDISK         CHECK QUEUE TYPE           1106 25948000
         BZ    QME52                    BRANCH IF CORE ONLY    @OX16402 25951000
         TM    QCBFLAG,QCBCKPT          CHECK FOR QCB ALREADY          X25954000
                                        PROCESSED                       25957000
         BCR   ONE,R14                  BRANCH IF PROCESSED 0208 S21101 25960000
QME3405  EQU   *                                                SA51078 25963000
         OI    QCBFLAG,QCBCKPT          TURN ON PROCESSED BIT           25966000
         MVC   CKPTRMAD(ONE),0(R11)     GET QCB DELIMITER      @OX16402 25969000
         MVC   QCBMSGCT(CKPMCTLN),ONE(R11)  UPDATE MSG CNT     @OX16402 25972000
         MVC   QCBQBACK(CKPQBKLN),CKPMCTLN+ONE(R11)  UPDATE    @OX16402 25975000
*                                         QBACK POINTER        @OX16402 25978000
         LA    R11,CKPMQBLN(R11)        LEN MASTER QCB FIELDS  @OX16402 25981000
         BAL   R13,IEDQME89             CHECK FOR END OF RCD   @OX16402 25984000
         B     QME3405                  RESTORE IF IN NEXT SEG @OX16402 25987000
         LA    R13,QME00                SET ERROR RETURN       @OX16402 25990000
         CLI   CKPTRMAD,CKPQDELM        VALID QCB              @OX16402 25993000
         BNE   QME9805                  INCR DISK ERROR CNT    @OX16402 25996000
         SPACE 3                                                        25999000
*BEGINNING OF LOOP THROUGH PRIORITY LEVEL QCB'S                         26002000
         SPACE                                                          26005000
QME35    EQU   *                                                        26008000
         MVC   QCBDNHDR(CKPQCBLN),0(R11)   UPDATE QCB POINTERS          26011000
         LA    R11,CKPQCBLN(0,R11)      MOVE TO NEXT FIELD IN RCD       26014000
         BAL   R13,IEDQME89             CHECK FOR END OF RECORD         26017000
         B     QME35                    RESTORE IF IN NEXT SEG  SA51078 26020000
QME3504  EQU   *                                                SA51078 26023000
         MVC   QCBPQBCK(CKPQBKLN),0(R11)                        SA51078 26026000
*                                       SET PRI LEVEL QBACK PTR SA51078 26029000
         LA    R11,CKPQBKLN(R11)        UPDATE FIELD PTR        SA51078 26032000
         BAL   R13,IEDQME89             CHECK FOR EMD OF RECORD SA51078 26035000
         B     QME3504                  RESTORE IF IN NEXT SEG  SA51078 26038000
         CLI   QCBPRIPQ,0               CHECK FOR 0 PRIORITY            26041000
         LA    RQCB,QCBPSIZE(0,RQCB)    MOVE TO NEXT PRIORITY QCB       26044000
         BNE   QME35                    BRANCH IF NOT LAST              26047000
         B     QME52                    CHECK NEXT TNT ENTRY   @OX16402 26062000
         SPACE 3                                               @OX16402 26065000
QME2201  EQU   *                                               @OX16402 26068000
         MVC   CKPTRMAD(CKPDELLN),0(R11) SAVE DELIMITER     0512 S21101 26100000
         MVC   TRMSTATE(CKPTRMLN),CKPDELLN(R11) UPDATE TERM 0208 S21101 26400000
         LA    R11,CKPTRMLN+CKPDELLN(R11)  ADD LENGTHS         @ZM47956 26700000
         BAL   R13,IEDQME89              CHECK FOR END OF RECORD        27000020
         B     QME22                    RESTORE IF IN NEXT SEG  SA51078 27100022
         LA    R13,QME00                SET ERROR RETURN        SA51078 27150022
         CLI   CKPTRMAD,CKPDELMT        IS THIS A GOOD TERM 0512 S21101 27200000
         BNE   QME9805                  INCR DISK ERROR CNTR *  SA51078 27210000
         TM    TRMSTATE,TRMPROC         PROC OR LOG TYPE       @Y17XACT 27220000
         BO    AROUND                   YES,NO QCB PROCESSING  @Y17XACT 27230000
         TM    TRMSTATE,TRMHELDN        CHECK FOR INTERCEPTED  @Y17XACT 27240000
         BZ    AROUND                   BR IF NOT INTERCEPTED  @Y17XACT 27250000
         TM    QCBFLAG,QCBTERMQ         CHECK QUEUEING TYPE    @Y17XACT 27260000
         BZ    AROUND                   BR IF QUEUEING BY LINE @Y17XACT 27270000
         OI    QCBLINK+2,QCBTRMHO       MARK QCB HELD-LINE     @Y17XACTX27280000
                                        OPEN WILL MOVE QCBSTAT @Y17XACT 27290000
AROUND   EQU    *                                              @Y17XACT 27300000
         TM    TRMSTATE,TRMLOG          PROCESS ENTRY           SA59179 27400105
         BM    QME23                    YES,UPDATE FIELDS       SA59179 27400205
         TM    TRMSTATE,TRMPREF         3705 RESOURCE?         @Y17XACT 27420200
         BO    QME3705                  YES,GO TO SPECIAL RTN  @Y17XACT 27440200
         TM    TRMSTATE,TRMSNGLE        SINGLE ENTRY ?         @Y17XACT 27460200
         BNZ   QMEB                     NO,DONT RESTORE        @YM07342 27480200
QMEA     EQU   *                                               @Y17XACT 27500200
         MVC   TRMSENSE(CKPSENSE),0(R11)                       @Y17XACT 27510200
*                                       RESTORE SENSE          @Y17XACT 27540200
         LA    R11,CKPSENSE(R11)        ADD LENGTHS            @Y17XACT 27560200
         BAL   R13,IEDQME89             CHK FOR END OF REC     @Y17XACT 27580200
         B     QMEA                     RESTORE FROM NEXT SEG  @Y17XACT 27600200
QMEB     EQU   *                                               @Y17XACT 27620200
         TM    QCBDSFLG,QCBDISK         DISK QUEUES?           @Y17XACT 27640200
         BZ    QME25                    BR IF CORE Q ONLY      @Y17XACT 27660200
QME23    EQU   *                                                SA51078 28000022
         MVC   TRMINSEQ(CKPSEQLN),0(R11) UPDATE SEQ FIELDS              29100020
         LA    R11,CKPSEQLN(0,R11)      ADD LENGTH OF SEQ FIELDS        29200020
         BAL   R13,IEDQME89             CHECK FOR END OF RCD            29300020
         B     QME23                    RESTORE IF IN NEXT SEG  SA51078 29300522
         EJECT                                                 @Y17XACL 29300700
*RESTORE OPTION FIELDS EXCEPT THOSE DEFINED AS ADDRESS TYPE CONSTANTS   29302020
         SPACE                                                          29303020
QME25    EQU   *                                                   1106 29304020
         TM    TRMSTATE,TRMOPTFN        CHECK FOR  OPTIONS USED    1106 29305020
         BZ    QME36                    BRANCH IF NOT USED     @OZ26495 29306082
         SPACE                                                          29307020
         SR    R1,R1                    CLEAR INDEX                1106 29308020
         SR    R3,R3                    CLEAR COUNT OF OPTION FIELD1106 29309020
         IC    R3,TRMOPNO               GET COUNT OF OPTION FIELDS 1106 29310020
         LH    R10,TRMOPTBL             GET ENTRY OFFSET       @YA05454 29311056
         N     R10,AVTCLRHI             CLEAR HI HALF          @YA05454 29311856
         L     R7,AVTOPTPT              GET OPT TBL ADDR       @YA05454 29312656
         AR    R10,R7                   ADD OPT TABLE ADDR     @YA05454 29313456
         L     R7,4(,R7)                GET OPT CSECT TBL ADDR @YA05454 29314256
         SPACE 3                                                        29315020
*BEGINNING OF LOOP THROUGH OPTION FIELDS FOR THIS TERMINAL ENTRY        29316020
         SPACE                                                          29317020
QME27    EQU   *                                                   1106 29318020
         SR    R5,R5                    K CLEAR LENGTH OF FIELD    1106 29319020
         SR    R13,R13                  CLEAR OFFSET REG           1106 29320020
         LR    R4,R10                   ADDR OF OPTIONS FOR TERM   1106 29321020
         IC    R13,TRMOPT(R1)           ADDR OF OPTION FIELD       1106 29322020
         CH    R13,QMENOPT              CHECK FOR UNUSED ENTRY     1106 29323020
         BE    QME31                    BRANCH IF UNUSED           1106 29324020
         AR    R4,R13                   ADDRESS OF OPTION FIELD    1106 29325020
         IC    R5,0(,R7)                GET LENGTH OF FIELD        1106 29326020
         CLI   1(R7),X'D0'              CHECK OPTION TYPE          1106 29327020
         BH    QME28                    BRANCH IF NOT ADDRESS-TYPE 1106 29328020
         CLI   1(R7),X'80'              CHECK OPTION TYPE          1106 29329020
         BH    QME31                    BRANCH IF ADDRESS TYPE     1106 29330020
QME28    EQU   *                                                   1106 29331020
         B     *+8                      ALIGN FOR RETURN BRANCH  S22024 29331222
QMENOPT  DC    H'255'                   COMP. FOR NO OPTION FIELDS22024 29331422
QMEHA5   DC    H'5'                     LENGTH OF ENV TTR        S22024 29331622
         EX    R5,QMEMOVE               RESTORE OPTION FIELD       1106 29332020
         LA    R11,1(R11,R5)            MOVE TO NEXT POSITION IN RD1106 29333020
         BAL   R13,QME89                CHECK FOR END OF RCD SEG   111W 29334020
         B     QME28                    RESTORE IF IN NEXT SEG  SA51078 29334522
QME31    EQU   *                                                   1106 29335020
         LA    R7,CKPOPLTL(,R7)         GET NEXT ENTRY IN OPT CHAR 1106 29336020
         LA    R1,1(,R1)                ADD 1 TO INDEX             1106 29337020
         BCT   R3,QME27                 SUBTRACT FROM COUNT OF OPT 1106 29338020
         SPACE                                                          29339020
*END OF LOOP THROUGH OPTION FIELDS FOR THIS TERMINAL ENTRY              29340020
         EJECT                                                 @Y17XACL 29340500
         SPACE 3                                               @OZ26495 29390582
QME36    EQU *                                                 @OZ26495 29440582
         TM    TRMDEVFL,X60             DIAL DIGITS/ADDR CHAR? @OZ26495 29490582
         BZ    QME40                    NO, BRANCH             @OZ26495 29540582
         SR    R5,R5                    CLEAR REG              @OZ26495 29590582
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS USED     @OZ26495 29640582
         BNO   NOOPTS                   NO, BRANCH             @OZ26495 29690582
         LA    R1,TRMOPT                START OF OPTIONS       @OZ26495 29740582
         IC    R5,TRMOPNO               NUMBER OF OPTIONS      @OZ26495 29790582
         AR    R1,R5                    START OF DEVICE FIELDS @OZ26495 29840582
         B     CKBUF                    CHECK BUFSIZE          @OZ26495 29890582
NOOPTS   EQU   *                                               @OZ26495 29940582
         LA    R1,TRMOPNO               START OF DEVICE FIELDS @OZ26495 29990582
CKBUF    EQU   *                                               @OZ26495 30040582
         TM    TRMDEVFL,X80             BUFSIZE SPECIFIED      @OZ26495 30090582
         BNO   CKDIAL                   NO, BRANCH             @OZ26495 30140582
         A     R1,ADD3                  BUMP PAST BUFSIZE      @OZ26495 30190582
CKDIAL   EQU   *                                               @OZ26495 30240582
         TM    TRMDEVFL,X40             DIAL DIGITS SPECIFIED  @OZ26495 30290582
         BNO   CKADDR                   NO, BRANCH             @OZ26495 30340582
QME37    EQU   *                                               @OZ26495 30360582
         ST    R11,CKPSAVE2+R11OFF      SAVE REG 11            @OZ26495 30370582
         IC    R5,0(R11)                SIZE OF DIAL DIGITS    @OZ26495 30390582
         LA    R11,ONE(R11,R5)          NEXT POSITION IN RECORD@OZ26495 30540582
         BAL   R13,QME89                CHECK - END OF RCD SEG @OZ26495 30590582
         B     QME37                    RESTORE IF IN NEXT SEG @OZ26495 30640582
         L     R11,CKPSAVE2+R11OFF      RESTORE REG 11         @OZ26495 30650582
         EX    R5,QME2MOVE              RESTORE DIAL DIGITS    @OZ26495 30660582
         LA    R11,ONE(R11,R5)          NEXT POSITION IN RECORD@OZ26495 30670582
         LA    R1,ONE(R1,R5)            BUMP PAST DIAL DIGITS  @OZ26495 30690582
CKADDR   EQU   *                                               @OZ26495 30740582
         TM    TRMDEVFL,X20             ADDR CHAR SPECIFIED    @OZ26495 30790582
         BNO   QME40                    NO, BRANCH             @OZ26495 30840582
QME38    EQU   *                                               @OZ26495 30860582
         ST    R11,CKPSAVE2+R11OFF      SAVE REG 11            @OZ26495 30870582
         IC    R5,0(R11)                SIZE OF DIAL DIGITS    @OZ26495 30890582
         LA    R11,ONE(R11,R5)          NEXT POSITION IN RECORD@OZ26495 31040582
         BAL   R13,QME89                CHECK - END OF RCD SEG @OZ26495 31090582
         B     QME38                    RESTORE IF IN NEXT SEG @OZ26495 31140582
         L     R11,CKPSAVE2+R11OFF      RESTORE REG 11         @OZ26495 31190582
         EX    R5,QME2MOVE              RESTORE ADDR CHAR      @OZ26495 31240582
         LA    R11,ONE(R11,R5)          NEXT POSITION IN RECORD@OZ26495 31290582
*SET UP LCB STATUS IN THE QCB TO BE PICKED UP BY LINE OPEN         0626 31800020
         SPACE                                                          31900020
QME40    EQU   *                                                        32000020
         TM    TRMSTATE,X'20'           CHK FOR PROCESS OR LOG @Y17XACT 32100000
         BCR   ONE,R14                  BRANCH IF PROCESS   0208 S21101 32200000
         L     RQCB,TRMDESTQ-1          RESTORE ADDR OF MASTER QCB 0626 32300020
QME43    EQU   *                                                   0826 32900020
         TM    TRMSTATE,TRMPREF         3705 ENTRY?            @Y17XACT 32903000
         BO    QME3705D                 YES, SPECIAL PROC      @Y17XACT 32906000
         SPACE                                                          32910020
         MVC   QCBLINK(CKPLCBLN),0(R11) SAVE LCBSTAT1,LCBSTAT2     0918 32920020
         L     R10,QCBDCBAD-1           ADDR OF DCB FOR LINE   @OZ28740 32925082
         MVC   DCBINTVL,CKPLCBLN(R11)   MOVE DCB INTERVAL TO DCB   1008 32930020
         LA    R11,CKPLCBLN+CKPDCBLN(,R11)  MOVE TO NEXT DISK POSIT1008 32940020
         BAL   R13,QME89                CHECK FOR END OF RCD SEG   1008 32950020
         B     QME43                    RESTORE IF IN NEXT SEG  SA51078 32980022
         TM    QCBLINK,LCBSENDN+LCBRECVN+LCBFREEN CHECK LINE STATUS0918 33020020
         BC    9,QME45                  BRANCH NOT MIXED-EITHER    0626X33100020
                                        STOPPED OR NOT OPENED      0626 33200020
         MVI   QCBLINK,LCBRECVN         MARK LCB STAT RECEIVING    0626 33300020
         EJECT                                                 @Y17XACL 33350000
*UPDATE INVITATION LIST                                                 34500020
         SPACE                                                          34600020
QME45    EQU   *                                               @Y17XACL 34650000
         TM    CKPFLAGS,CKPSTAIN        CHECK FOR INV LISTS CKPTED      34700020
         BCR   CONDZERO,R14             BRANCH IF NOT TO BE 0208 S21101X34740000
                                        CHECKPOINTED        0208 S21101 34780000
QME4503  EQU   *                                                 S22024 34784022
QME4505  EQU   *                                                 S22024 34824022
         L     R10,QCBDCBAD-1           ADDR OF DCB FOR LINE   @OX16402 34825000
         SR    R4,R4                    CLEAR                  @OX16402 34826000
         IC    R4,QCBRELLN              RELATIVE LINE NUMBER   @OX16402 34827000
         BCTR  R4,0                     DECREMENT BY ONE       @OX16402 34828000
         SLL   R4,2                     MULTIPLY BY FOUR       @OX16402 34829000
         ST    RBASE,CKPSAVE1           SAVE BASE FOR 1943     @XA05305 34830056
         L     RBASE,CKPSAVE1+Q8BASEOF  GET BASE FOR 19Q8      @XA05305 34920056
         BAL   R13,Q8INVCHK(,RBASE)     GO CHECK INVITATION LIS@XA05305 35010056
*                                                              @XA05305 35100056
         BR    R14                      BAD RETURN BR TO QME52 @XA05305 35190056
         SPACE                                                          35300022
         LR    R13,R0                   SAVE TTR                 A47151 35380022
         SR    R0,R0                    CLEAR                    A47151 35460022
         SR    R1,R1                      REGISTERS              A47151 35540022
         IC    R0,INVENTS(,R4)          GET NO. ENTRIES IN LIST  A47151 35620022
         IC    R1,INVELEN(,R4)          GET LENGTH OF ONE ENTRY  A47151 35700022
         MR    R0,R0                    GET LENGTH OF ALL ENTRIES       35800020
         LR    R0,R13                   RESTORE TTR                     35900020
         LA    R1,INVCNTRL(,R1)         ADD LEN OF CONTROL AREA  A47151 36000022
         TM    INVSTAT(R4),EOTBIT       IS IT EOT-FE (BSC)      SA57661 36020022
         BZ    QNK6406A                 NO, BRANCH              SA57661 36040022
         LA    R1,ONE(,R1)              ADD ADDITIONAL FOR EOT  SA57661 36060022
QNK6406A EQU   *                                                SA57661 36080022
         MVC   CKPTRMAD,INVCPUID(R4)    SAVE ADDRESS OF CPUID    A47151 36100022
         ST    R4,CKPSAVE1+4            SAVE ADDRESS               1217 36207020
QME46    EQU   *                                                   1014 36214020
         L     R3,CKPEXCP               BEGINNING ADDR OF DISK RCD 1014 36221020
         AH    R3,CKPBPERR              ADDR OF END OF RCD         1014 36228020
         SR    R3,R11                   REMAINING LENGTH           1014 36235020
         BNZ   QME47                    BRANCH IF NOT END          1015 36242020
         BAL   R13,QME8905              READ NEXT RCD SEGMENT      1022 36249020
         B     QME46                    GET LENGTH OF RCD SEGMENT  1022 36256020
QME47    EQU   *                                                   1014 36263020
         ST    RBASE,CKPSAVE1           SAVE BASE FOR 1943  0216 S21101 36266000
         L     RBASE,CKPSAVE1+8         GET BASE FOR IGG019Q8216 S21101 36269000
         BAL   R13,Q870(,RBASE)         BRANCH TO 19Q8           A47151 36272022
         LTR   R1,R1                    CHECK FOR REMAINDER OF LIST1022 36277020
         BP    QME46                    BRANCH IF STILL REMAINDER  1014 36284020
         L     R4,CKPSAVE1+4            RESTORE ADDR OF LIST BEGIN 1015 36584020
         OI    INVSTAT(R4),CKPSET2      MARK LIST PROCESSED      A47151 37000022
         TM    TRMDEVFL,X'02'           CHECK FOR BFRED TERMINAL   1014 37010020
         BZ    QME51                    BRANCH IF NOT BFRED TERM   1014 37020020
         NI    INVSTAT(R4),X'FF'-ONE    TURN OFF AUTOPOLL BIT    S21903 37030022
         BR    R14                      DONT RESTORE CPU ID 0208 S21101 37040000
QME51    EQU   *                                                   1014 37050020
         MVC   INVCPUID(INVIDLEN,R4),CKPTRMAD RESTORE CPUID ADDR S21903 37060022
         EJECT                                                 @Y17XACL 37080000
QME52    EQU   *                                                   1014 37150020
IEDQME52 EQU   *                                                        37200020
         LA    R6,ONE(,R6)              GET NEXT OFFSET     0208 S21101 37300000
         L     R15,AVTRNMPT             NAME TABLE          0507 S21101 37350000
         CH    R6,TNTLEN                CHECK FOR END OF TNT0208 S21101 37400000
         BNH   QME20                    BRANCH IF NOT       0208 S21101 37450000
         TM    CKPFLAGS,CKPOPNEN        TERM SCAN              @OX16402 37460000
         BO    ENDLOOP                  YES, MOVE AVT DATA     @OX16402 37470000
         OI    CKPFLAGS,CKPOPNEN        SET FOR TERM SCAN      @OX16402 37480000
         B     QME17                    GO THRU TNT AGAIN      @OX16402 37490000
         SPACE                                                          37500020
*END OF LOOP THROUGH TERMNAME TABLE                                     37600020
ENDLOOP  EQU   *                                               @OX16402 37630000
         NI    CKPFLAGS,AVTEFF-CKPOPNEN   TURN OFF BIT         @OX16402 37660000
         SPACE 3                                                        37700020
* UPDATE SIGNIFICANT AVT FIELDS                                         37703020
         SPACE                                                          37706020
         USING CKPAVT,R11               AVT CHECKPOINT FIELDS  @Y17XACA 37707000
QME60    EQU   *                                                        37709020
         MVC   AVTOPCON,CKPOPCON        OP. CONTROL TERMINAL   @Y17XACA 37712000
         MVC   AVTOPCIN,CKPOPCIN        PRI OP/CNT TERM TTCIN  @Y17XACA 37713000
         MVC   AVTINTLV,CKPINTLV        SYSTEM INTERVAL        @Y17XACA 37715000
         TM    AVTBIT1,AVTDISKN         DISK AVT                        37733022
         BZ    QME64                    BRANCH IF NO                    37733522
         NI    AVTBIT3,AVTEFF-AVTRFULN  RESET REUS FULL FLAG    SA68676 37733705
         TM    CKPBIT1,AVTRFULN         IN SLOWDOWN            @Y17XACA 37734000
         BZ    QME61                    BRANCH IF NO            SA59171 37734522
         OI    AVTBIT3,AVTRFULN         SET SLOW DOWN           SA59171 37735022
QME61    EQU   *                                                SA59171 37735522
         NI    AVTBIT4,AVTEFF-AVTRUFTN  RESET REUS ACTIVE AT CKPSA51078 37736422
         TM    CKPBIT2,AVTREUSN         WAS REUS TASK ACTIVE AT@Y17XACA 37736800
*                                       CHECKPOINT              SA51078 37737222
         BZ    QME62                    BRANCH IF NO            SA51078 37737622
         OI    AVTBIT4,AVTRUFTN         SET REUS ACTIVE AT CKPT SA51078 37738022
QME62    EQU   *                                                SA51078 37738422
         MVC   AVTNADDR(8),CKPNADDR     DISK QUEUE POINTERS    @Y17XACA 37739000
         MVC   AVTLODPT,CKPLODPT        RESTORE REUS LODPT FIEL@Y17XACA 37749000
         TM    CKPSUBT,AVTSUBON+AVTSUBPT  SUBTASK TRACE OR POST@OX21106 37759082
*                                         TRACE SPECIFIED      @OX21106 37760082
         BZ    NOTRACE                  NO, RESTORE AVTIOTR    @OX21106 37761082
         NC    AVTDISTR(FOUR),AVTDISTR  DOES TRACE TABLE EXIST @OX21106 37762082
         BZ    NOTRACE                  NO, DON'T RESTORE      @OX21106 37763082
         MVC   AVTSUBT(ONE),CKPSUBT     RESTORE AVTSUBT        @OX21106 37764082
NOTRACE  EQU   *                                               @OX21106 37765082
         MVC   AVTIOTR(ONE),CKPIOTR     RESTORE AVTIOTR        @OX21106 37766082
QME64    EQU   *                                                   0208 37769020
         LA    R11,CKPAVTLN(0,R11)      UPDATE DISK RCD POINTER    0208 37772020
         BAL   R13,QME89                TEST FOR END OF SEGMENT    0209 37775020
         B     QME60                    START OVER AGAIN ON AVT    0208 37776022
         B     QME87                    XCTL TO NEXT MODULE    @OX16402 37776500
         EJECT                                                 @Y17XACL 37777000
         SPACE 3                                                        40000020
*TRANSFER CONTROL TO NEXT EXECUTOR                                      40100020
         SPACE                                                          40200020
QME879   EQU   *                                                        40300020
         LA    R15,CKPGETML             ADDR OF PARM LIST               40400020
         MVC   6(2,R6),0(R8)            MOVE MODULE ID TO WTG TABLE     40500020
         XCTL  DE=(R6),SF=(E,(15))                                      40700020
         EJECT                                                 @Y17XACL 40705000
*PREPARE TO XCTL TO NEXT MODULE                                         40735000
         SPACE                                                          40765000
QME87    EQU   *                                                        40795000
         LM    R14,R11,CKPSAVE1+12      RESTORE REGS                    40825000
QME876   EQU   *                                                        40855000
         LA    R8,8(0,R8)               INCREMENT CURRENT WTG ENTRY     40885000
         LA    R7,4(0,R7)               INCREMENT CURRENT DCB           40915000
         CLC   ZERO(TWO,R8),AMIDCNST    IS THIS EXECUTOR NEEDED  Y02027 40945000
*                                         AGAIN                  Y02027 40975000
         BE    QMELD                    YES, RETURN TO PROCESS ITS22024 41005000
         CLC   0(2,R8),QME0S            CHECK FOR END OF TABLE          41035000
         BNE   QME876                   BRANCH IF NOT END               41065000
         LR    R7,R5                    RESET PARM LIST ADR      S21903 41095000
         LA    R8,32(R6)                RESET WTG TABLE ADDR            41125000
QME877   EQU   *                                                        41155000
         CLI   0(R8),0                  CHECK FOR ZERO ENTRY            41185000
         BNZ   QME879                   BRANCH IF NOT ZERO              41215000
         LA    R8,8(0,R8)               ADDR OF NEXT WTG ENTRY          41245000
         LA    R7,4(0,R7)               ADDR OF NEXT DCB                41275000
         B     QME877                   BRANCH                   S21903 41305000
*SUBROUTINE TO CHECK TO SEE IF THE END OF A TOTAL RECORD SEGMENT        42100020
*HAS BEEN REACHED; IF SO, READ THE NEXT RECORD.                         42200020
         SPACE                                                          42300020
QME89    EQU   *                                                   0626 42400020
IEDQME89 EQU   *                                                        42500020
         ST    R15,CKPSAVE1             SAVE REG                        42600020
         L     R15,CKPEXCP              GET BEGINNING OF RECORD         42700020
         AH    R15,CKPBPERR             ADD RECORD LENGTH               42800020
         CR    R11,R15                  COMPARE RECORD POSITION         42900020
         L     R15,CKPSAVE1             RESTORE REG                     43000020
         BNH   GOODRTN(,R13)            IF MORE RECORD,RETURN   SA51078 43100022
         SPACE 3                                                        43400020
*SUBROUTINE TO READ A RECORD AND UPDATE TTR (IN R0) TO NEXT RECORD.     43500020
         SPACE                                                          43600020
QME8905  EQU   *                                                   1022 43610020
QME90    EQU   *                                                   1014 43650020
IEDQME90 EQU   *                                                        43700020
         STM   R0,R14,CKPSAVE2          SAVE REGS              @OS80044 43740082
         L     R12,CKPSAVE1+8           BASE FOR IGG019Q8   0419 S21101 43780000
         BAL   R14,28(R12)              BRANCH TO 19Q8-READ 0419 S21101 43820000
         B     QME00                    ERROR RETURN START OVER SA51078 43860022
         L     R14,CKPSAVE2+R14OFF      RESTORE R14             SA51078 44860022
         BR    R13                      RETURN TO CALLING RTN   SA51078 45860022
         SPACE 3                                                        47900020
*SUBROUTINE TO INCREMENT DISK ERROR COUNT SO THAT ERROR MSGS CAN BE1109 47960020
*WRITTEN LATER BY IGG01942                                              48020020
         SPACE                                                          48100020
QME9805  EQU   *                                                   0728 48200020
         IC    R1,CKPERRCT              PICK UP ERROR COUNT        1109 48300020
         LA    R1,1(,R1)                ADD 1 TO COUNT             1109 48360020
         STC   R1,CKPERRCT              RESTORE COUNT              1109 48420020
         CLI   CKPERRCT,ONE             FIRST ERROR            @OZ28713 48423082
         BNE   NOTFIRST                 NO, BRANCH             @OZ28713 48426082
         STM   R0,R15,AVTSAVE1+8        SAVE REGS FOR IGG01942 @OZ28713 48430082
         L     R8,CKPEXCP               BEGINNING OF RECORD    @OZ28713 48432082
         MVC   AVTSAVE1(FOUR),FOUR(R8)  SAVE TIME OF RECORD    @OZ28713 48434082
         MVC   AVTSAVE1+8(ONE),CKPTRMAD SAVE FIELD             @OZ28713 48436082
NOTFIRST EQU   *                                               @OZ28713 48438082
QME9806  EQU   *                                                        48440020
         L     R8,CKPSAVE1+52           SET UP FOR RETURN TO       0208 48460020
         MVC   0(TWO,R8),QME42          ERROR MODULE           @G36XRCU 48480000
         BR    R13                      RETURN                     0728 48500020
         SPACE                                                          48600020
*END OF SUBROUTINE                                                      48700020
         EJECT                                                 @Y17XACL 48700500
QME3705  EQU   *                        PROCESS 3705 TTE       @Y17XACT 48701000
         CLI   TRMTYPE,TRMLUNT          LU?                    @Y17XACT 48702000
         BE    QME3705A                 YES,VALID QCB          @Y17XACT 48703000
         CLI   TRMTYPE,TRMPSNA          PRESNA TERM?           @Y17XACT 48704000
         BE    QME3705A                 YES, VALID QCB         @Y17XACT 48705000
         CLI   TRMTYPE,TRMCTERM         DIAL TERM?             @Y17XACT 48706000
         BNE   QME3705B                 NO, NO VALID QCB       @Y17XACT 48707000
QME3705A EQU   *                                               @Y17XACT 48708000
         TM    QCBDSFLG,QCBDISK         DISK QUEUEING ?        @Y17XACT 48709000
         BZ    QME3705B                 NO, BRANCH             @Y17XACT 48710000
QME3705C EQU   *                                               @Y17XACT 48711000
         MVC   TRMINSEQ(CKPSEQLN),0(R11) RESTORE IN/OUT SEQ    @Y17XACT 48712000
         LA    R11,CKPSEQLN(R11)        ADD LENGHT             @Y17XACT 48713000
         BAL   R13,IEDQME89             CHK END OF SEQ         @Y17XACT 48714000
         B     QME3705C                 RESTORE FROM NEW SEG   @Y17XACT 48715000
         EJECT                                                 @Y17XACL 48715500
QME3705B EQU   *                                               @Y17XACT 48716000
         USING CKPNRES,R11              CKP DSECT              @Y17XACT 48717000
         MVC   TRMSUBST,CKPSUBST        RESTORE SUBSTRUCT      @Y17XACT 48718000
         MVC   TRMCOHRT,CKPCOHRT        RESTORE COHORT PTR     @Y17XACT 48719000
         SPACE 1                                               @Y17XACL 48719300
         NI    TRMBYTE2,X'FF'-TRMREMB   CLEAR REMEMBER BIT     @Y17XACL 48719600
         TM    CKPNFLG,CKPREMB          REMB BIT SET           @Y17XACT 48720000
         BZ    AROUND1                  NO ,DONT RESTORE       @Y17XACT 48721000
         OI    TRMBYTE2,TRMREMB         RESTORE REMEMBER BIT   @Y17XACT 48722000
         SPACE 1                                               @Y17XACL 48722300
AROUND1  EQU   *                                               @Y17XACT 48722600
         TM    CKPFLAGS,CKPSTAIN        INVITATION LISTS CKPTED@Y17XACL 48723000
         BO    CKPTINV                  YES, BRANCH            @Y17XACL 48723500
         CLI   TRMTYPE,TRMPSNA          PRE-SNA TERMINAL       @Y17XACL 48724000
         BE    AROUND2                  YES, SKIP RSACT CKPT   @Y17XACL 48724300
CKPTINV  EQU   *                                               @Y17XACL 48724600
         NI    TRMBYTE2,X'FF'-TRMRSACT  CLEAR ACTIVE BIT       @Y17XACL 48725000
         TM    CKPNFLG,CKPRSACT         ACTIVE BIT SET         @Y17XACT 48725500
         BZ    AROUND2                  NO, DONT RESTORE       @Y17XACT 48726000
         OI    TRMBYTE2,TRMRSACT        RESTORE ACTIVE BIT     @Y17XACT 48726300
         SPACE 1                                               @Y17XACL 48726600
AROUND2  EQU   *                                               @Y17XACT 48727000
         TM    TRMSTATE,TRMLINE         IS THIS A LINE ENTRY   @Y17XACL 48727500
         BZ    AROUND3                  NO, BRANCH             @Y17XACL 48728000
         NI    TRMLINK,X'FF'-TRMEPMOD   CLEAR EP MOD BIT       @Y17XACL 48728300
         TM    CKPNFLG,CKPEPMOD         EPMOD BIT SET          @Y17XACT 48728600
         BZ    AROUND3                  NO, DONT RESTORE       @Y17XACT 48729000
         OI    TRMLINK,TRMEPMOD         RESTORE EP MOD BIT     @Y17XACT 48729500
         SPACE 1                                               @Y17XACL 48730000
AROUND3  EQU   *                                               @Y17XACT 48730300
         CLI   TRMTYPE,TRMLUNT          IS THIS AN LU ENTRY    @Y17XACL 48730600
         BNE   AROUND4                  NO, BRANCH             @Y17XACL 48731000
         NI    TRMLU,X'FF'-TRMLULOG     CLEAR LU LOG BIT       @Y17XACL 48731500
         TM    CKPNFLG,CKPLULOG         LU LOG BIT SET         @Y17XACT 48732000
         BZ    AROUND4                  NO, DONT RESTORE       @Y17XACT 48733000
         OI    TRMLU,TRMLULOG           RESTORE LU LOG BIT     @Y17XACT 48734000
         SPACE 1                                               @Y17XACL 48734500
AROUND4  EQU   *                                               @Y17XACT 48735000
         MVC   TRMTYPE,CKPTYPE          RESTORE TYPE           @Y17XACT 48736000
         LA    R11,CKPNRSZ(R11)         ADD LENGTH             @Y17XACT 48737000
         BAL   R13,IEDQME89             CHK FOR END OF SEG     @Y17XACT 48738000
         B     QME3705B                 RESTORE FROM NEW SEG   @Y17XACT 48739000
         B     QME25                    CONTINUE PROCESSING    @Y17XACT 48740000
         DROP  R11                                             @Y17XACT 48741000
         EJECT                                                 @Y17XACL 48741500
QME3705D EQU   *                                               @Y17XACT 48742000
         CLI   TRMTYPE,TRMSSCP          SSCP ENTRY             @ZM47951 48742300
         BER   R14                      GET NEXT ENTRY         @ZM47951 48742600
         CLI   TRMTYPE,TRMLNCP          NCP?                   @Y17XACT 48743000
         BNE   QME45                    NO, CONTINUE PROCESSING@YM07299 48744000
REDO     EQU   *                                               @Y17XACT 48744100
         MVC   TRMRLMCT(1),0(R11)       MOVE TRACE IND FOR198B @Y17XACT 48744200
         LA    R11,1(R11)               BUMP DISK PTR BY 1     @Y17XACT 48744400
         BAL   R13,IEDQME89             CHECK FOR END OF REC   @Y17XACT 48744600
         B     REDO                     CONTINUE PROCESSING    @Y17XACT 48747000
         BR    R14                      FINISHED WITH 3705     @YM07299 48750000
         EJECT                                                 @Y17XACL 48770000
QMECOMPR CLI   CKPRPERT,0               USED TO CHECK FOR END OF       X48990022
                                        TRACK WHEN READING ENV RCDS     49040022
QMEMOVE  EQU   *                        MOVE DATA TO OPTION TABLE  0728 49100020
IEDQMEM2 MVC   0(0,RLCB),0(R11)         MOVE DATA TO INV. LIST          49200020
QME2MOVE MVC   0(0,R1),0(R11)           MOVE DATA TO TERM ENTRY@OZ26495 49210082
ADD3     DC    F'3'                     CONSTANT               @OZ26495 49220082
TRMBCKUP DC    AL2(IEDQTRM-IEDNTRM)     LENGTH OF 3705 PREFIX    S22024 49250022
AMIDCNST DC    C'43'                    ID FOR THIS EXECUTOR   @G36XRCU 49270000
QME42    DC    C'42'                    ID FOR UNRECOV. ERROR  @G36XRCU 49280000
QME44    DC    C'44'                    ID OF NEXT LOAD        @G36XRCU 49290000
QME0S    DC    CL2'0S'                  LAST ID IN WTG TABLE            49300020
QMEONE   DC    X'1'                     USED TO INITIALIZE RCD NO.      49310022
ZERO     EQU   0                        OFFSET                 @G36XRCU 49315000
ONE      EQU   1                        BRANCH MASK         0208 S21101 49320000
FOUR     EQU   4                        OFFSET                 @G36XRCU 49330000
CONDZERO EQU   8                        BRANCH MASK         0208 S21101 49340000
HIGH     EQU   2                        BRANCH MASK         0208 S21101 49360000
NOTZERO  EQU   7                        BRANCH MASK         0208 S21101 49380000
NOTONES  EQU   14                       BRANCH MASK             SA53610 49390022
Q870     EQU   20                       Q8 BRANCH TABLE OFFSET   A47151 49400022
Q8BASEOF EQU   8                        OFFSET TO 19Q8'S BASE  @XA05305 49403056
Q8INVCHK EQU   16                       19Q8 BRANCH TABLE OFFSE@XA05305 49406056
         SPACE                                                          49410022
INVENTS  EQU   0                        OFFSET TO NO. OF ENTRIES A47151 49420022
INVELEN  EQU   2                        OFFSET TO ENTRY LENGTH   A47151 49430022
INVSTAT  EQU   3                        OFFSET TO LIST STATUS    A47151 49440022
INVCPUID EQU   4                        OFFSET TO CPUID ADDRESS  A47151 49450022
INVCNTRL EQU   9                        LENGTH OF CONTROL AREA   A47151 49460022
INVIDLEN EQU   4                        LENGTH OF CPUID ADDRESS  A47151 49470022
X80      EQU   X'80'                    FLAG FOR BUFSIZE       @OZ26495 49471082
X60      EQU   X'60'                    FLAG FOR DIAL OR ADDR  @OZ26495 49472082
X40      EQU   X'40'                    FLAG FOR DIAL DIGITS   @OZ26495 49473082
X20      EQU   X'20'                    FLAG FOR ADDR CHAR     @OZ26495 49474082
EOTBIT   EQU   X'80'                    EOT-FE (BSC) IN INVLIST SA57661 49475022
GOODRTN  EQU   4                        GOOD RETURN OFFSET      SA51078 49476022
R14OFF   EQU   56                       REG 14 OFFSET IN SA     SA51078 49477022
R11OFF   EQU   44                       REG 11 OFFSET          @OZ26495 49477582
EPMODE   EQU   X'01'                    EP MODE SWITCH           Y06328 49478005
RLD      EQU   22                       OFFSET TO RLD          @XA05305 49478556
RECLNG   EQU   25                       OFFSET TO RECORD LENGTH@XA05305 49479056
TWO       EQU   2                   CONSTANT                   @XA05305 49479556
ZAPAREA  DC    50H'0'                   PATCH AREA             @Y17XACT 49479700
         EJECT                                                 @Y17XACL 50900000
         TAVTD                                                          51300020
         EJECT                                                 @Y17XACL 51350000
         TCKPD 3330                     MERLIN VERSION      0503 S21101 51400000
         EJECT                                                 @Y17XACL 51450000
         DCBD  DSORG=TX                                                 51500020
         TQCBD                                                          51600020
         TTNTD                                                          51700020
         TTRMD                                                          51800020
         TLCBD                                                          51900020
         EJECT                                                          51910000
FORCORE  DSECT                                                 @G36XRCU 51920000
         IECDSECT                                              @G36XRCU 51930000
         EJECT                                                 @Y17XACL 51950000
*DSECT FOR DEB                                                          52000020
         SPACE                                                          52100020
IEDQDEB  DSECT                                                          52200020
DEBNMEXT DS    X                        NO OF EXTENTS IN DATA SET       52300020
         ORG   IEDQDEB+16               SET TO NO. OF EXTENTS FLDS21903 52400022
         ORG   IEDQDEB+25               SET TO ADDR FIELD        S21903 52500022
DEBDCBAD DS    AL3                      ADDR OF DCB                     52600020
         SPACE                                                          52700020
         ORG   IEDQDEB+32               SET TO DEV. DEPENDENT FLDS21903 52800022
DEBDVMOD DS    XL1                      DEVICE MODIFIER                 52900020
DEBUCBAD DS    XL3                      ADDRESS OF UCB                  53000020
DEBBINUM DS    XL2                      BIN NO                          53100020
DEBSTRCC DS    XL2                      CYLINDER ADDR FOR START         53200020
DEBSTRHH DS    XL2                      TRACK ADDR FOR START OF EXT     53300020
DEBENDCC DS    XL2                      CYLINDER ADDR FOR EXTNT END     53400020
DEBENDHH DS    XL2                      TRACK ADDR FOR EXTENT END       53500020
DEBNMTRK DS    XL2                      NO TRACKS IN THIS EXTENT        53600020
DEBEND   EQU   *                                                 S21903 53700022
DEBSEGLN EQU   DEBEND-DEBDVMOD          LNGTH OF SEG FOE EACH EXTNT     53800020
         END                                                            53900020
