1944     TITLE 'IGG01944-RESTART FROM INCIDENT AND CKREQ RECORDS'       00100020
IGG01944 CSECT                                                        * 00120000
* CHANGE ACTIVITY = AS FOLLOWS:                                       * 00140000
*A000000-999999                                                @Y16X5C0 00160000
*A244500,244700,305300-305600                                   SA51078 00200222
*A146840,146880,295000                                          SA59179 00200305
*C298000-299000                                                 SA59179 00200405
*C384000,387000-388000,390000-392000                           @SA67132 00230458
*A123000,244000,245200,393000,486000                           @SA67132 00260458
*D481000,487000-490000                                         @SA67132 00290458
*A123300                                                       @ZA06155 00290558
*A009000,040000,042000,078000,080000                           @Y17XAC2 00291500
*A093000,094000,103000                                         @Y17XAC2 00292500
*A121000-123000,121600,193600                                  @Y17XAC2 00293500
*C212000-214000                                                @Y17XAC2 00294500
*A214000,408000,409000,504000                                  @Y17XAC2 00295500
*A486016,505000                                                @G36XRCU 00295710
*C121400,346000                                                @G36XRCU 00295910
*D486024-486072,504827-504500                                  @G36XRCU 00296110
* PACKAGING ERROR                                              @OZ08378 00297110
*C355000-356000                                                @OZ18748 00298110
         SPACE 3                                                        00300020
*********************************************************************** 00400020
*                                                                     * 00500020
*MODULE-NAME=IGG01944  (TCAM,CHECKPOINT/RESTART)                      * 00510000
*                                                                     * 00520022
*DESCRIPTIVE-NAME=RESTART FROM INCIDENT AND CHECKREQ RECORDS          * 00530022
*                                                                     * 00540022
*COPYRIGHT='NONE'                                                     * 00550022
*                                                                     * 00700020
*STATUS: VERSION 10.0                                          @Y17XAC2 00800000
*                                                                     * 00900020
*FUNCTION: THIS MODULE SEARCHES THE TERMINAL NAME TABLE FOR LOCAL NCP * 01000000
*   ENTRIES.  WHEN ONE IS FOUND THE HIERARCHY BELOW IT IS CASCADED    * 01050000
*   CHECKING TRMRSACT AND SETTING TRMREMB FOR ACTIVATE.  IF A RESOURCE* 01100000
*   WAS ACTIVE (TRMRSACT= ON) THEN TRMREMB IS TURNED OFF.  THERE IS   * 01150000
*   NO CASCADING BELOW A BSC/SS LINE, A (TRMRSACT= OFF), AND A TTE    * 01200000
*   WITH AN INVALID TRMSUBST.                                         * 01250000
*   THIS MODULE READS THE INCIDENT AND CKREQ RECORDS AND USES THEM TO * 01300000
*   RECONSTRUCT THE MCP ENVIRONMENT.  THE TIME IN AN INCIDENT RECORD  * 01350000
*   IS COMPARED TO THE TIME IN THE ENVIRONMENT RECORD. IF THE INCIDENT* 01400000
*   RECORD IS MORE RECENT, IT IS USED TO UPDATE THE MCP TABLES. IF NOT* 01450000
*   ALL OTHER INCIDENT RECORDS ARE IGNORED. THE KEY FIELD IN AN INCI- * 01500000
*   DENT TELLS WHY THE CHECKPOINT WAS TAKEN AND WHICH TYPE OF         * 01550000
*   INFORMATION IS IN THE RECORD.  INCIDENT CHECKPOINTS ARE  TAKEN    * 01600000
*   AS THE RESULT OF CHECKPOINT(IN THE MH), TCHNG, ICHNG(IN AN APPLI- * 01700000
*   CATION PROGRAM) OR AN OPERATOR CONTROL COMMAND. CKREQ RECORDS DO  * 01800020
*   NOT INCLUDE THE TIME AT WHICH THEY WERE WRITTEN TO DISK. THEY ARE * 01900020
*   USED TO SYNCHRONIZE THE INFORMATION IN PROCESS-TYPE TERMINAL TABLE* 02000020
*   ENTRIES WITH AN OS CHECKPOINT TAKEN IN AN APPLICATION PROGRAM.    * 02100020
*   THE INTRO OPERAND 'CKREQS' INDICATES THE NUMBER OF CKREQ RECORS ON* 02200020
*   DISK (A CONSTANT VALUE IS ADDED TO ALLOW FOR DISK ERRORS). ALL    * 02300020
*   CKREQ RECORDS ARE READ OFF THE DISK. EACH TTR AND TERMNAME TABLE  * 02400020
*   OFFSET IS MOVED INTO THE CKREQ-TTR TABLE LOCATED IN THE CHECK-    * 02500020
*   POINT WORK AREA.(A CKREQ RECORD IS ASSOCIATED WITH A PARTICULAR   * 02600020
*   PROCESS ENTRY AS LONG AS THE ENTRY IS ACTIVE.) IF THE OFFSET IN A * 02700020
*   CKREQ RECORD IS ZERO,THE RECORD HAS NOT BEEN USED. IF IT IS NOT   * 02800020
*   ZERO,THE INFORMATION IS USED TO UPDATE THE MCP TABLES PERTAINING  * 02900020
*   TO THE PROCESS ENTRY.  START LINE AND STOP LINE OPERATOR          * 03000022
*   CONTROL COMMANDS OR APPLICATION PROGRAM MACRO'S FOR WHICH         * 03020022
*   INCIDENT RECORDS WERE RECORDED, ARE PROCESSED BY THIS MODULE.     * 03040022
*   ALL OTHER OPERATOR CONTROL INCIDENT RECORDS ARE PROCESSED         * 03060022
*   BY READY (IEDQND).  WHEN ALL RECORDS ARE READ, A FREEMAIN IS      * 03080022
*   ISSUED FOR THE AREA INTO WHICH THE RECORDS WERE READ. JUST BEFORE * 03100020
*   THIS MODULE EXITS,IT DETERMINES IF THE LAST LOAD MODULE IS NEEDED * 03200020
*   (TO SCAN THE MESSAGE QUEUES). IN ORDER FOR THE MODULE TO BE GIVEN * 03300020
*   CONTROL,                                                          * 03400020
*   THE LAST MCP CLOSEDOWN WAS ABNORMAL,AND DISK=YES WAS SPECIFIED ON * 03500020
*   INTRO. IF A DISK ERROR IS ENCOUNTERED,A WTO ERROR MESSAGE IS      * 03600020
*   ISSUED AND THE RECORD IS IGNORED.                                 * 03700020
*                                                                     * 03750022
*ENTRY POINT:                                                         * 03800020
*                                                                     * 03900020
*        IGG01944                                                     * 04000020
*                 PURPOSE SEE FUNCTION LINKAGE - VIA XCTL      @Y17XAC2 04050000
*                                                                     * 04100020
*INPUT:REGISTER 2 CONTAINS THE ADDRESS OF THE CHECKPOINT WORK AREA.   * 04200020
*      REGISTER 7 CURRENT ENTRY IN DCB PARAMETER LIST          @Y17XAC2 04250000
*                                                                     * 04300020
*   CHECKPOINT DATA SET                                               * 04400020
*                                                                     * 04500020
*OUTPUT:REGISTER 2 IS NOT CHANGED.                                    * 04600020
*                                                                     * 04700020
*   THE CHECKPOINT DATA SET IS NOT CHANGED.                           * 04800020
*                                                                     * 04900020
*   THE MCP TABLES ARE UPDATED TO THE TIME OF THE LAST CHECKPOINT.    * 05000020
*                                                                     * 05100020
*EXTERNAL ROUTINES:                                                   * 05200020
*                                                                     * 05300020
*        IECPCNVT-CONVERTS RELATIVE TRACK ADDRESS TO ABSOLUTE ADDRESS.* 05400020
*        SVC 7 (XCTL)                                                 * 05500022
*        SVC 35 (WTO)                                                 * 05600022
*                                                                     * 05700020
*EXITS-NORMAL:THIS MODULE XCTLS TO THE NEXT OPEN MODULE IN THE WHER-  * 05800020
*   TO-GO TABLE.                                                      * 05900020
*                                                                     * 06000020
*EXITS-ERROR:N/A                                                      * 06100020
*                                                                     * 06200020
*TABLES/WORK AREAS:                                                   * 06300020
*                                                                     * 06400020
*   AVT(AVTBIT1,AVTBIT3,AVTCKPTB,AVTCLRHI,AVTDISKN,AVTNCKPR,AVTOPTPT, * 06500020
*       AVTRNMPT)                                                     * 06600020
*   CHECKPOINT WORK AREA                                              * 06700020
*   QCB                                                               * 06800020
*   DCB                                                               * 06900020
*   TERMINAL TABLE                                                    * 07000020
*   INVITATION LIST                                                   * 07100020
*   OPTION TABLE                                                      * 07300020
*   CVT                                                               * 07400020
*                                                                     * 07500020
*                                                                     * 07600020
*                                                                     * 07700020
*ATTRIBUTES:REENTERABLE                                               * 07800020
*                                                                     * 07900020
*NOTES: RESTRICTIONS -- NAME                                   @Y17XAC2 08000000
*       REGISTER CONVENTIONS -- STANDARD CHECKPOINT CONVETIONS @Y17XAC2 08010000
*       PATCH LABEL -- ZAPAREA                                 @Y17XAC2 08020000
*       MODULE TYPE -- PROCEDURE PROCESSER ASSEMBLER XF        @Y17XAC2 08030000
*       MDOULE SIZE -- MAXIMUM 2K                              @Y17XAC2 08040000
*   THE OPERATION OF THIS MDOULE DEPENDS UPON AN INTERNAL REPRE-      * 08050000
*   SENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT TO    * 08100020
*   THE ONE USED AT ASSEMBLY TIME. THE CODING HAS BEEN ARRANGED SO    * 08200020
*   THAT REDEFINITION OF 'CHARACTER' CONSTANTS,BY REASSEMBLY, WILL    * 08300020
*   RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.               * 08400020
*                                                                     * 08500020
*********************************************************************** 08600020
         SPACE 3                                                        08700020
*REGISTER ASSIGNMENTS                                                   08800020
         SPACE                                                          08900020
R0       EQU   0                        TTR OF RECORD BEING WRITTEN     09000020
R1       EQU   1                        ADDR-TERM ENTRY                 09100020
R2       EQU   2                        ADDR-CKPT WORK AREA             09200020
R3       EQU   3                        INDEX-OPT TBL                   09300020
R4       EQU   4                        INCREMENT-OPT TBL LOOP          09400020
RLVLTTE  EQU   4                                               @Y17XAC2 09450000
R5       EQU   5                        COMPARAND-OPTTBL LOOP           09500020
R6       EQU   6                        ADDR-OPT LENGTH TBL             09600020
R7       EQU   7                        ADDR-QCB,OPTION TBL             09700020
RQCB     EQU   7                        BASE FOR QCB                    09800020
R8       EQU   8                        NO.CKREQ RECORDS ON A TRACK     09900020
RTERM    EQU   8                        BASE FOR TERM ENTRY             10000020
RAVT     EQU   9                        ADDR-AVT                        10100020
R10      EQU   10                       INDEX-NO.CKREQ RECORDS          10200020
RDCB     EQU   10                       BASE FOR DCB                    10300020
REGTABLT EQU   10                                              @Y17XAC2 10350000
R11      EQU   11                       ADDR-DISK RECORD                10400020
R12      EQU   12                       BASE REG                        10500020
R13      EQU   13                       OFFSET TO OPT ENTRY             10600020
*                                       BRANCH REG                      10700020
R14      EQU   14                       LENGTH -OPT ENTRY               10800020
R15      EQU   15                       ADDR-OPTION ENTRY               10900020
         SPACE 3                                                        11000020
         BALR  R12,0                    SET UP BASE REG                 11100020
         USING *,R12                                                    11200020
IGG01944 IEDHJN QMG00                                            S99240 11300022
         SPACE                                                          11800020
         USING IEDNTRM,RTERM            BASE FOR TERMNAME TABLE@Y17XAC2 11850000
         USING IEDQAVTD,RAVT            BASE FOR AVT                    11900020
         USING IEDQCKPD,R2              BASE FOR CKPT WORK AREA         12000020
         USING IEDQCDRD,R11             BASE FOR DISK RECORD            12100020
         USING IHADCB,RDCB                                       S22024 12120022
         USING FORCORE,R4               OPEN WORK AREA DSECT   @G36XRCU 12124010
         L     R4,FOUR(R8)              ADDR OF OPEN WORK AREA @G36XRCU 12128010
         L     RDCB,DXUDCBAD            CURRENT DCB ADDRESS    @G36XRCU 12132010
         DROP  R4                                              @G36XRCU 12136010
         L     R2,DCBIOBAD              GET CURRENT WORKAREA ADDRS22024 12160022
         LM    R14,R11,CKPSAVE1+12      LOAD REGS BY CKPT OPEN @Y17XAC2X12161000
                                        MODULE                 @Y17XAC2 12161400
         TM    AVTSAVTF,AVTVTMCP        IF NOT IN 3705 ENVIRON @Y17XAC2 12161800
         BO    GETENTRY                 THEN DO NOT PROCESS AND@Y17XAC2 12162200
*                                       CONTINUE               @Y17XAC2 12162600
QMG0405  EQU   *                                               @Y17XAC2 12184000
         LM    R14,R11,CKPSAVE1+12      GET REGS INITIALIZED BY        X12200020
                                        FIRST CKPT OPEN MUDULE          12300020
         LA    R14,CKPINRNO             RECORDS ON FIRST TRK   @SA67132 12310058
         SR    R1,R1                    CLEAR FOR IC           @SA67132 12320058
         IC    R1,CKPINCNT              GET COUNT OF INCIDENTS @SA67132 12330058
         BCTR  R1,R0                    DECREMENT INCIDENT     @ZA06155 12333058
*                                        COUNT BY ONE          @ZA06155 12336058
         L     R15,CKPTTRIN-1           FIRST RECORD ADDRESS   @SA67132 12340058
         EJECT                                                 @Y17XAC2 12345000
FINDLAST EQU   *                                               @SA67132 12350058
         BAL   R13,QMG9905              GET NEXT RECORD ADDRESS@SA67132 12360058
         LR    R15,R0                   SAVE RECORD ADDRESS    @SA67132 12370058
         BCT   R1,FINDLAST              RELOOP                 @SA67132 12380058
         ST    R0,AVTPARM               SAVE LAST RECORD ADDR+1@SA67132 12390058
         SPACE 3                                                        12400020
*THE LATEST TOTAL ENVIRONMENT RECORD HAS BEEN USED TO UPDATE THE        12500020
*TAM TABLES. USE THE INCIDENT RECORDS TAKEN AFTER THE TOTAL TO          12600020
*UPDATE THE TABLES FURTHER.                                             12700020
         SPACE                                                          12800020
         L     R0,CKPTTRLI-1            TTR OF LAST  INCIDENT RCD  0818 13200020
         MVC   CKPTRKLN,CKPSECLI        DATA LENGTH PRECEDING      0416X13230000
                                        LAST INCIDENT RECORD       0416 13260000
         LA    R14,CKPIPERT             NO.INCIDNTS PER TOTAL TRK  0818 13300020
         CLC   CKPTTRIN(2),CKPTTRLI     CHECK FOR RCD ON 1ST TRK   0818 13400020
         BNE   QMG05                    BRANCH IF NOT ON 1ST TRK   0818 13500020
         LA    R14,CKPINRNO             COUNT OF INC-1ST TRK       0820 13600020
QMG05    EQU   *                                                   0818 13700020
         BAL   R13,QMG98                GET NEXT RECORD ON TRACK   0416 13760000
         ST    R0,CKPSAVE1+4            SAVE 1ST INC RCD PROCESSED 0925 13830020
         B     QMG15                    SKIP CHECK 1ST TIME AROUND 0928 13860020
QMG10    EQU   *                                                        13900020
         C     R0,CKPSAVE1+4            CHECK FOR 1ST INC-WRAPPED  0928 13920020
         BE    QMG45                    BRANCH IF WRAPPED TO BEGIN 0928 13940020
QMG15    EQU   *                                                   0928 13960020
         BAL   R13,QMG50                READ INCIDENT RECORD            14000020
         USING IEDQCDRD,R11                                             14100020
         CLC   CDRDATE(8),CKPDATIM      COMPARE TIME OF INC., TOTAL     14200020
         BNH   QMG45                    BRANCH IF INCIDENT NOT MORE    X14400020
                                        RECENT THAN TOTAL               14500020
         OI    CKPFLAGS,CKPOPCRD        INDICATE TO READY ROUTINE  0118X14520020
                                        THAT THERE IS INCIDENT RCD 0118 14540020
         TM    AVTBIT3,AVTSTAYN         CHECK FOR SCAN SPECIFIED   0118 14560020
         BO    QMG45                    BRANCH IF NO SCAN SPECIFIED0118 14580020
         CLI   CDRKEY,CDROPC            CHECK FOR OPERATOR CONTROL      14600020
         BE    QMG36                    BRANCH IF FROM OP CONTROL  1028 14610020
         EJECT                                                 @Y17XAC2 14630000
*UPDATE SEQUENCE NUMBERS FROM  CHECKPT AND TCHNG MACROS                 14640020
         SPACE                                                          14650020
         LH    R1,CDROFFS               GET TERM OFFSET FROM RCD   1028 14670020
         BAL   R13,QMG9205              GET TERM ENTRY ADDRESS     1028 14680020
         USING IEDQQCB,R7               BASE FOR QCB                    14682020
         L     R7,TRMDESTQ-1            ADDRESS OF QCB FOR TERM    0115 14684020
         TM    TRMSTATE,TRMLOG          PROCESS ENTRY           SA59179 14684105
         BM    QMG18                    YES,UPDATE FIELDS       SA59179 14684205
         TM    QCBDSFLG,QCBDISK         CHECK FOR DISKQUEUES       0115 14686020
         BZ    QMG20                    BRANCH IF CORE ONLY        0115 14688020
QMG18    EQU   *                                                SA59179 14688105
         MVC   TRMINSEQ(4),CDRSEQIN     UPDATE SEQUENCE NUMBERS    1028 14690020
QMG20    EQU   *                                                   1110 14700020
         B     QMG10                    READ NEXT INCIDENT RCD     1110 14730020
         SPACE 2                                               @Y17XAC2 14800000
*INCIDENT RECORD WAS THE RESULT OF AN OPERATOR CONTROL CMD. IF CMD IS   14900020
*IS START LINE OR STOP LINE SET UP FIELDS IN QCB FOR LINE OPEN TO       15000020
*RECOGNIZE INSTEAD OF LETTING OPERATOR CONTROL REPROCESS THE COMMAND629 15100020
         SPACE                                                          15200020
QMG36    EQU   *                                                   0629 15300020
         SR    R4,R4                    CLEAR                      0629 15600020
         CLI   CDROPCB+CKPOCODE,OCSTOPL STOP LINE COMMAND        S99240 15700022
         BE    QMG37                    YES, BRANCH              S99240 15730022
         CLI   CDROPCB+CKPOCODE,OCSTARTL START LINE COMMAND      S99240 15760022
         BE    QMG3605                  YES, BRANCH              S99240 15790022
         CLI   CDROPCB+CKPOCODE,OCVARY  VARY COMMAND             S99240 15820022
         BNE   QMG20                    NO, READ NEXT INCIDENT   S99240 15850022
         CLI   CDROPCB+CKPOCSWC,OCX11   VARY OFFTP COMMAND       S99240 15880022
         BE    QMG37                    YES, BRANCH              S99240 15910022
         CLI   CDROPCB+CKPOCSWC,OCX12   VARY OFFTP HALT COMMAND  S99240 15940022
         BE    QMG37                    YES, BRANCH              S99240 15970022
         CLI   CDROPCB+CKPOCSWC,OCX18   VARY ONTP COMMAND        S99240 16000022
         BNE   QMG20                    NO, READ NEXT INCIDENT   S99240 16030022
QMG3605  EQU   *                        START LINE COMMAND       S99240 16060022
         LA    R4,LCBRECVN              SET UP SWITCH FOR START LIN0629 16100020
QMG37    EQU   *                                                   0629 16200020
         SR    R5,R5                    CLEAR                      0716 16300020
         IC    R5,CDROPCB+CKPOCREL      GET BINARY RELATIVE LINE NO0716 16400020
         L     R15,AVTRNMPT             ADDR OF TERMNAME TABLE     0716 18100020
         USING IEDQTNTD,R15             BASE FOR TERMNAME TABLE    0716 18200020
         LH    R6,TNTLEN                NUMBER OF ENTRIES IN TABLE 0629 18300020
         EJECT                                                 @Y17XAC2 18400000
*BEGINNING OF LOOP THROUGH TERMNAME TABLE TO FIND ENTRIES FOR THIS 0629 18500020
*COMMAND                                                                18600020
         SPACE                                                          18700020
QMG38    EQU   *                                                   0629 18800020
         LR    R1,R6                    GET TERM OFFSET            0629 18900020
         BAL   R13,QMG9205              GET ADDR OF TERM ENTRY     0716 19000020
         TM    TRMSTATE,X'40'           CHECK FOR TLIST            0715 19200020
         BO    QMG39                    BRANCH IF TLIST-HAS NO DCB 0715 19300020
         TM    TRMDSORG,TRMLGB          IS THIS A GROUP ENTRY    S22024 19330022
         BO    QMG39                    YES, HAS NO QCB - SKIP ITS22024 19360022
         TM    TRMSTATE,TRMPROC         TEST FOR TRMPROC ON    @Y17XAC2 19365000
         BO    QMG3805                  IF ON BRANCH           @Y17XAC2 19370000
         TM    TRMSTATE,TRMPREF         TEST FOR TRMPREF ON    @Y17XAC2 19375000
         BNO   QMG3805                  IF OFF BRANCH          @Y17XAC2 19380000
         CLI   TRMTYPE,TRMSSCP          COMPARE FOR SSCP LINE  @Y17XAC2 19385000
         BE    QMG39                    IF YES BRANCH          @Y17XAC2 19390000
QMG3805  EQU   *                                               @Y17XAC2 19395000
         L     R7,TRMDESTQ-1            ADDR OF QCB                0629 19400020
         USING IEDQQCB,R7                                          0630 19500020
         L     R10,QCBDCBAD-1           ADDR OF QCBS DCB           0629 19600020
         CLC   DCBDDNAM,CDROPCB+CKPOCNAM CHECK DDNAME WITH COMMAND 0720 19800020
         BE    QMG40                    BRANCH IF EQUAL            0629 19900020
QMG39    EQU   *                                                   0629 20000020
         BCT   R6,QMG38                 SUB FROM COUNT OF ENTRIES  0629 20100020
         EJECT                                                 @Y17XAC2 20200000
*END OF LOOP THROUGH TERMNAME TABLE ENTRIES                        0629 20300020
         SPACE 3                                                        20400020
         B     QMG10                    GET NEXT INCIDENT RECORD   0629 20500020
QMG40    EQU   *                                                   0629 20600020
         LTR   R5,R5                    CHECK FOR RELATIVE LINE NO.0716 20700020
         BZ    QMG41                    BRANCH IF NONE             0629 20800020
         EX    R5,QMGCOMPR              CHECK LINE NO IN QCB WITH  0716X20900020
                                        LINE NO. IN COMMAND        0629 21000020
         BNE   QMG39                    BRANCH IF NOT EQUAL        0629 21100020
QMG41    EQU   *                                               @Y17XAC2 21200000
         TM    TRMSTATE,TRMPROC         TEST FOR TPROCESS      @Y17XAC2 21240000
         BO    QMG43                    YES,BRANCH OUT         @Y17XAC2 21280000
         TM    TRMSTATE,TRMPREF         TEST FOR TPREF ZERO    @Y17XAC2 21320000
         BZ    QMG43                    IF YES BRANCH          @Y17XAC2 21360000
         TM    TRMSTATE,TRMLINE         CHECK FOR LINE TTE     @Y17XAC2 21400000
         BO    QMG44                    IF NOT BRANCH TO GETOUT@Y17XAC2 21440000
         B     QMG39                    BRANCH TO LOOP THRU    @Y17XAC2 21480000
QMG43    EQU   *                                               @Y17XAC2 21520000
         STC   R4,QCBLINK                                      @Y17XAC2 21560000
         B     QMG39                    BRANCH                 @Y17XAC2 21600000
QMG44    EQU   *                                               @Y17XAC2 21640000
         LTR   R4,R4                    TEST FOR START LINE    @Y17XAC2 21680000
         BNZ   QMG4405                  IF NOT ZERO SET REMB ON@Y17XAC2 21720000
         NI    TRMBYTE2,X'FF'-(TRMREMB) TURN REMB OFF          @Y17XAC2 21760000
         B     QMG39                    BRANCH BACK            @Y17XAC2 21800000
QMG4405  EQU   *                                               @Y17XAC2 21840000
         OI    TRMBYTE2,TRMREMB         TURN REMB ON           @Y17XAC2 21880000
         B     QMG39                    BRANCH BACK            @Y17XAC2 21920000
         EJECT                                                 @Y17XAC2 21960000
*THE ENVIRONNENT AND INCIDENT CHECKPOINT RECORDS HAVE BEEN USED TO      22200020
*UPDATE THE TCAM TABLES. NOW READ THE CKREQ RECORDS(IF ANY) AND USE     22300020
*THEM. THESE RECORDS ARE USED REGARDLESS OF WHETHER THEY WERE TAKEN     22400020
*BEFORE OR AFTER THE ENVIRONMENT RECORD.                                22500020
         SPACE                                                          22600020
QMG45    EQU   *                                                        22700020
         SR    R10,R10                  CLEAR                           22900020
         IC    R10,CKPCKRQS             VALUE OF INTRO OP.-CKREQS       23000020
         LTR   R10,R10                  CHECK FOR ZERO                  23100020
         BZ    QMG80                    BRANCH IF NO CKREQ RECORDS      23200020
         LA    R10,CKPCKRNO(0,R10)      NO. EXTRA RECRDS                23300020
         L     R0,CKPTTRCR-1            GET TTR OF FIRST CKREQ          23400020
         LA    R14,CKPCRRNO             COUNT OF CKREQ RCDS-1ST TRK0824 23500020
         MVC   CKPCTTRC(4),CKPCTTRB     INITIALIZE CURRENT CKREQ-TT     23600020
         OI    CKPFLAGS,CKPOPNCR        TURN OF OPN CKREQ FLAG          23700020
         SPACE 3                                                        23800020
*BEGINNING OF LOOP THROUGH CKREQ RECORDS                                23900020
         SPACE                                                          24000020
*CONVERT RELATIVE TTR TO ABSOLUTE DISK ADDRESS AND READ THE RECORD      24100020
*(CKREQ OR INCIDENT)                                                    24200020
         SPACE                                                          24300020
QMG50    EQU   *                                                        24400020
         ST    R0,AVTDOUBL              SET UP TTR             @SA67132 24404058
         CLC   AVTDOUBL+1(3),AVTPARM+1  CHECK FOR LAST RECORD  @SA67132 24408058
         BNL   LASTREC                  LAST REC ALREADY READ  @SA67132 24412058
*                                        RESET TO FIRST RECORD @SA67132 24416058
         STM   R0,R15,CKPSAVE2          SAVE REGS                  0419 24420000
         L     R12,CKPSAVE1+8           GET ADDRESS OF IGG019Q8    0419 24440000
         OI    CKPFLAGS,CKPOPNIN        INDICATE FROM 1944      SA51078 24450022
         BAL   R14,28(R12)             BRANCH TO IGG019Q8-READ RCD 0419 24460000
         NI    CKPFLAGS,AVTEFF-CKPOPNIN RESET FLAG              SA51078 24470022
         LM    R0,R15,CKPSAVE2         RESTORE REGS                0419 24480000
         LTR   R15,R15                 CHECK FOR END OF DATA SET   0419 24500000
         BZ    QMG5106                 BRANCH IF NOT END           0504 24520000
LASTREC  EQU   *                                               @SA67132 24530058
         LA    R13,QMG10                SET RETURN ADDRESS         0419 24540000
         B     QMG9903                  START WITH 1ST INCIDENT RCD0419 24560000
QMG5106  EQU   *                                                   0419 24580000
         L     R11,CKPEXCP              GET ADDRESS OF RECORD           26700020
         TM    CKPECB,X'7F'             CHECK FOR DISK ERROR            26800020
         BNO   QMG90                    BRANCH IF ERROR                 26900020
QMG5107  EQU   *                                                   0416 26950000
         TM    CKPFLAGS,CKPOPNCR        CHECK RECORD TYPE               27000020
         BZ    QMG98                    BRANCH IF INCIDENT         0416 27100000
         EJECT                                                 @Y17XAC2 27200000
*FILL IN CKREQ-TTR TABLE IN CHECKPOINT WORK AREA                        27300020
         SPACE                                                          27400020
QMG52    EQU   *                                                        27500020
         L     R15,CKPCTTRC             GET CURRENT ENTRY ADDRESS       27600020
         MVC   CKPCTTTR(3,R15),CKPSAVE2+1 MOVE TTR TO TABLE        1111 27700020
         MVC   CKPCTOFF(2,R15),CDRCKOFF MOVE OFFSET FROM DISK RCD       27800020
         MVC   CKPCTSEC(2,R15),CKPTRKLN SAVE DATA ON TRACK         0416 27850000
         MVI   CKPCTFLG(R15),0          CLEAR FLAG TO ZERO              27900020
         LA    R15,CKPCTTRL(0,R15)      MOVE ADDR TO NEXT ENTRY         28000020
         ST    R15,CKPCTTRC             SAVE                            28100020
         SPACE                                                          28200020
         SPACE 3                                                        28500020
*DETERMINE TERMINAL TABLE ENTRY ADDRESS                                 28600020
         SPACE                                                          28700020
         LH    R1,CDRCKOFF              GET TERM OFFSET FROM CKREQ      28800020
         BAL   R13,QMG9205              GET TERMINAL ENTRY              28900020
         USING IEDNTRM,R8               BASE FOR TERM ENTRY        0818 29000000
         SPACE 3                                                        29100020
*UPDATE TERMINAL ENTRY AND QCB                                          29200020
         SPACE                                                          29300020
         L     R7,TRMDESTQ-1            ADDRESS OF QCB                  29400020
         USING IEDQQCB,R7                                               29500020
         TM    TRMSTATE,TRMLOG          PROCESS ENTRY           SA59179 29500105
         BM    QMG5205                  YES,UPDATE FIELDS       SA59179 29500205
         TM    QCBDSFLG,QCBDISK         CHECK FOR DISK QUEUES           29600020
         BZ    QMG55                    BRANCH IF CORE QUEUE ONLY       29700020
         MVC   QCBMSGCT(CKPMCTLN),CDRCKMSG MESSAGE COUNT        SA59179 29800005
QMG5205  EQU   *                                                SA59179 29800105
         MVC   TRMINSEQ(CKPSEQLN),CDRCKIN  SEQUENCE NUMBERS     SA59179 29800205
         SPACE 3                                                        30000020
*BEGINNING OF LOOP THROUGH PRIORITY LEVEL QCBS                          30100020
         SPACE                                                          30200020
         MVC   QCBQBACK(CKPQBKLN),CDRCKQBC UPDATE QBACK PTR             30300020
QMG53    EQU   *                                                        30400020
         MVC   QCBDNHDR(CKPQCBLN),CDRCKQCB  UPDATE PRIORITY QCB PTR     30500020
         MVC   QCBPQBCK(CKPQBKLN),CDRCKPQB                      SA51078 30530022
*                                       UPDATE PRILEVEL QBACK   SA51078 30560022
         CLI   QCBPRIPQ,0               CHECK FOR LAST PRIORITY QCB     30600020
         BE    QMG55                    BRANCH IF LAST                  30700020
         LA    R7,QCBPSIZE(,R7)         ADD LENGTH OF PRIORITY QCB      30800020
         LA    R11,CKPQCBLN(,R11)       ADDLEN TO RCD POSITION          30900020
         B     QMG53                    LOOP                            31000020
         SPACE                                                          31100020
*END OF LOOP THROUGH PRIORITY LEVEL QCBS                                31200020
         EJECT                                                 @Y17XAC2 31300000
QMG55    EQU   *                                                        31400020
         TM    TRMSTATE,TRMOPTFN        CHECK FOR OPTION FIELDS         31500020
         BZ    QMG65                    BRANCH IF OPTIONS NOT USED      31600020
         LA    R11,CDRCKOPT             ADDRESS OF OPTION FIELD         31700020
         BAL   R13,QMG93                UPDATE OPTIONS FIELDS           31800020
QMG65    EQU   *                                                        31900020
         LH    R15,CKPCKRLN             LENGTH OF CKREQ RECORD     0416 31950000
         BAL   R13,QMG99                GET TTR OF NEXT CKREQ RECORD    32000020
         BCT   R10,QMG50                BRANCH IF NOT END OF CKREQ     X32100020
                                        RECORDS                         32200020
         SPACE 3                                                        32400020
*END OF LOOP THROUGH CKREQ RECORDS                                      32500020
         SPACE 3                                                        32600020
*FREE UP THE AREA USED FOR CHECKPOINT RECORDS TO BE READ INTO.          32700020
         SPACE                                                          32800020
QMG80    EQU   *                                                        32900020
         LM    R14,R11,CKPSAVE1+12      RESTORE REGS                    33800020
         MVC   0(AL2,R8),QMG45ID        ID FOR NEXT LOAD       @G36XRCU 34200010
         SPACE 3                                                        34800020
*SET UP WHERE-TO-GO TABLE TO XCTL TO NEXT OPEN MODULE                   34900020
         SPACE                                                          35000020
QMG83    EQU   *                                                        35400020
         TM    CKPFLAGS,CKPNORML        CHECK FOR COMPLETION TYPE  0416 35420000
         BZ    QMG84                    BRANCH IF ABNORMAL COMPLETN0416 35440000
         OI    AVTCKELF,AVTWARMN        INDICATE TYPE OF RESTART   0419 35460000
QMG84    EQU   *                                                   0416 35480000
         NI    CKPFLAGS,X'FF'-CKPOPNCR  CLEAR CKREQ FLAG       @OZ18748 35500010
         LA    R8,8(0,R8)               GET NEXT WTG ENTRY              35700020
         LA    R7,4(0,R7)               GET NEXT DCB LIST ENTRY         35800020
         CLC   0(2,R8),QMGXX            CHECK FOR SAME ENTRY REPETD     35900020
         BE    QMG00                    YES, RETURN TO PROCESS ITS22024 36000022
         CLC   0(2,R8),QMG0S            CHECK FOR END OF TABLE          36100020
         BNE   QMG83                    BRANCH IF NOT END               36200020
         LR    R7,R5                    RESET PARM LIST ADDR            36300020
         LA    R8,32(0,R6)              RESET WTG TABLE POINTER         36400020
QMG85    EQU   *                                                        36500020
         CLI   0(R8),0                  CHECK FOR ZEROED ENTRY          36600020
         BNE   QMG87                    BRANCH NOT ZERO                 36700020
         LA    R8,8(0,R8)               GET NEXT WTG ENTRY              36800020
         LA    R7,4(0,R7)               GET NEXT DCB                    36900020
         B     QMG85                    RELOOP                   S99240 37000022
         EJECT                                                 @Y17XAC2 37100000
*SUBROUTINE TO GET TERMINAL TABLE ENTRY ADDRESS                         39900020
         SPACE                                                          40000020
QMG9205  EQU   *                                                        40300020
         L     R15,AVTRNMPT                                             40400020
         STM   R14,R1,CKPSAVE2          SAVE REGS                       40500020
         N     R1,AVTCLRHI              CLEAR HIGH ORDER HALF WORD      40600020
         BZ    QMG65                    BRANCH IF NO TERM OFFSET   0928 40650020
         BALR  R14,R15                  GET TERM ENTRY                  40700020
         LR    RTERM,R1                 BASE FOR TERM ENTRY             40900020
         SH    RTERM,TRMBCKUP           BACKUP POINTER         @Y17XAC2 40950000
         LM    R14,R1,CKPSAVE2          RESTORE REGS                    41000020
         BR    R13                      RETURN                          41100020
         SPACE                                                          41200020
*END OF SUBROUTINE                                                      41300020
         SPACE 3                                                        41400020
*UPDATE OPTION FIELDS FOR THIS TERMINAL ENTRY.(REGISTERS BEING USED     41500020
*AT THIS TIME ARE 0,2,8,9,11,12,14THIS OPTION TABLE SUBROUTINE USES     41600020
*1,3,4,5,6,7,10,13,15).                                                 41700020
QMG93    EQU   *                                                        41900020
         SR    R6,R6                    INITIALIZE INDEX REG            42000020
         SR    R7,R7                                                    42100020
         IC    R7,TRMOPNO               COMPARAND-NO. OPTIONENTRIES     42200020
         L     R5,AVTOPTPT              ADDR OF OPTION TABLE            42300020
         L     R4,4(0,R5)               ADDR OF OPTION LENGTH TABLE     42400020
         LH    R1,TRMOPTBL              OFFST TO OPT FOR THIS ENTRY     42500020
         N     R1,AVTCLRHI              CLEAR HIGH ORDER HALF WORD      42600020
         AR    R5,R1                    ADD OFFST TO OPT TABLE ADDR     42700020
         SR    R1,R1                    CLEAR                           42800020
         SR    R3,R3                    CLEAR LENGTH FOR MOVE           42900020
         EJECT                                                 @Y17XAC2 43000000
*BEGINNING OF LOOP THROUGH OPTION TABLE OFFSETS FOR THIS TERMINAL       43100020
         SPACE                                                          43200020
QMG94    EQU   *                                                        43300020
         LR    R15,R5                   INITIALIZE BEG OPTN ENTRIES     43400020
         IC    R1,TRMOPT(R6)            OPTION OFFSET                   43500020
         CH    R1,QMGNOPT               CHECK FOR UNUSED FIELD          43600020
         BE    QMG95                    BRANCH IF UNUSED                43700020
         AR    R15,R1                   ADDR OF OPTION ENTRY            43800020
         IC    R3,0(R4)                 GET LNGTH OF THIS OPT ENTRY    X43900020
                                        (1 HAS ALREADY BEEN SUB-       X44000020
                                        TRACTED FOR EXECUTE)            44100020
         CLI   1(R4),X'D0'              CHECK  OPTION TYPE         1110 44110020
         BH    QMG9405                  BRANCH IF NOT ADDRESS TYPE 1110 44120020
         CLI   1(R4),X'80'              CHECK OPTION TYPE          1110 44130020
         BH    QMG95                    BRANCH IF ADDRESS TYPE     1110 44140020
QMG9405  EQU   *                                                   1110 44150020
         EX    R3,QMGMOVE1              MOVE OPTIONS TO OPTION TABL     44200020
         LA    R11,1(R3,R11)            ADD LENGTH MOVED TO BASE OF    X44300020
                                        DISK RECORD                     44400020
QMG95    EQU   *                                                        44500020
         LA    R4,CKPOPLTL(0,R4)        MOVE TO NEXT OPTION LENGTH     X44600020
                                        TABLE ENTRY                     44700020
         LA    R6,1(,R6)                ADD 1 TO INDEX                  44800020
         BCT   R7,QMG94                 SUB 1 FROM NO. OF ENTRIES       44900020
         SPACE                                                          45000020
*END OF LOOP THROUGH OPTION TABLE OFFSETS                               45100020
         SPACE 5                                               @Y17XAC2 45200000
         BR    R13                      RETURN  FROM SUBROUTINE         45300020
         SPACE                                                          45400020
*END OF SUBROUTINE                                                      45500020
         EJECT                                                 @Y17XAC2 45600000
*DETERMINE RELATIVE TTR OF NEXT CKREQ OR INCIDENT RECORD                45700020
         SPACE                                                          45800020
QMG98    EQU   *                                                   0416 45830000
         LH    R15,CKPINCLN             LENGTH OF INCIDENT RECORD  0416 45860000
QMG99    EQU   *                                                        45900020
         AH    R15,CKPTRKLN             ADD LENGTH OF RCD JUST READ0416 45930000
         STH   R15,CKPTRKLN             RESTORE TRACK DATA LENGTH  0416 45960000
         LR    R15,R0                                                   46000020
         LA    R15,0(,R15)              CLEAR HIGH ORDER BYTE      0820 46100020
         LTR   R15,R15                  CHECK FOR 1ST RCD          0820 46200020
         BNZ   QMG9905                  BRANCH IF NOT 1ST RCD      0822 46300020
QMG9903  EQU   *                                                   0416 46330000
         MVC   CKPTRKLN,CKPSECIN        DATA PRECEDING 1ST INCIDNT 0416 46360000
         L     R0,CKPTTRIN-1            GET TTR OF 1ST INCIDNT RCD 0822 46400020
         LA    R14,CKPINRNO             COUNT OF RCDS ON 1ST TRK   0822 46500020
         BR    R13                      RETURN                     0822 46600020
QMG9905  EQU   *                                                   0822 46700020
         LA    R0,1(0,R15)              GET NEXT RCD ON TRACK           46800020
         EX    R15,QMGCOMP2             CHECK FOR END OF TRACK     0820 46900020
         BCR   7,R13                    BRANCH IF NOT END OF TRACK 0820 47000020
         XC    CKPTRKLN,CKPTRKLN        INITIALIZE DATA LENGTH     0416 47050000
         LA    R0,CKP101(0,R15)         GET NEXT TRACK                  47100020
         IC    R0,QMGONE                INITIALIZE TO 1ST RECORD        47200020
         LA    R14,CKPIPERT             COUNT OF INC RCDS ON TRACK 0820 47300020
         TM    CKPFLAGS,CKPOPNCR        TEST FOR CKREQ RECORD           47400020
         BCR   8,R13                    BRANCH IF INCIDENT              47500020
         LA    R14,CKPCPERT             COUNT OF CKREQ RCDS-FULL TK0824 47600020
         BR    R13                      RETURN FROM SUBROUTINE          47700020
         DROP  R15                      DROP SO R6 MAY BE USED @Y17XAC2 47750000
         SPACE 3                                                        47800020
QMGNOPT  DC    H'255'                   UNUSED OPTION FIELD INDICA      47900020
QMGMOVE1 MVC   0(0,R15),0(R11)          MOVE OPTION FIELDS              48000020
QMGCOMPR CLI   QCBRELLN,0               CHECK RELATIVE LINE NO.    0629 48200020
QMGCOMP2 CLI   0(R14),0                 USED TO CHECK FOR END OF TK0820 48300020
QMGONE   DC    X'1'                     USED TO INITIALIZE TO 1ST      X48400020
                                        RECORD ON TRACK                 48500020
QMG0S    DC    CL2'0S'                  ID AT END OF WTG TABLE          48600020
IEDNMG   DC    CL8'IEDNMG'              MESSAGE MODULE NAME  * @SA67132 48600400
DSKCKREQ EQU   32                       OFFSET TO ERR MESSAGE* @SA67132 48600800
DSKINCID EQU   36                       OFFSET TO ERR MESSAGE* @SA67132 48601200
QMGXX    DC    CL2'44'                  ID OF THIS LOAD      *   S99240 48601600
QMG45ID  DC    CL2'45'                  ID FOR NEXT LOAD       @G36XRCU 48601710
FOUR     EQU   4                        OFFSET                 @G36XRCU 48601810
         EJECT                                               * @Y17XAC2 48602000
************************************************************** @Y17XAC2 48608000
*                                                            * @Y17XAC2 48608400
*        DEFINITELY IN 3705 ENVIRONMENT, NOW GET FIRST TNT   * @Y17XAC2 48608800
*        ENTRY AND THEN START TEST FOR SUBORDINATE RESOURCES.* @Y17XAC2 48609200
*        IF SO THEN BRANCH AND PROCESS THESE RESOURCES.      * @Y17XAC2 48609600
*                                                            * @Y17XAC2 48610000
************************************************************** @Y17XAC2 48610400
         CNOP  0,4                                           * @G36XRCU 48610810
GETENTRY EQU   *                                             * @Y17XAC2 48611200
         L     R6,AVTRNMPT              GET ADDRESS OF AVTRNMPT@Y17XAC2 48611600
         USING IEDQTNTD,R6                                     @Y17XAC2 48612000
         LH    R5,TNTLEN                LOAD NO. OF ENTRIES    @Y17XAC2 48612400
         N     R5,AVTCLRHI              CLEAR HI TWO BYTES     @Y17XAC2 48612800
         SR    R7,R7                    CLEAR REG7             @Y17XAC2 48613200
         IC    R7,TNTENLEN              GET LENGTH OF NAME     @Y17XAC2 48613600
         LA    R6,TNTFIRST              GET ADDR OF FIRST ENTRY@Y17XAC2 48614000
         AR    R6,R7                    PUT POINTER INREG6     @Y17XAC2 48614400
         LA    R7,3(R7)                 BUMP R7 BY LEN OF      @Y17XAC2X48614800
                                        ADDR PORTION OF TNT ENT@Y17XAC2 48615200
         ICM   RTERM,7,0(R6)            GET FIRST TNT ENTRY    @Y17XAC2 48615600
         SH    RTERM,TRMBCKUP           SUBTRACT FOR NEG PRFX  @Y17XAC2 48616000
TESTSUB  EQU   *                                               @Y17XAC2 48616400
         TM    TRMSTATE,TRMPROC         TEST FOR TPROCESS      @Y17XAC2 48616800
         BO    NEXTTTE                  YES, GET NEXT ENTRY    @Y17XAC2 48617200
         TM    TRMSTATE,TRMPREF         TEST, IF 3705 RESRC    @Y17XAC2 48617600
         BNO   NEXTTTE                  IF NO BRANCH           @Y17XAC2 48618000
         CLI   TRMTYPE,TRMLNCP          COMPARE FOR LNCP       @Y17XAC2 48618400
         BE    TESTACT                  IF YES BRANCH          @Y17XAC2 48618800
         SPACE 5                                               @Y17XAC2 48619200
NEXTTTE  EQU   *                                               @Y17XAC2 48619600
         AR    R6,R7                    ADD TNT ENLEN TO REG6  @Y17XAC2 50401000
         ICM   RTERM,7,0(R6)            GETS NEXT TTE ENTRY    @Y17XAC2 50401500
         SH    RTERM,TRMBCKUP           GETS TO NEG PREFIX     @Y17XAC2 50402000
         BCT   R5,TESTSUB               IF MORE ENTRIES BRANCH @Y17XAC2 50402500
         B     QMG0405                                         @Y17XAC2 50403000
         EJECT                                                 @Y17XAC2 50403500
*XCTL TO NEXT MODULE                                                    50404000
QMG87    EQU   *                                                        50404500
         LA    R15,CKPGETML             PARM LIST FOR XCTL              50405000
         MVC   6(2,R6),0(R8)            MOVE MODULE ID TO BLDL LIST     50405500
         XCTL  DE=(R6),SF=(E,(15))                                      50406500
         SPACE 3                                                        50407000
*DISK ERROR                                                             50407500
         SPACE                                                          50408000
QMG90    EQU   *                                                        50408500
         LR    R3,R0                    SAVE TTR                        50409000
         LA    R15,DSKINCID             GET OFFSET OF ERR MSG  @SA67132 50409500
         TM    CKPFLAGS,CKPOPNCR        CHECK FOR CKREQ RCD             50410000
         BZ    QMG91                    BRANCHIF INCIDENT               50410500
         XC    CDRCKOFF,CDRCKOFF        CLEAR TERM OFFSET          0416 50411000
         LA    R15,DSKCKREQ             GET OFFSET OF ERR MSG  @SA67132 50411500
QMG91    EQU   *                                                        50412000
         MVC   AVTSAVE4(8),IEDNMG       MOVE MSG MODULE NAME   @SA67132 50412500
         LOAD  EPLOC=AVTSAVE4                                  @SA67132 50413000
         ALR   R15,R0                   GET ADDR OF PTR TO MSG @SA67132 50413500
         L     R1,0(R15)                GET ADDR OF MESSAGE    @SA67132 50414000
         WTO   MF=(E,(1))                                               50414500
         DELETE EPLOC=AVTSAVE4          DELETE MSG MODULE      @SA67132 50415000
         LR    R0,R3                    RESTORE TTR                     50415500
         B     QMG5107                  GET NEXT RECORD            0416 50416000
         EJECT                                                 @Y17XAC2 50416500
************************************************************** @Y17XAC2 50416700
*                                                            * @Y17XAC2 50417000
*        EXAMINE'S THE LOCAL NCP'S TTE, IF IT IS NOT         * @Y17XAC2 50417200
*        ACTIVE, RESET REMEMBER BIT AND RETURN.  IF IT IS    * @Y17XAC2 50417500
*        ACTIVE, RESET ACTIVE BIT, SET REMEMBER BIT, AND PRO-* @Y17XAC2 50418000
*        CESS ANY REMAINING SUBORDINATE RESOURCES.           * @Y17XAC2 50418200
*                                                            * @Y17XAC2 50418500
************************************************************** @Y17XAC2 50418700
         SPACE 2                                               @Y17XAC2 50419000
TESTACT  EQU   *                                               @Y17XAC2 50419500
         LA    R11,AVTDOUBL             LOAD REG11 ADDR CKPDOUB@Y17XAC2 50419700
         USING SWITCH,R11               LOCAL DSECT            @Y17XAC2 50420000
         LR    RLVLTTE,RTERM            LVLTTE GETS LNCP ADDR  @Y17XAC2 50420200
         TM    TRMBYTE2,TRMRSACT        TEST FOR TRMRSACT ON   @Y17XAC2 50420500
         BO    VALIDSUB                 YES, BRANCH            @Y17XAC2 50421000
         B     NEXTTTE                  GET NEXT ENTRY         @Y17XAC2 50421500
         SPACE 2                                               @Y17XAC2 50421600
VALIDSUB EQU   *                                               @Y17XAC2 50421700
         OI    TRMBYTE2,TRMREMB         TURN TRMREMB ON        @Y17XAC2 50422000
         NI    TRMBYTE2,X'FF'-TRMRSACT  TURN TRMRSACT OFF      @Y17XAC2 50422400
         ICM   R1,3,TRMSUBST            LOAD REG1 WITH TRMSUBST@Y17XAC2 50422800
         BZ    NEXTTTE                  IF NOT VALID SUBST, BR @Y17XAC2 50423200
         L     R15,AVTRNMPT             LOAD SUBROUT ADDR      @Y17XAC2 50423600
         BALR  R14,R15                  BRANCH TO SUBROUT      @Y17XAC2 50424000
         SH    R1,TRMBCKUP              GET PTR TO NEG PREFIX  @Y17XAC2 50424400
         LR    RTERM,R1                 PUT RETURN ADDR IN NXT @Y17XAC2 50424800
         EJECT                                                 @Y17XAC2 50425200
************************************************************** @Y17XAC2 50425600
*                                                            * @Y17XAC2 50426000
*        IF THE SUBORDINATE RESOURCE IS ACTIVE, RESET ITS    * @Y17XAC2 50426200
*        ACTIVE BIT, AND TURN ITS REMEMBER BIT ON, AND PRO-  * @Y17XAC2 50426500
*        CESS ITS SUBORDINATE.  NO SUBORDINATE RESOURCES ARE * @Y17XAC2 50426600
*        PROCESSED FOR BSC/START STOP LINES.  IF SUBORDINATE * @Y17XAC2 50426700
*        RESOURCE IS NOT VALID, THEN CONTINUE PROCESS WITH   * @Y17XAC2 50427000
*        THE COHORT RESOURCE.                                * @Y17XAC2 50427200
*                                                            * @Y17XAC2 50427500
************************************************************** @Y17XAC2 50427600
         SPACE 2                                               @Y17XAC2 50427700
         NI    CKPDOUBL,X'FF'-LOOPSW-DONESW TURN BOTH LOOPSW   @Y17XAC2X50428000
                                        AND DONESW OFF         @Y17XAC2 50428200
FINDSUB  EQU   *                                               @Y17XAC2 50428500
         TM    CKPDOUBL,DONESW          TEST FOR DONESW ON     @Y17XAC2 50428700
         BO    NEXTTTE                  YES, RETURN            @Y17XAC2 50429000
         TM    TRMBYTE2,TRMRSACT        TEST FOR TRMRSACT ON   @Y17XAC2 50430000
         BZ    CHRTPROC                 NO, BRANCH             @Y17XAC2 50430400
         OI    TRMBYTE2,TRMREMB         ELSE TURN TRMREMB ON   @Y17XAC2 50430800
         NI    TRMBYTE2,X'FF'-(TRMRSACT) TURN TRMRSACT OFF     @Y17XAC2 50431200
         CLI   TRMTYPE,TRMNSDLC         TEST FOR BSC LINE      @Y17XAC2 50431600
         BE    BSCCOHRT                 YES, BRANCH            @Y17XAC2 50432000
         ICM   R1,3,TRMSUBST            LOAD TRMSUBST, TEST    @Y17XAC2 50432400
         BNZ   SBSTPROC                 IF VALID BRANCH        @Y17XAC2 50432800
         SPACE 2                                               @Y17XAC2 50433200
BSCCOHRT EQU   *                                               @Y17XAC2 50434000
         ICM   R1,3,TRMCOHRT            LOAD IT WITH COHRT PTR @Y17XAC2 50434400
         L     R15,AVTRNMPT             LOAD SUBRT ADDRESS     @Y17XAC2 50434800
         BALR  R14,R15                  BRANCH TO SUBRT        @Y17XAC2 50435200
         SH    R1,TRMBCKUP              GET PTR TO NEG PREFIX  @Y17XAC2 50435600
         LR    RTERM,R1                 GET NEG PREFIX AFTER   @Y17XAC2X50436000
                                        RETURN FROM SUBRT      @Y17XAC2 50436400
         B     DNETEST1                 BRNCH TO TEST LOOPSW   @Y17XAC2 50436800
         SPACE 2                                               @Y17XAC2 50437200
SBSTPROC EQU   *                                               @Y17XAC2 50438000
         LR    RLVLTTE,RTERM            LOAD LVL WITH NXT TTE  @Y17XAC2 50438500
         L     R15,AVTRNMPT             LOAD SUBRT ADDR        @Y17XAC2 50439000
         BALR  R14,R15                  BRANCH AND LINK        @Y17XAC2 50439500
         SH    R1,TRMBCKUP              GET NEG PREFIX         @Y17XAC2 50439700
         LR    RTERM,R1                 PUT RETURNING ANSW NXT @Y17XAC2 50440000
         B     DNETEST1                                        @Y17XAC2 50440500
         EJECT                                                 @Y17XAC2 50441000
CHRTPROC EQU   *                                               @Y17XAC2 50441200
         NI    TRMBYTE2,X'FF'-(TRMREMB) TURN TRMRMEB OFF       @Y17XAC2 50441500
         ICM   R1,3,TRMCOHRT            LOAD 1 WITH COHRT PTR  @Y17XAC2 50442000
         L     R15,AVTRNMPT             LOAD SUBRT ADDR        @Y17XAC2 50442500
         BALR  R14,R15                  BRANCH TO SUBRT        @Y17XAC2 50443000
         SH    R1,TRMBCKUP              GET NEG PREFIX         @Y17XAC2 50443200
         LR    RTERM,R1                 LOAD NXT WITH ANSWER   @Y17XAC2 50443500
         SPACE 4                                               @Y17XAC2 50444000
************************************************************** @Y17XAC2 50445000
*        DETERMINE WHETHER OR NOT ALL SUBORDINATE RESOURCES  * @Y17XAC2 50445100
*        HAVE BEEN PROCESSED.  IF NOT, RETURN TO PROCESS NEXT* @Y17XAC2 50445200
*        RESOURCE.  IF ALL SUBORDINATE RESOURCES FOR THE     * @Y17XAC2 50445500
*        LOCAL NCP HAVE BEEN PROCESSED, SET UP TP RETURN TO  * @Y17XAC2 50445600
*        LOOK AT NEXT LOCAL NCP.  OTHERWISE, CONTINUE TO FIND* @Y17XAC2 50445700
*        AND PROCESS NEXT RESOURCE.                          * @Y17XAC2 50446000
*                                                            * @Y17XAC2 50446100
************************************************************** @Y17XAC2 50446200
         SPACE 2                                               @Y17XAC2 50446300
DNETEST1 EQU   *                                               @Y17XAC2 50446400
         TM    CKPDOUBL,LOOPSW          TEST FOR LOOPSW ON     @Y17XAC2 50446500
         BZ    DNETEST2                 NO,BRANCH              @Y17XAC2 50446900
         NI    CKPDOUBL,X'FF'-LOOPSW    ELSE TURN LOOPSW OFF   @Y17XAC2 50447300
         B     FINDSUB                  BRANCH AND RETURN      @Y17XAC2 50447700
         SPACE 2                                               @Y17XAC2 50448100
DNETEST2 EQU   *                                               @Y17XAC2 50448500
         CLR   RTERM,RLVLTTE            COM NXT AND LVL TTE PTR@Y17XAC2 50448900
         BE    CMPLNCP                  EQUAL BR TO ADVANCE    @Y17XAC2 50449300
         OI    CKPDOUBL,LOOPSW          TURN LOOPSW ON         @Y17XAC2 50449700
         B     DNETEST1                 BRNCH TO TEST FOR      @Y17XAC2 50450100
         SPACE 2                                               @Y17XAC2 50450500
CMPLNCP  EQU   *                                               @Y17XAC2 50451000
         CLI   TRMTYPE,TRMLNCP          COMPARE TYPE AND LNCP  @Y17XAC2 50451100
         BNE   CNVRTRSC                 NOT EQUAL BRANCH       @Y17XAC2 50451200
         OI    CKPDOUBL,LOOPSW+DONESW   TURN LOOPSW & DONESW ON@Y17XAC2 50451500
         B     DNETEST1                 BRANCH TO TEST         @Y17XAC2 50451700
         EJECT                                                 @Y17XAC2 50452000
************************************************************** @Y17XAC2 50452100
*                                                            * @Y17XAC2 50452200
*        COHORTLOOK FINDS THE NEXT HIGHER RESOURCE OF THE    * @Y17XAC2 50452500
*        CURRENT RESOURCE THAT IS BEING PROCESSED.           * @Y17XAC2 50452600
*                                                            * @Y17XAC2 50452700
************************************************************** @Y17XAC2 50452800
         SPACE 2                                               @Y17XAC2 50453000
CNVRTRSC EQU   *                                               @Y17XAC2 50453400
         LA    REGTABLT,TABLETTE        SET TABLE ADDRESS      @Y17XAC2 50453800
LOOKTTE  EQU   *                                               @Y17XAC2 50454200
         CLC   ZER0(AL1,REGTABLT),TRMTYPE COMPARE TTE TYPE     @Y17XAC2 50454600
         BE    LOOKTTE1                 EQUAL,CHCK 2ND BYTE    @Y17XAC2 50455000
         LA    REGTABLT,TABSIZE(REGTABLT) BUMP TO NEXT ENTRY   @Y17XAC2 50455400
         B     LOOKTTE                                         @Y17XAC2 50455800
         SPACE 2                                               @Y17XAC2 50456200
LOOKTTE1 EQU   *                                               @Y17XAC2 50457000
         CLI   TRMTYPE,TRMPSNA          CHCK IF PRESNA TERM    @Y17XAC2 50457400
         BNE   TTELOOP                  NO,GO TEST COHRT PTR   @Y17XAC2 50457800
         TM    TRMBYTE0,TRMGP           CHECK FOR GENERAL POLL @Y17XAC2 50458200
         BZ    TTELOOP                                         @Y17XAC2 50458600
         LA    REGTABLT,TABSIZE(REGTABLT) BUMP TO GENERAL POLL @Y17XAC2X50459000
                                        TABLE NAME             @Y17XAC2 50459400
TTELOOP  EQU   *                                               @Y17XAC2 50459800
         LH    R1,TRMCOHRT              PUT COHRT PTR IN REG   @Y17XAC2 50460200
TTELOOP1 EQU   *                                               @Y17XAC2 50460600
         L     R15,AVTRNMPT                                    @Y17XAC2 50461000
         BALR  R14,R15                  GO TO TNT SUBROUT      @Y17XAC2 50461400
         SH    R1,TRMBCKUP              GET NEG PREFIX         @Y17XAC2 50461800
         CLC   TRMTYPE-IEDNTRM(1,R1),AL1(REGTABLT)             @Y17XAC2X50462200
                                        IF TABLE MATCHES COL2  @Y17XAC2 50462600
         BE    CNVRTNXT                 YES,GO TO EXIT         @Y17XAC2 50463000
         CLC   TRMTYPE-IEDNTRM(1,R1),AL2(REGTABLT)             @Y17XAC2X50463400
                                        TABLE MATCH COL 3      @Y17XAC2 50463800
         BE    CNVRTNXT                 NO GO TO TTELOOP AGAIN @Y17XAC2 50464200
         ICM   R1,3,TRMCOHRT-IEDNTRM(R1) INSRT INTO REG1 COHRT @Y17XAC2 50464600
         B     TTELOOP1                                        @Y17XAC2 50465000
         EJECT                                                 @Y17XAC2 50465400
************************************************************** @Y17XAC2 50465800
*                                                            * @Y17XAC2 50466200
*        MAKE THE HIGHER LEVEL RESOURCE THE 'LEVEL' RESOURCE * @Y17XAC2 50466600
*        AND GET COHORT OF THE CURRENT RESOURCE AND CONTINUE * @Y17XAC2 50467500
*        WITH SUBORDINATE RESOURCE PROCESSING.               * @Y17XAC2 50467600
*                                                            * @Y17XAC2 50467700
************************************************************** @Y17XAC2 50467800
         SPACE 2                                               @Y17XAC2 50468000
CNVRTNXT EQU   *                                               @Y17XAC2 50468200
         LR    RLVLTTE,R1               LOAD LVL WITH SUBRT ANS@Y17XAC2 50468500
         LH    R1,TRMCOHRT              LOAD WITH PTR ADDR     @Y17XAC2 50469000
         L     R15,AVTRNMPT             LOAD SUBRT ADDR        @Y17XAC2 50469200
         BALR  R14,R15                  GO TO SUBRT            @Y17XAC2 50469500
         SH    R1,TRMBCKUP              GET NEG PREFIX         @Y17XAC2 50469900
         LR    RTERM,R1                 PUT PTR IN NXTTTE      @Y17XAC2 50470300
         B     DNETEST1                 GO TO TEST LOOPSW ON   @Y17XAC2 50470700
         EJECT                                                 @Y17XAC2 50471100
TABLETTE EQU   *                        TABLE OF POSS TTE      @Y17XAC2 50471500
*                                       TTE TYPE TYPE TO BE FOU@Y17XAC2 50471900
         DC    X'18',X'21',X'00'        PUNT          SDLC     @Y17XAC2 50472300
         DC    X'20',X'0F',X'00'        NSDLC         NCP      @Y17XAC2 50472700
         DC    X'21',X'0F',X'00'        SDLC          NCP      @Y17XAC2 50473100
         DC    X'30',X'18',X'00'        LUNT          PUNT     @Y17XAC2 50473500
         DC    X'40',X'20',X'00'        PRESNACLUS    NSDLC    @Y17XAC2 50473900
         DC    X'48',X'20',X'21'        CTERM         NSDLC(SDL@Y17XAC2 50474300
         DC    X'4F',X'20',X'00'        PRESNATERM    NSDLC    @Y17XAC2 50474700
         DC    X'4F',X'40',X'00'        PRESNATERM    PRESNACLU@Y17XAC2 50475100
         DC    X'00',X'00',X'00'        GRP           0        @Y17XAC2 50475500
         SPACE 5                                               @Y17XAC2 50475900
         DS    0H                                              @Y17XAC2 50476300
TRMBCKUP DC    AL2(IEDQTRM-IEDNTRM)                            @Y17XAC2 50476700
ZAPAREA  DC    100X'00'                                        @Y17XAC2 50477100
         SPACE 3                                               @Y17XAC2 50477500
ZER0     EQU   0                                               @Y17XAC2 50477900
AL1      EQU   1                                               @Y17XAC2 50478300
AL2      EQU   2                                               @Y17XAC2 50478700
TABSIZE  EQU   3                                               @Y17XAC2 50479100
L2       EQU   2                                               @Y17XAC2 50479500
RLD      EQU   22                       OFFSET TO RLD          @Y17XAC2 50479900
RECLNG   EQU   25                       OFFSET TO REC LENGTH   @Y17XAC2 50482000
LENG1K   EQU   1                        LENGTH INDICATOR       @Y17XAC2 50482200
         SPACE 5                                               @Y17XAC2 50487000
SWITCH   DSECT                                                 @Y17XAC2 50489000
CKPDOUBL DS    XL1                                             @Y17XAC2 50491000
LOOPSW   EQU   X'80'                                           @Y17XAC2 50493000
DONESW   EQU   X'40'                                           @Y17XAC2 50495000
         EJECT                                                 @Y17XAC2 50497000
         TAVTD                                                          50500000
         EJECT                                                          51200010
FORCORE  DSECT                                                 @G36XRCU 51900010
         IECDSECT                                              @G36XRCU 52600010
         TCKPD 3330                     MERLIN VERSION             0504 53500000
         TTNTD                                                          56500000
         TTRMD                                                          59500000
         TQCBD                                                          62500000
         DCBD  DSORG=TX                                                 65500000
         EJECT                                                          68500000
         TOPCAVTD                                                       71500000
         EJECT                                                          74500000
         TOPCED                                                         77500000
         EJECT                                                          80500000
         TLCBD                                                          83500000
         TCPBD                                                     0819 86500000
         END                                                            89500000
