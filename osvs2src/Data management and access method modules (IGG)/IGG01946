1946     TITLE '''IGG01946'' - TCAM APPL PROG OPEN EXECUTOR(LOAD1)'     00040005
IGG01946 CSECT                                                          00040105
         SPACE 3                                                        00040205
*  CHANGE ACTIVITY AS FOLLOWS                                           00040305
******************** MICROFICHE FLAGS *********************** SUPT CODE 00040405
*A015500,044500,504500                                           X01004 00040505
*C015000,044000,103000-105000                                    X01004 00040605
*A012500,013500,018200-018800,040200-040800,041200,105500,171500,Y01004 00040705
*A239200-239800,245200-245600,251500,252500,259100-259600,       Y01004 00040805
*A271200-271800,277200-277600,285600-285800,296100-296700,       Y01004 00040905
*A441200-443600,445400-448200,449400-459400,505608-505648        Y01004 00041005
*C012000,013000,018000,040000,041000,107000,149000,155000,159000,Y01004 00041105
*C188000,207000,251000,252000,441000,445000,449000,505600        Y01004 00041205
*D098000,108000,110000,120000,133000,150000-153000,156000,160000,Y01004 00041305
*D209000-209800,339000-340000,469000,540000                      Y01004 00041405
*C132000                                                         X02004 00041505
*C118000,545000                                                  Y01948 00041605
*D054000,084000,505900,532000-533000,546000-547000,551000        Y01948 00041705
*A098600-098800,165500,383500,419500                             Y05330 00041805
*C098500,165000,167000,259100,381000,383000,419000,420000        Y05330 00041905
*D369000-371000,391000-394000,467000                             Y05330 00042005
*A102000,137000,231600,266000,470500                             Y01948 00042105
*C091000,146000-148000,202000-203000,237000-240000,256000,260000-Y01948 00042205
*C262000,268000-269000,271200-271400,285800-290000,408300-408600 Y01948 00042305
*D0985000,139000-141000,242000-245600,274000-280000,296200       Y01948 00042405
*A452200,459000,505600,530700,552000                            OY01838 00042505
*C457000-457400,505420                                          OY01838 00042605
*C012000-023200,040000,041200,052000,080000,080000,091300,097000 Y02027 00042806
*C101500-103200,105500,107000,146000,159000,161000,168000,169000 Y02027 00043006
*C170000,227000-231000,232000,233000-236000,237000,239000,241000 Y02027 00043206
*C246000-251000,252000,253000-254000,285600,305000,307000,337000 Y02027 00043406
*C361000,374000,382100-418700,419000,470000,503000,505616,512000 Y02027 00043606
*C530100-530700                                                  Y02027 00043806
*D040200-040400,041500,053000,077500,094000-095000,106000,107000 Y02027 00044006
*D109000-138000,149000,162000,171000,172000-173000,176000-221000 Y02027 00044206
*D231300-231600,232400,236300-236600,251500,252500,256000-272000 Y02027 00044406
*D285700-285800,286800,287800,291000,292000-296100,306000,303000 Y02027 00044606
*D309000,338000,346000,358000,372400-372600,381000,419500,420000 Y02027 00044806
*D441000,442000-460000,468000,471000-495200,505060,505180,505420 Y02027 00045006
*D505450,505600,505624,505632,505640,505648,505720,507000-508000 Y02027 00045206
*D530750,541000,549000,549300,549600,550000,552000,582000        Y02027 00045406
*A041400,041600,082500,099900,108500,111500-117500,120500,123500 Y02027 00045606
*A126500,129500,148000,150000,160000,168500,169500,170500,238000 Y02027 00045806
*A171600,171700,228000,240000,242000-245000,286600,287600,288600 Y02027 00046006
*A289600-291600,296350,304500,332050-332850,368800-370400        Y02027 00046206
*A371680-371920,374300-380900,381200-381800,470070-470350        Y02027 00046406
*A470420-470560,503200-503600,536020-538880                      Y02027 00046606
*A182000                                                        SA55391 00200100
*C441000                                                        SA57692 00200200
*C133000                                                         22027  00200300
*A098000                                                         S22025 00200400
*C041000,109000-110000,240000,256000,331000,362000,371000,468000 S22025 00200500
*C477000,479000,492000,494000-495000                             S22025 00200600
*A092000,469000,475000,504000,549000                             A47156 00200700
*C237000,242000,249000,257000,269000,275000,425000-459800,471000 A47156 00200800
*D480000-491000                                                  A47156 00200900
*A201000,209000,236000,505000                                    A47157 00201000
*A077000,079000,084000,099000,142000,145000,193000,195000,223000 CLUP21 00201100
*A226000,285000,298000,302000,347000,350000,372000,421000,505000 CLUP21 00201200
*C092000,102000,139000,144000,151000,156000-157000,164000,194000 CLUP21 00201300
*C204000,214000,282000-284000,292500,300000-301000,327000,349000 CLUP21 00201400
*C513000,530100                                                  CLUP21 00201500
*D087000-090000,123000,135000,188000,192000,222000,232000,244000 CLUP21 00201600
*D253000,263000,273000,341000-345000,375000-380000,399000-402000 CLUP21 00201700
*D410000,413000,423000-424000,465000,470000,496000,505000        CLUP21 00201800
*D510000-511000,515000,518000-519000,521000-522000,524000-524500 CLUP21 00201900
*D528000                                                         CLUP21 00202000
*C527000,529000                                                  A44886 00202100
*C478000                                                         A42380 00202200
*C151000,204000,287000-289000,291000-292000                      A47158 00202300
*C106000,133000,146000-150000,156000-163000,167000-168000        S22024 00202400
*C172000-173000,176000-182000,186000-188000,198000,200000,204000 S22024 00202500
*C209000,210000-211000,215000-218000,227000-228200,246000,254000 S22024 00202600
*C265000,278000,289000,292500,307000,327000-330000,339000,361000 S22024 00202700
*C374000,393000,396000-400000,416000                             S22024 00202800
*A408300-408600,498100-498700                                    S22024 00202900
*C328000,475000                                                  S21903 00203000
*C146000,157000,505900                                          SA60016 00203100
*C239000                                                       @ZA00205 00203461
*A239100-239600,470630                                         @ZA00205 00203761
*D240000                                                       @ZA00205 00204061
*A105000,470700                                                @SA69652 00205061
*A412700,415100                                                @ZA02619 00205361
*A101500                                                       @SA69652 00205661
*C523000                                                       @SA70001 00206061
*A105000                                                       @ZA02083 00216061
*A105000,370400,394100,403100,502000,530000,536490,538880      @ZA02601 00226061
*C332050-332750,382400-385100,385700,304500,359500             @ZA02601 00236061
*C394320                                                       @ZA02601 00246061
*D393500,105500,400400-400700                                  @ZA02601 00256061
*C383240                                                       @ZA05047 00276009
*C380000                                PECB DSECT CHG         @OZ07830 00276191
*C157000                                                       @OZ14150 00276291
*A332450                                                       @OZ11209 00276391
*A382760,382880,383480,383660,478000                           @OZ17630 00276491
*                                       PECB DSECT CHG         @OZ18744 00276586
         SPACE 4                                                        00300020
*********************************************************************** 00400020
*                                                                     * 00500020
*TITLE: 'IGG01946' TCAM APPLICATION PROGRAM OPEN EXECUTOR(LOAD 1)     * 00600020
*                                                                     * 00700020
*  MODULE NAME = IGG01946                                             * 00800000
*                                                                     * 00810000
*  DESCRIPTIVE NAME = TCAM APPLICATION PROGRAM OPEN EXECUTOR (LOAD 1) * 00820000
*                                                                     * 00830000
*  COPYRIGHT = 'NONE'                                                 * 00840000
*                                                                     * 00850000
*  STATUS:  CHANGE LEVEL 5                                            * 00860000
*                                                                     * 00900020
*FUNCTION: THIS MODULE INITIATES ACTIVATION OF A DATA TRANSFER        * 01000020
*   COMMUNICATION LINK BETWEEN AN APPLICATION PROGRAM AND THE MCP.    * 01100020
*   OPEN EXECUTES IN KEY 5, DATA MANAGEMENT KEY. IF TCAM IS ACTIVE,   * 01200006
*   AN AUTHORIZATION CHECK IS MADE.  THE EXECUTOR GETS MAIN FOR THE   * 01280006
*   DEB IN SUBPOOL 230, KEY 5. A DEBCHK IS ISSUED TO ADD THE DEB TO   * 01360006
*   LIST.  THE DEB IS INITIALIZED AND ENQUEUED ON THE TCB CHAIN       * 01440006
*   USING COMPARE & SWAP. NEXT, APPROPRIATE ACCESS METHOD MODULES     * 01520006
*   ARE LOADED - IGG019RG, IGG019RI, IGG019RM, IGG019RL. CORE IS      * 01600006
*   GOTTEN FOR THE LOCATE MODE WORKAREA IF NEEDED AND THE PROCESS     * 01680006
*   ECB IN USER KEY. ONCE PER OPEN MACRO, CORE IS GOTTEN FOR AN RCB   * 01760006
*   IN KEY 6 IN CSA.  THE RCB IS INITIALIZED WITH INFORMATION FROM    * 01840006
*   THE APP. PROG REGION NEEDED BY IEDQEU IN MCP. OPEN THEN BUILDS    * 01920006
*   AN ELEMENT AND ISSUES SVC 102 TO POST RCB TO OPEN/CLOSE SUBTASK.  * 02000006
*   A WAIT IS ISSUED FOR COMPLETION OF IEDQEU WHICH POSTS EDB COMPLETE* 02080006
*   UPON RETURN, THE DEB IS FURTHER INITIALIZED WITH INFO FROM THE    * 02160006
*   RCB.  THE COPIED DCB IS MOVED TO USER DCB.  AFTER ALL DCB'S       * 02240006
*   ARE OPENED, THE CORE FOR RCB IS FREED.                            * 02320006
*                                                                     * 02400020
*ENTRY POINT:                                                         * 02500020
*        IGG01946                                                     * 02600020
*                                                                     * 02700020
*INPUT: REGISTERS 5,6,7 AND 8 CONTAIN THE FOLLOWING VALUES:           * 02800020
*   5 - ADDRESS OF FIRST ENTRY IN DCB PARAMETER LIST                  * 02900020
*   6 - ADDRESS OF BEGINNING OF WHERE-TO-GO TABLE                     * 03000020
*   7 - ADDRESS OF CURRENT ENTRY IN DCB PARAMETER LIST                * 03100020
*   8 - ADDRESS OF CURRENT ENTRY IN WHERE-TO-GO TABLE                 * 03200020
*                                                                     * 03300020
*OUTPUT: REGISTERS 5,6,7 AND 8 CONTAIN THE FOLLOWING VALUES:          * 03400020
*   5 - SEE 'INPUT'                                                   * 03500020
*   6 - SEE 'INPUT'                                                   * 03600020
*   7 - ADDRESS OF NEXT ENTRY IN DCB PARAMETER LIST                   * 03700020
*   8 - ADDRESS OF NEXT ENTRY IN WHERE-TO-GO TABLE                    * 03800020
*                                                                     * 03900020
*EXTERNAL ROUTINES.  DEBCHK-- USED TO ADD DEB TO LIST.                * 04000006
*                   IEDQEB -- AQCTL SVC 102 ROUTINE -- TO TPOST A     * 04060005
*   SPECIAL ELEMENT TO THE MCP READY QUEUE.                           * 04080005
*                   AOS LOAD ROUTINE (SVC 8) -- TO LOAD REQUIRED      * 04100005
*                    TESTAUTH-- USED TO CHECK FOR APF AUTHORIZAION    * 04120006
*                    GETMAIN-- USED TO GET CORE FOR CONTROL BLOCKS    * 04140006
*   A MODESET IS USED GET GET IN CORRECT KEY BEFORE GETMAIN           * 04160006
*EXITS-NORMAL: THIS MODULE XCTLS TO NEXT ENTRY IN WTG TABLE           * 04200020
*                                                                     * 04300020
*EXITS-ERROR: THIS MODULE XCTLS TO THE OPEN ERROR HANDLER ROUTINE     * 04400005
*             (IGG0194B).                                             * 04450005
*                                                                     * 04500020
*TABLES/WORK AREAS:                                                   * 04600020
*   CVT                                                               * 04700020
*   AVT                                                               * 04800020
*   DCB                                                               * 04900020
*   TCB                                                               * 05000020
*   DEB                                                               * 05100020
*   PECB                                                              * 05200006
*   OPEN/CLOSE WORK AREA                                              * 05500020
*                                                                     * 05600020
*ATTRIBUTES: REENTRANT, REFRESHABLE                                   * 05700020
*                                                                     * 05800020
*NOTES: THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL         * 05900020
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  * 06000020
*   TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED   * 06100020
*   SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY,     * 06200020
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.          * 06300020
*                                                                     * 06400020
*********************************************************************** 06500020
         EJECT                                                          06600020
RZERO    EQU   0                        GENERAL WORK REGISTER           06700020
RPARM    EQU   1                        PARAMETER/WORK REGISTER         06800020
RPENTRY  EQU   2                        ADDRESS OF PROCESS ENTRY        06900020
RCORE    EQU   3                        ADDRESS OF DCB WORKAREA         07000020
RDCB     EQU   4                        DCB BASE REGISTER               07100020
RPAR     EQU   5                        ADDRESS OF FIRST ENTRY IN       07200020
*                                       DCB PARAMETER LIST              07300020
RWTG     EQU   6                        ADDRESS OF WHERE-TO-GO          07400020
*                                       (WTG) TABLE                     07500020
RPARC    EQU   7                        ADDRESS OF CURRENT ENTRY        07600020
*                                       IN DCB PARAMETER LIST           07700020
RWTGC    EQU   8                        ADDRESS OF CURRENT ENTRY        07800020
*                                       IN WHERE-TO-GO TABLE            07900020
RTCX     EQU   9                        TCX BASE REGISTER        Y02027 08000006
RWORK    EQU   10                       WORKAREA BASE REGISTER          08100020
RDEB     EQU   11                       DEB BASE REGISTER               08200020
RDCBMOVE EQU   11                       WORK REG TO MOVE DCB     Y02027 08250006
RBASE    EQU   12                       CSECT BASE REGISTER             08300020
RTCB     EQU   13                       ADDR TCB                 S22024 08450022
RETURN   EQU   14                       RETURN POINT REGISTER           08500020
RENTRY   EQU   15                       RETURN CODE REGISTER            08600020
         SPACE 3                                                        08700022
         USING *,RENTRY                                          Y01948 09100005
         BAL   RBASE,BEGIN              BRANCH AROUND DC'S       Y02027 09130006
         DROP  RENTRY                                                   09160005
         USING *,RBASE                  ADDRESSIBILITY           CLUP21 09200022
         USING IHADCB,RDCB              DCB ADDRESSABILITY              09300020
         USING FORCORE,RCORE            DCB WORKAREA ADDRESSABILITY     09600020
         USING IEDQTCB,RTCB             BASE FOR TCB.            Y02027 09700006
         DC    C'IGG019'                MODULE IDENTIFIER        Y05330 09860005
TAMOID   DC    C'46'                    ID OF THIS OPEN EXECUTOR Y05330 09870005
         IEDHJN                                                         09880005
         EJECT                                                          09900020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 09910022
*                                                                CLUP21 09920022
* THE FOLLOWING SECTION OF CODE IS EXECUTED FOR EACH DCB BEING   CLUP21 09930022
* PROCESSED. IT VERIFIES THAT TCAM IS ACTIVE AND THAT A PROCESS  CLUP21 09940022
* ENTRY EXISTS AND IS NOT IN USE. WHEN ANY OF THESE CONDITIONS   CLUP21 09950022
* ARE NOT MET, THE APPLICATION PROGRAM IS ABENDED.               CLUP21 09960022
*                                                                CLUP21 09970022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 09980022
BEGIN    SR    RPARM,RPARM              ZERO RCB PTR.            Y02027 09990006
START    EQU   *                                                        10000020
         L     RCORE,FOUR(RWTGC)        ADDRESS OF OPEN WORKAREA        10100020
         ST    RPARM,DXCCW10+FOUR       STORE RCB ADDRESS        Y02027 10150006
         MODESET EXTKEY=ZERO            GET IN KEY ZERO        @SA69652 10160061
TESTRDY  EQU   *                                               @SA69652 10170061
         L     RTCX,CVTPTR              GET ADDRESS OF THE CVT   Y02027 10200006
         L     RDCB,NULL(RTCX)          GET PTR TO TCB           Y02027 10260006
         ICM   RTCX,ALL,CVTAQAVT-CVT(RTCX)  TCX ACTIVE - IS  TCAMY02027 10320006
*                                       MCP ACTIVE               X01004 10400005
         BZ    ABORT                    BRANCH IF NO.            X01004 10500005
         TM    TCXFLAG1-IEDQTCX(RTCX),TCXMCPCD TCAM TERMINATED @ZA02601 10500661
         BO    ABORT                    YES, REJECT OPEN       @ZA02601 10501261
         ICM   RPARM,AD,TCXOCQ+ONE-IEDQTCX(RTCX)   APPLICATION @ZA02083 10501861
*                                       PROG INTERFACE EXIST   @ZA02083 10502461
         BZ    ABORT                    NO, REJECT OPEN        @ZA02083 10503061
         TM    TCXBIT1-IEDQTCX(RTCX),AVTREADN  TCAM READY      @SA69652 10508061
         BO    TIMEUP                   BRANCH YES             @SA69652 10516061
         STIMER WAIT,DINTVL=INTVL                              @SA69652 10524061
         B     TESTRDY                  CKECK IF TCAM RDY      @SA69652 10532061
TIMEUP   EQU   *                                               @SA69652 10540061
         TM    TCXFLAG1-IEDQTCX(RTCX),TCXAUTH  TEST AUTHORIZE    Y02027 10850006
         BNO   AUTHORZD                 APPL. DONT REQ AUTHOR.   Y02027 11150006
         MODESET  EXTKEY=DATAMGT                                 Y02027 11450006
         TESTAUTH FCTN=1                CHECK APF.               Y02027 11750006
         LTR   RENTRY,RENTRY            CHECK RETURN CODE.       Y02027 12050006
         BNZ   ABORT7                   INVOKER NOT AUTHORIZED   Y02027 12350006
AUTHORZD EQU   *                                                 Y02027 12650006
         MODESET  EXTKEY=DATAMGT                                 Y02027 12950006
         L     RTCB,FOUR(RDCB)          ADDRESS OF CURRENT TCB   Y01948 13750005
         EJECT                                                          14200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 14250022
*                                                                     * 14300020
* THE FOLLOWING SECTION OF CODE GETMAINS FOR AND INITIALIZES A   CLUP21 14400022
* DATA EXTENT BLOCK (DEB)                                        CLUP21 14450022
*                                                                     * 14500020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 14550022
         LA    RZERO,DEBSIZE+XTRADEB    SIZE OF DEB FOR GETMAIN  Y02027 14600006
         LA    RPENTRY,SPDEB            SUBPOOL 230 FOR DEB      Y02027 14800006
         BAL   RETURN,BLDLIST           GETMAIN FOR DEB          Y02027 15000006
         USING IEDQDEB,RDEB             DEB ADDRESSABILITY              15400020
         LR    RDEB,RPARM               SET DEB BASE REGISTER    Y01004 15500005
         MVI   12(RDEB),EIGHT           DEB SIZE IN DOUBLEWORDS@OZ14150 15700091
         LA    RDEB,SIXTEEN(ZERO,RDEB)  POINT TO DEB PROPER      S22024 15800022
         ST    RTCB,DEBTCBAD-ONE        STORE TCB ADDR IN DEB    Y02027 15900006
         L     RDCB,DXUDCBAD            GET ADDR OF REAL DCB            16000006
         STCM  RDCB,AD,DEBDCBAD         PUT REAL DCB ADDR IN DEB Y02027 16100006
         OI    DEBDCBAD-ONE,DEBID       SET THE DEB IDENTIFIER   S22024 16300022
         SR    RPARM,RPARM              CLEAR FOR ICM            Y05330 16500005
         ICM   RPARM,AD,TCBDEB+ONE      GET ADDRESS OF FIRST DEB Y05330 16550005
*                                       IN TCB DEB CHAIN                16600020
         MODESET  EXTKEY=ZERO    KEY 0 TO UPDATE DEB             Y02027 16800006
         STCM  RDEB,AD,DCBDEBAD+ONE     PUT DEB ADDR IN REAL DCB Y02027 16850006
CHAINDEB ST    RPARM,DEBDEBAD-ONE       PT. NEW DEB TO OLD HEAD  Y02027 16900006
         CS    RPARM,RDEB,TCBDEB        CHAIN NEW DEB TO TCB IF  Y02027 16950006
         BNE   CHAINDEB                   TCBDEB HAS NOT CHANGED Y02027 17000006
         MODESET  EXTKEY=DATAMGT        BACK TO KEY 5            Y02027 17050006
         DEBCHK  (RDCB),TYPE=ADD,AM=TCAMAP  INSERT DEB IN CHAIN  Y02027 17150006
         L     RDCB,NULL(RPARC)         ADDR OF COPIED DCB       Y02027 17160006
         STCM  RDEB,AD,DCBDEBAD+ONE     DEB ADDR IN COPIED DCB   Y02027 17170006
         MVI   DEBTAMID,DEBIDO          INITIALIZE DEB TAM FLAG         17400020
*                                       FIELD TO PUT/WRITE VALUE        17500020
         EJECT                                                          22300020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 22350022
*                                                                       22400020
* DETERMINE ACCESS MODULES TO BE LOADED AND LOAD THEM                   22500020
*                                                                       22600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 22650022
         MVI   SIX(RWTG),MODULEID       CONSTANT ID              Y02027 22700006
         MVC   DCBMACRF(TWO),DCBMACR    GO TO POST OPEN STATE    S22024 22800006
         CLI   DCBMACR,NULL             IS BYTE 1 ZERO,I.E.,IS          22900006
*                                       THIS AN OUTPUT DCB              23000006
         BE    OUTPUT                   BRANCH IF YES                   23100006
         MVI   DEBTAMID,DEBIDI          SET DEB FLAG FOR INPUT   Y01948 23200006
         LA    RPENTRY,DCBMACRF         ADDR OF INPUT DCB MACRO  Y02027 23300006
*                                       INSTRUCTION REFERENCE           23400006
         MVI   SEVEN(RWTG),GETREAD      ID FOR GET/READ MODULE   Y02027 23500006
CHECKL   EQU   *                                                        23600006
         BAL   RETURN,LOADER            GO LOAD THE ROUTINE      Y02027 23700006
         STCM  RZERO,AD,DCBGET+ONE      STORE EP ADDR IN DCB     Y02027 23800006
         TM    ZERO(RPENTRY),READFLG    IS THIS A BSAM DCB     @ZA00205 23900061
         BO    BSAM                     BR YES                 @ZA00205 23910061
         A     RZERO,CONFOUR            ADJUST ENTRY PT ADDR FOROZ00205 23920061
*                                       QSAM ENTRY IN 19RG &19RIOZ00205 23930061
         STCM  RZERO,AD,DCBGET+ONE      STORE ENTRY PT IN DCB  @ZA00205 23940061
         B     POINT                    CONT QSAM PROCESSING   @ZA00205 23950061
BSAM     EQU   *                                               @ZA00205 23960061
         MVI   SEVEN(RWTG),CHECK        ID FOR CHECK MODULE      Y02027 24100006
         BAL   RETURN,LOADER            GO LOAD THE ROUTINE      Y02027 24200006
         STCM  RZERO,AD,DCBCHECK+ONE    STORE EP ADDRESS INTO DCBY01004 24300006
POINT    EQU   *                                                 Y02027 24400006
         TM    ZERO(RPENTRY),POINTFLG   POINT SPECIFIED          Y02027 24500006
         BZ    SVCTIME                  BRANCH IF NO             Y02027 24600006
         MVI   SEVEN(RWTG),POINTR       ID FOR POINT MODULE      Y02027 24700006
         BAL   RETURN,LOADER            GO LOAD THE ROUTINE             24800006
         ST    RZERO,DCBPOINT           STORE EP ADDR IN DCB            24900006
         B     SVCTIME                  GO INVOKE OPEN SUBTASK   Y02027 25000006
OUTPUT   EQU   *                                                        25100006
         LA    RPENTRY,DCBMACRF+ONE     ADDR OF OUTPUT DCB       Y02027 25200006
         MVI   SEVEN(RWTG),PUTWRITE     ID FOR PUT/WRITE MODULE  Y02027 25300006
         B     CHECKL                   GO LOAD CHECK ROUTINE    Y02027 25400006
         EJECT                                                          28100020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 28200022
*                                                                CLUP21 28250022
* THIS SUBROUTINE SETS UP A PARAMETER LIST TO BE USED FOR        CLUP21 28300022
* DYNAMIC ALLOCATION OF MAIN STORAGE FOR DEB'S IOB'S AND         CLUP21 28350022
* LOCATE MODE WORKAREAS                                          CLUP21 28400022
*                                                                     * 28500020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 28550022
BLDLIST  EQU   *                                                 Y02027 28560006
*              FOR GETMAIN, REGISTER 0 = SIZE AND REGISTER 2=    Y02027 28660006
*              SUBPOOL, RETURN CODE IN REGISTER 15,              Y02027 28760006
*              AND ADDRESS OF GOTTEN AREA RETURNED IN REGISTER 1 Y02027 28860006
         LR    RWORK,RZERO              SAVE LEN                 Y02027 28960006
*                                       CLEAR GOTTEN CORE        Y02027 29060006
         GETMAIN     RC,LV=(0),SP=(2)                                   29160006
         SPACE                                                          29400020
         LTR   RENTRY,RENTRY            SUCCESSFUL GETMAIN              29500020
         BNZ   ABORT3                   BRANCH IF NO                    29600020
         LR    RENTRY,RPARM             COPY ADDR. OF STORAGE    Y01004 29630005
         LR    RZERO,RWORK              GET LEN OF GETMAIN REQ   Y02027 29635006
BLDLIST2 EQU   *                                                 Y01004 29640005
         MVI   NULL(RENTRY),NULL        CLEAR BYTE OF STORAGE    Y01004 29650005
         LA    RENTRY,ONE(RENTRY)       BUMP TO NEXT BYTE        Y01004 29660005
         BCT   RZERO,BLDLIST2           CLEAR NEXT BYTE          Y01004 29670005
         BR    RETURN                   RETURN TO CALLER                29700020
         EJECT                                                          29800020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 29850022
*                                                                     * 29900020
* SET UP TO TRANSFER CONTROL TO THE NEXT LOAD OF OPEN            CLUP21 30000022
*                                                                     * 30200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 30300022
EXITTST  EQU   *                                                        30400020
         MODESET EXTKEY=ZERO                                   @ZA02601 30450061
         L     RPARM,DXCCW10+FOUR       LOAD RCB ADDRESS         Y02027 30500006
         XC    NULL(TWO,RWTGC),NULL(RWTGC) CLEAR ID FOR THIS DCB Y02027 30700006
LOOP     EQU   *                                                        31000020
         LA    RWTGC,EIGHT(RWTGC)       BUMP TO NEXT ENTRY IN           31100020
*                                       WTG TABLE                       31200020
         LA    RPARC,FOUR(RPARC)        BUMP TO NEXT ENTRY IN           31300020
*                                       DCB LIST                        31400020
         CLC   NULL(TWO,RWTGC),TAMOID   ANOTHER TAM SAM DCB TO OPEN     31500020
         BE    START                    BRANCH IF YES TO RESTART        31600020
*                                       THIS EXECUTOR                   31700020
         CLC   NULL(TWO,RWTGC),OSID     END OF WTG TABLE                31800020
         BNE   LOOP                     BRANCH IF NO                    31900020
*                                                                       32000020
ABEXIT   EQU   *                                                        32100020
         LR    RPARC,RPAR               RESET POINTER TO BEGINNING      32200020
*                                       OF DCB PARAMETER LIST           32300020
         LA    RWTGC,C32(RWTG)          RESET POINTER TO BEGINNING      32400020
*                                       OF WTG TABLE                    32500020
LABEL    EQU   *                                                        32600020
         CLI   ZERO(RWTGC),NULL         THIS DCB PROCESSED       S22024 32700022
         BNE   XCTLRTN                  YES, DO XCTL             S21903 32800022
         LA    RWTGC,EIGHT(RWTGC)       BUMP BY EIGHT            S22024 32900022
         LA    RPARC,FOUR(RPARC)        BUMP BY FOUR             S22024 33000022
         B     LABEL                    CHECK NEXT DCB           S22025 33100022
XCTLRTN  EQU   *                                                        33200020
         ICM   RPARM,ALL,DXCCW10+FOUR   GET RCB ADDRESS        @ZA02601 33205061
         BZ    MODESET                  NO RCB TO DEALLOCATE   @ZA02601 33215061
         LA    RZERO,AIBKEY-IEDQAIB     RCB OFFSET IN AIB      @ZA02601 33225061
         SR    RPARM,RZERO              ADDRESS OF AIB         @ZA02601 33235061
         MVI   AIBSTATE-IEDQAIB(RPARM),AIBFREE FREE AIB        @ZA02601 33245061
         SR    RZERO,RZERO              CLEAR REG              @OZ11209 33255091
         ST    RZERO,DXCCW10+FOUR       CLEAR PTR TO AIB       @OZ11209 33265091
MODESET  EQU   *                                                 Y02027 33280006
         MODESET  EXTKEY=DATAMGT                                        33285006
         LA    RENTRY,DXCCW12           GET ADDRESS OF A WORKAREA       33300020
*                                       FOR USE BY XCTL SVC             33400020
         MVC   SIX(TWO,RWTG),NULL(RWTGC) MOVE EXECUTOR ID TO THE        33500020
*                                       PARAMETER LIST                  33600020
         XCTL  EPLOC=(RWTG),SF=(E,(15))                          Y02027 33700006
         EJECT                                                          34700020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 34750022
*                                                                     * 34800020
* ERROR PROCESSING                                               CLUP21 34900022
*                                                                     * 35000020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 35050022
ABORT    EQU   *                                                        35100020
         LA    RWORK,NOTCAM             TCAM NOT IN SYSTEM              35200020
         B     OUTERRX                  PREPARE TO ABORT                35300020
ABORT1   EQU   *                                                        35400020
         LA    RWORK,DDNERR             INVALID QNAME                   35500020
OUTERR   EQU   *                                                        35700020
OUTERRX  EQU   *                                                        35900020
         MODESET EXTKEY=ZERO            GET IN KEY ZERO        @ZA02619 35950061
         ST    RWORK,DXCCW10            PUT ERROR CODE IN OPEN WRKA     36000020
         MVC   NULL(2,RWTGC),OPERR      ID OF ERROR EXECUTOR     Y02027 36100006
         B     ABEXIT                   GO RESET POINTERS        S22025 36200022
ABORT2   EQU   *                                                        36300020
         LA    RWORK,USERR              PROCESS ENTRY IN USE            36400020
         B     OUTERR                   PREPARE TO EXIT                 36500020
ABORT3   EQU   *                                                        36600020
         LA    RWORK,GMERR2             GETMAIN FAILURE IN APPL PROG    36700020
         B     OUTERR                   PREPARE TO EXIT                 36800020
ABORT4   EQU   *                                                 Y02024 36880006
         LA    RWORK,GMERR1             GETMAIN FAILURE IN MCP   Y02024 36960006
         B     OUTERR                   PREPARE TO EXIT          Y02024 37040006
ABORT5   EQU   *                                               @ZA02601 37050061
         LA    RWORK,PCBERROR           PCB IN USE FOR ANOTHER @ZA02601 37060061
*                                       APPLICATION            @ZA02601 37070061
         B     OUTERR                   PREPARE TO EXIT        @ZA02601 37080061
ABORT6   EQU   *                                                 S22024 37120022
         LA    RWORK,SIX*FOUR           SECURED QUEUE CODE       S22024 37140022
         B     OUTERR                   PREPARE TO EXIT          S22024 37160022
ABORT7   EQU   *                                                 Y02027 37168006
         LA    RWORK,NOTAUTHC           NOT AUTH ERROR CODE      Y02027 37176006
         B     OUTERRX                  EXIT TO ERROR CODE       Y02027 37184006
NOTAUTHC EQU   X'1C'                    NOT AUTH  043-7  ABEND   Y02027 37192006
         EJECT                                                          37200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 37210022
*                                                                CLUP21 37220022
* THIS SECTION OF CODE DEALS WITH THE MCP OPEN SUBTASK INTERFACE CLUP21 37230022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 37270022
SVCTIME  EQU   *                                                        37300020
**************************************************************   Y02027 37400006
* GETMAIN FOR LOCATE MODE WORK AREA.                             Y02027 37430006
**************************************************************   Y02027 37460006
         TM    DCBDSORG,PHYSSEQ         PHYSICAL SEQUENTIAL-     Y02027 37490006
         BNO   CKPTTST                  BRANCH NO.               Y02027 37520006
         TM    ZERO(RPENTRY),READFLG    TEST FOR BSAM            Y02027 37550006
         BO    CKPTTST                  BRANCH IF BSAM           Y02027 37580006
         TM    ZERO(RPENTRY),LOCMFLG    TEST FOR LOCATE MODE     Y02027 37610006
         BNO   CKPTTST                  BRANCH IF NOT LOCATE MODEY02027 37640006
         SR    RZERO,RZERO              CLEAR REGISTER           Y02027 37670006
         ICM   RZERO,THREE,DCBBLKSI     LOAD WORKAREA SIZE       Y02027 37700006
         LA    RPENTRY,SPREGUSR         SUBPOOL FOR WORKAREA     Y02027 37730006
         MODESET  EXTKEY=RBT234,WORKREG=1                               37760006
         BAL   RETURN,BLDLIST           GET CORE FOR WK AREA     Y02027 37790006
         MODESET  EXTKEY=DATAMGT                                        37820006
         STCM  RPARM,AD,DEBLCMWA        MOVE WK AREA ADDR        Y02027 37850006
         MVC   DEBSOWA,DCBBLKSI         MOVE WK AREA SIZE        Y02027 37880006
CKPTTST  EQU   *                                                 Y02027 37910006
**************************************************************   Y02027 37940006
* GETMAIN FOR PECB.     **************************************   Y02027 37970006
         LA    RZERO,PECBSIZE           LOAD PECB SIZE           Y02027 38000006
         LA    RPENTRY,SPREGUSR         SUBPOOL FOR PECB         Y02027 38030006
         MODESET  EXTKEY=RBT234,WORKREG=1                               38060006
         BAL   RETURN,BLDLIST           GET PECB CORE            Y02027 38090006
         MODESET  EXTKEY=DATAMGT                                        38120006
         ST    RPARM,DCBPECB            PTR TO PECB.             Y02027 38150006
         EJECT                                                   Y02027 38180006
**************************************************************   Y02027 38210006
         MODESET EXTKEY=ZERO                                   @ZA02601 38240061
         ICM   RPARM,ALL,DXCCW10+FOUR   GET RCB ADDRESS        @ZA02601 38246061
         BNZ   HAVERCB                  BYPASS RCB GETMAIN     @ZA02601 38252061
         LA    RPARM,TCXAIBC-IEDQTCX(RTCX) TCX AIB PTR         @ZA02601 38258061
AIBGET   EQU   *                                               @ZA02601 38264061
         ICM   RPARM,AD,AIBCHAIN-IEDQAIB(RPARM) ANY AIB'S AVAIL@ZA02601 38270061
         BNZ   GOTAIBS                  YES, GET ONE           @ZA02601 38276061
         LH    RZERO,TCXSZAIB-IEDQTCX(RTCX)   GET SIZE OF AIB  @OZ17630 38277091
         CH    RZERO,FOURK              SIZE GREATER THAN 4K   @OZ17630 38278091
         BH    GETCORE                  YES, BRANCH            @OZ17630 38279091
         LA    RZERO,HPAGE              2K VALUE               @ZA02601 38282061
         AR    RZERO,RZERO              DOUBLE TO PAGE SIZE    @ZA02601 38288061
GETCORE  EQU   *                                               @OZ17630 38291091
         USING PSA,ZERO                                        @ZA02601 38294061
         LR    RPENTRY,RPARC            SAVE REG               @ZA02601 38300061
         ICM   RDCB,AD,DEBTCBAD         TCB ADDRESS FOR GETMAIN@ZA02601 38306061
         L     RPARC,PSAAOLD            ASCB ADDR FOR GETMAIN  @ZA02601 38312061
*                                       GETMAIN CSA KEY6       @ZA02601 38318061
         MODESET   EXTKEY=TCAM          GET IN TCAM KEY        @ZA05047 38324009
         GETMAIN  RU,LV=(0),BNDRY=PAGE,SP=CSA                  @ZA05047 38326009
         MODESET   EXTKEY=ZERO          GO BACK TO KEY 0       @ZA05047 38328009
         LR    RPARC,RPENTRY            RESTORE REG            @ZA02601 38330061
         L     RDCB,NULL(RPARC)         RESTORE DCB ADDRESS    @ZA02601 38336061
         L     RCORE,FOUR(RWTGC)        RESTORE WORK AREA PTR  @ZA02601 38342061
         LH    RETURN,TCXSZAIB-IEDQTCX(RTCX) SIZE OF AIB       @ZA02601 38348061
         CH    RETURN,FOURK             SIZE GREATER THAN 4K   @OZ17630 38349091
         BNH   SMALLAIB                 NO, BRANCH             @OZ17630 38350091
         LR    RENTRY,RPARM             GET ADDR OF ONLY AIB   @OZ17630 38351091
         B     CLRBYTE                  BRANCH TO CLEAR BYTE   @OZ17630 38352091
SMALLAIB EQU   *                                               @OZ17630 38353091
         LA    RENTRY,HPAGE             2K VALUE               @ZA02601 38354061
         LA    RENTRY,HPAGE(RENTRY,RPARM) ADDR OF END OF AIBS  @ZA02601 38360061
         SR    RENTRY,RETURN            ADDR OF LAST AIB       @ZA02601 38366061
CLRBYTE  EQU   *                                               @OZ17630 38369091
         LA    RZERO,ZERO(RPARM)        CLEAR HI ORDER BYTE    @ZA02601 38372061
         B     BXLE                     BRANCH TO INITIALIZE   @ZA02601 38378061
CHAINAIB EQU   *                                               @ZA02601 38384061
         ST    RZERO,AIBCHAIN-ONE-IEDQAIB(RPARM) STORE AIB PTR @ZA02601 38390061
         LR    RPARM,RZERO              SAVE CURRENT PTR       @ZA02601 38396061
BXLE     EQU   *                                               @ZA02601 38402061
         BXLE  RZERO,RETURN,CHAINAIB    LOOP THRU NEW CORE     @ZA02601 38408061
*                                       TILL ALL AIBS LINKED   @ZA02601 38414061
         LR    RENTRY,RPARM             LAST AIB PTR           @ZA02601 38420061
         N     RPARM,CLRLOW             START OF GOTTEN CORE   @ZA02601 38426061
         L     RZERO,TCXAIBC-IEDQTCX(RTCX) GET CURRENT AIB PTR @ZA02601 38432061
AIBLOOP  EQU   *                                               @ZA02601 38438061
         ST    RZERO,AIBCHAIN-ONE-IEDQAIB(RENTRY) LINK AIBS    @ZA02601 38444061
         CS    RZERO,RPARM,TCXAIBC-IEDQTCX(RTCX) CHAIN AIBS    @ZA02601 38450061
         BNE   AIBLOOP                  RETRY IF CS FAILED     @ZA02601 38456061
GOTAIBS  EQU   *                                               @ZA02601 38462061
         TS    AIBSTATE-IEDQAIB(RPARM)  ALLOCATE AIB           @ZA02601 38468061
         BNZ   AIBGET                   IN USE, RETRY          @ZA02601 38474061
         MVC   AIBECBA-IEDQAIB(FOUR,RPARM),OPEN SET ID         @ZA02601 38480061
*                                       FOR  FAILURE           @ZA02601 38486061
         LA    RPARM,AIBKEY-IEDQAIB(RPARM) BUMP TO RCB         @ZA02601 38492061
         ST    RPARM,DXCCW10+FOUR       SAVE RCB ADDRESS       @ZA02601 38498061
HAVERCB  EQU   *                                                 Y02027 38540006
         XC    ZERO(RCBSIZE,RPARM),ZERO(RPARM) CLEAR RCB       @ZA02601 38570061
**************************************************************   Y02027 38600006
*****  INITIALIZE RCB WITH DATA REQ'D BY IEDQEU IN MCP MEMORY.   Y02027 38630006
**************************************************************   Y02027 38660006
         USING IEDQRECB,RPARM           ESTABLISH RCB BASE.      Y02027 38690006
         MVI   RECBKEY,PROCKEY          SET RCB KEY.             Y02027 38720006
         MVI   RECBPRI,PROCPRI          SET RCB PRIORITY.        Y02027 38750006
         MVC   RECBQCBA(3),TCXOCQ-IEDQTCX+ONE(RTCX) MOVE OPEN/   Y02027 38780006
*                                       CLOSE QCB ADDR TO RCB    Y02027 38810006
         MVC   RCBTCB+ONE(THREE),DEBTCBAD MOVE TCB ADDR TO RCB.  Y02027 38840006
         L     RENTRY,TIOTPTR(RTCB)     LOAD TIOT ADDR           Y02027 38850006
         MVC   RCBJOBNM,0(RENTRY)       MOVE JOBNAME TO RCB      Y02027 38860006
         MVC   RCBPECB,DCBPECB          MOVE PECB ADDR TO RCB.   Y02027 38870006
         MVC   RCBDSNM,JFCBQNAM         MOVE PROC. QUEUE NAME.   Y02027 38900006
         ST    RDEB,RCBDEBAD            STORE DEB ADDR IN RCB.   Y02027 38930006
         MVC   RCBDCBMA,DCBMACRF        MOVE MACRF TO RCB.       Y02027 38960006
         MVC   RCBDCBDS,DCBDSORG        MOVE DSORG TO RCB.       Y02027 38990006
         MVC   RCBDCBBU,DCBBUFL         MOVE BUF. LGTH TO RCB.   Y02027 39020006
         MVC   RCBDCBLR,DCBLRECL        MOVE LOG REC SIZE TO RCB.Y02027 39050006
         ICM   RENTRY,EIGHT,DCBOPTCD    PUT DCBOPTCD             Y02027 39080006
         ICM   RENTRY,FOUR,DCBRECFM     DCBRECFM                 Y02027 39110006
         ICM   RENTRY,TWO,DCBFLAG1      DCBFLAG1                 Y02027 39140006
         ST    RENTRY,RCBDCBOP          IN RCB FOR EU            Y02027 39170006
         USING PSA,ZERO                                          Y02027 39200006
         L     RENTRY,PSAAOLD           ADDR OF CURRENT ASCB     Y02027 39230006
         ST    RENTRY,RCBASCB           STORE ASCB IN RCB        Y02027 39260006
         LH    RENTRY,ASCBASID-ASCB(RENTRY) ADDR OF SPACE IDENT. Y02027 39290006
         ST    RENTRY,RCBASID           STORE ASID IN RCB        Y02027 39320006
*              PUT RCB ON ASYCHRONOUS READY QUEUE TO ACTIVATE    Y02027 39380006
*              IEDQEU SUBTASK IN MCP                             Y02027 39410006
         TM    TCXFLAG1-IEDQTCX(RTCX),TCXMCPCD TCAM TERMINATED @ZA02601 39418061
         BO    ABORT                    YES, REJECT OPEN       @ZA02601 39420061
         CLC   RCBASID,TCXASID-IEDQTCX(RTCX) MCP SAME ASID     @ZA02601 39422061
         BNE   MCPOK                    NO, BRANCH             @ZA02601 39424061
         L     RENTRY,TCXTCB-IEDQTCX(RTCX) MCP TCB ADDRESS     @ZA02601 39426061
         TM    TCBFLGS-IEDQTCB(RENTRY),TERM MCP TERMINATED     @ZA02601 39428061
         BM    ABORT                    YES, REJECT OPEN       @ZA02601 39430061
MCPOK    EQU   *                                               @ZA02601 39432061
         L     RENTRY,DCBPECB           GET ECB ADDRESS        @ZA02601 39434061
         XC    ZERO(FOUR,RENTRY),ZERO(RENTRY)  CLEAR ECB       @ZA02601 39436061
         L     RENTRY,TCXREADY-IEDQTCX(RTCX)  FIRST ELEMENT      Y02027 39440006
POSTLOOP STCM  RENTRY,AD,RECBLINK-IEDQRECB(RPARM) POINT NEW      Y02027 39470006
*                                       ELEMENT TO FIRST ELEMENT Y02027 39500006
         CS    RENTRY,RPARM,TCXREADY-IEDQTCX(RTCX) CURRENT       Y02027 39530006
*                                       ELEMENT UPDATED?         Y02027 39560006
         BNE   POSTLOOP                 BRANCH IF YES, TRY AGAIN Y02027 39590006
*                                       NO, ASYCN READY QUEUE    Y02027 39620006
*                                       UPDATED WITH ELEMENT     Y02027 39650006
*                                                                Y02027 39680006
*              POST MCP ECB COMPLETE THROUGH CROSS MEMORY POST   Y02027 39710006
*                                                                Y02027 39740006
         L     RENTRY,TCXAVT-IEDQTCX(RTCX)  GET AVT ADDRESS      Y02027 39770006
         LA    RENTRY,AVTOSECB-IEDQAVTD(RENTRY) MCP-ECB ADDRESS  Y02027 39800006
         ST    RENTRY,DXCCW4            STORE IN PARAMETER LIST  Y02027 39830006
         L     RENTRY,CVTPTR            ADDRESS OF CVT           Y02027 39860006
         LA    RENTRY,CVTBRET-CVT(RENTRY) ERROR ADDRESS          Y02027 39890006
         ST    RENTRY,DXCCW4+EIGHT      AND STORE IN LIST        Y02027 39920006
         MVC   DXCCW4+FOUR(4),TCXASCB-IEDQTCX(RTCX) STORE ADDRESSY02027 39950006
*                                       OF ASCB IN LIST          Y02027 39980006
         SR    RZERO,RZERO              ZERO COMPLETION CODE     Y02027 40010006
         LA    RPARM,DXCCW4             ADDRESS OF LIST          Y02027 40100006
         POST  ,(0),MF=(E,(1))                                          40130006
         L     RPARM,DCBPECB            LOAD ECB ADDR.           Y02027 40160006
         WAIT  ECB=RECBKEY              WAIT FOR EU.             Y02027 40190006
         CLI   THREE(RPARM),USERR       WAS PROC ENTRY IN USE    Y02027 40220006
         BE    ABORT2                   YES-ERROR.               Y02027 40250006
         CLI   THREE(RPARM),ALL         WAS PROC. ENTRY FND.     Y02027 40280006
         BE    ABORT1                   NO-ENTRY NOT FOUND.      Y02027 40310006
         CLI   THREE(RPARM),NOTCAM      TCAM ABENDED           @ZA02601 40316061
         BE    ABORT                    YES, REJECT OPEN       @ZA02601 40322061
         CLI   THREE(RPARM),PCBERROR    PCB INVAID             @ZA02601 40328061
         BE    ABORT5                   YES, TAKE ERROR EXIT   @ZA02601 40334061
         CLI   THREE(RPARM),ZERO        DID GETMAIN FAIL.        Y02027 40340006
         BNE    ABORT4                  YES GETMAIN FAILED.      Y02027 40370006
         L     RPARM,DXCCW10+FOUR       RESTORE RCB ADDRESS      Y02027 40400006
         MVC   DEBTAMOS,RCBDEBTA        MOVE TT OFFSET           Y02027 40430006
         MVC   DEBPEWA,RCBDEBPW         MOVE PEWA ADDR           Y02027 40460006
         MVC   DEBPCBAD(3),RCBDEBPC     MOVE PCB ADDRESS         Y02027 40490006
         CLI   DCBRECFM,NULL            WAS RECFM SPECIFIED.     Y02027 40520006
         BNE   RECFMOK                  NO-RECFM NOT SPECIFID.   Y02027 40550006
         MVI   DCBRECFM,UFLG            DEFAULT TO UNDEFINED.    Y02027 40580006
         OI    DEBPCBAD-ONE,FLGU        INDICATE NOT SPECIFIED.  Y02027 40610006
RECFMOK  EQU   *                                                 Y02027 40640006
         MVC   DEBPEBAD,RCBPEBAD        PUT PEB ADDR IN DEB      Y02027 40670006
         TM    RCBSQ,SECURE             SECURE QUEUE             Y02027 40700006
         BZ    MOVEDCB                  BRANCH IF NO             Y02027 40730006
         ST    RPARM,DXCCW2             SAVE RCB ADDR THRU       Y02027 40760006
*                                       GETMAIN                  Y02027 40790006
         LA    RZERO,AREASIZE           MSG SIZE + REPLY         Y02027 40820006
         LA    RPENTRY,SP250             SUBPOOL                 Y02027 40850006
         BAL   RETURN,BLDLIST           LINK TO GETMAIN RTN      Y02027 40880006
         LR    RPENTRY,RPARM            GET MSG AREA             Y02027 40910006
         USING XWORK,RPENTRY                                     Y02027 40940006
         MVC   MSG,REQMSG               INIT WORKAREA            Y02027 40970006
         L     RWORK,DXCCW2             RELOAD RCB ADDR          Y02027 41000006
         MVC   QUEOFF(EIGHT,RPENTRY),RCBDSNM-IEDQRECB(RWORK)     Y02027 41030006
*                                       MOVE QNAME TO MSG        Y02027 41060006
         L     RPARM,TCBTIO             TIOT ADDR                Y02027 41090006
         MVC   JOBOFF(EIGHT,RPENTRY),ZERO(RPARM) JOBNAME TO MSG  Y02027 41120006
REQREPLY EQU   *                                                 Y02027 41150006
         XC    TECB(EIGHT),TECB         CLEAR ECB + REPLY        Y02027 41180006
         WTOR    ,TRTNAREA,1,TECB,MF=(E,(RPENTRY))               Y02027 41210006
         WAIT  ECB=TECB                                          Y02027 41240006
         OI    TRTNAREA,BLANK           FOLD TO CAPS             Y02027 41270006
         LA    RETURN,MOVEDCB           SET RETURN ADDR        @ZA02619 41280061
         CLI   TRTNAREA,YES             OK TO OPEN               Y02027 41300006
         BE    FREECORE                 BRANCH IF YES            Y02027 41330006
         CLI   TRTNAREA,NO              REPLAY NO                Y02027 41360006
         BNE   REQREPLY                 NO, ASK AGAIN            Y02027 41390006
         DROP RPENTRY                                            Y02027 41420006
         LA    RETURN,ABORT6            RETURN ADDRESS IF NO OPENY02027 41450006
FREECORE EQU   *                                                 Y02027 41480006
         FREEMAIN  RC,LV=AREASIZE,A=(RPENTRY),SP=SP250           Y02027 41510006
         BR    RETURN                   RETURN TO CALLER       @ZA02619 41520061
MOVEDCB  EQU   *                        MOVE IF NO ERRORS        Y02027 41540006
         L     RDCBMOVE,DXUDCBAD        LOAD USER DCB ADDR       Y02027 41570006
         SR    RENTRY,RENTRY            ZERO REG                 Y02027 41600006
         IC    RENTRY,DXUDCBPL+ONE      LEN OF NULL PREFIX       Y02027 41630006
         LA    RDCBMOVE,ZERO(RENTRY,RDCBMOVE) PT PAST NULL PREFIXY02027 41660006
         AH    RDCB,DXUDCBPL            INCREMENT PAST PREFIX           41690006
         IC    RENTRY,DXUDCBML+ONE      LEN OF MOVED DCB         Y02027 41720006
         MODESET   KEYADDR=DXUKEY,WORKREG=2  GET INTO USER KEY          41750006
         BCTR  RENTRY,ZERO              DEC FOR MOVE             Y02027 41780006
         EX    RENTRY,DCBMOVE           MOVE DCB COPY TO USER DCBY02027 41810006
         SH    RDCB,DXUDCBPL           POINT TO PREFIX           Y02027 41840006
         B     EXITTST                  EXIT                     Y02027 41870006
DCBMOVE  MVC   ZERO(ZERO,RDCBMOVE),ZERO(RDCB)  MOVE DCB TO REAL  Y02027 41900006
         EJECT                                                          42100020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 42110022
*                                                                CLUP21 42120022
* LOAD THE SPECIFIED ACCESS METHOD MODULE                        CLUP21 42130022
*                                                                CLUP21 42140022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *CLUP21 42150022
LOADER   EQU   *                                                        42200020
         L     RPARM,CVTPTR             ADDRESS THE CVT          A47156 42500022
         L     RPARM,SVCDCB(RPARM)      POINT TO DCB FOR SVCLIB  A47156 43300022
         LA    RZERO,0(RWTG)            MODULE ADDRESS           A47156 44120005
         LOAD  EPLOC=(0),DCB=(1)        LOAD THE MODULE         SA57692 44140005
         BR    RETURN                   AND RETURN               A47156 44160005
         EJECT                                                   Y01004 44180005
*                                                                     * 46100020
*  E Q U A T E S   A N D   C O N S T A N T S                          * 46200020
*                                                                     * 46300020
         SPACE 2                                                        46400020
OSID     DC    C'0S'                    ID OF OS OPEN EXECUTOR          46600020
MODULEID EQU   C'R'                     LOAD MODULE ID CONSTANT  Y02027 47000006
         DS    0F                       FULL WORD ALIGN.         Y02027 47007006
SPCSANFP EQU   241                      SUBPOOL 241.             Y02027 47014006
SPREGUSR EQU   251                      SUBPOOL 251.             Y02027 47021006
FREETYPE EQU   X'20'                    FREEMAIN INDICATOR       Y02027 47028006
SPDEB    EQU   230                      SUB POOL FOR DEB.        Y02027 47035006
REQMSG   WTOR  'IED1690 QNAME          SECURE, MAY          OPEN, REPLYC47042006
               ''Y'' OR ''N''',MF=L,ROUTCDE=8,DESC=2                    47049006
EREQMSG  DS    0F                                                Y02027 47056006
CONFOUR  DC    F'4'                     CONSTANT               @ZA00205 47063061
XTRADEB  EQU   24                       EXTRA CORE FOR DEB APP.  Y01948 47070005
INTVL    DS    0D                                              @SA69652 47270061
         DC    C'00000500'              5 SECOND DELAY         @SA69652 47470061
OPERR    DC    C'4B'                    OPEN ERROR HANDLER       A42380 47800021
FOURK    DC    H'4096'                  LENGTH OF A PAGE       @OZ17630 48700091
         EJECT                                                          49600022
FOUR     EQU   4                        CONSTANT                        49700020
NULL     EQU   0                        CONSTANT                        49800020
ZERO     EQU   0                        OFFSET                   S22024 49810022
FIVE     EQU   5                        OFFSET                   S22024 49820022
SEVEN    EQU   7                        OFFSET                   S22024 49830022
NINE     EQU   9                        OFFSET                   S22024 49840022
TWELVE   EQU   12                       OFFSET                   S22024 49850022
SIXTEEN  EQU   16                       OFFSET                   S22024 49860022
TWENTY2  EQU   22                       OFFSET                   S22024 49870022
TWO      EQU   2                        CONSTANT                        49900020
EIGHT    EQU   8                        CONSTANT                        50000020
C32      EQU   32                       CONSTANT                        50100020
SIX      EQU   6                        CONSTANT                        50200020
CSA      EQU   231                      COMMON SUBPOOL         @ZA02601 50210061
HPAGE    EQU   2048                     HALF PAGE SIZE         @ZA02601 50220061
KEY6     EQU   6                        KEY 6                  @ZA02601 50230061
CLRLOW   DS    0F                       MASK USED TO           @ZA02601 50240061
         DC    X'FFFFF000'              CLEAR 3 LOW BYTES      @ZA02601 50250061
OPEN     DC    C'OPEN'                  OPEN ID                @ZA02601 50260061
LOCMFLG  EQU   X'08'                    LOCATE MODE INDICATOR.   Y02027 50300006
PHYSSEQ  EQU   X'40'                    PHYSICAL SEQUENTIAL.     Y02027 50320006
UFLG     EQU   X'C0'                    RECFM IS UNDEFINED.      Y02027 50340006
FLGU     EQU   X'80'                    RECFM NOT SPECIFIED.     Y02027 50360006
TIOTPTR  EQU   12                       TIOT PTR IN TCB          Y02027 50380006
THREE    EQU   3                        CONSTANT                        50400020
ALL      EQU   15                       4-BYTE ICM MASK          X01004 50450005
GETREAD  EQU   C'G'                     GET/READ MODULE          A47156 50500022
PUTWRITE EQU   C'I'                     PUT/WRITE MODULE         A47156 50512022
CHECK    EQU   C'L'                     CHECK MODULE             A47156 50524022
POINTR   EQU   C'M'                     POINT MODULE             A47156 50530022
ONE      EQU   1                        TO INITIALIZE TRT        A47157 50536022
SVCDCB   EQU   84                       SVCLIB DCB OFFSET        A47156 50548022
SP250    EQU   250                      SUBPOOL 250 ID           CLUP21 50554022
AD       EQU   7                        MASK TO ICM ADDRESSES    Y01004 50560805
TEN      EQU   10                       CONSTANT                 Y02027 50561606
TRTLEN   EQU   256                      TRT TABLE SIZE           A47157 50566022
DEBID    EQU   X'0F'                    DEB IDENTIFIER           CLUP21 50578022
GETTYPE  EQU   X'20'                    TO INDICATE GETMAIN      CLUP21 50584022
DEBIDI   EQU   X'C0'                    TAM DEB ID FOR GET/READ         50600020
POINTFLG EQU   X'04'                    DCBMACR FLAG(POINT)             50900020
AFLAG    EQU   X'8C'                    POST FLAG FOR 102        Y02027 51200006
DEBIDO   EQU   X'CF'                    TCAM DEB ID FOR PUT/WRITECLUP21 51300022
*                                       WORKAREA                        51400020
READFLG  EQU   X'20'                    BSAM MACRF                      51600020
WRITEFLG EQU   READFLG                  DCBMACR BSAM MASK               51700020
PROCKEY  EQU   X'08'                    KEY AND PRIORITY FIELDS         52000020
PROCPRI  EQU   X'F3'                    OPEN ELEMT PRIORITY    @SA70001 52300061
DDNERR   EQU   8                        INVALID QNAME                   52500020
NOTCAM   EQU   4                        TCAM NOT IN SYSTEM              52600020
USERR    EQU   12                       PROCESS ENTRY IN USE     A44886 52700021
GMERR1   EQU   16                       GETMAIN FAILURE - MCP    A44886 52900021
GMERR2   EQU   20                       GETMAIN FAILURE - APPL PROG     53000020
PCBERROR EQU   X'20'                    PCB IN USE BY ANOTHER  @ZA02601 53002061
*                                       APPL PROG   043-8      @ZA02601 53004061
TERM     EQU   X'C0'                    TERNINATION FLAGS      @ZA02601 53006061
QUEOFF   EQU   26                       OFFSET INTO MSG OF QNAME Y02027 53010006
JOBOFF   EQU   47                       OFFSET OF JOBNAME        Y02027 53020006
NO       EQU   C'N'                     REPLY FOR NO             Y02027 53030006
YES      EQU   C'Y'                     REPLY FOR YES            Y02027 53040006
SECURE   EQU   1                        SECURE QUEUES            Y02027 53050006
BLANK    EQU   C' '                     TO FOLD TO CAPS          Y02027 53060006
AREASIZE EQU   EREQMSG-REQMSG+EIGHT     SIZE OF WORKAREA         Y02027 53070006
         EJECT                                                          53080022
*                 *                                                     53400020
*   D S E C T S   *                                                     53500020
*                 *                                                     53600020
XWORK    DSECT                                                   Y02027 53602006
MSG      DS    CL(EREQMSG-REQMSG)       MSG SPACE                Y02027 53604006
TECB     DS    F                        WTOR ECB                 Y02027 53606006
TRTNAREA DS    F                        REPLY AREA               Y02027 53608006
         TRECBD                                                  Y02027 53610006
*****************************************************************Y02027 53612006
*****    RCB EXTENSION FOR TCAM APPLICATION OPEN/CLOSE.          Y02027 53614006
*****************************************************************Y02027 53616006
RCBPECB  DS    F                        APPLIC. PGM PECB ADDR.   Y02027 53618006
RCBASCB  DS    F                        APPLIC. PGM ASCB ADDR.   Y02027 53620006
RCBERRET DS    0F                       ERROR RTN ADDR           Y02027 53622006
RCBASID  DS    F                        APPLIC. PGM ASID ADDR.   Y02027 53624006
RCBTCB   DS    F                        APPLIC. PGM TCB ADDR.    Y02027 53626006
RCBDCBMA DS    H                        DCBMACRF FROM APPLIC.    Y02027 53628006
RCBTCBFL DS    0X                       APPLIC. TCB FLAGS.       Y02027 53630006
RCBDCBDS DS    H                        DCBDSORG FROM APPLIC.    Y02027 53632006
RCBDSNM  DS    CL8                      PROCESS QUEUE NAME.      Y02027 53634006
RCBDEBAD DS    F                        DEB ADDR FOR APPLIC. DCB.Y02027 53636006
RCBDCBBU DS    H                        DCBBUFL FROM APPLIC.     Y02027 53638006
RCBDCBLR DS    H                        DCBLRECL FROM APPLIC.    Y02027 53640006
RCBDCBOP DS    X                        DCBOPTCD FROM APPLIC.    Y02027 53642006
RCBDCBRF DS    X                        DCBRECFM FROM APPLICATIONY02027 53644006
RCBDCBF1 DS    X                        DCBFLAG1 FROM APPLICATIONY02027 53646006
RCBERR   DS    X                        ERROR INDICATOR          Y02027 53648006
RCBJOBNM DS    CL8                      JOBNAME                  Y02027 53649006
RCBSAVE  DS    18F                      SAVE AREA FOR IEDQEU   @ZA02601 53649561
RCBEND   DS    0X                       END OF DSECT.            Y02027 53650006
         ORG   RCBTCB                                                   53652006
RCBDEBTA DS    H                        OFFSET IN T.T. FOR ENTRY.Y02027 53654006
RCBOPECB DS    0AL3                     OPCTL ECB ADDRESS        Y02027 53656006
RCBDEBPW DS    AL3                      ADDR. OF PEWA.           Y02027 53658006
RCBDEBPC DS    AL3                      ADDR. OF PCB.            Y02027 53660006
         DS    2F                       QNAME                    Y02027 53662006
RCBSQ    DS    0X                       SECURE QUEUE FLAG        Y02027 53664006
RCBAVTBT DS    X                        AVTBIT1 ON RETURN FROM EUY02027 53666006
RCBPEBAD DS    AL3                      READ-AHEAD QCB ADDR.     Y02027 53668006
RCBSIZE  EQU   RCBEND-RECBKEY           SIZE OF DSECT.           Y02027 53670006
         SPACE 2                                                        53700020
         DCBD DSORG=PS                  DATA CONTROL BLOCK              53800020
         ORG   DCBIOBAD                                          Y02027 53808006
DCBPECB  DS    A                        ADDR OF PECB             Y02027 53816006
         IHAPSA                                                  Y02027 53824006
         IHAASCB                                                        53832006
         IHAASVT                                                 Y02027 53840006
CVT      DSECT                                                   Y02027 53848006
         CVT                                                     Y02027 53856006
         IEZJSCB                                                 Y02027 53864006
         TPECBD                                                  Y02027 53872006
         IHARB                                                          53880006
         TTCXD                                                   Y02027 53888006
         TAIBD                                                 @ZA02601 53894061
         TAVTD                          ADDRESS VECTOR TABLE            53900020
         TTCBD                          TASK CONTROL BLOCK              54200020
FORCORE  DSECT                          OPEN WORKAREA                   54300020
         IECDSECT                                                       54400020
         EJECT                                                          54500005
         TDEBAPD                                                        54800020
         END                                                            75200020
