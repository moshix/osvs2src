         TITLE 'IGG01948 LAST LOAD OF LINE OPEN'                        00200020
IGG01948 CSECT                                                          00250022
         SPACE 3                                                        00260005
*  CHANGE ACTIVITY AS FOLLOWS                                           00270005
******************** MICROFICHE FLAGS *********************** SUPT CODE 00280005
*C224000                                                         Y01004 00280105
*A002000,180000,428000,785200,824000                             A51081 00300005
*D458000,785600,816000,823000,826000-828000                      A51081 00300105
*A 032300,200030,807000                                          S22026 00300205
*C    CLEANUP                                                    S22025 00300305
*C784600,785400                                                 SA62959 00300405
*C005000,050000,060000,094000-098000,200330,200420,212000,214000 Y02027 00300506
*C232000-236000,798000,802000-806000,808000-824000               Y02027 00300606
*D052000,062000,200450,238000                                    Y02027 00300706
*A174600,175200,200440,200460,200610,237000                      Y02027 00300806
*A502600,665000,868600,869200                                    Y02027 00300906
*C590000-618000,626000-628000,796000                           @ZA04001 00320909
*C556400                                                       @OZ16529 00321091
*C556400                                                       @OZ16529 00321100
*D550200-556000                                                @OZ29413 00321286
*A556600,842000                                                @OZ29413 00321386
*                                                                       00350005
         SPACE 3                                                        00370005
*********************************************************************** 00400005
*                                                                     * 00410005
*  TITLE:  'IGG01948' -- LAST LOAD OF LINE OPEN                       * 00420005
*                                                                     * 00430005
*  MODULE NAME = IGG01948                                             * 00440005
*                                                                     * 00450005
*  DESCRIPTIVE NAME = LAST LOAD OF LINE OPEN                          * 00460005
*                                                                     * 00470005
*  COPYRIGHT = 'NONE'                                                 * 00480005
*                                                                     * 00490005
*  STATUS = CHANGE LEVEL 6                                       Y02027 00500006
*                                                                     * 00600020
*FUNCTION/OPERATION - THIS ROUTINE FILLS IN THE USER REQUESTED        * 00800020
*   CROSS REFERENCE TABLE WITH THE FOLLOWING INFORMATION FOR          * 01000020
*   EACH LINE THAT IS OPENED, THE UCB NAME, THE ADDRESS OF THE        * 01200020
*   UCB, THE ADDRESS OF THE LCB, AND THE ADDRESS OF THE MASTER        * 01400020
*   QCB.  IT ALSO TESTS EACH LINE TO SEE THAT THE LINE HAS            * 01600020
*   COMPLETED ITS INITIAL I/O OPERATIONS SUCCESSFULLY.  IN THE        * 01800020
*   EVENT A LINE HAS NOT COMPLETED NORMALLY, A TEST IS MADE TO        * 02000020
*   SEE IF 28 SECONDS HAS ELAPSED SINCE THIS MODULE WAS FIRST         * 02200020
*   ENTERED.  IF THE TIME HAS ELAPSED, AN ERROR MESSAGE OF THE        * 02400020
*   FORM 'IED079I ENDING STATUS NOT RECEIVED FROM LINE XXX -          * 02600020
*   LINE UNAVAILABLE' IS WRITTEN TO THE SYSTEM CONSOLE.  IF THE       * 02800020
*   FULL TIME HAS NOT ELAPSED, WE TEST AGAIN FOR COMPLETION OF        * 03000020
*   THE INITIAL I/O OPERATION.                                        * 03200020
*   FOR CONCENTRATOR DATA READY QUEUE QCB'S, THE ROUTINE         S22026 03230022
*   ENTERS IN THE QCB STCB THE ADDRESS OF THE CONCENTRATOR       S22026 03260022
*   SEND SCHEDULER PLUS OFFSET, IN PLACE OF THE DESTINATION      S22026 03290022
*   SCHEDULER.  THIS ADDRESS EXISTS ONLY AFTER THE               S22026 03320022
*   CONCENTRATOR SEND SCHEDULER HAS BEEN LOADED INTO CORE.       S22026 03350022
*                                                                     * 03400020
*ENTRY POINTS - THIS ROUTINE IS ENTERED AT IGG01948 VIA AN XCTL       * 03600020
*   FROM IGG01940 OR IT MAY BE RE-ENTERED FROM THE RELOOP PORTION     * 03800020
*   OF THIS ROUTINE IF IT IS DETERMINED THAT ANOTHER DATA CONTROL     * 04000020
*   BLOCK IS TO BE PROCESSED BY IGG01948.                             * 04200020
*                                                                     * 04400020
*INPUT THE REGISTERS 5,6,7, AND 8 ARE THE INPUT AS FOLLOWS :          * 04600020
*                                                                     * 04800020
*   5 - THE ADDRESS OF THE WTG TABLE PREFIX                      Y02027 05000006
*                                                                     * 05400020
*   6  - THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE        * 05600020
*                                                                     * 05800020
*   7 - THE ADDRESS OF THE COPY OF THE CURRENT DCB               Y02027 06000006
*                                                                     * 06400020
*   8  - THE ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO TABLE    * 06600020
*                                                                     * 06800020
*OUTPUT - INFORMATION REGARDING EACH LINE OPENED IS ENTERED IN        * 07000020
*   IN THE CROSS REFERENCE TABLE IF ONE IS REQUESTED, AND EACH        * 07200020
*   LINE IN THE LINE GROUP IS TESTED TO SEE THAT IT HAS               * 07400020
*   COMPLETED ITS INITAIL I/O OPERATIONS SUCCESSFULLY.                * 07600020
*                                                                     * 07800020
*EXTERNAL ROUTINES - NONE                                             * 08000020
*                                                                     * 08200020
*EXITS - THIS ROUTINE EXITS VIA AN XCTL TO THE EXECUTOR               * 08400020
*   IDENTIFIED BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO          * 08600020
*   TABLE                                                             * 08800020
*                                                                     * 09000020
*TABLES/WORK AREAS - THE WHERE-TO-GO TABLE CONTAINS THE ID            * 09200020
*   AND TTR OF THE REQUIRED EXECUTORS.  THE WHERE-TO-GO          Y02027 09400006
*   TABLE PREFIX CONTAINS THE ADDRESS OF A COPY OF EACH          Y02027 09600006
*   DCB SPECIFIED IN THE OPEN MACRO INSTRUCTION.                 Y02027 09800006
*                                                                     * 10000020
*ATTRIBUTES - THIS ROUTINE IS EXECUTED IN THE TRANSIENT AREA          * 10200020
*   AS ENABLED, PRIVILEGED, AND RE-ENTRANT.                           * 10400020
*                                                                     * 10600020
*********************************************************************** 10700005
         EJECT                                                          10800020
*                                                                       11200020
*    REGISTER USAGE                                                     11400020
*                                                                       11600020
RE       EQU   0                        WORK REGISTER                   11800020
RF       EQU   1                        WORK REGISTER                   12000020
RDCB     EQU   2                        ADDRESS OF THE CURRENT DCB      12200020
RTIOT    EQU   3                        WORK REGISTER                   12400020
RCORE    EQU   4                        ADDRESS OF DCB WORK AREA        12600020
RPAR     EQU   5                        ADDRESS OF FIRST ENTRY IN       12800020
*                                         DCB PARAMETER LIST            13000020
RWTG     EQU   6                        ADDRESS OF THE WHERE-TO-GO      13200020
*                                         TABLE                         13400020
RPARC    EQU   7                        ADDRESS OF THE CURRENT          13600020
*                                         ENTRY IN DCB PARAMETER        13800020
*                                         LIST                          14000020
RWTGC    EQU   8                        ADDRESS OF THE CURRENT          14200020
*                                         ENTRY IN THE WTG TABLE        14400020
RAVT     EQU   9                        ADDRESS OF THE AVT              14600020
RUCB     EQU   10                       WORK REGISTERWORK REGISTER      14800020
RDEB     EQU   11                       WORK REGISTER                   15000020
RBASE    EQU   12                       BASE OF THIS ROUTINE            15200020
RC       EQU   13                       WORK REGISTER                   15400020
RD       EQU   14                       WORK REGISTER                   15600020
RJ       EQU   15                       WORK REGISTER                   15800020
*                                                                       16000020
         USING IEDQAVTD,RAVT            AVT DSECT                       16200020
         USING IHADCB,RDCB              DCB DSECT                       16400020
         USING IEDQQCB,RD               QCB DSECT                       16600020
         USING IEDQLCB,RC               LCB DSECT                       17000020
         USING FORCORE,RF               OPEN WORK AREA DSECT            17200020
         USING IEDQDEB,RDEB             DEB DSECT                       17400020
         USING CVTD,RJ                  CVT DSECT                Y02027 17460006
         USING IEDQTCX,RJ               TCX DSECT                Y02027 17520006
*                                                                       17600020
         BALR  RBASE,0                  SET UP BASE REGISTER            17800022
         USING *,RBASE                                                  18000020
         SPACE 2                                                        18050006
IGG01948 IEDHJN DATE                    MODULE ID AND DATE       S22025 18100022
         EJECT                                                          18200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     18400020
*                                                                 *     18600020
*        THIS SECTION OF CODE GETS THE TIME OF DAY WHEN THIS      *     18800020
*        MODULE IS ENTERED FROM THE OPEN MODULE IGG01940          *     19000020
*                                                                 *     19200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     19400020
         TIME  BIN                      GET THE TIME OF DAY             19600020
*                                                                       19800020
         LR    RCORE,RE                 COPY THE TIME OF DAY            20000020
         EJECT                                                   S22026 20003022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  S22026 20006022
*                                                                S22026 20009022
* FOR CONCENTRATOR DATA READY QUEUE QCB'S, ENTER IN QCB STCB THE S22026 20012022
* ADDRESS OF THE CONCENTRATOR SEND SCHEDULER PLUS OFFSET IN      S22026 20015022
* PLACE OF THE DESTINATION SCHEDULER.  THE MOVE IS NOT DONE IF   S22026 20018022
* QCBSTCHN EQUALS QCBSLINK, INDICATING THAT THE LINE GROUP WAS   S22026 20021022
* NOT OPENED.                                                    S22026 20024022
*                                                                S22026 20027022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  S22026 20030022
*                                                                S22026 20033022
         L     RJ,CVTPTR                ADDRESS OF CVT           Y02027 20036006
         USING CVTD,RJ                  CVT DSECT                Y02027 20038006
         L     RJ,CVTAQAVT              ADDRESS OF THE           Y02027 20040006
*                                       TCAM EXTENSION           Y02027 20042006
         USING IEDQTCX,RJ               TCX DSECT                Y02027 20044006
         L     RAVT,TCXAVT              ADDR OF TCAM AVT         Y02027 20046006
         TM    AVTSCOPT,AVTCONC+AVTCONCO  ARE ANY CONCENTRATORS  S22026 20048022
*                                           IN SYSTEM            S22026 20051022
         BZ    CONCEND                  NO, BYPASS INSERTION     S22026 20054022
         L     RJ,AVTRNMPT              ADDRESS OF THE TERMNAME  S22026 20057022
*                                         TABLE                  S22026 20060022
         USING IEDQTNTD,RJ              TERMNAME TABLE DSECT     Y02027 20061006
         LH    RF,TNTLEN                THE NUMBER OF ENTRIES IN S22026 20063022
*                                         THE TERMNAME TABLE     S22026 20066022
         LA    RDEB,TNTFIRST            ADDRESS OF FIRST ENTRY   S22026 20069022
         SR    RC,RC                    CLEAR LENGTH REGISTER    S22026 20072022
         IC    RC,TNTENLEN              LENGTH OF COMPARAND      S22026 20075022
*                                         FIELD                  S22026 20078022
         L     RTIOT,AVTCSCH            ADDR OF CONC SCHEDULER   S22026 20081022
         LA    RTIOT,CSO(RTIOT)         ADDR OF CONC SCHEDULER   S22026 20084022
*                                         PLUS OFFSET            S22026 20087022
TERMAD   LA    RDEB,0(RC,RDEB)          TERMINAL TABLE ADDRESS   S22026 20090022
         MVC   AVTGETMN+5(THREE),0(RDEB) MOVE CURRENT TERMINAL   S22026 20093022
*                                         ADDRESS INTO A SCRATCH S22026 20096022
*                                         AREA TO ALLIGN         S22026 20099022
         L     RD,AVTGETMN+4            LOAD THE TERMINAL ADDR   S22026 20102022
         L     RD,0(RD)                 ADDRESS OF THE           S22026 20105022
*                                         DESTINATION QCB        S22026 20108022
         LA    RD,0(RD)                 CLEAR HIGH ORDER BYTE    S22026 20111022
         CLI   QCBDSFLG,QCBDRQQ         IS THIS A DATA READY     S22026 20114022
*                                         QUEUE QCB              S22026 20117022
         BNE   TERMADL                  NO,GO CHECK NEXT QCB     S22026 20120022
         CLC   QCBSTCHN(THREE),QCBSLINK   IS SAME SUBTASK LINKED S22026 20123022
*                                           INTO BOTH FIELDS     S22026 20126022
         BE    TERMADL                  YES, SO NOT OPENED       S22026 20129022
         IC    RJ,QCBSTVTO              SAVE VECTOR TABLE OFFSET S22026 20132022
         ST    RTIOT,QCBSTCHN-1         ENTER ADDRESS OF CONC    S22026 20135022
*                                         SCHEDULER PLUS OFFSET  S22026 20138022
         STC   RJ,QCBSTVTO              RESTORE VECTOR TABLE     S22026 20141022
*                                         OFFSET                 S22026 20144022
TERMADL  LA    RDEB,3(RDEB)             BUMP TERMNAME TABLE ADDR S22026 20147022
         BCT   RF,TERMAD                DECREASE ENTRIES BY 1    S22026 20150022
CONCEND  EQU   *                                                 S22026 20153022
         BALR  RBASE,0                  SET UP BASE REGISTER            20400022
         USING *,RBASE                                                  20600020
*                                                                       20800020
RESTART  EQU   *                                                        21000020
         L     RF,OPWKAD(RWTGC)         LOAD OPEN WK AREA ADDR   Y02027 21200006
         L     RDCB,DXUDCBAD            LOAD USER DCB ADDR.      Y02027 21400006
         LA    RDCB,0(RDCB)             CLEAR THE HIGH ORDER BYTE       21600020
*                                         OF THE DCB ADDRESS            21800020
         LA    RJ,DEBPRFSZ              LOAD THE LENGTH OF THE DEB      22000020
*                                         PREFIX                        22200020
         L     RDEB,DCBDEBAD            ADDR OF THE DEB.         Y02027 22400006
*                                         FOR THIS DCB                  22600020
         SR    RDEB,RJ                  SET THE DSECT BASE FOR THIS     22800020
*                                         DEB                           23000020
         L     RJ,CVTPTR                ADDRESS OF CVT           Y02027 23200006
         USING CVTD,RJ                  CVT DSECT                Y02027 23300006
         L     RJ,CVTAQAVT              ADDRESS OF THE           Y02027 23400006
*                                       TCAM EXTENSION           Y02027 23500006
         USING IEDQTCX,RJ               TCX DSECT                Y02027 23600006
         L     RAVT,TCXAVT              ADDR OF TCAM AVT         Y02027 23700006
         LA    RJ,CROSSREF              LOAD THE ADDRESS OF THE         24000020
*                                         CROSS REFERENCE ROUTINE       24200020
DCBLOAD  EQU   *                                                        24400020
         L     RC,DCBIOBAD              LOAD THE BEGINNING ADDRESS      24600020
*                                         OF THE IOB                    24800020
         LA    RTIOT,IOBPTR             LOAD THE IOB OFFSET             25000020
         SR    RC,RTIOT                 LOCATE THE BEGINNING ADDRESS    25200020
*                                         OF THE LCB                    25400020
         SR    RE,RE                    CLEAR A LINE REGISTER           25600020
         IC    RE,DEBNMEXT              GET THE NUMBER OF LINES         25800020
         SR    RD,RD                    WORK REGISTERS                  26000020
         IC    RD,DCBEIOBX              GET THE SIZE OF ONE LCB         26200020
         SR    RTIOT,RTIOT              CLEAR A WORK REGISTER           26400020
BRANCH   EQU   *                                                        26500020
         BR    RJ                       BRANCH TO THE ROUTINE WHOSE     26600020
*                                         ADDRESS IS IN RJ              26800020
         EJECT                                                          27000020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     27200020
*                                                                 *     27400020
*        THIS SECTION OF CODE FILLS IN THE USER REQUESTED         *     27600020
*        CROSS REFERENCE TABLE WITH THE FOLLOWING INFORMATION     *     27800020
*        THE UCBNAME, THE ADDRESS OF THE UCB, THE ADDRESS OF      *     28000020
*        THE LCB ASSOCIATED WITH THIS PARTICULAR UCB, AND THE     *     28200020
*        ADDRESS OF  THE QCB FOR THIS PARTICULAR DEVICE           *     28400020
*                                                                 *     28600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     28800020
CROSSREF EQU   *                                                        29000020
         NC    AVTCRSRF(4),AVTCRSRF     HAS A CROSS REFERENCE TABLE     29200020
*                                         BEEN REQUESTED                29400020
         BZ    TESTLINE                 NO, BRANCH                      29600020
         L     RJ,AVTCRSRF              LOAD THE ADDRESS OF THE         29800020
*                                         CROSS REFERENCE TABLE         30000020
         AR    RC,RD                    ACCESS THE BEGINNING ADDRESS    30200020
*                                         OF THE FIRST LCB              30400020
         SR    RF,RF                    CLEAR AN INCREMENT REGISTER     30600020
ENTRY    EQU   *                                                        30800020
         CLC   ONE(THREE,RJ),FIVE(RJ)   HAVE WE USED THE LAST ENTRY     31000020
*                                         IN THE CROSS REFERENCE        31200020
*                                         TABLE                         31400020
         BH    RESTORE                  YES, BRANCH                     31600020
         L     RTIOT,0(RJ)              LOAD THE ADDRESS OF THE         31800020
*                                         FIRST AVAILABLE ENTRY IN      32000020
*                                         THE TABLE                     32200020
         MVC   0(FOUR,RJ),0(RTIOT)      MOVE THE ADDRESS OF THE         32400020
*                                         NEXT AVAILABLE ENTRY          32600020
*                                         INTO THE AVAILABLE            32800020
*                                         POSITION                      33000020
         L     RUCB,DEBUCBAD(RF)        LOAD THE ADDRESS OF THE         33200020
*                                         FIRST/NEXT UCB                33400020
         LTR   RUCB,RUCB                IS THIS A // DD DUMMY ENTRY     33600020
         BZ    UPDATLCB                 YES, BRANCH                     33800020
         MVC   0(4,RTIOT),UCBNAME(RUCB) MOVE THE UCBNAME INTO THE       34000020
*                                         FIRST POSITION IN THE         34200020
*                                         CROSS REFERENCE TABLE         34400020
         ST    RUCB,FOUR(RTIOT)         STORE THE ADDRESS OF THE        34600020
*                                         UCB IN THE SECOND POSITION    34800020
*                                         IN THE TABLE                  35000020
         ST    RC,EIGHT(RTIOT)          STORE THE ADDRESS OF THE        35200020
*                                         LCB IN THE THIRD POSITION     35400020
*                                         IN THE TABLE                  35600020
         B     QCBRTNE                  BRANCH TO THE QCB LOCATOR       35800020
*                                         ROUTINE                       36000020
QCBMOVE  EQU   *                                                        36200020
         MVC   QCBSPOT(THREE,RTIOT),AVTGETMN+1  MOVE THE QCB ADDRESS    36400020
*                                         INTO THE FOURTH POSITION      36600020
*                                         IN THE TABLE                  36800020
UPDATLCB EQU   *                                                        37000020
         LA    RC,0(RD,RC)              LOAD THE ADDRESS OF THE LCB     37200020
*                                         FOR THE NEXT LINE             37400020
         LA    RF,FOUR(RF)              INCREMENT THE INDEX REGISTER    37600020
*                                         BY FOUR                       37800020
         BCT   RE,ENTRY                 DECREMENT THE LINE COUNT        38000020
*                                         AND BRANCH                    38200020
RESTORE  EQU   *                                                        38400020
         LA    RJ,TESTLINE              LOAD THE ADDRESS OF THE         38600020
*                                         LINE TEST ROUTINE             38800020
         B     DCBLOAD                  RESET CERTAIN REGISTERS         39000020
*                                                                       39200020
         EJECT                                                          39400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     39600020
*                                                                 *     39800020
*        THIS SECTION OF CODE TESTS EACH LINE TO                  *     40000020
*          SEE THAT IT HAS COMPLETED NORMALLY                     *     40200020
*                                                                 *     40400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     40600020
TESTLINE EQU   *                                                        40800020
         LR    RUCB,RE                  COPY THE NUMBER OF EXTENTS      41000020
         SR    RDCB,RDCB                CLEAN AN INDEX REGISTER         41200020
NEXTLCB  EQU   *                                                        41400020
         AR    RC,RD                    LOCATE THE STARTING ADDRESS     41600020
*                                         OF THE FIRST/NEXT LCB         41800020
         L     RE,DEBUCBAD(RDCB)        LOAD THE UCB ADDRESS FOR        42000020
*                                         THIS LINE                     42200020
         LTR   RE,RE                    IS THIS A // DD DUMMY ENTRY     42400020
         BZ    BCT                      YES, BRANCH                     42600020
TESTPCD  EQU   *                                                        42800020
         CLI   LCBSIOCC,CC3             CONTROL UNIT NOT OPER.   A51081 42860022
         BE    BCT                      BR YES, SAVE FOR ERP     A51081 42920022
         CLI   LCBTPCD,NOTCOMPT         HAS THE INITIAL I/O             43000020
*                                         COMPLETED ON THIS LINE        43200020
         BE    TESTDLAY                 NO, BRANCH                      43400020
BCT      EQU   *                                                        43600020
         LA    RDCB,FOUR(RDCB)          INCREMENT THE POINTER TO        43800020
*                                         THE NEXT UCB ADDRESS          44000020
         BCT   RUCB,NEXTLCB             IT HAS COMPLETED, TEST THE      44200020
*                                         NEXT LINE                     44400020
         EJECT                                                          44600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     44800020
*                                                                 *     45000020
*        XCTL TO THE NEXT ENTRY IN THE WHERE-TO-GO TABLE                45200020
*                                                                 *     45400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     45600020
         XC    0(2,RWTGC),0(RWTGC)      CLEAR ID TO INDICATE            46000020
*                                         LINE GROUP COMPLETION         46200020
         L     RF,FOUR(RWTGC)           LOAD THE ADDRESS OF THE         46260020
*                                         OPEN WORK AREA                46320020
RELOOP   EQU   *                                                        46600020
         LA    RWTGC,8(RWTGC)           INCREMENT CURRENT WTG           46800020
*                                         POINTER                       47000020
         LA    RPARC,4(RPARC)           INCREMENT CURRENT DCB           47200020
*                                         POINTER                       47400020
         CLC   0(2,RWTGC),AMIDCNST      IS IGG01940 NEEDED AGAIN        47600020
         BE    RESTART                  YES, BRANCH                     47800020
         CLC   0(2,RWTGC),OPIDCNST      HAVE WE REACHED THE END OF      48000020
*                                         THE WHERE-TO-GO TABLE         48200020
         BNE   RELOOP                   CHECK NEXT WTG ENTRY            48400020
         LR    RPARC,RPAR               REINITIALIZE CURRENT WTG &      48600020
         LA    RWTGC,32(RWTG)           DCB POINTERS                    48800020
ZCHECK   EQU   *                                                        49000020
         CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETE          49200020
         BNE   XCTLRTNE                 NO, XCTL TO NEXT LOAD           49400020
         LA    RWTGC,8(RWTGC)           INCREMENT CURRENT WTG & DCB     49600020
         LA    RPARC,4(RPARC)           POINTERS                        49800020
         B     ZCHECK                   CHECK NEXT ENTRY                50000020
XCTLRTNE EQU   *                                                        50200020
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           Y02027 50260006
         SPACE 2                                                        50320006
         LA    RJ,DXCCW12               GET A DOUBLE WORD ADDRESS       50400020
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID AND TTR TO THE          50600020
         MVC   14(3,RWTG),2(RWTGC)      WTG TABLE                       50800020
         XCTL  DE=(RWTG),SF=(E,(15))    TRANSFER CONTROL                51000020
*                                                                       51200020
         EJECT                                                          51400020
TESTDLAY EQU   *                                                        51600020
         LTR   RTIOT,RTIOT              HAVE WE DELAYED                 51800020
         BZ    DELAY                    NO, BRANCH                      52000020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     52200020
*                                                                 *     52400020
*    THIS SECTION OF CODE WRITES THE LINE UNAVAILABLE MESSAGE     *     52600020
*                                                                 *     52800020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     53000020
         SR    RF,RF                    CLEAR A LINE REGISTER           53200020
         IC    RF,DEBNMEXT              GET THE NUMBER OF LINES IN      53400020
*                                         IN THIS LINE GROUP            53600020
         SR    RF,RUCB                  GET THE NUMBER OF THE LINE      53800020
*                                         THAT HAS NOT COMPLETED        54000020
         SLL   RF,TWO                   MULTIPLY THE LINE NUMBER BY     54200020
*                                         FOUR                          54400020
         L     RJ,DEBUCBAD(RF)          LOAD THE UCB ADDRESS FOR        54600020
*                                         THIS LINE                     54800020
         L     RF,FOUR(RWTGC)           LOAD THE ADDRESS OF THE         54860020
*                                         OPEN WORK AREA                54920020
         LA    RF,DXCCW                 LOAD A SCRATCH AREA ADDRESS     55620020
         MVC   0(MSGEND+FOUR-MESSAGE,RF),MESSAGE  MOVE MSG INTO@OZ16529 55640000
*                                        THE OPEN WORK AREA             55660020
         MVC   LINENO(THREE,RF),UCBNAME+1(RJ) MOVE THE UCB     @OZ29413 55660186
*                                             NAME TO THE LINE @OZ29413 55660286
*                                             UNAVAILABLE MSG  @OZ29413 55660386
         SVC   WTO                                                      55680020
*                                                                       55700020
*                                                                       56400020
         MVI   LCBSTAT1,LCBRECVN+LCBSENDN    INDICATE THAT AN           56410020
*                                            INITIAL INTERRUPT HAS      56420020
*                                         NOT BEEN RECEIVED FOR         56430020
*                                         THIS LINE                     56440020
         B     BCT                      CHECK THE NEXT LINE             56600020
         EJECT                                                          56800020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     57000020
*                                                                 *     57200020
*        THIS SECTION OF CODE COMPUTES THE AMOUNT OF ELAPSED      *     57400020
*        TIME BY COMPARING THE PRESENT TIME OF DAY WITH THE       *     57600020
*        TIME WHEN THIS MODULE WAS ENTERED FROM IGG01940          *     57800020
*                                                                 *     58000020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     58200020
DELAY    EQU   *                                                        58400020
         TIME  BIN                      GET THE CURRENT TIME            58600020
*                                                                       58800020
         CR    RE,RCORE                 IS CURRENT TIME VALUE  @ZA04001 59000009
*                                        LESS THAN INITIAL TIME@ZA04001 59400009
         BNL   COMPUTE                  NO, BRANCH             @ZA04001 60000009
*                                                              @ZA04001 60400009
         AL    RE,ONEDAY                ADD ONE DAY'S TIME TO  @ZA04001 61000009
*                                        THE CURRENT TIME      @ZA04001 61400009
COMPUTE  EQU   *                                                        62000020
         SLR   RE,RCORE                 COMPUTE THE AMOUNT OF           62200020
*                                         ELAPSED TIME                  62400020
         C     RE,LIMIT                 HAS LIMIT BEEN REACHED @ZA04001 62600009
         BL    TESTPCD                  NO, TEST AGAIN FOR LINE         63000020
*                                         COMPLETION                    63200020
         LR    RTIOT,RBASE              INDICATE THAT THE DELAY HAS     63400020
*                                         COMPLETED                     63600020
         B     TESTPCD                  TEST FOR LINE COMPLETION        63800020
*                                         AGAIN                         64000020
         EJECT                                                          64200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     64400020
*                                                                 *     64600020
*        THIS SECTION OF CODE IS A SUBROUTINE OF THE AVT CROSS    *     64800020
*        REFERENCE ROUTINE AND IS USED TO LOCATE THE MASTER QCB   *     65000020
*        ASSOCIATED WITH THIS PARTICULAR UCB.                     *     65200020
*                                                                 *     65400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     65600020
QCBRTNE  EQU   *                                                        65800020
         STM   RE,RJ,AVTSAVE4           SAVE ALL REGISTERS              66000020
         L     RJ,AVTRNMPT              LOAD THE ADDRESS OF THE         66200020
*                                         TERMNAME TABLE                66400020
         USING IEDQTNTD,RJ              TERMNAME TABLE DSECT     Y02027 66500006
         SR    RTIOT,RTIOT              CLEAR A WORK REGISTER           66600020
         IC    RTIOT,DEBNMEXT           INSERT THE NUMBER OF LINES      66800020
*                                         ASSOCIATED WITH THIS DCB      67000020
         SR    RTIOT,RE                 COMPUTE THE RELATIVE LINE       67200020
*                                         NUMBER MINUS 1 FOR THIS       67400020
*                                         LINE                          67600020
         LH    RE,TNTLEN                LOAD THE NUMBER OF ENTRIES      67800020
*                                         IN THE TERMNAME TABLE         68000020
         LA    RTIOT,ONE(RTIOT)         SET THE ACTUAL RELATIVE         68200020
*                                         LINE NUMBER                   68400020
         SR    RF,RF                    CLEAR A WORK REGISTER           68600020
         IC    RF,TNTENLEN              GET THE SIZE OF THE             68800020
*                                         COMPARAND FIELD IN AN         69000020
*                                         ENTRY                         69200020
         LA    RC,TNTFIRST              LOAD THE ADDRESS OF THE         69400020
*                                         FIRST ENTRY IN THE TABLE      69600020
TNTLOOP  EQU   *                                                        69800020
         LA    RC,0(RF,RC)              ACCESS THE TERMINAL TABLE       70000020
*                                         ADDRESS PORTION OF THE        70200020
*                                         ENTRY                         70400020
         MVC   AVTGETMN+1(3),0(RC)      MOVE THE TERMINAL TABLE         70600020
*                                         ADDRESS TO A SCRATCH AREA     70800020
         L     RD,AVTGETMN              LOAD THE TERMINAL TABLE         71000020
*                                         ADDRESS OF THE ENTRY          71200020
         L     RD,0(RD)                 LOAD THE ADDRESS OF THE         71400020
*                                         DESTINATION QCB               71600020
         L     RUCB,QCBRELLN            LOAD THE ADDRESS OF THE DCB     71800020
*                                         FOR THIS QCB                  72000020
         LA    RUCB,0(RUCB)             CLEAR THE HIGH ORDER BYTE       72200020
*                                         OF THE ADDRESS                72400020
         CR    RUCB,RDCB                ARE THE DCB ADDRESSES THE       72600020
*                                         SAME                          72800020
         BNE   QCBLOOP                  NO, BRANCH                      73000020
         SR    RUCB,RUCB                CLEAR A LINE NUMBER REGISTER    73200020
         IC    RUCB,QCBRELLN            INSERT THE RELATIVE LINE        73400020
*                                         BUMBER ASSOCIATED WITH        73600020
*                                         THIS QCB                      73800020
         CR    RTIOT,RUCB               ARE THE RELATIVE LINE           74000020
*                                         NUMBERS THE SAME              74200020
         BNE   QCBLOOP                  NO, BRANCH                      74400020
         ST    RD,AVTGETMN              SAVE THE QCB ADDRESS UNTIL      74600020
*                                         A LATER POINT IN TIME         74800020
QCBRETRN EQU   *                                                        75000020
         LM    RE,RJ,AVTSAVE4           RESTORE THE REGISTERS           75200020
         B     QCBMOVE                  BRANCH TO STORE THE QCB         75400020
*                                         ADDRESS                       75600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     75800020
QCBLOOP  EQU   *                                                        76000020
         LA    RC,THREE(RC)             ACCESS THE NEXT ENTRY IN        76200020
*                                         THE TERMNAME TABLE            76400020
         BCT   RE,TNTLOOP               DECREMENT THE COUNT AND         76600020
*                                         BRANCH                        76800020
         ST    RE,AVTGETMN              STORE ZEROES IN THE QCB         77000020
*                                         ADDRESS FOR THIS ENTRY        77200020
         B     QCBRETRN                 RETURN                          77400020
         EJECT                                                          77500020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     77600020
*                                                                 *     77800020
*        THIS IS THE FORMAT OF THE LINE UNAVAILABLE MESSAGE       *     78000020
*                                                                 *     78200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     78400020
         CNOP  0,4                                                      78420020
MESSAGE  DC    AL2(MSGEND-*)            LENGTH OF THE MESSAGE           78440020
         DC    X'8000'                  MCSFLAGS FIELD          SA62959 78460005
         DC    C'IED079I ENDING STATUS '  MESSAGE TO TELL               78480022
         DC    C'NOT RECEIVED FROM LINE ' OPERATOR THAT ENDING          78500022
LINENUMB DC    C'000 - LINE UNAVAILABLE'  STATUS NOT RECEIVED           78520022
MSGEND   EQU   *                                                        78530022
         DC    X'10000100'              ROUTINE & DESCRPTR CODE SA62959 78540005
OPIDCNST DC    C'0S'                    ID OF SYSTEM OPEN MODULE        79200020
AMIDCNST DC    C'48'                    ID OF THIS OPEN  MODULE         79400020
LIMIT    DC    A((31)*100)              LIMIT FOR ELASPED TIME @ZA04001 79600009
         SPACE 2                                               @ZA04001 79650009
ONEDAY   DC    A((60*60*24)*100)        NUMBER OF HUNDRETHS OF @ZA04001 79700009
*                                        A SEC IN 24 HOURS     @ZA04001 79750009
ONE      EQU   1                        NUMERIC CONSTANT         Y02027 79800006
TWO      EQU   2                        A NUMERIC CONSTANT              80000020
THREE    EQU   3                        NUMERIC CONSTANT         Y02027 80200006
FOUR     EQU   4                        NUMERIC CONSTANT         Y02027 80300006
FIVE     EQU   5                        NUMERIC CONSTANT         Y02027 80400006
CSO      EQU   6                        CONC SCHEDULER OFFSET    S22026 80700022
EIGHT    EQU   8                        NUMERIC CONSTANT         Y02027 80800006
UCBNAME  EQU   12                       UCB NAME                 Y02027 81000006
QCBSPOT  EQU   13                       QCB OFFSET IN CROSS REF  Y02027 81200006
CVT      EQU   16                       ADDRESS OF CVT           Y02027 81400006
IOBPTR   EQU   32                       IOB OFFSET IN LCB        Y02027 81600006
WTO      EQU   35                       WTO SVC                  Y02027 81800006
DEBPRFSZ EQU   36                       OFFSET TO START OF DEB   Y02027 82000006
NOTCOMPT EQU   X'02'                    I/O COMPLETION TEST VALUEY02027 82200006
CC3      EQU   X'70'                    SIO COND CODE = 3        A51081 82900022
OPWKAD   EQU   4                        OFFSET TO OPEN WK AREA ADY02027 83200006
NENT     EQU   1                                                        83600020
LENGTH   EQU   NENT*6+6                 LENGTH OF IDTTR'S + 6           83800020
NODBWDS  EQU   (LENGTH+7)/8             NUMBER OF DOUBLE WORDS WITH     84000020
*                                         PADDING                       84200020
LINENO   EQU   LINENUMB-MESSAGE     OFFSET OF LINE NO IN MSG   @OZ29413 84201086
ORGIDTTR EQU   1024-NODBWDS*8           START OF IDTTR LIST             84400020
         ORG   IGG01948+ORGIDTTR        LEAVE SPACE FOR LIST            84600022
TCAM34   DC    C'34'                    ID OF THE INITIAL LOADING       84800020
*                                         EXECUTOR                      85000020
         DC    XL4'00'                  TTR AND LENGTH                  85200020
IDEND    DC    X'0000'                  END OF ID                       85400022
         CNOP  4,8                                                      85600022
LOADID   DC    C'019'                   ID FOR LOAD                     85800022
         DC    YL1(X'80'-NODBWDS)       END OF IDTTR LIST               86000022
*                                                                       86200020
         EJECT                                                          86400020
         TTRMD                                                          86600020
         EJECT                                                          86800020
FORCORE  DSECT                                                          86860020
         IECDSECT                                                       86920020
         EJECT                                                          87200020
         TTNTD                                                          87400020
         EJECT                                                          87600020
         TQCBD                                                          87800020
         EJECT                                                          88000020
         TDEBD                                                          88200020
         EJECT                                                          88400020
         TAVTD                                                          88600020
         EJECT                                                          88800020
         TLCBD                                                          89000020
         EJECT                                                          89200020
         DCBD  DSORG=TX                                                 89400020
         EJECT                                                          89430006
CVTD     DSECT                                                   Y02027 89460006
         CVT                                                     Y02027 89490006
         EJECT                                                          89520006
         TTCXD                                                   Y02027 89550006
         END                                                            89600020
