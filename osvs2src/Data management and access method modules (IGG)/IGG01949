1949     TITLE 'IGG01949-CHECKPOINT DISK ALLOCATION ROUTINE'            00200020
IGG01949 CSECT                                                          00210022
*A000000-999999                                                @Y16X5N0 00215000
         SPACE 3                                                        00220022
*  CHANGE ACTIVITY AS FOLLOWS:                                        * 00230022
******************** MICROFICHE FLAGS *********************** SUPT CODE 00240022
*A374600,375200                                                 SA51078 00240122
*A324000                                                        SA53610 00240222
*C202000,304000,312000-314000                                   SA53610 00240322
*C202000,834000-836000                                           A42410 00240422
*A781000                                                         S22027 00240522
*C222000-224000                                                  S22027 00240622
*C004200-007200,016000                                           S21903 00240722
*A188500-189500,796400-797600                                   SA58440 00240822
*C223000-223300,224600-224900                                   SA58440 00240922
*   PTM 0114,0525,0527,0601,0626,0708,0731,1013,1109,1111,1120,1209     00241022
*   CLEANUP    99240,22027,21903                                        00241122
*A468000,792000                                                 SA62992 00241222
*A596000,598000                                                 SA58448 00241322
*C326000                                                        SA67099 00241454
*A337000,340000                                                 SA59179 00241822
*A782000                                                         Y01004 00241904
*C514000                                                         Y01004 00242004
*C346760-346800                                                  Y01948 00332005
*D337000,346520,360000,783500,486000-490000                      Y01948 00422005
*C226000-228000                                                 SA68675 00512005
*A484000                                                        SA68675 00602005
*A189870                                                       @XA05313 00602156
*C490000                                                       @XA05313 00602256
*A442000,454000,668000,783000                                  @XA05305 00602356
*C443200,458000,776340                                         @XA05305 00602456
*D714000-772000                                                @XA05305 00602556
*C346360-346480                                                @YA05454 00602656
*C776425-776435,894000                                         @YA11949 00602758
*A776445,776455                                                @YA11949 00602858
*A002100,189930,296000,347600,416000,776490,781963             @Y17XANU 00632800
*C325000-340000                                                @Y17XANU 00662800
*A816000,781780,781990                                         @G36XRNU 00668800
*C064000,068000,210600,514000-516000,520000,524000,528000,626000G36XRNU 00672800
*D668600-669200,672000,776020-776340,783310-783600             @G36XRNU 00676800
*A232000,270000,302000,325000,478000,484000                    @OX16402 00682800
*C326000,326250,326450,346280,347680,354000                    @OX16402 00702800
*D347520-382000 COPIED TO STMT 326000                          @OX16402 00722800
*D402000-410000 COPIED TO STMT 327400                          @OX16402 00742800
*A347460,778000                                                @OZ26495 00742982
*C346280                                                       @OZ26495 00743082
*A466000                                                       @OZ29218 00743182
*C468000-468600                                                @OZ29218 00743282
*A467000                                                       @OY20675 00743382
*C468300                                                       @OY20675 00743482
*********************************************************************** 00800020
*                                                                     * 00820022
*MODULE-NAME=IGG01949 (TCAM, INITIALIZATION)                   @Y17XANU 00830000
*                                                                     * 00860022
*DESCRIPTIVE-NAME=CHECKPOINT DISK ALLOCATION ROUTINE                  * 00880022
*                                                                     * 00900022
*COPYRIGHT='NONE'                                                     * 00920022
*                                                                     * 01000020
*  STATUS: VERSION 10.0                                        @Y17XANU 01100000
*                                                                     * 01800020
*FUNCTION:THIS MODULE SCANS THROUGH THE TCAM TABLES TO DETERMINE THE  * 02000020
*   SIZE OF AN ENVIRONMENT CHECKPOINT AND THE NUMBER OF DISK RECORDS  * 02200020
*   REQUIRED FOR IT. IT SAVES THE LENGTH AND COUNT IN THE CHECKPOINT  * 02400020
*   CONTROL RECORD. IT DETERMINES THE MAXIMUM NUMBER OF PRIORITY LEVEL* 02600020
*   QCBS USED FOR ANY ONE PROCESS ENTRY,AND USES THIS VALUE PLUS THE  * 02800020
*   LENGTH OF THE LONGEST OPTION AREA(FOR ANY ONE ENTRY IN THE TERM-  * 03000020
*   INAL TABLE) TO DETERMINE THE LENGTH OF A CKREQ RECORD.  IT        * 03200020
*   DETERMINES THE LENGTH OF AN INCIDENT RECORD,WHICH DEPENDS UPON THE* 03400020
*   LENGTH OF THE LONGEST OPTION AREA OR THE LENGTH OF THE OPERATOR   * 03600020
*   CONTROL DATA AREA,WHICH EVER IS LONGER. THIS MODULE ALSO DETER-   * 03800020
*   MINES THE NUMBER OF EACH OF THE THREE TYPES OF RECORDS WHICH WILL * 04000020
*   FIT ON ONE TRACK.  IT GETS THE DEVICE TYPE INDEX FROM THE UCB AND * 04200020
*   THE I/O DEVICE CHARACTERISTICS TABLE ADDRESS FROM THE CVT. IT USES* 04400020
*   THE VALUES IN THE TABLE TO CALCULATE RECORDS PER TRACK.           * 04600020
*                                                                     * 04800020
*ENTRY POINT:                                                         * 05000020
*                                                                     * 05200020
*        IGG01949                                                     * 05400020
*                                                                     * 05600020
*INPUT:REGISTERS 2,5,6,7 AND 8 CONTAIN THE FOLLOWING VALUES:          * 05800020
*                                                                     * 06000020
*   2-ADDRESS OF CHECKPOINT WORK AREA                                 * 06200020
*   5-ADDRESS OF THE BEGINNING OF THE WTG TABLE PREFIX         @G36XRNU 06400000
*   6-ADDRESS OF BEGINNING OF WHERE-TO-GO TABLE                       * 06600020
*   7-ADDRESS OF THE COPY OF THE CURRENT DCB                   @G36XRNU 06800000
*   8-ADDRESS OF CURRENT ENTRY IN WHERE-TO-GO TABLE                   * 07000020
*                                                                     * 07200020
*OUTPUT:                                                              * 07400020
*                                                                     * 07600020
*   REGISTERS 5 AND 6 ARE SAME AS INPUT.REGISTERS 7 AND 8 ARE UPDATED * 07800020
*   TO THE NEXT ENTRIES.                                              * 08000020
*                                                                     * 08200020
*   THE COUNT AND LENGTH FIELDS IN THE CONTROL RECORD ARE FILLED IN   * 08400020
*   FOR ENVIRONMENT,CKREQ,AND INCIDENT RECORDS.                       * 08600020
*                                                                     * 08800020
*EXTERNAL ROUTINES:NONE                                               * 09000020
*                                                                     * 09200020
*EXITS-NORMAL:THIS MODULE XCTLS TO THE NEXT ENTRY IN THE WHERE-TO-GO  * 09400020
*   TABLE,WHICH IS FOR IGG01942.                                      * 09600020
*                                                                     * 09800020
*EXITS-ERROR:N/A.                                                     * 10000020
*                                                                     * 10200020
*MACROS - IEDHJN                                               @Y17XANU 10210000
*         LOAD                                                 @Y17XANU 10220000
*         DELETE                                               @Y17XANU 10230000
*         WTO                                                  @Y17XANU 10240000
*         XCTL                                                 @Y17XANU 10250000
*                                                              @Y17XANU 10260000
*MODULE TYPE - PROCEDURE                                       @Y17XANU 10270000
*                                                              @Y17XANU 10280000
*PROCESSOR - ASSEMBLER XF                                      @Y17XANU 10290000
*                                                              @Y17XANU 10300000
*MODULE SIZE - 2K                                              @Y17XANU 10310000
*                                                              @Y17XANU 10320000
*PURPOSE - SEE FUNCTION                                        @Y17XANU 10330000
*                                                              @Y17XANU 10340000
*LINKAGE - XCTL'ED FROM IGG01941                               @Y17XANU 10350000
*                                                              @Y17XANU 10360000
*TABLES/WORK AREAS:                                                   * 10400020
*                                                                     * 10600020
*   CVT                                                               * 10800020
*   AVT                                                               * 11000020
*   CHECKPOINT WORK AREA                                              * 11200020
*   OPTION TABLE                                                      * 11400020
*   TERMNAME TABLE                                                    * 11600020
*   TERMINAL TABLE                                                    * 11800020
*   QCB                                                               * 12000020
*   DEB                                                               * 12200020
*   DCB                                                               * 12400020
*   INVITATION LIST                                                   * 12600020
*   I/O DEVICE CHARACTERICTICS TABLE                                  * 12800020
*                                                                     * 13000020
*ATTRIBUTES:REENTERABLE,REFRESHABLE,ENABLED,SUPERVISOR MODE    @Y17XANU 13100000
*                                                                     * 13400020
*NOTES - SEE BELOW                                             @Y17XANU 13410000
*                                                              @Y17XANU 13420000
* DEPENDENCIES - THE OPERATION OF THIS MODULE DEPENDS UPON AN  @Y17XANU 13430000
*  INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH @Y17XANU 13440000
*  IS EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME. THE CODING  @Y17XANU 13450000
*  HAS BEEN ARRANGED SO THAT REDEFINITION OF CHARACTER         @Y17XANU 13460000
*  CONSTANTS BY REASSEMBLY WILL RESULT IN A CORRECT MODULE     @Y17XANU 13470000
*  FOR THE NEW DEFINITIONS.                                    @Y17XANU 13480000
*                                                              @Y17XANU 13490000
* RESTRICTIONS - NONE                                          @Y17XANU 13500000
*                                                              @Y17XANU 13510000
* REGISTER CONVENTIONS - SEE REGISTER ASSIGNMENT               @Y17XANU 13520000
*                                                              @Y17XANU 13530000
* PATCH - PATCH                                                @Y17XANU 13540000
*                                                              @Y17XANU 13550000
*********************************************************************** 13600020
         EJECT                                                   S21903 13800022
* REGISTER USAGE FOR THIS SECTION                                       14000020
         SPACE                                                          14200020
R0       EQU   0                        WORK REG,LENGTH OF LCB          14400020
R1       EQU   1                        PARM REG OR WORK REG;INVLEN     14600020
R2       EQU   2                        ADDRESS OF CKP WORK AREA        14800020
R3       EQU   3                        LENGTH OF TOTAL CKPT RECORD     15000020
R4       EQU   4                        REG 4                    S22024 15200022
R5       EQU   5                        LENGTH OF TERMNAME              15400020
R6       EQU   6                        ADDRESS OF TERMNAME ENTRY       15600020
R7       EQU   7                        REG 7                    S22024 15800022
RQCB     EQU   7                        ADDRESS OF QCB;LNGTH-TOTSEG     16000020
R8       EQU   8                        REG 8                    S22024 16200022
RTERM    EQU   8                        ADDRESS OF TERM ENTRY:UCB       16400020
RAVT     EQU   9                        ADDRESS OF AVT                  16600020
RDCB     EQU   10                       ADDRESS OF DCB;BRANCH ADDR      17000020
R10      EQU   10                       REG 10                   S22024 17200022
R11      EQU   11                       REG 11                   S22024 17400022
RBASE    EQU   12                       BASE                            17600020
R13      EQU   13                       SAVE AREA;BYTES /RECORD         18000020
R14      EQU   14                       RETURN REG ;ADDRESS OF DEB      18200020
R15      EQU   15                       ENTRY REG;INDEX-NO. EXTENTS     18400020
         EJECT                                                 @Y17XANL 18500000
CVTZDTAB EQU   64                       CVT ADDRESS FOR I/O DEVICE     X18600020
                                        CHARACTERISTICS TABLE           18800020
TWO      EQU   2                                                SA58440 18850022
TFIFTY4  EQU   54                       MESSAGE LENGTH          SA58440 18900022
TFIFTY5  EQU   55                       MESSAGE LENGTH          SA58440 18950022
B3       EQU   3                        BIT THREE                S21903 18951022
         SPACE 1                                                 S21903 18952022
L1       EQU   1                        LENGTH OF ONE            S21903 18953022
L2       EQU   2                        LENGTH OF TWO            S21903 18954022
L3       EQU   3                        LENGTH OF THREE          S21903 18955022
L4       EQU   4                        LENGTH OF 4              S21903 18956022
L5       EQU   5                        LENGTH OF FIVE           S21903 18957022
L6       EQU   6                        LENGTH OF 6              S21903 18958022
L8       EQU   8                        LENGTH OF 8              S21903 18959022
L9       EQU   9                        LENGTH OF NINE           S21903 18960022
L14      EQU   14                       LENGTH OF 14             S21903 18961022
L16      EQU   16                       LENGTH OF SIXTEEN        S21903 18962022
L19      EQU   19                       LENGTH OF NINETEEN       S21903 18963022
L32      EQU   32                       LENGTH OF THIRTY-TWO     S21903 18964022
         SPACE 1                                                 S21903 18965022
X20      EQU   X'20'                    HEX 20                   S21903 18966022
X24      EQU   X'24'                    HEX 24                   S21903 18967022
X80      EQU   X'80'                    HEX 80                   S21903 18968022
XD0      EQU   X'D0'                    HEX D0                   S21903 18969022
         SPACE 1                                                 S21903 18970022
C1       EQU   1                        COUNT OF ONE             S21903 18971022
EIGHT    EQU   8                        COUNT EIGHT              S21903 18972022
EOTBIT   EQU   X'80'                    EOT INCLUDED IN LIST    SA62992 18973022
LO       EQU   4                        BRANCH LOW               S21903 18974022
MULT4    EQU   2                        MULTIPLY BY FOUR         S21903 18975022
ONE      EQU   1                        COUNT ONE                S21903 18976022
ZERO     EQU   0                        ZERO                     S21903 18977022
ALL      EQU   15                       MASK FOR ICM 4 BYTES     Y01948 18987004
HALF     EQU   3                        MASK FOR HALF WORD ICM @XA05313 18993056
ADDRMSK  EQU   7                        ADDRESS MASK           @Y17XANU 18996000
         EJECT                                                 @Y17XANL 18998000
         SPACE 3                                                        19000020
         USING *,R15                    TEMPORARY BASE           S21903 19200022
         BAL   RBASE,QMM00              SET BASE / BYPASS ID     S21903 19260022
         DROP  R15                                               S21903 19320022
         USING *,RBASE                                                  19400020
IGG01949 IEDHJN                                                         19600022
QMM00    DS    0H                                                S21903 20100022
         USING IEDQAVTD,RAVT            BASE FOR AVT                    20600020
         USING IHADCB,RDCB              BASE FOR DCB                    20800020
         USING IEDQCKPD,R2              BASE FOR CKPT WORK AREA         21000020
         USING FORCORE,R4               OPEN WORK AREA DSECT   @G36XRNU 21010000
         L     R4,FOUR(R8)              ADDR OF OPEN WORK AREA @G36XRNU 21020000
         L     RDCB,DXUDCBAD            ADDR OF USER'S DCB     @G36XRNU 21030000
         DROP  R4                                              @G36XRNU 21040000
         L     R2,DCBIOBAD              GET WORK AREA ADDRESS    S22024 21120022
         EJECT                                                 @Y17XANL 21160000
*FIGURE LENGTH NEEDED FOR TOTAL ENVIRONMENT RECORD                      21400020
         SPACE                                                          21600020
         LM    R14,R11,CKPSAVE1+12      PICK UP REGS FROM PREVIOUS 0731X21800020
                                        MODULE                          22000020
         LH    R4,DCBBLKSI(,RDCB)       LOAD USER SPECD RCD SIZE S22027 22200022
         LA    R3,CKPENVL               LOAD MIN RECORD SIZE     S22027 22220022
         LA    R5,BLKSMALL              GET OFFSET OF TOO SMALL  S22024 22221022
*                                        MESSAGE                  22024 22221322
         LA    R6,MIN3705               ADDR OF MIN SIZE FOR 3705S22024 22221622
         MVC   AVTDPARM(1),DCBOPTCD     SAVE FOR LATER TESTS     S22024 22222022
         TM    AVTDPARM,CKP3705         3705 CHECKPOINT DCB      S22024 22224022
         BZ    QMM02                    NO, BRANCH               S22024 22226022
         LA    R3,CKPNMINL              SET UP MINIMUM LENGTH    S22024 22228022
*                                        FOR 3705 CHECKPOINT RCD S22024 22230022
QMM02    EQU   *                                                 S22024 22236022
         CR    R4,R3                    USER SPEC TOO SMALL      S22027 22240022
         BL    WRTOP                    USE 300                 SA58440 22260022
CKMAX    EQU   *                                                 S22027 22360022
         LA    R3,SIZ3520               LOAD MAX RECORD SIZE     S22027 22380022
         TM    AVTDPARM,CKP3705         3705 CHECKPOINT DCB      S22024 22384022
         BZ    CHECKMAX                 NO, USE 3520 BLKSIZE     S22024 22388022
         LA    R3,CKPMAXL               ELSE SET 3705 DEFAULT    S22024 22392022
CHECKMAX EQU   *                                                 S22024 22396022
         CR    R4,R3                    USER SPEC TOO BIG        S22027 22400022
         BNH   STORSIZ                  NO, SAVE SIZE            S22027 22420022
         LA    R5,BLKBIG                GET OFFSET OF TOO BIG    S22024 22460022
*                                        MESSAGE                 S22024 22463022
         LA    R6,MAX3705               ADDR OF MAX SIZE FOR 3705S22024 22466022
WRTOP    EQU   *                                                SA58440 22470022
         LR    R4,R3                    USE DEFAULT BLKSIZE      S21903 22475022
         MVC   AVTSAVE4(DDL),IEDNMG     MOVE NAME OF MSG MODULE  S22024 22480022
         LOAD  EPLOC=AVTSAVE4           LOAD MESSAGE MODULE      S22024 22480822
         ALR   R5,R0                    GET ADDR OF PTR TO MSG   S22024 22481622
         L     R1,AVTEZERO(R5)          GET ADDR OF MESSAGE      S22024 22482422
         TM    AVTDPARM,CKP3705         3705 CHECKPOINT DCB      S22024 22483222
         BZ    MOVEDDNM                 NO, MOVE DDNAME          S22024 22484022
         MVC   BLKSIZE(FOUR,R1),AVTEZERO(R6) MOVE DEFAULT BLKSIZES22024 22484822
         EJECT                                                 @Y17XANL 22485200
MOVEDDNM EQU   *                                                 S22024 22485622
         L     R5,AVTTCB                GET TCB ADDRESS          S22024 22486422
         L     R5,TCBTIO(R5)            GET TIOT ADDRESS         S22024 22487222
         AH    R5,DCBTIOT               GET TIOE ADDRESS         S22024 22488022
         MVC   DDNAME(DDL,R1),TIOEDDNM(R5) MOVE DDNAME TO MSG    S22024 22488822
         WTO   MF=(E,(1))                                       SA58440 22490022
         DELETE EPLOC=AVTSAVE4          DELETE MESSAGE MODULE    S22024 22495022
STORSIZ  EQU   *                                                 S22027 22500022
         STH   R4,CKPBPERR              SAVE SIZE                S22027 22520022
         LR    R14,R4                   PUT SIZE IN R14          S22027 22560022
         TM    AVTDPARM,CKP3705         3705 CHECKPOINT DCB      S22024 22570022
         BO    QMM66                    YES, BRANCH              S22024 22580022
         LA    R3,CDRTINFO              LENGTH OF CONTROL INFO  SA68675 22600005
         MVI   CKPPRQNO,ONE             INIT MAX PRI QUEUES      S21903 23000022
         MVI   CKPRW+7,EIGHT            LENGTH OF COUNT AREA     S21903 23200022
         NI    CKPFLAGS,AVTEFF-CKPOPNEN TURN OFF BIT           @OX16402 23250000
         EJECT                                                 @Y17XANL 23300000
*INITIALIZE FOR LOOP THROUGH TERMNAME TABLE                             26800020
         SPACE                                                          27000020
QMM05    EQU   *                                               @OX16402 27050000
         USING IEDQTNTD,R6                                              27200020
         SR    R5,R5                    CLEAR                           27600020
         L     R6,AVTRNMPT              GET ADDRESS OF TERMNAME TBL     27800020
         IC    R5,TNTENLEN              GET LENGTH OF TERMNAME          28000020
         LH    R11,TNTLEN              GET COUNT OF ENTRIES             28200020
         N     R11,AVTCLRHI            CLEAR HIGH ORDER HALF WORD       28400020
         LA    R6,TNTFIRST              GET FIRST ENTRY                 28600020
         SPACE 3                                                        28800020
*BEGINNING OF LOOP THROUGH TERMNAME TABLE                               29000020
         SPACE                                                          29200020
QMM10    EQU   *                                                        29400020
         AR    R6,R5                    MOVE PAST NAME FIELD            29600020
         SLR   RTERM,RTERM              CLEAR REG              @Y17XANU 29620000
         ICM   RTERM,ADDRMSK,0(R6)      GET TTE ADDRESS        @Y17XANU 29640000
         LA    R10,TRMPRFSZ             GET PREFIX SIZE        @Y17XANU 29660000
         SLR   RTERM,R10                GET ADDRESS OF PREFIX  @Y17XANU 29680000
         USING IEDNTRM,RTERM            SET TTE ADDRESSABILITY @Y17XANU 29700000
         SLR   RQCB,RQCB                CLEAR REG              @Y17XANU 29720000
         ICM   RQCB,ADDRMSK,TRMDESTQ    GET QCB ADDRESS        @Y17XANU 29740000
         USING IEDQQCB,RQCB             SET QCB ADDRESSABILITY @Y17XANU 29760000
         EJECT                                                          30400022
*CHECK TYPE OF TERMINAL ENTRY. FIGURE LENGTHS OF ASSOCIATED QCB'S,      30600020
*LCB'S AND INVITATION LISTS                                             30800020
         TM    TRMDSORG,TRMLGB          IS THIS A GROUP ENTRY    S22024 30860022
         BO    QMM60                    YES, DO NOT INCLUDE      S22024 30920022
         SPACE                                                          31000020
         TM    TRMSTATE,TRMLIST         IS THE LIST BIT ON      SA53610 31200022
         BNO   QMM20                    IF NOT, INCLUDE IN COUNTSA53610 31400022
         TM    TRMSTATE,TRMLOG          IS THIS LOGTYPE         SA53610 31600022
         BNO   QMM60                    IF NOT, DO NOT INCLUDE  SA53610 31800022
         SPACE 3                                                        32000020
*FIGURE LENGTHS FOR SINGLE, GROUP,OR PROCESS ENTRIES                    32200020
         SPACE                                                          32400020
QMM20    EQU   *                                                SA53610 32500022
         TM    CKPFLAGS,CKPOPNEN        UPDATING TERMINAL ENTRY@OX16402 32503000
         BO    QMM21                    YES                    @OX16402 32506000
         SPACE 2                                                        32509000
* THE FOLLOWING INSTRUCTIONS HAVE BEEN MOVED TO UPDATE THE QCB @OX16402 32512000
* FIELDS BEFORE THE TERMINAL ENTRY FIELDS.  THIS IS FOR RESTART@OX16402 32515000
* SO THAT IT CAN BE SURE THAT THE SEQUENCE NUMBER HAS BEEN     @OX16402 32518000
* UPDATED TO WHAT THE DISK POINTER INDICATES.                  @OX16402 32521000
         BAL   R15,QMM85                COMPUTE TTE LENGTH TO  @Y17XANU 32530000
*                                       BE CHECKPOINTED        @Y17XANU 32560000
*FIGURE LENGTH OF QCB                                                   32600000
         SPACE                                                          32640000
QMM28    EQU   *                                                   1109 32680000
         SR    R4,R4                    INITIALIZE PRI QCB COUNT   0114 32720000
         TM    QCBDSFLG,QCBDISK         CHECK FOR DISK QUEUES      1109 32760000
         BZ    QMM60                    BRANCH IF CORE ONLY    @OX16402 32800000
         TM    QCBFLAG,QCBCKPT          CHECK FOR PROCESSED QCB         32840000
         BNZ   QMM60                    BRANCH IF ALREADY PROCESSED     32880000
         OI    QCBFLAG,QCBCKPT                                          32920000
         LA    R3,CKPMQBLN(,R3)         LEN OF MASTER QCB & DEL@OX16402 32960000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES FOR     X33000000
                                        ONE RECORD                      33040000
         SPACE 3                                                        33080000
*BEGINNING OF LOOP THROUGH PRIORITY LEVEL QCB'S                         33120000
         SPACE                                                          33160000
QMM30    EQU   *                                                        33200000
         LA    R3,CKPQCBLN(,R3)         ADD LTH DISK PTRS        S21903 33240000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES FOR     X33280000
                                        ONE RECORD                      33320000
         LA    R3,CKPQBKLN(,R3)         ADD LTH QBACK PTR        S21903 33360000
         BAL   R10,QMM78                CHECK FOR RECORD FULL   SA51078 33400000
         LA    R4,C1(,R4)               ADD 1 CNT TO PRTY QCB    S21903 33440000
         CLI   QCBPRIPQ,0               CHECK FOR 0 PRIOIRTY            33480000
         LA    RQCB,QCBPSIZE(,RQCB)     MOVE TO NXT PRTY QCB     S21903 33520000
         BNZ   QMM30                    BRANCH IF NOT LAST QCB          33560000
***************************************************************@OX16402 33600000
         TM    TRMSTATE,X24             SYNC PROCESS ENTRY     @OX16402 33640000
         BNO   QMM60                    BR, IF NOT SYNC PROCESS@OX16402 33680000
         EX    R4,QMMCOMPR              CHECK QCB COUNT WITH   @OX16402 33720000
*                                        PREVIOUS PRI QCB MAX  @OX16402 33760000
         BNL   QMM60                    BR, IF NOT NEW MAX     @OX16402 33800000
         STC   R4,CKPPRQNO              REPLACE OLD MAX        @OX16402 33840000
         B     QMM60                    GET NEXT ENTRY         @OX16402 33880000
         SPACE 2                                                        33920000
QMM21    EQU   *                                               @OX16402 33960000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES FOR     X34040000
                                        ONE RECORD                      34080000
         USING IEDQQCB,RQCB             BASE FOR QCB                    34120000
         L     RQCB,TRMDESTQ-1          GET ADDRESS OF QCB              34160000
         TM    TRMSTATE,TRMLOG          PROCESS ENTRY           SA59179 34200000
         BM    QMM23                    BRANCH YES              SA59179 34240000
         TM    QCBDSFLG,QCBDISK         CHECK FOR CORE QUEUES           34280000
         BZ    QMM24                    BRANCH IF CORE QUEUES      1109 34320000
QMM23    EQU   *                                                SA59179 34360000
         LA    R3,CKPSEQLN(,R3)         LENGTH OF SEQ FIELD      S21903 34400000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES FOR     X34440000
                                        ONE RECORD                      34480000
         SPACE 3                                                        34604020
*GET LENGTHS OF OPTION FIELDS FOR THIS TERM ENTRY. ADDRESS-TYPE         34608020
*OPTIONS ARE NOT INCLUDED                                          1109 34612020
         SPACE                                                          34616020
QMM24    EQU   *                                                   1109 34620020
         TM    TRMSTATE,TRMOPTFN        CHECK FOR OPTIONS          1109 34624020
         BZ    QMM35                    BRANCH IF OPTIONS      @OZ26495 34628082
*                                        NOT USED              @OZ26495 34629082
         SR    R13,R13                  CLEAR                      1109 34632020
         LH    R15,TRMOPTBL             GET ENTRY OFFSET       @YA05454 34636056
         N     R15,AVTCLRHI             CLEAR HI HALF          @YA05454 34640056
         L     R4,AVTOPTPT              GET OPT TBL ADDR       @YA05454 34644056
         AR    R15,R4                   ADD OPT TBL ADDR       @YA05454 34648056
         L     R4,FOUR(,R4)             GET OPT CSECT TBL ADDR @YA05454 34652056
         SR    R1,R1                    CLEAR                      1109 34656020
         EJECT                                                 @Y17XANL 34658000
*BEGINNING OF LOOP THROUGH COUNT OF OPTION FIELDS FOR THIS TERMINAL1109 34664020
         SPACE                                                          34668020
QMM25    EQU   *                                                   1109 34672020
         IC    R0,TRMOPT(R13)           OFFSET FOR OPTION ENTRY    1109 34676020
         CLM   R0,ONE,AVTHFF            CHECK OPTION ENTRY       Y01948 34680005
         BE    QMM27                    BRANCH IF UNUSED ENTRY     1109 34684020
         IC    R1,0(R4)                 LENGTH OF THIS FIELD       1109 34688020
         CLI   ONE(R4),XD0              CHECK OPTION BYTE        S21903 34692022
         BH    QMM26                    BRANCH IF NOT ADDRESS TYPE 1109 34696020
         CLI   ONE(R4),X80              CHECK OPTION BYTE        S21903 34700022
         BH    QMM27                    BRANCH IF ADDRESS TYPE     1109 34704020
QMM26    EQU   *                                                   1109 34708020
         LA    R3,L1(R1,R3)             ADD LENGTH TO TOTAL LTH  S21903 34712022
         BAL   R10,QMM78                CHECK FOR END OF SEGMENT   1109 34716020
QMM27    EQU   *                                                   1109 34720020
         LA    R4,CKPOPLTL(,R4)         GET NEXT ENTRY IN OPT CHAR 1109 34724020
         LA    R13,C1(,R13)             ADD ONE TO CT OF OPT FLD S21903 34728022
         EX    R13,QMMCOMP              CHECK FOR END OF OPT FIELDS1109 34732020
         BNE   QMM25                    BRANCH IF NOT END          1109 34736020
         SPACE                                                          34740020
*END OF LOOP THROUGH OPTION FIELDS FOR TERM ENTRY                  1109 34744020
         EJECT                                                 @Y17XANL 34746000
         SPACE 3                                               @OZ26495 34796082
QMM35    EQU   *                                               @OZ26495 34846082
         TM    TRMDEVFL,X60             DIAL DIGITS/ADDR CHAR? @OZ26495 34896082
         BZ    QMM40                    NO, BRANCH             @OZ26495 34946082
         SR    R1,R1                    CLEAR REG              @OZ26495 34996082
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS USED     @OZ26495 35046082
         BNO   NOOPTS                   NO, BRANCH             @OZ26495 35096082
         LA    R4,TRMOPT                START OF OPTION FIELDS @OZ26495 35146082
         IC    R1,TRMOPNO               NUMBER OF OPTIONS      @OZ26495 35196082
         AR    R4,R1                    START OF DEVICE FIELDS @OZ26495 35246082
         B     CKBUF                    CHECK BUFSIZE          @OZ26495 35296082
NOOPTS   EQU   *                                               @OZ26495 35346082
         LA    R4,TRMOPNO               START OF DEVICE FIELDS @OZ26495 35396082
CKBUF    EQU   *                                               @OZ26495 35446082
         TM    TRMDEVFL,X80             BUFSIZE SPECIFIED      @OZ26495 35496082
         BNO   CKDIAL                   NO, BRANCH             @OZ26495 35546082
         A     R4,ADD3                  BUMP PAST BUFSIZE      @OZ26495 35596082
CKDIAL   EQU   *                                               @OZ26495 35646082
         TM    TRMDEVFL,X40             DIAL DIGITS SPECIFIED  @OZ26495 35696082
         BNO   CKADDR                   NO, BRANCH             @OZ26495 35746082
         IC    R1,0(R4)                 SIZE OF DIAL DIGITS    @OZ26495 35796082
         LA    R3,1(R1,R3)              ADD LENGTH TO TOTAL LEN@OZ26495 35846082
         BAL   R10,QMM78                CHECK - END OF RCD SEG @OZ26495 35896082
         LA    R4,1(R4,R1)              BUMP PAST DIAL DIGITS  @OZ26495 35946082
CKADDR   EQU   *                                               @OZ26495 35996082
         TM    TRMDEVFL,X20             ADDR CHAR SPECIFIED    @OZ26495 36046082
         BNO   QMM40                    NO, BRANCH             @OZ26495 36096082
         IC    R1,0(R4)                 SIZE OF ADDR CHAR      @OZ26495 36146082
         LA    R3,1(R1,R3)              ADD LENGTH TO TOTAL LEN@OZ26495 36196082
         BAL   R10,QMM78                CHECK - END OF RCD SEG @OZ26495 36246082
         SPACE                                                          38400020
QMM40    EQU   *                                                        38600020
         TM    TRMSTATE,X24             SYNC PROCESS ENTRY       S21903 38800022
         BNO   QMM50                    BRANCH IF NOT SYNC PROCESS 0525 39000020
         TM    TRMSTATE,TRMOPTFN        CHECK FOR OPTION FIELDS    0525 39200020
         BZ    QMM45                    BRANCH IF NOT USED FOR SYNC0525 39400020
         OI    CKPFLAGS,CKPOPTFN        TURN ON BIT FOR SYNC PROCES0525X39600020
                                        USING OPTION FIELDS        0525 39800020
QMM45    EQU   *                                                   0525 40000020
QMM50    EQU   *                                                        41200020
         TM    TRMSTATE,TRMPROC         PROCESS ENTRY            S21903 41300000
         BO    QMM60                    BRANCH IF PROCESS ENTRY    0708 41600020
         TM    TRMSTATE,TRMPREF         3705 RESOURCE          @Y17XANU 41610000
         BO    QMM5050                  YES                    @Y17XANU 41620000
         LA    R3,CKPLCBLN+CKPDCBLN(R3) ADD LEN OF DCB AND LCB @Y17XANU 41630000
*                                       FIELDS TO TOTAL        @Y17XANU 41640000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES @Y17XANU 41650000
*                                       FOR ONE RECORD                  41660000
         B     QMM51                    CONTINUE PROCESSING    @Y17XANU 41670000
QMM5050  EQU   *                                               @Y17XANU 41680000
         CLI   TRMTYPE,TRMSSCP          SSCP ENTRY             @ZM47914 41681000
         BE    QMM60                    YES                    @ZM47914 41682000
         CLI   TRMTYPE,TRMLNCP          NCP ENTRY              @Y17XANU 41690000
         BNE   QMM51                    NO - CONTINUE          @Y17XANU 41700000
         LA    R3,CKPLTRLN(R3)          ADD LENGTH OF LCBTRACE @Y17XANU 41710000
*                                       FIELD TO TOTAL         @Y17XANU 41720000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES @Y17XANU 41730000
*                                       FOR ONE RECORD         @Y17XANU 41740000
         B     QMM60                    FINISHED WITH 3705     @YM07299 41745000
QMM51    EQU   *                                               @Y17XANU 41750000
         TM    AVTBIT3,AVTSTAIN         CHECK FOR INV LISTS CKPTED      42600020
         BZ    QMM60                    BRANCH IF NOT TO BE CKPTED      42800020
         OI    CKPFLAGS,CKPSTAIN        SAVE 'I' PARAM FROM INTRO       43000020
         EJECT                                                 @Y17XANL 43100000
*FIGURE LENGTH OF INVITATION LISTS.                                     43400020
         SPACE                                                          43600020
         L     RQCB,TRMDESTQ-1          RESTORE ADDR OF QCB             43800020
         L     RDCB,QCBDCBAD-1          GET DCB FROM QCB                44000020
         USING IHADCB,RDCB              BASE FOR DCB                    44200020
         LA    R15,QMM60                SET BRANCH REG         @XA05305 44230000
         CLC   QCBRELLN,DCBILCT         CHECK FOR INV LIST DEFINED 1209 44260020
         BHR   R15                      BR NOT DEFINED TO QMM60@XA05305 44320000
         SR    R4,R4                    CLEAR  FOR RLN                  44400020
         IC    R4,QCBRELLN              RELATIVE LINE NO                44600020
         SLL   R4,MULT4                 MULTIPLY BY FOUR         S21903 44800022
         SR    R0,R0                    CLEAR                           45000020
         SR    R1,R1                                                    45200020
         L     R4,DCBINVLI-4(R4)        ADDRESS OF INV LIST             45400020
         LA    R4,AVTEZERO(,R4)         CLEAR HI ORDER BYTE    @XA05305 45450056
         LTR   R4,R4                    INVLIST OMITTED ON GRP @XA05305 45500056
         BZR   R15                      BR YES TO QMM60        @XA05305 45550000
         TM    B3(R4),CKPSET2           CHK FOR PROCESSED LIST   S21903 45600022
         BNZR  R15                      BR IF PROCESED TO QMM60@XA05305 45800000
         OI    B3(R4),CKPSET2           SET SWITCH               S21903 46000022
         IC    R0,0(R4)                 GET NO OF ENTRIES IN LIST       46200020
         IC    R1,L2(R4)                GET LENGTH OF ENTRIES    S21903 46400022
         MR    R0,R0                    GET LENGTH OF IN                46600020
         LA    R1,L9(R1)                ADD CONTROL AREA       @OZ29218 46620082
         TM    L3(R4),EOTBIT            IS EOT IN LIST         @OZ29218 46640082
         BZ    QMM52                    NO, BRANCH             @OZ29218 46660082
         LA    R1,ONE(R1)               ADD ONE FOR EOT        @OZ29218 46680082
QMM52    EQU   *                                                SA62992 46700022
* IN CASE OF RETURN TO QMM52 AFTER RECORD OVERFLOW, THE        @OY20675 46710082
* ENTIRE INVITATION LIST MAY HAVE BARELY FIT IN THE PREVIOUS   @OY20675 46720082
* RECORD.  TEST FOR THIS POSSIBILITY AND IF SO, SKIP THE       @OY20675 46730082
* REMAINDER OF INVITATION LIST LENGTH CALCULATION.             @OY20675 46740082
         LTR   R1,R1                    ANY INVLIST LENGTH     @OY20675 46750082
*                                        LEFT FOR THIS SEGMENT @OY20675 46760082
         BZ    QMM60                    IF NOT BRANCH          @OY20675 46770082
         AR    R3,R1                    ADD LIST LENGTH        @OZ29218 46800082
         CR    R3,R14                   IS LIST TOO LONG TO    @OZ29218 46810082
*                                        FIT IN CURRENT SEG    @OZ29218 46820082
         BL    QMM53                    NO, BRANCH             @OY20675 46830082
         LR    R1,R3                    GET TOTAL LENGTH       @OZ29218 46840082
         SR    R1,R14                   SUBTRACT AMT THAT WILL @OZ29218 46850082
*                                        FIT IN CURRENT SEG    @OZ29218 46860082
         B     QMM53                    GO CHECK FOR RECORD     SA62992 46880022
*                                        OVERFLOW               SA62992 46900022
         B     QMM52                    RETURN IS HERE ON RCD   SA62992 46920022
*                                        OVERFLOW               SA62992 46940022
QMM53    EQU   *                                                SA62992 46960022
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES FOR     X47000020
                                        ONE RECORD                      47200020
QMM60    EQU   *                                                        47400020
         LA    R6,L3(,R6)               MVE PAST ADR FLD IN TNT  S21903 47600022
         BCT   R11,QMM10               SUB FROM NO TNT ENTRIES          47800020
         TM    CKPFLAGS,CKPOPNEN        UPDATING TERMINAL ENTRY@OX16402 47840000
         BO    QMM62                    BRANCH YES             @OX16402 47880000
         OI    CKPFLAGS,CKPOPNEN        INDICATE TERMINAL SCAN @OX16402 47920000
         B     QMM05                    UPDATE TERMINAL ENTRIES@OX16402 47960000
         SPACE                                                          48000020
*END OF LOOP THROUGH TERMNAME TABLE                                     48200020
         EJECT                                                 @Y17XANL 48300000
QMM62    EQU   *                                               @OX16402 48350000
         NI    CKPFLAGS,AVTEFF-CKPOPNEN TURN OFF BIT           @OX16402 48400000
         LA    R3,CKPAVTLN(R3)          LENGTH OF AVT FIELDS    SA68675 48600005
         BAL   R10,QMM78                RECORD FULL             SA68675 48800005
         ICM   R10,HALF,CKPRCDSR        GET COUNT OF RECORDS   @XA05313 49000056
         BNZ   QMM65                    BRANCH IF MORE THAN 1 SEG       49400020
         STH   R3,CKPBPERR              RESET SEG LENGTH TO TOTAL S     49600020
QMM65    EQU   *                                                        49800020
         LA    R10,1(,R10)              ADD ONE FOR PARTIAL RCD         50000020
         STH   R10,CKPRCDSR            RESTORE COUNT                    50200020
         SPACE 3                                                        50400020
*FIGURE NO OF TRACKS IN CKPT DATA SET                                   50600020
         SPACE                                                          50800020
QMM66    EQU   *                                                        51000020
         L     R10,CKPSAVE1+60          RESTORE R10                     51200020
         L     R14,DCBDEBAD             DEB ADDRESS            @G36XRNU 51250000
         SPACE                                                          51300000
         USING DXDEB,R14                BASE FOR DEB           @G36XRNU 51350000
         SR    R1,R1                    CLEAR COUNT OF TRACKS           51800020
         L     R13,DXDEBUCB             UCB ADDRESS            @G36XRNU 52000000
         SR    R15,R15                                                  52200020
         IC    R15,DXDEBUSR             GET NO. EXTENTS        @G36XRNU 52400000
QMM67    EQU   *                                                        52600020
         AH    R1,DXDEBNTR              ADD TRACKS IN THIS EXT @G36XRNU 52800000
         LA    R14,L16(,R14)            GO TO NXT EXTENT IN DEB  S21903 53000022
         BCT   R15,QMM67                RELOOP FOR NEXT EXTENT   S99240 53200022
         STH   R1,CKPTRKSA              SAVE NO. OF TRKS AVAIL          53400020
         TM    AVTDPARM,CKP3705         3705 CHECKPOINT DCB      S22024 53460022
         BO    QMM6905                  YES, ENVIRON RECORDS ONLYS22024 53520022
         SPACE 2                                               @Y17XANL 53560000
*DETERMINE SIZE OF INCIDENT RECORDS AND NUMBER OF RECORDS PER TRACK.    53650000
*FOR 3705 CHECKPOINT THIS AMOUNTS TO DETERMINING HOW MANY      @Y17XANU 53700000
*RESOURCE RECORDS PER TRACK CAN BE WRITTEN.                    @Y17XANU 53750000
         SPACE                                                          54000020
         ICM   R15,ALL,AVTOPTPT         ADDRSS OF OPTION TABLE   Y01948 54200004
         LA    R1,CDROPCBL-(CDROPTN-CDROPCB) GET MINIMUN LENGTH  S99240 54600022
         BZ    QMM68                    BRANCH IF OPTIONS USED     0525 54800020
         L     R15,0(,R15)              END OF OPTION TABLE        0525 55000020
         MVC   CKPSAVE2(2),0(R15)       MOVE TO BOUNBARY           0525 55200020
         CH    R1,CKPSAVE2              COMPARE OPTIONS WITH OPERAT    X55400020
                                        CONTROL BLOCK LENGTH            55600020
         BNL   QMM68                    BRANCH IF OPTIONS LOW           55800020
         LH    R1,CKPSAVE2              LONGEST OPTION FIELD            56000020
QMM68    EQU   *                                                        56200020
         LA    R1,CDROPTN-IEDQCDRD(,R1) LENGTH OF RECORD                56400020
         STH   R1,CKPINCLN              SAVE LENGTH                     56600020
         BAL   R11,QMM80                GET NUMBER PER TRACK            56800020
         STC   R15,CKPIPERT             SAVE NUMBER OF RCDS             57000020
         EJECT                                                 @Y17XANL 57100000
*DETERMINE NUMBER OF CKREQ RECORDS PER TRACK                            57400020
         SPACE                                                          57600020
         SR    R11,R11                  CLEAR OPTION LENGTH TO 0   0525 57800020
         TM    CKPFLAGS,CKPOPTFN        CHECK IF OPTION FIELDS USED0525 58000020
         BZ    QMM69                    BRANCH IF OPTIONS NOT USED 0525 58200020
         LH    R11,CKPSAVE2             LONGEST OPTION FIELD            58400020
QMM69    EQU   *                                                   0525 58600020
         LA    R0,CKPQCBLN+CKPQBKLN     LENGTH OF QCB FIELDS    SA51078 58800022
         SR    R1,R1                                                    59000020
         IC    R1,CKPPRQNO              MAX COUNT OF PRI QCBS-PROCE     59200020
         MR    R0,R0                    TOTAL LENGTH OF PRI QCB         59400020
         LA    R1,CDRCKQCB-IEDQCDRD(R11,R1) LENGTH OF CKREQ RECORD      59600020
         CH    R1,CKPCKRLN              NEW HIGH FOUND          SA58448 59660022
         BNH   QMM6901                  BRANCH IF NO            SA58448 59720022
         STH   R1,CKPCKRLN              SAVE LENGTH                     59800020
QMM6901  EQU   *                                                SA58448 59900022
         BAL   R11,QMM80                GET COUNT PER TRACK             60000020
         STC   R15,CKPCPERT             SAVE COUNT PER TRACK            60200020
         SPACE 3                                               @Y17XANL 60300000
*DETERMINE NUMBER OF ENVIRONMENT RECORD SEGMENTS PER TRACK.             60600000
*FOR THE 3705 CHECKPOINT DATA SET, THIS IS THE NUMBER OF       @Y17XANL 60630000
*RECORDS PER TRACK.                                                     60660000
QMM6905  EQU   *                                                 S22024 60700022
         SPACE                                                          60800020
         LH    R1,CKPBPERR              LENGTH OF ENV RCD SEGMENT       61000020
         BAL   R11,QMM80                GET NUMBER PER TRACK            61200020
         STC   R15,CKPRPERT             SAVE NUMBER RCDS/TRACK          61400020
         TM    AVTDPARM,CKP3705         3705 CKPT DCB          @Y17XANL 61408000
         BZ    QMM70                    NO, BRANCH             @Y17XANL 61416000
         EJECT                                                 @Y17XANL 61424000
*********************************************************************** 61432000
*                                                                     * 61440000
*        CALCULATE THE 3705 TRACK CONSTANT. THIS CONSTANT IS USED     * 61448000
*        BY THE CHECKPOINT SUBTASK AS AN UPPER LIMIT OF VALID         * 61456000
*        RESOURCE NUMBERS FOR CHECKPOINTING TO THIS CHECKPOINT        * 61464000
*        DATA SET. IT IS ALSO USED TO CALCULATE THE TRACK ADDRESS     * 61472000
*        OF THE SECOND RECORD OF THE TWO RECORDS ASSIGNED FOR         * 61480000
*        EACH RESOURCE.                                               * 61488000
*                                                                     * 61496000
*********************************************************************** 61504000
         LH    R1,CKPTRKSA              GET NUMBER OF TRACKS   @Y17XANL 61512000
*                                       AVAILABLE              @Y17XANL 61520000
         N     R1,AVTCLRHI              CLEAR HIGH HALF WORD   @Y17XANL 61528000
         MR    R0,R15                   GET NUMBER OF RECORDS  @Y17XANL 61536000
*                                       ON 3705 CKPT DATA SET  @Y17XANL 61544000
         SRL   R1,1                     DIVIDE BY 2 TO FIND    @Y17XANL 61552000
*                                       TRACK CONSTANT         @Y17XANL 61560000
         STH   R1,CKPTRKCN              SAVE IN CKPT WORKAREA  @Y17XANL 61568000
         EJECT                                                 @Y17XANL 61576000
*PREPARE TO XCTL TO NEXT MODULE                                         61800020
         SPACE                                                          62000020
QMM70    EQU   *                                                        62200020
         LM    R14,R11,CKPSAVE1+12      RESTORE REGS             S22024 62400022
         MVC   0(AL2,R8),QMM42          ID NXT LOAD OF OPEN    @G36XRNU 62600000
QMM72    EQU   *                                                        63000020
         LA    R8,L8(,R8)               INCR CURRNT WTG ENTRY    S21903 63200022
         LA    R7,L4(,R7)               INCR CURRNT DCB          S21903 63400022
         CLC   QMMXX(2),0(R8)           IS SAME EXECUTOR REQUIRED       63600020
         BE    QMM00                    YES, RETURN TO PROCESS ITS22024 63800022
         CLC   0(L2,R8),QMM0S           CHK FOR END OF TBL       S21903 64000022
         BNE   QMM72                    BRANCH IF NOT END               64200020
         LR    R7,R5                    RESER PARM LIST ADDR            64400020
         LA    R8,L32(R6)               RESET WTG TABLE ADDR     S21903 64600022
QMM73    EQU   *                                                        64800020
         CLI   0(R8),ZERO               CHK FOR ZERO ENTRY       S21903 65000022
         BNZ   QMM74                    BRANCH IF NOT ZERO              65200020
         LA    R8,L8(,R8)               ADDR NXT WTG ENTRY       S21903 65400022
         LA    R7,L4(,R7)               ADDR NXT DCB             S21903 65600022
         B     QMM73                    RELOOP                   S99240 65800022
         SPACE 3                                                        66000020
*TRANSFER CONTROL TO NEXT EXECUTOR                                      66200020
         SPACE                                                          66400020
QMM74    EQU   *                                                        66600020
         LA    R15,CKPGETML             ADDR OF PARM LIST               66800020
         MVC   L6(L2,R6),0(R8)          MVE MOD ID TO WTG TBL    S21903 67000022
         XCTL  DE=(R6),SF=(E,(15))                                      67400020
         EJECT                                                 @Y17XANL 67500000
*SUBROUTINE TO CHECK FOR REACHING LENGTH OF ONE RECORD. IF LENGTH       67800020
*IS REACHED,ONE IS ADDED TO COUNT OF RECRDS REQUIRED AND THE BYTE       68000020
*COUNT IS REINITIALIZED. IF THE COUNT0IS REINTIALIZED, CONTROL IS       68200020
*RETURNED TO THE VALUE IN RDCB-8 ,SO THAT THE LENGTH OF THE FIELD       68400020
*CAN BE ADDED AGAIN TO THE NEW COUNT.                                   68600020
         SPACE                                                          68800020
QMM78    EQU   *                                                        69000020
         CR    R3,R14                   CHECK FOR RECORD SIZE           69200020
         BCR   LO,R10                   BR IF NOT REACHED YET    S21903 69400022
         SPACE                                                          69600020
         LH    R3,CKPRCDSR              GET TRKS REQUIRED FOR TOTAL     69800020
         LA    R3,C1(,R3)               ADD ONE TO COUNT         S21903 70000022
         STH   R3,CKPRCDSR              RESTORE                         70200020
         LA    R3,CDRTINFO              INITIALIZE COUNT TO LENGTH     X70400020
                                        OF CONTROL INFO IN DISK RCD     70600020
         SH    RDCB,QMMEIGHT            GET BRANCH ADDRESS              70800020
         BR    R10                      RETURN                   S99240 71000022
         SPACE 3                                                        71200020
         SPACE                                                          77400020
*END OF SUBROUTINE                                                      77600020
         EJECT                                                 @Y17XANL 77601000
*SUBROUTINE TO DETERMINE THE NUMBER OF RECORDS ON ONE TRACK             77634556
         SPACE                                                          77635056
QMM80    EQU   *                                                        77635556
         L     R3,16                    ADDRESS OF CVT                  77636056
         USING IEDQDCTD,R3                                              77636556
         L     R3,CVTZDTAB(R3)          ADDRESS OF DEVICE CHAR TABL     77637056
         SR    R15,R15                                                  77637556
         IC    R15,L19(R13)             GET DVCE TYP FROM UCB    S21903 77638056
         IC    R15,0(R3,R15)            GET OFFSET TO ENTRY FOR DEV     77638556
         LA    R3,0(R3,R15)             GET ADDR OF ENTRY FOR DEVCE     77639056
         LH    R15,DCTBYTE              GET COUNT OF BYTES PER TRCK     77639556
         SR    R4,R4                                                    77640056
         IC    R4,DCTINTRO              OVERHEAD FOR INTERMEDIATE R     77640200
         SR    R0,R0                                                    77640500
         IC    R0,DCTKEY                AMOUNT OF OVERHEAD TO SUB-     X77641000
                                        TRACT IF KEYS ARE NOT USED      77642056
         SR    R14,R14                  CLEAR REG              @YA11949 77642500
         IC    R14,DCTLASTO             GET OVERHEAD OF LAST   @YA11949 77643000
         TM    DCTOPT,DCT1OH            ONLY ONE OVERHEAD      @YA11949 77644000
         BZ    QMM81                    NO, BRANCH             @YA11949 77645000
         LH    R14,DCTINTRO             GET THE HALFWD OVERHEAD@YA11949 77646000
         LR    R4,R14                   SET FOR BOTH           @YA11949 77647000
QMM81    EQU   *                                               @YA11949 77648000
         SR    R4,R0                    ADJUST IF KEYS NOT USED@YA11949 77649000
         SR    R14,R0                   SUB VALUE FOR NO KEYS           77650000
         AR    R14,R1                   TRUE LENGTH OF LAST RECORD      77651000
         TM    DCTOPT,DCTTOL            TOLERANCE FACTOR?      @YA11949 77652000
         BZ    QMM82                    NO, BRANCH             @YA11949 77653000
         MH    R1,DCTOLERN              MULTIPLY BY TOLERENCE FACTR     77654000
         SRL   R1,9                     DIVIDE BY 512                   77655000
QMM82    EQU   *                                               @YA11949 77656000
         AR    R1,R4                    TRUE LENGTH OF IMM RECORD       77657000
         SR    R15,R14                  SUB LENGTH OF LAST RCD FROM    X77658000
                                        NUMBER OF BYTES PER TRACK       77659000
         SR    R14,R14                  CLEAR FOR DIVIDE                77660000
         DR    R14,R1                   COUNT OF IMM RCDS PER TRACK     77661000
         LA    R15,C1(,R15)             ADD 1 TO LAST RECORD     S21903 77662000
         BR    R11                      RETURN                          77663000
         EJECT                                                          77664000
************************************************************** @Y17XANU 77665000
*                                                            * @Y17XANU 77666000
*        THE PURPOSE OF THIS ROUTINE IS TO DETERMINE THE     * @Y17XANU 77667000
*        NUMBER OF BYTES OF THE TTE TO BE CHECKPOINTED.      * @Y17XANU 77668000
*                                                            * @Y17XANU 77669000
*        INPUT - RTERM = TTE ADDRESS                         * @Y17XANU 77670000
*                R3    = CURRENT RECORD TOTAL                * @Y17XANU 77671000
*                RQCB  = QCB ADDRESS                         * @Y17XANU 77672000
*                R15   = RETURN ADDRESS                      * @Y17XANU 77673000
*                                                            * @Y17XANU 77674000
*        OUTPUT - R3   = NEW UPDATED RECORD TOTAL            * @Y17XANU 77675000
*                                                            * @Y17XANU 77676000
************************************************************** @Y17XANU 77677000
QMM85    EQU   *                                               @Y17XANU 77678000
         LA    R3,CKPTRMLN+CKPDELLN(R3) ADD FIXED LEN TO TOTAL @Y17XANU 77679000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES @Y17XANU 77680000
*                                       FOR ONE RECORD         @Y17XANU 77681000
         TM    TRMSTATE,TRMLOG          TPROCESS ENTRY         @Y17XANU 77682000
         BM    QMM8540                  BRANCH IF YES          @Y17XANU 77683000
         TM    TRMSTATE,TRMPREF         3705 RESOURCE          @Y17XANU 77684000
         BO    QMM8560                  YES                    @Y17XANU 77685000
         TM    TRMSTATE,TRMSNGLE        SINGLE ENTRY           @Y17XANU 77686000
         BNZ   QMM8520                  NO                     @Y17XANU 77687000
         LA    R3,CKPSENSE(R3)          ADD LEN OF SENSE FIELD @Y17XANU 77688000
*                                       TO TOTAL               @Y17XANU 77689000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES @Y17XANU 77690000
*                                       FOR ONE RECORD         @Y17XANU 77691000
         SPACE                                                          77692000
QMM8520  EQU   *                                               @Y17XANU 77693000
         TM    QCBDSFLG,QCBDISK         DISK QUEUEING          @Y17XANU 77694000
         BZ    QMM8590                  NO - RETURN            @Y17XANU 77695000
         LA    R3,CKPSEQLN(R3)          ADD SEQ FIELDS LEN TO  @Y17XANU 77696000
*                                       TOTAL                  @Y17XANU 77697000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES @Y17XANU 77698000
*                                       FOR ONE RECORD         @Y17XANU 77699000
         B     QMM8590                  EXIT                   @Y17XANU 77700000
         SPACE 2                                                        77701000
QMM8540  EQU   *                                               @Y17XANU 77702000
         LA    R3,CKPSEQLN(R3)          ADD SEQ FIELDS LEN TO  @Y17XANU 77703000
*                                       TOTAL                  @Y17XANU 77704000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES @Y17XANU 77705000
*                                       FOR ONE RECORD         @Y17XANU 77706000
         B     QMM8590                  EXIT                   @Y17XANU 77707000
         SPACE                                                          77708000
QMM8560  EQU   *                                               @Y17XANU 77709000
         CLI   TRMTYPE,TRMLUNT          LUNT ENTRY             @Y17XANU 77710000
         BE    QMM8565                  YES                    @Y17XANU 77711000
         CLI   TRMTYPE,TRMPSNA          PRE SNA TERMINAL ENTRY @Y17XANU 77712000
         BE    QMM8565                  YES                    @Y17XANU 77713000
         CLI   TRMTYPE,TRMCTERM         CTERM ENTRY            @Y17XANU 77714000
         BNE   QMM8570                  NO - CONTINUE          @Y17XANU 77715000
QMM8565  EQU   *                                               @Y17XANU 77716000
         TM    QCBDSFLG,QCBDISK         DISK QUEUEING          @Y17XANU 77717000
         BZ    QMM8570                  NO - CONTINUE          @Y17XANU 77718000
         LA    R3,CKPSEQLN(R3)          ADD SEQ FIELDS LEN TO  @Y17XANU 77719000
*                                       TOTAL                  @Y17XANU 77720000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES @Y17XANU 77721000
*                                       FOR ONE RECORD         @Y17XANU 77722000
         SPACE                                                          77723000
QMM8570  EQU   *                                               @Y17XANU 77724000
         LA    R3,CKPNRSZ(R3)           ADD 3705 FIELDS LEN    @Y17XANU 77725000
*                                       TO TOTAL               @Y17XANU 77726000
         BAL   R10,QMM78                CHECK FOR ENOUGH BYTES @Y17XANU 77727000
*                                       FOR ONE RECORD         @Y17XANU 77728000
QMM8590  EQU *                                                 @Y17XANU 77729000
         BR    R15                      RETURN TO CALLER       @Y17XANU 77730000
         EJECT                                                          77731000
QMMCOMP  CLI   TRMOPNO,0                CHECK FOR END OF OPTION FLD1109 77732000
QMMCOMPR CLI   CKPPRQNO,0               COMPARE                  S22024 77733000
QMMEIGHT DC    H'8'                     FOR ADJUSTING BRANCH ADDR       77800020
ADD3     DC    F'3'                     CONSTANT               @OZ26495 77850082
X60      EQU   X'60'                    FLAG FOR DIAL/ADDR     @OZ26495 77900082
X40      EQU   X'40'                    FLAG FOR DIAL DIGITS   @OZ26495 77950082
SIZ3520  EQU   3520                     MAX ENV RECORD SIZE      S22027 78130022
DCBBLKSI EQU   62                       DCBBLKSIZE OFFSET IN DCB S22027 78160022
CKP3705  EQU   X'10'                    OPTCD=I                  S22024 78166022
CKPNMINL EQU   38                       MINIMUM 3705 RECORD LEN  S22024 78172022
CKPMAXL  EQU   278                      MAX BUFSIZE FOR 3705     S22024 78175022
LENOFF   EQU   43                       OFFSET INTO MESSAGE      S22024 78178022
AL2      EQU   2                        CONSTANT TWO           @G36XRNU 78181000
THREE    EQU   3                        CONSTANT OF THREE        S22024 78184022
TCBTIO   EQU   12                       TIOT IN TCB              S22024 78190022
TIOEDDNM EQU   4                        DDNAME IN TIOE           S22024 78190922
DDNAME   EQU   12                       OFFSET TO DDNAME IN MSG  S22024 78191822
DDL      EQU   8                        SIZE OF DDNAME           S22024 78192722
BLKSIZE  EQU   50                       OFFSET TO BLKSIZE IN MSG S22024 78193622
FOUR     EQU   4                        SIZE OF MOVE INTO MESSAGES22024 78194522
BLKSMALL EQU   16                       OFFSET TO TOO SMALL MSG  S22024 78195422
BLKBIG   EQU   20                       OFFSET TO TOO BIG MSG    S22024 78196322
PATCH    DC    12F'0'                   PATCH AREA             @Y17XANU 78196700
MIN3705  DC    C' 038'                  MIN BLKSIZE FOR 3705     S22024 78197222
MAX3705  DC    C'0278'                  MAX BLKSIZE FOR 3705     S22024 78198122
IEDNMG   DC    CL8'IEDNMG'              NAME OF MESSAGE MODULE   S22024 78199022
QMM42    DC    C'42'                    ID OF NEXT LOAD        @G36XRNU 78199200
QMMXX    DC    CL2'49'                  ID OF THIS LOAD        @G36XRNU 78199400
QMM0S    DC    CL2'0S'                  ID OF LAST OPEN LOAD   @G36XRNU 78199600
DXPDEBAD EQU   X'1D0'                   OFFSET TO DEB ADDRESS IN Y01004 78200004
*                                         OPEN WORK AREA         Y01004 78250004
WTGC     EQU   52                                                Y01004 78300004
RLD      EQU   22                       OFFSET TO RLD FLAG     @XA05305 78310056
RECLNG   EQU   25                       OFFSET TO MODULE SIZE  @XA05305 78320056
         EJECT                                                 @Y17XANL 79400000
         TAVTD                                                          81600020
         EJECT                                                          81620000
FORCORE  DSECT                                                 @G36XRNU 81640000
         IECDSECT                                              @G36XRNU 81660000
         EJECT                                                 @Y17XANL 81700000
         TCKPD 3330                                                     81800000
         EJECT                                                 @Y17XANL 81900000
         DCBD  DSORG=TX                                                 82000020
         EJECT                                                 @Y17XANL 82100000
         TQCBD                                                          82200020
         EJECT                                                 @Y17XANL 82300000
         TTNTD                                                          82400020
         EJECT                                                 @Y17XANL 82500000
         TTRMD                                                          82600020
         EJECT                                                 @Y17XANL 82700000
*DSECT FOR DEB                                                          82800020
         SPACE                                                          83000020
IEDQDEB  DSECT                                                          83200020
         ORG   IEDQDEB+16               OFFSET TO NO. OF EXTENTS S99240 83400022
DEBNMEXT DS    X                        NO. EXTENTS IN DATA SET  A42410 83600021
         ORG   IEDQDEB+25               OFFSET TO DCB ADDR.      S99240 83800022
DEBDCBAD DS    AL3                      ADDR OF DCB                     84000020
         ORG   IEDQDEB+32               OFFSET TO DEV DEPENDENT  S99240 84200022
*                                        FIELDS IN DEB           S99240 84300022
DEBDVMOD DS    XL1                      DEVICE MODIFIER                 84400020
DEBUCBAD DS    XL3                      ADDRESS OF UCB                  84600020
DEBBINUM DS    XL2                      BIN NO                          84800020
DEBSTRCC DS    XL2                      CYLINDER ADDR FOR START         85000020
DEBSTRHH DS    XL2                      TRACK ADDR FOR START OF EXT     85200020
DEBENDCC DS    XL2                      CYLINDER ADDR FOR EXTNT END     85400020
DEBENDHH DS    XL2                      TRACK ADDR FOR EXTENT END       85600020
DEBNMTRK DS    XL2                      NO TRACKS IN THIS EXTENT        85800020
DEBEND  EQU   *                                                         86000020
DEBSEGLN EQU   DEBEND-DEBDVMOD          LNGTH OF SEG FOE EACH EXTNT     86200020
         EJECT                                                 @Y17XANL 86300000
*DSECT FOR ONE ENTRY IN THE I/O DEVICE CHARACTERISTICS TABLE            86600020
         SPACE                                                          86800020
IEDQDCTD DSECT                                                          87000020
         DS    X                        FILLER                          87200022
DCTCYL   DS    X                        NUMBER OF CYLINDERS             87400020
DCTRACKS DS    H                        NUMBER TRACKS PER CYLINDER      87600020
DCTBYTE  DS    H                        FILLER                   S99240 87800022
DCTINTRO DS    X                        OVERHEAD FOR EACH INTER-       X88000020
                                        MEDIATE RECORD                  88200020
DCTLASTO DS    X                        OVERHEAD FOR THE LAST RECRD    X88400020
                                        ON A TRACK                      88600020
DCTKEY   DS    X                        AMOUNT TO SUBTRACT FROM        X88800020
                                        OVERHEAD IF KEYS ARE NOT       X89000020
                                        USED                            89200020
DCTOPT   DS    X                                               @YA11949 89400058
DCT1OH   EQU   X'08'                    HALFWD OVERHEAD        @YA11949 89460058
DCTTOL   EQU   X'01'                    TOLERANCE FACTOR USED  @YA11949 89520058
DCTOLERN DS    H                        TOLERENCE FACTOR FOR EACH      X89600020
                                        INTERMEDIATE RECORD             89800020
         SPACE 5                                               @Y17XANL 89900000
         END                                                            90000020
