         TITLE 'IGG01950 IND OFLOW VALIDATION FOR VLR'           S20201 00200020
IGG01950 CSECT                                                          00201037
*                                                                       00202002
*********************************************************************** 00203002
*                                                                     * 00204002
* MODULE-NAME = IGG01950                                              * 00205002
*                                                                     * 00206002
* DESCRIPTIVE-NAME = ISAM OPEN, VALIDATION ROUTINE FOR VLR            * 00207002
*                                                                     * 00208002
* COPYRIGHT = NONE                                                    * 00209002
*                                                                     * 00210002
* STATUS = RELEASE OS/VS2-02, LEVEL 0                                 * 00211002
*                                                                     * 00212002
* FUNCTION = IF DCB OPENED FOR SHR, AND M OF DFALPDA IS NOT 0, XCTL   * 00213002
*            TO NEXT EXECUTOR.  OTHERWISE, IF INDEPENDENT OVERFLOW IS * 00214002
*            SPECIFIED:  INITIALIZE AND EXECUTE CHANNEL PROGRAM       * 00215002
*            VXCCW1B TO READ EOF OR END OF DS2LOVAD TRACK FOR         * 00216002
*            INDEPENDENT OVERFLOW RECORDS; UPDATE DS2RORG2, DS2OVRCT, * 00217002
*            AND DS2LOVAD; ERASE UNUSED PORTION OF TRACK; AND UPDATE  * 00218002
*            DS2BYOVL.                                                * 00219002
*                                                                     * 00220002
*            THEN, WHETHER IND. OV. SPECIFIED OR NOT:  INITIALIZE     * 00221002
*            AND EXECUTE CP VXCCW1B AGAIN TO READ EOF OR END OF       * 00221202
*            DS2LPRAD TRACK FOR PRIME DATA RECORDS; UPDATE DS2LPRAD;  * 00221402
*            AND IF DCB OPENED FOR SHR, AND M OF DFALPDA IS 0, MERGE  * 00221602
*            F2 DSCB FIELDS INTO FIELD AREA; AND, IF ENTERED FROM     * 00221802
*            RESTART, MERGE F2 DSCB FIELDS INTO DCB.                  * 00221902
*                                                                     * 00222002
* NOTES = SEE BELOW                                                   * 00223002
*                                                                     * 00224002
*    DEPENDENCIES = NONE                                              * 00225002
*                                                                     * 00226002
*    RESTRICTIONS = NONE                                              * 00227002
*                                                                     * 00228002
*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                     * 00229002
*                                                                     * 00230002
*    PATCH-LABEL = PATCH, A DC STATEMENT.                             * 00231002
*                                                                     * 00232002
* MODULE-TYPE = OPEN EXECUTOR                                         * 00233002
*                                                                     * 00234002
*    PROCESSOR = ASSEMXF-370R                                         * 00235002
*                                                                     * 00236002
*    MODULE-SIZE = 1115 DECIMAL BYTES                                 * 00237002
*                                                                     * 00238002
*    ATTRIBUTES = PRIVILEGED, REENTRANT                               * 00239002
*                                                                     * 00240002
* ENTRY-POINT = IGG01950                                              * 00241002
*                                                                     * 00242002
*    PURPOSE = SEE FUNCTION                                           * 00243002
*                                                                     * 00244002
*    LINKAGE = RECEIVES CONTROL FROM RESTART MODULE IGC0W05B, OR FROM * 00245002
*              ISAM OPEN EXECUTOR IGG01921 FOR RESUME LOAD, OR        * 00246002
*              IGG0192C FOR BISAM OR SCAN MODE.  RECEIVES CONTROL IN  * 00247002
*              STORAGE PROTECT KEY 5 AND PRIVILEGED STATE.            * 00247202
*                                                                     * 00248002
* INPUT = REGISTERS ESTABLISHED UPON ENTRY ARE                        * 00249002
*         REG 5 (RPAR) POINTS TO THE DCB COPY PARAMETER LIST          * 00250002
*         REG 6 (RWTG) POINTS TO THE O/C/EOV WHERE-TO-GO TABLE        * 00251002
*         REG 7 (RPARC) POINTS TO THE CURRENT ENTRY IN THE DCB COPY   * 00252002
*               PARAMETER LIST                                        * 00253002
*         REG 8 (RWTGC) POINTS TO THE CURRENT ENTRY IN THE WTG TABLE  * 00254002
*                                                                     * 00254202
*         HOWEVER, IF ENTERED FROM RESTART MODULE IGC0W05B, REGISTERS * 00254402
*         ARE ESTABLISHED AS FOLLOWS:                                 * 00254602
*         REG 1 (RVAL) POINTS TO THE RESTART AREA                     * 00254802
*         REG 4 (RCORE) POINTS TO THE OPEN WORK AREA                  * 00254902
*         REG 7 (RPARC) IS ZERO                                       * 00255202
*         REG 8 (RWTGC) POINTS TO THE RESTART TABLE                   * 00255402
*         REG 9 (RDEB) POINTS TO THE CURRENT RESTART ENTRY            * 00255602
*                                                                     * 00255702
* OUTPUT = REGISTERS 5 THROUGH 8 WILL BE IN THE SAME CONDITION AS     * 00256002
*          UPON ENTRY TO THIS MODULE                                  * 00257002
*                                                                     * 00258002
* EXIT-NORMAL = IF ENTERED FROM RESTART, RETURN VIA XCTL TO RESTART   * 00259002
*               MODULE IGC0W05B.  OTHERWISE XCTL TO ISAM OPEN         * 00259202
*               EXECUTOR IGG0192W FOR BISAM MODE, IGG01928 FOR SCAN   * 00259402
*               MODE, OR IGG0196C FOR RESUME LOAD MODE.               * 00259602
*                                                                     * 00260002
* EXIT-ERROR = ABEND CODES:                                           * 00261002
*              033 - I/O ERROR TRYING TO READ EOF OR EOT              * 00262002
*                                                                     * 00263002
*              IF ENTERED FROM RESTART, DO NOT ISSUE ABEND, BUT XCTL  * 00264002
*              TO IGC0W05B WITH ABEND CODE IN REGISTER 1.             * 00265002
*                                                                     * 00266002
* EXTERNAL-REFERENCES = SEE BELOW                                     * 00267002
*                                                                     * 00268002
*    ROUTINES = RESIDENT CONVERT ROUTINE                              * 00269002
*                                                                     * 00271002
*    DATA-AREAS = AREAS REFERENCED ARE:                               * 00272002
*                 FORCORE - OPEN WORK AREA                            * 00273002
*                                                                     * 00275002
*    CONTROL-BLOCKS = DCB, DCBFA, DEB, DSCB, IOB, AND CVT.            * 00276002
*                                                                     * 00277002
* TABLES = NONE                                                       * 00278002
*                                                                     * 00279002
* MACROS = ABEND, EXCP, WAIT, AND XCTL.                               * 00280002
*                                                                     * 00281002
* CHANGE-ACTIVITY = AS FOLLOWS:                                       * 00282002
*                                                                     * 00283002
*          RELEASE OS/VS2-02 DELETIONS                                * 00333002
*                                                               YM03922 00383002
*              OS/VS2 RELEASE 030 CHANGES                               00433037
* D482000-484000,C480000,A703800                                OZ04716 00483037
*                                                                     * 08007002
*A702200,702830,702830                                         @ZA06668 08007237
*C702250                                                       @ZA06668 08007437
*              CHANGES SINCE VS2-037                                    08007637
*A237100-237800                                                @ZA17080 08007737
*C238420                                                       @ZA24295 08007837
*A317600                                                       @ZA30069 08007937
*C237420,A222800,A237430-237470                                @ZA31637 08008037
*C237620,A237520                                               @ZA33836 08008137
*********************************************************************** 08008337
         EJECT                                                          08009002
DS2DSECT DSECT           FORMAT 2 DSCB                                  08010002
         DS    0D                                                       08012019
DS2KEY   DS    CL44                                                     08018019
DS2FMTID DS    CL1                                                      08024019
DS2NOLEV DS    CL1                                                      08030019
DS2DVIND DS    CL1                                                      08036019
DS21RCYL DS    CL3                                                      08042019
DS2LTCYL DS    CL2                                                      08048019
DS2CYLOV DS    CL1                                                      08054019
DS2HIRIN DS    CL1                                                      08060019
DS2HIRPR DS    CL1                                                      08066019
DS2HIROV DS    CL1                                                      08072019
DS2RSHTR DS    CL1                                                      08078019
DS2HIRTI DS    CL2                                                      08084019
DS2TAGDT DS    CL2                                                      08090019
DS2RORG3 DS    CL3                                                      08096019
DS2NOBYT DS    CL2                                                      08102019
DS2NOTRK DS    CL1                                                      08108019
DS2PRCTR DS    CL4                                                      08114019
DS2STIND DS    CL1                                                      08120019
DS2CYLAD DS    CL7                                                      08126019
DS2ADLIN DS    CL7                                                      08132019
DS2ADHIN DS    CL7                                                      08138019
DS2LPRAD DS    CL8                                                      08144019
DS2LTRAD DS    CL5                                                      08150019
DS2LCYAD DS    CL5                                                      08156019
DS2LMSAD DS    CL5                                                      08162019
DS2LOVAD DS    CL8                                                      08168019
DS2BYOVL DS    CL2                                                      08174019
DS2RORG2 DS    CL2                                                      08180019
DS2OVRCT DS    CL2                                                      08186019
DS2RORG1 DS    CL2                                                      08192019
         DCBD  DSORG=IS                                          A34959 08196020
FORCORE  DSECT                                                          08200018
         IECDSECT                                                       08400018
*                       CP TO READ TO EOF                        A25984 10400019
         ORG   DXCCW                                             A25984 12400019
VXCCW1   DS    BL8                 SRCH ID EQ                           15600018
VXCCW2   DS    BL8                     TIC                              15800018
VXCCW3   DS    BL8                 RD CKD                               16000018
VXCCW4   DS    BL8                 RD CKD                               16200018
VXCCW5   DS    BL8                 TIC                                  16400018
VXCCW6   DS    BL8                     COUNT FLD                        16600018
VXCCW7   DS    BL8                 COUNT FLD                            16800018
VXCCW8   DS    BL8                 NEW MBBCCHHR                         17000018
SAVEREG  DS    CL8                     REG. SAVE AREA                   17200018
         DS    CL4                     OLD TTR                          17400018
SAVER2   DS    CL2                     NEW R VALUE                      17600018
SAVER1   DS    CL2                     OLD R VALUE                      17800018
         SPACE 4                                                        17850002
IHADEB   IGGDEBD                                                 Y02072 17900002
         SPACE 4                                                        17950002
R0       EQU   0                        WORK REG                        18200018
RVAL     EQU   1                        BASE REG FOR VALIDATE CP        18400018
RDSCB    EQU   2                        BASE REG FOR DSCB FORMAT 2      18600018
RBASE    EQU   3                        BASE REG FOR THIS MODULE        18800018
RCORE    EQU   4                        BASE REG FOR OPEN WORK AREA     19000018
RPAR     EQU   5         *              ADDR OF PARAMETER TABLE         19200018
RWTG     EQU   6         *              ADDR OF WHERE-TO-GO TABLE       19400018
RPARC    EQU   7         *              CURRENT PARAMETER ENTRY         19600018
RWTGC    EQU   8         *              CURRENT WHERE-TO-GO ENTRY       19800018
RRSTC    EQU   9                        CURRENT RESTART ENTRY    A44475 19900021
RDEB     EQU   9                        DEB PTR                         20000018
RA       EQU   10                       WORK REG                        20200018
RB       EQU   11                       WORK REG                        20400018
RC       EQU   12                       WORK REG                        20600018
RD       EQU   13                       WORK REG                        20800018
RE       EQU   14                       WORK REG                        21000018
RF       EQU   15                       WORK REG                        21200018
RJ       EQU   15                                                       21400018
R1       EQU   1                                                        21600018
*                                                                       21800018
*                                                                       22000018
CVTPTR   EQU   16                       LOCATION OF THE CVT PTR         22200018
SHR      EQU   X'80'                    TEST FOR DISP EQ SHR     Y02072 22210002
L3BYTE   EQU   7                        STORE 3 LOW ORDER BYTES  Y02072 22212002
LOAD     EQU   X'18'                                             A34959 22220020
DCBFA    IGGDCBFA                                                       22260020
BLOCKED  EQU   X'10'                    DCBRECFM FOR BLOCKED   @ZA31637 22280037
         EJECT                                                   A25984 22300019
IGG01950 CSECT                                                   A25984 22350019
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        22400018
         USING *,RBASE                                                  22600018
         USING FORCORE,RCORE                                            22800018
         USING DS2DSECT,RDSCB                                           23000018
         USING IHADCB,RB                                         A25984 23040019
         LTR   RPARC,RPARC              CHECK FOR RESTART ENTRY  A25984 23080019
         BNZ   OPEN                     BRANCH IF NOT            A25984 23120019
         STM   RDSCB,RA,DXDSCB          SAVE REG 2-10 IN F1 DSCB A25984 23160019
         L     RB,0(RRSTC)              GET CURRENT DCB ADDR     A44475 23200021
         LA    RDSCB,DXJBF              POINT TO FORMAT 2 DSCB   A25984 23240019
         B     COMMON                                            A25984 23280019
OPEN     EQU   *                                                 A25984 23320019
         L     RB,0(RPARC)              SET DCB ADDR                    23400018
         L     RCORE,4(RWTGC)           SET OPEN WK AREA ADDR           23600018
         L     RDSCB,DSCCORE            SET PTR TO F2 DSCB       A25984 23700019
         CLC   DCBKEYLE,DSCKEYL         IS KEY EQUAL ?         @ZA17080 23706037
         BNE   COMMON1                  NO ABEND               @ZA17080 23710037
         CLI   DCBRECFM,X'00'           IS RECFM 0?            @ZA17080 23714037
         BE    COMMON1                  YES, ABEND             @ZA17080 23718037
         IC    RF,DCBRECFM              SAVE RECFM             @ZA17080 23722037
         NI    DCBRECFM,X'FE'           RESET KEYL BIT         @ZA17080 23726037
         CLC   DCBRECFM,DSCRECFM        DOES DCB RECFM EQUAL   @ZA17080 23730037
*                                       DSCB1 RECFM ?          @ZA17080 23734037
         STC   RF,DCBRECFM              RESTORE DCBRECFM       @ZA17080 23738037
         BNE   COMMON1                  NO-GO ABEND            @ZA31637 23742037
         TM    DSCRECFM,BLOCKED         RECORDS BLOCKED?       @ZA31637 23743037
         BNO   COMMON                   NO-GO AROUND ABEND     @ZA31637 23744037
         CLC   DCBBLKSI,DSCBLKL         DOES DCB BLKSIZE EQUAL @ZA31637 23745037
*                                       DSCB BLKSIZE?          @ZA31637 23746037
         BE    COMMON                   YES-GO AROUND ABEND    @ZA31637 23747037
COMMON1  LR    RDSCB,RB                 DCB PTR FOR PROB DETER @ZA33836 23752037
         ABEND X'03B',DUMP,,SYSTEM      NOT EQUAL ABEND.       @ZA33836 23762037
COMMON   EQU   *                                                 A25984 23800019
         L     RDEB,DCBDEBAD            SET DEB BASE             A44475 23803021
         USING IHADEB,RDEB              DEB ADDRESSABILITY       Y02072 23805002
*                                                                       23807020
*   IF DATA SET HAS BEEN OPENED FOR SHR, DEBDCBFA WILL CONTAIN          23814002
*        A POINTER TO THE DCBFA.  IF  M IS NONZERO IN DFALPDA,          23821002
*        DO NOT VALIDATE AS IT HAS BEEN DONE.                           23828002
*                                                                       23835020
         L     RA,DEBEXPTR              PTR TO DEB EXTENSION   @ZA24295 23842037
         USING DEBEXT,RA                EXTNSION ADDRSSABILITY   Y02072 23844002
         TM    DEBDCBFA,SHR             TEST FOR DISP EQ SHR     Y02072 23846002
         BZ    CNTINU                   BR TO CONTINUE RTN IF    A35340 23849020
*                                       NOT                      A35340 23856020
         L     RA,DEBDCBFA              ADDR OF FIELD AREA       Y02072 23860002
         USING DCBFA,RA                                          A37175 23864020
         CLI   DFALPDA,X'00'                                     A37175 23868020
         BNZ   NOEXEC                   BR TO END OF MODULE      A37175 23872020
CNTINU   EQU   *                                                 A35340 23877020
*                                                                       23884020
         LA    RVAL,DXCCW1              POINT TO WORKAREA CCWS   A25984 25100019
         ST    RB,IOBWGHT               SET DCB ADDR IN PHONY IOB       26000018
*INITIALIZE CHANNEL PROG TO READ EOF                                    26200018
*                                                                       26400018
         LM    RA,RF,VALCCW1                                            26600018
         LA    R0,DXDAADDR+3            POINT TO CCHHR           A25984 26800019
         ALR   RA,R0               OF DS2LOVAD                          27000018
         ALR   RC,RVAL                  RELOCATE ADDR FLDS IN           27200018
         ALR   RE,RVAL                     CCW2 AND CCW3                27400018
         STM   RA,RF,VXCCW1             INIT.VXCCW1,2,3                 27600018
         LM    RA,RD,VALCCW4                                            27800018
         ALR   RA,RVAL                  RELOCATE ADDR FLDS IN           28000018
         ALR   RC,RVAL                     CCW4 AND CCW5                28200018
         STM   RA,RD,VXCCW4             INIT.VXCCW4,5                   28400018
*                                                                       28600018
*                                                                       28800018
         CLI   DS2LOVAD,X'00'      ANY OVERFLOWS IN IND OFL             29000018
         BE    NOOVRFL             NO NO NEED TO UPDATE                 29200018
         MVC   DXDAADDR,DS2LOVAD        SET UP IOB SEEK ADDR            29400018
*                                                                       29600018
         BAL   RC,EOFREAD               GO READ EOF FOR          A35340 29700020
*                                       INDEPENDENT              A35340 29800020
*                                         OVERFLOW                      30000018
TESTIO   EQU   *                                                 A27811 30100019
         TM    IOBSTAT0,X'01'           END OF FILE                     30200018
         BO    SETLOVAD                 YES                             30400018
         CLI   IOBECBPT,X'42'           END OF EXTENT            A27811 30460019
         BNE   GOABEND                  NO, BR--I/O ERROR        A27811 30520019
         SR    RA,RA                    ELSE GO TO NEXT EXTENT   A27811 30580019
         IC    RA,DXDAADDR              GET M FROM IOB           A27811 30640019
         LA    RA,1(R0,RA)              ADD ONE FOR NEXT EXTENT  A27811 30700019
         STC   RA,DXDAADDR              PUT M+1 IN IOBSEEK       A27811 30760019
         CLC   DXDAADDR(1),16(RDEB)     DEBNMEXT VS NEXT M       A27811 30820019
         BE    NOOVRFL                  BR IF NO MORE EXTENTS    A27811 30880019
         SLL   RA,4                     M TIMES 16               A27811 30940019
         LA    RA,32(RA,RDEB)           NEW EXTENT               A27811 31000019
         MVC   DXDAADDR+3(4),6(RA)      MOVE CCHH TO IOB         A27811 31060019
         MVI   DXDAADDR+7,X'00'         START AT FIRST RECORD    A27811 31120019
         BAL   RC,EOTREAD               CHECK NEXT EXTENT        A35340 31160020
*                                       A2781                    A35340 31200020
         B     TESTIO                   CHECK CP RESULT          A27811 31240019
*                                                                       31400018
GOABEND  L     R1,ABENDCD                  PICK UP ABEND CODE           31600018
         LTR   RPARC,RPARC              IS RESTART IN CONTROL    A25984 31660019
         BZ    RESTARTX                 DON'T ABEND IF SO        A25984 31720019
         L     RCORE,DXUDCBAD           USERS DCB ADDRESS      @ZA30069 31760037
         ABEND X'033',DUMP,,SYSTEM      SYSTEM 033 ABEND         Y02072 31800002
*                                                                       32000018
SETLOVAD LA    RB,SETLIOV2                                              32200018
         LA    RE,NOOVRFL                                               32400018
         BAL   RF,STOPCHK                                               32600018
*                                                                       32800018
* SET UP NEW MBBCCHHR                                                   33000018
SETLIOV1 MVC   VXCCW8+3(5),VXCCW6       CCHHR FROM 1ST CT FLD           33200018
         B     SETLIOV3                                                 33400018
SETLIOV2 MVC   VXCCW8+3(5),VXCCW7       CCHHR FROM 2ND CT FLD           33600018
SETLIOV3 MVC   VXCCW8(3),DS2LOVAD       MBB INIT.SAME AS DSCB           33800018
*                                                                       34200018
NEWADDR  L     RC,CVTPTR               LOAD CVT POINTER                 34400018
         L     RF,32(RC)               LOAD ADDR OF CONVERT RT          34600018
         STM   RDSCB,RBASE,SAVEREG     SAVE REG.2,3                     34800018
         LR    RBASE,RVAL              SAVE REG.1                       35000018
         LR    R1,RDEB                  SET PTR TO DEB                  35200018
         LA    RDSCB,DS2LOVAD           SET PTR TO MBBCCHHR INPUT       35400018
         BALR  RE,RF                    CONVERT MBBCCHHR TO TTR         35600018
         LR    RDEB,R1                 RESTORE DEB PTR.                 35800018
         LR    RVAL,RBASE              RESTORE REG.1                    36000018
         ST    R0,SAVEREG+8            SAVE OLD TTR                     36200018
         LA    RDSCB,VXCCW8             SET PTR TO MBBCCHHR INPUT       36400018
         LR    R1,RDEB                 SET DEB PTR FOR CONVERT RT       36600018
         L     RC,CVTPTR               LOAD CVT PTR                     36800018
         L     RF,32(RC)               LOAD ADDR OF CONVERT RT          37000018
         BALR  RE,RF                    CON VERT MBBCCHHR TO TTR        37200018
         LR    RDEB,R1                  RESET DEB POINTR                37400018
         LR    RVAL,RBASE              RESTORE REG.1                    37600018
         LM    RDSCB,RBASE,SAVEREG     RESTORE REG.2,3                  37800018
         L     RA,SAVEREG+8             RA=OLD TTR. R0=NEW TTR          38000018
* UPDATE # OF UNUSED TRKS IN INDEPENDENT OVRFLO                         38200018
*                                                                       38400018
         STH   R0,SAVER2                SAVE NEW R VALUE                38600018
         STH   RA,SAVER1                SAVE OLD R VALUE                38800018
         SRL   R0,16                    SHIFT TO LOW ORDER 2 BYTE       38900018
         SRL   RA,16                    SHIFT TO LOW ORDER 2 BYTE       39000018
         SLR   R0,RA                    R0=NEW TT-OLD TT                39100018
         LR    RC,R0                   LOAD RC WITH DIFF.OF TTS         39400018
         LH    RB,DS2RORG2             OLD NO.UNUSED TRKS               39600018
         CLC   SAVER2(1),SAVER1        NEW R EQUAL OLD R                39800018
         BE    UPDATE1                 YES                              40000018
         CLC   SAVER2(1),DS2HIROV      NEW R EQUAL HI R FOR OVFL        40200018
         BNE   UPDATE1                 NO                               40400018
         LA    RC,1(RC)                ADD1 TO DIFFERENCE               40600018
UPDATE1  SR    RB,RC                   SUBTRACT DIFF, FROM NO. OF       40800018
*                                         UNUSED TRKS                   41000018
         STH   RB,DS2RORG2              UPDATE DS2RDRG2                 41200018
*                                                                       41400018
* UPDATE # OF RECORDS IN INDEPENDENT OVRFLO                             41600018
*                                                                       41800018
         LR    RD,R0                    RD=# TRKS DIFF.                 42000018
         SR    RC,RC                    CLEAR REG                       42200018
         IC    RC,DS2HIROV              RC=NO. REC/TRK                  42400018
         MR    RC,RC                    RD=NO.REC.DIFFERENCE            42600018
         SR    RA,RA                    CLEAR REG                       42800018
         SR    RB,RB                                                    43000018
         IC    RA,SAVER2                PICK UP R2                      43200018
         IC    RB,SAVER1                PICK UP R1                      43400018
         SR    RA,RB                    RA=NO.REC.DIFFERENCE            43600018
         AR    RD,RA                    RD=TOTAL NO.REC.DIFF.           43800018
         LH    RC,DS2OVRCT                                              44000018
         AR    RC,RD                   ADD TO NO OF REC IN OVRFLO       44200018
         STH   RC,DS2OVRCT              UPDATE DS2OVRCT                 44400018
*                                                                       44600018
         XC    VXCCW8+1(2),VXCCW8+1    ZERO BB                          44800018
         MVC   DS2LOVAD,VXCCW8          UPDATE DS2LOVAD                 45000018
*                                                                       45200018
*        UPDATE DS2BYOVL NUMBER OF BYTES REMAINING ON LST TRK           45400018
*                                                                       45600018
UPDATE30 LA    RA,VXCCW1                                                45800018
         ST    RA,IOBSTART-1      SET UP IOB                            46000018
         CLC   VXCCW6+2(2),VXCCW7+2 LAST REC & EOF ON SAME TRK          46200018
         BNE   UPDATE32           NO SRCH ON LAST OVFLOW REC            46400018
UPDATE31 LH    RA,VXCCW8+6        ADD 1 TO R TO POINT TO EOF            46600018
         LA    RA,1(RA)           & SEARCH ON EOF REC                   46800018
         STH   RA,VXCCW8+6                                              47000018
UPDATE32 EQU   *                                                 A25984 47400019
         MVC   VXCCW3(16),VALERASE     MOVE IN ERASE COMMAND            47800018
         LA    RA,VXCCW4               ERASE COUNT IS 32K       OZ04716 48000037
         STCM  RA,SEVEN,VXCCW3+1       SET UP VXCCW4 PTR        OZ04716 48050037
         MVC   DXDAADDR(8),VXCCW8  SET UP SEEK ADDR                     48600018
*                                                                       48800018
         BAL   RC,EOFREAD         ERASER REMAINDER OF TRK        A35340 48900020
*                                                                A35340 49000020
*                                                                       49200018
         TM    IOBSENS1,X'40'     TRK OVERRUN                           49400018
         BNO   GOABEND                  NO, TROUBLE, ABEND       M4045  49700020
*                                                                       50000018
*        DS2BYOVL = CCW COUNT - RESIDUAL                                50200018
*                                                                       50400018
UPDATE33 LH    RA,VXCCW4+6        PICK UP CCW COUNT                     50600018
         LH    RC,IOBCSW+6        PICK UP RESIDUAL                      50800018
         SR    RA,RC              GET DIFFERENCE                        51000018
         SH    RA,DEVTABLE                                       M4045  51040020
         BNM   UPDATE                                            M4045  51080020
         SR    RA,RA                                             M4045  51120020
UPDATE   EQU   *                                                 M4045  51160020
         STH   RA,DS2BYOVL        UPDATE FMT 2 FIELD                    51200018
*                                                                       51400018
         B     NOOVRFL                                                  51600018
*                                                                       51800018
* DETERMINE WHICH CCW THE CHANNEL PROG STOPPED ON;THE ONLY VALID STOPS  52000018
* ARE ON CCW4 OR CCW5                                                   52200018
*                                                                       52400018
*                                                                       52600018
STOPCHK  L     RC,IOBCOMAD              ADDR OF NXT CCW TO BE EXEC.     52800018
         LA    RC,0(RC)                 CLEAR HI ORDER BYTE             53000018
         LA    RD,VXCCW4                ADDR OF CCW4                    53200018
         CR    RC,RD                    NXT CCW IS VXCCW4               53400018
         BNE   SNDSTOP                  NO                              53600018
         NC    VXCCW7(8),VXCCW7         2ND COUNT FLD EMPTY             53800018
         BCR   8,RE                     YES,DSCB PTR CORRECT     A35340 54000020
FRSTOUT  BR    RB                       NO,UPDATE DSCB PTR TO 2ND CNT   54200018
SNDSTOP  LA    RD,VXCCW5                ADDR OF CCW5                    54400018
         CR    RC,RD                    NXT CCW IS VXCCW5               54600018
         BCR   8,RF                     YES,UPDATE DSCB PTR TO   A35340 54700020
*                                       1ST CNT                  A35340 54800020
         B     GOABEND                  ANY OTHER STOP IS ERROR         55000018
EOFREAD  SR    RA,RA                    CLEAR WORK REG.           16068 55600018
         IC    RA,DXDAADDR              GET M FROM IDB                  55800018
         SLL   RA,4                     M X 16                          56000018
         LA    RA,32(RA,RDEB)           POINT TO EXTENT OF M            56200018
EOTREAD  MVC   DXDAADDR+1(2),4(RA)      MOVE BB INTO IOB          16068 56400018
         XC    VXCCW6(16),VXCCW6        INIT.VXCCW6,7 TO ZERO    A35340 56500020
*                                        1606                    A35340 56600020
         LR    RB,RVAL                  SAVE REG.1                      56800018
*                                                                       57200018
         MVC   SAVEREG(4),28(RDEB)      SAVE APP VECT TBL PTR    A25984 57260019
         MVC   29(3,RDEB),DXDEBAPP+1    POINT TO DUMMY VECT TBL  A25984 57320019
         L     RVAL,IOBWGHT             ADDR OF COPY DCB         Y02072 57370002
         STCM  RVAL,L3BYTE,DEBDCBAD+1   DEB PT TO DCB COPY       Y02072 57380002
         EXCP  DXIOB                    READ TO EOF                     57400018
         WAIT  1,ECB=DXECB                                              57600018
*                                                                       57650002
         L     RVAL,DXUDCBAD            USERS DCB ADDRESS        Y02072 57660002
         STCM  RVAL,L3BYTE,DEBDCBAD+1   DEB PT TO USER DCB       Y02072 57662002
         MVC   28(4,RDEB),SAVEREG       RESTORE VECTOR TABLE PTR A25984 57700019
         LR    RVAL,RB                  RESTORE REG.1                   57800018
         BR    RC                                                A35340 58100020
**                                                                      60800018
*        UPDATE DS2LPRAD FROM LAST NORM INDEX ENTRY                     61000018
*                                                                       61200018
NOOVRFL  MVC   VXCCW8(5),DS2LPRAD  SET UP MBBCC OF INDEX                61400018
         MVC   VXCCW8+5(3),DS2LTRAD+2   SET   HHR                       61600018
         MVC   DXDAADDR(8),VXCCW8  SET UP IOB ADDR                      61800018
         LA    RA,VXCCW6                                                62000018
         ST    RA,VXCCW3                                                62200018
         MVI   VXCCW3,X'06'        SET CCW TO READ DATA                 62400018
         MVC   VXCCW3+4(4),VALPDACT  SET UP COUNT                       62600018
*                                                                       63400018
         BAL   RC,EOFREAD                                        A35340 63500020
*                                                                A35340 63600020
*                                                                       63800018
         CLI   IOBECBPT,X'7F'      ANY ERRORS                           64000018
         BNE   GOABEND             YES                                  64200018
*                                                                       64400018
         MVC   DS2LPRAD(8),VXCCW6  RESET LPRAD                          64600018
*                                                                       64800018
         L     RB,IOBWGHT               RESTORE DCB ADDRESS      A35340 65100020
         LA    RA,DXDCB                 ADDR OF PHONY DCB               65400018
         ST    RA,IOBWGHT                                               65600018
NOEXEC1  EQU   *                                                 A35340 65610020
         L     RA,DEBEXPTR              PTR TO DEB EXTENSION     Y02072 65620002
         USING DEBEXT,RA                EXTNSION ADDRSSABILITY   Y02072 65622002
         TM    DEBDCBFA,SHR             TEST FOR DISP EQ SHR     Y02072 65624002
*                                       VALIDATED                A35340 65630020
         BNO   NOEXEC                   BR IF NOT TO EXIT        A35340 65640020
         L     RA,DEBDCBFA              FIELD AREA ADDRESS       Y02072 65650002
         USING DCBFA,RA                                          A35340 65660020
         CLI   DFALPDA,X'00'                                     A37175 65663020
         BNZ   NOEXEC                                            A37175 65666020
         MVC   DFARORG3+L'DFARORG3-L'DS2RORG3(L'DS2RORG3),DS2RORG3      65680021
         MVC   DFANREC,DS2PRCTR                                  A35340 65690020
         MVC   DFAST,DS2STIND                                    A35340 65700020
         MVC   DFALPDA,DS2LPRAD                                  A35340 65710020
         MVC   DFANBOV,DS2BYOVL         NO. BYTES REMAINING ON  YM03922 65720002
*                                       CURRENT OVERFLOW TRACK  YM03922 65722002
         MVC   DFARORG2,DS2RORG2        FREE TRKS IN IND OVRFLW YM03922 65724002
         MVC   DFANOREC,DS2OVRCT        NO. RCDS IN OVERFLOW    YM03922 65726002
         MVC   DFALIOV,DS2LOVAD                                  A35340 65730020
         MVC   DFARORG1,DS2RORG1                                 A35340 65740020
NOEXEC   EQU   *                                                 A35340 65760020
         LTR   RPARC,RPARC              IF REGISTER IS ZERO,     A25984 65800019
         BZ    RESTART                  ENTRY WAS FROM RESTART   A25984 66000019
         TM    DCBMACRF,X'40'           TEST IF GET              A35340 66060020
         BO    SCANNEXT                                          A35340 66120020
         TM    DCBMACRF+1,LOAD          VLR RESUME LOAD          A34959 66230020
         BZ    BISAMNXT                 NO, BISAM                A34959 66260020
         MVC   0(L'LOAD6C,RWTGC),LOAD6C INITIALIZE WHERE-TO-GO   Y02072 66290002
         B     RELOOP                                            A34959 66320020
BISAMNXT EQU   *                                                 A34959 66350020
         MVC   0(L'LOAD2W,RWTGC),LOAD2W INITIALIZE WHERE-TO-GO   Y02072 66400002
         TM    DCBMACRF,SCAN            IS IT SCAN               S20201 66410020
         BZ    RELOOP                   NO, BRANCH               S20201 66420020
SCANNEXT MVC   0(L'LOAD28,RWTGC),LOAD28 INITIALIZE WHERE-TO-GO   Y02072 66520002
*********************************************************************** 66600018
RELOOP   LA    RWTGC,8(RWTGC)           INCREMENT WTG CURNT ENTRY       66800018
         LA    RPARC,4(RPARC)           INCREMENT DCB CURNT ENTRY       67000018
         CLC   0(2,RWTGC),THISLOAD                                      67200018
         BCR   8,RBASE                  BRANCH=BEGINNING OF THIS MODULE 67400018
         CLC   0(2,RWTGC),OPNLOD7       TEST FOR END OF WTG TABLE       67600018
         BC    7,RELOOP                 BRANCH=NOT AT END               67800018
ATEND    LR    RPARC,RPAR               INITIALIZE REPARC               68000018
         LA    RWTGC,32(RWTG)           INITIALIZE RWTGC                68200018
ZCHECK   CLI   0(RWTGC),X'00'           TEST FOR ENTRY = 0              68400018
         BC    7,TCTLRTN                BRANCH = NOT ZERO               68600018
ITSZERO  LA    RWTGC,8(RWTGC)                                           68800018
         LA    RPARC,4(RPARC)                                           69000018
         B     ZCHECK                                                   69200018
TCTLRTN  EQU   *                                                        69400018
         MVC   6(2,RWTG),0(RWTGC)       MOVE ID                         69600018
         LA    RJ,DXCCW12                                               70000018
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) XCTL TO NEXT LOAD  Y02072 70200002
RESTART  SR    RVAL,RVAL                ZERO RETURN CODE         A25984 70210019
         MODESET  KEYADDR=DXUKEY,WORKREG=1 CHANGE TO USER KEY  @ZA06668 70220037
         L     RB,DXUDCBAD              GET USER DCB ADDR      @ZA06668 70225037
         MVC   DCBNBOV(2),DS2BYOVL      MERGE BYTES ON OVERFLOW  A25984 70230019
         MVC   DCBLPDA(8),DS2LPRAD      MERGE FORMAT 2 FIELDS    A25984 70240019
         MVC   DCBST(1),DS2STIND        INTO DCB.                A25984 70250019
         MVC   DCBLIOV(8),DS2LOVAD                               A25984 70260019
         MVC   DCBNOREC(2),DS2OVRCT                              A25984 70270019
         MVC   DCBRORG2(2),DS2RORG2                              A25984 70280019
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY @ZA06668 70283037
         SR    RVAL,RVAL                RESTORE REG 1          @ZA06668 70286037
RESTARTX EQU   *                                                 A42870 70290021
         LA    RWTG,DXDSCB+464          SET UP WORKAREA FOR XCTL A25984 70300019
         MVC   0(8,RWTG),IGC0W05B       RESTART MODULE NAME      A25984 70310019
         ST    RWTG,DXDSCB+16           SAVE RWTG FOR RESTORE           70312000
         LM    RDSCB,RA,DXDSCB                                   A42870 70315021
         LA    RJ,8(RWTG)               SET UP REG FOR XCTL      A25984 70320019
         XCTL  EPLOC=(RWTG),DCB=0,SF=(E,(15)) RETURN TO RESTART  Y02072 70330002
SCAN     EQU   X'40'                    SCAN DCB                 S20201 70350020
FIVE     EQU   5                        MISC OFFSET              S20201 70370020
SEVEN    EQU   7                        CONSTANT 7              OZ04716 70380037
* CONSTANTS                                                             70400018
IGC0W05B DC    C'IGC0W05B'              ISAM RESTART MODULE      A25984 70500019
THISLOAD DC    C'50'                                              VLR   70600018
OPNLOD7  DC    C'0S'                                                    70800018
*        THE FOLLOWING ARE CONSTANTS THAT MUST BE SUBTRACTED            70810020
*        FROM TRK CAPACITY TO ALLOW FOR POSSIBLE VARIATIONS IN          70820020
*        THE VARIOUS DEVICES                                            70830020
DEVTABLE DC    H'422'                                            M4045  70930020
         DS    0F                                                S20201 71040020
ABENDCD  DC    X'80033000'             ABEND 33, DUMP OPTION ON         71200018
VALERASE DC    X'11'              ERASE COMMAND                         71400018
         DC    X'000000'                                                71600018
         DC    X'A0000008'                                              71800018
VALERCT2 DC    X'11000001'                                              72000018
VALERCT  DC    X'20007FFF'                                              72200018
*                                                                       72400018
VALPDACT DC    X'20000008'                                              72600018
VALCCW1  CCW   X'31',000,X'40',5        SRCH ID EQ   LPDA+3,5,CC        73000018
VALCCW2  CCW   X'08',000,X'00',0        TIC          VALCCW1            73200018
VALCCW3  CCW   X'9E',040,X'60',8       RD CKD(MT) VALCCW6,8,CC,SK       73400018
VALCCW4  CCW   X'9E',048,X'60',8       RD CKD(MT) VALCCW7,8,CC,SK       73600018
VALCCW5  CCW   X'08',016,X'00',0        TIC          VALCCW3            73800018
*                                                                       74400018
LOAD2W   DC    C'2W'                    ID OF MODULE IGG0192W    Y02072 74410002
LOAD28   DC    C'28'                    ID OF MODULE IGG01928    Y02072 74420002
LOAD6C   DC    C'6C'                    ID OF MODULE IGG0196C    Y02072 74430002
*                                                                       74440002
MODID    DC    CL8'IGG01950'            MODULE NAME            @ZA17080 74442037
DATE     DC    CL8'&SYSDATE'            DATE LAST CHANGED'     @ZA17080 74492037
FIX      DC    C'OZ33836'               LATEST FIX             @ZA30069 74542037
PATCH    DC    XL((*-IGG01950)/20)'00'  ZEROED PATCH AREA        Y02072 74592037
         END                                                            74642037
