196A     TITLE 'IGG0196A DEB CONSTRUCTION LOAD 2'                       00010002
IGG0196A CSECT                                                          00020019
*                                                                       00028019
*MODULE NAME - IGG0196A                                          Y02072 00028402
*                                                                       00028802
*DESCRIPTIVE NAME - FINISH DEB CONSTRUCTION                      Y02072 00029202
*                                                                       00029602
*COPYRIGHT - NONE                                                Y02072 00029702
*                                                                       00029802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00029902
*                                                                       00032402
*        VS2 RELEASE 040 CHANGES                                        00032503
* 101670-101972,115380                                         @ZA06110 00032603
*A103718-103722,103927-103933,115452                           @Z40MSRZ 00035004
*                                                                       00039204
*        VS2 RELEASE 03 DELETIONS                                       00041604
*A017720,023571,101619-101649,114500           XA06882/SA72925 @ZA01371 00044004
*A024198-024266,094559-094799,095500,096300,099793-099848,      ZA00742 00046404
*A099870,100100-100188,100300                                   ZA00742 00048804
*D059064,093650                                                 ZA00631 00051204
*A058947-059058,023594-023599                                   ZA00631 00053604
*D059064                                                       @ZM00636 00056004
*A058931                                                       @ZM00636 00058404
*D101703                                                        Z30AAWW 00060804
*A101707-101708,115364-115368                                   Z30AAWW 00063204
*                                                              @Z30TSCF 00065604
*        VS2 RELEASE 02 DELETIONS                                Y02072 00068004
*000120,000680,018400,035820-036020,058400-058820,058863,058927, Y02072 00070404
*115300-115380,056800,058859,103700,109100,113600,114400,        Y02072 00072804
*115700-117400                                                   Y02072 00075204
*                                                                YM3943 00077604
*D96400-96600,96800-98600                                        YM7814 00080004
*          RELEASE 21 DELETIONS                                         00082404
*0420098120                                                      A43728 00084804
*0420004800,017610-017700,035812,035900,036040,114000,114500-    S21042 00087204
*0420114560,116870-117800,135400-135600                          S21042 00089604
*0420                                                            S21092 00092004
*0420                                                            S21088 00094404
*          RELEASE 20 DELETIONS                                         00096804
*1471                                                            S20016 00099204
*1471                                                            A33605 00101604
* 058000                                                          M4878 00104004
*0000017600,101665-101755                                        M3591  00106404
*0000093800-094000                                               A25961 00108804
*1471                                                            S20202 00111204
*                                                                       00113604
*STATUS CHANGE LEVEL 003                                                00116004
* THIS MODULE IS A SPLIT OF IGG0191A FOR RELEASE 19                     00118404
*                                                                       00120804
*                                                                       00123204
*  CHANGES IDENTIFIED BY 'DM0D' IN COLUMNS 68-71 INSERTED          DM0D 00125604
*  IN SUPPORT OF CHECKPOINT/RESTART - RELEASE 17                   DM0D 00128004
*                                                                  DM0D 00130404
*                                                                       00132804
*FUNCTION  THIS EXECUTOR IS ENTERED FOR USERS OF SAM AND EXCP           00135204
*          DURING OPEN FOR THE CONSTRUCTION OF DEBS.                    00137604
*          DEBS ARE BUILT FOR ALL DEVICES SUPPORTED BY THE SEQUENTIAL   00140019
*          ACCESS METHODS OR PARTITIONED ACCESS METHOD.                 00160019
*                                                                       00180019
*ENTRY POINT - IGG0196A                                                 00210019
*              ENTERED FROM IGG0191A VIA XCTL                           00240019
*                                                                       00280019
*INPUT--  DCB ADDRESS                                                   00300019
*          WORK AREA ADDRESS                                            00320019
*          WHERE TO GO TABLE                                            00340019
*          PARAMETER LIST                                               00360019
*          CURRENT ENTRY IN WHERE TO GO TABLE                           00380019
*          CURRENT PARAMETER (DCB)                                      00400019
*                                                                       00420019
*OUTPUT-   AS OUTLINED BELOW :                                          00440019
*                                                                       00460019
*MACROS-ACTION:MODESET, DEBCHK, DMABCOND, XCTL, XCTLTABL         Y02072 00470002
*                                                                       00472002
*EXITS-ERROR: XCTL TO PROBLEM DETERMINATION FOR WTP AND 013 ABEND       00480021
*        BASIC DEB LAYOUT FOR ALL I/O DEVICES SUPPORTED                 00500019
*                                                                       00520019
*        **********************************                             00540019
*   -16  *I/OS* I/O SUPPORT DCB ADDRESS   *                             00560019
*   -12  *    * RESERVED                  *                             00580019
*   -08  *    * DCB MODIF MASK            *                             00600019
*   -04  *DEBL* AM TYPE * DEBTBLOF        *                             00620000
*   +00  *SUBL* TCB ADDRESS               *                             00640019
*   +04  *AML * DEB LINK FIELD            *                             00660019
*   +08  *DPAT* IRB ADDRESS               *                             00680019
*   +12  *FLTP* SYSTEM PUTGE CHAIN        *                             00700019
*   +16  *NEXT* USER PURGE CHAIN          *                             00720019
*   +20  *PRTY* ECB ADDRESS               *                             00740019
*   +24  *KEYD* DCB ADDRESS               *                             00760019
*   +28  *SCAL* APPENDAGE ADDRESS         *                             00780019
*        **********************************                             00800019
*                                                                       00820019
*                                                                       00840019
*        DEVICE DEPENDENT SECTION OF DEB                                00860019
*                                                                       00880019
* TAPE/URE                                                              00900019
*                                                                       00920019
*                                                                       00940019
*        **********************************                             00960019
*   +32  *DMOD*  UCB ADDRESS              *                             00980019
*   +36  *VOL SEQ NO     *NO. OF VOLS.    *                             01000019
*        **********************************                             01020019
*                                                                       01040019
* REMAINDER OF THE DEB IS BUILT IN IGG0191N.                            01050019
*                                                                       01060019
* D.A.SAM DEB.                                                          01080019
*        **********************************                             01100019
*   +32  *FMSK*  UCB ADDRESS              *                             01120019
*   +36  *EXTENT FIELD BBCCHHCCHH         *                             01140019
*   +40  *                                *                             01160019
*   +44  *               *NO.TRACKS ALL.  *                             01180019
*   +48  *VOL SEQ NO     *NO. OF VOLS     *                             01200019
*        **********************************                             01220019
*                                                                       01240019
*                                                                       01260019
* NOTE.+32 - +44 IS REPEATED PER EXTENT                                 01280019
*                                                                       01300019
*                                                                       01320019
* D.A.TO MEMBER FOR OUTPUT                                              01340019
*        **********************************                             01360019
*   +E2  *MEMBER NAME THAT IS OPENING     *                             01380019
*   +56  *MEMBER NAME THAT IS OPENING     *                             01400019
*        **********************************                             01420019
*                                                                       01440019
*                                                                       01460019
* DA BPAM CONCATENATION (INPUT)                                         01480019
*        **********************************                             01500019
*   +48  *DSNO DSNO  DSNO DSNO            *                             01520019
*        *EXTU EXT2  EXT3 EXT4            *                             01540019
*        **********************************                             01560019
*                                                                       01580019
*                                                                       01600019
*NOTE. BPAM DEB SAME AS SAM DEB WITH EXCLUSSION OF FIELD AT +48         01620019
*                                                                       01640019
*        USER LABEL EXTENT IS NOT INCLUDED IN F1 EXTENT COUNT,          01646019
*        AND IS NOT INCLUDED IN DEB EXTENTS.                            01652019
*                                                                       01660019
*        ROUTINE ALSO MERGES CLASS BYTE AND DEVICE BYTE OF UCB/SRT      01680019
*        INTO DCB FIELD (DEVT)                                          01700019
*                                                                       01720019
*EXITS  - NORMAL                                                   UT18 01724019
*       1 IF DEVICE TYPE = DA  XCTL'S TO IGG0191N                  UT18 01728019
*       2 IF DCB IS EXCP AND:                                  @Z40MSRZ 01730004
*            - DEVICE IS A 3800 PRINTER        IGG0196Q        @Z40MSRZ 01730404
*            - DEVICE IS A UCS/FCB PRINTER     IGG0191T        @Z40MSRZ 01730804
*            - DEVICE IS OTHER UR OR TAPE      IGG01911        @Z40MSRZ 01731204
*       3 IF DEVICE TYPE NOT = DA AND USER TOTALING FACILITY NOT   UT18 01732004
*              SPECIFIED (OPTCD NOT EQUAL TO X'02') XCTL'S TO      UT18 01736019
*              IGG0191B                                            UT18 01740019
*       4 IF DEVICE TYPE NOT = DA AND USER TOT. F.  IS SPECIFIED   UT18 01744004
*              XCTL'S TO IGG0191Y                                  UT18 01748019
*                                                                  UT18 01752019
OABD074  EQU   74                                                S21042 01762021
OABD213  EQU   419                                             @ZA01371 01772002
*                                                                       01780019
*TABLES/WORKAREA - SEE DSECTS AT END OF LISTING.                        01800019
*                                                                       01820019
*ATTRIBUTES- RE-ENTRANT- RE-USABLE- RUNS IN DATA MANAGEMENT KEY  Y02072 01840002
*            UNLESS OTHERWISE SPECIFIED, SUPER MODE              Y02072 01850002
*                                                                       01860019
*                                                                       01880019
*                                                                       01900019
*                                                                       01920019
*******************************************************************     01940019
*********************************************************************   01960019
*                                                                       01980019
* MASK'S TO TEST PARAMETER LIST WITH                                    02000019
DESZEM1    EQU   143                                                    02020019
DESZE    EQU   144                                                      02040019
OFFSET   EQU   4                                                        02060019
AB013    EQU   X'013'                   ABEND CODE               M3591  02070019
OPIECAPP EQU   20                                                       02080019
OPMDEBID EQU   X'0F'                                                    02100019
OPPATRUB EQU   0                                                        02120019
OPMEXSCL EQU   4                                                        02140019
OPMINPUT EQU   X'7F'                                                    02160019
OPMDEVT  EQU   X'40'                                                    02180019
DEBBSLNG EQU   80                                                       02200019
COMMUTAB EQU   16                                                       02220019
UCBDTYPE EQU   5                                                        02240019
SRTOUCBA EQU   0                                                        02260019
NEXTCORE EQU   140                                                      02280019
DUALDEN  EQU   X'20'                                                    02300019
READB    EQU   X'20'                                                    02320019
WRITEB   EQU   X'20'                                                    02340019
SUBRNTID EQU   20                       SUBROUTINE ID LENGHT.           02350019
TOTFLAG  EQU   X'02'                    USER TOTALING FLAG         UT18 02350819
ZERO     EQU   0                        PARAMETRIC ZERO            UT18 02351619
FOUR     EQU   4                        PARAMETRIC 4               UT18 02352419
CON8     EQU   8                        PARAMETRIC 8               UT18 02353219
INFLAG   EQU   X'0E'                    FLAG FOR INPUT TEST        UT18 02354019
ULEXTYP  EQU   X'40'  EXTENT TYPE INDICATOR FOR USER LABEL TRACK   UL17 02355019
D1275    EQU   X'1F'                    UCBDEVT CODE FOR 1275    S19033 02356019
D1419    EQU   X'1D'                    UCBDEVT CODE FOR 1419    S19033 02357019
D1419SCU EQU   X'1E'                    UCBDEVT FOR 1419 SCU   @ZA01371 02357102
PRT3211  EQU   X'09'                   DEVICE TYPE FOR 3211      S20202 02357320
*                                       PRINTER                  S20202 02357620
TIOTTERM EQU   X'20'                    DEVICE IS TERMINAL (TSO) S20016 02358020
EXCP     EQU   X'80'                    DCBMACRF EXCP MASK              02358400
DSORGPS  EQU   X'40'                    DCBDSORG PS MASK                02358800
PRT2245  EQU   X'0B'                    MASK FOR 2245 PRINTER    S21092 02359021
TSOAMLNG EQU   X'10'                    TSO HAS ACCESS METHOD   ZA00631 02359402
*                                       LENGTH OF X'10'         ZA00631 02359802
TSONMEXT EQU   X'01'                    TSO HAS ONE EXTENT      ZA00631 02359902
*                                                                       02360019
******************************           ****************************** 02380019
*                                                                       02400019
D3525    EQU   X'0C'                   3525 UCB UNIT TYPE CODE   S21088 02403021
RP       EQU   X'60'                   READ/PUNCH MASK           S21088 02406021
RW       EQU   X'50'                   READ/PRINT MASK           S21088 02409021
PW       EQU   X'30'                   PUNCH/PRINT MASK          S21088 02412021
FUNCOFF  EQU   3                       DCBFUNC OFFSET            S21088 02415021
DEB6250  EQU   X'D3'                    6250 BPI SET MODE         99223 02417002
TST6250  EQU   X'D0'                    MASK FOR 6250 BPI         99223 02419002
DEB1600  EQU   X'C3'                    1600 BPI SET MODE         99223 02419402
EXCPDCB  EQU   X'80'                    EXCP BIT IN DCBMACRF    ZA00742 02419802
FOUNDSEG EQU   X'40'                    FOUNDATION BIT          ZA00742 02419902
TRTCHTST EQU   X'38'                    TAPE RECORDING TECH     ZA00742 02426602
*                                                                       02433302
*                                                                       02440019
*                                                                       02460019
*                                                                       02480019
*REGISTERS ARE REFERENCED SYMBOLICALLY WHERE APPROPRIATE                02500019
*                                                                       02520019
RDCB     EQU   2         DCB REGISTER                                   02540019
RBASE    EQU   3         BASE REGISTER                                  02560019
RCORE    EQU   4         WORK AREA ADDRESS                              02580019
RPAR     EQU   5         TOP OF PARAMETER LIST                          02600019
RWTG     EQU   6         TOP OF WTG TABLE                               02620019
RPARC    EQU   7         CURRENT PARAMETER                              02640019
RWTGC    EQU   8         CURRENT TRANS LOAD                             02660019
RTIOT    EQU   9         USED HERE AS WRK REG AND  COMM VECTOR ADDR.    02680019
RUCB     EQU   10        USED HERE AS A COUNTER IN IOB GENERATION       02700019
RDEB     EQU   11        DEB ADDRESS                                    02720019
RB       EQU   12        WORK REG1  **                                  02740019
R1       EQU   RB                       PARM REGISTER            Y02072 02750002
RC       EQU   13        WORK REG2  **  USED IN IOB GENERATION          02760019
RD       EQU   14        WORK REG3  **                                  02780019
RJ       EQU   15        WORK REG4                                      02800019
RE       EQU   0         WORK REG5                                      02820019
RF       EQU   1         WORK REG6                                      02840019
RWK1     EQU   RF                       WORK REGISTER            Y02072 02842002
CVTREG   EQU   9                   ADDR OF CVT                   M4879  02850019
*                                                                       02860019
*                                                                       02880019
*                                                                       02900019
*********************************************************************** 02920019
*                                                                       02940019
*                                                                       02960019
*                                                                       02980019
*                                                                       03000019
*                                                                       03040019
*31440554-0560                                                     5798 03050019
*41260808,0808                                                     6831 03060019
         BALR  RBASE,0                                                  03080019
         USING PO,RBASE                                                 03100019
         USING IHADCB,RDCB                                              03120019
         USING FORCORE,RCORE                                            03140019
         USING DEB,RDEB                                                 03160019
         USING   TCB,RD                                                 03180019
         USING TIOT,RTIOT                                               03200019
         USING UCBOB,RUCB                                               03220019
*                                                                       03240019
*                                                                       03260019
*                                                                       03280019
*                                                                       03300019
PO       EQU   *                                                        03320019
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 03330002
         DC    C'IGG0196A'              MODULE NAME              YM4640 03332002
         DC    C'@Z40MSRZ'              LAST SHIP CODE         @Z40MSRZ 03334004
         DC    C'09/15/75'              LAST SHIP DATE         @Z40MSRZ 03336004
BEGIN    DS    0H                       END OF MODULE ID         YM4640 03338002
*                                                                       03340019
         L     RDCB,0(RPARC)            GET DCB ADDRESS                 03360019
         L     RCORE,4(RWTGC)           GET WORK AREA                   03380019
         L     RD,COMMUTAB         CALCULATE TCB ADDRESS                03500019
         L     RD,0(0,RD)                                               03520019
         L     RD,4(0,RD)               TCB  ADDR                       03540019
         L     RTIOT,TCBTIO                                             03560019
         AH    RTIOT,DCBTIOT       RESET TIOT POINTER                   03580019
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 03580620
         BO    MAINUNIT                 BRANCH IF YES            S21042 03581321
         L     RUCB,DXUCBADR            GET UCB PTR.             Y02072 03582002
MAINUNIT EQU   *                                                 S21042 03604021
         USING UCBOB,RUCB                                               03607019
         L     RDEB,DCBDEBAD            POINT TO DEB BASIC SECTION      04307019
         LA    RDEB,0(RDEB)            ZERO HIGH ORDER BYTE      A33605 04707020
         LM    RE,RF,DXCCW11            RESTORE LENGTH,ADDRESS    -UT18 05136019
OBPAM160 EQU   *                                                        05500019
*                                                                       05520019
         L     RJ,COMMUTAB                                              05620019
         L     RJ,OPIECAPP(0,RJ)        IOS APP ADDR                    05640019
         MVC   0(20,RF),0(RJ)           FILL IN IOS APP                 05660019
         MVC   DEBPROTG(1),DXUKEY       PROTECTION TAG           Y02072 05680002
         OI    DEBDEBID,X'0F'           ID                              05700019
         MVC   DEBPRIOR(1),TCBDSP       PRIORITY                        05720019
         MVC   DEBOPATB(1),0(RPARC)     OPEN ATTB                       05740019
         NI    DEBOPATB,X'7F'           CLEAR HI ORDER BIT              05760019
         MVI   DEBEXSCL,X'04'           SCALE FACTOR                    05780019
*                                                                       05820019
         L     RWK1,TCBDEB              GET FIRST DEB ON CHAIN   Y02072 05870002
         MODESET  EXTKEY=SUPR           GET INTO SUPER KEY       Y02072 05880002
OBPAM165 EQU   *                                                 Y02072 05882002
         STCM  RWK1,B'0111',DEBDEBAB    UPDATE DEB CHAIN POINTER YM3943 05882502
         CS    RWK1,RDEB,TCBDEB         ATTEMPT TO LINK NEW DEB  Y02072 05882802
         BNE   OBPAM165                 BR TO TRY AGAIN IF UNSUC Y02072 05883202
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 05884802
         LA    RF,DBCKEXCP              AMTYPE FOR EXCP DEB      Y01021 05885002
         TM    DCBMACRF,EXCP            IS DCB EXCP              Y01021 05885102
         BO    DEBCHK                   BRANCH IF YES            Y01021 05885202
         LA    RF,DBCKSAM               AMTYPE FOR SAM           Y01021 05885302
         TM    DCBDSORG,DSORGPS         IS DCBDSORG PS           Y01021 05885600
         BO    DEBCHK                   BRANCH IF YES            Y01021 05885700
         LA    RF,DBCKBPAM              AMTYPE FOR BPAM DEB      Y01021 05885902
DEBCHK   DEBCHK (RDCB),TYPE=ADD,AM=(0(RF)) ADD DEB TO DEB TABLE  Y02072 05890502
         LR    RDEB,RF                  LOAD VERIFIED DEB ADDR   Y01021 05891602
         LM    RE,RF,DXCCW11            RELOAD  ADDRESS, LENGTH  Y01021 05892702
         TM    TIOELINK,TIOTTERM        IS THIS TSO?           @ZM00636 05893103
         BNO   NOTTSO                   IF NOT TSO, BRANCH AROUNZA00631 05894702
         MVI   DEBAMLNG,TSOAMLNG        PUT ACCESS METHOD LENGTHZA00631 05896702
*                                       OF X'10' INTO TSO DEB   ZA00631 05898702
         MVI   DEBNMEXT,TSONMEXT        PUT X'01' INTO NUMBER   ZA00631 05899102
*                                       OF EXTENT FIELD OF TSO  ZA00631 05899502
*                                       DEB                     ZA00631 05901802
         B     RP350015                 CONTINUE TSO PROCESSING ZA00631 05903802
NOTTSO   EQU   *                                                ZA00631 05905802
         TM    UCBTBYT3,UCB3DACC        OPENING FOR D A DEVICE          05913200
         BC    14,OBPAMTAP              NO BRANCH                       05920019
         MVC   23(5,RF),DXCCW7          CCHHR                           05940019
OBPAM170 EQU   *                                                        06740019
         LA    RF,SOP1N                 SOP1N REQ'D FOR ALL D.A. DEVICE 07540019
         B     COMSTOP                 GO TO COMMON PATH FOR TAPE/UR/DA 08340019
OBPAMTAP EQU   *                                                        09320019
*                                                                       09340019
         ST    RUCB,DEBUCBAD            UCB ADDR                        09360019
         MVI   DEBAMLNG,X'10'           16 BYTE ACCESS METH.     A25961 09370019
*                                       LENGTH                          09380019
         MVI   DEBNMEXT,1                                        A25961 09390019
         CLI   UCBTBYT4,D3525          IS THIS A 3525            S21088 09391021
         BNE   RP350015                BRANCH IF NOT A 3525      S21088 09392021
         TM    DCBMODE+FUNCOFF,RP      READ/PUNCH ASSOCIATED     S21088 09393021
*                                       DATA SET                 S21088 09394021
         BO    RP350010                BRANCH IF READ/PUNCH      S21088 09395021
         TM    DCBMODE+FUNCOFF,RW      REAR/PRINT ASSOCIATED     S21088 09396021
*                                       DATA SET                 S21088 09397021
         BO    RP350010                BRANCH IF READ/PRINT      S21088 09398021
         TM    DCBMODE+FUNCOFF,PW      PUNCH/PRINT ASSOCIATED    S21088 09399021
*                                       DATA SET                 S21088 09400021
         BNO   RP350015                BRANCH IF NOT PUNCH/PRINT S21088 09401021
RP350010 EQU   *                                                 S21088 09402021
         MVI   DEBEXSCL,4              MOVE 4 INTO EXTENT SCALE  S21088 09403021
*                                       FIELD                    S21088 09404021
         B     RP350020                                          S21088 09405021
RP350015 EQU   *                                                 S21088 09406021
         MVI   DEBEXSCL,2                                               09420019
*                                                                       09422002
*                                                                       09431002
RP350020 EQU   *                                                 S21088 09435602
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 09441702
         BO    DEBFINI                  BRANCH IF YES            S20016 09447802
         MVI   DEBDVMOD,3                                               09453902
         TM    DCBMACRF,EXCPDCB         THIS AN EXCP DCB        ZA00742 09455902
         BZ    TAPE0010                 BR - NORMAL DCB         ZA00742 09457902
         TM    DCBMACRF,FOUNDSEG        FOUNDATION PRESENT      ZA00742 09459902
         BO    TAPE0010                 BR-DEVICE SEG ALSO      ZA00742 09466602
*                                       PRESENT                 ZA00742 09468602
         OC    DEBDVMOD(1),JFCTRTCH     USE JFCB FOR TRTCH      ZA00742 09470602
         OC    DEBDVMOD(1),JFCDEN       USE JFCB FOR DENSITY    ZA00742 09472602
         TM    JFCTRTCH,TRTCHTST        TRTCH SPECIFIED IN JFCB ZA00742 09473002
         BNZ   TAPE0030                 BR-SPECIFIED            ZA00742 09473102
         B     TAPE0020                 TRTCH NOT SPECIFIED     ZA00742 09473202
TAPE0010 EQU   *                        *                       ZA00742 09479902
         OC    DEBDVMOD(1),DCBTRTCH     TAPE RECORDING TECH             09486602
         OC    DEBDVMOD(1),DCBDEN       DENSITY                         09493302
         TM    DCBTRTCH,X'38'          HAS TRTCH BEEN SPECIFIED   99223 09500002
         BNZ   TAPE0030                 YES BRANCH                      09520002
*                                                                       09540019
TAPE0020 EQU   *                        *                       ZA00742 09550002
         OI    DEBDVMOD,X'30'                                           09560019
*                                                                       09580019
*      ASSUME TRANSLATE BYTE CONVERT OFF ODD DPARITY LOW DENSITY        09600019
*                                                                       09620019
TAPE0030 EQU   *                        *                       ZA00742 09630002
         SR    RE,RE                                              MC0W  09662019
         SR    RF,RF                                              MC0W  09664019
         IC    RF,JFCBVLCT              GET VOLUME COUNT          MC0W  09666019
         IC    RE,JFCBNVOL             GET NUMBER OF VOLUMES      MC0W  09668019
         CR    RE,RF                                              MC0W  09670019
         STH   RE,DEBTVLNM              IS NO. OF VOLUMES GREATER MC0W  09672019
         BH    OBPAM172                 YES USE NO. OF VOLUMES    MC0W  09674019
         STH   RF,DEBTVLNM              NO USE VOLUME COUNT       MC0W  09676019
OBPAM172 EQU   *                                                  MC0W  09678019
         MVC   DEBTVLSQ,DXVOLSEQ        VOL SEQ TO DEB           YM7814 09678402
*********************************************************************** 09880019
*      DUAL DENSITY SUPPORT HERE                                        09900019
*********************************************************************** 09920019
         TM    UCBTBYT1,X'04'           IS THIS PHASE-ENCODE UNIT 15451 09926019
         BO    PENCODE                  YES,BR TO ASSUME 1600 BPI 15451 09932019
         TM    UCBTBYT2,DUALDEN         DUAL DENSITY UNIT               09940019
         BO    PENCODE                  YES,SET UP 1600 OR 800 BPI99223 09960002
         TM    UCBTBYT1,UCB1FEA6        IS THIS 6250 BPI UNIT     99223 09972002
         BO    HICODE                   YES,ASSUME 6250 BPI       99223 09974002
         TM    UCBTBYT2,UCB2OPT3        6250/1600 BPI FEATURE     99223 09976002
         BZ    DEBFINI                  NO,DENSITY SET            99223 09978002
         SPACE                                                          09978402
HICODE   EQU   *                        6250/1600 BPI LOGIC       99223 09978802
         MVI   DEBDVMOD,DEB6250         SET 6250 BPI              99223 09979202
         TM    DCBMACRF,EXCPDCB         THIS AN EXCP DCB        ZA00742 09979302
         BZ    TAPE0040                 BR - NORMAL DCB         ZA00742 09979402
         TM    DCBMACRF,FOUNDSEG        FOUNDATION PRESENT      ZA00742 09979502
         BO    TAPE0040                 BR-DEVICE SEG ALSO      ZA00742 09982002
         TM    JFCDEN,TST6250           IS 6250 SPECIFIED       ZA00742 09984002
         B     TAPE0050                 GO COMPLETE SETTING     ZA00742 09984402
TAPE0040 EQU   *                        *                       ZA00742 09984802
         TM    DCBDEN,TST6250           IS 6250 SPECIFIED         99223 09985002
TAPE0050 EQU   *                        *                       ZA00742 09987002
         BO    DEBFINI                  YES,CONTINUE PROCESSING   99223 09987502
         MVI   DEBDVMOD,DEB1600         SET 1600 BPI              99223 09990002
         B     DEBFINI                  CONTINUE PROCESSING       99223 09992502
*                                                                       09995002
PENCODE  EQU   *                                                  15451 09997502
         MVI   DEBDVMOD,X'C3'           ASSUME 1600 BPI DENSITY         10000019
         TM    DCBMACRF,EXCPDCB         THIS AN EXCP DCB        ZA00742 10010002
         BZ    TAPE0060                 BR - NORMAL DCB         ZA00742 10012002
         TM    DCBMACRF,FOUNDSEG        FOUNDATION PRESENT      ZA00742 10014002
         BO    TAPE0060                 BR-DEVICE SEG ALSO      ZA00742 10016002
         TM    JFCDEN,X'C0'             IS 1600 SPECIFIED       ZA00742 10018002
         B     TAPE0070                 GO COMPLETE SETTING     ZA00742 10018402
TAPE0060 EQU   *                        *                       ZA00742 10018802
         TM    DCBDEN,X'C0'             IS IT 1600 BPI                  10020019
TAPE0070 EQU   *                        *                       ZA00742 10030002
         BC    9,DEBFINI                YES BRANCH                      10040019
*                                                                       10060019
         MVI   DEBDVMOD,X'CB'           800 BPI DENSITY INDICATED       10080019
DEBFINI  EQU   *                                                        10100019
*                                                                       10120019
         LA    RF,SOP1B                                                 10126019
COMSTOP  EQU   *                                                        10132019
*                                                                       10140019
         L     RDCB,0(RPARC)            RESTORE DCB ADDRESS             10160019
         TM    TIOELINK,TIOTTERM        IS THIS TSO?             S20016 10160120
         BO    FINISH                   BRANCH IF YES            S20016 10160220
*                                                                       10160519
         CLI   UCBTBYT4,D1275           IS THIS A 1275           S19033 10161019
         BE    MICR                     YES,BRANCH               S19033 10161519
         LA    RE,OABD213               SET INT ABEND CODE     @ZA01371 10161902
         CLI   UCBTBYT4,D1419SCU        IS IT 1419 SEC UNIT    @ZA01371 10162902
         BE    BADUNIT                  YES ISSUE ABEND        @ZA01371 10164902
         CLI   UCBTBYT4,D1419           IS THIS A 1419          XL03123 10165002
         BNE   TSTEXCP                  NO, BRANCH               S19033 10166002
MICR     EQU   *                                               @ZA06110 10167003
*                                                              @ZA06110 10167803
*        PERFORM A UCB LOOK-UP PROCEDURE TO OBTAIN THE ADDRESS @ZA06110 10168603
*                                                              @ZA06110 10169403
         LA    RE,OABD074               SET CODE FOR NO UCB    @ZA06110 10170203
         L     CVTREG,CVTPTR            LOAD CVT ADDRESS       @ZA06110 10171003
         USING CVT,CVTREG                                      @ZA06110 10171803
         LH    RC,UCBCHAN               GET CHAN AND DEVICE ADD@ZA06110 10172603
         N     RC,ADDRMASK              CLEAR FLAGS            @ZA06110 10173403
         LA    RC,1(RC)                 INCR TO SCU ADDR       @ZA06110 10174203
         L     RJ,CVTILK2               LOAD ADDR OF UCB LIST  @ZA06110 10175003
LOOP     EQU   *                                               @ZA06110 10175803
         LH    RD,0(RJ)                 GET PRT FROM LIST      @ZA06110 10176603
         LTR   RD,RD                    END OF LIST            @ZA06110 10177403
         BZ    ZPTR                     TABLE MAY HAVE HOLES   @ZA06110 10178203
         CH    RD,UCBEND                END OF TABLE           @ZA06110 10179003
         BE    NOUCB                    YES - NO UCB FOR SCU   @ZA06110 10179803
         DROP  RUCB                                            @ZA06110 10180603
         USING UCBOB,RD                                        @ZA06110 10181403
         N     RD,UCBMASK               CLEAR HIGH ORDER       @ZA06110 10182203
         LH    RB,UCBCHAN               GET CHAN AND DEV ADDR  @ZA06110 10183003
         N     RB,ADDRMASK              CLEAR FLAGS            @ZA06110 10183803
         CR    RC,RB                    IT THIS UCB FOR SCU?   @ZA06110 10184603
         BE    UCBFND                   YES, BR                @ZA06110 10185403
ZPTR     EQU   *                                               @ZA06110 10186203
         LA    RJ,2(RJ)                 UPDATE PTR INTO UCB    @ZA06110 10187003
*                                       TABLE                  @ZA06110 10187803
         B     LOOP                     BR,CK NEXT UCB IN LIST @ZA06110 10188603
UCBFND   EQU   *                                               @ZA06110 10189403
         ST    RD,DEBBINUM              PLACE A(SCU UCB IN DEB @ZA06110 10190203
         LA    RB,2                     LOAD NUMBER OF EXTENTS @ZA06110 10191003
         STC   RB,DEBNMEXT              PLACE NUM EXT OM DEB   @ZA06110 10191803
         STC   RB,DEBEXSCL              PLACE EXT SCALE IN DEB @ZA06110 10192603
         MODESET EXTKEY=ZERO            GET IN KEY ZERO        @ZA06110 10193403
         OI    UCBSTAT,UCBALOC          SET SCU ALLOCATED      @ZA06110 10194203
         MODESET EXTKEY=DATAMGT         BACK TO KEY 5          @ZA06110 10195003
         DROP  CVTREG,RD                                       @ZA06110 10195803
         USING UCBOB,RUCB                                               10197203
TSTEXCP  EQU   *                                                 S19033 10198002
*                                                                       10199002
*********************************************************************** 10200019
*                                                                       10220019
*      TEST FOR USER OF EXCP NOT BSAM OR QSAM                           10240019
*                                                                       10260019
*********************************************************************** 10280019
*                                                                       10300019
         TM    DCBMACRF,X'80'           EXCP BIT ON                     10320019
         BC    8,SAMOUT                 NO BRANCH                       10340019
         TM    UCBTBYT3,UCB3DACC        IS DEVICE D.A.                  10350019
         BO    FINISH                   YES, BRANCH.                    10360019
*                                                                       10360319
*********************************************************************** 10360619
*                                                                       10360919
*        TEST FOR PRINTER WITH EXCP DCB                        @Z40MSRZ 10361004
*             IF 3800              IGG0196Q                    @Z40MSRZ 10361104
*             IF UCS/FCB PRINTER   IGG0191T                    @Z40MSRZ 10362204
*                                                                       10364804
*********************************************************************** 10365904
*                                                                       10367004
         CLI   UCBTBYT3,X'08'           TEST IF DEVICE CLASS       DM0B 10368104
*                                       IS U/R                          10369204
         BC    7,EXCPOUT                IF NOT, GO TO LAST EXEC    DM0B 10370304
*                                       SELECTION                       10371404
         CLI   UCBTBYT4,UCB3800         TEST FOR 3800          @Z40MSRZ 10371804
         BE    XCTLGO6Q                 YES, SET FOR 196Q      @Z40MSRZ 10372204
*                                                                       10372304
         CLI   UCBTBYT4,PRT3211         TEST FOR 3211 PRINTER    S20202 10372504
         BE    XCTLGO1T                 YES GO TO PRT MOD        S20202 10373604
*                                                                       10374704
         CLI   UCBTBYT4,PRT2245        TEST FOR 2245             S21092 10375804
         BE    XCTLGO1T                YES, GO TO IGGO191T       S21092 10376904
         CLI   UCBTBYT4,X'08'           TEST IF DEVICE IS 1403     DM0B 10378004
         BC    7,EXCPOUT                IF NOT, GO TO LAST EXEC    DM0B 10379104
*                                       SELECTION                       10380204
*                                                                       10381304
         TM    UCBTBYT2,X'80'           IF 1403 HAS UCS            DM0B 10382404
         BC    14,EXCPOUT               IF NOT, GO TO LAST EXEC    DM0B 10383504
*                                       SELECTION                       10384604
XCTLGO1T EQU   *                                                 S20202 10385704
*                                                                       10386804
*                                                                       10387904
         LA    RF,SOP1T                 IF 1403 WITH UCS, XCTL     DM0B 10389004
*                                       IGG0191T                        10390104
         BC    15,FINISH                GO TO WTG ROUTINE          DM0B 10391204
*                                                                       10392304
XCTLGO6Q EQU   *                        SET FOR IGGO196Q       @Z40MSRZ 10392704
         LA    RF,SOP6Q                   FOR 3800 PRINTER     @Z40MSRZ 10393104
         B     FINISH                   GO TO WTG ROUTINE      @Z40MSRZ 10393204
*                                                                       10393304
*********************************************************************** 10393404
*                                                                       10394504
EXCPOUT  EQU   *                                                   DM0B 10395604
*                                                                       10396704
         LA    RF,SOP11                 EXCP AND NOT D.A., GO    Y02072 10397804
*                                         DO DCB COPY BACK       Y02072 10398904
*                                                                       10400019
SAMOUT   EQU   *                                                        10420019
*                                                                       10440019
*******************************************************************UT18 10450019
*  NOTE - THE FOLLOWING FEW INSTRUCTIONS SETUP FOR AN XCTL TO A NEWUT18 10460019
*        (WITH RELEASE 18 ) MODULE WHICH WILL LOAD THE USER TOTALINUT18 10470019
*        FACILITY SAVE ROUTINE AND DO A GETMAIN FOR A UTF SAVE AREAUT18 10480019
*        FROM THE USER'S SUBPOOL 0 FOR THE SAVING OF HIS TOTALING  UT18 10490019
*        AREA AT END-OF-VOLUME TIME.                               UT18 10500019
*******************************************************************UT18 10510019
*                                                                  UT18 10520019
         TM    ZERO(RPARC),INFLAG       TEST FOR INPUT DATA SET    UT18 10530019
         BZ    SAMOUT1                  BR IF INPUT                UT18 10540019
         TM    DCBMACRF,X'80'           IS IT EXCP                M4116 10543019
         BO    SAMOUT1                  IF YES, BRANCH            M4116 10546019
         TM    DCBOPTCD,TOTFLAG         TEST FOR UTF (OPTCD=T)     UT18 10550019
         BZ    SAMOUT1                  BIF NOT SPECIFIED          UT18 10560019
         TM    UCBTBYT3,UCB3DACC        CHECK IF DA                UT18 10570019
         BO    SAMOUT1                  BR IF DA                   UT18 10580019
*                                                                  UT18 10590019
         LA    RF,SOP1Y                 SETUP FOR XCTL TO IGG0191Y UT18 10600019
*                                                                  UT18 10610019
SAMOUT1  EQU   *                        SYMBOLIC ADDR              UT18 10620019
*                                                                       10640019
FINISH   EQU   *                                                        10880019
*                                                                       10900019
         USING WTGENTRY,RWTGC                                    Y02072 10902002
         MVC   WTGIDTTR,0(RF)           ST NEXT MODS ID        @Z30TSCF 10912003
RELOOP   LA    RWTGC,WGOFF(0,RWTGC)     UPDATE WHERE TO GO ENTRY        10952003
         LA    RPARC,PLOFF(0,RPARC)     UPDATE PARA LIST ENTRY          11002003
         CLC   0(2,RWTGC),AMIDCNST      THIS RT NEEDED AGAIN            11052003
         BCR   8,RBASE                  YES BR BACK TO BEGINNING        11062003
         CLC   0(2,RWTGC),OPIDCNST      END OF TABLE                    11080019
         BC    7,RELOOP                 NO BRANCH                       11100019
*                                                                       11120019
         LR    RPARC,RPAR                                               11140019
         LA    RWTGC,WAOFF(0,RWTG)      RE INIT  WTG LIST               11160019
ZCHEK    CLI   0(RWTGC),X'00'          IS THIS ENTRY COMPLETE           11180019
         BC    7,TCTLRTN                NO XCTL                         11200019
*                                                                       11220019
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY                  11240019
         LA    RPARC,PLOFF(0,RPARC)                                     11260019
         BC    15,ZCHEK                                                 11280019
*                                                                       11300019
TCTLRTN  EQU   *                                                        11320019
         USING WTG,RWTG                                                 11370003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*11420003
               MODID=WTGENTRY                                  @Z30TSCF 11430003
         DROP  RWTGC,RWTG                                      @Z30TSCF 11440003
*                                                                       11442019
*        AN 013 ABEND IS ISSUED WHEN NO SEC CONTROL UNIT (SCU)          11444019
*        UCB IS FOUND FOR 1419 OR IF TRYING TO OPEN THE SCU ONLY.       11446002
BADUNIT  EQU   *                                                        11446402
NOUCB    EQU   *                                                 M3591  11448019
         DMABCOND (RE),PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES   @ZA01371X11450002
                                        CALL PROBLEM DETERMINATION      11452021
         B     TCTLRTN                                           S21042 11454021
*                                                                       11458002
*                                                                       11460019
WAOFF    EQU   32                  OFFSET OF FIRST ENTRY IN WTG TABLE   11480019
PLOFF    EQU   4                   OFFSET OF DCB ENTRIES                11500019
WGOFF    EQU   8                   OFFSET OF WTG ENTRIES                11520019
DBCKEXCP DEBCHK AM=EXCP,MF=L            DEB AMTYPE FOR EXCP      Y01021 11532000
DBCKSAM  DEBCHK AM=SAM,MF=L             DEB AMTYPE FOR SAM       Y01021 11534000
DBCKBPAM DEBCHK AM=BPAM,MF=L            DEB AMTYPE FOR BPAM      Y01021 11536000
UCBMASK  DS    0F                       ALIGN                   Z30AAWW 11536403
         DC    X'0000'                  FOR ZEROING HI-ORDER    Z30AAWW 11536503
UCBEND   DC    X'FFFF'                  END OF LOOKUP TABLE     Z30AAWW 11536803
ADDRMASK DC    X'0003FFFF'              TO REMOVE FLAG         @ZA06110 11537403
*                                                                       11538002
*  MODULE ID'S                                                          11538402
*                                                                       11538802
SOP11    DC    C'11',VL3(IGG01911)      LAST EXECUTOR          @Z30TSCF 11539203
SOP1Y    DC    C'1Y',VL3(IGG0191Y)      USET TOTALING          @Z30TSCF 11539603
SOP1B    DC    C'1B',VL3(IGG0191B)      OTHER THAN DA          @Z30TSCF 11539703
SOP1N    DC    C'1N',VL3(IGG0191N)      DA TO FINISH DEB       @Z30TSCF 11539803
SOP1T    DC    C'1T',VL3(IGG0191T)      UCS/FCB EXECUTOR       @Z30TSCF 11539903
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROB DETERMINATION     @Z30TSCF 11543203
SOP6Q    DC    C'6Q',VL3(IGG0196Q)      3800 EXECUTOR          @Z40MSRZ 11545204
OPIDCNST DC    C'0S'                                                    11546702
AMIDCNST DC    C'6A'                                                    11550019
         SPACE                                                          11600002
PATCH    DC    25H'0'                   PATCH AREA               YM4640 11610002
END      EQU   *                        END OF MODULE            Y02072 11700002
         EJECT                                                          11750002
*********************************************************************   11820019
SRT      DSECT                                                          11840019
         IEFUCBOB                                                       11860019
*                                                                       11880019
         EJECT                                                          11900019
           DCBD  DSORG=PS                                               11920019
CVT      DSECT                                                          11940019
         CVT                                                            11960019
*   TASK CONTROL BLOCK                                                  11980019
         CNOP  0,4                                                      12000019
TCB      DSECT                                                          12020019
TCBRBP   DS    F                       PO9NTER TO EXECUTING RB          12040019
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   12060019
TCBDEB   DS    F                       POINTER TO DEB QUEUE             12080019
TCBTIO   DS    F                       POINTER TO TIOT                  12100019
TCBCMP   DS    F                       TASK COMPLETION CODE             12120019
TCBTRN   DS    F                       TESTRAN FIELD                    12140019
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 12160019
TCBPKF   DS    CL1                     RESERVED FOR FUTURE USE          12180019
TCBFLGS  DS    FL5                     FLAG BYTES                       12200019
TCBLMP   DS    CL1                     RESERVED FOR FUTURE USE          12220019
TCBDSP   DS    CL1                     RESERVED FOR FUTURE USE          12240019
TCBLLS   DS    F                       POINTER TO LOAD LIST             12260019
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            12280019
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  12300019
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       12320019
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             12340019
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  12360019
TCBTCB   DS    F                       RESERVED FOR FUTURE USE          12380019
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         12400019
         DS    CL24                                                     12420019
TIOT     DSECT                                                          12440019
TIOELNGH DS    CL1                           LENGTH OF THIS ENTRY       12460019
TIOESTTA DS    CL1                           STATUS -A-                 12480019
TIOERLOC DS    CL2                           REL. LOC OF POOL           12500019
TIOEDDNM DS    2F                            DDNAME                     12520019
TIOEJFCB DS    1F                            JFCB DISK ADDR             12540019
TIOESTTB DS    0CL1                                                     12560019
TIOEFSRT DS    CL4                                                      12580019
         DS    CL1                                                      12600019
*        TIOT POOL ENTRY                                                12620019
TIOPNSLT DS    XL1                           NR.OF SLOTS FOR POOL       12640019
         DS    CL1                                                      12660019
TIOPNSRT DS    XL1                           NR.OF DEVICES (FILLED      12680019
*                                             SLOTS)                    12700019
TIOPPOOL DS    CL8                           POOL NAME                  12720019
TIOPSTTB DS    XL1                           STATUS OF SLOT             12740019
TIOPSLOT DS    XL3                           SRT ADDRESS OR EMPTY SLOT  12760019
TIOTFEND DS    1F                            FINAL END OF AN ENTRY      12780019
TIOELINK EQU   TIOERLOC+1                                        S20016 12790020
         SPACE 1                                                        12800019
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          12820019
DEB      DSECT                                                          12840019
DEBNMSUB DS    0CL1                                                     12860019
DEBTCBAD DS    CL4                                                      12880019
DEBDEBAD DS    0CL4                                                     12890002
DEBAMLNG DS    CL1                                                      12900002
DEBDEBAB DS    CL3                                                      12910002
DEBOFLGS DS    0CL1                                                     12940019
DEBIRBAD DS    CL4                                                      12960019
DEBOPATB DS    0CL1                                                     12980019
DEBSYSPG DS    CL4                                                      13000019
DEBNMEXT DS    0CL1                                                     13020019
DEBUSRPG DS    CL4                                                      13040019
DEBPRIOR DS    0CL1                                                     13060019
DEBECBAD DS    CL4                                                      13080019
DEBPROTG DS    0CL1                                                     13100019
DEBDEBID DS    0CL1                                                     13120019
DEBDCBAD DS    CL4                                                      13140019
DEBEXSCL DS    0CL1                                                     13160019
DEBAPPAD DS    CL4                                                      13180019
DEBDVMOD DS    0CL1                                                     13200019
DEBUCBAD DS    CL4                                                      13220019
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     13240019
DEBBINUM DS    CL2                                                      13260019
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   13280019
DEBSTRCC DS    CL2                                                      13300019
DEBSTRHH DS    CL2                                                      13320019
DEBENDCC DS    CL2                                                      13340019
DEBENDHH DS    CL2                                                      13360019
DEBNMTRK DS    CL2                                                      13380019
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          13400019
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              13420019
DEBVOLSQ DS    H                                                        13440019
DEBVOLNM DS    H                                                        13460019
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     13480019
DEBSUBID DS    H                                                        13500019
         TITLE 'IGG0196A - FORMAT OF GOTTEN CORE'                       13520002
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @Z30TSCF 13550003
         ORG   WTGIDTTR                                          Y02072 13560002
WTGID    DS    CL2                      NEXT MOD ID              Y02072 13570002
CCWOFSET EQU   DXCCW12-FORCORE     CCW RELOCATABLE OFF SET FOR DXCCW12  13580019
DCBOFSET EQU   DCBDEBAD-IHADCB     DEB RLCATBL OFFSET IN DCB            13600019
           END                                                          13620019
