         TITLE   'IGG0197F - FCB EXECUTOR, VERIFIES FCB '        M0099  00030021
IGG0197F CSECT                                                          00060021
*MODULE NAME - IGG0197F                                          Y02072 00070002
*                                                                       00072002
*DESCRIPTIVE NAME - VERIFY FCB                                   Y02072 00074002
*                                                                       00076002
*COPYRIGHT - NONE                                                Y02072 00078002
*                                                                       00078402
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00078802
*                                                                       00079202
*                 RELEASE 21 DELETIONS                                  00080021
*1060157200,110500,186300,460350,46084-481000,632800             M1803  00082021
*                                                                M0099  00090021
*1060463000                                                      S21092 00150021
*1060662200-662600                                               M0191  00160021
*                                                                       00160402
*                 VS1 RELEASE 2 DELETIONS                               00160802
*                                                                XM2963 00161202
*                                                                       00162002
*                 VS2 RELEASE 2 DELETIONS                               00164002
*000500,001800,029000,047000,093200-093600,176500,242600,        Y02072 00166002
*243500-244400,265400,278600,279800,280400,281000,282800,285200, Y02072 00168002
*291200,295400,296000,300200,303200,304400,309800,312800,319400, Y02072 00168402
*380000,381000,386000-388000,419000-421000,499000,526050-526800, Y02072 00168802
*542070-542840,579000,613000-626000,642000,644000,593000,597000  Y02072 00169202
*500000,612000                                                   Y02072 00169602
*                                                                YM2424 00169702
*                                                                YM4697 00169802
*                                                                YM5708 00169902
*                                                                YM5923 00173202
*                                                                       00175203
*                 VS2 RELEASE 3 DELETIONS                               00175603
*                                                              @Z30TSCF 00176003
*A245000,405610,405620,407410,407420                           @AZ07594 00176137
*C304560,405000,406200,406800,408000                           @AZ07594 00176237
*D315200-320600                                                @AZ07594 00176337
*C229000                                                       @ZA09661 00176437
*A277410                                                       @ZA10220 00176537
*C186400,441600,441960                                         @ZA12979 00177237
*A190010,190020,440601,440602                                  @ZA12979 00177937
*D441300,441400                                                @ZA12979 00178637
*C174500,174560,205000                                         @ZA25668 00178837
*A205100                                                       @ZA25668 00178937
*A281570,281590                                                @ZA25088 00179337
*C174500,174560,281580                                         @ZA25088 00179537
*C174500,174560                                                @ZA29359 00179737
*A190040-190160                                                @ZA29359 00179837
*STATUS CHANGE LEVEL 002                                                00180002
*                                                                       00190001
*FUNCTION/OPERATION - TO CONSTRUCT AND EXECUTE A CHANNEL PROGRAM WHICH  00200020
*                     LOADS THE FCB.                                    00300020
*                   - PRINT OUT FCB IMAGE FOR VISUAL VERIFICATION AND   00400020
*                     ISSUE MESSAGE IEC128D VERIFY FORMS ALIGNMENT:AND  00500020
*                     ANALIZE OPERATOR REPLY WHEN REQUIRED              00600020
*                   - ISSUE IEC128 MESSAGE WITH OUT VERIFYING FCB IMAGE 00700020
*                     WHEN REQUIRED                                     00800020
*                   - DELETE ANY FCB IMAGE LOADED                       00850002
*                   - CLOSE SYS1.IMAGELIB                               00860002
*                   - RESET AUDIT TRAIL BITS INDICATING FCB      YM4697 00870002
*                     IMAGE LOADED AND SYS1.IMAGELIB OPENED      YM4697 00880002
*                   - UPDATE UCB WITH CURRENT FCB ID AND OPTIONS        00900020
*                   - XCTL TO NEXT OPEN EXECUTOR                        01000020
*                                                                       01100020
*ENTRY POINTS - ENTERED FROM IGG0197E                                   01200002
*                                                                       01400020
*INPUTS - DCB ADDRESS                                                   01500020
*       - OPEN WORK AREA ADDRESS                                        01600020
*       - WHERE TO GO TABLE                                             01700020
*       - PARAMETER LIST                                                01800020
*       - CURRENT ENTRY IN WTG TABLE                                    01900020
*       - CURRENT PARAMETER (DCB)                                       02000020
*       - ADDRESS OF FCB IMAGE RETRIVED IN IGG0197E                     02130020
*       - ADDRESS OF SYS1.IMGLIB DCB IN OPEN WORKAREA(DXCCW8)           02160002
*                                                                       02200020
*OUTPUTS - FCB BUFFER LOAD                                              02300020
*        - PRINT OUT OF FCB IMAGE FOR VISUAL VERIFICATION               02400020
*        - MESSAGE TO OPERATOR TO VERIFY FORMS ALIGNMENT                02500002
*           'IEC128D V XXX,VERIFY FORMS ALIGNMENT'                      02600020
*        - UPDATED UCB WITH NEW FCB ID                                  02700020
*                                                                       02800020
*EXTERNAL REFERENCES - MESSAGE CSECT                             Y02072 02900002
*                                                                       03000020
*EXITS - NORMAL - XCTL TO ONE OF THE FOLLOWING OPEN EXECUTORS           03100020
*                 - IGG01911 IF DCB IS FOR EXCP                  Y02072 03150002
*                 - IGG0191I IF BUFFER CNTRL BLOCK IS SPECIFIED         03200020
*                 - IGG0191G IF NORMAL SCHEDULING IS SPECIFIED          03300020
*                 - IGG0191Q IF CHAINED SCHEDULING IS SPECIFIED         03400020
*                                                                       03500020
*EXITS - ERROR - ISSUE DMABCOND MACRO FOR ONE OF THE FOLLOWING   Y02072 03650002
*              - PERMANENT I/O ERROR OCCURED DURING FCB LOAD.           03700002
*              - OPERATOR CANCELED BECAUSE OF AN INCORRECT FCB IMAGE    03900002
*                OR UNABLE TO ALIGN FORMS.                              04000002
*              - IGG0197E SET ABEND FLAG FOR THIS EXECUTOR              04050002
*                                                                       04300020
*TABLES/WORK ARES - WHERE-TO-GO TABLE (SEE LISTING EXECUTOR IGG0191B)   04400020
*                 - OPEN WORK AREAS (IECDSECT)                          04500020
*                                                                       04600020
*ATTRIBUTES - REENTRANT, REUSABLE, RUNS IN DATA MANAGEMENT KEY   Y02072 04700002
*             UNLESS OTHERWISE SPECIFIED, SUPER STATE            Y02072 04750002
*                                                                       04760002
*MACROS-ACTION:MODESET, DMABCOND, EXCP, WAIT, DELETE, XCTL       Y02072 04770002
*                                                                       04790002
*MACROS-MAPPING:IGGMSG,IECDSECS(MAIN,WTG), DCBD, IEFUCBOB,IKJTCB Y02072 04792002
*               IHAFCAUD                                                04794002
*                                                                       04800020
*NOTES - EXCP/WAIT MACROS USED TO LOAD FCB                              04900020
*      - DELETE MACRO USED TO DELETE FCB IMAGE FROM CORE                05000020
*      - SVC 35 USED FOR WTOR (WRITE TO OPERATOR TO REQUEST REPLY)      05100020
*      - OPEN WORK AREA USED FOR IOB/ECB                                05200020
*      - LOWER CASE OPERATOR REPLYS ALLOWED                             05300020
*      - BEFORE ISSUING A WTO/WTOR, THE MESSAGE TEXT MUST FIRST  Y02072 05360002
*        BE EXTRACTED FROM A MESSAGE CSECT.                      Y02072 05370002
*                                                                       05400020
*********************************************************************** 05500020
*                                                                       05600020
*   REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN MODULES              05700020
*                                                                       05800020
*********************************************************************** 05900020
*                                                                       06000020
RE       EQU   0                        WORK/PARAMETER REGISTER         06100020
RWK1     EQU   RE                       WORK REGISTER            Y02072 06150002
RF       EQU   1                        WORK/PARAMETER REGISTER         06200020
RWK2     EQU   RF                       WORK REGISTER            Y02072 06250002
RDCB     EQU   2                        ADDRESS OF USER'S DCB           06300020
RBASE    EQU   3                        BASE REGISTER                   06400020
RCORE    EQU   4                        ADDRESS OF OPEN WORK AREA       06500020
RPAR     EQU   5                        PARAMETER LIST                  06600020
RBRNCH   EQU   RPAR                     BRANCHING REGISTER       Y02072 06650002
RWTG     EQU   6                        START OF WTG TABLE              06700020
RWK8     EQU   RWTG                     WORK REGISTER            Y02072 06750002
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 06800020
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      06900020
RTIOT    EQU   9                        TIOT ADDRESS/WORK REGISTER      07000020
RUCB     EQU   10                       UCB ADDRESS/WORK REGISTER       07100020
RDEB     EQU   11                       DEB ADDRESS                     07200020
RWK3     EQU   RDEB                     WORK REGISTER            Y02072 07250002
RB       EQU   12                       WORK REGISTER/BASE R FOR DSECT  07300020
RWK7     EQU   RB                       WORK REGISTER            Y02072 07350002
RC       EQU   13                       WORK REGISTER                   07400020
RD       EQU   14                       WORK/PARAMETER REGISTER         07500020
RJ       EQU   15                       WORK/PARAMETER REGISTER         07600020
RWK6     EQU   RJ                       WORK REGISTER            Y02072 07650002
*                                                                       07700020
*********************************************************************** 07800020
*                                                                       07900020
*   WTG OFFSET EQUATES                                                  08000020
*                                                                       08100020
*********************************************************************** 08200020
*                                                                       08300020
WGOFF    EQU   8                        OFFSET OF CURRENT WTG ENTRIES   08400020
PLOFF    EQU   4                        OFFSET OF CURRENT DCB ENTRIES   08500020
WAOFF    EQU   32                       OFFSET OF 1ST ENTRY IN WTG TAB  08600020
*                                                                       08700020
*********************************************************************** 08800020
*                                                                       08900020
*   GENERAL EQUATES                                                     09000020
*                                                                       09100020
*********************************************************************** 09200020
*                                                                       09300020
VERFYSWT EQU   X'01'                    ENTRY IS FOR VERIFY ONLY SWITCH 09400020
ABEND    EQU   X'FF'                   ABEND RETURN CODE SWITCH         09500020
ALIGNSWT EQU   X'04'                    ENTRY IS FOR ALIGN FORMS SWITCH 09600020
NRETRYS  EQU   X'01'                    NUMBER OF TIMES TRY TO LOAD FCB 09700020
FCBLDCC  EQU   X'63'                    COMMAND CODE=LOAD FCB           09800020
UNRLMASK EQU   X'02'                    IOB IS UNRELATED                09900020
BSTFCBIM EQU   X'02'                    BYTES TO START OF FCB IMAGE     10000020
FCBLTHOS EQU   X'01'                    FCB IMAGE LENGTH OFFSET         10100020
SUCCFLCC EQU   X'7F'                    SUCCESSFUL COMPLETION CODE      10200020
LNIEC124 EQU   X'30'                    LENGTH OF IEC124 MESSAGE        10300020
PERMIOER EQU   X'0C'                    RETURN CODE=PERMANENT I/O ERROR 10400020
ABENDBIT EQU   X'80'                    ABEND IN PROCESS MASK           10500020
ABCDB13  EQU   X'B13'                   COMPLETION CODE=B13 (OPEN-1403) 10600020
VERFYMSK EQU   X'40'                    FCB OPTION BITS = VERIFY        10700020
ALIGNMSK EQU   X'80'                    FCB OPTION BITS = ALIGN FORMS   10800020
SILICCMK EQU   X'60'                    MASK TO SET SILI + C.C.FLAGS    10900020
SKIPCH1  EQU   X'8B'                    COMMAND CODE=SKIP TO CHANNEL 1  11000020
STGETWO  EQU   X'C7'                    ENTRY FLAG                M1803 11050021
WTSKP2   EQU   X'11'                    COMMAND CODE=WRITE + SPACE 2    11100020
WTSKP1   EQU   X'09'                    COMMAND CODE=WRITE + SPACE 1    11200020
HDLENGTH EQU   X'34'                    HEADING LENGTH                  11300020
SILIMASK EQU   X'20'                    MASK TO SET SILI FLAG           11400020
LPIEQ8   EQU   X'10'                    8 LINES/INCH SPACEING           11500020
UBLKDCMK EQU   X'40'                    UNBLOCK DATA CHECK MASK         11600020
UNRLBMSK EQU   X'42'                    UNRELATED BIT MASK              11700020
PRTLNLTH EQU   X'84'                    LENGTH OF VERIFICATION LINE     11800020
NUMBMASK EQU   X'F0'                    MASK TO CONVERT TO NUMERIC      11900020
ENDMARK  EQU   X'10'                    END OF FCB IMAGE INDICATOR      12100020
BLDLLOAD EQU   X'D3'                    FLAG FOR FCB LOADED INTO CORE   12200020
DELENDMK EQU   X'0F'                    DELETE END MARKER MASK          12300020
UCBUCSOF EQU   X'00'                    UCS OFFSET IN UCB WORK AREA     12400020
UCSOPOFS EQU   X'04'                    UCS OPTIONS OFFSET              12500020
UCBFCBOF EQU   X'08'                    FCB OFFSET IN UCB WORK AREA     12600020
FCBOPTNS EQU   X'05'                    FCB OPTIONS OFFSET              12700020
CMDRTYMK EQU   X'80'                    COMMAND RETRY MASK              12800020
BUFPARMK EQU   X'04'                    BUFFER PARITY MASK              12900020
BUFPARER EQU   X'01'                    UCS OPTIONS BUFFER PARITY ER    13000020
SKPCH0CD EQU   X'83'                    SKIP TO CH 0 COMMAND CODE       13100020
EXCPMASK EQU   X'80'                    OPTCD = EXCP                    13200020
PCIMASK EQU    X'20'                    OPTCD=PCI                       13300020
BFCNTRL  EQU   X'01'                    BUFFER CONTRL BLOCK FLAG        13400020
LNTH1STL EQU   X'2D'                    LENGTH OF VERIFICATION HEADING  13450020
IOERROR  EQU   X'10'                    I/O ERROR DURING FCB VERFIFCATN 13500020
IMCLOSED EQU   X'FF'                    FLAG SET FOR IMAGELIB NOT OPEN  13550020
SIX      EQU   C'6'                                                     13600020
NULL     EQU   X'00'                                                    13700020
BLANK    EQU   X'40'                                                    13800020
ONEMASK  EQU   X'01'                                                    13900020
THREE    EQU   X'03'                                                    14000020
FOURMASK EQU   X'04'                                                    14100020
TWO      EQU   X'02'                                                    14200020
FIVE     EQU   X'05'                                                    14300020
K27      EQU   X'1B'                                                    14400020
K20      EQU   X'14'                    LENGTH PRT LINE                 14500020
K23      EQU   X'17'                    LENGTH LAST VERIF LINE          14600020
K1       EQU   1                                                        14660020
K41      EQU   X'28'                                                    14730020
SIXC     EQU   X'06'                                                    14800020
EIGHT    EQU   C'8'                                                     14900020
SEVENMSK EQU   X'07'                                                    15000020
EIGHTMSK EQU   X'08'                                                    15100020
NINEMASK EQU   X'09'                                                    15200020
TENMASK  EQU   X'0A'                    VERIFICATION FLAG               15300020
FOURTNMK EQU   X'14'                    CONSTANT OF X'14'               15400020
DISP159  EQU   X'9F'                    CONSTANT OF 159                 15500020
ENDI     EQU   X'C5'                                                    15560020
VFYLNTH2 EQU   X'13'                                                    15590020
K17      EQU   X'11'                    CHANNEL CODE DISPLACEMENT       15620020
*                                       IN FCB VERIFY LINE              15650020
PRT2245  EQU   X'0B'                    MASK FOR 2245 PRINTER    S21092 15680021
OABD089  EQU   89                                                M0099  15690021
OABD090  EQU   90                                                M0099  15700021
IOBUNCHK EQU   X'02'                    TO TEST UNIT CHK IN CSW  Y02072 15750002
CLEARBYT EQU   X'00'                    TO CLEAR A BYTE          Y02072 15760002
LNCHCODE EQU   2                        LENGTH OF A CHAN CODE    Y02072 15770002
LNGNUM   EQU   3                        LENGTH OF 3 DIGIT NUMBER Y02072 15780002
LPI8     EQU   C'8'                     EIGHT LINES/INCH         Y02072 15790002
LPI6     EQU   C'6'                     SIX LINES/INCH           Y02072 15792002
FCBIMLNG EQU   4                        LENGTH OF FCB IMAGE NAME Y02072 15794002
*                                                                       15794402
*  THE FOLLOWING MESSAGES NUMBERS ARE EQUAL TO THEIR POSITION    Y02072 15794802
*  IN THE MESSAGE CSECT (RELATIVE TO ZERO), MULT BY 2 (LENGTH    Y02072 15795202
*  OF AN INDEX).                                                 Y02072 15795602
*                                                                       15795702
HEADING  EQU   16*2                     MESSAGE NO IN MSG CSECT  Y02072 15796002
MSG128   EQU   15*2                     MESSAGE NO IN MSG CSECT  Y02072 15798002
MSG125   EQU   9*2                      MESSAGE NO IN MSG CSECT  Y02072 15798402
INSERT1  EQU   18*2                     MESSAGE NO IN MSG CSECT  Y02072 15799602
INSERT2  EQU   20*2                     MESSAGE NO IN MSG CSECT  Y02072 15849802
         EJECT                                                          15859802
*                                                                       15874902
*********************************************************************** 15900020
*                                                                       16000020
*   INITIALIZE REGISTERS                                                16100020
*                                                                       16200020
*********************************************************************** 16300020
*                                                                       16400020
         BALR  RBASE,0                  SET UP BASE REGISTER            16500020
         USING FCB2010,RBASE                                            16600020
         USING IHADCB,RDCB                                              16700020
         USING FORCORE,RCORE                                            16800020
         USING DEB,RDEB                                                 16900020
         USING UCBOB,RUCB                                               17000020
*                                                                       17100020
FCB2010  EQU   *                                                        17200020
*                                                                       17300020
         B     AROUND                   BR AROUND CONSTANTS      Y02072 17350002
         DC    C'IGG0197F'              MODULE NAME              Y02072 17400002
         DC    C'@ZA29359'              LAST SHIP CODE         @ZA29359 17450037
         DC    C'01/20/78'              LAST DATE MODIFIED     @ZA29359 17456037
AROUND   DS    0H                                                Y02072 17470002
*                                                                       17480002
         L     RDCB,0(RPARC)            LOAD CURRENT DCB ADDRESS        17500020
         L     RCORE,4(RWTGC)           LOAD CURRENT WORK AREA ADDRESS  17600020
         L     RDEB,DCBDEBAD            LOAD DEB ADDRESS                17700020
         L     RUCB,DEBUCBAD            LOAD UCB ADDRESS                17800020
         DROP  RDEB                                              Y02072 17850002
         STM   RBRNCH,RWK8,DXREGSV2     SAVE REGS                Y02072 17870002
*                                                                       17900020
*********************************************************************** 18000020
*                                                                       18100020
*   CK FCB OPTION BITS FOR VERIFY OR ALIGN FORMS                        18200020
*                                                                       18300020
*********************************************************************** 18400020
*                                                                       18500020
FCB2060  EQU   *                                                        18600020
*                                                                       18610020
         MVI   ENDINDIC,CLEARBYT        INITIALIZE SWITCH        Y02072 18612002
         CLI   DXSTAGE2,STGETWO         ENTRY TO FIND SECOND     Y02072 18622002
*                                          STAGE EXECUTOR?       M1803  18632021
         BE    FCB2215                  YES, DELETE FCB IMAGE  @ZA12979 18640037
         CLI   DXFCBOPT,VERFYMSK        CK IF FCB IMAGE IS TO    Y02072 18650002
*                                         BE VERIFIED            Y02072 18660002
         BE    FCB2070                  YES GO PRINT OUT VERIFICATION   18760020
*                                       AND ISSUE ALIGN FORMS MESSAGE   18840020
         CLI   DXFCBOPT,ALIGNMSK        CK IF FCB OPT = ALIGN    Y02072 18890002
         BE    FCB2180                  YES GO ALIGN FORMS              19000020
*                                                                       19002037
         LA    RDEB,FCB2061             LOAD RETURN ADDRESS    @ZA29359 19004037
         SR    RC,RC                    CLEAR REG              @ZA29359 19006037
         L     RC,UCBXTADR              LOAD UCB EXTENSION     @ZA29359 19008037
         CLC   8(4,RC),DXCCW10+4        LOADED FCB = REQST FCB @ZA29359 19010037
         BE    FCB2072                  YES-GO SKIP TO CHAN 1  @ZA29359 19012037
*                                                                       19014037
FCB2061  EQU   *                                               @ZA29359 19016037
         CLI   DXSTAGE2,ABEND           B13 ABEND REQUESTED?   @ZA12979 19020037
         BNE   FCB2210                  NO - BRANCH            @ZA12979 19040037
*                                                                       19080020
FCB2065  EQU   *                                                        19400020
*                                                                       19500020
*********************************************************************** 19600020
*                                                                       19700020
*   UP DATE UCB FIELDS FOR FCB ID AND FCB OPTIONS TO SHOW FCB NOT       19800020
*   USABLE  AND DELETE FCB IMAGE LOADED BY IGG0197E                     19900020
*                                                                       20000020
*********************************************************************** 20100020
*                                                                       20200020
*                                                                       20300020
         L     RJ,UCBXTADR              LOAD ADDRESS OF UCB EXTENTION   20400020
         MODESET  EXTKEY=SUPR           KEY 0 TO STORE IN UCB    Y02072 20450002
         XC    UCBFCBOF(4,RJ),UCBFCBOF(RJ) ZERO OUT FCB ID     @ZA25668 20500037
         XC    FCBOPTNS(1,RJ),FCBOPTNS(RJ) ZERO FCB OPTIONS    @ZA25668 20510037
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 20550002
         SPACE                                                          20560002
         TM    FCAOPEN2,FCAOFCBL        CK IF 197E LOADED FCB    YM4697 20570002
*                                       IMAGE                           20700020
         BZ    FCB2066                  NO FCB LOADED GO ABEND   YM4697 20800002
*                                       YES FALL THROUGH TO DELETE      20900020
*                                       FCB IMAGE LOADED                21000020
         LA    RE,DXSAVFCB              GET ADDR OF FCB IMAGE ID Y02072 21050002
*                                                                       21200020
         DELETE EPLOC=(0)               ISSUE DELETE MACRO              21300020
         NI    FCAOPEN2,X'FF'-FCAOFCBL  INDIC FCB IMAGE DELETED  YM4697 21350002
*                                                                       21400020
*********************************************************************** 21500020
*                                                                       21600020
*   ABEND ROUTINE. SET COMPLETION CODE=B13. PUT RETURN CODE IN REG.15   21700020
*                                                                       21800020
*********************************************************************** 21900020
*                                                                       22000020
FCB2066  EQU   *                                                        22100020
*                                                                       22200020
         TM    DXNABEND,ABENDBIT        CK IF ABEND IN PROCESS   Y02072 22250002
         BO    FCB2220                  YES GO TO NEXT EXECUTOR         22400020
         LM    RPAR,RWTG,DXREGSV2       RELOAD REGS FOR PROB DET YM2424 22450002
         SR    RE,RE                    ZERO REG 0               M0099  22500021
         IC    RE,DXFCBOPT              PUT INTERNAL CODE INTO   Y02072 22550002
*                                       REG 0                    M0099  22700021
         DMABCOND (0),PDLOAD,RETURN=NONE,RES=NO,                 M0099 X22800021
               REGSAVE=NO               CALL PROBLEM           @ZA09661 22900037
*                                       DETERMINATION            M0099  23000021
         B     FCB2300                                           M0099  23100021
*                                                                       23300020
*                                                                       23400020
*********************************************************************** 23500020
*                                                                       23600020
*   PRINT OUT HEADING AND VERIFICATION LINES FOR FCB IMAGE              23700020
*                                                                       23800020
*********************************************************************** 23900020
FCB2070  EQU   *                                                        23960020
*                                                                       24020020
*********************************************************************** 24030021
*                                                                       24040021
         CLI   UCBTBYT4,PRT2245        CHECK FOR 2245 PRINTER    S21092 24050021
         BE    FCB2180                 YES, GO TO ALIGN FORMS    S21092 24060021
         USING FCBIMBEG,RWK7                                     XM2963 24110002
*                                                                       24120002
*  MUST BE IN KEY 0 BECAUSE FCB IMAGE COULD BE IN EITHER USER    YM5708 24130002
*  KEY OR KEY 0.                                                 YM5708 24140002
*                                                                       24150002
         SPACE                                                          24160002
         MODESET  EXTKEY=SUPR           GET INTO KEY 0           YM5708 24170002
         SPACE                                                          24180002
         LA    RD,FCBLNPIN              SET FCB IM PTR TO START  XM2963 24200002
*                                         OF IMAGE               XM2963 24210002
         TM    FCBINDEX,FCBRGTIN+FCBLFTIN  IS INDEXING BEING     XM2963 24220002
*                                            USED                XM2963 24230002
         BZ    FCB2071                  NO, RD HAS CORRECT ADDR  XM2963 24240002
         LA    RD,FCBLNPN1              YES, REINIT RD           XM2963 24242002
FCB2071  EQU   *                                                 XM2963 24244002
         SPACE                                                          24244402
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MAN KEY     YM5708 24244802
         SPACE                                                          24245202
         DROP  RWK7                                              XM2963 24246002
         ST    RWK7,DXREGSV1            SAVE IMAGE ADDRESS       Y02072 24250002
         LA    RBRNCH,FCB2078           GET ADDRESS OF INIT      Y02072 24260002
*                                       ROUTINE FOR FCB VERIFICATION    24320020
         B     FCB2078                                         @AZ07594 24500037
FCB2072  EQU   *                                                        24560020
*                                                                       24620020
         MVC   DXCCW1(EIGHTMSK),SKIP0CCW SET UP SKIP TO CHANNEL 1 CCW   24680020
         MVI   DXCCW1,SKIPCH1           SET COMMAND CODE=SKIP CH 1      24740020
*                                                                       24800020
*                                                                       24860020
FCB2073  EQU   *                                                        24920020
*                                                                       24980020
*                                                                       25040020
         LA    RF,DXIOB                 GET ADDR IOB IN REG 1           25160020
*                                                                       25220020
         EXCP  (1)                      ISSUE SKIP TO CH 1              25280020
*                                                                       25340020
         WAIT  ECB=DXECB                WAIT ON I/O              M0099  25440021
*                                                                       25580020
*                                                                       25640020
FCB2074  EQU   *                                                        25700020
*                                                                       25760020
         LTR   RD,RD                   CK IF REG 14 = 0                 25820001
         BZR   RBRNCH                  IF SO GO TO ADD IN REG 11 Y02072 26020002
         CLI   DXECB,SUCCFLCC           CK FOR SUCCESSFUL COMPLETION    26300020
         BNE   FCB2114                  NO GO SET CODE FOR PERM ERROR   26360020
*                                       DURING VERIFICATION             26420020
*                                                                       26480020
         BR    RBRNCH                   GO TO ADDRESS IN REG 11  Y02072 26540002
*                                                                       26600020
*                                                                       26660020
*                                                                       26720020
FCB2078  EQU   *                                                        26780020
*                                                                       26840020
*                                                                       26900020
*                                                                       26960020
*   INITIALIZE REGISTERS FOR VERIFICATION                               27020020
*   -RB  CONTAINS ADDRESS FCB IMAGE                                     27080020
*   -RTIOT CONTAINS LINE NUMBER                                         27140020
*   -RD    CONTAINS POINTER TO ENTRY IN FCB IMAGE                       27200020
*                                                                       27260020
         LA    RTIOT,ONEMASK            SET LINE COUNTER                27320020
*                                                                       27380020
*   FORM CCW TO PRINT LINES OF VERIFICATION                             27440020
*                                                                       27500020
         LA    RJ,MSGLSTSZ              GET ADDRESS OF PRINT LINE       27620020
         ST    RJ,DXCCW1                STORE ADD OF PRT LINE IN CCW    27680020
         MVI   DXCCW1,WTSKP1            SET COMMAND CODE TO PRT+SPACE 1 27740020
         MVI   DXCCW1+FOURMASK,SILIMASK SET THE SILI BIT       @ZA10220 27770037
*                                                                       27800020
* EXTRACT FCB VERIFICATION HEADING FROM THE MESSAGE CSECT        Y02072 27860002
*                                                                       27920020
         LA    RWK3,HEADING             MESSAGE NO FOR MSG RTN   Y02072 27970002
         BAL   RWK6,GETMSG              GO GET MSG TEXT          Y02072 28020002
FCB2079  EQU   *                                                 Y02072 28120002
         USING MSGTXTD,RWK3                                      Y02072 28122002
         USING MSGENTRY,RWK2                                     Y02072 28122402
         IC    RWK7,MSGLNG              LEN OF LINE - 1          Y02072 28122802
         EX    RWK7,MOVELINE            MOVE LINE TO BUFFER      Y02072 28122902
         LA    RWK7,1(RWK7)             TOTAL NUM OF BYT TO PRNT Y02072 28123202
         STC   RWK7,DXCCW1+7            LEN TO CCW               Y02072 28123602
         LR    RWK8,RWK2                SAVE ADDR OF HEADING TXT Y02072 28126002
*                                         IN MSG CSECT           Y02072 28128002
*                                                                       28128402
* FILL IN VARIABLE FIELDS OF THE HEADING                         Y02072 28128802
*                                                                       28129202
         IC    RWK7,MSGOFF5             OFFSET TO VAR FLD FIVE   Y02072 28130002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD FIVE  Y02072 28140002
         MVC   0(FCBIMLNG,RWK3),DXFCBID  FCB IMAGE TO MSG        Y02072 28142002
         IC    RWK7,MSGOFF6             OFFSET TO VAR MSG SIX    Y02072 28152002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD SIX   Y02072 28154002
         MVI   0(RWK3),LPI6             ASSUME 6 LINES/INCH      Y02072 28156002
         MODESET  EXTKEY=SUPR           GET INTO KEY ZERO      @ZA25088 28160037
         TM    0(RD),X'10'              TEST IF SPACING= 8 LPI @ZA25088 28170037
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MGT KEY   @ZA25088 28180037
         BNO   FCB2090                  IF NOT GO TRASLATE       Y02072 28220002
*                                         CHANNEL CODE           Y02072 28230002
         MVI   0(RWK3),LPI8             IMAGE 8 LINES/INCH       Y02072 28270002
         DROP  RWK3                                              Y02072 28330002
*                                                                       28640020
*    CONVERT LINE NUMBER AND INSERT INTO PRINT LINE                     28700020
*                                                                       28760020
FCB2090  EQU   *                                                        28820020
*                                                                       28880020
         CVD   RTIOT,DXCCW2             CONVERT LINE # TO DECIMAL       28940020
         UNPK  DXCCW2(FOURMASK),DXCCW2+SIXC(TWO) UNPACK LINE NUMBER     29000020
         OI    DXCCW2+THREE,NUMBMASK    MASK OUT SIGN                   29060020
         IC    RWK7,MSGOFF1             OFFSET TO VAR FLD ONE    Y02072 29160002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD ONE   Y02072 29172002
         MVC   0(LNGNUM,RWK3),NUMNXTLN  NUMBER OF THE NEXT PRINT Y02072 29174002
*                                         LINE                   Y02072 29176002
*                                                                       29180020
*    TRANSLATE CHANNEL CODE TO CHARACTER FORM AND ADD TO PRINT LINE     29240020
*    GET INTO KEY 0 AS IMAGE COULD BE IN USER KEY OR KEY 0.      Y02072 29290002
*                                                                       29300020
         MODESET  EXTKEY=SUPR                                    Y02072 29350002
*                                                                       29352002
*                                                                       29354002
         IC    RC,NULL(RD)              GET CHANNEL CODE                29360020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 29362002
         SPACE                                                          29364002
         N     RC,LFTHFOFF              TURN LEFT HALF OF BYTE   Y02072 29370002
*                                         OFF                    Y02072 29380002
         BNZ   FCB2095                  GO TRANSLATE CHAN CODE   Y02072 29480002
*                                         IF NOT ZERO            Y02072 29490002
*                                                                       29530002
* MUST BLANK OUT THE CHANNEL FIELD                               Y02072 29540002
*                                                                       29550002
         IC    RWK7,MSGOFF2             OFFSET TO VAR FLD TWO    Y02072 29580002
         LA    RWK3,MSGAREA(RWK7)       ADDR OF VAR FLD TWO      Y02072 29630002
*                                                                       29630402
* GET THE LENGTH OF THE CHANNEL FIELD BY GETTING THE LENGTH      Y02072 29630802
* OF INSERT 2 AND ADDING THE LENGTH OF THE CHANNEL CODE TO IT.   Y02072 29630902
* (THIS INSERT IS USED IN THE CHANNEL FIELD WHEN A CHANNEL CODE  Y02072 29631002
* IS PRESENT).                                                   Y02072 29631102
*                                                                       29631202
         LR    RWK1,RWK3                SAVE ADD OF FLD TO BLANK Y02072 29632002
         LA    RWK3,INSERT2             MSG NUM OF FLD TO BLANK  Y02072 29634002
         BAL   RWK6,GETMSG              GET MSG TO GET LENGTH    Y02072 29636002
         IC    RWK7,MSGLNG              LENTH OF INSERT - 1      Y02072 29638002
         LA    RWK7,LNCHCODE(RWK7)      LNG OF FIELD TO CLEAR    Y02072 29638402
         LR    RWK2,RWK1                RESTORE ADDR OF VAR FLD  Y02072 29638802
         MVI   0(RWK2),BLANK            BEGIN TO CLEAR FIELD     Y02072 29640002
         EX    RWK7,MVBLANK             CLEAR FIELD              Y02072 29650002
         B     FCB2100                  GO PRT A LINE OF VERIFICATION   29660020
MVBLANK  MVC   1(0,RWK2),0(RWK2)        INST TO PROP A BYTE      Y02072 29710002
         USING MSGTXTD,RWK3                                      Y02072 29710402
MOVELINE MVC   MSGAREA(0),MSGTXT        MOVE LINE TO BUFFER      Y02072 29712002
         DROP  RWK3                                                     29714002
*                                                                       29720020
FCB2095  EQU   *                                                        29780020
*                                                                       29840020
* PUT THE CHANNEL CODE IN THE PRINT LINE                         Y02072 29890002
*                                                                       29892002
         SLL   RC,ONEMASK               MUTIPLY CHANNEL CODE BY 2       29900020
         LA    RJ,DXCCW3(RC)            GET ADDRESS OF CHANNEL CODE     29960020
         IC    RWK7,MSGOFF3             OFFSET TO VAR FLD THREE  Y02072 30060002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD THREE Y02072 30070002
         MVC   0(LNCHCODE,RWK3),0(RJ)   CHAN CODE TO MESSAGE     Y02072 30072002
*                                                                       30080020
FCB2100  EQU   *                                                        30140020
*                                                                       30200020
*                                                                       30260020
         BAL   RBRNCH,FCB2073           GO ISSUE EXCP AND WAIT   Y02072 30320002
*                                                                       30380020
*                                                                       30432002
* TEST FOR THE LAST PRINT LINE                                   Y02072 30434002
*                                                                       30436002
         TM    ENDINDIC,ENDMARK         TEST FOR LAST LINE       Y02072 30446002
         BO    FCB2180                  GO TO MSG 'IEC128D'    @AZ07594 30456037
         USING MSGENTRY,RWK8                                     Y02072 30470002
*                                                                       30470402
* USE OFFSET TO VAR FLD 4 AS LENGTH OF LINE TO PRINT. LENGTH     Y02072 30470802
* WILL BE 1 BYTE TOO MANY.                                       Y02072 30471202
*                                                                       30471602
         IC    RWK7,MSGOFF4             OFFSET TO VAR FLD FOUR   Y02072 30472002
         BCTR  RWK7,0                   DECREMENT COUNT          Y02072 30522002
         STC   RWK7,DXCCW1+7            BYTE COUNT TO CCW        Y02072 30532002
*                                                                       30560020
*   SET REGISTERS TO PRINT NEXT LINE OF VERIFICATION                    30620020
*                                                                       30680020
         LA    RTIOT,ONEMASK(RTIOT)     INCREMENT LINE COUNTER          30740020
         LA    RD,ONEMASK(RD)           INCREMENT LINE POINTER TO       30860020
*                                       NEXT POSITION OF FCB IMAGE      30920020
*                                                                       30930002
* FILL IN THE CHANNEL FIELD                                      Y02072 30940002
*                                                                       30950002
         IC    RWK7,MSGOFF2             OFFSET TO VAR FLD TWO    Y02072 30970002
         LA    RWK1,MSGAREA(RWK7)       ADDR OF VAR FLD TWO      Y02072 30972002
         DROP  RWK8                                              Y02072 30974002
         LA    RWK3,INSERT2             MSG NUM IN MSG CSECT     Y02072 30976002
         BAL   RWK6,GETMSG              GET INSERT FOR HEADING   Y02072 31026002
         USING MSGENTRY,RWK2                                     Y02072 31028002
         IC    RWK7,MSGLNG              LNG OF INSERT - 1        Y02072 31028402
         LR    RWK6,RWK1                ADDR OF VAR FIELD        Y02072 31030002
         EX    RWK7,MVCINST             MOVE IN INSERT           Y02072 31030402
         LR    RWK2,RWK8                ADDR OF MSG IN CSECT     Y02072 31032402
         SPACE                                                          31034402
         MODESET  EXTKEY=SUPR                                    YM5923 31036402
         SPACE                                                          31038402
         TM    0(RD),ENDMARK            CK FOR END OF FCB IMAGE FLAG    31040002
         BNO   FCB2090                  NO GO TO FORM NEXT PRINT LINE   31090002
*                                       YES SET FOR LAST LINE OF VFY    31140002
         SPACE                                                          31190002
         MODESET  EXTKEY=DATAMGT                                 YM5923 31240002
         SPACE                                                          31250002
*  SET LENGTH FOR LAST LINE                                      Y02072 31270002
*  THE LENGTH OF THE LAST LINE IS CALCULATED BY ADDING LENGTH    Y02072 31280002
*  OF THE END INDICATOR TO VAR OFFSET 4.                         Y02072 31290002
*                                                                       31320002
         LA    RWK3,INSERT1             INDEX TO END INDICATOR   Y02072 31370002
         BAL   RWK6,GETMSG              GO GET THE END INDICATOR Y02072 31380002
         IC    RWK7,MSGLNG              LEN - 1 OF END INDIC     Y02072 31382002
         LA    RWK1,1(RWK7)             SAVE TOT LEN, END INDIC  Y02072 31384002
         USING MSGENTRY,RWK8                                     Y02072 31390002
         IC    RWK7,MSGOFF4             OFFSET TO VAR FLD        Y02072 31392002
         AR    RWK1,RWK7                TOTAL LEN OF LAST LINE   Y02072 31392402
         STH   RWK1,DXCCW1+6            BYTE COUNT TO CCW        Y02072 31392802
         LA    RWK6,MSGAREA(RWK7)       ADDR OF VAR FIELD        Y02072 31394002
         DROP  RWK8                                              Y02072 31398402
*                                                                       31398502
*  MOVE END INDICATOR TO THE LAST PRINT LINE                     Y02072 31398602
*                                                                       31398702
         USING MSGENTRY,RWK2                                     Y02072 31398802
         IC    RWK7,MSGLNG              LENGTH OF INSERT - 1     Y02072 31399202
         EX    RWK7,MVCINST             INSERT TO PRINT LINE     Y02072 31399602
         OI    ENDINDIC,ENDMARK         SET LAST LINE TO PRINT   Y02072 31399702
         LR    RWK2,RWK8                FOR ADDRESSABILITY TO    Y02072 31399802
*                                         VAR FIELDS IN HEADING  Y02072 31399902
         B     FCB2090                  GO CONVERT LINE NO       Y02072 31400002
MVCINST  MVC   0(0,RWK6),0(RWK3)        TO MOVE INSERT INTO MSG  Y02072 31410002
*                                                                       31460020
*                                                                       32120020
*                                                                       33000020
*   ERROR ROUTINE FOR PRINTER FAILURES DURING VERIFICATION              33100020
*                                                                       33200020
FCB2114  EQU   *                                                        33220020
*                                                                       33240020
*                                                                       33260020
         TM    IOBSTAT0,IOBUNCHK        UNIT CHECK CONDITION     Y02072 33280002
         BZ    FCB2130                  NO, BR AROUND SENSE TEST Y02072 33290002
         TM    IOBSENS1,CMDRTYMK        TEST IF ERROR RETRYABLE         33300020
         BNO   FCB2130                  NO GO SET RETURN CODE=X'10'     33400020
         TM    IOBSENS0,BUFPARMK        TEST FOR UCS BUFFER PARITY ERR  33500020
         BO    FCB2120                  YES GO ISSUE SKIP TO CH 0       33600020
FCB2115  EQU   *                                                        33700020
*                                                                       33800020
         LA    RF,ONEMASK               SET MASK TO CLEAR BITS 0-30     33900020
         NR    RC,RF                    CLEAR BITS 0-30                 34000020
         LTR   RC,RC                    IF RC=0 GO RETRY PRINT LINE     34100020
         BNZ   FCB2130                  NO GO SET PERM ERR +SKP CH 0    34200020
         LA    RC,ONEMASK(RC)           SET FLAG FOR FIRST RETRY        34300020
         B     FCB2100                  GO RETRY PRINT LINE             34400020
*                                                                       34500020
FCB2120  EQU   *                                                        34600020
*                                                                       34700020
         MVC   DXCCW1(EIGHTMSK),SKIP0CCW SET UP SKIP TO CH 0 CCW        35000020
         LA    RF,DXIOB                 GET IOB ADDR                    35300020
*                                                                       35400020
         EXCP  (1)                      ISSUE EXCP TO RESET PRINTER     35500020
*                                                                       35600020
*   SET RETURN CODE OF X'10' FOR PERM I/O ERROR DURING VERIFICATION     35700020
*                                                                       35800020
FCB2130  EQU   *                                                        35900020
*                                                                       36000020
         MVI   DXFCBOPT,OABD089         MOVE INTERNAL CODE TO    Y02072 36050002
*                                       WKAREA                   M0099  36120021
         B     FCB2066                  GO TO DELETE FCB IMAGE AND      36200020
*                                       FLAG INVALID                    36300020
*                                                                       36900020
*********************************************************************** 37000020
*                                                                       37100020
*   ALIGNMENT OF FORMS ROUTINE                                          37200020
*   (1) ISSUE MESSAGE'IEC128D XXX,VERIFY FORMS ALIGNMENT'               37300020
*   (2) ANALIZE REPLY                                                   37400020
*                                                                       37500020
*********************************************************************** 37600020
*                                                                       37700020
FCB2180  EQU   *                                                        37800020
*                                                                       37900020
         LA    RWK3,MSG128              MESSAGE NO FOR MSG RTN   Y02072 37950002
         BAL   RWK6,GETMSG              GO GET MSEEAGE           Y02072 38000002
         USING MSGTXTD,RWK3                                      Y02072 38010002
         IC    RWK7,MSGLNG              LEN - 1 TO MOVE          Y02072 38030002
         EX    RWK7,MOVELINE            MOVE LINE TO BUFFER      Y02072 38040002
         IC    RWK7,MSGOFF1             OFFSET TO VAR FLD ONE    Y02072 38050002
         LA    RWK3,MSGAREA(RWK7)       ADDRESS OF VAR FLD ONE   Y02072 38100002
         MVC   0(L'UCBNAME,RWK3),UCBNAME  DEV NAME TO MSG        Y02072 38150002
         B     FCB2195                  BR AROUND MOVE INST      Y02072 38200002
FCB2190  EQU   *                                                        38850020
*                                                                       38900020
         MVC   MSGAREA,MSGTXT           MV 64 BYTES TO WTOR AREA Y02072 38950002
         DROP  RWK3                                              Y02072 38960002
FCB2195  EQU   *                                                 Y02072 38970002
*                                                                       38980002
*   CLEAR REPLY AREA                                                    39000020
*                                                                       39050002
         LA    RF,REPLYLTH              GET ADDRESS OF PARM LIST        39060020
         XC    RPLY(24),RPLY            ZERO OUT REPLY AREA AND ECB     39120020
*                                                                       39180020
*                                                                       39300020
         SVC   35                                                       39360020
*                                                                       39420020
         LA    RF,RPLYECB               GET ECB ADDRESS                 39480020
*                                                                       39540020
         WAIT  ECB=(1),LONG=YES                                  Y02072 39600002
*                                                                       39780020
*   REPLY ANALYSIS                                                      39840020
*                                                                       39960020
         L     RWK7,DXREGSV1            REINIT REG IN CASE       Y02072 40010002
*                                         RE-VERIFICATION IS     Y02072 40012002
*                                         NECESSARY              Y02072 40014002
         OC    RPLY(8),LOMASK           ALLOW LOWER CASE ALPHA          40020020
         CLC   RPLY(2),RETRY0           RE-VERIFICATION OF FCB NEEDED   40080020
         BE    FCB2060                  GO RE_VERIFY IF NEEDED          40140020
*                                                                       40200020
         CLC   RPLY(6),RETRY1           RE-VERIFICATION OF FCB NEEDED   40260020
         BE    FCB2060                  GO RE_VERIFY IF NEEDED          40320020
*                                                                       40380020
         CLC   RPLY(2),VERFYC2          OPERATOR VERIFIED FCB IMAGE     40440020
         BNE   FCB2191                  GO TRY NEXT REPLY      @AZ07594 40500037
         LA    RBRNCH,FCB2210           ADDR TO CLEAN UP FCB I @AZ07594 40540037
         B     FCB2072                  GO ISSUE SKIP CHANN 1  @AZ07594 40580037
FCB2191  CLC   RPLY(8),VERFYC1          OPER VERIFIED FCB IMAG @AZ07594 40620037
         BNE   FCB2192                  GO TRY NEXT REPLY      @AZ07594 40660037
         LA    RBRNCH,FCB2210           ADDR TO CLEAN UP FCB I @AZ07594 40700037
         B     FCB2072                  GO ISSUE SKIP CHANN 1  @AZ07594 40740037
FCB2192  CLC   RPLY(7),CANCELC1         CK IF OPERATOR CANCEL  @AZ07594 40780037
         BE    FCB2200                  YES GO SET RETURN CODE = X'14'  40860020
         CLC   RPLY(2),CANCEL2          CK IF OPERATOR CANCELED FCB VER 40920020
*                                       FCB VERIFICATION                40980020
         BE    FCB2200                  YES GO SET RETURN CODE=X'14'    41300020
*                                                                       41400020
*   INVALID OPERATOR RESPONSE ISSUE MESSAGE TO REPEAT REPLY             41500020
*   'IEC125 ERROR - REPEAT REPLY'                                       41600020
*                                                                       41700020
         LA    RWK3,MSG125              MESSAGE NO FOR MSG RTN   Y02072 41750002
         LA    RWK6,FCB2190             RETURN ADDRESS           Y02072 41800002
         B     GETMSG                   GO GET MSESAGE           Y02072 41850002
*                                                                       42300020
FCB2200  EQU   *                                                        42400020
*                                                                       42500020
         MVI   DXFCBOPT,OABD090         MOVE INTERNAL CODE TO    Y02072 42550002
*                                       WKAREA                   M0099  42620021
         B     FCB2065                  GO DELETE FCB AND ABEND         42700020
*                                                                       42800020
*   HAVE FINISHED WITH FCB LOADING SO CLEAN UP                          42900020
*                                                                       43000020
FCB2210  EQU   *                                                        43100020
*                                                                       43200020
*                                                                       43700020
*   UP DATE UCB FIELDS WITH FCB ID AND FCB OPTIONS.  IF THE FCB ID      43800037
*   IN THE UCB EXTENSION IS THE SAME AS THE ONE REQUESTED BY THIS       43820037
*   USER, THEN EITHER THE FCB IMAGE WAS NOT LOCATED BY THE PREVIOUS     43840037
*   MODULE AND WE DO NOT WANT TO UPDATE THE UCB EXTENSION OR IT WAS     43860037
*   ONLY LOADED TO VERIFY IT.                                           43880037
*                                                                       43900020
         L     RC,UCBXTADR              GET POINTER TO UCB EXTENTION    44000020
         MODESET  EXTKEY=SUPR           KEY 0 TO STORE IN UCB    Y02072 44050002
         SPACE                                                          44060002
         CLC   UCBFCBOF(4,RC),DXFCBID   UCB ALREADY UPDATED?   @ZA12979 44070037
         BE    FCB2215                  YES, FCB IMAGE OK      @ZA12979 44080037
         MVC   UCBFCBOF(4,RC),DXFCBID   MOVE FCB ID INTO UCB     Y02072 44090037
         MVC   FCBOPTNS(1,RC),NULL(RB)  MOVE FCB OPTIONS TO UCB@ZA12979 44100037
*                                       IF ANY                          44110037
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 44120037
         SPACE                                                          44130037
FCB2215  TM    FCAOPEN2,FCAOFCBL        CK IF FCB LOADED INTO  @ZA12979 44140037
*                                         MAIN STG               Y02072 44198002
         BZ    FCB2220                  NO GO MOVE EROPT FOR DCB YM4697 44210002
         LA    RE,DXSAVFCB              GET ADDR OF FCB IMAGE ID Y02072 44220002
         DELETE EPLOC=(0)                                               44250020
         NI    FCAOPEN2,X'FF'-FCAOFCBL  INDIC FCB IMAGE DELETED  YM4697 44260002
*                                                                       44300020
*********************************************************************** 44400020
*                                                                       44500020
*   DETERMINE NEXT STAGE 2 EXECUTOR                                     44600020
*                                                                       44700020
*********************************************************************** 44800020
*                                                                       44900020
FCB2220  EQU   *                                                        45000020
*                                                                       45100020
*********************************************************************** 45200020
*                                                                       45300020
*   RESTORE DCB EROPT                                                   45400020
*                                                                       45500020
*********************************************************************** 45600020
*                                                                       45700020
         MVC   DXCCW6(1),DXEROPT        MVOE IN DCB EROPT        Y02072 45750002
*                                                                       45900020
*********************************************************************** 46000020
*   SEE IF SYS1.IMAGELIB HAS BEEN OPENED IF YES CLOSE IT                46007020
*                                                                       46014020
*                                                                       46021020
         CLI   DXIMGDCB,IMCLOSED        CK IF IMGLIB CLOSED      Y02072 46023002
         BE    FCB2230                  YES, GO TEST NEXT EXECUTORM1803 46035021
         L     RF,DXIMGDCB              GET ADDR OF IMGLIB DCB   Y02072 46037002
*                                                                       46049020
*   ISSUE SVC TO CLOSE IMAGELIB                                         46056020
*                                                                       46063020
         SVC   105                      ISSUE SVC TO CLOSE SYS1.IMAGELI 46070020
         NI    FCAOPEN2,X'FF'-FCAOIMGL  INDIC IMAGELIB CLOSED    YM4697 46072002
*                                                                       46077020
**********************************************************************  48200020
*                                                                       48300020
*   DETERMINE THE NEXT STAGE 2 EXECUTOR TO BE XCTLED                    48400020
*                                                                       48500020
*********************************************************************** 48600020
*                                                                       48700020
FCB2230  EQU   *                                                        48800020
*                                                                       48900020
*********************************************************************** 49000020
*                                                                       49100020
*   TEST IF EXCP IS SPECIFIED.IF YES,XCTL TO THE LAST OPEN EXECUTOR     49200020
*                                                                       49300020
*********************************************************************** 49400020
*                                                                       49500020
         TM    DCBMACRF,EXCPMASK        TEST IF EXCP IS SPECIFIED       49600020
         BC    14,FCB2240               IF NOT,GOTO BUFFER CNTRL BLK    49700020
*                                                                       49800020
         LA    RF,MODNM11               GO DO DCB COPY BACK      Y02072 49810002
         BC    15,FCB2270               GOTO WTG TABLE UPDATE    Y02072 50000002
*                                                                       50100020
*********************************************************************** 50200020
*                                                                       50300020
FCB2240  EQU   *                                                        50400020
*                                                                       50500020
*********************************************************************** 50600020
*                                                                       50700020
*   TEST IS BUFFER CONTROL BLOCK IS SPECIFIED.IF YES,XCTL TO IGG0911I   50800020
*                                                                       50900020
*********************************************************************** 51000020
*                                                                       51100020
         TM    DCBBUFNO+3,BFCNTRL       BUFFER CONTROL BLOCK SPECIFIED  51200020
         BC    14,FCB2250               IF YES,GOTO TEST PCI ROUTINE    51300020
*                                                                       51400020
         SR    RE,RE                    RESET REGISTER                  51500020
         IC    RE,DCBBUFNO              GET THE NO OF BUFFER SPECIFIED  51600020
         LTR   RE,RE                    TEST IF DCBBUFNO='0'            51700020
         BC    8,FCB2250                IF YES,GOTO TEST PCI            51800020
*                                                                       51900020
         LA    RF,MODNM1I               LOAD ADDR OF IDTTR OF IGG0191I  52000020
         BC    15,FCB2270               GOTO MOVE IDTTR ROUTINE         52100020
*                                                                       52200020
*********************************************************************** 52300020
*                                                                       52400020
FCB2250  EQU   *                                                        52500020
*                                                                       52600020
*********************************************************************** 52700020
*                                                                       52800020
*   TEST IF PCI IS SPECIFIED.IF YES,XCTL TO IGG0191Q                    52900020
*                                                                       53000020
*********************************************************************** 53100020
*                                                                       53200020
         TM    DCBOPTCD,PCIMASK         TEST IF PCI SPECIFIED           53300020
         BC    14,FCB2260               IF NOT,GOTO BSAM/QSAM ROUTINEED 53400020
*                                                                       53500020
         LA    RF,MODNM1Q               LOAD ADDR OF IDTTR OF IGG0191Q  53600020
         BC    15,FCB2270               GOTO MOVE IDTTR ROUTINE         53700020
*                                                                       53800020
*********************************************************************** 53900020
*                                                                       54000020
FCB2260  EQU   *                                                        54100020
*                                                                       54200020
*********************************************************************** 54300020
*                                                                       54400020
*   BSAM/QSAM EXIT.XCTL TO IGG0191G                                     54500020
*                                                                       54600020
*********************************************************************** 54700020
*                                                                       54800020
         LA    RF,MODNM1G               LOAD ADDR OF IDTTR IF IGG0191G  54900020
*                                                                       55000020
*********************************************************************** 55100020
*                                                                       55200020
FCB2270  EQU   *                                                        55300020
*                                                                       55400020
*********************************************************************** 55500020
*                                                                       55600020
*   MOVE IDTTR TO XCTL WTG TABLE                                        55700020
*                                                                       55800020
*********************************************************************** 55900020
*                                                                       56000020
         USING WTGENTRY,RWTGC                                    Y02072 56050002
         MVC   WTGIDTTR,0(RF)           ST NEXT MOD ID IN WTG  @Z30TSCF 56060003
*                                                                       56200020
*********************************************************************** 56300020
*                                                                       56400020
FCB2280  EQU   *                                                        56500020
         LM    RPAR,RWTG,DXREGSV2       RESTORE REGISTERS        Y02072 56550002
FCB2285  EQU   *                        UPDATE WTG TABLE         Y02072 56560002
*                                                                       56600020
*********************************************************************** 56700020
*                                                                       56800020
*   UPDATE WTG TABLE AND XCTL TO NEXT MODULE                            56900020
*                                                                       57000020
*********************************************************************** 57100020
*                                                                       57200020
         LA    RWTGC,WGOFF(0,RWTGC)     INCREMENT CURRENT WTG ENTRY     57300020
         LA    RPARC,PLOFF(0,RPARC)     INCREMENT CURRENT DCB ENTRY     57400020
         CLC   0(2,RWTGC),AMIDCNST      IS THE RTN NEEDED AGAIN         57500020
         BCR   8,RBASE                  IF YES,RETURN TO PROCESS        57600020
*                                                                       57700020
         CLC   0(2,RWTGC),OPIDCNST      TEST END OF WTG TABLE           57800020
         BC    7,FCB2285                IF NOT,CHECK NEXT ENTRY  Y02072 57900002
*                                                                       58000020
         LR    RPARC,RPAR               RESET REG TO '0'                58100020
         LA    RWTGC,WAOFF(0,RWTG)      RESET WTG REG TO POINT +32(WTG) 58200020
FCB2290  CLI   0(RWTGC),X'00'           TEST IF THIS ENTRY COMPLETE     58300020
         BNE   FCB2300                  IF NOT XCTL                     58400020
*                                                                       58500020
         LA    RWTGC,WGOFF(0,RWTGC)     GET NEXT ENTRY OF WTG TABLE     58600020
         LA    RPARC,PLOFF(0,RPARC)     GET NEXT ENTRY OF DCB           58700020
         BC    15,FCB2290               GOTO TEST COMPLETION            58800020
*                                                                       58900020
FCB2300  EQU   *                                                        59000020
*                                                                       59100020
         USING WTG,RWTG                                                 59150003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*59200003
               MODID=WTGENTRY                                  @Z30TSCF 59250003
         DROP  RWTGC,RWTG                                      @Z30TSCF 59300003
*                                                                       59800020
*********************************************************************** 59900020
*                                                                       60000020
*                                                                       60100020
**********************************************************************  60200020
*                                                                       60300020
*   CONSTANTS                                                           60400020
*                                                                       60500020
*********************************************************************   60600020
*                                                                       60970002
*  MODULE ID'S                                                          60980002
*                                                                       60990002
MODNM1G  DC    C'1G',VL3(IGG0191G)                             @Z30TSCF 60992003
MODNM1I  DC    C'1I',VL3(IGG0191I)                             @Z30TSCF 60994003
MODNM1Q  DC    C'1Q',VL3(IGG0191Q)                             @Z30TSCF 60996003
PDLOAD   DC    C'6M',VL3(IGG0196M)                             @Z30TSCF 60998003
MODNM11  DC    C'11',VL3(IGG01911)                             @Z30TSCF 60998403
OPIDCNST DC    C'0S'                    END OF WTG TABLE                61000020
AMIDCNST DC    C'7F'                    RTN CODE                        61100020
*                                                                       61150002
*  OTHER CONSTANTS                                                      61200002
*                                                                       61250002
LFTHFOFF DC    0F'0',X'0000000F'        TO CLEAR THE LEFT HALF   Y02072 61300002
*                                         OF A BYTE              Y02072 61350002
VERFYC1  DC    C'VERIFIED'                                              63000020
RETRY0   DC    C'R '                    RETRY FCB VERIFICATION          63030020
RETRY1   DC    C'RETRY '                RETRY FCB VERIFICATION          63060020
VERFYC2  DC    C'V '                    FCB IMAGE VERIFIED CODE         63090020
CANCELC1 DC    C'CANCEL '               CANCEL FCV VERIFICATION CODE    63120020
CANCEL2  DC    C'C '                    CANCEL FCV VERIFICATION CODE    63150020
SKIP0CCW DC    X'8300000020000001' SKIP TO CHANNEL 0 CCW                63260020
         EJECT                                                          63282002
*********************************************************************** 63290002
*  'GETMSG' SUBROUTINE                                           Y02072 63292002
*  THIS SUBROUTINE EXTRACTS THE REQUIRED MESSAGE FROM THE MSG    Y02072 63294002
*  CSECT AND MOVES IT TO THE WTO/WTOR AREA.                      Y02072 63296002
*                                                                       63298002
*    INPUT TO THIS ROUTINE:                                      Y02072 63298402
*      REG 11 - MESSAGE NUMBER IN CSECT                          Y02072 63298802
*      REG 15 - RETURN ADDRESS                                   Y02072 63299202
*                                                                       63299602
*    OUTPUT FROM THIS ROUTINE:                                   Y02072 63299702
*      REG 1 - POINTER TO MESSAGE ENTRY IN THE MESSAGE CSECT     Y02072 63299802
*      MESSAGE TEXT IN WTO/WTOR AREA                             Y02072 63299902
*********************************************************************** 63333202
GETMSG   DS    0H                       ENTRY POINT, MSG RTN     Y02072 63343202
         L     RWK7,DXMSGADR            GET ADDR OF MSG CSECT    Y02072 63353202
         LH    RWK2,0(RWK7,RWK3)        GET INDEX TO MESSAGE     Y02072 63363202
         LA    RWK2,0(RWK7,RWK2)        ADDR OF MESSAGE ENTRY    Y02072 63365202
         USING MSGENTRY,RWK2                                     Y02072 63365602
         SR    RWK3,RWK3                PREPARE REGISTER         Y02072 63366002
         IC    RWK3,MSGOFF              GET OFFSET TO TEXT IN    Y02072 63366402
*                                         ENTRY                  Y02072 63366502
         LA    RWK3,0(RWK2,RWK3)        ADDR OF MESSAGE TEXT     Y02072 63366602
         SR    RWK7,RWK7                PREPARE REG FOR RETURN   Y02072 63387702
         BR    RWK6                     RETURN                   Y02072 63388602
         SPACE                                                          63388702
PATCH    DC    0H'0',54X'00'            PATCH AREA               Y02072 63412002
END      EQU   *                        END OF THIS MODULE       Y02072 63458802
         EJECT                                                          63488802
         IHAFCBIM                                                XM2963 63538802
         EJECT                                                          63588802
CVT      DSECT                                                 @Z30TSCF 63638803
         CVT                                                   @Z30TSCF 63688803
         EJECT                                                          63738803
         DCBD  DSORG=PS                                                 65700020
         EJECT                                                          66050002
         IGGMSG                                                  Y02072 66060002
         EJECT                                                          66070002
         IECDSECS  WTG,PREFX,EXPAND=YES                        @Z30TSCF 66080003
         ORG   WTGIDTTR                                          Y02072 66082002
WTGID    DS    CL2                      ID NEXT MOD              Y02072 66084002
         EJECT                                                          66090002
         IECDSECS MAIN,EXPAND=YES                                M0099  66100021
         ORG   REPLYLTH+52                                       S21092 66210021
RPLY     DS    20C                      MSG REPLY AREA           M0191  66220021
RPLYECB  DS    F                        ECB FOR WTOR EXCP        M0191  66230021
MCSMASK  DS    H                        MASK FOR MCS             M0191  66240021
LOMASK   DS    8C                       MASK FOR LOWER CASE RPLY M0191  66250021
UCSID    DS    4C                       ID OF UCS IMAGE          M0191  66260021
         ORG   MSGLSTSZ                                          Y02072 66270002
MSGAREA  DS    0CL64                    AREA TO MOVE 64 BYTES    Y02072 66280002
*                                         TO FOR WTO/WTOR'S      Y02072 66290002
DXREGSV1 EQU   DXXCTL                   WORD TO SAVE REG         Y02072 66292002
DXREGSV2 EQU   DXCCW12                  WORDS TO SAVE REGS       Y02072 66294002
NUMNXTLN EQU   DXCCW2+1                 NUMBER OF PRINT LINES    Y02072 66296002
ENDINDIC EQU   DXXCTL+4                 IF X'00', NOT THE LAST   Y02072 66298002
*                                         LINE TO BE VERIFIED    Y02072 66298402
         EJECT                                                          66298802
         IGGSCW                                                  Y02072 66299202
         EJECT                                                          66299602
         IHAFCAUD  ORG=YES                                       YM4697 66299702
         EJECT                                                          66299802
*                                                                       66300020
*********************************************************************** 66400020
*                                                                       66500020
SRT      DSECT                                                          66600020
         IEFUCBOB                                                       66700020
*                                                                       66800020
*********************************************************************** 66900020
*                                                                       67000020
*   DATA EXTENT BLOCK  (UNTIL PROTIOS CHANGES)                          67100020
DEB      DSECT                                                          67200020
DEBNMSUB DS    0CL1                                                     67300020
DEBTCBAD DS    CL4                                                      67400020
DEBAMLNG DS    0CL1                                                     67500020
DEBDEBAD DS    CL4                                                      67600020
DEBOFLGS DS    0CL1                                                     67700020
DEBIRBAD DS    CL4                                                      67800020
DEBOPATB DS    0CL1                                                     67900020
DEBSYSPG DS    CL4                                                      68000020
DEBNMEXT DS    0CL1                                                     68100020
DEBUSRPG DS    CL4                                                      68200020
DEBPRIOR DS    0CL1                                                     68300020
DEBECBAD DS    CL4                                                      68400020
DEBPROTG DS    0CL1                                                     68500020
DEBDEBID DS    0CL1                                                     68600020
DEBDCBAD DS    CL4                                                      68700020
DEBEXSCL DS    0CL1                                                     68800020
DEBAPPAD DS    CL4                                                      68900020
DEBDVMOD DS    0CL1                                                     69000020
DEBUCBAD DS    CL4                                                      69100020
DEBTVLSQ DS    0CL2                VOL SEQ FOR TAPE                     69200020
DEBBINUM DS    CL2                                                      69300020
DEBTVLNM DS    0CL2                NO OF VOL FOR TAPE                   69400020
DEBSTRCC DS    CL2                                                      69500020
DEBSTRHH DS    CL2                                                      69600020
DEBENDCC DS    CL2                                                      69700020
DEBENDHH DS    CL2                                                      69800020
DEBNMTRK DS    CL2                                                      69900020
*  FOR ADDITIONAL EXTENT ON DIRECT ACCESS THE FOLLOWING FIELDS          70000020
*  WILL HAVE TO BE OFFSET ANOTHER 16 BYTES                              70100020
DEBVOLSQ DS    H                                                        70200020
DEBVOLNM DS    H                                                        70300020
*  FOR EACH SUBROUTINE LOADED BUMP THIS OFFSET BY 2                     70400020
DEBSUBID DS    H                                                        70500020
         END                                                            70900020
