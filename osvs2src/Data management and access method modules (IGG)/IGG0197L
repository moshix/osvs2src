         TITLE 'IGG0197L-TRANSLATES OMR OR RCE FORMAT CD--3505/3525'    00050000
         START                                                          00100000
IGG0197L CSECT                                                          00150000
*********************************************************************** 00200000
* AOS1 AND AOS2 ADDITIONS/CHANGES/DELETIONS                      Y01898 00250000
*D208000,C285000,C376500,C377000,C377500-377700                @ZA01942 00300000
*A137000                                                          M1865 00350000
*                                                                       00400000
*NAME--              IGG0197L                                           00450000
*                                                                       00500000
*TITLE--            'IGG0197L' - OMR OR RCE FORMAT CARD TRANSLATOR      00550000
*                                                                       00600000
*STATUS CHANGE LEVEL 000                                                00650000
*                    THIS MODULE WAS PUT INTO 'OS' RELEASE 21.0 AS A    00700000
*                    NEW MODULE                                         00750000
*                                                                       00800000
*MODULE TYPE--       OPEN - STAGE 1                                     00850000
*                                                                       00900000
*FUNCTION/OPERATION--THIS ROUTINE IS ENTERED FOR SAM USERS DURING       00950000
*                    OPEN WHEN:                                         01000000
*                             -OMR OR RCE IS SPECIFIED FOR 3505 CARD    01050000
*                             READER.                                   01100000
*                             RCE IS SPECIFIED FOR A 3525 CARD          01150000
*                             PUNCH'S READ ONLY FILE.                   01200000
*                    IT TRANSLATES THE FORMAT CARD AND ISSUES AN        01250000
*                    OMR OR RCE COMMAND TO THE DEVICE TO PUT IT IN      01300000
*                    THE PROPER (OMR OR RCE) MODE.                      01350000
*                                                                       01400000
*ENTRY POINT--       ENTERED FROM IGG0196B BY USE OF THE XCTL MACRO     01450000
*                                                                       01500000
*INPUT--             SEE DESCRIPTION OF REGISTERS                       01550000
*                                                                       01600000
*OUTPUT--            SEE DESCRIPTION OF REGISTERS                       01650000
*                                                                       01700000
*EXTERNAL ROUTINES-- NONE                                               01750000
*                                                                       01800000
*EXITS NORMAL--      XCTL TO IGG0197M TO CONTINUE PROCESSING            01850000
*                                                                       01900000
*EXITS ERROR--       XCTL TO IGG0197M IF FORMAT CARD IS INVALID OR      01950000
*                    IF OMR HAS BEEN SPECIFIED FOR 3525 CARD PUNCH      02000000
*                                                                       02050000
*TABLES/WORKAREAS--  WHERE-TO-GO TABLE                                  02100000
*                    BYTES  0- 7   NAME                                 02150000
*                    BYTES  8-10   RELATIVE DISK ADDRESS(TTR) OF        02200000
*                                  FIRST RECORD                         02250000
*                    BYTE     11   CONCATENATION NUMBER                 02300000
*                    BYTE     12   ZEROES                               02350000
*                    BYTE     13   ALIAS INDICATOR AND USER DATA        02400000
*                                  FIELD DESCRIPTOR:                    02450000
*                                      -ALIAS INDICATOR-- 1 BIT         02500000
*                                      -NUMBER OF TTRS IN USERS         02550000
*                                      DATA FIELD-- 2 BITS              02600000
*                    BYTES 14-16   TTR OF FIRST TEXT RECORD             02650000
*                    BYTE     17   ZEROES                               02700000
*                    BYTES 18-19   TTR OF NOTE LIST OR SCATTER LIST     02750000
*                    BYTE     20   TRANSLATION TABLE                    02800000
*                    BYTE     21   ZEROES OR NUMBER OF ENTRIES IN       02850000
*                                  THE NOTE LIST                        02900000
*                    BYTES 22-23   ATTRIBUTES                           02950000
*                    BYTES 24-26   TOTAL CONTIGUOUS MAIN STORAGE        03000000
*                                  REQUIRED FOR MODULE                  03050000
*                    BYTES 27-28   LENGTH OF FIRST TEXT RECORD          03100000
*                    BYTE     29   LENGTH OF WTG TABLE(IN DOUBLE        03150000
*                                  WORDS)                               03200000
*                    BYTES 30-31   PATH THROUGH LOADS OF ROUTINES       03250000
*                    BYTES 32-34   IDTTR OF EXECUTOR FOR FIRST DCB      03300000
*                    BYTE     35   ADDRESS OF STORAGE FOR DCB           03350000
*                    BYTES 36-39   TABLE OF IDTTR'S                     03400000
*                    BYTE  32+N(8)--                                    03450000
*                            IDTTR OF EXECUTOR FOR NTH DCB (3 BYTES)    03500000
*                            ADDRESS OF STORAGE FOR DCB    (1 BYTE )    03550000
*                            IDTTR OF LAST ROUTINE LOAD    (3 BYTES)    03600000
*                            NOT USED                      (1 BYTE )    03650000
*                    --------------                                     03700000
*                    WORKAREA-     SEE 'FORCORE DSECT'(IECDSECT)        03750000
*                                  IN THIS LISTING.                     03800000
*                                                                       03850000
*ATTRIBUTES--        REENTRANT AND REUSABLE.                            03900000
*                                                                       03950000
*********************************************************************** 04000000
*********************************************************************** 04050000
*                        REGISTER  CONVENTIONS                          04100000
*********************************************************************** 04150000
*                                                                       04200000
RDCB     EQU   2                       DCB REGISTER                     04250000
RBASE    EQU   3                       BASE REGISTER                    04300000
RCORE    EQU   4                       DCB WORK AREA REGISTER           04350000
RPAR     EQU   5                       TOP OF PARAMETER LIST            04400000
RWTG     EQU   6                       TOP OF WHERE-TO-GO (WTG) TABLE   04450000
RPARC    EQU   7                       CURRENT PARAMETER                04500000
RWTGC    EQU   8                       CURRENT TRANS LOAD               04550000
RTIOT    EQU   9                       USED HERE AS WORK REGISTER       04600000
RUCB     EQU   10                      USED HERE AS WORK REGISTER       04650000
RDEB     EQU   11                      USED HERE AS FORMAT CARD POINTER 04700000
RB       EQU   12                      USED HERE AS WRK/SWITCH REGISTER 04750000
RC       EQU   13                      WORK REGISTER                    04800000
RD       EQU   14                      WORK REGISTER                    04850000
RJ       EQU   15                      WORK REGISTER                    04900000
RE       EQU   0                       WORK REGISTER                    04950000
RF       EQU   1                       WORK REGISTER                    05000000
*********************************************************************** 05050000
*                        DISPLACEMENTS AND MASKS                        05100000
*********************************************************************** 05150000
*                                                                       05200000
RCE      EQU   X'10'                                                    05250000
OMR      EQU   X'20'                                                    05300000
P3525    EQU   X'4C'                                                    05350000
R3505    EQU   X'46'                                                    05400000
FDSS     EQU   X'23'                    FEED SS COMMAND                 05450000
OMRCEFSS EQU   X'2B'                    FEED SS CMD WITH OMR/RCE FLAG   05500000
RDONLY   EQU   X'C2'                                                    05550000
OMRCMD   EQU   X'31'                                                    05600000
RCECMD   EQU   X'11'                                                    05650000
UNRELFLG EQU   X'02'                                                    05700000
SLI      EQU   X'20'                                                    05750000
BYTCNT80 EQU   X'50'                                                    05800000
FIVE     EQU   5                                                        05850000
FOUR     EQU   X'04'                                                    05900000
THRE     EQU   X'03'                                                    05950000
TWO      EQU   X'02'                                                    06000000
ONE      EQU   X'01'                                                    06050000
Z        EQU   X'E9'                                                    06100000
SUCCFLCC EQU   X'7F'                                                    06150000
NINE     EQU   X'09'                                                    06200000
EIGHT    EQU   X'08'                                                    06250000
TWELVE   EQU   X'0C'                                                    06300000
SEVENTY1 EQU   X'47'                                                    06350000
SIXTY8   EQU   X'44'                                                    06400000
BLANK    EQU   X'40'                                                    06450000
LFTPAREN EQU   X'4D'                                                    06500000
RGTPAREN EQU   X'5D'                                                    06550000
COMMA    EQU   X'6B'                                                    06600000
ZERO     EQU   X'00'                                                    06650000
SEVEN    EQU   X'07'                                                    06700000
TEN      EQU   10                                                       06750000
D72      EQU   72                                                       06800000
F9       EQU   X'F9'                                                    06850000
F0       EQU   X'F0'                                                    06900000
D15      EQU   15                                                       06950000
D80      EQU   80                                                       07000000
D71      EQU   71                                                       07050000
SIX      EQU   6                                                        07100000
D14      EQU   14                                                       07150000
*                                                                       07200000
**                                                                      07250000
***                                                                     07300000
**                                                                      07350000
*                                                                       07400000
         BALR  RBASE,RE                LOAD BASE ADDR IN BASE REG       07450000
         USING RCE1000,RBASE                                            07500000
         USING FORCORE,RCORE                                            07550000
         USING IHADCB,RDCB                                              07600000
RCE1000  EQU   *                                                        07650000
         L     RDCB,0(RPARC)           GET DCB ADDRESS                  07700000
         L     RCORE,FOUR(RWTGC)       GET WORK AREA ADDRESS            07750000
         MVC   DSCEXT1+NINE(EIGHT),DXDEBAPP SET UP FOR WORK AREA FIRST  07800000
         MVC   DSCEXT2+SEVEN(EIGHT),DXDEBSCC USAGE. SAVE CONTENTS       07850000
         ST    RPAR,DXDEBAPP           SAVE PARAMETER LIST              07900000
         XC    DXLBL(80),DXLBL          BLANK TRANSLATION AREA    M1865 07950000
*                                                                       08000000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08050000
*                                                                     * 08100000
*                                 BUILD IOB AND CCW                   * 08150000
*                                                                     * 08200000
         ST    RDCB,IOBWGHT            PUT DCB ADDR IN WORK IOB         08250000
         TM    DCBMODE,RCE             RCE SPECIFIED FOR THIS DEVICE    08300000
         BO    RCE1100                 YES, BRANCH                      08350000
         TM    DCBMODE,OMR             OMR SPECIFIED FOR THIS DEVICE    08400000
         BNO   RCE4300                 NO, BRANCH TO TRANSFER CONTROL   08450000
         TM    DCBDEVT,P3525           3525 CARD PUNCH DEVICE           08500000
         BO    RCE4500                 YES, BRANCH                      08550000
RCE1100  EQU   *                                                        08600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08650000
*        SET UP SWITCH (RB) TO DETERMINE OPERATION TO BE PERFORMED      08700000
*             SWITCH(RB)                                                08750000
*                  0    FIRST FORMAT CARD JUST READ                     08800000
*                  1    READ ONLY CMD MUST BE ISSUED NOW                08850000
*                  2    TRANSLATION OF FORMAT CARD(S) COMPLETE          08900000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08950000
         SR    RB,RB                   SET FIRST FORMAT CD SWITCH TO 0  09000000
RCE1200  EQU   *                                                        09050000
         MVI   DXCCW1,RDONLY           SET READ ONLY CMD IN CCW         09100000
RCE1250  EQU   *                                                        09150000
         LA    RF,DXCCW2               GET DATA ADDRESS FOR CCW         09200000
RCE1300  EQU   *                                                        09250000
         ST    RF,DXDEBUCB             PREPARE DATA ADR FOR CCW STORAGE 09300000
         MVC   DXCCW1+ONE(THRE),DXDEBUCB+ONE  PUT DATA ADDR IN CCW      09350000
         MVI   DXCCW1+FOUR,SLI         TURN ON SLI BIT IN CCW           09400000
         MVI   DXCCW1+SEVEN,BYTCNT80   SET BYTE COUNT TO 80 IN CCW      09450000
*                                                                     * 09500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 09550000
         LA    RF,IOBFLAG1             GET IOB ADDRESS                  09600000
         EXCP  (1)                     EXECUTE CHANNEL PROGRAM          09650000
         LA    RF,DXECB                GET ECB ADDRESS FOR WAIT         09700000
         WAIT  ECB=(1)                                                  09750000
         TM    DXECB,SUCCFLCC          SUCCESSFUL COMPLETION (X'7F')    09800000
         BNO   RCE4500                 NO, BRANCH                       09850000
         XC    DXECB(FOUR),DXECB       ZERO OUT ECB AREA                09900000
         LA    RF,TWO                  SET MASK FOR TEST                09950000
         CLR   RB,RF                   IS TRANSLATION COMPLETE          10000000
         BE    RCE4300                 YES, BRANCH TO TRANSFER CONTROL  10050000
         TM    DXCCW1,FDSS             FEED, SS CMD                     10100000
         BO    RCE1200                 YES, GO BACK AN DO A RD ONLY CMD 10150000
         TM    DXCCW1,RDONLY           IS THIS A READ ONLY COMMAND      10200000
         BO    RCE1400                 YES,BRANCH                       10250000
         LA    RB,TWO                  SET TRANSLATION COMPLETE SWITCH  10300000
         MVI   DXCCW1,OMRCEFSS          SET TRANSLATION COMPLETE FLAG   10350000
         B     RCE1250                 BRANCH                           10400000
RCE1400  EQU   *                                                        10450000
         LTR   RB,RB                   SWITCH EQUALS ZERO               10500000
         BC    7,RCE3100               NO, BRANCH                       10550000
RCE1500  EQU   *                                                        10600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10650000
*        CHECK FIRST NINE COLUMNS OF FIRST FORMAT CARD FOR VALIDITY     10700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10750000
         CLC   DXCCW2(NINE),MYFRMT     ARE FIRST 9 COL. OF FORMAT VALID 10800000
         BNE   RCE4500                 NO, BRANCH                       10850000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10900000
*        'COLUMN NUMBER' COUNTER (RC) SPECIFIES THE COLUMN THAT IS      10950000
*        CURRENTLY BEING DIAGNOSED ON THE USER'S FORMAT CARD.           11000000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 11050000
         LA    RC,TEN                  COLUMN NUMBER COUNTER            11100000
         LA    RDEB,DXCCW2+NINE        POINT TO FIRST DIGIT OF OPERAND  11150000
         SR    RD,RD                   ZERO OUT WORK REGISTER           11200000
RCE1600  EQU   *                                                        11250000
         L     RPAR,F000               SET UP FOR FIRST FORMAT COL. NO. 11300000
         LR    RJ,RPAR                 SET UP FOR NEXT FORMAT COL. NO.  11350000
RCE1650  EQU   *                                                        11400000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 11450000
*        IF THE 'COLUMN NUMBER' COUNTER IS POINTING AT COLUMN72 AND     11500000
*        A CONTINUATION MARK IS IN COLUMN 72, THEN SAVE LAST 3 CHARS    11550000
*        OF CARD FOR HELP IN DIAGNOSING THE NEXT CARD.                  11600000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 11650000
         LA    RUCB,D72                LOAD NUMBER FOR COMPARE          11700000
         CLR   RC,RUCB                 IS COLUMN 72 BEING POINTED TO    11750000
         BL    RCE1700                 NO, BRANCH TO TRANSLATE COLUMN   11800000
         CLI   DXCCW2+SEVENTY1,BLANK   CONTINUATION MARK IN COL. 72     11850000
         BE    RCE1700                 NO, BRANCH TO TRANSLATE NEXT COL 11900000
         MVC   JFCBXPDT(THRE),DXCCW2+SIXTY8  SAVE LAST 3 BYTES OF CARD  11950000
RCE1680  EQU   *                                                        12000000
         LA    RB,ONE                  SET SWITCH TO ONE                12050000
         MVI   DXCCW1,FDSS             SET FD,SS CMD IN CCW             12100000
         ST    RJ,DXDEBEHH             SAVE LAST NUMBER OF OPERAND      12150000
         B     RCE1250                 BRANCH                           12200000
RCE1700  EQU   *                                                        12250000
         SR    RUCB,RUCB               ZERO OUT WORK REGISTER           12300000
         IC    RUCB,0(RDEB)            GET CHAR POINTED TO ON FORMAT CD 12350000
RCE1800  EQU   *                                                        12400000
         LA    RE,F9                   LOAD MASK TO CK FOR VALID CHAR   12450000
         CLR   RUCB,RE                 IS CHAR GREATER THAN A NUMBER    12500000
         BH    RCE4500                 YES, BRANCH                      12550000
         LR    RTIOT,RDEB              GET FORMAT POINTER               12600000
         LA    RE,TWO                  GET A VALUE OF 2                 12650000
         SR    RTIOT,RE                POINT BACK 2 COL. ON FORMAT CD   12700000
MOVE     MVC   DXDEBECC(FOUR),ZERO(RTIOT)  GET 4 CHAR OF FORMAT FOR TST 12750000
         LA    RF,F0                   GET MASK TO CK FOR SPECIAL CHAR  12800000
         CLR   RUCB,RF                 IS THIS CHAR A NUMBER            12850000
         BL    RCE2600                 NO, BR.--MUST BE SPECIAL CHAR    12900000
RCE1900  EQU   *                                                        12950000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 13000000
*        CONTINUE INTERROGATION OF OPERAND AND SAVE FIRST NUMBER        13050000
*        OF OPERAND IN REG. 5 (RPAR) AND LAST NUMBER IN REG.15 (RJ)     13100000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 13150000
         CLI   DXDEBECC+ONE,LFTPAREN   IS LEFT PAREN IN THIS FORMAT COL 13200000
         BNE   RCE2200                 NO, BRANCH                       13250000
         CLI   DXDEBECC+THRE,COMMA     COMMA IN THIS FORMAT COLUMN      13300000
         BNE   RCE2100                 NO, BRANCH                       13350000
RCE2000  EQU   *                                                        13400000
         IC    RPAR,ZERO(RDEB)         SAVE CHAR BEING POINTED TO       13450000
         LA    RDEB,TWO(RDEB)          INCRE FORMAT SEARCH ADDR. BY 2   13500000
         LA    RC,TWO(RC)              INCRE 'COLUMN NO.' COUNTER BY 2  13550000
         B     RCE1650                 BRANCH TO CHECK NEXT COLUMN      13600000
RCE2100  EQU   *                                                        13650000
         SR    RPAR,RPAR               ZERO OUT REGISTER                13700000
         IC    RPAR,ZERO(RDEB)         SAVE CHAR BEING POINTED TO       13750000
         SLA   RPAR,8                  PREPARE FOR SECOND DIGIT OF NO.  13800000
RCE2150  EQU   *                                                        13850000
         LA    RDEB,ONE(RDEB)          INCRE FORMAT SEARCH ADDR. BY 1   13900000
         LA    RC,ONE(RC)              INCRE 'COLUMN NO.' COUNTER BY 1  13950000
         B     RCE1650                 BRANCH TO CHECK NEXT COLUMN      14000000
RCE2200  EQU   *                                                        14050000
         CLI   DXDEBECC,LFTPAREN       LEFT PAREN IN THIS FORMAT COLUMN 14100000
         BE    RCE2000                 YES, BRANCH                      14150000
         CLI   DXDEBECC+ONE,COMMA      COMMA IN THIS FORMAT COLUMN      14200000
         BNE   RCE4450                  NO BRANCH                       14250000
         CLI   DXDEBECC+THRE,RGTPAREN  RGT. PAREN IN THIS FORMAT COLUMN 14300000
         BNE   RCE2400                 NO, BRANCH                       14350000
RCE2300  EQU   *                                                        14400000
         IC    RJ,ZERO(RDEB)           GET NUMBER BEING POINTED TO      14450000
         LA    RDEB,TWO(RDEB)          INCRE FORMAT CARD POINTER BY 2   14500000
         LA    RC,TWO(RC)              INCRE 'COLUMN NO.' COUNTER BY 2  14550000
         CLI   ZERO(RDEB),BLANK        IS FORMAT COMPLETED YET          14600000
         BE    RCE3350                  YES GO CK COLUMN 72             14650000
RCE2350  EQU   *                                                        14700000
         CLI   ZERO(RDEB),COMMA        IS THERE STILL ANOTHER OPERAND   14750000
         BNE   RCE2375                 NO, BRANCH                       14800000
         CLI   ONE(RDEB),BLANK         IS NEXT COLUMN BLANK             14850000
         BNE   RCE3400                 NO, BRANCH                       14900000
RCE2375  EQU   *                                                        14950000
         CLI   DXCCW2+SEVENTY1,BLANK   IS COLUMN 72 BLANK               15000000
         BE    RCE4500                 YES, BRANCH                      15050000
         B     RCE3400                 BRANCH TO PROCESS THIS OPERAND   15100000
RCE2400  EQU   *                                                        15150000
         SR    RJ,RJ                   ZERO OUT REG. 15                 15200000
         IC    RJ,ZERO(RDEB)           GET NUMBER BEING POINTED TO      15250000
         SLA   RJ,8                    PREPARE FOR SECOND DIGIT OF NO.  15300000
         B     RCE2150                 BRANCH TO GET SECOND DIGIT       15350000
RCE2600  EQU   *                                                        15400000
         CLI   DXDEBECC+TWO,COMMA      COMMA IN THIS COLUMN             15450000
         BE    RCE2800                  YES BRANCH                      15500000
         CLI   DXDEBECC+TWO,RGTPAREN   RIGHT PAREN IN THIS COLUMN       15550000
         BNE   RCE2950                  NO BRANCH                       15600000
         CLI   DXDEBECC+THRE,BLANK     END OF FORMAT CARD               15650000
         BE    SETEXCP                 YES GO SET UP OMR/RCE CCW        15700000
         B     RCE2150                 BRANCH                           15750000
*                                                                       15800000
RCE2800  EQU   *                                                        15850000
*                                                                       15900000
*                                                                       15950000
         CLI   DXDEBECC+ONE,RGTPAREN    RIGHT PAREN IN THIS COLUMN      16000000
         BE    RCE2150                  GO INCREMENT COUNTERS BY ONE    16050000
RCE2900  EQU   *                                                        16100000
         CLI   DXDEBECC+ONE,LFTPAREN   LEFT PAREN IN THIS COLUMN        16150000
         BE    RCE4500                 YES, BRANCH                      16200000
         B     RCE2150                 NO, BRANCH                       16250000
RCE2950  EQU   *                                                        16300000
*                                                                       16350000
*                                                                       16400000
         CLI   ZERO(RDEB),LFTPAREN      LEFT PAREN IN THIS COLUMN       16450000
         BE    RCE2150                  YES BRANCH                      16500000
         CLI   ZERO(RDEB),BLANK         BLANK IN THIS COLUMN            16550000
         BNE   RCE4500                  NO GO SET UP TO ABEND           16600000
RCE3000  EQU   *                                                        16650000
         CLI   DXCCW2+SEVENTY1,BLANK   COLUMN 72 BLANK                  16700000
         BE    SETEXCP                 YES, GO TO SET UP OMR/RCE CCW    16750000
         LA    RUCB,THRE               LOAD VALUE OF 3 IN WORK REGISTER 16800000
         SR    RDEB,RUCB               PT. BACK 3 COL. ON FORMAT CARD   16850000
         MVC   JFCBXPDT(THRE),ZERO(RDEB)  SAVE LAST 3 CHAR OF THIS CD.  16900000
         B     RCE1680                 BRANCH                           16950000
RCE3100  EQU   *                                                        17000000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 17050000
*        TEST FIRST 15 COLUMNS OF CONTINUATION CARDS.  IF OTHER THAN    17100000
*        BLANK(X'40'), THE FORMAT IS INVALID.  IF COLUMNS ARE BLANK     17150000
*        THEN MOVE INTO COLUMNS 13,14 AND 15 OF THIS FORMAT CARD        17200000
*        THE 3 CHARS. SAVED FROM PREVIOUS CARD.                         17250000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 17300000
         LA    RC,ONE                  SET REGISTER TO ONE              17350000
         LA    RDEB,DXCCW2                                              17400000
         LA    RUCB,D15                SET UP TO TEST 1ST 15 COL. OF CD 17450000
RCE3200  EQU   *                                                        17500000
         CLI   ZERO(RDEB),BLANK        IS THIS COL. OF FORMAT CD BLANK  17550000
         BNE   RCE4500                 NO, BRANCH                       17600000
         CLR   RC,RUCB                 POINTING AT COL. 15 YET          17650000
         BL    RCE3300                 NO, BRANCH                       17700000
         MVC   DXCCW2+TWELVE(THRE),JFCBXPDT  PUT SAVED CHARS. IN 13-15  17750000
         L     RJ,DXDEBEHH             RELOAD LAST NUMBER               17800000
         B     RCE2150                 BRANCH                           17850000
RCE3300  EQU   *                                                        17900000
         LA    RDEB,ONE(RDEB)          INCRE FORMAT POINTER BY 1        17950000
         LA    RC,ONE(RC)              INCREMENT COUNTER BY ONE         18000000
         B     RCE3200                 BR TO CHECK FOR BLANK COLUMN     18050000
RCE3350  EQU   *                                                        18100000
*                                                                       18150000
*                                                                       18200000
         CLI   DXCCW2+SEVENTY1,BLANK    IS COLUMN 72 BLANK              18250000
         BE    RCE3400                  IF SO GO CONVERT IT TO BINARY   18300000
         LA    RUCB,D72                SET UP TO TEST FOR COLUMN 72     18350000
         CLR   RC,RUCB                  IS THIS COLUMN 72 OR LOWER      18400000
         BNH   RCE4500                  IN NOT GO SET UP TO ABEND       18450000
RCE3400  EQU   *                       IS NO. SAVED FROM LAST OPERAND   18500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18550000
*        TEST LAST NO. OF PREVIOUS OPERAND AGAINST FIRST NO. OF         18600000
*        CURRENT OPERAND.  IF LAST NO. IS LESS THAN FIRST NO., THE      18650000
*        FORMAT IS INVALID.                                             18700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18750000
         CLR   RD,RPAR                 IS PRIVIOUS LAST NUMBER          18800000
*                                      < CURRENT FIRST NUMBER           18850000
         BNL   RCE4500                 IF NO THEN BRANCH                18900000
         CLR   RPAR,RJ                 IS CURRENT FIRST NUMBER @ZA01942 18950000
*                                      <= CUREENT LAST NUMBER  @ZA01942 19000000
         BH    RCE4500                 IF NO THEN BRANCH TO    @ZA01942 19050000
*                                      ABEND                   @ZA01942 19100000
         STH   RPAR,DXDEBSHH           GET FIRST NUMBER OF OPERAND      19150000
EXPACK   PACK  DXCCW12(EIGHT),DXDEBSHH(TWO) PACK THE NUMBER             19200000
         CVB   RPAR,DXCCW12            PUT NO. IN ARITHMETIC FORM       19250000
         ST    RJ,DXDEBEHH             GET LAST NUMBER  OF OPERAND      19300000
         PACK  DXCCW12(EIGHT),DXDEBEHH(FOUR)     PACK THE NUMBER        19350000
         CVB   RJ,DXCCW12              PUT NO. IN ARITHMETIC FORM       19400000
         LTR   RD,RD                   IS THIS THE FIRST FORMAT OPERAND 19450000
         BZ    EEEE                    YES, BRANCH                      19500000
         STH   RD,DXDEBSHH             GET NO. SAVED FROM LAST OPERAND  19550000
         EX    RE,EXPACK               GO TO PACK THE NUMBER            19600000
         CVB   RD,DXCCW12              PUT NO. IN ARITHMETIC FORM       19650000
EEEE     EQU   *                                                        19700000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19750000
*        IF NUMBER IS GREATER THAN 80 OR EQUAL TO 0, THEN THE FORMAT    19800000
*        IS INVALID.                                                    19850000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19900000
         LA    RTIOT,D80               SET WORK REG TO 80               19950000
         CLR   RPAR,RTIOT              IS FIRST NO. MORE THAN 80        20000000
         BH    RCE4500                 YES, BRANCH                      20050000
         CLR   RJ,RTIOT                IS LAST FIELD OF OPERAND > 80    20100000
         BH    RCE4500                 YES, BRANCH                      20150000
         LTR   RPAR,RPAR               IS FIRST NO. = 0                 20200000
         BZ    RCE4500                 YES, BRANCH                      20250000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20300000
*        FOR VALID USE OF OMR, THE DIFFERENCE BETWEEN THE LAST NO.      20350000
*        OF THE PREVIOUS OPERAND AND FIRST NO. OF CURRENT OPERAND       20400000
*        MUST EQUAL TO 2 OR MORE.                                       20450000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20500000
         TM    DCBMODE,OMR             OMR SPECIFIED                    20550000
         BNO   RCE3600                 NO, BRANCH                       20600000
         LTR   RD,RD                   IS THIS THE 1ST COMPLETE OPERAND 20650000
         BC    8,RCE3500               YES, BRANCH                      20700000
         LA    RD,TWO(RD)              INCREMENT SAVED NUMBER BY 2      20750000
         SR    RD,RPAR                 SUB. 1ST NO. OF CURR OPERAND TO  20800000
         LTR   RD,RD                   VALID SPACE PROVIDED FOR OMR USE 20850000
         BP    RCE4500                 NO, BRANCH                       20900000
RCE3500  EQU   *                                                        20950000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21000000
*        IF THE  TWO NUMBERS OF THIS OPERAND ARE NOT BOTH EVEN OR       21050000
*        BOTH ODD, THEN THE FORMAT IS INVALID FOR OMR.                  21100000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21150000
         STH   RC,DXDEBSCC                                              21200000
         SR    RB,RB                                                    21250000
         LR    RC,RPAR                 LOAD FIRST NO. OF OPERAND IN R13 21300000
         LA    RUCB,TWO                SET DIVISOR TO TWO               21350000
         DR    RB,RUCB                 DIVIDE FIRST NO. TO GET REMAINDR 21400000
         LR    RTIOT,RB                SAVE REMAINDER FOR NEXT TEST     21450000
         SR    RB,RB                                                    21500000
         LR    RC,RJ                   PUT LAST NO. OF OPERAND IN REG13 21550000
         DR    RB,RUCB                 DIVIDE LAST NO. TO GET REMAINDER 21600000
         CLR   RB,RTIOT                ARE BOTH NO. EITHER EVEN OR ODD  21650000
         BNE   RCE4500                 NO, BRANCH                       21700000
         SR    RC,RC                                                    21750000
         LH    RC,DXDEBSCC                                              21800000
RCE3600  EQU   *                                                        21850000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21900000
*        BUILD FORMAT TRANSLATION FOR THE DEVICE AS FOLLOWS:  PLACE     21950000
*        CHARACTER IN EACH OMR OR RCE COLUMN AS SPECIFIED VIA THE       22000000
*        USER'S FORMAT CARD(S).                                         22050000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 22100000
         LA    RB,DXLBL                GET @ OF AREA USED FOR TRANSLATN 22150000
         LA    RUCB,ONE                SET WORK REG TO 1                22200000
         SR    RB,RUCB                                                  22250000
         AR    RB,RPAR                 POINT TO COL. SPEC. ON FORMAT CD 22300000
         TM    DCBMODE,OMR             OMR SPECIFIED                    22350000
         BNO   RCE3700                 NO, RCE ASSUMED, BRANCH          22400000
         LA    RUCB,TWO                SET WORK REG TO 2                22450000
RCE3700  EQU   *                                                        22500000
         MVI   ZERO(RB),Z              PUT CHAR IN COL. TO BE RD IN OMR 22550000
         CLR   RPAR,RJ                 HAVE CHAR BEEN PLACED IN ALL COL 22600000
         BE    RCE3900                 YES, BRANCH                      22650000
         AR    RPAR,RUCB               POINT TO NEXT FORMAT COLUMN      22700000
         AR    RB,RUCB                 INCREMENT FORMAT AREA ADDRESS    22750000
         B     RCE3700                 BR TO PLACE CHAR IN THIS COLUMN  22800000
RCE3900  EQU   *                                                        22850000
         L     RD,DXDEBEHH             SAVE LAST NO. IN THIS OPERAND    22900000
         LA    RUCB,D80                SET UP TO TEST FOR FORMAT CD IND 22950000
         CLR   RJ,RUCB                 LAST NUMBER = 80                 23000000
         BNE   RCE1600                 NO, BRANCH                       23050000
         CLI   ZERO(RDEB),BLANK        IS NEXT COL OF FORMAT CARD BLANK 23100000
         BNE   RCE4500                 NO, BRANCH                       23150000
         CLI   DXCCW2+SEVENTY1,BLANK   YES, THEN IS CONTINUATION SPEC   23200000
         BNE   RCE4500                  YES BRANCH TO ABEND             23250000
SETEXCP  EQU   *                                                        23300000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 23350000
*        LOAD PROPER OP CODE (X'11' FOR RCE OR X'31' FOR OMR) AND       23400000
*        DATA ADDRESS INTO CCW.                                         23450000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 23500000
*                                                                       23550000
         MVI   DXCCW1,OMRCMD            SET OMR COMMAND IN CCW          23600000
         TM    DCBMODE,OMR             OMR SPECIFIED                    23650000
         BO    RCE4200                  BRANCH TO PUT DATA ADDR. IN CCW 23700000
         MVI   DXCCW1,RCECMD           SET RCE CMD IN CCW               23750000
RCE4200  EQU   *                                                        23800000
         LA    RF,DXLBL                GET DATA ADDRESS                 23850000
         B     RCE1300                 BR TO CONTINUE CONSTRUCTION CCW  23900000
RCE4300  EQU   *                                                        23950000
         SR    RB,RB                    SET ENTRY FOR BUFFER CHECKING   24000000
         B     RCE4600                  GO LOAD ID OF IGG0197M          24050000
RCE4450  EQU   *                                                        24100000
*                                                                       24150000
*                                                                       24200000
         CLI   DXDEBECC,COMMA           COMMA IN THIS COLUMN            24250000
         BNE   RCE4500                  IF NOT GO SET UP TO ABEND       24300000
         CLI   DXDEBECC+THRE,RGTPAREN   RIGHT PAREN IN THIS COLUMN      24350000
         BE    RCE2300                  YES GO INCREMENT COUNTERS       24400000
         LA    RUCB,D71                SET UP TO CHECK FOR COLUMN 71    24450000
         CLR   RC,RUCB                  IS THIS COLUMN 71               24500000
         BE    RCE2300                  IF SO GO INCREMENT COUNTERS     24550000
RCE4500  EQU   *                                                        24600000
         LA    RB,FIVE                 LOAD REG. WITH ERROR PARAMETER   24650000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 24700000
*        GET IDTTRL OF NEXT EXECUTOR FROM WTG TABLE.                    24750000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 24800000
*                                                                       24850000
*                                                                       24900000
RCE4600  EQU   *                                                        24950000
*                                                                       25000000
*                                                                       25050000
         MVC   DXCCW6(1),DCBEROPT      SAVE FOR QSAM           @ZA15324 25100000
         ST    RB,DXCCW11              STORE CODE IN DCB WORK AREA      25150000
*                                                              @ZA10074 25200000
         LA    RF,SOPN7M               GET ID OF NEXT MODULE            25250000
XCTLGOGO EQU   *                                                        25300000
         L     RPAR,DXDEBAPP           RESTORE PARAMETER LIST           25350000
         LA    RJ,DXDCB                                                 25400000
         ST    RJ,IOBWGHT                                               25450000
         MVC   DXDEBAPP(EIGHT),DSCEXT1+NINE RESTORE WORK                25500000
         MVC   DXDEBSCC(EIGHT),DSCEXT2+SEVEN AREA AFTER USAGE           25550000
         MVC   ZERO(FIVE,RWTGC),ZERO(RF)                                25600000
RELOOP   EQU   *                                                        25650000
         LA    RWTGC,WGOFF(ZERO,RWTGC)                                  25700000
         LA    RPARC,PLOFF(ZERO,RPARC)                                  25750000
         CLC   ZERO(TWO,RWTGC),AMIDCNST                                 25800000
         BCR   8,RBASE                 BRANCH IF EQUAL                  25850000
         CLC   ZERO(TWO,RWTGC),OPIDCNST                                 25900000
         BC    7,RELOOP                BRANCH IF NOT EQUAL              25950000
         LR    RPARC,RPAR                                               26000000
         LA    RWTGC,WAOFF(ZERO,RWTG)                                   26050000
ZCHEK    CLI   ZERO(RWTGC),ZERO                                         26100000
         BC    7,TCTLRTN               BRANCH IF NOT EQUAL              26150000
         LA    RWTGC,WGOFF(ZERO,RWTGC)                                  26200000
         LA    RPARC,PLOFF(ZERO,RPARC)                                  26250000
         BC    15,ZCHEK                BRANCH                           26300000
TCTLRTN  EQU   *                                                        26350000
         MVC   SIX(TWO,RWTG),ZERO(RWTGC)                                26400000
         MVC   D14(THRE,RWTG),TWO(RWTGC)                                26450000
         LA    RJ,DXCCW12                                               26500000
         XCTL  DE=(RWTG),SF=(E,(15))                                    26550000
*********************************************************************** 26600000
*                      DECLARE WTG OFFSETS                              26650000
WAOFF    EQU   32                                                       26700000
WGOFF    EQU   8                                                        26750000
PLOFF    EQU   4                                                        26800000
         DS    0F                                                       26850000
F000     DC    XL4'0000F000'           WORK DC TO BE LOADED IN REG      26900000
OPIDCNST DC    C'0S'                   ID                               26950000
AMIDCNST DC    C'7L'                   THIS MODULE'S ID                 27000000
MYFRMT   DC    C' FORMAT ('            FIRST NINE COL. OF FORMAT CD     27050000
*********************************************************************** 27100000
*                                                                       27150000
         ORG   IGG0197L+1008           LEAVE MAINT SPACE AS REQUIRED    27200000
SOPN7M   DC    C'7M    '               IDTTRL                           27250000
         DC    H'0'                    END OF TABLE MARKER              27300000
         DC    F'0'                    PAD TABLE TO DBL WORD BOUNDRY    27350000
         DC    C'019'                  OPEN SVC CODE                    27400000
         DC    AL1(126)                DBL WD CNST TO TOP OF WTG TABLE  27450000
*********************************************************************** 27500000
*                                                                       27550000
*                                   DSECTS                              27600000
*                                                                       27650000
         DCBD  DSORG=PS                                                 27700000
*                                                                       27750000
**                                                                      27800000
***                                                                     27850000
****                                                                    27900000
**                                                                      27950000
***                                                                     28000000
**                                                                      28050000
FORCORE  DSECT                                                          28100000
         IECDSECT                                                       28150000
         END                                                            28200000
