         START                                                          00050037
         TITLE 'IGGO197N FUNC= PARM VERIF AND DEB LOOK AND HOOK UP'     00100037
IGG0197N CSECT                                                          00150037
*********************************************************************** 00200037
*         VS2037 CHANGES                                                00210037
*                                                                       00220037
* D634000-635600,644000,684100-685700                          @YM06152 00250037
* D012000-016000,321000,330000-360000,396000,404000-410000,    @YM05576 00300037
* D428000-432000,440000-444000,635200,684400-685100,917000,    @YM05576 00350037
* D928000-934000                                               @YM05576 00400037
* C026000,030000,314000,418600,434000,446000,484600,504600,    @YM05576 00450037
* C524600,635600,684800,685100,924000,930000,942000            @YM05576 00500037
* A 380300,381300,476500,477300                                @YM05576 00550037
* C 38400000                                                   @ZA10075 00600037
* A 38400002                                                   @ZA10075 00650037
*C195500,199500,201000                                         @ZA00000 00670037
* MODULE NAME = IGG0197N                                                00700037
*                                                                       00750037
* DESCRIPTIVE NAME= IGG0197N-OPEN FOR 3505/3525                         00800037
*                                                                       00850037
*STATUS CHANGE LEVEL-020                                                00900037
*                                                                       00950037
*FUNCTION  THIS EXECUTOR IS ENTERED FOR SAM BSAM AND QSAM USERS OF THE  01000037
*          3505 OR 3525 DURING OPEN-STAGE2 FOR VERIFICATION OF FUNC=    01050037
*          AND RELATED DCB PARAMETERS. ALSO DEB'S FOR 3525 ASSOCIATED   01100037
*          DATA SETS ARE HOOKED VIA AN ADDRESS FIELD TO IT'S            01150037
*          ASSOCIATED DCB'S.                                            01200037
*                                                                       01250037
*  THERE ARE NOW TWO COPIES OF EACH DCB. ONE IS THE REAL, OR   @YM05576 01300037
*  USER DCB, AND ONE IS THE COPY, OR DATA MANAGEMENT DCB. THE  @YM05576 01350037
*  DCB ADDRESS THAT IS PLACED IN THE DEB MUST BE THE USER DCB  @YM05576 01400037
*  ADDRESS.                                                    @YM05576 01450037
*                                                              @YM05576 01500037
*     OPERATION=                                                        01550037
*          THE FUNC= PARAMETER IS CHECKED FOR A VALID FILE TYPE OR      01600037
*          A VALID COMBINATION. THIS PARAMETER IS ALSO CHECKED IN       01650037
*          REFERENCE TO THE DCB MACRF PARAMETER TO INSURE COMPATIBLE    01700037
*          ACCESS METHODS FOR ASSOCIATE DATA SETS AND TO INSURE STACKER 01750037
*          SELECTION VIA CNTRL IS NOT BEING ATTEMPTED FOR AN INPUT      01800037
*          FILE OF AN ASSOCIATED DATA SET.                              01850037
*                                                                       01900037
* NOTES= PATCH-LABEL = ZAPSZAPS                                         01950037
*                                                                       02000037
* MODULE TYPE= PROCESSOR-ASSEM                                          02050037
*              ATTRIBUTES-REENTRANT                                     02100037
*                                                                       02150037
* ENTRY POINT - IGG0197N                                                02200037
*              ENTERED FROM IGG0193I VIA XCTL                           02250037
*                                                                       02300037
* INPUT     DCB ADDRESS                                                 02350037
*          WORK AREA ADDRESS                                            02400037
*          WHERE TO GO TABLE                                            02450037
*          PARAMETER LIST                                               02500037
*          CURRENT ENTRY IN WHERE TO GO TABLE                           02550037
*          CURRENT PARAMETER (DCB)                                      02600037
*                                                                       02650037
*          THE REFERENCED DEB FIELDS ARE AS FOLLOWS                     02700037
* * * * DEB -- UNIT RECORD AND MAGNETIC TAPE SECTION                    02750037
*                                                                       02800037
*   +36 DEBRDCB    FULLWORD CONTAINING DEBRDCBA POINTER                 02850037
*   +37 DEBRDCBA   ADDRESS OF DCB FOR THE READ ASSOCIATED DATA SET      02900037
*   +40 DEBPDCB    FULLWORD CONTAINING DEBPDCBA POINTER                 02950037
*   +41 DEBPDCBA   ADDRESS OF DCB FOR THE PUNCH ASSOCIATED DATA SET     03000037
*   +44 DEBWDCB    FULLWORD CONTAINING DEBWDCBA POINTER                 03050037
*   +45 DEBWDCBA   ADDRESS OF DCB FOR THE PRINT ASSOCIATED DATA SET     03100037
*                                                                       03150037
*                                                                       03200037
*EXITS --- NORMAL                                                       03250037
*          1 IF NO DEVICE ASSOCIATED DATA SET AND NO FEATURES (OMR,RCE  03300037
*            OR PRINT) SPECIFIED FOR THE 3505 OR 3525 EXIT WILL BE      03350037
*            TO IGG0191G                                                03400037
*                                                                       03450037
*          2.IF A FEATURE OR ASSOCIATED DATA SETS ARE SPECIFIED, AS     03500037
*            STATED ABOVE,EXIT WILL BE TO IGG0197P.                     03550037
*     OUTPUT=                                                           03600037
*          THE ADDRESS OF ANY OPENED ASSOCIATED DATA IS PLACED IN THE   03650037
*          CURRENT DCB'S DEB ALSO THE ADDRESS OF THE CURRENT DCB IS     03700037
*          PLACED IN THE DEB OR DEB'S OF ANY OTHER ASSOCIATED DATA SET  03750037
*          WHICH HAS BEEN OPENED                                        03800037
*                                                                       03850037
* EXIT - ERROR=        004 ABEND,REG 15 WILL HAVE A RETURN CODE OF      03900037
*                      1,2,3 OR 4 WITH THE FOLLOWING MEANINGS.          03950037
*                                                                       04000037
*                      1 INDICATES INVALID DCBFUNC PARAMETERS           04050037
*                      2 INDICATES INVALID FUNC/CNTRL COMBINATION       04100037
*                      3 INDICATES CONFLICTING ASSOCIATED DATA SET      04150037
*                        ACCESS METHODS                                 04200037
*                      4 INDICATES INVALID DCB FOR A 3505 OR 3525       04250037
*                                                                       04300037
* EXTERNAL REFERENCES=                                                  04350037
*       DATA AREA- IECDSECS(O/C/E WORK AREA)                            04400037
*       CONTROL BLOCKS= DCB-U,DEB-M                                     04450037
*                                                                       04500037
*TABLES=  WHERE TO GO TABLE                                             04550037
*                                                                       04600037
* MACROS=MODESET,SETLOCK,XCTL,WTO                                       04650037
*     SERIALIZATION= DEB(LOCAL LOCK)                                    04700037
*                                                                       04750037
* CHANGE ACTIVITY= YM06152,YM05576                                      04800037
*                                                                       04850037
* MESSAGE= IEC952I  004-0 CONFLICTING/INVALID DCB FUNC OR               04900037
*                   RELATED PARAMETERS                                  04950037
*                                                                       05000037
*********************************************************************** 05050037
*                             REGISTER  CONVENTIONS                   * 05100037
*********************************************************************** 05150037
RDCB     EQU   2                       DCB REGISTER                     05200037
RBASE    EQU   3                       BASE REGISTER                    05250037
RCORE    EQU   4                       WORK AREA REGISTER               05300037
RPAR     EQU   5                       TOP OF PARAMTER LIST             05350037
RWTG     EQU   6                       TOP OF WTG TABLE                 05400037
RPARC    EQU   7                       CURRENT PARAMETER                05450037
RWTGC    EQU   8                       CURRENT TRANS LOAD               05500037
RTCB     EQU   9                       ADDRESS OF CURRENT TCB    Y02898 05550037
RUCB     EQU   10                      USED HERE AS WORK REGISTER       05600037
RDEB     EQU   11                      DEB ADDRESS                      05650037
RB       EQU   12                      WORK REG1                        05700037
RC       EQU   13                      WORK REG2                        05750037
RD       EQU   14                      WORK REG3                        05800037
RJ       EQU   15                      WORK REG4                        05850037
RE       EQU   0                       WORK REG5                        05900037
RF       EQU   1                       WORK REG6                        05950037
*                                                                       06000037
*                                                                       06050037
ZERO     EQU   X'00'                                                    06100037
ONE      EQU   X'01'                                                    06150037
TWO      EQU   X'02'                                                    06200037
THRE     EQU   X'03'                                                    06250037
FOUR     EQU   X'04'                                                    06300037
FIVE     EQU   X'05'                                           @YM05576 06350037
D40      EQU   40                                                       06400037
D74      EQU   74                                                       06450037
SVC35    EQU   35                                                       06500037
D5       EQU   5                                                        06550037
D6       EQU   6                                                        06600037
D14      EQU   14                                                       06650037
D8       EQU   8                                               @YM05576 06700037
D32      EQU   32                                              @YM05576 06750037
ENDTAB   EQU   X'80'                                           @YM05576 06800037
CNTRLOPT EQU   X'02'                                                    06850037
GETBIT   EQU   X'40'                                                    06900037
PUTBIT   EQU   X'40'                                                    06950037
GETRD    EQU   X'60'                                                    07000037
PUTWRT   EQU   X'60'                                                    07050037
R3505    EQU   X'46'                                                    07100037
RCE      EQU   X'10'                                                    07150037
OMR      EQU   X'20'                                                    07200037
INPUT    EQU   X'00'                                                    07250037
OUTPUT   EQU   X'07'                    MASK FOR OUTPUT OR OUTIN        07300037
FRTY8    EQU   X'30'                                                    07350037
TWENTY   EQU   X'14'                                                    07400037
INTRPRET EQU   X'80'                                                    07450037
READ     EQU   X'40'                                                    07500037
READWX   EQU   X'54'                                                    07550037
READWXT  EQU   X'56'                                                    07600037
READWT   EQU   X'52'                                                    07650037
READW    EQU   X'50'                                                    07700037
PUNCH    EQU   X'20'                                                    07750037
PUNCHW   EQU   X'30'                                                    07800037
PUNCHWX  EQU   X'34'                                                    07850037
PUNCHWXT EQU   X'36'                                                    07900037
PRINTX   EQU   X'04'                                                    07950037
PRINTW   EQU   X'10'                                                    08000037
PRINTWX  EQU   X'14'                                                    08050037
PRINTWT  EQU   X'12'                                                    08100037
PRINTWXT EQU   X'16'                                                    08150037
RDPUNCH  EQU   X'60'                                                    08200037
RDPHDPI  EQU   X'68'                                                    08250037
RDPHW    EQU   X'70'                                                    08300037
RDPHWX   EQU   X'74'                                                    08350037
RDPHWXT  EQU   X'76'                                                    08400037
RDPHWDPI EQU   X'78'                                                    08450037
*                                                                       08500037
SUFIXCOD EQU   26                       WTO SUFFIX ERROR CODE OFFSET    08550037
COMP1    EQU   X'F1'                                                    08600037
COMP2    EQU   X'F2'                                                    08650037
COMP3    EQU   X'F3'                                                    08700037
COMP4    EQU   X'F4'                                                    08750037
**                                                                      08800037
***                                                                     08850037
**                                                                      08900037
*                                                                       08950037
         BALR  RBASE,RE                PUT BASE ADDR IN BASE REG        09000037
         USING *,RBASE                                         @YM05576 09050037
         USING FORCORE,RCORE                                            09100037
         USING IHADCB,RDCB                                              09150037
         USING DEBBASIC,RDEB                                            09200037
         USING WTG,RWTG                                        @YM05576 09250037
*                                                                       09300037
         MODID BR=YES                                          @YM05576 09350037
*                                                                       09400037
FUNC1000 EQU   *                                                        09450037
         L     RDCB,ZERO(RPARC)        GET DCB ADDRESS                  09500037
         L     RCORE,FOUR(RWTGC)       GET DCB WORK AREA ADDRESS        09550037
         L     RDEB,DCBDEBAD           GET ASSOCIATED DEB ADDRESSY02898 09600037
         CLI   DCBFUNC,ZERO            FUNC PARAMETER OF DCB USED       09650037
         BE    FUNC4000                NO, BRANCH                       09700037
         CLI   DCBDEVT,R3505           IS THIS A 3505 CARD READER       09750037
         BNE   FUNC1100                NO, BRANCH                       09800037
         CLI   DCBFUNC,READ            IS FUNC= READ ONLY FILE          09850037
         BNE   FUNC3600                NO,BRANCH                        09900037
         TM    DCBMODE,OMR             OPTICAL MARK READ SPECIFIED      09950037
         BO    FUNC3800                YES, BRANCH                      10000037
         TM    DCBMODE,RCE             READ COLUMN ELIMINATE SPECIFIED  10050037
         BO    FUNC3800                YES,BRANCH                       10100037
FUNC1100 EQU   *                                                        10150037
         CLI   DCBFUNC,INTRPRET        IS THIS AN INTERPRET FILE        10200037
         BE    FUNC3800                 YES, BRANCH TO LOAD ID OF '7P'  10250037
         B     FUNC3300                OTHERWISE, CK FOR OTHER FUNCTION 10300037
FUNC1200 EQU   *                                                        10350037
*                                                                       10400037
*    VERIFY VALID USE OF CNTRL ON INPUT FILE OF AN ASSOCIATED DATA SET  10450037
*                                                                       10500037
         TM    DEBOPATB,OUTPUT          IS THIS AN INPUT DATA SET       10550037
         BO    FUNC1300                 NO, BRANCH                      10600037
         TM    DCBMACRF,CNTRLOPT       CHECK FOR INVALID CNTRL          10650037
         BO    FUNC3900                YES, BRANCH TO PRINT ERROR MSG.  10700037
*                                                                       10750037
FUNC1300 EQU   *                                                        10800037
         STM   RDEB,RD,DXREGB          SAVE REGISTERS 11_14      Y02898 10850037
         MODESET EXTKEY=ZERO           SET KEY 0               @YM05576 10900037
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02898X10950037
               RELATED=(DEB,IGG0197N(FUNC1800)) LOCK CPU'S       Y02898 11000037
*                                      CHAIN SO THAT A CHECK FOR Y02898 11050037
*                                      ASSOCIATED DATA SET CAN   Y02898 11100037
*                                      BE MADE                   Y02898 11150037
         MODESET EXTKEY=DATAMGT        SET DATA MANAGEMENT KEY @YM05576 11200037
         LM    RDEB,RD,DXREGB          RESTORE REGISTERS 11_14   Y02898 11250037
         XC    DXCCW2(32),DXCCW2       CLEAR 32 OF 48 BYTES    @ZA10075 11300037
         XC    DXCCW6+1(15),DXCCW6+1   CLEAR LAST 15 BYTES     @ZA10075 11350037
         SR    RB,RB                   CLEAR WORK REGISTERS             11400037
         SR    RC,RC                                                    11450037
         SR    RD,RD                                                    11500037
         L     RUCB,DEBSUCBA           GET DEB "IDENTIFIER"    @YM06152 11550037
         L     RDCB,DXUDCBAD           GET ACTUAL ADDRESS OF DCB Y02898 11600037
*                                      TO BE OPENED              Y02898 11650037
         LA    RDCB,ZERO(RDCB)         CLEAR HIGH ORDER BYTE   @YM05576 11700037
         LA    RUCB,0(RUCB)                 * * *              @YM06152 11750037
         MVC   DXCCW8+ONE(THRE),DXUDCBAD+ONE MOVE IN USER DCB  @YM06152 11800037
         ST    RDCB,DXCCW2              SAVE CURRENT DM DCB    @YM06152 11850037
FUNC1400 EQU   *                                                        11900037
         TM    DEBOPATB,OUTPUT         IS THIS AN INPUT DCB             11950037
         BO    FUNC1500                NO,BRANCH                        12000037
         MVC   DXCCW4+ONE(THRE),DXCCW8+ONE  GET READ DCB ADDR  @YM05576 12050037
         ST    RDEB,DXCCW4+FOUR        SAVE CORRESPONDING DEB  @YM06152 12100037
         B     FUNC1700                BR TO GET POINTER TO NEXT DEB    12150037
FUNC1500 EQU   *                                                        12200037
         TM    DEBOPATB,OUTPUT         IS THIS AN OUTPUT DCB            12250037
         BNO   FUNC1700                NO, BRANCH                       12300037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 12350037
*                                      KEY                       Y02898 12400037
         TM    DCBFUNC,PUNCH           PUNCH DCB                        12450037
         BNO   FUNC1600                NO, PRINT ASSUMED...,BRANCH      12500037
         TM    DCBFUNC,PRINTX          PRINTER BIT ON IN DCB FUNC PARM  12550037
         BO    FUNC1600                YES, BRANCH                      12600037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 12650037
*                                      KEY                       Y02898 12700037
         MVC   DXCCW5+ONE(THRE),DXCCW8+ONE SAVE PUNCH DCB PTR  @YM06152 12750037
         ST    RDEB,DXCCW5+FOUR        SAVE CORRESPONDING DEB  @YM06152 12800037
         B     FUNC1700                BRANCH                           12850037
FUNC1600 EQU   *                                                        12900037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 12950037
*                                      KEY                       Y02898 13000037
         MVC   DXCCW6+ONE(THRE),DXCCW8+ONE SAVE PRINT DCB PTR  @YM06152 13050037
         ST    RDEB,DXCCW6+FOUR        SAVE CORRESPONDING DEB  @YM06152 13100037
FUNC1700 EQU   *                                                        13150037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 13200037
*                                                                       13250037
*        CHANGE THE DEB AND DCB ADDRESSES SO THAT THE NEXT DEB IN THE   13300037
*        DEB QUEUE IS BEING POINTED TO AND ITS RELATED DCB IS           13350037
*        BEING POINTED TO.  THESE TWO ADDRESSES WILL BE CHANGED         13400037
*        CONTINUOUSLY UNTIL ALL OF THE DEB'S IN THE DEB QUEUE HAVE      13450037
*        BEEN INTERROGATED.                                             13500037
*                                                                       13550037
         CLC   DEBDEBB(THRE),DXCCW3    ANOTHER DEB IN DEB QUEUE         13600037
         BE    FUNC1800                NO, BRANCH                       13650037
         L     RDEB,DEBDEBAD           YES, GET ADDRESS OF NEXT DEB     13700037
         L     RDCB,DEBDCBAD           GET THIS DCB ADDRESS             13750037
         MVC   DXCCW7+ONE(THRE),DEBSUCBA+ONE  SAVE UCB ADDR.   @YM05576 13800037
         CL    RUCB,DXCCW7             DO UCB PTRS MATCH       @YM05576 13850037
         BNE   FUNC1700                NO, BRANCH              @YM05576 13900037
         LA    RDCB,ZERO(RDCB)         CLEAR HIGH ORDER BYTE   @YM05576 13950037
         LR    RB,RPAR                 GET DCB PARM LIST PTR   @YM05576 14000037
         LR    RC,RWTG                 GET WTG TABLE PTR       @YM05576 14050037
         LA    RC,D32(RC)              INDEX PAST WTG HEADER   @YM05576 14100037
FUNC1725 EQU   *                                               @YM05576 14150037
         L     RD,ZERO(RB)             GET DCB PTR FROM PLIST  @YM05576 14200037
         LA    RD,ZERO(RD)             ZERO HIGH ORDER BYTE    @YM05576 14250037
         CLR   RD,RDCB                 DOES PARM LIST DCB PTR  @YM05576 14300037
*                                      EQUAL DEB DCB PTR       @YM05576 14350037
         BE    FUNC1775                YES. MUST BE DATA       @YM05576 14400037
*                                      MANAGEMENT'S DCB        @YM05576 14450037
         TM    ZERO(RB),ENDTAB         IS IT END OF PARM LIST  @YM05576 14500037
         BO    FUNC1750                YES. MUST BE USER DCB   @YM05576 14550037
         LA    RB,FOUR(RB)             NO. GET NEXT DCB PTR    @YM05576 14600037
         LA    RC,D8(RC)               GET NEXT WTG TAB ENTRY  @YM05576 14650037
         B     FUNC1725                GO COMPARE NEXT DCB     @YM05576 14700037
FUNC1750 EQU   *                                               @YM05576 14750037
         ST    RDCB,DXCCW8             SAVE DEB DCB PTR (USER) @YM05576 14800037
         B     FUNC1400                BRANCH                           14850037
FUNC1775 EQU   *                                               @YM05576 14900037
         L     RC,FOUR(RC)             GET FORECORE ADDR       @YM05576 14950037
         USING FORCORE,RC              ESTAB ADDRESSABILITY    @YM05576 15000037
         L     RD,DXUDCBAD             GET USER DCB PTR        @YM05576 15050037
         DROP  RC                      REESTAB RCORE AS BASE   @YM05576 15100037
         ST    RD,DXCCW8               SAVE USER DCB ADDR.     @YM05576 15150037
         B     FUNC1400                GO PROCESS ASSOC. D.S.  @YM05576 15200037
FUNC1800 EQU   *                                                        15250037
         SR    RB,RB                   ZERO WORK REG           @YM05576 15300037
         SR    RC,RC                   ZERO WORK REG           @YM05576 15350037
         SR    RD,RD                   ZERO WORK REG           @YM05576 15400037
         STM   RDEB,RD,DXREGB          SAVE REGISTERS 11_14      Y02898 15450037
         MODESET EXTKEY=ZERO           SET KEY 0               @YM05576 15500037
         SETLOCK RELEASE,TYPE=LOCAL,                             Y02898X15550037
               RELATED=(DEB,IGG0197N(FUNC1300)) UNLOCK CPU'S     Y02898 15600037
         MODESET EXTKEY=DATAMGT        SET DATA MANAGEMENT KEY @YM05576 15650037
         LM    RDEB,RD,DXREGB          RESTORE REGISTERS 11_14   Y02898 15700037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 15750037
FUNC1850 CLC   DXCCW4(FOUR),DXCCW3     WAS A READ DCB FOUND             15800037
         BE    FUNC2000                NO,BRANCH                        15850037
         L     RDCB,DXCCW4             GET READ DCB ADDR FOR DSECT USE  15900037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 15950037
*                                      KEY                       Y02898 16000037
         TM    DCBMACRF,GETBIT         GET BIT ON IN DCB                16050037
         BNO   FUNC1900                NO, BRANCH                       16100037
         LA    RB,D40                  SET QSAM SWITCH ON               16150037
         B     FUNC2000                BRANCH                           16200037
FUNC1900 EQU   *                                                        16250037
         LA    RB,TWENTY               SET BSAM SWITCH ON               16300037
FUNC2000 EQU   *                                                        16350037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 16400037
*                                      KEY                       Y02898 16450037
FUNC2050 CLC   DXCCW5(FOUR),DXCCW3     WAS A PUNCH DCB ADDR RETAINED    16500037
         BE    FUNC2200                NO, BRANCH                       16550037
         L     RDCB,DXCCW5             GET PUNCH DCB ADDRESS            16600037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 16650037
*                                      KEY                       Y02898 16700037
         TM    DCBMACRF+ONE,PUTBIT     PUT BIT ON IN DCB                16750037
         BNO   FUNC2100                NO, BRANCH                       16800037
         LA    RC,D40                  SET QSAM SWITCH ON               16850037
         B     FUNC2200                BRANCH                           16900037
FUNC2100 EQU   *                                                        16950037
         LA    RC,TWENTY               SET BSAM SWITCH ON               17000037
FUNC2200 EQU   *                                                        17050037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 17100037
*                                      KEY                       Y02898 17150037
         CLC   DXCCW6+1(3),DXCCW3      WAS A PRINT DCB ADDR             17200037
*                                      RETAINED                @ZA14966 17250037
         BE    FUNC2400                NO, BRANCH                       17300037
         L     RDCB,DXCCW6             GET PRINT DCB ADDRESS            17350037
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 17400037
*                                      KEY                       Y02898 17450037
         TM    DCBMACRF+ONE,PUTBIT     PUT BIT ON IN DCB                17500037
         BNO   FUNC2300                NO, BRANCH                       17550037
         LA    RD,D40                  SET QSAM SWITCH ON               17600037
         B     FUNC2400                BRANCH                           17650037
FUNC2300 EQU   *                                                        17700037
         LA    RD,TWENTY               TURN ON BSAM SWITCH              17750037
FUNC2400 EQU   *                                                        17800037
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 17850037
*                                      KEY                       Y02898 17900037
         LTR   RB,RB                   WORK REG EQUAL ZERO              17950037
         BC    8,FUNC2700              YES, BRANCH                      18000037
         LTR   RC,RC                   THIS SWITCH EQUAL TO ZERO        18050037
         BC    8,FUNC2600              YES, BRANCH                      18100037
         CLR   RB,RC                   SAME ACC. MTHD USED FOR RD & PCH 18150037
         BE    FUNC2600                YES, BRANCH                      18200037
         LA    RCORE,THRE              CONFLICTING ACCESS METHODS.      18250037
         L     RDCB,DXCCW2             GET ACTUAL ADDRESS OF DCB Y02898 18300037
*                                      TO BE OPENED              Y02898 18350037
FUNC2500 EQU   *                                                        18400037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18450037
*                                                                     * 18500037
*     COMPLETION CODE 004-1 IS FOR INVALID DCBFUNC PARAMETERS           18550037
*     COMPLETION CODE 004-2 IS FOR INVALID FUNC/CNTRL COMBINATION       18600037
*     COMPLETION CODE 004-3 IS FOR CONFLICTING ASSOCIATED DATA SET      18650037
*                           ACCESS METHODS                              18700037
*     COMPLETION CODE 004-4 IS FOR AN INVALID DCB FOR A 3505 OR 3525    18750037
*                                                                     * 18800037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 18850037
         LR    RD,RCORE                SAVE RETURN CODE                 18900037
         L     RCORE,FOUR(RWTGC)       GET DCB WORKAREA ADDRESS         18950037
         LA    RF,MESSAGEA              GET ADDRESS OF WTO MESSAGEA     19000037
         MVC   MESSAGEA(D74),IECF03I   MOVE IN ERROR MESSAGE            19050037
         O     RD,SUFIXCOD(RF)         OR IN COMP CODE SUFFIX           19100037
         SVC   SVC35                   ISSUE WTO SVC                    19150037
         LR    RJ,RD                   LOAD IN RETURN CODE              19200037
         B     ABEN                    GO TO ISSUE ABEND                19250037
FUNC2600 EQU   *                                                        19300037
         LTR   RD,RD                   THIS SWITCH EQUAL TO ZERO        19350037
         BC    8,FUNC2900              YES, BRANCH                      19400037
         CLR   RB,RD                   SAME ACC. MTHD FOR RD AND PRT    19450037
         BE    FUNC2900                YES, BRANCH                      19500037
         B     FUNC2500                 NO PRINT IECF03I 004-3 @ZA00000 19550037
FUNC2700 EQU   *                                                        19600037
         LTR   RC,RC                   THIS SWITCH ON                   19650037
         BC    8,FUNC2800              NO, BRANCH                       19700037
         LTR   RD,RD                    THIS SWITCH ON                  19750037
         BC    8,FUNC2900              NO, BRANCH                       19800037
         CLR   RC,RD                   SAME ACC. MTHD BEING USED        19850037
         BE    FUNC2900                YES, BRANCH                      19900037
         B     FUNC2500                 NO PRINT IECF03I 004-3 @ZA00000 19950037
FUNC2800 EQU   *                                                        19990037
         LTR   RD,RD                   THIS SWITCH EQUAL TO ZERO        20030037
         BE    FUNC2500                YES PRINT IECF03I 004-3 @ZA00000 20070037
FUNC2900 EQU   *                                                        20150037
         CLC   DXCCW4(FOUR),DXCCW3     WAS A READ DCB FOUND    @YM06152 20200037
         BE    FUNC3100                NO, BRANCH                       20250037
         L     RDCB,DXCCW4             PUT RD DCB ADDR IN DCB REGISTER  20300037
         L     RDEB,DXCCW4+FOUR        GET READ DCB DEB ADDR   @YM06152 20350037
FUNC3000 EQU   *                                                        20400037
         MVC   DEBRDCBA(THRE),DXCCW4+ONE  PUT RD DCB ADDR IN DEB EXT.   20450037
         MVC   DEBPDCBA(THRE),DXCCW5+ONE  PUT PCH DCB ADDR IN DEB EXT.  20500037
         MVC   DEBWDCBA(THRE),DXCCW6+ONE  PUT PRT DCB ADDR IN DEB EXT.  20550037
FUNC3100 EQU   *                                                        20600037
         CLC  DXCCW5(FOUR),DXCCW3      WAS A PCH DCB FOUND     @YM06152 20650037
         BE    FUNC3200                NO, BRANCH                       20700037
         L     RDCB,DXCCW5             PUT PCH DCB ADDR IN DCB REG.     20750037
         L     RDEB,DXCCW5+FOUR        GET PCH DCB DEB ADDR    @YM06152 20800037
         LTR   RC,RC                   PUNCH DEB HOOK COMPLETE          20850037
         BNP   FUNC3200                YES, BRANCH                      20900037
         SR    RC,RC                   ZERO OUT WORK REGISTER           20950037
         B     FUNC3000                BRANCH TO GET DCB ADDR           21000037
FUNC3200 EQU   *                                                        21050037
         CLC   DXCCW6+1(3),DXCCW3      PRINT DCB FOUND         @ZA14966 21100037
         BE    FUNC4300                NO, BRANCH                       21150037
         L     RDCB,DXCCW6             PUT PRT DCB ADDR IN DCB REG.     21200037
         L     RDEB,DXCCW6+FOUR        GET PRINT DCB DEB ADDR  @YM06152 21250037
         LTR   RD,RD                   PRINT DEB HOOK COMPLETE          21300037
         BNP   FUNC4300                YES, BRANCH                      21350037
         SR    RD,RD                   ZERO OUT WORK REGISTER           21400037
         B     FUNC3000                BRANCH TO GET DCB ADDR           21450037
FUNC3300 EQU   *                                                        21500037
         CLI   DCBFUNC,READ            IS FUNC PARM EQUAL TO READ ONLY  21550037
         BNE   FUNC3500                NO, BRANCH                       21600037
         TM    DCBMODE,RCE             READ COLUMN ELIMINATE SPECIFIED  21650037
         BO    FUNC3800                YES, BRANCH                      21700037
FUNC3400 EQU   *                                                        21750037
         LA    RF,SOP5                 GET ID OF EXEC. IGG0191G         21800037
         B     XCTLGOGO                BRANCH TO XCT SUBROUTINE         21850037
*                                                                       21900037
** CHECK FOR TYPE OF DATA SET SPECIFIED                                 21950037
*                                                                       22000037
FUNC3500 EQU   *                                                        22050037
         CLI   DCBFUNC,PUNCH           PUNCH ONLY DATA SET              22100037
         BE    FUNC3400                YES, BRANCH                      22150037
         CLI   DCBFUNC,PRINTW          PRINT ONLY DATA SET              22200037
         BE    FUNC3800                YES, BRANCH                      22250037
         CLI   DCBFUNC,PRINTWT         PRT W/ 2-LINE PRINT DATA SET     22300037
         BE    FUNC3800                YES, BRANCH                      22350037
         CLI   DCBFUNC,PRINTWXT        PRINT W/ 2-LINE PRINT DATA SET   22400037
         BE    FUNC3800                YES, BRANCH                      22450037
         CLI   DCBFUNC,PRINTWX         PRINT ONLY DATA SET              22500037
         BE    FUNC3800                YES, BRANCH                      22550037
         CLI   DCBFUNC,RDPUNCH         RD/PUNCH ASSOCIATED DATA SET     22600037
         BE    FUNC1200                YES, BRANCH                      22650037
         CLI   DCBFUNC,RDPHDPI         RD/PCH W/ DATA PROTECT IMAGE     22700037
         BE    FUNC1200                YES, BRANCH                      22750037
         CLI   DCBFUNC,READW           RD/PRINT ASSOCIATED DATA SET     22800037
         BE    FUNC1300                YES, BRANCH                      22850037
         CLI   DCBFUNC,READWX          PRT PORTION OF RD/PRT ASSOC D.S. 22900037
         BE    FUNC1300                YES, BRANCH                      22950037
         CLI   DCBFUNC,READWXT         RD/PRT W/ 2-LINE PRT ASSOC D.S.  23000037
         BE    FUNC1300                YES, BRANCH                      23050037
         CLI   DCBFUNC,READWT          RD/PRT W/ 2-LINE PRT ASSOC D.S.  23100037
         BE    FUNC1300                YES, BRANCH                      23150037
         CLI   DCBFUNC,PUNCHW          PCH/PRT ASSOCIATED DATA SET      23200037
         BE    FUNC1200                YES, BRANCH                      23250037
         CLI   DCBFUNC,PUNCHWX         PRT PORTION OF PCH/PRT ASSOC. DS 23300037
         BE    FUNC1300                YES, BRANCH                      23350037
         CLI   DCBFUNC,PUNCHWXT        PCH/PRT FILE W/ 2-LINE PRINT     23400037
         BE    FUNC1300                YES, BRANCH                      23450037
         CLI   DCBFUNC,RDPHW           RD/PCH/PRT ASSOCIATED DATA SET   23500037
         BE    FUNC1200                YES, BRANCH                      23550037
         CLI   DCBFUNC,RDPHWX          PRT PART OF RD/PCH/PRT ASSOC. DS 23600037
         BE    FUNC1300                YES, BRANCH                      23650037
         CLI   DCBFUNC,RDPHWXT         RD/PCH/PRT FILE W/ 2-LINE PRINT  23700037
         BE    FUNC1300                YES, BRANCH                      23750037
         CLI   DCBFUNC,RDPHWDPI        RD/PCH/PRT FILE W/ DPI           23800037
         BE    FUNC1200                YES, BRANCH                      23850037
FUNC3600 EQU   *                                                        23900037
         LA    RCORE,ONE               INDICATE INVALID DCBFUNC PARAM   23950037
         B     FUNC2500                BRANCH TO WTO ROUTINE            24000037
FUNC3800 EQU   *                                                        24050037
         LA    RF,IGG0197P             GET ID OF NEXT EXECUTOR          24100037
         B     XCTLGOGO                BRANCH TO XCTL SUBROUTINE        24150037
FUNC3900 EQU   *                                                        24200037
         LA    RCORE,TWO               INDICATE INVALID FUNC/CNTRL COMB 24250037
         B     FUNC2500                BRANCH TO WTO ROUTINE            24300037
FUNC4000 EQU   *                                                        24350037
         TM    DCBDEVT,R3505           3505 CARD READER DEVICE USED     24400037
         BNO   FUNC4200                NO, BRANCH                       24450037
         TM    DCBMODE,OMR             OPTICAL MARK READ SPECIFIED      24500037
         BO    FUNC3800                YES, BRANCH                      24550037
FUNC4100 EQU   *                                                        24600037
         TM    DCBMODE,RCE             READ COL. ELIM. SPECIFIED        24650037
         BO    FUNC3800                YES, BRANCH                      24700037
         B     FUNC3400                BR TO LOAD NEXT EXECUTOR ID      24750037
FUNC4200 EQU   *                                                        24800037
         TM    DCBMACRF,GETRD          GET OR READ USED                 24850037
         BM    FUNC4100                YES, BRANCH                      24900037
         TM    DCBMACRF+ONE,PUTWRT     PUT OR WRITE USED                24950037
         BM    FUNC3400                YES, BRANCH                      25000037
         LA    RCORE,FOUR              INVALID DCB FOR A 3505 OR 3525   25050037
         B     FUNC2500                BRANCH TO WTO ROUTINE            25100037
FUNC4300 EQU   *                                                        25150037
         L     RDCB,DXCCW2             RELOAD CURRENT DCB ADDRESS       25200037
         LA    RF,IGG0197P             LOAD ID OF NEXT EXECUTOR         25250037
XCTLGOGO EQU   *                                                        25300037
*                                      SET SYSTEM TO OPEN PROTECTY02898 25350037
         MODESET EXTKEY=DATAMGT        KEY                       Y02898 25400037
         MVC   ZERO(D5,RWTGC),ZERO(RF) SAVE ID OF NEXT MODULE           25450037
RELOOP   EQU   *                                                        25500037
         LA    RWTGC,WGOFF(ZERO,RWTGC) INCREMENT CURRENT WTG ENTRY      25550037
         LA    RPARC,PLOFF(ZERO,RPARC) INCR CURRENT DCB ENTRY POINTER   25600037
         CLC   ZERO(TWO,RWTGC),AMIDCNST THIS ROUTINE NEEDED AGAIN       25650037
         BCR   8,RBASE                 BACK TO OPEN CONTROL ROUTINDM0I  25700037
*                                                                       25750037
         CLC   ZERO(TWO,RWTGC),OPIDCNST END OF TABLE                    25800037
         BC    7,RELOOP                NO, CHECK NEXT ENTRY             25850037
*                                                                       25900037
         LR    RPARC,RPAR                                               25950037
         LA    RWTGC,WAOFF(ZERO,RWTG)  REINITIALIZE WTG LIST POINTER    26000037
ZCHEK    CLI   0(RWTGC),X'00'          ENTRY COMPLETE                   26050037
         BC    7,TCTLRTN               IF NOT, TRANSFER CONTROL         26100037
*                                                                       26150037
         LA    RWTGC,WGOFF(ZERO,RWTGC) GET NEXT ENTRY                   26200037
         LA    RPARC,PLOFF(ZERO,RPARC) GET NEXT ENTRY                   26250037
         BC    15,ZCHEK                ZERO CHECK                       26300037
*                                                                       26350037
TCTLRTN  EQU   *                                                        26400037
         MVC   D6(TWO,RWTG),ZERO(RWTGC)   STORE ID IN WTG TABLE         26450037
         MVC   D14(THRE,RWTG),TWO(RWTGC) MOVE TTR INTO TABLE            26500037
*                                                                       26550037
         LA    RJ,DXCCW12              SET UP FOR XCTL                  26600037
**                                                                      26650037
         XCTL  DE=(RWTG),SF=(E,(15))                                    26700037
**                                                                      26750037
*                                                                       26800037
*********************************************************************** 26850037
*                                                                       26900037
**                                                                      26950037
ABEN     EQU   *                                                        27000037
         L     RF,ABEND4               GET SAM ABEND ERROR CODE         27050037
         SLL   RF,12                   SET UP REGISTER 1 FOR ABEND      27100037
         ABEND (1),DUMP                                                 27150037
*                                                                       27200037
*********************************************************************** 27250037
WAOFF    EQU   32                                                       27300037
PLOFF    EQU   4                       OFFSET OF DCB ENTRIES            27350037
WGOFF    EQU   8                       OFFSET OF WTG ENTRIES            27400037
OPIDCNST DC    C'0S'                   ID                               27450037
AMIDCNST DC    C'7N'                   THIS MODULE'S ID                 27500037
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     27550037
ABEND4   DC    X'00000004'             ABEND CODE OF 4                  27600037
*                                                                       27650037
IECF03I  WTO   'IEC952I 004-0 CONFLICTING/INVALID DCB FUNC OR RELATED P*27700037
               ARAMETERS ',MF=L,ROUTCDE=(11),DESC=4                     27750037
         DS    0F                      FULLWORD BOUNDARY       @YM06152 27800037
ZAPSZAPS DC    8C'ZAPSZAPS'            WORK AREA USED BY OPEN    Y02898 27850037
IGG0197P DC    C'7P'                   MODULE ID               @YM05576 27900037
SOP5     DC    C'1G'                   MODULE ID               @YM05576 27950037
*                                                                       28000037
*                                                                       28050037
         DCBD  DSORG=PS                                                 28100037
         IECDSECS MAIN,WTG,PREFX,EXPAND=YES                    @YM05576 28150037
         CVT   DSECT=YES,LIST=YES                              @YM05576 28200037
         IKJTCB                                                  Y02898 28250037
         IHARB                                                   Y02898 28300037
         IHAPSA                                                  Y02898 28350037
         IEZDEB                                                         28400037
         END                                                            28450037
