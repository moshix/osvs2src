         TITLE 'IGG0197P-BUILDS IOBS AND CCWS FOR 3505 AND 3525'        00100000
         START                                                          00200000
IGG0197P CSECT                                                          00300000
*********************************************************************** 00400000
* D189000,A188500-189000,A410100-410400                        @ZA01875 00420003
* D 177600,405000,574000-577000                                @YM05576 00450002
* C 175000                                                     @YM05576 00460002
* A 405700                                                     @YM05576 00470002
* D 236300,263300,392300,553000-558000,566000                  @YM06153 00475002
* C 242000,242300,244000,246000,248000,236500                  @YM06153 00480002
* A 458500,459500,410500,240500,235500,402600,490500           @YM06152 00485002
* C 498000                                                     @YM06152 00487002
*                                                                       00500000
* MODULE NAME=    IGG0197P                                              00600002
*                                                                       00700000
* DESCRIPTIVE NAME= IGG0197P-OPEN FOR 3505/3525 FEATURES                00800002
*                                                                       00900000
* STATUS CHANGE LEVEL - OS/VS2 REL 2                                    01000002
*                                                                       01300000
* MODULE TYPE=  PROCESSOR-ASSEM                                         01400002
*               ATTRIBUTES-REENTRANT,REUSABLE                           01460002
*                                                                       01520002
* FUNCTION/OPERATION--THIS ROUTINE WILL GET CORE (GETMAIN) TO SET UP    01600002
*                    THE NECESSARY IOB'S FOR THE 3505 CARD READER       01700000
*                    AND 3525 CARD PUNCH.  IT WILL CLEAR THE CORE       01800000
*                    AND LINK THE IOB'S TOGETHER.  IT WILL CONNECT      01900000
*                    THE DCB AND IOB.  IT WILL SET UP CCW'S FOR THE     02000000
*                    3505 AND 3525.  IT WILL SET UP ANY CONTROL         02100000
*                    COMMANDS NEEDED.                                   02200000
*                                                                       02300000
*                    A BIT IS SET IN THE AUDIT TRAIL TRAIL              02320002
*                    INDICATING THE IOB HAS BEEN OBTAINED AND           02340002
*                    SHOULD BE FREED IF AN ABEND OCCURS DURING          02360002
*                    OPEN PROCESSING                                    02380002
* ENTRY POINTS--      ENTERED FROM IGG0197N BY USE OF THE XCTL MACRO.   02400002
*     INPUT=      SEE DESCRIPTION OF REGISTERS.                         02600002
*                                                                       02700000
* EXITS-NORMAL--      XCTL TO IGG0197Q TO LOAD EOB, CNTRL AND NOTE      03300002
*                    POINT ID'S IN DCB.                                 03400000
*     OUTPUT=        IOB ADDRESS STORED INTO DCB                        03450002
*                                                                       03500000
* EXTERNAL REFERENCES=                                                  04010002
*     DATA AREAS-IECDSECS(O/C/E WORK AREA)                              04020002
*                IHAFCAUD(FORCE CLOSE WORK AREA)                        04030002
*     CONTROL BLOCKS=IOB-C,DCB-U,DEB,U                                  04040002
*                                                                       04050002
* TABLES=           WHERE-TO-GO TABLE                                   04100002
*                    BYTES  0- 7   NAME                                 04200000
*                    BYTES  8-10   RELATIVE DISK ADDRESS(TTR) OF        04300000
*                                  FIRST RECORD                         04400000
*                    BYTE     11   CONCATENATION NUMBER                 04500000
*                    BYTE     12   ZEROES                               04600000
*                    BYTE     13   ALIAS INDICATOR AND USER DATA        04700000
*                                  FIELD DESCRIPTOR:                    04800000
*                                      -ALIAS INDICATOR-- 1 BIT         04900000
*                                      -NUMBER OF TTRS IN USERS         05000000
*                                      DATA FIELD-- 2 BITS              05100000
*                    BYTES 14-16   TTR OF FIRST TEXT RECORD             05200000
*                    BYTE     17   ZEROES                               05300000
*                    BYTES 18-19   TTR OF NOTE LIST OR SCATTER LIST     05400000
*                    BYTE     20   TRANSLATION TABLE                    05500000
*                    BYTE     21   ZEROES OR NUMBER OF ENTRIES IN       05600000
*                                  THE NOTE LIST                        05700000
*                    BYTES 22-23   ATTRIBUTES                           05800000
*                    BYTES 24-26   TOTAL CONTIGUOUS MAIN STORAGE        05900000
*                                  REQUIRED FOR MODULE                  06000000
*                    BYTES 27-28   LENGTH OF FIRST TEXT RECORD          06100000
*                    BYTE     29   LENGTH OF WTG TABLE(IN DOUBLE        06200000
*                                  WORDS)                               06300000
*                    BYTES 30-31   PATH THROUGH LOADS OF ROUTINES       06400000
*                    BYTES 32-34   IDTTR OF EXECUTOR FOR FIRST DCB      06500000
*                    BYTE     35   ADDRESS OF STORAGE FOR DCB           06600000
*                    BYTES 36-39   TABLE OF IDTTR'S                     06700000
*                    BYTE  32+N(8)--                                    06800000
*                            IDTTR OF EXECUTOR FOR NTH DCB (3 BYTES)    06900000
*                            ADDRESS OF STORAGE FOR DCB    (1 BYTE )    07000000
*                            IDTTR OF LAST ROUTINE LOAD    (3 BYTES)    07100000
*                            NOT USED                      (1 BYTE )    07200000
*                                                                       07800000
* MACROS= GETMAIN,MODESET,XCTL                                          07820002
*                                                                       07840002
* CHANGE ACTIVITY= YM05576,YM06152,YM06153                              07860002
*********************************************************************** 07900000
*                                                                       08000000
*                                                                       08100000
*  REGISTER CONVENTIONS USED THROUGHOUT ALL OPEN PASSES                 08200000
*                                                                       08300000
*                                                                       08400000
*********************************************************************** 08500000
RDCB     EQU   2                       DCB REGISTER                     08600000
RBASE    EQU   3                       BASE REGISTER                    08700000
RCORE    EQU   4                       WORK AREA REGISTER               08800000
RPAR     EQU   5                       TOP OF PARAMETER LIST            08900000
RWTG     EQU   6                       TOP OF WTG TABLE                 09000000
RPARC    EQU   7                       CURRENT PARAMETER                09100000
RWTGC    EQU   8                       CURRENT TRANS. LOAD              09200000
RTCB     EQU   9                       ADDRESS OF CURRENT TCB    Y02898 09300002
RUCB     EQU   10                      UCB REGISTER                     09400000
RDEB     EQU   11                      DEB ADDRESS                      09500000
RB       EQU   12                      WORK REGISTER 1                  09600000
RC       EQU   13                      WORK REGISTER 2                  09700000
RD       EQU   14                      WORK REGISTER 3                  09800000
RJ       EQU   15                      WORK REGISTER 4                  09900000
RE       EQU   0                       WORK REGISTER 5                  10000000
RF       EQU   1                       WORK REGISTER 6                  10100000
*                                                                       10200000
**                 MASKS                                                10300000
*                                                                       10400000
QSAM     EQU   X'01'                                                    10500000
SUCCFUL  EQU   X'7F'                                                    10600000
UNDFIND  EQU   X'C0'                                                    10700000
FIXED    EQU   X'80'                                                    10800000
BLKBITOF EQU   X'EF'                                                    10900000
PRTONLY  EQU   X'E9'                                                    11000000
NOTRDPCH EQU   X'97'                                                    11100000
INTORPCH EQU   X'A9'                                                    11200000
FIRSTIOB EQU   X'01'                                                    11300000
CNTRLB   EQU   X'02'                                                    11400000
READONLY EQU   X'C2'                                                    11500000
CCOFF    EQU   X'BF'                                                    11600000
PRT      EQU   X'05'                                                    11700000
READPRT  EQU   X'50'                                                    11800000
PHPRT    EQU   X'30'                                                    11900000
RDFDSS   EQU   X'02'                                                    12000000
OMR      EQU   X'20'                                                    12100000
RCE      EQU   X'10'                                                    12200000
OMRCEFLG EQU   X'08'                                                    12300000
RPW      EQU   X'70'                                                    12400000
DISPSN   EQU   X'00'                                                    12500000
OUTP     EQU   X'07'                                                    12600000
ONE      EQU   X'01'                                                    12700000
TWO      EQU   X'02'                                                    12800000
THREE    EQU   3                                                        12900000
ASCII    EQU   X'04'                                                    13000000
QFOUR    EQU   X'04'                                                    13100000
QTHREE   EQU   X'03'                                                    13200000
CC       EQU   X'40'                                                    13300000
FDSS     EQU   X'23'                                                    13400000
SLI      EQU   X'20'                                                    13500000
MODE2    EQU   X'20'                                                    13600000
NOP      EQU   X'03'                                                    13700000
SLICC    EQU   X'60'                                                    13800000
WRFDSS   EQU   X'01'                                                    13900000
STACK2   EQU   X'40'                                                    14000000
PRINTX   EQU   X'04'                   PRINTER BIT MASK                 14100000
PRINTW   EQU   X'10'                   PRINT BIT MASK                   14200000
DPI      EQU   X'08'                   DPI BIT MASK                     14300000
INTRPRET EQU   X'80'                   INTERPRET DATA SET MASK          14400000
READ     EQU   X'40'                   READ DATA SET MASK               14500000
Z0       EQU   X'00'                                                    14600000
D07      EQU   7                                                        14700000
D10      EQU   10                                                       14800000
D255     EQU   X'FF'                                                    14900000
D12      EQU   12                                                       15000000
D20      EQU   20                                                       15100000
D16      EQU   16                                                       15200000
D14      EQU   14                                                       15300000
SIX      EQU   6                                                        15400000
FIVE     EQU   5                                                        15500000
D13      EQU   13                                                       15600000
D08      EQU   8                                                        15700000
X28      EQU   X'28'                                                    15800000
D24      EQU   24                                                       15900000
D37      EQU   37                                                       16000000
XC9      EQU   X'C9'                                                    16100000
DATA2    EQU   X'80'                   DATA MODE 2 MASK                 16200000
POCKET2  EQU   X'02'                   STACKER 2 MASK                   16300000
RCEMASK  EQU   X'10'                   RCE MASK                         16400000
OMRRCE   EQU   X'08'                   OMR OR RCE OP CODE FLAG          16500000
PRINTBUF EQU   64                      INTERPRET PRINT BUFFER SIZE      16600000
NOFUNC   EQU   X'00'                                                    16700000
FORTYATE EQU   X'30'                                                    16800000
*                                                                       16900000
**                                                                      17000000
***                                                                     17100000
**                                                                      17200000
*                                                                       17300000
         BALR  RBASE,RE                SET BASE                         17400000
         USING *,RBASE                                         @YM05576 17500002
         USING IHADCB,RDCB                                              17600000
         USING FORCORE,RCORE                                            17700000
         USING DEBBASIC,RDEB            SET UP BASE FOR DEB      Y02898 17730002
*                                                                       17800000
         MODID BR=YES                                                   17850002
**                                                                      17900000
NOPN21   EQU   *                                                        18000000
**                                                                      18100000
         SR    RE,RE                                                    18200000
         L     RDCB,Z0(RPARC)          GET DCB ADDR FROM PARM LIST      18300000
         L     RCORE,QFOUR(RWTGC)      GET DCB WORK AREA ADDRESS        18400000
         LA    RDCB,Z0(RDCB)           ZERO OUT HIGH ORDER BYTE         18500000
         L     RDEB,DCBDEBAD           GET ASSOCIATED DEB ADDRESSY02898 18530002
         L     RTCB,DEBTCBAD           GET CURRENT TCB ADDRESS   Y02898 18560002
         LA    RF,D07                  GET DBLWD LENGTH OF IOB & CCWS   18600000
         CLI   DCBFUNC,INTRPRET        IS THIS AN INTERPRET FILE        18700000
         BNE   NOPN22                  NO, BRANCH                       18800000
         SR    RUCB,RUCB               CLEAR RUCB              @ZA01875 18850003
         LH    RUCB,DCBBUFL            LOAD BUFFER LENGTH      @ZA01875 18900003
         CH    RUCB,DCBBLKSI           IS BUFL > OR = BLKSIZE  @ZA01875 18904003
         BNL   NOPN211                 YES - USE BUFL          @ZA01875 18908003
         LH    RUCB,DCBBLKSI           ELSE USE BLKSIZE        @ZA01875 18912003
NOPN211  EQU  *                                                @ZA01875 18916003
         LA    RUCB,D07(RUCB)          ROUND BUF LNG TO NEXT   @ZA01875 18920003
         SRL   RUCB,THREE              HIGHEST NUMBER DBL WDS  @ZA01875 18940003
         AR    RF,RUCB                 CALCULATE TOTAL JOB     @ZA01875 18960003
*                                      LENGTH                  @ZA01875 18980003
         B     NOPN24                  BRANCH                           19000000
NOPN22   EQU   *                                                        19200000
         TM    DCBFUNC,DPI             DPI BIT ON IN DCB                19300000
         BZ    NOPN24                  NO, BR                           19400000
         LA    RF,D10(RF)              ADD 80 BYTES TO LENGTH           19500000
NOPN24   EQU   *                                                        19600000
         STC   RF,DCBIOBL              STORE IOB LENGTH IN DCB          19700000
         TM    DCBCIND2,QSAM           QSAM BEING USED                  19800000
         BZ    BSAM                    NO, BR FOR BSAM                  19900000
         IC    RE,DCBBUFNO             GET NO. OF BUFFERS REQUIRED      20000000
         B     NOPN26                  BRANCH                           20100000
BSAM     EQU   *                                                        20200000
         IC    RE,DCBNCP               GET NUMBER OF CHANNEL PROGRAMS   20300000
         LTR   RE,RE                   HAS NUMBER BEEN SPECIFIED        20400000
         BNZ   NOPN26                  YES, BRANCH                      20500000
         LA    RE,ONE                  SUPPLY ONE IOB                   20600000
         STC   RE,DCBNCP               SAVE NO. OF BUFFERS SUPPLIED     20700000
NOPN26   EQU   *                                                        20800000
         TM    DCBFUNC,PRINTW          PRINT BIT ON                     20900000
         BZ    NOPN27                  NO, BR                           21000000
         TM    DCBFUNC,PRINTX          3525 PRINTER BIT ON              21100000
         BO    NOPN30                  YES, BR                          21200000
         B     NOPN28                  BRANCH                           21300000
NOPN27   EQU   *                                                        21400000
         CLI   DCBFUNC,INTRPRET        INTERPRET FILE                   21500000
         BE    NOPN30                  YES, BRANCH                      21600000
         B     NOPN29                  OTHERWISE, CK FOR OTHER CASES    21700000
NOPN28   EQU   *                                                        21800000
         CLI   DCBFUNC,PRINTW          PRINT ONLY FILE                  21900000
         BE    NOPN30                  YES, BR                          22000000
NOPN29   EQU   *                                                        22100000
         TM    DCBCIND2,QSAM           QSAM DATA SET                    22200000
         BZ    BSAM1                   NO, BRANCH FOR BSAM              22300000
         LA    RE,ONE                  SUPPLY ONE IOB                   22400000
         STC   RE,DCBBUFNO             STORE BUFNO IN DCB               22500000
         B     NOPN30                  BRANCH                           22600000
BSAM1    EQU   *                                                        22700000
         LA    RE,ONE                  SUPPLY ONE IOB                   22800000
         STC   RE,DCBNCP               STORE IN DCB NO. CHAN. PROGS.    22900000
NOPN30   EQU   *                                                        23000000
         SLL   RF,3                    CHANGE FROM DBLWD TO BYTES       23100000
         LR    RUCB,RE                 SAVE NO. AS COUNTER              23200000
         MR    RE,RE                   COMPUTE SPACE REQUIRED           23300000
         LR    RB,RF                   SAVE FOR FUTURE USED             23400000
*  THE FOLLOWING SAVES THE AMOUNT OF CORE GETMAINED FOR THE    @YM06153 23420002
*  IOBS, IN THE FORCE CLOSE AUDIT TRAIL FOR THE FORCE CLOSE    @YM06153 23440002
*  EXECUTOR.                                                   @YM06153 23460002
**                                                                   ** 23500000
         ST    RF,DXATEXC2             SAVE IOB LENGTH         @YM06153 23550002
*                                                                Y02898 23600002
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER KEY           @YM05576 23610002
*                                                                Y02898 23640002
         GETMAIN R,LV=(RF),SP=250      GET CORE FOR IOB'S      @YM06153 23650002
**                                                                   ** 23700000
*                                                                     * 23800000
         LR    RJ,RB                   RESTORE LENGTH TO CLEAR          23900000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 23930002
*                                      KEY                       Y02898 23960002
         ST    RF,DCBIOBA              SAVE FIRST IOB ADDRESS           24000000
         OI    FCAOPEN,FCAOIOB         INDIC IOBS CAN BE FREED @YM06153 24050002
         BCTR  RJ,RE                   REDUCE AMOUNT BY ONE             24100000
         LA    RC,D255                 GET MAX AMT BE CLEARED  @YM06153 24200002
         MODESET KEYADDR=DXUKEY,WORKREG=12 USER KEY            @YM06153 24250002
COMPARE  EQU   *                                                        24300000
         CR    RJ,RC                   IS AMT TO CLEAR GT 255  @YM06153 24400002
         BC    12,ONECLEAR             NO,                              24500000
         EX    RC,CLEAR1               CLEAR 256 BYTES         @YM06153 24600002
*                                                                       24700000
         SR    RJ,RC                   AMT CLEARED - 255       @YM06153 24800002
         BCTR  RJ,RE                   SUBTRACT ONE MORE BYTE           24900000
         LA    RF,256(RF)              UPDATE AREA ADDRESS              25000000
         B     COMPARE                 TRYN AGAIN                       25100000
*                                                                       25200000
CLEAR1   XC    Z0(ONE,RF),Z0(RF)       CLEAR INSTRUCTION                25300000
*                                                                       25400000
ONECLEAR EQU   *                                                        25500000
         EX    RJ,CLEAR1               CLEARS LESS THAN 256             25600000
*                                                                       25700000
*********************************************************************** 25800000
*                                                                       25900000
         L     RB,DCBIOBA              GET IOB ADDRESS                  26000000
         LR    RC,RB                   SET UP WORK REGISTERS            26100000
         LR    RD,RB                                                    26200000
NOPN31   EQU   *                                                        26300000
         LTR   RUCB,RUCB               HAVE ALL IOB'S BEEN GENERATED    26400000
         BNZ   NOPN33                  NO. BRANCH                       26500000
*                                                                       26600000
         L     RB,DCBIOBA              GET FIRST IOB ADDRESS            26700000
         ST    RB,0(RD)                LINK FIRST IOB TO LAST IOB       26800000
         OI    0(RB),FIRSTIOB          SET INDICATOR                    26900000
         B     NOPN61                  BRANCH                           27000000
*                                                                       27100000
NOPN33   EQU   *                                                        27200000
*********************************************************************** 27300000
*                                                                       27400000
**             LINK  IOB'S  TOGETHER                                    27500000
*                                                                       27600000
*********************************************************************** 27700000
*                                                                       27800000
         ST    RB,0(RD)                LINK THIS IOB TO LAST IOB        27900000
         LR    RD,RB                   UPDATE WORK REGISTER             28000000
         LA    RB,QFOUR(RB)            POINT TO ECB                     28100000
         OI    0(RB),SUCCFUL           SET ECB COMPLETE WITHOUT ERROR   28200000
         ST    RB,D12(RD)              STORE ECB IN POINTER             28300000
         LA    RC,D20(RB)              PT TO CHAN PROG START ADDR       28400000
*                                                                       28500000
         LA    RB,D16(RC)              POINT TO CHANNEL PROGRAM         28600000
         ST    RB,Z0(RC)               PUT CHAN PROG ADDR IN IOB        28700000
         MVC   QFOUR(QFOUR,RC),DXUDCBAD PUT DCB ADDRESS IN IOB   Y02898 28800002
*                                                                Y02898 28850002
         MVI   D13(RC),ONE             STORE INCREMENT AMOUNT           28900000
         LR    RC,RB                   UPDATE WORK REGISTER             29000000
*                                                                       29100000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 29130002
*                                      KEY                       Y02898 29160002
         TM    DCBCIND2,QSAM           IS THIS A QSAM DCB               29200000
         BZ    NOPN37                  NO, BRANCH                       29300000
         TM    DCBRECFM,UNDFIND        UNDEFINED FORMAT                 29400000
         BNO   NOPN36                  NO, BRANCH                       29500000
         TM    DCBRECFM,FIXED           FIXED FORMAT                    29600000
         BZ    NOPN36                  NO, BRANCH                       29700000
         MVC   DCBBLKSI(TWO),DCBLRECL  REDUCE BLK SIZE TO LOG SIZE      29800000
NOPN36   EQU   *                                                        29900000
         NI    DCBRECFM,BLKBITOF       TURN OFF BOLCKED BIT IF ON       30000000
NOPN37   EQU   *                                                        30100000
         TM    DCBRECFM,ASCII          ASCII CONTROL CHAR. USED         30200000
         BZ    NOTASA                  NO,BRANCH                        30300000
         MVI   DCBCNTRL+THREE,QFOUR    MOVE ID                          30400000
         B     AROUND                  BRANCH                           30500000
NOTASA   EQU   *                                                        30600000
         MVI   DCBCNTRL+THREE,QTHREE   MOVE ID                          30700000
AROUND   EQU   *                                                        30800000
         MODESET KEYADDR=DXUKEY,WORKREG=15                     @YM05576 30830002
         OI    D08(RD),CC              SET CC FLAG ON IN IOB            30900000
*                                                                       31000000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 31030002
*                                      KEY                       Y02898 31060002
         MVI   DCBWCPO,X28             SET WRITE CHAN PROG OFFSET       31100000
         MVC   DCBWCPL(THREE),DCBWCPO  SET WRITE CHAR PROG LGTH         31200000
*********************************************************************** 31300000
*                                                                       31400000
**             BUILD CCW'S FOR IOB                                      31500000
*                                                                       31600000
*********************************************************************** 31700000
         CLI   DCBFUNC,READ            READ ONLY FILE                   31800000
         BE    NOPN52                  YES, BR                          31900000
         CLI   DCBFUNC,NOFUNC          IS THERE ANY DCB FUNC= PARAMETER 32000000
         BE    NOPN52                  NO, BRANCH                       32100000
         TM    DCBFUNC,PRTONLY         PRINT ONLY DATA SET              32200000
         BM    NOPN40                  NO, BR                           32300000
*********************************************************************** 32400000
*                                                                       32500000
**             BUILD CCW'S FOR PRINT ONLY FILE                          32600000
*                                                                       32700000
*********************************************************************** 32800000
         MODESET KEYADDR=DXUKEY,WORKREG=15    USER KEY         @YM05576 32830002
         MVI   Z0(RB),FDSS             SET FEED, SS AND IN CCW OP CODE  32900000
         OI    QFOUR(RB),SLICC         SET SLI AND CMD CHAIN FLAGS ON   33000000
         ST    RB,D24(RD)              STORE CCW PTR IN IOB             33100000
         B     NOPN49                  BRANCH                           33200000
NOPN40   EQU   *                                                        33300000
         CLI   DCBFUNC,INTRPRET        IS THIS AN INTERPRET FILE        33400000
         BNE   NOPN40A                 BRANCH IF NOT INTERPRET FILE     33500000
*********************************************************************** 33600000
*                                                                       33700000
**             BUILD CCW'S FOR INTERPRET FILE                           33800000
*                                                                       33900000
*********************************************************************** 34000000
         MODESET KEYADDR=DXUKEY,WORKREG=15     USER KEY        @YM05576 34030002
         MVI   Z0(RB),NOP              SET NOP CMD. IN CCW              34100000
         OI    QFOUR(RB),CC            SET CMD CHAIN FLAG IN CCW        34200000
         MVI   D07(RB),ONE             SET BYTE COUNT OF ONE            34300000
         ST    RB,D24(RD)              STORE CCW PTS IN IOB             34400000
         LA    RB,D08(RB)              INCREMENT CCW PTR BY 8           34500000
         MVI   Z0(RB),WRFDSS           SET WR,FD,SS CMDS IN CCW OP      34600000
         OI    QFOUR(RB),SLICC         SET SLI AND CMD CHAIN FLAGS ON   34700000
         B     NOPN49                  BRANCH                           34800000
NOPN40A  EQU   *                                                        34900000
         TM    DCBFUNC,NOTRDPCH        IS ANYTHING SPEC OTHER THAN RP   35000000
         BM    NOPN51                  YES, BRANCH                      35100000
         TM    DISPSN(RPARC),OUTP                                       35200000
         BNO   NOPN43                  NO, BR                           35300000
OUTPUT   EQU   *                                                        35400000
*********************************************************************** 35500000
*                                                                       35600000
**             BUILD CCW'S FOR OUTPUT PORTION OF ASSOCIATED DATA SET    35700000
*                                                                       35800000
*********************************************************************** 35900000
         MODESET KEYADDR=DXUKEY,WORKREG=15    USER KEY         @YM05576 35930002
         MVI   Z0(RB),NOP              SET NOP CMD IN CCW               36000000
         OI    QFOUR(RB),CC            SET CMD CHAIN FLAG IN CCW        36100000
         MVI   D07(RB),ONE             SET BYTE COUNT OF ONE            36200000
         LA    RB,D08(RB)              POINT TO NEXT CCW                36300000
         TM    DCBMODE,DATA2           IS DATA MODE 2 SPECIFIED         36400000
         BNO   NOPN42                  NO, BRANCH                       36500000
         OI    0(RB),MODE2             NO, SET MODE 2 MODIFIER IN CCW   36600000
NOPN42   EQU   *                                                        36700000
         OI    0(RB),WRFDSS            SET WR,FD,SS CMD IN CCW          36800000
         OI    QFOUR(RB),SLI           SET SLI FLAG ON IN CCW           36900000
         TM    DCBSTACK,POCKET2        IS STACKER 2 SPECIFIED           37000000
         BNO   NOPN45                  NO, BRANCH                       37100000
         OI    Z0(RB),STACK2           TURN ON SS 2 INDICATOR           37200000
         B     NOPN45                  BRANCH                           37300000
*                                                                       37400000
NOPN43   EQU   *                                                        37500000
*********************************************************************** 37600000
*                                                                       37700000
**             SET UP INPUT PORTION OF CCW FOR ASSOCIATED DATA SET      37800000
*                                                                       37900000
*********************************************************************** 38000000
         MODESET KEYADDR=DXUKEY,WORKREG=15      USER KEY       @YM05576 38030002
         TM    DCBMODE,RCEMASK         IS RCE SPECIFIED                 38100000
         BNO   NOPN43A                 NO, BRANCH                       38200000
         OI    0(RB),OMRRCE            TURN ON OMR OR RCE FLAG          38300000
NOPN43A  EQU   *                                                        38400000
*                                                                       38500000
         TM    DCBMODE,DATA2           IS DATA MODE 2 SPECIFIED         38600000
         BNO   NOPN44                  NO, BRANCH                       38700000
         OI    0(RB),MODE2                                              38800000
NOPN44   EQU   *                                                        38900000
         OI    0(RB),READONLY          SET READ ONLY CMD IN CCW         39000000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG                 39100000
NOPN45   EQU   *                                                        39200000
         NI    D08(RD),CCOFF           TURN CMD CHAIN FLAG OFF IN IOB   39300000
*                                                                       39400000
*                                                                       39500000
*                                                                       39600000
         TM    DCBCIND2,QSAM           IS THIS A QSAM DCB               39700000
         BO    NOPN48                  YES, BRANCH                      39800000
*                                                                       39900000
         LA    RB,D08(RB)              UPDATE CHANNEL PROG. BY 1 CCW    40000000
*                                                                       40100000
NOPN48   EQU   *                                                        40200000
         MODESET KEYADDR=DXUKEY,WORKREG=15   USER KEY          @YM05576 40230002
NOPN480  EQU   *                                               @YM06152 40260002
         LA    RB,D08(RB)              UPDATE CHANNEL PROG BY 1 CCW     40300000
         MVI   D37(RD),Z0              CLEAR INCREMENT AMOUNT           40400000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 40530002
*                                      KEY                       Y02898 40560002
         MVI   DCBWCPL,TWO             CHAN PROG IN DOUBLEWRDS @YM05576 40580002
         CLI   DCBFUNC,INTRPRET        INTERPRET FILE                   40600000
         BNE   NOPN48A                 NO, BRANCH                       40700000
         MVI   DCBWCPL,THREE           CHAN PROG IN DOUBLEWORDS         40800000
NOPN48A  EQU   *                                                        40900000
         BCTR  RUCB,RE                 DECREMENT COUNTER                41000000
         SR    RC,RC                   CLEAR RC                @ZA01875 41010003
         IC    RC,DCBIOBL              IOB DBL WD LENGTH       @ZA01875 41020003
         SLL   RC,THREE                IOB BYTE LENGTH         @ZA01875 41030003
         LA    RB,Z0(RC,RD)            INCREMENT TO NEXT JOB   @ZA01875 41040003
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER KEY   @YM06152         41050002
         B     NOPN31                  GO BACK                          41100000
*                                                                       41200000
NOPN49   EQU   *                                                        41300000
*                                                                       41400000
         TM    DCBSTACK,POCKET2        IS STACKER 2 SPECIFIED           41500000
         BNO   NOPN50                  NO, BRANCH                       41600000
         OI    0(RB),STACK2            TURN ON STACKER 2 BIT            41700000
NOPN50   EQU   *                                                        41800000
         LA    RB,D08(RB)              INCRE CCW PTR BY 8               41900000
         MVI   Z0(RB),PRT              STORE PRINT CMD BYTE             42000000
         OI    QFOUR(RB),SLICC         SET SLI AND CMD CHAIN FLAGS ON   42100000
         TM    DCBFUNC,PRTONLY         IS THIS A PRINT ONLY DATA SET    42200000
         BM    NOPN50A                 NO, BRANCH                       42300000
         NI    QFOUR(RB),CCOFF         TURN OFF CC FLAG IN CCW, IF ON   42400000
NOPN50A  EQU   *                                                        42500000
         CLI   DCBFUNC,INTRPRET        IS THIS AN INTERPRET FILE        42600000
         BNE   NOPN48                  NO, BRANCH                       42700000
         LA    RB,D08(RB)              POINT TO NEXT CCW                42800000
         MVI   Z0(RB),PRT              SET PRINT CMD IN CCW             42900000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG                 43000000
         LA    RB,PRINTBUF(RB)         POINT TO NEXT IOB PAST PRINT BUF 43100000
         B     NOPN48                  BRNACH                           43200000
*                                                                       43300000
NOPN51   EQU   *                                                        43400000
*                                                                       43500000
         TM    DCBFUNC,INTORPCH        INTRP OR PH FILE OF ANY KIND     43600000
         BM    NOPN58                  YES, BRANCH                      43700000
         TM    DCBFUNC,READPRT         IS THIS A RD/PRT ASSOC. DATA SET 43800000
         BNO   NOPN58                  NO, BRANCH                       43900000
*                                                                       44000000
NOPN52   EQU   *                                                        44100000
*                                                                       44200000
         MODESET KEYADDR=DXUKEY,WORKREG=15    USER KEY         @YM05576 44230002
         TM    DISPSN(RPARC),OUTP      OUTPUT FILE                      44300000
         BO    NOPN57                  YES, BRANCH                      44400000
*********************************************************************** 44500000
*                                                                       44600000
**             BUILD CCW'S FOR READ FILES WITH CNTRL                    44700000
*                                                                       44800000
*********************************************************************** 44900000
         TM    DCBMACRF,CNTRLB         CNTRL SPECIFIED FOR INPUT        45000000
         BNO   NOPN53                  NO, BRANCH                       45100000
         MVI   Z0(RB),NOP              SET NOP CMD IN CCW               45200000
         OI    QFOUR(RB),CC            SET CMD CHAIN FLAG ON IN CCW     45300000
         MVI   D07(RB),ONE             SET BYTE COUNT OF 1              45400000
         LA    RB,D08(RB)              POINT TO NEXT CCW                45500000
         MVI   Z0(RB),READONLY         SET A READ ONLY CMD              45600000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG IN CCW          45700000
         ST    RB,D24(RD)              STORE CHAN PROG START ADDR       45800000
         MODESET EXTKEY=DATAMGT    DATA MGMT KEY               @YM06152 45850002
         MVI   DCBOFFSR,FORTYATE       SET RD CCW OFFSET ACCORDINGLY    45900000
         MODESET KEYADDR=DXUKEY,WORKREG=15  USER KEY           @YM06152 45950002
         B     NOPN54                  BRANCH                           46000000
*                                                                       46100000
NOPN53   EQU   *                                                        46200000
*********************************************************************** 46300000
*                                                                       46400000
**             BUILD CCW'S FOR READ FILES WITHOUT CNTRL                 46500000
*                                                                       46600000
*********************************************************************** 46700000
*                                                                       46800000
         MVI   0(RB),RDFDSS            SET RD,FD,SS CMD IN CCW          46900000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG                 47000000
         NI    D08(RD),CCOFF           TURN OFF CMD CHAIN FLAG, IF ON   47100000
         ST    RB,D24(RD)              STORE CHAN PROG  START ADDR      47200000
NOPN54   EQU   *                                                        47300000
*                                                                       47400000
         TM    DCBMODE,DATA2           IS DATA MODE 2 SPECIFIED         47500000
         BNO   NOPN55                  NO, BRANCH                       47600000
         OI    0(RB),MODE2             SET MODE 2 BIT ON IN CCW OP CODE 47700000
NOPN55   EQU   *                                                        47800000
         TM    DCBSTACK,POCKET2        IS STACKER 2 SPECIFIED           47900000
         BNO   NOPN55A                 NO, BRANCH                       48000000
         OI    0(RB),STACK2            TURN ON STACKER 2 BIT IN OP CIDE 48100000
NOPN55A  EQU   *                                                        48200000
         TM    DCBMODE,OMR             IS OMR SPECIFIED FOR THIS DCB    48300000
         BO    NOPN56                  YES, BRANCH                      48400000
         TM    DCBMODE,RCE             IS RCE SPECIFIED                 48500000
         BNO   NOPN48                  NO, BRANCH                       48600000
NOPN56   EQU   *                                                        48700000
         OI    0(RB),OMRCEFLG          TURN OMR/RCE FLAG ON IN CCW OP   48800000
         B     NOPN48                  BRANCH                           48900000
NOPN57   EQU   *                                                        49000000
         MODESET KEYADDR=DXUKEY,WORKREG=15  SET USER KEY       @YM06152 49050002
         MVI   0(RB),NOP               SET NOP CMD. IN CCW              49100000
         OI    QFOUR(RB),CC            SET CMD CHAIN IN CCW             49200000
         MVI   D07(RB),ONE             SET BYTE COUNT OF ONE            49300000
         LA    RB,D08(RB)              POINT TO NEXT CCW                49400000
         NI    D08(RD),CCOFF           TURN OFF CC FLAG IF ON           49500000
         MVI   Z0(RB),PRT              SET PRT CMD IN CCW OP CODE       49600000
         OI    QFOUR(RB),SLI           TURN ON SLI FLAG IN CCW          49700000
         B     NOPN480                 BRANCH                  @YM06152 49800002
*                                                                       49900000
NOPN58   EQU   *                                                        50000000
         TM    DCBFUNC,XC9             IS THIS A PRT FILE OF ANY KIND   50100000
         BM    NOPN59                  NO, BR ANCH                      50200000
         TM    DCBFUNC,PHPRT           PH/PRT ASSOCIATED DATA SET       50300000
         BNO   NOPN59                  NO, BRANCH                       50400000
         B     NOPN60                  BRANCH                           50500000
*                                                                       50600000
NOPN59   EQU   *                                                        50700000
*                                                                       50800000
*        RD/PCH/PRT ASSOCIATED DATA SET ASSUMED                         50900000
*                                                                       51000000
         TM    DISPSN(RPARC),OUTP      IS THIS AN OUTPUT FILE           51100000
         BNO   NOPN43                  NO,BRANCH                        51200000
NOPN60   EQU   *                                                        51300000
         TM    DCBFUNC,PRINTX          PRINTER DEVICE SPECIFIED         51400000
         BO    NOPN57                  YES, BRANCH                      51500000
         B     OUTPUT                  BRANCH TO OUTPUT                 51600000
*                                                                       51700000
NOPN61   EQU   *                                                        51800000
         MODESET EXTKEY=DATAMGT        SET SYSTEM TO OPEN PROTECTY02898 51830002
*                                      KEY                       Y02898 51860002
         MVC   Z0(FIVE,RWTGC),IGG0197Q SET ID OF NEXT EXECUTOR          51900000
*                                                                     * 52000000
**                                                                   ** 52100000
*********************************************************************** 52200000
**                                                                   ** 52300000
*                                                                     * 52400000
RELOOP   EQU   *                                                        52500000
         LA    RWTGC,WGOFF(Z0,RWTGC)   INCRE CURR WTG ENTRY             52600000
         LA    RPARC,PLOFF(Z0,RPARC)   INCRE CURR DCB ENTRY PTR         52700000
         CLC   Z0(TWO,RWTGC),AMIDCNST  IS THIS ROUTINE NEEDED AGAIN     52800000
         BCR   RWTGC,RBASE             BAKC TO OPEN CONTROL ROUTINE     52900000
*                                                                       53000000
         CLC   Z0(TWO,RWTGC),OPIDCNST  END OF TABLE                     53100000
         BC    7,RELOOP                NO, CHECK NEXT ENTRY             53200000
*                                                                       53300000
         LR    RPARC,RPAR                                               53400000
         LA    RWTGC,WAOFF(Z0,RWTG)    REINITIALIZE WTG LIST PTR        53500000
ZCHEK    CLI   0(RWTGC),X'00'          IS ENTRY COMPLETE                53600000
         BC    7,TCTLRTN               NO, TRANSFER CONTROL             53700000
*                                                                       53800000
         LA    RWTGC,WGOFF(Z0,RWTGC)   GET NEXT ENTRY                   53900000
         LA    RPARC,PLOFF(Z0,RPARC)   GET NEXT ENTRY                   54000000
         B     ZCHEK                   ZERO CHECK                       54100000
*                                                                       54200000
TCTLRTN  EQU   *                                                        54300000
         MVC   SIX(TWO,RWTG),Z0(RWTGC) STORE ID IN WTG TABLE            54400000
         MVC   D14(THREE,RWTG),TWO(RWTGC) MOVE TTR INTO TABLE           54500000
*                                                                       54600000
         LA    RJ,DXCCW12              SET UP FOR XCTL                  54700000
**                                                                      54800000
         XCTL  DE=(RWTG),SF=(E,(15))                                    54900000
**                                                                      55000000
*                                                                       55100000
*********************************************************************** 55200000
*                                                                       55900000
WAOFF    EQU   32                                                       56000000
PLOFF    EQU   4                       OFFSET OF DCB ENTRIES            56100000
WGOFF    EQU   8                       OFFSET OF WTG ENTRIES            56200000
OPIDCNST DC    C'0S'                   ID                               56300000
AMIDCNST DC    C'7P'                   ID                               56400000
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     56500000
*                                                                       56700000
*********************************************************************** 56800000
*                                                                       56900000
*                                                                       57000000
*                                                                       57100000
ZAPSZAPS DC    8C'ZAPSZAPS'            WORK AREA USED BY OPEN    Y02898 57200002
IGG0197Q DC    C'7Q    '               IDTTRL                           57300000
*                                                                       57350002
*                                                                       57400002
         DCBD  DSORG=PS                                                 57800000
         IEZDEB                                                         57900000
         IECDSECS MAIN,EXPAND=YES                                Y02898 58000002
         IKJTCB                                                  Y02898 58060002
         IHARB                                                   Y02898 58120002
FORCORE  DSECT                                                 @YM06153 58140002
         IHAFCAUD  ORG=YES                                     @YM06153 58170002
         END                                                            58200000
