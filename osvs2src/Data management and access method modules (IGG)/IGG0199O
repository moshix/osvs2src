         TITLE 'IGG0199O - BSAM/QSAM SEARCH DIRECT ON DA EXEC'          00050002
IGG0199O CSECT                                                          00090020
*MODULE NAME - IGG0199O                                          Y02072 00092002
*                                                                       00094002
*DESCRIPTIVE NAME - BUILD IOBS                                   Y02072 00096002
*                                                                       00098002
*COPYRIGHT - NONE                                                Y02072 00098402
*                                                                       00098802
*CHANGE ACTIVITY - AS FOLLOWS:                                   Y02072 00099202
*                                                                       00099602
*          VS2 RELEASE 1.6 DELETIONS                                  * 00099702
*426000-426400,427600-428400                                    SA51532 00099802
*                                                                     * 00099902
*          VS2 RELEASE 2 DELETIONS                               Y02072 00100002
*019800,093000,232000,275000,276300,280000-280010,307600-307800, Y02072 00110002
*312000,337000,369000-375000,378000,408000,458800,466000-530000, Y02072 00120002
*537000,540000,561000-565000,568000,602000,624000-628000,        Y02072 00130002
*632000-637000,645000-649000,689000,92000,294000,313000,         Y02072 00132002
*575000-583000,604000-612000                                     Y02072 00134002
*                                                                YM1378 00134402
*                                                                YM1158 00134802
*                                                                YM3176 00136802
*                                                                YM4640 00136902
*                                                                YM7595 00138902
*          VS2 RELEASE 03 DELETIONS                                     00139302
*                                                                       00139403
*                                                              @Z30TSCF 00139503
*D302500                                                        ZA01496 00139702
*A305500                                                        ZA01496 00139802
*A305500                                                        ZA01496 00140003
*                                                                       00140103
*          RELEASE 20 DELETIONS                                       * 01500020
*                                                                S20201 01550020
*          RELEASE 21 DELETIONS                                       * 01600020
*0335042000,566000,589000-591000,613000-619000,689000-690000     S21042 01650021
*                                                                       01950020
*STATUS CHANGE LEVEL 002                                                01980002
*                                                                       02010020
* FUNCTION/OPERATION--FOR DCBS BEING OPENED FOR INPUT WITH SEARCH DIR.  02310020
*      IT WILL LINK THE IOB'S AND INITIALIZE THEM.                      02700020
*      IT WILL CONSTRUCT CHANNEL PROGRAMS NEEDED FOR PROPER EXECUTION.  02800020
*      IT WILL SET UP THE NUMBER OF EXTENTS NEEDED AND PLACE THE        02900020
*      ADDRESSES IN THE DCB AND IOB'S.                                  03000020
*                                                                       03100020
*      THIS MODULE WAS CREATED NEW WITH BASE IGG0191O IN RLSE 20        03110020
*                                                                       03120020
*ENTRY POINTS--ENTERED FROM IGG0191D BY USE OF THE XCTL MACRO.          03200020
*                                                                       03300020
*INPUT--SEE DESCRIPTION OF REGISTERS, DCB(USERS).                       03400020
*OUTPUT--IOB(USER), SEE DESCRIPTION OF THE REGISTERS, DCB(USERS)        03500020
*                                                                       03600020
*                                                                       03700020
*EXTERNAL ROUTINES--NONE.                                               03800020
*                                                                       03900020
*EXITS-NORMAL--XCTL TO IGG01915 TO LOAD ROUTINES                        04000020
*                                                                       04100020
*EXITS-ERROR--XCTL TO PROBLEM DETERMINATION FOR WTP AND 013 ABEND       04160021
*            INSUFFICIENT BUFFERS AVAILABLE IN                          04220021
*            BUFFER POOL TO SATISFY DCB BUFFER REQUIREMENTS       M1552 04300020
*                                                                       04350002
*MACROS-ACTION--MODESET, XCTL, XCTLTABL, DMABCOND                Y02072 04360002
*                                                                       04370002
*MACROS-MAPPING--IHACCW,DCBD,IECDSECS(IOB,WTG),IGGBCB,IHAFCAUD          04380002
*                                                                       04400020
*TABLES/WORKAREAS-- WHERE TO GO TABLE  (WTG)                            04500020
*                                                                       04600020
*   BYTE 0-7   NAME                                                     04700020
*   BYTE 8-10  RELATIVE DISK ADDRESS (TTR) OF FIRST RECORD              04800020
*   BYTE 11    CONCATENATION NUMBER                                     04900020
*   BYTE 12    ZERO                                                     05000020
*   BYTE 13    ALIAS INDICATOR AND USER DATA FIELD DESCRIPTOR           05100020
*              ALIAS INDICATOR 1 BIT                                    05200020
*              NUMBER OF TTRS IN USERS DATA FIELD  2 BITS               05300020
*   BYTE 14-16 TTR OF FIRST TEXT RECORD                                 05400020
*   BYTE 17    ZERO                                                     05500020
*   BYTE 18-19 TTR OF NOTE LIST OR SCATTER LIST                         05600020
*   BYTE 20    TRANSLATION TABLE                                        05700020
*   BYTE 21    ZERO OR NUMBER OF ENTRIES IN THE NOTE LIST               05800020
*   BYTE 22-23 ATTRIBUTES                                               05900020
*   BYTE 24-26 TOTAL CONTIGUOUS MAIN STORAGE REQUIRED FOR MODULE        06000020
*   BYTE 27-28 LENGTH OF FIRST TEXT RECORD                              06100020
*   BYTE 29    LENGTH OF WTG TABLE  (IN DOUBLE WORDS)                   06200020
*   BYTE 30-31 PATH THROUGH LOADS OF ROUTINES                           06300020
*   BYTE 32-34 IDTTR OF EXECUTOR FOR 1ST DCB                            06400020
*   BYTE 35    WORKAREA ADDRESS FOR 1ST DCB                             06500020
*   BYTE 36-39 TABLE OF IDTTR'S                                         06600020
*                                                                       06700020
*        32+N(8)   IDTTR OF EXECUTOR FOR NTH DCB      (3 BYTES)         06800020
*                  WORKAREA ADDRESS FOR NTH DCB       (1 BYTE)          06900020
*                  IDTTR OF LAST ROUTINE  LOAD        (3 BYTES)         07000020
*                  NOT USED                           (1 BYTE)          07100020
*                                                                       07200020
*                                                                       07300020
*********************************************************************** 07400020
*ATTRIBUTES--REENTRANT,REUSABLE, RUNS IN SUPERVISOR STATE,       Y02072 07500002
*            RUNS IN USER KEY UNLESS OTHERWISE SPECIFIED.        Y02072 07550002
*                                                                       07600020
*                                                                       07700020
*********************************************************************** 07800020
*                                                                       07900020
*                                                                       08000020
*  REGISTER CONVENTIONS USED THROUGH OUT ALL OPEN PASSES                08100020
*                                                                       08200020
*********************************************************************** 08300020
*                                                                       08400020
RDCB     EQU   2                        DCB REGISTER                    08500020
RBASE    EQU   3                        BASE REGISTER                   08600020
RCORE    EQU   4                        WORK AREA ADDRESS               08700020
RPAR     EQU   5                        TOP OF PARAMETER LIST           08800020
RWTG     EQU   6                        TOP OF WTG TABLE                08900020
RPARC    EQU   7                        CURRENT PARAMETER               09000020
RWTGC    EQU   8                        CURRENT TRANS LOAD              09100020
RBUFADR  EQU   9                        MAINTAINS ADDR OF NEXT   Y02072 09150002
*                                         AVAILABLE BUFFER       Y02072 09160002
RWK1     EQU   10                       WORK REGISTER            Y02072 09300002
RDEB     EQU   11                       DEB ADDRESS                     09400020
RB       EQU   12                       WORK REG1  **                   09500020
RC       EQU   13                       WORK REG2  **  IOB GENERATION   09600020
RWK2     EQU   RC                       WORK REGISTER            Y02072 09650002
RD       EQU   14                       WORK REG3  **                   09700020
RJ       EQU   15                       WORK REG4                       09800020
RWK3     EQU   RJ                       WORK REG                 YM7595 09850002
CPR      EQU   RJ                       ADDR OF CHANNEL PROG            09900020
RE       EQU   0                        WORK REG5                       10000020
RF       EQU   1                        WORK REG6                       10100020
RCCWAD   EQU   RF                       PTR TO COUNT FIELD FOR   Y02072 10110002
*                                       SEARCH DIRECT            Y02072 10200002
*                                                                       10300020
PARAR    EQU   RPARC                                                    10400020
*                                                                       10500020
*********************************************************************** 10600020
*                                                                       10610020
* DISPLACEMENTS AS EQUATES                                              10620020
*                                                                       10630020
D0       EQU   0                        DISPLACEMENT OF ZERO            10640020
D1       EQU   1                        DISPLACEMENT OF ONE             10650020
D4       EQU   4                        DISPLACEMENT OF FOUR            10660020
D6       EQU   6                        DISPLACEMENT OF SIX             10670020
D7       EQU   7                        DISPLACEMENT OF SEVEN           10680020
D8       EQU   8                        DISPLACEMENT OF EIGHT           10690020
D16      EQU   16                       DISPLACEMENT OF SIXTEEN    DMOR 10700020
D24      EQU   24                       DISPLACEMENT OF 24              10710020
D28      EQU   28                       DISPLACEMENT OF TWENTYEIGHT     10720020
D31      EQU   31                       DISPLACEMENT OF THIRTYONE       10730020
D36      EQU   36                       DISPLACEMENT OF THIRTYSIX       10740020
D40      EQU   40                       DISPLACEMENT OF FORTY           10750020
D44      EQU   44                       DISPLACEMENT OF FORTYFOUR       10760020
D47      EQU   47                       DISPLACEMENT OF FORTYSEVEN      10770020
D48      EQU   48                       DISPLACEMENT OF 48              10780020
D64      EQU   64                       DISPLACEMENT OF 64              10790020
*                                                                       10800020
* BYTE COUNTS AS EQUATES                                                10810020
*                                                                       10820020
B0       EQU   0                        BYTE COUNT OF ZERO              10830020
B1       EQU   1                        BYTE COUNT OF ONE               10840020
B8       EQU   8                        BYTE COUNT OF EIGHT             10850020
*                                                                       10860020
*********************************************************************   11000020
* MASK'S TO TEST PARAMETER LIST WITH                                    11100020
INP      EQU   X'0F'                                                    11200020
OUTP       EQU   X'0F'                                                  11300020
UPDATE     EQU   X'04'                                                  11400020
INOUT      EQU   X'03'                                                  11500020
OUTIN      EQU   X'07'                                                  11600020
RDBACK     EQU   X'01'                                                  11700020
*                                                                       11800020
*                                                                       11900020
*********************************************************************   12000020
*                                                                       12100020
*                                                                       12200020
* OFFSET FOR PARAMETER TESTS                                            12300020
*                                                                       12400020
ONE        EQU   X'01'                                                  12500020
FRTYATE    EQU   48                                                     12600020
DISPSN     EQU   X'0'                                                   12700020
*                                                                       12800020
*                                                                       12900020
*********************************************************************   13000020
*                                                                       13100020
* OFFSETS FOR DEB REFERENCE                                             13200020
*                                                                       13300020
*                                                                       13400020
BIN        EQU   36                     BIN NOS.                   DM0I 13500020
BEXT       EQU   38                     BIN EXTENT                 DM0I 13600020
*                                                                       13700020
*                                                                       13800020
*                                                                       13900020
*********************************************************************   14000020
*                                                                       14100020
* MASK'S USED TO TEST OPTION FIELDS IN DCB                              14200020
*                                                                       14300020
*                                                                       14400020
*                                                                       14500020
DOUBLE     EQU   X'01'                                                  14600020
*                                                                       14700020
*                                                                       14800020
STOWB      EQU   X'80'                                                  14900020
WRTCK      EQU   X'80'                  WRITE CHECK                DM0I 15000020
OVRFLO     EQU   X'20'                                                  15100020
PCI        EQU   X'20'                                                  15200020
MINKEY     EQU   X'01'                                                  15300020
CONCAT     EQU   X'FF'                                                  15400020
*                                                                       15500020
*********************************************************************   15600020
*                                                                       15700020
* MASKS FOR ACCESS METHODS IN SAM                                       15800020
*                                                                       15900020
QSAMB      EQU   X'01'                                                  16000020
BSAMBIT    EQU   X'00'                                                  16100020
PAM        EQU   X'02'                                                  16200020
*                                                                       16300020
*                                                                       16400020
* MASKS FOR MACRO'S TO BE USED                                          16500020
*                                                                       16600020
GETB       EQU   X'40'                                                  16700020
PUTB       EQU   X'40'                                                  16800020
READB      EQU   X'20'                                                  16900020
WRITEB     EQU   X'20'                                                  17000020
POINTB     EQU   X'04'                                                  17100020
CNTRLB     EQU   X'02'                                                  17200020
*                                                                       17300020
*                                                                       17400020
*********************************************************************   17500020
*                                                                       17600020
* MASKS FOR DEVICES TO BE SUPPORTED                                     17700020
*                                                                       17800020
SRCHDRK  EQU   X'40'                    SRCH DIRECT MASK                17830020
NOTSILI  EQU   X'DF'                    NOT SIL BIT MASK                17860020
NORCDRY  EQU   X'20'                    NO RCD READY FOR ENTIRE         17890020
*                                       DATA SET MASK                   17920020
TICSD    EQU   X'48'                    SEARCH DIRECT TIC               17950020
*                                                                       18000020
*********************************************************************   18100020
*                                                                       18200020
*                                                                       18300020
COFFSR   EQU   80                       OFFSET OF RD CCW IF             18310020
*                                       RPS USED                        18320020
SDOFFSR  EQU   72                       SD OFFSET TO RD DATA            18330020
CSTOFFSR EQU   72                       OFFSET OF RDCCW IF RCD          18340020
*                                       READY AND F-STD RCDS            18350020
SRCHD    EQU   X'40'                    SEARCH DIRECT MASK         DMOR 18360020
*                                                                  DMOR 18370020
*                                                                       18400020
*                                                                       18500020
*********************************************************************   18600020
*                                                                       18700020
* MASKS FOR STATUS BITS TO BE TESTED                                    18800020
*                                                                       18900020
*                                                                       19000020
EXCPN      EQU   X'30'                                                  19100020
COMPLETE   EQU   X'60'                  COMPLETE MASK              DM0I 19200020
FIRSTIOB   EQU   X'01'                                                  19300020
*                                                                       19400020
*                                                                       19500020
*                                                                       19600020
*********************************************************************   19700020
*                                                                       19800020
* MASKS FOR BUFFER TECHNIQUE'S                                          19900020
*                                                                       20000020
BFTEKR     EQU   X'20'                  BDAM VS                         20100020
VSBITS     EQU   X'48'                  VS BITS IN DCBRECFM             20200020
CYCLICB    EQU   X'20'                                                  20300020
EXCHANGB   EQU   X'10'                                                  20400020
SIMPLEB    EQU   X'40'                                                  20500020
EXCHCYCL   EQU   X'30'                                                  20600020
*                                                                       20700020
*********************************************************************   20800020
*                                                                       20900020
*                                                                       21000020
* MODES OF OPERATION FOR QSAM                                           21100020
*                                                                       21200020
LOCATEB    EQU   X'08'                                                  21300020
MOVEB      EQU   X'10'                                                  21400020
SUBSTUTB   EQU   X'04'                                                  21500020
*                                                                       21600020
*                                                                       21700020
*********************************************************************   21800020
*                                                                       21900020
*                                                                       22000020
* COMMAND BYTES FOR THE 2841                                            22100020
*                                                                       22200020
*       CONTROL UNIT                                                    22300020
*                                                                       22400020
*                                                                       22500020
*                                                                       22600020
SRCHE      EQU   X'31'                                                  22700020
WRTCKD     EQU   X'1D'                                                  22800020
RDC        EQU   X'92'                                                  22900020
RDKD       EQU   X'8E'                                                  23000020
RDD        EQU   X'86'                                                  23100020
MTRCT    EQU   X'92'                    M/T RD CNT CCW CMND             23230020
SETSC    EQU   X'23'                    SET SECTOR CCW CMND             23260020
RDSC     EQU   X'22'                    READ SECTOR CCW CMND            23290020
NOTFIXED EQU   X'40'                    V OR U FORMAT MASK              23320020
*                                                                       23350020
*                                                                       23400020
*********************************************************************   23500020
*                                                                       23600020
*                                                                       23700020
* MASKS FOR RECORD FORMATS                                              23800020
*                                                                       23900020
*                                                                       24000020
STANDRDF   EQU   X'88'                  STANDARD FORMORT           DM0I 24100020
FORMATU    EQU   X'C0'                                                  24200020
FORMATF    EQU   X'80'                                                  24300020
FORMATV    EQU   X'40'                                                  24400020
BLOCKED    EQU   X'10'                                                  24500020
*                                                                       24600020
*                                                                       24700020
*********************************************************************   24800020
*                                                                       24900020
*                                                                       25000020
*   CHANNEL CONTROL WORD FLAGS                                          25100020
*                                                                       25200020
SKIP       EQU   X'10'                                                  25300020
SLI        EQU   X'20'                                                  25400020
SLIBIT     EQU   X'DF'                  TO TURN OFF SLI BIT             25500020
CCWNOP     EQU   X'03'                  NOP                             25600020
CC         EQU   X'40'                                                  25700020
DATACH     EQU   X'A0'                                                  25800020
SLICC      EQU   X'60'                                                  25900020
SLICCSK    EQU   X'70'                                                  26000020
*                                                                       26100020
*                                                                       26200020
*********************************************************************   26300020
*                                                                       26400020
*                                                                       26500020
KEYS       EQU   X'01'                                                  26600020
QSAM       EQU   X'01'                                                  26700020
*                                                                       26800020
*                                                                       26900020
*********************************************************************   27000020
*                                                                       27100020
GETMAIN    EQU   4                                                      27200020
QSAMZ      EQU   X'05'                  MASK                       DM0I 27300020
NRMLEND    EQU   X'7F'                  NORMAL END CODE FOR ECB         27310020
SRCHDRCT   EQU   X'40'                  SEARCH DIRECT--DCBCIND1         27320020
POBIT      EQU   X'02'                  PARTITIONED ORGANIZATION        27330020
ABCODE     EQU   X'013'                  ABEND CODE                     27340020
COMMTABL   EQU   16                     MASK                       DM0I 27400020
NULL       EQU   0                      CONSTANT 0                      27410020
K2         EQU   2                      CONSTANT 2                      27510020
K3         EQU   3                      CONSTANT 3                      27520020
WORD       EQU   4                      LENGTH OF A FULL WORD           27530020
K5         EQU   5                      CONSTANT 5                      27540020
K6         EQU   6                      CONSTANT 6                      27550020
K7         EQU   7                      CONSTANT 7                      27551020
K8         EQU   8                      CONSTANT 8                      27560020
L1CCW      EQU   8                      LENGTH OF 1 CCW                 27600020
K12        EQU   12                     CONSTANT 12                     27610020
K14        EQU   14                     CONSTANT 14                     27620020
L2CCW      EQU   16                     LENGTH OF 2 CCW'S               27700020
K19        EQU   19                     CONSTANT 19                     27710020
K20        EQU   20                     CONSTANT 20                     27720020
K23        EQU   23                     CONSTANT 23                     27730020
L3CCW      EQU   24                     LENGTH OF 3 CCW'S               27800020
K24        EQU   24                     CONSTANT 24                     27810020
K28        EQU   28                     CONSTANT 28                     27820020
K31        EQU   31                     CONSTANT 31                     27830020
K32        EQU   32                     CONSTANT 32                     27840020
K36        EQU   36                     CONSTANT 36                     27850020
K39      EQU   39                       CONSTANT OF 39                  27870020
L5CCW      EQU   40                     LENGTH OF 5 CCW'S               27900020
K40        EQU   40                     CONSTANT 40                     27910020
K43        EQU   43                     CONSTANT 43                     27920020
CPLNGTH  EQU   56                       NON RCD READY CHP LNGTH         28010020
K64        EQU   64                     CONSTANT 64                     28020020
K80        EQU   80                     CONSTANT 80                     28030020
K83        EQU   83                     CONSTANT 83                     28040020
K104       EQU   104                    CONSTANT 104                    28050020
OABD064  EQU   64                                                S21042 28070021
ONEIOB   EQU   1                        USED TO CHECK FOR 1 IOB  YM1158 28070402
*********************************************************************   28100020
*                                                                       28200020
*                                                                       28300020
*                                                                       28400020
*                                                                       28500020
*                                                                       28600020
*                                                                       28800020
*                                                                       28900020
*                                                                       29000020
         BALR  RBASE,NULL               REG 3 IS BASE                   29100020
         USING SOP2,RBASE                                               29200020
         USING IHADCB,RDCB              REG 2 IS DCB                    29300020
         USING FORCORE,RCORE            REG 4 IS WORK AREA ADDR         29500020
SOP2     EQU   *                                                        30100020
         B     BEGIN                    BRANCH AROUND MODULE ID  YM4640 30101002
         DC    C'IGG0199O'              MODULE NAME              YM4640 30102002
         DC    C'@Z30TSCF'              LAST SHIP CODE         @Z30TSCF 30103003
         DC    C'10/22/74'              LAST SHIP DATE         @Z30TSCF 30104003
BEGIN    DS    0H                       END OF MODULE ID         YM4640 30105002
*                                                                       30200020
         L     RDCB,NULL(RPARC)         GET DCB ADDRESS                 30300020
         LA    RDCB,NULL(RDCB)          CLEAR HI BYTE                   30400020
         L     RCORE,WORD(RWTGC)        GET WORK AREA ADDRESS           30500020
         MODESET  KEYADDR=DXUKEY,WORKREG=10 GET INTO USER KEY   ZA01496 30550002
*                                                                       30600020
         L     RB,DCBIOBA               GET FIRST IOB ADDR              30700020
         LR    RC,RB                    SET UP WORK REG                 30800020
         LR    RD,RB                    SET UP WORK REG                 30900020
         SR    RF,RF                    CLEAR FOR IC                    31000020
         TM    DCBCIND2,QSAMB           QSAM USED                       31050020
         IC    RF,DCBNCP                GET NO OF IOB'S                 31100020
         BNO   SOP230                   BRANCH IF NO                    31130020
         IC    RF,DCBBUFNO              USE BUFFER NO FOR IOB CNT       31160020
SOP230   EQU   *                                                        31400020
         LR    RDEB,RF                  PUT CNT IN DECR REG             31500020
SOPSTART EQU   *                                                        31600020
*                                                                       31700020
* START OF IOB BUILD ROUTINE                                            31800020
*                                                                       31900020
         SPACE 2                                                        32300020
*                                                                       32400020
SOP242   EQU   *                                                        32500020
*                                                                       32600020
         ST    RB,NULL(RD)              LINK NEW IOB TO LAST ONE BUILT  32700020
         LR    RD,RB                    UPDATE CURRENT IOB POINTER      32800020
         LA    RB,WORD(RB)              POINT TO ECB SLOT               32900020
         OI    NULL(RB),NRMLEND         SET ECB COMPLETE WITHOUT ERROR  33000020
         ST    RB,K12(RD)               STORE ECB ADDR IN IOB           33100020
         LA    RB,K20(RB)               POINT TO CP POINTER SLOT        33200020
         LR    RC,RB                    SAVE ADDR                       33300020
         LA    RB,K24(RB)               POINT TO CP START ADDR          33400020
SOP243   EQU   *                                                        33500020
         ST    RB,NULL(RC)              STORE CP STARTAD IN IOB         33600020
         L     RWK1,DXUDCBAD            GET ADDR OF USERS DCB    Y02072 33700002
         USING IOBSIOCC,RWK2                                     Y02072 33750002
         ST    RWK1,IOBDCBPT            DCB ADDR TO IOB          Y02072 33760002
         DROP  RWK2                                              Y02072 33770002
         MVC   K40(L'DCBFDAD,RD),DCBFDAD  INITIALIZE IOBFDAD.           33800020
*                                                                       33900020
*********************************************************************** 34000020
*                                                                       34100020
*    CONSTRUCTION OF READ CHANNEL PROGRAM FOLLOWS                       34200020
*                                                                       34300020
*********************************************************************** 34400020
*                                                                       34500020
SOP255   EQU   *                                                        34600020
*                                                                       34700020
         LA    RC,K19(RC)               POINT TO CCHHR FIELD IN IOB     34800020
         TM    JFCBMASK+D6,NORCDRY      ANY NON RPS DEVICES             34820020
         BO    SOP2NC1                  BRANCH IF YES                   34840020
         BAL   RJ,SOP2STA               IF NOT GO BUILD SET SECTOR      34860020
SOP2NC1  EQU   *                                                        34880020
         ST    RC,NULL(RB)              STORE ADDR IN SRCH CCW          34900020
         MVI   NULL(RB),SRCHE           STORE CMD BYTE                  35000020
         MVI   K7(RB),K5                STORE COUNT OF 5 IN CCW         35100020
         OI    WORD(RB),CC              SET CMD CHAIN FLAG ON           35200020
         ST    RB,D8(RB)                PUT SEARCH ADDR IN TIC CCW DMOR 35300020
         LR    RC,RB                    UPDATE PTR                      35400020
         MVI   K8(RB),TICSD             PUT IN SEARCH DIRECT TIC        35500020
         SR    RE,RE                                              17363 35600020
         IC    RE,DCBKEYLE              OBTAIN KL                 17363 35700020
         AH    RE,DCBBLKSI              ADD DL                    17363 35800020
*     KL+DL TO RH OF TIC FOR USE BY EOB ROUT                      17363 35810020
         STH   RE,K14(RB)                                         17363 35900020
SOP255B  EQU   *                                                  17363 36000020
*                                                                       36100020
*                                                                       36200020
*     SRCH AND TIC CCWS HAVE BEEN GENERATED AT THIS POINT               36300020
*                                                                       36400020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 36410002
         MVI       DCBOFFSR,SDOFFSR     PUT OFFSET IN DCB               36500020
         TM    DCBMACRF,POINTB          POINT MACRO USED ON INPUT       36600020
         BZ    SOP255A0                 NO BRANCH                       36700020
         MVI   DCBCNTRZ,QSAMZ           MOVE ID                    DM0I 36800020
SOP255A0 EQU   *                                                 Y02072 36850002
         MODESET  KEYADDR=DXUKEY,WORKREG=10 GET INTO USER KEY    Y02072 36860002
         USING CPDEF,RB                 EST CHANNEL PGM BASE REG Y02072 36910002
         LA    RCCWAD,CPRDKD            POINT TO READ DATA CCW   Y02072 37600002
         ICM   RCCWAD,B'1000',TICCMD    INIT NEXT CCW TO A TIC   Y02072 37602002
*                                                                       37602402
*  IF THIS IS THE SECOND PHYSICAL IOB (FIRST LOGICAL IOB), THE   YM3176 37602502
*  CHANNEL PROGRAM ASSOCIATED WITH IT MUST BE ALTERED SO THAT    YM3176 37602602
*  THE SECOND TIC IS A READ COUNT TO KEEP THE CHANNEL PROGRAM    YM3176 37606202
*  FROM READING R0. THE FIRST I/O REQUEST FOR SEARCH DIRECT      YM3176 37608202
*  WOULD THEN OPERATE AS A SEARCH PREVIOUS REQUEST.              YM3176 37608602
*  IF ONLY ONE IOB IS BEING USED, ITS CHANNEL PROGRAM WILL BE    YM3176 37608702
*  ALTERED. THE CHAN PROG WILL BE RESET BY THE CHAN END APP      YM3176 37608802
*                                                                       37608902
         SR    RWK1,RWK1                PREPARE FOR IC INST      YM3176 37609602
         IC    RWK1,DCBNCP              NUM OF IOBS, ASSUME BSAM YM3176 37610002
         TM    DCBCIND2,DCBCNQSM        IS THIS QSAM             YM3176 37610402
         BZ    NUMCPOK                  NO, RWK1 CORRECT         YM3176 37610802
         IC    RWK1,DCBBUFNO            GET NUM IOBS, QSAM       YM3176 37611202
NUMCPOK  EQU   *                                                 YM3176 37611702
         CH    RWK1,CONONE              ONLY ONE IOB BEING USED  YM3176 37612102
         BE    BLDRDCNT                 YES, BUILD READ COUNT    YM3176 37612502
         L     RWK1,DCBIOBA             GET ADDR OF FIRST IOB    YM1378 37613502
         USING IOBQSAMN,RWK1            ESTABLISH IOB BASE REG   YM1378 37614002
         LA    RWK1,0(RWK1)             CLEAR HI-BYTE FOR COMP   YM3176 37624002
         LA    RD,0(RD)                 CLEAR HI-BYTE FOR COMP   YM3176 37626002
         CR    RD,RWK1                  IS CURRENT IOB THE FIRST YM1158 37631602
         BE    BUILDTIC                 DON'T BLD RD COUNT IF SO YM1158 37635202
         L     RWK1,IOBNIOBA            GET ADDR OF SECOND IOB   YM1378 37638802
         LA    RWK1,0(RWK1)             CLEAR HI-BYTE FOR COMP   YM3176 37640802
         DROP  RWK1                     DROP IOB BASE REGISTER   YM1378 37642402
         CR    RD,RWK1                  IS THIS IOB FOR RECORD 0 YM1378 37653202
         BNE   BUILDTIC                 BRANCH IF NOT            YM1378 37656802
*                                                                       37660402
BLDRDCNT EQU   *                                                 YM1158 37664002
         LA    RCCWAD,CPCOUNT2          PT TO SECOND COUNT FIELD Y02072 37667602
         TM    JFCBMASK+6,JFCNRPS       ANY DEVICES W/O RCD RDY  Y02072 37671202
         BO    NOTRPS                   BRANCH IF YES            Y02072 37674802
         LA    RCCWAD,L'CPRDSEC(,RCCWAD) INCR PAST RD SECTOR CCW Y02072 37678402
*                                                                       37682002
NOTRPS   EQU   *                                                 Y02072 37685602
         ICM   RCCWAD,B'1000',RDCNTCMD  CHANGE CCW TO READ COUNT Y02072 37689202
*                                                                       37692802
BUILDTIC EQU   *                                                 YM1378 37696402
         ST    RCCWAD,CPTIC2            SET UP CMND & DATA ADDR  Y02072 37700002
         DROP  RB                       DROP CHANNEL PGM BASE    Y02072 37702002
         MVI   K23(RB),K8               BYTE COUNT EQUALS EIGHT         37900002
         OI    K20(RB),CC               CMND CHAIN CCW                  38000020
*                                                                       40700020
         TM    DCBCIND2,QSAMB           QSAM USED                       40900020
         BO    SOP259                   YES BRANCH                      41000020
*                                                                       41100020
         CLI   DCBKEYLE,ONE             IS KEY LENGTH SPECIFIED         41200020
         BL    SOP259A                  NO BRANCH                       41300020
*                                                                       41400020
         MVI   K24(RB),RDKD             CCW CMND                        41500020
         B     SOP259C                  GO ATOUND                       41600020
*                                                                       41700020
SOP259   EQU   *                                                        41800020
         LA    RF,K24(RB)               ADDR OF CCW                     41900020
*                                                                       41950002
* FILL IN BUFFER ADDRESS AND BYTE COUNT                                 42000002
*                                                                       42050002
         L     RWK3,DCBBUFCB            BUFFER CNTRL BLK ADDR    YM7595 42100002
         USING BCBLK,RWK3                                               42150002
         L     RBUFADR,BCBBUFPT         ADDR OF NEXT AVAIL BUF   YM7595 42160002
         LTR   RBUFADR,RBUFADR          IS BUFFER AVAILABLE      YM7595 42170002
         BZ    BUFERR                   NO, ISSUE DMABCOND       YM7595 42180002
         USING CCW,RF                                                   42190002
         STCM  RBUFADR,B'0111',CCWADDRB  BUFFER ADDR TO CCW      YM7595 42192002
         MVC   CCWBYTE,DCBBLKSI         BYTE COUNT TO CCW        YM7595 42194002
         USING BUFFER,RBUFADR                                           42196002
         MVC   BCBBUFAD,BUFNXPTB        UPDATE BUF CNTRL BLOCK   YM7595 42198002
         DROP  RWK3,RBUFADR,RF                                          42198402
SOP259A  EQU   *                                                        42200020
         MVI   K24(RB),RDD              CCW COMMAND                     42300020
*                                                                       42400020
*                                                                       42440020
SOP259C  EQU   *                                                        42480020
*                                                                       42520020
         OI    D28(RB),CC               SET THE COMMAND CHAIN FLG       42560020
         TM    DCBRECFM,STANDRDF        IS IT F STANDARD                42680020
         BO    SOP259XB                 YES, BR AROUND SILI SETTING     42720020
         OI    D28(RB),SLI              SET SILI FLAG                   42880020
SOP259XB EQU   *                                                        42920020
         LA    RF,K40(RB)               CCHHR ADDR                      42960020
         TM    JFCBMASK+D6,NORCDRY      ANY DEVICES W/O RCD READ        43000020
         BO    SOP2NST                  BRANCH IF YES                   43040020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 43042002
         MVI   DCBOFFSR,COFFSR          PUT IN OFFSET TO RD CCW         43080020
*                                       IF RPS IS FEATURED              43120020
         MODESET  KEYADDR=DXUKEY,WORKREG=10 GET INTO USER KEY    Y02072 43140002
         LA    RF,K8(RF)                INCR ADDR BY EIGHT              43160020
SOP2NST  EQU   *                                                        43200020
*                                                                       43240020
         ST    RF,K32(RB)               ADDR TO CCW                     43280020
         MVI   K32(RB),MTRCT            CCW COMMAND                     43320020
*                                                                       43360020
         MVI   K39(RB),K8               BYTE COUNT EQS EIGHT            43400020
*                                                                       43440020
*                                                                       43480020
         TM    JFCBMASK+D6,NORCDRY      NOT STND F, BUT WITH RCD        43520020
*                                       READY                           43560020
         BO    SOP2NRR                  BRANCH IF NO                    43600020
         BAL   RJ,SOP2RTA               GO BUILD RD SECTOR CCW          43640020
SOP2NRR  EQU   *                                                        43680020
*                                                                       43720020
*******************************************************************DMOR 43760020
SOP259D  EQU   *                                                        43900020
         LA    RB,CPLNGTH(RB)           PT TO NEXT POSS IOB             43990020
SOP240   EQU   *                                                        44080020
         SH    RDEB,CONONE              DECR IOB COUNT             DMOR 44170020
         BP    SOPSTART                 IF MOR IOBS BRANCH              44260020
         L     RB,DCBIOBA               IF NOT LINK LAST TO FIRST  DMOR 44350020
         ST    RB,D0(RD)                PUT FIRST ADDR IN LAST     DMOR 44440020
         B     OFFSETRD                 GO AROUND INTERNAL SUBROUT DMOR 44530020
*                                                                       44620020
* SET SECTOR CCW BUILD RTN                                              44710020
*                                                                       44800020
SOP2STA  EQU   *                                                        44890020
         L     RE,DXCCW11               GET SET SECTOR ADDR             44980020
         ST    RE,D0(RB)                PUT IN CCW                      45070020
         MVI   D0(RB),SETSC             PUT IN CCW CMND                 45160020
         MVI   D7(RB),B1                SET BYTE CNT TO ONE             45250020
         OI    D4(RB),CC                TURN ON CMND CHAIN              45340020
         B     CMNDFIN                  GO TO FINISH DETAILS            45430020
*                                                                       45520020
* READ SECTOR CCW BUILD RTN                                             45610020
*                                                                       45700020
SOP2RTA  EQU   *                                                        45790020
         L     RE,DXCCW11               GET READ SECTOR ADDR     Y02072 45880002
         ST    RE,D40(RB)               PUT IN CCW                      45970020
         MVI   D40(RB),RDSC             PUT IN RD SECT CMND             46060020
         OI    D36(RB),CC               CMND CHAIN PREVIOUS CCW         46150020
         MVI   D47(RB),B1               SET BYTE CNT TO ONE             46240020
CMNDFIN  EQU   *                                                        46330020
         LA    RB,B8(RB)                INCR PTR                        46420020
         BR    RJ                       RETURN                          46510020
*                                                                       46560002
OFFSETRD EQU   *                                                 Y02072 46610002
*                                                                       46660002
         OI    NULL(RB),FIRSTIOB        SET INDICATOR ON FOR CLOSE      53100020
         LR    RC,RB                    SAVE ADDR FOR QSAM USE          53200020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 53210002
         SPACE                                                          53220002
         OI    FCAOPEN2,FCAOIOBC        IOBS COMPLETED           YM7595 53230002
         TM    DCBDSORG,DCBDSGPO        DCB FOR PO               Y02072 53260002
         BZ    SOP2ENDA                 NO, BRANCH               Y02072 53270002
         MVI   DCBCNTRZ,QSAMZ           FOR EXECS TO LOAD PAM RT Y02072 53280002
SOP2ENDA EQU   *                                                 Y02072 53290002
         TM    DCBRECFM,FORMATV         VARIABLE FORMAT            DM0I 53300020
         BZ    SOP2STOP                 BRANCH NOT V FORMAT        DM0I 53400020
         TM    DCBRECFM,FORMATF         FIXED FORMAT               DM0I 53500020
         BO    SOP2STOP                 YES, BRANCH                DM0I 53600020
         USING WTGENTRY,RWTGC                                    Y02072 53750002
         MVC   WTGIDTTR,SOPSLDVT        VAR, GET 1915          @Z30TSCF 53760003
         B     RELOOP                   BACK TO MAIN LINE          DM0I 53800020
SOP2STOP EQU   *                                                        53900020
         MVC   WTGIDTTR,SOPSLDFT        FIXED, GET 1910        @Z30TSCF 53950003
RELOOP   LA    RWTGC,WGOFF(RE,RWTGC)    INCREMENT CURR WTG ENTRY        54200020
         LA    RPARC,PLOFF(NULL,RPARC)  INCR CURRENT DCB ENTRY PRTR     54210020
         CLC   NULL(L'AMIDCNST,RWTGC),AMIDCNST  THIS RT NEEDED AGAIN    54400020
         BCR   RWTGC,RBASE              BACK TO OPEN CONTROL ROUTINDM0I 54500020
*                                                                       54600020
         CLC   NULL(L'OPIDCNST,RWTGC),OPIDCNST  END OF TABLE            54700020
         BNE   RELOOP                   NO,CHECK NEXT ENTRY             54800020
*                                                                       54900020
         LR    RPARC,RPAR                                               55000020
         LA    RWTGC,WAOFF(NULL,RWTG)   REINITIALIZE WTG LIST PTR       55100020
ZCHEK    CLI   NULL(RWTGC),NULL         IS THIS ENTRY COMPLETE          55200020
         BNE   TCTLRTN                  IF NOT TRANSFER CONTROL         55300020
*                                                                       55400020
         LA    RWTGC,WGOFF(NULL,RWTGC)  GET NEXT ENTRY                  55500020
         LA    RPARC,PLOFF(NULL,RPARC)                                  55600020
         B     ZCHEK                    TO ZERO CHECK              DM0I 55700020
*                                                                       55800020
TCTLRTN  EQU   *                                                        55900020
         USING WTG,RWTG                                                 55950003
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,            @Z30TSCF*56000003
               MODID=WTGENTRY                                  @Z30TSCF 56050003
         DROP  RWTGC,RWTG                                      @Z30TSCF 56100003
*                                                                       58500020
**********************************************************************  58600020
*                                                                    *  58700020
BUFERR   EQU   *                                                  M1552 58800020
         MODESET  EXTKEY=DATAMGT        BACK TO DATA MANAG KEY   Y02072 58810002
         DMABCOND OABD064,PDLOAD,RES=NO,REGSAVE=YES              S21042X58880021
                                        CALL PROBLEM DETERMINATION     X58960021
                                        TO ISSUE 013 ABEND              59040021
         B     TCTLRTN                  GO XCTL                  S21042 59120021
WAOFF    EQU   32                                                       59200020
PLOFF    EQU   4                        OFFSET OF DCB ENTRIES           59300020
WGOFF    EQU   8                        OFFSET OF WTG ENTRIES           59400020
OPIDCNST DC    C'0S'                    ID                         DM0I 59500020
AMIDCNST DC    C'9O'                    THIS ID                         59600020
*                                                                       59700020
*********************************************************************** 59800020
*      CONSTANTS AND RESERVED STORAGE.                                  59900020
*                                                                       60000020
*                                                                       60100020
CONONE   DC    H'1'                     CONSTANT OF ONE                 60300020
TICCMD   DC    X'08'                    COMMAND CODE FOR A TIC   Y02072 60302002
RDCNTCMD DC    X'92'                    CMND CODE FOR READ COUNT Y02072 60304002
SOPSLDFT DC    C'10',VL3(IGG01910)      FIXED LEN RECORDS      @Z30TSCF 60350003
SOPSLDVT DC    C'15',VL3(IGG01915)      VARIABLE LEN RECORDS   @Z30TSCF 60400003
PDLOAD   DC    C'6M',VL3(IGG0196M)      PROBLEM DETERMINATION  @Z30TSCF 60450003
         SPACE 2                                                        60500002
         DS    0H                       ALIGN PATCH AREA TO H.W. Y02072 60500402
PATCH    DC    50X'0'                   PATCH AREA               YM4640 60550002
END      EQU   *                        END OF MODULE            Y02072 60600002
         EJECT                                                          60610003
CVT      DSECT                                                 @Z30TSCF 60620003
         CVT                                                   @Z30TSCF 60630003
         EJECT                                                          60650002
         IHACCW  DSECT=YES                                       Y02072 60700002
         EJECT                                                          60750002
         IGGBCB  TYPE=SAM                                               60800002
         EJECT                                                          61600002
CPDEF    DSECT                          OFFSET READ CHANNEL PROG        62200020
CPSETSEC DS    0D                       SET SECTOR CCW           Y02072 62300002
CPSCH    DS    D                        SEARCH ID EQUAL                 62900020
CPTIC1   DS    D                        TIC TO SEARCH                   63000020
CPTIC2   DS    D                        TIC TO READ COUNT               63100020
CPRDKD   DS    0D                       READ (KEY) DATA                 63800020
RKDCC    DS    0X                       COMMAND CODE                    63900020
RKDDATAD DS    A                        DATA ADDR                       64000020
RKDFLAGS DS    BL1                      FLAGS                           64100020
         DS    1X                       NOT USED                        64200020
RKDBYTCT DS    2X                       BYTE COUNT                      64300020
CPRDCNT  DS    D                        READ COUNT CCW           Y02072 64302002
CPRDSEC  DS    0D                       READ SECTOR CCW          Y02072 64400002
CPCOUNT1 DS    D                        FIRST COUNT FIELD        Y02072 65000002
CPCOUNT2 DS    D                        SECOND COUNT FIELD       Y02072 65002002
           DCBD  DSORG=PS                                               65100020
DCBCNTRZ EQU   DCBCNTRL+1                                          DM0I 65200020
DCBCNTRX EQU   DCBCNTRL+3                                          DM0I 65300020
         EJECT                                                          65400002
         TITLE 'IGG0199O--FORMAT OF GOTTEN CORE'                        68600002
*                                                                       68700020
*                                                                       68800020
         IECDSECS (MAIN,(IOB,NO)),IOB,WTG,PREFX,EXPAND=YES     @Z30TSCF 68900003
         ORG   WTGIDTTR                                          Y02072 68950002
WTGID    DS    CL2                      NEXT MODS ID             Y02072 69000002
         EJECT                                                          69050002
FORCORE  DSECT                                                          69052002
         IHAFCAUD ORG=YES                                               69060002
           END                                                          69100020
