         TITLE 'IGG019FQ-EOB ROUTINE FOR ALL 3525 PRINT FILES'          00050037
         START                                                          00100037
*********************************************************************** 00150037
* AOS1 AND AOS2 ADDITIONS/CHANGES/DELETIONS                      Y01898 00200037
*A856000                                                          M1866 00250037
*D324000                                                        YA00439 00300037
*                                                              @ZA06630 00350037
*A033500,033700,036200,080500-080700,081100-081300,            @ZA32137 00370037
*A086500-086600,227600-227800                                  @ZA32137 00380037
*                                                                       00400037
*NAME--              IGG019FQ                                           00450037
*                                                                       00500037
*TITLE--             'IGG019FQ' - EOB ROUTINE FOR ALL 3525 PRINT FILES  00550037
*                                                                       00600037
*STATUS CHANGE LEVEL 000                                                00650037
*                    THIS MODULE WAS PUT INTO 'OS' RELEASE 21.0 AS A    00700037
*                    NEW MODULE                                         00750037
*                                                                       00800037
*MODULE TYPE--       END OF BLOCK                                       00850037
*                                                                       00900037
*FUNCTION/OPERATION--SAM END OF BLOCK ROUTINE FOR ALL 3525 PRINT        00950037
*                    FILES. IT TESTS FOR SEQUENCE FLAGS, IN THE CASE    01000037
*                    OF DEVICE ASSOCIATED DATA SETS, TO VERIFY PROPER   01050037
*                    ISSUANCE OF READ, PUNCH AND PRINT COMMANDS. IT     01100037
*                    INCREMENTS THE LINE POSITION COUNTER (DCBLNP) OR   01150037
*                    RESETS IT WHEN NECESSARY. MODIFIES COMMAND         01200037
*                    BYTE IN WRITE CCW TO INCICATE LINE ON WHICH        01250037
*                    PRINTING SHOULD BE DONE. IT SETS UP COMMAND        01300037
*                    BYTE IN THE CCW.  THE BUFFER ADDRESS AND RECORD    01350037
*                    LENGTH ARE PASSED FROM THE PUT OR WRITE ROUTINE.   01400037
*                    THE CHANNEL PROGRAM IS SCHEDULED WITH AN EXCP      01450037
*                    MACRO.                                             01500037
*                                                                       01550037
*ENTRY POINT--       IGG019FQ FROM WRITE OR PUT ROUTINES:               01600037
*                    LA    2,DCB                                        01650037
*                    LA    3,IOB                                        01700037
*                    L     15,76(DCB)       FOR BSAM                    01750037
*                    L     15,92(DCB)       FOR QSAM                    01800037
*                    BALR  14,15                                        01850037
*                                                                       01900037
*INPUT--             DCB ADDRESS IN REGISTER 1                          01950037
*                             DCBIOBA---IOB ADDRESS                     02000037
*                             DCBLNP----LINE POSITION COUNTER           02050037
*                             DCBDEBAD--DEB ADDRESS                     02100037
*                             DCBRECFM--RECORD FORMAT                   02150037
*                                                                       02200037
*OUTPUT--            IOB                                                02250037
*                    DCBLNP INCREMENTED OR RESET TO INCICATE LINE       02300037
*                             POSITION.                                 02350037
*                                                                       02400037
*EXTERNAL ROUTINES-- IOS SUPERVISOR (EXCP AND WAIT)                     02450037
*                                                                       02500037
*EXITS-NORMAL--      RETURN TO CALLING ROUTINE ON REGISTER 14.          02550037
*                                                                       02600037
*EXITS-ERROR--       003 - ABEND--ASSOCIATED DATA SET I/O SEQUENCE      02650037
*                    ERROR. RETURN CODE OF 3 IN REGISTER 15.            02700037
*                                                                       02750037
*TABLES/WORKAREA--   NONE                                               02800037
*                                                                       02850037
*ATTRIBUTES--        REENTRANT, REUSABLE                                02900037
*                                                                       02950037
*********************************************************************** 03000037
WRKR0    EQU   0                                                        03050037
WRKR1    EQU   1                                                        03100037
DCBR     EQU   2                       DCB ADDRESS UPON ENTRY           03150037
IOBAR    EQU   3                       IOB ADDRESS UPON ENTRY           03200037
BUFR     EQU   4                       BUFFER ADDRESS                   03250037
LENR     EQU   5                       LENGTH OF RECORD                 03300037
R5       EQU   5                       USED IN OIL AND NIL     @ZA32137 03350037
OPR      EQU   6                       COMMAND BYTE                     03360037
R6       EQU   6                       USED IN OIL AND NIL     @ZA32137 03370037
SAVR     EQU   13                                                       03400037
RETR     EQU   14                      CALLING ROUTINE RETURN ADDRESS   03450037
DEBR     EQU   7                       DEB ADDRESS                      03500037
WRKR2    EQU   5                        WORK REGISTER                   03550037
WRKR3    EQU   9                                                        03600037
R9       EQU   9                       USED IN OIL AND NIL     @ZA32137 03620037
RLINE    EQU   10                                                       03650037
BASR     EQU   15                      BASE REGISTER                    03700037
SAVE1    EQU   32                                                       03750037
SAVE9    EQU   64                                                       03800037
SAVE11   EQU   16                                                       03850037
SEQFLAG  EQU   X'08'                                                    03900037
SEQFLGOF EQU   X'F7'                                                    03950037
SEGCODE  EQU   X'02'                   FIRST BYTE OF SEGMENT CODE       04000037
ZERO     EQU   X'00'                                                    04050037
ONE      EQU   1                                                        04100037
USED     EQU   X'7F'                   DCB USED INDICATOR               04150037
IOBCC    EQU   X'40'                                                    04200037
IOBOV    EQU   X'80'                   IOB PRTOV INDICATOR              04250037
CLEAR    EQU   X'00'                   CLEAR BYTE MASK                  04300037
CCOFF    EQU   X'BF'                                                    04350037
SLI      EQU   X'20'                                                    04400037
FOUR     EQU   4                                                        04450037
CNTRL    EQU   X'02'                                                    04500037
COMCH    EQU   X'40'                   CCW COMMAND CHAIN BIT            04550037
RP       EQU   X'60'                                                    04600037
FORMV    EQU   X'40'                   VARIABLE RECORD FORMAT MASK      04650037
FORMU    EQU   X'C0'                   UNDEFINED RECORD FORMAT MASK     04700037
PRTOV    EQU   X'30'                   PRTOV MASK                       04750037
MCHAR    EQU   X'02'                   MACHINE CONTROL CHARACTER MASK   04800037
ASCII    EQU   X'04'                   ASCII CONTROL CHARACTER MASK     04850037
THRE     EQU   X'03'                                                    04900037
PW       EQU   X'30'                   PH/PRT    ASSOC. DATA SET MASK   04950037
RW       EQU   X'50'                                                    05000037
CHN9OF   EQU   X'20'                                                    05050037
CHN12OF  EQU   X'10'                                                    05100037
LINE17   EQU   X'11'                                                    05150037
LINE23   EQU   X'17'                                                    05200037
SPACE1   EQU   X'40'                                                    05250037
SPACE2   EQU   X'F0'                                                    05300037
SPACE3   EQU   X'60'                                                    05350037
SUPPRESS EQU   X'4E'                                                    05400037
SKCHAN1  EQU   X'F1'                                                    05450037
SKCHAN2  EQU   X'F2'                                                    05500037
SKCHAN10 EQU   X'C1'                                                    05550037
SKCHAN9  EQU   X'F9'                                                    05600037
SKCHAN12 EQU   X'C3'                                                    05650037
LNEDLT   EQU   X'07'                   MASK TO DELETE LINE CNT FROM CCW 05700037
TWENTY5  EQU   X'19'                                                    05750037
FDSS     EQU   X'23'                                                    05800037
T        EQU   X'02'                                                    05850037
PRTOV9   EQU   X'20'                   CHANNEL 9 MASK                   05900037
PRTOV12  EQU   X'10'                   CHANNEL 12 MASK                  05950037
LINE1    EQU   X'0D'                   PRINT LINE ONE OP CODE           06000037
OFMASK   EQU   X'CF'                   OVERFLOW MASK                    06050037
LINE18   EQU   18                                                       06100037
LINE24   EQU   24                                                       06150037
Z0       EQU   0                                                        06200037
D2       EQU   2                                                        06250037
A19      EQU   19                                                       06300037
*                                                                       06350037
IGG019FQ CSECT                                                          06400037
*                                                                       06450037
*                                                                       06500037
*                                                                       06550037
         USING IGG019FQ,BASR                                            06600037
         USING DEBBASIC,DEBR                                            06650037
         USING IHADCB,DCBR                                              06700037
         USING IOB,IOBAR                                                06750037
*                                                                       06800037
*        ENTRY POINT                                                    06850037
*                                                                       06900037
         STM   WRKR3,RLINE,SAVE9(SAVR)  SAVE REGS. 9 AND 10             06950037
         L     DEBR,DCBDEBAD           GET DEB ADDRESS                  07000037
PRNT1000 EQU   *                                                        07050037
         TM    DCBFUNC,PW              (RD/)PCH/PRT ASSOC. DATA SET     07100037
         BO    PRNT1100                YES, BR TO CK FOR PRINT SEQ FLAG 07150037
         TM    DCBFUNC,RW              READ/PRINT ASSOC. DATA SET       07200037
         BO    PRNT1400                YES, BR TO CK FOR PRT/RD SEQFLGS 07250037
         B     PRNT1500                BR TO TEST FOR CONTROL CHARACTRS 07300037
LEVELID  DC    C'04'                   MODULE LEVEL CONTROL             07350037
PRNT1100 EQU   *                                                        07400037
         TM    DCBQSWS,SEQFLAG         PRINT SEQUENCE FLAG ON           07450037
         BZ    PRNT1300                NO, BR TO CK FOR PUNCH SEQ. FLAG 07500037
PRNT1200 EQU   *                                                        07550037
         LA    WRKR1,CCW2OP            GET ADDRESS OF PRINT CCW         07600037
         ST    WRKR1,IOBSTAD           STORT PRINT CCW @ IN IOB AS PTR. 07650037
         B     PRNT1500                BR TO CK FOR CONTROL CHARACTERS  07700037
PRNT1300 EQU   *                                                        07750037
         CLC   DEBPDCBA(THRE),ZEROES   PUNCH DCB OPEN YET               07800037
         BE    PRNTWTP                 NO, BRANCH                       07850037
         L     DCBR,DEBPDCB            GET PUNCH DCB ADDRESS            07900037
         TM    DCBQSWS,SEQFLAG         PUNCH SEQUENCE FLAG ON           07950037
         BZ    PRNTWTP                 NO, BR TO WRITE ERROR MESSAGE    08000037
*                                      TRUN SEQUENCE FLAG OFF  @ZA32137 08050037
         NIL   DCBQSWS,SEQFLGOF,REF=DCBQSWS,WREGS=(R5,R6,R9)   @ZA32137 08070037
PRNT1350 L     DCBR,DEBDCBAD           GET CURRENT DCB ADDRESS AGAIN    08090037
*                                      TURN ON PRINT SEQ FLAG  @ZA32137 08110037
         OIL   DCBQSWS,SEQFLAG,REF=DCBQSWS,WREGS=(R5,R6,R9)    @ZA32137 08130037
         B     PRNT1200                BR TO PUT CCW ADDRESS IN IOB     08200037
PRNT1400 EQU   *                                                        08250037
         TM    DCBQSWS,SEQFLAG         PRINT SEQUENCE FLAG ON           08300037
         BO    PRNT1200                YES, BR TO SEE CHAN PROG START@  08350037
         CLC   DEBRDCBA(THRE),ZEROES   READ DCB OPEN YET                08400037
         BE    PRNTWTP                 NO, BRANCH                       08450037
         L     DCBR,DEBRDCB            GET READ DCB ADDRESS             08500037
         TM    DCBQSWS,SEQFLAG         READ SEQUENCE FLAG ON            08550037
         BZ    PRNTWTP                 NO, BR TO WRITE ERROR MESSAGE    08600037
*                                      TURN READ SEQ FLAG OFF  @ZA32137 08650037
         NIL   DCBQSWS,SEQFLGOF,REF=DCBQSWS,WREGS=(R5,R6,R9)   @ZA32137 08660037
         B     PRNT1350                BR TO TURN ON PRINT SEQ. FLAG    08700037
PRNT1500 EQU   *                                                        08750037
         LH    LENR,CCW1LN             LOAD BLOCK LENGTH                08800037
         L     BUFR,CCW1AD             LOAD BUFFER ADDRESS              08850037
         MVC   CCW2AD+ONE(THRE),CCW1AD+ONE MOVE BUF @ TO 2ND CCW        08900037
DDA2     EQU   *                                                        08950037
         TM    DCBRECFM,ASCII          ASCII SPECIFIED                  09000037
         BO    PRNT1550                YES, BRANCH                      09050037
         TM    DCBRECFM,MCHAR          MACHINE CONTROL SPECIFIED        09100037
         BZ    PRNT4000                NO, BRANCH                       09150037
         SR    OPR,OPR                 CLEAR WORK REG          @ZA06630 09200037
         SR    WRKR1,WRKR1             CLEAR WORK REG          @ZA06630 09250037
         IC    OPR,ZERO(BUFR)          OBTAIN MACHINE OP CODE  @ZA06630 09300037
         SRL   OPR,THRE                GET LINE NUMBER         @ZA06630 09350037
         IC    WRKR1,DCBLNP            LOAD LAST LINE PRINTED  @ZA06630 09400037
         CR    OPR,WRKR1               COMPARE CURRENT TO OLD  @ZA06630 09450037
         BH    DDA3                    IF CURRENT GREATER THAN @ZA06630 09500037
*                                      OLD, THEN BRANCH        @ZA06630 09550037
         MVI   DCBLNP,ZERO             ZERO TO FEED NEXT CARD  @ZA06630 09600037
DDA3     EQU   *                                               @ZA06630 09650037
         BCTR  LENR,Z0                 DECREMENT                        09700037
         IC    OPR,ZERO(BUFR)          GET CONTROL CHAR FORM BUFFER     09750037
         LA    BUFR,ONE(BUFR)          INCREMENT BUFFER ADDR BY 1       09800037
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             09850037
         BNZ   DDA4                    BRANCH IF ONE OR MIXED           09900037
         CLI   DCBLNP,ZERO             IS LINE POSITION EQUAL TO ZERO   09950037
         BNE   DDA31                   NO, BRANCH                       10000037
         LA    WRKR1,CCW1OP            GET ADDRESS OF FD,SS CCW         10050037
         ST    WRKR1,IOBSTAD           STORE PRINT CCW ADDR IN IOB      10100037
         B     DDA4                    BRANCH TO SET UP CCW             10150037
DDA31    EQU   *                                                        10200037
         LA    WRKR1,CCW2OP            GET ADDRESS OF PRINT CCW         10250037
         ST    WRKR1,IOBSTAD           STORE PRINT CCW @ IN IOB AS PTR  10300037
DDA4     EQU *                                                          10350037
         ST    BUFR,CCW2AD             STORE RECORD ADDRESS IN CCW      10400037
         NI    IOBIOS,CCOFF            TURN OFF CC FLAG IN IOB          10450037
         OI    CCW2FL,SLI              TURN ON SILI FLAG IN CCW         10500037
         STH   LENR,CCW2LN             RESTORE LENGTH                   10550037
         STC   OPR,CCW2OP              STORE CMD BYTE IN WRITE CCW      10600037
         SRL   OPR,3                   SHIFT OUT PRINT OP CODE          10650037
         STC   OPR,DCBLNP              STORE LINE POSITION IN DCB       10700037
         B     PRNT4300                BRANCH                           10750037
PRNT1550 EQU   *                                                        10800037
         L     WRKR2,CCW1OP            GET BUFFER ADDRESS               10850037
         LR    WRKR1,WRKR2             GET BUFFER ADDRESS               10900037
         LA    WRKR1,ONE(WRKR1)        INCREMENT BUFFER ADDRESS         10950037
         IC    OPR,CCW2OP              SAVE PRINT COMMAND BYTE          11000037
         ST    WRKR1,CCW2OP            STORE BUFFER ADDRESS IN CCW      11050037
         STC   OPR,CCW2OP              RESTORE OP CODE IN CCW           11100037
         SR    WRKR1,WRKR1             ZERO OUT WORK REGISTER FOR USAGE 11150037
         IC    WRKR1,DCBLNP            GET LINE COUNTER FROM DCB        11200037
         CLI   ZERO(WRKR2),SPACE1      IS CONTROL CHAR FOR SPACE 1      11250037
         BNE   PRNT1700                NO, BRANCH                       11300037
         LA    WRKR3,ONE               YES, GET COUNT OF ONE            11350037
PRNT1600 EQU   *                                                        11400037
         AR    WRKR1,WRKR3             INCREMENT LINE COUNTER           11450037
         CLI   DCBLNP,ZERO             LINE POSITION EQUAL ZERO         11500037
         BNE   PRNT3000                NO, BRANCH                       11550037
         STC   WRKR1,DCBLNP            UPDATE DCB LINE POSITION         11600037
PRNT1650 TM    DCBFUNC,RP              READ OR PUNCH BIT ON             11650037
         BNZ   PRNT3000                BRANCH ON ONE OR MIXED           11700037
         B    PRNT3200                 BRANCH TO SET UP CCW             11750037
PRNT1700 EQU   *                                                        11800037
         LA    WRKR3,D2                SET UP FOR LINE COUNT INCREMENT  11850037
         CLI   Z0(WRKR2),SPACE2        CONTROL CHARACTER FOR SPACE 2    11900037
         BE    PRNT1600                IF SO, INCREMENT LINE COUNT BY 2 11950037
PRNT1800 EQU   *                                                        12000037
         LA    WRKR3,THRE              SET UP FOR LINE COUNT INCREMENT  12050037
         CLI   Z0(WRKR2),SPACE3        CONTROL CHARACTER FOR SPACE 3    12100037
         BE    PRNT1600                IF SO, INCREMENT LINE COUNT BY 3 12150037
PRNT2000 EQU   *                                                        12200037
         CLI   ZERO(WRKR2),SKCHAN1     CONTROL CHAR FOR SKIP TO CHAN 1  12250037
         BNE   PRNT2100                NO, BRANCH                       12300037
PRNT2050 EQU   *                                                        12350037
         LA    WRKR1,ONE               EQUATE LINE COUNTER TO 1         12400037
         STC   WRKR1,DCBLNP            STORE LINE COUNT IN DCB          12450037
         B     PRNT3100                BRANCH                           12500037
PRNT2100 EQU   *                                                        12550037
         LA    RLINE,THRE              SET UP LINE COUNTER MASK         12600037
         LA    WRKR3,SKCHAN2           LOAD SKIP TO CHAN 2 MASK         12650037
         IC    ONE,ZERO(WRKR2)                                          12700037
PRNT2200 EQU   *                                                        12750037
         CR    WRKR3,ONE                                                12800037
         BH    PRNT2400                NO, MUST BE GREATER THAN CHAN 9  12850037
         BE    PRNT2300                YES, BR TO CK FOR VALIDITY       12900037
         LA    WRKR3,ONE(WRKR3)        INCRE SKIP MASK BY 1             12950037
         LA    RLINE,D2(RLINE)         INCRE LINE COUNTER MASK BY 2     13000037
         B     PRNT2200                BRANCH                           13050037
PRNT2300 EQU   *                                                        13100037
         CLI   ZERO(WRKR2),SKCHAN9     IS CHARACTER INVALID             13150037
         BNH   PRNT2350                NO, BRANCH                       13200037
PRNT2325 EQU   *                                                        13250037
         LA    WRKR3,ONE               YES, DEFAULT VALUE USED          13300037
         B     PRNT1600                BRANCH                           13350037
PRNT2335 EQU   *                                                        13400037
*                                                                       13450037
*                                                                       13500037
         CLI   ZERO(WRKR2),SKCHAN12     CONTROL CHARACTER VALID         13550037
         BH    PRNT2325                 NO INVALID CHAR. GO USE DEFAULT 13600037
PRNT2350 EQU   *                                                        13650037
         LR    WRKR1,RLINE             REFLECT LINE POS. IN LINE CTR.   13700037
         IC    RLINE,DCBLNP            SAVE CURRENT LINE POSITION       13750037
         STC   WRKR1,DCBLNP            STORE LINE COUNTER IN DCB        13800037
         LTR   RLINE,RLINE             LINE COUNTER EQUALS ZERO         13850037
         BZ    PRNT1650                YES, BRANCH                      13900037
         CR    WRKR1,RLINE             CURRENT LINE POS GT SKIP TO VALU 13950037
         BNH   PRNT3100                YES, BRANCH TO TEST FOR ASSOC DS 14000037
         B     PRNT2700                BRANCH                           14050037
PRNT2400 EQU   *                                                        14100037
         LA    RLINE,A19               LINE COUNTER MASK                14150037
         LA    WRKR3,SKCHAN10          LOAD SKIP TO CHAN 10 MASK        14200037
         LA    OPR,THRE                LOAD VALUE OF 3 INTO REG         14250037
         IC    ONE,ZERO(WRKR2)                                          14300037
PRNT2500 EQU   *                                                        14350037
         CR    WRKR3,ONE                                                14400037
         BE    PRNT2335                 YES BRANCH TO CK FOR VALIDITY   14450037
         LA    WRKR3,ONE(WRKR3)        NO, INCREMENT CHAN MASK          14500037
         LA    RLINE,D2(RLINE)         INCREMENT LINE CTR MASK          14550037
         BCT   OPR,PRNT2500             LOOP THREE TIMES                14600037
         B     PRNT2325                 INVALID CHAR. GO USE DEFAULT    14650037
PRNT2700 EQU   *                                                        14700037
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             14750037
         BZ    PRNT2750                NO, BRANCH                       14800037
         IC    WRKR1,DCBLNP            GET THE LINE COUNT               14850037
         SLL   WRKR1,3                 SHIFT COUNT FOR CCW INSERTION    14900037
         NI    CCW2OP,LNEDLT           DELETE LINE CNT FROM OP CODE     14950037
         IC    WRKR2,CCW2OP            GET CCW OP CODE                  15000037
         OR    WRKR2,WRKR1             OR LINE COUNT INTO OP CODE       15050037
         STC   WRKR2,CCW2OP            RESTORE OP CODE IN CCW           15100037
         B     PRNT2775                BRANCH TO FINISH CCW             15150037
PRNT2750 EQU   *                                                        15200037
         LA    WRKR1,CCW2OP            GET CCW ADDRESS                  15250037
         ST    WRKR1,IOBSTAD           LOAD CCW ADDR IN IOB             15300037
PRNT2760 EQU   *                                                        15350037
         IC    WRKR1,DCBLNP            GET LINE COUNT FROM DCB          15400037
         SLL   WRKR1,3                 SHIFT COUNT FOR CCW INSERTION    15450037
         NI    CCW2OP,LNEDLT           DELETE LINE CNT FROM OP CODE     15500037
         IC    WRKR2,CCW2OP            GET CCW OP CODE                  15550037
         OR    WRKR2,WRKR1             OR LINE COUNT INTO OP CODE       15600037
         STC   WRKR2,CCW2OP            RESTORE OP CODE IN CCW           15650037
PRNT2775 EQU   *                                                        15700037
         MVC   CCW2OP+FOUR(FOUR),CCW1OP+FOUR  SET UP REST OF WRITE CCW  15750037
         TM    DCBRECFM,ASCII          ASCII SPECIFIED          YA00436 15800037
         BNO   PRNT2780                NO, BRANCH               YA00436 15850037
         LH    LENR,CCW1LN             LOAD BLOCK LENGTH        YA00436 15900037
         BCTR  LENR,Z0                 DECREMENT BYTE CNT BY 1  YA00436 15950037
         STH   LENR,CCW2LN             RESTORE LENGTH IN CCW    YA00436 16000037
PRNT2780 EQU   *                                                YA00436 16050037
         OI    CCW2FL,SLI              TURN ON SILI FLAG IN CCW         16100037
         NI    CCW2FL,CCOFF            TURN OFF CC FLAG IN CCW          16150037
         B     PRNT4300                BRANCH                           16200037
PRNT2800 EQU   *                                                        16250037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 16300037
*                   PRINT OVERFLOW ROUTINE                              16350037
*           IF THE RIGHT OVERFOOW COND.EXIST A FEED SS WILL BE          16400037
*           PREFORMED BEFORE PRINTING ON LINE ONE OF NEXT CARD.         16450037
*                                                                       16500037
         TM    DCBDEVT+ONE,PRTOV9      OVERFLOW ON CH. 9                16550037
         BO    PRNT2810                YES, BRANCH                      16600037
         TM    DCBDEVT+ONE,PRTOV12     OVERFLOW ON CH. 12               16650037
         BNO   PRNT4400                NO, BRANCH TO PRINT A LINE       16700037
         TM    DCBIFLGS,PRTOV12        LINE 24 BEEN PRINTED ON          16750037
         BO    PRNT2820                YES,  BRANCH                     16800037
         B     PRNT4400                NO, BRANCH TO PRINT A LINE       16850037
PRNT2810 EQU   *                                                        16900037
         TM    DCBIFLGS,PRTOV9         LINE 18 BEEN PRINTED ON          16950037
         BNO   PRNT4400                NO, BRANCH TO PRINT A LINE       17000037
PRNT2820 EQU   *                                                        17050037
PRNT2900 EQU   *                                                        17100037
         TM    DCBFUNC,RP              IS THIS AN ASSOC. DATA SET       17150037
         BM    PRNTWTP                 YES, BRANCH                      17200037
         BO    PRNTWTP                 YES, BRANCH                      17250037
         MVI   CCW1OP,FDSS             MOVE IN A FEED STACKER EL. CMD.  17300037
         MVI   CCW1FL,COMCH            SET CMD. CHAIN ON IN CCW         17350037
         MVI   DCBDEVT+ONE,ZERO        RESET DCB PRTOV INDICATOR        17400037
         LA    WRKR1,CCW1OP            GET FIRST CCW ADDRESS            17450037
         ST    WRKR1,IOBSTAD           LOAD CCW START ADDR. IN IOB      17500037
         MVI   DCBLNP,ONE              RESET LINE POSITION CTR. TO ONE  17550037
         MVI   CCW2OP,LINE1            SET LINE IN PRT CCW OP CODE TO 1 17600037
         B     PRNT4400                BRANCH                           17650037
*                                                                       17700037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 17750037
PRNT3000 EQU   *                                                        17800037
         STC   WRKR1,DCBLNP            LOAD LINE CTR INTO DCB           17850037
         CLI   DCBLNP,TWENTY5          IS LINE CTR GREATER THAN 25      17900037
         BNH   PRNT2700                NO, BRANCH                       17950037
         B     PRNT2050                YES, BR TO GET DEFAULT VALUE     18000037
PRNT3100 EQU   *                                                        18050037
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             18100037
         BO    PRNTWTP                 BOTH ON, BRANCH FOR ERROR MSG.   18150037
         BM    PRNTWTP                 ONE  ON, BRANCH FOR ERROR MSG.   18200037
         OI    IOBIOS,IOBCC            TURN ON CC FLAG IN IOB           18250037
PRNT3200 EQU   *                                                        18300037
         SLL   WRKR1,3                 SHIFT COUNT FOR CCW INSERTION    18350037
         NI    CCW2OP,LNEDLT           DELETE LINE CNT FROM OP CODE     18400037
         IC    WRKR2,CCW2OP            GET CCW OP CODE                  18450037
         OR    WRKR2,WRKR1             OR LINE COUNT INTO OP CODE       18500037
         STC   WRKR2,CCW2OP            RESTORE OP CODE IN CCW           18550037
         LA    WRKR1,CCW1OP            GET CCW ADDRESS                  18600037
         ST    WRKR1,IOBSTAD           STORE CCW ADDRESS IN IOB AS PTR  18650037
         B     PRNT2775                BRANCH                           18700037
PRNT4000 EQU   *                                                        18750037
         TM    DCBFUNC,T               TWO-LINE PRINT SPECIFIED         18800037
         BO    PRNT4100                YES, BRANCH                      18850037
         CLI   DCBLNP,ZERO             LINE POSITION EQUALS ZERO        18900037
         BE    PRNT4200                YES, BRANCH                      18950037
         TM    DCBMACRF+ONE,CNTRL      CNTRL SPECIFIED IN DCB           19000037
         BO    PRNT2700                YES, BRANCH                      19050037
         CLI   DCBLNP,X'19'            LINE POSITION EQUALS 25          19100037
         BE    PRNT2900                YES, BRANCH                      19150037
PRNT4020 IC    WRKR1,DCBLNP            LOAD DCBLNCT IN REGISTER         19200037
         LA    WRKR1,ONE(WRKR1)        INCREMENT AMOUNT BY ONE          19250037
PRNT4050 STC   WRKR1,DCBLNP            RESTORE AMOUNT IN DCB            19300037
         B     PRNT2700                BRANCH                           19350037
PRNT4100 EQU   *                                                        19400037
         CLI   DCBLNP,ZERO             LINE POSITION EQUALS ZERO        19450037
         BE    PRNT4200                YES, BRANCH                      19500037
         CLI   DCBLNP,ONE              LINE POSITION EQUALS 1           19550037
         BNE   PRNT2900                NO, BRANCH                       19600037
         IC    WRKR1,DCBLNP            YES, LOAD LINE CTR IN WORK REG   19650037
         LA    WRKR1,D2(Z0,WRKR1)      POINT TO LINE THREE              19700037
         B     PRNT4050                BRANCH                           19750037
PRNT4200 EQU   *                                                        19800037
         MVI   DCBLNP,ONE              SET LINE POSITION TO ONE         19850037
         IC    WRKR1,DCBLNP            GET LINE COUNT FROM DCB          19900037
         TM    DCBFUNC,RP              READ OR PUNCH BIT ON             19950037
         BO    PRNT2700                BOTH ON, BRANCH                  20000037
         BM    PRNT2700                ONE  ON, BRANCH                  20050037
         LA    WRKR1,CCW1OP            POINT TO 1ST CCW                 20100037
         ST    WRKR1,IOBSTAD           STORE PRINT CCW @ IN IOB AS PTR  20150037
         B     PRNT2760                FINISH SETTING UP CCW            20200037
PRNT4300 EQU   *                                                        20250037
         TM    DCBDEVT+ONE,PRTOV       PRINT OVERFLOW ISSUED            20300037
         BM    PRNT2800                YES, BRANCH TO OVERFLOW ROUTINE  20350037
PRNT4400 EQU   *                                                        20400037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 20450037
*                                                                       20500037
*        THIS ROUTINE WILL SET UP FLAGS FOR AN OVERFOOW CONDITION.      20550037
*  NOTE- OVERFLOW IS DETECTED AFTER PRINTING THE LINE FOLLOWING THE     20600037
*        LINE CORRESPONDING TO CHANNEL 9 OR 12                          20650037
*                                                                       20700037
         NI    DCBIFLGS,OFMASK         CLEAR OVERFOLW INDICATORS        20750037
         CLI   DCBLNP,LINE23           IS THIS CHANNEL 12 OR GREATER    20800037
         BL    PRNT4405                NO, BRANCH                       20850037
         OI    DCBIFLGS,PRTOV12        SET CHAN. 12 OVERFLOW INDICATOR  20900037
         B     PRNT4410                BRANCH                           20950037
PRNT4405 EQU   *                                                        21000037
         CLI   DCBLNP,LINE17           IS THIS CHANNEL 9 OR GREATER     21050037
         BL    PRNT4410                NO, BRANCH                       21100037
         OI    DCBIFLGS,PRTOV9         SET CHAN. 9 OVERFLOW INDICATOR   21150037
PRNT4410 EQU   *                                                        21200037
         TM    DCBMACRF+ONE,CNTRL      CNTRL SPECIFIED IN DCB           21250037
         BZ    PRNT4415                NO, BRANCH                       21300037
         IC    WRKR1,DCBLNP            GET LINE COUNT FROM DCB          21350037
         LA    WRKR1,ONE(WRKR1)        INCREMENT LINE COUNT BY ONE      21400037
         STC   WRKR1,DCBLNP            RESTORE LINE COUNT IN DCB        21450037
PRNT4415 EQU   *                                                        21500037
*                                                                       21550037
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21600037
         LA    WRKR1,IOBIOS                                             21650037
         EXCP  (1)                                                      21700037
         NI    DCBCIND1,USED                                            21750037
*   RESTORE REGS. WHICH WILL NOT BE RESTORED IN THE PUT OR WRITE ROUTS. 21800037
         L     WRKR1,SAVE1(SAVR)        RESTORE REG. 1                  21850037
         LM    WRKR3,RLINE,SAVE9(SAVR)  RESTORE REGS. 9 AND 10          21900037
         BR    RETR                    RETURN TO CALLING ROUTINE        21950037
*                                                                       22000037
         DS    0F                      ALIGN ON A FULLWORD BOUNDARY     22050037
ABEND3   DC    X'00000003'             AGEND CODE OF 3                  22100037
ZEROES   DC    X'00000000'             WORK DC                          22150037
PRNTWTP  EQU   *                                                        22200037
         LR    RLINE,BASR              LOAD BASE ADDR INTO REG 10       22250037
         DROP  BASR                    DROP OLD BASE REG                22300037
         USING IGG019FQ,RLINE          SET UP NEW BASE                  22350037
         WTO   'IEC950I 003-3 3525 ASSOCIATED DATA SET I/O SEQUENCE ERR*22400037
               OR',ROUTCDE=(11),DESC=4                                  22450037
         LA    BASR,THRE               INDICATE ASSOCIATED DATA SET     22500037
*                                      PRINT SEQUENCE ERROR CODE TO BE  22550037
*                                      PASSED TO USER VIA REGISTER 15   22600037
         L     WRKR1,ABEND3            GET SAM ABEND ERROR CODE         22650037
         SLL   WRKR1,12                SET UP REGISTER 1 FOR ABEND      22700037
         ABEND (1),DUMP                                                 22750037
MODID    DC    CL8'IGG019FQ'            MODULE ID              @ZA32137 22760037
FLAG     DC    CL8'@ZA32137'            FLAG                   @ZA32137 22770037
DATE     DC    CL8'&SYSDATE'            DATE OF LATEST FLAG    @ZA32137 22780037
         DC    12CL4'ZAPS'              MAINTENANCE AREA          M1866 22800037
*                                                                       22850037
*                                                                       22900037
*                                                                       22950037
*              THE FOLLOWING CNOP MUST REMAIN ON A HALF-WORD BOUNDARY   23000037
*                                                                       23050037
         CNOP  0,8                     PAD MODULE TO DBL. WD. BOUNDARY  23100037
*                                                                       23150037
*        DSECTS                                                         23200037
*                                                                       23250037
*                                                                       23300037
IOB      DSECT                                                          23350037
         DS    2F                      SPACE                            23400037
IOBIOS   DS    1F                      SPACE                            23450037
         DS    3F                      SPACE                            23500037
IOBSTAD  DS    1F                      STAUS                            23550037
         DS    3F                      SPACE                            23600037
CCW1OP   DS    1F                      OP CODE                          23650037
CCW1AD   EQU   CCW1OP                  CCW OP CODE                      23700037
CCW1FL   DS    1H                      FLAGS                            23750037
CCW1LN   DS    1H                      LENGTH                           23800037
CCW2OP   DS    1F                      OP CODE                          23850037
CCW2AD   EQU   CCW2OP                  OP CODE                          23900037
CCW2FL   DS    1H                      FLAGS                            23950037
CCW2LN   DS    1H                      LENGTH                           24000037
         DCBD  DSORG=PS                                                 24050037
         IEZDEB                                                         24100037
         END                                                            24150037
