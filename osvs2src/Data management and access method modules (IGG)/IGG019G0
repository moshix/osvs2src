         TITLE 'IGG019G0 - APPENDAGES-PART1,UNBL,SYS WA,NO WRT CHK'     00020000
IGG019G0 CSECT                                                          00040000
*          RELEASE OS/VS2-02 DELETIONS                                * 00045002
*          RELEASE 19 DELETIONS                                       * 00060000
*          RELEASE 20 DELETIONS                                       * 00065000
*2331018650-018700,018750,018800,038800-039000,039200-040000,    S20201 00065120
*2331047400-048200,050400,051400,051600-052000,054600,059800,    S20201 00065220
*2331087200-087500,117000,117200-118200,135000,135200,135400,    S20201 00065320
*2331135600-162200,167000,167200-171000,171200-175000,175200-    S20201 00065420
*2331194400                                                      S20201 00065520
*2331078200-078400                                               A38857 00065720
*2331044000,044200,062410,062420,062430,062440,062450,062460,    A31323 00066020
*2331062470,062480,062490,062500,062510,062520,062530,062600,    A31323 00067020
*2331062800,063000,065800,079600-080260,083600-085000,099200-    A31323 00068020
*2331099860                                                      A31323 00069020
*2331070200,085800-086000,086400-089000,089600,104800-105000,    A34922 00069320
*2331105400-108000                                               A34922 00069620
*2331085700,086000-086100,086500                                 A38537 00069820
*          RELEASE 21 DELETIONS                                       * 00070000
*1202104700,105000-105100,105800                                 A44495 00070521
*1202021800,022800                                               S21045 00071021
*1202                                                            A33533 00072021
*1202                                                            A46955 00073021
*XXXX                                                            A49403 00073421
*1202021600                                                      A50670 00073800
*D043980-044000,A043990-044086                                  SA53815 00074202
*           CHANGES SINCE VS2-3.7                                     * 00074437
*A023800-023890,C023920                                        @ZA26522 00074637
*                                                                     * 00075002
*STATUS CHANGE LEVEL 007                                                00092002
*                                                                       00100000
* FUNCTION/OPERATION- APPENDAGE ROUTINES FOR BISAM                      00120000
*        WHEN WRITE KN IS USED WITH OR WITHOUT READ AND UPDATE          00140000
*        WHEN THE USER HAS NOT SUPPLIED A READ-IN AREA,                 00160000
*        WHEN WRITE VALIDITY CHECKING IS NOT REQUESTED,                 00180000
*        AND RECORD FORMAT IS UNBLOCKED.                                00200000
*        (PART 1)                                                       00220000
*                                                                       00240000
*                                                                       00260000
*                                                                       00280000
*        CEND  - IF CHANNEL PROGRAM ENDS                                00300000
*                **WITHOUT ERROR, EITHER                                00320000
*                    PROCESSING COMPLETION WILL BE SCHEDULED,           00340000
*                    PROCESSING CONTINUATION WILL BE SCHEDULED,         00360000
*                    OR PROCESSING WILL CONTINUE.                       00380000
*                **WITH A LENGTH CHECK, TESTS DETERMINE WHETHER         00400000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00420000
*                    ERROR.                                             00440000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00460000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00480000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00500000
*                                                                       00520000
*        ABEND - IF CHANNEL PROGRAM ENDS ABNORMALLY BECAUSE OF          00540000
*                **PERMANENT ERROR, 'UNCORRECTABLE I/O ERROR'           00560000
*                    IS INDICATED IN THE DECB, AND PROCESSING           00580000
*                    COMPLETION WILL BE SCHEDULED.                      00600000
*                **NON-PERMANENT ERROR, ONE RE-TRY IS MADE              00620000
*                    BEFORE INDICATING A PERMANENT ERROR.               00640000
*                **FILE PROTECTION, TESTS DETERMINE WHETHER             00660000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00680000
*                    ERROR.                                             00700000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00720000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00740000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00760000
* ENTRY POINTS-                                                         00780000
*        ENTRY POINT               FUNCTION                             00800000
*        -----------               --------                             00820000
*        APPCEND                   CEND                                 00840000
*        APPABEND                  ABEND                                00860000
*                                                                       00880000
* INPUT - N/A                                                           00900000
* OUTPUT - N/A                                                          00920000
* EXTERNAL ROUTINES - N/A                                               00940000
* EXITS- 1. RETURN TO IOS VIA THE APPENDAGE RETURN VECTOR TABLE POINTED 00960000
*            TO BY REGISTER 14.  SEE THE DSECT LABELED    APPRV FOR THE 00980000
*            FORMAT OF THIS TABLE AND THE USE OF EACH EXIT.             01000000
*           USED TO CONTINUE PROCESSING.                                01020000
*        2. SCHEDULE AN ASYNCHRONOUS ROUTINE - BRANCH VIA THE EXIT      01040000
*            EFFECTOR ADDRESS IN THE COMMUNICATION VECTOR TABLE.        01060000
*           USED TO SCHEDULE PROCESSING COMPLETION OR CONTINUATION.     01080000
*        3. IF THE DESIRED APPENDAGE ROUTINE IS IN PART 2, BRANCH TO    01100000
*            THAT ROUTINE VIA THE PART 2 VECTOR TABLE.  THE POINTER TO  01120000
*            THE MODULE IS IN DCBWKPT5.  SEE THE DSECT LABELED          01140000
*            IHAPART2 FOR RELATIVE ADDRESSES AND USES OF THE ROUTINES.  01160000
*                                                                       01180000
* TABLES/WORK AREAS - DECB, DCB, IOB AND EXTENTION, DCB WA (DCW), DEB,  01200000
*        CVT, PART 2 VECTOR TABLE.                                      01220000
*        SEE DSECTS AT END OF MODULE FOR FORMAT AND DESCRIPTIONS.       01240000
*                                                                       01260000
* ATTRIBUTES- REENTRANT. DISABLED.                                      01280000
* NOTES - NONE                                                          01300000
         EJECT                                                          01320000
* GENERAL REGISTERS ARE USED AS FOLLOWS                                 01340000
*                                                                       01360000
R0       EQU   0                   *    -----                           01380000
R1       EQU   1                   *    12* ADDRESS                     01400000
R2       EQU   2                   *    IOB                             01420000
R3       EQU   3                   *    DEB                             01440000
R4       EQU   4                   *    DCB                             01460000
BASEXXXX EQU   5                        BASE REG FOR CLEANUP     Y02072 01472002
R6       EQU   6                   *    -----                           01500000
R7       EQU   7                   *    UCB                             01520000
SAVEXXXX EQU   8                        SAVE AREA FOR CLEANUP    Y02072 01530002
R9       EQU   9                   #    WORK REGISTER                   01560000
R10      EQU   10                       CHANNEL PROGRAM POINTER         01580000
R11      EQU   11                       DECB                            01600000
R12      EQU   12                       WORK REGISTER                   01620000
R13      EQU   13                       WORK REGISTER                   01640000
R14      EQU   14                       IOS RETURN VECTOR TABLE         01660000
R15      EQU   15                       BASE REGISTER                   01680000
*                                                                       01700000
*        * MEANS THIS REGISTER IS SET UP UPON ENTRY FROM IOS,           01720000
*          AND ITS CONTENTS MUST BE RESTORED UPON RETURN TO IOS         01740000
*        # MEANS THIS REGISTER MAY BE CHANGED, BUT UPON RETURN TO IOS   01760000
*          MUST CONTAIN ZEROES IN THE THREE HIGH ORDER BYTES            01780000
*                                                                       01800000
PERRMASK EQU   X'20'          TO TEST FOR PERMANENT ERROR, TEST         01820000
PERRYES  EQU   8               IOBECBAD, B2. IF OFF (CONDITION CODE 8)  01840000
PERRNO   EQU   7               THERE IS A PERM ERR. ELSE B2 ON ( CD 7)  01860000
ONE      EQU   1                        MISC OFFSET              S20201 01860820
TWO      EQU   2                        *                        S20201 01861620
THREE    EQU   3                        *                        S20201 01862420
FOUR     EQU   4                        *                        S20201 01863220
FIVE     EQU   5                        *                        S20201 01864020
SEVEN    EQU   7                        *                        S20201 01866020
EIGHT    EQU   8                        *                        S20201 01868020
OFLOW    EQU   X'10'                    OVERFLOW BIT IN F BYTE   S20201 01870020
DUMMY    EQU   X'20'                    DUMMY/INACTIVE BIT       S20201 01872020
BYP      EQU   12                       RETURN TO IOS/BYPASS     S20201 01874020
CCOFF    EQU   X'BF'                    MASK FOR CC OFF                 01874401
*                                        1592                    S20201 01876020
EXCP     EQU   8                        RETURN TO IOS/EXCP       S20201 01880020
*                                        1592                    S20201 01884020
NORMAL   EQU   0                        RETURN TO IOS/NORMAL     S20201 01888020
*                                        1592                    S20201 01892020
ABENTRY  EQU   X'01'                    ABEND ENTRY INDICATOR    A50670 01894000
DATACHK  EQU   X'08'                    DATA CHECK IOB SENSE     A50670 01894400
FMVIOL   EQU   X'04'                    FILE MASK VIOLATION      Y02072 01894502
REEXCP   EQU   8                        REEXCP RETURN TO IOS     Y02072 01894802
SKIPX    EQU   4                        SKIP RETURN TO IOS       Y02072 01895202
BYPASS   EQU   12                       BYPASS RETURN TO IOS     Y02072 01895602
NOTSEEK  EQU   8                        CC - SEEK TEST SENSE B0  Y02072 01895702
SEEKCHK  EQU   X'01'                    SEEK CHECK INDICATOR     Y02072 01895802
*                                                                       01895902
         USING RQE,R1                   RQE ADDRESSABILITY       Y02072 01901902
         USING IHAIOB,R2                IOB POINTER              S20201 01908002
         USING IHADEB,R3                DEB POINTER                     01914002
         USING IHADCB,R4                DCB POINTER                     01920000
         USING IHAWKNCP,R10             CHANNEL PROGRAM POINTER         01940000
         USING IHADECB,R11              DECB POINTER                    01960000
         USING IHADCW,R12               DCB WA POINTER ONLY AS WORK REG 01980000
         SPACE 5                                                        02020002
*                             APPENDAGE VECTOR TABLE                    02040000
APP      DC    A(APPCEND-APP)           CHANNEL END       USED BY WKN   02060000
         DC    A(APPABEND-APP)          ABNORMAL END  -     USED BY WKN 02080000
         USING APPCEND,R15                                              02100000
APPCEND  NI    IOBINDCT,X'FE'          INDICATE CEND ENTRY              02120000
         B     SETUPREG                 BRANCH TO SET UP REGISTERS      02140000
APPABEND EQU   *                                                        02150000
         USING APPABEND,R15                                             02152000
*                                                                A50670 02160000
*        IF THIS IS A CORRECTABLE DATA CHECK FROM AN RPS         A50670 02162000
*        DEVICE THEN RETURN TO IOS FOR ERP HANDLING              A50670 02164000
*                                                                A50670 02166000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR          A50670 02166400
         BZ    NOCDACK                  YES CONTINUE AS USUAL    A50670 02166800
         TM    IOBSENS1,FMVIOL          WAS IT A SEEK CHECK      Y02072 02176802
         BCR   NOTSEEK,R14              NO - RETURN TO ERPS      Y02072 02178802
         SPACE 3                                                        02180802
NOCDACK  EQU   *                                                        02182100
         OI    IOBINDCT,ABENTRY         INDICATE ABEND ENTRY     A50670 02182500
SETUPREG L     R15,DEBEXPTR              GET ADDR OF DEB         S21045 02183000
*                                       EXTENSION PTR            S21045 02190400
         USING DEBEXT,R15                                        S21045 02197800
         L     R15,DEBWKPT4              R15  BASE               S21045 02205200
         DROP  R15                                                      02212600
         USING APP,R15                                                  02220000
*                                                                       02222002
*   SAVE IOS REGISTERS AND SET UP ADDRESSABILITY TO RETURN TO SPECIAL   02230002
*   CLEANUP ROUTINE.                                                    02232002
*                                                                       02232402
         STM   R14,R12,0(R13)           SAVE REGISTERS           Y02072 02234002
         LR    SAVEXXXX,R13             SAVE SAVE AREA PTR       Y02072 02236002
         LA    R14,IOSRETS              RETURN TO RETURN TO IOS  Y02072 02238002
         LR    BASEXXXX,R14             BASE REG FOR RETURN      Y02072 02238402
         SPACE 2                                                        02238502
         MODESET KEYADDR=RQEPRT,WORKREG=13 ACQUIRE USER KEY      Y02072 02238802
         SPACE 2                                                        02239202
         L     R10,IOBCCWAD             R10  CP                         02240000
         LA    R10,0(R10)               CLEAR HIGH ORDER BYTE    A49403 02242021
         MVC   IOBECBAD+1(3),IOBBCHAD+1 RESTORE ECB              A33533 02250021
         L     R11,IOBECBAD             R11  DECB                       02260000
         L     R13,DEBEXPTR              GET ADDR OF DEB         S21045 02266021
*                                       EXTENSION PTR            S21045 02272021
         USING DEBEXT,R13                                        S21045 02278021
         L     R13,DEBWKPT5              R13  BASE, PART 2       S21045 02284021
         DROP  R13                                               S21045 02290021
         L     R12,IOBCSW               CSW= STOP ADDRESS PLUS 8        02300000
         LA    R12,0(R12)               CLEAR HIGH ORDER ZERO           02320000
         USING IHAPART2,R13                                             02340000
         IC    R9,IOBAPP                R9   RELATIVE ADDRESS IN        02360000
         CH    R9,TWOTHREE              IS APP CODE GT 23?     @ZA26522 02380037
         BNH   CODEOK                   IF NOT BYPASS PROGCHK  @ZA26522 02383037
         DC    H'0'                     PROG CHK ON BAD CODE   @ZA26522 02386037
TWOTHREE DC    X'0017'                  MAX VALUE FOR APPCODE  @ZA26522 02389037
CODEOK   SLL   R9,2                            APPENDAGE TABLE @ZA26522 02392037
         TM    IOBINDCT,X'01'                                           02400000
         BO    APPABENT(R9)            IF ABEND, BRANCH VIA ABEND TABLE 02420000
         B     APPCENDT(R9)            IF CEND, BRANCH VIA THAT TABLE   02440000
         EJECT                                                          02460000
*********************************************************************** 02480000
*****              CHANNEL END APPENDAGE VECTOR TABLE             ***** 02500000
*********************************************************************** 02520000
APPCENDT EQU   *              CODE      FOR COMPLETION OF               02540000
         B     APPABA2   0             CP4/CP5, READ                    02560000
         B     APPABA2   1             CP4/CP5, WRITE                   02580000
         B     APPADB2   2             CP7                              02600000
         B     APPAAB2   3             CP1 OR CP2, READ AND UPDATE      02620000
         B     APPRVNOR  4             NOT USED                         02640000
         B     APPACA2   5             CP6                              02660000
         B     APPRVNOR  6             NOT USED                         02680000
         B     APPM67CE  7             CP1 OR CP2, WRITE KN             02700000
         B     APPN3B21                                                 02720000
         B     APPN7B2   9             CP10A  - TRUE INSERT             02740000
         B     APPN8A2   10            CP10B  - TRUE INSERT             02760000
         B     APPN8A2   11            CP10B  - ADD TO END              02780000
         B     APPM4A2   12            CP14  - SETUPS 1, 2, OR 5        02800000
         B     APPM5A2   13            CP14  - SETUPS 3, 4, OR 6        02820000
         B     APPM1B21                                                 02840000
         B     APPM2B2   15            CP16 - SITUATION 2               02860000
         B     APPM3B2   16            CP16 - SITUATION 3               02880000
         B     APPN9A2   17            CP17  - TRACK INDEX ONLY         02900000
         B     APPN9A2   18            CP17  - TRACK AND HIGHER LEVELS  02920000
         B     APPN9A2   19            CP17  - HIGHER LEVELS ONLY       02940000
         B     APPN4B2   20            CP9A                             02960000
         B     APPN5B2   21            CP9B                             02980000
         B     APPN6B2   22            CP9C                             03000000
         B     APPN7B2   23             CP10A  - ADD TO END             03020000
         EJECT                                                          03040000
*********************************************************************** 03060000
*****             ABNORMAL END APPENDAGE VECTOR TABLE             ***** 03080000
*********************************************************************** 03100000
APPABENT EQU   *              CODE      FOR COMPLETION OF               03120000
         B     APPABD2   0             CP4/CP5, READ                    03140000
         B     APPABD2   1             CP4/CP5, WRITE                   03160000
         B     APPADE2   2             CP7                              03180000
         B     APPAAA2   3             CP1 OR CP2, READ AND UPDATE      03200000
         B     APPRVNOR  4             NOT USED                         03220000
         B     APPACE2   5             CP6                              03240000
         B     APPRVNOR  6             NOT USED                         03260000
         B     APPM67AE  7             CP1 OR CP2, WRITE KN             03280000
         B     APPN3E2   8             CP8                              03300000
         B     APPN7J2   9             CP10A  - TRUE INSERT             03320000
         B     APPN8G2   10            CP10B  - TRUE INSERT             03340000
         B     APPN8G2   11            CP10B  - ADD TO END              03360000
         B     APPM4E2   12            CP14  - SETUPS 1, 2, OR 5        03380000
         B     APPM5E2   13            CP14  - SETUPS 3, 4, OR 6        03400000
         B     APPM1J2   14            CP15                             03420000
         B     APPM2H2   15            CP16 - SITUATION 2               03440000
         B     APPM2H2   16            CP16 - SITUATION 3               03460000
         B     APPN9G4   17            CP17  - TRACK INDEX ONLY         03480000
         B     APPN9G4   18            CP17  - TRACK AND HIGHER LEVELS  03500000
         B     APPN9G4   19            CP17  - HIGHER LEVELS ONLY       03520000
         B     APPN4G2   20            CP9A                             03540000
         B     APPN5G2   21            CP9B                             03560000
         B     APPN6H2   22            CP9C                             03580000
         B     APPN7J2   23             CP10A  - ADD TO END             03600000
         DROP  R13                                                      03620000
         USING CVT,R13                  COMMUNICATION VECTOR TABLE      03640000
         EJECT                                                          03660000
*   SPECIAL IOS RETURN CLEANUP ROUTINE INTERCEPTS ALL RETURNS TO        03670002
*   IOS AND RESTORES REGISTERS AND SETS PROTECTION KEY TO 0.            03672002
         SPACE 2                                                 Y02072 03674002
IOSRETS  EQU   *                        RETURN POINT             Y02072 03676002
         USING *,BASEXXXX               ADDRESSABILITY           Y02072 03678002
         B     NORMRET                  NORMAL RETURN            Y02072 03678402
         B     SKIPRET                  SKIP POST RETURN         Y02072 03678802
         B     REEXCPRT                 REEXCP RETURN            Y02072 03679202
         SPACE 2                                                        03679602
BYPASRET EQU   *                        BYPASS POST RETURN       Y02072 03679702
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03679802
         LA    R14,BYPASS(R14)          SCHEDULE ASYNCH ROUTINE  Y02072 03679902
         L     R13,CVTPTR               CVT ADDRESSABILITY       Y02072 03686602
         L     R13,CVTEXEF              ASYNCH SCHED ROUTINE     Y02072 03688602
         BR    R13                      GO TO ROUTINE            Y02072 03690602
         SPACE 2                                                        03692602
REEXCPRT EQU   *                        REEXCP RETURN            Y02072 03693002
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03693102
         B     REEXCP(R14)              RETURN - REEXCP          Y02072 03693202
         SPACE 2                                                        03697402
SKIPRET  EQU   *                        RETURN - SKIP            Y02072 03699402
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03701402
         B     SKIPX(R14)               RETURN - SKIP            Y02072 03701502
         SPACE 2                                                        03704002
NORMRET  EQU   *                        RETURN - NORMAL          Y02072 03706002
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03706402
         BR    R14                      RETURN                   Y02072 03706802
         SPACE 2                                                        03707202
IOSRETX  EQU   *                        RESTORE REGS AND KEY     Y02072 03707302
         MODESET KEYADDR=KEY0,WORKREG=13   SET KEY = 0           Y02072 03707402
         SPACE 2                                                        03707802
         LM    R14,R11,0(SAVEXXXX)      RESTORE REGISTERS        Y02072 03708502
         BR    R12                      RETURN                   Y02072 03710502
         DROP  BASEXXXX                 RESET ADDRESSABILITY     Y02072 03710602
         SPACE 2                                                 Y02072 03710702
KEY0     DC    H'0'                     KEY 0                    Y02072 03710802
         EJECT                                                   Y02072 03711402
*              CHANNEL  END CP8,    APPENDAGE CODE  8,         CHART N3 03712802
APPN3B2  EQU   *                        *                               03713402
*                                                                       03714002
         LA    R13,CB8A+EIGHT           DID CHANNEL PROGRAM END ON      03715002
         CLR   R12,R13                  CB8A                            03717502
         BNE   APPAOS22                 NO, CONTINUE                    03720002
         TM    CB8A+FIVE,CC             WAS CB8A CHAINED                03722502
         BZ    APPAOS22                 NO, CP UNCHANGED                03725002
         NI    CB8A+FIVE,CCOFF          RESET CHAIN IND.                03727502
         OI    CB8A+FOUR,CC             TURN CC BACK ON                 03730002
         CLI   CB12,SEEKHH              CB12 SET FOR HEAD SEEK          03732502
         BNE   APPN3F3                  NO,  FILE PROTECT               03735002
         LA    R13,CB16                 RESET IOBSTART                  03737502
         ST    R13,IOBSTART-ONE         START CP WITH SETSECT           03740002
         MVC   IOBDADAD,CB10+SEVEN      RESET IOBSEEK                   03742502
         B     APPRVXCP                 SECHDULE EXCP IOS RETURN        03745002
APPAOS22 EQU   *                        *                               03747502
*                                                                       03750002
         LA    R13,CB21+EIGHT           DID CHAN PROG STOP AT CB21      03752502
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      03755002
         BNE   APPN3A3                  NO - CHECK FOR LENGTH ERROR     03757502
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         03760000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   03780000
         BO    APPN3C2A                 BO IF SHARED                    03800000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         03820000
         B     APPN3C2B                                                 03840000
APPN3C2A MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         03860000
APPN3C2B EQU   *                                                 S20201 03890020
APPN3C2D MVC   IOBDADAD+3(5),CB23+3     MOVE CB23 CCHHR TO IOB          04020000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        04040000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   04060000
         LA    R13,CB30                 START AT CB30                   04080000
         ST    R13,IOBSTART-1                                           04100000
         LA    R13,IOBDADAD+3           PUT SEEK ADDRESS IN CB30,       04120000
         IC    R9,CB30                   CB34, AND CB40                 04140000
         ST    R13,CB30                                                 04160000
         STC   R9,CB30                                                  04180000
         MVC   CB34+1(3),CB30+1                                         04200000
         MVC   CB40+1(3),CB30+1                                         04220000
         MVC   CB36+1(3),DECBKEY+1      PUT I IN CB36 AND CB38          04240000
         MVC   CB38+1(3),DECBKEY+1                                      04260000
         L     R13,DECBAREA             PUT AREA + 16 IN CB37 AND CB39  04280000
         LA    R13,16(R0,R13)                                           04300000
         IC    R9,CB37                                                  04320000
         ST    R13,CB37                                                 04340000
         STC   R9,CB37                                                  04360000
         MVC   CB39+1(3),CB37+1                                         04380000
         NI    IOBINDCT,X'FF'-LASTIND   FLAG NORMAL USE OF CP9A  A31323 04390020
*                                                                       04390402
*        TEST FOR OUT OF SPACE CONDITION                                04391020
*                                                                       04391402
         TM    DCBOPTCD,X'08'          CYL OVFL OPTION           A31323 04392020
         BZ    APPNSC                  IF NO-BRANCH              A31323 04393020
         CLI   CB22+5,X'00'            CYL OVFL FULL             A31323 04394020
         BNE   APPRVXCP                IF NO-BRANCH              A31323 04395020
APPNSC   TM    DCBOPTCD,X'10'          INDEP OVFL OPTION         A31323 04396020
         BZ    APPNSE                  IF NO-BRANCH              A31323 04397020
*      ADJUST DCBRORG2 TO ZERO IF IND OVFL IS FULL              SA53815 04399002
         LH    R13,DCBRORG2             LAST UNFILLED IOV TRK?  SA53815 04399402
*                                                                       04399502
         LTR   R13,R13                  ANY IND OVRFLOW TRKS    SA65051 04399602
         BZ    APPNSD                   BRANCH IF NO            SA65051 04399702
         BCT   R13,APPRVXCP             NO - BR TO READ BLOCK   SA53815 04399802
*                                       YES - CONTINUE          SA53815 04400202
APPNSD   IC    R13,DCBLIOV+7            GET LIOV (REC NO.)      SA65051 04400602
         LA    R13,1(R13)               BUMP REC NO.            SA53815 04400702
         SR    R12,R12                  CLEAR REG               SA53815 04400802
         IC    R12,DCBHIIOV             GET HIGHEST REC. NO.    SA53815 04400902
         CLR   R13,R12                  LIOV+EOF FILLS LAST TRK?SA53815 04403802
         BNE   APPRVXCP                 NO - BR TO READ BLOCK   SA53815 04405802
*                                       YES - CONTINUE          SA53815 04406202
         SR    R13,R13                  REDUCE NUMBER OF -      SA53815 04406602
         STH   R13,DCBRORG2             IND OVFL TRKS TO ZERO   SA53815 04407002
APPNSE   CLC   IOBDADAD(7),DCBLPDA      ON LAST TRK OF DATA SET  A31323 04407802
         BNE   APPNSG                   NO, BRANCH               A31323 04410702
         TM    DCBST,X'01'              IS LAST TRACK FULL       A31323 04413602
         BNO   APPRVXCP                 NO, BR--SPACE IS AVAIL   A31323 04416502
APPNSG   TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN  A31323 04419402
         BO    APPNSI                   YES, BR--RD LAST BLK TO  A31323 04422302
*                                                                       04425202
*        CHECK FOR DELETED RECORDS.  OTHERWISE, SET NO SPACE FND        04428102
*                                                                       04431002
         OI    DECBEXC1,X'20'           THEN READ DESIRED BLK    A31323 04433902
         B     APPRVXCP                 TO CHECK FOR DUP RECS.   A31323 04436802
APPNSI   OI    IOBINDCT,LASTIND         WILL CHECK LAST RECORD   A31323 04439702
         L     R12,DCBWKPT2             RESTORE WORK AREA BASE   A31323 04442602
         USING IHADCW,R12                                        A31323 04445502
         MVC   IOBDADAD+7(1),DCWHIRPS   SET R TO LAST ON TRK     A31323 04448402
         B     APPRVXCP                 CHK RECORD FOR DELETION  A31323 04451302
APPN3B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE    A31323 04454202
APPN3B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  04457102
APPN3B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 04460002
APPN3B6  LA    R13,CB8A+EIGHT           DID CP STOP AT CB8A      S20201 04522020
         CLR   R12,R13                  COMPARE ADDRESSES        S20201 04524020
         BNE   APPN3B3                  NO, UNREACHABLE BLOCK    S20201 04526020
         TM    CB11+SEVEN,OFLOW+DUMMY   OFLO, INACTIVE, OR DUMMY S20201 04528020
         BNZ   APPN3F3                  YES, GO TO FILE PROTECT  S20201 04530020
         MVC   CB23+THREE(FOUR),CB11+TWO    SET UP CCHH          S20201 04532020
         MVI   CB23+SEVEN,ONE           SET R EQUAL TO 1         S20201 04534020
         B     APPN3C2D                 GO READ RECORD           S20201 04536020
         EJECT                                                          04540000
*              ABNORMAL END CP8,    APPENDAGE CODE  8,         CHART N3 04560000
APPN3E2  EQU   *                                                  19374 04580000
         TM    IOBSENSE+1,X'04'         WAS ABEND DUE TO FILE     15924 04600016
*                                       PROTECT                   15924 04610016
         BO    APPN3F2                  YES--BRANCH               19374 04620000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 04630000
         BC    PERRYES,APPN3B3          YES--BRANCH               19374 04640000
         B     APPRVNOR                 NO--RETRY CHANNEL PGM     19374 04650000
APPN3F2  LA    R13,CB12+8               DID CHAN PROG STOP AT CB12      04680000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      04700000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      04720000
APPN3F3  TM    CB11+SEVEN,OFLOW         WAS OFLO TRK IX ENTRY RD S20201 04730020
         BZ    APPN3G3                  BZ IF NO                        04840000
         TM    CB11+7,X'20'                                             04860000
         BO    APPN3G3                  BO IF NO                        04880000
         MVC   CJ11(7),IOBDADAD         SAVE TRK INDEX MBBCCHH          04900000
         MVI   IOBAPP,X'10'             SET APPENDAGE CODE TO 16        04920000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          04940000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            04960000
         LA    R13,CJ1                  START AT CJ1                    04980000
         ST    R13,IOBSTART-1                                           05000000
         MVC   IOBDADAD,CB10+7          PUT CB10 MBBCCHHR IN IOB        05020000
         LA    R13,IOBDADAD+3           PUT SEEK ADDRESS IN CJ1 AND CJ5 05060000
         IC    R9,CJ1                                                   05080000
         ST    R13,CJ1                                                  05100000
         STC   R9,CJ1                                                   05120000
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 05130020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE   MOVE IN ADDR OF KEY  S20201 05140020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE   *                    S20201 05150020
         L     R12,DCBWKPT2             SET ON FIRST TIME ONLY SWITCH   05220000
         USING IHADCW,R12                                        S20201 05230020
         OI    DCWWKNI,X'40'                                            05240000
         LA    R12,0(R0,R0)             IS FIRST OFLO ON SAME MODULE    05260000
         IC    R12,CB10+7                      GET M OF OFLO ENTRY      05280000
         SLL   R12,4(R0)                       MULT BY 16               05300000
         L     R12,32(R12,R3)                  LOAD UCB ADDR FROM DEB   05320000
         LA    R12,0(R0,R12)                   COMP WITH UCB AD IN 7    05340000
         CR    R12,R7                                                   05360000
         BE    APPRVXCP                 SAME MODULE - EXCP RTRN TO IOS  05380000
         MVI   IOBASYN,X'01'            DIFFERENT MODULE - MUST EXCP    05400000
         B     APPN3B5                   IN ASYNCHRONOUS ROUTINE        05420000
APPN3A3  TM    IOBCSW+5,X'40'           DID CHAN PROG HAVE LENGTH ERROR 05440000
         BZ    APPN3B6                  GO TEST FOR SPECIAL CASE S20201 05460020
         TM    CB11+7,X'30'             WAS ENTRY INACTIVE              05480000
         BO    APPN3B3                  BO IF YES                       05500000
APPN3G3  TM    CB11+7,X'20'             VERIFY ADD-TO-END SITUATION     05520000
         BZ    APPN3B3                  BZ IF DUMMY OR INACTIVE         05540000
         CLI   DCBNLEV,X'00'            ERROR IF 2 OR MORE INDEX LEVELS 05560000
         BNE   APPN3B3                  BNE IF MORE THAN 1 INDEX LEVEL  05580000
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         05600000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   05620000
         USING IHADCW,R12                                        S20201 05630020
         BO    APPN3G33                 BO IF SHARED                    05640000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         05660000
         B     APPN3G5                                                  05680000
APPN3G33 MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         05700000
APPN3G5  MVI   IOBAPP,X'0E'             SET APPENDAGE CODE TO 14        05720000
         MVC   IOBDADAD(3),DCBLPDA      SEEK TO DCBLETI'S CYLINDER      05740000
         MVC   IOBDADAD+3(4),DCBLETI    CCHH                            05760000
         OC    IOBDADAD+6(1),DCBFIRSH+3                                 05780000
         XC    IOBDADAD+6(1),DCBFIRSH+3 REDUCE TO CYL BOUNDRY OR ZERO   05800000
         MVI   IOBDADAD+7,0                                             05820000
         LA    R12,CI1                  START AT CI1                    05840000
         ST    R12,IOBSTART-1                                           05860000
         MVI   IOBFLAG1,X'42'                                           05880000
         LA    R12,IOBDADAD+3           PUT SEEK ADDRESS IN CI1         05900000
         IC    R9,CI1                                                   05920000
         ST    R12,CI1                                                  05940000
         STC   R9,CI1                                                   05960000
         MVC   CI5+TWO(FIVE),DCBLETI    PUT DCBLETI CCHHR IN CI5 S20201 05970020
         MVC   CI5(TWO),DCBLPDA+ONE     MOVE IN BB FOR HEAD SEEK S20201 05980020
         B     APPRVXCP                                                 06000000
         EJECT                                                          06020000
*              CHANNEL  END CP9A,   APPENDAGE CODE 20,         CHART N4 06040000
APPN4B2  LA    R13,CB33+8               DID CHAN PROG STOP AT CB33      06060000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      06080000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      06100000
         L     R12,CB32                 KEY OF RECORD JUST READ         06120000
         LA    R12,0(R0,R12)                                            06140000
         L     R13,DECBKEY              KEY OF NEW RECORD               06160000
         IC    R9,DCBKEYLE                                              06180000
         BCTR  R9,R0                                                    06200000
         EX    R9,APPN4C2A              ARE KEYS EQUAL                  06220000
         BE    APPN4C3                  YES  C3                         06240000
         TM    DECBEXC1,X'20'           WAS NO SPACE FOUND       A31323 06241020
         BO    APPN3B4                  YES, POST REQ IN ERROR   A31323 06242020
         NI    CB35+4,X'00'             NO - SET OFF REPL-OF-DEL A31323 06242620
*                                       FLAG                     A31323 06243220
         L     R12,DCBWKPT2             SET WORK AREA BASE       A31323 06244120
         USING IHADCW,R12                                        A31323 06245020
         TM    IOBINDCT,LASTIND         WAS LAST BLK READ        A31323 06246020
         BZ    APPN4B7                  NO, BR TO CONTINUE       A31323 06247020
         NI    IOBINDCT,X'FF'-LASTIND   TURN OFF BIT             A31323 06248020
         L     R13,CB33                 POINT TO DATA FIELD      A31323 06249020
         CLI   0(R13),X'FF'             WAS RECORD DELETED       A31323 06250020
         BNE   APPN4B50                 NO, BR--SPACE NOT AVAIL  A31323 06250620
         BAL   R13,COMPLDT              YES, SPACE MAY BE AVAIL  A31323 06251220
*                                                                       06251302
*        RETURN HERE IF RECORD MUST BE BUMPED.  RETURN HERE + 4         06251520
*        (AFTER THE NEXT INSTRUCTION) IF RECORD NEED NOT GO INTO        06251820
*        OVERFLOW.                                                      06252120
*                                                                       06252202
APPN4B50 OI    DECBEXC1,X'20'           SPACE IS NOT AVAILABLE   A31323 06252420
APPN4B5  CLC   DCWHIRPS(1),CB23+7       IS THIS THE DESIRED BLK  A31323 06261420
         BE    APPN4E4                  YES, BRANCH              A31323 06270420
         MVC   IOBDADAD+7(1),CB23+7     NO, SEEK TO CORRECT BLK  A31323 06279420
         B     APPRVXCP                 READ IT IN               A31323 06288420
APPN4B7  CLC   IOBDADAD+7(1),DCWHIRPS   WAS RCD LAST ON TRK      A31323 06298420
         BE    APPN4E4                  YES  E4                         06320000
         MVI   CB37+4,X'40'             SET ON  CB37  CC FLAG           06340000
APPN4F4  MVI   IOBAPP,X'15'             SET APPENDAGE CODE TO 21        06360000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   06380000
         LA    R12,CB34                 START AT CB34                   06400000
         ST    R12,IOBSTART-1                                           06420000
         B     APPRVXCP                                                 06440000
APPN4C3  TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         06460000
         BZ    APPN4B4                  NO   B4                         06480000
         L     R12,CB33                 IS RECORD MARKED FOR DELETION   06500000
         CLI   0(R12),X'FF'                                             06520000
         BNE   APPN4B4                  NO   B4                         06540000
         OI    CB35+4,X'80'             SET ON REPL-OF-DEL FLAG         06560000
APPN4E4  TM    DECBEXC1,X'20'           WAS NO SPACE AVAIL       A31323 06570020
         BO    APPN3B4                  YES, POST REQ IN ERROR   A31323 06580020
         MVI   CB37+4,X'00'             SET OFF CB37  CC FLAG    A31323 06590020
         B     APPN4F4                                                  06600000
APPN4B4  OI    DECBEXC1,X'01'           INDICATE DUPLICATE RECORD       06620000
         MVI   IOBASYN,X'08'                                            06640000
         B     APPN3B5                  SCHEDULE PROCESSING COMPLETION  06660000
         EJECT                                                          06680000
*              ABNORMAL END CP9A,   APPENDAGE CODE 20,         CHART N4 06700000
APPN4G2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     06720000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       06740000
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     06760000
         BZ    APPN3B3                  NO   N3B3                       06780000
         LA    R13,CB32+8               DID CHAN PROG STOP AT CB32      06800000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      06820000
         BE    APPN4K2                  YES - UNCORRECTABLE I/O ERROR   06840000
         LA    R13,CB33+8               DID CHAN PROG STOP AT CB33      06860000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      06880000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      06900000
APPN4K2  OI    DECBEXC1,X'08'           UNCORRECTABLE I/O ERROR         06920000
         B     APPN3B4                                                  06940000
APPN4C2A CLC   0(0,R13),0(R12)          EXECUTED INSTRUCTION            06960000
         EJECT                                                          06980000
*              CHANNEL  END CP9B,   APPENDAGE CODE 21,         CHART N5 07000000
APPN5B2  MVI   CB36,WKD                 RESTORE COMMAND CODE     A34922 07008020
         NI    CB36+4,X'FF'-SKIP        RESTORE FLAGS            A34922 07016020
         NI    CB37+4,X'FF'-SKIP        RESTORE FLAGS            A34922 07024020
         LA    R13,CB39+8               CHAN PGM STOP AT CB39    A34922 07032020
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      07040000
         BNE   APPN5B3                  NO - TRY CB38                   07060000
         IC    R9,IOBDADAD+7            INCREASE R IN IOB BY 1          07080000
         LA    R13,1(R0,R9)                                             07100000
         STC   R13,IOBDADAD+7                                           07120000
         L     R12,DCBWKPT2             WAS RCD JUST READ LAST ON TRACK 07140000
         USING IHADCW,R12                                        S20201 07150020
         CLC   IOBDADAD+7(1),DCWHIRPS                                   07160000
         BE    APPN5D1                  YES  D1                         07180000
         MVI   CB43+4,X'40'             SET ON  CB43  CC FLAG           07200000
APPN5E1  MVI   IOBAPP,X'16'             SET APPENDAGE CODE TO 22        07220000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   07240000
         LA    R12,CB40                 START AT CB40                   07260000
         ST    R12,IOBSTART-1                                           07280000
         B     APPRVXCP                 EXCP RETURN TO IOS              07300000
APPN5D1  MVI   CB43+4,X'00'             SET OFF CB43  CC FLAG           07320000
         B     APPN5E1                                                  07340000
APPN5B3  LA    R13,CB38+8               DID CHAN PROG STOP AT CB38      07360000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      07380000
         BNE   APPN5B4                  NO - TRY CB37                   07400000
         TM    IOBCSW+4,X'01'           DID CHAN PROG END WITH EOF      07420000
         BZ    APPN3B3                  NO   N3B3                       07440000
         MVI   IOBAPP,X'09'             SET APPENDAGE CODE TO 9         07460000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   07480000
         LA    R12,CB46                 START AT CB46                   07500000
         ST    R12,IOBSTART-1                                           07520000
         MVC   CB51(4),IOBDADAD+3       MOVE IOB CCHHR (PLUS 1) TO CB51 07540000
         IC    R9,IOBDADAD+7                                            07560000
         LA    R12,1(R0,R9)                                             07580000
         STC   R12,CB51+4                                               07600000
         MVC   CB49+1(3),CB32+1         MOVE KEY  ADDRESS TO CB49       07620000
         MVC   CB50+1(3),CB33+1         MOVE DATA ADDRESS TO CB50       07640000
         LA    R12,IOBDADAD+3                                           07660000
         IC    R9,CB46                  SAVE                            07680000
         ST    R12,CB46                 PUT IOB ADDRESS IN CB46         07700000
         STC   R9,CB46                  RESTORE                         07720000
         B     APPRVXCP                 EXCP RETURN TO IOS              07740000
APPN5B4  LA    R13,CB37+8               DID CHAN PROG STOP AT CB37      07760000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      07780000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      07800000
         TM    CB35+4,X'80'             IS REPL-OF-DEL FLAG ON   A38857 07800620
         BO    APPN3B4                  BR IF YES                A38857 07801220
         L     R12,DCBWKPT2             GET WKAREA BASE          A34922 07802020
         CLC   DCWHIRPS(1),IOBDADAD+7   END OF TRACK STOP        A34922 07804020
         BE    APPN5B5                  YES, BRANCH              A34922 07806020
         OI    CB37+4,CC+SKIP           NO, MUST BE ERROR STOP   A34922 07808020
         OI    CB36+4,SKIP              NO OP WRITE COMMAND      A34922 07810020
         B     APPRVXCP                 RESTART CHANNEL PROG     A34922 07812020
APPN5B5  EQU   *                        PROCESS END OF TRACK     A34922 07814020
         TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         07860000
         BZ    APPN5F4                  NO   F4                         07880000
         L     R12,CB33                 IS RECORD MARKED FOR DELETION   07900000
         CLI   0(R12),X'FF'                                             07920000
         BNE   APPN5F4                  NO   F4                         07940000
         BAL   R13,COMPLDT              SEE IF MUST BUMP RECORD  A31323 07960020
         B     APPN5F4                  YES, RETURN HERE         A31323 07980020
*                                                                       07990002
*                                       NO, DON'T BUMP                  08000020
         MVC   IOBDADAD+5(3),CB23       MOVE CB23 CCHHR TO IOB          08040000
         MVI   IOBAPP,X'11'             SET APPENDAGE CODE TO 17        08060000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   08080000
         LA    R12,CK1                  START AT CK1                    08100000
         ST    R12,IOBSTART-1                                           08120000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  08140000
         ST    R12,CK1                                                  08160000
         MVI   CK1,X'31'                                                08180000
         ST    R12,CK4                                                  08200000
         MVI   CK4,X'31'                                                08220000
         MVC   CK6+1(3),DECBKEY+1       PUT I ADDRESS IN CK6            08240000
         B     APPRVXCP                 EXCP RETURN TO IOS              08260000
APPN5F4  OI    IOBINDCT,X'20'           INDICATE OFLO RECORD IN W       08280000
         MVI   IOBASYN,X'09'            SET ASYNCHRONOUS CODE TO 9      08300000
         MVC   CH7+1(3),DECBKEY+1       PUT I ADDRESS IN CH7            08320000
         B     APPN3B5                  SCHEDULE ASYNCHRONOUS ROUTINE   08340000
COMPLDT  IC    R9,DCBHMASK              GET TRACK MASK           A31323 08350020
         SLL   R13,8                    MOVE OVER RETURN ADDR    A31323 08360020
         IC    R13,IOBDADAD+6           PICK UP TRACK BYTE       A31323 08370020
         NR    R9,R13                   MASK OFF TRACK           A31323 08380020
         SRL   R13,8                    RESTORE RETURN ADDR      A31323 08390020
         EX    R9,CLILDT                SEE IF LAST TRK OF CYL   A31323 08400020
         BE    COMPLDT1                 BRANCH IF ON LAST TRACK  A31323 08410020
*                                                                       08412002
*        IF NOT LAST TRACK, CHECK TO SEE IF LAST TRK OF PRIME.          08420020
*                                                                       08422002
         CLC   IOBDADAD(7),DCBLPDA      LAST PRIME DATA TRK      A31323 08430020
         BNE   4(R13)                   NO, DON'T BUMP RECORD    A31323 08440020
COMPLDT1 TM    CB26,X'08'               DOES OVERFLOW IX ENTRY   A31323 08450020
*                                                                       08452002
*        INDICATE THE EXISTENCE OF A CHAIN.                             08460020
*                                                                       08462002
         BO    4(R13)                   YES, NO NEED TO BUMP     A31323 08470020
         BR    R13                      MUST BUMP--NO CHAIN YET  A31323 08480020
CLILDT   CLI   DCBLDT+1,0               REC ON LAST TRK OF CYL          08520000
         EJECT                                                          08540000
*              ABNORMAL END CP9B,   APPENDAGE CODE 21,         CHART N5 08560000
APPN5G2  EQU   *                                                 A38537 08564020
         TM    IOBECBAD,PERRMASK        TEST FOR PERM ERROR      A38537 08568020
         BC    PERRNO,APPN5G3           BIF FIRST ENTRY          A38537 08572020
         MVI   CB36,WKD                 RESTORE COMMAND CODE     A38537 08576020
         NI    CB36+4,X'FF'-SKIP        RESTORE FLAGS            A34922 08580020
         NI    CB37+4,X'FF'-SKIP        RESTORE FLAGS            A34922 08590020
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     08620000
         BZ    APPN3B3                  NO, UNREACHABLE BLOCK    A34922 08630020
         B     APPN4K2                  YES, UNCORR I/O ERROR    A34922 08640020
APPN5G3  EQU   *                                                 A38537 08643020
         TM    IOBSENSE,TCC             IS IT ALT.TRK            A38537 08646020
TCC      EQU   X'02'                    TRACK COND CHECK         A38537 08649020
         BO    APPRVNOR                 NO ACTION FOR ALT. TRK   A38537 08652020
         LA    R13,CB38+8               POINT TO NXT REC CCW     A38537 08655020
         CLR   R12,R13                  DID CP GET THIS FAR      A34922 08660020
         BL    APPN5G4                  NO, RETRY CHAN PGM       A34922 08670020
         MVI   CB36,RKD                 YES, CONVERT TO RD KD    A34922 08680020
         OI    CB36+4,SKIP              SUPPRESS DATA XFER       A34922 08690020
         OI    CB37+4,SKIP              SUPPRESS DATA XFER       A34922 08700020
         B     APPRVNOR                 RETRY CHAN PGM           A34922 08710020
APPN5G4  NI    CB37+4,X'FF'-CC          TURN OFF COMMAND CHAIN   A34922 08760020
         MVI   CB36,WKD                 RESTORE COMMAND          A38537 08762020
         NI    CB36+4,X'FF'-SKIP        RESTORE FLAGS            A38537 08764020
         NI    CB37+4,X'FF'-SKIP        RESTORE FLAGS            A38537 08766020
         B     APPRVNOR                 RETRY CHANNEL PGM        A34922 08770020
         EJECT                                                          08920000
*              CHANNEL  END CP9C,   APPENDAGE CODE 22,         CHART N6 08940000
APPN6B2  MVI   CB42,WKD                 RESTORE COMMAND CODE     A34922 08948020
         NI    CB42+4,X'FF'-SKIP        RESTORE FLAGS            A34922 08956020
         NI    CB43+4,X'FF'-SKIP        RESTORE FLAGS            A34922 08964020
         LA    R13,CB45+8               CHAN PGM STOP AT CB45    A34922 08972020
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      08980000
         BNE   APPN6B3                  NO - TRY CB44                   09000000
         IC    R9,IOBDADAD+7            INCREASE R IN IOB BY 1          09020000
         LA    R13,1(R0,R9)                                             09040000
         STC   R13,IOBDADAD+7                                           09060000
         L     R12,DCBWKPT2             WAS RCD JUST READ LAST ON TRACK 09080000
         USING IHADCW,R12                                        S20201 09090020
         CLC   IOBDADAD+7(1),DCWHIRPS                                   09100000
         BNE   APPN6E2                  NO   E2                         09120000
         MVI   CB37+4,X'00'             SET OFF CB37  CC FLAG           09140000
         NI    CB35+4,X'7F'             SET OFF REPL-OF-DEL FLAG        09160000
APPN6F1  MVI   IOBAPP,X'15'             SET APPENDAGE CODE TO 21        09180000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   09200000
         LA    R12,CB34                 START AT CB34                   09220000
         ST    R12,IOBSTART-1                                           09240000
         B     APPRVXCP                 EXCP RETURN TO IOS              09260000
APPN6E2  MVI   CB37+4,X'40'             SET ON  CB37  CC FLAG           09280000
         B     APPN6F1                                                  09300000
APPN6B3  LA    R13,CB44+8               DID CHAN PROG STOP AT CB44      09320000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      09340000
         BNE   APPN6B4                  NO - TRY CB43                   09360000
         TM    IOBCSW+4,X'01'           DID CHAN PROG END WITH EOF      09380000
         BZ    APPN3B3                  NO   N3B3                       09400000
         MVI   IOBAPP,X'09'             SET APPENDAGE CODE TO 9         09420000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   09440000
         LA    R12,CB46                 START AT CB46                   09460000
         ST    R12,IOBSTART-1                                           09480000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CB46         09500000
         ST    R12,CB46                                                 09520000
         MVI   CB46,X'31'                                               09540000
         MVC   CB49+1(3),DECBKEY+1      MOVE KEY  ADDRESS TO CB49       09560000
         L     R12,DECBAREA                                             09580000
         LA    R12,16(R0,R12)                                           09600000
         ST    R12,CB50                 MOVE DATA ADDRESS TO CB50       09620000
         MVC   CB51(4),IOBDADAD+3                                       09640000
         IC    R9,IOBDADAD+7                                            09660000
         LA    R12,1(R0,R9)                                             09680000
         STC   R12,CB51+4               MOVE IOB CCHHR (PLUS 1) TO CB51 09700000
         B     APPRVXCP                 EXCP RETURN TO IOS              09720000
APPN6B4  LA    R13,CB43+8               DID CHAN PROG STOP AT CB43      09740000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      09760000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      09780000
         L     R12,DCBWKPT2             GET WKAREA BASE          A34922 09782020
         CLC   DCWHIRPS(1),IOBDADAD+7   END OF TRACK STOP        A34922 09784020
         BE    APPN6B5                  YES, BRANCH              A34922 09786020
         OI    CB43+4,CC+SKIP           NO, MUST BE ERROR STOP   A34922 09788020
         OI    CB42+4,SKIP              NO OP WRITE COMMAND      A34922 09790020
         B     APPRVXCP                 RESTART CHANNEL PROG     A34922 09792020
APPN6B5  EQU   *                        PROCESS END OF TRACK     A34922 09794020
         TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         09800000
         BZ    APPN6E4                  NO   E4                         09820000
         L     R12,DECBAREA             IS RECORD MARKED FOR DELETION   09840000
         LA    R12,16(R0,R12)                                           09860000
         CLI   0(R12),X'FF'                                             09880000
         BNE   APPN6E4                  NO   E4                         09900000
         BAL   R13,COMPLDT              SEE IF MUST BUMP RECORD  A31323 09920020
         B     APPN6E4                  YES, RETURN HERE         A31323 09940020
*                                       NO, DON'T BUMP                  09960020
         MVC   IOBDADAD+5(3),CB23       MOVE CB23 CCHHR TO IOB          10000000
         MVI   IOBAPP,X'11'             SET APPENDAGE CODE TO 17        10020000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   10040000
         LA    R12,CK1                  START AT CK1                    10060000
         ST    R12,IOBSTART-1                                           10080000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  10100000
         ST    R12,CK1                                                  10120000
         MVI   CK1,X'31'                                                10140000
         ST    R12,CK4                                                  10160000
         MVI   CK4,X'31'                                                10180000
         L     R12,CB42                                                 10200000
         LA    R12,0(R0,R12)                                            10220000
         ST    R12,CK6                  MOVE KEY ADDRESS TO CK6         10240000
         MVI   CK6,X'0D'                                                10260000
         B     APPRVXCP                 EXCP RETURN TO IOS              10280000
APPN6E4  NI    IOBINDCT,X'DF'           INDICATE OFLO RECORD IN AREA    10300000
         MVI   IOBASYN,X'09'            SET ASYNCHRONOUS CODE TO 9      10320000
         L     R12,CB42                 MOVE KEY ADDRESS TO CH7         10340000
         LA    R12,0(R0,R12)                                            10360000
         ST    R12,CH7                                                  10380000
         MVI   CH7,X'0D'                                                10400000
         B     APPN3B5                  SCHEDULE ASYNCHRONOUS ROUTINE   10420000
         EJECT                                                          10440000
*              ABNORMAL END CP9C,   APPENDAGE CODE 22,         CHART N6 10460000
APPN6H2  EQU   *                                                 A44495 10464021
         TM    IOBECBAD,PERRMASK        TEST FOR PERMANENT ERROR A44495 10468021
         BC    PERRNO,APPN6H3           BIF FIRST ENTRY          A44495 10472021
         MVI   CB42,WKD                 RESTORE COMMAND CODE     A44495 10476021
         NI    CB42+4,X'FF'-SKIP        RESTORE FLAGS            A34922 10480020
         NI    CB43+4,X'FF'-SKIP        RESTORE FLAGS            A34922 10490020
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     10520000
         BZ    APPN3B3                  NO, UNREACHABLE BLOCK    A34922 10540020
         B     APPN4K2                  YES, UNCORR I/O ERROR    A34922 10560020
APPN6H3  EQU   *                                                 A44495 10568021
         TM    IOBSENSE,TCC             TRK COND CHK             A44495 10576021
         BO    APPRVNOR                 LET 9C COMPLETE          A44495 10584021
         LA    R13,CB44+8               POINT TO NEXT REC CCW    A44495 10592021
         CLR   R12,R13                  DID CP GET THIS FAR      A34922 10600020
         BL    APPN6H4                  NO, RETRY CHAN PGM       A34922 10620020
         MVI   CB42,RKD                 YES, CONVERT TO RD KD    A34922 10640020
         OI    CB42+4,SKIP              SUPPRESS DATA XFER       A34922 10660020
         OI    CB43+4,SKIP              SUPPRESS DATA XFER       A34922 10680020
         B     APPRVNOR                 RETRY CHAN PGM           A34922 10700020
APPN6H4  NI    CB43+4,X'FF'-CC          NO COMMAND CHAIN         A34922 10720020
         MVI   CB42,WKD                 RESTORE COMMAND CODE     A44495 10725021
         NI    CB42+4,X'FF'-SKIP        RESTORE FLAGS            A44495 10730021
         NI    CB43+4,X'FF'-SKIP        RESTORE FLAGS            A44495 10735021
         B     APPRVNOR                 RETRY CHANNEL PROGRAM    A34922 10740020
         EJECT                                                          10820000
*              CHANNEL  END CP15,   APPENDAGE CODE 14,         CHART M1 10840000
APPM1B2  LA    R13,CI4+8                DID CHAN PROG STOP AT CI4       10860000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      10880000
         BNE   APPM1B3                  NO - RECORD IS UNREACHABLE      10900000
         L     R12,DCBWKPT2                                             10920000
         USING IHADCW,R12                                        S20201 10930020
         OI    DCWWKNI,X'10'            SET ADD-TO-END INDICATOR ON     10940000
         CLI   DCBFIRSH+TWO,ONE         TEST FOR SHARED TRACK    A46955 10946021
         BNH   APPM1B20                 NO                       A46955 10952021
         CLC   DCBFIRSH(2),DCBLPDA+5    END OF SHARED TRACK        7851 10960000
         BE    APPM1B2A                                            7851 10980000
APPM1B20 EQU   *                        *                        A46955 10990021
         MVC   DCWHIRPS(1),DCBHIRPD                                7851 11000000
         B     APPM1B2B                                            7851 11020000
APPM1B2A MVC   DCWHIRPS(1),DCBHIRSH                                7851 11040000
APPM1B2B EQU   *                                                   7851 11060000
         TM    DCBST,X'01'              IS LAST TRACK FULL              11080000
         BO    APPM1C2                  BO IF YES, TO SET UP CP16       11100000
         MVI   IOBAPP,X'17'             SET APPENDAGE CODE TO 23        11120000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   11140000
         LA    R12,CB46                 START AT CB46                   11160000
         ST    R12,IOBSTART-1                                           11180000
         MVC   IOBDADAD,DCBLPDA         PUT DCBLPDA MBBCCHHR IN IOB     11200000
         MVC   CB49+1(3),DECBKEY+1      MOVE KEY  ADDRESS TO CB49       11220000
         L     R12,DECBAREA             MOVE DATA ADDRESS TO CB50       11240000
         LA    R12,16(R0,R12)                                           11260000
         ST    R12,CB50                                                 11280000
         IC    R9,DCBLPDA+7             MOVE DCBLPDA CCHHR TO CB51      11300000
         LA    R12,1(R0,R9)              THEN INCREASE CB51 R BY 1      11320000
         STC   R12,CB51+4                                               11340000
         MVC   CB51(4),DCBLPDA+3                                        11360000
         LA    R12,IOBDADAD+3                                           11380000
         STH   R12,CB46+2                                               11400000
         SRL   R12,16                                                   11420000
         STC   R12,CB46+1               MOVE IOB ADDRESS TO CB46        11440000
         B     APPRVXCP                 EXCP RETURN TO IOS              11460000
APPM1C2  EQU   *                                                        11480000
         TM    CB26,X'08'               WAS ENTRY READ IN CB25 OFLO END 11500000
         BZ    APPM1D3                  YES  M1D3                       11520000
         MVC   IOBDADAD,CB25            MOVE CB25 MBBCCHHR TO IOB       11540000
         MVI   IOBAPP,X'0F'             SET APPENDAGE CODE TO 15        11560000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          11580000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            11600000
         LA    R12,CJ1                  START AT CJ1                    11620000
         ST    R12,IOBSTART-1                                           11640000
         LA    R12,IOBDADAD+3           MOVE IOB ADDRESS TO CJ1 AND CJ5 11660000
         ST    R12,CJ1                                                  11680000
         MVI   CJ1,SIDEQ                RESTORE COMMAND CODE     S20201 11686020
         MVC   CJ5+ONE(THREE),CJ1+ONE      MOVE IN ADDR OF SEEK  S20201 11692020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 11701020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE                        S20201 11710020
         LA    R12,0(R0,R0)             CMP TRK INDEX AND OFLO RCD MODL 11840000
         IC    R12,CB25                  ARE THEY THE SAME              11860000
         SLL   R12,4(R0)                                                11880000
         L     R12,32(R3,R12)                                           11900000
         LA    R12,0(R0,R12)                                            11920000
         CLR   R12,R7                                                   11940000
         BE    APPRVXCP                 YES - EXCP RETURN TO IOS        11960000
         MVI   IOBASYN,X'01'                                            11980000
         B     APPM1D4                  EXCP IN ASYNCHRONOUS ROUTINE    12000000
APPM1D3  MVI   IOBASYN,X'0A'            SET ASYNCHRONOUS CODE TO 10     12020000
APPM1D4  NI    IOBINDCT,X'DF'           INDICATE OFLO RECORD IN AREA    12040000
         B     APPM1B5                  SCHEDULE ASYNCHRONOUS ROUTINE   12060000
APPM1B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           12080000
APPM1B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  12100000
APPM1B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 12120002
         EJECT                                                          12200000
*              ABNORMAL END CP15,   APPENDAGE CODE 14,         CHART M1 12220000
APPM1J2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     12240000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       12260000
         B     APPM1B3                  YES  M1B3                       12280000
APPN3B21 LA    R13,APPN3B2                                              12300000
         BC    15,APPN3B22                                              12320000
APPM1B21 LA    R13,APPM1B2                                              12340000
APPN3B22 BR    R13                      NULL ROUTINE             Y02072 12360002
APPRVXCP EQU   *                                                        12500000
         SR    R12,R12                                                  12520000
         IC    R12,IOBDADAD             EXTENT                          12540000
         SLL   R12,4                    LENGTH OF 1 EXTENT=16           12560000
         LA    R12,32(R12,R3)           ADDR OF CORRECT EXTENT          12580000
         MVC   IOBDADAD+1(2),4(R12)     MOVE BB                         12600000
         LA    R14,EXCP(R14)            SETUP EXCP RETURN TO IOS  15924 12605016
         XC    IOBFLAG2(3),IOBFLAG2     CLEAR FLAG2,SENSE BYTES   15924 12610016
         XC    IOBCSW(9),IOBCSW         CLEAR FLAG3,CSW,AND SIOCC 15924 12615016
         XC    IOBERRCT(2),IOBERRCT     CLEAR ERROR COUNT         15924 12620016
         NI    IOBFLAG1,X'C2'           RESET FLAG1               15924 12625016
APPRVNOR BR    R14                      RETURN TO IOS             15924 12630016
         EJECT                                                          12640000
*                        ADDRESS OF COMMUNICATION VECTOR TABLE          12660000
CVTPTR   EQU   16                                                       12680000
LASTIND  EQU   X'02'       LAST BLK READ TO CHK FOR DELETES      A31323 12690020
*                             RETURN TO IOS VECTOR TABLE                12700000
MODID    DC    C'IGG019G0'              MODULE NAME            @ZA26522 12710037
DATE     DC    CL8'&SYSDATE'            FIX DATE               @ZA26522 12720037
FIX      DC    C' OZ26522'              LATEST FIX             @ZA26522 12730037
PATCH    DC    XL((*-IGG019G0)/20)'00'  ZEROED PATCH AREA        Y02072 12750002
*                                                                       12800002
CVT      DSECT                                                          12820000
         DS    F         COMMUNICATION VECTOR TABLE EXIT EFFECTOR       12840000
CVTEXEF  DS    A                        *                        Y02072 12850002
         SPACE 2                                                        12880002
RQE      IECDRQE ,                      RQE                      Y02072 12890002
         EJECT                                                          12892002
IHAPART2 DS    0D                       PART 2 VECTOR TABLE             12900000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              12920000
APPM67CE DS    CL6            7         CP1 OR CP2, WRITE KN            12940000
APPN7B2  DS    CL6            9,23      CP10A                           12960000
APPN8A2  DS    CL6            10,11     CP10B                           12980000
APPM4A2  DS    CL6            12        CP14  - SETUPS 1, 2, OR 5       13000000
APPM5A2  DS    CL6            13        CP14  - SET UPS 3, 4, OR 6      13020000
APPM2B2  DS    CL6            15        CP16 - SITUATION 2              13040000
APPM3B2  DS    CL6            16        CP16 - SITUATION 3              13060000
APPN9A2  DS    CL6            17,18,19  CP17                            13080000
         DS    CL6                                                17332 13090018
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              13100000
APPM67AE DS    CL6            7         CP1 OR CP2, WRITE KN            13120000
APPN7J2  DS    CL6            9,23      CP10A                           13140000
APPN8G2  DS    CL6            10,11     CP10B                           13160000
APPM4E2  DS    CL6            12        CP14  -SETUPS 1, 2, OR 5        13180000
APPM5E2  DS    CL6            13        CP14  -SETUPS 3, 4, OR 6        13200000
APPM2H2  DS    CL6            15,16     CP16                            13220000
APPN9G4  DS    CL6            17,18,19  CP17                            13240000
         DS    CL6                                                17332 13250018
APPN7A3  DS    CL4            CONTINUATION OF ROUTINES BEGUN IN         13260000
APPN7B4  DS    CL4                 PART 1                               13280000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              13300000
APPABA2  DS    CL6            0,1       CP4/CP5                         13320000
APPADB2  DS    CL6            2         CP7                             13340000
APPAAB2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     13360000
APPACA2  DS    CL6            5         CP6                             13380000
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              13400000
APPABD2  DS    CL6            0,1       CP4/CP5                         13420000
APPADE2  DS    CL6            2         CP7                             13440000
APPAAA2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     13460000
APPACE2  DS    CL6            5         CP6                             13480000
IHAWKNCP IGGWKNCP                                                       13490020
         IGGCP9A                                                        13500020
         IGGCP9B                                                        13520020
         IGGCP9C                                                        13540020
         EJECT                                                          16240000
*              DATA EVENT CONTROL BLOCK                                 16260000
IHADECB  DSECT                                                          16280000
         DS    0F                                                       16300000
DECBECB  DS    CL4                      EVENT CONTROL BLOCK (ECB)       16320000
DECBTYP1 DS    BL1                      TYPE B6 - 1 IF LENGTH IS S      16340000
*                                            B7 - 1 IF AREA IS S        16360000
DECBTYP2 DS    BL1                           B0 - 1 IF READ K           16380000
*                                            B1 - 1 IF READ KX          16400000
*                                            B2 - 1 IF READ KU          16420000
*                                            B4 - 1 IF WRITE K          16440000
*                                            B5 - 1 IF WRITE KN         16460000
DECBLGTH DS    CL2                      LENGTH OF BLOCK                 16480000
DECBDCBA DS    A                        POINTER TO DCB                  16500000
DECBAREA DS    A                        ADDRESS OF AREA                 16520000
DECBLOGR DS    A                        POINTER TO LOGICAL RECORD       16540000
DECBKEY  DS    A                        POINTER TO KEY                  16560000
DECBEXC1 DS    BL1                      EXCPTN CD B0-RECORD NOT FOUND   16580000
*                                                 B1-RECORD LGTH CHK    16600000
*                                                 B2-NO SPACE           16620000
*                                                 B3-INVALID REQUEST    16640000
*                                                 B4-UNCORRECTABLE IO   16660000
*                                                 B5-UNREACHABLE BLOCK  16680000
         DCBD  DSORG=(IS)                                        S20201 16690020
IHAIOB   IGGIOBD                                                        16700020
IHADCW   IGGBISAM                                                       16900020
IHADEB   IGGDEBD                                                        17200020
         END                                                            19460000
