         TITLE 'IGG019G1 - APPENDAGES-PART 1,UNBL,SYS WA,WITH WRT CHK'  00020000
IGG019G1 CSECT                                                          00040000
*          RELEASE OS/VS2-02 DELETIONS                                  00045002
*          RELEASE 19 DELETIONS                                       * 00060000
*          RELEASE 20 DELETIONS                                       * 00065000
*2331080200-080400                                               A38857 00065220
*2331088300,088600-093600,110900,111200-116600                   A34922 00065520
*2331045000,063610,063620,063630,063640,063650,063660,063670,    A31323 00066020
*2331063680,063690,063700,063710,063720,063730,064000,064200,    A31323 00067020
*2331067200,081600-082260,086000-087400,104800-105460            A31323 00068020
*2331019050-019100,019150,019200,039400-040000,040200-040600,    S20201 00068320
*2331048400,048600-049600,051400,052400,052600-053000,055600,    S20201 00068620
*2331061000,094140,126400,126600-127600,144800-149600,149800-    S20201 00068920
*2331154600,154800-159600,159800-164600,164800-169600,169800-    S20201 00069220
*2331178000,184000,184200,184400-210400                          S20201 00069520
*2331094160                                                      A38537 00069720
*          RELEASE 21 DELETIONS                                       * 00070000
*1202117140                                                      A44495 00070521
*1202022400,023400                                               S21045 00071021
*1202                                                            A33533 00072021
*1202                                                            A46955 00073021
*XXXX                                                            A49403 00073421
*1202022200                                                      A50670 00073800
*            CHANGES SINCE VS2-3.7                                    * 00074237
*A024400-024490,C024520                                        @ZA26522 00074637
*                                                                     * 00075002
*STATUS CHANGE LEVEL 008                                                00092002
*                                                                       00100000
* FUNCTION/OPERATION- APPENDAGE ROUTINES FOR BISAM                      00120000
*        WHEN WRITE KN IS USED WITH OR WITHOUT READ AND UPDATE          00140000
*        WHEN THE USER HAS NOT SUPPLIED A READ-IN AREA,                 00160000
*        WHEN WRITE VALIDITY CHECKING IS     REQUESTED,                 00180000
*        AND RECORD FORMAT IS UNBLOCKED.                                00200000
*        (PART 1)                                                       00220000
*                                                                       00240000
*                                                                       00260000
*        CEND  - IF CHANNEL PROGRAM ENDS                                00280000
*                **WITHOUT ERROR, EITHER                                00300000
*                    PROCESSING COMPLETION WILL BE SCHEDULED,           00320000
*                    PROCESSING CONTINUATION WILL BE SCHEDULED,         00340000
*                    OR PROCESSING WILL CONTINUE.                       00360000
*                **WITH A LENGTH CHECK, TESTS DETERMINE WHETHER         00380000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00400000
*                    ERROR.                                             00420000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00440000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00460000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00480000
*                                                                       00500000
*        ABEND - IF CHANNEL PROGRAM ENDS ABNORMALLY BECAUSE OF          00520000
*                **PERMANENT ERROR, 'UNCORRECTABLE I/O ERROR'           00540000
*                    IS INDICATED IN THE DECB, AND PROCESSING           00560000
*                    COMPLETION WILL BE SCHEDULED.                      00580000
*                    USE OF WRITE VALIDITY CHECKING OPTION              00600000
*                    ALLOWS A LIMITED NUMBER OF RE-EXECUTIONS           00620000
*                    BEFORE INDICATING AN ERROR.                        00640000
*                **NON-PERMANENT ERROR, ONE RE-TRY IS MADE              00660000
*                    BEFORE INDICATING A PERMANENT ERROR.               00680000
*                **FILE PROTECTION, TESTS DETERMINE WHETHER             00700000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00720000
*                    ERROR.                                             00740000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00760000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00780000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00800000
* ENTRY POINTS-                                                         00820000
*        ENTRY POINT               FUNCTION                             00840000
*        -----------               --------                             00860000
*        APPCEND                   CEND                                 00880000
*        APPABEND                  ABEND                                00900000
* INPUT - N/A                                                           00920000
* OUTPUT - N/A                                                          00940000
* EXTERNAL ROUTINES - N/A                                               00960000
*                                                                       00980000
* EXITS- 1. RETURN TO IOS VIA THE APPENDAGE RETURN VECTOR TABLE POINTED 01000000
*            TO BY REGISTER 14.  SEE THE DSECT LABELED    APPRV FOR THE 01020000
*            FORMAT OF THIS TABLE AND THE USE OF EACH EXIT.             01040000
*           USED TO CONTINUE PROCESSING.                                01060000
*        2. SCHEDULE AN ASYNCHRONOUS ROUTINE - BRANCH VIA THE EXIT      01080000
*            EFFECTOR ADDRESS IN THE COMMUNICATION VECTOR TABLE.        01100000
*           USED TO SCHEDULE PROCESSING COMPLETION OR CONTINUATION.     01120000
*        3. IF THE DESIRED APPENDAGE ROUTINE IS IN PART 2, BRANCH TO    01140000
*            THAT ROUTINE VIA THE PART 2 VECTOR TABLE.  THE POINTER TO  01160000
*            THE MODULE IS IN DCBWKPT5.  SEE THE DSECT LABELED          01180000
*            IHAPART2 FOR RELATIVE ADDRESSES AND USES OF THE ROUTINES.  01200000
*                                                                       01220000
* TABLES/WORK AREAS - DECB, DCB, IOB AND EXTENTION, DCB WA (DCW), DEB,  01240000
*        CVT, PART 2 VECTOR TABLE.                                      01260000
*        SEE DSECTS AT END OF MODULE FOR FORMAT AND DESCRIPTIONS.       01280000
*                                                                       01300000
* ATTRIBUTES- REENTRANT. DISABLED.                                      01320000
* NOTES - NONE                                                          01340000
         EJECT                                                          01360000
* GENERAL REGISTERS ARE USED AS FOLLOWS                                 01380000
*                                                                       01400000
R0       EQU   0                   *    -----                           01420000
R1       EQU   1                   *    12* ADDRESS                     01440000
R2       EQU   2                   *    IOB                             01460000
R3       EQU   3                   *    DEB                             01480000
R4       EQU   4                   *    DCB                             01500000
BASEXXXX EQU   5                        BASE REG FOR CLEANUP     Y02072 01512002
R6       EQU   6                   *    -----                           01540000
R7       EQU   7                   *    UCB                             01560000
SAVEXXXX EQU   8                        SAVE AREA FOR CLEANUP    Y02072 01570002
R9       EQU   9                   #    WORK REGISTER                   01600000
R10      EQU   10                       CHANNEL PROGRAM POINTER         01620000
R11      EQU   11                       DECB                            01640000
R12      EQU   12                       WORK REGISTER                   01660000
R13      EQU   13                       WORK REGISTER                   01680000
R14      EQU   14                       IOS RETURN VECTOR TABLE         01700000
R15      EQU   15                       BASE REGISTER                   01720000
*                                                                       01740000
*        * MEANS THIS REGISTER IS SET UP UPON ENTRY FROM IOS,           01760000
*          AND ITS CONTENTS MUST BE RESTORED UPON RETURN TO IOS         01780000
*        # MEANS THIS REGISTER MAY BE CHANGED, BUT UPON RETURN TO IOS   01800000
*          MUST CONTAIN ZEROES IN THE THREE HIGH ORDER BYTES            01820000
*                                                                       01840000
PERRMASK EQU   X'20'          TO TEST FOR PERMANENT ERROR, TEST         01860000
PERRYES  EQU   8               IOBECBAD, B2. IF OFF (CONDITION CODE 8)  01880000
PERRNO   EQU   7               THERE IS A PERM ERR. ELSE B2 ON ( CD 7)  01900000
ONE      EQU   1                        MISC OFFSETS             S20201 01900820
TWO      EQU   2                        *                        S20201 01901620
THREE    EQU   3                        *                        S20201 01902420
FOUR     EQU   4                        *                        S20201 01903220
FIVE     EQU   5                        *                        S20201 01904020
SEVEN    EQU   7                        *                        S20201 01906020
EIGHT    EQU   8                        *                        S20201 01908020
OFLOW    EQU   X'10'                    OVERFLOW BIT OF F BYTE   S20201 01910020
DUMMY    EQU   X'20'                    DUMMY BIT OF F BYTE      S20201 01912020
BYP      EQU   12                       RETURN TO IOS/BYPASS     S20201 01914020
CCOFF    EQU   X'BF'                    MASK FOR CC OFF                 01914401
*                                        1592                    S20201 01916020
EXCP     EQU   8                        RETURN TO IOS/EXCP       S20201 01920020
*                                        1592                    S20201 01924020
NORMAL   EQU   0                        RETURN TO IOS/NORMAL     S20201 01928020
*                                        1592                    S20201 01932020
ABENTRY  EQU   X'01'                    ABEND ENTRY INDICATOR    A50670 01934000
DATACHK  EQU   X'08'                    DATA CHECK IOB SENSE     A50670 01934400
REEXCP   EQU   8                        REEXCP RETURN TO IOS     Y02072 01934802
SKIPX    EQU   4                        SKIP RETURN TO IOS       Y02072 01935202
BYPASS   EQU   12                       BYPASS RETURN TO IOS     Y02072 01935602
FMVIOL   EQU   X'04'                    FILE MASK VIOLATION      Y02072 01935702
NOTSEEK  EQU   8                        CC - SEEK TEST SENSE B0  Y02072 01935802
SEEKCHK  EQU   X'01'                    SEEK CHECK INDICATOR     Y02072 01935902
*                                                                       01936002
         USING RQE,R1                   RQE ADDRESSABILITY       Y02072 01941902
         USING IHAIOB,R2                IOB POINTER              S20201 01948002
         USING IHADEB,R3                DEB POINTER                     01954002
         USING IHADCB,R4                DCB POINTER                     01960000
         USING IHAWKNCP,R10             CHANNEL PROGRAM POINTER         01980000
         USING IHADECB,R11              DECB POINTER                    02000000
         USING IHADCW,R12               DCB WA POINTER ONLY AS WORK REG 02020000
         EJECT                                                          02060000
*                             APPENDAGE VECTOR TABLE                    02080000
APP      DC    A(APPCEND-APP)           CHANNEL END       USED BY WKN   02100000
         DC    A(APPABEND-APP)          ABNORMAL END  -     USED BY WKN 02120000
APPNO    EQU   *                                                        02140000
         USING APPCEND,R15                                              02160000
APPCEND  NI    IOBINDCT,X'FE'          INDICATE CEND ENTRY              02180000
         B     SETUPREG                 BRANCH TO SET UP REGISTERS      02200000
APPABEND EQU   *                                                 A50670 02210000
         USING APPABEND,R15                                             02212000
*                                                                A50670 02220000
*        IF THIS IS A CORRECTABLE DATA CHECK FROM AN RPS         A50670 02222000
*        DEVICE THEN RETURN TO IOS FOR ERP HANDLING              A50670 02224000
*                                                                A50670 02226000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR          A50670 02226400
         BZ    NOCDACK                  YES CONTINUE AS USUAL    A50670 02226800
         TM    IOBSENS1,FMVIOL        WAS IT A SEEK CHECK        Y02072 02236802
         BCR   NOTSEEK,R14              NO - RETURN TO ERPS      Y02072 02238802
         SPACE 2                                                        02240802
NOCDACK  EQU   *                                                 A50670 02242100
         OI    IOBINDCT,ABENTRY         INDICATE ABEND ENTRY     A50670 02242500
SETUPREG L     R15,DEBEXPTR              GET ADDR OF DEB         S21045 02243000
*                                       EXTENSION PTR            S21045 02250400
         USING DEBEXT,R15                                        S21045 02257800
         L     R15,DEBWKPT4              R15  BASE               S21045 02265200
         DROP  R15                                                      02272600
         USING APP,R15                                                  02280000
*                                                                       02282002
*   SAVE IOS REGISTERS AND SET UP ADDRESSABILITY TO RETURN TO SPECIAL   02290002
*   CLEANUP ROUTINE.                                                    02292002
*                                                                       02292402
         STM   R14,R12,0(R13)           SAVE REGISTERS           Y02072 02294002
         LR    SAVEXXXX,R13             SAVE SAVE AREA PTR       Y02072 02296002
         LA    R14,IOSRETS              RETURN TO RETURN TO IOS  Y02072 02298002
         LR    BASEXXXX,R14             BASE REG FOR RETURN      Y02072 02298402
         SPACE 2                                                        02298502
         MODESET KEYADDR=RQEPRT,WORKREG=13 ACQUIRE USER KEY      Y02072 02298802
         SPACE 2                                                        02299202
         L     R10,IOBCCWAD             R10  CP                         02300000
         LA    R10,0(R10)               CLEAR HIGH ORDER BYTE    A49403 02302021
         MVC   IOBECBAD+1(3),IOBBCHAD+1 RESTORE ECB              A33533 02310021
         L     R11,IOBECBAD             R11  DECB                       02320000
         L     R13,DEBEXPTR              GET ADDR OF DEB         S21045 02326021
*                                       EXTENSION PTR            S21045 02332021
         USING DEBEXT,R13                                        S21045 02338021
         L     R13,DEBWKPT5              R13  BASE, PART 2       S21045 02344021
         DROP  R13                                               S21045 02350021
         USING IHAPART2,R13                                             02360000
         L     R12,IOBCSW               R12  ADDRESS OF LAST CCW + 8    02380000
         LA    R12,0(0,R12)                                             02400000
         IC    R9,IOBAPP                R9   RELATIVE ADDRESS IN        02420000
         CH    R9,TWOTHREE              IS APP CODE GT 23?     @ZA26522 02440037
         BNH   CODEOK                   IF NOT BYPASS PROGCHK  @ZA26522 02443037
         DC    H'0'                     PROG CHK FOR BAD CODE  @ZA26522 02446037
TWOTHREE DC    X'0017'                  MAX VALUE FOR APP CODE @ZA26522 02449037
CODEOK   SLL   R9,2                            APPENDAGE TABLE @ZA26522 02452037
         TM    IOBINDCT,X'01'                                           02460000
         BO    APPABENT(R9)            IF ABEND, BRANCH VIA ABEND TABLE 02480000
         B     APPCENDT(R9)            IF CEND, BRANCH VIA THAT TABLE   02500000
         EJECT                                                          02520000
*********************************************************************** 02540000
*****              CHANNEL END APPENDAGE VECTOR TABLE             ***** 02560000
*********************************************************************** 02580000
APPCENDT EQU   *              CODE      FOR COMPLETION OF               02600000
         B     APPABA2   0             CP4/CP5, READ                    02620000
         B     APPABA2   1             CP4/CP5, WRITE                   02640000
         B     APPADB2   2             CP7                              02660000
         B     APPAAB2   3             CP1 OR CP2, READ AND UPDATE      02680000
         B     APPRVNOR  4             NOT USED                         02700000
         B     APPACA2   5             CP6                              02720000
         B     APPAHB2   6             CP4/CP5 WRITE CHECK              02740000
         B     APPM67CE  7             CP1 OR CP2, WRITE KN             02760000
         B     APPN3B21                                                 02780000
         B     APPN7B2   9             CP10AW - TRUE INSERT             02800000
         B     APPN8A2   10            CP10BW - TRUE INSERT             02820000
         B     APPN8A2   11            CP10BW - ADD TO END              02840000
         B     APPM4A2   12            CP14W - SETUPS 1, 2, OR 5        02860000
         B     APPM5A2   13            CP14W - SETUPS 3, 4, OR 6        02880000
         B     APPM1B21                                                 02900000
         B     APPM2B2   15            CP16 - SITUATION 2               02920000
         B     APPM3B2   16            CP16 - SITUATION 3               02940000
         B     APPN9A2   17            CP17W - TRACK INDEX ONLY         02960000
         B     APPN9A2   18            CP17W - TRACK AND HIGHER LEVELS  02980000
         B     APPN9A2   19            CP17W - HIGHER LEVELS ONLY       03000000
         B     APPN4B2   20            CP9A                             03020000
         B     APPN5B2   21            CP9BW                            03040000
         B     APPN6B2   22            CP9CW                            03060000
         B     APPN7B2   23             CP10AW - ADD TO END             03080000
         EJECT                                                          03100000
*********************************************************************** 03120000
*****             ABNORMAL END APPENDAGE VECTOR TABLE             ***** 03140000
*********************************************************************** 03160000
APPABENT EQU   *              CODE      FOR COMPLETION OF               03180000
         B     APPABD2   0             CP4/CP5, READ                    03200000
         B     APPABD2   1             CP4/CP5, WRITE                   03220000
         B     APPAIB2   2             CP7                              03240000
         B     APPAAA2   3             CP1 OR CP2, READ AND UPDATE      03260000
         B     APPRVNOR  4             NOT USED                         03280000
         B     APPACE2   5             CP6                              03300000
         B     APPAHD2   6             CP4/CP5 WRITE CHECK              03320000
         B     APPM67AE  7             CP1 OR CP2, WRITE KN             03340000
         B     APPN3E2   8             CP8                              03360000
         B     APPJ3B2   9             CP10AW - TRUE INSERT             03380000
         B     APPJ4B2   10            CP10BW - TRUE INSERT             03400000
         B     APPJ4B2   11            CP10BW - ADD TO END              03420000
         B     APPJ5B2   12            CP14W - SETUPS 1, 2, OR 5        03440000
         B     APPJ6B2   13            CP14W - SETUPS 3, 4, OR 6        03460000
         B     APPM1J2   14            CP15                             03480000
         B     APPM2H2   15            CP16 - SITUATION 2               03500000
         B     APPM2H2   16            CP16 - SITUATION 3               03520000
         B     APPJ7B2   17            CP17W - TRACK INDEX ONLY         03540000
         B     APPJ7B2   18            CP17W - TRACK AND HIGHER LEVELS  03560000
         B     APPJ7B2   19            CP17W - HIGHER LEVELS ONLY       03580000
         B     APPN4G2   20            CP9A                             03600000
         B     APPJ1B2   21            CP9BW                            03620000
         B     APPJ2B2   22            CP9CW                            03640000
         B     APPJ3B2   23             CP10AW - ADD TO END             03660000
         DROP  R13                                                      03680000
         USING CVT,R13                  COMMUNICATION VECTOR TABLE      03700000
         EJECT                                                          03720000
*   SPECIAL IOS RETURN CLEANUP ROUTINE INTERCEPTS ALL RETURNS TO        03730002
*   IOS AND RESTORES REGISTERS AND SETS PROTECTION KEY TO 0.            03740002
         SPACE 2                                                 Y02072 03750002
IOSRETS  EQU   *                        RETURN POINT             Y02072 03760002
         USING *,BASEXXXX               ADDRESSABILITY           Y02072 03760402
         B     NORMRET                  NORMAL RETURN            Y02072 03760802
         B     SKIPRET                  SKIP POST RETURN         Y02072 03761202
         B     REEXCPRT                 REEXCP RETURN            Y02072 03761302
         SPACE 2                                                        03761402
BYPASRET EQU   *                        BYPASS POST RETURN       Y02072 03761502
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03764002
         LA    R14,BYPASS(R14)          SCHEDULE ASYNCH ROUTINE  Y02072 03766002
         L     R13,CVTPTR               CVT ADDRESSABILITY       Y02072 03766402
         L     R13,CVTEXEF              ASYNCH SCHED ROUTINE     Y02072 03766802
         BR    R13                      GO TO ROUTINE            Y02072 03767202
         SPACE 2                                                        03767302
REEXCPRT EQU   *                        REEXCP RETURN            Y02072 03767402
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03768502
         B     REEXCP(R14)              RETURN - REEXCP          Y02072 03770502
         SPACE 2                                                        03770602
SKIPRET  EQU   *                        RETURN - SKIP            Y02072 03770702
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03770802
         B     SKIPX(R14)               RETURN - SKIP            Y02072 03771402
         SPACE 2                                                        03771802
NORMRET  EQU   *                        RETURN - NORMAL          Y02072 03772202
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03772602
         BR    R14                      RETURN                   Y02072 03772702
         SPACE 2                                                        03773202
IOSRETX  EQU   *                        RESTORE REGS AND KEY     Y02072 03773602
         MODESET KEYADDR=KEY0,WORKREG=13   SET KEY = 0           Y02072 03774002
         SPACE 2                                                        03774102
         LM    R14,R11,0(SAVEXXXX)      RESTORE REGISTERS        Y02072 03774402
         BR    R12                      RETURN                   Y02072 03774902
         DROP  BASEXXXX                 RESET ADDRESSABILITY     Y02072 03775302
         SPACE 1                                                 Y02072 03775702
KEY0     DC    H'0'                     KEY 0                    Y02072 03775802
         EJECT                                                   Y02072 03775902
*              CHANNEL  END CP8,    APPENDAGE CODE  8,         CHART N3 03776002
APPN3B2  EQU   *                        *                               03776502
*                                                                       03777002
         LA    R13,CB8A+EIGHT           DID CHANNEL PROGRAM END ON      03777502
         CLR   R12,R13                  CB8A                            03778002
         BNE   APPAOS22                 NO, CONTINUE                    03780002
         TM    CB8A+FIVE,CC             WAS CB8A CHAINED                03782502
         BZ    APPAOS22                 NO, CP UNCHANGED                03785002
         NI    CB8A+FIVE,CCOFF          RESET CHAIN IND.                03787502
         OI    CB8A+FOUR,CC             TURN CC BACK ON                 03790002
         CLI   CB12,SEEKHH              CB12 SET FOR HEAD SEEK          03792502
         BNE   APPN3F3                  NO,  FILE PROTECT               03795002
         LA    R13,CB16                 RESET IOBSTART                  03797502
         ST    R13,IOBSTART-ONE         START CP WITH SETSECT           03800002
         MVC   IOBDADAD,CB10+SEVEN      RESET IOBSEEK                   03802502
         B     APPRVXCP                 SECHDULE EXCP IOS RETURN        03805002
APPAOS22 EQU   *                        *                               03807502
*                                                                       03810002
         LA    R13,CB21+EIGHT           DID CHAN PROG STOP AT CB21      03812502
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      03815002
         BNE   APPN3A3                  NO - CHECK FOR LENGTH ERROR     03817502
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         03820000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   03840000
         BO    APPN3C2A                 BO IF SHARED                    03860000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         03880000
         B     APPN3C2B                                                 03900000
APPN3C2A MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         03920000
APPN3C2B EQU   *                                                 S20201 03970020
APPN3C2D MVC   IOBDADAD+3(5),CB23+3     MOVE CB23 CCHHR TO IOB          04080000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        04100000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   04120000
         LA    R13,CB30                 START AT CB30                   04140000
         ST    R13,IOBSTART-1                                           04160000
         LA    R13,IOBDADAD+3           PUT SEEK ADDRESS IN CB30,       04180000
         IC    R9,CB30                   CB34, AND CB40                 04200000
         ST    R13,CB30                                                 04220000
         STC   R9,CB30                                                  04240000
         MVC   CB34+1(3),CB30+1                                         04260000
         MVC   CB40+1(3),CB30+1                                         04280000
         MVC   CB37A+1(3),CB34+1        PUT SEEK ADDRESS IN CB37A       04300000
         MVC   CB43A+1(3),CB40+1        PUT SEEK ADDRESS IN CB43A       04320000
         MVC   CB36+1(3),DECBKEY+1      PUT I IN CB36 AND CB38          04340000
         MVC   CB38+1(3),DECBKEY+1                                      04360000
         L     R13,DECBAREA             PUT AREA + 16 IN CB37 AND CB39  04380000
         LA    R13,16(R0,R13)                                           04400000
         IC    R9,CB37                                                  04420000
         ST    R13,CB37                                                 04440000
         STC   R9,CB37                                                  04460000
         MVC   CB39+1(3),CB37+1                                         04480000
         NI    IOBINDCT,X'FF'-LASTIND   FLAG NORMAL USE OF CP9A  A31323 04480920
*                                                                       04481302
*        TEST FOR OUT OF SPACE CONDITION                                04481820
*                                                                       04482202
         TM    DCBOPTCD,X'08'          CYL OVFL OPTION           A31323 04482720
         BZ    APPNSC                  IF NO-BRANCH              A31323 04483620
         CLI   CB22+5,X'00'            CYL OVFL FULL             A31323 04484520
         BNE   APPRVXCP                IF NO-BRANCH              A31323 04485420
APPNSC   TM    DCBOPTCD,X'10'          INDEP OVFL OPTION         A31323 04486320
         BZ    APPNSE                  IF NO-BRANCH              A31323 04487220
*      ADJUST DCBRORG2 TO ZERO IF IND OVFL IS FULL              SA53815 04489202
         LH    R13,DCBRORG2             LAST UNFILLED IOV TRK?  SA53815 04489602
*                                                                       04489702
         LTR   R13,R13                  ANY IND OVRFLOW TRKS    SA65051 04489802
         BZ    APPNSD                   BRANCH IF NO            SA65051 04492002
         BCT   R13,APPRVXCP             NO - BR TO READ BLOCK   SA53815 04496202
*                                       YES - CONTINUE          SA53815 04498402
APPNSD   IC    R13,DCBLIOV+7            GET LIOV (REC NO.)      SA65051 04500602
         LA    R13,1(R13)               BUMP REC NO.            SA53815 04502802
         SR    R12,R12                  CLEAR REG               SA53815 04505002
         IC    R12,DCBHIIOV             GET HIGHEST REC. NO.    SA53815 04507202
         CLR   R13,R12                  LIOV+EOF FILLS LAST TRK?SA53815 04509402
         BNE   APPRVXCP                 NO - BR TO READ BLOCK   SA53815 04511602
*                                       YES - CONTINUE          SA53815 04513802
         SR    R13,R13                  REDUCE NUMBER OF -      SA53815 04516002
         STH   R13,DCBRORG2             IND OVFL TRKS TO ZERO   SA53815 04518202
APPNSE   CLC   IOBDADAD(7),DCBLPDA      ON LAST TRK OF DATA SET  A31323 04520402
         BNE   APPNSG                   NO, BRANCH               A31323 04522602
         TM    DCBST,X'01'              IS LAST TRACK FULL       A31323 04524802
         BNO   APPRVXCP                 NO, BR--SPACE IS AVAIL   A31323 04527002
APPNSG   TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN  A31323 04529202
         BO    APPNSI                   YES, BR--RD LAST BLK TO  A31323 04531402
*                                                                       04533602
*        CHECK FOR DELETED RECORDS.  OTHERWISE, SET NO SPACE FND        04535802
*                                                                       04538002
         OI    DECBEXC1,X'20'           THEN READ DESIRED BLK    A31323 04540202
         B     APPRVXCP                 TO CHECK FOR DUP RECS.   A31323 04542402
APPNSI   OI    IOBINDCT,LASTIND         WILL CHECK LAST RECORD   A31323 04544602
         L     R12,DCBWKPT2             RESTORE WORK AREA BASE   A31323 04546802
         USING IHADCW,R12                                        A31323 04549002
         MVC   IOBDADAD+7(1),DCWHIRPS   SET R TO LAST ON TRK     A31323 04551202
         B     APPRVXCP                 CHK RECORD FOR DELETION  A31323 04553402
APPN3B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           04555602
APPN3B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  04557802
APPN3B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 04560002
APPN3B6  LA    R13,CB8A+EIGHT           DID CP STOP AT CB8A      S20201 04622020
         CLR   R12,R13                  COMPARE REGS             S20201 04624020
         BNE   APPN3B3                  NO, UNREACHABLE BLOCK    S20201 04626020
         TM    CB11+SEVEN,OFLOW+DUMMY   OFLO, INACTIVE, OR DUMMY S20201 04628020
         BNZ   APPN3F3                  YES, GO TO FILE PROTECT  S20201 04630020
         MVC   CB23+THREE(FOUR),CB11+TWO  SET UP CCHH            S20201 04632020
         MVI   CB23+SEVEN,ONE           SET R EQUAL TO 1         S20201 04634020
         B     APPN3C2D                 GO READ RECORD           S20201 04636020
         EJECT                                                          04640000
*              ABNORMAL END CP8,    APPENDAGE CODE  8,         CHART N3 04660000
APPN3E2  EQU   *                                                  19374 04680000
         TM    IOBSENSE+1,X'04'         WAS ABEND DUE TO FILE     15924 04700016
*                                       PROTECT                   15924 04710016
         BO    APPN3F2                  YES--BRANCH               19374 04720000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 04730000
         BC    PERRYES,APPN3B3          YES--BRANCH               19374 04740000
         B     APPRVNOR                 NO--RETRY CHANNEL PGM     19374 04750000
APPN3F2  LA    R13,CB12+8               DID CHAN PROG STOP AT CB12      04780000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      04800000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      04820000
APPN3F3  TM    CB11+SEVEN,OFLOW         WAS OFLO TRK IX ENTRY RD S20201 04830020
         BZ    APPN3G3                  BZ IF NO                 S20201 04840020
         TM    CB11+SEVEN,DUMMY                                  S20201 04850020
         BO    APPN3G3                  BO IF NO                        04980000
         MVC   CJ11(7),IOBDADAD         SAVE TRACK INDEX MBBCCHH        05000000
         MVI   IOBAPP,X'10'             SET APPENDAGE CODE TO 16        05020000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          05040000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            05060000
         LA    R13,CJ1                  START AT CJ1                    05080000
         ST    R13,IOBSTART-1                                           05100000
         MVC   IOBDADAD,CB10+7          PUT CB10 MBBCCHHR IN IOB        05120000
         LA    R13,IOBDADAD+3           PUT SEEK ADDRESS IN CJ1 AND CJ5 05160000
         IC    R9,CJ1                                                   05180000
         ST    R13,CJ1                                                  05200000
         STC   R9,CJ1                                                   05220000
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 05230020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE   MOVE IN ADDR OF KEY  S20201 05240020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE                        S20201 05250020
         L     R12,DCBWKPT2             SET ON FIRST TIME ONLY SWITCH   05320000
         USING IHADCW,R12                                        S20201 05330020
         OI    DCWWKNI,X'40'                                            05340000
         LA    R12,0(R0,R0)             IS FIRST OFLO ON SAME MODULE    05360000
         IC    R12,CB10+7                      GET M OF OFLO ENTRY      05380000
         SLL   R12,4(R0)                       MULT BY 16               05400000
         L     R12,32(R12,R3)                  LOAD UCB ADDR FROM DEB   05420000
         LA    R12,0(R0,R12)                   COMP WITH UCB AD IN 7    05440000
         CR    R12,R7                                                   05460000
         BE    APPRVXCP                 SAME MODULE - EXCP RTRN TO IOS  05480000
         MVI   IOBASYN,X'01'            DIFFERENT MODULE - MUST EXCP    05500000
         B     APPN3B5                   IN ASYNCHRONOUS ROUTINE        05520000
APPN3A3  TM    IOBCSW+5,X'40'           DID CHAN PROG HAVE LENGTH ERROR 05540000
         BZ    APPN3B6                  GO TEST FOR SPECIAL CASE S20201 05560020
         TM    CB11+7,X'30'             WAS ENTRY INACTIVE              05580000
         BO    APPN3B3                  BO IF YES                       05600000
APPN3G3  TM    CB11+7,X'20'             VERIFY ADD-TO-END SITUATION     05620000
         BZ    APPN3B3                  BZ IF DUMMY OR INACTIVE         05640000
         CLI   DCBNLEV,X'00'            ERROR IF 2 OR MORE INDEX LEVELS 05660000
         BNE   APPN3B3                  BNE IF MORE THAN 1 INDEX LEVEL  05680000
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         05700000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   05720000
         USING IHADCW,R12                                        S20201 05730020
         BO    APPN3G33                 BO IF SHARED                    05740000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         05760000
         B     APPN3G5                                                  05780000
APPN3G33 MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         05800000
APPN3G5  MVI   IOBAPP,X'0E'             SET APPENDAGE CODE TO 14        05820000
         MVC   IOBDADAD(3),DCBLPDA      SEEK TO DCBLETI'S CYLINDER      05840000
         MVC   IOBDADAD+3(4),DCBLETI    CCHH                            05860000
         OC    IOBDADAD+6(1),DCBFIRSH+3                                 05880000
         XC    IOBDADAD+6(1),DCBFIRSH+3 REDUCE TO CYL BOUNDRY OR ZERO   05900000
         MVI   IOBDADAD+7,0                                             05920000
         LA    R12,CI1                  START AT CI1                    05940000
         ST    R12,IOBSTART-1                                           05960000
         NI    IOBFLAG1,X'7F'           DON'T USE DATA CHAINING         05980000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            06000000
         LA    R12,IOBDADAD+3           PUT SEEK ADDRESS IN CI1         06020000
         IC    R9,CI1                                                   06040000
         ST    R12,CI1                                                  06060000
         STC   R9,CI1                                                   06080000
         MVC   CI5+TWO(FIVE),DCBLETI    PUT DCBLETI CCHHR IN CI5 S20201 06090020
         MVC   CI5(TWO),DCBLPDA+ONE     MOVE IN BB FOR HEAD SEEK S20201 06100020
         B     APPRVXCP                                                 06120000
         EJECT                                                          06140000
*              CHANNEL  END CP9A,   APPENDAGE CODE 20,         CHART N4 06160000
APPN4B2  LA    R13,CB33+8               DID CHAN PROG STOP AT CB33      06180000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      06200000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      06220000
         L     R12,CB32                 KEY OF RECORD JUST READ         06240000
         LA    R12,0(R0,R12)                                            06260000
         L     R13,DECBKEY              KEY OF NEW RECORD               06280000
         IC    R9,DCBKEYLE                                              06300000
         BCTR  R9,R0                                                    06320000
         EX    R9,APPN4C2A              ARE KEYS EQUAL                  06340000
         BE    APPN4C3                  YES  C3                         06360000
         TM    DECBEXC1,X'20'           WAS NO SPACE FOUND       A31323 06366020
         BO    APPN3B4                  YES, POST REQ IN ERROR   A31323 06369020
         NI    CB35+4,X'00'             NO - SET OFF REPL-OF-DEL FLAG   06380000
         L     R12,DCBWKPT2             SET WORK AREA BASE       A31323 06382020
         USING IHADCW,R12                                        A31323 06384020
         TM    IOBINDCT,LASTIND         WAS LAST BLK READ        A31323 06386020
         BZ    APPN4B7                  NO, BR TO CONTINUE       A31323 06388020
         NI    IOBINDCT,X'FF'-LASTIND   TURN OFF BIT             A31323 06390020
         L     R13,CB33                 POINT TO DATA FIELD      A31323 06392020
         CLI   0(R13),X'FF'             WAS RECORD DELETED       A31323 06394020
         BNE   APPN4B50                 NO, BR--SPACE NOT AVAIL  A31323 06396020
         BAL   R13,COMPLDT              YES, SPACE MAY BE AVAIL  A31323 06398020
*                                                                       06398402
*        RETURN HERE IF RECORD MUST BE BUMPED.  RETURN HERE + 4         06400020
*        (AFTER THE NEXT INSTRUCTION) IF RECORD NEED NOT GO INTO        06402020
*        OVERFLOW.                                                      06404020
*                                                                       06404102
         USING IHADCW,R12                                        S20201 06404402
APPN4B50 OI    DECBEXC1,X'20'           SPACE IS NOT AVAILABLE   A31323 06406020
APPN4B5  CLC   DCWHIRPS(1),CB23+7       IS THIS THE DESIRED BLK  A31323 06408020
         BE    APPN4E4                  YES, BRANCH              A31323 06410020
         MVC   IOBDADAD+7(1),CB23+7     NO, SEEK TO CORRECT BLK  A31323 06412020
         B     APPRVXCP                 READ IT IN               A31323 06414020
APPN4B7  CLC   IOBDADAD+7(1),DCWHIRPS   WAS RCD LAST ON TRK      A31323 06424020
         BE    APPN4E4                  YES  E4                         06440000
         OI    CB37C+4,X'40'            SET ON  CB37C CC FLAG           06460000
APPN4F4  MVI   IOBAPP,X'15'             SET APPENDAGE CODE TO 21        06480000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               06500000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   06520000
         LA    R12,CB34                 START AT CB34                   06540000
         ST    R12,IOBSTART-1                                           06560000
         B     APPRVXCP                                                 06580000
APPN4C3  TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         06600000
         BZ    APPN4B4                  NO   B4                         06620000
         L     R12,CB33                 IS RECORD MARKED FOR DELETION   06640000
         CLI   0(R12),X'FF'                                             06660000
         BNE   APPN4B4                  NO   B4                         06680000
         OI    CB35+4,X'80'             SET ON REPL-OF-DEL FLAG         06700000
APPN4E4  TM    DECBEXC1,X'20'           WAS NO SPACE AVAIL       A31323 06710020
         BO    APPN3B4                  YES, POST REQ IN ERROR   A31323 06720020
         NI    CB37C+4,X'BF'            TURN OFF CC IN CB37C     A31323 06730020
         B     APPN4F4                                                  06740000
APPN4B4  OI    DECBEXC1,X'01'           INDICATE DUPLICATE RECORD       06760000
         MVI   IOBASYN,X'08'                                            06780000
         B     APPN3B5                  SCHEDULE PROCESSING COMPLETION  06800000
         EJECT                                                          06820000
*              ABNORMAL END CP9A,   APPENDAGE CODE 20,         CHART N4 06840000
APPN4G2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     06860000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       06880000
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     06900000
         BZ    APPN3B3                  NO   N3B3                       06920000
         LA    R13,CB32+8               DID CHAN PROG STOP AT CB32      06940000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      06960000
         BE    APPN4K2                  YES - UNCORRECTABLE I/O ERROR   06980000
         LA    R13,CB33+8               DID CHAN PROG STOP AT CB33      07000000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      07020000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      07040000
APPN4K2  OI    DECBEXC1,X'08'           UNCORRECTABLE I/O ERROR         07060000
         B     APPN3B4                                                  07080000
APPN4C2A CLC   0(0,R13),0(R12)          EXECUTED INSTRUCTION            07100000
         EJECT                                                          07120000
*              CHANNEL  END CP9BW,  APPENDAGE CODE 21,         CHART N5 07140000
APPN5B2  LA    R13,CB39+8               DID CHAN PROG STOP AT CB39      07160000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      07180000
         BNE   APPN5B3                  NO - TRY CB38                   07200000
         IC    R9,IOBDADAD+7            INCREASE R IN IOB BY 1          07220000
         LA    R13,1(R0,R9)                                             07240000
         STC   R13,IOBDADAD+7                                           07260000
         L     R12,DCBWKPT2             WAS RCD JUST READ LAST ON TRACK 07280000
         USING IHADCW,R12                                        S20201 07290020
         CLC   IOBDADAD+7(1),DCWHIRPS                                   07300000
         BE    APPN5D1                  YES  D1                         07320000
         OI    CB43C+4,X'40'            SET ON  CB43C CC FLAG           07340000
APPN5E1  MVI   IOBAPP,X'16'             SET APPENDAGE CODE TO 22        07360000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   07380000
         LA    R12,CB40                 START AT CB40                   07400000
         ST    R12,IOBSTART-1                                           07420000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               07440000
         B     APPRVXCP                 EXCP RETURN TO IOS              07460000
APPN5D1  NI    CB43C+4,X'BF'            SET OFF CB43C CC FLAG           07480000
         B     APPN5E1                                                  07500000
APPN5B3  LA    R13,CB38+8               DID CHAN PROG STOP AT CB38      07520000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      07540000
         BNE   APPN5B4                  NO - TRY CB37C                  07560000
         TM    IOBCSW+4,X'01'           DID CHAN PROG END WITH EOF      07580000
         BZ    APPN3B3                  NO   N3B3                       07600000
         MVI   IOBAPP,X'09'             SET APPENDAGE CODE TO 9         07620000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   07640000
         LA    R12,CB46                 START AT CB46                   07660000
         ST    R12,IOBSTART-1                                           07680000
         MVC   CB51(4),IOBDADAD+3       MOVE IOB CCHHR (PLUS 1) TO CB51 07700000
         IC    R9,IOBDADAD+7                                            07720000
         LA    R12,1(R0,R9)                                             07740000
         STC   R12,CB51+4                                               07760000
         MVC   CB49+1(3),CB32+1         MOVE KEY  ADDRESS TO CB49       07780000
         MVC   CB50+1(3),CB33+1         MOVE DATA ADDRESS TO CB50       07800000
         LA    R12,IOBDADAD+3                                           07820000
         IC    R9,CB46                  SAVE                            07840000
         ST    R12,CB46                 PUT IOB ADDRESS IN CB46         07860000
         STC   R9,CB46                  RESTORE                         07880000
         MVC   CB50A+1(3),CB46+1        PUT IOB ADDRESS IN CB50A        07900000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               07920000
         B     APPRVXCP                 EXCP RETURN TO IOS              07940000
APPN5B4  LA    R13,CB37C+8              DID CHAN PROG STOP AT CB37C     07960000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      07980000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      08000000
         TM    CB35+4,X'80'             IS REPL-OF-DEL FLAG ON   A38857 08000620
         BO    APPN3B4                  B IF YES                 A38857 08001220
         L     R12,DCBWKPT2             GET WKAREA BASE          A34922 08002020
         CLC   DCWHIRPS(1),IOBDADAD+7   END OF TRACK STOP        A34922 08004020
         BE    APPN5B5                  YES, BRANCH              A34922 08006020
         OI    CB37C+4,CC               PUT CP BACK TOGETHER     A34922 08008020
         LA    R13,CB37A                START LAST HALF OF CHAN  A34922 08010020
         ST    R13,IOBSTART-1           PROGRAM TO READ NEXT REC A34922 08012020
         B     APPRVXCP                 RESTART CHANNEL PROG     A34922 08014020
APPN5B5  EQU   *                        PROCESS END OF TRACK     A34922 08016020
         TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         08060000
         BZ    APPN5F4                  NO   F4                         08080000
         L     R12,CB33                 IS RECORD MARKED FOR DELETION   08100000
         CLI   0(R12),X'FF'                                             08120000
         BNE   APPN5F4                  NO   F4                         08140000
         BAL   R13,COMPLDT              SEE IF MUST BUMP RECORD  A31323 08160020
         B     APPN5F4                  YES, RETURN HERE         A31323 08180020
*                                       NO, DON'T BUMP                  08200020
         MVC   IOBDADAD+5(3),CB23       MOVE CB23 CCHHR TO IOB          08240000
         MVI   IOBAPP,X'11'             SET APPENDAGE CODE TO 17        08260000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   08280000
         LA    R12,CK1                  START AT CK1                    08300000
         ST    R12,IOBSTART-1                                           08320000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  08340000
         ST    R12,CK1                                                  08360000
         MVI   CK1,X'31'                                                08380000
         ST    R12,CK4                                                  08400000
         MVI   CK4,X'31'                                                08420000
         MVC   CK6+1(3),DECBKEY+1       PUT I ADDRESS IN CK6            08440000
         MVC   CK7A+1(3),CK1+1          PUT IOB ADDRESS IN CK7A         08460000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               08480000
         B     APPRVXCP                 EXCP RETURN TO IOS              08500000
APPN5F4  OI    IOBINDCT,X'20'           INDICATE OFLO RECORD IN W       08520000
         MVI   IOBASYN,X'09'            SET ASYNCHRONOUS CODE TO 9      08540000
         MVC   CH7+1(3),DECBKEY+1       PUT I ADDRESS IN CH7            08560000
         B     APPN3B5                  SCHEDULE ASYNCHRONOUS ROUTINE   08580000
COMPLDT  IC    R9,DCBHMASK              GET TRACK MASK           A31323 08590020
         SLL   R13,8                    MOVE OVER RETURN ADDR    A31323 08600020
         IC    R13,IOBDADAD+6           PICK UP TRACK BYTE       A31323 08610020
         NR    R9,R13                   MASK OFF TRACK           A31323 08620020
         SRL   R13,8                    RESTORE RETURN ADDR      A31323 08630020
         EX    R9,CLILDT                SEE IF LAST TRK OF CYL   A31323 08640020
         BE    COMPLDT1                 BRANCH IF ON LAST TRACK  A31323 08650020
*                                                                       08652002
*        IF NOT LAST TRACK, CHECK TO SEE IF LAST TRK OF PRIME.          08660020
*                                                                       08662002
         CLC   IOBDADAD(7),DCBLPDA      LAST PRIME DATA TRK      A31323 08670020
         BNE   4(R13)                   NO, DON'T BUMP RECORD    A31323 08680020
COMPLDT1 TM    CB26,X'08'               DOES OVERFLOW IX ENTRY   A31323 08690020
*                                                                       08692002
*        INDICATE THE EXISTENCE OF A CHAIN.                             08700020
*                                                                       08702002
         BO    4(R13)                   YES, NO NEED TO BUMP     A31323 08710020
         BR    R13                      MUST BUMP--NO CHAIN YET  A31323 08720020
CLILDT   CLI   DCBLDT+1,0               REC ON LAST TRK OF CYL          08760000
         EJECT                                                          08780000
*              ABNORMAL END CP9BW,  APPENDAGE CODE 21,         CHART J1 08800000
APPJ1B2  EQU   *                                                        08810013
         TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     08820013
         BC    PERRNO,APPJ1B3           NO, SEE WHERE STOPPED    A34922 08830020
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     08840013
         BZ    APPN3B3                  NO- RECORD UNREACHABLE          08850013
APPJ1E3  OI    DECBEXC1,X'08'           UNCORRECTABLE I/O ERROR         09380000
         B     APPN3B4                                                  09400000
APPJ1B3  LA    R13,CB38+8               POINT TO NEXT READ       A34922 09402020
         CLR   R12,R13                  DID CP GET THIS FAR      A34922 09404020
         BL    APPJ1B4                  NO, RETRY CHAN PGM       A34922 09406020
         LA    R13,CB37A                OTHERWISE, START AT      A34922 09408020
         ST    R13,IOBSTART-1           LAST HALF OF CHAN PGM    A34922 09410020
         B     APPRVNOR                 RETRY CHANNEL PROGRAM    A34922 09412020
APPJ1B4  EQU   *                                                 A38537 09413020
         TM    IOBSENSE,TCC             TRK COND CHK             A38537 09414020
TCC      EQU   X'02'                                             A38537 09415020
         BO    APPRVNOR                 LET 9BW COMPLETE         A38537 09416020
         NI    CB37C+4,X'FF'-CC         OFF WITH CC              A38537 09417020
         B     APPRVNOR                 GO TO ERROR RECOVERY     A34922 09418020
         EJECT                                                          09420000
*              CHANNEL  END CP9CW,  APPENDAGE CODE 22,         CHART N6 09440000
APPN6B2  LA    R13,CB45+8               DID CHAN PROG STOP AT CB45      09460000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      09480000
         BNE   APPN6B3                  NO - TRY CB44                   09500000
         IC    R9,IOBDADAD+7            INCREASE R IN IOB BY 1          09520000
         LA    R13,1(R0,R9)                                             09540000
         STC   R13,IOBDADAD+7                                           09560000
         L     R12,DCBWKPT2             WAS RCD JUST READ LAST ON TRACK 09580000
         USING IHADCW,R12                                        S20201 09590020
         CLC   IOBDADAD+7(1),DCWHIRPS                                   09600000
         BNE   APPN6E2                  NO   E2                         09620000
         NI    CB37C+4,X'BF'            SET OFF CB37C CC FLAG           09640000
         NI    CB35+4,X'7F'             SET OFF REPL-OF-DEL FLAG        09660000
APPN6F1  MVI   IOBAPP,X'15'             SET APPENDAGE CODE TO 21        09680000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   09700000
         LA    R12,CB34                 START AT CB34                   09720000
         ST    R12,IOBSTART-1                                           09740000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               09760000
         B     APPRVXCP                 EXCP RETURN TO IOS              09780000
APPN6E2  OI    CB37C+4,X'40'            SET ON  CB37C CC FLAG           09800000
         B     APPN6F1                                                  09820000
APPN6B3  LA    R13,CB44+8               DID CHAN PROG STOP AT CB44      09840000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      09860000
         BNE   APPN6B4                  NO - TRY CB43C                  09880000
         TM    IOBCSW+4,X'01'           DID CHAN PROG END WITH EOF      09900000
         BZ    APPN3B3                  NO   N3B3                       09920000
         MVI   IOBAPP,X'09'             SET APPENDAGE CODE TO 9         09940000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   09960000
         LA    R12,CB46                 START AT CB46                   09980000
         ST    R12,IOBSTART-1                                           10000000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CB46         10020000
         ST    R12,CB46                                                 10040000
         MVI   CB46,X'31'                                               10060000
         MVC   CB49+1(3),DECBKEY+1      MOVE KEY  ADDRESS TO CB49       10080000
         L     R12,DECBAREA                                             10100000
         LA    R12,16(R0,R12)                                           10120000
         ST    R12,CB50                 MOVE DATA ADDRESS TO CB50       10140000
         MVC   CB51(4),IOBDADAD+3                                       10160000
         IC    R9,IOBDADAD+7                                            10180000
         LA    R12,1(R0,R9)                                             10200000
         STC   R12,CB51+4               MOVE IOB CCHHR (PLUS 1) TO CB51 10220000
         MVC   CB50A+1(3),CB46+1        PUT IOB ADDRESS IN CB50A        10240000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               10260000
         B     APPRVXCP                 EXCP RETURN TO IOS              10280000
APPN6B4  LA    R13,CB43C+8              DID CHAN PROG STOP AT CB43C     10300000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      10320000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      10340000
         L     R12,DCBWKPT2             GET WKAREA BASE          A34922 10342020
         CLC   DCWHIRPS(1),IOBDADAD+7   END OF TRACK STOP        A34922 10344020
         BE    APPN6B5                  YES, BRANCH              A34922 10346020
         OI    CB43C+4,CC               PUT CP BACK TOGETHER     A34922 10348020
         LA    R13,CB43A                START LAST HALF OF CHAN  A34922 10350020
         ST    R13,IOBSTART-1           PROGRAM TO READ NEXT REC A34922 10352020
         B     APPRVXCP                 RESTART CHANNEL PROG     A34922 10354020
APPN6B5  EQU   *                        PROCESS END OF TRACK     A34922 10356020
         TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         10360000
         BZ    APPN6E4                  NO   E4                         10380000
         L     R12,DECBAREA             IS RECORD MARKED FOR DELETION   10400000
         LA    R12,16(R0,R12)                                           10420000
         CLI   0(R12),X'FF'                                             10440000
         BNE   APPN6E4                  NO   E4                         10460000
         BAL   R13,COMPLDT              SEE IF MUST BUMP RECORD  A31323 10480020
         B     APPN6E4                  YES, RETURN HERE         A31323 10500020
*                                       NO, DON'T BUMP                  10520020
         MVC   IOBDADAD+5(3),CB23       MOVE CB23 CCHHR TO IOB          10560000
         MVI   IOBAPP,X'11'             SET APPENDAGE CODE TO 17        10580000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   10600000
         LA    R12,CK1                  START AT CK1                    10620000
         ST    R12,IOBSTART-1                                           10640000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  10660000
         ST    R12,CK1                                                  10680000
         MVI   CK1,X'31'                                                10700000
         ST    R12,CK4                                                  10720000
         MVI   CK4,X'31'                                                10740000
         L     R12,CB42                                                 10760000
         LA    R12,0(R0,R12)                                            10780000
         ST    R12,CK6                  MOVE KEY ADDRESS TO CK6         10800000
         MVI   CK6,X'0D'                                                10820000
         MVC   CK7A+1(3),CK1+1          PUT IOB ADDRESS IN CK7A         10840000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               10860000
         B     APPRVXCP                 EXCP RETURN TO IOS              10880000
APPN6E4  NI    IOBINDCT,X'DF'           INDICATE OFLO RECORD IN AREA    10900000
         MVI   IOBASYN,X'09'            SET ASYNCHRONOUS CODE TO 9      10920000
         L     R12,CB42                 MOVE KEY ADDRESS TO CH7         10940000
         LA    R12,0(R0,R12)                                            10960000
         ST    R12,CH7                                                  10980000
         MVI   CH7,X'0D'                                                11000000
         B     APPN3B5                  SCHEDULE ASYNCHRONOUS ROUTINE   11020000
         EJECT                                                          11040000
*              ABNORMAL END CP9CW,  APPENDAGE CODE 22,         CHART J2 11060000
APPJ2B2  EQU   *                                                        11070013
         TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     11080013
         BC    PERRNO,APPJ2B3           NO, SEE WHERE STOPPED    A34922 11090020
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     11100013
         BZ    APPN3B3                  NO- RECORD UNREACHABLE          11110013
APPJ2E3  OI    DECBEXC1,X'08'           UNCORRECTABLE I/O ERROR         11680000
         B     APPN3B4                                                  11700000
APPJ2B3  LA    R13,CB44+8               POINT TO NEXT READ       A34922 11702020
         CLR   R12,R13                  DID CP GET THIS FAR      A34922 11704020
         BL    APPJ2B4                  NO, RETRY CHAN PGM       A34922 11706020
         LA    R13,CB43A                OTHERWISE, START AT      A34922 11708020
         ST    R13,IOBSTART-1           LAST HALF OF CHAN PGM    A34922 11710020
         B     APPRVNOR                 RETRY CHANNEL PROGRAM    A34922 11712020
APPJ2B4  EQU   *                                                 A44495 11712821
         TM    IOBSENSE,TCC             TRK COND CHK             A44495 11713621
         BO    APPRVNOR                 LET CP9CW COMPLETE       A44495 11714421
         NI    CB43C+4,X'FF'-CC         OFF WITH CC              A44495 11715221
         B     APPRVNOR                 RETRY CHANNEL PROGRAM    A34922 11716020
         EJECT                                                          11720000
*              CHANNEL  END CP15,   APPENDAGE CODE 14,         CHART M1 11740000
APPM1B2  LA    R13,CI4+8                DID CHAN PROG STOP AT CI4       11760000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      11780000
         BNE   APPM1B3                  NO - RECORD IS UNREACHABLE      11800000
         L     R12,DCBWKPT2                                             11820000
         USING IHADCW,R12                                        S20201 11830020
         OI    DCWWKNI,X'10'            SET ADD-TO-END INDICATOR ON     11840000
         CLI   DCBFIRSH+TWO,ONE         TEST FOR SHARED TRACK    A46955 11846021
         BNH   APPM1B20                 NO                       A46955 11852021
         CLC   DCBFIRSH(2),DCBLPDA+5    END OF SHARED TRACK        7851 11860000
         BE    APPM1B2A                                            7851 11880000
APPM1B20 EQU   *                        *                        A46955 11890021
         MVC   DCWHIRPS(1),DCBHIRPD                                7851 11900000
         B     APPM1B2B                                            7851 11920000
APPM1B2A MVC   DCWHIRPS(1),DCBHIRSH                                7851 11940000
APPM1B2B EQU   *                                                   7851 11960000
         TM    DCBST,X'01'              IS LAST TRACK FULL              11980000
         BO    APPM1C2                  BO IF YES, TO SET UP CP16       12000000
         MVI   IOBAPP,X'17'             SET APPENDAGE CODE TO 23        12020000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   12040000
         LA    R12,CB46                 START AT CB46                   12060000
         ST    R12,IOBSTART-1                                           12080000
         MVC   IOBDADAD,DCBLPDA         PUT DCBLPDA MBBCCHHR IN IOB     12100000
         MVC   CB49+1(3),DECBKEY+1      MOVE KEY  ADDRESS TO CB49       12120000
         L     R12,DECBAREA             MOVE DATA ADDRESS TO CB50       12140000
         LA    R12,16(R0,R12)                                           12160000
         ST    R12,CB50                                                 12180000
         IC    R9,DCBLPDA+7             MOVE DCBLPDA CCHHR TO CB51      12200000
         LA    R12,1(R0,R9)              THEN INCREASE CB51 R BY 1      12220000
         STC   R12,CB51+4                                               12240000
         MVC   CB51(4),DCBLPDA+3                                        12260000
         LA    R12,IOBDADAD+3                                           12280000
         STH   R12,CB46+2                                               12300000
         SRL   R12,16                                                   12320000
         STC   R12,CB46+1               MOVE IOB ADDRESS TO CB46        12340000
         MVC   CB50A+1(3),CB46+1        MOVE IOB ADDRESS TO CB50A       12360000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               12380000
         B     APPRVXCP                 EXCP RETURN TO IOS              12400000
APPM1C2  EQU   *                                                        12420000
         TM    CB26,X'08'               WAS ENTRY READ IN CB25 OFLO END 12440000
         BZ    APPM1D3                  YES  M1D3                       12460000
         MVC   IOBDADAD,CB25            MOVE CB25 MBBCCHHR TO IOB       12480000
         MVI   IOBAPP,X'0F'             SET APPENDAGE CODE TO 15        12500000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          12520000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            12540000
         LA    R12,CJ1                  START AT CJ1                    12560000
         ST    R12,IOBSTART-1                                           12580000
         LA    R12,IOBDADAD+3           MOVE IOB ADDRESS TO CJ1 AND CJ5 12600000
         ST    R12,CJ1                                                  12620000
         MVI   CJ1,SIDEQ                RESTORE COMMAND CODE     S20201 12626020
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 12632020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE   MOVE IN ADDR OF KEY  S20201 12641020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE                        S20201 12650020
         LA    R12,0(R0,R0)             CMP TRK INDEX AND OFLO RCD MODL 12780000
         IC    R12,CB25                  ARE THEY THE SAME              12800000
         SLL   R12,4(R0)                                                12820000
         L     R12,32(R3,R12)                                           12840000
         LA    R12,0(R0,R12)                                            12860000
         CLR   R12,R7                                                   12880000
         BE    APPRVXCP                 YES - EXCP RETURN TO IOS        12900000
         MVI   IOBASYN,X'01'                                            12920000
         B     APPM1D4                  EXCP IN ASYNCHRONOUS ROUTINE    12940000
APPM1D3  MVI   IOBASYN,X'0A'            SET ASYNCHRONOUS CODE TO 10     12960000
APPM1D4  NI    IOBINDCT,X'DF'           INDICATE OFLO RECORD IN AREA    12980000
         B     APPM1B5                  SCHEDULE ASYNCHRONOUS ROUTINE   13000000
APPM1B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           13020000
APPM1B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  13040000
APPM1B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 13060002
         EJECT                                                          13140000
*              ABNORMAL END CP15,   APPENDAGE CODE 14,         CHART M1 13160000
APPM1J2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     13180000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       13200000
         B     APPM1B3                  YES  M1B3                       13220000
APPN3B21 LA    R13,APPN3B2                                              13240000
         BC    15,APPN3B22                                              13260000
APPM1B21 LA    R13,APPM1B2                                              13280000
APPN3B22 BR    R13                      NULL ROUTINE             Y02072 13300002
APPRVXCP EQU   *                                                        13440000
         SR    R12,R12                                                  13460000
         IC    R12,IOBDADAD             CURRENT EXTENT                  13480000
         SLL   R12,4                    LENGTH OF 1 EXTENT=16           13500000
         LA    R12,32(R12,R3)           ADDRESS OF CORRECT EXTENT       13520000
         MVC   IOBDADAD+1(2),4(R12)     MOVE BB TO IOB                  13540000
         LA    R14,EXCP(R14)            SETUP EXCP RETURN TO IOS  15924 13545016
         XC    IOBFLAG2(3),IOBFLAG2     CLEAR FLAG2,SENSE BYTES   15924 13550016
         XC    IOBCSW(9),IOBCSW         CLEAR FLAG3,CSW,AND SIOCC 15924 13555016
         XC    IOBERRCT(2),IOBERRCT     CLEAR ERROR COUNT         15924 13560016
         NI    IOBFLAG1,X'C2'           RESET FLAG1               15924 13565016
APPRVNOR BR    R14                      RETURN TO IOS             15924 13570016
*                                                                       13572002
MODID    DC    C'IGG019G1'              MODULE NAME            @ZA26522 13572537
DATE     DC    CL8'&SYSDATE'            FIX DATE               @ZA26522 13573037
FIX      DC    C' OZ26522'              LATEST FIX             @ZA26522 13573537
PATCH    DC    XL((*-IGG019G1)/20)'00'  ZEROED PATCH AREA        Y02072 13574002
*                                                                       13576002
         EJECT                                                          13580000
*                        ADDRESS OF COMMUNICATION VECTOR TABLE          13600000
CVTPTR   EQU   16                                                       13620000
LASTIND  EQU   X'02'       LAST BLK READ TO CHK FOR DELETES      A31323 13630020
*                             RETURN TO IOS VECTOR TABLE                13640000
CVT      DSECT                                                          13760000
         DS    F         COMMUNICATION VECTOR TABLE EXIT EFFECTOR       13780000
CVTEXEF  DS    A                        *                        Y02072 13790002
IHAPART2 DS    0D                       PART 2 VECTOR TABLE             13820000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              13840000
APPM67CE DS    CL6            7         CP1 OR CP2, WRITE KN            13860000
APPN7B2  DS    CL6            9,23      CP10AW                          13880000
APPN8A2  DS    CL6            10,11     CP10BW                          13900000
APPM4A2  DS    CL6            12        CP14W - SETUPS 1, 2, OR 5       13920000
APPM5A2  DS    CL6            13        CP14W - SET UPS 3, 4, OR 6      13940000
APPM2B2  DS    CL6            15        CP16 - SITUATION 2              13960000
APPM3B2  DS    CL6            16        CP16 - SITUATION 3              13980000
APPN9A2  DS    CL6            17,18,19  CP17W                           14000000
         DS    CL6                                                17332 14010018
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              14020000
APPM67AE DS    CL6            7         CP1 OR CP2, WRITE KN            14040000
APPJ3B2  DS    CL6            9,23      CP10AW                          14060000
APPJ4B2  DS    CL6            10,11     CP10BW                          14080000
APPJ5B2  DS    CL6            12        CP14W -SETUPS 1, 2, OR 5        14100000
APPJ6B2  DS    CL6            13        CP14W -SETUPS 3, 4, OR 6        14120000
APPM2H2  DS    CL6            15,16     CP16                            14140000
APPJ7B2  DS    CL6            17,18,19  CP17W                           14160000
         DS    CL6                                                17332 14170018
APPN7A3  DS    CL4            CONTINUATION OF ROUTINES BEGUN IN         14180000
APPN7B4  DS    CL4                 PART 1                               14200000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              14220000
APPABA2  DS    CL6            0,1       CP4/CP5                         14240000
APPADB2  DS    CL6            2         CP7W                            14260000
APPAAB2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     14280000
APPACA2  DS    CL6            5         CP6W                            14300000
APPAHB2  DS    CL6            6         CP4/CP5W, WRITE CHECK           14320000
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              14340000
APPABD2  DS    CL6            0,1       CP4/CP5W                        14360000
APPAIB2  DS    CL6            2         CP7W                            14380000
APPAAA2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     14400000
APPACE2  DS    CL6            5         CP6W                            14420000
APPAHD2  DS    CL6            6         CP4/CP5W, WRITE CHECK           14440000
         EJECT                                                          14450002
RQE      IECDRQE ,                      RQE                      Y02072 14452002
         EJECT                                                          14460000
*        WRITE KEY NEW CHANNEL PROGRAM REFERENCES (WRITE CHECK)         14660020
IHAWKNCP IGGWKNCP  OPTCD=W                                       S20201 15060020
         IGGCP9A                                                        15460020
         IGGCP9B   OPTCD=W                                       S20201 15960020
         IGGCP9C   OPTCD=W                                       S20201 16460020
         EJECT                                                          17820000
*              DATA EVENT CONTROL BLOCK                                 17840000
IHADECB  DSECT                                                          17860000
         DS    0F                                                       17880000
DECBECB  DS    CL4                      EVENT CONTROL BLOCK (ECB)       17900000
DECBTYP1 DS    BL1                      TYPE B6 - 1 IF LENGTH IS S      17920000
*                                            B7 - 1 IF AREA IS S        17940000
DECBTYP2 DS    BL1                           B0 - 1 IF READ K           17960000
*                                            B1 - 1 IF READ KX          17980000
*                                            B2 - 1 IF READ KU          18000000
*                                            B4 - 1 IF WRITE K          18020000
*                                            B5 - 1 IF WRITE KN         18040000
DECBLGTH DS    CL2                      LENGTH OF BLOCK                 18060000
DECBDCBA DS    A                        POINTER TO DCB                  18080000
DECBAREA DS    A                        ADDRESS OF AREA                 18100000
DECBLOGR DS    A                        POINTER TO LOGICAL RECORD       18120000
DECBKEY  DS    A                        POINTER TO KEY                  18140000
DECBEXC1 DS    BL1                      EXCPTN CD B0-RECORD NOT FOUND   18160000
*                                                 B1-RECORD LGTH CHK    18180000
*                                                 B2-NO SPACE           18200000
*                                                 B3-INVALID REQUEST    18220000
*                                                 B4-UNCORRECTABLE IO   18240000
*                                                 B5-UNREACHABLE BLOCK  18260000
*                                                 B6-OVERFLOW RECORD    18280000
*                                                 B7-DUPLICATE          18300000
DECBEXC2 DS    BL1                                B7-READ KU            18320000
         EJECT                                                          18340000
         DCBD  DSORG=(IS)                                               18360000
         EJECT                                                          18380000
IHAIOB   IGGIOBD                                                        18390020
IHADCW   IGGBISAM                                                       18400020
IHADEB   IGGDEBD                                                        18410020
         END                                                            18519900
