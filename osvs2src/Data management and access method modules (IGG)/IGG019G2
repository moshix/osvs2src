         TITLE 'IGG019G2 - APPENDAGES-PART 1,UNBL,USR WA,NO WRT CHK'    00020000
IGG019G2 CSECT                                                          00040000
*          RELEASE OS/VS2-02 DELETIONS                                * 00052002
*          RELEASE 19 DELETIONS                                       * 00052402
*2682072526-072574                                               A27357 00053019
*          RELEASE 20 DELETIONS                                       * 00054000
*3377018450,018500,018550,018600,036800,039200-039800,040000-    S20201 00054220
*3377040400,043000,043400,043600,043800,044200,044400,044800,    S20201 00054420
*3377045000,051600,051800-052800,054600,055600,055800-056200,    S20201 00054620
*3377057400,058800,064200,070200,070620,080400,099600,118200,    S20201 00054820
*3377118400-119400,120200,125200,125400,125600,126000,127000,    S20201 00055020
*3377136000,136200-152000,152200-155000,155200-158100,158150-    S20201 00055220
*3377161400,167400,167600,167800-186400,186600-193800            S20201 00055420
*3377080200,099400                                               M4966  00055720
*          RELEASE 21 DELETIONS                                       * 00056000
*1201021800,022800,084400                                        S21045 00056521
*1201                                                            A33533 00057021
*1201                                                            A46955 00057521
*XXXX                                                            A49403 00057921
*1201021600                                                      A50670 00064600
*          CHANGES SINCE VS2-3.7                                      * 00066637
*A023660-023720,A127520-127522                                 @ZA26522 00068637
*                                                                     * 00071302
*STATUS CHANGE LEVEL 009                                                00078002
*                                                                       00100000
* FUNCTION/OPERATION- APPENDAGE ROUTINES FOR BISAM                      00120000
*        WHEN WRITE KN IS USED WITH OR WITHOUT READ AND UPDATE          00140000
*        WHEN THE USER HAS     SUPPLIED A READ-IN AREA,                 00160000
*        WHEN WRITE VALIDITY CHECKING IS NOT REQUESTED,                 00180000
*        AND RECORD FORMAT IS UNBLOCKED.                                00200000
*        (PART 1)                                                       00220000
*                                                                       00240000
*                                                                       00260000
*        CEND  - IF CHANNEL PROGRAM ENDS                                00280000
*                **WITHOUT ERROR, EITHER                                00300000
*                    PROCESSING COMPLETION WILL BE SCHEDULED,           00320000
*                    PROCESSING CONTINUATION WILL BE SCHEDULED,         00340000
*                    OR PROCESSING WILL CONTINUE.                       00360000
*                **WITH A LENGTH CHECK, TESTS DETERMINE WHETHER         00380000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00400000
*                    ERROR.                                             00420000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00440000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00460000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00480000
*                                                                       00500000
*        ABEND - IF CHANNEL PROGRAM ENDS ABNORMALLY BECAUSE OF          00520000
*                **PERMANENT ERROR, 'UNCORRECTABLE I/O ERROR'           00540000
*                    IS INDICATED IN THE DECB, AND PROCESSING           00560000
*                    COMPLETION WILL BE SCHEDULED.                      00580000
*                **NON-PERMANENT ERROR, ONE RE-TRY IS MADE              00600000
*                    BEFORE INDICATING A PERMANENT ERROR.               00620000
*                **FILE PROTECTION, TESTS DETERMINE WHETHER             00640000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00660000
*                    ERROR.                                             00680000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00700000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00720000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00740000
* ENTRY POINTS-                                                         00760000
*        ENTRY POINT               FUNCTION                             00780000
*        -----------               --------                             00800000
*        APPCEND                   CEND                                 00820000
*        APPABEND                  ABEND                                00840000
*                                                                       00860000
* INPUT - N/A                                                           00880000
* OUTPUT - N/A                                                          00900000
* EXTERNAL ROUTINES - N/A                                               00920000
* EXITS- 1. RETURN TO IOS VIA THE APPENDAGE RETURN VECTOR TABLE POINTED 00940000
*            TO BY REGISTER 14.  SEE THE DSECT LABELED    APPRV FOR THE 00960000
*            FORMAT OF THIS TABLE AND THE USE OF EACH EXIT.             00980000
*           USED TO CONTINUE PROCESSING.                                01000000
*        2. SCHEDULE AN ASYNCHRONOUS ROUTINE - BRANCH VIA THE EXIT      01020000
*            EFFECTOR ADDRESS IN THE COMMUNICATION VECTOR TABLE.        01040000
*           USED TO SCHEDULE PROCESSING COMPLETION OR CONTINUATION.     01060000
*        3. IF THE DESIRED APPENDAGE ROUTINE IS IN PART 2, BRANCH TO    01080000
*            THAT ROUTINE VIA THE PART 2 VECTOR TABLE.  THE POINTER TO  01100000
*            THE MODULE IS IN DCBWKPT5.  SEE THE DSECT LABELED          01120000
*            IHAPART2 FOR RELATIVE ADDRESSES AND USES OF THE ROUTINES.  01140000
*                                                                       01160000
* TABLES/WORK AREAS - DECB, DCB, IOB AND EXTENTION, DCB WA (DCW), DEB,  01180000
*        CVT, PART 2 VECTOR TABLE.                                      01200000
*        SEE DSECTS AT END OF MODULE FOR FORMAT AND DESCRIPTIONS.       01220000
*                                                                       01240000
* ATTRIBUTES- REENTRANT. DISABLED.                                      01260000
* NOTES - NONE                                                          01280000
         EJECT                                                          01300000
* GENERAL REGISTERS ARE USED AS FOLLOWS                                 01320000
*                                                                       01340000
R0       EQU   0                   *    -----                           01360000
R1       EQU   1                   *    12* ADDRESS                     01380000
R2       EQU   2                   *    IOB                             01400000
R3       EQU   3                   *    DEB                             01420000
R4       EQU   4                   *    DCB                             01440000
BASEXXXX EQU   5                        BASE REG FOR CLEANUP     Y02072 01452002
R6       EQU   6                   *    -----                           01480000
R7       EQU   7                   *    UCB                             01500000
SAVEXXXX EQU   8                        SAVE AREA FOR CLEANUP    Y02072 01510002
R9       EQU   9                   #    WORK REGISTER                   01540000
R10      EQU   10                       CHANNEL PROGRAM POINTER         01560000
R11      EQU   11                       DECB                            01580000
R12      EQU   12                       WORK REGISTER                   01600000
R13      EQU   13                       WORK REGISTER                   01620000
R14      EQU   14                       IOS RETURN VECTOR TABLE         01640000
R15      EQU   15                       BASE REGISTER                   01660000
*                                                                       01680000
*        * MEANS THIS REGISTER IS SET UP UPON ENTRY FROM IOS,           01700000
*          AND ITS CONTENTS MUST BE RESTORED UPON RETURN TO IOS         01720000
*        # MEANS THIS REGISTER MAY BE CHANGED, BUT UPON RETURN TO IOS   01740000
*          MUST CONTAIN ZEROES IN THE THREE HIGH ORDER BYTES            01760000
*                                                                       01780000
PERRMASK EQU   X'20'          TO TEST FOR PERMANENT ERROR, TEST         01800000
PERRYES  EQU   8               IOBECBAD, B2. IF OFF (CONDITION CODE 8)  01820000
PERRNO   EQU   7               THERE IS A PERM ERR. ELSE B2 ON ( CD 7)  01840000
ONE      EQU   1                        MISC OFFSETS             S20201 01840820
TWO      EQU   2                        *                        S20201 01841620
THREE    EQU   3                        *                        S20201 01842420
FOUR     EQU   4                        *                        S20201 01843220
FIVE     EQU   5                        *                        S20201 01844020
SIX      EQU   6                        *                        S20201 01847020
SEVEN    EQU   7                        *                        S20201 01848020
EIGHT    EQU   8                        *                        S20201 01849020
SIXTEEN  EQU   16                       *                        S20201 01850020
OFLOW    EQU   X'10'                    OVERFLOW BIT OF F BYTE   S20201 01852020
DUMMY    EQU   X'20'                    DUMMY BIT OF F BYTE      S20201 01853020
CCOFF    EQU   X'BF'                    MASK FOR CC OFF                 01855001
BYP      EQU   12                       RETURN TO IOS/BYPASS     S20201 01856020
EXCP     EQU   8                        RETURN TO IOS/EXCP       S20201 01862020
NORMAL   EQU   0                        RETURN TO IOS/NORMAL     S20201 01868020
ABENTRY  EQU   X'01'                    ABEND ENTRY INDICATOR    A50670 01870000
DATACHK  EQU   X'08'                    DATA CHECK IOB SENSE     A50670 01872000
REEXCP   EQU   8                        REEXCP RETURN TO IOS     Y02072 01872402
SKIPX    EQU   4                        SKIP RETURN TO IOS       Y02072 01872802
BYPASS   EQU   12                       BYPASS RETURN TO IOS     Y02072 01873202
FMVIOL   EQU   X'04'                    FILE MASK VIOLATION      Y02072 01873302
NOTSEEK  EQU   8                        CC - SEEK TEST SENSE B0  Y02072 01873602
SEEKCHK  EQU   X'01'                    SEEK CHECK INDICATOR     Y02072 01873702
*                                                                       01873802
         USING RQE,R1                   RQE ADDRESSABILITY       Y02072 01873902
         USING IHAIOB,R2                IOB POINTER              S20201 01874020
         USING IHADEB,R3                DEB POINTER                     01880000
         USING IHADCB,R4                DCB POINTER                     01900000
         USING IHAWKNCP,R10             CHANNEL PROGRAM POINTER         01920000
         USING IHADECB,R11              DECB POINTER                    01940000
         USING IHADCW,R12               DCB WA POINTER ONLY AS WORK REG 01960000
         EJECT                                                          02000000
*                             APPENDAGE VECTOR TABLE                    02020000
APP      DC    A(APPCEND-APP)           CHANNEL END        USED BY WKN  02040000
         DC    A(APPABEND-APP)          ABNORMAL END  -     USED BY WKN 02060000
APPNO    EQU   *                                                        02080000
         USING APPCEND,R15                                              02100000
APPCEND  NI    IOBINDCT,X'FE'          INDICATE CEND ENTRY              02120000
         B     SETUPREG                 BRANCH TO SET UP REGISTERS      02140000
APPABEND EQU   *                                                 A50670 02150000
         USING APPABEND,R15                                             02152000
*                                                                A50670 02160000
*        IF THIS IS A CORRECTABLE DATA CHECK FROM AN RPS         A50670 02170000
*        DEVICE THEN RETURN TO IOS FOR ERP HANDLING              A50670 02180000
*                                                                A50670 02182000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR          A50670 02182400
         BZ    NOCDACK                  YES CONTINUE AS USUAL    A50670 02182800
         TM    IOBSENS1,FMVIOL          WAS IT A SEEK CHECK      Y02072 02184802
         BCR   NOTSEEK,R14              NO - RETURN TO ERPS      Y02072 02186802
         SPACE 3                                                        02188802
NOCDACK  EQU   *                                                 A50670 02190100
         OI    IOBINDCT,ABENTRY         INDICATE ABEND ENTRY     A50670 02190200
SETUPREG L     R15,DEBEXPTR              GET ADDR OF DEB         S21045 02190400
*                                       EXTENSION PTR            S21045 02192000
         USING DEBEXT,R15                                        S21045 02197800
         L     R15,DEBWKPT4              R15  BASE               S21045 02205200
         DROP  R15                                                      02212600
         USING APP,R15                                                  02220000
*                                                                       02222002
*   SAVE IOS REGISTERS AND SET UP ADDRESSABILITY TO RETURN TO SPECIAL   02230002
*   CLEANUP ROUTINE.                                                    02232002
*                                                                       02232402
         STM   R14,R12,0(R13)           SAVE REGISTERS           Y02072 02234002
         LR    SAVEXXXX,R13             SAVE SAVE AREA PTR       Y02072 02236002
         LA    R14,IOSRETS              RETURN TO RETURN TO IOS  Y02072 02238002
         LR    BASEXXXX,R14             BASE REG FOR RETURN      Y02072 02238402
         SPACE 2                                                        02238502
         MODESET KEYADDR=RQEPRT,WORKREG=13 ACQUIRE USER KEY      Y02072 02238802
         SPACE 3                                                        02239202
         L     R10,IOBCCWAD             R10  CP                         02240000
         LA    R10,0(R10)               CLEAR HIGH ORDER BYTE    A49403 02242021
         MVC   IOBECBAD+1(3),IOBBCHAD+1 RESTORE ECB              A33533 02250021
         L     R11,IOBECBAD             R11  DECB                       02260000
         L     R13,DEBEXPTR              GET ADDR OF DEB         S21045 02266021
*                                       EXTENSION PTR            S21045 02272021
         USING DEBEXT,R13                                        S21045 02278021
         L     R13,DEBWKPT5              R13  BASE, PART 2       S21045 02284021
         DROP  R13                                               S21045 02290021
         L     R12,IOBCSW               CSW = STOP ADDRESS PLUS 8       02300000
         LA    R12,0(R12)               CLEAR HIGH ORDER ZERO           02320000
         USING IHAPART2,R13                                             02340000
         IC    R9,IOBAPP                R9   RELATIVE ADDRESS IN        02360000
         CH    R9,TWOFOUR               IS APPCD GT 24?        @ZA26522 02366037
         BH    INVAPPCD                 IF YES-GO PROG CHK     @ZA26522 02372037
         SLL   R9,2                            APPENDAGE TABLE          02380000
         TM    IOBINDCT,X'01'                                           02400000
         BO    APPABENT(R9)            IF ABEND, BRANCH VIA ABEND TABLE 02420000
         B     APPCENDT(R9)            IF CEND, BRANCH VIA THAT TABLE   02440000
         EJECT                                                          02460000
*********************************************************************** 02480000
*****              CHANNEL END APPENDAGE VECTOR TABLE             ***** 02500000
*********************************************************************** 02520000
APPCENDT EQU   *              CODE      FOR COMPLETION OF               02540000
         B     APPABA2   0             CP4/CP5, READ                    02560000
         B     APPABA2   1             CP4/CP5, WRITE                   02580000
         B     APPADB2   2             CP7                              02600000
         B     APPAAB2   3             CP1 OR CP2, READ AND UPDATE      02620000
         B     APPAFB                   CP14-PART2                17332 02640018
         B     APPACA2   5             CP6                              02660000
         B     APPRVNOR  6             NOT USED                         02680000
         B     APPM67CE  7             CP1 OR CP2, WRITE KN             02700000
         B     APPN3B21                                                 02720000
         B     APPN7B2   9             CP10A  - TRUE INSERT             02740000
         B     APPN8A2   10            CP10B  - TRUE INSERT             02760000
         B     APPN8A2   11            CP10B  - ADD TO END              02780000
         B     APPM4A2   12            CP14  - SETUPS 1, 2, OR 5        02800000
         B     APPM5A2   13            CP14  - SETUPS 3, 4, OR 6        02820000
         B     APPM1B21                                                 02840000
         B     APPM2B2   15            CP16 - SITUATION 2               02860000
         B     APPM3B2   16            CP16 - SITUATION 3               02880000
         B     APPN9A2   17            CP17  - TRACK INDEX ONLY         02900000
         B     APPN9A2   18            CP17  - TRACK AND HIGHER LEVELS  02920000
         B     APPN9A2   19            CP17  - HIGHER LEVELS ONLY       02940000
         B     APPT1B2   20            CP12A                            02960000
         B     APPT2B2   21            CP12B                            02980000
         B     APPRVNOR  22            NOT USED                         03000000
         B     APPN7B2   23             CP10A  - ADD TO END             03020000
         B     APPT3B2   24             XP12C                           03040000
         EJECT                                                          03060000
*********************************************************************** 03080000
*****             ABNORMAL END APPENDAGE VECTOR TABLE             ***** 03100000
*********************************************************************** 03120000
APPABENT EQU   *              CODE      FOR COMPLETION OF               03140000
         B     APPABD2   0             CP4/CP5, READ                    03160000
         B     APPABD2   1             CP4/CP5, WRITE                   03180000
         B     APPADE2   2             CP7                              03200000
         B     APPAAA2   3             CP1 OR CP2, READ AND UPDATE      03220000
         B     APPAEB                   CP14 PART 2               17332 03240018
         B     APPACE2   5             CP6                              03260000
         B     APPRVNOR  6             NOT USED                         03280000
         B     APPM67AE  7             CP1 OR CP2, WRITE KN             03300000
         B     APPN3E2   8             CP8                              03320000
         B     APPN7J2   9             CP10A  - TRUE INSERT             03340000
         B     APPN8G2   10            CP10B  - TRUE INSERT             03360000
         B     APPN8G2   11            CP10B  - ADD TO END              03380000
         B     APPM4E2   12            CP14  - SETUPS 1, 2, OR 5        03400000
         B     APPM5E2   13            CP14  - SETUPS 3, 4, OR 6        03420000
         B     APPM1J2   14            CP15                             03440000
         B     APPM2H2   15            CP16 - SITUATION 2               03460000
         B     APPM2H2   16            CP16 - SITUATION 3               03480000
         B     APPN9G4   17            CP17  - TRACK INDEX ONLY         03500000
         B     APPN9G4   18            CP17  - TRACK AND HIGHER LEVELS  03520000
         B     APPN9G4   19            CP17  - HIGHER LEVELS ONLY       03540000
         B     APPT1A3   20            CP12A                            03560000
         B     APPT2A3   21            CP12B                            03580000
         B     APPRVNOR  22            NOT USED                         03600000
         B     APPN7J2   23             CP10A  - ADD TO END             03620000
         B     APPT3A4   24             CP12C                           03640000
         DROP  R13                                                      03660000
         EJECT                                                          03700000
*   SPECIAL IOS RETURN CLEANUP ROUTINE INTERCEPTS ALL RETURNS TO        03710002
*   IOS AND RESTORES REGISTERS AND SETS PROTECTION KEY TO 0.            03712002
         SPACE 2                                                 Y02072 03714002
IOSRETS  EQU   *                        RETURN POINT             Y02072 03718002
         USING *,BASEXXXX               ADDRESSABILITY           Y02072 03718402
         B     NORMRET                  NORMAL RETURN            Y02072 03718802
         B     SKIPRET                  SKIP POST RETURN         Y02072 03719202
         B     REEXCPRT                 REEXCP RETURN            Y02072 03719602
         SPACE 2                                                        03719702
BYPASRET EQU   *                        BYPASS POST RETURN       Y02072 03719802
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03719902
         LA    R14,BYP(R14)             SCHEDULE ASYNCH ROUTINE  Y02072 03726602
         L     R13,CVTPTR               CVT ADDRESSABILITY       Y02072 03728602
         USING CVT,R13                  *                        Y02072 03729002
         L     R13,CVTEXEF              ASYNCH SCHED ROUTINE     Y02072 03730602
         DROP  R13                      *                        Y02072 03731002
         BR    R13                      GO TO ROUTINE            Y02072 03732602
         SPACE 2                                                        03733002
REEXCPRT EQU   *                        REEXCP RETURN            Y02072 03733102
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03733202
         B     REEXCP(R14)              RETURN - REEXCP          Y02072 03737402
         SPACE 2                                                        03739402
SKIPRET  EQU   *                        RETURN - SKIP            Y02072 03741402
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03741502
         B     SKIPX(R14)               RETURN - SKIP            Y02072 03744002
         SPACE 2                                                        03746002
NORMRET  EQU   *                        RETURN - NORMAL          Y02072 03746402
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03746802
         BR    R14                      RETURN                   Y02072 03747202
         SPACE 2                                                        03747302
IOSRETX  EQU   *                        RESTORE REGS AND KEY     Y02072 03747402
         MODESET KEYADDR=KEY0,WORKREG=13   SET KEY = 0           Y02072 03748502
         SPACE 2                                                        03748902
         LM    R14,R11,0(SAVEXXXX)      RESTORE REGISTERS        Y02072 03750502
         BR    R12                      RETURN                   Y02072 03750602
         DROP  BASEXXXX                 RESET ADDRESSABILITY     Y02072 03750702
         SPACE 1                                                 Y02072 03750802
KEY0     DC    H'0'                     KEY 0                    Y02072 03751402
         EJECT                                                   Y02072 03751802
*              CHANNEL  END CP8,    APPENDAGE CODE  8,         CHART N3 03752802
APPN3B2  EQU   *                        *                               03753402
*                                                                       03754002
         LA    R13,CB8A+EIGHT           DID CHANNEL PROGRAM END ON      03755002
         CLR   R12,R13                  CB8A                            03757502
         BNE   APPAOS22                 NO, CONTINUE                    03760002
         TM    CB8A+FIVE,CC             WAS CB8A CHAINED                03762502
         BZ    APPAOS22                 NO, CP UNCHANGED                03765002
         NI    CB8A+FIVE,CCOFF          RESET CHAIN IND.                03767502
         OI    CB8A+FOUR,CC             TURN CC BACK ON                 03770002
         CLI   CB12,SEEKHH              CB12 SET FOR HEAD SEEK          03772502
         BNE   APPN3F3                  NO,  FILE PROTECT               03775002
         LA    R13,CB16                 RESET IOBSTART                  03777502
         ST    R13,IOBSTART-ONE         START CP WITH SETSECT           03780002
         MVC   IOBDADAD,CB10+SEVEN      RESET IOBSEEK                   03782502
         B     APPRVXCP                 SECHDULE EXCP IOS RETURN        03785002
APPAOS22 EQU   *                        *                               03787502
*                                                                       03790002
         LA    R13,CB21+EIGHT           DID CHAN PROG STOP AT CB21      03792502
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      03795002
         BNE   APPN3A3                  NO - CHECK FOR LENGTH ERROR     03797502
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         03800000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   03820000
         BO    APPN3C2A                 BO IF SHARED                    03840000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         03860000
         B     APPN3C2B                                                 03880000
APPN3C2A MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         03900000
APPN3C2B EQU   *                                                 S20201 03950020
APPN3C2D MVC   IOBDADAD+3(5),CB23+3     MOVE CB23 CCHHR TO IOB          04060000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        04080000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          04100000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            04120000
         LA    R13,CD1                  START AT CD1                    04140000
         ST    R13,IOBSTART-1                                           04160000
         L     R12,DCBMSWA              SET UP COUNT FIELD AT W         04180000
         LA    R12,2(R12)                                         17332 04190018
         MVC   0(5,R12),IOBDADAD+3      CCHHR FROM IOB                  04200000
         MVC   5(1,R12),DCBKEYLE        KL    FROM DCBKEYLE             04220000
         MVC   6(2,R12),DCBBLKSI        DL    FROM DCBBLKSI             04240000
         L     R12,CD2+4                POINTER TO CE1                  04260000
         LA    R13,IOBDADAD+3           PUT IOB ADDRESS AT CE1 AND CL1  04280000
         USING CP12B,R12                                         S20201 04290020
         STH   R13,CE1+TWO              STORE ADDRESS            S20201 04300020
         SRL   R13,16                                                   04320000
         STC   R13,CE1+ONE              STORE ADDRESS            S20201 04340020
         MVC   CL1+ONE(THREE),CE1+ONE   MOVE ADDRESS             S20201 04360020
         MVC   CE4+ONE(THREE),DECBKEY+ONE  PUT I ADDR IN CE4     S20201 04380020
         L     R13,DECBAREA                                             04400000
         LA    R13,SIXTEEN(R0,R13)      PUT AREA+16 ADDR AT CE5  S20201 04420020
         STH   R13,CE5+TWO              PUT A(AREA+16) IN CE5    S20201 04440020
         SRL   R13,16                                                   04460000
         STC   R13,CE5+ONE                                       S20201 04480020
         MVC   CL3+ONE(THREE),CE5+ONE   PUT A(AREA+16) IN CL3    S20201 04500020
         SR    R13,R13                  CLEAR REGISTER 13               04520000
         L     R12,DCBWKPT2                                             04540000
         USING IHADCW,R12                                        S20201 04550020
         IC    R13,DCWHIRPS                                             04560000
         IC    R9,IOBDADAD+7                                            04580000
         SR    R13,R9                                                   04600000
         LA    R13,1(R0,R13)            NUMBER OF RECORDS               04620000
         SLL   R13,3                    MULTIPLY BY 8                   04640000
         LA    R12,CD2                                                  04660000
         AR    R13,R12                  'SET OFF' ADDRESS IN REG 13     04680000
         LA    R9,8(R0,R0)              PUT 8 IN REG 9                  04700000
         NI    4(R13),X'BF'             SET OFF CC FLAG                 04720000
APPN3D2  SR    R13,R9                                                   04740000
         CLR   R13,R12                  IS IT LAST TIME THROUGH LOOP    04760000
         BE    APPRVXCP                 YES - EXCP RETURN TO IOS        04780000
         OI    4(R13),X'40'             SET ON CC FLAG                  04800000
         B     APPN3D2                  LOOP                            04820000
APPN3B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           04840000
APPN3B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  04860000
APPN3B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 04880002
         SPACE 2                                                        04900002
APPN3B6  LA    R13,CB8A+EIGHT           DID CP STOP AT CB8A      S20201 04942020
         CLR   R12,R13                  COMPARE REGS             S20201 04944020
         BNE   APPN3B3                  NO, UNREACHABLE BLOCK    S20201 04946020
         TM    CB11+SEVEN,OFLOW+DUMMY   OFLO, INACTIVE, OR DUMMY S20201 04948020
         BNZ   APPN3F3                  YES, GO TO FILE PROTECT  S20201 04950020
         MVC   CB23+THREE(FOUR),CB11+TWO  SET UP CCHH            S20201 04952020
         MVI   CB23+SEVEN,ONE           SET R EQUAL TO 1         S20201 04954020
         B     APPN3C2D                 GO READ RECORD           S20201 04956020
         EJECT                                                          04960000
*              ABNORMAL END CP8,    APPENDAGE CODE  8,         CHART N3 04980000
APPN3E2  EQU   *                                                  19374 05000000
         TM    IOBSENSE+1,X'04'         WAS ABEND DUE TO FILE     15924 05020016
*                                       PROTECT                   15924 05030016
         BO    APPN3F2                  YES--BRANCH               19374 05040000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 05050000
         BC    PERRYES,APPN3B3          YES--BRANCH               19374 05060000
         B     APPRVNOR                 NO--RETRY CHANNEL PGM     19374 05070000
APPN3F2  LA    R13,CB12+8               DID CHAN PROG STOP AT CB12      05100000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      05120000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      05140000
APPN3F3  TM    CB11+SEVEN,OFLOW         WAS OFLO TRK IX ENTRY RD S20201 05150020
         BZ    APPN3G3                  BZ IF NO                 S20201 05160020
         TM    CB11+SEVEN,DUMMY         DUMMY OR INACTIVE READ   S20201 05170020
         BO    APPN3G3                  BO IF NO                        05300000
         MVC   CJ11(7),IOBDADAD         SAVE TRK INDEX MBBCCHH          05320000
         MVI   IOBAPP,X'10'             SET APPENDAGE CODE TO 16        05340000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          05360000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            05380000
         LA    R13,CJ1                  START AT CJ1                    05400000
         ST    R13,IOBSTART-1                                           05420000
         MVC   IOBDADAD,CB10+7          PUT CB10 MBBCCHHR IN IOB        05440000
         LA    R13,IOBDADAD+3           PUT SEEK ADDRESS IN CJ1 AND CJ5 05480000
         IC    R9,CJ1                                                   05500000
         ST    R13,CJ1                                                  05520000
         STC   R9,CJ1                                                   05540000
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 05550020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 05560020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE                        S20201 05570020
         L     R12,DCBWKPT2             SET ON FIRST TIME ONLY SWITCH   05640000
         USING IHADCW,R12                                        S20201 05650020
         OI    DCWWKNI,X'40'                                            05660000
         LA    R12,0(R0,R0)             IS FIRST OFLO ON SAME MODULE    05680000
         IC    R12,CB10+7                      GET M OF OFLO ENTRY      05700000
         SLL   R12,4(R0)                       MULT BY 16               05720000
         L     R12,DEBUCBAD(R12)        GET UCB ADDR FROM DEB    S20201 05740020
         LA    R12,0(R0,R12)                   COMP WITH UCB AD IN 7    05760000
         CR    R12,R7                                                   05780000
         BE    APPRVXCP                 SAME MODULE - EXCP RTRN TO IOS  05800000
         MVI   IOBASYN,X'01'            DIFFERENT MODULE - MUST EXCP    05820000
         B     APPN3B5                   IN ASYNCHRONOUS ROUTINE        05840000
APPN3A3  TM    IOBCSW+5,X'40'           DID CHAN PROG HAVE LENGTH ERROR 05860000
         BZ    APPN3B6                  GO TEST FOR SPECIAL CASE S20201 05880020
         TM    CB11+7,X'30'             WAS ENTRY INACTIVE              05900000
         BO    APPN3B3                  BO IF YES                       05920000
APPN3G3  TM    CB11+7,X'20'             VERIFY ADD-TO-END SITUATION     05940000
         BZ    APPN3B3                  BZ IF DUMMY OR INACTIVE         05960000
         CLI   DCBNLEV,X'00'            ERROR IF 2 OR MORE INDEX LEVELS 05980000
         BNE   APPN3B3                  BNE IF MORE THAN 1 INDEX LEVEL  06000000
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         06020000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   06040000
         USING IHADCW,R12                                        S20201 06050020
         BO    APPN3G33                 BO IF SHARED                    06060000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         06080000
         B     APPN3G5                                                  06100000
APPN3G33 MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         06120000
APPN3G5  MVI   IOBAPP,X'0E'             SET APPENDAGE CODE TO 14        06140000
         MVC   IOBDADAD(3),DCBLPDA      SEEK TO DCBLETI'S CYLINDER      06160000
         MVC   IOBDADAD+3(4),DCBLETI    CCHH                            06180000
         OC    IOBDADAD+6(1),DCBFIRSH+3                                 06200000
         XC    IOBDADAD+6(1),DCBFIRSH+3 REDUCE TO CYL BOUNDRY OR ZERO   06220000
         MVI   IOBDADAD+7,0                                             06240000
         LA    R12,CI1                  START AT CI1                    06260000
         ST    R12,IOBSTART-1                                           06280000
         NI    IOBFLAG1,X'7F'           DON'T USE DATA CHAINING         06300000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            06320000
         LA    R12,IOBDADAD+3           PUT SEEK ADDRESS IN CI1         06340000
         IC    R9,CI1                                                   06360000
         ST    R12,CI1                                                  06380000
         STC   R9,CI1                                                   06400000
         MVC   CI5+TWO(FIVE),DCBLETI    PUT DCBLETI CCHHR IN CI5 S20201 06410020
         MVC   CI5(TWO),DCBLPDA+ONE     MOVE IN BB FOR HEAD SEEK S20201 06420020
         B     APPRVXCP                                                 06440000
         EJECT                                                          06460000
*              CHANNEL  END CP12A,  APPENDAGE CODE 20,         CHART T1 06480000
APPT1B2  LA    R13,CD2+8                                                06500000
         CLR   R12,R13                                                  06520000
         BNH   APPN3B3                  NO - RECORD IS UNREACHABLE      06540000
         L     R12,DECBKEY              KEY IN I                        06560000
         L     R13,DCBMSWA                                              06580000
         LA    R13,2(R13)                                         17332 06590018
         LA    R13,8(R0,R13)            KEY IN W PLUS 8                 06600000
         IC    R9,DCBKEYLE                                              06620000
         BCTR  R9,R0                    COMPARE KEYLE BYTES             06640000
         EX    R9,APPT1D2               ARE KEYS EQUAL                  06660000
         BE    APPT1E2                  YES - RECORD IS DUPLICATE       06680000
         TM    IOBCSW+4,X'01'           DID CHAN PROG END WITH EOF      06700000
         L     R12,DCBWKPT2                                             06720000
         USING IHADCW,R12                                        S20201 06730020
         BZ    APPT1D5                  BZ IF NO                        06740000
         OI    DCWWKNI,X'08'            SET ON 'CP12A ENDED W/EOF' SW   06760000
         L     R13,IOBCSW               POINT TO LAST READ CCW PLUS 8   06780000
         LA    R9,8(R0,R0)              PUT 8 IN REG 9                  06800000
         SR    R13,R9                   POINT TO LAST READ - OF THE EOF 06820000
         L     R13,0(R13)               POINT TO COUNT OF EOF           06840000
         MVC   5(1,R13),DCBKEYLE        NON-EOF KL TO REPLACE EOF'S 0   06860000
         MVC   6(2,R13),DCBLRECL        NON-EOF DL TO REPLACE EOF'S 00  06880000
APPT1E3  L     R12,IOBCSW               SET REG 12 TO STOP ADDR PLUS 8  06900000
         LA    R12,0(R0,R12)                                            06920000
         LA    R13,CD3                                                  06940000
         SR    R12,R13                  SET REG 12 TO TRUE NO. OF RDS,  06960000
         SLL   R12,1                     INCLUDING EOF, TIMES 16        06980000
         L     R13,CD2+4                CE4 POINTER                     07000000
         USING CP12B,R13                                         S20201 07010020
         LA    R13,CE3                  POINT TO CE3             S20201 07020020
         AR    R12,R13                  SET REG 12 TO 'SET OFF CC' ADDR 07040000
         NI    4(R12),X'BF'             SET OFF CC FLAG                 07060000
         L     R11,CD2+4                                          17332 07061018
         DROP  R13                                               S20201 07061520
         USING CP12B,R11                                         S20201 07062020
         LA    R11,CE5                  POINT TO FIRST CE5       S20201 07062520
         CR    R11,R12                                            17332 07063018
         BNE   APPT1B3                                            17332 07064018
         L     R11,IOBECBAD                                       17332 07065018
         USING IHADECB,R11                                       S20201 07065520
         L     R9,DECBKEY                                         17332 07066018
         B     APPT1B4                                            17332 07067018
APPT1B3  EQU   *                                                  17332 07068018
         L     R11,IOBECBAD                                       17332 07069018
         LR    R9,R12                                             17332 07070018
         L     R9,0(R9)                POINT TO KEY OF OVERFLOW   17332 07071018
APPT1B4  EQU   *                                                  17332 07072018
         ST    R9,CH6+4                 RECORD KEY AND DATA       17332 07073018
         LA    R9,16(R0,R0)             PUT 16 IN REG 9                 07080000
APPT1E32 SR    R12,R9                   REDUCE 'SET OFF/ON' ADDR BY 16  07100000
         CLR   R12,R13                  IS IT REDUCED TO CE4 YET        07120000
         BE    APPT1F3                  YES - LOOP COMPLETE             07140000
         OI    4(R12),X'40'             SET ON CC FLAG                  07160000
         B     APPT1E32                 LOOP                            07180000
APPT2B6  L     R12,DCBMSWA         USE 1ST RECORD OF WA          A27357 07181019
         LA    R12,2(R12)          TO TEST FOR DELETED RECORD    A27357 07182019
         B     APPT2B7                                           A27357 07183019
APPT1F3  SR    R9,R9                                              17332 07184018
         L     R12,CH6+4          PTR  TO KEY   OF                M3275 07194018
*                                 RECORD TO BE BUMPED                   07204018
         IC    R9,DCBKEYLE              PUT IL IN REG 9                 07218018
         L     R13,DECBKEY         IS KEY OF NORMAL TRK INDEX    A27357 07219019
         CR    R12,R13             EQU USER KEY                  A27357 07220019
         BE    APPT2B6             IF SO, BRANCH                 A27357 07221019
         LA    R12,0(R9,R12)                                      M3275 07223018
         AH    R12,DCBBLKSI            PT TO OVFL RECORD         A27357 07224019
APPT2B7  EQU   *                                                 A27357 07225019
         LA    R12,8(R9,R12)                                     A27357 07226019
         IC    R9,DCBFIRSH+3            TRACK MASK                      07228018
         SLL   R12,8                                                    07230018
         IC    R12,IOBDADAD+6           TRACK BYTE OF IOB               07232018
         NR    R9,R12                                                   07234018
         SRL   R12,8                                                    07236018
         TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         07238018
         BZ    APPT2H3                  BZ IF NO                        07240018
         CLI   0(R12),X'FF'             WAS RCD MARKED FOR DELETION     07242018
         BNE   APPT2H3                  NO--OVERFLOW IT           12999 07244018
         EX    R9,CLILDT                                                07246018
         BE    APPD2G31                 YES--BRANCH               12999 07248018
         CLC   DCBLPDA(7),IOBDADAD      IS IT LAST RCD OF DATA SET      07250018
         BNE   APPT2K2                                            17332 07252018
APPD2G31 EQU   *                                                  12999 07258018
         TM    CB11+7,X'10'             CURR IX ENTRY OFLOW       12999 07258618
         BZ    APPD2G33                 NO, BRANCH--NEXT INDEX    12999 07259218
*                                       ENTRY MUST BE OVERFLOW    12999 07259818
         TM    CB11+7,X'08'             CHAINING PRESENT          12999 07260418
         BZ    APPT2H3                  NO--BUMP DELETED REC      12999 07261018
         B     APPT2K2                                            17332 07261618
APPD2G33 TM    CB26,X'08'               CHECK FOR CHAINING        17332 07262218
         BO    APPT2K2                                            17332 07262818
APPT2H3  EQU   *                                                  M3216 07263018
         L     R12,DCBWKPT2                                       M3216 07263218
         USING IHADCW,R12                                        S20201 07263320
         TM    DCWWKNI,X'08'      DID CP12A END WITH EOF          M3216 07263418
         BO    APPT2K2            IF YES BRANCH                   M3216 07263618
         L     R12,CH6+4                                          M3216 07263818
         MVC   CH7+1(3),CH6+5          ADDR OF LAST KEY ON        17332 07264018
*                                      PRIME TRACK                      07264618
         NI    IOBINDCT,X'CF'                                     17332 07265218
         OI    CH8E+4,X'82'                                       17332 07265818
         L     R9,DECBKEY              IS HI KEY ON TRK           17332 07266418
         CR    R9,R12                  EQ TO  KEY OF NEW RECORD   17332 07267018
         BE    APPT2H31                IF YES-BRANCH              17332 07267618
         AH    R12,DCBBLKSI            OVFL REC COUNT ADDR        17332 07268218
         SR    R9,R9                                              17332 07268818
         IC    R9,DCBKEYLE                                        17332 07269418
         AR    R12,R9                                             17332 07270018
APPT2H32 ST    R12,CH6+4                                          17332 07270618
         MVI   IOBASYN,X'09'            SCHED ASYN ROUTINE        17332 07271218
         SR    R9,R9                                              17332 07271818
         B     APPN3B5                                            17332 07272418
APPT2H31 L     R12,DCBMSWA                                        17332 07273018
         LA    R12,2(R12)                                         17332 07273618
         B     APPT2H32                                           17332 07274218
APPT2K2  L     R13,CD2+4               CP12B POINTER              17332 07274818
         IC    R9,IOBDADAD+7                                      17332 07275418
         BCTR  R9,R0                                              17332 07276018
         STC   R9,IOBDADAD+7                                      17332 07276618
         NI    CH8E+4,X'40'             NO RECORDS BUMPED TO OVFL 17332 07277218
APPT1K2  LR    R12,R13                  START AT CE1                    07280000
         ST    R12,IOBSTART-1                                           07300000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   07320000
         MVI   IOBAPP,X'15'             SET APPENDAGE CODE TO 21        07340000
         B     APPRVXCP                 EXCP RETURN TO IOS              07360000
APPT1D5  NI    DCWWKNI,X'F7'            SET OFF CP12A ENDED W/EOF SW    07380000
         B     APPT1E3                                                  07400000
APPT1D2  CLC   0(0,R12),0(R13)          EXECUTED INSTRUCTION            07420000
APPT1E2  TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         07440000
         BO    APPT1F2                  BO IF YES                       07460000
APPT1E1  OI    DECBEXC1,X'01'           RECORD IS A DUPLICATE           07480000
         MVI   IOBASYN,X'08'                                            07500000
         B     APPN3B5                  SCHEDULE PROCESSING COMPLETION  07520000
APPT1F2  L     R12,DCBMSWA              CHECK FIRST DATA BYTE AT W+KL+8 07540000
         LA    R12,2(R12)                                         17332 07550018
         IC    R9,DCBKEYLE                                              07560000
         AR    R12,R9                                                   07580000
         CLI   8(R12),X'FF'             IS RECORD MARKED FOR DELETION   07600000
         BNE   APPT1E1                  NO - IT IS A TRUE DUPLICATE     07620000
         LA    R13,CL1                  REPLACE DEL RCD - START AT CL1  07640000
         ST    R13,IOBSTART-1                                           07660000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          07680000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            07700000
         MVI   IOBAPP,X'18'             SET APPENDAGE CODE TO 24        07720000
         B     APPRVXCP                 EXCP RETURN TO IOS              07740000
         EJECT                                                          07760000
*              ABNORMAL END CP12A,  APPENDAGE CODE 20,         CHART T1 07780000
APPT1A3  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     07800000
         BC    PERRNO,APPRVNOR          NO - NORMAL RETURN TO IOS       07820000
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     07840000
         BZ    APPN3B3                  NO - RECORD IS UNREACHABLE      07860000
         LA    R13,CD2+8                                                07880000
         CLR   R12,R13                                                  07900000
         BNH   APPN3B3                  NO - RECORD IS UNREACHABLE      07920000
         OI    DECBEXC1,X'08'           UNCORRECTABLE I/O ERROR         07940000
         B     APPN3B4                  SCHEDULE PROCESSING COMPLETION  07960000
         EJECT                                                          07980000
*              CHANNEL  END CP12B,  APPENDAGE CODE 21,         CHART T2 08000000
APPT2B2  L     R13,CD2+4                PIONT TO CE1             M4966  08010020
         USING CP12B,R13                                         S20201 08030020
         LA    R13,CE3                  POINT TO CE3             S20201 08040020
         LA    R9,24(R0,R0)             PUT 24 IN REG 9                 08060000
         SR    R12,R9                   SET REG 12 TO STOP ADDRESS-24   08080000
         TM    20(R12),X'40'            CHECK CC FLAG AT STOP-4         08100000
         BO    APPN3B3                  BO IF ON - UNREACHABLE RECORD   08120000
         CLR   R12,R13                                                  08140000
         BL    APPN3B3                  BL MEANS STOPPED TOO SOON       08160000
         BE    *+8                      REG 12 POINTS TO WR COUNT       08180000
         LA    R12,8(R0,R12)            ADJUST IF IT DOES NOT           08200000
         STH   R12,IOBFCHAD+2                                           08220000
         SRL   R12,16                                                   08240000
         STC   R12,IOBFCHAD+1           SAVE AT IOBFCHAD                08260000
APPT2C2  L     R12,IOBFCHAD             POINT TO CP12B SAVED ADDRESS    08280000
         L     R13,0(R0,R12)            POINT TO LAST COUNT             08300000
         L     R12,DCBWKPT2                                             08320000
         USING IHADCW,R12                                        S20201 08330020
         TM    DCWWKNI,X'08'            DID CP12A END WITH EOF          08340000
         BZ    APPT2E2                  BZ IF NO                        08360000
         MVC   IOBDADAD+4(4),1(R13)     MOVE CHHR OF LAST COUNT TO IOB  08380000
         OI    DCWWKNI,X'20'            SET ON SAME MODULE SW           08400000
         MVI   IOBAPP,X'09'             SET APPENDAGE CODE TO 9         08420000
         MVC   DCBLPDA+7(1),IOBDADAD+7  UPDATE R IN LPDA          13494 08430015
         L     R15,DEBEXPTR              GET ADDR OF DEB         S21045 08434021
*                                       EXTENSION PTR            S21045 08438021
         USING DEBEXT,R15                                        S21045 08442021
         L     R15,DEBWKPT5              ADDRESS OF PART 2 IN    S21045 08446021
*                                       R15                      S21045 08450021
         DROP  R15                                               S21045 08454021
         USING IHAPART2,R15                                             08460000
         B     APPN7B4                  BRANCH TO CP10A APPENDAGE       08480000
         USING APP,R15                                                  08500000
APPT2E2  TM    CH8E+4,X'02'             RECORD BUMPED TO OVFL     17332 08590018
         BZ    APPT2J2                  IF NO-BRANCH              17332 08680018
         MVI   IOBAPP,X'04'             SET UP 2ND PART CP14      17332 08770018
         MVC   IOBSTART,CH21+4          TO UPDATE INDICES         17332 08860018
         MVC   IOBDADAD,CH14           RESTORE IOBSEEK            17332 08950018
         MVI   CH14,X'03'               CHANGE CH14               17332 09040018
         MVI   CH14+4,X'20'             TO ANOP                   17332 09130018
         MVI   CH14+7,X'01'                                       17332 09220018
         NI    CH8E+4,X'40'            RESET  FLAG                17332 09310018
         B     APPRVXCP                                           17332 09400018
APPT2J2  LA    R12,CK1                  START AT CK1                    09500000
         ST    R12,IOBSTART-1                                           09520000
         MVC   IOBDADAD+5(3),CB23       PUT CB23 HHR IN IOB             09540000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   09560000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  09580000
         STH   R12,CK1+2                                                09600000
         STH   R12,CK4+2                                                09620000
         SRL   R12,16                                                   09640000
         STC   R12,CK1+1                                                09660000
         STC   R12,CK4+1                                                09680000
         L     R12,IOBFCHAD                                             09700000
         LA    R12,8(R0,R12)            POINTER TO LAST WRITE KEY       09720000
         MVC   CK6+1(3),1(R12)          PUT KEY ADDRESS IN CK6          09740000
         MVI   IOBAPP,X'11'             SET APPENDAGE CODE TO 17        09760000
         B     APPRVXCP                 EXCP RETURN TO IOS              09780000
CLILDT   CLI   DCBLDT+1,0                                               09800000
         EJECT                                                          09820000
*              ABNORMAL END CP12B,  APPENDAGE CODE 21,         CHART T2 09840000
APPT2A3  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     09860000
         BC    PERRNO,APPRVNOR          NO - NORMAL RETURN TO IOS       09880000
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     09900000
         BZ    APPN3B3                  NO - RECORD IS UNREACHABLE      09920000
         L     R13,CD2+4                POINT TO CE1             M4966  09930020
         USING CP12B,R13                                         S20201 09950020
         LA    R13,CE3                  POINTER TO CE3           S20201 09960020
         CLR   R12,R13                                                  09980000
         BNH   APPN3B3                  NO - RECORD IS UNREACHABLE      10000000
         OI    DECBEXC1,X'08'           UNCORRECTABLE I/O ERROR         10020000
         B     APPN3B4                  SCHEDULE PROCESSING COMPLETION  10040000
         EJECT                                                          10060000
*              CHANNEL  END CP12C,  APPENDAGE CODE 24,         CHART T3 10080000
APPT3B2  LA    R13,CL3+8                DID CHAN PROG STOP AT CL3       10100000
         CLR   R12,R13                                                  10120000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      10140000
         B     APPN3B4                  SCHEDULE PROCESSING COMPLETION  10160000
         EJECT                                                          10180000
*              ABNORMAL END CP12C,  APPENDAGE CODE 24,         CHART T3 10200000
APPT3A4  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     10220000
         BC    PERRNO,APPRVNOR          NO - NORMAL RETURN TO IOS       10240000
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     10260000
         BZ    APPN3B3                  NO - RECORD IS UNREACHABLE      10280000
         LA    R13,CL3+8                DID CHAN PROG STOP AT CL3       10300000
         CLR   R12,R13                                                  10320000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      10340000
         OI    DECBEXC1,X'08'           UNCORRECTABLE I/O ERROR         10360000
         B     APPN3B4                  SCHEDULE PROCESSING COMPLETION  10380000
         EJECT                                                          10400000
*              GENERALIZED MOVE OF LOGICAL RECORD SUBROUTINE            10420000
* ENTRY  LA    12,SENDADDR    SENDADDR = SEND ADDRESS FIRST BYTE        10440000
*        LA    13,RCVADDR     RCVADDR = RECEIVE ADDRESS FIRST BYTE      10460000
*        BAL   3,APPMOV10                                               10480000
* DESTROYS     REGISTER 9 (ONE BYTE), REGISTERS 3, 10, 12, 13           10500000
* AT EXIT      REGISTER 3 CONTAINS RETURN ADDR                          10520000
*              REGISTER 9 CONTAINS X'FF' IN LOW-ORDER BYTE              10540000
*              REGISTER 10 CONTAINS A VARIABLE QUANTITY, LESS THAN 256  10560000
*              REGISTER 12 CONTAINS SENDADDR + DCBLRECL                 10580000
*              REGISTER 13 CONTAINS RCVADDR + DCBLRECL                  10600000
* RETURNS      TO BAL INSTRUCTION PLUS FOUR BYTES                       10620000
APPMOV10 LA    R9,255(R0,R0)            PLACE 255 IN REG 9              10640000
         LH    R10,DCBLRECL             PLACE RECORD LENGTH IN REG 10   10660000
         BCTR  R10,R0                   MOVE LRECL BYTES                10680000
APPMOV20 CLR   R10,R9                   COMPARE LENGTH REMAINDER TO 255 10700000
         BNH   APPMOV30                 BRANCH LAST TIME                10720000
         MVC   0(255,R13),0(R12)        MOVE 255 BYTES                  10740000
         SR    R10,R9                   REDUCE LENGTH REMAINDER BY 255  10760000
         AR    R12,R9                   INCREASE SEND INDEXING BY 255   10780000
         AR    R13,R9                   INCREASE RCV INDEXING BY 255    10800000
         B     APPMOV20                 LOOP                            10820000
APPMOV30 EX    R10,APPMOV40             MOVE 255 OR FEWER BYTES         10840000
         LA    R12,1(R12,R10)           UPDATE INDEXING BY 255 OR LESS  10860000
         LA    R13,1(R13,R10)           UPDATE INDEXING BY 255 OR LESS  10880000
         BR    R3                       RETURN FROM SUB-ROUTINE         10900000
APPMOV40 MVC   0(0,R13),0(R12)          LENGTH, RCV ADDR, SEND ADDR     10920000
         EJECT                                                          10940000
*              CHANNEL  END CP15,   APPENDAGE CODE 14,         CHART M1 10960000
APPM1B2  LA    R13,CI4+8                DID CHAN PROG STOP AT CI4       10980000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      11000000
         BNE   APPM1B3                  NO - RECORD IS UNREACHABLE      11020000
         L     R12,DCBWKPT2                                             11040000
         USING IHADCW,R12                                        S20201 11050020
         OI    DCWWKNI,X'10'            SET ADD-TO-END INDICATOR ON     11060000
         CLI   DCBFIRSH+TWO,ONE         TEST FOR SHARED TRACK    A46955 11066021
         BNH   APPM1B20                 NO                       A46955 11072021
         CLC   DCBFIRSH(2),DCBLPDA+5    END OF SHARED TRACK        7851 11080000
         BE    APPM1B2A                                            7851 11100000
APPM1B20 EQU   *                        *                        A46955 11110021
         MVC   DCWHIRPS(1),DCBHIRPD                                7851 11120000
         B     APPM1B2B                                            7851 11140000
APPM1B2A MVC   DCWHIRPS(1),DCBHIRSH                                7851 11160000
APPM1B2B EQU   *                                                   7851 11180000
         TM    DCBST,X'01'              IS LAST TRACK FULL              11200000
         BO    APPM1C2                  BO IF YES, TO SET UP CP16       11220000
         MVI   IOBAPP,X'17'             SET APPENDAGE CODE TO 23        11240000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   11260000
         LA    R12,CB46                 START AT CB46                   11280000
         ST    R12,IOBSTART-1                                           11300000
         MVC   IOBDADAD,DCBLPDA         PUT DCBLPDA MBBCCHHR IN IOB     11320000
         MVC   CB49+1(3),DECBKEY+1      MOVE KEY  ADDRESS TO CB49       11340000
         L     R12,DECBAREA             MOVE DATA ADDRESS TO CB50       11360000
         LA    R12,16(R0,R12)                                           11380000
         ST    R12,CB50                                                 11400000
         IC    R9,DCBLPDA+7             MOVE DCBLPDA CCHHR TO CB51      11420000
         LA    R12,1(R0,R9)              THEN INCREASE CB51 R BY 1      11440000
         STC   R12,CB51+4                                               11460000
         MVC   CB51(4),DCBLPDA+3                                        11480000
         LA    R12,IOBDADAD+3                                           11500000
         STH   R12,CB46+2                                               11520000
         SRL   R12,16                                                   11540000
         STC   R12,CB46+1               MOVE IOB ADDRESS TO CB46        11560000
         B     APPRVXCP                 EXCP RETURN TO IOS              11580000
APPM1C2  EQU   *                                                        11600000
         TM    CB26,X'08'               WAS ENTRY READ IN CB25 OFLO END 11620000
         BZ    APPM1D3                  YES  M1D3                       11640000
         MVC   IOBDADAD,CB25            MOVE CB25 MBBCCHHR TO IOB       11660000
         MVI   IOBAPP,X'0F'             SET APPENDAGE CODE TO 15        11680000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          11700000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            11720000
         LA    R12,CJ1                  START AT CJ1                    11740000
         ST    R12,IOBSTART-1                                           11760000
         LA    R12,IOBDADAD+3           MOVE IOB ADDRESS TO CJ1 AND CJ5 11780000
         ST    R12,CJ1                                                  11800000
         MVI   CJ1,SIDEQ                RESTORE COMMAND CODE     S20201 11806020
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 11812020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE    MOVE IN ADDR OF KEY S20201 11821020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE    MOVE IN ADDR OF KEY S20201 11830020
         LA    R12,0(R0,R0)             CMP TRK INDEX AND OFLO RCD MODL 11960000
         IC    R12,CB25                  ARE THEY THE SAME              11980000
         SLL   R12,4(R0)                                                12000000
         L     R12,DEBUCBAD(R12)        GET UCB ADDR FROM DEB    S20201 12020020
         LA    R12,0(R0,R12)                                            12040000
         CLR   R12,R7                                                   12060000
         BE    APPRVXCP                 YES - EXCP RETURN TO IOS        12080000
         MVI   IOBASYN,X'01'                                            12100000
         B     APPM1D4                  EXCP IN ASYNCHRONOUS ROUTINE    12120000
APPM1D3  MVI   IOBASYN,X'0A'            SET ASYNCHRONOUS CODE TO 10     12140000
APPM1D4  NI    IOBINDCT,X'CF'           OFLO RCD AND KEY IN AREA AND I  12160000
         B     APPM1B5                  SCHEDULE ASYNCHRONOUS ROUTINE   12180000
APPM1B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           12200000
APPM1B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  12220000
APPM1B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 12240002
         EJECT                                                          12320000
*              ABNORMAL END CP15,   APPENDAGE CODE 14,         CHART M1 12340000
APPM1J2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     12360000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       12380000
         B     APPM1B3                  YES  M1B3                       12400000
APPN3B21 LA    R13,APPN3B2                                              12420000
         BC    15,APPN3B22                                              12440000
APPM1B21 LA    R13,APPM1B2                                              12460000
APPN3B22 BR    R13                      NULL ROUTINE             Y02072 12480002
APPRVXCP EQU   *                                                        12620000
         SR    R12,R12                                                  12640000
         IC    R12,IOBDADAD             CURRENT EXTENT                  12660000
         SLL   R12,4                    LENGTH OF 1 EXTENT=1            12680000
         LA    R12,DEBUCBAD(R12)        ADDR OF CORRECT EXTENT   S20201 12700020
         MVC   IOBDADAD+1(2),4(R12)     MOVE BB TO IOB                  12720000
         LA    R14,EXCP(R14)            SETUP EXCP RETURN TO IOS  15924 12725016
         XC    IOBFLAG2(3),IOBFLAG2     CLEAR FLAG2,SENSE BYTES   15924 12730016
         XC    IOBCSW(9),IOBCSW         CLEAR FLAG3,CSW,AND SIOCC 15924 12735016
         XC    IOBERRCT(2),IOBERRCT     CLEAR ERROR COUNT         15924 12740016
         NI    IOBFLAG1,X'C2'           RESET FLAG1               15924 12745016
APPRVNOR BR    R14                      RETURN TO IOS             15924 12750016
INVAPPCD DC    H'0'                PROGCHK FOR BAD APP CODE    @ZA26522 12752037
TWOFOUR  DC    X'0018'             MAX VALUE FOR APP CODE      @ZA26522 12752237
*                                                                       12752437
MODID    DC    C'IGG019G2'              MODULE NAME            @ZA26522 12752637
DATE     DC    CL8'&SYSDATE'            FIX DATE               @ZA26522 12752837
FIX      DC    C' OZ26522'              LATEST FIX             @ZA26522 12753037
PATCH    DC    XL((*-IGG019G2)/20)'00'  ZEROED PATCH AREA        Y02072 12754002
*                                                                       12756002
         EJECT                                                          12760000
*                        ADDRESS OF COMMUNICATION VECTOR TABLE          12780000
CVTPTR   EQU   16                                                       12800000
*                             RETURN TO IOS VECTOR TABLE                12820000
CVT      DSECT                                                          12940000
         DS    F         COMMUNICATION VECTOR TABLE EXIT EFFECTOR       12960000
CVTEXEF  DS    A                        *                               12962002
RQE      IECDRQE ,                      RQE                      Y02072 12970002
         EJECT                                                          12972002
IHAPART2 DS    0D                       PART 2 VECTOR TABLE             12980002
*        ROUTINE FOR          CODE      CEND COMPLETION OF              13020000
APPM67CE DS    CL6            7         CP1 OR CP2, WRITE KN            13040000
APPN7B2  DS    CL6            9,23      CP10A                           13060000
APPN8A2  DS    CL6            10,11     CP10B                           13080000
APPM4A2  DS    CL6            12        CP14  - SETUPS 1, 2, OR 5       13100000
APPM5A2  DS    CL6            13        CP14  - SET UPS 3, 4, OR 6      13120000
APPM2B2  DS    CL6            15        CP16 - SITUATION 2              13140000
APPM3B2  DS    CL6            16        CP16 - SITUATION 3              13160000
APPN9A2  DS    CL6            17,18,19  CP17                            13180000
APPAFB   DS    CL6                                                17332 13190018
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              13200000
APPM67AE DS    CL6            7         CP1 OR CP2, WRITE KN            13220000
APPN7J2  DS    CL6            9,23      CP10A                           13240000
APPN8G2  DS    CL6            10,11     CP10B                           13260000
APPM4E2  DS    CL6            12        CP14  -SETUPS 1, 2, OR 5        13280000
APPM5E2  DS    CL6            13        CP14  -SETUPS 3, 4, OR 6        13300000
APPM2H2  DS    CL6            15,16     CP16                            13320000
APPN9G4  DS    CL6            17,18,19  CP17                            13340000
APPAEB   DS    CL6                                                17332 13350018
APPN7A3  DS    CL4            CONTINUATION OF ROUTINES BEGUN IN         13360000
APPN7B4  DS    CL4                 PART 1                               13380000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              13400000
APPABA2  DS    CL6            0,1       CP4/CP5                         13420000
APPADB2  DS    CL6            2         CP7                             13440000
APPAAB2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     13460000
APPACA2  DS    CL6            5         CP6                             13480000
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              13500000
APPABD2  DS    CL6            0,1       CP4/CP5                         13520000
APPADE2  DS    CL6            2         CP7                             13540000
APPAAA2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     13560000
APPACE2  DS    CL6            5         CP6                             13580000
IHAWKNCP IGGWKNCP                                                       13600020
         IGGCP12C                                                       14100020
         IGGCP12A                                                       14600020
CP12B    DSECT                                                          15000020
         IGGCP12B                                                       15400020
         EJECT                                                          16160000
*              DATA EVENT CONTROL BLOCK                                 16180000
IHADECB  DSECT                                                          16200000
         DS    0F                                                       16220000
DECBECB  DS    CL4                      EVENT CONTROL BLOCK (ECB)       16240000
DECBTYP1 DS    BL1                      TYPE B6 - 1 IF LENGTH IS S      16260000
*                                            B7 - 1 IF AREA IS S        16280000
DECBTYP2 DS    BL1                           B0 - 1 IF READ K           16300000
*                                            B1 - 1 IF READ KX          16320000
*                                            B2 - 1 IF READ KU          16340000
*                                            B4 - 1 IF WRITE K          16360000
*                                            B5 - 1 IF WRITE KN         16380000
DECBLGTH DS    CL2                      LENGTH OF BLOCK                 16400000
DECBDCBA DS    A                        POINTER TO DCB                  16420000
DECBAREA DS    A                        ADDRESS OF AREA                 16440000
DECBLOGR DS    A                        POINTER TO LOGICAL RECORD       16460000
DECBKEY  DS    A                        POINTER TO KEY                  16480000
DECBEXC1 DS    BL1                      EXCPTN CD B0-RECORD NOT FOUND   16500000
*                                                 B1-RECORD LGTH CHK    16520000
*                                                 B2-NO SPACE           16540000
*                                                 B3-INVALID REQUEST    16560000
*                                                 B4-UNCORRECTABLE IO   16580000
*                                                 B5-UNREACHABLE BLOCK  16600000
*                                                 B6-OVERFLOW RECORD    16620000
*                                                 B7-DUPLICATE          16640000
DECBEXC2 DS    BL1                                B7-READ KU            16660000
         EJECT                                                          16680000
         DCBD  DSORG=(IS)                                               16700000
         EJECT                                                          16720000
IHAIOB   IGGIOBD                                                        16730020
IHADCW   IGGBISAM                                                       16740020
IHADEB   IGGDEBD                                                        16760020
         END                                                            17660020
