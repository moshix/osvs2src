         TITLE 'IGG019G4 - APPENDAGES-PART 1,BLKD,SYS WA,NO WRT CHK'    00020000
IGG019G4 CSECT                                                          00040000
*          RELEASE OS/VS2-02 DELETIONS                                * 00045002
*          RELEASE 19 DELETIONS                                       * 00060000
*2452064500,071810-071930,072100                                 A28692 00062019
*          RELEASE 20 DELETIONS                                       * 00065000
*0150                                                            A38857 00065520
*0150042200,042260-042320,064540,069200,069400,069600,069800,    A31323 00066020
*0150070000,072140,072400,078800-079000,103200-106000            A31323 00067020
*0150018250-018300,018350,018400,038600-038800,039000-039800,    S20201 00067420
*0150045600,045800-046800,048600,049600,049800-050200,052800,    S20201 00067820
*0150058200,147600,147800,148000-148800,165600-167400,167600-    S20201 00068220
*0150171400,171600-175400,175600-180400,180600-191000,197000-    S20201 00068620
*0150199800,200000-209800,210200-211000,211200-215360,215600-    S20201 00069020
*0150216400,216600-223000                                        S20201 00069420
*          RELEASE 21 DELETIONS                                       * 00070000
*1201021600,022600                                               S21045 00070221
*1201                                                            A33533 00070521
*1201036200,043200,119000-119200,152200,157200-157400,159000-    A37184 00071021
*1201159400                                                      A37184 00072021
*1201                                                            M0060  00073021
*XXXX                                                            A49403 00073400
*1201021400                                                      A50670 00073800
*            CHANGES SINCE VS2-3.7                                    * 00074237
*A023460-023520,A156930-156960                                 @ZA26522 00074637
*                                                                     * 00075002
*STATUS CHANGE LEVEL 008                                                00092002
*                                                                       00100000
* FUNCTION/OPERATION- APPENDAGE ROUTINES FOR BISAM                      00120000
*        WHEN WRITE KN IS USED WITH OR WITHOUT READ AND UPDATE          00140000
*        WHEN THE USER HAS NOT SUPPLIED A READ-IN AREA,                 00160000
*        WHEN WRITE VALIDITY CHECKING IS NOT REQUESTED,                 00180000
*        AND RECORD FORMAT IS   BLOCKED.                                00200000
*        (PART 1)                                                       00220000
*                                                                       00240000
*        CEND  - IF CHANNEL PROGRAM ENDS                                00260000
*                **WITHOUT ERROR, EITHER                                00280000
*                    PROCESSING COMPLETION WILL BE SCHEDULED,           00300000
*                    PROCESSING CONTINUATION WILL BE SCHEDULED,         00320000
*                    OR PROCESSING WILL CONTINUE.                       00340000
*                **WITH A LENGTH CHECK, TESTS DETERMINE WHETHER         00360000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00380000
*                    ERROR.                                             00400000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00420000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00440000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00460000
*                                                                       00480000
*        ABEND - IF CHANNEL PROGRAM ENDS ABNORMALLY BECAUSE OF          00500000
*                **PERMANENT ERROR, 'UNCORRECTABLE I/O ERROR'           00520000
*                    IS INDICATED IN THE DECB, AND PROCESSING           00540000
*                    COMPLETION WILL BE SCHEDULED.                      00560000
*                **NON-PERMANENT ERROR, ONE RE-TRY IS MADE              00580000
*                    BEFORE INDICATING A PERMANENT ERROR.               00600000
*                **FILE PROTECTION, TESTS DETERMINE WHETHER             00620000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00640000
*                    ERROR.                                             00660000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00680000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00700000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00720000
* ENTRY POINTS-                                                         00740000
*        ENTRY POINT               FUNCTION                             00760000
*        -----------               --------                             00780000
*        APPCEND                   CEND                                 00800000
*        APPABEND                  ABEND                                00820000
*                                                                       00840000
* INPUT - N/A                                                           00860000
* OUTPUT - N/A                                                          00880000
* EXTERNAL ROUTINES - N/A                                               00900000
* EXITS- 1. RETURN TO IOS VIA THE APPENDAGE RETURN VECTOR TABLE POINTED 00920000
*            TO BY REGISTER 14.  SEE THE DSECT LABELED    APPRV FOR THE 00940000
*            FORMAT OF THIS TABLE AND THE USE OF EACH EXIT.             00960000
*           USED TO CONTINUE PROCESSING.                                00980000
*        2. SCHEDULE AN ASYNCHRONOUS ROUTINE - BRANCH VIA THE EXIT      01000000
*            EFFECTOR ADDRESS IN THE COMMUNICATION VECTOR TABLE.        01020000
*           USED TO SCHEDULE PROCESSING COMPLETION OR CONTINUATION.     01040000
*        3. IF THE DESIRED APPENDAGE ROUTINE IS IN PART 2, BRANCH TO    01060000
*            THAT ROUTINE VIA THE PART 2 VECTOR TABLE.  THE POINTER TO  01080000
*            THE MODULE IS IN DCBWKPT5.  SEE THE DSECT LABELED          01100000
*            IHAPART2 FOR RELATIVE ADDRESSES AND USES OF THE ROUTINES.  01120000
*                                                                       01140000
* TABLES/WORK AREAS - DECB, DCB, IOB AND EXTENTION, DCB WA (DCW), DEB,  01160000
*        CVT, PART 2 VECTOR TABLE.                                      01180000
*        SEE DSECTS AT END OF MODULE FOR FORMAT AND DESCRIPTIONS.       01200000
*                                                                       01220000
* ATTRIBUTES- REENTRANT. DISABLED.                                      01240000
* NOTES - NONE                                                          01260000
         EJECT                                                          01280000
* GENERAL REGISTERS ARE USED AS FOLLOWS                                 01300000
*                                                                       01320000
R0       EQU   0                   *    -----                           01340000
R1       EQU   1                   *    12* ADDRESS                     01360000
R2       EQU   2                   *    IOB                             01380000
R3       EQU   3                   *    DEB                             01400000
R4       EQU   4                   *    DCB                             01420000
BASEXXXX EQU   5                        BASE REG FOR CLEANUP     Y02072 01432002
SAVEXXXX EQU   6                        SAVE AREA FOR CLEANUP    Y02072 01442002
R7       EQU   7                   *    UCB                             01480000
R8       EQU   8                   *                                    01482002
R9       EQU   9                   #    WORK REGISTER                   01520000
R10      EQU   10                       CHANNEL PROGRAM POINTER         01540000
R11      EQU   11                       DECB                            01560000
R12      EQU   12                       WORK REGISTER                   01580000
R13      EQU   13                       WORK REGISTER                   01600000
R14      EQU   14                       IOS RETURN VECTOR TABLE         01620000
R15      EQU   15                       BASE REGISTER                   01640000
*                                                                       01660000
*        * MEANS THIS REGISTER IS SET UP UPON ENTRY FROM IOS,           01680000
*          AND ITS CONTENTS MUST BE RESTORED UPON RETURN TO IOS         01700000
*        # MEANS THIS REGISTER MAY BE CHANGED, BUT UPON RETURN TO IOS   01720000
*          MUST CONTAIN ZEROES IN THE THREE HIGH ORDER BYTES            01740000
*                                                                       01760000
PERRMASK EQU   X'20'          TO TEST FOR PERMANENT ERROR, TEST         01780000
PERRYES  EQU   8               IOBECBAD, B2. IF OFF (CONDITION CODE 8)  01800000
PERRNO   EQU   7               THERE IS A PERM ERR. ELSE B2 ON ( CD 7)  01820000
ONE      EQU   1                        MISC OFFSETS             S20201 01820820
TWO      EQU   2                        *                        S20201 01821620
THREE    EQU   3                        *                        S20201 01822420
FOUR     EQU   4                        *                        S20201 01823220
FIVE     EQU   5                        *                        S20201 01824020
SEVEN    EQU   7                        *                        S20201 01825020
EIGHT    EQU   8                        *                        S20201 01826020
SIXTEEN  EQU   16                       *                        S20201 01827020
OFLOW    EQU   X'10'                    OVERFLOW BIT OF F BYTE   S20201 01829020
DUMMY    EQU   X'20'                    DUMMY BIT OF F BYTE      S20201 01832020
NOSPACE  EQU   X'20'                    NO-SPACE-FOUND IND      SA59778 01832402
CCOFF    EQU   X'BF'                    MASK FOR CC OFF                 01834001
BYP      EQU   12                       RETURN TO IOS/BYPASS     S20201 01835020
EXCP     EQU   8                        RETURN TO IOS/EXCP       S20201 01841020
NORMAL   EQU   0                        RETURN TO IOS/NORMAL     S20201 01847020
ABENTRY  EQU   X'01'                    ABEND ENTRY INDICATOR    A50670 01852000
DATACHK  EQU   X'08'                    DATA CHECK IOB SENSE     A50670 01852400
REEXCP   EQU   8                        REEXCP RETURN TO IOS     Y02072 01852502
SKIPX    EQU   4                        SKIP RETURN TO IOS       Y02072 01852602
BYPASS   EQU   12                       BYPASS RETURN TO IOS     Y02072 01852702
FMVIOL   EQU   X'04'                    FILE MASK VIOLATION             01852802
NOTSEEK  EQU   8                        CC - SEEK TEST SENSE B0  Y02072 01853002
SEEKCHK  EQU   X'01'                    SEEK CHECK INDICATOR     Y02072 01854202
*                                                                       01856202
         USING RQE,R1                   RQE ADDRESSABILITY       Y02072 01856602
         USING IHAIOB,R2                IOB POINTER              S20201 01866602
         USING IHADEB,R3                DEB POINTER                     01873302
         USING IHADCB,R4                DCB POINTER                     01880000
         USING IHAWKNCP,R10             CHANNEL PROGRAM POINTER         01900000
         USING IHADECB,R11              DECB POINTER                    01920000
         USING IHADCW,R12               DCB WA POINTER ONLY AS WORK REG 01940000
         SPACE 4                                                        01980002
*                             APPENDAGE VECTOR TABLE                    02000000
APP      DC    A(APPCEND-APP)           CHANNEL END     USED BY WKN     02020000
         DC    A(APPABEND-APP)          ABNORMAL END  -     USED BY WKN 02040000
APPNO    EQU   *                                                        02060000
         USING APPCEND,R15                                              02080000
APPCEND  NI    IOBINDCT,X'FE'          INDICATE CEND ENTRY              02100000
         B     SETUPREG                 BRANCH TO SET UP REGISTERS      02120000
APPABEND EQU   *                                                 A50670 02130000
         USING APPABEND,R15                                             02132000
*                                                                A50670 02140000
*        IF THIS IS A CORRECTABLE DATA CHECK FROM AN RPS         A50670 02150000
*        DEVICE THEN RETURN TO IOS FOR ERP HANDLING              A50670 02160000
*                                                                A50670 02162000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR          A50670 02162400
         BZ    NOCDACK                  YES CONTINUE AS USUAL    A50670 02162800
         TM    IOBSENS1,FMVIOL          WAS IT A SEEK CHECK      Y02072 02173902
         BCR   NOTSEEK,R14              NO - RETURN TO ERPS      Y02072 02183902
         SPACE 3                                                        02193902
NOCDACK  EQU   *                                                 A50670 02197602
         OI    IOBINDCT,ABENTRY         INDICATE ABEND ENTRY     A50670 02200402
SETUPREG L     R15,DEBEXPTR              GET ADDR OF DEB         S21045 02203202
*                                       EXTENSION PTR            S21045 02206002
         USING DEBEXT,R15                                        S21045 02208802
         L     R15,DEBWKPT4              R15  BASE               S21045 02211602
         DROP  R15                                                      02214402
         USING APP,R15                                                  02217202
*                                                                       02217602
*   SAVE IOS REGISTERS AND SET UP ADDRESSABILITY TO RETURN TO SPECIAL   02219202
*   CLEANUP ROUTINE.                                                    02219602
*                                                                       02219702
         STM   R14,R12,0(R13)           SAVE REGISTERS           Y02072 02219802
         LR    SAVEXXXX,R13             SAVE SAVE AREA PTR       Y02072 02219902
         LA    R14,IOSRETS              RETURN TO RETURN TO IOS  Y02072 02220002
         LR    BASEXXXX,R14             BASE REG FOR RETURN      Y02072 02223902
         SPACE 2                                                        02224302
         MODESET KEYADDR=RQEPRT,WORKREG=13 ACQUIRE USER KEY      Y02072 02225902
         SPACE 3                                                        02227902
         L     R10,IOBCCWAD             R10  CP                         02228002
         LA    R10,0(R10)               CLEAR HIGH ORDER BYTE    A49403 02232002
         MVC   IOBECBAD+1(3),IOBBCHAD+1 RESTORE ECB              A33533 02236002
         L     R11,IOBECBAD             R11  DECB                       02240000
         L     R13,DEBEXPTR              GET ADDR OF DEB         S21045 02246021
*                                       EXTENSION PTR            S21045 02252021
         USING DEBEXT,R13                                        S21045 02258021
         L     R13,DEBWKPT5              R13  BASE, PART 2       S21045 02264021
         DROP  R13                                               S21045 02270021
         L     R12,IOBCSW               CSW = STOP ADDR PLUS 8          02280000
         LA    R12,0(R12)               CLEAR HIGH ORDER BYTE           02300000
         USING IHAPART2,R13                                             02320000
         IC    R9,IOBAPP                R9   RELATIVE ADDRESS IN        02340000
         CH    R9,TWOTHREE              IS APP CODE GT 23?     @ZA26522 02346037
         BH    INVAPPCD                 IF YES-GO PROGCHK      @ZA26522 02352037
         SLL   R9,2                            APPENDAGE TABLE          02360000
         TM    IOBINDCT,X'01'                                           02380000
         BO    APPABENT(R9)            IF ABEND, BRANCH VIA ABEND TABLE 02400000
         B     APPCENDT(R9)            IF CEND, BRANCH VIA THAT TABLE   02420000
         EJECT                                                          02440000
*********************************************************************** 02460000
*****              CHANNEL END APPENDAGE VECTOR TABLE             ***** 02480000
*********************************************************************** 02500000
APPCENDT EQU   *              CODE      FOR COMPLETION OF               02520000
         B     APPABA2   0             CP4/CP5, READ                    02540000
         B     APPABA2   1             CP4/CP5, WRITE                   02560000
         B     APPADB2   2             CP7                              02580000
         B     APPAAB2   3             CP1 OR CP2, READ AND UPDATE      02600000
         B     APPRVNOR  4             NOT USED                         02620000
         B     APPACA2   5             CP6                              02640000
         B     APPRVNOR  6             NOT USED                         02660000
         B     APPM67CE  7             CP1 OR CP2, WRITE KN             02680000
         B     APPN3B21                                                 02700000
         B     APPN7B2   9             CP10A  - TRUE INSERT             02720000
         B     APPN8A2   10            CP10B  - TRUE INSERT             02740000
         B     APPN8A2   11            CP10B  - ADD TO END              02760000
         B     APPM4A2   12            CP14  - SETUPS 1, 2, OR 5        02780000
         B     APPM5A2   13            CP14  - SETUPS 3, 4, OR 6        02800000
         B     APPM1B21                                                 02820000
         B     APPM2B2   15            CP16 - SITUATION 2               02840000
         B     APPM3B2   16            CP16 - SITUATION 3               02860000
         B     APPN9A2   17            CP17  - TRACK INDEX ONLY         02880000
         B     APPN9A2   18            CP17  - TRACK AND HIGHER LEVELS  02900000
         B     APPN9A2   19            CP17  - HIGHER LEVELS ONLY       02920000
         B     APPD1B2   20            CP11A                            02940000
         B     APPD2B2   21            CP11B                            02960000
         B     APPRVNOR  22            NOT USED                         02980000
         B     APPN7B2   23             CP10A  - ADD TO END             03000000
         EJECT                                                          03020000
*********************************************************************** 03040000
*****             ABNORMAL END APPENDAGE VECTOR TABLE             ***** 03060000
*********************************************************************** 03080000
APPABENT EQU   *              CODE      FOR COMPLETION OF               03100000
         B     APPABD2   0             CP4/CP5, READ                    03120000
         B     APPABD2   1             CP4/CP5, WRITE                   03140000
         B     APPADE2   2             CP7                              03160000
         B     APPAAA2   3             CP1 OR CP2, READ AND UPDATE      03180000
         B     APPRVNOR  4             NOT USED                         03200000
         B     APPACE2   5             CP6                              03220000
         B     APPRVNOR  6             NOT USED                         03240000
         B     APPM67AE  7             CP1 OR CP2, WRITE KN             03260000
         B     APPN3E2   8             CP8                              03280000
         B     APPN7J2   9             CP10A  - TRUE INSERT             03300000
         B     APPN8G2   10            CP10B  - TRUE INSERT             03320000
         B     APPN8G2   11            CP10B  - ADD TO END              03340000
         B     APPM4E2   12            CP14  - SETUPS 1, 2, OR 5        03360000
         B     APPM5E2   13            CP14  - SETUPS 3, 4, OR 6        03380000
         B     APPM1J2   14            CP15                             03400000
         B     APPM2H2   15            CP16 - SITUATION 2               03420000
         B     APPM2H2   16            CP16 - SITUATION 3               03440000
         B     APPN9G4   17            CP17  - TRACK INDEX ONLY         03460000
         B     APPN9G4   18            CP17  - TRACK AND HIGHER LEVELS  03480000
         B     APPN9G4   19            CP17  - HIGHER LEVELS ONLY       03500000
         B     APPD3B2   20            CP11A                            03520000
         B     APPD3F2   21            CP11B                            03540000
         B     APPRVNOR  22            NOT USED                         03560000
         B     APPN7J2   23             CP10A  - ADD TO END             03580000
         DROP  R13                                                      03600000
         EJECT                                                          03640000
*   SPECIAL IOS RETURN CLEANUP ROUTINE INTERCEPTS ALL RETURNS TO        03650002
*   IOS AND RESTORES REGISTERS AND SETS PROTECTION KEY TO 0.            03652002
         SPACE 2                                                 Y02072 03654002
IOSRETS  EQU   *                        RETURN POINT             Y02072 03656002
         USING *,BASEXXXX               ADDRESSABILITY           Y02072 03658002
         B     NORMRET                  NORMAL RETURN            Y02072 03658402
         B     SKIPRET                  SKIP POST RETURN         Y02072 03658802
         B     REEXCPRT                 REEXCP RETURN            Y02072 03659202
         SPACE 2                                                        03659602
BYPASRET EQU   *                        BYPASS POST RETURN       Y02072 03659702
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03659802
         LA    R14,BYPASS(R14)          SCHEDULE ASYNCH ROUTINE  Y02072 03659902
         L     R13,CVTPTR               CVT ADDRESSABILITY       Y02072 03666602
         USING CVT,R13                  *                        Y02072 03667002
         L     R13,CVT0EF00             ASYNCH SCHED ROUTINE     Y02072 03668602
         DROP  R13                      *                        Y02072 03669002
         BR    R13                      GO TO ROUTINE            Y02072 03670602
         SPACE 2                                                        03672602
REEXCPRT EQU   *                        REEXCP RETURN            Y02072 03673002
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03673102
         B     REEXCP(R14)              RETURN - REEXCP          Y02072 03673202
         SPACE 2                                                        03677402
SKIPRET  EQU   *                        RETURN - SKIP            Y02072 03679402
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03681402
         B     SKIPX(R14)               RETURN - SKIP            Y02072 03681502
         SPACE 2                                                        03684002
NORMRET  EQU   *                        RETURN - NORMAL          Y02072 03686002
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03686402
         BR    R14                      RETURN                   Y02072 03686802
         SPACE 2                                                        03687202
IOSRETX  EQU   *                        RESTORE REGS AND KEY     Y02072 03687302
         MODESET KEYADDR=KEY0,WORKREG=13   SET KEY = 0           Y02072 03687402
         SPACE 2                                                        03687802
         LM    R14,R11,0(SAVEXXXX)      RESTORE REGISTERS        Y02072 03688502
         BR    R12                      RETURN                   Y02072 03690502
         DROP  BASEXXXX                 RESET ADDRESSABILITY     Y02072 03690602
         SPACE 2                                                 Y02072 03690702
KEY0     DC    H'0'                     KEY 0                    Y02072 03690802
         EJECT                                                   Y02072 03691402
*              CHANNEL  END CP8,    APPENDAGE CODE  8,         CHART N3 03692802
APPN3B2  EQU   *                        *                               03693402
*                                                                       03694002
         LA    R13,CB8A+EIGHT           DID CHANNEL PROGRAM END ON      03695002
         CLR   R12,R13                  CB8A                            03697502
         BNE   APPAOS22                 NO, CONTINUE                    03700002
         TM    CB8A+FIVE,CC             WAS CB8A CHAINED                03702502
         BZ    APPAOS22                 NO, CP UNCHANGED                03705002
         NI    CB8A+FIVE,CCOFF          RESET CHAIN IND.                03707502
         OI    CB8A+FOUR,CC             TURN CC BACK ON                 03710002
         CLI   CB12,SEEKHH              CB12 SET FOR HEAD SEEK          03712502
         BNE   APPN3F3                  NO,  FILE PROTECT               03715002
         LA    R13,CB16                 RESET IOBSTART                  03717502
         ST    R13,IOBSTART-ONE         START CP WITH SETSECT           03720002
         MVC   IOBDADAD,CB10+SEVEN      RESET IOBSEEK                   03722502
         B     APPRVXCP                 SECHDULE EXCP IOS RETURN        03725002
APPAOS22 EQU   *                        *                               03727502
*                                                                       03730002
         LA    R13,CB21+EIGHT           DID CHAN PROG STOP AT CB21      03732502
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      03735002
         BNE   APPN3A3                  NO - CHECK FOR LENGTH ERROR     03737502
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         03740000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   03760000
         BO    APPN3C2A                 BO IF SHARED                    03780000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         03800000
         B     APPN3C2B                                                 03820000
APPN3C2A MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         03840000
APPN3C2B EQU   *                        *                        S20201 03870020
APPN3C2D MVC   IOBDADAD+3(5),CB23+3     MOVE CB23 CCHHR TO IOB          04000000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        04020000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   04040000
         LA    R13,CC1                  START AT CC1                    04060000
         ST    R13,IOBSTART-1                                           04080000
         L     R12,DCBWKPT2                                             04100000
         OI    DCWWKNI,X'04'            SET ON CP11A FIRST TIME SW      04120000
         LA    R13,IOBDADAD+3           PUT IOB ADDRESS IN CC1 AND CC4  04140000
         ST    R13,CC1                                                  04160000
         MVI   CC1,X'31'                                                04180000
         MVC   CC4(4),CC1                                               04200000
         NI    IOBINDCT,X'FF'-LASTIND   FLAG NORMAL USE OF CP11A A31323 04210020
*                                                                       04210402
*        TEST FOR OUT OF SPACE CONDITION                                04210620
*                                                                       04211002
         TM    DCBOPTCD,X'08'          CYL OVFL OPTION           A31323 04211220
         BZ    APPNSC                  IF NO-BRANCH              A31323 04211820
         CLI   CB22+5,X'00'            CYL OVFL FULL             A31323 04212420
         BNE   APPRVXCP                IF NO-BRANCH              A31323 04213020
APPNSC   TM    DCBOPTCD,X'10'          INDEP OVFL OPTION         A31323 04213620
         BZ    APPNSE                  IF NO-BRANCH              A31323 04214220
*      ADJUST DCBRORG2 TO ZERO IF IND OVFL IS FULL              SA53815 04216202
         LH    R13,DCBRORG2             LAST UNFILLED IOV TRK?  SA53815 04216302
*                                                                       04218202
         LTR   R13,R13                  ANY IND OVRFLOW TRKS    SA65051 04220202
         BZ    APPNSD                   BRANCH IF NO            SA65051 04220602
         BCT   R13,APPRVXCP             NO - BR TO READ BLOCK   SA53815 04221102
*                                       YES - CONTINUE          SA53815 04223002
APPNSD   IC    R13,DCBLIOV+7            GET LIOV (REC NO.)      SA65051 04224902
         LA    R13,1(R13)               BUMP REC NO.            SA53815 04226802
         SR    R12,R12                  CLEAR REG               SA53815 04228702
         IC    R12,DCBHIIOV             GET HIGHEST REC. NO.    SA53815 04230602
         CLR   R13,R12                  LIOV+EOF FILLS LAST TRK?SA53815 04232502
         BNE   APPRVXCP                 NO - BR TO READ BLOCK   SA53815 04234402
*                                       YES - CONTINUE          SA53815 04236302
         SR    R13,R13                  REDUCE NUMBER OF -      SA53815 04238202
         STH   R13,DCBRORG2             IND OVFL TRKS TO ZERO   SA53815 04240102
APPNSE   CLC   IOBDADAD(7),DCBLPDA      ON LAST TRK OF DATA SET  A31323 04242002
         BNE   APPNSG                   NO, BRANCH               A31323 04243902
         TM    DCBST,X'03'              IS LAST TRACK FULL       A31323 04245802
         BNO   APPRVXCP                 NO, BR--SPACE IS AVAIL   A31323 04247702
APPNSG   TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN  A31323 04249602
         BO    APPNSI                   YES, BR--RD LAST BLK TO  A31323 04251502
*                                                                       04253402
*        CHECK FOR DELETED RECORDS.  OTHERWISE, SET NO SPACE FND        04255302
*                                                                       04257202
         OI    DECBEXC1,X'20'           THEN READ DESIRED BLK    A31323 04259102
         B     APPRVXCP                 TO CHECK FOR DUP REC.    A31323 04261002
APPNSI   OI    IOBINDCT,LASTIND         WILL CHECK LAST RECORD   A31323 04262902
         L     R12,DCBWKPT2             RESTORE WORK AREA BASE   A31323 04264802
         USING IHADCW,R12                                        A31323 04266702
         MVC   IOBDADAD+7(1),DCWHIRPS   SET R TO LAST ON TRK     A31323 04268602
         B     APPRVXCP                 CHK RECORD FOR DELETION  A31323 04270502
APPNOB3  TM    DECBEXC1,NOSPACE         OUT OF SPACE?           SA59778 04270902
         BO    APPN3B1                  YES, GO ASYN RETURN     SA59778 04271302
APPN3B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           04272402
APPN3B1  L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 04274302
         LA    R3,0(R0,R3)              RESTORE DEB POINTER      A31323 04276202
APPN3B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  04278102
APPN3B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 04280002
         SPACE 5                                                        04290002
APPN3B6  LA    R13,CB8A+EIGHT           DID CP STOP AT CB8A      S20201 04342020
         CLR   R12,R13                  COMPARE REGS             S20201 04344020
         BNE   APPN3B3                  NO, UNREACHABLE BLOCK    S20201 04346020
         TM    CB11+SEVEN,OFLOW+DUMMY   OFLO, INACTIVE, OR DUMMY S20201 04348020
         BNZ   APPN3F3                  YES, GO TO FILE PROTECT  S20201 04350020
         MVC   CB23+THREE(FOUR),CB11+TWO  SET UP CCHH            S20201 04352020
         MVI   CB23+SEVEN,ONE           SET R EQUAL TO 1         S20201 04354020
         B     APPN3C2D                 GO READ RECORD           S20201 04356020
         EJECT                                                          04360000
*              ABNORMAL END CP8,    APPENDAGE CODE  8,         CHART N3 04380000
APPN3E2  EQU   *                                                  19374 04400000
         TM    IOBSENSE+1,X'04'         WAS ABEND DUE TO          15924 04420016
*                                       FILE PROTECT              15924 04430016
         BO    APPN3F2                  YES--BRANCH               19374 04440000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 04450000
         BC    PERRYES,APPN3B3          YES--BRANCH               19374 04460000
         B     APPRVNOR                 NO--RETRY CHANNEL PGM     19374 04470000
APPN3F2  LA    R13,CB12+8               DID CHAN PROG STOP AT CB12      04500000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      04520000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      04540000
APPN3F3  TM    CB11+SEVEN,OFLOW         WAS OFLO TRK IX ENTRY RD S20201 04550020
         BZ    APPN3G3                  BZ IF NO                 S20201 04560020
         TM    CB11+SEVEN,DUMMY         DUMMY OR INACTIVE        S20201 04570020
         BO    APPN3G3                  BO IF NO                        04700000
         MVC   CJ11(7),IOBDADAD         SAVE TRK INDEX MBBCCHH          04720000
         MVI   IOBAPP,X'10'             SET APPENDAGE CODE TO 16        04740000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          04760000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            04780000
         LA    R13,CJ1                  START AT CJ1                    04800000
         ST    R13,IOBSTART-1                                           04820000
         MVC   IOBDADAD,CB10+7          PUT CB10 MBBCCHHR IN IOB        04840000
         LA    R13,IOBDADAD+3           PUT SEEK ADDRESS IN CJ1 AND CJ5 04880000
         IC    R9,CJ1                                                   04900000
         ST    R13,CJ1                                                  04920000
         STC   R9,CJ1                                                   04940000
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 04950020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 04960020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 04970020
         L     R12,DCBWKPT2             SET ON FIRST TIME ONLY SWITCH   05040000
         USING IHADCW,R12                                        S20201 05050020
         OI    DCWWKNI,X'40'                                            05060000
         LA    R12,0(R0,R0)             IS FIRST OFLO ON SAME MODULE    05080000
         IC    R12,CB10+7                      GET M OF OFLO ENTRY      05100000
         SLL   R12,4(R0)                       MULT BY 16               05120000
         L     R12,32(R12,R3)                  LOAD UCB ADDR FROM DEB   05140000
         LA    R12,0(R0,R12)                   COMP WITH UCB AD IN 7    05160000
         CR    R12,R7                                                   05180000
         BE    APPRVXCP                 SAME MODULE - EXCP RTRN TO IOS  05200000
         MVI   IOBASYN,X'01'            DIFFERENT MODULE - MUST EXCP    05220000
         B     APPN3B5                   IN ASYNCHRONOUS ROUTINE        05240000
APPN3A3  TM    IOBCSW+5,X'40'           DID CHAN PROG HAVE LENGTH ERROR 05260000
         BZ    APPN3B6                  GO TEST FOR SPECIAL CASE S20201 05280020
         TM    CB11+7,X'30'             WAS ENTRY INACTIVE              05300000
         BO    APPN3B3                  BO IF YES                       05320000
APPN3G3  TM    CB11+7,X'20'             VERIFY ADD-TO-END SITUATION     05340000
         BZ    APPN3B3                  BZ IF DUMMY OR INACTIVE         05360000
         CLI   DCBNLEV,X'00'            ERROR IF 2 OR MORE INDEX LEVELS 05380000
         BNE   APPN3B3                  BNE IF MORE THAN 1 INDEX LEVEL  05400000
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         05420000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   05440000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 05450020
         BO    APPN3G33                 BO IF SHARED                    05460000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         05480000
         B     APPN3G5                                                  05500000
APPN3G33 MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         05520000
APPN3G5  MVI   IOBAPP,X'0E'             SET APPENDAGE CODE TO 14        05540000
         MVC   IOBDADAD(3),DCBLPDA      SEEK TO DCBLETI'S CYLINDER      05560000
         MVC   IOBDADAD+3(4),DCBLETI    CCHH                            05580000
         OC    IOBDADAD+6(1),DCBFIRSH+3                                 05600000
         XC    IOBDADAD+6(1),DCBFIRSH+3 REDUCE TO TRK BNDRY OR ZERO     05620000
         MVI   IOBDADAD+7,0                                             05640000
         LA    R12,CI1                  START AT CI1                    05660000
         ST    R12,IOBSTART-1                                           05680000
         NI    IOBFLAG1,X'7F'           DON'T USE DATA CHAINING         05700000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            05720000
         LA    R12,IOBDADAD+3           PUT SEEK ADDRESS IN CI1         05740000
         IC    R9,CI1                                                   05760000
         ST    R12,CI1                                                  05780000
         STC   R9,CI1                                                   05800000
         MVC   CI5+TWO(FIVE),DCBLETI    PUT DCBLETI CCHHR IN CI5 S20201 05810020
         MVC   CI5(TWO),DCBLPDA+ONE     MOVE IN BB FOR HEAD SEEK S20201 05820020
         B     APPRVXCP                                                 05840000
         EJECT                                                          05860000
*              CHANNEL  END CP11A,  APPENDAGE CODE 20,         CHART D1 05880000
APPD1B2  LA    R13,CC2A+8               DID CHAN PROG END AT CC2A       05900000
         CLR   R12,R13                                                  05920000
         BE    APPD1B3                  YES                             05940000
         LA    R13,CC3+8                DID CHAN PROG STOP AT CC3       05960000
         CLR   R12,R13                                                  05980000
         BNE   APPN3B3                  NO                              06000000
APPD1B3  L     R12,DCBWKPT2                                             06020000
         USING IHADCW,R12                                        S20201 06030020
         TM    DCWWKNI,X'10'            WAS CP11A USED FOR ADD-TO-END   06040000
         BO    APPD1A4                  BO IF YES                       06060000
         TM    DCWWKNI,X'04'                                            06080000
         BO    APPD1D2                  BO FIRST TIME THROUGH           06100000
         TM    IOBCSW+4,X'01'           DID CHAN PROG END WITH EOF      06120000
         BZ    APPD1H2                  BZ IF NO                        06140000
         TM    DCBST,X'02'              IS LAST BLOCK FULL              06160000
         BO    APPD1D4                  BO IF YES                       06180000
         L     R12,DCBMSWA              POINT TO W                      06200000
         AH    R12,CC6+6                POINT TO W+IL+AL                06220000
         SH    R12,DCBLRECL             POINT TO W+IL+AL-RL             06240000
         BAL   R13,APPPAD10             IS IT PADDING                   06260000
         B     APPN3B4                  YES - SCHEDULE COMPLETION       06280000
         OI    DCBST,X'02'              NO - SET ON LAST BLOCK FULL SW  06300000
         B     APPN3B4                                                  06320000
*        REGISTERS  3 AND 10 MUST NOW BE DESTROYED                      06340000
APPD1A4  L     R12,CC3                  SEND ADDRESS = W + IL + RL      06360000
         LA    R12,0(R0,R12)                                            06380000
         LR    R13,R12                                                  06400000
         SH    R13,DCBLRECL             RCV  ADDRESS = W + IL           06420000
APPD1A42 BAL   R3,APPMOV10              MOVE RECORD DOWN 1 SLOT         06440000
*                                                                       06440402
*                       GIVE UNREACHABLE BLOCK CONDITION IF NO KEY      06441018
*                       IN BLOCK READ IS HIGHER THAN KEY TO BE          06442018
*                       ADDED                                           06443018
*                                                                       06443402
         L     R10,IOBCCWAD             GET CP ADDRESS AGAIN      24080 06444018
         L     R3,CC3                   ADDRESS OF BLOCK READ     24080 06445018
         LA    R3,0(0,R3)                                         24080 06446018
         AH    R3,DCBBLKSI              ADDRESS OF END OF BLOCK   24080 06447018
         CR    R12,R3                   NEXT LRECL TO BE MOVED VS 24080 06448018
*                                       END OF BLOCK                    06449018
         BNL   APPN3B3                  BRANCH IF BEYOND END     A31323 06454020
         LH    R3,DCBRKP                POINT TO SEND   AREA'S KEY      06460000
         AR    R3,R12                                                   06480000
         L     R10,DECBKEY                                              06500000
         LA    R10,0(R0,R10)            POINT TO INSERT AREA'S KEY      06520000
         IC    R9,DCBKEYLE                                              06540000
         BCTR  R9,R0                    COMPARE KEYLE BYTES             06560000
         EX    R9,APPD1A44              IS SEND AREA PADDING            06580000
         BH    APPD1A42                 BH IF NO, TO LOOP               06600000
         L     R12,DECBAREA                                             06620000
         LA    R12,16(R0,R12)           SEND ADDRESS = AREA + 16        06640000
         BAL   R3,APPMOV10              MOVE NEW RECORD INTO BLOCK      06660000
         L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 06680002
         LA    R3,0(R0,R3)              RESTORE DEB POINTER             06700000
         L     R10,IOBCCWAD             RESTORE CP8 POINTER             06720000
         L     R12,DECBKEY                                              06740000
         LA    R12,0(R0,R12)            POINT TO INSERT AREA'S KEY      06760000
         L     R13,DCBMSWA              POINT TO BLOCK  AREA'S KEY      06780000
         IC    R9,DCBKEYLE                                              06800000
         BCTR  R9,R0                    MOVE KEYLE BYTES                06820000
         EX    R9,APPD1B52              MOVE INSERT KEY TO BLOCK KEY    06840000
         B     APPD1H5                                                  06860000
APPD1A44 CLC   0(0,R10),0(R3)           INSERT KEY VS. SEND KEY         06880000
APPD1B52 MVC   0(0,R13),0(R12)          INSERT KEY TO BLOCK KEY         06900000
APPD1D2  L     R13,CC3                  GET ADDR OF BLOCK READ   A31323 06910020
         LA    R13,0(R0,R13)            CLEAR HIGH BYTE          A31323 06920020
         AH    R13,DCBBLKSI             POINT TO END OF BLOCK    A31323 06930020
         SH    R13,DCBLRECL             POINT TO LAST RECORD     A31323 06940020
         TM    IOBINDCT,LASTIND         WAS THE LAST BLK RD      A31323 06950020
         BZ    APPD1D3                  NO, BRANCH TO CONTINUE   A31323 06960020
         NI    IOBINDCT,X'FF'-LASTIND   TURN OFF BIT             A31323 06970020
         CLI   0(R13),X'FF'             IS THIS RECORD DELETED   A31323 06980020
         BNE   APPN4B50                 NO, BR--SPACE NOT AVAIL  A31323 06982020
         BAL   R13,COMPLDT              YES, SPACE MAY BE AVAIL  A31323 06984020
*                                                                       06984402
*        RETURN HERE IF RECORD MUST BE BUMPED.  RETURN HERE + 4         06986020
*        (AFTER THE NEXT INSTRUCTION) IF RECORD NEED NOT GO INTO        06988020
*        OVERFLOW.                                                      06990020
*                                                                       06990402
APPN4B50 OI    DECBEXC1,X'20'           SPACE IS NOT AVAILABLE   A31323 06992020
APPD1E3  CLC   DCWHIRPS(1),CB23+7       IS THIS THE DESIRED BLK  A31323 06994020
         BE    APPD1D2                  YES, BRANCH              A31323 06996020
         MVC   IOBDADAD+7(1),CB23+7     NO, SEEK TO CORRECT BLK  A31323 06998020
         B     APPRVXCP                 GO READ IT IN            A31323 07000020
APPD1D3  NI    DCWWKNI,X'FB'            SET OFF FIRST TIME SW    A31323 07002020
         SH    R13,DCBBLKSI             RESTORE REG 13           A31323 07004020
         LR    R12,R13                                           A31323 07006020
         AH    R12,DCBLRECL                                      A31323 07008020
*                                                                       07008402
*        SEND ADDRESS (R12) IS W + LRECL + KL.                          07010020
*        RECEIVE ADDRESS (R13) IS W + KL.                               07012020
*                                                                       07014002
APPD1E2  LH    R3,DCBRKP                POINT TO SEND   AREA'S KEY      07020000
         AR    R3,R12                                                   07040000
         L     R10,DECBKEY                                              07060000
         LA    R10,0(R0,R10)            POINT TO INSERT AREA'S KEY      07080000
         IC    R9,DCBKEYLE                                              07100000
         BCTR  R9,R0                    COMPARE KEYLE BYTES             07120000
         EX    R9,APPD1A44              UPDATE, INSERT, OR LOOP         07140000
         BL    APPD1F2                  INSERT                          07160000
         BE    APPD1E1                  UPDATE                          07180000
*                                                                       07192002
         BAL   R3,APPMOV10              MOVE RECORD                     07200000
*                                                                       07200402
*                       GIVE UNREACHABLE BLOCK CONDITION IF NO KEY      07201018
*                       IN BLOCK READ IS HIGHER THAN KEY TO BE          07202018
*                       ADDED                                           07203018
*                                                                       07203402
         L     R10,IOBCCWAD             GET CP ADDRESS AGAIN      24080 07204018
         L     R3,CC3                   ADDRESS OF BLOCK READ     24080 07205018
         LA    R3,0(0,R3)                                         24080 07206018
         AH    R3,DCBBLKSI              ADDRESS OF END OF BLOCK   24080 07207018
         CR    R12,R3                   NEXT LRECL TO BE MOVED VS 24080 07208018
*                                       END OF BLOCK                    07209018
         BNL   APPNOB3                  BRANCH IF BEYOND END    SA59778 07214002
         B     APPD1E2                  CHECK AGAIN                     07220000
APPD1F2  TM    DECBEXC1,X'20'           WAS NO SPACE AVAIL       A31323 07230020
         BO    APPN3B1                  YES, POST REQ IN ERROR   A31323 07240020
         L     R12,DECBAREA                                      A31323 07250020
         LA    R12,16(R0,R12)           SEND ADDRESS = AREA + 16        07260000
         BAL   R3,APPMOV10              MOVE AREA + 16 INTO BLOCK       07280000
         L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 07300002
         LA    R3,0(R0,R3)              RESTORE DEB POINTER             07320000
         L     R10,IOBCCWAD             RESTORE CP8 POINTER             07340000
         NI    CC5+4,X'7F'              SET OFF REPL-OF-DEL FLAG        07360000
APPD1H2  CLC   IOBDADAD,DCBLPDA         WAS THE SEEK TO LAST RCD        07380000
         BNE   APPD1J3                  BNE IF NO                       07400000
         TM    DCBST,X'02'              IS LAST BLOCK FULL              07420000
         BO    APPD1J3                  BRANCH IF YES                   07440000
APPD1H5  L     R12,DCBNREC           H5 ADD 1 TO NUMBER OF PRIME DATA   07460000
         LA    R12,1(0,R12)              RECORDS - A LOGICAL RECORD     07480000
         ST    R12,DCBNREC               WILL REPLACE A PADDING RECORD. 07500000
         B     APPD1J4                                                  07520000
APPD1J3  L     R13,DCBMSWA              POINT TO BLOCK'S KEY            07540000
         LR    R12,R13                                                  07560000
         AH    R12,CC6+6                                                07580000
         SH    R12,DCBLRECL                                             07600000
         AH    R12,DCBRKP               POINT TO NEXT-TO-LAST KEY       07620000
         IC    R9,DCBKEYLE                                              07640000
         BCTR  R9,R0                    MOVE KEYLE BYTES                07660000
         EX    R9,APPD1B52              KEY OF NEXT-TO-LAST TO BLOCK'S  07680000
APPD1J4  LA    R12,CC4                  START AT CC4                    07700000
         ST    R12,IOBSTART-1                                           07720000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          07740000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            07760000
         MVI   IOBAPP,X'15'             SET APPENDAGE CODE TO 21        07780000
         B     APPRVXCP                 EXCP RETURN TO IOS              07800000
APPD1E1  TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         07820000
         BO    APPD1F1                  BO IF YES                       07840000
APPD1D1  OI    DECBEXC1,X'01'           RECORD IS A DUPLICATE           07860000
         B     APPN3B1                  SCHEDULE COMPLETION      A31323 07890020
APPD1F1  CLI   0(R12),X'FF'             IS RECORD IN BLOCK DELETED      07920000
         BNE   APPD1D1                  BNE IF NO                       07940000
         NI    DECBEXC1,X'DF'                                    A38857 07950020
         L     R12,DECBAREA                                             07960000
         LA    R12,16(R0,R12)           SEND ADDRESS = AREA +16         07980000
APPD1H1  BAL   R3,APPMOV10              MOVE AREA + 16 INTO BLOCK       08000000
         L     R3,RQEDEB                RESTORE DEB POINTER     Y02072  08020002
         LA    R3,0(R0,R3)                                              08040000
         L     R10,IOBCCWAD             RESTORE CCW POINTER             08060000
         L     R12,DCBMSWA                                              08080000
         AH    R12,CC6+6                POINTER TO LAST RECORD          08100000
         CLR   R12,R13                  HAS IT BEEN FILLED              08120000
         BE    APPD1J1                  BE IF YES                       08140000
         LR    R12,R13                                                  08160000
         AH    R12,DCBLRECL             RE-CREATE SEND POINTER          08180000
         B     APPD1H1                  MOVE UNTIL BLOCK IS DONE        08200000
APPD1J1  OI    CC5+4,X'80'              SET ON REPL-OF-DEL FLAG         08220000
         B     APPD1H2                                                  08240000
APPD1D4  L     R12,CC3                                                  08260000
         LA    R12,0(R0,R12)            START PADDING AT 2D RECORD      08280000
         L     R13,DCBMSWA                                              08300000
         AH    R13,CC6+6                STOP AT LAST RECORD             08320000
         CLR   R12,R13                  IS PADDING NECESSARY      12244 08326016
         BE    APPD1D5                  NO--BRANCH (1 REC/BLOCK)  12244 08332016
APPD1D42 MVI   0(R12),X'FF'             PAD BLOCK REMAINDER             08340000
         LA    R12,1(R0,R12)            INCREMENT INDEX                 08360000
         CLR   R12,R13                                                  08380000
         BL    APPD1D42                 BL IF LOOP COMPLETE             08400000
         NI    DCBST,X'FD'              LAST BLOCK NOT FULL       12244 08406016
APPD1D5  EQU   *                                                  12244 08412016
         L     R13,DCBMSWA              POINT TO BLOCK'S KEY            08420000
         LR    R12,R13                                                  08440000
         IC    R9,DCBKEYLE                                              08460000
         AR    R12,R9                                                   08480000
         AH    R12,DCBRKP               POINT TO FIRST KEY              08500000
         BCTR  R9,R0                    MOVE KEYLE BYTES                08520000
         EX    R9,APPD1B52              MOVE FIRST KEY TO BLOCK'S KEY   08540000
         LA    R12,CB46                 START AT CB46                   08580000
         ST    R12,IOBSTART-1                                           08600000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   08620000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CB46         08640000
         STH   R12,CB46+2                                               08660000
         SRL   R12,16                                                   08680000
         STC   R12,CB46+1                                               08700000
         MVC   CB49+1(3),DCBMSWA+1      PUT KEY ADDRESS IN CB49         08720000
         L     R12,DCBMSWA                                              08740000
         AH    R12,CC2A+6                                               08760000
         ST    R12,CB50                 PUT DATA ADDRESS IN CB50        08780000
         MVC   CB51(5),IOBDADAD+3       PUT IOB CCHHR IN CB51           08800000
         IC    R9,IOBDADAD+7             DECREASING R IN IOB BY 1       08820000
         BCTR  R9,R0                                                    08840000
         STC   R9,IOBDADAD+7                                            08860000
         MVI   IOBAPP,X'09'             SET APPENDAGE TO 9              08880000
         B     APPRVXCP                 EXCP RETURN TO IOS              08900000
         SPACE 5                                                        08920002
*              TEST FOR PADDING SUBROUTINE                              08940000
*                                                                       08950002
* ENTRY  LA    12,FIRSTPOS    FIRSTPOS = LOGICAL RECORD FIRST BYTE      08960000
*        BAL   13,APPPAD10                                              08980000
*                                                                       08990002
* DESTROYS     REGISTERS 9 (ONE BYTE), 12, 13 DESTRUCTIVELY             09000000
*              REGISTER 11, BUT RESTORES IT TO IOBECBAD                 09020000
*                                                                       09030002
* RETURNS      TO BAL INSTRUCTION PLUS FOUR BYTES IF PADDING            09040000
*              TO BAL INSTRUCTION PLUS EIGHT BYTES IF NO                09060000
*                                                                       09070002
APPPAD10 CLI   0(R12),X'FF'             TEST FIRST BYTE FOR ALL ONES    09080000
         BNE   APPPAD40                 BRANCH IF BLOCK IS FULL         09100000
         LH    R11,DCBLRECL             PLACE RECORD LENGTH IN REG 11   09120000
         LA    R9,255(R0,R0)            PLACE 255 IN REG 9              09140000
         LH    R11,DCBLRECL             PLACE RECORD LENGTH IN IR 11    09160000
         BCTR  R11,R0                   LRECL MINUS ONE COMPARES REQD   09180000
APPPAD20 CLR   R11,R9                   LENGTH REMAINDER MORE THAN 255  09200000
         BNH   APPPAD30                 NO - NO MORE LOOPING            09220000
         CLC   0(255,R12),1(R12)        COMPARE 255 BYTES               09240000
         BNE   APPPAD40                 NOT PADDING                     09260000
         SR    R11,R9                   REDUCE LENGTH REMAINDER BY 255  09280000
         AR    R12,R9                   INCREASE INDEXING BY 255        09300000
         B     APPPAD20                 LOOP                            09320000
APPPAD30 BCTR  R11,R0                   ADJUST FOR MACHINE LANGUAGE     09340000
         EX    R11,APPPAD60             COMPARE 255 OR FEWER BYTES      09360000
         BE    APPPAD50                 PADDING                         09380000
APPPAD40 LA    R13,4(R0,R13)            MODIFY RETURN FOR NOT PADDING   09400000
APPPAD50 L     R11,IOBECBAD             RESTORE REGISTER 11             09420000
         BR    R13                      RETURN                          09440000
APPPAD60 CLC   0(0,R12),1(R12)          EXECUTED COMPARE                09460000
         EJECT                                                          09480000
*              GENERALIZED MOVE OF LOGICAL RECORD SUBROUTINE            09500000
*                                                                       09510002
* ENTRY  LA    12,SENDADDR    SENDADDR = SEND ADDRESS FIRST BYTE        09520000
*        LA    13,RCVADDR     RCVADDR = RECEIVE ADDRESS FIRST BYTE      09540000
*        BAL   3,APPMOV10                                               09560000
*                                                                       09570002
* DESTROYS     REGISTER 9 (ONE BYTE), REGISTERS 3, 10, 12, 13           09580000
*                                                                       09590002
* AT EXIT      REGISTER 3 CONTAINS RETURN ADDR                          09600000
*              REGISTER 9 CONTAINS X'FF' IN LOW-ORDER BYTE              09620000
*              REGISTER 10 CONTAINS A VARIABLE QUANTITY, LESS THAN 256  09640000
*              REGISTER 12 CONTAINS SENDADDR + DCBLRECL                 09660000
*              REGISTER 13 CONTAINS RCVADDR + DCBLRECL                  09680000
*                                                                       09690002
* RETURNS      TO BAL INSTRUCTION PLUS FOUR BYTES                       09700000
*                                                                       09710002
APPMOV10 LA    R9,255(R0,R0)            PLACE 255 IN REG 9              09720000
         LH    R10,DCBLRECL             PLACE RECORD LENGTH IN REG 10   09740000
         BCTR  R10,R0                   MOVE LRECL BYTES                09760000
APPMOV20 CLR   R10,R9                   COMPARE LENGTH REMAINDER TO 255 09780000
         BNH   APPMOV30                 BRANCH LAST TIME                09800000
         MVC   0(255,R13),0(R12)        MOVE 255 BYTES                  09820000
         SR    R10,R9                   REDUCE LENGTH REMAINDER BY 255  09840000
         AR    R12,R9                   INCREASE SEND INDEXING BY 255   09860000
         AR    R13,R9                   INCREASE RCV INDEXING BY 255    09880000
         B     APPMOV20                 LOOP                            09900000
APPMOV30 EX    R10,APPMOV40             MOVE 255 OR FEWER BYTES         09920000
         LA    R12,1(R12,R10)           UPDATE INDEXING BY 255 OR LESS  09940000
         LA    R13,1(R13,R10)           UPDATE INDEXING BY 255 OR LESS  09960000
         BR    R3                       RETURN FROM SUB-ROUTINE         09980000
APPMOV40 MVC   0(0,R13),0(R12)          LENGTH, RCV ADDR, SEND ADDR     10000000
         EJECT                                                          10020000
*              CHANNEL  END CP11B,  APPENDAGE CODE 21,         CHART D2 10040000
APPD2B2  LA    R13,CC6+8                DID CHAN PROG STOP AT CC6       10060000
         CLR   R12,R13                                                  10080000
         BNE   APPN3B3                  NO   N3B3                       10100000
         L     R12,DCBWKPT2             WAS CP11B USED FOR ADD-TO-END   10120000
         USING IHADCW,R12                                        S20201 10130020
         TM    DCWWKNI,X'10'                                            10140000
         BO    APPD2A3                  YES  D2                         10160000
         TM    CC5+4,X'80'              WAS REPL OF DELE FLAG ON        10180000
         BO    APPN3B4                  YES  N3B4                       10200000
         CLC   DCWHIRPS,IOBDADAD+7      DOES R IN IOB EQUAL DCWHIRPS    10220000
         BNE   APPD2D3                  NO   D3                         10240000
         CLC   DCBLPDA,IOBDADAD         WAS SEEK TO LAST RCD OF DATASET 10260000
         BE    APPD2F3                  YES  F3                         10280000
APPD2G2  EQU   *                                                        10300000
         TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         10302016
         BZ    APPD2G3                  NO   G3                         10304016
         LH    R12,CC6+6                IS LAST RCD IN W TO BE DELETED  10306016
         L     R13,DCBMSWA                                              10308016
         AR    R12,R13                                                  10310016
         CLI   0(R12),X'FF'                                             10312016
         BNE   APPD2G3                  NO   G3                         10314016
         BAL   R13,COMPLDT              SEE IF MUST BUMP RECORD  A31323 10394020
         B     APPD2G3                  YES, RETURN HERE         A31323 10474020
*        NO, RETURN HERE                                                10554020
         MVC   IOBDADAD+5(3),CB23       MOVE CB23 CCHHR TO IOB          10640000
         MVI   IOBAPP,X'11'             SET APPENDAGE CODE TO 17        10660000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   10680000
         LA    R12,CK1                  START AT CK1                    10700000
         ST    R12,IOBSTART-1                                           10720000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  10740000
         ST    R12,CK1                                                  10760000
         MVI   CK1,X'31'                                                10780000
         MVC   CK4(4),CK1                                               10800000
         L     R12,CC6                  PUT NEXT-TO-LAST RCD'S KEY      10820000
         LA    R12,0(R0,R12)             ADDRESS IN CK6                 10840000
         AH    R12,CC6+6                                                10860000
         AH    R12,DCBRKP                                               10880000
         SH    R12,DCBLRECL                                             10900000
         STH   R12,CK6+2                                                10920000
         SRL   R12,16                                                   10940000
         STC   R12,CK6+1                                                10960000
         B     APPRVXCP                                                 10980000
APPD2A3  L     R12,DCBMSWA              POINT TO NEXT-TO-LAST RCD IN W  11000000
         AH    R12,CC6+6                                                11020000
         SH    R12,DCBLRECL                                             11040000
         BAL   R13,APPPAD10             IS IT PADDING                   11060000
         BE    APPD2A5                  YES - BLOCK IS NOT FULL         11080000
         OI    DCBST,X'02'              SET ON LAST BLOCK FULL SW       11100000
         B     APPD2C1                                                  11120000
APPD2A5  MVI   IOBAPP,X'12'             SET APPENDAGE CODE TO 18        11140000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   11160000
         LA    R12,CK1                  START AT CK1                    11180000
         ST    R12,IOBSTART-1                                           11200000
         MVC   IOBDADAD+3(5),DCBLETI    PUT DCBLETI CCHHR IN IOB        11220000
         MVC   IOBDADAD(3),DCBLPDA                                      11240000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  11260000
         ST    R12,CK1                                                  11280000
         MVI   CK1,X'31'                                                11300000
         MVC   CK4(4),CK1                                               11320000
         MVC   CK6+1(3),DECBKEY+1       PUT KEY ADDRESS IN CK6          11340000
         B     APPRVXCP                 EXCP RETURN TO IOS              11360000
APPD2D3  IC    R9,IOBDADAD+7            ADD 1 TO R IN IOB               11380000
         LA    R12,1(R0,R9)                                             11400000
         STC   R12,IOBDADAD+7                                           11420000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          11440000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            11460000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        11480000
         LA    R12,CC1                  START AT CC1                    11500000
         ST    R12,IOBSTART-1                                           11520000
         L     R12,DCBMSWA              MOVE LAST LOGICAL RCD TO W+IL   11540000
         AH    R12,CC6+6                                                11560000
         L     R13,DCBMSWA                                              11580000
         IC    R9,DCBKEYLE                                              11600000
         LA    R13,0(R9,R13)                                            11620000
         BAL   R3,APPMOV10                                              11640000
         L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 11660002
         LA    R3,0(R0,R3)                                              11680000
         B     APPRVXCP                 EXCP RETURN TO IOS              11700000
APPD2F3  TM    DCBST,X'02'              IS LAST BLOCK FULL              11720000
         BO    APPD2G2                  YES  G2                         11740000
         L     R12,DCBMSWA              TEST NEXT-TO-LAST RCD IN W      11760000
         AH    R12,CC6+6                                                11780000
         SH    R12,DCBLRECL                                             11800000
         BAL   R13,APPPAD10             IS IT PADDING                   11820000
         BE    APPN3B4                  YES - SCHEDULE COMPLETION       11840000
         OI    DCBST,X'03'              SET ON LAST BLK AND TRK FULL SW 11860000
         B     APPN3B4                                                  11880000
APPD2G3  EQU   *                                                 A37184 11910021
         L     R13,DECBAREA                                             11940000
         LA    R13,16(R0,R13)                                           11960000
*                                                                       11960402
         LR    R12,R4                   SAVE DCB ADDRESS         Y02072 11961002
         LR    R3,R14                   SAVE REG FOR IOS RETURN  Y02072 11962002
         L     R4,RQEDEB                ADDR OF CURRENT DEB      Y02072 11963002
         L     R4,0(R4)                 ADDR OF CURRENT TCB      Y02072 11964002
         LR    R8,R15                   SAVE BASE ADDRESS        Y02072 11964402
         LR    R9,R1                    SAVE RQE ADDRESS         Y02072 11964802
         LR    R10,R2                   SAVE IOB ADDRESS         Y02072 11964902
         SR    R2,R2                    IND. NO RANGE FOR TEST   Y02072 11966802
         LR    R1,R13                   ADDR TO BE VALIDATED     Y02072 11969602
         SPACE 2                                                        11970002
         MODESET  KEYADDR=KEY0,WORKREG=15  SET PROTECTION KEY 0  Y02072 11970402
         SPACE 2                                                        11970802
         L     R15,CVTPTR               ADDR OF CVT              Y02072 11971502
         USING CVT,R15                  CVT ADDRESSABILITY       Y02072 11973402
         L     R15,CVT0VL00             ADDR OF VALIDATION RTN   Y02072 11975302
         DROP  R15                      END USING ON CVT         Y02072 11977202
         SPACE 1                                                        11977602
         BALR  R14,R15                  VALIDATE ADDR            Y02072 11979102
         SPACE 1                                                        11979502
         LR    R1,R9                    RESTORE RQE ADDRESS      Y02072 11981002
         LR    R2,R10                   RESTORE IOB ADDRESS      Y02072 11982902
         LR    R4,R12                   RESTORE DCB ADDRESS      Y02072 11983302
         LR    R14,R3                   RESTORE IOS RETURN ADDR  Y02072 11983702
         LR    R15,R8                   RESTORE BASE ADDRESS AND Y02072 11984102
         USING APP,R15                  MODULE ADDRESSABILITY    Y02072 11984202
         SPACE 2                                                        11984502
         MODESET  KEYADDR=RQEPRT,WORKREG=10  SET USER'S KEY      Y02072 11984602
         SPACE 2                                                        11984702
         BZ    OKAREA                   B IF VALID TO CONTINUE   A37184 11984802
         OI    DECBEXC1,X'10'           SET INVALID REQUEST      A37184 11986702
         B     APPN3B1                  BR TO SCHED ASYNC        A37184 11988602
OKAREA   EQU   *                                                 A37184 11990502
         L     R10,IOBCCWAD             *                        M0060  11992402
         L     R12,DCBMSWA              MOVE LAST RCD IN W TO    A37184 11994302
         AH    R12,CC6+6                       AREA + 16         A37184 11996202
         BAL   R3,APPMOV10                                              11998102
         L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 12000002
         LA    R3,0(R0,R3)              RESTORE CP8 POINTER             12020000
         L     R10,IOBCCWAD                  RESTORE 10                 12040000
         L     R12,DCBMSWA                                              12060000
         AH    R12,CC6+6                                                12080000
         AH    R12,DCBRKP                                               12100000
         SR    R9,R9                                             A37184 12110021
         IC    R9,DCBKEYLE                                              12120000
         BCTR  R9,R0                    MOVE KEYLE BYTES                12140000
         L     R13,DECBKEY                                              12160000
         EX    R9,APPD2G4A              MOVE NEW KEY                    12180000
         NI    IOBINDCT,X'DF'           OFLO RCD IS IN AREA AND I       12200000
         L     R12,DCBMSWA              PUT KEY ADDRESS IN CH7          12220000
         AH    R12,CC6+6                                                12240000
         AH    R12,DCBRKP                                               12260000
         SH    R12,DCBLRECL                                             12280000
         ST    R12,CH7                                                  12300000
         MVI   CH7,X'0D'                                                12320000
         MVI   IOBASYN,X'09'            SET ASYNCHRONOUS CODE TO 9      12340000
         B     APPN3B5                  SCHEDULE ASYNCHRONOUS ROUTINE   12360000
APPD2C1  L     R12,DCBWKPT2             IS LAST RCD IN LAST SLOT ON TRK 12380000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 12390020
         CLC   DCWHIRPS,DCBLPDA+7                                       12400000
         BNE   APPD2A5                  BNE IF NO                       12420000
         OI    DCBST,X'01'              SET ON LAST TRACK FULL SW       12440000
         B     APPD2A5                                                  12460000
APPD2G4A MVC   0(0,R13),0(R12)          EXECUTED INSTRUCTION            12480000
COMPLDT  IC    R9,DCBHMASK              GET TRACK MASK           A31323 12481020
         SLL   R13,8                    MOVE OVER RETURN ADDR    A31323 12482020
         IC    R13,IOBDADAD+6           PICK UP TRACK BYTE       A31323 12483020
         NR    R9,R13                   MASK OFF TRACK           A31323 12484020
         SRL   R13,8                    RESTORE RETURN ADDR      A31323 12485020
         EX    R9,CLILDT                SEE IF LAST TRK OF CYL   A31323 12486020
         BE    COMPLDT1                 BRANCH IF ON LAST TRACK  A31323 12487020
*                                                                       12487402
*        IF NOT LAST TRACK, CHECK TO SEE IF LAST TRK OF PRIME.          12488020
*                                                                       12488402
         CLC   IOBDADAD(7),DCBLPDA      LAST PRIME DATA TRK      A31323 12489020
         BNE   4(R13)                   NO, DON'T BUMP RECORD    A31323 12490020
COMPLDT1 TM    CB26,X'08'               DOES OVERFLOW IX ENTRY   A31323 12491020
*                                                                       12491402
*        INDICATE THE EXISTENCE OF A CHAIN.                             12492020
*                                                                       12492402
         BO    4(R13)                   YES, NO NEED TO BUMP     A31323 12493020
         BR    R13                      MUST BUMP--NO CHAIN YET  A31323 12494020
CLILDT   CLI   DCBLDT+1,0                                               12500000
         EJECT                                                          12520000
*              ABNORMAL END CP11A,  APPENDAGE CODE 20,         CHART D3 12540000
APPD3B2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM. ERROR    12560000
         BC    PERRNO,APPRVNOR          NO - NORMAL RETURN TO IOS       12580000
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     12600000
         BZ    APPN3B3                  NO - BRANCH, RECORD UNREACHABLE 12620000
         LA    R13,CC2A+8               DID CHAN PROG STOP AT CC2A      12640000
         CLR   R12,R13                                                  12660000
         BE    APPD3E2                  YES - BRANCH TO E2              12680000
         LA    R13,CC3+8                                                12700000
         CLR   R12,R13                  DID CHAN PROG STOP AT CC3       12720000
         BNE   APPN3B3                  NO - BRANCH, RECORD UNREACHABLE 12740000
APPD3E2  OI    DECBEXC1,X'08'           YES - INDICATE UNCORRECTABLE    12760000
         B     APPN3B4                  I/O ERROR AND BRANCH            12780000
         EJECT                                                          12800000
*              ABNORMAL END CP11B,  APPENDAGE CODE 21,         CHART D3 12820000
APPD3F2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     12840000
         BC    PERRNO,APPRVNOR          NO - NORMAL RETURN TO IOS       12860000
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     12880000
         BZ    APPN3B3                  NO - BRANCH, RECORD UNREACHABLE 12900000
         LA    R13,CC6+8                DID CHAN PROG STOP AT CC6       12920000
         CLR   R12,R13                                                  12940000
         BNE   APPN3B3                  NO - BRANCH, RECORD UNREACHABLE 12960000
         B     APPD3E2                                                  12980000
         EJECT                                                          13000000
*              CHANNEL  END CP15,   APPENDAGE CODE 14,         CHART M1 13020000
APPM1B2  LA    R13,CI4+8                DID CHAN PROG STOP AT CI4       13040000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      13060000
         BNE   APPM1B3                  NO - RECORD IS UNREACHABLE      13080000
         L     R12,DCBWKPT2                                             13100000
         USING IHADCW,R12               ESTABLISH                S20201 13106020
*                                       ADDRESSABLILITY          S20201 13112020
         OI    DCWWKNI,X'10'            SET ADD-TO-END INDICATOR ON     13120000
         TM    DCBHIRSH,X'FF'           IS ADD TO SHARED TRACK    13401 13130016
         BZ    APPM1B2A                 NO BRANCH, YES CK AGAIN   13401 13140016
         CLC   DCBFIRSH+1(1),DCBLPDA+6  ADD TO END OF SHARED TRK  13401 13150016
         BNE   APPM1B2A                 BRANCH IF NOT SHARED      13401 13160016
         MVC   DCWHIRPS(1),DCBHIRSH     MOVE HIRSH TO WORK AREA   13401 13170016
         B     APPM1B2B                                           13401 13180016
APPM1B2A MVC   DCWHIRPS(1),DCBHIRPD     MOVE HIRPD TO WORK AREA   13401 13190016
APPM1B2B EQU   *                                                        13240000
*              SIMULATE CHART D4 SUBROUTINE                             13260000
         TM    DCBST,X'02'              IS LAST BLOCK FULL              13280000
         BO    APPD4B3                  BO IF YES                       13300000
         MVC   IOBDADAD+3(5),DCBLPDA+3  PUT DCBLPDA CCHHR IN IOB        13320000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   13340000
         LA    R12,CC1                  START AT CC1                    13360000
         ST    R12,IOBSTART-1                                           13380000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CC1 AND CC4  13400000
         STH   R12,CC1+2                                                13420000
         SRL   R12,16                                                   13440000
         STC   R12,CC1+1                                                13460000
         MVC   CC4+1(3),CC1+1                                           13480000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        13500000
         B     APPRVXCP                 EXCP RETURN TO IOS              13520000
APPD4B3  TM    DCBST,X'01'              IS LAST TRACK FULL              13540000
         BO    APPM1C2                  BO IF YES, TO SET UP CP16       13560000
         L     R13,DCBMSWA              MOVE RCD FROM AREA+16 TO W+IL   13580000
         IC    R9,DCBKEYLE                                              13600000
         LA    R13,0(R9,R13)                                            13620000
         L     R12,DECBAREA                                             13640000
         LA    R12,16(R0,R12)                                           13660000
*              SIMULATE GENERALIZED MOVE SUBROUTINE                     13680000
         LA    R9,255(R0,R0)            PLACE 255 IN IR 9               13700000
         LH    R10,DCBLRECL             RCD LGTH IN IR 10               13720000
         BCTR  R10,R0                   LRECL MOVES REQD                13740000
APPD4B3B CLR   R10,R9                   LGTH REMAINDER MORE THAN 255    13760000
         BNH   APPD4B3C                 BRANCH LAST TIME                13780000
         MVC   0(255,R13),0(R12)        MOVE 255 CHS                    13800000
         SR    R10,R9                   REDUCE LGTH REMAINDER BY 255    13820000
         AR    R12,R9                   INCREASE INDEXING BY 255        13840000
         AR    R13,R9                                                   13860000
         B     APPD4B3B                 LOOP                            13880000
APPD4B3C EX    R10,APPD4B3D             MOVE 255 OR FEWER BYTES         13900000
APPD4B3D MVC   0(0,R13),0(R12)          EXECUTED MOVE                   13920000
         L     R12,DCBMSWA              FORM PADDING RECORDS            13940000
         IC    R9,DCBKEYLE                                              13960000
         LA    R12,0(R9,R12)                                            13980000
         LR    R10,R12                                                  14000000
         AH    R12,DCBLRECL                                             14020000
         AH    R10,DCBBLKSI                                             14040000
         CLR   R10,R12                  IS PADDING NECESSARY      12244 14046016
         BE    APPD4B3E                 NO--BRANCH (1 REC/BLOCK)  12244 14052016
APPD4B3A MVI   0(R12),X'FF'                                             14060000
         LA    R12,1(R0,R12)                                            14080000
         CLR   R12,R10                                                  14100000
         BL    APPD4B3A                                                 14120000
         NI    DCBST,X'FD'              LAST BLOCK NOT FULL       12244 14126016
APPD4B3E EQU   *                                                  12244 14132016
         L     R10,IOBCCWAD             RESTORE CP8 POINTER             14140000
         MVI   IOBAPP,X'17'             SET APPENDAGE CODE TO 23        14160000
         MVC   IOBDADAD+3(5),DCBLPDA+3  PUT DCBLPDA CCHHR IN IOB        14200000
         MVC   CB51(4),IOBDADAD+3       USE DATA AND COMMAND CHAINING   14220000
         IC    R12,IOBDADAD+7           MOVE DCBLPDA CCHHR TO CB51      14240000
         LA    R12,1(R0,R12)                                            14260000
         STC   R12,CB51+4                                               14280000
         OI    IOBFLAG1,X'C0'            THEN INCREASE CB51 R BY 1      14300000
         LA    R12,CB46                 START AT CB46                   14320000
         ST    R12,IOBSTART-1                                           14340000
         LA    R12,IOBDADAD+3           MOVE IOB ADDRESS TO CB46        14360000
         STH   R12,CB46+2                                               14380000
         SRL   R12,16                                                   14400000
         STC   R12,CB46+1                                               14420000
         MVC   CB49+1(3),DECBKEY+1      MOVE KEY  ADDRESS TO CB49       14440000
         L     R12,DCBMSWA                                              14460000
         IC    R9,DCBKEYLE                                              14480000
         LA    R12,0(R9,R12)                                            14500000
         ST    R12,CB50                 MOVE DATA ADDRESS TO CB50       14520000
         B     APPRVXCP                 EXCP RETURN TO IOS              14540000
APPM1C2  EQU   *                                                        14560000
         TM    CB26,X'08'               WAS ENTRY READ IN CB25 OFLO END 14580000
         BZ    APPM1D3                  YES  M1D3                       14600000
         MVC   IOBDADAD,CB25            MOVE CB25 MBBCCHHR TO IOB       14620000
         MVI   IOBAPP,X'0F'             SET APPENDAGE CODE TO 15        14640000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          14660000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            14680000
         LA    R12,CJ1                  START AT CJ1                    14700000
         ST    R12,IOBSTART-1                                           14720000
         LA    R12,IOBDADAD+3           MOVE IOB ADDRESS TO CJ1 AND CJ5 14740000
         ST    R12,CJ1                  STORE ADDRESS            S20201 14750020
         MVI   CJ1,SIDEQ                RESTORE COMMAND CODE     S20201 14760020
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 14770020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 14780020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 14790020
         LA    R12,0(R0,R0)             CMP TRK INDEX AND OFLO RCD MODL 14900000
         IC    R12,CB25                  ARE THEY THE SAME              14920000
         SLL   R12,4(R0)                                                14940000
         L     R12,32(R3,R12)                                           14960000
         LA    R12,0(R0,R12)                                            14980000
         CLR   R12,R7                                                   15000000
         BE    APPRVXCP                 YES - EXCP RETURN TO IOS        15020000
         MVI   IOBASYN,X'01'                                            15040000
         B     APPM1D4                  EXCP IN ASYNCHRONOUS ROUTINE    15060000
APPM1D3  MVI   IOBASYN,X'0A'            SET ASYNCHRONOUS CODE TO 10     15080000
APPM1D4  NI    IOBINDCT,X'DF'           INDICATE OFLO RECORD IN AREA    15100000
         B     APPM1B5                  SCHEDULE ASYNCHRONOUS ROUTINE   15120000
APPM1B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           15140000
APPM1B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  15160000
APPM1B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 15180002
         EJECT                                                          15260000
*              ABNORMAL END CP15,   APPENDAGE CODE 14,         CHART M1 15280000
APPM1J2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     15300000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       15320000
         B     APPM1B3                  YES  M1B3                       15340000
APPN3B21 LA    R13,APPN3B2                                              15360000
         BC    15,APPN3B22                                              15380000
APPM1B21 LA    R13,APPM1B2                                              15400000
APPN3B22 BR    R13                      NULL ROUTINE             Y02072 15420002
         SPACE 3                                                        15440002
APPRVXCP EQU   *                                                        15560000
         SR    R12,R12                                                  15580000
         IC    R12,IOBDADAD             CURRENT EXTENT                  15600000
         SLL   R12,4                    LENGTH OF 1 EXTENT = 16         15620000
         LA    R12,32(R12,R3)           ADDRESS OF CURRENT EXTENT       15640000
         MVC   IOBDADAD+1(2),4(R12)     MOVE BB TO IOB                  15660000
         LA    R14,EXCP(R14)            SETUP FOR EXCP IOS RETURN 15924 15665016
         XC    IOBFLAG2(3),IOBFLAG2     CLEAR FLAG2,SENSE BYTES   15924 15670016
         XC    IOBCSW(9),IOBCSW         CLEAR FLAG3,CSW,AND SIOCC 15924 15675016
         XC    IOBERRCT(2),IOBERRCT     CLEAR ERROR COUNT         15924 15680016
         NI    IOBFLAG1,X'C2'           RESET FLAG1               15924 15685016
APPRVNOR BR    R14                      RETURN TO IOS             15924 15690016
INVAPPCD DC    H'0'                PROGCHK FOR BAD APP CODE    @ZA26522 15693037
TWOTHREE DC    X'0017'             MAX VALUE FOR APP CODE      @ZA26522 15696037
         SPACE 2                                                        15700002
LASTIND  EQU   X'02'       LAST BLK READ TO CHK FOR DELETES      A31323 15750020
*                             RETURN TO IOS VECTOR TABLE                15760000
*                                                                       15770002
MODID    DC    C'IGG019G4'         MODULE NAME                 @ZA26522 15772037
DATE     DC    CL8'&SYSDATE'       FIX DATE                    @ZA26522 15774037
FIX      DC    C' OZ26522'         LATEST FIX                  @ZA26522 15776037
PATCH    DC    XL((*-IGG019G4)/20)'00'  ZEROED PATCH AREA        Y02072 15780002
*                                                                       15790002
         EJECT                                                          15810002
RQE      IECDRQE ,                      RQE                      Y02072 15860002
         EJECT                                                          15870002
CVT      DSECT                                                          15880000
         CVT                                                            15900021
IHAPART2 DSECT                                 PART2 VECTOR      A37184 15920021
*                                       TABLE                    A37184 15940021
*        ROUTINE FOR          CODE      CEND COMPLETION OF              15960000
APPM67CE DS    CL6            7         CP1 OR CP2, WRITE KN            15980000
APPN7B2  DS    CL6            9,23      CP10A                           16000000
APPN8A2  DS    CL6            10,11     CP10B                           16020000
APPM4A2  DS    CL6            12        CP14  - SETUPS 1, 2, OR 5       16040000
APPM5A2  DS    CL6            13        CP14  - SET UPS 3, 4, OR 6      16060000
APPM2B2  DS    CL6            15        CP16 - SITUATION 2              16080000
APPM3B2  DS    CL6            16        CP16 - SITUATION 3              16100000
APPN9A2  DS    CL6            17,18,19  CP17                            16120000
         DS    CL6                                                17332 16130018
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              16140000
APPM67AE DS    CL6            7         CP1 OR CP2, WRITE KN            16160000
APPN7J2  DS    CL6            9,23      CP10A                           16180000
APPN8G2  DS    CL6            10,11     CP10B                           16200000
APPM4E2  DS    CL6            12        CP14  -SETUPS 1, 2, OR 5        16220000
APPM5E2  DS    CL6            13        CP14  -SETUPS 3, 4, OR 6        16240000
APPM2H2  DS    CL6            15,16     CP16                            16260000
APPN9G4  DS    CL6            17,18,19  CP17                            16280000
         DS    CL6                                                17332 16290018
APPN7A3  DS    CL4            CONTINUATION OF ROUTINES BEGUN IN         16300000
APPN7B4  DS    CL4                 PART 1                               16320000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              16340000
APPABA2  DS    CL6            0,1       CP4/CP5                         16360000
APPADB2  DS    CL6            2         CP7                             16380000
APPAAB2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     16400000
APPACA2  DS    CL6            5         CP6                             16420000
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              16440000
APPABD2  DS    CL6            0,1       CP4/CP5                         16460000
APPADE2  DS    CL6            2         CP7                             16480000
APPAAA2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     16500000
APPACE2  DS    CL6            5         CP6                             16520000
         EJECT                                                          16540000
*        WRITE KEY NEW CHANNEL PROGRAM REFERENCES (NO WRITE CHECK)      16640020
IHAWKNCP IGGWKNCP                                                       16840020
         IGGCP11A                                                       17140020
         IGGCP11B                                                       17540020
         EJECT                                                          19120000
*              DATA EVENT CONTROL BLOCK                                 19140000
IHADECB  DSECT                                                          19160000
         DS    0F                                                       19180000
DECBECB  DS    CL4                      EVENT CONTROL BLOCK (ECB)       19200000
DECBTYP1 DS    BL1                      TYPE B6 - 1 IF LENGTH IS S      19220000
*                                            B7 - 1 IF AREA IS S        19240000
DECBTYP2 DS    BL1                           B0 - 1 IF READ K           19260000
*                                            B1 - 1 IF READ KX          19280000
*                                            B2 - 1 IF READ KU          19300000
*                                            B4 - 1 IF WRITE K          19320000
*                                            B5 - 1 IF WRITE KN         19340000
DECBLGTH DS    CL2                      LENGTH OF BLOCK                 19360000
DECBDCBA DS    A                        POINTER TO DCB                  19380000
DECBAREA DS    A                        ADDRESS OF AREA                 19400000
DECBLOGR DS    A                        POINTER TO LOGICAL RECORD       19420000
DECBKEY  DS    A                        POINTER TO KEY                  19440000
DECBEXC1 DS    BL1                      EXCPTN CD B0-RECORD NOT FOUND   19460000
*                                                 B1-RECORD LGTH CHK    19480000
*                                                 B2-NO SPACE           19500000
*                                                 B3-INVALID REQUEST    19520000
*                                                 B4-UNCORRECTABLE IO   19540000
*                                                 B5-UNREACHABLE BLOCK  19560000
*                                                 B6-OVERFLOW RECORD    19580000
*                                                 B7-DUPLICATE          19600000
DECBEXC2 DS    BL1                                B7-READ KU            19620000
         EJECT                                                          19640000
         DCBD  DSORG=(IS)                                               19660000
         EJECT                                                          19680000
IHAIOB   IGGIOBD                                                        19780020
         EJECT                                                          21000000
IHADCW   IGGBISAM                                                       21060020
         EJECT                                                          21540000
IHADEB   IGGDEBD                                                        21600020
         END                                                            22439900
