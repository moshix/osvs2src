         TITLE 'IGG019G5 - APPENDAGES-PART 1,BLKD,SYS WA,WITH WRT CHK'  00020000
IGG019G5 CSECT                                                          00040000
*          RELEASE OS/VS2-02 DELETIONS                                * 00045002
*          RELEASE 19 DELETIONS                                       * 00060000
*2452065900,073210-073330,073500                                 A28692 00062019
*          RELEASE 20 DELETIONS                                       * 00065000
*0150                                                            A38857 00065520
*0150043200,043260-043320,065940,070600,070800,071000,071200,    A31323 00066020
*0150071400,073540,073800,080600-080800,105140-107400            A31323 00067020
*0150018850,018900,018950,019000,039200-039400,039600-040400,    S20201 00067320
*0150046600-047000,047200-047400,047800,049600,050600,050800-    S20201 00067620
*0150051200,053800,059600,059800,153600,153800,154000-154600,    S20201 00067920
*0150159400,159600,159800,160200,171600-174400,174600-178400,    S20201 00068220
*0150178600-183400,183600-189400,189600-202400,208400-211200,    S20201 00068520
*0150211400-221200,221600-222400,222600-226760,227000-227800,    S20201 00068820
*0150228000-234400                                               S20201 00069120
*          RELEASE 21 DELETIONS                                       * 00070000
*1232022200,023200                                               S21045 00070221
*1232                                                            A33533 00070521
*1232036800,044200,121600-121800,158000,162800-163000,164600-    A37184 00071021
*1232165000                                                      A37184 00072021
*1232                                                            M0060  00073021
*XXXX                                                            A49403 00073400
*1232022000                                                      A50670 00073800
*            CHANGES SINCE VS2-3.7                                    * 00074237
*A024200-024290,C024320                                        @ZA26522 00074637
*                                                                     * 00075002
*STATUS CHANGE LEVEL 009                                                00092002
*                                                                       00100000
* FUNCTION/OPERATION- APPENDAGE ROUTINES FOR BISAM                      00120000
*        WHEN WRITE KN IS USED WITH OR WITHOUT READ AND UPDATE          00140000
*        WHEN THE USER HAS NOT SUPPLIED A READ-IN AREA,                 00160000
*        WHEN WRITE VALIDITY CHECKING IS     REQUESTED,                 00180000
*        AND RECORD FORMAT IS   BLOCKED.                                00200000
*        (PART 1)                                                       00220000
*                                                                       00240000
*        CEND  - IF CHANNEL PROGRAM ENDS                                00260000
*                **WITHOUT ERROR, EITHER                                00280000
*                    PROCESSING COMPLETION WILL BE SCHEDULED,           00300000
*                    PROCESSING CONTINUATION WILL BE SCHEDULED,         00320000
*                    OR PROCESSING WILL CONTINUE.                       00340000
*                **WITH A LENGTH CHECK, TESTS DETERMINE WHETHER         00360000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00380000
*                    ERROR.                                             00400000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00420000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00440000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00460000
*                                                                       00480000
*        ABEND - IF CHANNEL PROGRAM ENDS ABNORMALLY BECAUSE OF          00500000
*                **PERMANENT ERROR, 'UNCORRECTABLE I/O ERROR'           00520000
*                    IS INDICATED IN THE DECB, AND PROCESSING           00540000
*                    COMPLETION WILL BE SCHEDULED.                      00560000
*                    USE OF WRITE VALIDITY CHECKING OPTION              00580000
*                    ALLOWS A LIMITED NUMBER OF RE-EXECUTIONS           00600000
*                    BEFORE INDICATING AN ERROR.                        00620000
*                **NON-PERMANENT ERROR, ONE RE-TRY IS MADE              00640000
*                    BEFORE INDICATING A PERMANENT ERROR.               00660000
*                **FILE PROTECTION, TESTS DETERMINE WHETHER             00680000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00700000
*                    ERROR.                                             00720000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00740000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00760000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00780000
* ENTRY POINTS-                                                         00800000
*        ENTRY POINT               FUNCTION                             00820000
*        -----------               --------                             00840000
*        APPCEND                   CEND                                 00860000
*        APPABEND                  ABEND                                00880000
* INPUT - N/A                                                           00900000
* OUTPUT - N/A                                                          00920000
* EXTERNAL ROUTINES - N/A                                               00940000
*                                                                       00960000
* EXITS- 1. RETURN TO IOS VIA THE APPENDAGE RETURN VECTOR TABLE POINTED 00980000
*            TO BY REGISTER 14.  SEE THE DSECT LABELED    APPRV FOR THE 01000000
*            FORMAT OF THIS TABLE AND THE USE OF EACH EXIT.             01020000
*           USED TO CONTINUE PROCESSING.                                01040000
*        2. SCHEDULE AN ASYNCHRONOUS ROUTINE - BRANCH VIA THE EXIT      01060000
*            EFFECTOR ADDRESS IN THE COMMUNICATION VECTOR TABLE.        01080000
*           USED TO SCHEDULE PROCESSING COMPLETION OR CONTINUATION.     01100000
*        3. IF THE DESIRED APPENDAGE ROUTINE IS IN PART 2, BRANCH TO    01120000
*            THAT ROUTINE VIA THE PART 2 VECTOR TABLE.  THE POINTER TO  01140000
*            THE MODULE IS IN DCBWKPT5.  SEE THE DSECT LABELED          01160000
*            IHAPART2 FOR RELATIVE ADDRESSES AND USES OF THE ROUTINES.  01180000
*                                                                       01200000
* TABLES/WORK AREAS - DECB, DCB, IOB AND EXTENTION, DCB WA (DCW), DEB,  01220000
*        CVT, PART 2 VECTOR TABLE.                                      01240000
*        SEE DSECTS AT END OF MODULE FOR FORMAT AND DESCRIPTIONS.       01260000
*                                                                       01280000
* ATTRIBUTES- REENTRANT. DISABLED.                                      01300000
* NOTES - NONE                                                          01320000
         EJECT                                                          01340000
* GENERAL REGISTERS ARE USED AS FOLLOWS                                 01360000
*                                                                       01380000
R0       EQU   0                   *    -----                           01400000
R1       EQU   1                   *    12* ADDRESS                     01420000
R2       EQU   2                   *    IOB                             01440000
R3       EQU   3                   *    DEB                             01460000
R4       EQU   4                   *    DCB                             01480000
BASEXXXX EQU   5                        BASE REG FOR CLEANUP     Y02072 01492002
SAVEXXXX EQU   6                        SAVE AREA FOR CLEANUP    Y02072 01510002
R7       EQU   7                   *    UCB                             01540000
R8       EQU   8                   *                                    01550002
R9       EQU   9                   #    WORK REGISTER                   01580000
R10      EQU   10                       CHANNEL PROGRAM POINTER         01600000
R11      EQU   11                       DECB                            01620000
R12      EQU   12                       WORK REGISTER                   01640000
R13      EQU   13                       WORK REGISTER                   01660000
R14      EQU   14                       IOS RETURN VECTOR TABLE         01680000
R15      EQU   15                       BASE REGISTER                   01700000
*                                                                       01720000
*        * MEANS THIS REGISTER IS SET UP UPON ENTRY FROM IOS,           01740000
*          AND ITS CONTENTS MUST BE RESTORED UPON RETURN TO IOS         01760000
*        # MEANS THIS REGISTER MAY BE CHANGED, BUT UPON RETURN TO IOS   01780000
*          MUST CONTAIN ZEROES IN THE THREE HIGH ORDER BYTES            01800000
*                                                                       01820000
PERRMASK EQU   X'20'          TO TEST FOR PERMANENT ERROR, TEST         01840000
PERRYES  EQU   8               IOBECBAD, B2. IF OFF (CONDITION CODE 8)  01860000
PERRNO   EQU   7               THERE IS A PERM ERR. ELSE B2 ON ( CD 7)  01880000
ONE      EQU   1                        MISC OFFSETS             S20201 01880820
TWO      EQU   2                        *                        S20201 01881620
THREE    EQU   3                        *                        S20201 01882420
FOUR     EQU   4                        *                        S20201 01883220
FIVE     EQU   5                        *                        S20201 01884020
SIX      EQU   6                        *                        S20201 01887020
SEVEN    EQU   7                        *                        S20201 01888020
EIGHT    EQU   8                        *                        S20201 01889020
SIXTEEN  EQU   16                       *                        S20201 01890020
OFLOW    EQU   X'10'                    OVERFLOW BIT OF F BYTE   S20201 01892020
DUMMY    EQU   X'20'                    DUMMY BIT OF F BYTE      S20201 01894020
NOSPACE  EQU   X'20'                    NO-SPACE-FOUND IND      SA59778 01894102
CCOFF    EQU   X'BF'                    MASK FOR CC OFF                 01894401
BYP      EQU   12                       RETURN TO IOS/BYPASS     S20201 01896020
EXCP     EQU   8                        RETURN TO IOS/EXCP       S20201 01902020
NORMAL   EQU   0                        RETURN TO IOS/NORMAL     S20201 01908020
ABENTRY  EQU   X'01'                    ABEND ENTRY INDICATOR    A50670 01913000
DATACHK  EQU   X'08'                    DATA CHECK IOB SENSE     A50670 01913400
REEXCP   EQU   8                        REEXCP RETURN TO IOS     Y02072 01913802
SKIPX    EQU   4                        SKIP RETURN TO IOS       Y02072 01913902
BYPASS   EQU   12                       BYPASS RETURN TO IOS     Y02072 01920402
FMVIOL   EQU   X'04'                    FILE MASK VIOLATION             01920802
NOTSEEK  EQU   8                        CC - SEEK TEST SENSE B0  Y02072 01922402
SEEKCHK  EQU   X'01'                    SEEK CHECK INDICATOR     Y02072 01924402
*                                                                       01926402
         USING RQE,R1                   RQE ADDRESSABILITY       Y02072 01926802
         USING IHAIOB,R2                IOB POINTER              S20201 01927002
         USING IHADEB,R3                DEB POINTER                     01933502
         USING IHADCB,R4                DCB POINTER                     01940000
         USING IHAWKNCP,R10             CHANNEL PROGRAM POINTER         01960000
         USING IHADECB,R11              DECB POINTER                    01980000
         USING IHADCW,R12               DCB WA POINTER ONLY AS WORK REG 02000000
         SPACE 4                                                        02040002
*                             APPENDAGE VECTOR TABLE                    02060000
APP      DC    A(APPCEND-APP)          CHAN END  -  USED BY WKN         02080000
         DC    A(APPABEND-APP)          ABNORMAL END  -     USED BY WKN 02100000
APPNO    EQU   *                                                        02120000
         USING APPCEND,R15                                              02140000
APPCEND  NI    IOBINDCT,X'FE'          INDICATE CEND ENTRY              02160000
         B     SETUPREG                 BRANCH TO SET UP REGISTERS      02180000
APPABEND EQU   *                                                 A50670 02190000
         USING APPABEND,R15                                             02192000
*                                                                A50670 02200000
*        IF THIS IS A CORRECTABLE DATA CHECK FROM AN RPS         A50670 02210000
*        DEVICE THEN RETURN TO IOS FOR ERP HANDLING              A50670 02220000
*                                                                A50670 02222000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR          A50670 02222400
         BZ    NOCDACK                  YES CONTINUE AS USUAL    A50670 02222800
         TM    IOBSENS1,FMVIOL          WAS IT A SEEK CHECK      Y02072 02224802
         BCR   NOTSEEK,R14              NO - RETURN TO ERPS      Y02072 02226802
         SPACE 3                                                        02228802
NOCDACK  EQU   *                                                 A50670 02230100
         OI    IOBINDCT,ABENTRY         INDICATE ABEND ENTRY     A50670 02230200
SETUPREG L     R15,DEBEXPTR              GET ADDR OF DEB         S21045 02230400
*                                       EXTENSION PTR            S21045 02232000
         USING DEBEXT,R15                                        S21045 02237800
         L     R15,DEBWKPT4              R15  BASE               S21045 02245200
         DROP  R15                                                      02252600
         USING APP,R15                                                  02260000
*                                                                       02262002
*   SAVE IOS REGISTERS AND SET UP ADDRESSABILITY TO RETURN TO SPECIAL   02270002
*   CLEANUP ROUTINE.                                                    02272002
*                                                                       02272402
         STM   R14,R12,0(R13)           SAVE REGISTERS           Y02072 02274002
         LR    SAVEXXXX,R13             SAVE SAVE AREA PTR       Y02072 02276002
         LA    R14,IOSRETS              RETURN TO RETURN TO IOS  Y02072 02278002
         LR    BASEXXXX,R14             BASE REG FOR RETURN      Y02072 02278402
         SPACE 2                                                        02278502
         MODESET KEYADDR=RQEPRT,WORKREG=13 ACQUIRE USER KEY      Y02072 02278802
         SPACE 3                                                        02279202
         L     R10,IOBCCWAD             R10  CP                         02280000
         LA    R10,0(R10)               CLEAR HIGH ORDER BYTE    A49403 02282000
         MVC   IOBECBAD+1(3),IOBBCHAD+1 RESTORE ECB              A33533 02290021
         L     R11,IOBECBAD             R11  DECB                       02300000
         L     R13,DEBEXPTR              GET ADDR OF DEB         S21045 02306021
*                                       EXTENSION PTR            S21045 02312021
         USING DEBEXT,R13                                        S21045 02318021
         L     R13,DEBWKPT5              R13  BASE, PART 2       S21045 02324021
         DROP  R13                                               S21045 02330021
         USING IHAPART2,R13                                             02340000
         L     R12,IOBCSW               R12  ADDRESS OF LAST CCW + 8    02360000
         LA    R12,0(0,R12)                                             02380000
         IC    R9,IOBAPP                R9   RELATIVE ADDRESS IN        02400000
         CH    R9,TWOTHREE              IS APP CODE GT 23?     @ZA26522 02420037
         BNH   CODEOK                   IF NOT BYPASS PROGCHK  @ZA26522 02423037
         DC    H'0'                     PROGCHK FOR BAD CODE   @ZA26522 02426037
TWOTHREE DC    X'0017'                  MAX VALUE FOR APP CODE @ZA26522 02429037
CODEOK   SLL   R9,2                            APPENDAGE TABLE @ZA26522 02432037
         TM    IOBINDCT,X'01'                                           02440000
         BO    APPABENT(R9)            IF ABEND, BRANCH VIA ABEND TABLE 02460000
         B     APPCENDT(R9)            IF CEND, BRANCH VIA THAT TABLE   02480000
         EJECT                                                          02500000
*********************************************************************** 02520000
*****              CHANNEL END APPENDAGE VECTOR TABLE             ***** 02540000
*********************************************************************** 02560000
APPCENDT EQU   *              CODE      FOR COMPLETION OF               02580000
         B     APPABA2   0             CP4/CP5, READ                    02600000
         B     APPABA2   1             CP4/CP5, WRITE                   02620000
         B     APPADB2   2             CP7                              02640000
         B     APPAAB2   3             CP1 OR CP2, READ AND UPDATE      02660000
         B     APPRVNOR  4             NOT USED                         02680000
         B     APPACA2   5             CP6                              02700000
         B     APPAHB2   6             CP4/CP5 WRITE CHECK              02720000
         B     APPM67CE  7             CP1 OR CP2, WRITE KN             02740000
         B     APPN3B21                                                 02760000
         B     APPN7B2   9             CP10AW - TRUE INSERT             02780000
         B     APPN8A2   10            CP10BW - TRUE INSERT             02800000
         B     APPN8A2   11            CP10BW - ADD TO END              02820000
         B     APPM4A2   12            CP14W - SETUPS 1, 2, OR 5        02840000
         B     APPM5A2   13            CP14W - SETUPS 3, 4, OR 6        02860000
         B     APPM1B21                                                 02880000
         B     APPM2B2   15            CP16 - SITUATION 2               02900000
         B     APPM3B2   16            CP16 - SITUATION 3               02920000
         B     APPN9A2   17            CP17W - TRACK INDEX ONLY         02940000
         B     APPN9A2   18            CP17W - TRACK AND HIGHER LEVELS  02960000
         B     APPN9A2   19            CP17W - HIGHER LEVELS ONLY       02980000
         B     APPD1B2   20            CP11A                            03000000
         B     APPD2B2   21            CP11BW                           03020000
         B     APPRVNOR  22            NOT USED                         03040000
         B     APPN7B2   23             CP10AW - ADD TO END             03060000
         EJECT                                                          03080000
*********************************************************************** 03100000
*****             ABNORMAL END APPENDAGE VECTOR TABLE             ***** 03120000
*********************************************************************** 03140000
APPABENT EQU   *              CODE      FOR COMPLETION OF               03160000
         B     APPABD2   0             CP4/CP5, READ                    03180000
         B     APPABD2   1             CP4/CP5, WRITE                   03200000
         B     APPAIB2   2             CP7                              03220000
         B     APPAAA2   3             CP1 OR CP2, READ AND UPDATE      03240000
         B     APPRVNOR  4             NOT USED                         03260000
         B     APPACE2   5             CP6                              03280000
         B     APPAHD2   6             CP4/CP5 WRITE CHECK              03300000
         B     APPM67AE  7             CP1 OR CP2, WRITE KN             03320000
         B     APPN3E2   8             CP8                              03340000
         B     APPJ3B2   9             CP10AW - TRUE INSERT             03360000
         B     APPJ4B2   10            CP10BW - TRUE INSERT             03380000
         B     APPJ4B2   11            CP10BW - ADD TO END              03400000
         B     APPJ5B2   12            CP14W - SETUPS 1, 2, OR 5        03420000
         B     APPJ6B2   13            CP14W - SETUPS 3, 4, OR 6        03440000
         B     APPM1J2   14            CP15                             03460000
         B     APPM2H2   15            CP16 - SITUATION 2               03480000
         B     APPM2H2   16            CP16 - SITUATION 3               03500000
         B     APPJ7B2   17            CP17W - TRACK INDEX ONLY         03520000
         B     APPJ7B2   18            CP17W - TRACK AND HIGHER LEVELS  03540000
         B     APPJ7B2   19            CP17W - HIGHER LEVELS ONLY       03560000
         B     APPD3B2   20            CP11A                            03580000
         B     APPJ8B2   21            CP11BW                           03600000
         B     APPRVNOR  22            NOT USED                         03620000
         B     APPJ3B2   23             CP10AW - ADD TO END             03640000
         DROP  R13                                                      03660000
         EJECT                                                          03700000
*   SPECIAL IOS RETURN CLEANUP ROUTINE INTERCEPTS ALL RETURNS TO        03710002
*   IOS AND RESTORES REGISTERS AND SETS PROTECTION KEY TO 0.            03712002
         SPACE 2                                                 Y02072 03714002
IOSRETS  EQU   *                        RETURN POINT             Y02072 03716002
         USING *,BASEXXXX               ADDRESSABILITY           Y02072 03718002
         B     NORMRET                  NORMAL RETURN            Y02072 03718402
         B     SKIPRET                  SKIP POST RETURN         Y02072 03718802
         B     REEXCPRT                 REEXCP RETURN            Y02072 03719202
         SPACE 2                                                        03719602
BYPASRET EQU   *                        BYPASS POST RETURN       Y02072 03719702
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03719802
         LA    R14,BYPASS(R14)          SCHEDULE ASYNCH ROUTINE  Y02072 03719902
         L     R13,CVTPTR               CVT ADDRESSABILITY       Y02072 03726602
         USING CVT,R13                  *                        Y02072 03727002
         L     R13,CVT0EF00             ASYNCH SCHED ROUTINE     Y02072 03728602
         DROP  R13                      *                        Y02072 03729002
         BR    R13                      GO TO ROUTINE            Y02072 03730602
         SPACE 2                                                        03732602
REEXCPRT EQU   *                        REEXCP RETURN            Y02072 03733002
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03733102
         B     REEXCP(R14)              RETURN - REEXCP          Y02072 03733202
         SPACE 2                                                        03737402
SKIPRET  EQU   *                        RETURN - SKIP            Y02072 03739402
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03741402
         B     SKIPX(R14)               RETURN - SKIP            Y02072 03741502
         SPACE 2                                                        03744002
NORMRET  EQU   *                        RETURN - NORMAL          Y02072 03746002
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03746402
         BR    R14                      RETURN                   Y02072 03746802
         SPACE 2                                                        03747202
IOSRETX  EQU   *                        RESTORE REGS AND KEY     Y02072 03747302
         MODESET KEYADDR=KEY0,WORKREG=13   SET KEY = 0           Y02072 03747402
         SPACE 2                                                        03747802
         LM    R14,R11,0(SAVEXXXX)      RESTORE REGISTERS        Y02072 03748502
         BR    R12                      RETURN                   Y02072 03750502
         DROP  BASEXXXX                 RESET ADDRESSABILITY     Y02072 03750602
         SPACE 2                                                 Y02072 03750702
KEY0     DC    H'0'                     KEY 0                    Y02072 03750802
         EJECT                                                   Y02072 03751402
*              CHANNEL  END CP8,    APPENDAGE CODE  8,         CHART N3 03752802
APPN3B2  EQU   *                        *                               03753402
*                                                                       03754002
         LA    R13,CB8A+EIGHT           DID CHANNEL PROGRAM END ON      03755002
         CLR   R12,R13                  CB8A                            03757502
         BNE   APPAOS22                 NO, CONTINUE                    03760002
         TM    CB8A+FIVE,CC             WAS CB8A CHAINED                03762502
         BZ    APPAOS22                 NO, CP UNCHANGED                03765002
         NI    CB8A+FIVE,CCOFF          RESET CHAIN IND.                03767502
         OI    CB8A+FOUR,CC             TURN CC BACK ON                 03770002
         CLI   CB12,SEEKHH              CB12 SET FOR HEAD SEEK          03772502
         BNE   APPN3F3                  NO,  FILE PROTECT               03775002
         LA    R13,CB16                 RESET IOBSTART                  03777502
         ST    R13,IOBSTART-ONE         START CP WITH SETSECT           03780002
         MVC   IOBDADAD,CB10+SEVEN      RESET IOBSEEK                   03782502
         B     APPRVXCP                 SECHDULE EXCP IOS RETURN        03785002
APPAOS22 EQU   *                        *                               03787502
*                                                                       03790002
         LA    R13,CB21+EIGHT           DID CHAN PROG STOP AT CB21      03792502
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      03795002
         BNE   APPN3A3                  NO - CHECK FOR LENGTH ERROR     03797502
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         03800000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   03820000
         BO    APPN3C2A                 BO IF SHARED                    03840000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         03860000
         B     APPN3C2B                                                 03880000
APPN3C2A MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         03900000
APPN3C2B EQU   *                        *                        S20201 03930020
APPN3C2D MVC   IOBDADAD+3(5),CB23+3    MOVE CB23 CCHHR TO IOB           04060000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        04080000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   04100000
         LA    R13,CC1                  START AT CC1                    04120000
         ST    R13,IOBSTART-1                                           04140000
         L     R12,DCBWKPT2                                             04160000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 04170020
         OI    DCWWKNI,X'04'            SET ON CP11A FIRST TIME SW      04180000
         LA    R13,IOBDADAD+3           PUT IOB ADDRESS IN CC1 AND CC4  04200000
         ST    R13,CC1                                                  04220000
         MVI   CC1,X'31'                                                04240000
         MVC   CC4(4),CC1              MOVE ID AND OP CODE TO CC4       04260000
         MVC   CC6A+1(3),CC4+1          PUT IOB ADDRESS IN CC6A         04280000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               04300000
         NI    IOBINDCT,X'FF'-LASTIND   FLAG NORMAL USE OF CP11A A31323 04301020
*                                                                       04301402
*        TEST FOR OUT OF SPACE CONDITION                                04302020
*                                                                       04302402
         TM    DCBOPTCD,X'08'          CYL OVFL OPTION           A31323 04303020
         BZ    APPNSC                  IF NO-BRANCH              A31323 04304020
         CLI   CB22+5,X'00'            CYL OVFL FULL             A31323 04305020
         BNE   APPRVXCP                IF NO-BRANCH              A31323 04306020
APPNSC   TM    DCBOPTCD,X'10'          INDEP OVFL OPTION         A31323 04307020
         BZ    APPNSE                  IF NO-BRANCH              A31323 04308020
*      ADJUST DCBRORG2 TO ZERO IF IND OVFL IS FULL              SA53815 04310002
         LH    R13,DCBRORG2             LAST UNFILLED IOV TRK?  SA53815 04310402
*                                                                       04310502
         LTR   R13,R13                  ANY IND OVRFLOW TRKS    SA65051 04310602
         BZ    APPNSD                   BRANCH IF NO            SA65051 04310702
         BCT   R13,APPRVXCP             NO - BR TO READ BLOCK   SA53815 04310802
*                                       YES - CONTINUE          SA53815 04311202
APPNSD   IC    R13,DCBLIOV+7            GET LIOV (REC NO.)      SA65051 04311602
         LA    R13,1(R13)               BUMP REC NO.            SA53815 04311702
         SR    R12,R12                  CLEAR REG               SA53815 04311802
         IC    R12,DCBHIIOV             GET HIGHEST REC. NO.    SA53815 04311902
         CLR   R13,R12                  LIOV+EOF FILLS LAST TRK SA53815 04313402
         BNE   APPRVXCP                 NO - BR TO READ BLOCK   SA53815 04315402
*                                       YES - CONTINUE          SA53815 04315802
         SR    R13,R13                  REDUCE NUMBER OF -      SA53815 04315902
         STH   R13,DCBRORG2             IND OVFL TRKS TO ZERO   SA53815 04316202
APPNSE   CLC   IOBDADAD(7),DCBLPDA      ON LAST TRK OF DATA SET  A31323 04317002
         BNE   APPNSG                   NO, BRANCH               A31323 04317502
         TM    DCBST,X'03'              IS LAST TRACK FULL       A31323 04319002
         BNO   APPRVXCP                 NO, BR--SPACE IS AVAIL   A31323 04320502
APPNSG   TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN  A31323 04322002
         BO    APPNSI                   YES, BR--RD LAST BLK TO  A31323 04323502
*                                                                       04325002
*        CHECK FOR DELETED RECORDS.  OTHERWISE, SET NO SPACE FND        04326502
*                                                                       04328002
         OI    DECBEXC1,X'20'           THEN READ DESIRED BLK    A31323 04329502
         B     APPRVXCP                 TO CHECK FOR DUP REC.    A31323 04331002
APPNSI   OI    IOBINDCT,LASTIND         WILL CHECK LAST RECORD   A31323 04332502
         L     R12,DCBWKPT2             RESTORE WORK AREA BASE   A31323 04334002
         USING IHADCW,R12                                        A31323 04335502
         MVC   IOBDADAD+7(1),DCWHIRPS   SET R TO LAST ON TRK     A31323 04337002
         B     APPRVXCP                 CHK RECORD FOR DELETION  A31323 04338502
APPNOB3  TM    DECBEXC1,NOSPACE         OUT OF SPACE?           SA59778 04338902
         BO    APPN3B1                  YES, GO ASYN RETURN     SA59778 04339302
APPN3B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           04340000
APPN3B1  EQU   *                        *                        Y02072 04346002
APPN3B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  04360000
APPN3B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 04380002
APPN3B6  LA    R13,CB8A+EIGHT           DID CP STOP AT CB8A      S20201 04442020
         CLR   R12,R13                  COMPARE REGS             S20201 04444020
         BNE   APPN3B3                  NO, UNREACHABLE BLOCK    S20201 04446020
         TM    CB11+SEVEN,OFLOW+DUMMY   OFLO, INACTIVE, OR DUMMY S20201 04448020
         BNZ   APPN3F3                  YES, GO TO FILE PROTECT  S20201 04450020
         MVC   CB23+THREE(FOUR),CB11+TWO  SET UP CCHH            S20201 04452020
         MVI   CB23+SEVEN,ONE           SET R EQUAL TO 1         S20201 04454020
         B     APPN3C2D                 GO READ RECORD           S20201 04456020
         EJECT                                                          04460000
*              ABNORMAL END CP8,    APPENDAGE CODE  8,         CHART N3 04480000
APPN3E2  EQU   *                                                  19374 04500000
         TM    IOBSENSE+1,X'04'         WAS ABEND DUE TO          15924 04520016
*                                       FILE PROTECT              15924 04530016
         BO    APPN3F2                  YES--BRANCH               19374 04540000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 04550000
         BC    PERRYES,APPN3B3          YES--BRANCH               19374 04560000
         B     APPRVNOR                 NO--RETRY CHANNEL PGM     19374 04570000
APPN3F2  LA    R13,CB12+8               DID CHAN PROG STOP AT CB12      04600000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      04620000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      04640000
APPN3F3  TM    CB11+SEVEN,OFLOW         WAS OFLO TRK IX ENTRY RD S20201 04680020
         BZ    APPN3G3                  BZ IF NO                        04760000
         TM    CB11+SEVEN,DUMMY         DUMMY OR INACTIVE        S20201 04780020
         BO    APPN3G3                  BO IF NO                        04800000
         MVC   CJ11(7),IOBDADAD        SAVE TRACK IX MBBCCHH            04820000
         MVI   IOBAPP,X'10'             SET APPENDAGE CODE TO 16        04840000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          04860000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            04880000
         LA    R13,CJ1                  START AT CJ1                    04900000
         ST    R13,IOBSTART-1                                           04920000
         MVC   IOBDADAD,CB10+7          PUT CB10 MBBCCHHR IN IOB        04940000
         LA    R13,IOBDADAD+3           PUT SEEK ADDRESS IN CJ1 AND CJ5 04980000
         IC    R9,CJ1                                                   05000000
         ST    R13,CJ1                                                  05020000
         STC   R9,CJ1                                                   05040000
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 05050020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 05060020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 05070020
         L     R12,DCBWKPT2             SET ON FIRST TIME ONLY SWITCH   05140000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 05150020
         OI    DCWWKNI,X'40'                                            05160000
         LA    R12,0(R0,R0)             IS FIRST OFLO ON SAME MODULE    05180000
         IC    R12,CB10+7                      GET M OF OFLO ENTRY      05200000
         SLL   R12,4(R0)                       MULT BY 16               05220000
         L     R12,32(R12,R3)                  LOAD UCB ADDR FROM DEB   05240000
         LA    R12,0(R0,R12)                   COMP WITH UCB AD IN 7    05260000
         CR    R12,R7                                                   05280000
         BE    APPRVXCP                 SAME MODULE - EXCP RTRN TO IOS  05300000
         MVI   IOBASYN,X'01'            DIFFERENT MODULE - MUST EXCP    05320000
         B     APPN3B5                   IN ASYNCHRONOUS ROUTINE        05340000
APPN3A3  TM    IOBCSW+5,X'40'           DID CHAN PROG HAVE LENGTH ERROR 05360000
         BZ    APPN3B6                  GO TEST FOR SPECIAL CASE S20201 05380020
         TM    CB11+7,X'30'             WAS ENTRY INACTIVE              05400000
         BO    APPN3B3                  BO IF YES                       05420000
APPN3G3  TM    CB11+7,X'20'             VERIFY ADD-TO-END SITUATION     05440000
         BZ    APPN3B3                  BZ IF DUMMY OR INACTIVE         05460000
         CLI   DCBNLEV,X'00'            ERROR IF 2 OR MORE INDEX LEVELS 05480000
         BNE   APPN3B3                  BNE IF MORE THAN 1 INDEX LEVEL  05500000
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         05520000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   05540000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 05550020
         BO    APPN3G33                 BO IF SHARED                    05560000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         05580000
         B     APPN3G5                                                  05600000
APPN3G33 MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         05620000
APPN3G5  MVI   IOBAPP,X'0E'             SET APPENDAGE CODE TO 14        05640000
         MVC   IOBDADAD(3),DCBLPDA      SEEK TO DCBLETI'S CYLINDER      05660000
         MVC   IOBDADAD+3(4),DCBLETI   CCHH TO IOB                      05680000
         OC    IOBDADAD+6(1),DCBFIRSH+3   MASK OUT TRACK                05700000
         XC    IOBDADAD+6(1),DCBFIRSH+3 VALUE-REDUCE TO CYL BOUNDRY     05720000
         MVI   IOBDADAD+7,X'00'        R=0                              05740000
         LA    R12,CI1                  START AT CI1                    05760000
         IC    R9,IOBSIOCC                                              05780000
         ST    R12,IOBSTART-1                                           05800000
         STC   R9,IOBSIOCC                                              05820000
         NI    IOBFLAG1,X'7F'           DON'T USE DATA CHAINING         05840000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            05860000
         LA    R12,IOBDADAD+3           PUT SEEK ADDRESS IN CI1         05880000
         IC    R9,CI1                                                   05900000
         ST    R12,CI1                                                  05920000
         STC   R9,CI1                                                   05940000
         MVC   CI5+TWO(FIVE),DCBLETI    PUT DCBLETI CCHHR IN CI5 S20201 05950020
         MVC   CI5(TWO),DCBLPDA+ONE     MOVE IN BB FOR HEAD SEEK S20201 05960020
         B     APPRVXCP                 GO EXCP REQUEST          S20201 05980020
         EJECT                                                          06000000
*              CHANNEL  END CP11A,  APPENDAGE CODE 20,         CHART D1 06020000
APPD1B2  LA    R13,CC2A+8              DID CP STOP AT CP2A              06040000
         CLR   R12,R13                                                  06060000
         BE    APPD1B3                  YES                             06080000
         LA    R13,CC3+8                DID CHAN PROG STOP AT CC3       06100000
         CLR   R12,R13                                                  06120000
         BNE   APPN3B3                  NO                              06140000
APPD1B3  L     R12,DCBWKPT2                                             06160000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 06170020
         TM    DCWWKNI,X'10'            WAS CP11A USED FOR ADD-TO-END   06180000
         BO    APPD1A4                  BO IF YES                       06200000
         TM    DCWWKNI,X'04'                                            06220000
         BO    APPD1D2                  BO FIRST TIME THROUGH           06240000
         TM    IOBCSW+4,X'01'           DID CHAN PROG END WITH EOF      06260000
         BZ    APPD1H2                  BZ IF NO                        06280000
         TM    DCBST,X'02'              IS LAST BLOCK FULL              06300000
         BO    APPD1D4                  BO IF YES                       06320000
         L     R12,DCBMSWA              POINT TO W                      06340000
         AH    R12,CC6+6                POINT TO W+IL+AL                06360000
         SH    R12,DCBLRECL             POINT TO W+IL+AL-RL             06380000
         BAL   R13,APPPAD10             IS IT PADDING                   06400000
         B     APPN3B4                  YES - SCHEDULE COMPLETION       06420000
         OI    DCBST,X'02'              NO - SET ON LAST BLOCK FULL SW  06440000
         B     APPN3B4                                                  06460000
*        REGISTERS  3 AND 10 MUST NOW BE DESTROYED                      06480000
APPD1A4  L     R12,CC3                  SEND ADDRESS = W + IL + RL      06500000
         LA    R12,0(R0,R12)                                            06520000
         LR    R13,R12                                                  06540000
         SH    R13,DCBLRECL             RCV  ADDRESS = W + IL           06560000
APPD1A42 BAL   R3,APPMOV10              MOVE RECORD DOWN 1 SLOT         06580000
*                                                                       06580402
*                       GIVE UNREACHABLE BLOCK CONDITION IF NO KEY      06581018
*                       IN BLOCK READ IS HIGHER THAN KEY TO BE          06582018
*                       ADDED                                           06583018
*                                                                       06583402
         L     R10,IOBCCWAD             GET CP ADDRESS AGAIN      24080 06584018
         L     R3,CC3                   ADDRESS OF BLOCK READ     24080 06585018
         LA    R3,0(0,R3)                                         24080 06586018
         AH    R3,DCBBLKSI              ADDRESS OF END OF BLOCK   24080 06587018
         CR    R12,R3                   NEXT LRECL TO BE MOVED VS 24080 06588018
*                                       END OF BLOCK                    06589018
         BNL   APPN3B3                  BRANCH IF BEYOND END     A31323 06594020
         LH    R3,DCBRKP                POINT TO SEND   AREA'S KEY      06600000
         AR    R3,R12                                                   06620000
         L     R10,DECBKEY                                              06640000
         LA    R10,0(R0,R10)            POINT TO INSERT AREA'S KEY      06660000
         IC    R9,DCBKEYLE                                              06680000
         BCTR  R9,R0                    COMPARE KEYLE BYTES             06700000
         EX    R9,APPD1A44              IS SEND AREA PADDING            06720000
         BH    APPD1A42                 BH IF NO, TO LOOP               06740000
         L     R12,DECBAREA                                             06760000
         LA    R12,16(R0,R12)           SEND ADDRESS = AREA + 16        06780000
         BAL   R3,APPMOV10              MOVE NEW RECORD INTO BLOCK      06800000
         L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 06820002
         L     R10,IOBCCWAD             RESTORE CP8 POINTER             06860000
         L     R12,DECBKEY                                              06880000
         LA    R12,0(R0,R12)            POINT TO INSERT AREA'S KEY      06900000
         L     R13,DCBMSWA              POINT TO BLOCK  AREA'S KEY      06920000
         IC    R9,DCBKEYLE                                              06940000
         BCTR  R9,R0                    MOVE KEYLE BYTES                06960000
         EX    R9,APPD1B52              MOVE INSERT KEY TO BLOCK KEY    06980000
         B     APPD1H5                                                  07000000
APPD1A44 CLC   0(0,R10),0(R3)           INSERT KEY VS. SEND KEY         07020000
APPD1B52 MVC   0(0,R13),0(R12)          INSERT KEY TO BLOCK KEY         07040000
APPD1D2  L     R13,CC3                  GET ADDR OF BLOCK READ   A31323 07042020
         LA    R13,0(R0,R13)            CLEAR HIGH BYTE          A31323 07044020
         AH    R13,DCBBLKSI             POINT TO END OF BLOCK    A31323 07046020
         SH    R13,DCBLRECL             POINT TO LAST RECORD     A31323 07048020
         TM    IOBINDCT,LASTIND         WAS THE LAST BLK RD      A31323 07050020
         BZ    APPD1D3                  NO, BRANCH TO CONTINUE   A31323 07052020
         NI    IOBINDCT,X'FF'-LASTIND   TURN OFF BIT             A31323 07054020
         CLI   0(R13),X'FF'             IS THIS RECORD DELETED   A31323 07056020
         BNE   APPN4B50                 NO, BR--SPACE NOT AVAIL  A31323 07058020
         BAL   R13,COMPLDT              YES, SPACE MAY BE AVAIL  A31323 07060020
*                                                                       07060402
*        RETURN HERE IF RECORD MUST BE BUMPED.  RETURN HERE + 4         07062020
*        (AFTER THE NEXT INSTRUCTION) IF RECORD NEED NOT GO INTO        07064020
*        OVERFLOW.                                                      07066020
*                                                                       07066402
APPN4B50 OI    DECBEXC1,X'20'           SPACE IS NOT AVAILABLE   A31323 07068020
APPD1E3  CLC   DCWHIRPS(1),CB23+7       IS THIS THE DESIRED BLK  A31323 07070020
         BE    APPD1D2                  YES, BRANCH              A31323 07072020
         MVC   IOBDADAD+7(1),CB23+7     NO, SEEK TO CORRECT BLK  A31323 07074020
         B     APPRVXCP                 GO READ IT IN            A31323 07076020
APPD1D3  NI    DCWWKNI,X'FB'            SET OFF FIRST TIME SW    A31323 07078020
         SH    R13,DCBBLKSI             RESTORE REG 13           A31323 07082020
         LR    R12,R13                                           A31323 07086020
         AH    R12,DCBLRECL                                      A31323 07090020
*                                                                       07092002
*        SEND ADDRESS (R12) IS W + LRECL + KL.                          07094020
*        RECEIVE ADDRESS (R13) IS W + KL.                               07104020
*                                                                       07154002
APPD1E2  LH    R3,DCBRKP                POINT TO SEND   AREA'S KEY      07160000
         AR    R3,R12                                                   07180000
         L     R10,DECBKEY                                              07200000
         LA    R10,0(R0,R10)            POINT TO INSERT AREA'S KEY      07220000
         IC    R9,DCBKEYLE                                              07240000
         BCTR  R9,R0                    COMPARE KEYLE BYTES             07260000
         EX    R9,APPD1A44              UPDATE, INSERT, OR LOOP         07280000
         BL    APPD1F2                  INSERT                          07300000
         BE    APPD1E1                  UPDATE                          07320000
*                                                                       07332002
         BAL   R3,APPMOV10              MOVE RECORD                     07340000
*                                                                       07340402
*                       GIVE UNREACHABLE BLOCK CONDITION IF NO KEY      07341018
*                       IN BLOCK READ IS HIGHER THAN KEY TO BE          07342018
*                       ADDED                                           07343018
*                                                                       07343402
         L     R10,IOBCCWAD             GET CP ADDRESS AGAIN      24080 07344018
         L     R3,CC3                   ADDRESS OF BLOCK READ     24080 07345018
         LA    R3,0(0,R3)                                         24080 07346018
         AH    R3,DCBBLKSI              ADDRESS OF END OF BLOCK   24080 07347018
         CR    R12,R3                   NEXT LRECL TO BE MOVED VS 24080 07348018
*                                       END OF BLOCK                    07349018
         BNL   APPNOB3                  BRANCH IF BEYOND END    SA59778 07354002
         B     APPD1E2                  CHECK AGAIN                     07360000
APPD1F2  TM    DECBEXC1,X'20'           WAS NO SPACE AVAIL       A31323 07370020
         BO    APPN3B1                  YES, POST REQ IN ERROR   A31323 07380020
         L     R12,DECBAREA                                      A31323 07390020
         LA    R12,16(R0,R12)           SEND ADDRESS = AREA + 16        07400000
         BAL   R3,APPMOV10              MOVE AREA + 16 INTO BLOCK       07420000
         L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 07440002
         L     R10,IOBCCWAD             RESTORE CP8 POINTER             07480000
         NI    CC5+4,X'7F'              SET OFF REPL-OF-DEL FLAG        07500000
APPD1H2  CLC   IOBDADAD,DCBLPDA         WAS THE SEEK TO LAST RCD        07520000
         BNE   APPD1J3                  BNE IF NO                       07540000
         TM    DCBST,X'02'              IS LAST BLOCK FULL              07560000
         BO    APPD1J3                  BRANCH IF YES                   07580000
APPD1H5  L     R12,DCBNREC           H5 ADD 1 TO NUMBER OF PRIME DATA   07600000
         LA    R12,1(0,R12)              RECORDS - A LOGICAL RECORD     07620000
         ST    R12,DCBNREC               WILL REPLACE A PADDING RECORD. 07640000
         B     APPD1J4                                                  07660000
APPD1J3  L     R13,DCBMSWA              POINT TO BLOCK'S KEY            07680000
         LR    R12,R13                                                  07700000
         AH    R12,CC6+6                                                07720000
         SH    R12,DCBLRECL                                             07740000
         AH    R12,DCBRKP               POINT TO NEXT-TO-LAST KEY       07760000
         IC    R9,DCBKEYLE                                              07780000
         BCTR  R9,R0                    MOVE KEYLE BYTES                07800000
         EX    R9,APPD1B52              KEY OF NEXT-TO-LAST TO BLOCK'S  07820000
APPD1J4  LA    R12,CC4                  START AT CC4                    07840000
         ST    R12,IOBSTART-1                                           07860000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          07880000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            07900000
         MVI   IOBAPP,X'15'             SET APPENDAGE CODE TO 21        07920000
         MVC   CC6A+1(3),CC4+1          PUT IOB ADDRESS IN CC6A         07940000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               07960000
         B     APPRVXCP                 EXCP RETURN TO IOS              07980000
APPD1E1  TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         08000000
         BO    APPD1F1                  BO IF YES                       08020000
APPD1D1  OI    DECBEXC1,X'01'           RECORD IS A DUPLICATE           08040000
         B     APPN3B1                  SCHEDULE COMPLETION      A31323 08070020
APPD1F1  CLI   0(R12),X'FF'             IS RECORD IN BLOCK DELETED      08100000
         BNE   APPD1D1                  BNE IF NO                       08120000
         NI    DECBEXC1,X'DF'                                    A38857 08130020
         L     R12,DECBAREA                                             08140000
         LA    R12,16(R0,R12)           SEND ADDRESS = AREA +16         08160000
APPD1H1  BAL   R3,APPMOV10              MOVE AREA + 16 INTO BLOCK       08180000
         L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 08200002
         L     R10,IOBCCWAD             RESTORE CCW POINTER             08240000
         L     R12,DCBMSWA                                              08260000
         AH    R12,CC6+6                POINTER TO LAST RECORD          08280000
         CLR   R12,R13                  HAS IT BEEN FILLED              08300000
         BE    APPD1J1                  BE IF YES                       08320000
         LR    R12,R13                                                  08340000
         AH    R12,DCBLRECL             RE-CREATE SEND POINTER          08360000
         B     APPD1H1                  MOVE UNTIL BLOCK IS DONE        08380000
APPD1J1  OI    CC5+4,X'80'              SET ON REPL-OF-DEL FLAG         08400000
         B     APPD1H2                                                  08420000
APPD1D4  L     R12,CC3                                                  08440000
         LA    R12,0(R0,R12)            START PADDING AT 2D RECORD      08460000
         L     R13,DCBMSWA                                              08480000
         AH    R13,CC6+6                STOP AT LAST RECORD             08500000
         CLR   R12,R13                  IS PADDING NECESSARY      12244 08506016
         BE    APPD1D5                  NO--BRANCH (1 REC/BLOCK)  12244 08512016
APPD1D42 MVI   0(R12),X'FF'             PAD BLOCK REMAINDER             08520000
         LA    R12,1(R0,R12)            INCREMENT INDEX                 08540000
         CLR   R12,R13                                                  08560000
         BL    APPD1D42                 BL IF LOOP COMPLETE             08580000
         NI    DCBST,X'FD'              LAST BLOCK NOT FULL       12244 08586016
APPD1D5  EQU   *                                                  12244 08592016
         L     R13,DCBMSWA              POINT TO BLOCK'S KEY            08600000
         LR    R12,R13                                                  08620000
         IC    R9,DCBKEYLE                                              08640000
         AR    R12,R9                                                   08660000
         AH    R12,DCBRKP               POINT TO FIRST KEY              08680000
         BCTR  R9,R0                    MOVE KEYLE BYTES                08700000
         EX    R9,APPD1B52              MOVE FIRST KEY TO BLOCK'S KEY   08720000
         LA    R12,CB46                 START AT CB46                   08760000
         ST    R12,IOBSTART-1                                           08780000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   08800000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CB46         08820000
         STH   R12,CB46+2                                               08840000
         SRL   R12,16                                                   08860000
         STC   R12,CB46+1                                               08880000
         MVC   CB49+1(3),DCBMSWA+1      PUT KEY ADDRESS IN CB49         08900000
         L     R12,DCBMSWA                                              08920000
         AH    R12,CC2A+6                                               08940000
         ST    R12,CB50                 PUT DATA ADDRESS IN CB50        08960000
         MVC   CB51(5),IOBDADAD+3       PUT IOB CCHHR IN CB51           08980000
         IC    R9,IOBDADAD+7             DECREASING R IN IOB BY 1       09000000
         BCTR  R9,R0                                                    09020000
         STC   R9,IOBDADAD+7                                            09040000
         MVC   CB50A+1(3),CB46+1        PUT IOB ADDRESS IN CB50A        09060000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               09080000
         MVI   IOBAPP,X'09'             SET APPENDAGE TO 9              09100000
         B     APPRVXCP                 EXCP RETURN TO IOS              09120000
         EJECT                                                          09140000
*              TEST FOR PADDING SUBROUTINE                              09160000
*                                                                       09170002
* ENTRY  LA    12,FIRSTPOS    FIRSTPOS = LOGICAL RECORD FIRST BYTE      09180000
*        BAL   13,APPPAD10                                              09200000
*                                                                       09210002
* DESTROYS     REGISTERS 9 (ONE BYTE), 12, 13 DESTRUCTIVELY             09220000
*              REGISTER 11, BUT RESTORES IT TO IOBECBAD                 09240000
*                                                                       09250002
* RETURNS      TO BAL INSTRUCTION PLUS FOUR BYTES IF PADDING            09260000
*              TO BAL INSTRUCTION PLUS EIGHT BYTES IF NO                09280000
*                                                                       09290002
APPPAD10 CLI   0(R12),X'FF'             TEST FIRST BYTE FOR ALL ONES    09300000
         BNE   APPPAD40                 NO - NOT A PADDING RECORD       09320000
         LA    R9,255(R0,R0)            PLACE 255 IN REG 9              09340000
         LH    R11,DCBLRECL             PLACE RECORD LENGTH IN REG 11   09360000
         BCTR  R11,R0                   LRECL MINUS ONE COMPARES REQD   09380000
APPPAD20 CLR   R11,R9                   LENGTH REMAINDER MORE THAN 255  09400000
         BNH   APPPAD30                 NO - NO MORE LOOPING            09420000
         CLC   0(255,R12),1(R12)        COMPARE 255 BYTES               09440000
         BNE   APPPAD40                 NOT PADDING                     09460000
         SR    R11,R9                   REDUCE LENGTH REMAINDER BY 255  09480000
         AR    R12,R9                   INCREASE INDEXING BY 255        09500000
         B     APPPAD20                 LOOP                            09520000
APPPAD30 BCTR  R11,R0                   ADJUST FOR MACHINE LANGUAGE     09540000
         EX    R11,APPPAD60             COMPARE 255 OR FEWER BYTES      09560000
         BE    APPPAD50                 PADDING                         09580000
APPPAD40 LA    R13,4(R0,R13)            MODIFY RETURN FOR NOT PADDING   09600000
APPPAD50 L     R11,IOBECBAD             RESTORE REGISTER 11             09620000
         BR    R13                      RETURN                          09640000
APPPAD60 CLC   0(0,R12),1(R12)          EXECUTED COMPARE                09660000
         EJECT                                                          09680000
*              GENERALIZED MOVE OF LOGICAL RECORD SUBROUTINE            09700000
*                                                                       09710002
* ENTRY  LA    12,SENDADDR    SENDADDR = SEND ADDRESS FIRST BYTE        09720000
*        LA    13,RCVADDR     RCVADDR = RECEIVE ADDRESS FIRST BYTE      09740000
*        BAL   3,APPMOV10                                               09760000
*                                                                       09770002
* DESTROYS     REGISTER 9 (ONE BYTE), REGISTERS 3, 10, 12, 13           09780000
*                                                                       09790002
* AT EXIT      REGISTER 3 CONTAINS RETURN ADDR                          09800000
*              REGISTER 9 CONTAINS X'FF' IN LOW-ORDER BYTE              09820000
*              REGISTER 10 CONTAINS A VARIABLE QUANTITY, LESS THAN 256  09840000
*              REGISTER 12 CONTAINS SENDADDR + DCBLRECL                 09860000
*              REGISTER 13 CONTAINS RCVADDR + DCBLRECL                  09880000
*                                                                       09890002
* RETURNS      TO BAL INSTRUCTION PLUS FOUR BYTES                       09900000
*                                                                       09910002
APPMOV10 LA    R9,255(R0,R0)            PLACE 255 IN REG 9              09920000
         LH    R10,DCBLRECL             PLACE RECORD LENGTH IN REG 10   09940000
         BCTR  R10,R0                   MOVE LRECL BYTES                09960000
APPMOV20 CLR   R10,R9                   COMPARE LENGTH REMAINDER TO 255 09980000
         BNH   APPMOV30                 BRANCH LAST TIME                10000000
         MVC   0(255,R13),0(R12)        MOVE 255 BYTES                  10020000
         SR    R10,R9                   REDUCE LENGTH REMAINDER BY 255  10040000
         AR    R12,R9                   INCREASE SEND INDEXING BY 255   10060000
         AR    R13,R9                   INCREASE RCV INDEXING BY 255    10080000
         B     APPMOV20                 LOOP                            10100000
APPMOV30 EX    R10,APPMOV40             MOVE 255 OR FEWER BYTES         10120000
         LA    R12,1(R12,R10)           UPDATE INDEXING BY 255 OR LESS  10140000
         LA    R13,1(R13,R10)           UPDATE INDEXING BY 255 OR LESS  10160000
         BR    R3                       RETURN FROM SUB-ROUTINE         10180000
APPMOV40 MVC   0(0,R13),0(R12)          LENGTH, RCV ADDR, SEND ADDR     10200000
         EJECT                                                          10220000
*              CHANNEL  END CP11BW, APPENDAGE CODE 21,         CHART D2 10240000
APPD2B2  LA    R13,CC6C+8              DID CP STOP AT CC6A              10260000
         CLR   R12,R13                                                  10280000
         BNE   APPN3B3                  NO   N3B3                       10300000
         L     R12,DCBWKPT2             WAS CP11BW USED FOR ADD-TO-END  10320000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 10330020
         TM    DCWWKNI,X'10'                                            10340000
         BO    APPD2A3                  YES  D2                         10360000
         TM    CC5+4,X'80'              WAS REPL OF DELE FLAG ON        10380000
         BO    APPN3B4                  YES  N3B4                       10400000
         CLC   DCWHIRPS,IOBDADAD+7      DOES R IN IOB EQUAL DCWHIRPS    10420000
         BNE   APPD2D3                  NO   D3                         10440000
         CLC   DCBLPDA,IOBDADAD         WAS SEEK TO LAST RCD OF DATASET 10460000
         BE    APPD2F3                  YES  F3                         10480000
APPD2G2  EQU   *                                                  12999 10490016
         TM    DCBOPTCD,X'02'           WAS DELETE OPTION TAKEN         10493016
         BZ    APPD2G3                  NO   G3                         10496016
         LH    R12,CC6+6                IS LAST RCD IN W TO BE DELETED  10499016
         L     R13,DCBMSWA                                              10502016
         AR    R12,R13                                                  10505016
         CLI   0(R12),X'FF'                                             10508016
         BNE   APPD2G3                  NO   G3                         10511016
         BAL   R13,COMPLDT              SEE IF MUST BUMP RECORD  A31323 10571020
         B     APPD2G3                  YES, RETURN HERE         A31323 10631020
*        NO, RETURN HERE                                                10691020
         MVC   IOBDADAD+5(3),CB23       MOVE CB23 CCHHR TO IOB          10780000
         MVI   IOBAPP,X'11'             SET APPENDAGE CODE TO 17        10800000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   10820000
         LA    R12,CK1                  START AT CK1                    10840000
         ST    R12,IOBSTART-1                                           10860000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  10880000
         ST    R12,CK1                                                  10900000
         MVI   CK1,X'31'                                                10920000
         MVC   CK4(4),CK1              MOVE OP CODE AND ID TO CK4       10940000
         L     R12,CC6                  PUT NEXT-TO-LAST RCD'S KEY      10960000
         LA    R12,0(R0,R12)             ADDRESS IN CK6                 10980000
         AH    R12,CC6+6                                                11000000
         AH    R12,DCBRKP                                               11020000
         SH    R12,DCBLRECL                                             11040000
         STH   R12,CK6+2                                                11060000
         SRL   R12,16                                                   11080000
         STC   R12,CK6+1                                                11100000
         MVC   CK7A+1(3),CK1+1          PUT IOB ADDRESS IN CK7A         11120000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               11140000
         B     APPRVXCP                                                 11160000
APPD2A3  L     R12,DCBMSWA              POINT TO NEXT-TO-LAST RCD IN W  11180000
         AH    R12,CC6+6                                                11200000
         SH    R12,DCBLRECL                                             11220000
         BAL   R13,APPPAD10             IS IT PADDING                   11240000
         BE    APPD2A5                  YES - BLOCK IS NOT FULL         11260000
         OI    DCBST,X'02'              SET ON LAST BLOCK FULL SW       11280000
         B     APPD2C1                                                  11300000
APPD2A5  MVI   IOBAPP,X'12'             SET APPENDAGE CODE TO 18        11320000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   11340000
         LA    R12,CK1                  START AT CK1                    11360000
         ST    R12,IOBSTART-1                                           11380000
         MVC   IOBDADAD+3(5),DCBLETI    PUT DCBLETI CCHHR IN IOB        11400000
         MVC   IOBDADAD(3),DCBLPDA                                      11420000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  11440000
         ST    R12,CK1                                                  11460000
         MVI   CK1,X'31'                                                11480000
         MVC   CK4(4),CK1              MOVE OP CODE AND ID TO CK4       11500000
         MVC   CK6+1(3),DECBKEY+1       PUT KEY ADDRESS IN CK6          11520000
         MVC   CK7A+1(3),CK1+1          PUT IOB ADDRESS IN CK7A         11540000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               11560000
         B     APPRVXCP                 EXCP RETURN TO IOS              11580000
APPD2D3  IC    R9,IOBDADAD+7            ADD 1 TO R IN IOB               11600000
         LA    R12,1(R0,R9)                                             11620000
         STC   R12,IOBDADAD+7                                           11640000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          11660000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            11680000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        11700000
         LA    R12,CC1                  START AT CC1                    11720000
         IC    R9,IOBSIOCC                                              11740000
         ST    R12,IOBSTART-1                                           11760000
         STC   R9,IOBSIOCC                                              11780000
         L     R12,DCBMSWA              MOVE LAST LOGICAL RCD TO W+IL   11800000
         AH    R12,CC6+6                                                11820000
         L     R13,DCBMSWA                                              11840000
         IC    R9,DCBKEYLE                                              11860000
         LA    R13,0(R9,R13)                                            11880000
         BAL   R3,APPMOV10                                              11900000
         L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 11920002
         B     APPRVXCP                 EXCP RETURN TO IOS              11960000
APPD2F3  TM    DCBST,X'02'              IS LAST BLOCK FULL              11980000
         BO    APPD2G2                  YES  G2                         12000000
         L     R12,DCBMSWA              TEST NEXT-TO-LAST RCD IN W      12020000
         AH    R12,CC6+6                                                12040000
         SH    R12,DCBLRECL                                             12060000
         BAL   R13,APPPAD10             IS IT PADDING                   12080000
         BE    APPN3B4                  YES - SCHEDULE COMPLETION       12100000
         OI    DCBST,X'03'              SET ON LAST BLK AND TRK FULL SW 12120000
         B     APPN3B4                                                  12140000
APPD2G3  EQU   *                                                 A37184 12170021
         L     R13,DECBAREA                                             12200000
         LA    R13,16(R0,R13)                                           12220000
*                                                                       12220402
         LR    R12,R4                   SAVE DCB ADDRESS         Y02072 12221002
         LR    R3,R14                   SAVE REG FOR IOS RETURN  Y02072 12222002
         L     R4,RQEDEB                ADDR OF CURRENT DEB      Y02072 12223002
         L     R4,0(R4)                 ADDR OF CURRENT TCB      Y02072 12224002
         LR    R8,R15                   SAVE BASE ADDRESS        Y02072 12224402
         LR    R9,R1                    SAVE RQE ADDRESS         Y02072 12224802
         LR    R10,R2                   SAVE IOB ADDRESS         Y02072 12224902
*                                                                       12226802
         SR    R2,R2                    IND. NO RANGE TEST       Y02072 12228802
         LR    R1,R13                   ADDR TO BE VALIDATED     Y02072 12229602
         SPACE 2                                                        12230002
         MODESET  KEYADDR=KEY0,WORKREG=15  SET PROTECTION KEY 0  Y02072 12230402
         SPACE 2                                                        12230802
         L     R15,CVTPTR               CVT ADDRESS              Y02072 12231602
         USING CVT,R15                  CVT ADDRESSABILITY       Y02072 12233402
         L     R15,CVT0VL00             ADDR OF VALIDATION RTN   Y02072 12235302
         DROP  R15                      END USING ON CVT         Y02072 12237202
         SPACE 1                                                        12237602
         BALR  R14,R15                  VALIDATE ADDR            Y02072 12239102
         SPACE 1                                                        12239502
         LR    R1,R9                    RESTORE RQE ADDRESS      Y02072 12239902
         LR    R2,R10                   RESTORE IOB ADDRESS      Y02072 12240302
         LR    R4,R12                   RESTORE DCB ADDRESS      Y02072 12240702
         LR    R14,R3                   RESTORE IOS RETURN ADDR  Y02072 12240802
         LR    R15,R8                   RESTORE BASE ADDRESS AND Y02072 12240902
         USING APP,R15                  MODULE ADDRESSABILITY    Y02072 12242902
         SPACE 2                                                        12243902
         MODESET  KEYADDR=RQEPRT,WORKREG=10      SET USER KEY           12245902
         SPACE 2                                                        12246302
         BZ    OKAREA                   B IF VALID TO CONTINUE   A37184 12253002
         OI    DECBEXC1,X'10'           SET INVALID REQUEST      A37184 12256002
         B     APPN3B1                  BR TO SCHED ASYNC        A37184 12259002
OKAREA   EQU   *                                                 A37184 12262002
         L     R10,IOBCCWAD             ADDRESSABILITY           M0060  12265002
         L     R12,DCBMSWA              MOVE LAST RCD N W TO     A37184 12268002
         AH    R12,CC6+6                   AREA + 16             A37184 12271002
         BAL   R3,APPMOV10                                              12274002
         L     R3,RQEDEB                RESTORE DEB POINTER      Y02072 12277002
         LA    R3,0(R0,R3)                                              12280000
         L     R10,IOBCCWAD             RESTORE CP8 POINTER             12300000
         L     R12,DCBMSWA                                              12320000
         AH    R12,CC6+6                                                12340000
         AH    R12,DCBRKP                                               12360000
         SR    R9,R9                                             A37184 12370021
         IC    R9,DCBKEYLE                                              12380000
         BCTR  R9,R0                    MOVE KEYLE BYTES                12400000
         L     R13,DECBKEY                                              12420000
         EX    R9,APPD2G4A              MOVE NEW KEY                    12440000
         NI    IOBINDCT,X'DF'           OFLO RCD IS IN AREA AND I       12460000
         L     R12,DCBMSWA              PUT KEY ADDRESS IN CH7          12480000
         AH    R12,CC6+6                                                12500000
         AH    R12,DCBRKP                                               12520000
         SH    R12,DCBLRECL                                             12540000
         ST    R12,CH7                                                  12560000
         MVI   CH7,X'0D'                                                12580000
         MVI   IOBASYN,X'09'            SET ASYNCHRONOUS CODE TO 9      12600000
         B     APPN3B5                  SCHEDULE ASYNCHRONOUS ROUTINE   12620000
APPD2C1  L     R12,DCBWKPT2             IS LAST RCD IN LAST SLOT ON TRK 12640000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 12650020
         CLC   DCWHIRPS,DCBLPDA+7                                       12660000
         BNE   APPD2A5                  BNE IF NO                       12680000
         OI    DCBST,X'01'              SET ON LAST TRACK FULL SW       12700000
         B     APPD2A5                                                  12720000
APPD2G4A MVC   0(0,R13),0(R12)          EXECUTED INSTRUCTION            12740000
COMPLDT  IC    R9,DCBHMASK              GET TRACK MASK           A31323 12741020
         SLL   R13,8                    MOVE OVER RETURN ADDR    A31323 12742020
         IC    R13,IOBDADAD+6           PICK UP TRACK BYTE       A31323 12743020
         NR    R9,R13                   MASK OFF TRACK           A31323 12744020
         SRL   R13,8                    RESTORE RETURN ADDR      A31323 12745020
         EX    R9,CLILDT                SEE IF LAST TRK OF CYL   A31323 12746020
         BE    COMPLDT1                 BRANCH IF ON LAST TRACK  A31323 12747020
*                                                                       12747402
*        IF NOT LAST TRACK, CHECK TO SEE IF LAST TRK OF PRIME.          12748020
*                                                                       12748402
         CLC   IOBDADAD(7),DCBLPDA      LAST PRIME DATA TRK      A31323 12749020
         BNE   4(R13)                   NO, DON'T BUMP RECORD    A31323 12750020
COMPLDT1 TM    CB26,X'08'               DOES OVERFLOW IX ENTRY   A31323 12751020
*                                                                       12751402
*        INDICATE THE EXISTENCE OF A CHAIN.                             12752020
*                                                                       12752402
         BO    4(R13)                   YES, NO NEED TO BUMP     A31323 12753020
         BR    R13                      MUST BUMP--NO CHAIN YET  A31323 12754020
CLILDT   CLI   DCBLDT+1,0                                        A31323 12755020
         EJECT                                                          12760000
*              ABNORMAL END CP11A,  APPENDAGE CODE 20,         CHART D3 12780000
APPD3B2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM. ERROR    12800000
         BC    PERRNO,APPRVNOR          NO - NORMAL RETURN TO IOS       12820000
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     12840000
         BZ    APPN3B3                  NO - BRANCH, RECORD UNREACHABLE 12860000
         LA    R13,CC2A+8               DID CHAN PROG STOP AT CC2A      12880000
         CLR   R12,R13                                                  12900000
         BE    APPD3E2                  YES - BRANCH TO E2              12920000
         LA    R13,CC3+8                                                12940000
         CLR   R12,R13                  DID CHAN PROG STOP AT CC3       12960000
         BNE   APPN3B3                  NO - BRANCH, RECORD UNREACHABLE 12980000
APPD3E2  OI    DECBEXC1,X'08'           YES - INDICATE UNCORRECTABLE    13000000
         B     APPN3B4                  I/O ERROR AND BRANCH            13020000
         EJECT                                                          13040000
*              ABNORMAL END CP11BW, APPENDAGE CODE 21,         CHART J8 13060000
APPJ8B2  EQU   *                                                        13070013
         TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     13080013
         BC    PERRNO,APPRVNOR          NO-NORMAL RETURN TO IOS         13090013
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     13100013
         BZ    APPN3B3                  NO- RECORD UNREACHABLE          13110013
         LA    R13,CC6C+8                                               13120000
         CLR   R12,R13                  DID CHAN PROG STOP AT CC6C      13140000
         BE    APPJ8E3                  YES- E3 I/O ERROR               13240013
         LA    R13,CC6+8                DID CHAN PROG STOP AT CC6       13400000
         CLR   R12,R13                                                  13420000
         BNE   APPN3B3                  NO - BRANCH, RECORD UNREACHABLE 13440000
APPJ8E3  OI    DECBEXC1,X'08'           YES - INDICATE UNCORRECTABLE    13460000
         B     APPN3B4                   I/O ERROR AND BRANCH           13480000
         EJECT                                                          13500000
*              CHANNEL  END CP15,   APPENDAGE CODE 14,         CHART M1 13520000
APPM1B2  LA    R13,CI4+8                DID CHAN PROG STOP AT CI4       13540000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      13560000
         BNE   APPM1B3                  NO - RECORD IS UNREACHABLE      13580000
*              SIMULATE CHART D4 SUBROUTINE                             13600000
         L     R12,DCBWKPT2                                             13620000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 13630020
         OI    DCWWKNI,X'10'            SET ADD-TO-END INDICATOR ON     13640000
         TM    DCBHIRSH,X'FF'           IS ADD TO SHARED TRACK    13401 13650016
         BZ    APPM1B2A                 NO BRANCH, YES CK AGAIN   13401 13660016
         CLC   DCBFIRSH+1(1),DCBLPDA+6  ADD TO END OF SHARED TRK  13401 13670016
         BNE   APPM1B2A                 BRANCH IF NOT SHARED      13401 13680016
         MVC   DCWHIRPS(1),DCBHIRSH     MOVE HIRSH TO WORK AREA   13401 13690016
         B     APPM1B2B                                           13401 13700016
APPM1B2A MVC   DCWHIRPS(1),DCBHIRPD     MOVE HIRPD TO WORK AREA   13401 13710016
APPM1B2B EQU   *                                                   7851 13760000
         TM    DCBST,X'02'              IS LAST BLOCK FULL              13780000
         BO    APPD4B3                  BO IF YES                       13800000
         MVC   IOBDADAD+3(5),DCBLPDA+3   PUT LPDA CCHHR IN IOB          13820000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   13840000
         LA    R12,CC1                  START AT CC1                    13860000
         ST    R12,IOBSTART-1                                           13880000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CC1 AND CC4  13900000
         STH   R12,CC1+2                                                13920000
         SRL   R12,16                                                   13940000
         STC   R12,CC1+1                                                13960000
         MVC   CC4+1(3),CC1+1                                           13980000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        14000000
         MVC   CC6A+1(3),CC4+1          PUT IOB ADDRESS IN CC6A         14020000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               14040000
         B     APPRVXCP                 EXCP RETURN TO IOS              14060000
APPD4B3  TM    DCBST,X'01'              IS LAST TRACK FULL              14080000
         BO    APPM1C2                  BO IF YES, TO SET UP CP16       14100000
         L     R13,DCBMSWA              MOVE RCD FROM AREA+16 TO W+IL   14120000
         IC    R9,DCBKEYLE                                              14140000
         LA    R13,0(R9,R13)                                            14160000
         L     R12,DECBAREA                                             14180000
         LA    R12,16(R0,R12)                                           14200000
*              SIMULATE GENERALIZED MOVE SUBROUTINE                     14220000
         LA    R9,255(R0,R0)            PLACE 255 IN IR 9               14240000
         LH    R10,DCBLRECL             RCD LGTH IN IR 10               14260000
         BCTR  R10,R0                   LRECL MOVES REQD                14280000
APPD4B3B CLR   R10,R9                   LGTH REMAINDER MORE THAN 255    14300000
         BNH   APPD4B3C                 BRANCH LAST TIME                14320000
         MVC   0(255,R13),0(R12)        MOVE 255 CHS                    14340000
         SR    R10,R9                   REDUCE LGTH REMAINDER BY 255    14360000
         AR    R12,R9                   INCREASE INDEXING BY 255        14380000
         AR    R13,R9                                                   14400000
         B     APPD4B3B                 LOOP                            14420000
APPD4B3C EX    R10,APPD4B3D             MOVE 255 OR FEWER BYTES         14440000
APPD4B3D MVC   0(0,R13),0(R12)          EXECUTED MOVE                   14460000
         L     R12,DCBMSWA              FORM PADDING RECORDS            14480000
         IC    R9,DCBKEYLE                                              14500000
         LA    R12,0(R9,R12)                                            14520000
         LR    R10,R12                                                  14540000
         AH    R12,DCBLRECL                                             14560000
         AH    R10,DCBBLKSI                                             14580000
         CLR   R10,R12                  IS PADDING NECESSARY      12244 14586016
         BE    APPD4B3E                 NO--BRANCH (1 REC/BLOCK)  12244 14592016
APPD4B3A MVI   0(R12),X'FF'                                             14600000
         LA    R12,1(R0,R12)                                            14620000
         CLR   R12,R10                                                  14640000
         BL    APPD4B3A                                                 14660000
         NI    DCBST,X'FD'              LAST BLOCK NOT FULL       12244 14666016
APPD4B3E EQU   *                                                  12244 14672016
         L     R10,IOBCCWAD             RESTORE CP8 POINTER             14680000
         MVI   IOBAPP,X'17'             SET APPENDAGE CODE TO 23        14700000
         MVC   IOBDADAD+3(5),DCBLPDA+3   PUT LPDA CCHHR IN IOB          14740000
         MVC   CB51(4),IOBDADAD+3       MOVE DCBLPDA CCHHR TO CB51      14760000
         IC    R12,IOBDADAD+7            THEN INCREASE CB51 R BY 1      14780000
         LA    R12,1(R0,R12)                                            14800000
         STC   R12,CB51+4                                               14820000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   14840000
         LA    R12,CB46                 START AT CB46                   14860000
         ST    R12,IOBSTART-1                                           14880000
         LA    R12,IOBDADAD+3           MOVE IOB ADDRESS TO CB46        14900000
         STH   R12,CB46+2                                               14920000
         SRL   R12,16                                                   14940000
         STC   R12,CB46+1                                               14960000
         MVC   CB49+1(3),DECBKEY+1      MOVE KEY  ADDRESS TO CB49       14980000
         L     R12,DCBMSWA                                              15000000
         IC    R9,DCBKEYLE                                              15020000
         LA    R12,0(R9,R12)                                            15040000
         ST    R12,CB50                 MOVE DATA ADDRESS TO CB50       15060000
         MVC   CB50A+1(3),CB46+1        MOVE IOB ADDRESS TO CB50A       15080000
         MVI   IOBCOUNT,X'0A'           SET COUNTER TO 10               15100000
         B     APPRVXCP                 EXCP RETURN TO IOS              15120000
APPM1C2  EQU   *                                                        15140000
         TM    CB26,X'08'               WAS ENTRY READ IN CB25 OFLO END 15160000
         BZ    APPM1D3                  YES  M1D3                       15180000
         MVC   IOBDADAD,CB25            MOVE CB25 MBBCCHHR TO IOB       15200000
         MVI   IOBAPP,X'0F'             SET APPENDAGE CODE TO 15        15220000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          15240000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            15260000
         LA    R12,CJ1                  START AT CJ1                    15280000
         ST    R12,IOBSTART-1                                           15300000
         LA    R12,IOBDADAD+3           MOVE IOB ADDRESS TO CJ1 AND CJ5 15320000
         ST    R12,CJ1                                                  15340000
         MVI   CJ1,SIDEQ                RESTORE COMMAND CODE     S20201 15350020
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 15360020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 15370020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 15380020
         LA    R12,0(R0,R0)             CMP TRK INDEX AND OFLO RCD MODL 15480000
         IC    R12,CB25                  ARE THEY THE SAME              15500000
         SLL   R12,4(R0)                                                15520000
         L     R12,32(R3,R12)                                           15540000
         LA    R12,0(R0,R12)                                            15560000
         CLR   R12,R7                                                   15580000
         BE    APPRVXCP                 YES - EXCP RETURN TO IOS        15600000
         MVI   IOBASYN,X'01'                                            15620000
         B     APPM1D4                  EXCP IN ASYNCHRONOUS ROUTINE    15640000
APPM1D3  MVI   IOBASYN,X'0A'            SET ASYNCHRONOUS CODE TO 10     15660000
APPM1D4  NI    IOBINDCT,X'DF'           INDICATE OFLO RECORD IN AREA    15680000
         B     APPM1B5                  SCHEDULE ASYNCHRONOUS ROUTINE   15700000
APPM1B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           15720000
APPM1B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  15740000
APPM1B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 15760002
APPN3B21 LA    R13,APPN3B2                                              15840000
         BC    15,APPN3B22                                              15860000
APPM1B21 LA    R13,APPM1B2                                              15880000
APPN3B22 BR    R13                      NULL ROUTINE             Y02072 15900002
APPRVXCP SR    R12,R12                                                  16040000
         IC    R12,IOBDADAD             GET M                           16060000
         SLL   R12,4                    M X 16                          16080000
         LA    R12,32(R3,R12)           R12 POINTS TO EXTENT            16100000
         MVC   IOBDADAD+1(2),4(R12)     MOVE BB INTO IOB                16120000
         LA    R14,EXCP(R14)            SETUP FOR EXCP IOS RETURN 15924 16125016
         XC    IOBFLAG2(3),IOBFLAG2     CLEAR FLAG2,SENSE BYTES   15924 16130016
         XC    IOBCSW(9),IOBCSW         CLEAR FLAG3,CSW,AND SIOCC 15924 16135016
         XC    IOBERRCT(2),IOBERRCT     CLEAR ERROR COUNT         15924 16140016
         NI    IOBFLAG1,X'C2'           RESET FLAG1               15924 16145016
APPRVNOR BR    R14                      RETURN TO IOS             15924 16150016
         EJECT                                                          16160000
*              ABNORMAL END CP15,   APPENDAGE CODE 14,         CHART M1 16180000
APPM1J2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     16200000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       16220000
         B     APPM1B3                  YES  M1B3                       16240000
*                                                                       16250002
MODID    DC    C'IGG019G5'              MODULE NAME            @ZA26522 16250537
DATE     DC    CL8'&SYSDATE'            FIX DATE               @ZA26522 16251037
FIX      DC    C' OZ26522'              LATEST FIX             @ZA26522 16251537
PATCH    DC    XL((*-IGG019G5)/20)'00'  ZEROED PATCH AREA        Y02072 16252002
*                                                                       16254002
         EJECT                                                          16260000
RQE      IECDRQE ,                      RQE                      Y02072 16270002
         EJECT                                                          16280002
LASTIND  EQU   X'02'       LAST BLK READ TO CHK FOR DELETES      A31323 16310020
*                             RETURN TO IOS VECTOR TABLE                16320000
CVT      DSECT                                                          16440000
         CVT                                                            16460021
IHAPART2 DSECT                                 PART2 VECTOR      A37184 16480021
*                                       TABLE                    A37184 16500021
*        ROUTINE FOR          CODE      CEND COMPLETION OF              16520000
APPM67CE DS    CL6            7         CP1 OR CP2, WRITE KN            16540000
APPN7B2  DS    CL6            9,23      CP10AW                          16560000
APPN8A2  DS    CL6            10,11     CP10BW                          16580000
APPM4A2  DS    CL6            12        CP14W - SETUPS 1, 2, OR 5       16600000
APPM5A2  DS    CL6            13        CP14W - SET UPS 3, 4, OR 6      16620000
APPM2B2  DS    CL6            15        CP16 - SITUATION 2              16640000
APPM3B2  DS    CL6            16        CP16 - SITUATION 3              16660000
APPN9A2  DS    CL6            17,18,19  CP17W                           16680000
         DS    CL6                                                17332 16690018
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              16700000
APPM67AE DS    CL6            7         CP1 OR CP2, WRITE KN            16720000
APPJ3B2  DS    CL6            9,23      CP10AW                          16740000
APPJ4B2  DS    CL6            10,11     CP10BW                          16760000
APPJ5B2  DS    CL6            12        CP14W -SETUPS 1, 2, OR 5        16780000
APPJ6B2  DS    CL6            13        CP14W -SETUPS 3, 4, OR 6        16800000
APPM2H2  DS    CL6            15,16     CP16                            16820000
APPJ7B2  DS    CL6            17,18,19  CP17W                           16840000
         DS    CL6                                                17332 16850018
APPN7A3  DS    CL4            CONTINUATION OF ROUTINES BEGUN IN         16860000
APPN7B4  DS    CL4                 PART 1                               16880000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              16900000
APPABA2  DS    CL6            0,1       CP4/CP5                         16920000
APPADB2  DS    CL6            2         CP7W                            16940000
APPAAB2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     16960000
APPACA2  DS    CL6            5         CP6W                            16980000
APPAHB2  DS    CL6            6         CP4/CP5W, WRITE CHECK           17000000
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              17020000
APPABD2  DS    CL6            0,1       CP4/CP5W                        17040000
APPAIB2  DS    CL6            2         CP7W                            17060000
APPAAA2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     17080000
APPACE2  DS    CL6            5         CP6W                            17100000
APPAHD2  DS    CL6            6         CP4/CP5W, WRITE CHECK           17120000
         EJECT                                                          17140000
*        WRITE KEY NEW CHANNEL PROGRAM REFERENCES (WRITE CHECK)         17240020
IHAWKNCP IGGWKNCP  OPTCD=W                                       S20201 17540020
         IGGCP11A                                                       17940020
         IGGCP11B  OPTCD=W                                       S20201 18440020
         EJECT                                                          20260000
*              DATA EVENT CONTROL BLOCK                                 20280000
IHADECB  DSECT                                                          20300000
         DS    0F                                                       20320000
DECBECB  DS    CL4                      EVENT CONTROL BLOCK (ECB)       20340000
DECBTYP1 DS    BL1                      TYPE B6 - 1 IF LENGTH IS S      20360000
*                                            B7 - 1 IF AREA IS S        20380000
DECBTYP2 DS    BL1                           B0 - 1 IF READ K           20400000
*                                            B1 - 1 IF READ KX          20420000
*                                            B2 - 1 IF READ KU          20440000
*                                            B4 - 1 IF WRITE K          20460000
*                                            B5 - 1 IF WRITE KN         20480000
DECBLGTH DS    CL2                      LENGTH OF BLOCK                 20500000
DECBDCBA DS    A                        POINTER TO DCB                  20520000
DECBAREA DS    A                        ADDRESS OF AREA                 20540000
DECBLOGR DS    A                        POINTER TO LOGICAL RECORD       20560000
DECBKEY  DS    A                        POINTER TO KEY                  20580000
DECBEXC1 DS    BL1                      EXCPTN CD B0-RECORD NOT FOUND   20600000
*                                                 B1-RECORD LGTH CHK    20620000
*                                                 B2-NO SPACE           20640000
*                                                 B3-INVALID REQUEST    20660000
*                                                 B4-UNCORRECTABLE IO   20680000
*                                                 B5-UNREACHABLE BLOCK  20700000
*                                                 B6-OVERFLOW RECORD    20720000
*                                                 B7-DUPLICATE          20740000
DECBEXC2 DS    BL1                                B7-READ KU            20760000
         EJECT                                                          20780000
         DCBD  DSORG=(IS)                                               20800000
         EJECT                                                          20820000
IHAIOB   IGGIOBD                                                        20920020
         EJECT                                                          22140000
IHADCW   IGGBISAM                                                       22200020
         EJECT                                                          22680000
IHADEB   IGGDEBD                                                        22740020
         END                                                            23579900
