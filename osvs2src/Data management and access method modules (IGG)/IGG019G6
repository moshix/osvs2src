         TITLE 'IGG019G6 - APPENDAGES-PART 1,BLKD,USR WA,NO WRT CHK'    00020000
IGG019G6 CSECT                                                          00040000
*          RELEASE OS/VS2-02 DELETIONS                                * 00042002
*          RELEASE 19 DELETIONS                                       * 00052000
*2372077000,077500,097400                                        A27341 00053019
*2372068300,137100                                               A29928 00053519
*          RELEASE 20 DELETIONS                                       * 00054000
*0518018250,018300,018350,018400,039000-039200,039400-040200,    S20201 00054120
*0518042000,045600,045800,046000,046200,046400,046600,050200-    S20201 00054220
*0518051000,051400,053200,054200,054400-054800,056000,057400,    S20201 00054320
*0518060200,063200,069800,074620,074800,077500,077800,078600,    S20201 00054420
*0518079160,087600,090800,091400,091600,092000,094000,112000,    S20201 00054520
*0518112400,115800,128200,139000,139200,139400,139600-139680,    S20201 00054620
*0518139760,144200,144600,145600,146400,146600,156000,156200,    S20201 00054720
*0518169800,170000,170200-171000,171800,175800,176000,176200,    S20201 00054820
*0518176600,177600,187800-189600,189800-193600,193800-197600,    S20201 00054920
*0518197800-202600,202800-205600,205800-208600,208800-213400,    S20201 00055020
*0518219400-222200,222400-232200,232600-233400,233600-237760,    S20201 00055120
*0518238000-238800,239000-245400                                 S20201 00055220
*0518128000                                                      M4966  00055620
*          RELEASE 21 DELETIONS                                       * 00056000
*0980021600,023000,114800,130400                                 S21045 00056121
*0980                                                            A33533 00056321
*0980036600,047800,080008-080040,174400,179400-179600,181200-    A37184 00056621
*0980181600                                                      A37184 00057221
*0980                                                            M0060  00057621
*0980                                                            A46955 00057821
*XXXX                                                            A49403 00057921
*0980021400                                                      A50670 00064600
*           CHANGES SINCE VS2-3.7                                     * 00066637
*A023600-023690,C023720                                        @ZA26522 00068637
*                                                                     * 00071302
*STATUS CHANGE LEVEL 010                                                00078002
*                                                                       00100000
* FUNCTION/OPERATION- APPENDAGE ROUTINES FOR BISAM                      00120000
*        WHEN WRITE KN IS USED WITH OR WITHOUT READ AND UPDATE          00140000
*        WHEN THE USER HAS     SUPPLIED A READ-IN AREA,                 00160000
*        WHEN WRITE VALIDITY CHECKING IS NOT REQUESTED,                 00180000
*        AND RECORD FORMAT IS   BLOCKED.                                00200000
*        (PART 1)                                                       00220000
*                                                                       00240000
*        CEND  - IF CHANNEL PROGRAM ENDS                                00260000
*                **WITHOUT ERROR, EITHER                                00280000
*                    PROCESSING COMPLETION WILL BE SCHEDULED,           00300000
*                    PROCESSING CONTINUATION WILL BE SCHEDULED,         00320000
*                    OR PROCESSING WILL CONTINUE.                       00340000
*                **WITH A LENGTH CHECK, TESTS DETERMINE WHETHER         00360000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00380000
*                    ERROR.                                             00400000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00420000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00440000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00460000
*                                                                       00480000
*        ABEND - IF CHANNEL PROGRAM ENDS ABNORMALLY BECAUSE OF          00500000
*                **PERMANENT ERROR, 'UNCORRECTABLE I/O ERROR'           00520000
*                    IS INDICATED IN THE DECB, AND PROCESSING           00540000
*                    COMPLETION WILL BE SCHEDULED.                      00560000
*                **NON-PERMANENT ERROR, ONE RE-TRY IS MADE              00580000
*                    BEFORE INDICATING A PERMANENT ERROR.               00600000
*                **FILE PROTECTION, TESTS DETERMINE WHETHER             00620000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00640000
*                    ERROR.                                             00660000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00680000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00700000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00720000
* ENTRY POINTS-                                                         00740000
*        ENTRY POINT               FUNCTION                             00760000
*        -----------               --------                             00780000
*        APPCEND                   CEND                                 00800000
*        APPABEND                  ABEND                                00820000
*                                                                       00840000
* INPUT - N/A                                                           00860000
* OUTPUT - N/A                                                          00880000
* EXTERNAL ROUTINES - N/A                                               00900000
* EXITS- 1. RETURN TO IOS VIA THE APPENDAGE RETURN VECTOR TABLE POINTED 00920000
*            TO BY REGISTER 14.  SEE THE DSECT LABELED    APPRV FOR THE 00940000
*            FORMAT OF THIS TABLE AND THE USE OF EACH EXIT.             00960000
*           USED TO CONTINUE PROCESSING.                                00980000
*        2. SCHEDULE AN ASYNCHRONOUS ROUTINE - BRANCH VIA THE EXIT      01000000
*            EFFECTOR ADDRESS IN THE COMMUNICATION VECTOR TABLE.        01020000
*           USED TO SCHEDULE PROCESSING COMPLETION OR CONTINUATION.     01040000
*        3. IF THE DESIRED APPENDAGE ROUTINE IS IN PART 2, BRANCH TO    01060000
*            THAT ROUTINE VIA THE PART 2 VECTOR TABLE.  THE POINTER TO  01080000
*            THE MODULE IS IN DCBWKPT5.  SEE THE DSECT LABELED          01100000
*            IHAPART2 FOR RELATIVE ADDRESSES AND USES OF THE ROUTINES.  01120000
*                                                                       01140000
* TABLES/WORK AREAS - DECB, DCB, IOB AND EXTENTION, DCB WA (DCW), DEB,  01160000
*        CVT, PART 2 VECTOR TABLE.                                      01180000
*        SEE DSECTS AT END OF MODULE FOR FORMAT AND DESCRIPTIONS.       01200000
*                                                                       01220000
* ATTRIBUTES- REENTRANT. DISABLED.                                      01240000
* NOTES - NONE                                                          01260000
         EJECT                                                          01280000
* GENERAL REGISTERS ARE USED AS FOLLOWS                                 01300000
*                                                                       01320000
R0       EQU   0                   *    -----                           01340000
R1       EQU   1                   *    12* ADDRESS                     01360000
R2       EQU   2                   *    IOB                             01380000
R3       EQU   3                   *    DEB                             01400000
R4       EQU   4                   *    DCB                             01420000
BASEXXXX EQU   5                        BASE REG FOR CLEANUP     Y02072 01432002
SAVEXXXX EQU   6                        SAVE AREA FOR CLEANUP    Y02072 01442002
R7       EQU   7                   *    UCB                             01480000
R8       EQU   8                   *                             Y02072 01490002
R9       EQU   9                   #    WORK REGISTER                   01520000
R10      EQU   10                       CHANNEL PROGRAM POINTER         01540000
R11      EQU   11                       DECB                            01560000
R12      EQU   12                       WORK REGISTER                   01580000
R13      EQU   13                       WORK REGISTER                   01600000
R14      EQU   14                       IOS RETURN VECTOR TABLE         01620000
R15      EQU   15                       BASE REGISTER                   01640000
*                                                                       01660000
*        * MEANS THIS REGISTER IS SET UP UPON ENTRY FROM IOS,           01680000
*          AND ITS CONTENTS MUST BE RESTORED UPON RETURN TO IOS         01700000
*        # MEANS THIS REGISTER MAY BE CHANGED, BUT UPON RETURN TO IOS   01720000
*          MUST CONTAIN ZEROES IN THE THREE HIGH ORDER BYTES            01740000
*                                                                       01760000
PERRMASK EQU   X'20'          TO TEST FOR PERMANENT ERROR, TEST         01780000
PERRYES  EQU   8               IOBECBAD, B2. IF OFF (CONDITION CODE 8)  01800000
PERRNO   EQU   7               THERE IS A PERM ERR. ELSE B2 ON ( CD 7)  01820000
ONE      EQU   1                        MISC OFFSETS             S20201 01820820
TWO      EQU   2                        *                        S20201 01821620
THREE    EQU   3                        *                        S20201 01822420
FOUR     EQU   4                        *                        S20201 01823220
FIVE     EQU   5                        *                        S20201 01824020
SIX      EQU   6                        *                        S20201 01827020
SEVEN    EQU   7                        *                        S20201 01828020
EIGHT    EQU   8                        *                        S20201 01829020
NINE     EQU   9                        *                        S20201 01830020
SIXTEEN  EQU   16                       *                        S20201 01831020
OFLOW    EQU   X'10'                    OVERFLOW BIT OF F BYTE   S20201 01833020
DUMMY    EQU   X'20'                    DUMMY BIT OF F BYTE      S20201 01834020
KADDRCHG EQU   X'80'                    KEY ADDRESS CHANGE SW    S20201 01835020
BYP      EQU   12                       RETURN TO IOS/BYPASS     S20201 01836020
EXCP     EQU   8                        RETURN TO IOS/EXCP       S20201 01842020
NORMAL   EQU   0                        RETURN TO IOS/NORMAL     S20201 01848020
CCOFF    EQU   X'BF'                    MASK FOR CC OFF                 01850001
ABENTRY  EQU   X'01'                    ABEND ENTRY INDICATOR    A50670 01853000
DATACHK  EQU   X'08'                    DATA CHECK IOB SENSE     A50670 01853400
REEXCP   EQU   8                        REEXCP RETURN TO IOS     Y02072 01853802
SKIPX    EQU   4                        SKIP RETURN TO IOS       Y02072 01853902
BYPASS   EQU   12                       BYPASS RETURN TO IOS     Y02072 01860402
FMVIOL   EQU   X'04'                    FILE MASK VIOLATION      Y02072 01860802
NOTSEEK  EQU   8                        CC - SEEK TEST SENSE B0  Y02072 01862402
SEEKCHK  EQU   X'01'                    SEEK CHECK INDICATOR     Y02072 01864402
*                                                                       01866402
         USING RQE,R1                   RQE ADDRESSABILITY       Y02072 01866802
         USING IHAIOB,R2                IOB POINTER              S20201 01867002
         USING IHADEB,R3                DEB POINTER                     01873502
         USING IHADCB,R4                DCB POINTER                     01880000
         USING IHAWKNCP,R10             CHANNEL PROGRAM POINTER         01900000
         USING IHADECB,R11              DECB POINTER                    01920000
         USING IHADCW,R12               DCB WA POINTER ONLY AS WORK REG 01940000
         SPACE 4                                                        01980002
*                             APPENDAGE VECTOR TABLE                    02000000
APP      DC    A(APPCEND-APP)          CHAN END  -  USED BY WKN         02020000
         DC    A(APPABEND-APP)          ABNORMAL END  -     USED BY WKN 02040000
APPNO    EQU   *                                                        02060000
         USING APPCEND,R15                                              02080000
APPCEND  NI    IOBINDCT,X'FE'          INDICATE CEND ENTRY              02100000
         B     SETUPREG                 BRANCH TO SET UP REGISTERS      02120000
APPABEND EQU   *                                                 A50670 02130000
         USING APPABEND,R15                                             02132000
*                                                                A50670 02140000
*        IF THIS IS A CORRECTABLE DATA CHECK FROM AN RPS         A50670 02150000
*        DEVICE THEN RETURN TO IOS FOR ERP HANDLING              A50670 02160000
*                                                                A50670 02162000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR          A50670 02162400
         BZ    NOCDACK                  YES CONTINUE AS USUAL    A50670 02162800
         TM    IOBSENS1,FMVIOL          WAS IT A SEEK CHK        Y02072 02164802
         BCR   NOTSEEK,R14              NO - RETURN TO ERPS      Y02072 02166802
NOCDACK  EQU   *                                                 A50670 02170100
         OI    IOBINDCT,ABENTRY         INDICATE ABEND ENTRY     A50670 02170200
SETUPREG L     R15,DEBEXPTR              GET ADDR OF DEB         S21045 02170400
*                                       EXTENSION PTR            S21045 02172000
         USING DEBEXT,R15                                        S21045 02177800
         L     R15,DEBWKPT4              R15  BASE               S21045 02185200
         DROP  R15                                                      02192600
         USING APP,R15                                                  02213302
*                                                                       02213702
*   SAVE IOS REGISTERS AND SET UP ADDRESSABILITY TO RETURN TO SPECIAL   02215302
*   CLEANUP ROUTINE.                                                    02217302
*                                                                       02217702
         STM   R14,R12,0(R13)           SAVE REGISTERS           Y02072 02219302
         LR    SAVEXXXX,R13             SAVE SAVE AREA PTR       Y02072 02219702
         LA    R14,IOSRETS              RETURN TO RETURN TO IOS  Y02072 02219802
         LR    BASEXXXX,R14             BASE REG FOR RETURN      Y02072 02219902
         SPACE 2                                                        02221902
         MODESET KEYADDR=RQEPRT,WORKREG=13 ACQUIRE USER KEY      Y02072 02226602
         SPACE 3                                                        02228602
         L     R12,IOBCSW              CSW=STOP ADDR+8                  02233302
         LA    R12,0(R12)              CLEAR HIGH ORDER BYTE            02240000
         L     R10,IOBCCWAD             R10  CP                         02260000
         LA    R10,0(R10)               CLEAR HIGH ORDER BYTE    A49403 02262021
         MVC   IOBECBAD+1(3),IOBBCHAD+1 RESTORE ECB              A33533 02270021
         L     R11,IOBECBAD             R11  DECB                       02280000
         L     R13,DEBEXPTR              GET ADDR OF DEB         S21045 02286021
*                                       EXTENSION PTR            S21045 02292021
         USING DEBEXT,R13                                        S21045 02298021
         L     R13,DEBWKPT5              R13  BASE, PART 2       S21045 02304021
         DROP  R13                                               S21045 02310021
         USING IHAPART2,R13                                             02320000
         IC    R9,IOBAPP                R9   RELATIVE ADDRESS IN        02340000
         CH    R9,TWOFOUR               IS APP CODE GT 24?     @ZA26522 02360037
         BNH   CODEOK                   IF NOT SKIP PROGCHK    @ZA26522 02363037
         DC    H'0'                     FOR PROG CHK           @ZA26522 02366037
TWOFOUR  DC    X'0018'                  MAX VALUE FOR APPCODE  @ZA26522 02369037
CODEOK   SLL   R9,2                            APPENDAGE TABLE @ZA26522 02372037
         TM    IOBINDCT,X'01'                                           02380000
         BO    APPABENT(R9)            IF ABEND, BRANCH VIA ABEND TABLE 02400000
         B     APPCENDT(R9)            IF CEND, BRANCH VIA THAT TABLE   02420000
         EJECT                                                          02440000
*********************************************************************** 02460000
*****              CHANNEL END APPENDAGE VECTOR TABLE             ***** 02480000
*********************************************************************** 02500000
APPCENDT EQU   *              CODE      FOR COMPLETION OF               02520000
         B     APPABA2   0             CP4/CP5, READ                    02540000
         B     APPABA2   1             CP4/CP5, WRITE                   02560000
         B     APPADB2   2             CP7                              02580000
         B     APPAAB2   3             CP1 OR CP2, READ AND UPDATE      02600000
         B     APPAFB                   CP14-PART2                17332 02620018
         B     APPACA2   5             CP6                              02640000
         B     APPRVNOR  6             NOT USED                         02660000
         B     APPM67CE  7             CP1 OR CP2, WRITE KN             02680000
         B     APPN3B21                                                 02700000
         B     APPN7B2   9             CP10A  - TRUE INSERT             02720000
         B     APPN8A2   10            CP10B  - TRUE INSERT             02740000
         B     APPN8A2   11            CP10B  - ADD TO END              02760000
         B     APPM4A2   12            CP14  - SETUPS 1, 2, OR 5        02780000
         B     APPM5A2   13            CP14  - SETUPS 3, 4, OR 6        02800000
         B     APPM1B21                                                 02820000
         B     APPM2B2   15            CP16 - SITUATION 2               02840000
         B     APPM3B2   16            CP16 - SITUATION 3               02860000
         B     APPN9A2   17            CP17  - TRACK INDEX ONLY         02880000
         B     APPN9A2   18            CP17  - TRACK AND HIGHER LEVELS  02900000
         B     APPN9A2   19            CP17  - HIGHER LEVELS ONLY       02920000
         B     APPU1B2   20            CP13A                            02940000
         B     APPU2B2   21            CP13B                            02960000
         B     APPRVNOR  22            NOT USED                         02980000
         B     APPN7B2   23             CP10A  - ADD TO END             03000000
         B     APPU6B2   24            CP13C                            03020000
         EJECT                                                          03040000
*********************************************************************** 03060000
*****             ABNORMAL END APPENDAGE VECTOR TABLE             ***** 03080000
*********************************************************************** 03100000
APPABENT EQU   *              CODE      FOR COMPLETION OF               03120000
         B     APPABD2   0             CP4/CP5, READ                    03140000
         B     APPABD2   1             CP4/CP5, WRITE                   03160000
         B     APPADE2   2             CP7                              03180000
         B     APPAAA2   3             CP1 OR CP2, READ AND UPDATE      03200000
         B     APPAEB                   CP14 PART 2               17332 03220018
         B     APPACE2   5             CP6                              03240000
         B     APPRVNOR  6             NOT USED                         03260000
         B     APPM67AE  7             CP1 OR CP2, WRITE KN             03280000
         B     APPN3E2   8             CP8                              03300000
         B     APPN7J2   9             CP10A  - TRUE INSERT             03320000
         B     APPN8G2   10            CP10B  - TRUE INSERT             03340000
         B     APPN8G2   11            CP10B  - ADD TO END              03360000
         B     APPM4E2   12            CP14  - SETUPS 1, 2, OR 5        03380000
         B     APPM5E2   13            CP14  - SETUPS 3, 4, OR 6        03400000
         B     APPM1J2   14            CP15                             03420000
         B     APPM2H2   15            CP16 - SITUATION 2               03440000
         B     APPM2H2   16            CP16 - SITUATION 3               03460000
         B     APPN9G4   17            CP17  - TRACK INDEX ONLY         03480000
         B     APPN9G4   18            CP17  - TRACK AND HIGHER LEVELS  03500000
         B     APPN9G4   19            CP17  - HIGHER LEVELS ONLY       03520000
         B     APPU4B2   20            CP13A                            03540000
         B     APPU4G2   21            CP13B                            03560000
         B     APPRVNOR  22            NOT USED                         03580000
         B     APPN7B2   23             CP10A  - ADD TO END             03600000
         B     APPU6A4   24            CP13C                            03620000
         DROP  R13                                                      03640000
         EJECT                                                          03680000
*   SPECIAL IOS RETURN CLEANUP ROUTINE INTERCEPTS ALL RETURNS TO        03690002
*   IOS AND RESTORES REGISTERS AND SETS PROTECTION KEY TO 0.            03692002
         SPACE 2                                                 Y02072 03694002
IOSRETS  EQU   *                        RETURN POINT             Y02072 03696002
         USING *,BASEXXXX               ADDRESSABILITY           Y02072 03698002
         B     NORMRET                  NORMAL RETURN            Y02072 03698402
         B     SKIPRET                  SKIP POST RETURN         Y02072 03698802
         B     REEXCPRT                 REEXCP RETURN            Y02072 03699202
         SPACE 2                                                        03699602
BYPASRET EQU   *                        BYPASS POST RETURN       Y02072 03699702
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03699802
         LA    R14,BYPASS(R14)          SCHEDULE ASYNCH ROUTINE  Y02072 03699902
         L     R13,CVTPTR               CVT ADDRESSABILITY       Y02072 03706602
         USING CVT,R13                  *                        Y02072 03707002
         L     R13,CVT0EF00             ASYNCH SCHED ROUTINE     Y02072 03708602
         DROP  R13                      *                        Y02072 03709002
         BR    R13                      GO TO ROUTINE            Y02072 03710602
         SPACE 2                                                        03712602
REEXCPRT EQU   *                        REEXCP RETURN            Y02072 03713002
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03713102
         B     REEXCP(R14)              RETURN - REEXCP          Y02072 03713202
         SPACE 2                                                        03717402
SKIPRET  EQU   *                        RETURN - SKIP            Y02072 03719402
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03721402
         B     SKIPX(R14)               RETURN - SKIP            Y02072 03721502
         SPACE 2                                                        03724002
NORMRET  EQU   *                        RETURN - NORMAL          Y02072 03726002
         BAL   R12,IOSRETX              RESTORE REGS AND KEY     Y02072 03726402
         BR    R14                      RETURN                   Y02072 03726802
         SPACE 2                                                        03727202
IOSRETX  EQU   *                        RESTORE REGS AND KEY     Y02072 03727302
         MODESET KEYADDR=KEY0,WORKREG=13   SET KEY = 0           Y02072 03727402
         SPACE 2                                                        03727802
         LM    R14,R11,0(SAVEXXXX)      RESTORE REGISTERS        Y02072 03728502
         BR    R12                      RETURN                   Y02072 03730502
         DROP  BASEXXXX                 RESET ADDRESSABILITY     Y02072 03730602
         SPACE 2                                                 Y02072 03730702
KEY0     DC    H'0'                     KEY 0                    Y02072 03730802
         EJECT                                                   Y02072 03731402
*              CHANNEL  END CP8,    APPENDAGE CODE  8,         CHART N3 03732802
APPN3B2  EQU   *                        *                               03733402
*                                                                       03734002
         LA    R13,CB8A+EIGHT           DID CHANNEL PROGRAM END ON      03735002
         CLR   R12,R13                  CB8A                            03737502
         BNE   APPAOS22                 NO, CONTINUE                    03740002
         TM    CB8A+FIVE,CC             WAS CB8A CHAINED                03742502
         BZ    APPAOS22                 NO, CP UNCHANGED                03745002
         NI    CB8A+FIVE,CCOFF          RESET CHAIN IND.                03747502
         OI    CB8A+FOUR,CC             TURN CC BACK ON                 03750002
         CLI   CB12,SEEKHH              CB12 SET FOR HEAD SEEK          03752502
         BNE   APPN3F3                  NO,  FILE PROTECT               03755002
         LA    R13,CB16                 RESET IOBSTART                  03757502
         ST    R13,IOBSTART-ONE         START CP WITH SETSECT           03760002
         MVC   IOBDADAD,CB10+SEVEN      RESET IOBSEEK                   03762502
         B     APPRVXCP                 SECHDULE EXCP IOS RETURN        03765002
APPAOS22 EQU   *                        *                               03767502
*                                                                       03770002
         LA    R13,CB21+EIGHT           DID CHAN PROG STOP AT CB21      03772502
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      03775002
         BNE   APPN3A3                  NO - CHECK FOR LENGTH ERROR     03777502
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         03780000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   03800000
         BO    APPN3C2A                 BO IF SHARED                    03820000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         03840000
         B     APPN3C2B                                                 03860000
APPN3C2A MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         03880000
APPN3C2B EQU   *                                                 S20201 03910020
APPN3C2D MVC   IOBDADAD+3(5),CB23+3    MOVE CB23 CCHHR TO IOB           04040000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        04060000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            04080000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          04100000
         LA    R13,CF1                  START AT CF1                    04120000
         ST    R13,IOBSTART-1                                           04140000
         L     R12,DCBWKPT2                                             04160000
         L     R13,CF2+4                SET OFF KEY ADDRESS CHANGE SW   04180000
         USING CP13B,R13                ESTABLISH ADDRESSABILITY S20201 04190020
         NI    CG2+FOUR,X'FF'-KADDRCHG  TURN OFF SWITCH          S20201 04200020
         IC    R9,DCWHIRPS              INITIALIZE CP13A AND CP13B      04220000
         LA    R12,0(R0,R9)             SET CC FLAGS ACCORDING TO       04240000
         IC    R9,IOBDADAD+7             NUMBER OF RCDS TO RD/WR        04260000
         SR    R12,R9                                                   04280000
         SLL   R12,4                                                    04300000
         LA    R13,CF3+4                REG 13 = FIRST CC FLAG          04320000
         LA    R12,0(R12,R13)           REG 12 = LAST  CC FLAG          04340000
APPN3D2A CLR   R12,R13                                                  04360000
         BE    APPN3D2B                                                 04380000
         MVI   0(R13),X'40'             SET CC FLAG ON                  04400000
         LA    R13,16(R0,R13)                                           04420000
         B     APPN3D2A                                                 04440000
APPN3D2B MVI   0(R13),X'00'             SET CC FLAG OFF                 04460000
         L     R12,DCBMSWA              INSERT COUNT FIELD IN Y         04480000
         MVC   0(5,R12),IOBDADAD+3                                      04500000
         MVC   5(1,R12),DCBKEYLE                                        04520000
         MVC   6(2,R12),DCBBLKSI                                        04540000
         LA    R12,IOBDADAD+THREE       POINT TO IOBSEEK         S20201 04560020
         L     R13,CF2+FOUR             POINT TO CG1 OF CP13B    S20201 04580020
         STH   R12,CG1+TWO              STORE ADDR OF IOBSEEK    S20201 04600020
         SRL   R12,SIXTEEN              SHIFT                    S20201 04620020
         STC   R12,CG1+ONE              STORE ADDR OF IOBSEEK    S20201 04640020
         MVC   CL5+ONE(THREE),CG1+ONE   MOVE IOBSEEK ADDRESS     S20201 04660020
         B     APPRVXCP                 EXCP RETURN TO IOS              04680000
*                                                                       04682002
APPN3B1  EQU   *                        *                        Y02072 04686002
APPN3B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           04700000
APPN3B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  04720000
APPN3B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 04740002
*                                                                       04790002
APPN3B6  LA    R13,CB8A+EIGHT           DID CP STOP AT CB8A      S20201 04802020
         CLR   R12,R13                  COMPARE REGS             S20201 04804020
         BNE   APPN3B3                  NO, UNREACHABLE BLOCK    S20201 04806020
         TM    CB11+SEVEN,OFLOW+DUMMY   OFLO, INACTIVE, OR DUMMY S20201 04808020
         BNZ   APPN3F3                  YES, GO TO FILE PROTECT  S20201 04810020
         MVC   CB23+THREE(FOUR),CB11+TWO  SET UP CCHH            S20201 04812020
         MVI   CB23+SEVEN,ONE           SET R EQUAL TO 1         S20201 04814020
         B     APPN3C2D                 GO READ RECORD           S20201 04816020
         EJECT                                                          04820000
*              ABNORMAL END CP8,    APPENDAGE CODE  8,         CHART N3 04840000
APPN3E2  EQU   *                                                  19374 04860000
         TM    IOBSENSE+1,X'04'         WAS ABEND DUE TO          15924 04880016
*                                       FILE PROTECT              15924 04890016
         BO    APPN3F2                  YES--BRANCH               19374 04900000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 04910000
         BC    PERRYES,APPN3B3          YES--BRANCH               19374 04920000
         B     APPRVNOR                 NO--RETRY CHANNEL PGM     19374 04930000
APPN3F2  LA    R13,CB12+8               DID CHAN PROG STOP AT CB12      04960000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      04980000
         BNE   APPN3B3                  NO - RECORD IS UNREACHABLE      05000000
APPN3F3  TM    CB11+SEVEN,OFLOW         WAS OFLO TRK IX ENTRY RD S20201 05010020
         BZ    APPN3G3                  BZ IF NO                        05120000
         TM    CB11+SEVEN,DUMMY         DUMMY OR INACTIVE        S20201 05140020
         BO    APPN3G3                  BO IF NO                        05160000
         MVC   CJ11(7),IOBDADAD        SAVE TRACK INDEX MBBCCHH         05180000
         MVI   IOBAPP,X'10'             SET APPENDAGE CODE TO 16        05200000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          05220000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            05240000
         LA    R13,CJ1                  START AT CJ1                    05260000
         ST    R13,IOBSTART-1                                           05280000
         MVC   IOBDADAD,CB10+7          PUT CB10 MBBCCHHR IN IOB        05300000
         LA    R13,IOBDADAD+3           PUT SEEK ADDRESS IN CJ1 AND CJ5 05340000
         IC    R9,CJ1                                                   05360000
         ST    R13,CJ1                                                  05380000
         STC   R9,CJ1                                                   05400000
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 05410020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 05420020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 05430020
         L     R12,DCBWKPT2             SET ON FIRST TIME ONLY SWITCH   05500000
         USING IHADCW,R12                                        S20201 05510020
         OI    DCWWKNI,X'40'                                            05520000
         LA    R12,0(R0,R0)             IS FIRST OFLO ON SAME MODULE    05540000
         IC    R12,CB10+7                      GET M OF OFLO ENTRY      05560000
         SLL   R12,4(R0)                       MULT BY 16               05580000
         L     R12,DEBUCBAD(R12)        LOAD UCB ADDR FROM DEB   S20201 05600020
         LA    R12,0(R0,R12)                   COMP WITH UCB AD IN 7    05620000
         CR    R12,R7                                                   05640000
         BE    APPRVXCP                 SAME MODULE - EXCP RTRN TO IOS  05660000
         MVI   IOBASYN,X'01'            DIFFERENT MODULE - MUST EXCP    05680000
         B     APPN3B5                   IN ASYNCHRONOUS ROUTINE        05700000
APPN3A3  TM    IOBCSW+5,X'40'           DID CHAN PROG HAVE LENGTH ERROR 05720000
         BZ    APPN3B6                  GO TEST FOR SPECIAL CASE S20201 05740020
         TM    CB11+7,X'30'             WAS ENTRY INACTIVE              05760000
         BO    APPN3B3                  BO IF YES                       05780000
APPN3G3  TM    CB11+7,X'20'             VERIFY ADD-TO-END SITUATION     05800000
         BZ    APPN3B3                  BZ IF DUMMY OR INACTIVE         05820000
         CLI   DCBNLEV,X'00'            ERROR IF 2 OR MORE INDEX LEVELS 05840000
         BNE   APPN3B3                  BNE IF MORE THAN 1 INDEX LEVEL  05860000
         TM    CB11+7,X'08'             TEST IF TRACK IS SHARED         05880000
         L     R12,DCBWKPT2             CREATE PROPER 'R' IN DCWHIRPS   05900000
         USING IHADCW,R12                                        S20201 05910020
         BO    APPN3G33                 BO IF SHARED                    05920000
         MVC   DCWHIRPS,DCBHIRPD        UNSHARED - USE DCBHIRPD         05940000
         B     APPN3G34                                                 05960000
APPN3G33 MVC   DCWHIRPS,DCBHIRSH        SHARED   - USE DCBHIRSH         05980000
APPN3G34 L     R13,CF2+4                SET OFF KEY ADDR CHANGE SW      06000000
         USING CP13B,R13                ESTABLISH ADDRESSABILITY S20201 06010020
         NI    CG2+FOUR,X'FF'-KADDRCHG  TURN OFF SWITCH          S20201 06020020
APPN3G5  MVI   IOBAPP,X'0E'             SET APPENDAGE CODE TO 14        06040000
         MVC   IOBDADAD(3),DCBLPDA      SEEK TO DCBLETI'S CYLINDER      06060000
         MVC   IOBDADAD+3(4),DCBLETI   CCHH TO IOB                      06080000
         OC    IOBDADAD+6(1),DCBFIRSH+3  MASK OUT TRACK VALUE TO        06100000
         XC    IOBDADAD+6(1),DCBFIRSH+3  REDUCE TO A CYL BOUNDRY        06120000
         MVI   IOBDADAD+7,X'00'        R=0                              06140000
         LA    R12,CI1                  START AT CI1                    06160000
         ST    R12,IOBSTART-1                                           06180000
         NI    IOBFLAG1,X'7F'           DON'T USE DATA CHAINING         06200000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            06220000
         LA    R12,IOBDADAD+3           PUT SEEK ADDRESS IN CI1         06240000
         IC    R9,CI1                                                   06260000
         ST    R12,CI1                                                  06280000
         STC   R9,CI1                                                   06300000
         MVC   CI5+TWO(FIVE),DCBLETI    PUT DCBLETI CCHHR IN CI5 S20201 06310020
         MVC   CI5(TWO),DCBLPDA+ONE     MOVE IN BB FOR HEAD SEEK S20201 06320020
         B     APPRVXCP                                                 06340000
         EJECT                                                          06360000
*              CHANNEL  END CP13A,  APPENDAGE CODE 20,         CHART U1 06380000
APPU1B2  LA    R9,8                                                     06400000
         SR    R12,R9                   POINT TO LAST OP CODE           06420000
         CLI   0(R12),X'06'                                             06440000
         BNE   APPN3B3                  NO - BRANCH UNREACHABLE         06460000
         L     R12,DCBWKPT2             DCB WORK AREA                   06480000
         USING IHADCW,R12                                        S20201 06490020
         TM    DCWWKNI,X'10'            WAS CP13A USED FOR ADD TO END   06500000
         BO    APPU3B2                  YES BRANCH TO A.T.E. CHART U3   06520000
*              REGISTERS 3 AND 10 WILL NOW BE DESTROYED                 06540000
         L     R13,CF3                  Z+RL                            06560000
         LA    R13,0(R0,R13)                                            06580000
         SH    R13,DCBLRECL             POINT TO RCV ADDR, Z            06600000
APPU1C3  L     R10,DECBKEY              POINT TO KEY OF INSERT          06620000
         LR    R12,R13                                                  06640000
         AH    R12,DCBLRECL                                             06660000
         AH    R12,DCBRKP               POINT TO KEY OF SEND AREA       06680000
         IC    R9,DCBKEYLE                                              06700000
         BCTR  R9,R0                    COMPARE KEYLE BYTES             06720000
         EX    R9,APPU1C32              COMPARE INSERT TO SEND          06740000
         BL    APPU1D2                  BRANCH TO INSERT                06760000
         BE    APPU1C1                  BRANCH TO REPLACE               06780000
         SH    R12,DCBRKP               ADJUST SEND ADDRESS             06800000
         BAL   R3,APPMOV10              MOVE FORWARD ONE RECORD         06820000
*                                                                       06820402
*                       GIVE UNREACHABLE BLOCK CONDITION IF NO KEY      06821018
*                       IN FIRST BLOCK READ IS HIGHER THAN KEY          06822018
*                       TO BE ADDED                                     06823018
*                                                                       06823402
         L     R10,IOBCCWAD             GET CP ADDRESS AGAIN      24080 06824018
         L     R3,CF3                   ADDRESS OF BLOCK READ     24080 06825018
         LA    R3,0(0,R3)                                         24080 06826018
         AH    R3,DCBBLKSI              ADDRESS OF END OF BLOCK   24080 06827018
         CR    R12,R3                   NEXT LRECL TO BE MOVED VS 24080 06828018
*                                       END OF BLOCK                    06829018
         BNL   APPN3B1                  BRANCH IF BEYOND END     A29928 06834019
         B     APPU1C3                  LOOP                            06840000
APPU1C32 CLC   0(0,R10),0(R12)          EXECUTED INSTRUCTION            06860000
APPU1D2  L     R12,DECBAREA                                             06880000
         LA    R12,16(R0,R12)           MOVE AREA +16                   06900000
         BAL   R3,APPMOV10              INSERT NEW RECORD               06920000
         L     R10,DCBWKPT3             RESTORE CP8 POINTER ONLY        06940000
         L     R3,CF2+4                                                 06960000
         DROP  R13                      DROP REGISTER            S20201 06970020
         USING CP13B,R3                 ESTABLISH ADDRESSABILITY S20201 06980020
         LA    R3,CG1                   GET A(CG1) INTO BASE REG S20201 06990020
         IC    R9,IOBDADAD+7                                            07000000
         BCTR  R9,R0                                                    07020000
         STC   R9,IOBDADAD+7            REDUCE R BY 1                   07040000
         L     R12,DCBWKPT2                                             07060000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 07070020
         TM    IOBCSW+4,X'01'                                           07080000
         BO    APPU1G4                  BRANCH IF EOF                   07100000
         NI    DCWWKNI,X'F7'            SET EOF INDICATOR OFF           07120000
         BAL   R11,APPURTN                                              07140000
         L     R11,IOBECBAD                                             07160000
APPU1G2  SR    R12,R9                   REDUCE BY 24                    07180000
         CLR   R12,R13                  IF GONE PAST CG4                07200000
         BL    APPU1J2                  BRANCH OUT                      07220000
         OI    12(R12),X'40'            OTHERWISE SET COMMAND CHNG ON   07240000
         B     APPU1G2                  AND LOOP                        07260000
APPU1J2  CLC   CB10+7(7),DCBLPDA        BRANCH IF SEEK-SRCH MBBCCHH     07280000
         BNE   APPU1K2                  NOT EQUAL TO LPDA               07300000
         L     R12,DCBWKPT2                                             07320000
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 07330020
         CLC   DCWHIRPS(1),DCBLPDA+7    BRANCH IF SEEK-SRCH R           07340000
         BNE   APPU1K2                  NOT EQUAL TO LPDA               07360000
APPU1J3  TM    DCBST,X'02'              IS LAST BLOCK FULL              07380000
         BO    APPU1K2                  BRANCH IF YES                   07400000
         L     R12,DCBNREC              ADD 1 TO NUMBER OF PRIME DATA   07420000
         LA    R12,1(0,R12)              RECORDS - A LOGICAL RECORD     07440000
         ST    R12,DCBNREC               WILL REPLACE A PADDING RECORD. 07460000
         L     R12,CG2+FOUR             LOAD REGISTER            S20201 07462020
         L     R12,8(R0,R12)                                      7S083 07464000
         AH    R12,DCBBLKSI             GO TO ORIGINAL LAST RECORD7S083 07466000
         BAL   R13,APPPAD10             WAS IT REALLY PADDING     7S083 07468000
         B     APPU1J4                  YES--STATUS OK            7S083 07470000
         OI    DCBST,X'02'              NO--LAST BLOCK WAS FULL   7S083 07472000
         B     APPU1K2                  REJOIN MAINLINE CODE      7S083 07474000
APPU1J4  L     R12,CG2+FOUR             WR KEY ADDR AT CG2       S20201 07484020
         L     R12,8(R0,R12)            POINT TO LAST BLOCK             07500000
APPU1J5  STH   R12,IOBFCHAD+2                                           07520000
         SRL   R12,16                                                   07540000
         STC   R12,IOBFCHAD+1           STORE LAST BLOCK ADDRESS        07560000
         L     R12,IOBFCHAD             RESTORE                         07580000
         BAL   R13,APPPAD10             IS IT PADDING                   07600000
         B     APPU1H5                  SUB-ROUTINE SAYS YES            07620000
         L     R12,IOBFCHAD             LAST LOGICAL RCD CHECKED        07640000
         AH    R12,DCBLRECL             TRY THE NEXT                    07660000
         B     APPU1J5                                                  07680000
APPU1H5  EQU   *                                                 A27341 07700019
         L     R12,IOBFCHAD             POINTER TO FIRST PAD            07720000
         SH    R12,DCBLRECL             POINTER TO LAST NON-PAD         07740000
APPU1H6  L     R13,CG2+FOUR             LAST WR KEY ADDR         S20201 07750020
         AH    R12,DCBRKP               POINTER TO ITS KEY              07760000
         MVC   CG2+FIVE(THREE),ONE(R13) SAVE A(ORIGINAL KEY)     S20201 07780020
         STH   R12,2(R0,R13)                                            07800000
         SRL   R12,16                                                   07820000
         STC   R12,1(R0,R13)            PLACE CORRECT KEY ADDRESS       07840000
         OI    CG2+FOUR,KADDRCHG        KEY ADDR CHANGE IND ON   S20201 07850020
         USING IHADEB,R3                                         S20201 07860020
APPU1K2  ST    R3,IOBSTART-1                                            07880000
         L     R3,RQEDEB                RESTORE DEB ADDRESS      Y02072 07900002
         L     R12,DCBWKPT2            WORK AREA POINTER          17332 07905018
         USING IHADCW,R12                                        S20201 07907020
         TM    DCWWKNI,X'08'           DID CP13A END WITH AN EOF  17332 07910018
         BO    APPU2H2                 IF YES-BRANCH              M3216 07912018
         L     R13,CF2+4               TEST FOR KEY CHANGE        M3216 07914018
         USING CP13B,R13                ESTABLISH ADDRESSABILITY S20201 07915020
         TM    CG2+FOUR,KADDRCHG        DID KEY CHANGE           S20201 07916020
         BO    APPU2H2                 IF YES-BRANCH              M3216 07918018
         OI    CH8E+4,X'02'                                       M3216 07920018
         TM    DCWWKNI,X'10'      WAS CP13A USED FOR ADD TO END   17332 07925018
         BZ    APPU2F3            IF NO-BRANCH                    17332 07930018
APPU2H2  NI    CH8E+4,X'FD'            RESET BUMP TO OVFL FLAG    17332 07935018
         OI    IOBFLAG1,X'C0'           DATA AND COMMAND CHAINING       07940000
         MVI   IOBAPP,X'15'             SET APPENDAGE CODE TO 21        07960000
         B     APPRVXCP                 EXCP RETURN TO IOS              07980000
APPU2F3  EQU   *                                                  12999 07980818
         TM    DCBOPTCD,X'02'           OTHERWISE BRANCH IF DELETE      07981618
         BZ    APPU2J3                  OPTION NOT TAKEN                07982418
         L     R13,IOBFCHAD             IS LFTOVR RCD MRKD FOR DELETION 07983218
         L     R12,16(R0,R13)                                           07984018
         AH    R12,22(R0,R13)                                           07984818
         CLI   0(R12),X'FF'                                             07985618
         BNE   APPU2J3                  BRANCH IF NOT DELETED     12999 07986418
         IC    R9,IOBDADAD+6            SAVE H                    12999 07987218
         NC    IOBDADAD+6(1),DCBFIRSH+3    LEAVE ONLY TRK VALUE         07988018
         CLC   IOBDADAD+6(1),DCBLDT+1                                   07988818
         STC   R9,IOBDADAD+6           RESTORE SAVED H                  07989618
         BE    APPD2G31                 BRANCH--LAST TRACK OF CYL 12999 07990418
         CLC   DCBLPDA(7),IOBDADAD                                      07991218
         BNE   APPU2H2                  NO--DON'T BUMP            12999 07992018
APPD2G31 EQU   *                                                  12999 07992818
         TM    CB11+7,X'10'             CURR IX ENTRY OFLOW       12999 07993618
         BZ    APPD2G33                 NO, BRANCH--NEXT INDEX    12999 07994418
*                                       ENTRY MUST BE OVERFLOW    12999 07995218
         TM    CB11+7,X'08'             CHAINING PRESENT          12999 07996018
         BZ    APPU2J3                  NO--BUMP DELETED REC      12999 07996818
         B     APPU2H2                  YES--DON'T BUMP           12999 07997618
APPD2G33 TM    CB26,X'08'               CHECK FOR CHAINING        12999 07998418
         BO    APPU2H2                  CHAIN--DON'T BUMP MORE    12999 07999218
*                                                                 12999 08000018
APPU2J3  EQU   *                                                 A37184 08000121
         L     R13,DECBAREA                                      A37184 08000221
         LA    R13,16(R0,R13)           RCV ADDR EQ AREA PLUS 16 A37184 08000321
*                                                                       08000402
         LR    R3,R14                   SAVE REG FOR IOS RETURN  Y02072 08000502
         LR    R12,R4                   SAVE DCB ADDRESS         Y02072 08000702
         L     R4,RQEDEB                ADDR OF CURRENT DEB      Y02072 08000802
         L     R4,0(R4)                 ADDR OF CURRENT TCB      Y02072 08000902
         LR    R8,R15                   SAVE BASE ADDRESS        Y02072 08001002
         LR    R9,R1                    SAVE RQE ADDRESS         Y02072 08001102
         LR    R10,R2                   SAVE IOB ADDRESS         Y02072 08001202
         SR    R2,R2                    NO RANGE TO BE TESTED    Y02072 08001302
         LR    R1,R13                   ADDR TO BE VALIDATED     Y02072 08001402
         SPACE 2                                                        08001502
         MODESET  KEYADDR=KEY0,WORKREG=15  SET PROTECTION KEY 0  Y02072 08001602
         SPACE 2                                                        08002002
         L     R15,CVTPTR               ADDR OF CVT              Y02072 08002302
         USING CVT,R15                  CVT ADDRESSABILITY       Y02072 08002402
         L     R15,CVT0VL00             ADDR OF VALIDATION RTN   Y02072 08002502
         DROP  R15                      END USING ON CVT         Y02072 08002602
         SPACE 1                                                        08002702
         BALR  R14,R15                  VALIDATE ADDR            Y02072 08003302
         SPACE 1                                                        08003402
         LR    R15,R8                   RESTORE BASE ADDRESS AND Y02072 08003502
         USING APP,R15                  MODULE ADDRESSABILITY    Y02072 08003702
         LR    R4,R12                   RESTORE DCB ADDRESS      Y02072 08004202
         LR    R1,R9                    RESTORE RQE ADDRESS      Y02072 08004402
         LR    R2,R10                   RESTORE IOB ADDRESS      Y02072 08004602
         LR    R14,R3                   RESTORE IOS RETURN ADDR  Y02072 08004802
         SPACE 2                                                        08005102
         MODESET  KEYADDR=RQEPRT,WORKREG=10  SET USER'S KEY      Y02072 08005202
         SPACE 2                                                        08005302
         BZ    OKAREA                   B IF VALID TO CONTINUE   A37184 08005502
         OI    DECBEXC1,X'10'           SET INVALID REQUEST      A37184 08005802
         L     R3,RQEDEB                RESTORE DEB ADDRESS      Y02072 08006102
         B     APPN3B4                  BR TO SCHED ASYNC        A37184 08006402
OKAREA   EQU   *                                                 A37184 08006702
         L     R13,IOBFCHAD             LAST WCKD                A37184 08007002
         L     R12,16(R0,R13)           LAST DATA                A37184 08007302
         AH    R12,DCBBLKSI             SEND ADDR EQ LAST DATA + A37184 08007602
*                                       AL                       A37184 08007902
         L     R13,DECBAREA                                      M0060  08008202
         LA    R13,16(R0,R13)           RCV ADDR EQ AREA + 16    M0060  08008502
         BAL   R3,APPMOV10              MOVE LEFT-OVER RCD              08008802
         SH    R12,DCBLRECL             RESTORE SEND ADDRESS            08009102
         AH    R12,DCBRKP               POINT TO LEFT-OVER KEY          08009402
         L     R13,DECBKEY              POINT TO I                      08009702
         SR    R9,R9                                             A37184 08010002
         IC    R9,DCBKEYLE                                              08010302
         BCTR  R9,R0                    MOVE KEYLENGTH BYTES            08010602
         EX    R9,APPU2J3A              MOVE LEFT-OVER KEY              08010902
         L     R3,RQEDEB                ADDR OF CURRENT DEB      Y02072 08011202
         L     R10,IOBCCWAD             RESTORE R10 USED ABOVE          08012018
         NI    IOBINDCT,X'DF'           POINT TO AREA + I FOR OFLO RCD  08012818
         L     R13,IOBFCHAD             PUT ADDR OF KEY OF LAST         08013618
         MVC   CH7+1(3),9(R13)          BLOCK WRITTEN IN CH7            08014418
         MVI   IOBASYN,X'09'            SET ASYNCH CODE TO 9            08015218
         B     APPN3B5                  SCHEDULE ASYNCH ROUTINE         08016018
APPU2F4  L     R12,CF2+4               KEY ADDR CHANGE            17332 08016818
         BO    APPU2H2                 IF YES-BRANCH              17332 08017618
APPU1C1  TM    DCBOPTCD,X'02'          WAS DELETE OPTION TAKEN    17332 08018418
         BZ    APPU1A3                  NO  BRANCH TO DUP. RCD EXIT     08020000
         SH    R12,DCBRKP               POINT TO LOGICAL RCD BYTE 1     08040000
         CLI   0(R12),X'FF'     WAS IT DELETED                     7851 08060000
         BNE   APPU1A3          NO BRNCH TO DUP REC EXIT           7851 08080000
         L     R12,DECBAREA             YES POINT TO INSERT RCD         08100000
         LA    R12,16(R0,R12)                                           08120000
         BAL   R3,APPMOV10              MOVE NEW RCD INTO BLOCK         08140000
APPU1F1  L     R10,DCBWKPT3             RESTORE CP8 POINTER             08160000
         L     R12,CF3                  Z+RL                            08180000
         LA    R12,0(R0,R12)                                            08200000
         AH    R12,DCBBLKSI             Z+RL+AL                         08220000
         SH    R12,DCBLRECL             Z+AL                            08240000
         CLR   R12,R13                  DOES LST RCD IN BLK EQ RCV ADDR 08260000
         BE    APPU1G1                  YES BRANCH                      08280000
         LR    R12,R13                                             7851 08300000
         AH    R12,DCBLRECL  POINT TO SEND ADDR                    7851 08320000
         BAL   R3,APPMOV10              MOVE                            08340000
         B     APPU1F1                  LOOP                            08360000
APPU1G1  L     R10,DCBWKPT3             RESTORE CP8 POINTER             08380000
         L     R3,RQEDEB                ADDR OF CURRENT DEB      Y02072 08390002
         LA    R13,CL5                                                  08440000
         ST    R13,IOBSTART-1                                           08460000
         NI    IOBFLAG1,X'7F'           DATA CHAINING OFF               08480000
         OI    IOBFLAG1,X'40'           COMMAND CHAINING ON             08500000
         MVI   IOBAPP,X'18'             SET APPENDAGE CODE TO 24        08520000
         B     APPRVXCP                 EXCP RETURN TO IOS              08540000
APPU1A3  L     R10,DCBWKPT3             RESTORE CP8 POINTER             08560000
         L     R3,RQEDEB                ADDR OF CURRENT DEB      Y02072 08570002
         OI    DECBEXC1,X'01'           DUPLICATE RECORD                08620000
         MVI   IOBASYN,X'08'            SET ASYNCHRONOUS CODE TO 8      08640000
         B     APPN3B5                  SCHEDULE ASYNCHRONOUS ROUTINE   08660000
APPU1G4  OI    DCWWKNI,X'08'            SET EOF INDICATOR ON            08680000
         TM    DCBST,X'02'              IS LAST BLOCK FULL              08700000
         BO    APPU1F5                  YES BRANCH                      08720000
         L     R3,CF2+4                                                 08740000
         DROP  R13                      DROP REGISTER            S20201 08750020
         USING CP13B,R3                 ESTABLISH ADDRESSABILITY S20201 08760020
         LA    R3,CG1                   CG1 IN REG 3             S20201 08770020
         LA    R13,CF4                                                  08780000
         BAL   R11,APPURTN+4                                            08800000
         L     R11,IOBECBAD                                             08820000
APPU1E4  SR    R12,R9                   REDUCE BY 24                    08840000
         CLR   R12,R13                  IF GONE PAST CG4                08860000
         BL    APPU1E3                  BRANCH OUT                      08880000
         OI    12(R12),X'40'            OTHERWISE SET COMMAND CHNG ON   08900000
         B     APPU1E4                  AND LOOP                        08920000
APPURTN  LA    R13,CF2                                                  08940000
         L     R12,IOBCSW                                               08960000
         LA    R12,0(R12)                                               08980000
         SR    R12,R13                 16 TIMES NO. OF DATA RDS-1       09000000
         LR    R13,R12                                                  09020000
         SRL   R13,1                   NOW 8 TIMES NO. OF RDS-1         09040000
         AR    R12,R13                 24 TIMES NO OF RDS-1             09060000
         LA    R13,CG3                                           S20201 09080020
         AR    R12,R3                  ADDR OF CC SW-8                  09100000
         NI    12(R12),X'BF'           CC BIT OFF                       09120000
         ST    R12,CG2+FOUR             POINT TO LAST WRITE KEY  S20201 09130020
         LA    R12,16(R12)                                        17332 09143018
APPU1GA  LA    R9,24                                              17332 09146018
         SR    R12,R9                                             17332 09149018
         ST    R12,IOBFCHAD            ADDR OF LAST CP13B CKD     17332 09152018
         LA    R12,8(R12)                                         17332 09155018
         BR    R11                                                      09180000
APPU1E3  L     R12,CG2+FOUR             POINT TO LAST WRITE DATA S20201 09200020
         L     R12,8(R0,R12)                                            09220000
         LA    R12,0(R0,R12)                                            09240000
         AH    R12,DCBBLKSI             ADD AL                          09260000
         SH    R12,DCBLRECL             SUB RL                          09280000
         BAL   R13,APPPAD10             IS IT PADDING                   09300000
         B     APPU1J4                  YES BRANCH                      09320000
         OI    DCBST,X'02'              NO  SET LAST BLOCK FULL         09340000
         B     APPU1K2                  BRANCH TO SET UP CP13B          09360000
APPU1F5  L     R3,CF2+4                                                 09380000
         LA    R3,CG1                   CG1 OF CP13B HI BYTE=0   S20201 09390020
         DROP  R3                       DROP REG                 S20201 09400020
         USING IHADEB,R3                ESTABLISH ADDRESSABILITY S20201 09410020
         BAL   R11,APPURTN                                              09420000
         L     R11,IOBECBAD                                             09440000
APPU1E5  SR    R12,R9                   REDUCE BY 24                    09460000
         CLR   R12,R13                  IF GONE PAST CG4                09480000
         BL    APPU1D5                  BRANCH OUT                      09500000
         OI    12(R12),X'40'            OTHERWISE SET COMMAND CHNG ON   09520000
         B     APPU1E5                  AND LOOP                        09540000
APPU1D5  L     R12,12(R0,R3)            POINT TO LAST WR DATA           09560000
         LA    R9,8(R0,R0)                                              09580000
         SR    R12,R9                   POINT TO CCW LAST WR CT         09600000
         L     R12,0(R0,R12)            POINT TO COUNT                  09620000
         MVC   5(1,R12),DCBKEYLE        RESET RECORD KEY &DATA          09640000
         MVC   6(2,R12),DCBBLKSI        LENGTHS AFTER EOF               09660000
         L     R12,12(R0,R3)            RESTORE TO LAST WRITE DATA      09680000
         L     R12,8(R0,R12)                                            09700000
         LA    R12,0(R0,R12)                                            09720000
         LH    R13,DCBBLKSI             MOVE (M-1)LRECL BYTES           09760000
         SH    R13,DCBLRECL                                             09780000
         BZ    APPU1H6                  NO PADDING (1 REC/BLOCK)  12244 09790016
         AH    R12,DCBLRECL             START PADDING AT +LRECL  A27341 09795019
APPU1D52 MVI   0(R12),X'FF'                                             09800000
         LA    R12,1(R0,R12)            ADD 1                           09820000
         BCT   R13,APPU1D52                                             09840000
         NI    DCBST,X'FD'              SET LAST BLOCK NOT FULL         09860000
         B     APPU1J4                  BRANCH                          09880000
         EJECT                                                          09900000
*              TEST FOR PADDING SUBROUTINE                              09920000
*                                                                       09930002
* ENTRY  LA    12,FIRSTPOS    FIRSTPOS = LOGICAL RECORD FIRST BYTE      09940000
*        BAL   13,APPPAD10                                              09960000
*                                                                       09970002
* DESTROYS     REGISTERS 9 (ONE BYTE), 12, 13 DESTRUCTIVELY             09980000
*              REGISTER 11, BUT RESTORES IT TO IOBECBAD                 10000000
*                                                                       10010002
* RETURNS      TO BAL INSTRUCTION PLUS FOUR BYTES IF PADDING            10020000
*              TO BAL INSTRUCTION PLUS EIGHT BYTES IF NO                10040000
*                                                                       10050002
APPPAD10 CLI   0(R12),X'FF'             TEST FIRST BYTE FOR ALL ONES    10060000
         BNE   APPPAD40                 NO - NOT A PADDING RECORD       10080000
         LA    R9,255(R0,R0)            PLACE 255 IN REG 9              10100000
         LH    R11,DCBLRECL             PLACE RECORD LENGTH IN REG 11   10120000
         BCTR  R11,R0                   LRECL MINUS ONE COMPARES REQD   10140000
APPPAD20 CLR   R11,R9                   LENGTH REMAINDER MORE THAN 255  10160000
         BNH   APPPAD30                 NO - NO MORE LOOPING            10180000
         CLC   0(255,R12),1(R12)        COMPARE 255 BYTES               10200000
         BNE   APPPAD40                 NOT PADDING                     10220000
         SR    R11,R9                   REDUCE LENGTH REMAINDER BY 255  10240000
         AR    R12,R9                   INCREASE INDEXING BY 255        10260000
         B     APPPAD20                 LOOP                            10280000
APPPAD30 BCTR  R11,R0                   ADJUST FOR MACHINE LANGUAGE     10300000
         EX    R11,APPPAD60             COMPARE 255 OR FEWER BYTES      10320000
         BE    APPPAD50                 PADDING                         10340000
APPPAD40 LA    R13,4(R0,R13)            MODIFY RETURN FOR NOT PADDING   10360000
APPPAD50 L     R11,IOBECBAD             RESTORE REGISTER 11             10380000
         BR    R13                      RETURN                          10400000
APPPAD60 CLC   0(0,R12),1(R12)          EXECUTED COMPARE                10420000
         EJECT                                                          10440000
*              GENERALIZED MOVE OF LOGICAL RECORD SUBROUTINE            10460000
*                                                                       10470002
* ENTRY  LA    12,SENDADDR    SENDADDR = SEND ADDRESS FIRST BYTE        10480000
*        LA    13,RCVADDR     RCVADDR = RECEIVE ADDRESS FIRST BYTE      10500000
*        BAL   3,APPMOV10                                               10520000
*                                                                       10530002
* DESTROYS     REGISTER 9 (ONE BYTE), REGISTERS 3, 10, 12, 13           10540000
*                                                                       10550002
* AT EXIT      REGISTER 3 CONTAINS RETURN ADDR                          10560000
*              REGISTER 9 CONTAINS X'FF' IN LOW-ORDER BYTE              10580000
*              REGISTER 10 CONTAINS A VARIABLE QUANTITY, LESS THAN 256  10600000
*              REGISTER 12 CONTAINS SENDADDR + DCBLRECL                 10620000
*              REGISTER 13 CONTAINS RCVADDR + DCBLRECL                  10640000
*                                                                       10650002
* RETURNS      TO BAL INSTRUCTION PLUS FOUR BYTES                       10660000
*                                                                       10670002
APPMOV10 LA    R9,255(R0,R0)            PLACE 255 IN REG 9              10680000
         LH    R10,DCBLRECL             PLACE RECORD LENGTH IN REG 10   10700000
         BCTR  R10,R0                   MOVE LRECL BYTES                10720000
APPMOV20 CLR   R10,R9                   COMPARE LENGTH REMAINDER TO 255 10740000
         BNH   APPMOV30                 BRANCH LAST TIME                10760000
         MVC   0(255,R13),0(R12)        MOVE 255 BYTES                  10780000
         SR    R10,R9                   REDUCE LENGTH REMAINDER BY 255  10800000
         AR    R12,R9                   INCREASE SEND INDEXING BY 255   10820000
         AR    R13,R9                   INCREASE RCV INDEXING BY 255    10840000
         B     APPMOV20                 LOOP                            10860000
APPMOV30 EX    R10,APPMOV40             MOVE 255 OR FEWER BYTES         10880000
         LA    R12,1(R12,R10)           UPDATE INDEXING BY 255 OR LESS  10900000
         LA    R13,1(R13,R10)           UPDATE INDEXING BY 255 OR LESS  10920000
         BR    R3                       RETURN FROM SUB-ROUTINE         10940000
APPMOV40 MVC   0(0,R13),0(R12)          LENGTH, RCV ADDR, SEND ADDR     10960000
         EJECT                                                          10980000
*              CHANNEL  END CP13B,  APPENDAGE CODE 21,         CHART U2 11000000
APPU2B2  LA    R9,24                    CALC LAST CCW ADDR              11020000
         SR    R12,R9                   GET ADDR OF LAST CCW            11040000
         CLI   20(R12),X'00'                                            11060000
         BNE   APPN3B3                  YES, RECORD IS UNREACHABLE      11080000
         STH   R12,IOBFCHAD+2           NO, CSW - 24 = LAST WR CKD      11100000
         SRL   R12,16                                                   11120000
         STC   R12,IOBFCHAD+1                                           11140000
APPU2C2  L     R13,IOBFCHAD                                             11160000
         L     R12,CF2+4                HAS KEY ADDR IN CP13B CHANGED   11180000
         USING CP13B,R12                ESTABLISH ADDRESSABILITY S20201 11190020
         TM    CG2+FOUR,KADDRCHG        TEST SWITCH              S20201 11200020
         BZ    APPU2B3                  NO. BRANCH FOR ADD TO END TEST  11220000
         MVC   NINE(THREE,R13),CG2+FIVE YES, RESTORE A(KEY)      S20201 11230020
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 11240020
APPU2B3  L     R12,DCBWKPT2             WAS CP USED FOR ADD TO END      11260000
         USING IHADCW,R12                                        S20201 11270020
         TM    DCWWKNI,X'10'                                            11280000
         BO    APPU3E2                  YES. BRANCH TO ADD TO END CHART 11300000
         TM    DCWWKNI,X'08'            NO.  DID CP13A END WITH EOF     11320000
         BZ    APPU2E3                  NO.  BRANCH                     11340000
         L     R13,IOBFCHAD                                             11360000
         L     R13,0(R13)               YES. PUT LAST RCD CHHR IN IOB   11380000
         MVC   IOBDADAD+3(5),0(R13)                                     11400000
         OI    DCWWKNI,X'20'            SET SAME MODULE SW ON           11420000
         MVI   IOBAPP,X'09'             SET APPENDAGE CODE TO 9         11440000
         MVC   DCBLPDA+7(1),IOBDADAD+7  UPDATE R IN LPDA          13494 11460015
         L     R15,DEBEXPTR              GET ADDR OF DEB         S21045 11465021
*                                       EXTENSION PTR            S21045 11470021
         USING DEBEXT,R15                                        S21045 11475021
         L     R15,DEBWKPT5              ADDRESS OF PART 2 IN    S21045 11480021
*                                       R15                      S21045 11485021
         DROP  R15                                               S21045 11490021
         USING IHAPART2,R15                                             11500000
         B     APPN7B4                  BRANCH TO CP10A CHART           11520000
         USING APP,R15                                                  11540000
APPU2E3  L     R12,CF2+4                IS KEY ADDR CHANGE IND ON       11560000
         USING CP13B,R12                ESTABLISH ADDRESSABILITY S20201 11570020
         TM    CG2+FOUR,KADDRCHG        IS KEY ADDR CHANGE SW ON S20201 11580020
         BZ    APPU2F5                                            17332 11600018
         L     R13,IOBFCHAD             YES. CALCULATE ADDRESS OF LAST  11620000
         L     R12,16(R0,R13)           WRITE KEY.                      11640000
         AH    R12,22(R0,R13)                                           11660000
         SH    R12,DCBLRECL                                             11680000
         BAL   R13,APPPAD10             TEST RECORD FOR PADDING         11700000
         B     APPN3B4                  YES. GO TO SCHEDULE COMPLETION  11720000
         OI    DCBST,X'03'              NO. SET LST BLCK, LST TRCK FULL 11740000
         B     APPN3B4                  GO TO SCHEDULE COMPLETION       11760000
APPU2F5  TM    CH8E+4,X'02'                                       17332 11820018
         BZ    APPT2J2                  IF NO-BRANCH              17332 11880018
         MVI   IOBAPP,X'04'             SET UP 2ND PART CP14      17332 11940018
         MVC   IOBSTART,CH21+4          TO UPDATE INDICES         17332 12000018
         MVC   IOBDADAD,CH14           RESTORE IOBSEEK            17332 12060018
         MVI   CH14,X'03'               CHANGE CH14               17332 12120018
         MVI   CH14+4,X'20'             TO ANOP                   17332 12180018
         MVI   CH14+7,X'01'                                       17332 12240018
         NI    CH8E+4,X'40'            RESET  FLAG                17332 12300018
         B     APPRVXCP                                           17332 12360018
APPT2J2  OI    IOBFLAG1,X'C0'                                     17332 12420018
         LA    R12,CK1                  START AT CK1                    12480000
         ST    R12,IOBSTART-1                                           12500000
         MVC   IOBDADAD+5(3),CB23       SET SEEK ADDRESS                12520000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  12540000
         ST    R12,CK1                                                  12560000
         MVI   CK1,X'31'                                                12580000
         MVC   CK4(4),CK1              MOVE OP CODE AND ID TO CK4       12600000
         L     R13,IOBFCHAD             ADDRESS OF LAST KEY TO CK6      12620000
         L     R13,8(R0,R13)                                            12640000
         ST    R13,CK6                                                  12660000
         MVI   CK6,X'0D'                                                12680000
         MVI   IOBAPP,X'11'             SET APPENDAGE CODE TO 16        12700000
         B     APPRVXCP                 EXCP RETURN TO IOS              12720000
APPU2J3A MVC   0(0,R13),0(R12)     EXECUTED INSTRUCTION            7851 12740000
         EJECT                                                          12760000
*              CP13B WHEN USED FOR ADD-TO-END, CHART U3                 12780000
APPU3E2  L     R12,CF2+4                POINT TO CG1             M4966  12790020
         USING CP13B,R12                ESTABLISH ADDRESSABILITY S20201 12810020
         TM    CG2+FOUR,KADDRCHG        BR IF KEY ADDR CHANGE    S20201 12820020
         USING IHADCW,R12               ESTABLISH ADDRESSABILITY S20201 12830020
         BO    APPU3E3                  INDICATOR IS ON                 12840000
         OI    DCBST,X'02'              OTHERWISE, SET LST BLCK FULL    12860000
         L     R12,DCBWKPT2                                             12880000
         USING IHADCW,R12                                        S20201 12890020
         CLC   DCWHIRPS,DCBLPDA+7       IS LPDA THE SAME AS HIRPS       12900000
         BNE   APPU3G4                  NO.  BRANCH                     12920000
         OI    DCBST,X'01'              YES  SET LAST TRK FULL IND ON   12940000
         B     APPU3F3                                                  12960000
APPU3E3  CLC   DCWHIRPS,DCBLPDA+7                                       12980000
         BE    APPU3F3                  BRANCH IF LPDA EQUALS HIRPS     13000000
APPU3G4  MVI   IOBAPP,X'17'             SET APPENDAGE CODE TO 23        13020000
         L     R15,DEBEXPTR              GET ADDR OF DEB         S21045 13025021
*                                       EXTENSION PTR            S21045 13030021
         USING DEBEXT,R15                                        S21045 13035021
         L     R15,DEBWKPT5              ADDRESS OF PART 2 IN    S21045 13040021
*                                       R15                      S21045 13045021
         DROP  R15                                               S21045 13050021
         USING IHAPART2,R15                                             13060000
         B     APPN7A3                  BRANCH TO CP10A CHART           13080000
         USING APP,R15                                                  13100000
APPU3F3  L     R12,DCBNREC              ADD 1 TO NUMBER OF PRIME DATA   13120000
         LA    R12,1(0,R12)              RECORDS - A LOGICAL RECORD     13140000
         ST    R12,DCBNREC               WILL REPLACE A PADDING RECORD. 13160000
         OI    IOBFLAG1,X'C0'           SET FLAGS TO ALLOW CC AND DC    13180000
         LA    R12,CK1                  START AT CK1                    13200000
         ST    R12,IOBSTART-1                                           13220000
         MVC   IOBDADAD(3),DCBLPDA      SET IOB SEEK                    13240000
         MVC   IOBDADAD+3(5),DCBLETI                                    13260000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CK1 AND CK4  13280000
         ST    R12,CK1                                                  13300000
         MVI   CK1,X'31'                                                13320000
         MVC   CK4(4),CK1              MOVE OP CODE AND ID TO CK4       13340000
         MVC   CK6+1(3),DECBKEY+1                                       13360000
         MVI   IOBAPP,X'12'             SET APPENDAGE CODE TO 18        13380000
         B     APPRVXCP                 EXCP RETURN TO IOS              13400000
         EJECT                                                          13420000
*              CP13A WHEN USED FOR ADD-TO-END, CHART U3                 13440000
APPU3B2  L     R13,CF3                  Z PLUS RL INTO R13              13460000
         LA    R13,0(R0,R13)                                            13480000
         SH    R13,DCBLRECL             POINT TO RCV ADDRESS, Z         13500000
APPU3B22 L     R10,DECBKEY              POINT TO KEY OF INSERT          13520000
         LR    R12,R13                                                  13540000
         AH    R12,DCBLRECL                                             13560000
         AH    R12,DCBRKP               POINT TO SEND AREA'S KEY        13580000
         IC    R9,DCBKEYLE                                              13600000
         BCTR  R9,R0                    COMPARE KEYLENGTH BYTES         13620000
         EX    R9,APPU1C32              COMPARE INSERT TO SEND          13640000
         BNH   APPU3B3                  INSERT                          13660000
         SH    R12,DCBRKP               ADJUST SEND ADDRESS             13680000
         BAL   R3,APPMOV10              MOVE FORWARD ONE RECORD         13700000
*                       GIVE UNREACHABLE BLOCK CONDITION IF NO KEY      13701018
*                       IN FIRST BLOCK READ IS HIGHER THAN KEY          13702018
*                       TO BE ADDED                                     13703018
         L     R10,IOBCCWAD             GET CP ADDRESS AGAIN      24080 13704018
         L     R3,CF3                   ADDRESS OF BLOCK READ     24080 13705018
         LA    R3,0(0,R3)                                         24080 13706018
         AH    R3,DCBBLKSI              ADDRESS OF END OF BLOCK   24080 13707018
         CR    R12,R3                   NEXT LRECL TO BE MOVED VS 24080 13708018
*                                       END OF BLOCK                    13709018
         BNL   APPN3B1                  BRANCH IF BEYOND END     A29928 13714019
         B     APPU3B22                 AND LOOP                        13720000
APPU3B3  L     R12,DECBAREA             EXCP RETURN TO IOS              13740000
         LA    R12,16(R0,R12)           MOVE AREA PLUS 16               13760000
         BAL   R3,APPMOV10              INSERT NEW RECORD               13780000
         IC    R9,IOBDADAD+7                                            13800000
         BCTR  R9,R0                                                    13820000
         STC   R9,IOBDADAD+7            REDUCE R BY 1                   13840000
         L     R10,DCBWKPT3             CHANNEL PROGRAM POINTER         13860000
         L     R3,CF2+4                                                 13880000
         USING CP13B,R3                 ESTABLISH ADDRESSABILITY S20201 13890020
         LA    R3,CG1                   CG1 WITH HI BYTE = 0     S20201 13900020
         LA    R12,CG4                                           S20201 13910020
         NI    CG5+FOUR,X'FF'-CC        CC OFF AT CG5            S20201 13920020
         ST    R12,CG2+FOUR             SAVE A(LAST KEY) AT CG2  S20201 13930020
         LA    R12,CG5+EIGHT            A(1ST CG5+8)             S20201 13940020
         BAL   R11,APPU1GA                                        17332 13972018
         L     R12,CG2+FOUR             RESTORE A(LAST KEY)      S20201 13974020
         USING IHADEB,R3                ESTABLISH ADDRESSABILITY S20201 13977020
         L     R12,8(R0,R12)            POINT TO LAST WRITE DATA        13980000
         AH    R12,DCBBLKSI             ADD AL                          14000000
         SH    R12,DCBLRECL             SUBTRACT RL                     14020000
         BAL   R13,APPPAD10             IS RECORD PADDING               14040000
         B     APPU1J4                  YES. CONTINUE PADDING CHECK     14060000
         B     APPU1K2                  NO.  GO TO SET UP CP13B START   14080000
         EJECT                                                          14100000
*              ABNORMAL END CP13A,  APPENDAGE CODE 20,         CHART U4 14120000
APPU4B2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     14140000
         BC    PERRNO,APPRVNOR          NO.  NORMAL RETURN TO IOS       14160000
         TM    IOBSENSE,X'08'           CONTINUE IF CAUSE DATA CHECK    14180000
         BZ    APPN3B3                  OTHERWISE, RECORD IS UNRCHBLE   14200000
         LA    R13,CF2+8                                                14220000
         CLR   R12,R13                                                  14240000
         BNH   APPN3B3                  NO.  RECORD UNRCHBLE, BRANCH    14260000
APPU4E2  OI    DECBEXC1,X'08'           YES. UNCORRECTABLE I/O ERROR    14280000
         B     APPN3B4                                                  14300000
         EJECT                                                          14320000
*              ABNORMAL END CP13B,  APPENDAGE CODE 21,         CHART U4 14340000
APPU4G2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     14360000
         BC    PERRNO,APPRVNOR          NO.  NORMAL RETURN TO IOS       14380000
         L     R13,CF2+4                CG1 POINTER                     14400000
         USING CP13B,R13                ESTABLISH ADDRESSABILITY S20201 14410020
         TM    CG2+FOUR,KADDRCHG        WAS KEY ADDR CHANGED     S20201 14420020
         BZ    APPU4J1+6                NO.  BRANCH                     14440000
         LA    R12,CG4                  CG4 POINTER              S20201 14460020
APPU4H1  TM    12(R12),X'40'                 WAS CC ON                  14480013
         BZ    APPU4J1                                                  14500013
         LA    R12,24(R0,R12)           YES. TRY NEXT SEQUENCE          14520000
         B     APPU4H1                  LOOP                            14540000
APPU4J1  MVC   ONE(THREE,R12),CG2+FIVE  RESTORE KEY ADDRESS      S20201 14560020
         TM    IOBSENSE,X'08'           WAS CAUSE DATA CHECK            14580000
         BZ    APPN3B3                  NO.  BRANCH UNREACHABLE         14600000
         L     R12,IOBCSW               DID CP STOP AT WR CCW           14620000
         LA    R13,CG4                  CG4 ADDR                 S20201 14640020
         LA    R12,0(R0,R12)                                            14680000
         CLR   R12,R13                                                  14700000
         BL    APPN3B3                  BRANCH IF NOT TO UNRCHBLE       14720000
         B     APPU4E2                                                  14740000
         EJECT                                                          14760000
*              CHANNEL  END CP13C,  APPENDAGE CODE 24,         CHART U6 14780000
APPU6B2  LA    R13,CL7+8                                                14800000
         CLR   R12,R13                                                  14820000
         BNE   APPN3B3                  NO.  BRANCH UNREACHABLE         14840000
         B     APPN3B4                  YES. SCHEDULE COMPLETION        14860000
         EJECT                                                          14880000
*              ABNORMAL END CP13C,  APPENDAGE CODE 24,         CHART U6 14900000
APPU6A4  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     14920000
         BC    PERRNO,APPRVNOR          NO.  NORMAL RETURN TO IOS       14940000
         TM    IOBSENSE,X'08'           YES. CONT. IF CAUSE DATA CHECK  14960000
         BZ    APPN3B3                  OTHERWISE BRANCH UNREACHABLE    14980000
         LA    R13,CL7+8                                                15000000
         CLR   R12,R13                                                  15020000
         BNE   APPN3B3                  NO.  BRANCH UNREACHABLE         15040000
         OI    DECBEXC1,X'08'           YES. UNCORRECTABLE I/O ERROR    15060000
         B     APPN3B4                  BRANCH                          15080000
         EJECT                                                          15100000
*              CHANNEL  END CP15,   APPENDAGE CODE 14,         CHART M1 15120000
APPM1B2  LA    R13,CI4+8                DID CHAN PROG STOP AT CI4       15140000
         CLR   R12,R13                  BE MEANS YES, BNE MEANS NO      15160000
         BNE   APPM1B3                  NO - RECORD IS UNREACHABLE      15180000
*              SIMULATE CHART U5 SUBROUTINE                             15200000
         L     R12,DCBWKPT2                                             15220000
         USING IHADCW,R12                                        S20201 15230020
         OI    DCWWKNI,X'10'            SET ADD-TO-END INDICATOR ON     15240000
         CLI   DCBFIRSH+TWO,ONE         TEST FOR SHARED TRACK    A46955 15246021
         BNH   APPM1B20                 NO                       A46955 15252021
         CLC   DCBFIRSH(2),DCBLPDA+5    END OF SHARED TRACK        7851 15260000
         BE    APPM1B2A                                            7851 15280000
APPM1B20 EQU   *                        *                        A46955 15290021
         MVC   DCWHIRPS(1),DCBHIRPD                                7851 15300000
         B     APPM1B2B                                            7851 15320000
APPM1B2A MVC   DCWHIRPS(1),DCBHIRSH                                7851 15340000
APPM1B2B EQU   *                                                   7851 15360000
         TM    DCBST,X'02'              IS LAST BLOCK FULL              15380000
         BO    APPU5B3                  BO IF YES                       15400000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            15420000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          15440000
         LA    R12,CF1                  START AT CF1                    15460000
         ST    R12,IOBSTART-1                                           15480000
         MVC   IOBDADAD,DCBLPDA         SEEK TO LAST RECORD             15500000
         LA    R12,IOBDADAD+3           PUT IOB ADDRESS IN CL5 AND CG1  15520000
         STH   R12,CL5+2                                                15540000
         SRL   R12,16                                                   15560000
         STC   R12,CL5+1                                                15580000
         L     R13,CF2+FOUR             POINT TO CG1             S20201 15590020
         USING CP13B,R13                ESTABLISH ADDRESSABILITY S20201 15600020
         MVC   CG1+ONE(THREE),CL5+ONE   MOVE IOBSEEK TO CP13B    S20201 15610020
         MVC   CB50(FOUR),CG5           MOVE DATA ADDR TO CB50   S20201 15620020
         MVI   CF3+4,X'00'                                              15640000
         L     R12,DCBMSWA                                              15660000
         MVC   0(5,R12),IOBDADAD+3                                      15680000
         MVC   5(1,R12),DCBKEYLE                                        15700000
         MVC   6(2,R12),DCBBLKSI        ASSEMBLE COUNT FIELD AT W       15720000
         MVI   IOBAPP,X'14'             SET APPENDAGE CODE TO 20        15740000
         B     APPRVXCP                                                 15760000
APPU5B3  TM    DCBST,X'01'              IS LAST TRACK FULL              15780000
         BO    APPM1C2                  BO IF YES, TO SET UP CP16       15800000
         L     R12,DECBAREA             NO - MOVE RECORD FROM           15820000
         LA    R12,16(R0,R12)           AREA+16 TO Z                    15840000
         L     R13,CF3                                                  15860000
         LA    R13,0(R0,R13)                                            15880000
         SH    R13,DCBLRECL                                             15900000
*              SIMULATE GENERALIZED MOVE SUBROUTINE                     15920000
         LA    R9,255(R0,R0)            PLACE 255 IN IR 9               15940000
         LH    R10,DCBLRECL             RCD LGTH IN IR 10               15960000
         BCTR  R10,R0                   LRECL MOVES REQD                15980000
APPU5B3B CLR   R10,R9                   LGTH REMAINDER MORE THAN 255    16000000
         BNH   APPU5B3C                 BRANCH LAST TIME                16020000
         MVC   0(255,R13),0(R12)        MOVE 255 CHS                    16040000
         SR    R10,R9                   REDUCE LGTH REMAINDER BY 255    16060000
         AR    R12,R9                   INCREASE INDEXING BY 255        16080000
         AR    R13,R9                                                   16100000
         B     APPU5B3B                 LOOP                            16120000
APPU5B3D MVC   0(0,R13),0(R12)          EXECUTED MOVE                   16140000
APPU5B3C EX    R10,APPU5B3D             MOVE 255 OR FEWER BYTES         16160000
         L     R10,IOBCCWAD             RESTORE REGISTER 10             16180000
         L     R12,CF3                  FORM PADDING RCDS AS FOLLOWS    16200000
         LA    R12,0(R0,R12)            Z+RL TO REG 12                  16220000
         LR    R13,R12                                                  16240000
         AH    R13,CF3+6                Z+RL+AL TO REG 13               16260000
         SH    R13,DCBLRECL             Z+AL TO REG 13                  16280000
         CLR   R12,R13                  IS PADDING NECESSARY      12244 16286016
         BE    APPU5C4B                 NO--BRANCH (1 REC/BLOCK)  12244 16292016
APPU5C4A MVI   0(R12),X'FF'             PAD                             16300000
         LA    R12,1(R0,R12)            INCREMENT                       16320000
         CLR   R12,R13                                                  16340000
         BL    APPU5C4A                 LOOP                            16360000
         NI    DCBST,X'FD'              LAST BLOCK NOT FULL       12244 16366016
APPU5C4B EQU   *                                                  12244 16372016
         MVI   IOBAPP,X'17'             SET APPENDAGE CODE TO 23        16380000
         MVC   IOBDADAD+3(5),DCBLPDA+3   PUT LPDA CCHHR IN IOB          16420000
         MVC   CB51(4),IOBDADAD+3       MOVE DCBLPDA CCHHR TO CB51      16440000
         IC    R12,IOBDADAD+7            THEN INCREASE CB51 R BY 1      16460000
         LA    R12,1(R0,R12)                                            16480000
         STC   R12,CB51+4                                               16500000
         OI    IOBFLAG1,X'C0'           USE DATA AND COMMAND CHAINING   16520000
         LA    R12,CB46                 START AT CB46                   16540000
         ST    R12,IOBSTART-1                                           16560000
         LA    R12,IOBDADAD+3           MOVE IOB ADDRESS TO CB46        16580000
         STH   R12,CB46+2                                               16600000
         SRL   R12,16                                                   16620000
         STC   R12,CB46+1                                               16640000
         MVC   CB49+1(3),DECBKEY+1      MOVE KEY  ADDRESS TO CB49       16660000
         L     R12,CF2+4                                                16680000
         L     R12,32(R0,R12)                                           16700000
         ST    R12,CB50                 MOVE DATA ADDRESS TO CB50       16720000
         B     APPRVXCP                 EXCP RETURN TO IOS              16740000
APPM1C2  EQU   *                                                        16760000
         TM    CB26,X'08'               WAS ENTRY READ IN CB25 OFLO END 16780000
         BZ    APPM1D3                  YES  M1D3                       16800000
         MVC   IOBDADAD,CB25            MOVE CB25 MBBCCHHR TO IOB       16820000
         MVI   IOBAPP,X'0F'             SET APPENDAGE CODE TO 15        16840000
         NI    IOBFLAG1,X'7F'           DONT USE DATA CHAINING          16860000
         OI    IOBFLAG1,X'40'           USE COMMAND CHAINING            16880000
         LA    R12,CJ1                  START AT CJ1                    16900000
         ST    R12,IOBSTART-1                                           16920000
         LA    R12,IOBDADAD+3           MOVE IOB ADDRESS TO CJ1 AND CJ5 16940000
         ST    R12,CJ1                                                  16960000
         MVI   CJ1,SIDEQ                RESTORE COMMAND CODE     S20201 16970020
         MVC   CJ5+ONE(THREE),CJ1+ONE   MOVE IN ADDR OF SEEK     S20201 16980020
         MVC   CJ3+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 16990020
         MVC   CJ7+ONE(THREE),DECBKEY+ONE  MOVE IN ADDR OF KEY   S20201 17000020
         LA    R12,0(R0,R0)             CMP TRK INDEX AND OFLO RCD MODL 17120000
         IC    R12,CB25                  ARE THEY THE SAME              17140000
         SLL   R12,4(R0)                                                17160000
         L     R12,DEBUCBAD(R12)        GET UCB ADDR FROM DEB    S20201 17180020
         LA    R12,0(R0,R12)                                            17200000
         CLR   R12,R7                                                   17220000
         BE    APPRVXCP                 YES - EXCP RETURN TO IOS        17240000
         MVI   IOBASYN,X'01'                                            17260000
         B     APPM1D4                  EXCP IN ASYNCHRONOUS ROUTINE    17280000
APPM1D3  MVI   IOBASYN,X'0A'            SET ASYNCHRONOUS CODE TO 10     17300000
APPM1D4  NI    IOBINDCT,X'DF'           INDICATE OFLO RECORD IN AREA    17320000
         B     APPM1B5                  SCHEDULE ASYNCHRONOUS ROUTINE   17340000
APPM1B3  OI    DECBEXC1,X'04'           RECORD IS UNREACHABLE           17360000
APPM1B4  MVI   IOBASYN,X'08'            SCHEDULE PROCESSING COMPLETION  17380000
APPM1B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 17400002
APPN3B21 LA    R13,APPN3B2                                              17480000
         BC    15,APPN3B22                                              17500000
APPM1B21 LA    R13,APPM1B2                                              17520000
APPN3B22 BR    R13                      NULL ROUTINE             Y02072 17540002
         DROP  R13                                               A37184 17660021
APPRVXCP SR    R12,R12                                                  17680000
         IC    R12,IOBDADAD                                             17700000
         SLL   R12,4                                                    17720000
         L     R3,RQEDEB                ADDR OF CURRENT DEB      Y02072 17730002
         LA    R12,DEBUCBAD(R12)        POINT TO CURRENT EXTENT  S20201 17760020
         MVC   IOBDADAD+1(2),4(R12)           MOVE IN BB                17780000
         LA    R14,EXCP(R14)            SETUP FOR EXCP IOS RETURN 15924 17785016
         XC    IOBFLAG2(3),IOBFLAG2     CLEAR FLAG2,SENSE BYTES   15924 17790016
         XC    IOBCSW(9),IOBCSW         CLEAR FLAG3,CSW,AND SIOCC 15924 17795016
         XC    IOBERRCT(2),IOBERRCT     CLEAR ERROR COUNT         15924 17800016
         NI    IOBFLAG1,X'C2'           RESET FLAG1               15924 17805016
APPRVNOR BR    R14                      RETURN TO IOS             15924 17810016
         EJECT                                                          17820000
*              ABNORMAL END CP15,   APPENDAGE CODE 14,         CHART M1 17840000
APPM1J2  TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     17860000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       17880000
         B     APPM1B3                  YES  M1B3                       17900000
*                                                                       17900402
MODID    DC    C'IGG019G6'              MODULE NAME            @ZA26522 17900537
DATE     DC    CL8'&SYSDATE'            FIX DATE               @ZA26522 17900637
FIX      DC    C' OZ26522'              LATEST FIX             @ZA26522 17900737
PATCH    DC    XL((*-IGG019G6)/20)'00'  ZEROED PATCH AREA        Y02072 17900802
*                                                                       17901202
         SPACE 5                                                        17902002
RQE      IECDRQE ,                      RQE                      Y02072 17910002
         EJECT                                                          17920000
*                             RETURN TO IOS VECTOR TABLE                17980000
CVT      DSECT                                                          18100000
         CVT                                                            18120021
IHAPART2 DSECT                                 PART2 VECTOR      A37184 18140021
*                                       TABLE                    A37184 18160021
*        ROUTINE FOR          CODE      CEND COMPLETION OF              18180000
APPM67CE DS    CL6            7         CP1 OR CP2, WRITE KN            18200000
APPN7B2  DS    CL6            9,23      CP10A                           18220000
APPN8A2  DS    CL6            10,11     CP10B                           18240000
APPM4A2  DS    CL6            12        CP14  - SETUPS 1, 2, OR 5       18260000
APPM5A2  DS    CL6            13        CP14  - SET UPS 3, 4, OR 6      18280000
APPM2B2  DS    CL6            15        CP16 - SITUATION 2              18300000
APPM3B2  DS    CL6            16        CP16 - SITUATION 3              18320000
APPN9A2  DS    CL6            17,18,19  CP17                            18340000
APPAFB   DS    CL6                                                17332 18350018
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              18360000
APPM67AE DS    CL6            7         CP1 OR CP2, WRITE KN            18380000
APPN7J2  DS    CL6            9,23      CP10A                           18400000
APPN8G2  DS    CL6            10,11     CP10B                           18420000
APPM4E2  DS    CL6            12        CP14  -SETUPS 1, 2, OR 5        18440000
APPM5E2  DS    CL6            13        CP14  -SETUPS 3, 4, OR 6        18460000
APPM2H2  DS    CL6            15,16     CP16                            18480000
APPN9G4  DS    CL6            17,18,19  CP17                            18500000
APPAEB   DS    CL6                                                17332 18510018
APPN7A3  DS    CL4            CONTINUATION OF ROUTINES BEGUN IN         18520000
APPN7B4  DS    CL4                 PART 1                               18540000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              18560000
APPABA2  DS    CL6            0,1       CP4/CP5                         18580000
APPADB2  DS    CL6            2         CP7                             18600000
APPAAB2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     18620000
APPACA2  DS    CL6            5         CP6                             18640000
*        ROUTINE FOR          CODE     ABEND COMPLETION OF              18660000
APPABD2  DS    CL6            0,1       CP4/CP5                         18680000
APPADE2  DS    CL6            2         CP7                             18700000
APPAAA2  DS    CL6            3         CP1 OR CP2, READ AND UPDATE     18720000
APPACE2  DS    CL6            5         CP6                             18740000
         EJECT                                                          18760000
*        WRITE KEY NEW CHANNEL PROGRAM REFERENCES (NO WRITE CHECK)      18860020
IHAWKNCP IGGWKNCP                                                       19060020
         IGGCP13C                                                       19360020
         IGGCP13A                                                       19760020
CP13B    DSECT                                                          20160020
         IGGCP13B                                                       20460020
         EJECT                                                          21360000
*              DATA EVENT CONTROL BLOCK                                 21380000
IHADECB  DSECT                                                          21400000
         DS    0F                                                       21420000
DECBECB  DS    CL4                      EVENT CONTROL BLOCK (ECB)       21440000
DECBTYP1 DS    BL1                      TYPE B6 - 1 IF LENGTH IS S      21460000
*                                            B7 - 1 IF AREA IS S        21480000
DECBTYP2 DS    BL1                           B0 - 1 IF READ K           21500000
*                                            B1 - 1 IF READ KX          21520000
*                                            B2 - 1 IF READ KU          21540000
*                                            B4 - 1 IF WRITE K          21560000
*                                            B5 - 1 IF WRITE KN         21580000
DECBLGTH DS    CL2                      LENGTH OF BLOCK                 21600000
DECBDCBA DS    A                        POINTER TO DCB                  21620000
DECBAREA DS    A                        ADDRESS OF AREA                 21640000
DECBLOGR DS    A                        POINTER TO LOGICAL RECORD       21660000
DECBKEY  DS    A                        POINTER TO KEY                  21680000
DECBEXC1 DS    BL1                      EXCPTN CD B0-RECORD NOT FOUND   21700000
*                                                 B1-RECORD LGTH CHK    21720000
*                                                 B2-NO SPACE           21740000
*                                                 B3-INVALID REQUEST    21760000
*                                                 B4-UNCORRECTABLE IO   21780000
*                                                 B5-UNREACHABLE BLOCK  21800000
*                                                 B6-OVERFLOW RECORD    21820000
*                                                 B7-DUPLICATE          21840000
DECBEXC2 DS    BL1                                B7-READ KU            21860000
         EJECT                                                          21880000
         DCBD  DSORG=(IS)                                               21900000
         EJECT                                                          21920000
IHAIOB   IGGIOBD                                                        22020020
         EJECT                                                          23240000
IHADCW   IGGBISAM                                                       23300020
         EJECT                                                          23780000
IHADEB   IGGDEBD                                                        23840020
         END                                                            24679900
