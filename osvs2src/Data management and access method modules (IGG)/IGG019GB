 TITLE 'IGG019GB  - PUT, WR CHK'                                        00020000
IGG019GB CSECT                                                          00028000
*          RELEASE OS/VS2-02 DELETIONS                                * 00036002
*D078000                                                        YM03178 00036102
*                                                               YM05395 00036202
*                                                               YM06516 00036302
*                                                                     * 00036402
*          RELEASE 19 DELETIONS                                       * 00060000
*2182215000                                                      A27810 00064019
*          RELEASE 20 DELETIONS                                       * 00068000
*0751357400,363400,374800,378600,386700,398100                   M5864  00068320
*0751344300,357200-358200,363200-363600,371000,374600-375400,    A37537 00068620
*0751378000-379200,382900,386200-387200,397600-398600            A37537 00069220
*0751062860-062880,066200-066600,082260-082440                   A32496 00070020
*0751062840,063400-063600                                        A31998 00072020
*0751069600-069700                                               M1857  00074020
*                                                                S20201 00084020
*1202289500-290300                                               M0170  00086021
*1202106400-106600                                               A42181 00089021
*1202282400                                                      A41405 00094021
*1202147500                                                      A46109 00099021
*D062920                                                         XM6075 00101000
*        VS2 030 PTF CHANGES                                   @ZA07607 00101637
*C071800,073260,216600                                         @ZA07607 00102237
*A073220-074600                                                @ZA07607 00102837
*A0741700-074200,C078600                                       @ZA10227 00103037
*A216500                                                       @ZA10226 00103237
*D198800,199000                                                @ZA28406 00103337
*                                                                       00103437
* STATUS CHANGE LEVEL 010                                               00104002
*FUNCTION/OPERATION- THIS MODULE CONTAINS THE BASIC LOAD MODE PUT     * 00120000
*   ROUTINES. THESE ROUTINES INVOLVE RECORD PROCESSING FOR MOVE MODE  * 00140000
*   AND FOR LOCATE MODE, BUFFER MANAGEMENT, CHANNEL PROGRAM INITIAL-  * 00160000
*   IZATION, AND CHANNEL PROGRAM EXECUTION.                           * 00180000
*                                                                     * 00200000
*ENTRY POINTS- 'IGG019GB' (ISLFX01) IS THE ENTRY FOR A LOAD MODE PUT  * 00220000
*   MACRO INSTRUCTION. THE GENERATED CALLING SEQUENCE IS,             * 00240000
*   LA   1,DCB                                                        * 00260000
*   LA   0,RECORD   FOR MOVE MODE                                     * 00280000
*   L    15,48(0,1)                                                   * 00300000
*   BALR 14,15                                                        * 00320000
*                                                                     * 00340000
*INPUT- REGISTER 0  -POINTS TO USERS RECORD IN WORK AREA (MOVE MODE). * 00360000
*       REGISTER 1  -POINTS TO DCB.                                   * 00380000
*       REGISTER 13 -POINTS TO USER SAVE AREA.                        * 00400000
*       REGISTER 14 -POINTS TO RETURN FROM PUT                        * 00420000
*                                                                     * 00440000
*OUTPUT- REGISTER 1 -POINTS TO NEXT AVAILABLE SPACE IN OUTPUT BUFFER  * 00460000
*                    (LOCATE MODE).                                   * 00480000
*        REGISTER 1 -POINTS TO BAD BUFFER IF WRITE ERROR OCCURRED.    * 00500000
*        REGISTER 0 -POINTS TO IOB IF WRITE ERROR OCCURRED.           * 00520000
*        REGISTER 14-POINTS TO RETURN TO CLOSE IF WRITE ERROR         * 00540000
*                      OCCURRED DURING CLOSE.                         * 00560000
*                                                                     * 00580000
*EXTERNAL ROUTINES- 'IGG019GD'-CHANNEL PROGRAM APPENDAGE ROUTINES     * 00600000
*   USED TO PROCESS I/O RETURNS. ALSO, CHANNEL PROGRAMS AND IOS.      * 00620000
*                                                                     * 00640000
*EXITS-NORMAL- (ISLFX13), USER RECORD HAS BEEN PROCESSED SUCCESSFULLY.* 00660000
*     -ERROR-  (ISLFX05), AN ERROR OCCURRED DURING THE PROCESSING OF  * 00680000
*   THE USER RECORD. THE ERROR CONDITION IS FLAGGED AS FOLLOWS,       * 00700000
*   DCBEXCD1 BIT 5 ON = WRITE ERROR, REG 1 POINTS TO BAD BUFFER       * 00720000
*                                    REG 0 POINTS TO IOB              * 00740000
*   DCBEXCD1 BIT 2 ON = SPACE ERROR, NOT ENOUGH SPACE FOR DATA SET.   * 00760000
*   DCBEXCD2 BIT 1 ON = DUPLICATE KEY.                                * 00780000
*   DCBEXCD2 BIT 0 ON = KEY OUT OF SEQUENCE.                          * 00800000
*                                    REG 0 POINTS TO HIGH KEY     20852 00810000
*                                                                     * 00820000
*TABLES/WORK AREAS-                                                   * 00840000
*   DCB      - COMMUNICATION WITH USER.                               * 00860000
*   DEB      - COMMUNICATION WITH IOS                                 * 00880000
*   ISLCOMON - COMMUNICATION WITHIN LOAD MODE.                        * 00900000
*   ISLIOBA  - COMMUNICATION WITH I/O FOR CP18 AND 20.                * 00920000
*   ISLIOBB  - COMMUNICATION WITH I/O FOR CP21.                       * 00940000
*   ISLIOBC  - COMMUNICATION WITH I/O FOR CP19.                       * 00960000
*   ISLAREAZ - WORK AREA USED FOR PREFORMATTING.                      * 00980000
*   ISLIXLT  - INDEX LOCATION TABLE, LOCATES HI-LEVEL INDICIES.       * 01000000
*   ISLY     - WORK AREA USED WHEN WRITING INDICIES.                  * 01020000
*   ISLVPTRS - VARIABLE POINTERS, REFERENCE VARIABLE LENGTH BLOCKS.   * 01040000
*   IOBBCT   - BUFFER CONTROL TABLE, CONTROLS BUFFER USAGE.           * 01060000
*                                                                     * 01080000
*ATTRIBUTES- READ ONLY, REENTRANT, REUSABLE.                          * 01100000
*                                                                     * 01120000
*NOTES- THIS MODULE, TOGETHER WITH THE APPENDAGE MODULE 'IGG019GD',   * 01140000
*   AND THE CHANNEL PROGRAMS, CREATE THE ISAM DATA SET WHEN WRITE-    * 01160000
*   CHECKING IS SPECIFIED. ALL OTHER LOAD MODE MODULES MERELY PROVIDE * 01180000
*   THE OPEN AND CLOSE FUNCTIONS.                                     * 01200000
*       SECTIONS OF THE PROCESSING IN THIS MODULE ARE ENTERED         * 01220000
*   DIRECTLY FROM CLOSE PROCESSING. IN SUCH CASES, PROCESSING IS      * 01240000
*   CARRIED ON AS THOUGH IT WAS PART OF CLOSE.                        * 01260000
*        ENTRY POINTS - ISLFX01                                       * 01280000
*                     - ISLFX20                                       * 01300000
*                     - ISLFY01                                       * 01320000
*                     - ISLFZ01                                       * 01340000
*                     - ISLPA01                                       * 01360000
*                                                                     * 01380000
*    ****************************************************************** 01400000
*    THE FOLLOWING NOTATION IS FREQUENTLY USED THROUGHOUT COMMENTS -  * 01420000
*              C(FIELD X) = A(FIELD Y)                                * 01440000
*     CONTENTS OF FIELD X = ADDRESS OF FIELD Y                        * 01460000
*                                                                       01480000
*                                                                     * 01500000
         EJECT                                                          01520000
IGG019GB CSECT                                                          01540000
********************                                                    01560000
* DCB REFERENCE    *                                                    01580000
********************                                                    01600000
*                                                                       01620000
         DCBD  DSORG=(IS)                                               01640000
         USING IHADCB,R1                                                01660000
         EJECT                                                          01680000
********************                                                    01700000
* DEB REFERENCE    *                                                    01720000
********************                                                    01740000
*                                                                       01760000
IHADEB   IGGDEBD                                                        01770020
DEBXTN   DSECT                                                          01772002
DEBXLNGH  DS   H                        LENGTH DEB EXTENSION            01774002
DEBXFLG1  DS   B                        FLAG BYTE                       01776002
DEBXTSKC EQU   X'40'                    TASK CLOSE CLOSING DCB          01778002
         USING IHADEB,R8                                         S20201 01780020
         EJECT                                                          02480000
ISLCOMON IGGLOAD                                                        02490020
         USING ISLCOMON,R12                                      S20201 02500020
*                                                                       03840000
* IOBBCT REFERENCE         C(ISLVPTRS+8)=A(IOBBCT)                      03860000
*                                                                       03880000
IOBBCT   DSECT                                                          03900000
         USING IOBBCT,R11                                               03920000
         DS    0D                                                       03940000
IOBFLAGS DS    0CL1                     FLAGS                           03960000
IOBPTRA  DS    A                        PTR A                           03980000
IOBB     DS    0CL1                     B                               04000000
IOBPTRB  DS    A                        PTR B                           04020000
IOBS     DS    0CL1                     S - STATUS FIELD FOR BUF NO 1   04040000
IOBABUF  DS    A                        A(BUF NO 1) - ADR OF BUF NO 1   04060000
*                                                                       04080000
*------------------ VARIABLE AREA ------------------------------------  04100000
*                                                                       04120000
*        --                                                             04140000
*        --                                                             04160000
*        --                                                             04180000
*        --                                                             04200000
*                                                                       04220000
* ISLY REFERENCE           C(ISLVPTRS)=A(ISLY)                          04240000
*                                                                       04260000
ISLY     DSECT                                                          04280000
         USING ISLY,R9                                                  04300000
         DS    0D                                                       04320000
         DS    CL8                      CYL-MAST IX    COUNT    Y+0     04340000
         DS    CL10                                    DATA     Y+8     04360000
         DS    CL8                      TRK IX NORM    COUNT    Y+18    04380000
         DS    CL10                                    DATA     Y+26    04400000
         DS    CL8                      TRK IX OVFL    COUNT    Y+36    04420000
         DS    CL10                                    DATA     Y+44    04440000
         DS    CL8                      TRK IX DUMM    COUNT    Y+54    04460000
*        DS    CL(IL)                                  KEY 1S   Y+62    04480000
*        DS    CL10                                    DATA     Y+62+IL 04500000
*                                                                       04520000
         EJECT                                                          04540000
IHAIOB   DSECT                                                          04560000
         USING IHAIOB,R2                                                04580000
         DS    0D                                                       04600000
IOBFLG1  DS    CL1                      FLAGS 1                         04620000
IOBFLG2  DS    CL1                      FLAGS 2                         04640000
         DS    CL1                                                      04660000
IOBSENSE DS    CL1                      SENSE                           04680000
IOBECBAD DS    A                        ECB POINTER                     04700000
IOBCSW   DS    CL8                      CHANNEL STATUS WORD             04720000
IOBSIOCC DS    0CL1                     SIO CC                          04740000
IOBCPSAD DS    A                        CHANNEL PROG START ADR          04760000
IOBWT    DS    0CL1                     WEIGHT                          04780000
IOBDCBAD DS    A                        DCB POINTER                     04800000
IOBCPRAD DS    A                        CHANNEL PROG RESTART ADR        04820000
IOBBCTI  DS    CL2                      BLK CTR INCR                    04840000
IOBECT   DS    CL2                      ERROR CTR                       04860000
IOBDADAD DS    CL8                      DIR ACCESS DEV ADR MBBCCHHR     04880000
*                                                                       04900000
IXLT     DSECT                                                          04920000
         USING IXLT,R7                                                  04940000
         DS    0D                                                       04960000
IXLTIND  DS    CL1                      INDICATOR                       04980000
IXLBEG   DS    CL8                      BEGINING COUNT MBBCCHHR         05000000
IXLSTP   DS    CL8                      STEPPING COUNT MBBCCHHR         05020000
IXLEND   DS    CL8                      ENDING COUNT   NBBCCHHR         05040000
         DS    CL1                                                      05060000
         DS    CL26                                                LEV2 05080000
         DS    CL26                                                LEV3 05100000
         DS    CL26                                                LEV4 05120000
         EJECT                                                          05125020
CPSX     DSECT                                                          05130020
         IGGLDCP OPTCD=W,RECFM=F        LOAD CHANNEL PROGRAMS    S20201 05135020
         EJECT                                                          05140000
         IKJRB DSECT=YES                                        YM03178 05142002
         SPACE 4                                                        05148002
         IHAPSA                                                 YM05395 05148402
         EJECT                                                          05150002
*********************************************************************** 05160000
* ISL PUT - BEGIN                                                     * 05180000
*********************************************************************** 05200000
*                                                                       05220000
*                                                                       05240000
IGG019GB CSECT                                                          05260000
ISLF800  SAVE  (14,12)                  SAVE USERS REGS                 05280000
         BALR  R15,0                                                    05300000
         USING *,R15                                                    05320000
         B     ISLFX01                                                  05340000
         B     ISLFX20                                                  05360000
         B     ISLFY01                                                  05380000
         B     ISLFZ01                                                  05400000
         B     ISLPA01                                                  05420000
*                                                                       05440000
* EQUATE SYMBOLIC REGISTERS                                             05460000
*                                                                       05480000
R0       EQU   0                                                        05500000
R1       EQU   1                                                        05520000
R2       EQU   2                                                        05540000
R3       EQU   3                                                        05560000
R4       EQU   4                                                        05580000
R5       EQU   5                                                        05600000
R6       EQU   6                                                        05620000
R7       EQU   7                                                        05640000
R8       EQU   8                                                        05660000
R9       EQU   8                                                        05680000
R10      EQU   10                                                       05700000
R11      EQU   11                                                       05720000
R12      EQU   12                                                       05740000
R13      EQU   13                                                       05760000
R14      EQU   14                                                       05780000
R15      EQU   9                                                        05800000
R16      EQU   15                                                       05820000
CVTPTR   EQU   16                                                       05840000
RSLOAD   EQU   X'20'                    DCBST - RESUME LOAD      S20201 05842020
*                                       *       INDICATOR               05844020
K1       EQU   1                        CONSTANT                 S20201 05846020
L3       EQU   3                        LENGTH                   S20201 05848020
K3       EQU   3                        CONSTANT                 S20201 05850020
K24      EQU   24                       CONSTANT                 S20201 05852020
K8       EQU   8                        CONSTANT                 S20201 05854020
K7       EQU   7                        CONSTANT                 S20201 05856020
K4       EQU   4                        CONSTANT                 S20201 05858020
*                                                                       05860000
L4       EQU   4                        LENGTH                   S20201 05866020
K0       EQU   0                        CONSTANT                 S20201 05872020
COMPLETE EQU   X'40'                    IOB COMPLETED            A42181 05872621
IOERROR  EQU   X'04'                    DCBEXCD1 - I/O ERROR     A42181 05873221
CQT5ATIC EQU   CQT5A+5                  TIC TO SEEK              M5864  05874020
CQT5ANOP EQU   CQT4A+5                  TIC TO CQT5B             M5864  05876020
ISLKEYVL EQU   X'04'                    KEY SEQUENCE VALID       XM6075 05878000
INCLOSE  EQU   X'10'                    ENTERED FROM CLOSE      YM05395 05878402
DMCODE   EQU   119                      INTERNAL PROB DET CODE  YM05395 05878802
         EJECT                                                          05880000
*********************************************************************** 05900000
* CHART FX - PUT (MOVE/LOCATE)                                        * 05920000
*********************************************************************** 05940000
*                                                                       05960000
         USING IHADEB,R8                                                05980000
*                                                                       06000000
* FX HOUSEKEEPING                                                       06020000
*                                                                       06040000
ISLFX01  L     R12,DCBWKPT1             C(R12)=A(COMMON)                06060000
         L     R10,DCBWKPT6             C(R10)=A(VPTRS)           14251 06065016
         L     R11,8(R10)               C(R11)=A(BCT)             14251 06070016
         TM    IOBFLAGS,X'10'           DID WE COME FROM CLOSE    14251 06075016
         BO    CONTINUE                 YES TAKE BRANCH           14251 06080016
         ST    R13,ISLVRSAV+4                                     14251 06085016
CONTINUE EQU   *                                                  14251 06090016
         LA    R2,ISLIOBA               C(R2)=A(IOBA)                   06140000
         NI    DCBEXCD2,X'3F'           SET EXCD2 BITS 0 AND 1 = 00     06160000
*                                                                       06180000
         TM    DCBEXCD1,X'04'           HAS AN OUTPUT ERROR      A31998 06185020
*                                       * OCCURRED$                     06190020
         BO    ISLFX02                  YES TAKE SYNAD           A31998 06195020
* TEST DCBST BIT 1 FOR LOAD MODE (FIRST TIME SW)                        06200000
*                                                                       06220000
         TM    DCBST,X'40'              TEST ST BIT 1 (1=NOT FRST TIME) 06240000
         BC    14,ISLFX10A              BRANCH NOT ON                   06260000
         LH    R5,DCBRKP                RELATIVE KEY POSITION    A32496 06270020
*                                                                       06280000
         TM    DCBST,X'20'              RESUME LOAD               P4701 06282000
         BZ    ISLFX022                 NOT RESUME LOAD          A31998 06284020
         TM    DCBMACRF+1,X'08'         PUT - LOCATE MODE         P4701 06290000
         BO    ISLFX07A                 BR-YES                   XM6075 06292000
         L     R4,4(R10)                PT TO HIGH KEY           A32496 06294020
         B     ISLFY022                 BRANCH TO CHECK SEQUENCE A32496 06296020
* TEST DCBEXCD1 BIT 5 FOR PREVIOUS UNCORRECTABLE WRITE ERROR            06300000
*                                                                       06320000
ISLFX02  L     R13,ISLVRSAV+4           C(R13)=A(USERS SAVE AREA) 20852 06330000
         MVC   24(4,R13),ISLVPTRA       A(BAD BUFFER) IN USER R1  25463 06420018
         LA    R0,ISLIOBA               C(R0)=A(IOBA)                   06480000
         ST    R0,20(R13)               STORE A(IOBA) IN USERS R0       06500000
         B     ISLFX05                  B TO TAKE SYNAD                 06520000
*                                                                       06540000
* SEQUENCE CHECK                                                        06560000
****************                                                        06580000
*                                                                       06600000
ISLFX022 EQU   *                        *                        A32496 06610020
         L     R4,ISLCBF                                         A32496 06620020
         AR    R4,R5                    PT TO KEY                A32496 06630020
ISLFY022 EQU   *                                                 A32496 06640020
         SR    R3,R3                                                    06680000
         IC    R3,DCBKEYLE              C(R3)=KEYLEN, 000000NN          06700000
         BCTR  R3,0                     C(R3)=KEYLEN-1, FOR EXECUTE     06720000
*                                                                       06740000
* TEST FOR MOVE OR LOCATE PUT                                           06760000
*                                                                       06780000
         TM    DCBMACRF+1,X'10'         TEST MACRF BIT 11               06800000
         BC    1,ISLFX08                B IF ON = MOVE PUT              06820000
*                                                                       06840000
* LOCATE PUT ***                                                        06860000
*                                                                       06880000
         L     R5,4(R10)                C(R5)=A(KEYSAVE)=A(PREV KEY)    06900000
         EX    R3,ISLFX02A              C(CBF+RKP) VS C(KEYSAVE)        06920000
         BH    ISLFX06                  B IF NEW KEY HIGH               06940000
         BE    ISLFX023                 BR - SEQUENCE CORRECT     20852 06950000
         LR    R4,R5                    PTR TO KEY               M1857  06960020
         B    ISLFX041                  BR TO POST ERROR         M1857  06970020
*                                                                       06980000
* LOCATE PUT,KEYS EQUAL- TEST IF 2ND PUT (SEQ CHK ONLY AFTER 2ND PUT)   07000000
*                                                                       07020000
ISLFX023 EQU   *                                                  20852 07030000
         L     R6,DCBNREC               C(R6)=NREC                      07040000
         C     R6,ISLONEF               TEST NREC VS 1                  07060000
         BE    ISLFX06                  B IF NREC = 1, ONLY 2ND PUT     07080000
*                                                                       07100000
* DUPLICATE RECORDS = ERROR                                             07120000
*                                                                       07140000
ISLFX03  OI    DCBEXCD2,X'40'           SET EXCD2 BIT 1 ON = DUPLICATE  07160000
         B     ISLFX04A                                        @ZA07607 07180037
*                                                                       07200000
* MOVE PUT ***                                                          07220000
*                                                                       07240000
ISLFX08  AR    R5,R0                    C(R5)=C(AREA+RKP)=A(NEW KEY)    07260000
         EX    R3,ISLFX08A              C(NEW KEY) VS C(CBF+RKP)        07280000
         BH    ISLFX07                  BRANCH IF NEW KEY HIGH          07300000
         BE    ISLFX03                  BR IF KEYS EQUAL=DUPLIC ATES    07320000
ISLFX041 EQU   *                        *                        M1857  07322020
* SEQUENCE ERROR                                               @ZA07607 07324037
         OI    DCBEXCD2,X'80'           EXCD2 BIT 0,SEQ ERROR  @ZA07607 07334037
         TM    IOBFLAGS,X'10'           IN CLOSE                 M1857  07344037
         BO    ISLFX04A                 YES - DON'T SAVE KEY   @ZA07607 07354037
         ST    R4,20(R13)               HI KEY ADDR INTO USER R0  20852 07364037
         OI    20(R13),X'80'            TURN REG 0 NEG         @ZA07607 07374037
         B     ISLFX05                  BR TO SYNAD            @ZA07607 07384037
*                                                                       07394037
* TAKE SYNAD EXIT                                                       07404037
ISLFX04A LA    R0,ISLIOBA               LOAD IOB ADDR          @ZA07607 07414037
         TM    IOBFLAGS,X'10'           IN CLOSE?              @ZA10227 07417037
         BO    ISLFX05                  YES BRANCH             @ZA10227 07420037
         ST    R0,20(R13)               ST IN USER SAVE AREA   @ZA07607 07424037
ISLFX05  LR    R4,R14                   SAVE RETURN IN R4               07480000
         L     R16,DCBSYNAD                                             07500000
         C     R16,ISLONEF              TEST SYNAD VS 1                 07520000
         BE    ISLFX052                 BR IF 1 - NO SYNAD              07540000
         TM    IOBFLAGS,X'10'           TEST FLAGS BIT 3 (CLOSE)        07560000
         BC    1,ISLFX051               B IF ON = CLOSE                 07580000
         L     R13,ISLVRSAV+4           RESTORE USER R13                07600000
         L     R14,12(R13)              RESTORE USER R14                07620000
         LM    0,12,20(R13)             RESTORE REGS                    07640000
         BR    R16                      TAKE SYNAD EXIT                 07660000
ISLFX051 TM    DCBEXCD2,X'20'           TEST EXCD2 BIT 2    ***CLOSE*** 07680000
         BC    1,0(R4)                  B IF ON, RETURN TO CLOSE        07700000
         L     R5,DCBDEBAD              DEB ADDRESS             YM06516 07710002
         LA    R5,0(R5)                 CLEAR HIGH ORDER BYTE   YM06516 07712002
         S     R5,ISL8                  PT TO DEB EXTENSION PTR YM06516 07720002
         L     R5,0(R5)                 ADDR DEB EXTENSION      YM06516 07730002
         USING DEBXTN,R5                DEB EXT. ADDRESSABILITY YM06516 07740002
         TM    DEBXFLG1,DEBXTSKC        TASK CLOSE CLOSING DCB  YM06516 07742002
         BO    ISLFTERM                 BR YES - ISSUE MESSAGE  YM06516 07744002
         USING PSA,R0                   LOW CORE ADDRESABILITY  YM05395 07750002
         L     R5,PSATOLD               TCB ADDRESS             YM05395 07760002
         DROP  R0,R5                    END LOW CORE DEB ADDR   YM06516 07776002
         L     R5,0(R5)                                                 07780000
         USING RBBASIC,R5               SYNCH RB ADDRESSABILITY YM03178 07830002
         L     R5,RBLINK                OPEN SVRB ADDRESS       YM03178 07832002
         DROP  R5                       END RB ADDRESSABILITY   YM03178 07834002
         LA    R13,ISLVRSAV             SAVE AREA ADDRESS       YM03178 07836002
         OI    DCBEXCD2,X'20'           SET EXCD2 BIT 2 ON = CLOSE      07840000
         L     1,24(R13)                SET REG 1              @ZA10227 07860037
         LM    2,13,40(R5)              RESTORE USERS REGS 2 - 13       07880000
         BR    R16                      TAKE SYNAD EXIT - WILL   Y02072 07900002
*                                       RETURN TO CLOSE AS REG   Y02072 07920002
*                                       14 HAS RETURN ADDR TO    Y02072 07960002
*                                       CLOSE ESTABLISHED BY     Y02072 07980002
*                                       SYNCH ISSUED BY CLOSE    Y02072 08000002
*                                                                       08020002
*                                                                       08040002
ISLFX052 EQU   *                        NO SYNAD = ABEND 31             08060002
         TM    IOBFLAGS,INCLOSE         ENTERED FROM CLOSE      YM05395 08070002
         BZ    ISLFX054                 BR NO - ISSUE ABEND     YM05395 08072002
         L     R5,DCBDEBAD              DEB ADDRESS             YM06516 08072402
         LA    R5,0(R5)                 CLEAR HIGH ORDER BYTE   YM06516 08072502
         S     R5,ISL8                  PT TO DEB EXTENSION PTR YM06516 08072802
         L     R5,0(R5)                 ADDR DEB EXTENSION      YM06516 08073202
         USING DEBXTN,R5                DEB EXT. ADDRESSABILITY YM06516 08073602
         TM    DEBXFLG1,DEBXTSKC        TASK CLOSE CLOSING DCB  YM06516 08073702
         BO    ISLFTERM                 BR YES - ISSUE MESSAGE  YM05395 08078802
         DROP  R5                       END DEB EXT. USING      YM06516 08079202
ISLFX054 EQU   *                        ISSUE ABEND             YM05395 08079602
         ABEND X'031',DUMP,,SYSTEM      SYSTEM 031 ABEND         Y02072 08080002
         SPACE 2                                                        08090002
*        ISSUE ERROR MESSAGE AND TERMINATE TASK WITH 031 ABEND -        08092002
*        TASK TERMINATION ISSUED CLOSE FOR USER.                        08094002
         SPACE 2                                                        08096002
ISLFTERM EQU   *                        ISSUE MESSAGE-TERM. TSK YM05395 08098002
         DMABCOND DMCODE,SVC=YES,DCB=(R1)                       YM05395 08098402
         SPACE 2                                                        08098802
*                                                                       08100000
* LOCATE PUT,SEQUENCE OK- MOVE KEY TO KEYAVE AREA                       08120000
*                                                                       08140000
ISLFX06  EX    R3,ISLFX06A              MOVE C(CBF+RKP) TO C(KEYSAVE)   08160000
*                                                                       08180000
* BUMP CBF                                                              08200000
*                                                                       08220000
ISLFX07  EQU   *                        *                        A32496 08230020
         OI    ISLIXLT,ISLKEYVL         VALID RECORD ADDED        M6075 08232000
ISLFX07A L     R7,ISLCBF                C(R7)=A(CURR BUFR PTR)   S20201 08240020
*                                        P470                    S20201 08250020
         A     R7,ISLBMPR               C(R7)=CBF+BMPR           S20201 08260020
         ST    R7,ISLCBF                C(CBF)=CBF+BMPR                 08280000
         B     ISLFX10                                                  08300000
*                                                                       08320000
* BUMP NREC                                                             08340000
*                                                                       08360000
ISLFX10A OI    DCBST,X'40'              SET ST BIT ON                   08380000
         CLC   DCBLPDA(1),DCBMSWA       TEST FOR SAME M           16305 08383016
         BNE   KEEPGOIN                                           16305 08386016
         CLC   DCBLPDA+3(4),DCBMSWA+3   TEST FOR OUT OF SPACE     16305 08389016
         BH    ISLPA205                 BRANCH NO SPACE           16305 08392016
KEEPGOIN EQU   *                                                  16305 08395016
ISLFX10  L     R3,DCBNREC               C(R3)=NREC                      08400000
         A     R3,ISLONEF               C(R3)=NREC+1                    08420000
         ST    R3,DCBNREC               C(NREC)=NREC+1                  08440000
*                                                                       08460000
* TEST BOB SWITCH (APPLIES ONLY TO MOVE PUT, BOBSW = 1 FOR LOCATE PUT)  08480000
*                                                                       08500000
         TM    IOBFLAGS,X'08'           TEST FLAGS BIT 4 VS 1 (BOBSW)   08520000
         BC    1,ISLFX11                B IF ON = NOT 0                 08540000
*                                                                       08560000
*                                       BOBSW = 0                       08580000
         OI    IOBFLAGS,X'08'           SET FLAGS BIT 4 = 1 (BOBSW ON)  08600000
         BAL   R14,ISLPA01             *LINK TO BOB ROUTINE             08620000
*                                                                       08640000
         TM    DCBST,RSLOAD             IS IT RESUME LOAD        S20201 08645020
         BZ    ISLFX11                  NO - O.K.                S20201 08650020
         MVC   IOBPTRA+K1(L3),IOBPTRB+K1 MAKE IT THE FIRST       S20201 08655020
*                                       BOBSW = 1                       08660000
* TEST FOR MOVE OR LOCATE PUT                                           08680000
*                                                                       08700000
ISLFX11  TM    DCBMACRF+1,X'10'         TEST MACRF BIT 11               08720000
         BC    1,ISLFX20                B IF ON = MOVE PUT              08740000
*                                                                       08760000
* LOCATE PUT                                                            08780000
* TEST FOR EOB, HAS USERS LAST RCD FILLED A BUFFER -                    08800000
*                                                                       08820000
         L     R7,ISLCBF                C(R7)=CBF                       08840000
         C     R7,ISLEOB                TEST CBF VS EOB                 08860000
         BNL   ISLFX24                  B IF EOB                        08880000
*                                                                       08900000
*                                       NOT EOB                         08920000
ISLFX12  TM    IOBFLAGS,X'40'           TEST FLAGS BIT 1                08940000
         BC    1,ISLFX14                B IF ON = WRITE SHOULD BE       08960000
*                                                 ATTEMPTED             08980000
*                                                                       09000000
* NOT EOB, FLAGS BIT 1 OFF, RESTORE REGS AND RETURN TO USER             09020000
*                                                                       09040000
* EXIT PUT                                                              09060000
*                                                                       09080000
ISLFX13  TM    IOBFLAGS,X'10'           TEST FLAGS BIT-3 (CLOSE)        09100000
         BC    1,0(R14)                 B IF ON = CLOSE                 09120000
*                                       * INDICATOR                     09122020
         TM    DCBST,RSLOAD             RESUME LOAD              S20201 09124020
         BZ    ISLFX13R                 NO - BUFFERS CORRECT     S20201 09126020
         NI    DCBST,X'FF'-RSLOAD       TURN OFF RESUME LOAD     S20201 09128020
         MVC   IOBPTRA+K1(L3),IOBPTRB+K1 CORRECT PTRS            S20201 09130020
ISLFX13R EQU   *                        *                        S20201 09132020
         TM    DCBMACRF+1,X'10'         TEST MACRF BIT 11 (MOVE PUT)    09140000
         BC    1,ISLFX132               B IF ON = MOVE PUT              09160000
         L     R1,ISLCBF                C(R1)=CBF, FOR LOCATE PUT       09180000
ISLFX132 L     R13,ISLVRSAV+4                                           09200000
         L     R14,12(R13)              RESTORE R14                     09220000
         RETURN (2,12)                  RESTORE USERS REGS AND EXIT     09240000
*                                                                       09260000
*                                                                       09280000
*                                                                       09300000
* NOT EOB, FLAGS BIT 1 ON, SET FLAGS BIT 1 OFF AND ATTEMPT WRITE        09320000
*                                                                       09340000
ISLFX14  NI    IOBFLAGS,X'BF'           SET FLAGS BIT 1 OFF             09360000
         OI    IOBFLAGS,X'20'           SET FLAGS BIT 2 ON (NOT EOB)    09380000
         B     ISLFY02                 *                                09400000
*                                                                       09420000
*                                                                       09440000
*                                                                       09460000
* MOVE PUT                                                              09480000
* MOVE RECORD FROM USER AREA TO CURRENT BUFFER VIA CBF                  09500000
*                                                                       09520000
ISLFX20  L     R3,ISLMVC                C(R3)=COUNT OF EXECUTED MOVE    09540000
         L     R4,ISLCBF                C(R4)=CBF=MOVE DESTINATION      09560000
         LR    R5,R0                    C(R5)=MOVE ORIGIN               09580000
         L     R6,ISLMVCT               C(R6)=NBR OF 255 BYTE MOVES     09600000
ISLFX21  BCT   R6,ISLFX22               TO MOVE 255 BYTES               09620000
         EX    R3,ISLFX21A              MOVE RCD AT R0 TO CBF           09640000
         B     ISLFX23                  MOVE COMPLETED                  09660000
ISLFX22  MVC   0(255,R4),0(R5)          MOVE 255 BYTES OF RECORD        09680000
         LA    R4,255(R4)               BUMP DESTINATION          8M800 09700018
         LA    R5,255(R5)               BUMP ORIGIN               8M800 09720018
         B     ISLFX21                  TO MOVE REST OF RECORD          09740000
*                                                                       09760000
* TEST FOR EOB, HAS RCD JUST MOVED FILLED A BUFFER                      09780000
*                                                                       09800000
ISLFX23  L     R7,ISLCBF                C(R7)=CBF                       09820000
         A     R7,ISLBMPR               C(R7)=CBF+BMPR                  09840000
         C     R7,ISLEOB                TEST CBF+BMPR VS EOB            09860000
         BL    ISLFX12                  B IF NOT EOB                    09880000
*                                                                       09900000
*                                                                       09920000
*                                       EOB                             09940000
*                                                                       09960000
* SET BOB SW TO ZERO (RESET)                                            09980000
*                                                                       10000000
         NI    IOBFLAGS,X'F7'           SET FLAGS BIT 4 = 0 (BOBSW OFF) 10020000
         NI    DCBST,X'FF'-RSLOAD       TURN OFF RESUME LOAD     S20201 10030020
*                                                                       10040000
* MARK CURRENT BUFFER AND BUMP B IN BCT.                                10060000
*                                                                       10080000
ISLFX24  L     R3,IOBPTRB               C(R3)=PTR B = A(CURRENT SLOT)   10100000
         TM    DCBST,RSLOAD             RESUME LOAD              S20201 10106020
         BO    ISLFY01                  YES - DON'T SCHEDULE     S20201 10112020
         NI    0(R3),X'DF'              SET STATUS BIT 2 = 0            10120000
         OI    0(R3),X'40'              SET STATUS BIT 1 = 1            10140000
*                                       STATUS BITS 1 AND 2 = 10        10160000
*                                       =BUF FULL BUT NOT SCHED         10180000
         IC    R4,IOBB                  C(R4)-000N, FULL BUFRS    P4701 10200000
         LA    R4,1(0,R4)               C(R4)-000000NN+1          P4701 10220000
         STC   R4,IOBB                  C(PTRB)=NNAAAAAA, NN = B        10260000
*                                                                       10300000
         EJECT                                                          10320000
*********************************************************************** 10340000
* CHART FY - PUT (EOB)                                                * 10360000
*********************************************************************** 10380000
*                                                                       10400000
* TEST B VS FBW (ARE WE READY TO ATTEMPT TO WRITE)                      10420000
*                                                                       10440000
ISLFY01  SR    R3,R3                                                    10460000
         IC    R3,IOBB                  C(R3)=000N  N=NO. FILLED,       10480000
*                                         UNSCHEDULED BUFFERS           10500000
         C     R3,ISLFBW                TEST B VS FBW                   10520000
         BL    ISLFY41                  B IF NOT ENOUGH BUFFERS FILLED  10540000
*                                                                       10560000
*                                       B G.E. FBW, ATTEMPT WRITE       10580000
* TEST FLAGS BIT 0 VS 1, (IWR)-IS CP AVAILABLE                          10600000
*                                                                       10620000
ISLFY02  EQU   *                        *                        A42181 10628021
         TM    ISLECBA,COMPLETE         IOB AVAILABLE            A42181 10636021
         BZ    ISLFY41A                 NO - SCHEDULE LATER      A42181 10644021
         TM    DCBEXCD1,IOERROR         HAS AN I/O ERROR         A42181 10652021
*                                       OCCURRED                 A42181 10660021
         BO    ISLFX02                  YES - TERMINATE LOAD.    A42181 10668021
*                                                                       10680000
* B GE FBW AND FLAGS BIT 0 = 0 (CP AVAILABLE), SET UP TO WRITE          10700000
*                                                                       10720000
ISLFY03  SR    R3,R3                                                    10740000
         IC    R3,IOBB                  C(R3)=000N                      10760000
         S     R3,ISLFBW                C(R3)=B-FBW, WE WILL SCHED FBW  10780000
*                                                    BUFFRS             10800000
         STC   R3,IOBB                  C(PTRB)=NNAAAAAA, NN = B        10820000
*                                                                       10840000
         NI    IOBFLAGS,X'BF'           SET FLAGS BIT 1 OFF             10860000
*                                                                       10880000
*                                                                       10900000
*                                                                       10920000
* WAIT FOR PREVIOUS I/O TO COMPLETE                                     10940000
*                                                                       10960000
*                                                                       10980000
*                                                                       11000000
* MAKE SURE CP21 HAS COMPLETED                                          11020000
*                                                                       11040000
         LA    R2,ISLIOBB               SET BASE FOR IOB FOR CP21       11060000
         BAL   R4,ISLFY99               BR TO WAIT SUBROUTINE           11080000
*                                                                       11100000
* TEST STATUS BIT-6 (PF BIT) PERTAING TO 1ST BFR.  IF PF BIT ON, THIS   11120000
* IS THE 1ST BUFFER TO BE WRITTEN ON A NEW CYLINDER WITH SHARED TRACKS  11140000
*                                                                       11160000
         TM    0(R3),X'02'              TEST STATUS BIT-6               11180000
         BC    8,ISLFY08                B IF PF NOT ON                  11200000
*                                                                       11220000
* STATUS BIT-6 (PF BIT) IS ON. WE ARE ABOUT TO SCHED THE 1ST WRITE ON   11240000
* A NEW, SHARED-TRACK, CYLINDER. FIRST WE MUST BE SURE CP19 HAS         11260000
* FINISHED PRE-FORMATTING.                                              11280000
*                                                                       11300000
         LA    R2,ISLIOBC               SET BASE FOR IOB FOR CP19       11320000
         BAL   R4,ISLFY99               BR TO WAIT SUBROUTINE           11340000
         NI    0(R3),X'FD'              SET STATUS BIT 6 (PF BIT) OFF   11360000
*                                                                       11380000
*                                                                       11400000
* SCHED FBW BUFFRS FOR WRITING VIA PTR A (STATUS BITS 1,2 ON)           11420000
* AT THE SAME TIME TEST STATUS BYTES FOR BIT-3 ON = NEW EXTENT          11440000
*                                                                       11460000
ISLFY08  L     R4,ISLFBW                C(R4)= NO OF SLOTS TO SCHED     11480000
ISLFY10  OI    0(R3),X'60'              SET STATUS BITS 1,2 = 11        11500000
         TM    0(R3),X'10'              TEST STATUS BIT-3               11520000
         BC    8,ISLFY11                B IF 0, SAME EXTENT             11540000
         IC    R5,IOBDADAD              C(R5)-M                   P4701 11560000
         LA    R5,1(0,R5)               C(R5)-M+1                 P4701 11580000
         STC   R5,IOBDADAD              C(IOBA+32)=MBBCCHHR, M=M+1      11620000
         BAL   R5,ISLFZ21                                               11630013
         NI    0(R3),X'EF'              SET STATUS BIT-3 = 0            11640000
ISLFY11  A     R3,ISL4                  BUMP R3 TO ADR NEXT SLOT        11660000
         C     R3,ISLBUFN               TEST FOR ADR OF NTH SLOT        11680000
         BC    13,ISLFY20A              BR IF NOT HIGH                  11700000
ISLFY12  BCT   R4,ISLFY13               WRAPAROUND POSSIBLE             11720000
         B     ISLFY20                  OUT, SLOT N WAS LAST            11740000
ISLFY13  LA    R3,IOBABUF               WRAPAROUND REAL, C(R3)=A(SLOT1) 11760000
         B     ISLFY10                  LOOP AGAIN                      11780000
*                                                                       11800000
*                                       SAVE ADR OF LAST SLOT IN REG 7  11820000
ISLFY20A BCT   R4,ISLFY10                                               11840000
ISLFY20  LR    R7,R3                    C(R7)=A(LAST SLOT SCHED + 4)    11860000
         S     R7,ISL4                  C(R7)=A(LAST SLOT SCHED)        11880000
*                                                                       11900000
* INITIALIZE CP18 AND CP20 IN SUBROUTINE                                11920000
*                                                                       11940000
*                                                                       11960000
         STM   R2,R11,ISLVRSAV+28       SAVE REGS 2-11                  11980000
         B     ISLF801                                                  12000000
ISLFY21  LM    R2,R11,ISLVRSAV+28       RESTORE REGS 2-11               12020000
*                                                                       12040000
* SAVE CONTENTS OF BCT SLOT WITH STATUS AND POINTER OF LAST BUFF SCHED  12060000
*                                                                       12080000
         MVC   ISLF9WK1(4),0(R7)        SAVE SLOT CONTENTS OF     16305 12100016
*                                       LAST BCT SLOT             16305 12120016
*                                                                       12140000
* TEST LAST BUFFER FOR END OF CYLINDER (C-BIT ON)                       12160000
*                                                                       12180000
         TM    0(R7),X'04'              TEST S BIT 5 VS 1 (C-BIT)       12200000
         BC    1,ISLFZ01                B IF ON                         12220000
*                                                                       12240000
*                                                                       12260000
* EXECUTE CP18 (CP20)                                                   12280000
*                                                                       12300000
*                                                                       12320000
ISLFY30  LA    R13,ISLVRSAV             C(R13)=A(VRSAV)                 12340000
         LR    R3,R0                    SAVE R0                         12360000
         LR    R4,R1                    SAVE R1                         12380000
         LR    R5,R14                   SAVE R14                        12400000
*                                                                  8791 12420000
*                                                                  8791 12440000
*                                                                  8791 12460000
* SET FLAGS BIT-0 (IWR BIT)=1, CP IS NOT AVAIL                     8791 12480000
*                                                                  8791 12500000
         OI    IOBFLAGS,X'80'           TURN ON FLAGS BIT 0        8791 12520000
*                                                                  8791 12540000
         EXCP  IHAIOB                   EXECUTE CHANNEL PROGRAM         12560000
         LR    R0,R3                    RESTORE R0                      12580000
         LR    R1,R4                    RESTORE R1                      12600000
         LR    R14,R5                   RESTORE R14                     12620000
*                                                                       12640000
* SET FBW IN SUBROUTINE                                                 12660000
*                                                                       12680000
         LA    R7,ISLF9WK1              C(R7)=A(LAST SLOT) FROZEN       12700000
         B     ISLPB01                  GO TO SUBROUTINE                12720000
ISLFY41A OI    IOBFLAGS,X'40'           SET FLAGS BIT 1 ON TO ATTEMPT   12740000
*                                       TO WRITE LATER                  12760000
*                                                                       12780000
*                                                                       12800000
*                                                                       12820000
* TEST FLAGS BIT 2 (NOT EOB INDICATOR)                                  12840000
*                                                                       12860000
ISLFY41  TM    IOBFLAGS,X'20'           TEST FLAGS BIT 2                12880000
         BC    8,ISLFY42                B IF NOT ON (EOB)               12900000
         NI    IOBFLAGS,X'DF'           TURN FLAGS BIT 2 OFF            12920000
         B     ISLFX13                  RTRN TO FX (DONT GET LOC BUFF)  12940000
*                                                                       12960000
* TEST FOR MOVE OR LOCATE PUT                                           12980000
*                                                                       13000000
ISLFY42  TM    DCBMACRF+1,X'10'         TEST MACRF BIT 11               13020000
         BC    1,ISLFX13                B IF ON = MOVE PUT, RTRN TO FX  13040000
*                                                                       13060000
* LOCATE PUT                                                            13080000
*                                                                       13100000
         BAL   R14,ISLPA01             *LINK TO BOB ROUTINE             13120000
         B     ISLFX13                  RETURN TO FX                    13140000
*                                                                       13160000
*                                                                       13180000
***WAIT SUBROUTINE***                                                   13200000
* THIS SUBROUTINE DETERMINES IF A CHANNEL PROGRAM IS AVAILABLE, AND     13220000
* IF IT IS NOT, WAITS UNTIL IT IS.  THE ROUTINE EXPECTS THE  FOLLOWING  13240000
* INPUT - R2 = ADDR OF IOB FOR CHANNEL PROGRAM TO BE TESTED             13260000
*         R4 = RETURN ADDRESS                                           13280000
*                                                                       13300000
ISLFY99  EQU   *                                                        13320000
         ST    R4,ISLVRSAV              SAVE RETURN ADDRESS        0700 13340000
         LR    R3,R1                    SAVE R1                         13360000
         L     R1,IOBECBAD              C(R1)=A(ECB)                    13380000
         TM    0(R1),X'40'              TEST ECB BIT 1 (C-BIT)          13400000
         BC    1,ISLFY995               B IF 1, I/O COMPLETE-DON'T WAIT 13420000
         LA    R13,ISLVRSAV             C(R13)=A(VRSAV)                 13440000
         LR    R4,R0                    SAVE R0                         13460000
         LR    R5,R14                   SAVE R14                        13480000
         WAIT  ECB=(1)                                                  13500000
         LR    R0,R4                    RESTORE R0                      13520000
         LR    R14,R5                   RESTORE R14                     13560000
*                                                                       13580000
ISLFY995 LA    R2,ISLIOBA               C(R2)=A(IOBA)                   13600000
         LR    R1,R3                    RESTORE R1                      13620000
         L     R3,IOBPTRA               C(R3)=A(1ST SLOT TO SCHED)      13640000
         LA    R3,0(R3)                                                 13660000
         L     R4,ISLVRSAV              GET RETURN ADDRESS         0700 13680000
         BCR   15,R4                    RETURN                          13700000
*                                                                       13720000
         EJECT                                                          13740000
*********************************************************************** 13760000
* CHART FZ - CYLINDER INDEX ENTRY SETUP                               * 13780000
*********************************************************************** 13800000
*                                                                       13820000
*                                                                       13840000
* STORE ADDR OF STATUS BYTE WITH C-BIT ON IN CP21 AT CQ41               13860000
* -THIS IS DONE TO PERMIT APPENDAGE TO TURN OFF C-BIT-                  13880000
*            * R7 CONTAINS ADDR OF THE STATUS BYTE *                    13900000
*                                                                       13920000
ISLFZ01  L     R10,DCBWKPT6             C(R10)=A(VPTRS)                 13940000
         L     R10,24(R10)              C(R10)=A(CP21-CQ40)             13960000
         ST    R7,12(R10)               C(CQ41+4)=A(LAST SLOT SCHED)    13980000
         NI    ISLIXLT,X'F7'            SET IXLT LEV1 BIT-4 OFF- TRK IX 14000000
*                                                                       14020000
*                                                                       14040000
* LOCATE LEVEL IN INDEX LOCATION TABLE AT CYLINDER INDEX                14060000
*                                                                       14080000
         LA    R7,ISLIXLT               C(R7)=A(IXLT)                   14100000
         OI    0(R7),X'20'              IXLTIND BIT-2 ON IN LEV1        14120000
         NI    26(R7),X'DF'                     BIT-2 OFF IN LEV2       14140000
         NI    52(R7),X'DF'                                  LEV3       14160000
         NI    78(R7),X'DF'                                  LEV4       14180000
*                                                                       14200000
* CONSTRUCT COUNT FOR CYLINDER INDEX ENTRY IN AREA Y, Y+0               14220000
*                                                                       14240000
         L     R10,DCBWKPT6             C(R10)=A(VPTRS)                 14260000
         L     R9,0(R10)                C(R9)=A(AREA Y)                 14280000
         MVC   0(4,R9),12(R7)           COUNT = CCHH FROM IXLT S0       14300000
         SR    R3,R3                                                    14320000
         IC    R3,16(R7)                C(R3)=R FROM IXLT S0, 000N      14340000
         A     R3,ISLONEF               C(R3)=R+1                       14360000
         STC   R3,4(R9)                 COUNT = CCHHR WITH R=R+1        14380000
*                                                                       14400000
* CONSTRUCT DATA FOR CYLINDER INDEX ENTRY IN AREA Y, Y+8                14420000
*                                                                       14440000
         TM    0(R7),X'40'              TEST IXLTIND BIT 1 (DUMMY SW)   14460000
         BC    1,ISLFZ10                B IF ON                         14480000
*                                                                       14500000
*                                       DUMMY SW OFF                    14520000
*  A. NORMAL DATA                                                       14540000
*                                                                       14560000
         MVC   8(7,R9),IOBDADAD         DATA=MBBCCHH FROM IOBA+32       14580000
         MVI   14(R9),X'00'             FOR 2321 SET TO TRACK 0         14680013
         CLI   DCBFIRSH+1,X'00'         H OF FIRSH VS 0          A46109 14760021
         MVI   15(R9),X'00'             DATA = MBBCCHHR WITH R=0 A46109 14800021
         BNE   ISLFZ03                  BIF HH NOT 00            A46109 14840021
*                                       HH OF FIRSH = 00                14880021
         MVC   15(1,R9),DCBFIRSH+2      DATA = MBBCCHHR WITH R   A46109 14920021
*                                       OF FIRSH                        14960021
ISLFZ03  MVI   16(R9),X'01'             DATA = MBBCCHHRF WITH F = 01    15000000
*                                                                       15020000
         SR    R6,R6                                                    15040000
         IC    R6,9(R7)                 C(R6) = M FROM IXLT S0          15060000
         BCTR  R6,0                     C(R6)=M-1                       15080013
         SLL   R6,4                     C(R6) = M-1 X 16 (USE AS INDX)  15100000
*                                                                       15120000
         SR    R5,R5                                                    15140000
         IC    R5,IOBDADAD              C(R5) = M FROM IOBA+32          15160000
         BCTR  R5,0                     C(R5)=M-1                       15180013
         SLL   R5,4                     C(R5) = M-1 X 16 (USE AS INDX)  15200000
*                                                                       15220000
         L     R8,DCBDEBAD              C(R8)=A(DEB)                    15240000
         L     R4,DEBFPEAD              C(R4)=A(1ST PRIM EXTENT ENTRY)  15280000
         LA    R4,0(R6,R4)              C(R4)=A(CURR INDX EXTENT ENTRY) 15300000
         L     R3,DEBFPEAD              C(R3)=A(1ST PRIM EXTENT ENTRY)  15320000
         LA    R3,0(R5,R3)              C(R3)=A(CURR PRIM EXTENT ENTRY) 15340000
         L     R9,0(R10)                C(R9)=A(AREA Y)                 15360000
*                                                                       15380000
         CLC   1(3,R3),1(R4)            COMP UCB ADDRS, PRIM VS INDX    15400000
         BNE   ISLFZ04                  B IF NOT EQUAL                  15420000
*                                                                       15440000
*                                       UCBS EQUAL                      15460000
         MVI   17(R9),X'0B'             DATA = MBBCCHHRFP WITH P=0B     15600000
         B     ISLFZ05                                                  15620000
*                                                                       15640000
*                                       UCBS UNEQUAL                    15660000
ISLFZ04  MVI   17(R9),X'07'             DATA = MBBCCHHRFP WITH P=07     15680000
*                                                                       15700000
*                                       SET CQ43 (CP21) TO ADDRESS KEY  15720000
*                                       OF LAST RECORD IN LAST BUFFER   15740000
*                                                                       15760000
ISLFZ05  L     R4,ISLKEYAD              =A(KEY OF LAST WR CKD)    13165 15830016
         B     ISLFZ20                                                  15900000
*                                                                       15920000
*                                       DUMMY SW ON = END OF CYLINDER   15940000
*  B. DUMMY DATA                                                        15960000
*                                                                       15980000
*                                       TEST CC+1 VS DEBENDCC FOR       16000000
*                                       POSSIBLE END OF INDEX EXTENT    16020000
*                                                                       16040000
ISLFZ10  EQU   *                                                        16060000
         SR    R6,R6                                                    16080000
         IC    R6,9(R7)                 C(R6)=M FROM IXLT S0, 000M      16100000
         BCTR  R6,0                                                     16120000
         SLL   R6,4                     C(R6)=16(M-1) FOR USE AS INDEX  16140013
*                                       TO DEB ENTRY FOR CURR IX EXTNT  16160000
*                                                                       16180000
         L     R8,DCBDEBAD              C(R8)=A(DEB)                    16200000
         L     R4,DEBFPEAD              C(R4)=A(1ST PRIM EXTENT ENTRY)  16240000
         LA    R4,0(R6,R4)              C(R4)=A(CURR INDX EXTNT ENTRY)  16260000
*                                                                       16280000
         L     R9,0(R10)                C(R9)=A(AREA Y)                 16320000
         MVC   ISLFXWK1(4),12(R7)       C(FXWK1)=CCHH OF IXLT SO  13165 16340016
         L     R3,ISLFXWK1              C(R3)=CCHH                      16360000
         MVC   ISLFXWK2(4),10(R4)       C(FXWK2)=CCHH FROM DEBENDCC     16380000
*                                                                       16500000
         SRL   R3,16                    C(R3)=00CC                      16520000
         LA    R3,1(R3)                 ADD 1 FOR NEXT CYL C(R3)=00CC+1 16540000
         SLL   R3,16                    C(R3)=CC+100                    16560000
         ST    R3,ISLFXWK1              C(FXWK1)=CC+100                 16580000
         CLC   ISLFXWK1(2),ISLFXWK2     CC+1 VS ENDCC                   16600000
         BH    ISLFZ11                  BR IF CC+1 HI - IN NEW EXTENT   16620000
*                                                                       16640000
*                                       CC+1    IN CURRENT EXTENT       16660000
ISLFZ11A MVC   8(3,R9),9(R7)            DATA=MBB FROM IXLT S0           16680000
         MVC   11(4,R9),ISLFXWK1        DATA=MBBCCHH  CC=CC+1 HH=00     16700000
         BC    15,ISLFZ12               BR TO PICK UP R, ETC.           16720000
*                                                                       16740000
*                                                                       17460000
ISLFZ11  EQU   *                                                        17480000
         L     R8,DCBDEBAD              C(R8)=A(DEB)              13165 17500016
         LA    R6,16(R6)                INDEX TO NEXT EXTENT      7M402 17510000
         L     R4,DEBFPEAD              C(R4)=A(1ST PRIM EXTENT ENTRY)  17520000
         LA    R4,0(R6,R4)              C(R4)=A(NEXT INDEX EXT)   7M568 17540000
*                                                                       17560000
         L     R9,0(R10)                C(R9)=A(AREA Y)           13165 17570016
         MVC   11(4,R9),6(R4)           DATA=CCHH OF NEW EXTENT   7M568 17580000
         SRL   R6,4                     C(R6) = M FOR NEXT EXTENT       17600000
         A     R6,ISLONEF               C(R6) = M+1 (M=1 FOR EXTENT 0)  17620000
         STC   R6,8(R9)                 DATA = MBBCCHH OF NEW EXTENT    17640000
*                                                                       17660000
ISLFZ12  MVC   15(3,R9),ISLRFP          RFP=002907                8M800 17710018
*                                                                       17760000
*                                       SET CQ43(CP21) TO ADDRESS KEY   17780000
*                                       OF ALL ONES AT AREA Y +62       17800000
*                                                                       17820000
         LA    R4,62(R9)                C(R4)=A(AREA Y +62)             17860000
*                                                                       17940000
* PLACE IXLT S0 IN IOBB+32                                              17960000
*                                                                       17980000
ISLFZ20  L     R10,24(R10)              C(R10)=A(CP21-CQ40)       13165 17984016
         IC    R5,24(R10)               SAVE OP                   13165 17988016
         ST    R4,24(R10)               PTR TO REAL OR DUMMY KEY  13165 17992016
         STC   R5,24(R10)               RESTORE OP                13165 17996016
         LA    R2,ISLIOBB               C(R2)=A(IOBB)             13165 18000016
         MVC   IOBDADAD(8),9(R7)        C(IOBB+32)=C(IXLT SO)     13165 18004016
         BAL   R5,ISLFZ21                                               18010013
*                                                                       18020000
*                                                                       18040000
*                                                                       18060000
* EXECUTE CP21                                                          18080000
*                                                                       18100000
         LA    R13,ISLVRSAV             C(R13)=A(VRSAV)                 18120000
         LR    R3,R0                    SAVE R0                         18140000
         LR    R4,R1                    SAVE R1                         18160000
         LR    R5,R14                   SAVE R14                        18180000
         EXCP  IHAIOB                   EXECUTE CHANNEL PROGRAM         18200000
         LR    R0,R3                    RESTORE R0                      18220000
         LR    R1,R4                    RESTORE R1                      18240000
         LR    R14,R5                   RESTORE R14                     18260000
*                                                                       18280000
         LA    R2,ISLIOBA               C(R2)=A(IOBA)                   18300000
         TM    IOBFLAGS,X'12'           TEST FLAGS BITS 3&6 (CLOSE X)   18320000
         BCR   1,R14                    BR IF ON = CLOSE                18340000
         B     ISLFY30                  EXIT                            18360000
*                                                                       18380000
ISLFZ21  EQU   *                                                        18382013
         L     R13,DCBDEBAD                                             18384013
         LA    R13,32(R13)   START MOVE OF DEB BB INTO IOB              18386013
         SR    R8,R8                                                    18388013
         IC    R8,IOBDADAD                                              18390013
         SLL   R8,4                                                     18392013
         AR    R8,R13                                                   18394013
         MVC   IOBDADAD+2(1),5(R8)                                      18396013
         BR    R5                                                       18398013
         EJECT                                                          18400000
*********************************************************************** 18420000
* CHART PA - BEGINING OF BUFFER                                       * 18440000
*********************************************************************** 18460000
*                                                                       18480000
*                                                                       18500000
* USING PTR B TO REFERENCE COUNT IN LAST BUFFER FILLED -                18520000
*   SET REG 5 = R               - REG A = 000R                          18540000
*   SET REG 6 = CCHH            - REG B = CCHH                          18560000
*   SET REG 7 = HI-RCD ON TRACK - REG C = 000R                          18580000
*                                                                       18600000
ISLPA01  ST    R14,ISLF9WK1             SAVE R14 FOR RETURN TO FX       18620000
         MVC   DCBFTMI3(8),DCBLPDA      SAVE PREVIOUS LPDA FOR CLOSE    18640000
         L     R3,IOBPTRB               C(R3)=C(PTRB)                   18660000
         LA    R3,0(R3)                 C(R3)=A(SLOT S)                 18680000
         L     R4,0(R3)                 C(R4)=C(SLOT S)=A(BUF B)        18700000
         SR    R5,R5                                                    18720000
         IC    R5,4(R4)                 C(R5)=000R                      18740000
         MVC   ISLFXWK2(4),0(R4)        C(FXWK2)=CCHH                   18760000
         L     R6,ISLFXWK2              C(R6)=CCHH                      18780000
*                                                                       18800000
*                                       TEST HH FOR SHARED TRACK        18820000
         SR    R7,R7                                                    18840000
         CLI   DCBHIRSH,X'00'           HIRSH VS 0                      18860000
         BE    ISLPA02                  BR IF 0 - NO SHARED TRACKS      18880000
         STC   R6,ISLFXWK1              C(FXWK1)= H FROM BUF CNT        18900000
ISLPA01A NC    ISLFXWK1(1),DCBFIRSH+3   REDUCE TO TRACK                 18920000
ISLPA01B CLC   DCBFIRSH+1(1),ISLFXWK1   H OF FIRSH VS H OF BUFR CNT     18940000
         IC    R7,DCBHIRSH              C(R7)=HIRSH                     18960000
         BE    ISLPA03                  BR EQ, SHARED TRK - R7=HIRSH    18980000
ISLPA02  IC    R7,DCBHIRPD              NOT A SHARED TRACK, C(R7)=HIRPD 19000000
*                                                                       19020000
* STEP PTR B TO NEXT SLOT IN BCT (MAY WRAPAROUND)                       19040000
*                                                                       19060000
ISLPA03  C     R3,ISLBUFN               TEST FOR ADR OF NTH SLOT        19080000
         LA    R3,4(R3)                 STEP TO NEXT SLOT               19100000
         BNE   ISLPA05                  NOT NTH SLOT, GO UPDATE PTR B   19120000
ISLPA04  LA    R3,IOBABUF               C(R3)=0AAA, AAA= ADR 1ST SLOT   19140000
ISLPA05  IC    R4,IOBB                  SAVE B                          19160000
         ST    R3,IOBPTRB               STORE UPDATED PTR B             19180000
         STC   R4,IOBB                  RESTORE B                       19200000
*                                                                       19220000
* UPDATE CBF AND EOB FOR NEW BUFFER VIA PTR B                           19240000
*                                                                       19260000
         L     R4,0(R3)                 C(R4)=C(SLOT S)=A(BUFF B)       19280000
         LA    R4,0(R4)                                                 19300000
         LR    R3,R4                    C(R3)=A(BUFF B)                 19320000
         A     R3,ISL8                  C(R3)=A(BUFF B)+8               19340000
         ST    R3,ISLCBF                C(CBF)=A(BUFF B)+8              19360000
         LH    R3,DCBBUFL               C(R3)=00NN                8M800 19390018
         BCTR  R3,0                     C(R3)=00NN-1                    19420013
         AR    R3,R4                    C(R3)=A(BUFF B)+BUFL-1          19440000
         ST    R3,ISLEOB                C(EOB)=A(BUFF B)+BUFL-1         19460000
*                                                                       19480000
*                                                                       19500000
* ROUTINE TO SET UP NEW COUNT FIELD FOR NEW BUFFER                      19520000
* ************************************************                      19540000
*                                                                       19560000
*                                                                       19580000
* TEST IF LAST BUFFR FILLED WAS EOT                                     19600000
*                                                                       19620000
         CR    R7,R5                    TEST REG C VS REG A             19640000
         BE    ISLPA20                  B IF EOT                        19660000
*                                                                       19680000
*                                                                       19700000
* STEP REG A TO NEXT R ON CURRENT TRACK                                 19720000
*                                                                       19740000
         A     R5,ISLONEF               C(R5)=000R+1                    19760000
*                                                                       19780000
* TEST IF NEXT BUFFR TO BE FILLED IS AVAILABLE (STATUS BITS)            19800000
*                                                                       19820000
ISLPA50  L     R3,IOBPTRB               C(R3)=PTR B = A(NEXT SLOT) OR-  19840000
         LA    R3,0(R3)                 C(R3)=A(STATUS BITS)            19860000
*                                                                       19920000
*                                       BITS 1 AND 2 = 11 OR 10         19940000
*                                                                       19960000
* WAIT FOR CP18, AND/OR CP20, AND/OR CP21 BEFORE RE-FILLING BUFFER      19980000
*                                                                       20000000
ISLPA60  L     R4,IOBECBAD              C(R4)=A(ECB)                    20020000
         TM    0(R4),X'40'              TEST ECB BIT 1 (C-BIT)          20040000
         BC    1,ISLPA70                B IF 1, I/O COMPLETE-DONT WAIT  20060000
         LA    R13,ISLVRSAV             C(R13)=A(VRSAV)                 20080000
         LR    R3,R1                    SAVE R1                         20100000
         LR    R1,R4                    C(R1)=A(ECB)                    20120000
         LR    R4,R0                    SAVE R0                         20140000
         WAIT  ECB=(1)                  WAIT                            20160000
         LR    R0,R4                    RESTORE R0                      20180000
         LR    R1,R3                    RESTORE R1                      20200000
         L     R3,IOBPTRB               C(R3)=PTR B = A(NEXT SLOT) OR-  20220000
         LA    R3,0(R3)                 C(R3)=A(STATUS BITS)            20240000
*                                                                       20260000
*                                                                       20280000
* TEST DCBEXCD1 BIT 5 FOR PREVIOUS UNCORRECTABLE WRITE ERROR            20300000
*                                                                       20320000
ISLPA70  TM    DCBEXCD1,X'04'           TEST EXCD1 BIT 5                20340000
         BC    8,ISLPA72                B IF NOT ON                     20360000
         TM    IOBFLAGS,X'10'           TEST FLAGS BIT 3 (CLOSE)        20380000
         BC    1,ISLPA72                B IF ON = CLOSE                 20400000
         L     R10,DCBWKPT6             C(R10)=A(VPTRS) FROM VPTR10     20420000
         L     R13,ISLVRSAV+4           C(R13)=A(USERS SAVE AREA)       20440000
         MVC   24(4,R13),36(R10)  STORE A(BAD BUF) IN USERS R1)         20470013
         LA    R0,ISLIOBA               C(R0)=A(IOBA)                   20500000
         ST    R0,20(R13)               STORE A(IOBA) IN USERS R0       20520000
         MVC   40(4,R10),DCBSYNAD       SET VPTR 11 = A(SYNAD)          20540000
         B     ISLFX05                  B TO TAKE SYNAD                 20560000
*                                                                       20580000
ISLPA72  EQU   *                                                        20600000
         LA    R2,ISLIOBB               C(R2)=A(IOBB)                   20620000
         TM    0(R3),X'04'              TEST BIT 5 (C-BIT)              20640000
         BC    7,ISLPA60                BR IF 1 - C-BIT ON              20660000
*                                                                       20680000
*                                       C-BIT OFF                       20700000
         LA    R2,ISLIOBA               C(R2)=A(IOBA)                   20720000
*                                                                       20740000
* TEST IF NEXT BUFFER TO BE FILLED WILL BE EOT (AND EOC)                20760000
* IF EOT, TURN ON T-BIT  IF EOC, TURN ON C-BIT                          20780000
*                                                                       20800000
ISLPA80  CR    R7,R5                    TEST REG C VS REG A             20820000
         BNE   ISLPA84                  B IF NOT EOT                    20840000
*                                                                       20860000
*                                       NEXT BUFFER EOT                 20880000
         OI    0(R3),X'08'              TURN T-BIT ON (STATUS BIT 4)    20900000
         ST    R6,ISLFXWK1              C(FXWK1)= CCHH FROM REG B       20920000
ISLPA8A  NC    ISLFXWK1+3(1),DCBFIRSH+3 REDUCE TO TRACK FROM REG B      20940000
ISLPA8B  CLC   DCBLDT+1(1),ISLFXWK1+3   H OF LDT VS H FROM REG B        20960000
         BNE   ISLPA84                  B IF NOT LDT                    20980000
         OI    0(R3),X'04'              TURN C-BIT ON (STATUS BIT 5)    21000000
*                                                                       21020000
* ENTER NEW COUNT IN BUFFER USING REG A AND REG B AND UPDATE LPDA       21040000
*                                                                       21060000
ISLPA84  L     R3,0(R3)                 C(R3)=C(SLOT S)=A(NEXT BUFFR)   21080000
         LA    R3,0(R3)                                                 21100000
         ST    R6,ISLFXWK2              STORE CCHH FROM REG B           21120000
         MVC   0(4,R3),ISLFXWK2                                         21140000
         STC   R5,4(R3)                 STORE R FROM REG A              21160000
         MVC   DCBLPDA+3(5),0(R3)       STORE CCHHR FROM BUF IN LPDA    21180000
         L     R14,ISLF9WK1             RESTORE R14 FOR RETURN TO FX    21200000
         BR    R14                     *EXIT                            21220000
*---------------------------------------------------------------------- 21240000
*                                                                       21260000
*                                       LAST BUFFR FILLED EOT           21280000
* SET REG 7 (REG C) = HIRPD, NEXT TRACK CANT BE SHARED                  21300000
*                                                                       21320000
ISLPA20  IC    R7,DCBHIRPD              NOT A SHARED TRACK, C(R7)=HIRPD 21340000
         ST    R6,ISLFXWK1              C(FXWK1)=CCHH FROM REG B        21360000
*                                                                       21380000
* TEST FOR OUT-OF-SPACE                                                 21400000
*                                                                       21420000
         CLC   DCBLPDA(1),DCBMSWA       CURRENT M VS HI M               21440000
         BNE   ISLPA21                  B IF NOT HI PRIME M             21460000
         CLC   ISLFXWK1(4),DCBMSWA+3    CURRENT CCHH VS HI CCHH         21480000
         BL    ISLPA21                  BR LESS THAN HIGH PRIME  A27810 21490019
*                                       CCHH                     A27810 21500019
         TM    IOBFLAGS,X'10'           TEST FOR CLOSE                  21520000
         BO    ISLPA21                  IF CLOSE, GET COUNT       17925 21540000
*                                       ELSE OUT OF SPACE         17925 21560000
*                                      *---------OUT-OF-SPACE---------* 21600000
ISLPA205 EQU   *                                                        21620000
         OI    DCBEXCD1,X'20'           SET EXCD1 BIT 2 ON = SPACE ERR  21640000
         L     R13,ISLVRSAV+4           RESTORE USER REG 13    @ZA10226 21650037
         B     ISLFX04A                 B TO TAKE SYNAD        @ZA07607 21660037
*                                                                       21680000
* TEST IF LAST BUFFER FILLED WAS EOT AND EOC                            21700000
*                                                                       21720000
ISLPA21  EQU   *                                                        21740000
         EX    R0,ISLPA8A               EXECUTE NC                      21760000
         EX    R0,ISLPA8B               EXECUTE CLC                     21780000
         BE    ISLPA30                  B IF EOT AND EOC                21800000
*                                                                       21820000
*                                       EOT NOT EOC                     21840000
* STEP REG B TO NEXT HH AND SET REG A TO R = 1                          21860000
*                                                                       21880000
         A     R6,ISLONEF               C(R6)=CCHH+1                    21900000
         L     R5,ISLONEF               C(R5)=000R, R = 1               21920000
         B     ISLPA50                                                  21940000
*                                                                       21960000
*                                                                       21980000
*                                       EOT,EOC                         22000000
* NEXT BUFFER TO BE FILLED WILL BE THE 1ST BUFFR ON A NEW CYLINDER      22020000
*                                                                       22040000
* TEST IF SHARED TRACKS                                                 22060000
*                                                                       22080000
ISLPA30  CLI   DCBHIRSH,X'00'           HIRSH VS 0                      22100000
         BE    ISLPA31                  B IF 0, NOT SHARED              22120000
*                                                                       22140000
*                                       SHARED TRACKS                   22160000
* IF SHARED TRACKS, 1ST PRIME DATA ON NEW CYLINDER IS ON A SHARED TRACK 22180000
*                                                                       22200000
         L     R3,IOBPTRB               C(R3)=PTR B = A(NEXT SLOT) OR-  22220000
         OI    0(R3),X'02'              TURN PF-BIT ON (STATUS BIT 6)   22240000
*                                                                       22260000
* SET REG 7 (REG C) = HIRSH                                             22280000
*                                                                       22300000
         IC    R7,DCBHIRSH              SHARED TRACK NEXT, C(R7)=HIRSH  22320000
*                                                                       22340000
* TEST IF LAST BUFFER FILLED WAS EOT, EOC, AND EOE                      22360000
*                                                                       22380000
ISLPA31  L     R8,DCBDEBAD              C(R8)=A(DEB)                    22400000
         L     R3,DEBFPEAD              C(R3)=A(1ST PRIME EXTENT ENTRY) 22420000
         LA    R3,0(R3)                                                 22440000
         L     R4,DCBLPDA               C(R4)=MBBC                      22460000
         SRL   R4,24                    C(R4)=000M                      22480000
         BCTR  R4,0                     C(R4)=M-1                       22500013
         SLL   R4,4                     C(R4)=000M-1 X 16 (USE AS INDX) 22520000
         L     R8,12(R4,R3)             C(R8)=HHXX-END HH OF CURR EXTNT 22540000
         SRL   R8,16                    C(R8)=00HH                      22560000
*                                                                       22660000
         L     R8,8(R4,R3)              C(R8)=END HHCC OF CURR EXTENT   22680000
         SLL   R8,16                    C(R8)=CC00                      22700000
         SRL   R8,16                    C(R8)=00CC=END CC OF EXTENT     22720000
         LR    R5,R6                    C(R5)=CCHH                      22740000
         SRL   R5,16                    C(R5)=00CC=CC JUST FILLED       22760000
         CR    R8,R5                    COMPARE FOR LAST CYLINDER       22780000
         BH    ISLPA33                  B IF END CC IS HIGH             22800000
*                                                                       22820000
*                                       EOT, EOC, AND EOE               22840000
*                                                                       22860000
* SET REG 6 (REG B) TO CC FROM NEXT EXTENT                              22880000
*                                                                       22900000
         LA    R4,16(R4)                C(R4)=MX16  INDEX TO NEXT EXTNT 22920000
         L     R8,4(R4,R3)              C(R8)=STR BBCC OF NEXT EXTENT   22940000
         SLL   R8,16                    C(R8)=CC00                      22960000
         LR    R6,R8                    C(R6)=CC00, HH SET LATER        22980000
*                                                                       23000000
* SET M IN DCBLPDA = M+1                                                23020000
*                                                                       23040000
         SRL   R4,4                     C(R4)=000M                      23060000
         A     R4,ISLONEF               C(R4)=000M+1 (M=1 FOR EXTENT 0) 23080000
         STC   R4,DCBLPDA               C(LPDA)=000M+1                  23100000
*                                                                       23120000
* SET STATUS BIT-3 ON = NEW EXTEN STARTS WITH THIS BUFFR                23140000
*                                                                       23160000
         L     R3,IOBPTRB               C(R3)=PTR B = A(NEXT SLOT) OR-  23180000
         LA    R3,0(R3)                 C(R3)=A(STATUS BITS)            23200000
         OI    0(R3),X'10'              TURN STATUS BIT-3 ON            23220000
*                                                                       23240000
         B     ISLPA34                                                  23260000
*                                                                       23280000
*                                                                       25220000
* SET REG 6 (REG B) TO CC +1            EOT, EOC, NOT EOE               25240000
*                                                                       25260000
ISLPA33  A     R5,ISLONEF               C(R5)=00CC+1, PREVIOUS CC +1    25280000
         SLL   R5,16                    C(R5)=CC00                      25300000
         LR    R6,R5                    C(R6)=CC00, HH SET BELOW        25320000
*                                                                       25340000
* SET REG 6 (REG B) TO HH FROM FIRSH                                    25360000
*                                                                       25380000
ISLPA34  ST    R6,ISLFXWK1              C(FXWK1)=CC00                   25400000
         MVC   ISLFXWK1+2(2),DCBFIRSH   C(FXWK1)=CCHH, HH FROM FIRSH    25420000
         L     R6,ISLFXWK1              C(R6)=CCHH                      25440000
*                                                                       25460000
* SET REG 5 (REG A) TO R FROM FIRSH                                     25480000
*                                                                       25500000
ISLPA35  EQU   *                                                        25520000
         SR    R5,R5                                                    25540000
         IC    R5,DCBFIRSH+2            C(R5)=000R, R FROM FIRSH        25560000
*                                                                       25580000
* PREFORMAT SHARED TRACK OF NEW CYLINDER IF NECESSARY                   25600000
*                                                                       25620000
         TM    DCBOPTCD,X'08'           TEST OPTCD BIT-4 FOR CYL OVFL   25640000
         BC    1,ISLPA40                B IF ON = CYL OVFL              25660000
         CLI   DCBHIRSH,X'00'           TEST HIRSH VS 0           8M800 25680018
         BE    ISLPA50                  B IF 0, NOT SHARED              25700000
*                                                                       25720000
*                                       SHARED TRACKS - PREFORMAT       25740000
*                                                                       25760000
* INITIALIZE CP19                                                       25780000
*****************                                                       25800000
*                                                                       25820000
ISLPA40  LA    R2,ISLIOBC               C(R2)=A(IOBC)                   25840000
*                                                                       25860000
* BE SURE CP19 NOT IN USE                                               25880000
*                                                                       25900000
         L     R4,IOBECBAD              C(R4)=A(ECB)                    25920000
         TM    0(R4),X'40'              TEST ECB BIT 1 (C-BIT)          25940000
         BC    1,ISLPA41                B IF 1, I/O COMPLETE-DONT WAIT  25960000
         LA    R13,ISLVRSAV             C(R13)=A(VRSAV)                 25980000
         LR    R3,R1                    SAVE R1                         26000000
         LR    R1,R4                    C(R1)=A(ECB)                    26020000
         LR    R4,R0                    SAVE R0                         26040000
         WAIT  ECB=(1)                  WAIT                            26060000
         LR    R0,R4                    RESTORE R0                      26080000
         LR    R1,R3                    RESTORE R1                      26100000
ISLPA41  STM   R2,R11,ISLVRSAV+28       SAVE REGS 2-11                  26120000
*                                                                       26140000
*  1. SET IOBC+32 TO NEW CC AND NEW M IF ANY                            26160000
*                                                                       26180000
         ST    R6,ISLFXWK2              C(FXWK2)=CCHH FROM REG B        26200000
         MVC   32(3,R2),DCBLPDA         MOVE MBB FROM LPDA              26220000
         MVC   35(3,R2),ISLFXWK2        MOVE CCH FROM REG B       22619 26240018
*                                                                       26400000
*  2. SET CM27 TO NEW CC AND NEW M IF ANY                               26420000
*                                                                       26440000
         L     R10,DCBWKPT6             C(R10)=A(VPTRS)                 26480000
         L     R10,16(R10)              C(R10)=A(CP19)                  26500000
         USING CM1,R10                  ADDRESSABILITY CP19      S20201 26510020
         MVC   CM27(L3),DCBLPDA         MOVE MBB FROMLPDA        S20201 26520020
         MVC   CM27+L3(L4),ISLFXWK2     MOVE IN CCHH             S20201 26530020
         DROP  R10                                               S20201 26540020
*                                                                       26560000
*  3. SET UP AREA Z WITH NEW CC                                         26580000
*                                                                       26600000
         LA    R9,ISLAREAZ              C(R9)=A(AREA Z)                 26620000
         LA    R3,10                    C(R3) = 10 = COUNT              26640000
         LA    R4,6(R9)                 C(R4)=A(Z+6)                    26660000
ISLPA42  MVC   0(4,R4),ISLFXWK2         STORE CCHH IN Z                 26680000
         A     R4,ISL8                  STEP Z                          26700000
         BCT   R3,ISLPA42               LOOP                            26720000
*                                                                       26740000
*                                                                       26760000
* EXECUTE CP19 - PREFORMAT NEW CYLINDER                                 26780000
***************************************                                 26800000
*                                                                       26820000
         LM    R2,R11,ISLVRSAV+28       RESTORE REGS 2-11               26840000
         LA    R13,ISLVRSAV             C(R13)=A(VRSAV)                 26860000
         LR    R3,R0                    SAVE R0                         26880000
         LR    R4,R1                    SAVE R1                         26900000
         EXCP  IHAIOB                   EXECUTE CHANNEL PROGRAM         26920000
         LR    R0,R3                    RESTORE R0                      26940000
         LR    R1,R4                    RESTORE R1                      26960000
         LA    R2,ISLIOBA               C(R2)=A(IOBA)                   26980000
*                                                                       27000000
         B     ISLPA50                                                  27020000
*                                                                       27040000
*---------------------------------------------------------------------- 27060000
*                                                                       27080000
         EJECT                                                          27100000
*********************************************************************** 27120000
* CHART PB - SET FBW                                                  * 27140000
*********************************************************************** 27160000
*                                                                       27180000
*                                                                       27200000
* C(R7)=A(LAST SLOT SCHED) AS IT WAS FROZEN BEFORE I/O                  27220000
*    SET REG 8 = NO OF BUFFRS NEEDED TO COMPLETE TRACK  - REG C         27240000
*                                                                       27260000
ISLPB01  L     R6,0(R7)                 C(R6)=A(LAST BUFF)              27280000
         LA    R6,0(R6)                                                 27300000
         SR    R3,R3                                                    27320000
         SR    R8,R8                                                    27340000
         IC    R3,4(R6)                 C(R3)=LAST R                    27360000
*                                                                       27380000
* TEST IF SHARED TRACKS ARE USED                                        27400000
*                                                                       27420000
         IC    R8,DCBHIRPD         C(R8)=HIRPD                          27440000
         CLI   DCBHIRSH,X'00'      HIRSH VS 0                           27460000
         BE    ISLPB02                  B IF 0, NO SHARED TRACKS        27480000
*                                                                       27500000
* TEST IF CURRENT TRACK SHARED                                          27520000
*                                                                       27540000
ISLPB01A MVC   ISLFXWK1(1),3(R6)   H (TRK BYTE) FROM BUFFER CNT         27560000
         EX    R0,ISLPA01A         REDUCE TO TRACK ADDR                 27580000
         EX    R0,ISLPA01B         H OF FIRSH VS H OF BUFFER CNT        27600000
         BE    ISLPB03                  B IF EQUAL, TRACK SHARED        27620000
*                                                                       27640000
* TEST IF LAST BUFF WAS EOC, IF SO- NEXT TRACK IS SHARED                27660000
*                                                                       27680000
         TM    0(R7),X'04'              TEST S BIT 5 VS 1 (C-BIT)       27700000
         BC    1,ISLPB05                B IF 1, EOC                     27720000
*                                                                       27740000
* 1. SHARED TRACKS-                                                     27760000
*        CURR TRACK NOT SHARED AND NOT EOC                              27780000
* 2. SHARED TRACKS NOT USED-                                            27800000
*                                                                       27820000
ISLPB02  EQU   *                                                        27840000
         TM    0(R7),X'08'              TEST S BIT 4 VS 1 (T-BIT)       27860000
         BC    1,ISLPB06                B IF 1, EOT                     27880000
         B     ISLPB06A                                                 27900000
*                                                                       27920000
* 3. SHARED TRACKS-                                                     27940000
*        CURR TRACK SHARED                                              27960000
*                                                                       27980000
ISLPB03  TM    0(R7),X'08'              TEST S BIT 4 VS 1 (T-BIT)       28000000
         BC    1,ISLPB06                B IF 1, EOT                     28020000
         IC    R8,DCBHIRSH              C(R8)=HIRSH                     28040000
         B     ISLPB06A                                                 28060000
*                                                                       28080000
* 4. SHARED TRACKS-                                                     28100000
*        CURR TRACK NOT SHARED, BUT EOC                                 28120000
*                                                                       28140000
ISLPB05  IC    R8,DCBHIRSH              C(R8)=HIRSH                     28160000
         IC    R3,DCBFIRSH+2            C(R3)=FIRSH R                   28180000
         A     R8,ISLONEF               C(R8)=HIRSH-FIRSH R +1          28200000
*                                                                       28220000
ISLPB06A CR    R8,R3                    END OF TRACK?            A41405 28225021
         BNE   SUBTR                    NO, CALCULATE FBW        A41405 28230021
         IC    R8,DCBHIRPD              YES,LAST REC UNSHARED    A41405 28235021
*                                       TRK                      A41405 28240021
         B     ISLPB06                  STORE HIRPD IN ISLFBW    A41405 28245021
SUBTR    SR    R8,R3                    CALCULATE FBW            A41405 28250021
*   REG C = HI R IF FULL TRACK TO BE WRITTEN                            28260000
*   REG C = HI R - R IF PARTIAL TRACK TO BE WRITTEN                     28280000
*                  R = NO. OF BUFFERS WRITTEN SO FAR ON THIS TRACK      28300000
*                                                                       28320000
ISLPB06  ST    R8,ISLFBW                R8 = REG C, C(FBW)=C(REG C)     28340000
*                                                                       28360000
* TEST NEW FBW VS BUFNO AND ADJUST FBW IF NECESSARY                     28380000
*                                                                       28400000
         LA    R4,1                     C(R4)=1                         28420000
         CLC   ISLFBW+3(1),ISLBUFNO     TEST FBW VS BUFNO               28440000
         BL    ISLPB20                  B IF FBW LOW                    28460000
*                                                                       28480000
*                                       FBW HI OR EQ -                  28500000
*                                                                       28520000
         CLC   ISLBUFNO(1),ISLONEF+3    TEST BUFNO VS 1                 28540000
         BE    ISLPB10                  B IF BUFNO = 1                  28560000
*                                                                       28580000
         IC    R4,ISLBUFNO              BUFNO NOT 1, C(R4)=BUFNO        28600000
         BCTR  R4,0                     C(R4)-BUFNO-1             P4701 28620000
*                                                                       28640000
*                                       BUFNO=1                         28660000
ISLPB10  EQU   *                                                        28680000
         ST    R4,ISLFBW                C(FBW)=1                        28700000
*                                                                       28720000
ISLPB20  B     ISLFY41                 *EXIT                            28740000
         EJECT                                                          28760000
*********************************************************************** 28780000
* CHART F8 - INITIALIZE CP18 FOR CURRENT BUFFER SET                   * 28800000
*********************************************************************** 28820000
*                                                                       28840000
*                                                                       28860000
* SET OFFST AND D ACCORDING TO RECFM (IOBA FLAGS BIT 7)                 28880000
*                                                                       28900000
ISLF801  L     R10,DCBWKPT6             C(R10)=A(VPTRS)                 28920000
*                                                                       29060000
* CALC FSTBF = # OF SLOTS SLOT X IS FROM SLOT #1 IN BUF CTRL TABLE      29080000
*                                                                       29100000
ISLF803  L     R3,IOBPTRA               C(R3)=C(PTR A)=A(SLOT X)        29120000
         LA    R3,0(R3)                                                 29140000
         LA    R4,IOBS                  C(R4)=A(SLOT #1)                29160000
         SR    R3,R4                    C(R3)= # OF BYTES X IS FROM #1  29180000
         SRA   R3,2                     DIV BY 4, C(R3)= DIFF IN SLOTS  29200000
         ST    R3,ISLFSTBF              C(FSTBF)= # OF SLOTS FROM #1    29220000
*                                         THAT FIRST BUF SCHED IS       29240000
*                                                                       29260000
* CALC ADDR OF WR CKD X (SCHED TO WR FIRST) FOR TIC IN CP18             29280000
*                                                                       29300000
         L     R5,ISLOFFST              C(R4+R5)=OFFST                  29320000
         MR    R4,R3                    FSTBF X OFFST, C(R5)= THE # OF  29340000
*                                         BYTES WR CKD X IS FROM THE    29360000
*                                         FIRST BYTE OF WR CKD #1       29380000
         L     R10,12(R10)              C(R10)=A(CP18)                  29400000
         LA    R4,24(R10)               C(R4)=A(WR CKD #1)              29420000
         AR    R4,R5                    C(R4)=A(WR CKD X)               29440000
         IC    R6,16(R10)               C(R6)=TIC OP CODE AT CP18+16    29460000
         ST    R4,16(R10)               C(CP18+16)=A(WR CKD X),4 BYTES  29480000
         STC   R6,16(R10)               C(CP18+16)=TIC OP CODE,1 BYTE   29500000
*                                                                       29880000
* CALC LSTBF = FBW SLOTS FROM FSTBF -1, MAY WRAPAROUND                  29900000
*                                                                       29920000
         L     R3,ISLFSTBF              C(R3)=# OF SLOTS FROM SLOT #1   29940000
         A     R3,ISLFBW                C(R3)= FSTBF + FBW              29960000
         BCTR  R3,0                     C(R3)=FSTBF + FBW-1 = LSTBF     29980000
         SR    R4,R4                    C(R4)= 0000                     30000000
         IC    R4,ISLBUFNO              C(R4)=NO OF BUFFRS              30020000
         CR    R3,R4                    LSTBF VS BUFNO, TEST WRAPAROUND 30040000
         BL    ISLF806                  B IF NO WRAPAROUND, LSTBF OK    30060000
         SR    R3,R4                    C(R3)=LSTBF-BUFNO = LSTBF       30080000
*                                         LSTBF SET FOR WRAPAROUND      30100000
ISLF806  ST    R3,ISLLSTBF              C(LSTBF)= # OF SLOTS FROM #1    30120000
*                                         THAT LAST BUF SCHED IS        30140000
         L     R5,ISLOFFST              C(R4+R5)=OFFST                  30240000
         MR    R4,R3                    LSTBF X OFFST, C(R5)= THE # OF  30260000
*                                         BYTES LAST WR CKD TO BE       30280000
*                                         EXECUTED IS FROM THE FIRST    30300000
*                                         BYTE OF WR CKD #1             30320000
         AR    R5,R10                   *                         13334 30324016
         IC    R4,ISLBUFNO              * C(6)=BUFFER NUMBER      13334 30328016
         LR    R3,R10                   * C(R3)=A(CP18)           13334 30332016
ISLF811  AL    R3,ISLOFFST              *C(R3)=A OF 1ST WRT. COMD 13334 30336016
         MVC   17(3,R3),21(R3)          * RESTORE ORIGN. TIC ADDR.13334 30340016
         BCT   R4,ISLF811               * LOOP , UNTIL ALL DONE   13334 30344016
         TM    IOBFLAGS,X'01'           * RKP=0 ?                 13334 30348016
         BC    1,ISLF808                * BRANCH IF RKP=0         13334 30352016
         MVC   49(3,R5),13(R10)         * SET TIC BRANCH TO WRT.CK13334 30356016
         MVC   ISLKEYAD+1(3),33(R5)     * SET LAST WRITE KEY ADDR.13334 30360016
ISLF809  L     R5,12(R10)               * C(R5)=A(TIC CCW)        13334 30364016
         L     R3,ISLFBW                * C(R3)=NO. OF BUF. TO WRT13334 30368016
         L     R4,20(R10)               * C(R4)=A(READ BACK CCW)  13334 30372016
ISLF807  SL    R4,ISL8                  * C(R4)=A(FIRST READ CCW) 13334 30376016
         BCT   R3,ISLF807               * LOOP,IF MORE THAN 1 BUFR13334 30380016
         ST    R4,K24(R5)               * C(R4)=A(FIRST READ     S20201 30382020
*                                       CCW)                     S20201 30384020
         OI    K24(R5),TIC              * RESTORE TIC OP CODE    S20201 30388020
         B     ISLF901                                            13334 30392016
*                                                                 13334 30396016
ISLF808  MVC   33(3,R5),13(R10)         * SET TIC BRANCH TO WRT.CK13334 30400016
         L     R4,24(R5)                * C(R4)=A(CKD OF LAST WRT)13334 30404016
         LA    R4,8(R4)                 * C(R4)=A(KEY OF LAST WRT)13334 30408016
         ST    R4,ISLKEYAD              * SET UP LAST KEY ADDR.   13334 30412016
         B     ISLF809                  * RETURN TO MAIN LINE     13334 30416016
         EJECT                                                          30440000
*********************************************************************** 30460000
* CHART F9 - INITIALIZE CP20 FOR CURRENT TRACK                        * 30480000
*********************************************************************** 30500000
*                                                                       30520000
         USING ISLY,R9                                                  30540000
*                                                                       30560000
* F9 HOUSEKEEPING                                                       30580000
*                                                                       30600000
ISLF901  L     R6,IOBPTRA               C(R6)=C(PTR A)=A(SLOT X)        30620000
         L     R6,0(R6)                 C(R6)=C(SLOT X)=A(1ST BUF)      30640000
         LA    R6,0(R6)                                                 30660000
         MVC   ISLFXWK1(4),1(R6)        C(FXWK1)=CHHR OF CNT IN 1ST BUF 30680000
         L     R7,ISLFXWK1              C(R7)=CHHR                      30700000
         BCTR  R7,0                     C(R7)=CCHR-1                    30720000
*                                                                       30740000
* TEST LAST BUFFER FOR END OF TRACK (T-BIT ON)                          30760000
*                                                                       30780000
         L     R3,ISLLSTBF              C(R3)=LSTBF                     30800000
         SLA   R3,2                     MULT BY 4, C(R3)=LSTBF IN BYTES 30820000
         LA    R3,IOBS(R3)              C(R3)=A(LSTBF SLOT IN BCT)      30840000
         TM    0(R3),X'08'              TEST S BIT 4 VS 1 (T-BIT)       30860000
         BC    1,ISLF902                B IF T-BIT ON                   30880000
*                                                                       30900000
*                                       T-BIT OFF, NO CP20 YET          30920000
*                                                                       30940000
* SET IOBA+32 (IOBDADAD) = COUNT OF 1ST BUF SCHED, R=R-1 FOR SRCH ID    30960000
*                                                                       30980000
         MVC   IOBDADAD+3(1),0(R6)      C(IOBA+35)=C FROM 1ST BUF       31000000
         ST    R7,IOBDADAD+4            C(IOBA+35)=CCHHR WITH R=R-1     31020000
         IC    R4,IOBCPSAD              SAVE SIOCC                      31040000
         ST    R10,IOBCPSAD             C(CPSAD)=CP18 START ADR         31060000
         STC   R4,IOBCPSAD              RESTORE SIOCC                   31080000
*                                                                       31100000
* SET CL1 IN CP18 TO REFERENCE IOBA+35                                  31120000
*                                                                       31140000
         LA    R3,IOBDADAD+3            C(R3)=A(IOBA+35)                31160000
         O     R3,SCHCOM                *COMBINE SCH OP CODER.    13334 31180016
         ST    R3,0(R10)                *UPDATE CP18 SCH COMD.    13334 31200016
         ST    R3,CL1-CL0(R5)           *UPDATE CP18 WRT. CK.    S20201 31210020
*                                       SCH                      S20201 31220020
         B     ISLFY21                  * RETURN TO FYRT. CK. SCH 13334 31240016
*                                                                       31280000
*                                       T-BIT ON, INITL CP20            31300000
* CLEAR TWO SW                                                          31320000
*                                                                       31340000
ISLF902  NI    IOBFLAGS,X'FB'           SET FLAGS BIT 5 = 0 (TWOSW OFF) 31360000
         OI    ISLIXLT,X'08'            SET IXLT LEV1 BIT-4 ON- TRK IX  31380000
*                                                                       31780000
* SET CP20 LINE CQ14A = CCHHR FROM COUNT OF 1ST BUF SCHED, R=R-1        31800000
*                         MBB FROM IOBA+32 (IOBDADAD)                   31820000
*                                                                       31840000
         LR    R5,R10                   C(R5)=A(CP18,CL1)               31860000
*                                                                       31880000
         L     R10,DCBWKPT6             C(R10)=A(VPTRS)                 31900000
         L     R10,20(R10)              C(R10)=A(CP20)                  31920000
         USING CQ1,R10                  ADDRESSABILITY CP20      S20201 31930020
         MVC   112(3,R10),IOBDADAD      C(CQ14A)=MBB FROM IOBA+32       31940000
         MVC   115(1,R10),0(R6)         C(CQ14A)=C FROM 1ST BUF         31960000
         ST    R7,116(R10)              C(CQ14A)=MBBCCHHR WITH R=R-1    31980000
*                                                                       32120000
* SET CL1 IN CP18 TO REFERENCE CQ14A+3                                  32140000
*                                                                       32160000
         LA    R3,115(R10)              C(R3)=A(CQ14A+3)                32180000
         O     R3,SCHCOM                *COMBINE SCH OP CODER.    13334 32190016
         ST    R3,0(R5)                 *UPDATE CP18 SCH COMD.    13334 32200016
         L     R4,12(R5)                *C(R4)=A(SCHCMD.OF CP18)  13334 32210016
         ST    R3,K8(R4)                *UPDATE SCH CMD. ADDR.   S20201 32230020
*                                                                       32260000
* TEST COUNT OF 1ST BUFFR SCHED, HH VS FIRSH HH, FOR NEW CYLINDER       32280000
*                                                                       32300000
         EX    R0,ISLPB01A              H FROM COUNT                    32320000
         EX    R0,ISLPA01A              REDUCE TO TRACK ADDR            32340000
         EX    R0,ISLPA01B              COUNT VS FIRSH                  32360000
         BE    ISLF909                  B IF EQUAL, NEW CYLINDER        32380000
*                                                                       32400000
* TEST IF LAST IX ENTRY IS ON A SHARED TRACK                            32420000
*                                                                       32440000
         CLI   DCBHIRSH,X'00'           HIRSH VS 0                      32460000
         BE    ISLF905                  B IF 0, NOT SHARED              32480000
ISLF904A MVC   ISLFXWK1(1),ISLOCNT+3    H FROM OVFLO COUNT              32500000
         EX    R0,ISLPA01A              REDUCE TO TRACK ADDR            32520000
         EX    R0,ISLPA01B              OVFLO CNT VS FIRSH              32540000
         BNE   ISLF905                  B IF NOT EQUAL, NOT SHARED      32560000
*                                       SHARED TRACK                    32580000
*                                                                       32600000
* CALC - NO ENTRIES REMAINING = (FIRSH-1) - LAST IX ENTRY, R-R          32620000
*                                                                       32640000
         MVC   ISLF9WK1+3(1),DCBFIRSH+2                                 32660000
         L     R3,ISLF9WK1              C(R3)=000R FROM FIRSH           32680000
         BCTR  R3,0                     C(R3)=000R-1 FROM FIRSH         32700000
*                                            = R OF LAST IX ENT ON TRK  32720000
         B     ISLF906A                                                 32740000
*                                       NOT A SHARED TRACK              32760000
*                                                                       32780000
* CALC - NO ENTRIES REMAINING = HIRT - LAST IX ENTRY, R-R               32800000
*                                                                       32820000
ISLF905  MVC   ISLF9WK1+3(1),ISLHIRT                                    32840000
         L     R3,ISLF9WK1              C(R3)=000R FROM HIRT            32860000
*                                       = R OF LAST IX ENTRY ON TRACK   32880000
ISLF906A EQU   *                                                        32900000
         MVC   ISLF9WK1+3(1),ISLOCNT+4                                  32920000
*                                       = R OF LAST IX ENTRY            32940000
         S     R3,ISLF9WK1              C(R3)=HIRT-OCNT                 32960000
         ST    R3,ISLNOENT              C(NOENT)=HIRT-OCNT              32980000
*                                                                       33000000
* TEST NO ENTRIES                                                       33020000
*                                                                       33040000
ISLF906  EQU   *                                                        33060000
         LTR   R3,R3                    TEST NOENT VS 0                 33080000
         BC    8,ISLF908                B IF ZERO - END OF IX TRACK     33100000
         C     R3,ISLTWOF               TEST NOENT  VS 2                33120000
         BL    ISLG101                  BR LOW - NOENT=1                33140000
         BNE   ISLF907                  B NOT 2, ROOM FOR MORE THAN 2   33160000
*                                                                       33180000
* NO ENTRIES = 2, SET TWO SW ON                                         33200000
*                                                                       33220000
         OI    IOBFLAGS,X'04'           SET FLAGS BIT 5 = 1 (TWOSW ON)  33240000
*                                                                       33260000
* NO ENTRIES = 2 OR MORE, BUMP R IN NORMAL AND OVERFLOW COUNTS          33280000
*                                                                       33300000
ISLF907  SR    R3,R3                                                    33320000
         IC    R3,ISLOCNT+4             C(R3)=R FROM OCNT               33340000
         LA    R3,1(R3)                 C(R3)=R+1                       33360000
         STC   R3,ISLNCNT+4             C(NCNT)=CCHHR, R=R+1            33380000
         LA    R3,1(R3)                 C(R3)=(R+1)+1=R+2               33400000
         STC   R3,ISLOCNT+4             C(OCNT)=CCHHR, R=R+2            33420000
         MVC   ISLNCNT+2(2),ISLOCNT+2   C(NCNT)=CCHHR, HH FROM OCNT     33440000
         B     ISLG201                                                  33460000
*                                                                       33480000
* NO ENTRIES = 0, BUMP HH IN NORMAL AND OVERFLOW COUNTS AND SET R = 1   33500000
*                                                                       33520000
ISLF908  L     R3,ISLNCNT               C(R3)=CCHH FROM NCNT            33540000
         A     R3,ISLONEF               C(R3)=CCHH+1                    33560000
         ST    R3,ISLNCNT               C(NCNT)=CCHH+1                  33580000
         B     ISLF9095                                                 33600000
*                                                                       33620000
* NEW CYLINDER, NORMAL AND OVERFLOW COUNTS RESET USING 1ST BUFFR SCHED  33640000
*                                                                       33660000
ISLF909  EQU   *                                                        33680000
         MVC   ISLNCNT(4),0(R6)         C(NCNT)=CCHH FROM 1ST BFR       33700000
*                             SET TRACK=0                               33720000
*                                                                       33820000
         MVC   ISLNCNT+2(2),ISLZEROF    C(NCNT)=CCHH WITH HH=00         33840000
ISLF9095 EQU   *                                                        33860000
         MVI   ISLNCNT+4,X'01'          C(NCNT)=CCHHR WITH R=1          33880000
         MVC   ISLOCNT(4),ISLNCNT       C(OCNT)=CCHH FROM NCNT          33900000
         MVI   ISLOCNT+4,X'02'          C(OCNT)=CCHHR WITH R=2          33920000
         B     ISLG201                                                  33940000
         EJECT                                                          34120000
*                                                                     * 34140000
* CHART G1 - CONTINUATION OF CHART F9, INDEX ENTRIES SPLIT            * 34160000
*********************************************************************** 34180000
*                                                                       34200000
* NO ENTRIES = 1, BUMP R IN NORMAL COUNT AND HH IN OVERFLOW COUNT       34220000
*                 SET R = 1 IN OVERFLOW COUNT                           34240000
*                                                                       34260000
ISLG101  IC    R3,ISLNCNT+4             C(R3)-R FROM NCNT         P4701 34280000
         LA    R3,2(0,R3)               R=R+2                     P4701 34300000
         STC   R3,ISLNCNT+4             C(NCNT)=CCHHR, R=R+2            34340000
         L     R3,ISLOCNT               C(R3)=CCHH FROM OCNT            34360000
         A     R3,ISLONEF               C(R3)=CCHH+1                    34380000
         ST    R3,ISLOCNT               C(OCNT)=CCHH+1                  34400000
         MVI   ISLOCNT+4,X'01'          C(OCNT)=CCHHR, R=1              34420000
*                                                                       34440000
* SET IOBA+35 (IOBDADAD) = NORMAL CCHHR, R=R-1 FOR SRCH ID              34460000
*                                                                       34480000
         MVC   IOBDADAD+3(5),ISLNCNT    C(IOBA+35)=CCHHR FROM NCNT      34500000
         L     R3,IOBDADAD+4            C(R3)=CHHR                      34520000
         BCTR  R3,0                     C(R3)=CCHR-1                    34540000
         ST    R3,IOBDADAD+4            C(DADAD)=MBBCCHHR WITH R=R-1    34560000
*                                                                       34580000
* TEST IF OVFLO HH IS ON A SHARED TRACK (IS IT FORMATTED)               34600000
*                                                                       34620000
         CLI   DCBHIRSH,X'00'           HIRSH VS 0                      34640000
         BE    ISLG102                  BR IF 0, NOT SHARED             34660000
         EX    R0,ISLF904A              C(FXWK1)=H FROM OVFLO CNT       34680000
         EX    R0,ISLPA01A              REDUCE TO TRACK ADDR            34700000
         EX    R0,ISLPA01B              H OF FIRSH VS C(FXWK1) OVFLO CT 34720000
         BNE   ISLG102                  B IF NOT EQUAL, NOT SHARED      34740000
*                                       SHARED TRACK                    34760000
*                                                                       34780000
* INITL CP20 FOR SHARED TRACK (FORMATTED TRACK)                         34800000
*                                                                       34820000
         LA    R3,CQ15                  C((R3)=A(CQ15)           S20201 34840020
         IC    R4,IOBCPSAD              SAVE SIOCC                      34860000
         ST    R3,IOBCPSAD              C(CPSAD)=CP20 START ADR, CQ15   34880000
         STC   R4,IOBCPSAD              RESTORE SIOCC                   34900000
         L     R3,ISLKEYAD              C(R3)=A(KEY OF LAST WR CKD)     34920000
         IC    R4,48(R10)               SAVE OP AT CQ7                  34940000
         ST    R3,48(R10)               STORE KEY ADR AT CQ7            34960000
         STC   R4,48(R10)               RESTORE OP                      34980000
         IC    R4,CQ18                  SAVE OP AT CQ18          S20201 35000020
         ST    R3,CQ18                  STORE KEY ADR AT CQ18    S20201 35020020
         STC   R4,CQ18                  RESTORE OP               S20201 35040020
         LA    R3,32(R10)               C(R3)=A(CQ5)                    35060000
         IC    R4,CQ20                  SAVE OP AT CQ20          S20201 35080020
         ST    R3,CQ20                  STORE A(CQ5) AT CQ20     S20201 35100020
         STC   R4,CQ20                  RESTORE OP               S20201 35120020
         B     ISLG202                                                  35140000
*---------------------------------------------------------------------- 35160000
*                                                                       35180000
*                                       NOT A SHARED TRACK              35200000
*                                                                       35220000
* INITL CP20 FOR UNSHARED TRACK (NON-FORMATTED TRACK)                   35240000
*                                                                       35260000
ISLG102  L     R3,ISLKEYAD              C(R3)=A(KEY OF LAST WR CKD)     35280000
         IC    R4,CQ18                  SAVE OP AT CQ18          S20201 35300020
         ST    R3,CQ18                  STORE KEY ADR AT CQ18    S20201 35320020
         STC   R4,CQ18                  RESTORE OP               S20201 35340020
         IC    R4,CQ22                  SAVE OP AT CQ22          S20201 35360020
         ST    R3,CQ22                  STORE KEY ADR AT CQ22    S20201 35380020
         STC   R4,CQ22                  RESTORE OP               S20201 35400020
*                                                                       35420000
* TEST LAST BUFFER FOR END OF CYLINDER (C-BIT ON)                       35440000
*                                                                       35460000
         L     R3,ISLLSTBF              C(R3)=LSTBF                     35480000
         SLA   R3,2                     MULT BY 4, C(R3)=LSTBF IN BYTES 35500000
         LA    R3,IOBS(R3)              C(R3)=A(LSTBF SLOT IN BCT       35520000
         TM    0(R3),X'04'              TEST S BIT 5 VS 1 (C-BIT)       35540000
         BC    1,ISLG103                B IF C-BIT ON                   35560000
*                                                                       35580000
*                                       C-BIT OFF                       35600000
         LA    R3,96(R10)               C(R3)=A(CQ13)                   35620000
         IC    R4,CQ24                  SAVE OP AT CQ24          S20201 35640020
         ST    R3,CQ24                  STORE A(CQ13) AT CQ24    S20201 35660020
         STC   R4,CQ24                  RESTORE OP               S20201 35680020
*                                                                       35700000
         MVC   CQT5A+1(3),CQT5ATIC      SKIP INACTIVE CHECK      M5864  35740020
ISLG104  EQU   *                        *                        A37537 35780020
*                                                                       35840000
         LA    R3,CQ27                  C(R3)=A(CQ27)            S20201 35860020
         IC    R4,CQ20                  SAVE OP AT CQ20          S20201 35880020
         ST    R3,CQ20                  STORE A(CQ27) AT CQ20    S20201 35900020
         STC   R4,CQ20                  RESTORE OP               S20201 35920020
         LA    R3,CQ21                  C(R3)=A(CQ21)            S20201 35940020
         IC    R4,CQ29                  SAVE OP AT CQ29          S20201 35960020
         ST    R3,CQ29                  STORE A(CQ21) AT CQ29    S20201 35980020
         STC   R4,CQ29                  RESTORE OP               S20201 36000020
         B     ISLG221                                                  36020000
*---------------------------------------------------------------------- 36040000
*                                                                       36060000
*                                                                       36080000
*                                       C-BIT ON                        36100000
ISLG103  MVC   ISLDCNT(5),ISLOCNT       C(DCNT)=CCHHR FROM OCNT         36120000
         SR    R3,R3                                                    36140000
         IC    R3,ISLDCNT+4             C(R3)=R FROM DCNT               36160000
         LA    R3,1(R3)                 C(R3)=R+1                       36180000
         STC   R3,ISLDCNT+4             C(DCNT)=CCHHR, R=R+1            36200000
         LA    R3,CQ25                  C(R3)=A(CQ25)            S20201 36220020
         IC    R4,CQ24                  SAVE OP AT CQ24          S20201 36240020
         ST    R3,CQ24                  STORE A(CQ25) AT CQ24    S20201 36260020
         STC   R4,CQ24                  RESTORE OP               S20201 36280020
*                                                                       36300000
         MVC   CQT5A+1(3),CQT5ANOP      CHECK INACTIVE ENTRY     M5864  36340020
*                                                                       36380000
         B     ISLG104                                                  36400000
         EJECT                                                          36420000
*                                                                     * 36440000
* CHART G2 - CONTINUATION OF CHARTS F9 AND G1                         * 36460000
*********************************************************************** 36480000
*                                                                       36500000
* TEST IF OVFLO HH IS ON A SHARED TRACK (IS IT FORMATTED)               36520000
*                                                                       36540000
ISLG201  EQU   *                                                        36560000
         CLI   DCBHIRSH,X'00'           HIRSH VS 0                      36580000
         BE    ISLG210                  BR IF 0 - NOT SHARED            36600000
         EX    R0,ISLF904A              C(FXWK1)=H FROM OVFLO CNT       36620000
         EX    R0,ISLPA01A              REDUCE TO TRACK ADDR            36640000
         EX    R0,ISLPA01B              H OF FIRSH VS H OF OVFLO CNT    36660000
         BNE   ISLG210                  B IF NOT EQUAL, NOT SHARED      36680000
*                                       SHARED TRACK                    36700000
*                                                                       36720000
* INITL CP20 FOR SHARED TRACK (FORMATTED TRACK) AND SET IOBA+35         36740000
*                                                                       36760000
         IC    R4,IOBCPSAD              SAVE SIOCC                      36780000
         ST    R10,IOBCPSAD             C(CPSAD)=CP20 START ADR, CQ1    36800000
         STC   R4,IOBCPSAD              RESTORE SIOCC                   36820000
*                                       SET IOBA+35 = NORMAL CCHHR      36840000
         MVC   IOBDADAD+3(5),ISLNCNT    C(IOBA+35)=CCHHR FROM NCNT      36860000
*                                                                       36880000
         L     R3,ISLKEYAD              C(R3)=A(KEY OF LAST WR CKD)     36900000
         IC    R4,16(R10)               SAVE OP AT CQ3                  36920000
         ST    R3,16(R10)               STORE KEY ADR AT CQ3            36940000
         STC   R4,16(R10)               RESTORE OP                      36960000
         IC    R4,48(R10)               SAVE OP AT CQ7                  36980000
         ST    R3,48(R10)               STORE KEY ADR AT CQ7            37000000
         STC   R4,48(R10)               RESTORE OP                      37020000
*                                                                       37040000
*                                                                       37160000
* TEST LAST BUFFER FOR END OF CYLINDER (C-BIT ON)                       37180000
*                                                                       37200000
ISLG202  L     R3,ISLLSTBF              C(R3)=LSTBF                     37220000
         SLA   R3,2                     MULT BY 4, C(R3)=LSTBF IN BYTES 37240000
         LA    R3,IOBS(R3)              C(R3)=A(LSTBF SLOT IN BCT)      37260000
         TM    0(R3),X'04'              TEST S BIT 5 VS 1 (C-BIT)       37280000
         BC    1,ISLG203                B IF C BIT ON                   37300000
*                                                                       37320000
*                                       C-BIT OFF                       37340000
         LA    R3,96(R10)               C(R3)=A(CQ13)                   37360000
         IC    R4,64(R10)               SAVE OP AT CQ9                  37380000
         ST    R3,64(R10)               STORE A(CQ13) AT CQ9            37400000
         STC   R4,64(R10)               RESTORE OP                      37420000
*                                                                       37440000
         MVC   CQT5A+1(3),CQT5ATIC      SKIP INACTIVE CHECK      M5864  37480020
         B     ISLG250                  BR - SET UP N,O DAT      A37537 37520020
*                                                                       37560000
*                                       C-BIT ON                        37580000
ISLG203  MVC   ISLDCNT(5),ISLOCNT       C(DCNT)=CCHHR FROM OCNT         37600000
         IC    R3,ISLDCNT+4             C(R3)=R FROM DCNT               37640000
         LA    R3,1(0,R3)               C(R3)-R+1                 P4701 37660000
         STC   R3,ISLDCNT+4             C(DCNT)=CCHHR, R=R+1            37680000
         LA    R3,72(R10)               C(R3)=A(CQ10)                   37700000
         IC    R4,64(R10)               SAVE OP AT CQ9                  37720000
         ST    R3,64(R10)               STORE A(CQ10) AT CQ9            37740000
         STC   R4,64(R10)               RESTORE OP                      37760000
*                                                                       37780000
         MVC   CQT5A+1(3),CQT5ANOP      CHECK INACTIVE ENTRY     M5864  37860020
*                                                                       37940000
         B     ISLG250                                                  37960000
*                                                                       37980000
*                                       NOT A SHARED TRACK              38000000
*                                                                       38020000
* INITL CP20 FOR UNSHARED TRACK (NON FORMATTED) AND SET IOBA+35         38040000
*                                                                       38060000
*                                       SET IOBA+35 = NORMAL CCHHR-1    38080000
ISLG210  MVC   IOBDADAD+3(5),ISLNCNT    C(IOBA+35)=CCHHR FROM NCNT      38100000
         L     R3,IOBDADAD+4            C(R3)=CHHR                      38120000
         BCTR  R3,0                     C(R3)=CHHR-1                    38140000
         ST    R3,IOBDADAD+4            C(DADAD)=MBBCCHHR WITH R=R-1    38160000
         L     R3,ISLKEYAD              C(R3)=A(KEY OF LAST WR CKD)     38180000
         IC    R4,CQ18                  SAVE OP AT CQ18          S20201 38200020
         ST    R3,CQ18                  STORE KEY ADR AT CQ18    S20201 38220020
         STC   R4,CQ18                  RESTORE OP               S20201 38240020
         IC    R4,CQ22                  SAVE OP AT CQ22          S20201 38260020
         ST    R3,CQ22                  STORE KEY ADR AT CQ22    S20201 38270020
         STC   R4,CQ22                  RESTORE OP               S20201 38280020
*                                                                       38320000
* TEST LAST BUFFER FOR END OF CYLINDER (C-BIT ON)                       38340000
*                                                                       38360000
         L     R3,ISLLSTBF              C(R3)=LSTBF                     38380000
         SLA   R3,2                     MULT BY 4, C(R3)=LSTBF IN BYTES 38400000
         LA    R3,IOBS(R3)              C(R3)=A(LSTBF SLOT IN BCT)      38420000
         TM    0(R3),X'04'              TEST S BIT 5 VS 1 (C-BIT)       38440000
         BC    1,ISLG211                B IF C BIT ON                   38460000
*                                                                       38480000
*                                       C-BIT OFF                       38500000
         LA    R3,96(R10)               C(R3)=A(CQ13)                   38520000
         IC    R4,CQ24                  SAVE OP AT CQ24          S20201 38540020
         ST    R3,CQ24                  STORE A(CQ13) AT CQ24    S20201 38560020
         STC   R4,CQ24                  RESTORE OP               S20201 38580020
*                                                                       38600000
         MVC   CQT5A+1(3),CQT5ATIC      SKIP INACTIVE CHECK      M5864  38670020
*                                                                       38740000
ISLG220  LA    R3,CQ21                  C(R3)=A(CQ21)            S20201 38760020
         IC    R4,CQ20                  SAVE OP AT CQ20          S20201 38780020
         ST    R3,CQ20                  STORE A(CQ21) AT CQ20    S20201 38800020
         STC   R4,CQ20                  RESTORE OP               S20201 38820020
*                                                                       38840000
ISLG221  LA    R3,CQ15                  C(R3)=A(CQ15)            S20201 38860020
         IC    R4,IOBCPSAD              SAVE SIOCC                      38880000
         ST    R3,IOBCPSAD              C(CPSAD)=CP20 START ADR, CQ15   38900000
         STC   R4,IOBCPSAD              RESTORE SIOCC                   38920000
         MVC   CQ30,IOBDADAD            C(CQ30)=MBBCCHH FROM     S20201 38930020
*                                       IOBA+32                  S20201 38940020
         MVI   CQ30+K7,K0               C(CQ30)=MBBCCHHR, R=0    S20201 38960020
         L     R3,CQ30+K4               C(R3)=CHHR               S20201 38980020
         A     R3,ISLTENF               C(R3)=CHHR, HH=HH+1             39000000
         ST    R3,CQ30+K4               C(CQ30)=MBBCCHHR, HH+1,  S20201 39010020
*                                       R=0                      S20201 39020020
*                                                                       39040000
* SET NORMAL DATA = COUNT FROM 1ST BUF SCHED (BOTH SHARED AND UNSHARED) 39060000
*                                                                       39080000
ISLG250  MVC   ISLNDAT(3),IOBDADAD      C(NDAT)=MBB FROM IOBA+32        39100000
         MVC   ISLNDAT+3(4),0(R6)       C(NDAT)=CCHH FROM 1ST BUF       39120000
         MVC   ISLODAT(7),ISLNDAT       C(ODAT)=MBBCCHH FROM NDAT       39140000
         MVC   ISLNDAT+7(2),ISLZEROF    NORMAL DATA F=0  (SHARED)       39160000
*                                       R=0                             39180000
*                                                                       39200000
         CLI   DCBHIRSH,X'00'           HIRSH VS 0                      39220000
         BE    ISLG252                  BR IF 0, NOT SHARED             39240000
         MVC   ISLFXWK1(1),ISLNDAT+6    C(FXWK1)=H OF NORMAL DATA ENTRY 39260000
         EX    R0,ISLPA01A              REDUCE TO TRACK ADDR            39280000
         EX    R0,ISLPA01B              H OF FIRSH VS C(FXWK1)          39300000
         BNE   ISLG252                                                  39320000
*                                                                       39340000
         MVI   ISLNDAT+8,X'08'          NORMAL DATA F = 08 (SHARED)     39360000
         MVC   ISLNDAT+7(1),DCBFIRSH+2  NORMAL DATA R = FIRSH R         39380000
*                                                                       39400000
* SET UP AREA Y                                                         39420000
*                                                                       39440000
ISLG252  L     R10,DCBWKPT6             C(R10)=A(VPTRS)                 39460000
         L     R9,0(R10)                C(R9)=A(Y)                      39480000
         MVC   ISLY+18(8),ISLNCNT       C(Y+18)=NORM COUNT              39500000
         MVC   ISLY+26(10),ISLNDAT      C(Y+26)=NORM DATA               39520000
         MVC   ISLY+36(8),ISLOCNT       C(Y+36)=OVFL COUNT              39540000
         MVC   ISLY+44(10),ISLODAT      C(Y+44)=OVFL DATA               39560000
         MVC   ISLY+54(8),ISLDCNT       C(Y+54)=DUMM COUNT              39580000
*                                                                       39600000
* END OF EXPANSION                                                      39620000
*                                                                       39640000
ISLG260  B     ISLFY21                  RETURN TO FY                    39660000
*---------------------------------------------------------------------- 39680000
*                                                                       39700000
*                                                                       39720000
*                                       C-BIT ON                        39740000
ISLG211  MVC   CQT5A+1(3),CQT5ANOP      CHECK INACTIVE ENTRY     M5864  39810020
*                                                                       39880000
*                                                                       39900000
* TEST TWO SW, IS THERE ROOM FOR JUST 2 MORE ENTRIES AT END OF CYLINDER 39920000
*                                                                       39940000
         TM    IOBFLAGS,X'04'           TEST FLAGS BIT 5 VS 1 (TWOSW)   39960000
         BC    1,ISLG212                B IF ON                         39980000
*                                                                       40000000
*                                       TWOSW OFF                       40020000
         MVC   ISLDCNT(5),ISLOCNT       C(DCNT)=CCHHR FROM OCNT         40040000
         SR    R3,R3                                                    40060000
         IC    R3,ISLDCNT+4             C(R3)=R FROM DCNT               40080000
         LA    R3,1(R3)                 C(R3)=R+1                       40100000
         STC   R3,ISLDCNT+4             C(DCNT)=CCHHR, R=R+1            40120000
         LA    R3,CQ25                  C(R3)=A(CQ25)            S20201 40140020
         B     ISLG213A                                                 40160000
*                                                                       40180000
*                                       TWOSW ON                        40200000
ISLG212  MVC   ISLDCNT(5),ISLOCNT       C(DCNT)=CCHHR FROM OCNT         40220000
         L     R3,ISLDCNT               C(R3)=CCHH FROM DCNT            40240000
         A     R3,ISLONEF               C(R3)=CCHH+1                    40260000
         ST    R3,ISLDCNT               C(DCNT)=CCHH+1                  40280000
         MVI   ISLDCNT+4,X'01'          C(DCNT)=CCHHR, R=1              40300000
*                                                                       40320000
* TEST IF DUMMY HH IS A SHARED TRACK (FORMATTED)                        40340000
*                                                                       40360000
         CLI   DCBHIRSH,X'00'           HIRSH VS 0                      40380000
         BE    ISLG213                  B IF 0, NOT SHARED              40400000
         MVC   ISLFXWK1(1),ISLDCNT+3    C(FXWK1)=H FROM DUMMY COUNT     40420000
         EX    R0,ISLPA01A              REDUCE TO TRACK ADDR            40440000
         EX    R0,ISLPA01B              FIRSH VS C(FXWK1)               40460000
         BNE   ISLG213                  B IF NOT EQUAL, NOT SHARED      40480000
*                                                                       40500000
*                                       SHARED TRACK (FORMATTED)        40520000
         LA    R3,72(R10)               C(R3)=A(CQ10)                   40540000
         B     ISLG213A                                                 40560000
*                                                                       40580000
*                                       NOT A SHARED TRACK              40600000
ISLG213  LA    R3,CQ25                  C(R3)=A(CQ25)            S20201 40620020
         IC    R4,CQ29                  SAVE OP AT CQ29          S20201 40640020
         ST    R3,CQ29                  STORE C(R3) AT CQ29      S20201 40660020
         STC   R4,CQ29                  RESTORE OP               S20201 40680020
*                                                                       40700000
         LA    R3,CQ27                  C(R3)=A(CQ27)            S20201 40720020
ISLG213A EQU   *                                                        40740000
         IC    R4,CQ24                  SAVE OP A CQ24           S20201 40760020
         ST    R3,CQ24                  STORE C(R3) AT CQ24      S20201 40780020
         STC   R4,CQ24                  RESTORE OP               S20201 40800020
         B     ISLG220                                                  40820000
*                                                                       40840000
         EJECT                                                          40860000
*                                                                       40880000
* F8 CONSTANTS                                                          40900000
*                                                                       40920000
ISL8     DC    F'0008'                                                  40940000
CONSF8   DC    F'248'                                             13334 40990016
*                                                                       41060000
* F9 CONSTANTS                                                          41080000
*                                                                       41100000
ISL4     DC    F'0004'                                                  41120000
ISLONEF  DC    F'0001'                                                  41180000
ISLTWOF  DC    F'0002'                                                  41200000
SCHCOM   DC    X'31000000'                                        13334 41210016
ISLZEROF EQU   SCHCOM+1                 ISLZEROF=4 BYTES OF ZEROS 20852 41215000
ISLTENF  DC    X'00000100'                                              41220000
ISLRFP   EQU   ISLTENF+3                RFP OF MBBCCHHRFP =       8M800 41225018
*                                       002907                    8M800 41230018
ISLFP    DC    X'2907'                  FP OF ISLRFP              8M800 41235018
*                                                                       41240000
* FX CONSTANTS                                                          41260000
*                                                                       41280000
ISLFX02A CLC   0(1,R4),0(R5)            KEY COMP TO BE EXECUTED (L)     41300000
ISLFX06A MVC   0(1,R5),0(R4)            MOVE KEY TO BE EXECUTED (L)     41320000
ISLFX08A CLC   0(1,R5),0(R4)            KEY COMP TO BE EXECUTED (M)     41340000
ISLFX21A MVC   0(1,R4),0(R5)            MOVE RCD TO BE EXECUTED (M)     41360000
*                                                                       41380000
PATCH    DC    XL((*-IGG019GB)/20)'00'  ZEROED PATCH AREA        Y02072 41390002
*                                                                       41420000
         END                                                            41460000
