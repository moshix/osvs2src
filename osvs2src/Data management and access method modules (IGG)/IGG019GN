         TITLE 'IGG019GN - APPENDAGES-PART 2,COMBINED,NO WRT CHK'       00020000
IGG019GN CSECT                                                          00040000
*          RELEASE OS/VS2-02 DELETIONS                                * 00042002
*          RELEASE 19 DELETIONS                                       * 00052000
*2180150800                                                      A29939 00053019
*          RELEASE 20 DELETIONS                                       * 00054000
*0568087600,103200-103400                                        A34932 00054520
*0568182400-183000                                               A34619 00055020
*0568014200,031400,032400,032600,032800,033000,038600,041600,    S20201 00055120
*0568046400,050800,052000,053000,053400-053800,054000-056000,    S20201 00055220
*0568068900,069500,075000,075400,076600,082200,082600,089400,    S20201 00055320
*0568089800,101400,105800,109600,110000,111400,111600-111800,    S20201 00055420
*0568114600,114800-115000,117400,130600,151800,152000-152800,    S20201 00055520
*0568153000-155600,160400,164200,170300,172600,176800,177000,    S20201 00055620
*0568200600-202400,202600-206400,206600-210400,210600-219400,    S20201 00055720
*0568221200-224000,224200-228000,228200-233000,233200-237000,    S20201 00055820
*0568237200-241000,241200-243000,243200-255200                   S20201 00055920
*          RELEASE 21 DELETIONS                                       * 00056000
*                                                                       00060002
*STATUS CHANGE LEVEL 009                                                00068002
* FUNCTION/OPERATION' APPENDAGE ROUTINES FOR BISAM WHEN READ AND UPDATE 00080000
*        IS USED WITH    WRITE KN,    WHEN WRITE VALIDITY CHECKING IS   00100000
*        NOT REQUESTED.                                                 00120000
*        (PART 2)                                                       00140000
*        CEND  - IF CHANNEL PROGRAM ENDS                                00160000
*                **WITHOUT ERROR, EITHER                                00180000
*                    PROCESSING COMPLETION WILL BE SCHEDULED,           00200000
*                    PROCESSING CONTINUATION WILL BE SCHEDULED,         00220000
*                    OR PROCESSING WILL CONTINUE.                       00240000
*                **WITH A LENGTH CHECK, TESTS DETERMINE WHETHER         00260000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00280000
*                    ERROR.                                             00300000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00320000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00340000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00360000
*                                                                       00380000
*        ABEND - IF CHANNEL PROGRAM ENDS ABNORMALLY BECAUSE OF          00400000
*                **PERMANENT ERROR, 'UNCORRECTABLE I/O ERROR'           00420000
*                    IS INDICATED IN THE DECB, AND PROCESSING           00440000
*                    COMPLETION WILL BE SCHEDULED.                      00460000
*                **NON-PERMANENT ERROR, ONE RE-TRY IS MADE              00480000
*                **FILE PROTECTION, TESTS DETERMINE WHETHER             00500000
*                    OR NOT TO TREAT THE SITUATION AS A REAL            00520000
*                    ERROR.                                             00540000
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            00560000
*                    BLOCK' IS INDICATED IN THE DECB, AND               00580000
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           00600000
*                                                                       00620000
* ENTRY POINTS-                                                         00640000
*        ANY POINT IN THE VECTOR TABLE AT THE BEGINNING OF THE MODULE.  00660000
* INPUT - N/A                                                           00680000
* OUTPUT - N/A                                                          00700000
* EXTERNAL ROUTINES - N/A                                               00720000
* EXITS  1. RETURN TO IOS VIA THE APPENDAGE RETURN VECTOR TABLE POINTED 00740000
*            TO BY REGISTER 14.  SEE THE DSECT LABELED IHAAPPRV FOR THE 00760000
*            FORMAT OF THIS TABLE AND THE USE OF EACH EXIT.             00780000
*        2. SCHEDULE AN ASYNCHRONOUS ROUTINE - BRANCH VIA THE EXIT      00800000
*            EFFECTOR ADDRESS IN THE COMMUNICATION VECTOR TABLE.        00820000
* TABLES/WORK AREAS ' DECB, DCB, IOB AND EXTENTION, DCB WA (DCW), DEB,  00840000
*        COMMUNICATION VECTOR TABLE.                                    00860000
*        SEE DSECTS AT END OF MODULE FOR FORMAT AND DESCRIPTIONS.       00880000
* ATTRIBUTES' REENTRANT. DISABLED.                                      00900000
* NOTES - NONE                                                          00920000
* GENERAL REGISTERS ARE USED AS FOLLOWS BY THE CEND AND ABEND ROUTINES  00940000
R0       EQU   0                   *    -----                           00960000
R1       EQU   1                   *    12* ADDRESS                     00980000
R2       EQU   2                   *    IOB                             01000000
R3       EQU   3                   *    DEB                             01020000
R4       EQU   4                   *    DCB                             01040000
R5       EQU   5                   *    -----                           01042002
R6       EQU   6                   *    -----                           01080000
R7       EQU   7                   *    UCB                             01100000
R9       EQU   9                   #    WORK REGISTER                   01140000
R10      EQU   10                       CHANNEL PROGRAM                 01160000
R11      EQU   11                       DECB                            01180000
R12      EQU   12                       WORK REGISTER                   01200000
R13      EQU   13                       WORK REGISTER                   01220000
R14      EQU   14                       IOS RETURN VECTOR TABLE         01240000
R15      EQU   15                       BASE REGISTER                   01260000
*        * MEANS THIS REGISTER IS SET UP UPON ENTRY AND MAY NOT BE      01280000
*            DESTROYED BECAUSE OF THE NEEDS OF IOS                      01300000
*        #     MEANS THIS REGISTER MAY BE CHANGED, BUT UPON RETURN MUST 01320000
*            BE IN THE FORM 000X BECAUSE OF THE NEEDS OF IOS            01340000
PERRMASK EQU   X'20'          TO TEST FOR PERMANENT ERROR, TEST         01360000
PERRYES  EQU   8               IOBECBAD, B2. IF OFF (CONDITION CODE 8)  01380000
PERRNO   EQU   7               THERE IS A PERM ERR. ELSE B2 ON ( CD 7)  01400000
BYP      EQU   12                       RETURN TO IOS/BYPASS      15924 01405016
EXCP     EQU   8                        RETURN TO IOS/EXCP        15924 01410016
NORMAL   EQU   0                        RETURN TO IOS/NORMAL      15924 01415016
K0       EQU  0                         MISC OFFSETS             S20201 01415820
K1       EQU  1                         *                        S20201 01416620
K2       EQU  2                         *                        S20201 01417420
K3       EQU  3                         *                        S20201 01418220
K4       EQU  4                         *                        S20201 01419020
K5       EQU  5                         *                        S20201 01421020
K6       EQU   6                        *                        S20201 01423020
K7       EQU   7                        *                        S20201 01425020
K10      EQU  10                        *                        S20201 01427020
NOT      EQU  255                       MASK OF ALL BITS ON      S20201 01429020
OFLORCD  EQU  2                                                  S20201 01431020
BLOCKED  EQU  X'10'                                              S20201 01433020
READKU   EQU   X'20'                    READ KEY FOR UPDATE     SA65011 01433102
MIS      EQU   PERRMASK                 MASTER IDX SRCH MASK            01433401
CCOFF    EQU   X'BF'                    TURN OFF CC MASK                01433801
         SPACE 2                                                        01434202
         USING IHAIOB,R2                                         S20201 01435020
         USING IHADEB,R3                                                01440000
         USING IHADCB,R4                                                01460000
         USING IHAWKNCP,R10                                             01480000
         USING IHADECB,R11                                              01500000
         USING IHADCW,R12                                               01520000
         USING IGG019GN,R15                                             01560000
         USING IHACVTEX,R13             CVT                             01580000
         SPACE 2                                                        01590002
*         VECTOR TABLE.  BRANCH TO THE ROUTINE SELECTED IN THE          01600000
*           APPENDAGE ROUTINE, PART 1.                                  01620000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              01640000
         LR    R15,R13                                                  01660000
         B     APPM67CE       7         CP1 OR CP2 FOR WRITE KN         01680000
         LR    R15,R13                                                  01700000
         B     APPN7B2        9,23      CP10A                           01720000
         LR    R15,R13                                                  01740000
         B     APPN8A2        10,11     CP10B                           01760000
         LR    R15,R13                                                  01780000
         B     APPM4A2        12        CP14 - SETUPS 1, 2, OR 5        01800000
         LR    R15,R13                                                  01820000
         B     APPM5A2        13        CP14 - SETUPS 3, 4, OR 6        01840000
         LR    R15,R13                                                  01860000
         B     APPM2B2        15        CP16 - SITUATION 2              01880000
         LR    R15,R13                                                  01900000
         B     APPM3B2        16        CP16 - SITUATION 3              01920000
         LR    R15,R13                                                  01940000
         B     APPN9A2        17,18,19  CP17                            01960000
         LR    R15,R13                                            17332 01966018
         B     APPAFB                   CP14 PART2                17332 01972018
*        ROUTINE FOR          CODE      ABEND COMPLETION OF             01980000
         LR    R15,R13                                                  02000000
         B     APPM67AE       7         CP1 OR CP2, WRITE KN            02020000
         LR    R15,R13                                                  02040000
         B     APPN7J2        9,23      CP10A                           02060000
         LR    R15,R13                                                  02080000
         B     APPN8G2        10,11     CP10B                           02100000
         LR    R15,R13                                                  02120000
         B     APPM4E2        12        CP14 - SETUPS 1, 2, OR 5        02140000
         LR    R15,R13                                                  02160000
         B     APPM5E2        13        CP14 -SETUPS 3, 4, OR 6         02180000
         LR    R15,R13                                                  02200000
         B     APPM2H2        15,16     CP16                            02220000
         LR    R15,R13                                                  02240000
         B     APPN9G4        17,18,19  CP17                            02260000
         LR    R15,R13                                            17332 02266018
         B     APPAEB                   CP14 PART2                17332 02272018
         B     APPN7A3                  CONTINUE ROUTINES BEGUN IN      02280000
         B     APPN7B4                   PART 1                         02300000
*        ROUTINE FOR          CODE      CEND COMPLETION OF              02320000
         LR    R15,R13                                                  02340000
         B     APPABA2        0,1       CP4/CP5                         02360000
         LR    R15,R13                                                  02380000
         B     APPADB2        2         CP7                             02400000
         LR    R15,R13                                                  02420000
         B     APPAAB2        3         CP1 OR CP2, READ AND UPDATE     02440000
         LR    R15,R13                                                  02460000
         B     APPACA2        5         CP6                             02480000
*        ROUTINE FOR          CODE      ABEND COMPLETION OF             02500000
         LR    R15,R13                                                  02520000
         B     APPABD2        0,1       CP4/CP5                         02540000
         LR    R15,R13                                                  02560000
         B     APPADE2        2         CP7                             02580000
         LR    R15,R13                                                  02600000
         B     APPAAA2        3         CP1 OR CP2, READ AND UPDATE     02620000
         LR    R15,R13                                                  02640000
         B     APPACE2        5         CP6                             02660000
*              BRANCH TO M6 OR M7                                       02680000
APPM67CE L     R13,DCBWKPT2             CHAN END OF CP1 OR CP2          02700000
         CLI   11(R13),X'01'            NLSD=1 MEANS NO MAST IX         02720000
         BE    APPM6B2                       CYLINDER - M6 (CP2)        02740000
         B     APPM7A2                       MASTER - M7 (CP1)          02760000
APPM67AE L     R13,DCBWKPT2             ABNORMAL END OF CP1 OR CP2      02780000
         CLI   11(R13),X'01'            NLSD=1 MEANS NO MAST IX         02800000
         BE    APPM6J4                       CYLINDER - M6 (CP2)        02820000
         B     APPM7J2                       MASTER - M7 (CP1)          02840000
         EJECT                                                          02860000
*              CHART M7  CP1 FOR WRITE KN, CODE 7                       02880000
*              CHANNEL END                                              02900000
APPM7A2  LA    R13,C6+8                                                 02920000
         CLR   R12,R13                  TEST STOP AT C6 - END OF SEARCH 02940000
         BE    APPM7B2                   OF MASTER INDEX. BRANCH IF YES 02960000
         LA    R13,C16+8                                                02980000
         CLR   R12,R13                  TEST STOP AT C16 - END OF SRCH  03000000
         BNE   APPN3B3                   OF CYLINDER INDEX. BRANCH NO   03020000
         TM    C18,X'20'                END OF CYLINDER SEARCH.         03040000
         BZ    APPM7C4                  TEST FOR DUMMY OR INACTIVE      03060000
         TM    C18,X'08'                                                03080000
         BZ    APPM7B3                  BRANCH IF INACTIVE OR DUMMY-END 03100000
         MVC   IOBDADAD,C17             DUMMY CHAINED.                  03120000
         LA    R12,C10A                 RESTART CP TO SEARCH CYL S20201 03140020
         ST    R12,IOBSTART-1           INDEX ON CHAIN.                 03160000
         B     APPRVXCP                 RETURN TO IOS TO EXCP           03180000
APPM7C4  MVC   IOBDADAD(7),C17          ACTIVE.                         03200000
APPM7C45 EQU   *                                                 S20201 03210020
         MVI   IOBDADAD+7,X'00'         SET UP IOB FOR CP8              03220000
         MVI   IOBAPP,CODE8             M--R IS ADDR FOUND, R=0  S20201 03230020
         L     R10,DCBWKPT3             GET STARTING ADDR OF CP8 S20201 03240020
         ST    R10,CPSTART              STORE IN IOB AS CP START S20201 03250020
         ST    R10,IOBCCWAD             AND FOR USE AS BASE REG  S20201 03260020
         MVC   CB23+K3(K5),IOBDADAD+K3  CCHH OF FIRST TRACK, R=0 S20201 03270020
         OC    CB23+K5(K3),DCBFIRSH     SET HHR TO FIRSH         S20201 03280020
         MVI   IOBFLAG1,X'42'           APP CODE 8                      03320000
         LA    R12,IOBDADAD+3           INITIALIZE CP8                  03340000
         STH   R12,CB1+2                 CB1 SET TO SEEK CCHHR OF IOB   03360000
         SRL   R12,16                                                   03380000
         STC   R12,CB1+1                                                03400000
         MVC   CB5+1(3),DECBKEY+1        CB5, CB15, CB19 ALL SET TO     03420000
         MVC   CB19+1(3),DECBKEY+1                                      03440000
APPM7G4  SR    R12,R12                  CHECK WITH DEB TO SEE IF NEXT   03460000
         IC    R12,IOBDADAD              ADDRESS ON SAME MODULE         03480000
         SLL   R12,4                                                    03500000
         L     R12,32(R3,R12)                                           03520000
         LA    R12,0(R12)                                               03540000
         CLR   R12,R7                                                   03560000
         BE    APPRVXCP                 IF SO, EXECUTE CP RETURN TO IOS 03580000
         MVI   IOBASYN,X'01'            IF NOT, SCHEDULE ASYNCHRONOUS   03600000
         B     APPN3B5                  ROUTINE TO EXCP                 03620000
APPM7B2  EQU   *                        *                               03640001
*                                                                       03650002
         TM    C6+K5,CC                 WAS C6 CHAINED                  03652001
         BZ    APPAOS1                  NO, CONTINUE                    03654001
         NI    C6+K5,CCOFF              TURN OFF INDICATOR              03656001
         OI    C6+K4,CC                 RECHAIN C6                      03658001
         B     APPAOSJ3                 RESCHEDULE CP1                  03658401
APPAOS1  EQU   *                        *                               03658801
*                                                                       03659202
         TM    C9+K7,MIS                END MASTER INDEX SEARCH.        03659601
         BZ    APPM7C2                  TEST FOR DUMMY OR INACTIVE      03660000
APPM7B3  TM    C9+7,X'08'                                               03680000
         BO    APPM7E2                  BRANCH IF INACTIVE OR DUMMY-END 03700000
         IC    R12,C9+7                 DUMMY CHAINED.                  03720000
         SLL   R12,29                   IF LEVEL INDEX NOT HIGHEST LVL, 03740000
         IC    R13,DCBNLEV               ERROR OF SOME SORT             03760000
         SLL   R13,29                                                   03780000
         CLR   R12,R13                                                  03800000
         BNE   APPN3B3                                                  03820000
*                                       ALWAYS DO CP15                  03840000
APPM7E3  MVI   IOBAPP,CODE14            TRK FULL--CP15 CODE      S20201 03860020
         MVC   IOBDADAD(3),DCBLPDA      SET UP IOB FOR CP15             03880000
         MVI   IOBDADAD+7,X'00'         INSERT ZERO INTO R              03900000
         MVC   IOBDADAD+3(4),DCBLETI    PUT DCBLETI CCHH INTO IOB       03920000
         OC    IOBDADAD+6(1),DCBFIRSH+3                                 03940000
         XC    IOBDADAD+6(1),DCBFIRSH+3  INCR TO NEXT CYL               03960000
         L     R10,DCBWKPT3                   HHR ZERO                  03980000
         ST    R10,IOBCCWAD              START ADDR CI1                 04000000
         LA    R12,CI1                   REL CCW 0  CP8                 04020000
         ST    R12,IOBSTART-1           FLAGS INDICATE CC, NO DC        04040000
         MVI   IOBFLAG1,X'42'                                           04060000
         LA    R12,IOBDADAD+3           INITIALIZE CP15                 04080000
         STH   R12,CI1+2                 CI1 POINTS TO IOB CCHHR        04100000
         SRL   R12,16                                                   04120000
         STC   R12,CI1+1                                                04140000
         MVC   CI5+K2(K5),DCBLETI       GET CCHHR OF INDEX ENTRY S20201 04150020
         MVC   CI5(K2),DCBLPDA+K1       MOVE IN BB FOR HEAD SEEK S20201 04160020
         B     APPM7G4                  BRANCH TO EXCP                  04180000
APPM7C2  TM    C9+7,X'04'               ACTIVE ENTRY.                   04200000
         BO    APPM7E2                  IF LVL 2 MAST IND JUST SRCHED   04220000
         OI    C6+4,X'40'                CC ON TO CHN FROM LVL 1 TO CYL 04240000
APPM7E2  MVC   IOBDADAD,C8+7            SEEK ADDR IN IOB IS FND ADDR    04260000
         MVI   IOBFLAG1,X'42'                                           04280000
         B     APPRVXCP                 RETURN TO IOS TO EXCP           04300000
         EJECT                                                          04320000
*              ABNORMAL END                                             04340000
APPM7J2  EQU   *                                                  19374 04350000
         TM    IOBSENSE+1,X'04'         FILE PROTECT?             19374 04360000
         BO    APPM7J3                  YES--BRANCH               19374 04370000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 04380000
         BC    PERRYES,APPN3B3          YES--BRANCH               19374 04390000
         B     APPRVNOR                 NO--RETRY CHANNEL PROGRAM 19374 04400000
APPM7J3  LA    R13,C10+8                FILE PROTECT                    04460000
         CLR   R12,R13                                                  04480000
         BNE   APPN3B3                  BRANCH IF STOP NOT AT C10       04500000
*                                                                       04510002
APPAOSJ3 EQU   *                        *                               04512001
*                                                                       04514002
         MVI   IOBFLAG1,X'42'           RESTORE IOB FLGS & ERR CTR      04520000
         MVI   IOBFLAG2,X'00'             UNRELATED FLAG ON             04540000
         MVI   IOBCSW,X'00'               OTHERS OFF                    04560000
         XC    IOBERRCT,IOBERRCT                                        04580000
         TM    C9+7,X'20'                                               04600000
         BO    APPM7B3                  BRANCH IF DUMMY OR INACTIVE     04620000
         LA    R12,C10A                 SET UP IOB TO RESTART    S20201 04640020
         ST    R12,IOBSTART-1                                           04660000
         NI    IOBFLAG1,X'FB'           RESET EXCEPTION FLAG            04680000
         B     APPM7E2                  BRANCH                          04700000
         EJECT                                                          04720000
*              M6 - CP2 FOR WRITE KN, CODE 7                            04740000
*              CHANNEL END                                              04760000
APPM6B2  LA    R13,C35+8                B2   STOP AT C350               04780000
         CLR   R12,R13                                                  04800000
         BNE   APPN3B3                       NO                         04820000
         TM    C37,X'20'             C2      DUMMY OR INACTIVE{         04840000
         BZ    APPM6D2                       NO D2                      04860000
         TM    C37,X'28'             C3      DUMMY CHAINED{             04880000
         BO    APPM6D3                       YES D3                     04900000
         TM    DCBNLEV,X'01'         C4      NLEV=F{ F MUST BE 1        04920000
         BZ    APPN3B3                       NO                         04940000
*                                       ALWAYS DO CP15                  04960000
         MVI   IOBDADAD+7,X'00'         ZERO R  SET UP CP15             04980000
         MVC   IOBDADAD(3),DCBLPDA           MBB FROM LPDA              05000000
         MVC   IOBDADAD+3(4),DCBLETI    CCHH FROM LETI                  05020000
         OC    IOBDADAD+6(1),DCBFIRSH+3                                 05040000
         XC    IOBDADAD+6(1),DCBFIRSH+3  INCREMENT TO A CYL BOUNDRY     05060000
         MVI   IOBAPP,CODE14            SET CODE 14 FOR CP15     S20201 05080020
         L     R10,DCBWKPT3          E5      CP8 ADDR                   05100000
         LA    R12,CI1                       CP15 START                 05120000
         ST    R12,IOBSTART-1                CHAN PROG START            05140000
         ST    R10,IOBCCWAD                  CCW O                      05160000
         MVI   IOBFLAG1,X'42'           USE COMMAND CHAINING            05180000
         MVC   CI5+K2(K5),DCBLETI            COUNT ADDR          S20201 05190020
         MVC   CI5(K2),DCBLPDA+K1         MOVE IN BB FOR HEAD    S20201 05200020
*                                       SEEK                     S20201 05210020
         IC    R9,CI1                        SAVE                       05220000
         LA    R12,IOBDADAD+3                                           05240000
         ST    R12,CI1                       IDENT ADDR                 05260000
         STC   R9,CI1                        SAVE                       05280000
         B     APPM7G4                  DO AN EXCP               S20201 05300020
APPM6D2  MVC   IOBDADAD(7),C36       D2      C36 MBBCCHH                05320000
         B     APPM7C45                 SET UP CP8               S20201 05360020
APPM6D3  MVC   IOBDADAD,C36          D3      C36 MBBCCHHR               05620000
         B     APPRVXCP              E3      EXCP RETURN TO IOS         05640000
         EJECT                                                          05660000
*              ABNORMAL END                                             05680000
APPM6J4  TM    IOBECBAD,PERRMASK     J4      PERMANENT ERROR TEST       05700000
         BC    PERRYES,APPN3B3          YES  B3                         05720000
         B     APPRVNOR              J5      NORMAL RETURN TO IOS       05740000
         EJECT                                                          05760000
*                        CHANNEL END APP CODES 9&23 (CP10A) CHART N7    05780000
APPN7B2  LA    R13,CB50+8               B2  STOP AT CB500               05800000
         CLR   R12,R13                                                  05820000
         BNE   APPM1B3                  NO   M1B3                       05840000
APPN7A3  L     R12,DCBWKPT2             YES  SET SAME MODULE SWITCH ON  05860000
         OI    DCWWKNI,X'20'                                            05880000
         IC    R9,IOBDADAD+7         B3      ADD 1 TO R IN IOB          05900000
         LA    R12,1(R0,R9)                                             05920000
         STC   R12,IOBDADAD+7                                           05940000
         STC   R12,DCBLPDA+7            PUT NEW R IN LPDA         11081 05960015
APPN7B4  CLI   DCBHIRSH,X'00'          ARE ALL TRACKS UNSHARED    11081 05980015
         BE    APPN7C4                  YES  C4                         06000000
         IC    R9,IOBDADAD+6            TRK SHARED                      06020000
         IC    R12,DCBFIRSH+3           AND H AND MASK TO GET           06040000
         NR    R9,R12                   REAL TRK NO.                    06060000
         EX    R9,CLIFIRSH                                              06080000
         BNE   APPN7C4                  NO   C4                         06100000
         CLC   DCBHIRSH,DCBLPDA+7       YES  HIRSH R = LPDA R {         06120000
         BNE   APPN7C2                  NO   C2                         06140000
APPN7D3  IC    R9,IOBDADAD+6            IS THIS LAST                    06160000
         IC    R12,DCBFIRSH+3                                           06180000
         NR    R12,R9                   DATA TRACK OF THIS              06200000
         EX    R12,CLILDT               CYLINDER                        06220000
         BE    APPN7D4                  YES, GO FIND NEXT CYL           06240000
         LA    R9,1(0,R9)               NO,                             06260000
         STC   R9,IOBDADAD+6            ADD 1 TO TRACK                  06280000
         MVI   IOBDADAD+7,X'00'      E2 NO   SET IOB R TO ZERO          06300000
APPN7G2  TM    DCBST,X'02'           G2      LAST BLOCK FULL{           06320000
         BZ    APPN7C2                  NO   C2                         06340000
         OI    DCBST,X'01'           G3 YES  SET LAST TRACK FULL SW ON  06360000
         B     APPN7C2                                                  06380000
APPN7D4  SR    R12,R12                                                  06400000
         IC    R12,IOBDADAD             FIND CURRENT                    06420000
         SLL   R12,4                          EXTENT                    06440000
         AR    R12,R3                                                   06460000
         OC    IOBDADAD+6(1),DCBFIRSH+3      SET TRACK TO MAX           06480000
         CLC   IOBDADAD+6(1),DEBENDHH+1-IHADEB(R12)   LAST TRACK IN EXT 06500000
         BNL   APPCCH                         YES                       06520000
         IC    R9,IOBDADAD+6            ONLY 2301 WILL GO THIS PATH     06540000
         LA    R9,1(0,R9)               TO ADD 1 TO CYLINDER            06560000
         STC   R9,IOBDADAD+6                                            06580000
         B     APPN7G4                                                  06600000
APPCCH   CLC   IOBDADAD+3(3),DEBENDCC-IHADEB(R12) LAST CYL OF           06620000
         BL    APPN7E4A                      EXTENT (CCH)               06640000
         IC    R9,IOBDADAD                                              06660000
         LA    R9,1(0,R9)               PUT NEW M IO IOB                06680000
         STC   R9,IOBDADAD                                              06700000
         LA    R12,16(0,R12)            ACCESS NEXT EXTENT INTRY IN DEB 06720000
         MVC   IOBDADAD+1(6),DEBBINUM-IHADEB(R12)   MOVE NEW BBCCHH     06740000
         L     R13,DEBUCBAD-IHADEB(R0,R12) IS NEW CYL ON SAME MODULE    06760000
         LA    R13,0(R0,R13)                                            06780000
         CLR   R13,R7                                                   06800000
         BE    APPN7G4                  YES  G4                         06820000
         L     R12,DCBWKPT2          F5 NO   SET SAME MOD SW OFF        06840000
         NI    DCWWKNI,X'DF'                                            06860000
         B     APPN7G4                       G4                         06880000
APPN7E4A MVI   IOBDADAD+K6,K0           SET TRACK TO ZERO        S20201 06881020
         IC    R13,IOBDADAD+K3          PICK UP C1 OF CC         S20201 06884020
         SLL   R13,8                    SHIFT                    S20201 06885020
         IC    R13,IOBDADAD+K4          PICK UP C2 OF CC         S20201 06886020
         LA    R13,K1(R0,R13)           ADD ONE TO CYL VALUE     S20201 06887020
         STC   R13,IOBDADAD+K4          RESTORE C2               S20201 06888020
         SRL   R13,8                    SHIFT                    S20201 06889020
         STC   R13,IOBDADAD+K3          RESTORE C1               S20201 06891020
APPN7G4  OC    IOBDADAD+6(1),DCBFIRSH+1                                 07100000
         IC    R9,DCBFIRSH+2                                            07120000
         BCTR  R9,0                                                     07140000
         STC   R9,IOBDADAD+7                                            07160000
         B     APPN7G2                                                  07180000
CLILDT   CLI   DCBLDT+1,0               OBJECT OF EXECUTE               07200000
CLIFIRSH CLI   DCBFIRSH+1,0             OBJECT OF EXECUTE               07220000
APPN7C4  CLC   DCBHIRPD,DCBLPDA+7    C4      HIRPD R = LPDA R {         07240000
         BE    APPN7D3                  YES  D3                         07260000
APPN7C2  MVC   CB55(4),IOBDADAD+3    C2 NO                              07280000
         IC    R9,IOBDADAD+7                                            07300000
         LA    R12,1(R0,R9)                                             07320000
         STC   R12,CB55+4                                               07340000
         MVI   IOBFLAG1,X'42'           SET B1 ON (CC)                  07360000
         LA    R12,CB52                      SET IOB START TO CP10B     07380000
         ST    R12,IOBSTART-1                                           07400000
         LA    R13,IOBDADAD+3                                           07420000
         STH   R13,CB52+2                                               07440000
         SRL   R13,16                                                   07460000
         STC   R13,CB52+1                                               07480000
         CLI   IOBAPP,CODE9             IS APPENDAGE CODE 9      S20201 07500020
         BE    APPN7E1                  YES  E1                         07520000
         MVI   IOBAPP,CODE11            SET APPENDAGE CODE TO 11 S20201 07540020
APPN7F1  L     R12,DCBWKPT2          F1      SAME MODULE SW ON{         07560000
         TM    DCWWKNI,X'20'                                            07580000
         BO    APPRVXCP                 YES  EXCP RETURN TO IOS         07600000
         MVI   IOBASYN,X'01'            NO   SET ASYNC CODE 1           07620000
         B     APPM1B5                       SCHED ASYNC ROUTINE        07640000
APPN7E1  MVI   IOBAPP,CODE10            SET APPENDAGE CODE TO 10 S20201 07660020
         B     APPN7F1                       F1                         07680000
         EJECT                                                          07700000
*                             ABNORMAL END APP CODE 9&23 (CP10A)CHARTN7 07720000
APPN7J2  TM    IOBECBAD,PERRMASK     J2      PERMANENT ERROR TEST       07740000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       07760000
         TM    IOBSENSE,X'08'        J3 YES  CAUSE DATA CHECK{          07780000
         BZ    APPM1B3                  NO   M1B3                       07800000
         LA    R13,CB48+8                                               07820000
         CLR   R12,R13                                                  07840000
         BE    APPN7J5                  YES  N7J5                       07860000
         LA    R13,CB49+8                                               07880000
         CLR   R12,R13                                                  07900000
         BE    APPN7J5                  YES  N7J5                       07920000
         LA    R13,CB50+8                                               07940000
         CLR   R12,R13                                                  07960000
         BE    APPN7J5                  YES  N7J5                       07980000
         B     APPM1B3                  NO   M1B3                       08000000
APPN7J5  OI    DECBEXC1,X'08'        J5     IND UNCOR I/O ERR           08020000
         B     APPM1B4                                                  08040000
         EJECT                                                          08060000
*                             CHANNEL END APP CODES 10&11(CP10B)CHARTN8 08080000
APPN8A2  LA    R13,CB54+8                                               08100000
         CLR   R12,R13                                                  08120000
         BNE   APPM1B3                  NO   M1B3                       08140000
         TM    CB53+4,X'20'             EOF FOR CP14?             13270 08146015
         BO    APPM426                                            17332 08153018
         L     R12,DCBNREC                                              08160000
         LA    R12,1(R0,R12)                                            08180000
         ST    R12,DCBNREC                   ADD 1 TO PRIME COUNT       08200000
         CLI   IOBAPP,CODE10            IS APPENDAGE CODE 10     S20201 08220020
         BE    APPM1B4                  YES  M1B4                       08240000
         MVI   IOBAPP,CODE18            NO, SET APP CODE TO 18   S20201 08260020
         OI    IOBFLAG1,X'C0'                SET B0&B1 ON (CC&DC)       08280000
         LA    R12,CK1                       SET IOB START TO CP17      08300000
         ST    R12,IOBSTART-1                                           08320000
         MVC   IOBDADAD+3(5),DCBLETI         SET SEEK ADDR IN IOB       08340000
         MVC   IOBDADAD(3),DCBLPDA                                      08360000
         LA    R12,IOBDADAD+3        D2      INITIALIZE CP17            08380000
         ST    R12,CK1                                                  08400000
         MVI   CK1,X'31'                                                08420000
         ST    R12,CK4                                                  08440000
         MVI   CK4,X'31'                                                08460000
         MVC   CK6+1(3),DECBKEY+1                                       08480000
         B     APPM7G4                                                  08500000
         EJECT                                                          08520000
*                        ABNORMAL END APP CODES 10&11 (CP10B) CHART N8  08540000
APPN8G2  TM    IOBECBAD,PERRMASK     G2      PERMANENT ERROR TEST       08560000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       08580000
         TM    IOBSENSE,X'08'        G3 YES  CAUSE DATA CHECK{          08600000
         BZ    APPM1B3                  NO   M1B3                       08620000
         LA    R13,CB55+8                                               08640000
         CLR   R12,R13                                                  08660000
         BE    APPN7J5                  YES  N7J5                       08680000
         B     APPM1B3                  NO   M1B3                       08700000
         EJECT                                                          08720000
*                        CHANNEL END APP CODES 17,18,19 (CP17) CHART N9 08740000
APPN9A2  LA    R13,CK1                  CP START MAY HAVE BEEN   A34932 08748020
*                                       CHANGED                  A34932 08756020
         ST    R13,IOBSTART-1              FOR RETRY ON ERROR.   A34932 08764020
         LA    R13,CK7+8             A2   STOP AT CK70           A34932 08772020
         CLR   R12,R13                                                  08780000
         BNE   APPM1B3                  NO   M1B3                       08800000
         CLI   CK9,X'00'             A3      TEST F IN CK9              08820000
         BE    APPN9B3                       NORMAL TRACK INDEX         08840000
         CLI   CK9,X'08'                                                08860000
         BE    APPN9B3                       SHARED                     08880000
APPN9B2  EQU   *                                                        08900000
         L     R12,DCBWKPT2                                             08920000
         CLI   IOBAPP,CODE17            IS APPENDAGE CODE 17     S20201 08940020
         BE    APPM1B4                  YES  M1B4                       08960000
         CLI   IOBAPP,CODE18            IS APPENDAGE CODE 18     S20201 08980020
         BE    APPN9C2                  YES  C2                         09000000
         CLC   DCWNLEVC,DCBNLEV      E2 NO   (19)NLEV CTR = DCBNLEV|    09020000
         BE    APPN9F1                  YES                             09040000
         IC    R13,DCWNLEVC          G2 NO   ADD 1 TO NLEV COUNTER      09060000
         LA    R13,1(R0,R13)                                            09080000
         STC   R13,DCWNLEVC                                             09100000
         CLI   DCWNLEVC,X'02'           TEST NLEV COUNTER = 2           09120000
         BE    APPN9E3                   BRANCH IF YES                  09140000
         CLI   DCWNLEVC,X'03'           TEST NLEV COUNTER = 3           09160000
         BE    APPN9F3                   BRANCH IF YES, ELSE = 4        09180000
         MVC   IOBDADAD+3(5),DCBLEMI3    G3  SET SEEK ADDR TO LEMI3     09200000
         CLI   DCBFTMI3+1,X'00'                                         09220000
         BE    *+14                                                     09240000
         MVC   IOBDADAD(1),DCBFTMI3+1                                   09260000
         B     APPN9C5                                                  09280000
         MVC   IOBDADAD(1),DCBFTMI3                                     09300000
         B     APPN9C5                                                  09320000
APPN9E3  MVC   IOBDADAD+3(5),DCBLEMI1   E3  SET SEEK ADDR TO LEMI1      09340000
         CLI   DCBFTMI1+1,X'00'                                         09360000
         BE    *+14                                                     09380000
         MVC   IOBDADAD(1),DCBFTMI1+1                                   09400000
         B     APPN9C5                                                  09420000
         MVC   IOBDADAD(1),DCBFTMI1                                     09440000
         B     APPN9C5                                                  09460000
APPN9F3  MVC   IOBDADAD+3(5),DCBLEMI2   F3  SET SEEK ADDR TO LEMI2      09480000
         CLI   DCBFTMI2+1,X'00'                                         09500000
         BE    *+14                                                     09520000
         MVC   IOBDADAD(1),DCBFTMI2+1                                   09540000
         B     *+10                                                     09560000
         MVC   IOBDADAD(1),DCBFTMI2                                     09580000
         XC    IOBDADAD+1(2),IOBDADAD+1                                 09600000
         B     APPN9C5                       C5                         09620000
APPN9B3  CLI   CB26,X'10'            B3      TEST F IN CB26             09640000
         BNE   APPN9B2                       NOT OVERFLOW END           09660000
         MVC   IOBDADAD+3(5),CB24    C3      OVERFLOW ENTRY             09680000
         B     APPRVXCP              C4      EXCP RETURN TO IOS         09700000
APPN9F1  TM    DCWHIAV,X'40'                 HIGH IND IN CORE?          09720000
         BZ    APPN9H1                  NO   H1                         09740000
         L     R12,DCWMSHIL          G1 YES  CHNG KEY OF LST CORE INDEX 09760000
         L     R11,DECBKEY                                              09780000
         IC    R9,DCBKEYLE                                              09800000
         LA    R13,0(R0,R9)                                             09820000
         BCTR  R13,R0                                                   09840000
         EX    R13,APPN9G1A                                             09860000
APPN9H1  MVI   IOBASYN,X'08'         H1      SET ASYNC CODE 8           09880000
         B     APPM1B5                       SCHED ASYNC ROUTINE        09900000
APPN9C2  CLI   DCBNLEV,X'00'         C2      DCBNLEV = 0 {              09920000
         BE    APPM1B4                  YES  M1B4                       09940000
         L     R12,DCBWKPT2             R12  ADDRESS DCB WA             09960000
         MVI   DCWNLEVC,X'01'        D2 NO   SET NLEV COUNTER TO 1      09980000
         MVC   IOBDADAD+3(5),DCBLECI     D3  SET SEEK ADDR TO LECI      10000000
         CLI   DCBFTCI+1,X'00'                                          10020000
         BE    *+14                                                     10040000
         MVC   IOBDADAD(1),DCBFTCI+1                                    10060000
         B     APPMVI                                                   10080000
         MVC   IOBDADAD(1),DCBFTCI                                      10100000
         XC    IOBDADAD+1(2),IOBDADAD+1                                 10120000
APPMVI   MVI   IOBAPP,CODE19            SET APPENDAGE CODE TO 19 S20201 10140020
         OI    IOBFLAG1,X'C0'                SET B0&B1 ON (CC&DC)       10160000
         LA    R12,CK1                       SET IOBSTART TO CK1        10180000
         ST    R12,IOBSTART-1                                           10200000
APPN9C5  MVI   IOBASYN,X'01'         C5      SET ASYNC CODE 1           10220000
         B     APPM1B5                       SCHED ASYNC ROUTINE        10240000
         EJECT                                                          10260000
*                        ABNORMAL END APP CODES 17,18,19 (CP17)CHART N9 10280000
APPN9G4  TM    IOBECBAD,PERRMASK     G4      PERMANENT ERROR TEST       10300000
         BC    PERRYES,APPM1B3        YES   M1B3                 A34932 10306020
* THIS IS A FIRST ENTRY ON AN ERROR.                                    10312020
         LA    R11,CK4                  TEST FOR STOP PRIOR TO   A34932 10318020
*                                       CK4                      A34932 10324020
         CLR   R12,R11                  DID IT STOP BEFORE CK4?  A34932 10330020
         BNH   APPRVNOR                 BIF YES. RETRY FROM CK1. A34932 10336020
         ST    R11,IOBSTART-1           RETRY FROM CK4           A34932 10342020
         B     APPRVNOR                 RETURN TO IOS.           A34932 10348020
APPN9G1A MVC   0(0,R12),0(R11)                                          10360000
         EJECT                                                          10380000
*        COMMON ROUTINE TO SCHEDULE ASYNCHRONOUS ROUTINE                10400000
APPM1B3  OI    DECBEXC1,X'04'        B3      SET DECB EXCD TO UNRCHABLE 10420000
APPM1B4  MVI   IOBASYN,X'08'         B4      SET ASYNC CODE TO 8        10440000
APPM1B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 10460002
         EJECT                                                          10540000
*                        CHANNEL END APP CODE 15 (CP16) CHART M2        10560000
APPM2B2  LA    R13,CJ10+L'CJ10          B2   STOP AT CJ100              10580020
         CLR   R12,R13                                                  10600000
         BNE   APPM1B3                  NO   M1B3                       10620000
         L     R12,DCBMSWA           C2 YES  OFLO END ENTRY?            10640000
         TM    8(R12),X'08'                                             10660000
         BZ    APPM2D3                  YES  D3                         10680000
         MVC   IOBDADAD,0(R12)       E2 NO   SET SEEK ADDR FROM LINK    10700000
         B     APPM7G4                                                  10720000
APPM2D3  MVC   CJ11,IOBDADAD         D3      PUT SEEK ADDR IN CJ11      10740000
         MVI   IOBASYN,X'0B'                 SET ASYNC CODE 11          10760000
         NI    IOBINDCT,X'DF'                SET B2-OFLO RCD FR AREA    10780000
         B     APPM1B5                       SCHED ASYNC ROUTINE        10800000
         EJECT                                                          10820000
*                        ABNORMAL END APP CODES 15,16,(CP16) CHART M2   10840000
APPM2H2  TM    IOBECBAD,PERRMASK     H2      PERMANENT ERROR TEST       10860000
         BC    PERRNO,APPRVNOR          NO   CONTINUE, NORMAL IOS       10880000
         B     APPM1B3                  YES  M1B3                       10900000
         EJECT                                                          10920000
*                        CHANNEL END APP CODE 16 (CP16) CHART M3        10940000
APPM3B2  LA    R13,CJ10+L'CJ10          B2   STOP AT CJ10               10960020
         CLR   R12,R13                                                  10980000
         BNE   APPM3B3                  NO - TRY CJ9             S20201 10990020
         MVC   CJ11,IOBDADAD                 SAVE SEEK ADDR IN CJ11     11020000
         L     R12,DCBMSWA           D2 YES  SET IOB SEEK FROM LINK     11040000
         MVC   IOBDADAD,0(R12)                                          11060000
         L     R12,DCBWKPT2          E2      SET FIRST TIME ONLY SW OFF 11080000
         NI    DCWWKNI,X'BF'                                            11100000
         B     APPM7G4                                                  11120000
APPM3B3  LA    R13,CJ9+L'CJ9           STOP AT CJ9                      11130020
         CLR   R12,R13                                           S20201 11140020
         BNE   APPM3B4                  NO - TRY CJ8             S20201 11150020
         MVC   CJ11,IOBDADAD                 SAVE SEEK ADDR IN CJ11     11200000
         TM    DCBOPTCD,X'02'        C3 YES  DELETE OPTION{             11220000
         BZ    APPM3C4                  NO   C4                         11240000
         L     R12,DCBMSWA           D3 YES  RCD MARKED FOR DELETION{   11260000
         LA    R13,10(R0,R12)                                           11280000
         CLI   0(R13),X'FF'                                             11300000
         BNE   APPM3C4                  NO   C4                         11320000
         MVI   IOBASYN,X'0E'         E3 YES  SET ASYNC CODE 14          11340000
APPM3E4  NI    IOBINDCT,X'DF'        E4      SET B2-OFLO RCD FR AREA    11360000
         B     APPM1B5               E5      SCHED ASYNC ROUTINE        11380000
APPM3C4  OI    DECBEXC1,X'01'        C4      SET EXCEP CODE TO IND DUPL 11400000
         MVI   IOBASYN,X'08'         D4      SET ASYNC CODE 8           11420000
         B     APPM1B5                       SCHED ASYNC ROUTINE        11440000
APPM3B4  LA    R13,CJ8+L'CJ8            SEE IF STOPPED AT CJ8           11450020
         CLR   R12,R13                                           S20201 11460020
         BNE   APPM1B3                  IF NOT, UNREACHABLE BLK  S20201 11470020
         L     R12,DCBWKPT2          C5 YES  FIRST TIME ONLY SW ON{     11520000
         TM    DCWWKNI,X'40'                                            11540000
         BO    APPM3B5                  YES  B5                         11560000
         MVI   IOBASYN,X'0C'         D5 NO   SET ASYNC CODE 12          11580000
         B     APPM3E4                       E4                         11600000
APPM3B5  MVI   IOBASYN,X'0D'         B5      SET ASYNC CODE 13          11620000
         MVC   IOBDADAD(7),CJ11         RESTORE TRK INDEX MBBCCHH       11640000
         B     APPM3E4                                                  11660000
         EJECT                                                          11680000
*                             CHANNEL END APP CODE 12 (CP14) CHART M4   11700000
APPM4A2  LA    R13,CH18+8               DID CHAN PROG STOP AT CH18      11720000
APPM4A21 EQU   *                                                  13270 11722015
         TM    CB53+4,X'20'             EOF WRITTEN               13270 11724015
         BZ    APPM4A22                 BRANCH IF NO              13270 11726015
         MVC   IOBDADAD,DCBLIOV         INITIALIZE IOBDADAD SEEK  13270 11728015
         MVC   DCBLIOV(3),CH23          RESET LIOV FROM           13270 11730015
         MVC   DCBLIOV+3(5),CH24        CP14                      13270 11732015
         CLR   R12,R13                                            13270 11734015
         BNE   APPM1B3                  B = UNREACHABLE           13270 11736015
         MVI   IOBFLAG1,X'42'          CC SET ON                  13270 11738015
         MVI   IOBAPP,CODE10            SET APPENDAGE CODE 10    S20201 11740020
         LA    R12,CB52                                           13270 11742015
         ST    R12,IOBSTART-1                                     13270 11744015
         LA    R13,IOBDADAD+3                                     13270 11746015
         STH   R13,CB52+2                                         13270 11748015
         SRL   R13,16                                             13270 11750015
         STC   R13,CB52+1                                         13270 11752015
         SR    R13,R13                                            16384 11752316
         IC    R13,IOBDADAD             GET M                     16384 11752616
         SLL   R13,4                    TIMES 16                  16384 11752916
         LA    R13,32(R3,R13)           ALLOW FOR BASIC DEB TOO   16384 11753216
         L     R12,0(0,R13)             GET UCB POINTER           16384 11753516
         LA    R12,0(0,R12)             ZERO HIGH ORDER BYTE      16384 11753816
         CR    R7,R12                   SAME UNIT                 16384 11754116
         BE    APPRVXCP                 YES--EXCP RETURN          16384 11754416
         MVI   IOBASYN,X'01'            NO--SET ASYNCH CODE = 1   16384 11754716
         B     APPM1B5                  SCHEDULE ASYNCHRONOUS RTN 16384 11755016
APPM426  CLI   CK9+7,12                INSERT TO MIDDLE  OVFL CH  17332 11755218
         MVI   CB53+4,X'00'            RESET EOF FLAG             17332 11755418
         BE    APPM1B4                 IF YES POST COMPLETION     17332 11755618
APPM4A22 EQU   *                                                  13270 11756015
         CLR   R12,R13                                            13270 11760015
         BNE   APPM1B3                  B = UNREACHABLE           13270 11762015
         TM    CH8E+4,X'40'            TEST FOR UWA               17332 11762618
         BZ    APPM425                 IF NO-BRANCH               17332 11763218
         NI    CH8E+4,X'42'            RESET  FLAG                17332 11763818
         CLI   CK9+7,14                 ASYN CODE=14              17332 11764418
         BE    APPM1B4                  IF YES-POST COMPLETION    17332 11765018
         CLI   CK9+7,9                  ASYN CODE=9               17332 11765618
         BE    APPM4A23                 IF YES BRANCH             17332 11766218
         MVI   IOBAPP,X'04'             SET UP CP14 PART2         17332 11766818
         MVC   IOBSTART,CH21+4          TO UPDATE TRACK           17332 11767418
         MVC   IOBDADAD,CH14           RESTORE IOBSEEK            17332 11768018
         MVI   CH14,X'03'               SET NOP IN CH14           17332 11768618
         MVI   CH14+4,X'20'                                       17332 11769218
         MVI   CH14+7,X'01'                                       17332 11769818
         B     APPN9C5                                            17332 11770418
APPM4A23 MVI   IOBCOUNT,X'01'           ERROR COUNT=1             17332 11771018
         MVC   IOBDADAD(3),CB10+7       IOBSEEK ADDR              17332 11771618
         MVC   IOBDADAD+3(5),CB23+3                               17332 11772218
         IC    R12,IOBDADAD+7           REDUCE R BY 1             17332 11772818
         BCTR  R12,R0                                             17332 11773418
         STC   R12,IOBDADAD+7                                     17332 11774018
         TM    DCBRECFM,X'10'          TEST FOR BLOCKED           17332 11774618
         BO    APPM424                 IF YES-BRANCH              17332 11775218
         L     R12,CH6+4               RESTORE 10 BYTES           17332 11775818
         L     R13,DECBAREA            USED FOR LINK FIELD IN     17332 11776418
         MVC   0(10,R12),0(R13)        OVFL RECORD                17332 11777018
APPM424  MVC   IOBSTART,CD2+5           START OF CP12B            17332 11777618
         MVI   IOBAPP,X'15'             APP CODE 15               17332 11778218
         OI    IOBFLAG1,X'C0'                                     17332 11778818
         B     APPN9C5                                            17332 11779418
APPM425  L     R12,DCBWKPT2                                       17332 11789418
         TM    DCWWKNI,X'10'            IS  ADD-TO-END INDICATOR ON     11800000
         BZ    APPM1B4                  NO - SCHEDULE COMPLETION        11820000
APPM4C2  MVC   CK6+1(3),DECBKEY+1  IF SO, SET ADDR OF CK6 TO DECB KEY   11840000
         LA    R12,IOBDADAD+3           SET UP CP17                     11860000
         STH   R12,CK1+2                                                11880000
         SRL   R12,16                                                   11900000
         STC   R12,CK1+1                                                11920000
         MVC   CK4+1(3),CK1+1                                           11940000
         B     APPN9C2             BRANCH                               11960000
         EJECT                                                          11980000
*                             ABNORMAL END APP CODE 12 (CP14) CHART M4  12000000
APPM4E2  EQU   *                                                  19374 12010000
         TM    IOBSENSE+1,X'04'         FILE PROTECT?             15924 12030016
         BO    APPM4I2                  YES BRANCH                15924 12040016
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 12060000
         BC    PERRNO,APPRVNOR          NO--RETRY CHANNEL PROG    19374 12080000
         TM    IOBSENSE,X'08'                                           12100000
         BZ    APPM1B3             BRANCH IF CAUSE NOT DATA CHECK       12120000
APPM4G2  LA    R13,CH16+8               IF STOP NOT AT CH16, CH17, OR   12140000
         CLR   R12,R13                   CH18, BRANCH                   12160000
         BE    APPM4H2                                                  12180000
         LA    R13,CH17+8                                               12200000
         CLR   R12,R13                                                  12220000
         BE    APPM4H2                                                  12240000
         LA    R13,CH18+8                                               12260000
         CLR   R12,R13                                                  12280000
         BNE   APPM1B3                                                  12300000
APPM4H2  OI    DECBEXC1,X'08'           IF SO, SET UNCORRECTABLE I/O    12320000
         B     APPM1B4                   ERROR IN EXCEP CODE IN DECB    12340000
APPM4I2  LA    R13,CH14+8               DID CHAN PROG STOP AT CH14      12360000
          CLR   R12,R13                 BE MEANS YES, BNE MEANS NO      12380000
         BNE   APPM1B3                  NO - RECORD IS UNREACHABLE      12400000
         MVC   IOBDADAD,CH23            MOVE CH23 MBBCCHHR TO IOB       12420000
         MVC   IOBSTART,IOBCSW+1        RESUME PROCESSING AT CH15       12440000
         MVI   IOBASYN,X'01'                                            12460000
         B     APPM1B5                  EXCP IN ASYNCHRONOUS ROUTINE    12480000
         EJECT                                                          12500000
*              CHART M5  COMPLETION OF CP14, CODE 13                    12520000
*              CHANNEL END                                              12540000
APPM5A2  LA    R13,CH22+8               DID CHAN PROG STOP AT CH22      12560000
         B     APPM4A21                                                 12580000
         EJECT                                                          12600000
*              ABNORMAL END                                             12620000
APPM5E2  EQU   *                                                  19374 12630000
         TM    IOBSENSE+1,X'04'         FILE PROTECT?             15924 12650016
         BO    APPM5I2                  YES BRANCH                15924 12660016
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 12680000
         BC    PERRNO,APPRVNOR          NO--RETRY CHAN PROG       19374 12700000
         TM    IOBSENSE,X'08'      IF YES,                              12720000
         BZ    APPM1B3              BRANCH IF CAUSE NOT DATA CHECK      12740000
         LA    R13,CH22+8                                               12760000
         CLR   R12,R13                                                  12780000
         BE    APPM4H2              BRANCH IF STOP AT CH22              12800000
         B     APPM4G2              BRANCH OTHERWISE.                   12820000
APPM5I2  LA    R13,CH19+8               DID CHAN PROG STOP AT CH19      12840000
          CLR   R12,R13                 BE MEANS YES, BNE MEANS NO      12860000
         BNE   APPM4I2                  NO - BRANCH TO TEST FOR CH14    12880000
         MVC   IOBDADAD,CJ11            MOVE CJ11 MBBCCHHR TO IOB       12900000
         MVC   IOBSTART,IOBCSW+1        RESUME PROCESSING AT CH20       12920000
         MVI   IOBASYN,X'01'                                            12940000
         B     APPM1B5                  EXCP IN ASYNCHRONOUS ROUTINE    12960000
         EJECT                                                  , 17332 12960818
*              NORMAL END APPENDAGE CODE 4                              12961618
*              UPDATE TRACK INDICES WITH 2ND PART CP14                  12962418
*                                                                       12963218
*                                                                       12964018
APPAFB   LA    R13,CH14+8               DID CP END AT CH14        17332 12964818
         CLR   R12,R13                                            17332 12965618
         BNE   APPN3B3                  NO-RECORD IS UNREACHABLE  17332 12966418
         MVC   IOBASYN,CK9+7                                      17332 12967218
         CLI   IOBASYN,10          ADD TO END                     17332 12968018
         BE    APPM4C2             IF YES-GO UPDATE MSTR INDICES  17332 12968818
         CLI   IOBASYN,11          ADD TO END                     17332 12969618
         BE    APPM4C2             IF YES-GO UPDATE MSTR INDICES  17332 12970418
         B     APPM1B4             POST COMPLETION                17332 12971218
         EJECT                                                  , 17332 12972018
*                                                                       12972818
*              ABNORMAL END  APPENDAGE CODE 4                           12973618
*              UPDATE  TRACK INDICES                                    12974418
*                                                                       12975218
APPAEB   TM    IOBECBAD,PERRMASK        PERM ERROR                17332 12976018
         BC    PERRNO,APPRVNOR          IF NO-NORMAL RET TO IOS   17332 12976818
         B     APPM1B3                  POST UNREACHABLE BLOCK    17332 12977618
         EJECT                                                          12980000
*           READ AND UPDATE APPENDAGE MODULES         *********         13000000
*                                                                       13020000
APPHCA14 DC    A(CA14-IHACP47+8)                                        13040000
APPHCA20 DC    A(CA20-IHACP47+8)        CA20 OFFSET              S20201 13060020
APPHCA23 DC    A(CA23-IHACP47+8)                                        13080000
APPHCA24 DC    A(CA24-IHACP47+8)                                        13100000
APPHCA31 DC    A(CA31-IHACP47+8)                                        13120000
APPCA31B DC    A(CA31B-IHACP47+8)       CA31B OFFSET             S20201 13130020
APPHCA36 DC    A(CA36-IHACP47+8)                                        13140000
APPHCA43 DC    A(CA43-IHACP47+8)                                        13160000
APPHCA10 DC    A(CA10-IHACP47+8)        CA10 OFFSET                     13172001
*                                                                       13174002
*        CHANNEL END APP CODE 3 (CP2) CHART AA                          13180000
         USING CP2,R10                                                  13200000
APPAAB2  L     R13,DCBWKPT2             R13  ADDR DCB WA                13220000
         USING IHADCW,R13                                               13240000
         CLI   DCWNLSD,X'01'            BRANCH IF NLSD NOT 1, I.E.      13260000
         BH    APPAEB2                   IF CP1 IS BEING USED           13280000
         LA    R13,C35+8                                                13300000
         CLR   R12,R13                                                  13320000
         BNE   APPAAB3                  NO   B3                         13340000
         TM    C37,X'20'                YES  DUMMY OR INACTIVE TEST     13360000
         BO    APPAAC3                  YES  C3                         13380000
         MVC   IOBDADAD,C36             NO   C36 TO IOBDADAD            13400000
         MVI   IOBASYN,X'03'         E2      ASYNC CD SET=3 (G CP1,2)   13420000
         B     APPABSAR                                                 13440000
APPAAC3  TM    C37,X'08'                TEST DUMMY CHAINED              13460000
         BO    APPAAD3                  YES  D3                         13480000
         IC    R12,C37                  NO   TEST NLEV PER F = DCBNLEV  13500000
         NI    C37,X'07'                                                13520000
         CLC   DCBNLEV,C37                                              13540000
         STC   R12,C37                                                  13560000
         BNE   APPAAB3                  NO   B3                         13580000
         OI    DECBEXC1,X'80'        C5 YES  DECB EXCEP SET=NO RCD FND  13600000
APPAAD4  MVI   IOBASYN,X'07'         D4      ASYNC CD SET=7 (NG CP1,2)  13620000
         B     APPABSAR                      SAR                        13640000
APPAAD3  MVC   IOBDADAD,C36             C36 TO IOBDADAD                 13660000
         B     APPRVXCP                      EXCP RETURN TO IOS         13680000
APPAAB3  OI    DECBEXC1,X'04'        B3      DECB EXCEP SET=UNREACHABLE 13700000
         B     APPAAD4                       D4                         13720000
*                                                                       13730002
*        ABNORMAL END APP CODE 3 (CP2) CHART AA                         13740000
*                                                                       13760000
APPAAA2  L     R13,DCBWKPT2            R13  ADDR DCB WA                 13780000
         CLI   DCWNLSD,X'01'            BRANCH IF NLSD NOT 1, I.E.      13800000
         BNE   APPAEJ2                    IF CP1 IS BEING USED          13820000
APPAAA3  TM    IOBECBAD,PERRMASK        TEST PERM ERR                   13840000
         BO    APPRVNOR                 NO, NORMAL IOS RETURN     15924 13860016
         B     APPAAB3                  YES BRANCH TO INDICATE UNRCHBLE 13880000
         DROP  R13                                                      13900000
*                                                                       13920000
*              CHART AE                 END CP1                         13940000
*              CHANNEL END                                              13960000
         USING CP1,R10                                                  13980000
APPAEB2  LA    R13,C6+8                 TEST FINAL CCW EQUAL C6         14000000
         CLR   R12,R13                                                  14020000
         BE    APPAEC2                  BRANCH IF YES                   14040000
         LA    R13,C16+8                TEST EQUAL C16                  14060000
         CLR   R12,R13                                                  14080000
         BE    APPAEC4                  BRANCH IF YES                   14100000
         B     APPAAB3                  ERROR IF NO                     14120000
*              INTERRUPT AT C6                                          14140000
APPAEC2  EQU   *                        *                               14160001
*                                                                       14170002
         TM    C6+K5,CC                 WAS C6 CHAINED                  14172001
         BZ    APPAOS8                  NO, CONTINUE                    14174001
         NI    C6+K5,CCOFF              TURN OFF INDICATOR              14176001
         OI    C6+K4,CC                 RECHAIN C6                      14178001
         CLI   C10,SEEKHH               C10 SET TO DO SEEK HEAD         14178401
         BNE   APPAOSJ4                 NO, FILE PROTECT                14178801
         LA    R13,C10A                 RESET IOBSTART TO               14179201
         ST    R13,IOBSTART-K1          RESTART AT C10A                 14179601
         B     APPAEG2                  RESCHEDULE CP1                  14179701
APPAOS8  EQU   *                        *                               14179801
*                                                                       14179902
         TM    C9+K7,MIS                END MASTER INDEX SEARCH.        14186601
         BO    APPAEC3                  BRANCH IF YES                   14193301
         TM    C9+7,X'04'               IF LEVEL OF INDEX IS 3          14200000
         BO    APPAEG2                   SET CC IN CP1 TO CHAIN TO      14220000
         OI    C6+4,X'40'                SEARCH CYLINDER INDEX          14240000
APPAEG2  MVC   IOBDADAD,C8+7            ADDR NEXT SRCH ADDR IN IOB      14260000
         B     APPRVXCP                 RETURN TO EXCP                  14280000
*                                                                       14290002
*              DUMMY OR INACTIVE                                        14300000
*                                                                       14310002
APPAEC3  TM    C9+7,X'08'               TEST DUMMY ENTRY CHAINED        14320000
         BO    APPAEG2                  BRANCH IF YES                   14340000
         IC    R12,C9+7                 COMPARE LEVEL OF INDEX READ TO  14360000
         SLL   R12,29                    DCB INDEX LEVEL                14380000
         IC    R13,DCBNLEV                                              14400000
         SLL   R13,29                                                   14420000
         CLR   R12,R13                                                  14440000
         BNE   APPAAB3                  BRANCH IF NOT EQUAL             14460000
         OI    DECBEXC1,X'80'           SET NO REC FND IN EXCEPTION CD  14480000
         B     APPAAD4                                                  14500000
*                                                                       14510002
*              END OF CYLINDER SEARCH                                   14520000
*                                                                       14530002
APPAEC4  TM    C18,X'20'                TEST DUMMY OR INACTIVE          14540000
         BO    APPAEC5             BRANCH IF YES                        14560000
         MVC   IOBDADAD,C17                  ADDR NEXT SRCH IN IOB      14580000
         MVI   IOBASYN,X'03'       SET ASYNC CODE                       14600000
         B     APPABSAR                 SCHEDULE ASYNCH RTN             14620000
APPAEC5  TM    C18,X'08'                IF DUMMY ENTRY NOT CHAINED,     14640000
         BZ    APPAAB3                   BRANCH TO INDICATE UNRCHBLE    14660000
         MVC   IOBDADAD,C17             OTHERWISE, RESTART CHAN PROG    14680000
         LA    R12,C11                   WITH NEW SRCH ADDRESS          14700000
         STH   R12,IOBSTART+1                                           14720000
         SRL   R12,16                                                   14740000
         STC   R12,IOBSTART                                             14760000
         B     APPRVXCP                 RETURN TO IOS                   14780000
*                                                                       14790002
*              ABNORMAL END                                             14800000
*                                                                       14810002
APPAEJ2  TM    IOBSENSE+1,X'04'        FILE PROTECT               25000 14820018
         BZ    APPAAA3                  BRANCH IF NO.                   14840000
         LA    R12,C10+8                TEST STOP AT C10                14860000
         L     R13,IOBCSW                                               14880000
         LA    R13,0(R13)                                               14900000
         CLR   R12,R13                  BRANCH TO INDICATE UNREACHABLE  14920000
         BNE   APPAAB3                   IF NO.                         14940000
*                                                                       14942002
APPAOSJ4 EQU   *                        *                               14944001
*                                                                       14946002
         TM    C9+7,X'20'              IF DUMMY OR INACTIVE       25000 14950018
*                                       RECORD                    25000 14960018
         BO    APPAEC3                   BRANCH TO SAME PROCEDURE AS    14980000
         LA    R12,C11                   CHANNEL END                    15000000
         STH   R12,IOBSTART+1           OTHERWISE, RESTART CHAN PROG    15020000
         SRL   R12,16                                                   15040000
         STC   R12,IOBSTART                                             15060000
         B     APPAEG2                                                  15100000
*                                                                       15120000
*        CHANNEL END APP CODE O,1 (CP4,5) CHART AB                      15140000
         USING CP4,R10                                                  15160000
APPABA2  EQU   *                                                 S20201 15180020
*                                                                       15190002
         L     R12,IOBCSW               CP STOP ADDR                    15200001
         LA    R12,0(R12)               CLEAR HI BYTE                   15210001
         SR    R12,R10                  OFFSET OF CCW                   15212001
*                                                                       15212402
         CL    R12,APPHCA23             STOP AT CCW CA23        SA65011 15212802
         BNE   NOTCA23                  BRANCH IF NO            SA65011 15213202
         TM    DECBTYP2,READKU          READ K FOR UPDATE       SA65011 15213602
         BZ    NOTCA23                  BRANCH IF NO            SA65011 15213702
         CLI   CA24,RDSECT              CA24 READ SECTOR CCW    SA65011 15215502
         BE    APPABF3                  BR IF YES - SET UNREACH SA65011 15215902
*                                       BLK, ASYN CODE OF 4     SA65011 15216302
NOTCA23  EQU   *                        CONTINUE - CP OK        SA65011 15216702
         CL    R12,APPHCA10             STOP AT CA10                    15217202
         BNE   APPAOSA2                 NO                              15218802
         TM    CA10+K5,CC               WAS CA10 COMMAND CHAINED        15220402
         BZ    APPAOSA2                 NO                              15222002
         OI    CA10+K4,CC               TURN CC BACK ON                 15223602
         NI    CA10+K5,CCOFF            TURN INDICATOR OFF              15225202
         CLI   CA14,SEEKHH              CA14 SEEK HEAD                  15226802
         BNE   APPAOS21                 NO, FILE PROTECT                15228402
         MVC   IOBDADAD,CA12+K7         RESET IOBSEEK                   15230002
         LA    R12,CA16A                RESET IOBSTART TO               15231602
         ST    R12,IOBSTART-K1          START AT CA16A                  15233201
         B     APPRVXCP                 GO DO AN EXCP                   15243201
APPAOSA2 EQU   *                        *                               15245201
*                                                                       15245602
         NI    DECBEXC1,NOT-OFLORCD     DECB EXCEP SET=NOT       S20201 15246701
*                                       OFLORCD                  S20201 15260020
         MVC   IOBDADAD+K5(K3),CA25+K5                           S20201 15360020
APPABB3  MVI   IOBASYN,X'00'         B3      ASYNC CD SET=0 (G CP4,5,6) 15580000
APPABSAR B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 15600002
         SPACE 3                                                        15650002
*        ABNORMAL END APP CODE 0,1 (CP4,5) CHART AB                     15700000
*                                                                       15720000
APPABD2  EQU   *                                                  19374 15727000
         TM    IOBSENSE+1,X'04'         FILE PROTECT?             19374 15734000
         BO    APPABD21                 BRANCH IF SO              19374 15741000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 15748000
         BC    PERRYES,APPABD3          YES--BRANCH               19374 15755000
         B     APPRVNOR                 NO--RETRY CHANNEL PROGRAM 19374 15762000
APPABD21 EQU   *                                                  19374 15769000
         L     R12,IOBCSW          E2 YES  STOP AT CA14 TEST            15780000
         LA    R12,0(R12)                                               15800000
         SR    R12,R10                                                  15820000
         CL    R12,APPHCA14                                             15840000
         BNE   APPABF3                  NO   F3                         15860000
*                                                                       15870002
APPAOS21 EQU   *                        *                               15872001
*                                                                       15874002
         TM    CA13+7,X'20'        F2 YES  DUMMY OR INAC TEST           15880000
         BO    APPABF1                  YES  F1                         15900000
         MVC   IOBDADAD,CA12+7     G2 NO   CA12+7 TO IOBDADAD           15920000
         MVC   CA34+7(8),CA12+7         CA12+7 TO CA34+7                15940000
         LA    R12,IOBDADAD+3      G1   ADIOBDADAD(CCHH)TO CA26         15960000
         ST    R12,CA26                                                 15980000
         MVI   CA26,X'31'                                               16000000
         MVC   CA28+1(3),DECBKEY+1 H1   DECBKEY+1 TO CA28 AD            16020000
         CLI   IOBAPP,CODE0             TEST FOR A READ          S20201 16040020
         BE    APPABJ2                  READ J2                         16060000
         LA    R12,CA40            K1 WRITE CA30 TIC TO CA40            16080000
         STH   R12,CA30+2                                               16100000
         SRL   R12,16                                                   16120000
         STC   R12,CA30+1                                               16140000
         L     R12,DECBAREA        K2   AREA+6 TO CA40 AD               16160000
         LA    R12,6(R12)                                               16180000
         ST    R12,CA40                                                 16200000
         MVI   CA40,X'06'                                               16220000
         MVC   CA43+1(3),CA40+1    K3   AREA+6 TO CA43 AD               16240000
         LA    R13,CA43+6               LENGTH+10 TO CA43 CNT           16260000
APPABK2  MVI   CA28,SKEQ                SCH EQ FOR WRITE         S20201 16270020
APPABK4  TM    DECBTYP1,X'02'                DECBLGTH SPECIFIED{        16280000
         BZ    APPABK4A                 YES  K4A                        16300000
         LH    R12,DCBLRECL             NO   USE DCBLRECL               16320000
         B     APPABK4B                                                 16340000
APPABK4A LH    R12,DECBLGTH             DECB LENGTH OVERRIDING          16360000
APPABK4B LA    R12,10(R12)                                              16380000
         STH   R12,0(R13)                                               16400000
APPABK5  MVI   IOBAPP,CODE5             SET CODE 5 FOR CP6       S20201 16420020
         LA    R12,CA26            J5   AD CA26 TO IOBSTART             16440000
         IC    R13,IOBSIOCC                                             16460000
         ST    R12,IOBSIOCC                                             16480000
         STC   R13,IOBSIOCC                                             16500000
         MVI   IOBFLAG1,X'42'        H5 RESTORE IOB FLAGS AND ERR CTR   16520000
         MVI   IOBFLAG2,X'00'            CC AND UNRELATED FLAGS ON      16540000
         MVI   IOBCSW,X'00'              OTHERS OFF                     16560000
         XC    IOBERRCT,IOBERRCT                                        16580000
         SR    R12,R12             G5   TEST OFLO SAME VOLUMN           16600000
         IC    R12,IOBDADAD                                             16620000
         SLL   R12,4                                                    16640000
         L     R12,DEBUCBAD(R12)                                        16660000
         LA    R7,0(R7)                                                 16680000
         LA    R12,0(R12)                                               16700000
         CLR   R7,R12                                                   16720000
         BE    APPRVXCP                 IF SAME, EXCP RET TO IOS        16740000
         MVI   IOBASYN,X'01'         G4 NO   ASYNC CD SET=1 (EXCP)      16760000
         B     APPABSAR                      SAR                        16780000
APPABJ2  LA    R12,CA31              J2 CA30 TIC TO CA31                16800000
         STH   R12,CA30+2                                               16820000
         SRL   R12,16                                                   16840000
         STC   R12,CA30+1                                               16860000
         L     R12,DECBAREA                  AREA+6 TO CA31 ADDRESS     16880000
         LA    R12,6(R12)                                               16900000
         ST    R12,CA31                                                 16920000
         MVI   CA31,X'06'                                               16940000
         LA    R13,CA31+6                    LENGTH+10 TO CA31 COUNT    16960000
         SR    R12,R12                                           S20201 16962020
         AH    R12,DCBRKP               RKP=0                    S20201 16964020
         BNZ   APPABJ4                  BIF NOT = 0              S20201 16966020
         TM    DCBRECFM,BLOCKED         RECFM=BLOCKED            S20201 16968020
         BZ    APPABK2                  BIF NOT BLOCKED          S20201 16970020
APPABJ4  MVI   CA28,SKEQHI             SCH EQHI FOR (READ AND    S20201 16972020
*                                       RKP NE 0                 S20201 16974020
*                                       OR (READ AND RKP=0 AND BLKD)    16976020
         B     APPABK4                       K4                         16980000
APPABF1  CLI   DCBNLEV,X'00'         F1      DCBNLEV=0{                 17000000
         BE    APPABD5                  YES  D5                         17020000
APPABF3  OI    DECBEXC1,X'04'        F3 NO   DECB EXCEP SET=UNREACHABLE 17040000
APPABG3  MVI   IOBASYN,X'04'         G3      ASYNC CD SET=4(NG CP4,5,6) 17060000
         B     APPABSAR                      SAR                        17080000
APPABD3  EQU   *                                                        17110016
         TM    IOBSENSE+1,X'08'         NO RECORD FOUND           16072 17140016
         BZ    APPABB1                  NO--BRANCH                16072 17160016
APPABE4  L     R12,IOBCSW          E4   STOP AT CA21 TEST               17200000
         LA    R12,0(R12)                                               17220000
         SR    R12,R10                                                  17240000
         CL    R12,APPHCA20                                      S20201 17260020
         BNE   APPABF3                  NO   F3                         17280000
         CLI   CA21,X'69'          D4,C4 READ FORMAT BLOCKED TEST       17300000
         BE    APPABF3                  YES  F3                         17320000
APPABD5  OI    DECBEXC1,X'80'        D5 NO   DECB EXCEP SET=NO RCD FND  17340000
         B     APPABG3                       G3                         17360000
APPABB1  L     R12,IOBCSW          B1   STOP AT CA23                    17380000
         LA    R12,0(R12)                                               17400000
         SR    R12,R10                                                  17420000
         CL    R12,APPHCA23                                             17440000
         BNE   APPABF3                  NO   F3                         17460000
APPABD1  OI    DECBEXC1,X'08'        D1 YES  DECB EXCEP SET=UNCOR IO ER 17520000
         B     APPABG3                       G3                         17540000
*                                                                       17560000
*        CHANNEL END APP CODE 5 (CP6) CHART AC                          17580000
         USING CP4,R10                                                  17600000
APPACA2  L     R12,IOBCSW          A2   TEST STOP AT CA31               17620000
         LA    R12,0(R12)                                               17640000
         SR    R12,R10                                                  17660000
         CL    R12,APPHCA31             NON-RPS HALT.            S20201 17670020
         BE    APPACA6                  BIF HALT ON CA31         S20201 17673020
         CL    R12,APPCA31B             RPS HALT.                S20201 17676020
         BNE   APPACA3                  BIF NO HALT HERE.        S20201 17679020
         B     APPACA6A                 COMPARE KEYS            SA65011 17681002
*                                                                       17681402
APPACA6  TM    DECBTYP2,READKU          READ K FOR UPDATE       SA65011 17681802
         BZ    APPACA6A                 BRANCH IF NO            SA65011 17681902
         TM    CA31+4,CC                CA31 COMMAND CHAINED    SA65011 17684902
         BO    APPABF3                  BR IF YES - SET UNREACH SA65011 17686902
*                                       BLK, ASYN CODE OF 4     SA65011 17688902
APPACA6A CLI   CA28,SKEQHI              SEARCH HI USED.         SA65011 17689002
         BNE   APPACA8                  BIF NOT                  S20201 17692002
*                                                                       17695002
*        COMPARE KEYS. IF THE RECORD'S KEY IS HIGHER, TERMINATE         17698002
*        THE SEARCH OF THE OVERFLOW CHAIN.                              17701002
*                                                                       17704002
         IC    R9,CA28+K7                GET KEY LENGTH.         S20201 17707002
         BCTR  R9,R0                    EXECUTED LENGTH          S20201 17710002
         L     R12,CA28                 GET KEY ADDR.            S20201 17713002
         L     R13,CA31                 GET DATA ADDR.           S20201 17716002
         AH    R13,DCBRKP               FIND THE KEY IN THE      S20201 17719002
*                                       RECORD.                  S20201 17722002
         LA    R13,K10(R13)             KEY FOUND.               S20201 17725002
         EX    R9,COMPARE               CHECK FOR MATCH.         S20201 17728002
         BNE   APPACG3                  BIF NO MATCH.            S20201 17731002
APPACA8  EQU   *                                                 S20201 17734002
         CLC   CA34+7(8),CA12+7         FIRST RECORD IN CHAIN   OY00310 17737002
         BE    APPACB3                  YES  B3                         17740000
         L     R12,DCBRORG3             NO   ADD 1 TO DCBRORG3          17760000
         LA    R12,1(R12)                                               17780000
         ST    R12,DCBRORG3                                             17800000
         TM    DECBTYP2,X'20'           B2  TEST READ FOR UPDATE        17820000
         BZ    APPACB3                  NO   B3                         17840000
         MVC   IOBDADAD,CA34+7          YES  IOBDADAD SET FOR WRITEBACK 17860000
APPACB3  OI    DECBEXC1,X'02'        B3      DECB EXCEP SET=OFLO RCD    17880000
         MVI   IOBASYN,X'00'         B4      ASYNC CD SET=0 (G CP4,5,6) 17900000
         B     APPABSAR                      SAR                        17920000
APPACA3  CL    R12,APPHCA43        A3   STOP AT CA43 TEST               17940000
         BNE   APPACF4                  NO   F4                         17960000
         B     APPACB3                  YES  B3                         17980000
*                                                                       18000000
*        ABNORMAL END APP CODE 5 (CP6) CHART AC                         18020000
*                                                                       18040000
APPACE2  EQU   *                                                  19374 18047000
         TM    IOBSENSE+1,X'04'         FILE PROTECT?             19374 18054000
         BO    APPACE21                 YES--BRANCH               19374 18061000
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 18068000
         BC    PERRYES,APPACE3          YES--BRANCH               19374 18075000
         B     APPRVNOR                 NO--RETRY CHANNEL PROGRAM 19374 18082000
APPACE21 EQU   *                                                  19374 18089000
         L     R12,IOBCSW          F2 YES  STOP AT CA36 TEST            18100000
         LA    R12,0(R12)                                               18120000
         SR    R12,R10                                                  18140000
         CL    R12,APPHCA36                                             18160000
         BNE   APPACF4                  NO   F4                         18180000
*                                                                       18190002
         CLI   CA36,SEEKHH              CA36 SET TO SEEK HEAD           18192001
         BNE   APPAOSE2                 NO                              18194001
         MVC   IOBDADAD,CA34+K7         RESET IOBSEEK                   18196001
         B     APPRVXCP                 GO DO AN EXCP                   18198001
APPAOSE2 EQU   *                        *                               18198401
*                                                                       18198802
         TM    CA35+7,X'08'        G2 YES  END OR CHAINED TEST          18200000
         BZ    APPACG3                  END  G3                         18220000
         MVI   IOBASYN,X'01'         J2      ASYNC CD SET=1 (EXCP)      18320000
         MVI   IOBFLAG1,X'42'        J3 RESTORE IOB FLAGS AND ERR CTR   18340000
         MVI   IOBFLAG2,X'00'            CC AND UNRELATED FLAGS ON      18360000
         MVI   IOBCSW,X'00'              OTHERS OFF                     18380000
         XC    IOBERRCT,IOBERRCT                                        18400000
         MVC   IOBDADAD,CA34+7          SET SEEK SEARCH ADDRESS         18420000
         B     APPABSAR                      SAR                        18440000
APPACE3  EQU   *                                                        18470016
         L     R12,IOBCSW          E4 YES  TEST STOP AT CA31 OR CA43    18500000
         LA    R12,0(R12)                                               18520000
         SR    R12,R10                                                  18540000
         CL    R12,APPHCA31                                             18560000
         BE    APPACE5                  YES  E5                         18580000
         CL    R12,APPHCA43                                             18600000
         BE    APPACE5                  YES  E5                         18620000
APPACF4  OI    DECBEXC1,X'04'        F4 NO   DECB EXCEP SET=UNREACHABLE 18640000
APPACG4  MVI   IOBASYN,X'04'         G4      ASYNC CD SET=4(NG CP4,5,6) 18660000
         B     APPABSAR                      SAR                        18680000
APPACG3  OI    DECBEXC1,X'80'        G3      DECB EXCEP SET=NO RCD FND  18700000
         B     APPACG4                       G4                         18720000
APPACE5  TM    IOBSENSE,X'08'        E5      DATA CHK{                  18740000
         BZ    APPACF4                  NO   F4                         18760000
         OI    DECBEXC1,X'08'        F5 YES  DECB EXCEP SET=UNCOR IO ER 18780000
         B     APPACG4                       G4                         18800000
*              CHART AD       CHANNEL END + NORMAL END CP7              18820000
*              CHANNEL END                                              18840000
         USING CP7,R10                                                  18860000
APPADB2  LA    R13,CA46+8               TEST STOP AT CA46               18880000
         L     R12,IOBCSW                                               18900000
         LA    R12,0(R12)                                               18920000
         CLR   R12,R13                                                  18940000
         BNE   APPADB3                                                  18960000
         MVI   IOBASYN,X'02'            IF SO, SET ASYN CODE AND BRANCH 18980000
         B     APPABSAR                 SCHEDULE ASYN ROUTINE           19000000
APPADB3  OI    DECBEXC1,X'04'           IF NOT, INDICATE UNREACHABLE IN 19020000
APPADB4  MVI   IOBASYN,X'06'             DECB AND SET ASYNCH CODE       19040000
         B     APPABSAR                 SCHEDULE ASYNCH ROUTINE         19060000
*                                                                       19070002
*              ABNORMAL END                                             19080000
*                                                                       19090002
APPADE2  TM    IOBECBAD,PERRMASK        IF NOT PERM ERR,                19100000
         BO    APPRVNOR                 NO, NORM IOS RETURN       15924 19120016
         LA    R12,CA46+8               IF STOP AT CA46 AND             19140000
         L     R13,IOBCSW                CAUSE IN NOT DATA CHECK,       19160000
         LA    R13,0(R13)                OR IF STOP NOT AT CA46         19180000
         CLR   R13,R12                   GO TO APPADB3                  19200000
         BNE   APPADB3                                                  19220000
         TM    IOBCSW+5,X'08'                                           19240000
         BZ    APPADB3                                                  19260000
         OI    DECBEXC1,X'08'            DATA CHECK, SET IO UNCORRTABLE 19280000
         B     APPADB4                   ERROR BIT IN DECB              19300000
APPRVXCP SR    R12,R12                                                  19320000
         IC    R12,IOBDADAD             GET BB                          19340000
         SLL   R12,4                                                    19360000
         LA    R12,32(R12,R3)                                           19380000
         MVC   IOBDADAD+1(2),4(R12)                                     19400000
         LA    R14,EXCP(R14)            SETUP FOR EXCP IOS RETURN 15924 19405016
         XC    IOBFLAG2(3),IOBFLAG2     CLEAR FLAG2,SENSE BYTES   15924 19410016
         XC    IOBCSW(9),IOBCSW         CLEAR FLAG3,CSW,AND SIOCC 15924 19415016
         XC    IOBERRCT(2),IOBERRCT     CLEAR ERROR COUNT         15924 19420016
         NI    IOBFLAG1,X'C2'           RESET FLAG1               15924 19425016
APPRVNOR BR    R14                      RETURN TO IOS             15924 19430016
COMPARE  CLC   K0(K1,R12),K0(R13)       EXECUTED INSTRUCTION     S20201 19435020
         EJECT                                                          19440000
APPN3B3  EQU   APPM1B3        LABELS USED IN COMMON ROUTINE TO          19460000
APPN3B5  EQU   APPM1B5         SCHEDULE ASYNCHRONOUS ROUTINE            19480000
CVTPTR   EQU   16                       ADDR COMMUNICATION VECTOR TABLE 19500000
CODE0    EQU   0                        CHAN PGM 4-5 APPEND CODE S20201 19500920
CODE5    EQU   5                        CHAN PGM 6 APPEND CODE   S20201 19501820
CODE8    EQU   8                        CHAN PGM 8 APP CODE      S20201 19502720
CODE9    EQU   9                        CHAN PGM 10A APP CODE    S20201 19503620
CODE10   EQU   10                       CHAN PGM 10B APP CODE    S20201 19504520
CODE11   EQU   11                       CHAN PGM 10B APP CODE    S20201 19505420
CODE14   EQU   14                       CHAN PGM 15 APP CODE     S20201 19506320
CODE17   EQU   17                       CHAN PGM 17 APP CODE     S20201 19507220
CODE18   EQU   18                       CHAN PGM 17 APP CODE     S20201 19508120
CODE19   EQU   19                       CHAN PGM 17 APP CODE     S20201 19509020
*                                                                       19519002
PATCH    DC    XL((*-IGG019GN)/20)'00'  ZEROED PATCH AREA        Y02072 19519402
*                                                                       19519802
         SPACE 4                                                        19520002
*                                                                       19540000
*              DATA EVENT CONTROL BLOCK                                 19560000
IHADECB  DSECT                                                          19580000
         DS    0F                                                       19600000
DECBECB  DS    CL4                      EVENT CONTROL BLOCK (ECB)       19620000
DECBTYP1 DS    BL1                      TYPE B6 - 1 IF LENGTH IS S      19640000
*                                            B7 - 1 IF AREA IS S        19660000
DECBTYP2 DS    BL1                           B0 - 1 IF READ K           19680000
*                                            B1 - 1 IF READ KX          19700000
*                                            B2 - 1 IF READ KU          19720000
*                                            B4 - 1 IF WRITE K          19740000
*                                            B5 - 1 IF WRITE KN         19760000
DECBLGTH DS    CL2                      LENGTH OF BLOCK                 19780000
DECBDCBA DS    A                        POINTER TO DCB                  19800000
DECBAREA DS    A                        ADDRESS OF AREA                 19820000
DECBLOGR DS    A                        POINTER TO LOGICAL RECORD       19840000
DECBKEY  DS    A                        POINTER TO KEY                  19860000
DECBEXC1 DS    BL1                      EXCPTN CD B0-RECORD NOT FOUND   19880000
*                                                 B1-RECORD LGTH CHK    19900000
*                                                 B3-INVALID REQUEST    19920000
*                                                 B4-UNCORRECTABLE IO   19940000
*                                                 B5-UNREACHABLE BLOCK  19960000
*                                                 B6-OVERFLOW RECORD    19980000
*                                                 B7-DUPLICATE REC      20000000
DECBEXC2 DS    BL1                                B7-READ KU            20020000
         EJECT                                                          20030002
         DCBD  DSORG=(IS)                                               20040000
         EJECT                                                          20090002
IHAIOB   IGGIOBD                                                        20110020
CPSTART  EQU   IOBSTART-1                                        S20201 20180020
         EJECT                                                          20230002
IHADCW   IGGBISAM                                                       20380020
         EJECT                                                          20430002
IHADEB   IGGDEBD                                                        20680020
         EJECT                                                          20730002
IHACVTEX DSECT                COMMUNICATION VECTOR TABLE                22060000
         DS    A                                                        22080000
*        READ K, READ KU, AND WRITE K CHANNEL PGMS(NO WRITE CHK)        22200020
IHACP47  IGGCP47                                                        22500020
         SPACE 2                                                        22550002
*        WRITE KEY NEW CHANNEL PROGRAM REFERENCES (NO WRITE CHECK)      22900020
IHAWKNCP IGGWKNCP                                                       23300020
         SPACE 2                                                        23350002
         IGGCP12C                                                       23700020
         SPACE 2                                                        23750002
         IGGCP12A                                                       24000020
         END                                                            25540000
