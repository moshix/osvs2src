         TITLE 'IGG019GO - APPENDAGES-PART 2,COMBINED,WITH WRT CHK'     00070020
IGG019GO CSECT                                                          00140020
*                                                                       00210020
*          RELEASE OS/VS2-02 DELETIONS/CHANGES                          00420002
*          RELEASE 21 DELETIONS/CHANGES                                 00490020
*          RELEASE 20 DELETIONS                                       * 00560020
*0568090200,105900-106000                                        A34932 00630020
*0568200200-200800                                               A34619 00700020
*0568090320                                                      M3299  00770020
*                                                                S20201 00790020
*                                                                       00810020
* THIS MODULE WAS REWRITTEN IN RELEASE 20.2 TO                          00840020
* UTILIZE CHANNEL PROGRAM AND WORK AREA                                 00910020
* MACRO EXPANSIONS                                                      00980020
*                                                                       01050020
*STATUS CHANGE LEVEL 011                                                01120002
* FUNCTION/OPERATION' APPENDAGE ROUTINES FOR BISAM                      01190020
*        WHEN READ AND UPDATE IS USED WITH WRITE KN,                    01260020
*        WHEN WRITE VALIDITY CHECKING IS     REQUESTED,                 01330020
*        (PART 2)                                                       01400020
*        CEND  - IF CHANNEL PROGRAM ENDS                                01470020
*                **WITHOUT ERROR, EITHER                                01540020
*                    PROCESSING COMPLETION WILL BE SCHEDULED,           01610020
*                    PROCESSING CONTINUATION WILL BE SCHEDULED,         01680020
*                    OR PROCESSING WILL CONTINUE.                       01750020
*                **WITH A LENGTH CHECK, TESTS DETERMINE WHETHER         01820020
*                    OR NOT TO TREAT THE SITUATION AS A REAL            01890020
*                    ERROR.                                             01960020
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            02030020
*                    BLOCK' IS INDICATED IN THE DECB, AND               02100020
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           02170020
*                                                                       02240020
*        ABEND - IF CHANNEL PROGRAM ENDS ABNORMALLY BECAUSE OF          02310020
*                **PERMANENT ERROR, 'UNCORRECTABLE I/O ERROR'           02380020
*                    IS INDICATED IN THE DECB, AND PROCESSING           02450020
*                    COMPLETION WILL BE SCHEDULED.                      02520020
*                    USE OF WRITE VALIDITY CHECKING OPTION              02590020
*                    ALLOWS A LIMITED NUMBER OF RE-EXECUTIONS           02660020
*                    BEFORE INDICATING AN ERROR.                        02730020
*                **NON-PERMANENT ERROR, ONE RE-TRY IS MADE              02800020
*                    BEFORE INDICATING A PERMANENT ERROR.               02870020
*                **FILE PROTECTION, TESTS DETERMINE WHETHER             02940020
*                    OR NOT TO TREAT THE SITUATION AS A REAL            03010020
*                    ERROR.                                             03080020
*                **ANY OTHER ERROR, IN GENERAL, 'UNREACHABLE            03150020
*                    BLOCK' IS INDICATED IN THE DECB, AND               03220020
*                    PROCESSING COMPLETION WILL BE SCHEDULED.           03290020
*                                                                       03360020
* ENTRY POINTS-                                                         03430020
*        ENTRY POINT               FUNCTION                             03500020
*        ANY POINT IN THE VECTOR TABLE AT THE BEGINNING OF THE MODULE.  03570020
* INPUT - N/A                                                           03640020
* OUTPUT - N/A                                                          03710020
* EXTERNAL ROUTINES - N/A                                               03780020
* EXITS  1. RETURN TO IOS VIA THE APPENDAGE RETURN VECTOR TABLE POINTED 03850020
*            TO BY REGISTER 14.  SEE THE DSECT LABELED    APPRV FOR THE 03920020
*            FORMAT OF THIS TABLE AND THE USE OF EACH EXIT.             03990020
*        2. SCHEDULE AN ASYNCHRONOUS ROUTINE - BRANCH VIA THE EXIT      04060020
*            EFFECTOR ADDRESS IN THE COMMUNICATION VECTOR TABLE.        04130020
* TABLES/WORK AREAS ' DECB, DCB, IOB AND EXTENTION, DCB WA (DCW), DEB,  04200020
*        COMMUNICATION VECTOR TABLE.                                    04270020
*        SEE DSECTS AT END OF MODULE FOR FORMAT AND DESCRIPTIONS.       04340020
* ATTRIBUTES- REENTRANT. DISABLED.                                      04410020
* NOTES - NONE                                                          04480020
* GENERAL REGISTERS ARE USED AS FOLLOWS                                 04550020
R0       EQU   0                   *    -----                           04620020
R1       EQU   1                   *    12* ADDRESS                     04690020
R2       EQU   2                   *    IOB                             04760020
R3       EQU   3                   *    DEB                             04830020
R4       EQU   4                   *    DCB                             04900020
BASEXXXX EQU   5                        BASE REGISTER            Y02072 05020002
R6       EQU   6                   *    -----                           05040020
R7       EQU   7                   *    UCB                             05110020
SAVEXXXX EQU   8                        SAVE AREA                Y02072 05230002
R9       EQU   9                   #    WORK REGISTER                   05250020
R10      EQU   10                       CHANNEL PROGRAM POINTER         05320020
R11      EQU   11                       DECB                            05390020
R12      EQU   12                       WORK REGISTER                   05460020
R13      EQU   13                       WORK REGISTER                   05530020
R14      EQU   14                       IOS RETURN VECTOR TABLE         05600020
R15      EQU   15                       BASE REGISTER                   05670020
*        * MEANS THIS REGISTER IS SET UP UPON ENTRY FROM IOS,           05740020
*          AND ITS CONTENTS MUST BE RESTORED UPON RETURN TO IOS         05810020
*        # MEANS THIS REGISTER MAY BE CHANGED, BUT UPON RETURN TO IOS   05880020
*          MUST CONTAIN ZEROES IN THE THREE HIGH ORDER BYTES            05950020
PERRMASK EQU   X'20'          TO TEST FOR PERMANENT ERROR, TEST         06020020
PERRYES  EQU   8               IOBECBAD, B2. IF OFF (CONDITION CODE 8)  06090020
PERRNO   EQU   7               THERE IS A PERM ERR. ELSE B2 ON ( CD 7)  06160020
NORECFND EQU   X'08'                    NO RECORD FOUND SENSE BIT 19323 06230020
BYP      EQU   12                       RETURN TO IOS/BYPASS      15924 06300020
EXCP     EQU   8                        RETURN TO IOS/EXCP        15924 06370020
NORMAL   EQU   0                        RETURN TO IOS/NORMAL      15924 06440020
K0       EQU   0                                                 S20201 06510020
K1       EQU   1                                                 S20201 06580020
K2       EQU   2                                                 S20201 06650020
K3       EQU   3                                                 S20201 06720020
K4       EQU   4                                                 S20201 06790020
K5       EQU   5                                                 S20201 06860020
K6       EQU   6                                                 S20201 06930020
K7       EQU   7                                                 S20201 07000020
K10      EQU   10                                                S20201 07070020
NOT      EQU   255                                               S20201 07140020
OFLORCD  EQU   2                                                 S20201 07210020
DATACHK  EQU   8                                                 S20201 07280020
TWOBYTES EQU   16                                                S20201 07350020
BLOCKED  EQU   X'10'                                             S20201 07420020
NRF      EQU   8                                                 S20201 07490020
MIS      EQU   PERRMASK                 MASTER IDX SRCH MASK            07540001
CCOFF    EQU   X'BF'                    TURN OFF CC MASK                07550001
READKU   EQU   X'20'                    READ KEY FOR UPDATE     SA65011 07552002
         USING IHAIOB,R2                                         S20201 07560020
         USING IHADEB,R3                                         S20201 07630020
         USING IHADCB,R4                                                07700020
         USING IHAWKNCP,R10                                             07770020
         USING IHADECB,R11                                              07840020
         USING IHADCW,R12                                               07910020
         USING IGG019GO,R15             BASE                            07980020
         USING IHACVTEX,R13             CVT                             08050020
*         VECTOR TABLE.  BRANCH TO THE ROUTINE SELECTED IN THE          08120020
*           APPENDAGE ROUTINE, PART 1.                                  08190020
*        ROUTINE FOR          CODE      CEND COMPLETION OF              08260020
         LR    R15,R13                                                  08330020
         B     APPM67CE       7         CP1 OR CP2 FOR WRITE KN         08400020
         LR    R15,R13                                                  08470020
         B     APPN7B2        9,23      CP10AW                          08540020
         LR    R15,R13                                                  08610020
         B     APPN8A2        10,11     CP10BW                          08680020
         LR    R15,R13                                                  08750020
         B     APPM4A2        12        CP14W - SETUPS 1, 2, OR 5       08820020
         LR    R15,R13                                                  08890020
         B     APPM5A2        13        CP14W - SETUPS 3, 4, OR 6       08960020
         LR    R15,R13                                                  09030020
         B     APPM2B2        15        CP16 - SITUATION 2              09100020
         LR    R15,R13                                                  09170020
         B     APPM3B2        16        CP16 - SITUATION 3              09240020
         LR    R15,R13                                                  09310020
         B     APPN9A2        17,18,19  CP17W                           09380020
         LR    R15,R13                                            17332 09450020
         B     APPAFB                   CP14 PART2                17332 09520020
*        ROUTINE FOR          CODE      ABEND COMPLETION OF             09590020
         LR    R15,R13                                                  09660020
         B     APPM67AE       7         CP1 OR CP2, WRITE KN            09730020
         LR    R15,R13                                                  09800020
         B     APPJ3B2        9,23      CP10AW                          09870020
         LR    R15,R13                                                  09940020
         B     APPJ4B2        10,11     CP10BW                          10010020
         LR    R15,R13                                                  10080020
         B     APPJ5B2        12        CP14W - SETUPS 1, 2, OR 5       10150020
         LR    R15,R13                                                  10220020
         B     APPJ6B2        13        CP14W - SETUPS 3, 4, OR 6       10290020
         LR    R15,R13                                                  10360020
         B     APPM2H2        15,16     CP16                            10430020
         LR    R15,R13                                                  10500020
         B     APPJ7B2        17,18,19  CP17W                           10570020
         LR    R15,R13                                            17332 10640020
         B     APPAEB                   CP14 PART2                17332 10710020
         B     APPN7A3                  CONTINUE ROUTINES BEGUN IN      10780020
         B     APPN7B4                   PART 1                         10850020
*        ROUTINE FOR          CODE      CEND COMPLETION OF              10920020
         LR    R15,R13                                                  10990020
         B     APPABA2        0,1       CP4/CP5W                        11060020
         LR    R15,R13                                                  11130020
         B     APPADB2        2         CP7W                            11200020
         LR    R15,R13                                                  11270020
         B     APPAAB2        3         CP1 OR CP2, READ AND UPDATE     11340020
         LR    R15,R13                                                  11410020
         B     APPACA2        5         CP6W                            11480020
         DC    3H'0'                    INVALID  CODE 6          S20201 11550020
*        ROUTINE FOR          CODE      ABEND COMPLETION OF             11620020
         LR    R15,R13                                                  11690020
         B     APPABD2        0,1       CP4/CP5W                        11760020
         LR    R15,R13                                                  11830020
         B     APPAIB2        2         CP7W                            11900020
         LR    R15,R13                                                  11970020
         B     APPAAA2        3         CP1 OR CP2, READ AND UPDATE     12040020
         LR    R15,R13                                                  12110020
         B     APPACE2        5         CP6W                            12180020
         DC    3H'0'                    INVALID CODE 6           S20201 12250020
*              BRANCH TO M6 OR M7                                       12320020
APPM67CE L     R13,DCBWKPT2             CHAN END OF CP1 OR CP2          12390020
         CLI   11(R13),X'01'            NLSD=1 MEANS NO MAST IX         12460020
         BE    APPM6B2                       CYLINDER - M6 (CP2)        12530020
         B     APPM7A2                       MASTER - M7 (CP1)          12600020
APPM67AE L     R13,DCBWKPT2             ABNORMAL END OF CP1 OR CP2      12670020
         CLI   11(R13),X'01'            NLSD=1 MEANS NO MAST IX         12740020
         BE    APPM6J4                       CYLINDER - M6 (CP2)        12810020
         B     APPM7J2                       MASTER - M7 (CP1)          12880020
         EJECT                                                          12950020
*              CHART M7  CP1 FOR WRITE KN, CODE 7                       13020020
*              CHANNEL END                                              13090020
APPM7A2  EQU   *                                                        13160020
         LA    R13,C6+8                                                 13230020
         CLR   R12,R13                  TEST STOP AT C6 - END OF SEARCH 13300020
         BE    APPM7B2                   OF MASTER INDEX. BRANCH IF YES 13370020
         LA    R13,C16+8                                                13440020
         CLR   R12,R13                  TEST STOP AT C16 - END OF SRCH  13510020
         BNE   APPN3B3                   OF CYLINDER INDEX. BRANCH NO   13580020
         TM    C18,X'20'                END OF CYLINDER SEARCH.         13650020
         BZ    APPM7C4                  TEST FOR DUMMY OR INACTIVE      13720020
         TM    C18,X'08'                                                13790020
         BZ    APPM7B3                  BRANCH IF INACTIVE OR DUMMY-END 13860020
         MVC   IOBDADAD,C17             DUMMY CHAINED.                  13930020
         LA    R12,C10A                 RESTART CP TO SEARCH CYL S20201 14000020
         STH   R12,IOBSTART+1            INDEX ON CHAIN.                14070020
         SRL   R12,16                                                   14140020
         STC   R12,IOBSTART                                             14210020
         B     APPRVXCP                 RETURN TO IOS TO EXCP           14280020
APPM7C4  MVC   IOBDADAD(7),C17          ACTIVE.                         14350020
APPM7C4A MVI   IOBDADAD+7,X'00'         SET UP IOB FOR CP8              14420020
         MVI   IOBAPP,CODE8             M--R IS ADDR FOUND, R=0  S20201 14490020
         L     R10,DCBWKPT3             GET STARTING ADDR OF CP8 S20201 14560020
         ST    R10,CPSTART              STORE IN IOB AS CP START S20201 14630020
         ST    R10,IOBCCWAD             AND FOR USE AS BASE REG  S20201 14700020
         MVC   CB23+K3(K5),IOBDADAD+K3  CCHH OF FIRST TRACK, R=0 S20201 14770020
         OC    CB23+K5(K3),DCBFIRSH     SET HHR TO FIRSH         S20201 14840020
         MVI   IOBFLAG1,X'42'           APP CODE 8                      14910020
         LA    R12,IOBDADAD+3           INITIALIZE CP8                  14980020
         STH   R12,CB1+2                 CB1 SET TO SEEK CCHHR OF IOB   15050020
         SRL   R12,16                                                   15120020
         STC   R12,CB1+1                                                15190020
         MVC   CB5+1(3),DECBKEY+1        CB5, CB15, CB19 ALL SET TO     15260020
         MVC   CB19+1(3),DECBKEY+1                                      15330020
APPM7G4  SR    R12,R12                  CHECK WITH DEB TO SEE IF NEXT   15400020
         IC    R12,IOBDADAD              ADDRESS ON SAME MODULE         15470020
         SLL   R12,4                                                    15540020
         L     R12,32(R3,R12)                                           15610020
         LA    R12,0(R12)                                               15680020
         CLR   R12,R7                                                   15750020
         BE    APPRVXCP                 IF SO, EXECUTE CP RETURN TO IOS 15820020
         MVI   IOBASYN,X'01'            IF NOT, SCHEDULE ASYNCHRONOUS   15890020
         B     APPN3B5                  ROUTINE TO EXCP                 15960020
APPM7B2  EQU   *                        *                               16030001
*                                                                       16080002
         TM    C6+K5,CC                 WAS C6 CHAINED                  16090001
         BZ    APPAOS1                  NO, CONTINUE                    16092001
         NI    C6+K5,CCOFF              TURN OFF INDICATOR              16094001
         OI    C6+K4,CC                 RECHAIN C6                      16096001
         B     APPAOSJ3                 RESCHEDULE CP1                  16098001
APPAOS1  EQU   *                        *                               16098401
*                                                                       16098802
         TM    C9+K7,MIS                END MASTER INDEX SEARCH.        16099201
         BZ    APPM7C2                  TEST FOR DUMMY OR INACTIVE      16100020
APPM7B3  TM    C9+7,X'08'                                               16170020
         BO    APPM7E2                  BRANCH IF INACTIVE OR DUMMY-END 16240020
         IC    R12,C9+7                 DUMMY CHAINED.                  16310020
         SLL   R12,29                   IF LEVEL INDEX NOT HIGHEST LVL, 16380020
         IC    R13,DCBNLEV               ERROR OF SOME SORT             16450020
         SLL   R13,29                                                   16520020
         CLR   R12,R13                                                  16590020
         BNE   APPN3B3                                                  16660020
*                                       ALWAYS DO CP15                  16730020
APPM7E3  MVI   IOBAPP,CODE14            TRK FULL--CP15 CODE      S20201 16800020
         MVC   IOBDADAD(3),DCBLPDA      SET UP IOB FOR CP15             16870020
         MVC   IOBDADAD+3(4),DCBLETI    APP CODE 14,MOVE FR LETI CCHH   16940020
         MVI   IOBDADAD+7,X'00'         ZERO R                          17010020
         OC    IOBDADAD+6(1),DCBFIRSH+3                                 17080020
         XC    IOBDADAD+6(1),DCBFIRSH+3  INCREMENT TO A CYL BOUNDRY     17150020
         L     R10,DCBWKPT3                   HHR ZERO                  17220020
         ST    R10,IOBCCWAD              START ADDR CI1                 17290020
         LA    R12,CI1                   REL CCW 0  CP8                 17360020
         ST    R12,IOBSTART-1           FLAGS INDICATE CC, NO DC        17430020
         MVI   IOBFLAG1,X'42'                                           17500020
         LA    R12,IOBDADAD+3           INITIALIZE CP15                 17570020
         STH   R12,CI1+2                 CI1 POINTS TO IOB CCHHR        17640020
         SRL   R12,16                                                   17710020
         STC   R12,CI1+1                                                17780020
         MVC   CI5+K2(K5),DCBLETI       COUNT ADDR               S20201 17850020
         MVC   CI5(K2),DCBLPDA+K1       MOVE IN BB FOR HEAD SEEK S20201 17920020
         B     APPM7G4                  BRANCH TO EXCP                  17990020
APPM7C2  TM    C9+7,X'04'               ACTIVE ENTRY.                   18060020
         BO    APPM7E2                  IF LVL 2 MAST IND JUST SRCHED   18130020
         OI    C6+4,X'40'                CC ON TO CHN FROM LVL 1 TO CYL 18200020
APPM7E2  MVC   IOBDADAD,C8+7            SEEK ADDR IN IOB IS FND ADDR    18270020
         NI    IOBFLAG1,X'7F'                B0 OFF NO DC               18340020
         OI    IOBFLAG1,X'40'                B1 ON YES DC               18410020
         B     APPRVXCP                 RETURN TO IOS TO EXCP           18480020
         EJECT                                                          18550020
*              ABNORMAL END                                             18620020
APPM7J2  EQU   *                                                  19374 18690020
         TM    IOBSENSE+1,X'04'         FILE PROTECT?             19374 18760020
         BO    APPM7J3                  YES--BRANCH               19374 18830020
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 18900020
         BC    PERRYES,APPN3B3          YES--BRANCH               19374 18970020
         BR    R14                      NO--RETRY CHANNEL        S20201 19040020
*                                       PROGRAM 1937             S20201 19110020
APPM7J3  LA    R13,C10+8                FILE PROTECT                    19180020
         CLR   R12,R13                                                  19250020
         BNE   APPN3B3                  BRANCH IF STOP NOT AT C10       19320020
*                                                                       19370002
APPAOSJ3 EQU   *                        *                               19380001
*                                                                       19382002
         MVI   IOBFLAG1,X'42'           RESTORE IOBFLAGS & ERR CTR      19390020
         MVI   IOBFLAG2,X'00'             UNRELATED FLAG ON             19460020
         MVI   IOBCSW,X'00'               OTHERS OFF                    19530020
         XC    IOBERRCT,IOBERRCT                                        19600020
         TM    C9+7,X'20'                                               19670020
         BO    APPM7B3                  BRANCH IF DUMMY OR INACTIVE     19740020
         LA    R12,C10A                 SET UP IOB TO RESTART    S20201 19810020
         ST    R12,IOBSTART-1                                           19880020
         B     APPM7E2                  BRANCH                          19950020
         EJECT                                                          20020020
*              M6 - CP2 FOR WRITE KN, CODE 7                            20090020
*              CHANNEL END                                              20160020
APPM6B2  LA    R13,C35+8                B2   STOP AT C350               20230020
         CLR   R12,R13                                                  20300020
         BNE   APPN3B3                       NO                         20370020
         TM    C37,X'20'             C2      DUMMY OR INACTIVE{         20440020
         BZ    APPM6D2                       NO D2                      20510020
         TM    C37,X'28'             C3      DUMMY CHAINED{             20580020
         BO    APPM6D3                       YES D3                     20650020
         TM    DCBNLEV,X'01'         C4      NLEV=F{ F MUST BE 1        20720020
         BZ    APPN3B3                       NO                         20790020
         B     APPM7E3                                                  20860020
APPM6D2  MVC   IOBDADAD(7),C36       D2      C36 MBBCCHH                20930020
         B     APPM7C4A                                                 21000020
APPM6D3  MVC   IOBDADAD,C36          D3      C36 MBBCCHHR               21070020
         B     APPRVXCP              E3      EXCP RETURN TO IOS         21140020
         SPACE 10                                                       21210002
*              ABNORMAL END                                             21280020
APPM6J4  TM    IOBECBAD,PERRMASK     J4      PERMANENT ERROR TEST       21350020
         BC    PERRYES,APPN3B3          YES  B3                         21420020
         BR    R14                      NORMAL RETURN TO IOS     S20201 21490020
         EJECT                                                          21560020
*                        CHANNEL END APP CODES 9&23 (CP10A) CHART N7    21630020
APPN7B2  LA    R13,CB50C+8              TEST STOP AT CB50C              21700020
         CLR   R12,R13                                                  21770020
         BNE   APPM1B3                  NO   M1B3                       21840020
APPN7A3  L     R12,DCBWKPT2             YES  SET SAME MODULE SWITCH ON  21910020
         OI    DCWWKNI,X'20'                                            21980020
         IC    R9,IOBDADAD+7         B3      ADD 1 TO R IN IOB          22050020
         LA    R12,1(R0,R9)                                             22120020
         STC   R12,IOBDADAD+7                                           22190020
         STC   R12,DCBLPDA+7            PUT NEW R IN LPDA         11081 22260020
APPN7B4  CLI   DCBHIRSH,X'00'          ARE ALL TRACKS UNSHARED    11081 22330020
         BE    APPN7C4                  YES  C4                         22400020
         IC    R9,DCBLPDA+6             IS THIS TRK SHARED              22470020
         IC    R12,DCBFIRSH+3           AND H  AND MASK TO GET          22540020
         NR    R9,R12                    REAL TRK NO.                   22610020
         EX    R9,CLIFIRSH              EXECUTE THE COMPARE             22680020
         BNE   APPN7C4                  NO   C4                         22750020
         CLC   DCBHIRSH,DCBLPDA+7       YES  HIRSH R = LPDA R {         22820020
         BNE   APPN7C2                  NO   C2                         22890020
APPN7D3  IC    R9,IOBDADAD+6            IS THIS LAST                    22960020
         IC    R12,DCBFIRSH+3                                           23030020
         NR    R12,R9                   DATA TRACK OF THIS              23100020
         EX    R12,CLILDT               CYLINDER                        23170020
         BE    APPN7D4                  YES, GO FIND NEXT CYL           23240020
         LA    R9,1(0,R9)               NO,                             23310020
         STC   R9,IOBDADAD+6            ADD 1 TO TRACK                  23380020
         MVI   IOBDADAD+7,X'00'      E2 NO   SET IOB R TO ZERO          23450020
APPN7G2  TM    DCBST,X'02'           G2      LAST BLOCK FULL{           23520020
         BZ    APPN7C2                  NO   C2                         23590020
         OI    DCBST,X'01'           G3 YES  SET LAST TRACK FULL SW ON  23660020
         B     APPN7C2                                                  23730020
APPN7D4  SR    R12,R12                                                  23800020
         IC    R12,IOBDADAD             FIND CURRENT                    23870020
         SLL   R12,4                          EXTENT                    23940020
         AR    R12,R3                                                   24010020
         OC    IOBDADAD+6(1),DCBFIRSH+3      SET TRACK TO MAX           24080020
         CLC   IOBDADAD+6(1),DEBENDHH+1-IHADEB(R12)   LAST TRACK IN EXT 24150020
         BNL   APPCCH                         YES                       24220020
         IC    R9,IOBDADAD+6                                            24290020
         LA    R9,1(0,R9)               ONLY THE 2301 WILL GO THIS PATH 24360020
         STC   R9,IOBDADAD+6              TO ADD 1  TO CLYINDER         24430020
         B     APPN7G4                                                  24500020
APPCCH   CLC   IOBDADAD+3(3),DEBENDCC-IHADEB(R12) LAST CYL OF           24570020
         BL    APPN7E4A                      EXTENT (CCH)               24640020
         IC    R9,IOBDADAD                                              24710020
         LA    R9,1(0,R9)               PUT NEW M IO IOB                24780020
         STC   R9,IOBDADAD                                              24850020
         LA    R12,16(0,R12)            ACCESS NEXT EXTENT INTRY IN DEB 24920020
         MVC   IOBDADAD+1(6),DEBBINUM-IHADEB(R12)   MOVE NEW BBCCHH     24990020
         L     R13,DEBUCBAD-IHADEB(R0,R12) IS NEW CYL ON SAME MODULE    25060020
         LA    R13,0(R0,R13)                                            25130020
         CLR   R13,R7                                                   25200020
         BE    APPN7G4                  YES  G4                         25270020
         L     R12,DCBWKPT2          F5 NO   SET SAME MOD SW OFF        25340020
         NI    DCWWKNI,X'DF'                                            25410020
         B     APPN7G4                       G4                         25480020
APPN7E4A MVI   IOBDADAD+K6,K0           SET TRACK TO ZERO        S20201 25550020
         IC    R13,IOBDADAD+K3          PICK UP C1 OF CC         S20201 25760020
         SLL   R13,8                    SHIFT                    S20201 25830020
         IC    R13,IOBDADAD+K4          PICK UP C2 OF CC         S20201 25900020
         LA    R13,K1(R0,R13)           ADD ONE TO CYL VALUE     S20201 25970020
         STC   R13,IOBDADAD+K4          RESTORE C2               S20201 26040020
         SRL   R13,8                    SHIFT                    S20201 26110020
         STC   R13,IOBDADAD+K3          RESTORE C1               S20201 26180020
APPN7G4  OC    IOBDADAD+6(1),DCBFIRSH+1                                 27300020
         IC    R9,DCBFIRSH+2                                            27370020
         BCTR  R9,0                                                     27440020
         STC   R9,IOBDADAD+7                                            27510020
         B     APPN7G2                                                  27580020
CLILDT   CLI   DCBLDT+1,0                                               27650020
CLIFIRSH CLI   DCBFIRSH+1,0                                             27720020
APPN7C4  CLC   DCBHIRPD,DCBLPDA+7    C4      HIRPD R = LPDA R {         27790020
         BE    APPN7D3                  YES  D3                         27860020
APPN7C2  MVC   CB55(4),IOBDADAD+3    C2 NO                              27930020
         IC    R9,IOBDADAD+7                                            28000020
         LA    R12,1(R0,R9)                                             28070020
         STC   R12,CB55+4                                               28140020
         MVI   IOBFLAG1,X'42'                SET B1 ON (CC)             28210020
         LA    R12,CB52                      SET IOB START TO CP10B     28280020
         ST    R12,IOBSTART-1                                           28350020
         LA    R13,IOBDADAD+3                                           28420020
         STH   R13,CB52+2                                               28490020
         SRL   R13,16                                                   28560020
         STC   R13,CB52+1                                               28630020
         CLI   IOBAPP,CODE9             IS APPENDAGE CODE 9      S20201 28700020
         BE    APPN7E1                  YES  E1                         28770020
         MVI   IOBAPP,CODE11            SET APPENDAGE CODE TO 11 S20201 28840020
APPN7F1  L     R12,DCBWKPT2          F1      SAME MODULE SW ON{         28910020
         TM    DCWWKNI,X'20'                                            28980020
         MVC   CB54A+1(3),CB52+1             WRITE CHECK SEARCH         29050020
         MVI   IOBCOUNT,X'0A'                SET COUNTER TO 10          29120020
         BO    APPRVXCP                 YES  EXCP RETURN TO IOS         29190020
         MVI   IOBASYN,X'01'            NO   SET ASYNC CODE 1           29260020
         B     APPM1B5                       SCHED ASYNC ROUTINE        29330020
APPN7E1  MVI   IOBAPP,CODE10            SET APPENDAGE CODE TO 10 S20201 29400020
         B     APPN7F1                       F1                         29470020
         EJECT                                                          29540020
*                        CHART J3, ABNORMAL END APP CODE9,23(CP10AW)    29610020
APPJ3B2  EQU   *                                                        29680020
         TM    IOBECBAD,PERRMASK       PERMANENT ERROR                  29750020
         BCR   PERRNO,R14                    NO,NORM IOS         S20201 29820020
         TM    IOBSENSE,X'08'      YES DATA CHECK                       29890020
         BZ    APPM1B3                                                  29960020
         LA    R13,CB50C+8              TEST STOP AT CB50C              30030020
         CLR   R12,R13                                                  30100020
         BE    APPJ3E3             YES E3                               30170020
         LA    R13,CB48+8                    STOP AT CB48?              30240020
         CLR   R12,R13                                                  30310020
         BE    APPJ3E3                  YES  E3                         30380020
         LA    R13,CB49+8                    STOP AT CB49?              30450020
         CLR   R12,R13                                                  30520020
         BE    APPJ3E3                  YES  E3                         30590020
         LA    R13,CB50+8                    STOP AT CB50?              30660020
         CLR   R12,R13                                                  30730020
         BNE   APPM1B3                  NO   N3B3                       30800020
APPJ3E3  OI    DECBEXC1,X'08'        E3 YES  IND UNCOR I/O ERROR        30870020
         B     APPM1B4                       N3B4                       30940020
         EJECT                                                          31010020
*                             CHANNEL END APP CODES 10&11(CP10B)CHARTN8 31080020
APPN8A2  LA    R13,CB54C+8              TEST STOP AT CB54C              31150020
         CLR   R12,R13                                                  31220020
         BNE   APPM1B3                  NO   M1B3                       31290020
         TM    CB53+4,X'20'             EOF FOR CP14?             13270 31360020
         BO    APPM426                                            17332 31430020
         L     R12,DCBNREC                                              31500020
         LA    R12,1(R0,R12)                                            31570020
         ST    R12,DCBNREC                   ADD 1 TO PRIME COUNT       31640020
         CLI   IOBAPP,CODE10            IS APPENDAGE CODE 10     S20201 31710020
         BE    APPM1B4                  YES  M1B4                       31780020
         MVI   IOBAPP,CODE18            NO, SET APP CODE TO 18   S20201 31850020
         OI    IOBFLAG1,X'C0'                SET B0&B1 ON (CC&DC)       31920020
         LA    R12,CK1                       SET IOB START TO CP17      31990020
         ST    R12,IOBSTART-1                                           32060020
         MVC   IOBDADAD+3(5),DCBLETI         SET SEEK ADDR IN IOB       32130020
         MVC   IOBDADAD(3),DCBLPDA                                      32200020
         LA    R12,IOBDADAD+3        D2      INITIALIZE CP17            32270020
         ST    R12,CK1                                                  32340020
         MVI   CK1,X'31'                                                32410020
         ST    R12,CK4                                                  32480020
         MVI   CK4,X'31'                                                32550020
         ST    R12,CK7A                 PUT IOB ADDR IN CK7A            32620020
         MVI   CK7A,X'31'                                               32690020
         MVC   CK6+1(3),DECBKEY+1                                       32760020
         B     APPM7G4                                                  32830020
         EJECT                                                          32900020
*                        CHART J4, ABNORMAL END APP CODE 10,11(CP10BW)  32970020
APPJ4B2  EQU   *                                                        33040020
         TM    IOBECBAD,PERRMASK       PERMANENT ERROR                  33110020
         BCR   PERRNO,R14               NO,NORMAL IOS RETURN     S20201 33180020
         TM    IOBSENSE,X'08'      YES DATA CHECK                       33250020
         BZ    APPM1B3                                                  33320020
         LA    R13,CB54C+8              TEST STOP AT CB54C              33390020
         CLR   R12,R13                                                  33460020
         BE    APPJ4E3             YES E3                               33530020
         LA    R13,CB54+8                    STOP AT CB54?              33600020
         CLR   R12,R13                                                  33670020
         BNE   APPM1B3                  NO   N3B3                       33740020
APPJ4E3  OI    DECBEXC1,X'08'        E3 YES  IND UNCOR I/O ERROR        33810020
         B     APPM1B4                       N3B4                       33880020
         EJECT                                                          33950020
*                        CHANNEL END APP CODES 17,18,19 (CP17) CHART N9 34020020
APPN9A2  LA    R13,CK1                  CP START MAY HAVE BEEN   A34932 34090020
*                                       CHANGED                  A34932 34160020
         ST    R13,IOBSTART-1              FOR RETRY ON ERROR.   A34932 34230020
         LA    R13,CK7C+8           A2  STOP AT CK70             M3299  34300020
         CLR   R12,R13                                                  34370020
         BNE   APPM1B3                  NO   M1B3                       34440020
         CLI   CK9,X'00'             A3      TEST F IN CK9              34510020
         BE    APPN9B3                       NORMAL TRACK INDEX         34580020
         CLI   CK9,X'08'                                                34650020
         BE    APPN9B3                       SHARED                     34720020
APPN9B2  EQU   *                                                        34790020
         L     R12,DCBWKPT2                                             34860020
         CLI   IOBAPP,CODE17            IS APPENDAGE CODE 17     S20201 34930020
         BE    APPM1B4                  YES  M1B4                       35000020
         CLI   IOBAPP,CODE18            IS APPENDAGE CODE 18     S20201 35070020
         BE    APPN9C2                  YES  C2                         35140020
         CLC   DCWNLEVC,DCBNLEV      E2 NO   (19)NLEV CTR = DCBNLEV|    35210020
         BE    APPN9F1                  YES                             35280020
         IC    R13,DCWNLEVC          G2 NO   ADD 1 TO NLEV COUNTER      35350020
         LA    R13,1(R0,R13)                                            35420020
         STC   R13,DCWNLEVC                                             35490020
         CLI   DCWNLEVC,X'02'        H2      NLEV COUNTER = 2{          35560020
         BE    APPN9E3                  YES  E3                         35630020
         CLI   DCWNLEVC,X'03'           NO   NLEV COUNTER = 3{          35700020
         BE    APPN9F3                  YES  F3                         35770020
         MVC   IOBDADAD+3(5),DCBLEMI3    G3  SET SEEK ADDR TO LEMI3     35840020
         CLI   DCBFTMI3+1,X'00'                                         35910020
         BE    *+14                                                     35980020
         MVC   IOBDADAD(1),DCBFTMI3+1                                   36050020
         B     APPN9C5                                                  36120020
         MVC   IOBDADAD(1),DCBFTMI3                                     36190020
         B     APPN9C5                       C5                         36260020
APPN9E3  MVC   IOBDADAD+3(5),DCBLEMI1   E3  SET SEEK ADDR TO LEMI1      36330020
         CLI   DCBFTMI1+1,X'00'                                         36400020
         BE    *+14                                                     36470020
         MVC   IOBDADAD(1),DCBFTMI1+1                                   36540020
         B     APPN9C5                                                  36610020
         MVC   IOBDADAD(1),DCBFTMI1                                     36680020
         B     APPN9C5                       C5                         36750020
APPN9F3  MVC   IOBDADAD+3(5),DCBLEMI2   F3  SET SEEK ADDR TO LEMI2      36820020
         CLI   DCBFTMI2+1,X'00'                                         36890020
         BE    *+14                                                     36960020
         MVC   IOBDADAD(1),DCBFTMI2+1                                   37030020
         B     *+10                                                     37100020
         MVC   IOBDADAD(1),DCBFTMI2                                     37170020
         XC    IOBDADAD+1(2),IOBDADAD+1                                 37240020
         B     APPN9C5                       C5                         37310020
APPN9B3  CLI   CB26,X'10'            B3      TEST F IN CB26             37380020
         BNE   APPN9B2                       NOT OVERFLOW END           37450020
         MVC   IOBDADAD+3(5),CB24    C3      OVERFLOW ENTRY             37520020
         MVI   IOBCOUNT,X'0A'                SET COUNTER TO 10          37590020
         B     APPRVXCP              C4      EXCP RETURN TO IOS         37660020
APPN9F1  TM    DCWHIAV,X'40'                 HIGH IND IN CORE?          37730020
         BZ    APPN9H1                  NO   H1                         37800020
         L     R12,DCWMSHIL          G1 YES  CHNG KEY OF LST CORE INDEX 37870020
         L     R11,DECBKEY                                              37940020
         IC    R9,DCBKEYLE                                              38010020
         LA    R13,0(R0,R9)                                             38080020
         BCTR  R13,R0                                                   38150020
         EX    R13,APPN9G1A                                             38220020
APPN9H1  MVI   IOBASYN,X'08'         H1      SET ASYNC CODE 8           38290020
         B     APPM1B5                       SCHED ASYNC ROUTINE        38360020
APPN9C2  CLI   DCBNLEV,X'00'         C2      DCBNLEV = 0 {              38430020
         BE    APPM1B4                  YES  M1B4                       38500020
         L     R12,DCBWKPT2             R12  ADDRESS DCB WA             38570020
         MVI   DCWNLEVC,X'01'        D2 NO   SET NLEV COUNTER TO 1      38640020
         MVC   IOBDADAD+3(5),DCBLECI     D3  SET SEEK ADDR TO LECI      38710020
         CLI   DCBFTCI+1,X'00'                                          38780020
         BE    *+14                                                     38850020
         MVC   IOBDADAD(1),DCBFTCI+1                                    38920020
         B     APPMVI                                                   38990020
         MVC   IOBDADAD(1),DCBFTCI                                      39060020
APPMVI   MVI   IOBAPP,CODE19            SET APPENDAGE CODE TO 19 S20201 39130020
         OI    IOBFLAG1,X'C0'                SET B0&B1 ON (CC&DC)       39200020
         LA    R12,CK1                       SET IOBSTART TO CK1        39270020
         ST    R12,IOBSTART-1                                           39340020
APPN9C5  MVI   IOBASYN,X'01'         C5      SET ASYNC CODE 1           39410020
         MVI   IOBCOUNT,X'0A'                SET COUNTER TO 10          39480020
         B     APPM1B5                       SCHED ASYNC ROUTINE        39550020
         EJECT                                                          39620020
*                        CHART J7, ABNORMAL END APP CODE17,18,19(CP17W) 39690020
APPJ7B2  EQU   *                                                        39760020
         TM    IOBECBAD,PERRMASK       PERMANENT ERROR                  39830020
         BC    PERRYES,APPJ7B7                                   A34932 39900020
* THIS IS A FIRST ENTRY ON AN ERROR.                                    39970020
         LA    R11,CK4                  TEST FOR STOP PRIOR TO   A34932 40040020
*                                       CK4                      A34932 40110020
         CLR   R12,R11                  DID IT STOP BEFORE CK4?  A34932 40180020
         BNH   APPRVNOR                 BIF YES. RETRY FROM CK1. A34932 40250020
         ST    R11,IOBSTART-1           RETRY FROM CK4           A34932 40320020
         B     APPRVNOR                 RETURN TO IOS.           A34932 40390020
APPJ7B7  TM    IOBSENSE,X'08'           UNCORRECTABLE I/O ERROR  A34932 40460020
         BZ    APPM1B3                                                  40530020
         LA    R13,CK7C+8                                               40600020
         CLR   R12,R13                                                  40670020
         BNE   APPM1B3                                                  40740020
APPJ7E3  OI    DECBEXC1,X'08'        E3 YES  IND UNCOR I/O ERROR        40810020
         B     APPM1B4                       N3B4                       40880020
         SPACE 4                                                        40950002
APPN9G1A MVC   0(0,R12),0(R11)                                          41020020
         SPACE 6                                                        41090002
*        COMMON ROUTINE TO SCHEDULE ASYNCHRONOUS ROUTINE                41160020
APPM1B3  OI    DECBEXC1,X'04'        B3      SET DECB EXCD TO UNRCHABLE 41230020
APPM1B4  MVI   IOBASYN,X'08'         B4      SET ASYNC CODE TO 8        41300020
APPM1B5  B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 41370002
         EJECT                                                          41650020
*                        CHANNEL END APP CODE 15 (CP16) CHART M2        41720020
APPM2B2  LA    R13,CJ10+8               TEST STOP AT CJ10               41790020
         CLR   R12,R13                                                  41860020
         BNE   APPM1B3                  NO   M1B3                       41930020
         L     R12,DCBMSWA           C2 YES  OFLO END ENTRY?            42000020
         TM    8(R12),X'08'                                             42070020
         BZ    APPM2D3                  YES  D3                         42140020
         MVC   IOBDADAD,0(R12)       E2 NO   SET SEEK ADDR FROM LINK    42210020
         B     APPM7G4                                                  42280020
APPM2D3  MVC   CJ11,IOBDADAD         D3      PUT SEEK ADDR IN CJ11      42350020
         MVI   IOBASYN,X'0B'                 SET ASYNC CODE 11          42420020
         NI    IOBINDCT,X'DF'                SET B2-OFLO RCD FR AREA    42490020
         B     APPM1B5                       SCHED ASYNC ROUTINE        42560020
         SPACE 10                                                       42630002
*                        ABNORMAL END APP CODES 15,16,(CP16) CHART M2   42700020
APPM2H2  TM    IOBECBAD,PERRMASK     H2      PERMANENT ERROR TEST       42770020
         BCR   PERRNO,R14              NO   CONTINUE, NORMAL IOS S20201 42840020
         B     APPM1B3                  YES  M1B3                       42910020
         EJECT                                                          42980020
*                        CHANNEL END APP CODE 16 (CP16) CHART M3        43050020
APPM3B2  LA    R13,CJ10+8               TEST STOP AT CJ10               43120020
         CLR   R12,R13                                                  43190020
         BNE   APPM3B3                  NO - TRY CJ9             S20201 43260020
         MVC   CJ11,IOBDADAD                 SAVE SEEK ADDR IN CJ11     43330020
         L     R12,DCBMSWA           D2 YES  SET IOB SEEK FROM LINK     43400020
         MVC   IOBDADAD,0(R12)                                          43470020
         L     R12,DCBWKPT2          E2      SET FIRST TIME ONLY SW OFF 43540020
         NI    DCWWKNI,X'BF'                                            43610020
         B     APPM7G4                  GO TO TEST DEB                  43680020
APPM3B3  LA    R13,CJ9+L'CJ9             STOP AT CJ9                    43750020
         CLR   R12,R13                                           S20201 43820020
         BNE   APPM3B4                  NO - TRY CJ8             S20201 43890020
         MVC   CJ11,IOBDADAD                 SAVE SEEK ADDR IN CJ11     43960020
         TM    DCBOPTCD,X'02'        C3 YES  DELETE OPTION{             44030020
         BZ    APPM3C4                  NO   C4                         44100020
         L     R12,DCBMSWA           D3 YES  RCD MARKED FOR DELETION{   44170020
         LA    R13,10(R0,R12)                                           44240020
         CLI   0(R13),X'FF'                                             44310020
         BNE   APPM3C4                  NO   C4                         44380020
         MVI   IOBASYN,X'0E'         E3 YES  SET ASYNC CODE 14          44450020
APPM3E4  NI    IOBINDCT,X'DF'        E4      SET B2-OFLO RCD FR AREA    44520020
         B     APPM1B5               E5      SCHED ASYNC ROUTINE        44590020
APPM3C4  OI    DECBEXC1,X'01'        C4      SET EXCEP CODE TO IND DUPL 44660020
         MVI   IOBASYN,X'08'         D4      SET ASYNC CODE 8           44730020
         B     APPM1B5                       SCHED ASYNC ROUTINE        44800020
APPM3B4  LA    R13,CJ8+L'CJ8            SEE IF STOPPED AT CJ8           44870020
         CLR   R12,R13                                           S20201 44940020
         BNE   APPM1B3                  IF NOT, UNREACHABLE BLK  S20201 45010020
         L     R12,DCBWKPT2          C5 YES  FIRST TIME ONLY SW ON{     45080020
         TM    DCWWKNI,X'40'                                            45150020
         BO    APPM3B5                  YES  B5                         45220020
         MVI   IOBASYN,X'0C'         D5 NO   SET ASYNC CODE 12          45290020
         B     APPM3E4                       E4                         45360020
APPM3B5  MVI   IOBASYN,X'0D'         B5      SET ASYNC CODE 13          45430020
         MVC   IOBDADAD(7),CJ11         RESTORE TRK INDEX MBBCCHH       45500020
         B     APPM3E4                                                  45570020
         EJECT                                                          45640020
*                             CHANNEL END APP CODE 12 (CP14) CHART M4   45710020
APPM4A2  LA    R13,CH18C+8              DID CHAN PROG STOP AT CH18C     45780020
APPM4A21 EQU   *                                                  13270 45850020
         TM    CB53+4,X'20'             EOF WRITTEN               13270 45920020
         BZ    APPM4A22                 BRANCH IF NO              13270 45990020
         MVC   IOBDADAD,DCBLIOV         INITIALIZE IOBDADAD SEEK  13270 46060020
         MVC   DCBLIOV(3),CH23          RESET LIOV FROM           13270 46130020
         MVC   DCBLIOV+3(5),CH24        CP14                      13270 46200020
         CLR   R12,R13                                            13270 46270020
         BNE   APPM1B3                  B = UNREACHABLE           13270 46340020
         MVI   IOBFLAG1,X'42'          CC SET ON                  13270 46410020
         MVI   IOBAPP,CODE10            SET APPENDAGE CODE 10    S20201 46480020
         LA    R12,CB52                                           13270 46550020
         ST    R12,IOBSTART-1                                     13270 46620020
         LA    R13,IOBDADAD+3                                     13270 46690020
         STH   R13,CB52+2                                         13270 46760020
         SRL   R13,16                                             13270 46830020
         STC   R13,CB52+1                                         13270 46900020
         MVC   CB54A+1(3),CB52+1        WRITE CHECK SEARCH        13270 46970020
         SR    R13,R13                                            16384 47040020
         IC    R13,IOBDADAD             GET M                     16384 47110020
         SLL   R13,4                    TIMES 16                  16384 47180020
         LA    R13,32(R3,R13)           ALLOW FOR BASIC DEB TOO   16384 47250020
         L     R12,0(0,R13)             GET UCB POINTER           16384 47320020
         LA    R12,0(0,R12)             ZERO HIGH ORDER BYTE      16384 47390020
         CR    R7,R12                   SAME UNIT                 16384 47460020
         BE    APPRVXCP                 YES--EXCP RETURN          16384 47530020
         MVI   IOBASYN,X'01'            NO--SET ASYNCH CODE = 1   16384 47600020
         B     APPM1B5                  SCHEDULE ASYNCHRONOUS RTN 16384 47670020
APPM426  CLI   CK9+7,12                INSERT TO MIDDLE  OVFL CH  17332 47740020
         MVI   CB53+4,X'00'            RESET EOF FLAG             17332 47810020
         BE    APPM1B4                 IF YES POST COMPLETION     17332 47880020
APPM4A22 EQU   *                                                  13270 47950020
         CLR   R12,R13                                            13270 48020020
         BNE   APPM1B3                  B = UNREACHABLE           13270 48090020
         TM    CH8E+4,X'40'            TEST FOR UWA               17332 48160020
         BZ    APPM425                 IF NO-BRANCH               17332 48230020
         NI    CH8E+4,X'42'            RESET  FLAG                17332 48300020
         CLI   CK9+7,14                 ASYN CODE=14              17332 48370020
         BE    APPM1B4                  IF YES-POST COMPLETION    17332 48440020
         CLI   CK9+7,9                  ASYN CODE=9               17332 48510020
         BE    APPM4A23                 IF YES BRANCH             17332 48580020
         MVI   IOBAPP,X'04'             SET UP CP14 PART2         17332 48650020
         MVC   IOBSTART,CH21+4          TO UPDATE TRACK           17332 48720020
         MVC   IOBDADAD,CH14           RESTORE IOBSEEK            17332 48790020
         MVI   CH14,X'03'               SET NOP IN CH14           17332 48860020
         MVI   CH14+4,X'20'                                       17332 48930020
         MVI   CH14+7,X'01'                                       17332 49000020
         B     APPN9C5                                            17332 49070020
APPM4A23 MVI   IOBCOUNT,X'01'           ERROR COUNT=1             17332 49140020
         MVC   IOBDADAD(3),CB10+7       IOBSEEK ADDR              17332 49210020
         MVC   IOBDADAD+3(5),CB23+3                               17332 49280020
         IC    R12,IOBDADAD+7           REDUCE R BY 1             17332 49350020
         BCTR  R12,R0                                             17332 49420020
         STC   R12,IOBDADAD+7                                     17332 49490020
         TM    DCBRECFM,X'10'          TEST FOR BLOCKED           17332 49560020
         BO    APPM424                 IF YES-BRANCH              17332 49630020
         L     R12,CH6+4               RESTORE 10 BYTES           17332 49700020
         L     R13,DECBAREA            USED FOR LINK FIELD IN     17332 49770020
         MVC   0(10,R12),0(R13)        OVFL RECORD                17332 49840020
APPM424  MVC   IOBSTART,CD2+5           START OF CP12B            17332 49910020
         MVI   IOBAPP,X'15'             APP CODE 15               17332 49980020
         OI    IOBFLAG1,X'C0'                                     17332 50050020
         B     APPN9C5                                            17332 50120020
APPM425  L     R12,DCBWKPT2                                       17332 50190020
         TM    DCWWKNI,X'10'            IS  ADD-TO-END INDICATOR ON     50260020
         BZ    APPM1B4                  NO - SCHEDULE COMPLETION        50330020
APPM4C2  MVC   CK6+1(3),DECBKEY+1  IF SO, SET ADDR OF CK6 TO DECB KEY   50400020
         LA    R12,IOBDADAD+3           SET UP CP17                     50470020
         STH   R12,CK1+2                                                50540020
         SRL   R12,16                                                   50610020
         STC   R12,CK1+1                                                50680020
         MVC   CK4+1(3),CK1+1                                           50750020
         MVC   CK7A+1(3),CK1+1                                          50820020
         B     APPN9C2             BRANCH                               50890020
         EJECT                                                          50960020
*                        CHART J5, ABNORMAL END APP CODE 12 (CP14W)     51030020
APPJ5B2  EQU   *                                                  19374 51100020
         TM    IOBSENSE+1,X'04'         FILE PROTECT              15924 51170020
         BO    APPJ5I2                  YES, BRANCH               15924 51240020
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 51310020
         BCR   PERRNO,R14               NO--RETRY CHAN PGM       S20201 51380020
*                                        1937                    S20201 51450020
         TM    IOBSENSE,X'08'      YES DATA CHECK                       51520020
         BZ    APPM1B3                                                  51590020
         LA    R13,CH3C+8               TEST STOP AT CH3C               51660020
         CLR   R12,R13                                                  51730020
         BE    APPJ5D2                  YES  D2                         51800020
         LA    R13,CH8C+8                    STOP AT CH8C?              51870020
         CLR   R12,R13                                                  51940020
         BE    APPJ5D2                  YES  D2                         52010020
         LA    R13,CH13C+8                   STOP AT CH13C?             52080020
         CLR   R12,R13                                                  52150020
         BE    APPJ5D2                  YES  D2                         52220020
         LA    R13,CH18C+8                   STOP AT CH18C?             52290020
         CLR   R12,R13                                                  52360020
         BE    APPJ5D2             YES D2                               52430020
         LA    R13,CH16+8                    STOP AT CH16?              52500020
         CLR   R12,R13                                                  52570020
         BE    APPJ5E3                  YES  E3                         52640020
         LA    R13,CH17+8                    STOP AT CH17?              52710020
         CLR   R12,R13                                                  52780020
         BE    APPJ5E3                  YES  E3                         52850020
         LA    R13,CH18+8                    STOP AT CH18?              52920020
         CLR   R12,R13                                                  52990020
         BNE   APPM1B3                  NO   N3B3                       53060020
APPJ5D2  EQU   *                                                        53130020
APPJ5E3  OI    DECBEXC1,X'08'        E3 YES  IND UNCOR I/O ERROR        53200020
         B     APPM1B4                       N3B4                       53270020
APPJ5I2  LA    R13,CH14+8               DID CHAN PROG STOP AT CH14      53340020
         L     R12,IOBCSW               CSW = STOP ADDRESS PLUS 8       53410020
         LA    R12,0(R0,R12)            CLEAR HIGH ORDER ZERO           53480020
          CLR   R12,R13                 BE MEANS YES, BNE MEANS NO      53550020
         BNE   APPM1B3                  NO - RECORD IS UNREACHABLE      53620020
         MVC   IOBDADAD,CH23            MOVE CH23 MBBCCHHR TO IOB       53690020
         MVC   IOBSTART,IOBCSW+1        RESUME PROCESSING AT CH15       53760020
         MVI   IOBASYN,X'01'                                            53830020
         B     APPM1B5                  EXCP IN ASYNCHRONOUS ROUTINE    53900020
         EJECT                                                          53970020
*              CHART M5  COMPLETION OF CP14, CODE 13                    54040020
*              CHANNEL END                                              54110020
APPM5A2  LA    R13,CH22C+8              DID CHAN PROG STOP AT CH22C     54180020
         B     APPM4A21                                                 54250020
         EJECT                                                          54320020
*                        CHART J6, ABNORMAL END APP CODE 13 (CP14W)     54390020
APPJ6B2  EQU   *                                                  19374 54460020
         TM    IOBSENSE+1,X'04'         FILE PROTECT?             15924 54530020
         BO    APPJ6I2                  YES, BRANCH               15924 54600020
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 54670020
         BCR   PERRNO,R14               NO--RETRY CHAN PGM       S20201 54740020
*                                        1937                    S20201 54810020
         TM    IOBSENSE,X'08'      YES DATA CHECK                       54880020
         BZ    APPM1B3                                                  54950020
         LA    R13,CH3C+8               TEST STOP AT CH3C               55020020
         CLR   R12,R13                                                  55090020
         BE    APPJ6D2                  YES  D2                         55160020
         LA    R13,CH8C+8                    STOP AT CH8C?              55230020
         CLR   R12,R13                                                  55300020
         BE    APPJ6D2                  YES  D2                         55370020
         LA    R13,CH13C+8                   STOP AT CH13C?             55440020
         CLR   R12,R13                                                  55510020
         BE    APPJ6D2                  YES  D2                         55580020
         LA    R13,CH18C+8                   STOP AT CH18C?             55650020
         CLR   R12,R13                                                  55720020
         BE    APPJ6D2                  YES  D2                         55790020
         LA    R13,CH22C+8                   STOP AT CH22C?             55860020
         CLR   R12,R13                                                  55930020
         BE    APPJ6D2             YES D2                               56000020
         LA    R13,CH16+8                    STOP AT CH16?              56070020
         CLR   R12,R13                                                  56140020
         BE    APPJ6E3                  YES  E3                         56210020
         LA    R13,CH17+8                    STOP AT CH17?              56280020
         CLR   R12,R13                                                  56350020
         BE    APPJ6E3                  YES  E3                         56420020
         LA    R13,CH18+8                    STOP AT CH18?              56490020
         CLR   R12,R13                                                  56560020
         BE    APPJ6E3                  YES  E3                         56630020
         LA    R13,CH22+8                    STOP AT CH22?              56700020
         CLR   R12,R13                                                  56770020
         BNE   APPM1B3                  NO   N3B3                       56840020
APPJ6D2  EQU   *                                                        56910020
APPJ6E3  OI    DECBEXC1,X'08'        E3 YES  IND UNCOR I/O ERROR        56980020
         B     APPM1B4                       N3B4                       57050020
APPJ6I2  LA    R13,CH19+8               DID CHAN PROG STOP AT CH19      57120020
         L     R12,IOBCSW               CSW = STOP ADDRESS PLUS 8       57190020
         LA    R12,0(R0,R12)            CLEAR HIGH ORDER ZERO           57260020
          CLR   R12,R13                 BE MEANS YES, BNE MEANS NO      57330020
         BNE   APPJ5I2                  NO - BRANCH TO TEST FOR CH14    57400020
         MVC   IOBDADAD,CJ11            MOVE CJ11 MBBCCHHR TO IOB       57470020
         MVC   IOBSTART,IOBCSW+1        RESUME PROCESSING AT CH20       57540020
         MVI   IOBASYN,X'01'                                            57610020
         B     APPM1B5                  EXCP IN ASYNCHRONOUS ROUTINE    57680020
         EJECT                                                          57750020
*           READ AND UPDATE APPENDAGE MODULES         *********         57820020
APPHCA14 DC    A(CA14-IHACP47+8)                                        57890020
APPHCA20 DC    A(CA20-IHACP47+8)        CA20 OFFSET              S20201 57960020
APPHCA23 DC    A(CA23-IHACP47+8)                                        58030020
APPHCA24 DC    A(CA24-IHACP47+8)                                        58100020
APPHCA31 DC    A(CA31-IHACP47+8)                                        58170020
APPCA31B DC    A(CA31B-IHACP47+8)       CA31B OFFSET             S20201 58240020
APPHCA36 DC    A(CA36-IHACP47+8)                                        58310020
APPHCA43 DC    A(CA43-IHACP47+8)                                        58380020
APHCA43C DC    A(CA43C-IHACP47+8)                                       58450020
APPHCA10 DC    A(CA10-IHACP47+8)        CA10 OFFSET                     58510001
*                                                                       58512002
*        CHANNEL END APP CODE 3 (CP2) CHART AA                          58520020
         USING CP2,R10                                                  58590020
APPAAB2  L     R13,DCBWKPT2             R13  ADDR DCB WA                58660020
         USING IHADCW,R13                                               58730020
         CLI   DCWNLSD,X'01'            BRANCH IF NLSD NOT 1, I.E.      58800020
         BH    APPAEB2                   IF CP1 IS BEING USED           58870020
         LA    R13,C35+8                TEST STOP AT C35                58940020
         CLR   R12,R13                                                  59010020
         BNE   APPAAB3                  NO   B3                         59080020
         TM    C37,X'20'                YES  DUMMY OR INACTIVE TEST     59150020
         BO    APPAAC3                  YES  C3                         59220020
         MVC   IOBDADAD,C36             NO   C36 TO IOBDADAD            59290020
         MVI   IOBASYN,X'03'         E2      ASYNC CD SET=3 (G CP1,2)   59360020
         B     APPABSAR                                                 59430020
APPAAC3  TM    C37,X'08'                TEST DUMMY CHAINED              59500020
         BO    APPAAD3                  YES  D3                         59570020
         IC    R12,C37                  NO   TEST NLEV PER F = DCBNLEV  59640020
         NI    C37,X'07'                                                59710020
         CLC   DCBNLEV,C37                                              59780020
         STC   R12,C37                                                  59850020
         BNE   APPAAB3                  NO   B3                         59920020
         OI    DECBEXC1,X'80'        C5 YES  DECB EXCEP SET=NO RCD FND  59990020
APPAAD4  MVI   IOBASYN,X'07'         D4      ASYNC CD SET=7 (NG CP1,2)  60060020
         B     APPABSAR                      SAR                        60130020
APPAAD3  MVC   IOBDADAD,C36             C36 TO IOBDADAD                 60200020
         B     APPRVXCP                      EXCP RETURN TO IOS         60270020
APPAAB3  OI    DECBEXC1,X'04'        B3      DECB EXCEP SET=UNREACHABLE 60340020
         B     APPAAD4                       D4                         60410020
*                                                                       60460002
*        ABNORMAL END APP CODE 3 (CP2) CHART AA                         60480020
*                                                                       60550020
APPAAA2  L     R13,DCBWKPT2            R13  ADDR DCB WA                 60620020
         CLI   DCWNLSD,X'01'            BRANCH IF NLSD NOT 1, I.E.      60690020
         BNE   APPAEJ2                    IF CP1 IS BEING USED          60760020
APPAAA3  TM    IOBECBAD,PERRMASK        TEST PERM ERR                   60830020
         BCR   1,R14                    NO, NORM RETURN TO IOS   S20201 60900020
*                                        1592                    S20201 60970020
         B     APPAAB3                  YES BRANCH TO INDICATE UNRCHBLE 61040020
         DROP  R13                                                      61110020
*                                                                       61180020
*              CHART AE                 END CP1                         61250020
*              CHANNEL END                                              61320020
         USING CP1,R10                                                  61390020
APPAEB2  L     R12,IOBCSW               R12  ADDRESS OF FINAL CCW+8     61460020
         LA    R12,0(R12)                     WITH HIGH ORDER BYTE ZERO 61530020
         LA    R13,C6+8                 TEST FINAL CCW EQUAL C6         61600020
         CLR   R12,R13                                                  61670020
         BE    APPAEC2                  BRANCH IF YES                   61740020
         LA    R13,C16+8                TEST EQUAL C16                  61810020
         CLR   R12,R13                                                  61880020
         BE    APPAEC4                  BRANCH IF YES                   61950020
         B     APPAAB3                  ERROR IF NO                     62020020
*              INTERRUPT AT C6                                          62090020
APPAEC2  EQU   *                        *                               62160001
*                                                                       62210002
         TM    C6+K5,CC                 WAS C6 CHAINED                  62220001
         BZ    APPAOS8                  NO, CONTINUE                    62222001
         NI    C6+K5,CCOFF              TURN OFF INDICATOR              62224001
         OI    C6+K4,CC                 RECHAIN C6                      62226001
         CLI   C10,SEEKHH               C10 SET TO DO SEEK HEAD         62228001
         BNE   APPAOSJ4                 NO, FILE PROTECT                62228401
         LA    R13,C10A                 RESET IOBSTART TO               62228801
         ST    R13,IOBSTART-K1          RESTART AT C10A                 62229201
         B     APPAEG2                  RESCHEDULE CP1                  62229601
APPAOS8  EQU   *                        *                               62229701
*                                                                       62229802
         TM    C9+K7,MIS                END MASTER INDEX SEARCH.        62229901
         BO    APPAEC3                  BRANCH IF YES                   62230020
         TM    C9+7,X'04'               IF LEVEL OF INDEX IS 3          62300020
         BO    APPAEG2                   SET CC IN CP1 TO CHAIN TO      62370020
         OI    C6+4,X'40'                SEARCH CYLINDER INDEX          62440020
APPAEG2  MVC   IOBDADAD,C8+7            ADDR NEXT SRCH ADDR IN IOB      62510020
         B     APPRVXCP                 RETURN TO EXCP                  62580020
*                                                                       62630002
*              DUMMY OR INACTIVE                                        62650020
*                                                                       62700002
APPAEC3  TM    C9+7,X'08'               TEST DUMMY ENTRY CHAINED        62720020
         BO    APPAEG2                  BRANCH IF YES                   62790020
         IC    R12,C9+7                 COMPARE LEVEL OF INDEX READ TO  62860020
         SLL   R12,29                    DCB INDEX LEVEL                62930020
         IC    R13,DCBNLEV                                              63000020
         SLL   R13,29                                                   63070020
         CLR   R12,R13                                                  63140020
         BNE   APPAAB3                  BRANCH IF NOT EQUAL             63210020
         OI    DECBEXC1,X'80'           SET NO REC FND IN EXCEPTION CD  63280020
         B     APPAAD4                                                  63350020
*                                                                       63400002
*              END OF CYLINDER SEARCH                                   63420020
*                                                                       63470002
APPAEC4  TM    C18,X'20'                TEST DUMMY OR INACTIVE          63490020
         BO    APPAEC5             BRANCH IF YES                        63560020
         MVC   IOBDADAD,C17                  ADDR NEXT SRCH IN IOB      63630020
         MVI   IOBASYN,X'03'       SET ASYNC CODE                       63700020
         B     APPABSAR                 SCHEDULE ASYNCH RTN             63770020
APPAEC5  TM    C18,X'08'                IF DUMMY ENTRY NOT CHAINED,     63840020
         BZ    APPAAB3                   BRANCH TO INDICATE UNRCHBLE    63910020
         MVC   IOBDADAD,C17             OTHERWISE, RESTART CHAN PROG    63980020
         LA    R12,C11                   WITH NEW SRCH ADDRESS          64050020
         STH   R12,IOBSTART+1                                           64120020
         SRL   R12,16                                                   64190020
         STC   R12,IOBSTART                                             64260020
         B     APPRVXCP                 RETURN TO IOS                   64330020
*                                                                       64380002
*              ABNORMAL END                                             64400020
*                                                                       64450002
APPAEJ2  TM    IOBSENSE+1,X'04'        FILE PROTECT               25000 64470020
         BZ    APPAAA3                  BRANCH IF NO.                   64540020
         LA    R12,C10+8                TEST STOP AT C10                64610020
         L     R13,IOBCSW                                               64680020
         LA    R13,0(R13)                                               64750020
         CLR   R12,R13                  BRANCH TO INDICATE UNREACHABLE  64820020
         BNE   APPAAB3                   IF NO.                         64890020
*                                                                       64940002
APPAOSJ4 EQU   *                        *                               64950001
*                                                                       64952002
         TM    C9+7,X'20'              IF DUMMY OR INACTIVE       25000 64960020
*                                       RECORD                    25000 65030020
         BO    APPAEC3                   BRANCH TO SAME PROCEDURE AS    65100020
         LA    R12,C11                   CHANNEL END                    65170020
         STH   R12,IOBSTART+1           OTHERWISE, RESTART CHAN PROG    65240020
         SRL   R12,16                                                   65310020
         STC   R12,IOBSTART                                             65380020
         B     APPAEG2                                                  65450020
*                                                                       65520020
*        CHANNEL END APP CODE 0,1 (CP4,5) CHART AB                      65590020
         USING CP4,R10                                                  65660020
APPABA2  EQU   *                                                 S20201 65730020
*                                                                       65780002
         L     R12,IOBCSW               CP STOP ADDR                    65790001
         LA    R12,0(R12)               CLEAR HI BYTE                   65792001
         SR    R12,R10                  OFFSET OF CCW                   65794001
*                                                                       65794402
         CL    R12,APPHCA23             STOP AT CCW CA23        SA65011 65794802
         BNE   NOTCA23                  BRANCH IF NO            SA65011 65795202
         TM    DECBTYP2,READKU          READ K FOR UPDATE       SA65011 65795602
         BZ    NOTCA23                  BRANCH IF NO            SA65011 65795702
         CLI   CA24,RDSECT              CA24 READ SECTOR CCW    SA65011 65798302
         BE    APPABF3                  BR IF YES - SET UNREACH SA65011 65800302
*                                       BLK, ASYN CODE OF 4     SA65011 65800702
NOTCA23  EQU   *                        CONTINUE - CP OK        SA65011 65801102
         CL    R12,APPHCA10             STOP AT CA10                    65801602
         BNE   APPAOSA2                 NO                              65804002
         TM    CA10+K5,CC               WAS CA10 COMMAND CHAINED        65806402
         BZ    APPAOSA2                 NO                              65808802
         OI    CA10+K4,CC               TURN CC BACK ON                 65811202
         NI    CA10+K5,CCOFF            TURN INDICATOR OFF              65813602
         CLI   CA14,SEEKHH              CA14 SEEK HEAD                  65816002
         BNE   APPAOS21                 NO, FILE PROTECT                65818402
         MVC   IOBDADAD,CA12+K7         RESET IOBSEEK                   65820802
         LA    R12,CA16A                RESET IOBSTART TO               65823201
         ST    R12,IOBSTART-K1          START AT CA16A                  65833201
         B     APPRVXCP                 GO DO AN EXCP                   65843201
APPAOSA2 EQU   *                        *                               65845201
*                                                                       65845602
         NI    DECBEXC1,NOT-OFLORCD     DECB EXECP CD SET NOT    S20201 65846701
*                                       OFLO                     S20201 65870020
         MVC   IOBDADAD+K5(K3),CA25+K5                           S20201 65940020
APPABB3  MVI   IOBASYN,X'00'         B3      ASYNC CD SET=0 (G CP4,5,6) 66010020
APPABSAR B     BYP(R14)                 SCHEDULE ASYNCH ROUTINE  Y02072 66080002
         SPACE 2                                                        66130002
*        ABNORMAL END APP CODE 0,1 (CP4,5) CHART AB                     66430020
*                                                                       66500020
APPABD2  EQU   *                                                  19374 66570020
         TM    IOBSENSE+1,X'04'         FILE PROTECT?             19374 66640020
         BO    APPABD21                 YES--BRANCH               19374 66710020
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 66780020
         BC    PERRYES,APPABD3          YES--INDICATE PERMANENT   19374 66850020
         TM    IOBSENSE,DATACHK         WAS ABEND DUE TO DATA    S20201 66920020
*                                       CHECK                    S20201 66990020
         BCR   ZERO,R14                 NO-NORMAL RETURN TO IOS  S20201 67060020
ZERO     EQU   8                        TM COND CODE FOR ==ZERO  S20201 67130020
         LA    R13,CA24C+L'CA24C        TEST STOP AT 24C                67200020
         CLR   R12,R13                                           S20201 67270020
         BCR   NOTEQ,R14                 NO-NORMAL RETURN TO IOS S20201 67340020
NOTEQ    EQU   7                        COMPARE COND CODE FOR    S20201 67410020
*                                       NOT EQUA                 S20201 67480020
         LA    R13,CA24D                 START ADDRESS = CA24D   S20201 67550020
         STH   R13,IOBSTART+K1                                   S20201 67620020
         SRL   R13,TWOBYTES                                      S20201 67690020
         STC   R13,IOBSTART                                      S20201 67760020
         MVC   IOBDADAD+3(5),CA25+3      RESET IOBSEEK          SA62417 67770002
         BR    R14                      NORMAL RETURN TO IOS     S20201 67830020
APPABD21 EQU   *                                                 S20201 67900020
*                                        1937                    S20201 67970020
         SR    R12,R10                  TEST STOP AT CA14               68040020
         CL    R12,APPHCA14                                             68110020
         BNE   APPABF3                  NO   F3                         68180020
*                                                                       68230002
APPAOS21 EQU   *                        *                               68240001
*                                                                       68242002
         TM    CA13+7,X'20'        F2 YES  DUMMY OR INAC TEST           68250020
         BO    APPABF1                  YES  F1                         68320020
         MVC   IOBDADAD,CA12+7     G2 NO   CA12+7 TO IOBDADAD           68390020
         MVC   CA34+7(8),CA12+7         CA12+7 TO CA34+7                68460020
         LA    R12,IOBDADAD+3      G1   ADIOBDADAD(CCHH)TO CA26         68530020
         ST    R12,CA26                                                 68600020
         MVI   CA26,X'31'                                               68670020
         MVC   CA28+1(3),DECBKEY+1 H1   DECBKEY+1 TO CA28 AD            68740020
         CLI   IOBAPP,CODE0             TEST FOR A READ          S20201 68810020
         BE    APPABJ2                  READ J2                         68880020
         LA    R12,CA40            K1 WRITE CA30 TIC TO CA40            68950020
         STH   R12,CA30+2                                               69020020
         SRL   R12,16                                                   69090020
         STC   R12,CA30+1                                               69160020
         L     R12,DECBAREA        K2   AREA+6 TO CA40 AD               69230020
         LA    R12,6(R12)                                               69300020
         ST    R12,CA40                                                 69370020
         MVI   CA40,X'06'                                               69440020
         MVC   CA43+1(3),CA40+1    K3   AREA+6 TO CA43 AD               69510020
         LA    R13,CA43+6               LENGTH+10 TO CA43 CNT           69580020
APPABK2  MVI   CA28,SKEQ                SCH EQ FOR WRITE         S20201 69650020
APPABK4  TM    DECBTYP1,X'02'                DECBLGTH SPECIFIED{        69720020
         BZ    APPABK4A                 YES  K4A                        69790020
         LH    R12,DCBLRECL             NO   USE DCBLRECL               69860020
         B     APPABK4B                                                 69930020
APPABK4A LH    R12,DECBLGTH             DECB LENGTH OVERRIDING          70000020
APPABK4B LA    R12,10(R12)                                              70070020
         STH   R12,0(R13)                                               70140020
         MVC   CA43C+6(2),CA43+6        SET COUNT IN CA43C              70210020
APPABK5  MVI   IOBAPP,CODE5             SET CODE 5 FOR CP6       S20201 70280020
         LA    R12,CA26            J5   AD CA26 TO IOBSTART             70350020
         IC    R13,IOBSIOCC                                             70420020
         ST    R12,IOBSIOCC                                             70490020
         STC   R13,IOBSIOCC                                             70560020
         MVI   IOBFLAG1,X'42'        H5 RESTORE IOB FLAGS AND ERR CTR   70630020
         MVI   IOBFLAG2,X'00'            CC AND UNRELATED FLAGS ON      70700020
         MVI   IOBCSW,X'00'              OTHERS OFF                     70770020
         XC    IOBERRCT,IOBERRCT                                        70840020
         MVI   IOBCOUNT,X'0A'           INITIALIZE ERR CTR FOR 10 TRIES 70910020
         SR    R12,R12             G5   TEST OFLO SAME VOLUMN           70980020
         IC    R12,IOBDADAD                                             71050020
         SLL   R12,4                                                    71120020
         L     R12,DEBUCBAD(R12)                                        71190020
         LA    R7,0(R7)                                                 71260020
         LA    R12,0(R12)                                               71330020
         CLR   R7,R12                                                   71400020
         BE    APPRVXCP                 IF SAME, EXCP RET TO IOS        71470020
         MVI   IOBASYN,X'01'         G4 NO   ASYNC CD SET=1 (EXCP)      71540020
         B     APPABSAR                      SAR                        71610020
APPABJ2  LA    R12,CA31              J2 CA30 TIC TO CA31                71680020
         STH   R12,CA30+2                                               71750020
         SRL   R12,16                                                   71820020
         STC   R12,CA30+1                                               71890020
         L     R12,DECBAREA                  AREA+6 TO CA31 ADDRESS     71960020
         LA    R12,6(R12)                                               72030020
         ST    R12,CA31                                                 72100020
         MVI   CA31,X'06'                                               72170020
         LA    R13,CA31+6                    LENGTH+10 TO CA31 COUNT    72240020
         SR    R12,R12                                           S20201 72310020
         AH    R12,DCBRKP               TEST IF RKP=0            S20201 72380020
         BNZ   APPABJ4                  BIF RKP NOT =0           S20201 72450020
         TM    DCBRECFM,BLOCKED         RECFM=BLOCKED            S20201 72520020
         BZ    APPABK2                  BIF NOT BLOCKED          S20201 72590020
APPABJ4  MVI   CA28,SKEQHI              SCH EQ+HI FOR (READ AND  S20201 72660020
*                                       RKP NE                   S20201 72730020
*                                       0) OR (READ AND RKP=0 AND BLKD) 72800020
         B     APPABK4                       K4                         72870020
APPABF1  CLI   DCBNLEV,X'00'         F1      DCBNLEV=0{                 72940020
         BE    APPABD5                  YES  D5                         73010020
APPABF3  OI    DECBEXC1,X'04'        F3 NO   DECB EXCEP SET=UNREACHABLE 73080020
APPABG3  MVI   IOBASYN,X'04'         G3      ASYNC CD SET=4(NG CP4,5,6) 73150020
         B     APPABSAR                      SAR                        73220020
APPABD3  EQU   *                                                        73290020
         L     R12,IOBCSW                                        S20201 73360020
         LA    R12,0(R12)                                               73430020
         SR    R12,R10                                                  73500020
         TM    SENSE1,NRF               NO RECORD FOUND          S20201 73570020
*                                        1607                    S20201 73640020
         BZ    APPABB1                  NO--BRANCH               S20201 73710020
*                                        1607                    S20201 73780020
         CL    R12,APPHCA20             STOP AT CA20 TEST        S20201 73850020
         BNE   APPAHH2                  NO   H2                  S20201 73920020
         CLI   CA21,X'69'          D4,C4 READ FORMAT BLOCKED TEST       73990020
         BE    APPABF3                  YES  F3                         74060020
APPABD5  OI    DECBEXC1,X'80'        D5 NO   DECB EXCEP SET=NO RCD FND  74130020
         B     APPABG3                       G3                         74200020
APPABB1  CL    R12,APPHCA23             B1   STOP AT CA23        S20201 74270020
         BNE   APPAHH2                  NO   H2                  S20201 74340020
APPABD1  OI    DECBEXC1,X'08'        D1 YES  DECB EXCEP SET=UNCOR IO ER 74410020
         B     APPABG3                       G3                         74480020
*                                                                       74550020
*        CHANNEL END APP CODE 5 (CP6) CHART AC                          74620020
         USING CP4,R10                                                  74690020
APPACA2  SR    R12,R10                  TEST STOP AT CA31               74760020
         CL    R12,APPHCA31             NON-RPS HALT.            S20201 74830020
         BE    APPACA6                  BIF STOP ON CA31         S20201 74900020
         CL    R12,APPCA31B             RPS HALT.                S20201 74970020
         BNE   APPACA3                  BIF NO HALT HERE.        S20201 75040020
         B     APPACA6A                 COMPARE KEYS            SA65011 75090002
*                                                                       75100002
APPACA6  TM    DECBTYP2,READKU          READ K FOR UPDATE       SA65011 75102002
         BZ    APPACA6A                 BRANCH IF NO            SA65011 75104002
         TM    CA31+4,CC                CA31 COMMAND CHAINED    SA65011 75106002
         BO    APPABF3                  BR IF YES - SET UNREACH SA65011 75108002
*                                       BLK, ASYN CODE OF 4     SA65011 75108402
APPACA6A CLI   CA28,SKEQHI              SEARCH HI USED.         SA65011 75110002
         BNE   APPACA8                  BIF NOT SCH HI           S20201 75180020
*                                                                       75230002
*        COMPARE KEYS. IF THE RECORD'S KEY IS HIGHER, TERMINATE THE     75250020
*        SEARCH OF THE OVFLO CHAIN.                                     75320020
*                                                                       75370002
         IC    R9,CA28+K7                GET KEY LENGTH          S20201 75390020
         SH    R9,HWDONE                EXECUTED LENGTH          S20201 75460020
         L     R12,CA28                 GET KEY ADDR             S20201 75530020
         L     R13,CA31                 GET DATA ADDR            S20201 75600020
         AH    R13,DCBRKP               FIND THE KEY IN          S20201 75670020
         LA    R13,K10(R13)             THE RECORD               S20201 75740020
         EX    R9,COMPARE               CHECK FOR MATCH          S20201 75810020
         BNE   APPACG3                  BIF NO MATCH             S20201 75880020
APPACA8  EQU   *                                                 S20201 75950020
         CLC   CA34+7(8),CA12+7         FIRST RECORD IN CHAIN   OY00310 76020002
         BE    APPACB3                  YES  B3                         76090020
         L     R12,DCBRORG3             NO   ADD 1 TO DCBRORG3          76160020
         LA    R12,1(R12)                                               76230020
         ST    R12,DCBRORG3                                             76300020
         TM    DECBTYP2,X'20'           B2  TEST READ FOR UPDATE        76370020
         BZ    APPACB3                  NO   B3                         76440020
         MVC   IOBDADAD,CA34+7          YES  IOBDADAD SET FOR WRITEBACK 76510020
APPACB3  OI    DECBEXC1,X'02'        B3      DECB EXCEP SET=OFLO RCD    76580020
         MVI   IOBASYN,X'00'         B4      ASYNC CD SET=0 (G CP4,5,6) 76650020
         B     APPABSAR                      SAR                        76720020
APPACA3  CL    R12,APHCA43C          A3 TEST - STOP AT CA43C            76790020
         BNE   APPACF4                  NO   F4                         76860020
         B     APPACB3                  YES  B3                         76930020
*                                                                       77000020
*        ABNORMAL END APP CODE 5 (CP6) CHART AC                         77070020
*                                                                       77140020
APPACE2  EQU   *                                                  19374 77210020
         TM    IOBSENSE+1,X'04'         FILE PROTECT?             19374 77280020
         BO    APPACE21                 YES--BRANCH               19374 77350020
         TM    IOBECBAD,PERRMASK        PERMANENT ERROR?          19374 77420020
         BC    PERRYES,APPAGH3          YES--BRANCH               19374 77490020
         B     APPAGG2                  GO SEE IF DATA CHECK      24075 77560020
APPACE21 EQU   *                                                  19374 77630020
         SR    R12,R10                  TEST STOP AT CA36               77700020
         CL    R12,APPHCA36                                             77770020
         BNE   APPACF4                  NO   F4                         77840020
*                                                                       77890002
         CLI   CA36,SEEKHH              CA36 SET TO SEEK HEAD           77900001
         BNE   APPAOSE2                 NO                              77902001
         MVC   IOBDADAD,CA34+K7         RESET IOBSEEK                   77904001
         B     APPRVXCP                 GO DO AN EXCP                   77906001
APPAOSE2 EQU   *                        *                               77908001
*                                                                       77908402
         TM    CA35+7,X'08'        G2 YES  END OR CHAINED TEST          77910020
         BZ    APPACG3                  END  G3                         77980020
         MVI   IOBASYN,X'01'         J2      ASYNC CD SET=1 (EXCP)      78050020
         MVI   IOBFLAG1,X'42'        J3 RESTORE IOB FLAGS AND ERR CTR   78120020
         MVI   IOBFLAG2,X'00'            CC AND UNRELATED FLAGS ON      78190020
         MVI   IOBCSW,X'00'              OTHERS OFF                     78260020
         XC    IOBERRCT,IOBERRCT                                        78330020
         MVC   IOBDADAD,CA34+7          SET SEEK SEARCH ADDRESS         78400020
         B     APPABSAR                      SAR                        78470020
APPACE3  EQU   *                                                        78540020
         L     R12,IOBCSW          E4 YES  TEST STOP AT CA31 OR CA43    78610020
         LA    R12,0(R12)                                               78680020
         SR    R12,R10                                                  78750020
         CL    R12,APPHCA31                                             78820020
         BE    APPACE5                  YES  E5                         78890020
         CL    R12,APPHCA43                                             78960020
         BE    APPACE5                  YES  E5                         79030020
APPACF4  OI    DECBEXC1,X'04'        F4 NO   DECB EXCEP SET=UNREACHABLE 79100020
APPACG4  MVI   IOBASYN,X'04'         G4      ASYNC CD SET=4(NG CP4,5,6) 79170020
         B     APPABSAR                      SAR                        79240020
APPACG3  OI    DECBEXC1,X'80'        G3      DECB EXCEP SET=NO RCD FND  79310020
         B     APPACG4                       G4                         79380020
APPACE5  TM    IOBSENSE,X'08'        E5      DATA CHK{                  79450020
         BZ    APPACF4                  NO   F4                         79520020
APPACF5  OI    DECBEXC1,X'08'        F5 YES  DECB EXCP SET UNCOR IO ERR 79590020
         B     APPACG4                       G4                         79660020
*                                                                       79710002
*              CHART AD       CHANNEL END + NORMAL END CP7              79730020
*              CHANNEL END                                              79800020
*                                                                       79850002
         USING CP7,R10                                                  79870020
APPADB2  LA    R13,CA46C+8              TEST STOP AT CA46C              79940020
         CLR   R12,R13                  TEST STOP AT CA46C              80010020
         BNE   APPADB3                                                  80080020
         MVI   IOBASYN,X'02'            IF SO, SET ASYN CODE AND BRANCH 80150020
         B     APPABSAR                 SCHEDULE ASYN ROUTINE           80220020
APPADB3  OI    DECBEXC1,X'04'           IF NOT, INDICATE UNREACHABLE IN 80290020
APPADB4  MVI   IOBASYN,X'06'             DECB AND SET ASYNCH CODE       80360020
         B     APPABSAR                 SCHEDULE ASYNCH ROUTINE         80430020
*                                                                       80480002
*    CHART AI ABNORMAL END, CODE 2  , CP7 , WRITE CHECK                 80500020
*                                                                       80550002
APPAIB2  EQU   *                                                        80570020
         TM    IOBECBAD,PERRMASK        WAS ABEND DUE TO PERM ERROR     80640020
         BCR   1,R14                    NO, NORM RETURN TO IOS   S20201 80710020
*                                        1592                    S20201 80780020
         L     R13,IOBCSW               ADDRESS+8 OF CCW WHERE    19323 80850020
         LA    R13,0(R13)                 CP STOPPED              19323 80920020
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     80990020
         BZ    APPADG4                  NO- TEST FOR RETRY        19323 81060020
         LA    R12,CA46+8               IF STOP AT CA46 AND             81130020
         CLR   R13,R12                   GO TO APPADB3                  81200020
         BE    APPADG3                  YES - I/O ERROR                 81270020
         LA    R12,CA46C+8                                              81340020
         CLR   R13,R12                  CHECK STOP AT 46C               81410020
         BNE   APPADB3                  NO-INDICATE UNREACHABLE         81480020
APPADG3  OI    DECBEXC1,X'08'           DATA CHECK, SET IO UNCORRTABLE  81550020
         B     APPADB4                   ERROR BIT IN DECB              81620020
APPADG4  EQU   *                                                  19323 81690020
         TM    IOBSENSE+1,NORECFND      NO RECORD FOUND           19323 81760020
         BZ    APPADB3                 FALSE-INDICATE UNREACHABLE 19323 81830020
         LA    R12,CA46A+8                                        19323 81900020
         CLR   R13,R12                  STOP AT CA46A             19323 81970020
         BNE   APPADB3                  NO- INDICATE UNREACHABLE  19323 82040020
         CLI   IOBCOUNT,X'0A'           FIRST TIME THROUGH        19323 82110020
         BL    APPADB3                  NO- INDICATE UNREACHABLE  19323 82180020
         MVI   IOBCOUNT,X'00'           INDICATE RETRY            19323 82250020
         B     APPRVXCP                 RETRY CHANNEL PROGRAM     19323 82320020
*                                                                       82370002
*              CHART AG  ABNORMAL END, NOT FILE PROT CHK                82390020
*                                                                       82440002
         USING  CP4,R10                                          S20201 82460020
APPAGG2  EQU   *                                                        82530020
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     82600020
         BCR   8,R14                    NO - NORMAL RETURN TO    S20201 82670020
*                                       IOS                      S20201 82740020
         LA    R12,CA43C+8                                              82810020
         L     R13,IOBCSW                                               82880020
         LA    R13,0(R13)                                               82950020
         CLR   R12,R13                                                  83020020
         BCR   7,R14                    NO-NORMAL RETURN TO IOS  S20201 83090020
         MVC   IOBDADAD,CA34+7                                          83160020
         LA    R12,CA41                                                 83230020
         STH   R12,IOBSTART+1                                           83300020
         SRL   R12,16                                                   83370020
         STC   R12,IOBSTART                                             83440020
         BR    R14                      TAKE NORMAL RETURN TO    S20201 83510020
*                                       IOS                      S20201 83580020
APPAGH3  EQU   *                                                        83650020
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     83720020
         BZ    APPACE3                  NO-BRANCH                       83790020
         LA    R13,CA43C+8              TEST STOP AT 43C                83860020
         CLR   R12,R13                                                  83930020
         BNE   APPACE3                  BRANCH IF NO                    84000020
         B     APPACF5                   UNCORRECTABLE I/O ERROR        84070020
APPAHH2  EQU   *                                                        84140020
         AR    R12,R10                  GET STOPPING ADDR        S20201 84210020
         TM    IOBSENSE,X'08'           WAS ABEND DUE TO DATA CHECK     84280020
         BZ    APPABF3                  NO-BRANCH                       84350020
         LA    R13,CA24C+8              TEST STOP AT 24C                84420020
         CLR   R12,R13                                                  84490020
         BE    APPABD1                  YES- I/O ERROR                  84560020
         LA    R13,CA24F+8              IF PERMANENT, WAS STOP AT       84630020
         CLR   R12,R13                   CA24F                          84700020
         BNE   APPABF3                  BRANCH IF NO                    84770020
         B     APPABD1                   UNCORRECTABLE I/O ERROR        84840020
APPRVXCP SR    R12,R12                                                  84910020
         IC    R12,IOBDADAD             GET BB                          84980020
         SLL   R12,4                                                    85050020
         LA    R12,32(R12,R3)                                           85120020
         MVC   IOBDADAD+1(2),4(R12)                                     85190020
         LA    R14,EXCP(R14)            SETUP FOR EXCP IOS RETURN 15924 85260020
         XC    IOBFLAG2(3),IOBFLAG2     CLEAR FLAG2,SENSE BYTES   15924 85330020
         XC    IOBCSW(9),IOBCSW         CLEAR FLAG3,CSW,AND SIOCC 15924 85400020
         XC    IOBERRCT(2),IOBERRCT     CLEAR ERROR COUNT         15924 85470020
         NI    IOBFLAG1,X'C2'           RESET FLAG1               15924 85540020
APPRVNOR BR    R14                      RETURN TO IOS             15924 85610020
*                                                                       85680020
         EJECT                                                  , 17332 85750020
*              NORMAL END APPENDAGE CODE 4                              85820020
*              UPDATE TRACK INDICES WITH 2ND PART CP14                  85890020
*                                                                       85960020
*                                                                       86030020
         USING IHAWKNCP,R10                                      S20201 86100020
APPAFB   LA    R13,CH14+8               DID CP END AT CH14        17332 86170020
         CLR   R12,R13                                            17332 86240020
         BNE   APPN3B3                  NO-RECORD IS UNREACHABLE  17332 86310020
         MVC   IOBASYN,CK9+7                                      17332 86380020
         CLI   IOBASYN,10          ADD TO END                     17332 86450020
         BE    APPM4C2             IF YES-GO UPDATE MSTR INDICES  17332 86520020
         CLI   IOBASYN,11          ADD TO END                     17332 86590020
         BE    APPM4C2             IF YES-GO UPDATE MSTR INDICES  17332 86660020
         B     APPM1B4             POST COMPLETION                17332 86730020
         SPACE 10                                                       86800002
*                                                                       86870020
*              ABNORMAL END  APPENDAGE CODE 4                           86940020
*              UPDATE  TRACK INDICES                                    87010020
*                                                                       87080020
APPAEB   TM    IOBECBAD,PERRMASK        PERM ERROR                17332 87150020
         BCR   PERRNO,R14               IF NO-NORMAL RET TO IOS  S20201 87220020
*                                        1733                    S20201 87290020
         B     APPM1B3                  POST UNREACHABLE BLOCK    17332 87360020
COMPARE  CLC   K0(K1,R12),K0(R13)       EXECUTED INSTRUCTION     S20201 87430020
         EJECT                                                          87500020
HWDONE   DC    H'1'                     CONSTANT FOR EXECUTE     S20201 87570020
APPN3B3  EQU   APPM1B3        LABELS USED IN COMMON ROUTINE TO          87640020
APPN3B5  EQU   APPM1B5         SCHEDULE ASYNCHRONOUS ROUTINE            87710020
CODE0    EQU   0                        CHAN PGM 4-5 APPEND CODE S20201 87780020
CODE5    EQU   5                        CHAN PGM 6 APPEND CODE   S20201 87850020
CODE6    EQU   6                        CP5W APPEND CODE FOR WC  S20201 87920020
CODE8    EQU   8                        CHAN PGM 8 APP CODE      S20201 87990020
CODE9    EQU   9                        CHAN PGM 10A APP CODE    S20201 88060020
CODE10   EQU   10                       CHAN PGM 10B APP CODE    S20201 88130020
CODE11   EQU   11                       CHAN PGM 10B APP CODE    S20201 88200020
CODE14   EQU   14                       CHAN PGM 15 APP CODE     S20201 88270020
CODE17   EQU   17                       CHAN PGM 17 APP CODE     S20201 88340020
CODE18   EQU   18                       CHAN PGM 17 APP CODE     S20201 88410020
CODE19   EQU   19                       CHAN PGM 17 APP CODE     S20201 88480020
*                                                                       88530002
PATCH    DC    XL((*-IGG019GO)/20)'00'  ZEROED PATCH AREA        Y02072 88540002
*                                                                       88542002
IHACVTEX DSECT   COMMUNICATION VECTOR TABLE                             88550020
         DS    A                                                        88620020
CVTEXEF  DS    A                        USED WITH R13 TO EFFECT EXIT    88690020
*                        ADDRESS OF COMMUNICATION VECTOR TABLE          88760020
CVTPTR   EQU   16                                                       88830020
         EJECT                                                          89040020
*        READ K, READ KU, AND WRITE K CHANNEL PGMS(WRITE CHK)           89110020
IHACP47  IGGCP47 OPTCD=W                                         S20201 89180020
         SPACE 2                                                        89230002
*        WRITE KEY NEW CHANNEL PROGRAM REFERENCES (WRITE CHECK)         89250020
IHAWKNCP IGGWKNCP  OPTCD=W                                       S20201 89320020
         SPACE 2                                                        89370002
         IGGCP12C  OPTCD=W                                       S20201 89390020
         SPACE 2                                                        89440002
         IGGCP12A                                                       89460020
         EJECT                                                          89530020
*              DATA EVENT CONTROL BLOCK                                 89600020
IHADECB  DSECT                                                          89670020
         DS    0F                                                       89740020
DECBECB  DS    CL4                      EVENT CONTROL BLOCK (ECB)       89810020
DECBTYP1 DS    BL1                      TYPE B6 - 1 IF LENGTH IS S      89880020
*                                            B7 - 1 IF AREA IS S        89950020
DECBTYP2 DS    BL1                           B0 - 1 IF READ K           90020020
*                                            B1 - 1 IF READ KX          90090020
*                                            B2 - 1 IF READ KU          90160020
*                                            B4 - 1 IF WRITE K          90230020
*                                            B5 - 1 IF WRITE KN         90300020
DECBLGTH DS    CL2                      LENGTH OF BLOCK                 90370020
DECBDCBA DS    A                        POINTER TO DCB                  90440020
DECBAREA DS    A                        ADDRESS OF AREA                 90510020
DECBLOGR DS    A                        POINTER TO LOGICAL RECORD       90580020
DECBKEY  DS    A                        POINTER TO KEY                  90650020
DECBEXC1 DS    BL1                      EXCPTN CD B0-RECORD NOT FOUND   90720020
*                                                 B1-RECORD LGTH CHK    90790020
*                                                 B2-NO SPACE           90860020
*                                                 B3-INVALID REQUEST    90930020
*                                                 B4-UNCORRECTABLE IO   91000020
*                                                 B5-UNREACHABLE BLOCK  91070020
*                                                 B6-OVERFLOW RECORD    91140020
*                                                 B7-DUPLICATE          91210020
DECBEXC2 DS    BL1                                B7-READ KU            91280020
         EJECT                                                          91350020
         DCBD  DSORG=(IS)                                               91420020
         EJECT                                                          91490020
IHAIOB   IGGIOBD                                                        91560020
CPSTART  EQU   IOBSTART-1                                        S20201 91630020
SENSE1   EQU   IOBSENSE+1                                        S20201 91700020
         SPACE 3                                                        91750002
IHADCW   IGGBISAM                                                       91770020
         SPACE 2                                                        91820002
IHADEB   IGGDEBD                                                        91840020
         END                                                            91980020
