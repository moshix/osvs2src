         TITLE 'IGG019HB - GET MODULE'                                  00010000
IGG019HB CSECT                                                          00020000
*          RELEASE OS/VS2-02 CHANGES                             Y02072 00030003
*D                                                               Y02072 00030402
*                                                               YM03876 00030802
*                                                               YM05395 00031202
*                                                               YM05971 00031602
*                                                               YM06516 00031702
*                                                               YM07002 00031802
*              OS/VS2 RELEASE 030 CHANGES                               00033803
* A294500                                                       OZ05912 00034203
* A138220,C149904                                               OZ05933 00034603
*A103000                                                       @ZA07607 00035003
*                                                                       00035403
*          RELEASE 21 DELETIONS                                       * 00036000
*0693                                                            A39794 00036121
*0693117200,124200,125000,126600,130600,131200,146200,175800,    S21045 00036321
*0693199400,289200                                               S21045 00036621
*0693                                                            A36373 00037021
*    149400-149760                                               A48519 00037400
*A138300-138340,141500-141520,C144800                           SA66297 00047402
*                                                                     * 00055302
* STATUS CHANGE LEVEL 012                                               00058002
*                                                                       00080000
*FUNCTION/OPERATION- THIS MODULE CONTAINS ROUTINES FOR THE SETL B(D), * 00100000
*   ESETL, PUTX, AND RELSE MACROS AS WELL AS GET. IT ALSO CONTAINS    * 00120000
*   SUBROUTINES USED BY THESE MACROS AND USED AS EXTERNAL ROUTINES BY * 00140000
*   SETL K(D), SETL I(D), AND CLOSE. AT THE BEGINNING OF THE GET      * 00160000
*   MODULE IS A VECTOR TABLE OF UNRELOCATED ADDRESSES CONTAINING THE  * 00180000
*   ENTRY POINTS TO THE VARIOUS MACRO ROUTINES AND SUBROUTINES. THIS  * 00200000
*   TABLE PROVIDES ACCESS TO THE ROUTINES BY EACH OTHER AND BY OTHER  * 00220000
*   MODULES. THE PUTX AND RELSE ADDRESSES ARE IN BRANCH INSTRUCTIONS  * 00240000
*   BECAUSE OF THE MACRO EXPANSION METHOD OF OBTAINING ENTRY POINTS   * 00260000
*   FOR THESE MACROS. EACH ROUTINE AND SUBROUTINE IS DISCUSSED        * 00280000
*   INDIVIDUALLY.                                                     * 00300000
*                                                                     * 00320000
*   GET - IS THE CENTRAL MACRO OF SCAN MODE. THE OBJECT OF THE GET    * 00340000
*   ROUTINE IS TO GIVE THE USER ACCESS TO THE NEXT LOGICAL RECORD.    * 00360000
*   THIS IS ACCOMPLISHED BY UPDATING THE POINTER 'W1CBF' (BY MEANS OF * 00380000
*   THE END OF BUFFER ROUTINE WHEN NECESSARY) AND MOVING THE NEW RCD  * 00400000
*   TO THE USER SPECIFIED AREA (MOVE MODE) OR POINTING TO THE NEW RCD * 00420000
*   IN REGISTER 1 (LOCATE MODE). BEFORE RETURNING A RECORD TO THE USER* 00440000
*   A CHECK FOR DELETED OR PADDING RECORDS IS MADE, BOTH TYPES BEING  * 00460000
*   BYPASSED. GET ALSO CONTROLS READ AND WRITE SCHEDULING. IF A READ  * 00480000
*   OPERATION HAS COMPLETED SINCE THE LAST GET OR THE LAST ATTEMPT AT * 00500000
*   INPUT SCHEDULING WAS UNSUCCESSFUL, THE GET ROUTINE ATTEMPTS TO    * 00520000
*   INITIATE ANOTHER READ USING THE SCHEDULE SUBROUTINE. EACH TIME    * 00540000
*   CONTROL GOES TO END OF BUFFER,IF AT LEAST HALF OF THE BUFFERS ARE * 00560000
*   WAITING TO BE WRITTEN, A WRITE IS INITIATED. THE GET ROUTINE ALSO * 00580000
*   CHECKS WHETHER I/O ERRORS HAVE BEEN DETECTED AND SENDS CONTROL TO * 00600000
*   THE USERS SYNCHRONOUS ERROR ADDRESS BY MEANS OF THE EINFO SUB-    * 00620000
*   ROUTINE.                                                          * 00640000
*                                                                     * 00660000
*                                                                     * 00680000
*   PUTX - THE PUTX MACRO ROUTINE SETS AN INDICATOR IN THE CHANNEL    * 00700000
*   PROGRAM ASSOCIATED WITH THE BUFFER TO BE WRITTEN. THIS INDICATOR  * 00720000
*   IS INTEROGATED BY THE END OF BUFFER ROUTINE.                      * 00740000
*                                                                     * 00760000
*                                                                     * 00780000
*   RELSE - THE FUNCTION OF THIS MACRO IS TO BYPASS THE REMAINING     * 00800000
*   LOGICAL RECORDS OF THE CURRENT BLOCK. THIS IS ACCOMPLISED BY USING* 00820000
*   THE END OF BUFFER ROUTINE. NO ACTION IS TAKEN IF THERE HAS BEEN NO* 00840000
*   INTERCEDING GET SINCE THE LAST RELSE OR SETL, NOR IF THE MOST     * 00860000
*   RECENT GET OBTAINED THE LAST RECORD OF A BLOCK. RELSE ALSO CHECKS * 00880000
*   IF ANY WRITE ERRORS OCCURRED ON THE LAST WRITE,AND IF SO INFORMS  * 00900000
*   THE USER BY MEANS OF THE ERROR SUBROUTINE(EINFO).                 * 00920000
*                                                                     * 00940000
*                                                                     * 00960000
*   SETL B(D) - THE PURPOSE OF THE MACRO IS TO ENABLE THE USER TO     * 00980000
*   START TO SEQUENTIALLY RETRIEVE HIS RECORDS AT THE FIRST RECORD    * 01000000
*   OF HIS DATA SET. IF SETL BD IS SPECIFIED, ONLY THE DATA PORTION   * 01020000
*   OF THE UNBLOCKED RECORDS ARE RETRIEVED. THE SETL B MACRO CAN GAIN * 01040000
*   CONTROL DIRECTLY THROUGH THE USER (IF HE ISSUES THE MACRO), OR    * 01060000
*   THROUGH THE GET MACRO. IF NO SETL IS GIVEN THEN A SETL B IS       * 01080000
*   ASSUMED. THE ROUTINE WILL INFORM THE USER IF THERE WERE ANY       * 01100000
*   PREVIOUS WRITE ERRORS, SET THE CHANNEL PROGRAMS TO READ COMMANDS  * 01120000
*   AND SCHEDULE  A READ WHICH WILL MAKE THE FIRST RECORDS AVAILABLE  * 01140000
*   TO THE USER.                                                      * 01160000
*                                                                     * 01180000
*                                                                     * 01200000
*   ESETL - THE ESETL MACRO INSTRUCTION ENDS THE SCANNING OF AN       * 01220000
*   INDEXED SEQUENTIAL DATA SET. IF AT THE TIME OF THE ESETL, THERE   * 01240000
*   WERE RECORDS ON THE PUTX QUEUE (WAITING TO BE WRITTEN), A WRITE   * 01260000
*   IS INITIATED. IF THERE WERE WRITE ERRORS, THE ROUTINE SEND CONTROL* 01280000
*   TO THE USER'S SYNCHRONOUS ERROR ADDRESS BY MEANS OF THE EINFO     * 01300000
*   ROUTINE. THE ESETL ALSO MOVES ANY BUFFERS REMAINING ON ANY OTHER  * 01320000
*   QUEUE TO THE FREE QUEUE. IF A READ WAS IN PROGRESS, IT WAITS FOR  * 01340000
*   ITS COMPLETION AND MOVES READ QUEUE BUFFERS TO THE FREE QUEUE. THE* 01360000
*   ESETL REINITIALIZES CERTAIN WORKAREA FIELDS BEFORE RETURNING TO   * 01380000
*   THE USER.                                                         * 01400000
*                                                                     * 01420000
*   SCHEDULE  - THIS ROUTINE SETS UP CHANNEL PROGRAMS FOR READING AND * 01440000
*    INITIATES THE READ. IT DETERMINES WHETHER THE NEXT RECORD TO BE  * 01460000
*    READ IS A PRIME DATA OR OVERFLOW RECORD, WHETHER AN EXTENT OR A  * 01480000
*    CYLINDER BOUNDARY IS BEING CROSSED, AND WHETHER THE NUMBER OF    * 01500000
*    FREE BUFFERS SATISFIES THE CONDITIONS FOR INITIATING A READ, AND * 01520000
*    PROCEEDS ACCORDINGLY. IT ALSO SCHEDULES THE READING OF TRACK     * 01540000
*    INDEX ENTRIES WHEN A TRACK BOUNDARY IS CROSSED. THE SCHEDULING   * 01560000
*    BIT (W1OSBIT2, BIT 5) IS ON AT THE EXIT FROM THIS ROUTINE IF NO  * 01580000
*    READ COULD BE SCHEDULED.                                         * 01600000
*                                                                     * 01620000
*   QUEUE  - THIS ROUTINE IS USED TO MOVE BUFFERS FROM QUEUE TO QUEUE.* 01640000
*    ON ENTRY TO THIS ROUTINE R5 CONTAINS THE NUMBER OF BUFFERS TO BE * 01660000
*    MOVED(0-255), R3 CONTAINS THE ADDRESS OF THE 'TO' QUEUE AND R4   * 01680000
*    CONTAINS THE ADDRESS OF THE'FROM' Q. ALL QUEUES ARE CONSIDERED TO* 01700000
*    HAVE AN R (RESIDUE) FIELD ALTHOUGH ONLY THE READ Q CAN HAVE AN   * 01720000
*    R NOT EQUAL TO 0. THE FORMAT OF A QUEUE IS - 1ST WORD, ADDRESS OF* 01740000
*    1ST CHANNEL PROGRAM ON Q, 2ND WORD, ADDRESS OF LAST CP ON Q, 3RD * 01760000
*    WORD BYTES 0-1, NUMBER ON UNUSED CP'S ON Q, BYTES 2-3, NUMBER(C) * 01780000
*    OF USED CP'S ON Q. INTERMEDIATE BUFFERS ARE CHAINED TOGETHER BY  * 01800000
*    MEANS OF THE TIC ADDRESS IN CN5 OF THE CORRESPONDING CP.         * 01820000
*                                                                     * 01840000
*                                                                     * 01860000
*   END OF BUFFER - THE PURPOSE OF THE END OF BUFFER ROUTINE IS TO    * 01880000
*   ADVANCE TO THE NEXT BUFFER IF THE CURRENT BUFFER HAS ALREADY      * 01900000
*   BEEN PROCESSED. IF THE CURRENT USER BUFFER WAS MARKED FOR WRITING * 01920000
*   (PUTXED), THIS BUFFER IS MOVED TO THE PUTX QUEUE. IF THERE ARE    * 01940000
*   N/2 BUFFERS ON THE PUTX QUEUE NOW, THE ROUTINE INITIATES A WRITE. * 01960000
*   IF AT THIS TIME THERE STILL IS AT LEAST ONE BUFFER ON THE USER Q, * 01980000
*   THE ROUTINE ADJUSTS THE CURRENT AND END OF BUFFER POINTERS (W1CBF * 02000000
*   AND W1EOB,RESPECTIVELY) AND EXITS. IF NO USER QUEUE BUFFERS WERE  * 02020000
*   PRESENT, END OF BUFFER MOVES READ QUEUE BUFFERS TO THE USER QUEUE,* 02040000
*   OR SCHEDULES A READ (TO GET BUFFERS FOR THE READ QUEUE) AND THEN  * 02060000
*   MOVES THESE READ QUEUE BUFFERS TO THE USER QUEUE.                 * 02080000
*                                                                     * 02100000
*                                                                     * 02120000
*   SETC4- THE FUNCTION OF THIS ROUTINE IS TO PREPARE ALL THE WRITE   * 02140000
*   QUEUE SETS FOR OUTPUT. A SET CAN CONSIST OF ONE (IN THE CASE OF   * 02160000
*   OVERFLOW RECORDS) OR MANY BUFFERS (PRIME DATA RECORDS FALLING ON  * 02180000
*   THE SAME TRACK). THE LAST RECORD ON A PRIME DATA TRACK ALWAYS     * 02200000
*   DESIGNATES THE END OF A SET. THE COMMAND CODES OF ALL THE CHANNEL * 02220000
*   PROGRAMS ARE SET FOR WRITING. WHEN THE END OF THE WRITE Q HAS BEEN* 02240000
*   REACHED, THE SEEK ADDRESS IN THE IOB (W1ODAD), IS SET EQUAL TO    * 02260000
*   THE MBBCCHHR OF THE FIRST CHANNEL PROGRAM OF THE FIRST SET. THE   * 02280000
*   ACTUAL WRITE COMMAND (EXCP) IS GIVEN IN THE MAINLINE CODING.      * 02300000
*                                                                     * 02320000
*                                                                     * 02340000
*   CHECK - THIS ROUTINE IS ENTERED FOR EACH LOGICAL RECORD TO SEE IF * 02360000
*   THE BUFFER WAS READ WITHOUT ERROR. IF AN ERROR DID OCCUR CHECK    * 02380000
*   USES EINFO TO SET THE REGISTERS AND GIVE CONTROL TO THE USER'S    * 02400000
*   SYNAD ROUTINE. CHECK SETS THE EXCD CODE TO INDICATE UNREADABLE OR * 02420000
*   UNREACHABLE.                                                      * 02440000
*                                                                     * 02460000
*   EINFO - THIS ROUTINE SERVES 2 PURPOSES- 1- WHEN A WRITE ERROR HAS * 02480000
*   BEEN DISCOVERED, EINFO IS ENTERED AT 'SISSGF1', AND IT DETERMINES * 02500000
*   WHICH BUFFER(S) ON THE WRITE Q IS(ARE) IN ERROR AND SETS THE EXCD * 02520000
*   CODE UNWRITEABLE OR UNREACHABLE AS INDICATED BY THE FLAG BIT OF   * 02540000
*   THE CHANNEL PROGRAM ASSOCIATED WITH THE BAD BUFFER. 2-FROM        * 02560000
*   'SISSGG4' THE ROUTINE IS ALSO USED BY CHECK TO SET REGISTERS TO   * 02580000
*   GIVE ERROR INFORMATION TO THE USER.                               * 02600000
*                                                                     * 02620000
*ENTRY POINTS- THE ENTRY POINTS AND CALLING SEQUENCES FOR THE MACROS  * 02640000
*   CONTAINED IN THE MODULE ARE-                                        02660000
*        'SISCTSA' -GET-       LA 1,DCB (LOCATE)  LA 0,TOAREA  (MOVE) * 02680000
*                              L  15,48(0,1)      LA 1,DCB            * 02700000
*                              BALR 14,15         L  15,48(0,1)       * 02720000
*                                                 BALR 14,15          * 02740000
*        'SISSAH1' -PUTX-      LA 1,DCB                               * 02760000
*                              L 15,48(0,15)                          * 02780000
*                              BAL 14,4(0,15)                         * 02800000
*        'SISCTRE' -RELSE-     LA 1,DCB                               * 02820000
*                              L 15,48(0,15)                          * 02840000
*                              BAL 14,8(0,15)                         * 02860000
*        'SISCTBS' -SETL B(D)- LA  1,DCB                              * 02880000
*                              L   15,76(0,1)                         * 02900000
*                              BALR 14,15                             * 02920000
*        'SISCTES' -ESETL-     LA  1,DCB                              * 02940000
*                              L   15,84(0,1)                         * 02960000
*                              BALR 14,15                             * 02980000
*                                                                     * 03000000
*INPUT- REGISTER 1, DCB ADDRESS, REGISTER 14, RETURN ADDRESS, REGISTER* 03020000
*   13, SAVE AREA ADDRESS, REGISTER 15, ENTRY POINT. FOR SETL B(D)    * 03040000
*   AND THE MOVE MODE OF GET,THE CONTENTS OF REGISTER 0 ARE ALSO      * 03060000
*   MEANINGFUL. BYTE 0 IS 10 FOR SETL B, 18 FOR SETL BD. THE ADDRESS  * 03080000
*   OF THE USER WORK AREA IS IN REGISTER 0 FOR THE MOVE MODE OF GET.  * 03100000
*                                                                     * 03120000
*OUTPUT- SAME AS INPUT FOR NORMAL EXIT EXCEPT-                        * 03140000
*   GET, LOCATE MODE, REGISTER 1 POINTS TO THE DATA PORTION OF THE    * 03160000
*   NEXT SEQUENTIAL LOGICAL RECORD (REGISTER 0 POINTS TO THE KEY      * 03180000
*   PORTION OF THIS RECORD IF THE RECORDS ARE UNBLOCKED AND KEY AND   * 03200000
*   DATA HAVE BEEN SPECIFIED IN THE LATEST SETL). IN THE MOVE MODE OF * 03220000
*   GET THE NEXT LOGICAL RECORD HAS BEEN MOVED TO THE USER WORK AREA. * 03240000
*                                                                     * 03260000
*   OUTPUT FOR ERROR EXIT FOR READ OR WRITE ERROR, REGISTER 0 POINTS  * 03280000
*   TO I-O STATUS INDICATORS, REGISTER 1 POINTS TO THE BUFFER IN ERROR* 03300000
*   REGISTER 15 CONTAINS THE USER SYNAD ROUTINE ADDRESS, AND PROPER   * 03320000
*   DCBEXCD BIT IS SET. FOR SETL ERRORS ONLY REGISTER 15 AND THE EXCD * 03340000
*   BITS ARE SET.                                                       03360000
*                                                                     * 03380000
*EXTERNAL ROUTINES- N/A                                               * 03400000
*                                                                     * 03420000
*EXITS-NORMAL                                                         * 03440000
*        'GETOUT' RETURNS TO THE NEXT SEQUENTIAL INSTRUCTION AFTER THE* 03460000
*   GET MACRO EXPANSION.                                              * 03480000
*        'PUTXOUT' RETURNS TO THE NEXT SEQUENTIAL INSTRUCTION AFTER   * 03500000
*   THE PUTX MACRO EXPANSION.                                         * 03520000
*        'SISRED2' RETURNS TO THE NEXT SEQUENTIAL INSTRUCTION AFTER   * 03540000
*   THE RELSE MACRO EXPANSION.                                        * 03560000
*        'SISBSH5' RETURNS TO THE NEXT SEQUENTIAL INSTRUCTION AFTER   * 03580000
*   THE SETL B(D) MACRO EXPANSION.                                    * 03600000
*        'SISESG1' RETURNS TO THE NEXT SEQUENTIAL INSTRUCTION AFTER   * 03620000
*   THE ESETL MACRO EXPANSION.                                        * 03640000
*        'SISSEOUT' RETURNS TO THE USER SPECIFIED END OF DATA ADDRESS.* 03660000
*                                                                     * 03680000
*   ERROR EXITS TO USER SYNCHRONOUS ERROR ROUTINE-                    * 03700000
*        'SISBSE1', ERROR IN SPECIFYING SETL B(D).                    * 03720000
*        'ERROUT', READ OR WRITE ERROR.                               * 03740000
*   ABEND EXITS IF NO SYNAD ROUTINE SPECIFIED                         * 03760000
*        'SISBSAB', ERROR IN SPECIFYING SETL B(D).                    * 03780000
*        'SISSGAB', READ OR WRITE ERROR.                              * 03800000
*   ABEND EXIT IF NO END OF DATA ADDRESS SPECIFIED IN THE DCB         * 03820000
*        'SISSEABE', END OF DATA SET                                  * 03840000
*                                                                     * 03860000
*TABLES AND WORKAREAS- DATA EXTENT BLOCK(DEB) DESCRIBED BY SISDEB     * 03880000
*   DSECT, WORKAREA DESCRIBED BY SISWORK1 DSECT, DATA CONTROL BLOCK   * 03900000
*   DESCRIBED BY IHADCB DSECT.                                        * 03920000
*                                                                     * 03940000
*ATTRIBUTES- REENTRANT, READ ONLY.                                    * 03960000
*                                                                     * 03980000
*NOTES-REGISTER USAGE IS CONSISTENT IN ALL SCAN MODE MACRO TIME       * 04000000
*   MODULES.  IN THIS MODULE R15 IS THE BASE REGISTER FOR GET, PUTX,  * 04020000
*   RELSE, SETL B, AND ESETL, R12 FOR END OF BUFFER, R11 FOR SCHEDULE,* 04040000
*   SETC4, CHECK, AND EINFO, R10 FOR QUEUE.  R9 IS THE RETURN REGISTER* 04060000
*   FROM SUBROUTINES.  R3, R4, AND R5 ARE USED AS PARAMETER REGISTERS * 04080000
*   FOR THE QUEUE ROUTINE. R6,R7,AND R8 ARE ALWAYS WORK REGISTERS AND * 04100000
*   ANY REGISTER LOWER THAN THE BASE OF THE ROUTINE IS USUALLY        * 04120000
*   AVAILABLE AS A WORK REGISTER.                                     * 04140000
         EJECT                                                          04160000
         USING IHADCB,R1                BASE FOR DCB                    04180000
         USING SISDEB,R8                BASE FOR DEB                    04200000
         USING SISCP22,R3               BASE FOR REFERENCES TO          04220000
*                                       CP22A OR CP22B                  04240000
         USING SISWORK1,R2              BASE FOR WORKAREA               04260000
         USING *,R15                                                    04280000
R0       EQU   0                                                        04300000
R1       EQU   1                                                        04320000
R2       EQU   2                                                        04340000
R3       EQU   3                                                        04360000
R4       EQU   4                                                        04380000
R5       EQU   5                                                        04400000
R6       EQU   6                                                        04420000
R7       EQU   7                                                        04440000
R8       EQU   8                                                        04460000
R9       EQU   9                                                        04480000
R10      EQU   10                                                       04500000
R11      EQU   11                                                       04520000
R12      EQU   12                                                       04540000
R13      EQU   13                                                       04560000
R14      EQU   14                                                       04580000
R15      EQU   15                                                       04600000
K3       EQU   3                        CONSTANT                 S20201 04602020
L4       EQU   4                        LENGTH                   S20201 04604020
K16      EQU   16                       CONSTANT                 S20201 04606020
L2       EQU   2                        CONSTANT                 S20201 04608020
K1       EQU   1                        CONSTANT                 S20201 04610020
L3       EQU   3                        LENGTH                   S20201 04612020
THIRTY   EQU   30                       LIMIT WRITE CP'S                04616001
         SPACE 3                                                        04640002
*********************************************************************   04660000
*****                             VECTOR TABLE                          04680000
*********************************************************************   04700000
         SPACE 2                                                        04720002
*                                       ROUTINE             OFFSET      04740000
SISCTSA  B     SISSAB1                  GET                  0          04760000
         B     SISSAH1                  PUTX                 4          04780000
         B     SISCTRE                  RELSE                8          04800000
         DC    A(SISCTSGE-SISCTSA)      EINFO(ERROR)        12          04820000
         DC    A(SISCTSD-SISCTSA)       QUEUE               16          04840000
         DC    A(SISCTSB-SISCTSA)       SCHEDULE            20          04860000
         DC    A(SISCTSF-SISCTSA)       SETC4               24          04880000
         DC    A(SISCTSE-SISCTSA)       END OF BUFFER       28          04900000
         DC    A(SISCTSGC-SISCTSA)      CHECK               32          04920000
         DC    A(SISCTBS-SISCTSA)       SETL B(D)           36          04940000
         DC    A(SISCTES-SISCTSA)       ESETL               40          04960000
         EJECT                                                          05000000
*                                       ***************                 05020000
*                                       *             *                 05040000
*                                       *  GET MACRO  *                 05060000
*                                       *             *                 05080000
*                                       ***************                 05100000
*                                                                       05120000
* TEST FOR WRITE ERRORS                                                 05140000
*                                                                       05160000
SISSAB1  STM   R2,R12,28(R13)           SAVE REGISTERS                  05180000
         L     R2,DCBWKPT1              SET UP R2 WITH ADDR OF WORKAREA 05200000
         SPACE 2                                                        05210002
         NIL   W1OSBIT2,ONES-RELSE,    SET OFF BIT FOR RELSE    YM03876X05220002
               REF=W1OSBIT1,WREGS=(R6,R9,R11)                   YM03876 05230002
         SPACE 2                                                        05232002
         ST    R0,W1TEMPSA             SAVE SO IOS WONT DESTROY         05240000
         TM    W1OSBIT2,X'80'           ANY WRITE ERRORS                05260000
         BZ    SISSAA2                  NO                              05280000
*                                       YES, GO TO EINFO TO TELL USER   05300000
         L     R11,CTSGE(R15)           PICK UP OFFSET                  05320000
         AR    R11,R15                  ADD BASE                        05340000
         BALR  R9,R11                   GO TO EINFO  ROUTINE            05360000
         SPACE 1                                                        05380002
*                                                                       05400000
* HAS A SCAN BEEN INITIATED BY A SETL                                   05420000
*                                                                       05440000
SISSAA2  XC    DCBEXCD1(2),DCBEXCD1    SET EXCD'S TO ZERO               05460000
         TM    W1OSBIT1,X'80'           IS SCAN MODE IND ON             05480000
         BO    SISSAB3                  YES                             05500000
*                                       NO, SETL B MUST BE EXECUTED     05520000
*                                                                       05524019
*CHECK FOR NULL DATA SET                                                05528019
*                                                                       05532019
          CLC   DCBNREC(4),EMPTYCON     IS DATA SET EMPTY        A27355 05536019
         BNE   SISSAB2                  NO                       A27355 05540019
         LA    R12,SISCTSE              ADDRESABILITY            A27355 05544019
         B     SISSEG2                  BRANCH TO END OF FILE    A27355 05548019
SISSAB2  OI    W1OSBIT2,X'08'           INDICATE TO SETL B THAT  A27355 05552019
*                                       GET                      A27355 05556019
*                                       INITIATED SETL                  05560000
         L     R0,SISSACN2              SET CODE FOR B,KD TYPE OF SETL  05580000
         LA    R15,SISCTBS                                              05600000
         LM    R2,R12,28(R13)         RESTORE BEFORE GOING TO SETL      05620000
         BR    R15                      SETL WILL RETURN TO SISSAB1     05640000
         SPACE 1                                                        05660002
*                                                                       05680000
* UPDATE POINTER TO CURRENT RECORD                                      05700000
*                                                                       05720000
SISSAB3  L     R6,W1CBF                 UPDATE CURRENT BUFFER LENGTH    05740000
         AH    R6,W1CURLEN              WITH LENGTH OF CURRENT LOG REC  05760000
         ST    R6,W1CBF                                                 05780000
SISSAC3  CLC   W1CBF,W1EOB              ARE WE FINISHED WITH THIS BUF   05800000
         BNH   SISSAB31                 NO                              05820000
*                                       YES, GO TO EOB SUB-ROUTINE      05840000
SISSAC31 L     R12,CTSE(0,R15)          PICK UP OFFSET                  05860000
         AR    R12,R15                  ADD BASE                        05880000
         BALR  R9,R12                                                   05900000
        SPACE 1                                                         05920002
*                                                                       05940000
* IS THIS BUFFER OK                                                     05960000
*                                                                       05980000
SISSAB31 TM    DCBRECFM,X'80'           FIXED RECS                      06000000
         BO    SISSAB32                 YES                             06020000
         MVC   W1CURLEN,0(R6)           NO, MOVE LOGICAL RCD LENGTH OF  06040000
*                                       CURRENT RCD TO W1CURLEN         06060000
SISSAB32 L     R11,CTSGC(R15)           GO TO CHK RTN TO SEE IF         06080000
         AR    R11,R15                  THERE HAS BEEN A READ ERROR     06100000
         BALR  R9,R11                   OF THE CURRENT BUFFER           06120000
*                                       IF SO CHECK GOES TO USER        06140000
         SPACE                                                          06160000
*                                                                       06180000
* CHECK FOR DELETED RECORD OR PADDING                                   06200000
*                                                                       06220000
SISTAB2  TM    DCBOPTCD,X'02'           WAS DELETE OPTION SPECIFIED     06240000
         BO    SISTAB3                  YES, SEE IF THIS RCD WAS DELETD 06260000
SISTAC2  L     R3,W1US1ST               NO, IS THIS LAST BLOCK          06280000
         CLC   CN6,DCBLPDA              DISK ADDR OF CURRENT BUFFER=CN6 06300000
         BNE   SISSAD3                  NOT LAST BLOCK                  06320000
SISTAD2  TM    DCBST,X'02'              YES, IS LAST BLOCK FULL         06340000
         BO    SISSAD3                  YES                             06360000
*                                       NO, TEST FOR PADDING RECORD     06380000
SISTAE2  LH    R6,W1CURLEN              R6=BYTE LEN OF CURRENT RECORD   06400000
         L     R7,W1CBF                 LRECL IF FIXED, CHAR CNT IF VAR 06420000
         AR    R6,R7                    R6=END OF RECORD + 1            06440000
SISTAE22 BCTR  R6,0                    SUB  1                           06460000
         CLI   DCBRECFM,X'80'          IF FIXED FORMAT                  06480000
         BE    SISSAD3                 DO NOT TEST PADDING              06500000
         TM    0(R6),X'FF'              LOOP TESTING ALL BITS FOR 1     06520000
         BC    12,SISSAD3              TILL START OF RECORD             06540000
SISTAE23 CR    R6,R7                    ARE WE AT END OF RECORD         06560000
         BNE   SISTAE22                 NO, LOOP                        06580000
         B     SISSAC31                 YES, ALL BITS=1, PADDING        06600000
         SPACE 2                                                        06620000
*  DELETE CHECK                                                         06640000
*                                                                       06660002
SISTAB3  L     R7,W1CBF                 IF REC IS FIXED LENGTH 1ST BYTE 06680000
         TM    DCBRECFM,X'80'          IS TESTED FOR ALL ONES, IF       06700000
         BO    SISTAB31                 VARIABLE 5TH BYTE IS TESTED     06720000
         LA    R7,4(R7)                ADD  4 TO STARTING BYTE          06740000
SISTAB31 TM    0(R7),X'FF'              WAS THIS RCD DELETED            06760000
         BO    SISSAB3                  YES, GET NEXT RECORD            06780000
*                                       NO                              06800000
         EJECT                                                          06820000
*                                                                       06840000
* WHAT MODE OF GET                                                      06860000
*                                                                       06880000
SISSAD3  L     R3,W1US1ST               CURRENT BUFFER                  06900000
         TM    DCBMACRF,X'10'           IS IT MOVE MODE                 06920000
         BO    SISSAD4                  YES                             06940000
*                                       NO, LOCATE MODE                 06960000
         MVC   W1REGSAV,W1CBF           SAVE BUFFER ADDRESS TO          06980000
*                                       BE RETURNED TO USER             07000000
         SPACE                                                          07020000
         TM    CN2+4,X'20'              WAS KEY-DATA SPECIFIED          07040000
         BZ    SISSAE3                  NO, DATA ONLY                   07060000
         MVC   W1TEMPSA,CN7+4           YES, KEY ADDR MUST BE SAVED TO  07080000
         B     SISSAE3                  RETURN TO USER                  07100000
         SPACE 1                                                        07120002
*                                                                       07140000
* MOVE ROUTINE                                                          07160000
*                                                                       07180000
SISSAD4  L     R7,W1TEMPSA              USERS AREA ADDRESS              07200000
         TM    CN2+4,X'20'              ARE KEY AND DATA READ           07220000
         BZ    SISSAD4A                 NO, DATA ONLY                   07240000
         SR    R6,R6                                                    07260000
         IC    R6,DCBKEYLE              YES, MOVE KEY FIRST             07280000
         L     R8,CN7+4                 R8 = KEY ADDRESS                07300000
         EX    R6,SISSAD43              MOVE KEYLEN+1 CHARACTERS        07320000
         AR    R7,R6                    UPDATE TO ADDRESS               07340000
SISSAD4A LH    R6,W1CURLEN              R6=NUMBER CHARS TO BE MOVED     07360000
         L     R8,W1CBF                 R8= FROM ADDRESS IN CUR BUFFER  07380000
SISSAD41 CH    R6,SISSACN1              IS REC OR REMAINDER OF REC      07400000
*                                       GREATER THAN 256 BYTES %LIMIT   07420000
*                                       OF MOVE INST<                   07440000
         SPACE                                                          07460000
         BNH   SISSAD42                 NO,MOVE LAST %OR ONLY< PORTION  07480000
*                                       OF RECORD                       07500000
         SPACE                                                          07520000
         MVC   0(256,R7),0(R8)          MOVE GREATEST AMOUNT POSSIBLE   07540000
         SH    R6,SISSACN1              FIND HOW MANY BYTES LEFT        07560000
         AH    R7,SISSACN1              UPDATE TO AND FROM ADDRS        07580000
         AH    R8,SISSACN1                                              07600000
         B     SISSAD41                 LOOP                            07620000
SISSAD42 BCTR  R6,0                    SUB 1 FOR WAY MOVE WORKS         07640000
         EX    R6,SISSAD43              EXECUTE MOVE OF REMAINING CHARS 07660000
         ST    R1,W1REGSAV              STORE R1 SO THAT DCB ADDRESS    07680000
*                                       WILL BE RETURNED IN R1          07700000
         EJECT                                                          07720000
*                                                                       07740000
* CHECK FOR OVERFLOW, COMPLETED WRITES AND COMPLETED READS              07760000
*                                                                       07780000
         SPACE                                                          07800000
SISSAE3  TM    CN2+4,X'40'              IS THIS AN OVERFLOW RD          07820000
         BZ    SISSAE31                 NO                              07840000
         OI    DCBEXCD2,X'10'           YES,INDICATE TO USER            07860000
SISSAE31 TM    W1OSBIT1,X'01'          IS IOBO COMPLETE BIT ON          07880000
         BZ    SISSAG3                  NO, EITHER STILL IN PROGRESS    07900000
*                                       OR TAKEN CARE OF ALREADY        07920000
*                                       YES                             07940000
         TM    W1OSBIT2,X'80'           ANY UNWRITEABLE RCDS            07960000
         BO    SISSAG3                  YES, LEAVE THEM FOR NEXT GET    07980000
SISSAF3  LA    R3,W1FR1ST               NO, MOVE BUFFERS FROM           08000000
         LA    R4,W1WR1ST               WRITE Q TO FREE Q               08020000
         LH    R5,W1WRITEC                                              08040000
         L     R10,CTSD(R15)            GO TO QUEUE ROUTINE             08060000
         AR    R10,R15                                                  08080000
         BALR  R9,R10                                                   08100000
         SPACE 2                                                        08110002
         NIL   W1OSBIT1,ONES-IOBOC,     SET OFF IOB-O COMPLETE  YM03876X08120002
               REF=W1OSBIT1,WREGS=(R9,R10,R11)   BIT            YM03876 08130002
         SPACE 2                                                        08132002
SISSAG3  TM    W1OSBIT1,X'02'           IS IOB-I COMPLETE BIT ON        08140000
         BO    SISSAH3                  YES, FULL BUFFERS ON READ Q     08160000
         TM    W1OSBIT2,X'04'           NO, WAS LAST TRY AT SCHEDULING  08180000
*                                       UNSUCCUSSFUL BECAUSE OF LACK    08200000
*                                       OF BUFFERS                      08220000
         BO    SISSAK3                  YES TRY AGAIN                   08240000
         B     SISSAK4                  NO                              08260000
SISSAH3  LA    R3,W1US1ST               MOVE BUFFERS FROM               08280000
         LA    R4,W1RD1ST               READ Q TO USER Q                08300000
         LH    R5,W1READC                                               08320000
         L     R10,CTSD(0,R15)                                          08340000
         AR    R10,R15                                                  08360000
         BALR  R9,R10                   GO TO QUEUE ROUTINE             08380000
         SPACE 2                                                        08390002
         NIL   W1OSBIT1,ONES-IOBIC,     SET OFF COMPLETE IOBI   YM03876X08400002
               REF=W1OSBIT1,WREGS=(R9,R10,R11)   INDICATOR      YM03876 08410002
         SPACE 2                                                        08412002
SISSAK3  L     R11,CTSB(0,R15)          SCHEDULE                        08420000
         AR    R11,R15                                                  08440000
         BALR  R9,R11                                                   08460000
SISSAK4  L     R0,W1TEMPSA             FORMER CONTENTS OR KEY ADDR      08480000
         L     R1,W1REGSAV             DCB OR BUFFER ADDR               08500000
         LM    R2,R12,28(R13)                                           08520000
GETOUT   BR    R14                      RETURN TO USER                  08540000
         SPACE                                                          08560000
         DS    0F                                                       08580000
*                                  ***** CONSTANTS *****                08600000
SISSACN2 DC    X'10000000'                                              08620000
SISSACN1 DC    H'256'                                                   08640000
         SPACE 1                                                        08660002
SISSAD43 MVC   0(1,R7),0(R8)            USED BY EXECUTE INST TO MOVE    08680000
*                                       DATA TO USERS AREA              08700000
         EJECT                                                          08720000
*                                       ***************                 08740000
*                                       *             *                 08760000
*                                       * PUTX MACRO  *                 08780000
*                                       *             *                 08800000
*                                       ***************                 08820000
         SPACE 5                                                        08840000
SISSAH1  STM   R2,R12,28(R13)           PUTX ENTRY POINT, SAVE REGS     08860000
         TM    DCBMACRF+1,X'44'         WAS PUTX SPECIFIED        15407 08866016
         BZ    NOPUTX                   NO--TAKE SYNAD,IF ANY     15407 08872016
         L     R2,DCBWKPT1                                              08880000
         CLI   W1USERC+1,X'00'          IS A BUFFER ON USER QUEUE 7M265 08885017
         BE    PUTXOUT                  NO--EXIT, PREVIOUS GET    7M265 08890017
*                                       RESULTED IN SYNAD ENTRY   7M265 08895017
         L     R3,W1US1ST               SET R3 TO CURRENT BUFFER CP     08900000
         OI    CN2+4,X'80'              SET PUTX FLAG                   08920000
PUTXOUT  EQU   *                                                  7M265 08930017
         LM    R2,R12,28(R13)          RESTORE REGS                     08940000
         BR    R14                      RETURN TO USER            7M265 08950017
NOPUTX   L     R2,PUTXCON               GET ERROR RTN OFFSET      15407 08963016
         LA    R15,SISCTBS              SET FOREIGN BASE          15407 08966016
         AR    R2,R15                                             15407 08969016
         BR    R2                       BRANCH TO ERROR EXIT      15407 08972016
PUTXCON  DC    A(SISBSB1-SISCTBS)       OFFSET TO ERROR RTN       15407 08975016
         EJECT                                                          08980000
SISCTRE  EQU   *                                                        09000000
*                                     * *************                   09020000
*                                     *             *                   09040000
*                                     * RELSE MACRO *                   09060000
*                                     *             *                   09080000
*                                     ***************                   09100000
         SPACE 3                                                        09120000
SISREA2  STM   R2,R12,28(R13)           SAVE REGS  2-12 IN R13          09140000
         L     R2,DCBWKPT1              SET R2 WITH WKPT1 ADDRESS       09160000
         XC    DCBEXCD1(2),DCBEXCD1    SET EXCD'S TO ZERO               09180000
SISREA3  TM    W1OSBIT2,X'80'           WRITE Q ERROR                   09200000
         BZ    SISREB3                  BRANCH IF NO                    09220000
SISREA4  L     R11,CTSGE(0,R15)         YES, GO TO EINFO TO TELL USER   09240000
         AR    R11,R15                                                  09260000
         BALR  R9,R11                                                   09280000
SISREB3  TM    W1OSBIT2,X'02'           IS RELSE BIT ON                 09300000
*                                       (ON IF NO GET FOLLOWING A SETL  09320000
*                                         OR LAST RELSE)                09340000
         BO    SISREC2                  YES, TAKE NO ACTION             09360000
         SPACE 2                                                        09370002
         OIL   W1OSBIT2,RELSE,          SET RELEASE BIT ON      YM03876X09380002
               REF=W1OSBIT1,WREGS=(R6,R7,R9)                    YM03876 09390002
         SPACE 2                                                        09392002
         L     R6,W1CBF                 IS CURRENT RCD LAST IN BUFFER   09400000
         AH    R6,W1CURLEN                                              09420000
         L     R7,W1EOB                                                 09440000
         CR    R7,R6                                                    09460000
         BL    SISREC2                  YES, TAKE NO ACTION             09480000
*                                       NO                              09500000
SISREB2  L     R12,CTSE(0,R15)         GO TO EOB SUBROUTINE             09520000
         AR    R12,R15                  TO BYPASS REMAINING RCDS IN BLK 09540000
         BALR  R9,R12                                                   09560000
         L     R3,W1CBF                 RESET CBF SO THAT SUBSEQUENT    09580000
         SH    R3,W1CURLEN              GET WILL RETURN 1ST RCD IN      09600000
         ST    R3,W1CBF                 BLOCK TO USER                   09620000
SISREC2  LM    R2,R12,28(R13)           RESTORE REGISTERS               09640000
SISRED2  BR    R14                      RETURN TO USER                  09660000
         EJECT                                                          09680000
*                                     ****************                  09700000
*                                     *              *                  09720000
*                                     * SETL B MACRO *                  09740000
*                                     *              *                  09760000
*                                     ****************                  09780000
         SPACE                                                          09800000
         SPACE                                                          09820000
         USING *,R15                                                    09840000
SISCTBS  B     SISBSA2                                                  09860000
         SPACE 2                                                        09880000
*                                  ***** CONSTANTS *****                09900000
EMPTYCON DC    F'0'                                                     09920000
ONECON   DC    F'1'                                                     09940000
         SPACE 3                                                        09980000
SISBSA2  STM   R2,R12,28(R13)           SAVE REGS. 2-12                 10000000
         L     R2,DCBWKPT1              LOAD R2 WITH WORK AREA ADDRESS  10020000
         ST    R0,W1REGSAV              SAVE TYPE OF SETL               10040000
         XC    DCBEXCD1(2),DCBEXCD1    SET EXCD'S TO ZERO               10060000
         TM    W1DCBFA,X'80'           TEST FOR DISP=SHR         A35340 10060820
         BZ    CNTINU                  BR IF NOT TO CONTINUE RTN A35340 10061620
         SVC   54                      IF SHR, ISSUE SVC 54 TO   A35340 10062420
*                                       REFRESH                  A35340 10063220
*                                      DCB FIELDS                       10064020
CNTINU   EQU   *                                                 A35340 10064820
         CLC   DCBNREC(4),EMPTYCON      CHECK FOR NULL DATA SET  A27355 10066019
         BE    SISBSH4                  BRANCH ON NULL           A27355 10072019
SISBSA3  TM    W1ECBO,X'40'             IS WRITE IN PROGRESS            10080000
         BZ    SISBSA4                  YES                             10100000
*                                       NO                              10120000
SISBSB3  CLI   W1WRITEC+1,X'00'        WRITE Q EMPTY                    10140000
         BNE   SISBSB4                  NO                              10160000
SISBSB2  TM    W1OSBIT1,X'80'           TEST SCAN MODE INDICATOR        10180000
         BZ    SISBSC2                  OFF,NOT IN SCAN MODE            10200000
*                                       ALREADY ON                      10220000
SISBSB1  OI    DCBEXCD1,X'10'           SET ON INVAL REQUEST BIT        10240000
         TM    DCBSYNAD+3,X'01'         WAS A SYNAD ADDRESS SPECIFIED   10260000
         BO    SISBSF1                  NO                              10280000
SISBSC1  L     R15,DCBSYNAD             LOAD USER'S SYNAD ADDR. TO R15  10300000
         LA    R0,W1IOBI                LOAD IOB ADDR          @ZA07607 10310003
SISBSD1  LM    R2,R12,28(R13)           RESTORE REGS 2-12               10320000
SISBSE1  BR    R15                      TAKE SYNAD EXIT                 10340000
         SPACE 2                                                        10360000
*                                       GIVE 031 ABEND, NO       Y02072 10380002
SISBSF1  ABEND X'031',DUMP,,SYSTEM      SYNAD PROVIDED           Y02072 10390002
         SPACE 2                                                        10420000
*  SET UP CHANNEL PROGRAMS                                              10440000
         SPACE 2                                                        10460000
SISBSC2  EQU   *                                                        10480000
         L     R3,W1FR1ST               GET FIRST CP1 ON FREE Q         10500000
         LA    R8,8                     SET UP FOR                      10520000
         SR    R9,R9                    CP 22B                          10540000
         TM    DCBRECFM,X'10'           BLOCKED RECORDS                 10560000
         BO    SISBSD2                  YES, INITIALIZE CP22B IN CASE   10580000
*                                       A PREVIOUS OPERATION HAS TAKEN  10600000
*                                       PLACE                           10620000
SISBSC3  TM    W1REGSAV,X'08'           UNBLOCKED KEY AND DATA (22A)    10640000
         BO    SISBSD2                  DATA ONLY REQUESTED             10660000
         SPACE                                                          10680000
*                        SETL OF KEY AND DATA TYPE HAS BEEN REQUESTED   10700000
*                        IF BUFFER SIZE IS LARGE ENOUGH TO ALLOW FOR    10720000
*                        THIS TYPE, OPEN SETS ON  OSBIT3, BYTE 0        10740000
         SPACE                                                          10760000
         LA    R8,14                   CHAN PROGRAMS                    10780000
         LA    R9,32                   WILL BE CP22A                    10800000
         TM    W1OSBIT3,X'80'           IS THERE ROOM FOR KEY AND DATA  10820000
         BZ    SISBSB1                  NO                              10840000
         BO    SISBSD2B                                                 10860000
         SPACE 2                                                        10880000
*              INITIALIZE ALL CN3 ADDR FOR CP22B                        10900000
SISBSD2  LA    R7,CN4                                                   10920000
SISBSD2A ST    R7,CN3                                                   10940000
         STC   R8,CN3                  STORE OP CODE                    10960000
         STC   R9,CN2+4                SET FLAG BIT INDICATORS          10980000
         CLC   CN5+1(3),EMPTYCON        LAST CP ON QUEUE                11000000
         BE    SISBSE3                  YES                             11020000
         L     R3,CN5                   NO, GET NEXT CP ON Q            11040000
         TM    DCBRECFM,X'10'           BLOCKED RECORDS                 11060000
         BO    SISBSD2                  YES, CP 22B                     11080000
         TM    W1REGSAV,X'08'          DATA ONLY TO BE READ             11100000
         BO    SISBSD2                 YES                              11120000
SISBSD2B L     R7,CN7+4                CN3 ADDR FOR CP22A               11140000
         B     SISBSD2A                                                 11160000
         SPACE                                                          11180000
         SPACE                                                          11200000
* FIND DISK ADDRESS OF START OF DATA SET                                11220000
         SPACE                                                          11240000
SISBSE3  L     R8,DCBDEBAD              LOAD R8 WITH DEB ADDRESS        11260000
         MVI   W1LPDR,X'01'            M=1                              11280000
         MVC   W1LPDR+K3(L4),DEBSTRCC+K16 CCHH FROM DEB TO LPDR  S20201 11300020
         OC    W1LPDR+6(1),DCBFIRSH+1   PUT FIRST DATA TRK INTO LPDR    11320000
SISBSF3  IC    R4,DCBFIRSH+2            R OF FIRSH, ONE IS SUBTRACTED   11340000
         BCTR  R4,0                    BECAUSE SCHEDULE ADDS 1 TO R OF  11360000
*                                       LPDR TO GET RECORD TO BE READ   11380000
         STC   R4,W1LR                  STORE'NEW' R IN R OF LPDR       11400000
SISBSG3  OI    W1OSBIT1,X'90'    SET ON SCAN AND READ TRK INDEX BITS    11420000
SISBSG1  NI    W1OSBIT1,X'DF'           SET OVERFLOW MODE INDIC OFF     11440000
         OI    W1OSBIT2,X'20'           SET CYLINDER INDICATOR ON       11460000
         MVC   W1WCNXDM(4),W1LPDR+3    MOVE CCHH FOR READING TRK IX     11480000
         OC    W1WCNXDM+3(1),DCBFIRSH+3 REDUCE TO A                     11500000
         XC    W1WCNXDM+3(1),DCBFIRSH+3     CYL BOUNDRY                 11520000
         MVI   W1WCNXDM+4,X'01'        R=1                              11540000
         IC    R12,W1ICNOT              SAVE ICNOT                      11560000
         MVI   W1ICNOT,X'01'            SET TO 1 TO FILL 1 BUFFER       11580000
         CLI   DCBFIRSH+2,X'01'         IS THIS A SHARED TRACK          11600000
         BE    SISBSH1                  NO                              11620000
         OI    W1OSBIT2,X'10'           INDICATE SHARED TRACK           11640000
         SPACE 2                                                        11660000
*  READ 1ST RECORD AND TRACK INDEX ENTRIES                              11680000
         SPACE 2                                                        11700000
SISBSH1  L     R11,DCBDEBAD             DEB ADDRESS              S21045 11705021
         USING SISDEB,R11                                        S21045 11710021
         L     R11,DEBEXPTR             EXTENSION ADDRESS        S21045 11715021
         USING DEBEXT,R11                                        S21045 11720021
         L     R11,DEBGET               LOAD GET RTN ADDR        S21045 11725021
         DROP  R11                                               S21045 11730021
         A     R11,CTSB(R11)                                            11740000
         BALR  R9,R11                   GO TO SCHEDULE ROUTINE          11760000
         STC   R12,W1ICNOT              REPLACE ICNOT                   11780000
         TM    W1ECBI,X'40'             IS A WAIT NECESSARY             11800000
         BO    SISBSJ2                  NO                              11820000
SISBSJ1  LR    R10,R1                   YES, WAIT FOR READ TO COMPLETE  11840000
         LA    R1,W1ECBI                                                11860000
         LR    R3,R15                   SAVE R15                        11880000
         WAIT  ECB=(1)                                                  11900000
         LR    R15,R3                   RESTORE R15                     11920000
         LR    R1,R10                   RESTORE R1                      11940000
         SPACE 3                                                        11960000
SISBSJ2  MVI   W1EOB,X'00'              ZERO HIGH ORDER W1EOB           11980000
         MVC   W1CBF,W1EOB              TO FORCE ENTRY TO EOB ROUTINE   12000000
SISBSH3  TM    W1OSBIT2,X'08'           WAS SETL B ENTERED FROM GET     12020000
         BO    SISBSH3A                 YES, PREPARE TO RETURN TO GET   12040000
*                                       NO, FROM USER                   12060000
SISBSH4  OI    W1OSBIT2,X'02'           SET ON RELSE BIT                12080000
         LM    R2,R12,28(R13)           RESTORE REGS 2-12               12100000
SISBSH5  BR    R14                      BRANCH TO USER                  12120000
         SPACE 3                                                        12140000
*  WRITING FROM LAST SCAN NOT COMPLETED                                 12160000
         SPACE                                                          12180000
SISBSA4  LR    R6,R1                    SAVE R1                         12200000
         LA    R1,W1ECBO                SET R1 WITH ECBO ADDRESS        12220000
         LR    R3,R15                   SAVE R15                        12240000
         WAIT  ECB=(1)                  WAIT FOR LAST WRITE             12260000
         LR    R15,R3                   RESTORE R15                     12280000
         LR    R1,R6                                                    12300000
SISBSB4  TM    W1OSBIT2,X'80'           ANY WRITE ERRORS                12320000
         BO    SISBSB5                  YES                             12340000
SISBSC4  LA    R3,W1FR1ST               NO,MOVE ENTIRE WRITE Q          12360000
         LA    R4,W1WR1ST                TO FREE Q                      12380000
         LH    R5,W1WRITEC                                              12400000
         L     R10,DCBDEBAD             DEB ADDRESS              S21045 12405021
         USING SISDEB,R10                                        S21045 12410021
         L     R10,DEBEXPTR             EXTENSION ADDRESS        S21045 12415021
         USING DEBEXT,R10                                        S21045 12420021
         L     R10,DEBGET               LOAD GET RTN ADDR        S21045 12425021
         DROP  R10                                               S21045 12430021
         A     R10,CTSD(R10)            GO TO QUEUE ROUTINE             12440000
         BALR  R9,R10                                                   12460000
         B     SISBSB2                                                  12480000
SISBSB5  L     R11,DCBDEBAD             DEB ADDRESS              S21045 12485021
         USING SISDEB,R11                                        S21045 12490021
         L     R11,DEBEXPTR             EXTENSION ADDRESS        S21045 12495021
         USING DEBEXT,R11                                        S21045 12500021
         L     R11,DEBGET               LOAD GET RTN ADDR        S21045 12505021
         DROP  R11                                               S21045 12510021
         A     R11,CTSGE(R11)                                           12520000
         BALR  R9,R11                   INFORM USER OF WRITE ERRORS     12540000
         B     SISBSB2                                                  12560000
         SPACE 2                                                        12580000
*  RETURN TO GET                                                        12600000
         SPACE                                                          12620000
SISBSH3A NI    W1OSBIT2,X'F7'           SET OFF GET RETURN INDICATOR    12640000
         L     R15,DCBDEBAD             DEB ADDRESS              S21045 12645021
         USING SISDEB,R15                                        S21045 12650021
         L     R15,DEBEXPTR             EXTENSION ADDRESS        S21045 12655021
         USING DEBEXT,R15                                        S21045 12660021
         L     R15,DEBGET               LOAD GET RTN ADDR        S21045 12665021
         DROP  R15                                               S21045 12670021
         L     R0,W1TEMPSA              RESTORE R0 FOR GET              12680000
         LM    R2,R12,28(R13)           RESTORE REGS. 2-12              12700000
         BR    R15                      RETURN TO GET MODULE            12720000
         EJECT                                                          12740000
*                                     *****************                 12760000
*                                     *               *                 12780000
*                                     * ESETL MACRO   *                 12800000
*                                     *               *                 12820000
*                                     *****************                 12840000
         USING *,R15                                                    12860000
SISCTES  EQU  *                                                         12880000
*                                                                       12900000
*                                                                       12920000
         SPACE                                                          12940000
SISESA2  STM   R2,R12,28(R13)           SAVE REGS. 2 TO 12 IN R13       12960000
         L     R2,DCBWKPT1(0)           LOAD R2 WITH WORKAREA ADDRESS   12980000
SISESA3  TM    W1OSBIT2,X'80'           ANY WRITE Q ERRORS              13000000
         BZ    SISESB2                  NO                              13020000
*                                       YES                             13040000
SISESA4  L     R11,DCBDEBAD             DEB ADDRESS              S21045 13045021
         USING SISDEB,R11                                        S21045 13050021
         L     R11,DEBEXPTR             EXTENSION ADDRESS        S21045 13055021
         USING DEBEXT,R11                                        S21045 13060021
         L     R11,DEBGET               LOAD EINFO RTN ADDR      S21045 13065021
         DROP  R11                                               S21045 13070021
         A     R11,CTSGE(R11)                                           13080000
         BALR  R9,R11                   GO TO EINFO SUBROUTINE          13100000
SISESB2  L     R10,DCBDEBAD             DEB ADDRESS              S21045 13105021
         USING SISDEB,R10                                        S21045 13110021
         L     R10,DEBEXPTR             EXTENSION ADDRESS        S21045 13115021
         USING DEBEXT,R10                                        S21045 13120021
         L     R10,DEBGET               LOAD QUEUE RTN ADDR      S21045 13125021
         DROP  R10                                               S21045 13130021
         A     R10,CTSD(R10)                                            13140000
         CLI   W1USERC+1,X'00'         IS USER Q EMPTY                  13160000
         BE    SISESD2                  YES                             13180000
         L     R3,W1US1ST               NO, POINT TO 1ST BUFFER ON USER 13200000
         TM    CN2+4,X'80'              WAS THIS BUFFER PUTXED          13220000
         BZ    SISESC3                  NO                              13240000
SISESB3  LA    R3,W1PX1ST               YES, MOVE ONE BUFFER            13260000
         LA    R4,W1US1ST               FROM USER QUEUE                 13280000
         LA    R5,1                    TO PUTX Q                        13300000
         BALR  R9,R10                   GO TO QUEUE RTN                 13320000
SISESC3  LA    R3,W1FR1ST                                               13340000
         LA    R4,W1US1ST               MOVE USER QUEUE BUFFERS         13360000
         LH    R5,W1USERC               TO THE FREE QUEUE               13380000
         BALR  R9,R10                   GO TO QUEUE RTN                 13400000
SISESD2  CLI   W1READC+1,X'00'         IS C OF READ Q EMPTY             13420000
         BNE   SISESD3                  NO                              13440000
         CLI   W1READR+1,X'00'         IS R OF READ Q EMPTY             13460000
         BE    SISESE2                  YES, THEN READ Q IS EMPTY       13480000
SISESD3  TM    W1ECBI,X'40'             IS A READ IN PROGRESS           13500000
         BO    SISESE4                  NO                              13520000
SISESD4  LR    R6,R1                    YES,WAIT FOR IT                 13540000
         LA    R1,W1ECBI                                                13560000
         LR    R3,R15                   SAVE R15 AND WAIT TO COMPLETE   13580000
         WAIT  ECB=(1)                                                  13600000
         LR    R15,R3                   RESTORE R15                     13620000
         LR    R1,R6                    RESTORE R1                      13640000
SISESE4  LA    R3,W1FR1ST               MOVE READ Q BUFFERS             13660000
         LA    R4,W1RD1ST               TO THE  FREE Q                  13680000
         LH    R5,W1READC                                               13700000
         AH    R5,W1READR               TO GET ALL BUFS OFF READ Q      13720000
         STH   R5,W1READC                                               13740000
         BALR  R9,R10                   GO TO QUEUE RTN                 13760000
         MVC   W1READR,W1READC          ZERO READ R FOR NEXT SCAN       13780000
SISESE2  CLI   W1PUTXC+1,X'00'         IS PUTX Q EMPTY                  13800000
         BNE   SISESF2                  NO, SO A WRITE IS NECESSARY     13820000
SISESE1A EQU   *                                                OZ05933 13822003
         TM    W1ECBO,X'40'             IS WRITE IN PROCESS?    SA66297 13830002
         BO    SISESE1                  NO, RESET DCBWA FIELDS  SA66297 13832002
         BAL   R11,SISESF3              YES, WAIT ON COMPLETION SA66297 13834002
*                                       RESET WORKAREA FIELDS           13840002
SISESE1  SR    R9,R9                    SET OFF ALL OVERALL     YM03876 13860002
         STC   R9,W1OSBIT1              STATUS EXCEPT WRITE     YM03876 13880002
         SPACE 2                                                        13880402
         NIL   W1OSBIT2,UNWRITE+WAPBIT, CONDITIONS              YM03876X13882002
               REF=W1OSBIT1,WREGS=(R9,R10,R11)                  YM03876 13884002
         SPACE 2                                                        13886002
         XC    W1LPDR(8),W1LPDR         ZERO OUT FOR LATER GETS   10384 13890000
         XC    W1WCOUNT(36),W1WCOUNT    SET TRK IX AREA TO ZERO   10384 13900000
         TM    DCBEXCD2,X'20'           DID CONTROL COME FROM CLOSE     13920000
         BO    SISESG1A                 YES                             13940000
*                                       NO                              13960000
SISESF1  LM    R2,R12,28(R13)           RESET REGS. R2-R12 FROM R13     13980000
SISESG1  BR    R14                      RETURN TO USER                  14000000
         SPACE 2                                                        14010002
SISESG1A OIL   W1OSBIT3,CLSESETL,       INDICATE THAT CLOSE     YM03876X14020002
               REF=W1OSBIT1,WREGS=(R9,R10,R11)  WENT TO ESETL   YM03876 14030002
         SPACE 2                                                        14032002
         LM    R2,R12,28(R13)                                           14040000
         BR    R14                      RETURN TO CLOSE                 14060000
*   IF CLOSE WAS IN PROCESS THEN R14 WAS SET FOR RETURN TO CLOSE        14080000
         SPACE 3                                                        14100000
*  PUTX Q NOT EMPTY, WRITE MUST BE INITIATED                            14120000
         SPACE 2                                                        14140000
SISESF2  EQU   *                                                        14150002
         LA    R11,SISESH2              SETUP ROUTINE BRANCH    SA66297 14152002
         TM    W1ECBO,X'40'             ARE WRITES IN PROCESS           14160002
         BO    SISESG2                  NO                              14180000
*                                       YES                             14200000
SISESF3  LR    R6,R1                    SAVE R1 AND WAIT FOR            14220000
         LA    R1,W1ECBO                WRITES TO COMPLETE              14240000
         LR    R3,R15                   SAVE R15                        14260000
         WAIT  ECB=(1)                                                  14280000
         LR    R15,R3                   RESTORE R15                     14300000
         LR    R1,R6                    RESTORE R1                      14320000
SISESG3  TM    W1OSBIT2,X'80'           WERE THERE WRITE ERRORS         14340000
         BO    SISESA4                  YES,GO TO EINFO                 14360000
*                                       NO                              14380000
         LA    R3,W1FR1ST               MOVE WRITE                      14400000
         LA    R4,W1WR1ST               QUEUE BUFFERS                   14420000
         LH    R5,W1WRITEC              TO FREE QUEUE                   14440000
         BALR  R9,R10                   GO TO QUEUE RTN                 14460000
         BR    R11                      AND BRANCH              SA66297 14480002
SISESG2  CLI   W1WRITEC+1,X'00'        IS WRITE Q EMPTY                 14500000
         BNE   SISESG3                  NO                              14520000
SISESH2  SR    R5,R5                     CLEAR REG                10386 14522014
         L     R11,W1PX1ST               GET 1ST CP POINTER       10386 14524014
SISESH2A LA    R5,1(R5)                  INCRE BUFFER COUNT       10386 14526014
         LA    R3,40(R11)                POINT TO MBBCC           10386 14528014
         L     R11,32(R11)          GET NEXT CP ADDR. (IF ANY)    10386 14530014
         LA    R11,0(R11)                CLEAR HI ORDER BYTE      10386 14532014
         LTR   R11,R11                   ANY MORE CHANNEL PROGS   10386 14534014
         BZ    SISESH2B                  NO BRANCH                10386 14536014
         LA    R4,40(R11)                POINT TO NEXT MBBCC      10386 14538014
         CLC   0(7,R3),0(R4)            ARE TWO MBBCCHH'S EQUAL   22662 14540018
         BE    SISESH2A                  YES, GO COMP NEXT MBBCC  10386 14542014
SISESH2B LA    R3,W1WR1ST              NO, GO SET UP AND DO EXCP  10386 14544014
*                                   ON THE BUFFERS ON SAME CYL    10386 14546014
*   LIMIT NUMBER OF BUFFERS WRITTEN IN ORDER TO PREVENT CHANNEL         14548001
*   PROGRAMS LONGER THAN 224 CCW'S.                                     14549001
         LA    R4,THIRTY                LIMIT WRITE BUFFERS             14550001
         CR    R4,R5                    TOO MANY WRITE BUFFERS          14551001
         BH    AOS000                   NO - NUMBER O.K.                14552001
         LR    R5,R4                    LIMIT NUMBER OF BUFFERS         14553001
AOS000   EQU   *                        *                               14554001
         LA    R4,W1PX1ST               MOVE PUTX QUEUE                 14560000
         BALR  R9,R10                   GO TO QUEUE RTN                 14600000
SISESJ2  L     R11,DCBDEBAD             DEB ADDRES               S21045 14605021
         USING SISDEB,R11                                        S21045 14610021
         L     R11,DEBEXPTR             EXTENSION ADDRESS        S21045 14615021
         USING DEBEXT,R11                                        S21045 14620021
         L     R11,DEBGET               GET RTN ADDR             S21045 14625021
         DROP  R11                                               S21045 14630021
         A     R11,CTSF(R11)            GET SETC4 ADDR. AND PREPARE     14640000
         BALR  R9,R11                   WRITE QUEUE FOR OUTPUT          14660000
*                                                                       14680000
*                                                                       14700000
*                                                                       14720000
SISESK1  MVI   W1OEXTEN+1,X'08'        SET APP CODE FOR WRITING         14740000
         SR    R6,R6                   CLEAR WORK AREA                  14760000
         IC    R6,W1ODAD               SET M FROM IOB                   14780000
         SLL   R6,4                    M X 16                           14800000
         L     R7,DCBDEBAD             GET DEB ADDR                     14820000
         LA    R6,32(R6,R7)            R6 POINT TO EXTENT OF 7          14840000
         MVC   W1ODAD+1(2),4(R6)       MOVE BB FROM DEB TO IOB          14860000
         LR    R6,R1                    SAVE R1                         14880000
         LR    R7,R15                   SAVE R15                        14900000
         EXCP  W1IOBO                                                   14920000
         WAIT  ECB=W1ECBO                                         10386 14980014
         LR    R1,R6                     RESTORE REGISTE9S        10386 14984014
         LR    R15,R7                                             10386 14988014
         CLI   W1PUTXC+1,X'00'           PUTX Q EMPTY            A48519 14990000
         BE    SISESE1A                  YES DON'T WAIT         OZ05933 14990403
         LA    R11,SISESH2              SET RETURN ADDRESS      YM05971 14990802
         B     SISESG3               GO GET MORE PUTX BUFFERS     10386 14992014
         EJECT                                                          15000000
*                                       ***************                 15020000
*                                       *             *                 15040000
*                                       * SCHEDULE    *                 15060000
*                                       *             *                 15080000
*                                       ***************                 15100000
         SPACE 2                                                        15120002
         USING *,R11                    R11 SET AS BASE BY CALLING RTN  15140000
SISCTSB  TM    W1OSBIT1,X'40'           ARE WE AT END OF DATA SET       15160000
         BCR   7,R9                    YES, NO MORE SCHEDULING          15180000
SISSBB1  LH    R6,W1FREEC               C OF FREE Q                     15200000
         AH    R6,W1READR               R OF READ Q                     15220000
*                                       R6 = TOTAL AVAILABLE BUFFERS    15240000
         ST    R9,W1REGSV2              SAVE EXIT ADDR                  15260000
         SPACE 2                                                        15270002
         OIL   W1OSBIT2,SCHED,          SET ON SCHEDULING BIT   YM03876X15280002
               REF=W1OSBIT1,WREGS=(R5,R9,R10)                   YM03876 15290002
         SPACE 2                                                        15292002
SISSBA2  TM    W1OSBIT1,X'20'           OVERFLOW INDICATOR              15300000
         BO    SISSBA3                  ON, OVERFLOW TO BE READ         15320000
*                                       OFF, READ PRIME DATA            15340000
SISSBB2  TM    W1OSBIT2,X'20'           CYLINDER INDICATOR              15360000
         BO    SISSBC2                  ON, NEXT RCD ON SAME CYLINDER   15380000
*                                       OFF, GO TO NEW CYLINDER         15400000
         SPACE 2                                                        15420000
*        CHANGE TO NEW CYLINDER                                         15440000
*                                                                       15460000
SISSBB3  CH    R6,SISSBCN4           IS THERE AT LEAST ONE BUFFER       15480000
*                                       (FOR THE CASE OF SHARED TRACK)  15500000
         BL    SISSBD5                  NO, EXIT WITHOUT SCHEDULING     15520000
         SPACE 2                                                        15530002
         OIL   W1OSBIT2,CYLIND,         SET ON CYLINDER         YM03876X15540002
               REF=W1OSBIT1,WREGS=(R5,R9,R10)  INDICATOR        YM03876 15550002
         SPACE 2                                                        15552002
         MVI   W1WDNXDM+8,X'00'        RESET DUMMY IND                  15560000
         SR    R7,R7                                                    15580000
         L     R8,DCBDEBAD             GET DEB ADDR                     15600000
         SR    R5,R5                                                    15620000
         SR    R6,R6                                                    15640000
         IC    R5,W1LMBBCC             PICK UP M FROM LPDR              15660000
         SLL R5,4                      M X 16                           15680000
         LA    R5,32(R8,R5)            R5 POINTS TO EXTENT OF M         15700000
         OC    W1LPDR+6(1),DCBFIRSH+3  USE MASK TO MAKE TRK MAX VALUE   15720000
         CLC   W1LPDR+6(1),13(R5)      LAST TRK OF CYL OR EXTENT        15740000
         BL    SISSBB34                NO, GO INCREM TRK NO             15760000
         CLC   W1LPDR+3(3),10(R5)      LAST TRK OF EXTENT               15780000
         BNE   SISSBB33                NO, GO TO INCREM CCH             15800000
         IC    R6,W1LPDR               GO TO NEXT EXTENT                15820000
         LA    R6,1(R6)                M  +  1                          15840000
         STC   R6,W1LPDR               STORE BACK INTO LPDR             15860000
         CLC   W1LPDR(1),DEBNPEE       ANY MORE PRIME EXTENTS           15880000
         BH    SISSBD51                NO, SET OFF SCHEDULE BIT         15900000
         B     SISSBB31                                                 15920000
*                                                                       15940000
SISSBB33 EQU   *                        *                               15943002
         MVC   W1WCNXDM(L2),W1LPDR+K3   MOVE CC TO HWORD BDY     S20201 15952020
         LH    R6,W1WCNXDM              GET CYL VALUE            S20201 15955020
         LA    R6,K1(R0,R6)             ADD ONE TO IT            S20201 15958020
         STH   R6,W1WCNXDM              STORE IT BACK            S20201 15961020
         MVC   W1LPDR+K3(L2),W1WCNXDM   MOVE IT BACK TO FIELD    S20201 15964020
SISSBB34 IC    R6,W1LPDR+6             INCREMENT TRK NO                 16260000
         LA    R6,1(R6)                (MAY BE INCREMENTING FROM        16280000
         STC   R6,W1LPDR+6             MINUS 1 TO ZERO)                 16300000
SISSBB32 MVC   W1WCNXDM(4),W1LPDR+3    MOVE CCHH INTO WCNXDM            16320000
         OC    W1LPDR+6(1),DCBFIRSH+1  MOVE IN FIRSH TRACK              16340000
         IC    R7,DCBFIRSH+2           GET FIRSH R                      16360000
         BCTR  R7,0                    R-1                              16380000
         STC   R7,W1LPDR+7             STORE R INTO LPDR                16400000
         MVI   W1WCNXDM+4,X'01'        R=1                              16420000
         LH    R6,W1FREEC               C OF FREE Q                     16440000
         AH    R6,W1READR               R OF READ Q                     16460000
         SPACE 2                                                        16470002
         OIL   W1OSBIT1,TRKINDX,        SET ON READ TRACK       YM03876X16480002
               REF=W1OSBIT1,WREGS=(R5,R7,R9)  INDEX BIT         YM03876 16482002
         SPACE 2                                                        16490002
         CLI   DCBFIRSH+2,X'01'         IS THIS A SHARED TRACK          16500000
         BE    SISSBC2                  NO                              16520000
         SPACE 2                                                        16530002
         OIL   W1OSBIT2,SHRDTRK,        SET ON SHARED TRACK     YM03876X16540002
               REF=W1OSBIT1,WREGS=(R5,R7,R9)  INDICATOR         YM03876 16542002
         SPACE 2                                                        16550002
         SR    R7,R7                                                    16560000
         IC    R7,DCBHIRSH              PRESET R7                       16580000
         LA    R5,1                    FOR SHARED TRK, USE ONLY 1       16600000
*                                       RCD SINCE TRACK INDEX HAS NOT   16620000
*                                       BEEN READ, AND IF AN OVERFLOW   16640000
*                                       RCD HAS BEEN ADDED TO THE 1ST   16660000
*                                       TRACK, IT COULD BE BYPASSED IF  16680000
*                                       ICNOT IS GREATER THAN THE NUM   16700000
*                                       OF PRIME DATA RCDS ON THE 1ST   16720000
*                                       TRACK.                          16740000
         B     SISSBE5                  TO SET UP TO READ               16760000
         SPACE 3                                                        16780002
*                                                                       16800000
* GET NEW EXTENT                                                        16820000
*                                                                       16840000
SISSBB31 LA    R5,16(0,R5)             ADD 16 FOR NEXT EXTENT           16860000
         MVC   W1LPDR+3(4),6(R5)       MOVE IN NEW CCHH                 16880000
         B     SISSBB32                 GO BACK TO SET HHR'S            16900000
         SPACE 1                                                        16920002
*                                                                       16940000
* DETERMINE WHAT IS TO BE READ                                          16960000
*                                                                       16980000
         SPACE 1                                                        17000002
SISSBC2  SR    R7,R7                    CLEAR R7                        17020000
SISSBD2  IC    R7,DCBHIRPD              HI R OF NON-SHARED PRIME TRACK  17040000
         TM    W1OSBIT2,X'10'           SHARED TRACK IND                17060000
         BZ    SISSBE2                  OFF                             17080000
SISSBD3  IC    R7,DCBHIRSH              ON, SET R7=HI R SHARED TRACK    17100000
SISSBE2  SR    R8,R8                    CLEAR R8                        17120000
         IC    R8,W1LR                  R FROM LPDR (LAST RCD READ)     17140000
         SR    R5,R5                    CLEAR R5                        17160000
         IC    R5,W1ICNOT                                               17180000
         AR    R8,R5                    R8 = R(OF LPDR) + ICNOT         17200000
         CR    R8,R7                R(LPDR) + ICNOT G.E. HI DATA R      17220000
         BL    SISSBE3                  NO, NOW CHECK AVAILABLE BUFFERS 17240000
*                                       YES, LESS THAN N/2 BLKS ON TRK  17260000
SISSBF2  TM    W1WOVFL+8,X'18'          DOES THIS TRACK HAVE OVERFLOW   17280000
         BO    SISSBG2                  YES                             17300000
SISSBF3  TM    W1WDNXDM+8,X'20'         NO, IS THIS LAST TRK OF CYLINDR 17320000
         BO    SISSBG3                  YES                             17340000
*                                   NO, IF BUFFERS AVAILABLE CAN READ   17360000
*                                   END OF THIS TRACK AND PART OF NEXT  17380000
SISSBE3  CR    R6,R5                    ARE FREE BUFS LESS THAN ICNOT   17400000
         BL    SISSBD5                  YES                             17420000
*                                       NO, READ ICNOT BUFFERS          17440000
*                                                                       17460000
SISSBE5  LA    R3,W1RD1ST               MOVE FROM FREE TO READ Q        17480000
         LA    R4,W1FR1ST                                               17500000
         STH   R5,W1CPNUM               SAVE SO AS TO KNOW HOW MANY     17520000
*                                       CHANNEL PROGRAMS TO SET UP      17540000
         STH   R7,W1SAV7                R7 IS DESTROYED BY QUEUE RTN    17560000
         L     R10,DCBDEBAD             DEB ADDRESS              S21045 17565021
         USING SISDEB,R10                                        S21045 17570021
         L     R10,DEBEXPTR             EXTENSION ADDRESS        S21045 17575021
         USING DEBEXT,R10                                        S21045 17580021
         L     R10,DEBGET               LOAD QUEUE RTN ADDR      S21045 17585021
         DROP  R10                                               S21045 17590021
         A     R10,CTSD(R10)                                            17600000
         BALR  R9,R10                   GO TO Q SUBROUTINE              17620000
         SR    R5,R5                    CLEAR TO USE AS COUNTER         17640000
         LH    R7,W1SAV7                R7=HIGH R OF CURRENT TRACK      17660000
         SPACE                                                          17680000
*        CHART SC                                                       17700000
         SPACE 2                                                        17720000
*                                                                       17740000
* SET UP CHANNEL PROGRAMS FOR READING PRIME DATA RECORDS.               17760000
*                                                                       17780000
         SPACE 2                                                        17800000
SISSCA2  L     R3,W1RD1ST               SET BASE FOR CP22 DSECT         17820000
         MVC   W1ICPS+1(3),W1RD1ST+1    INIT IOBI CP POINTER TO 1ST CP  17840000
*                                       ON READ Q                       17860000
SISSCB2  SR    R6,R6                                                    17880000
         IC    R6,W1LR                  R OF LPDR                       17900000
SISSCB21 CR    R6,R7                    AT END OF TRACK                 17920000
         BE    SISSCB3                  YES                             17940000
         LA    R6,1(R6)                NO, ADD 1 TO R OF LPDR           17960000
         STC   R6,W1LR                                                  17980000
         TM    W1OSBIT1,X'10'           IS READ TRK INDEX SWITCH ON     18000000
*                                        (ON FROM SETL B OR NEW CYLIND) 18020000
         BO    SISSCB31                 YES                             18040000
*                                       NO                              18060000
SISSCD2  SR    R8,R8                                                    18064013
         IC    R8,W1LPDR                SETUP BB MOVE INTO CN6          18068013
         SLL   R8,4                                                     18072013
         ST    R8,CN6                   REGS SCARCE SO MUST REUSE       18076013
         L     R8,DCBDEBAD                                              18080013
         LA    R8,32(R8)                                                18084013
         A     R8,CN6                                                   18088013
         MVC   CN6,W1LPDR                                               18092013
         MVC   CN6+1(2),4(R8)                                           18096013
         MVC   CN4+1(3),CN7+1           SET ALL CPS FOR PRIME DATA READ 18100000
         LH    R8,DCBBLKSI              RESET COUNT TO BLOCKSIZE        18120000
         STH   R8,CN4+6                                                 18140000
         MVI   CN4,X'06'                SET CN4 TO READ                 18160000
         NI    CN2+4,X'20'              SET OFF ALL FLAGS BUT D-KD      18180000
         OI    CN1,X'80'               SET ON MT BIT                    18200000
         LA    R5,1(R5)                ADD 1 TO COUNT OF CP'S INIT'ZED  18220000
         CLI   CN3,X'08'               CP22A OR 22B                     18240000
         BE    SISSCE2                  22B                             18260000
         MVI   CN3,X'0E'                22A, SET CN3 FOR READ KD        18280000
SISSCE2  CH    R5,W1CPNUM               ARE WE AT END OF CHAIN          18300000
         BNE   SISSCF2                  NO                              18320000
         NI    CN4+4,X'BF'              YES, SET OFF CC BIT             18340000
         L     R3,W1RD1ST                                               18360000
         NI    CN1,X'7F'               SET OFF MT BIT IN 1ST CP         18380000
         MVC   W1IDAD,CN6               SET IOB + 32 FOR IOS            18400000
         CLC   W1ICPS+1(3),W1RD1ST+1    ARE TRACK INDICES TO BE READ    18420000
         BE    SISSBC5                  NO                              18440000
         MVC   W1IDAD+3(5),W1WCOUNT     YES, SET CCHHR OF IOB+32 TO     18460000
*                                 CCHHR OF NEXT TRACK INDEX RECORD      18480000
         LA    R6,CN6+1                 SET SEEK ADDR IN READ TRACK     18500000
         ST    R6,W1CN14                INDEX CP TO CN1 OF 1ST CP ON    18520000
         MVI   W1CN14,X'1B'             READ Q. REPLACE SEEK COMMAND    18540000
         NI    W1CN8,X'7F'              SET OFF MT BIT                  18560000
         B     SISSBC5                  GO TO EXECUTE EXCP              18580000
         SPACE 2                                                        18600000
SISSCF2  OI    CN4+4,X'40'              SET ON CC BIT                   18620000
         L     R3,CN5                   ADVANCE TO NEXT CP ON READ Q    18640000
         B     SISSCB21                 AND SET IT UP                   18660000
         SPACE 3                                                        18680000
*                                                                       18700000
* TRACK INDEX TO BE READ                                                18720000
*                                                                       18740000
SISSCB3  MVC   W1LPDR(8),W1WDNXDM       MOVE DATA PORTION OF NEXT       18760000
*                                       NORMAL ENTRY IN TRACK INDEX     18780000
*                                       TO LPDR                         18800000
         SPACE 2                                                        18810002
         NIL   W1OSBIT2,ONES-SHRDTRK,   SET OFF SHARED TRACK    YM03876X18820002
               REF=W1OSBIT1,WREGS=(R8,R9,R10)  INDICATOR        YM03876 18830002
         SPACE 2                                                        18832002
         MVI   W1LR,X'01'               SET R OF LPDR TO 1              18840000
         IC    R6,W1LR                  SET R6 TO R OF NEW LPDR         18860000
         SPACE 2                                                        18870002
SISSCB31 NIL   W1OSBIT1,ONES-TRKINDX,   SET OFF READ TRACK      YM03876X18880002
               REF=W1OSBIT1,WREGS=(R8,R9,R10)  INDEX INDICATOR  YM03876 18890002
         SPACE 2                                                        18892002
         LA    R9,W1CP24                PUT CP24 ADDR IN IOBI POINTER   18900000
         ST    R9,W1ICPS                CHAIN IT TO 1ST CP22 ON READ Q  18920000
         MVC   W1CN15+1(3),W1RD1ST+1                                    18940000
         LM    R8,R9,W1WCNXDM           UPDATE COUNT FIELD FOR NEXT     18960000
         STM   R8,R9,W1WCOUNT           INDEX READ                      18980000
         B     SISSCD2                  TO SET UP FOR READING NEW TRK   19000000
         SPACE 2                                                        19020002
*                                                                       19040000
* OVERFLOW AND END OF CYLINDER                                          19060000
*                                                                       19080000
         SPACE 2                                                        19090002
SISSBG2  OIL   W1OSBIT1,OVRFLOW,        SET ON OVERFLOW         YM03876X19100002
               REF=W1OSBIT1,WREGS=(R4,R9,R10)  INDICATOR        YM03876 19110002
         SPACE 2                                                        19112002
SISSBH2  SR    R8,R5                    R8 NOW = R OF LPDR              19120000
         CR    R7,R8                    HAVE WE ALREADY READ THE LAST   19140000
*                                       RECORD ON THIS TRACK            19160000
         BNE   SISSRKSI                                                 19180000
         TM    W1OSBIT1,X'40'           NO, GO FINISH TRACK             19200000
         BC    1,SISSBD5                EOD, EXIT                       19220000
         BC    15,SISSBA2               END OF CYL, GET NEXT CYL        19240000
SISSRKSI LR    R5,R7                                                    19260000
         SR    R5,R8                    R5=NUMBER LEFT ON CURRENT TRACK 19280000
         CR    R6,R5                    ARE THERE ENOUGH BUFFERS        19300000
         BNL   SISSBE5                 YES, READ THE REST               19320000
         SPACE 2                                                        19330002
         NIL   W1OSBIT1,ONES-OVRFLOW,   NO-SET OFF OVRFLOW, NXT YM03876X19340002
               REF=W1OSBIT1,WREGS=(R4,R9,R10)  RCD NOT OVERFLOW YM03876 19360002
         SPACE 2                                                        19370002
SISSBK3  OIL   W1OSBIT2,CYLIND,         SET ON CYL BIT          YM03876X19380002
               REF=W1OSBIT1,WREGS=(R4,R9,R10)                   YM03876 19390002
         SPACE 2                                                        19392002
*                                       SCHEDULE BIT IS ON SO THAT NEXT 19400000
         B     SISSBD5                  GET WILL TRY AGAIN              19420000
*                                                                       19440000
SISSBG3  TM    W1WDNXDM+8,X'10'         IS THIS AN INACTIVE ENTRY       19460000
         BO    SISSBG31                                                 19480000
         SPACE 2                                                        19490002
         NIL   W1OSBIT2,ONES-CYLIND,    SET OFF SAME CYL IND    YM03876X19500002
               REF=W1OSBIT1,WREGS=(R4,R9,R10)                   YM03876 19510002
         SPACE 2                                                        19512002
         B     SISSBH2                  GO TO COMMON PROCESSING         19520000
SISSBG31   CR  R6,R5                    ENOUGH BUFFERS                  19540000
         BL    SISSBD5                  NO                              19560000
         SPACE 2                                                        19570002
         OIL   W1OSBIT1,EOD,            SET ON END OF DATA      YM03876X19580002
               REF=W1OSBIT1,WREGS=(R4,R9,R10)  INDICATOR        YM03876 19590002
         SPACE 2                                                        19592002
         B     SISSBH2                                                  19600000
         SPACE 3                                                        19620002
*                                                                       19640000
* SET CHANNEL PROGRAMS TO READ OVERFLOW RECORDS                         19660000
*                                                                       19680000
SISSBA3  CH    R6,SISSBCN4              ARE THERE AT LEAST 2 FREE BUFS  19700000
         BH    SISSBA4                  YES                             19720000
*                                       NO, TEST                        19740000
         SR    R5,R5                   FOR SPECIAL CASE WHERE ICNOT     19760000
         IC    R5,W1ICNOT               IS 1                            19780000
         CR    R6,R5                                                    19800000
         BL    SISSBK3                  NOT ENOUGH BUFFERS              19820000
SISSBA4  LH    R5,W1FREEC               MOVE ALL FREE Q TO READ Q       19840000
         AH    R5,W1READR               TO INSURE MOVING ALL OF FREE Q  19860000
*                                        RATHER THAN %FREE C<-%READ R<  19880000
         LA    R3,W1RD1ST                                               19900000
         LA    R4,W1FR1ST                                               19920000
         L     R10,DCBDEBAD             DEB ADDRESS              S21045 19925021
         USING SISDEB,R10                                        S21045 19930021
         L     R10,DEBEXPTR             EXTENSION ADDRESS        S21045 19935021
         USING DEBEXT,R10                                        S21045 19940021
         L     R10,DEBGET               LOAD QUEUE RTN ADDR      S21045 19945021
         DROP  R10                                               S21045 19950021
         A     R10,CTSD(R10)                                            19960000
         BALR  R9,R10                                                   19980000
SISSBA5  MVC   W1READR,W1READC          SET READ R = READ C             20000000
         L     R3,W1RD1ST               PUT DISK ADDR OF NEXT OVERFLOW  20020000
*                                       RECORD IN CN6 OF 1ST CP         20040000
SISSBB5  SR    R8,R8                                                    20044013
         IC    R8,W1WOVFL                                               20048013
         SLL   R8,4                                                     20052013
         ST    R8,CN6                   REGS SCARCE SO JUST REUSE       20056013
         L     R8,DCBDEBAD                                              20060013
         LA    R8,32(R8)                                                20064013
         A     R8,CN6                                                   20068013
         MVC   CN6,W1WOVFL                                              20072013
         MVC   CN6+1(2),4(R8)                                           20076013
         NI    CN2+4,X'20'              SET OFF ALL FLAGS BUT D-KD      20080000
         OI    CN2+4,X'40'              SET ON OVERFLOW                 20100000
         NI    CN1,X'7F'                SET OFF MT                      20120000
         NI    CN4+4,X'BF'              SET OFF CC  SINCE OVERFLOW RCDS 20140000
*                                       ARE READ ONE AT A TIME          20160000
         MVC   W1ICPS+1(3),W1RD1ST+1    SET CP POINTER IN IOBI TO 1ST   20180000
*                                       C.P. ON READ Q                  20200000
         MVC   W1IDAD,W1WOVFL           SET IOB+32 FOR IOS              20220000
*                                       SET CHANNEL PROGRAMS FOR        20240000
SISSBB51 L     R8,CN7                   READING OVERFLOW RECORDS        20260000
         SH    R8,SISSBCN1              SET BUFD ADDR TO 10 LESS TO     20280000
         ST    R8,CN4                   ALLOW FOR LINK FIELD            20300000
         LH    R8,DCBLRECL              SET COUNT TO RCD LENGTH + 10    20320000
         AH    R8,SISSBCN1               FOR LINK                       20340000
         STH   R8,CN4+6                                                 20360000
         MVI   CN4,X'06'                SET OP CODE TO READ             20380000
         CLI   CN3,X'08'               CP22A OR 22B                     20400000
         BE    SISSBB52                 22B                             20420000
         MVI   CN3,X'0E'                FOR 22A  TO READ KD ALSO        20440000
SISSBB52 CLC   CN5+1(3),SISSBCN2+1      ARE  WE AT END OF CHAIN         20460000
         BE    SISSBC5                  YES                             20480000
         L     R3,CN5                   NO, GET NEXT CP ADDR AND LOOP   20500000
         B     SISSBB51                                                 20520000
         SPACE 3                                                        20540002
*                                                                       20560000
* INITIATE READ                                                         20580000
*                                                                       20600000
         SPACE 2                                                        20620000
SISSBC5  MVI   W1IEXTEN+1,X'00'         SET APP CODE FOR READ           20640000
         OI    W1IF1,X'80'              SET ON DC BIT                   20660000
         SR    R6,R6                   CLEAR WORK REG                   20680000
         IC    R6,W1IDAD               GET M FROM IOB                   20700000
         SLL   R6,4                    M X 16                           20720000
         L     R3,DCBDEBAD             GET DEB ADDR                     20740000
         LA    R6,32(R6,R3)            R6 POINTS TO EXTENT OF M         20760000
         MVC   W1IDAD+1(2),4(R6)       MOVE BB INTO IOBI                20780000
         LR    R6,R1                    SAVE  R1                        20800000
         LR    R3,R15                   SAVE R15                        20820000
         EXCP  W1IOBI                                                   20840000
         LR    R15,R3                                                   20860000
         LR    R1,R6                    RESTORE R1                      20880000
         SPACE 2                                                        20890002
SISSBD51 NIL   W1OSBIT2,ONES-SCHED,     SET OFF SCHEDULE BIT    YM03876X20900002
               REF=W1OSBIT1,WREGS=(R4,R9,R10) AS SCHED WAS SUCC YM03876 20920002
         SPACE 2                                                        20930002
SISSBD5  L     R9,W1REGSV2              PICK UP EXIT ADDR               20940000
         BR    R9                                                       20960000
         SPACE 2                                                        20980000
* CONSTANTS FOR SB AND SC                                               21000000
*                                                                       21020000
*                                                                       21040000
CVTPTR   EQU   16                                                       21060000
CVTZDTAB EQU   64                                                       21080000
SISSBCN2 DC    F'0000'                                                  21100000
SISSBCN4 DC    X'0001'                                                  21120000
SISSBCN1 DC    H'10'                                                    21140000
         EJECT                                                          21160000
*                                       ***************                 21180000
*                                       *             *                 21200000
*                                       *    QUEUE    *                 21220000
*                                       *             *                 21240000
*                                       ***************                 21260000
         USING *,R10                                                    21280000
*                                                                       21300000
SISCTSD  EQU   *                                                        21320000
         SPACE 1                                                        21340002
*        ON ENTERING THE QUEUEING ROUTINE                               21360000
*        R3 CONTAINS THE ADDRESS OF THE TO   QUEUE                      21380000
*        R4 CONTAINS THE ADDRESS OF THE FROM QUEUE                      21400000
*        R5 CONTAINS THE NUMBER OF ENTRIES TO BE MOVED %N<              21420000
*        REGISTERS DESTROYED- R6,R7                                     21440000
*        POINTERS TO CHANNEL PROGRAMS MAY HAVE X'08' IN BYTE 0. THIS    21460000
*        CAN BE MASKED OUT IF IT INTERFERES.                            21480000
         SPACE 1                                                        21500002
SISSDD2  CH    R5,SISSDCN1              IS N = 0                        21520000
         BNE   SISSDD21                 NO                              21540000
         BR    R9                       YES, RETURN WITHOUT MOVING Q'S  21560000
SISSDD21 LH    R6,8(R0,R3)              R OF TO Q                       21580000
         CR    R6,R5                    COMPARE NUMBER TO BE MOVED AND  21600000
*                                       RESIDUE                         21620000
         BL    SISSDF2                  NOT ENOUGH IN RESIDUE           21640000
SISSDE1  SR    R6,R5                    ENOUGH ARE ON Q, SET R=R-N      21660000
         STH   R6,8(R0,R3)                                              21680000
         LH    R6,10(R0,R3)             C OF TO Q                       21700000
         AR    R6,R5                                                    21720000
         STH   R6,10(R0,R3)             C=C+N                           21740000
         BR    R9                       RETURN                          21760000
*                                                                       21780000
*                                                                       21800000
SISSDF2  L     R7,0(R0,R4)              SET R7 TO ADDR OF 1ST CP ON     21820000
*                                       FROM QUEUE                      21840000
         CLC   SISSDCN1(4),8(R3)        ARE C AND R OF TO Q ZERO        21860000
         BE    SISSDF3                  YES                             21880000
*                                       NO, MUST CHAIN NEW ADDRESSES TO 21900000
*                                       THOSE ALREADY ON Q              21920000
         L     R6,4(R0,R3)              R6=ADDR OF LAST CP ON TO Q      21940000
         MVC   33(3,R6),1(R4)           MOVE ADDRESS OF 1ST CP ON FROM  21960000
*                                       Q TO TIC ADDRESS IN CN5 OF      21980000
*                                       LAST CP ON TO Q                 22000000
         SH    R5,8(R3)             N=N-R                               22020000
         LH    R6,10(R3)           C=C+R                                22040000
         AH    R6,8(R3)                                                 22060000
         STH   R6,10(R3)                                                22080000
         MVC   8(2,R3),SISSDCN1        ZERO R                           22100000
SISSDG1  CH    R5,10(R4)              IS N G.T. C OF FROM Q             22120000
         BNH   SISSDJ2                  NO                              22140000
SISSDH2  LH    R5,10(R4)                YES, SET N = C OF FROM QUEUE    22160000
SISSDJ2  CH    R5,SISSDCN3              IS N=1                          22180000
         BE    SISSDJ3                  YES                             22200000
*                                                                       22220000
*                                       NO                              22240000
*        *****                MOVE LINK ADDR OF %N-1<TH ENTRY IN FROM Q 22260000
*        *****                TO THE 'LAST' FIELD OF THE TO Q           22280000
         SPACE                                                          22300000
         LR    R6,R5                    SET R6 TO N-1                   22320000
         SH    R6,SISSDCN3                                              22340000
*                                                                       22360000
*                                       R7 IS ORIGINALLY ADDR OF 1ST    22380000
*                                       CP ON FROM Q                    22400000
         SPACE                                                          22420000
SISSDK2  L     R7,32(R7)                LOOP UNTIL R7 WILL              22440000
         BCT   R6,SISSDK2               PICK UP LINK FIELD  OF (N-1) TH 22460000
*                                       (POINTING TO ADDR OF NTH CP)    22480000
         SPACE                                                          22500000
Q1ST     EQU   4                        DISPLACEMENT TO FIRST    S20201 22506020
*                                       * Q POINTER                     22512020
SISSDJ3  ST    R7,Q1ST(R3)              MOVE TO 'LAST' FIELD OF  S20201 22515020
*                                       * 'TO' Q                        22518020
         USING CN1,R7                   ADDRESSABILITY ON CP22   S20201 22521020
         CLI   CN5,TIC                  RPS FORM OF CP           M5092  22524020
         BE    SISSDA4                  NO DON'T CORRECT TIC     M5092  22527020
         MVI   CN5,TIC                  RESTORE TIC              S20201 22530020
         XC    CN5+K1(L3),CN5+K1        TIC ADDRESS = 0          S20201 22533020
SISSDA4  L     R6,CN5                   SET NEW 1ST FIELD IN     S20201 22539020
*                                       FROM Q                   S20201 22545020
         DROP  R7                                                S20201 22551020
         ST    R6,0(R4)                 WITH LINK FIELD OF NTH FROM CP  22560000
         MVC   33(3,R7),SISSDCN1        SET NTH LINK (NEW 'LAST' FIELD  22580000
*                                       ON TO Q) TO 0                   22600000
         LH    R6,10(R4)                C OF FROM Q = C - N             22620000
         SR    R6,R5                                                    22640000
         STH   R6,10(R0,R4)                                             22660000
         LH    R6,10(R3)                C OF TO Q = C + N               22680000
         AR    R6,R5                                                    22700000
         STH   R6,10(R0,R3)                                             22720000
         BR    R9                       RETURN TO CALLING ROUTINE       22740000
         SPACE                                                          22760000
SISSDF3  L     R6,0(R4)                 WHEN TO Q EMPTY, MOVE 'FIRST'   22780000
         ST    R6,0(R0,R3)              FROM FIELD TO 'FIRST' TO FIELD  22800000
         B     SISSDG1                                                  22820000
*                                                                       22840000
* CONSTANTS                                                             22860000
*                                                                       22880000
         DS    0F                                                       22900000
SISSDCN1 DC    X'00000000'                                              22920000
SISSDCN3 DC    X'0001'                                                  22940000
         EJECT                                                          22960000
*                                     *******************               22980000
*                                     *                 *               23000000
*                                     * END OF BUFFER   *               23020000
*                                     *                 *               23040000
*                                     *******************               23060000
         USING *,R12                                                    23080000
         SPACE 3                                                        23100000
SISCTSE  EQU  *                                                         23120000
         SPACE 2                                                        23140000
SISSEA2  L     R3,W1US1ST                                               23160000
         ST    R9,W1REGSV3              SAVE R9 IN ORDER TO EXIT        23180000
         TM    W1USERC+1,X'FF'          USER Q EMPTY                    23200000
*                                       (SPECIAL CASE ON 1ST GET        23220000
*                                        FOLLOWING A SETL)              23240000
         BZ    SISSEA4                  YES                             23260000
         TM    CN2+4,X'10'              IS THIS EOD BUFFER, CLOSE WILL  23280000
*                                       WRITE IT IF PUTXED              23300000
         BO    SISSEG2                  YES, GO TO EOD EXIT             23320000
         TM    CN2+4,X'80'              NO, WAS CURRENT BUFFER PUTXED   23340000
         BZ    SISSEB2                  NO                              23360000
*                                       YES                             23380000
SISSEA3  LA    R3,W1PX1ST               MOVE CURRENT USER               23400000
         LA    R4,W1US1ST               QUEUE BUFFER TO                 23420000
         LA    R5,1                    TO PUTX Q                        23440000
         L    R10,CTSD(R15)            GO TO QUEUE SUBROUTINE           23460000
         AR    R10,R15                                                  23480000
         BALR  R9,R10                                                   23500000
         B     SISSEC3                                                  23520000
SISSEB2  LA    R3,W1FR1ST               MOVE NON PUTXED USER            23540000
         LA    R4,W1US1ST               BUFFER TO THE                   23560000
         LA    R5,1                    FREE Q                           23580000
         L    R10,CTSD(R15)             GET QUEUE ROUTINE OFFSET        23600000
         AR    R10,R15                                                  23620000
         BALR  R9,R10                   BRANCH TO Q SUB AND RETURN      23640000
SISSEC3  CLC   W1PUTXC+1(1),W1ICNOT     CAN A WRITE BE SCHEDULED        23660000
         BL    SISSED3                  NO, NOT N/2 PUTX Q BUFFERS      23680000
         TM    W1WRITEC+1,X'FF'         YES, IS WRITE Q EMPTY           23700000
         BZ    SISSEC1A                 YES                             23720000
*                                       NO, IS WRITING COMPLETE         23740000
SISSEC2  TM    W1OSBIT1,X'01'           TEST IOB-O COMPLETE INDIC       23760000
         BZ    SISSED3                  WRITING IS STILL GOING ON       23780000
*                                       WRITING COMPLETE                23800000
SISSEC2A TM    W1OSBIT2,X'80'           ANY WRITE ERRORS                23820000
         BO    SISSED3                  YES, TELL USER ON NEXT GET      23840000
*                                       NO                              23860000
         SPACE 2                                                        23870002
         NIL   W1OSBIT1,ONES-IOBOC,     SET OFF IOBO COMPLETE   YM03876X23880002
               REF=W1OSBIT1,WREGS=(R4,R9,R10)  BIT              YM03876 23890002
         SPACE 2                                                        23892002
SISSEC1  LA    R3,W1FR1ST                                               23900000
         LA    R4,W1WR1ST               MOVE WRITE QUEUE                23920000
         LH    R5,W1WRITEC              BUFFERS TO FREE QUEUE           23940000
         L    R10,CTSD(R15)                                             23960000
         AR    R10,R15                                                  23980000
         BALR  R9,R10                   BRANCH TO Q SUB AND RETURN      24000000
SISSEC1A SR    R5,R5                     CLEAR REGISTERS          10386 24002014
         CLI   W1PUTXC+1,0              IS PUTX Q MT             A36373 24002621
         BE    SISSED3                  BIF YES                  A36373 24003221
         L     R10,W1PX1ST               GET 1ST CP ADDR          10386 24004014
SISSEC1B LA    R5,1(R5)                  INCRE BUFFER COUNT       10386 24006014
         LA    R3,40(R10)                POINT TO MBBCC           10386 24008014
         L     R10,32(R10)          GET NEXT CP ADDR. (IF ANY)    10386 24010014
         LA    R10,0(R10)                CLEAR HI ORDER BYTE      10386 24012014
         LTR   R10,R10                   ANY MORE CHANNEL PROGS   10386 24014014
         BZ    SISSEC1C                  NO, BRANCH               10386 24016014
         LA    R4,40(R10)                POINT TO NEXT MBBCC      10386 24018014
         CLC   0(7,R3),0(R4)            ARE TWO MBBCCHH'S EQUAL   22662 24020018
         BE    SISSEC1B                  YES, GO TO 5573-42233    10386 24022014
SISSEC1C LA    R3,W1WR1ST                NO, GO SET UP AND DO EXCP10386 24024014
*                                         ON THE BUFFERS ON THE   10386 24026014
*                                        SAME CYLINDER            10386 24028014
         LA    R4,W1PX1ST               MOVE PUTX QUEUE                 24040000
*                                                                       24042002
*   LIMIT NUMBER OF BUFFERS WRITTEN IN ORDER TO PREVENT CHANNEL         24048001
*   PROGRAMS LONGER THAN 224 CCW'S.                                     24052001
*                                                                       24054002
         LA    R10,THIRTY               LIMIT WRITE BUFFERS             24056001
         CR    R10,R5                   TOO MANY WRITE BUFFERS          24060001
         BH    AOS001                   NO - NUMBER O.K.                24064001
         LR    R5,R10                   LIMIT NUMBER OF BUFFERS         24068001
AOS001   EQU   *                        *                               24072001
         L    R10,CTSD(R15)                                             24080000
         AR    R10,R15                                                  24100000
         BALR  R9,R10                   BRANCH AND RETURN FROM Q SUB.   24120000
SISSEE1  L     R11,CTSF(R15)            GO TO SETC4 SUBROUTINE          24140000
         AR    R11,R15                  TO PREPARE WRITE Q              24160000
         BALR  R9,R11                   BUFFERS FOR OUTPUT              24180000
         SPACE 2                                                        24200000
*  INITIATE WRITE                                                       24220000
         SPACE 2                                                        24240000
SISSEF1  MVI   W1OEXTEN+1,X'08'        SET APP CODE FOR WRITING         24260000
         SR    R6,R6                   CLEAR WORK REG                   24280000
         IC    R6,W1ODAD               GET M FROM IOB                   24300000
         SLL   R6,4                    M X 16                           24320000
         L     R7,DCBDEBAD             GET DEB ADDR                     24340000
         LA    R6,32(R6,R7)            R6 POINTS TO EXTENT OF M         24360000
         MVC   W1ODAD+1(2),4(R6)       MOVE BB INTO IOBO                24380000
         LR    R6,R1                    SAVE R1                         24400000
         LR    R7,R15                  SAVE R15                         24420000
         EXCP  W1IOBO                   INITIATE WRITING                24440000
         LR    R1,R6                    RESTORE R1                      24460000
         LR    R15,R7                   RESTORE R15                     24480000
         CLI   W1PUTXC+1,X'00'           PUTX Q 5MPTY             10386 24484014
         BE    SISSED3                   YES DON'T WAIT           10386 24488014
         LR    R6,R1                     SAVE REGISTERS           10386 24492014
         LR    R7,R15                                             10386 24496014
         WAIT  ECB=W1ECBO                                         10386 24500014
         LR    R1,R6                     RESTORE REGISTERS        10386 24504014
         LR    R15,R7                                             10386 24508014
         B     SISSEC2A                                           10386 24512014
         SPACE                                                          24520000
*                                       AT END OF DATA SET              24540000
SISSEG2  TM    DCBEODAD+3,X'01'         WAS AN EOD ADDRESS SPECIFIED    24560000
         BO    SISSEG2A                 NO                              24580000
*                                       YES                             24600000
         LM    R2,R12,28(R13)           RESTORE REGS 2-12 FOR USER      24620000
         L     R1,DCBEODAD              GET USER'S EOD ADDRESS          24640000
SISSEOUT BR    R1                       GO TO END OF DATA EXIT          24660000
         SPACE 2                                                        24680000
*                                       GIVE 039 ABEND, NO       Y02072 24700002
SISSEG2A ABEND X'039',DUMP,,SYSTEM      EOD ADDR GIVEN           Y02072 24710002
         SPACE 2                                                        24740000
SISSED3  CLI   W1USERC+1,X'01'         IS USER Q EMPTY                  24760000
         BL    SISSEA4                  YES                             24780000
SISSEF3  L     R3,W1US1ST         END OF DS BUF TEST. COMPARE MBBCC     24800000
         CLC   CN6,DCBLPDA        HHR OF LPDA WITH CN6 OF CP1 USERQ     24820000
         BNE   SISSEF3A                 NOT LAST BLOCK                  24840000
*                                       LAST PRIME DATA RCD NEXT TO BE  24860000
*                                       PROCESSED                       24880000
         TM    W1WOVFL+8,X'08'          DOES OVERFLOW CHAIN REMAIN TO   24900000
*                                       BE READ                         24920000
         BO    SISSEF3A                 YES                             24940000
         OI    CN2+4,X'10'              NO, MARK THIS AS EOD BUFFER     24960000
         SPACE 3                                                        24980000
* SET CBF AND EOB POINTERS                                              25000000
         SPACE 2                                                        25020000
SISSEF3A TM    CN2+4,X'40'              IS CURRENT RECORD AN OVERFLOW   25040000
         BO    SISSEH3                  YES                             25060000
*                                       NO                              25080000
         TM    W1OSBIT2,X'01'           IS BLOCKED SW. FROM SETL K ON   25100000
         BZ    SISSEF3B                 NO                              25120000
         MVC   W1CBF,W1KEYBLK           YES,MOVE REC SAVED BY SETL K    25140000
*                                       TO CBF                          25160000
         B     SISSEF3C                                                 25180000
SISSEF3B MVC   W1CBF+1(3),CN4+1         SET CBF FOR NORMAL CASE         25200000
SISSEF3C L     R5,CN4                                                   25220000
         LA    R5,0(R5)                CLEAR HIGH ORDER BYTE            25240000
         TM    DCBRECFM,X'80'           ARE THESE FIXED RECS            25260000
         BZ    SISSEG3                  NO, VARIABLE RECORDS            25280000
         AH    R5,DCBBLKSI              FIXED, GET EOB ADDRESS          25300000
SISSEJ5  BCTR  R5,0                    TO POINT TO LAST BYTE OF BUFF    25320000
         ST    R5,W1EOB                 SET W1EOB                       25340000
         SPACE 2                                                        25350002
         NIL   W1OSBIT2,ONES-SETLKBLK,  SET OFF SETLK BLK BIT   YM03876X25360002
               REF=W1OSBIT1,WREGS=(R4,R9,R10)                   YM03876 25370002
         SPACE 2                                                        25372002
         L     R9,W1REGSV3                                              25380000
         BR    R9                       EXIT                            25400000
         SPACE 3                                                        25420000
*                             VARIABLE                                  25440000
SISSEG3  LR    R6,R5                    LOAD BUFFER ADDRESS TO R6       25460000
         LA    R6,4(R6)                SET R6 TO 1ST RECORD IN BLOCK    25480000
         TM    W1OSBIT2,X'01'           SETL K BLK BIT ON               25500000
         BO    SISSEG3A                 YES                             25520000
         ST    R6,W1CBF                 SET CBF TO 1ST REC IN BUFFER    25540000
SISSEG3A AH    R5,0(R6)                 ADD BLK LEN                     25560000
         B     SISSEJ5                                                  25580000
         SPACE 3                                                        25600000
SISSEH3  L     R5,CN4                   OVERFLOW PROCESSING             25620000
         LA    R5,10(R5)                                                25640000
         TM    DCBRECFM,X'80'           FIXED OR VARIABLE               25660000
         BZ    SISSEG3                  VARIABLE                        25680000
*                                       FIXED                           25700000
         ST    R5,W1CBF                 SET W1CBF FOR OVERFLOW RECORD   25720000
         AH    R5,DCBLRECL              TO FIND END OF BUFFER           25740000
         B     SISSEJ5                                                  25760000
         SPACE 3                                                        25780000
*                                       FILL USER QUEUE                 25800000
SISSEA4  TM    W1ECBI,X'40'             ARE ANY READS IN PROCESS        25820000
         BZ    SISSEC4                  YES WAIT FOR THEM               25840000
*                                       NO                              25860000
         TM    W1OSBIT1,X'02'           HAVE WE USED LAST READ BUFFERS  25880000
         BO    SISSEA5                  NO, MOVE THEM TO USER Q         25900000
         B     SISSED5                  YES,GET BUFFERS FROM WRITE Q    25920000
         SPACE 3                                                        25940000
*                                       WAIT FOR LAST READ              25960000
SISSEC4  LR    R6,R1                    SAVE R1                         25980000
         LA    R1,W1ECBI                                                26000000
         LR    R3,R15                   SAVE R15                        26020000
         WAIT  ECB=(1)                                                  26040000
         LR    R15,R3                   RESTORE R15                     26060000
         LR    R1,R6                    RESET R1                        26080000
SISSEA5  LA    R3,W1US1ST                                               26100000
         LA    R4,W1RD1ST               MOVE READ QUEUE                 26120000
         LH    R5,W1READC               BUFFERS TO USER QUEUE           26140000
         L     R10,CTSD(0,R15)                                          26160000
         AR    R10,R15                                                  26180000
         BALR  R9,R10                   BRANCH TO Q ROUT AND RETURN     26200000
         SPACE 1                                                        26210002
*           SET ON SCHEDULE BIT SO THAT AN ATTEMPT                      26220002
*           TO SCHEDULE WILL BE MADE AT NEXT GET                        26240002
*                                                                       26242002
         SPACE 2                                                        26244002
         OIL   W1OSBIT2,SCHED,          SET SCHED BIT ON        YM03876X26250002
               REF=W1OSBIT1,WREGS=(R4,R9,R10)                   YM03876 26252002
         SPACE 2                                                        26254002
         NIL   W1OSBIT1,ONES-IOBIC,     SET IOBI COMP BIT TO    YM03876X26260002
               REF=W1OSBIT1,WREGS=(R4,R9,R10) ZERO              YM03876 26262002
         SPACE 2                                                        26264002
         CLI   W1USERC+1,X'00'          USER Q STILL EMPTY        7M265 26266017
         BE    SISSEG2                  YES--EXIT, EOF WAS READ   7M265 26272017
         B     SISSEF3                                                  26280000
         SPACE 3                                                        26300000
*                                       TO FILL USER Q BUFFERS MUST BE  26320000
*                                       OBTAINED FROM WRITE Q THROUGH   26340000
*                                       FREE TO READ TO USER QUEUES     26360000
SISSED5  TM    W1ECBO,X'40'             IS WAIT NECESSARY               26380000
         BO    SISSEE5                  NO                              26400000
         LR    R6,R1                    YES, SAVE R1 AND R15            26420000
         LR    R3,R15                                                   26440000
         WAIT  ECB=W1ECBO                                               26460000
         LR    R15,R3                   RESTORE R1 AND R15              26480000
         LR    R1,R6                                                    26500000
SISSEE5  TM    W1OSBIT2,X'80'           ANY WRITE ERRORS                26520000
         BZ    SISSEE5A                 NO                              26540000
         L     R11,CTSGE(R15)           YES, MUST GO TO EINFO NOW       26560000
         AR    R11,R15                                                  26580000
         BALR  R9,R11                   GO TO EINFO                     26600000
SISSEE5A LA    R3,W1FR1ST               MOVE WRITE Q TO FREE Q          26620000
         LA    R4,W1WR1ST                                               26640000
         LH    R5,W1WRITEC                                              26660000
         L     R10,CTSD(0,R15)          GO TO QUEUE ROUTINE             26680000
         AR    R10,R15                                                  26700000
         BALR  R9,R10                   SET RETURN REG. FROM QUEUE      26720000
SISSEF5  TM    W1OSBIT1,X'40'           AT END OF DATA SET       A36373 26726021
         BO    SISSEG2                  YES-NO SCHED POSSIBLE    A36373 26732021
*                                       NOW HAVE FREE BUFS, SCHEDULE A  26740000
*                                       READ                            26760000
         L     R11,CTSB(0,R15)          GET SCHED RTN OFFSET      7M265 26780017
         AR    R11,R15                                                  26800000
         BALR  R9,R11                   BRANCH TO SCHEDULE INPUT        26820000
         TM    W1OSBIT2,X'04'           SCHEDULING SUCCESSFUL    A25968 26826019
         BO    SISSEC1A                 NO, USE PUTX Q BUFFERS   A25968 26832019
SISSEG5  TM    W1ECBI,X'40'             IS INPUT COMPLETED              26840000
         BO    SISSEA5                  YES                             26860000
         B     SISSEC4                  WAIT                            26880000
         DS    0F                                                       26900000
         EJECT                                                          26940000
*                                     ********************              26960000
*                                     *                  *              26980000
*                                     * SETC4 SUBROUTINE *              27000000
*                                     *                  *              27020000
*                                     ********************              27040000
         SPACE 1                                                        27060002
         USING *,R11                                                    27080000
SISCTSF  EQU  *                                                         27100000
*                                                                       27120000
         SPACE 1                                                        27160002
SISSFA2  L     R3,W1WR1ST                                               27180000
         NI    CN1,X'7F'                SET OFF MT BIT IN CP1 OF QUEUE  27200000
         ST    R3,W1FCPS                SET FCPS TO 1ST CP OF QUEUE     27220000
SISSFB2  CLI   CN3,X'08'                IS THE CN3 A TIC                27240000
         BE    SISSFB2A                 YES(CP22B)                      27260000
*                                       NO (CP22A)                      27280000
         MVI   CN3,X'0D'                SET THE CN3 OF CP22A TO WR KD   27300000
SISSFB2A MVI   CN4,X'05'                SET THE CN4 TO WR DATA          27320000
SISSFC2  TM    CN2+4,X'40'              IS THIS AN OVERFLOW RECORD      27340000
         BO    SISSFD3                  YES                             27360000
*                                       NO                              27380000
SISSFD2  CLC   CN6+7(1),DCBHIRPD        IS RECORD LAST OF TRACK         27400000
         BE    SISSFE3                  YES                             27420000
         CLC   CN6+7(1),DCBHIRSH                                        27440000
         BE    SISSFE3                  YES                             27460000
         CLC   CN5+1(3),LASTITEM        NO, ARE WE AT END OF QUEUE      27480000
         BE    SISSFE3                  YES                             27500000
*                                       NO                              27520000
         L     R8,CN5                   GET NEXT CHANNEL PROGRAM        27540000
         TM    12(R8),X'40'             IS THIS ONE AN OVERFLOW RCD     27560000
         BO    SISSFE3                  YES                             27580000
         CLC   CN6(7),40(R8)            NEXT REC ON SAME TRACK    22662 27586018
         BNE   SISSFE3                  NO,BRANCH-CAN'T CHAIN CP  22662 27592018
SISSFF2  OI    CN4+4,X'40'              CHAIN THIS CP ON TO THE SET     27600000
SISSFH2  L     R3,CN5                   GET THE NEXT CHANNEL PROGRAM    27620000
         B     SISSFB2                  GO BACK TO CHANGE THIS CP       27640000
SISSFD3  NI    CN2+4,X'BF'              SET OFF OVERFLOW INDICATOR      27660000
SISSFE3  NI    CN4+4,X'BF'              INDIC. END OF SET.(OVFLO OR PD) 27680000
         CLC   CN5+1(3),LASTITEM       END OF Q                         27700000
         BE    SISSFF4                  YES                             27720000
*                                       NO                              27740000
         L     R8,CN5                   GET THE NEXT CHANNEL PROGRAM    27760000
         NI    0(R8),X'7F'              SET OFF ITS MT BIT SINCE 1ST OF 27780000
         B     SISSFH2                  A SET                           27800000
SISSFF4  L     R3,W1WR1ST               GET  CP1 ON WRITE QUEUE         27820000
         MVC   W1ODAD,CN6               SET IOB SEEK TO CN6 OF CP1      27840000
         MVC   W1OCPS,W1WR1ST           SET OCPS TO INITIATE THE WRITE  27860000
         BR    R9                      RETURN                           27880000
LASTITEM DC    X'00000000'             CONSTANT TO TEST FOR END OF Q    27900000
         EJECT                                                          27920000
         USING *,R11                                                    27940000
SISCTSGC EQU   *                        ***************                 27960000
*                                       *             *                 27980000
*                                       * CHECK RTN   *                 28000000
*                                       *             *                 28020000
*                                       ***************                 28040000
         SPACE 2                                                        28060000
         SPACE                                                          28080000
SISSGA2  L     R3,W1US1ST               1ST CP ON USER QUEUE            28100000
         TM    CN2+4,X'08'              INPUT ERROR                     28120000
         BO    SISSGB3                  YES                             28140000
*                                       NO                              28160000
         TM    CN2+4,X'02'              UNREACHABLE BLOCK               28180000
         BO    SISSGC3                  YES                             28200000
         BR    R9                       NO,RETURN RECORD IS OK          28220000
SISSGC3  OI    DCBEXCD1,X'02'           SET ON EXCD FOR UNREACHABLE BLK 28240000
         B     SISSGD3                                                  28260000
SISSGB3  OI    DCBEXCD1,X'08'           SET ON EXCD FOR UNREADABLE BLK  28280000
SISSGD3  LA    R10,SISSGG4                                              28300000
         L     R11,CTSGE(R15)           SET UP EINFO BASE               28320000
         AR    R11,R15                                                  28340000
         L     R4,W1CBF                 SO THAT BAD BUFFER WILL BE      28360000
*                                       POINTED TO                      28380000
         BR    R10                      GO TO END OF EINFO RTN          28400000
         EJECT                                                          28420000
         USING *,R11                                                    28440000
SISCTSGE EQU   *                        ***************                 28460000
*                                       *             *                 28480000
*                                       * EINFO  RTN  *                 28500000
*                                       *             *                 28520000
*                                       ***************                 28540000
         SPACE 2                                                        28560002
SISSGF1  LR    R8,R9                    SAVE EXIT                       28580000
SISSGF2  TM    W1WRITEC+1,X'FF'        IS WRITE Q EMPTY                 28600000
         BZ    SISSGF3                  YES, ALL BAD RCDS TAKEN CARE OF 28620000
         L     R3,W1WR1ST               NO, CHECK 1ST WRITE Q BUFFER    28640000
         L     R4,CN7                   SET R4 TO BUFFER ADDRESS        28660000
         TM    CN2+4,X'04'              IS THIS RCD UNWRITEABLE         28680000
         BO    SISSGG3                  YES                             28700000
*                                       NO                              28720000
         TM    CN2+4,X'02'              IS BUFFER UNREACHABLE           28740000
         BZ    SISSGF21                 NO                              28760000
         OI    DCBEXCD1,X'01'           YES, SET ON UNREACHABLE OP BIT  28780000
         B     SISSGG31                                                 28800000
         SPACE                                                          28820000
*                                       THIS BUFFER OK                  28840000
SISSGF21 LA    R3,W1FR1ST               MOVE 1 BUFFER TO FREE Q         28860000
         LA    R5,1                                                     28880000
         LA    R4,W1WR1ST                                               28900000
         L     R10,DCBDEBAD             DEB ADDRESS              S21045 28905021
         USING SISDEB,R10                                        S21045 28910021
         L     R10,DEBEXPTR             EXTENSION ADDRESS        S21045 28915021
         USING DEBEXT,R10                                        S21045 28920021
         L     R10,DEBGET               LOAD BASE                S21045 28925021
         DROP  R10                                               S21045 28930021
         A     R10,CTSD(R10)            ADD OFFSET                      28940000
*              GO TO QUEUE ROUTINE                                      28960000
         BALR  R9,R10                                                   28980000
         B     SISSGF2                  TEST NEXT CP                    29000000
         SPACE 2                                                        29020000
SISSGF3  NIL   W1OSBIT2,ONES-(UNWRITE+WAPBIT), SET OFF ERR IND  YM03876X29040002
               REF=W1OSBIT1,WREGS=(R4,R9,R10) USER NOTIFIED     YM03876 29050002
         SPACE 2                                                        29060002
         TM    DCBEXCD2,X'20'           DID CONTROL COME FROM CLOSE     29080000
         BCR   8,R8                    RETURN                           29100000
SISSGF31 LM    R3,R4,W1CN11             LOAD CLOSE BASE AND ENTRY POINT 29120000
         LM    R5,R8,W1CN9              RESTORE REGS 5-8         A39794 29130021
         L     R15,DCBWKPT1             RESTORE DSECT BASE              29140000
         LR    R2,R1                    RESTORE DCB REGISTER      7M265 29150017
         BR    R4                       RETURN TO CLOSE                 29160000
         SPACE 2                                                        29180000
SISSGG3  OI    DCBEXCD1,X'04'           SET ON UNCORRECTABLE O/P ERROR  29200000
SISSGG31 NI    CN2+4,X'20'              SET OFF ALL FLAG BITS BUT D-KD  29220000
         EJECT                                                          29240000
*        USED IN COMMON WITH CHECK TO SET INDICATORS FOR ERROR EXIT     29260000
         SPACE                                                          29280000
SISSGG4  TM    DCBSYNAD+3,X'01'         DID USER SPECIFY A SYNAD RTN    29300000
         BZ    SISSGH4                  YES                             29320000
         SPACE 2                                                        29330002
*        TEST FOR NORMAL TASK TERMINATION.  IF IN TERMINATION, CLOSE    29340002
*        EXECUTOR IGG02029 WILL ISSUE DMABCOND MACRO TO CAUSE 031       29350002
*        ABEND AND WRITING OF MESSAGE IEC203I.                          29352002
         SPACE 2                                                        29354002
         L     R5,DCBDEBAD              DEB ADDRESS             YM06516 29356002
         LA    R5,0(R5)                 CLEAR HIGH ORDER BYTE   YM06516 29356402
         SH    R5,ISL8                  PT TO DEB EXTENSION PTR YM06516 29358002
         L     R5,0(R5)                 ADDRESS DEB EXTENSION   YM06516 29358402
         USING DEBXTN,R5                DEB EXT. ADDRESSABILITY YM06516 29358802
         TM    DEBXFLG1,DEBXTSKC        TASK CLOSE CLOSING DCB  YM06516 29358902
         BO    SISSGH4                  YES, GO TO 2029 FOR MSG YM07002 29359202
         DROP  R5                       END DEB EXTENSION USING YM06516 29359602
         SPACE 2                                                        29359702
*                                                                       29372602
SISSGAB  ABEND X'031',DUMP,,SYSTEM      NO, GIVE 031 ABEND       Y02072 29373302
         SPACE                                                          29380000
*                                       SET REGISTERS ACCORDING TO CPS  29400000
SISSGH4  L     R15,DCBSYNAD             SET R15 WITH ADDR OF SYNAD RTN  29420000
*        RESTORE FIRST 16 BYTES OF IOB FOR USER                         29430003
         MVC   W1TEMPSA,CN5+4           SAVE FIRST FOUR IOB BYTES       29440003
         ST    R2,W1REGSV2              STORE ECB PTR           OZ05912 29450003
         MVC   W1REGSAV(8),CN6          SAVE BYTES 8 TO 16 OF IOB       29460003
         LA    R0,W1TEMPSA              POINT TO IO STATUS INDICATORS   29480000
         TM    DCBEXCD2,X'20'           WAS EINFO ENTERED FROM CLOSE    29500000
         BO    SISSGJ4                  YES, LET CLOSE GO TO USER       29520000
         LR    R1,R4                    POINT TO RCD OR BUFFER IN ERROR 29540000
         LM    R2,R12,28(R13)           RESTORE REGS                    29560000
ERROUT   BR    R15                      GO TO SYNAD                     29580000
SISSGJ4  L     R3,W1CN11                RESTORE CLOSE BASE              29600000
         L     R8,W1CN12                RETURN POINT                    29620000
         L     R15,DCBWKPT1             SET BASE FOR WORKAREA           29640000
         LR    R2,R1                    RESTORE DCB REG FOR CLOSE 22662 29650018
         LR    R1,R4                    POINT TO BUFFER                 29660000
         BR    R8                       RETURN TO CLOSE FOR SYNAD EXIT  29680000
         DS    0F                                                       29700000
*                                                                       29720000
*                                  ***** CONSTANTS *****                29740000
         SPACE 4                                                        29780000
CTSGE    EQU   12                       OFFSETS FOR INTER-CHART         29800000
CTSD     EQU   16                        COMMUNICATION                  29820000
CTSB     EQU   20                                *                      29840000
CTSF     EQU   24                                *                      29860000
CTSE     EQU   28                               ***                     29880000
CTSGC    EQU   32                                *                      29900000
INCLOSE  EQU   X'20'                    ENTERED FROM CLOSE      YM05395 29910002
ISL8     DC    H'8'                     DECR DEB PTR TO EXT PTR YM06516 29910102
*                                                                       29910402
CLSESETL EQU   X'40'                    IND. CLOSE ISSUED ESETL YM03876 29910802
CYLIND   EQU   X'20'                    SAME CYLINDER INDICATOR YM03876 29911202
EOD      EQU   X'40'                    END OD DATA INDICATOR   YM03876 29911602
IOBIC    EQU   X'02'                    INPUT IOB COMPLETION    YM03876 29911702
IOBOC    EQU   X'01'                    OUTPUT IOB COMPLETION   YM03876 29911802
ONES     EQU   X'FF'                    MASK OF ALL ONES        YM03876 29911902
OVRFLOW  EQU   X'20'                    OVERFLOW RCD INDICATOR  YM03876 29961902
RELSE    EQU   X'02'                    RELEASE BUFFER IND.     YM03876 29971902
SCHED    EQU   X'04'                    SCHEDULING BIT          YM03876 29981902
SETLKBLK EQU   X'01'                    SETL K BLKD BIT         YM03876 29991902
SHRDTRK  EQU   X'10'                    SHARED TRK INDICATOR    YM03876 30001902
TRKINDX  EQU   X'10'                    READ TRK INDES IND.     YM03876 30003902
UNWRITE  EQU   X'80'                    UNWRITABLE RECORD       YM03876 30005902
WAPBIT   EQU   X'40'                    WRITE APPEND WORK BIT   YM03876 30007902
*                                                                       30009902
PATCH    DC    XL((*-IGG019HB)/20)'00'  ZEROED PATCH AREA        Y02072 30011902
*                                                                       30061902
         EJECT                                                          30111902
SISWORK1 IGGSCAN                SCAN MODE WORK AREA              A35340 30920020
*                                  ****END OF FIXED LENGTH FIELDS ****  32400000
*                                  THE NO. OF CP 22'S IS DEPENDENT ON   32420000
*                                  THE NO. OF BUFFERS (DCBBUFNO)        32440000
         EJECT                                                          32460000
SISCP22  DSECT                                                          32470020
         IGGCP22                                                        32480020
         EJECT                                                          32640000
SISDEB   IGGDEBD                                                        32660020
*                             ***********************************       33360000
DEBMODID DS    BL4                      2 BYTE IDS OF LOADED MODULES    33380000
DEBXTN   DSECT                                                          33390002
DEBXLNGH  DS   H                        LENGTH DEB EXTENSION            33392002
DEBXFLG1  DS   B                        FLAG BYTE                       33394002
DEBXTSKC EQU   X'40'                    TASK CLOSE CLOSING DCB          33396002
         EJECT                                                          33400000
         DCBD  DSORG=(IS)                                               33420000
         END                                                            33440000
