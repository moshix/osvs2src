         TITLE 'IGG019J0 - BISAM COMBINED PRIV MACRO TIME, NLSD=0'      00020000
IGG019J0 CSECT                                                          00040000
*        RELEASE OS/VS2-02 DELETIONS                             Y02072 00042002
*        RELEASE 19 DELETIONS                                           00046000
*1078061200,139100                                               A25517 00046519
*1078022004-022088,022100-022136,022137,022140-022188,022300-    A26738 00046619
*1078022320,023200-023800,024600-026400,028000,029000,029200,    A26738 00046719
*1078029400                                                      A26738 00046819
*        RELEASE 20 DELETIONS                                           00047000
*0712022200,055600,058400,058600,058800,059000,059200,059400,    S20201 00047120
*0712059600-060600,068600,069400,088200,088400,088600,088800,    S20201 00047220
*0712089000,090400,091000-094800,095000-098800,099000-115200,    S20201 00047320
*0712120600,120800,121000-121800,122000-122800,123000-130800,    S20201 00047420
*0712131000-134800,135000-140800,141000-146600                   S20201 00047520
*0712022340,022350,022441                                        A33986 00047720
*        RELEASE 21 DELETIONS                                           00048000
*1024                                                            A33533 00048521
*                                                               SA67174 00058502
*                                                                       00060002
*STATUS CHANGE LEVEL 009                                                00072002
* FUNCTION/OPERATION' PRIVILEGED MACRO-TIME ROUTINE FOR BISAM WHEN      00100000
*        READ AND UPDATE IS USED WITH    WRITE KN AND WHEN              00120000
*        ONLY THE TRACK INDEX IS SEARCHED ON DEVICE.                    00140000
*        1. IF THE MACRO IS NOT A WRITE K FOLLOWING FROM A READ KU,     00160000
*            GETMAIN FOR AN IOB AND EXTENTION AND INITIALIZE THE IOB.   00180000
*            IF  A  WRITE K FOLLOWING FROM READ KU, FIND THE IOB        00200000
*            ON THE UPDATE QUEUE AND REMOVE IF FROM THE QUEUE.          00220000
*        2. IF THE MACRO IS WRITE KN, DETERMINE IF ANY OTHER MACRO IS   00240000
*            BEING PROCESSED FOR THIS DATA SET.  IF SO, ADD THE IOB TO  00260000
*            THE UNSCHEDULED QUEUE AND SET THE UNSCHEDULED SWITCH ON.   00280000
*            IF NOT, SEARCH THE HIGHEST LEVEL INDEX IN CORE IF THIS     00300000
*            IS NECESSARY, INITIALIZE THE FIRST WKN CHANNEL PROGRAM,    00320000
*            AND SET THE START ADDRESS AND SEEK-SEARCH ADDRESS IN THE   00340000
*            IOB.                                                       00360000
*        3. IF THE MACRO IS READ AND UPDATE MACRO, THEN                 00380000
*            A. IF IT IS A WRITE K FOLLOWING FROM A READ KU OR IF       00400000
*                WRITE KN IS NOT IN PROCESS OR PENDING, THEN            00420000
*           DETERMINE IF THE FIRST CHANNEL PROGRAM NEEDED FOR THIS      00440000
*            MACRO IS AVAILABLE. IF SO, REMOVE THE CHANNEL PROGRAM FROM 00460000
*            ITS QUEUE, SEARCH THE HIGHEST LEVEL INDEX IN CORE          00480000
*            IF THIS IS NECESSARY,     INITIALIZE THE CHANNEL PROGRAM,  00500000
*            AND SET THE START ADDRESS AND SEEK-SEARCH ADDRESS IN THE   00520000
*            IOB.  IF NOT, ADD THE IOB TO THE UNSCHEDULED QUEUE AND SET 00540000
*            THE UNSCHEDULED SWITCH ON.                                 00560000
*            B. IF IT IS NOT A WRITE K FOLLWOING FROM READ KU AND       00580000
*                WRITE KN IS PENDING, THEN ADD THE IOB TO THE UNSCHED-  00600000
*                ULED QUEUE AND SET THE UNSCHEDULED SWITCH ON.          00620000
* ENTRY POINTS                                                          00640000
*        ENTRY PNT     CALLING ROUTINE                FUNCTION          00660000
*        ---------     ---------------                --------          00680000
*        DISQHN     NON-PRIVILEGED MACRO-TIME   ALL OF THE FUNCTIONS    00700000
*                    ROUTINE VIA QING SVC        DESCRIBED ABOVE        00720000
*                    (SVC 54) ROOT                                      00740000
*                                                                       00760000
*        DISCP45    ASYNCHRONOUS ROUTINE        SET UP CP4/CP5 AND      00780000
*                                                REMOVE THEM FROM THEIR 00800000
*                                                QUEUE WHERE NECESSARY  00820000
*                                                                       00840000
*        DISCP7     ASYNCHRONOUS ROUTINE        SET UP CP7              00860000
*                                                                       00880000
*        DISCPWKN   ASYNCHRONOUS ROUTINE        SET UP FIRST WKN CP     00900000
*                                                                       00920000
*        DISPRIV    ASYNCHRONOUS ROUTINE        THE FUNCTIONS DESCRIBED 00940000
*                                                IN 3.A. ABOVE          00960000
*                                                                       00980000
* INPUT - N/A                                                           01000000
* OUTPUT - N/A                                                          01020000
* EXTERNAL ROUTINES - N/A                                               01040000
* EXITS  FROM DISQHN  RETURN TO QING SVC ROOT        VIA REGISTER 13    01060000
*        FROM DISCP45 RETURN TO ASYNCHRONOUS ROUTINE VIA REGISTER 11    01080000
*        FROM DISCP7  RETURN TO ASYNCHRONOUS ROUTINE VIA REGISTER 11    01100000
*        FROM DISCPWKN RETURN TO ASYNCHRONOUS ROUTINE VIA REGISTER 11   01120000
*        FROM DISPRIV RETURN TO ASYNCHRONOUS ROUTINE VIA REGISTER 13    01140000
* TABLES/WORK AREAS' DECB, DCB, IOB AND EXTENSION, DCB WA (DCW), DEB    01160000
*        SEE DSECTS AT END OF MODULE FOR FORMAT AND DESCRIPTIONS        01180000
* ATTRIBUTES' RE-ENTRANT. DISABLED UPON ENTRY AND EXIT. ENABLED WHILE   01200000
*        CHANNEL PROGRAMS ARE BEING INITIALIZED.                        01220000
* NOTES - NONE                                                          01240000
* GENERAL REGISTERS USED AS FOLLOWS                                     01260000
R0       EQU   0                        WORK REGISTER                   01280000
R1       EQU   1                   *    IOB                             01300000
R2       EQU   2                 # *    DECB                            01320000
R3       EQU   3                   *    -----                           01340000
R4       EQU   4                 # *    DCB                             01360000
R5       EQU   5                   **   CHANNEL PROGRAM                 01380000
R6       EQU   6                        WORK REGISTER                   01400000
R7       EQU   7                        WORK REGISTER                   01420000
R8       EQU   8                   *    DCB WA (DCW)                    01440000
R9       EQU   9                        WORK REGISTER                   01460000
R10      EQU   10                       WORK REGISTER                   01480000
R11      EQU   11                  ***  RETURN ADDRESS, SUBROUTINES     01500000
R12      EQU   12                # *    BASE REGISTER                   01520000
R13      EQU   13                # *    RETURN ADDRESS                  01540000
R14      EQU   14                       SAVE AREA ADDRESS        Y02072 01560002
R15      EQU   15                       WORK REGISTER                   01580000
*        # MEANS THAT THESE REGISTERS ARE SET UP BEFORE ENTRY           01600000
*            FROM SVC ROOT, AND MAY NOT BE DISTURBED                    01620000
*        * MEANS THAT THESE REGISTERS ARE SET UP BEFORE                 01640000
*            ANY ENTRY FROM THE                                         01660000
*           ASYNCHRONOUS ROUTINE, AND MAY NOT BE DISTURBED              01680000
*       ** MEANS THAT THESE REGISTERS ARE SET UP BEFORE                 01700000
*            THE DISCP45 AND DISCP7 ENTRIES FROM THE                    01720000
*            ASYNCHRONOUS ROUTINE, AND MAY NOT BE DISTURBED.            01740000
*      *** MEANS THAT THESE REGISTERS ARE SET UP BEFORE                 01760000
*            THE DISCP45, DISCP7, AND DISCPWKN ENTRIES FROM THE         01780000
*            ASYNCHRONOUS ROUTINE, AND MAY NOT BE DISTURBED.            01800000
         USING IGG019J0,R12                                             01820000
         USING IHADCW,R8                                                01840000
         USING IHAIOB,R1                                                01860000
         USING IHADCB,R4                                                01880000
         USING IHADECB,R2                                               01900000
         USING IGGSAVE,R14              SAVEAREA ADDRESSABILITY  Y02072 01910002
         SPACE 2                                                        01912002
DISQHN   B     QHNQAB1                  ADDRESS MACRO-TIME Q HANDLING   01920000
DISCP45  B     BMTS3B2                  ADDRESS CP4-CP5 SUB-ROUTINE     01940000
DISCP7   B     BMTS4A2                  ADDRESS CP7 SUB-ROUTINE         01960000
DISCPS   DS    A                        NOT USED THIS MODULE            01980000
DISCPWKN B     WKNS5B1                  ASYNCH ENTRY TO SET UP WKN CP   02000000
DISPRIV  B     QHNQAG1                  ASYNCH ENTRY TO SCHED R+U CP    02020000
*              CHART QA                                                 02040000
QHNQAB1  L     R3,IGGPDEB               PROTECTED DEB ADDR       Y02072 02060002
         L     R8,DCBWKPT2              R8   DCB WK AREA                02080000
         TM    DECBTYP2,X'08'           TEST WRITE KU W  UPDATE FLAG ON 02140000
         BZ    QHNQXB30                 BRANCH TO TEST ON ERROR Q P4700 02160000
         TM    DECBEXC2,X'01'                                           02180000
         BO    QHNQAB5                                                  02200000
QHNQXB30 LA    R5,DCWFIOBE              POINT TO ERROR QUEUE     A26738 02201019
         BAL   R15,SCHQUEUE             SEE IF DECB'S IOB HERE   A26738 02202019
         B     QHNQHB30                 IF NOT, TRY UPDATE QUEUE A26738 02203019
         IC    R9,DCWFIOBE              SAVE ERROR QUEUE COUNT   A26738 02204019
         BAL   R15,QHNQAC4              REMOVE FROM QUEUE        A26738 02205019
         LA    R9,1(R9)                 ROOM FOR ONE MORE        A26738 02206019
         STC   R9,DCWFIOBE              STORE NEW VALUE          A26738 02207019
         B     QHNQHB8                  GO CLEAR IOB             A26738 02208019
QHNQHB30 EQU   *                                                  MC1F  02209418
         LA    R5,DCWFUPDI              POINT TO UPDATE QUEUE    A26738 02210219
         BAL   R15,SCHQUEUE             SEE IF DECB'S IOB HERE   A26738 02211019
         B     QHNQAC3                  IF NOT, DO GETMAIN       A26738 02211819
*        IF SO, REDUCE DCWNACT AND REUSE THIS IOB.                      02212619
         IC    R6,DCWNACT               DECREASE NUMBER OF NON-  A26738 02213219
         BCTR  R6,R0                    WRITE KN MACRO EVENTS.    7S029 02213800
         STC   R6,DCWNACT                                         7S029 02213900
         BAL   R15,QHNQAC4              REMOVE FROM QUEUE        A26738 02215919
         B     QHNQHB8                  GO CLEAR IT              A26738 02217919
QHNQAC3  EQU   *                        *                        Y01021 02218100
         L     R1,IGGPDEB               PROTECTED DEB ADDR       Y02072 02223002
         LA    R0,SP250LN               SIZE OF BASIC IOB        Y02072 02223402
         USING IHADEB,R1                                         S20201 02224000
         TM    DEBRPSID,RPS             TEST IF RPS DEVICE USED  S20201 02225000
         BZ    QHNQAC31                 BIF NOT RPS              S20201 02226000
         AH    R0,RPSCCW                ADD LENGTH OF RPS CCWS   S20201 02227000
QHNQAC31 EQU   *                        *                        S20201 02228000
         SPACE 2                                                        02228402
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 02229002
         SPACE 2                                                        02229102
         STM   R2,R15,IGGREGS           SAVE REGISTERS 2-15      Y02072 02229402
         IC    R2,IGGUKEY               USERS PROTECT KEY        Y02072 02229902
         LR    R9,R14                   SAVE SAVE AREA ADDR      Y02072 02230302
         DROP  R14                      END SAVE AREA USING      Y02072 02230702
         L     R4,DEBTCBAD              TCB ADDRESS              Y02072 02231402
         USING PSA,R0                   LOW CORE ADDRESSABILITY  Y02072 02233402
         L     R7,PSAAOLD               ASCB ADDRESS             Y02072 02233602
         SPACE 2                                                        02233702
         MODESET  KEYADDR=KEY0,WORKREG=1  CHANGE TO KEY ZERO     Y02072 02233802
         SPACE 2                                                        02234002
         GETMAIN  RU,LV=(0),SP=SP250,KEY=(R2),BRANCH=YES   IOB   Y02072 02234402
         SPACE 2                                                        02234502
         USING IGGSAVE,R9               SAVEAREA ADDRESSABILITY  Y02072 02234702
         MODESET  KEYADDR=IGGUKEY,WORKREG=2 SET TO USER KEY      Y02072 02235802
         SPACE 2                                                        02235902
         LM    R2,R15,IGGREGS           RESTORE REGS 2-15        Y02072 02236202
         DROP  R9                       END SAVE AREA USING      Y02072 02236302
         USING IGGSAVE,R14              SAVEAREA ADDRESSABILITY  Y02072 02236402
         USING IHAIOB,R1                                         S20201 02236602
         B     QHNQHB85                 CLEAR IOB                A26738 02236802
QHNQHB8  TM    DECBTYP2,X'A0'           READ DECB                A26738 02237002
         BZ    QHNQHB81                 NO, BRANCH               A26738 02238002
         TM    DECBTYP1,X'01'           DYNAMIC BUFFERING        A26738 02239502
         BZ    QHNQHB81                 NO, BRANCH               A26738 02241002
         MVC   DECBAREA(4),IOBCCWAD     REUSE BUFFER IF PRESENT  A26738 02242502
         B     QHNQHB9                  CLEAR IOB                A26738 02244002
QHNQHB81 EQU   *                                                 A26738 02245502
         LA    R15,QHNQHB9                                       A33986 02247002
         L     R6,IOBCCWAD              DID IT HAVE A DYN BUFF    MC1F  02248502
QHNQHB83 LTR   R6,R6                                             A33986 02250002
         BCR   8,R15                   NO CLEAR IOB              A33986 02251502
         DROP  R1                       YES ,FREE DYN BUFF        MC1F  02253002
         LR    R0,R1                    SAVE IOB ADDRESS          MC1F  02254502
         L     R1,DCBBUFCB              SET UP BUFFER CNTL BLK    MC1F  02256002
         USING IHABCB,R1                                          MC1F  02257502
         MVC   0(4,R6),BCBNAVB          SET POINTER TO THIS       MC1F  02259002
         ST    R6,BCBNAVB               BUFFER &SET UP NXT AVAL   MC1F  02260502
*                                       BUFF                      MC1F  02262002
         DROP  R1                                                 MC1F  02263502
         LR    R1,R0                    RESET                     MC1F  02265002
         BR    R15                      CLEAR IOB                A33986 02266502
QHNQHB85 TM    DECBTYP2,X'A0'           IF READ AND DYN BUFF,    A26738 02268002
         BZ    QHNQHB9                  ZERO DECBAREA.           A26738 02269502
         TM    DECBTYP1,X'01'                                    A26738 02271002
         BZ    QHNQHB9                                           A26738 02272502
         XC    DECBAREA(4),DECBAREA                              A26738 02274002
         USING IHAIOB,R1                                          MC1F  02275502
QHNQHB9  XC    IOBFLAG1(56),IOBFLAG1    CLEAR IOB                 MC1F  02277002
         MVI   IOBFLAG1,X'02'            GET CORE AND INITIALIZE        02278502
         ST    R2,IOBECBAD                                              02280000
         ST    R2,IOBBCHAD              SAVE ECB                 A33533 02290021
         ST    R4,IOBDCBAD-1                                            02300000
         TM    DECBTYP2,X'04'            IF WKN, BRANCH           P4700 02306000
         BO    QHNQCB2                                            P4700 02312000
         B     QHNQAE3                                                  02420000
QHNQAB5  MVI   DECBEXC2,X'00'           RESET UPDATE FLAG               02440000
         LA     R5,DCWFUPDI             POINT TO UPDATE QUEUE    A26738 02470019
         BAL   R15,SCHQUEUE             SEE IF DECB'S IOB HERE   A26738 02500019
         B     QHNQAD5                  BR IF NOT THERE          A26738 02530019
         BAL   R15,QHNQAC4              REMOVE FROM QUEUE        A26738 02560019
         B     QHNQBD1                  SET UP CP 7              A26738 02590019
QHNQAD5  OI    DECBEXC1,X'10'           IF NOT THERE, TURN ON INVALID   02660000
QHNQAE5  BR    R13                       REQUEST BIT AND RETURN VIA SVC 02680000
         SPACE 2                                                        02680402
*        THIS ROUTINE SEARCHES THE IOB QUEUE POINTED TO BY REG 5        02681019
*        FOR A MATCH WITH THE DECB IN REG 2.  IF AN IOB IS FOUND        02682019
*        THE ROUTINE RETURNS AT REG 15 + 4. IF THE IOB IS ABSENT,       02683019
*        A RETURN IS MADE AT REG 15 + 0.                                02684019
         SPACE 2                                                        02684402
SCHQUEUE L     R1,0(R5)                 GET FIRST IOB            A26738 02685019
         LA    R1,0(R1)                 CLEAR HIGH ORDER BYTE    A26738 02686019
SCHQ2    LTR   R1,R1                    IS THIS AN IOB           A26738 02687019
         BZ    0(R15)                   RETURN IF NOT            A26738 02688019
         L     R6,IOBECBAD              IF IT IS, GET ITS DECB   A26738 02689019
         LA    R6,0(R6)                 CLEAR HIGH BYTE          A26738 02690019
         CLR   R2,R6                    IS THIS THE DECB SOUGHT  A26738 02691019
         BE    4(R15)                   BRANCH IF IT IS          A26738 02692019
         L     R1,IOBFCHAD              OTHERWISE, TRY THE NEXT  A26738 02693019
         B     SCHQ2                    GO CHECK IT              A26738 02694019
*                                                                       02695019
QHNQAC4  L     R6,IOBBCHAD              IF FOUND, REMOVE IT FROM Q      02700000
         LTR   R6,R6                                                    02720000
         BZ    QHNQAC41                                                 02740000
         MVC   IOBFCHAD-IHAIOB(4,R6),IOBFCHAD                           02760000
         B     QHNQAC42                                                 02780000
QHNQAC41 MVC   1(3,R5),IOBFCHAD+1       SET NEW 1ST IOB PTR      A26738 02800019
QHNQAC42 L     R6,IOBFCHAD                                              02820000
         LTR   R6,R6                                                    02840000
         BZ    QHNQAC43                                                 02860000
         MVC   IOBBCHAD-IHAIOB(4,R6),IOBBCHAD                           02880000
         BR    R15                      RETURN                   A26738 02900019
QHNQAC43 MVC   5(3,R5),IOBBCHAD+1       SET NEW LAST IOB PTR     A26738 02920019
         BR    R15                      RETURN                   A26738 02940019
QHNQAE3  TM    DCWWKNI,X'80'            AFTER IOB SET UP, TEST TO SEE   02960000
         BO    QHNQAE4                   IF WRITE KN WAITING OR IN      02980000
         CLI   DCWNUWKN,X'00'            PROCESS.                       03000000
         BE    QHNQAG1                  BRANCH IF NOT                   03020000
QHNQAE4  MVI   IOBUNSQR,X'08'            IF SO, INDICATE AWAITING W KN, 03040000
         B     QHNQBH2                  BRANCH TO PLACE ON UNSCHED Q    03060000
         SPACE 2                                                        03070002
*   ENTRY FROM ASYNCHRONOUS ROUTINE                                     03080000
         SPACE 2                                                        03090002
QHNQAG1  IC    R6,DCWNACT               INCREASE NACT - WRITE KN NOT    03100000
         LA    R6,1(R6)                  ALLOWED                        03120000
         STC   R6,DCWNACT                                               03140000
         TM    DECBTYP2,X'20'           IF READ KU, SET UPDATE          03160000
         BZ    QHNQAH2                   FLAG ON                        03180000
         OI    DECBEXC2,X'01'                                           03200000
         B     QHNQBB2                   AND BRANCH                     03220000
QHNQAH2  TM    DECBTYP2,X'08'           IF WRITING A BLOCKED RECORD TO  03240000
         BZ    QHNQBB2                   A PRIME DATA TRACK, THE KEY    03260000
         TM    DCBRECFM,X'10'            OF THE LAST RECORD NOT A       03280000
         BZ    QHNQBB2                   PADDING RECORD MUST REPLACE    03300000
         TM    DECBEXC1,X'02'            THE DECB KEY                   03320000
         BO    QHNQBB2                                                  03340000
         SR    R9,R9                    CLEAR REGISTER            10245 03350013
         L     R5,DECBAREA                R5  ADDRESS OF REC            03360000
         LA    R5,16(R5)                  R6  ADD FOR BXLE              03380000
         AH    R5,DCBBLKSI                R7  COMPARAND FOR BXLE        03400000
         LA    R6,1(0,0)                                                03420000
QHNQAK3  LR    R7,R5                                                    03440000
         BCTR  R7,0                                                     03460000
         SH    R5,DCBLRECL                                              03480000
         AH    R5,DCBRKP                                                03500000
         IC    R9,DCBKEYLE                                              03520000
QHNQAK32 CLI   0(R5),X'FF'                                              03540000
         BNE   QHNQAJ3                                                  03560000
         LA    R5,1(R5)                                                 03580000
         BCT   R9,QHNQAK32                                              03600000
         SH    R5,DCBRKP                                                03620000
         IC    R9,DCBKEYLE                                              03640000
         SR    R5,R9                                                    03660000
QHNQAK31 CLI   0(R5),X'FF'                                              03680000
         BNE   QHNQAJ3                                                  03700000
         BXLE  R5,R6,QHNQAK31                                           03720000
         SH    R5,DCBLRECL                                              03740000
         B     QHNQAK3                                                  03760000
QHNQAJ3  SH    R7,DCBLRECL               RECORD FOUND                   03780000
         LA    R7,1(R7)                   R7  ADDRESS OF KEY IN REC     03800000
         AH    R7,DCBRKP                                                03820000
         IC    R6,DCBKEYLE                R6  KEY LENGTH - 1            03840000
         BCTR  R6,0                                                     03860000
         L     R5,DECBKEY                 R5  ADDRESS WHERE KEY SAVED   03880000
         EX    R6,QHNQAJ31                                              03900000
         B     QHNQBB2                                                  03920000
QHNQAJ31 MVC   0(0,R5),0(R7)                                            03940000
*              CHART QB                                                 03960000
QHNQBC2  L     R5,DCWFCP4               TRACK AND DATA SRCH CP.         03980000
QHNQBB2  EQU   QHNQBC2                                                  04000000
         LTR   R5,R5                    BRANCH IF NONE AVAILABLE        04020000
         BZ    QHNQBE2                                                  04040000
         OI    IOBINDCT,X'80'           INDICATE REMOVE CP FROM Q       04060000
         BAL   R11,DISCP45              BRANCH TO SET UP CP ROUTINE     04080000
         B     QHNQBG3                  ERROR RETURN                    04100000
         B     QHNQBG4                  OK RETURN                       04120000
QHNQBG3  IC    R9,DCWNACT               DECREASE NO. OF NON-WRITE KN    04140000
         BCTR  R9,0                      MACRO EVENTS                   04160000
         STC   R9,DCWNACT                                               04180000
         B     QHNQBH4                  BRANCH                          04200000
QHNQBD1  L     R5,DCWFCP7               WRITE UPDATE CP                 04220000
         LTR   R5,R5                    BRANCH IF NONE AVAILABLE        04240000
         BZ    QHNQBE1                                                  04260000
         OI    IOBINDCT,X'80'           INDICATE REMOVE CP FROM Q       04280000
         BAL   R11,DISCP7               BRANCH TO SET UP CP ROUTINE     04300000
QHNQBG4  NI    IOBINDCT,X'BF'           SET OFF UNSCHEDULED BIT         04320000
         ST    R2,IOBBCHAD              SAVE ECB                 A33533 04330021
QHNQBH4  BR    R13                      RET TO ASYNCH RTN OR SVC ROOT   04340000
QHNQBE2  IC    R6,DCWNUCP4              NO CP4-5-6.                     04360000
         LA    R6,1(R6)                 ADD 1 TO NUMBER UNSCHED IOBS    04380000
         STC   R6,DCWNUCP4               AWAITING CP4-5-6.              04400000
         MVI   IOBUNSQR,X'40'           INDICATE REASON ON Q            04420000
         B     QHNQBH2                  BRANCH                          04440000
QHNQBE1  IC    R6,DCWNUCP7              NO CP7.                         04460000
         LA    R6,1(R6)                 ADD 1 TO NUMBER OF UNSCHED IOBS 04480000
         STC   R6,DCWNUCP7               AWAITING CP7                   04500000
         MVI   IOBUNSQR,X'20'           INDICATE REASON ON Q            04520000
QHNQBH2  L    R6,DCWLIOBU                                               04540000
         LTR   R6,R6                                                    04560000
         BZ    QHNQBH21                                                 04580000
         ST   R1,IOBFCHAD-IHAIOB(R6)                                    04600000
         B     QHNQBH22                                                 04620000
QHNQBH21 ST    R1,DCWFIOBU                                              04640000
QHNQBH22 ST    R6,IOBBCHAD                                              04660000
         ST   R1,DCWLIOBU                                               04680000
         XC    IOBFCHAD,IOBFCHAD                                        04700000
         OI    IOBINDCT,X'40'           SET UNSCHEDULED FLAG ON         04720000
         BR    R13                      EXIT   TO SVC ROOT OR ASYNCH    04740000
*                                                                       04750002
*              CHART QC   WRITE KN MACRO-TIME                           04760000
*                                                                       04770002
         USING IHAWKNCP,5                                               04780000
QHNQCB2  CLI   DCWNACT,X'00'            OTHER MACROS IN PROCESS   P4700 04860000
         BNE   QHNQCF2                                                  04940000
         TM    DCWWKNI,X'80'                                            04960000
         BO    QHNQCF2                                                  04980000
         OI    DCWWKNI,X'80'            IF NOT, INDICATE WKN IN PROCESS 05000000
         NI    IOBINDCT,X'BF'            UNSCHEDULED BIT OFF            05020000
         ST    R2,IOBBCHAD              SAVE ECB                 A33533 05030021
         BAL   R11,WKNS5B1               SET UP W KN CP                 05040000
         BR    R13                       RETURN BY SVC ROOT             05060000
QHNQCF2  IC    R6,DCWNUWKN              IS SO, ADD 1 TO NUMBER OF IOBS  05080000
         LA    R6,1(R6)                  AWAITING WKN MODULE            05100000
         STC   R6,DCWNUWKN                                              05120000
         MVI   IOBUNSQR,X'10'            INDICATE REASON ON Q           05140000
         B     QHNQBH2                   BRANCH                         05160000
         SPACE 2                                                        05210002
*              CHART S2  HIGHEST INDEX SEARCHED IN CORE                 05220000
         SPACE 2                                                        05230002
BMTS2B2  SR    R7,R7                    R7   KEY LENGTH - 1             05240000
         IC    R7,DCBKEYLE                                              05260000
         BCTR  R7,0                                                     05280000
         L     R6,DECBKEY               R6   ADDRESS OF KEY SOUGHT      05300000
         L     R5,DCBMSHI               R5   ADDRESS OF KEY ON TABLE    05320000
BMTS2B21 EX    R7,BMTS2B22              COMPARE KEY ON TABLE TO SOUGHT  05340000
         BNL   BMTS2C2                  IF HI OR EQ, BRANCH             05360000
         AR    R5,R7                                                    05380000
BMTS2E2  LA    R5,11(R5)                ELSE ADD KEY LGTH + INDEX LGTH  05400000
         B     BMTS2B21                  TO R5 FOR NXT KEY AND BRANCH   05420000
BMTS2C2  AR    R5,R7                    HIGH FOUND                      05440000
         TM    9(R5),X'20'              IF DUMMY-END OR INACTIVE, NO    05460000
         BZ    BMTS2D3                   REC FND. IF DUMMY-CHAINED,     05480000
         TM    9(R5),X'08'               SKIP THIS KEY                  05500000
         BO    BMTS2E2                                                  05520000
         OI    DECBEXC1,X'80'           NO REC FND. SET EXCEP CODE      05540000
         TM    DECBTYP1,X'01'           DYNAMIC BUFFERING        A33986 05540420
         BZ    BMTS2C4                  NO, BRANCH               A33986 05540820
         L     R6,DECBAREA                                       A33986 05541220
         LR    R7,R15                   SAVE REG 15             SA64081 05541302
         BAL   R15,QHNQHB83                                      A33986 05541620
         LR    R15,R7                   RESTORE REG 15          SA64081 05541702
BMTS2C4  LR    R0,R1                    R0= IOB ADDR             S20201 05542020
         L     R1,IGGPDEB               PROTECTED DEB ADDR       Y02072 05544002
         USING IHADEB,R1                                         S20201 05546020
         TM    DEBRPSID,RPS             TEST IF RPS DEVICE USED  S20201 05548020
         LR    R1,R0                    R1=IOB ADDR              S20201 05550020
         USING IHAIOB,R1                                         S20201 05552020
         LA    R0,SP250LN               GET SIZE OF BASIC IOB    Y02072 05556002
         BZ    BMTS2C41                 BIF NOT RPS              S20201 05560020
         AH    R0,RPSCCW                ADD LENGTH OF RPS CCWS   S20201 05564020
BMTS2C41 EQU   *                        *                        S20201 05568020
         L     R5,IOBCCWAD              RESTORE POINTER TO CP   SA67174 05568402
         SPACE 2                                                        05570002
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 05572002
         SPACE 2                                                        05572402
         STM   R2,R15,IGGREGS           SAVE REGISTERS 2-15      Y02072 05574002
         IC    R5,IGGUKEY               USERS PROTECT KEY        Y02072 05574802
         L     R4,IGGPDEB               PROTECTED DEB ADDR       Y02072 05574902
         DROP  R14                      END SAVE AREA USING      Y02072 05575002
         LR    R9,R14                   SAVE SAVE AREA ADDR      Y02072 05575202
         USING IHADEB,R4                DEB ADDRESSABILITY       Y02072 05575402
         L     R4,DEBTCBAD              TCB ADDRESS              Y02072 05575502
         DROP  R4                       END USING ON DEB         Y02072 05575602
         USING PSA,R0                   LOW CORE ADDRESSABILITY  Y02072 05575702
         L     R7,PSAAOLD               ASCB ADDRESS             Y02072 05575802
         SPACE 2                                                        05576802
         MODESET  KEYADDR=KEY0,WORKREG=3  CHANGE TO KEY ZERO     Y02072 05579002
         SPACE 2                                                        05579402
*                                       FREE IOB CORE            Y02072 05579802
         FREEMAIN  RU,LV=(0),A=(1),SP=SP250,KEY=(R5),BRANCH=YES  Y02072 05580002
         SPACE 2                                                        05583902
         DROP  R1                                                S20201 05588002
         USING IHADCB,R4                DCB ADDRESSABILITY       Y02072 05590002
         SPACE 2                                                        05594002
         SR    R10,R10                  POST COMPLETION CODE     Y02072 05596002
         LA    R11,DECBECB              ECB ADDRESS              Y02072 05598002
         LA    R11,0(R11)               CLEAR HIGH ORDER BYTE    Y02072 05598402
         L     R15,CVTPTR               CVT ADDRESS              Y02072 05598802
         USING CVT,R15                  CVT ADDRESSABILITY       Y02072 05599202
         L     R15,CVT0PT01             POST ENTRY POINT         Y02072 05599602
         DROP  R15                      END USING ON CVT         Y02072 05599702
*                                                                       05599802
         BALR  R14,R15                  GO POST COMPLETION       Y02072 05599902
*                                                                       05602102
         USING IGGSAVE,R9               SAVEAREA ADDRESSABILITY  Y02072 05604602
         SPACE 2                                                        05606602
         MODESET  KEYADDR=IGGUKEY,WORKREG=11 CHANGE TO USER KEY  Y02072 05606802
         SPACE 2                                                        05608802
         LM    R2,R15,IGGREGS           RESTORE REGISTERS 2-15   Y02072 05609002
         DROP  R9                       END SAVE AREA USING      Y02072 05611202
         USING IGGSAVE,R14              SAVEAREA ADDRESSABILITY  Y02072 05613402
         BR    R11                      ERROR RETURN                    05615602
         USING  IHAIOB,R1                                        S20201 05617802
BMTS2D3  MVC   IOBDADAD,1(R5)           IF KEY HI OR EQ + NOT DUMMY,    05620000
         L     R5,IOBCCWAD              RESTORE POINTER TO CP           05640000
         BR    R10                       MOVE ADDR TO IOB & OK RETURN   05660000
BMTS2B22 CLC   0(0,R5),0(R6)                                            05680000
*                                                                       05700000
*        CHART S3 SET UP CP4 AND CP5                                    05720000
*                                                                       05730002
         USING CP4,R5                                                   05740000
BMTS3B2  ST    R5,IOBCCWAD              SET POINTER TO CP IN IOB EXT    05760000
         CLI   DCWNLSD,X'00'            IF NLSD=0, TRACK IS HIGHEST LVL 05780000
         BNE   BMTS3D4                   INDEX.                         05800000
         TM    DCWHIAV,X'40'            UNLESS HIGH LVL IN CORE         05820000
         BZ    BMTS3C3                  BRANCH IF IT IS NOT      S20201 05830020
         BAL   R10,BMTS2B2              IF HI LVL IN CORE, SCH   S20201 05840020
         B     BMTS3D4                  GO TEST FOR SHARED TRACK S20201 05850020
BMTS3C3  EQU   *                        TRK IX IS HIGHEST LEVEL  S20201 05860020
         MVC   IOBDADAD(SEVEN),DCBFTHI  IF TRK HIGH,SET IOB ADDR S20201 05870020
BMTS3D4  EQU   *                        TEST FOR SHARED TRACK    S20201 05880020
         SR    R6,R6                    MBBCCHH  FROM HI INDEX   S20201 05890020
         AH    R6,DCBFIRSH              R MUST BE HIGHER THAN    S20201 05900020
         BNZ   BMTS3D5                  R OF LAST INDEX REC.     S20201 05910020
         MVC   IOBDADAD+SEVEN(ONE),DCBFIRSH+TWO THUS, R = FIRST  S20201 05917020
*                                       REC OF                   S20201 05924020
         B     BMTS3C2                  SHARED TRACK, IF SHARED. S20201 05931020
*                                       R = 255 OTHERWISE.              05940020
BMTS3D5  MVI   IOBDADAD+SEVEN,HEXFF     CHANGE R TO 255          S20201 05949020
BMTS3C2  TM    IOBINDCT,X'80'           IS CP4-5-6 ON AVAILABLE Q{      06080000
         BZ    BMTS3D1                  BRANCH IF NO                    06100000
         MVC   DCWFCP4,CP45PTR  REMOVE CP FROM AVAILABLE Q       A25517 06120019
BMTS3D1  EQU   *                        *                               06130000
         MVC   IOBSTART,IOBCCWAD+1      INITIALIZE IOB                  06160000
         NI    IOBFLAG1,X'7F'                                           06180000
         OI    IOBFLAG1,X'40'                                           06200000
         SR    R6,R6                                             S20201 06202020
         AH    R6,DCBFIRSH              IS 1ST TRK SHARED        S20201 06204020
         BZ    BMTS3F1                  BIF YES                  S20201 06206020
         LA    R6,CA5                   TIC CA5 IF NOT SHARED    S20201 06208020
         B     BMTS3F2                                           S20201 06210020
BMTS3F1  LA    R6,CA1                   TIC CA1 IF SHARED        S20201 06212020
BMTS3F2  EQU   *                        *                        S20201 06214020
         ST    R6,CA03                  STORE TIC ADDR           S20201 06216020
         MVI   CA03,TIC                 RESTORE OP CODE          S20201 06218020
         LA    R6,IOBDADAD+3            SET UP CHANNEL PROGRAM          06220000
         STH   R6,CA1+2                 KEY AND ID ADDRESSES            06240000
         STH   R6,CA01+2                                          17516 06244000
         SRL   R6,16                                              17516 06248000
         STC   R6,CA01+1                                          17516 06252000
         STC   R6,CA1+1                                           17516 06256000
         MVC   CA5+1(3),DECBKEY+1                                       06300000
         MVC   CA8+1(3),DECBKEY+1                                       06320000
         MVC   CA21+1(3),DECBKEY+1                                      06340000
         TM    DECBTYP1,X'02'           LENGTH - FROM DCB IF B6 OF TYPE 06360000
         BZ    BMTS3K1                           FROM DECB OTHERWISE    06380000
         MVC   CA23+6(2),DCBBLKSI                                       06400000
         B     BMTS3J2                                                  06420000
BMTS3K1  MVC   CA23+6(2),DECBLGTH                                       06440000
BMTS3J2  L     R6,DECBAREA              DATA ADDRESS TO AREA+16         06460000
         LA    R6,16(R6)                                                06480000
         STH   R6,CA23+2                                                06500000
         SRL   R6,16                                                    06520000
         STC   R6,CA23+1                                                06540000
         NI    CA24+FOUR,CCOFF          DISCONNECT WRT CHECK CP  S20201 06550020
         TM    DECBTYP2,X'E0'           WRITE OR READ{                  06560000
         BZ    BMTS3G3                                                  06580000
         MVI   CA23,X'06'               READ                            06600000
         MVI   IOBAPP,X'00'             SET APPENDAGE CODE TO ZERO      06620000
         TM    DCBRECFM,X'10'                                           06640000
         BZ    BMTS3J4                  SET CA21 TO SRCH HI/EQ IF BLKED 06660000
         MVI   CA21,X'69'                                               06680000
         B     BMTS3J4                                                  06700000
BMTS3G3  MVI   CA23,X'05'               WRITE                           06720000
         MVI   IOBAPP,X'01'                                             06740000
         TM    DCBRECFM,X'10'           SET CA21 TO SRCH = IF BLKED     06760000
         BZ    BMTS3J4                                                  06780000
         MVI   CA21,X'29'                                               06800000
BMTS3J4  TM    DCBOPTCD,X'80'           IF WRITE CHECK DESIRED,         06820000
         BZ    BMTS5E2                   SET UP ADDITIONAL COMMANDS     06840000
ANYREAD  EQU   X'E0'                                             S20201 06842020
ONES     EQU   1                                                 S20201 06844020
MIXED    EQU   4                                                 S20201 06846020
         TM    DECBTYP2,ANYREAD         NO WRT CHK IF READ       S20201 06848020
         BNZ   BMTS3J8                  BIF READ                 S20201 06850020
         OI    CA24+FOUR,CC             CONNECT WRT CHECK CP     S20201 06852020
         MVC   CA24D+1(3),CA1+1         CA24D ADDRESS FROM CA1          06880000
         MVC   CA24C+6(2),CA23+6        CA24C COUNT FROM CA23           06900000
         MVC   CA24F+1(7),CA23+1        CA24F ADDR AND COUNT FROM CA23  06920000
BMTS3J8  MVI   CA25+SEVEN,ZERO          CLEAR R                  S20201 06924020
         MVC   CA25+THREE(FOUR),IOBSEEK+THREE INIT CCHH          S20201 06928020
         OC    CA25+FIVE(THREE),DCBFIRSH INIT HHR                S20201 06932020
         B     BMTS5E4                                           S20201 06936020
BMTS5E2  EQU   *                                                 S20201 06939020
         USING CP4+(SZ5W-SZ5),R5                                 S20201 06942020
         MVI   CA25+SEVEN,ZERO          CLEAR R                  S20201 06945020
         MVC   CA25+THREE(FOUR),IOBSEEK+THREE INIT CCHH          S20201 06948020
         OC    CA25+FIVE(THREE),DCBFIRSH INIT HHR                S20201 06951020
BMTS5E4  EQU   *                        *                               06953000
         B     4(R11)                   RETURN, NO ERROR                06960000
*        CHART S4   SET UP CP7                                          06980000
         USING CP7,R5                                                   07000000
BMTS4A2  TM    IOBINDCT,X'80'           REMOVE FROM Q IF COMING FROM    07020000
         BZ    BMTS4B2                  MACRO                           07040000
         MVC   DCWFCP7,CA45+4                                           07060000
BMTS4B2  ST    R5,IOBCCWAD              INITIALIZE IOB                  07080000
         MVC   IOBSTART(3),IOBCCWAD+1                                   07100000
         NI    IOBFLAG1,X'7F'                                           07120000
         OI    IOBFLAG1,X'40'                                           07140000
         MVI   IOBAPP,X'02'              SET APPENDAGE CODE CODE TO 2   07160000
         LA    R6,IOBDADAD+3            SET UP CP7 - ADDRESS OF ID      07180000
         STH   R6,CA44+2                                                07200000
         SRL   R6,16                                                    07220000
         STC   R6,CA44+1                                                07240000
         L     R6,DECBAREA              ADDRESS OF AREA IN R6           07260000
         SR    R7,R7                    CLEAR R7 FOR DATA LENGTH        07280000
         TM    DECBEXC1,X'02'                                           07300000
         BZ    BMTS4F3                  TEST FOR OVERFLOW REC           07320000
         LA    R6,6(R6)                 OVRFLOW - ADD 6 TO AREA ADDRESS 07340000
         LA    R7,10(R7)                ADD 10 TO AREA LENGTH           07360000
         TM    DECBTYP1,X'02'           IF NO OVERRIDE ON LENGTH, ADD   07380000
         BZ    BMTS4G2                   DCB RECORD SIZE TO LENGTH      07400000
         AH    R7,DCBLRECL                                              07420000
         B     BMTS4J2                                                  07440000
BMTS4F3  LA    R6,16(R6)                PRIME REC-ADD 16 TO AREA ADDR   07460000
         TM    DECBTYP1,X'02'           IF NO OVERRIDE ON LENGTH, TAKE  07480000
         BZ    BMTS4G2                   FROM DCB BLOCK SIZE            07500000
         AH    R7,DCBBLKSI                                              07520000
         B     BMTS4J2                                                  07540000
BMTS4G2  AH    R7,DECBLGTH              LNGTH OVRRIDE,ADD DECB LENGTH   07560000
BMTS4J2  STH   R6,CA46+2                IN ANY CASE, MOVE COMPUTED      07580000
         SRL   R6,16                     LENGTH AND ADDRESS TO CP7      07600000
         STC   R6,CA46+1                 CCW CA46                       07620000
         STH   R7,CA46+6                                                07640000
         TM    DCBOPTCD,X'80'           WRITE CHECK DESIRED{            07660000
         BZ    BMTS4K4                  BRANCH IF NO                    07680000
         MVI   IOBCOUNT,10              SET ERROR COUNTER TO 10         07700000
         MVC   CA46A+1(3),CA44+1        CA46A ADDRESS FROM CA44         07720000
         MVC   CA46C+6(2),CA46+6        CA46C COUNT FROM CA46           07740000
BMTS4K4  BR    R11                      RETURN                          07760000
*                                                                       07770002
*                             SET UP FIRST CHANNEL PROGRAM              07780000
*                                                                       07782002
WKNS5B1  EQU   *                        *                               07790000
         NI    DCWWKNI,X'EF'            SET ADD-TO-END INDICATOR OFF    07820000
         TM    DCWHIAV,X'40'            ON IF HI LEVEL INDEX IN CORE    07840000
         BO    WKNS5B3                  SEARCH HI LEVEL INDEX IN CORE   07860000
         MVC   IOBDADAD(7),DCBFTHI      SET SEEK ADDRESS TO MBBCCHHX    07880000
         MVI   IOBDADAD+7,X'00'         R IS ZERO                       07900000
WKNS5E1  MVI   IOBAPP,X'08'             SET APPENDAGE CODE TO 8         07920000
WKNS5D1  EQU   WKNS5E1                                                  07940000
         L     R5,DCBWKPT3              R5   POINTER TO CP8             07960000
         USING IHAWKNCP,R5                                              07980000
         ST    R5,IOBCCWAD              CCW 0 RELATIVE ADDRESS          08000000
         LA    R6,CB1                   START OF CP8                    08020000
         ST    R6,IOBSTART-1                                            08040000
         MVI   IOBFLAG1,X'42'           B1 ON- YES CC                   08060000
         LA    R6,IOBDADAD+3                                            08080000
         STH   R6,CB1+2                                                 08100000
         SRL   R6,16                                                    08120000
         STC   R6,CB1+1                 SEEK-SEARCH ADDRESS AT CB1      08140000
         MVC   CB5+1(3),DECBKEY+1       ADDR OF KEY TO CP8              08160000
         MVC   CB19+1(3),DECBKEY+1                                      08180000
         MVC   CB23+THREE(FIVE),IOBDADAD+THREE CCHH OF FIRST     S20201 08185020
*                                       TRACK, R=                S20201 08190020
         OC    CB23+FIVE(THREE),DCBFIRSH SET HHR TO FIRSH        S20201 08195020
         B     WKNS5G2                                                  08200000
WKNS5B3  SR    R6,R6                    CLEAR WORK REGISTER             08220000
         IC    R6,DCBKEYLE              KEY LENGTH IN LOW ORDER BYTE    08240000
         BCTR  R6,0                     COMPARE KEY LENGTH BYTES        08260000
         L     R7,DECBKEY               POINTER TO STORAGE ARGUMENT     08280000
         L     R10,DCBMSHI              POINTER TO INDEX ARGUMENT       08300000
WKNS5B31 EX    R6,WKNS5B34              MODIFY COMPARE LENGTH           08320000
         BNL   WKNS5C3                  FIRST HI OR EQUAL               08340000
         AR    R10,R6                   INCREMENT IS KEYLE-1            08360000
WKNS5B32 LA    R10,11(0,R10)            PLUS 11 MORE (= KEYLE+10)       08380000
         B     WKNS5B31                 TRY AGAIN                       08400000
WKNS5B34 CLC   0(0,R10),0(R7)           LENGTH, INDEX ARG, STORAGE ARG  08420000
WKNS5C3  AR    R10,R6                   NOW POINT TO FLAG BYTE MINUS 9  08440000
         TM    9(R10),X'28'             TEST IF DUMMY CHAINED           08460000
         BO    WKNS5B32                 SKIP ENTRY - TRY AGAIN          08480000
         TM    9(R10),X'20'             TEST IF INACTIVE OR DUMMY END   08500000
         BO    WKNS5C5                       ADD TO END OF DATA SET     08520000
         MVC   IOBDADAD(7),1(R10)       SET SEEK ADDRESS TO MBBCCHHX    08540000
         MVI   IOBDADAD+7,X'00'         R IS ZERO                       08560000
         B     WKNS5D1                  CONTINUE                        08580000
*                                                                       08590002
*              SET UP CP15                                              08600000
*                                                                       08610002
WKNS5C5  MVC   IOBDADAD(3),DCBLPDA      MBB FROM LPDA                   08620000
         MVC   IOBDADAD+3(4),DCBLETI    CCHH FROM LETI                  08640000
         OC    IOBDADAD+6(1),DCBFIRSH+3                                 08660000
         XC    IOBDADAD+6(1),DCBFIRSH+3                                 08680000
         MVI   IOBDADAD+7,X'00'                                         08700000
         MVI   IOBAPP,X'0E'             SET APPENDAGE CODE TO 14        08720000
         L     R5,DCBWKPT3              PUT CP8 ADDRESS IN REG 5        08740000
         ST    R5,IOBCCWAD              CCW 0 RELATIVE ADDRESS          08760000
         TM    DCBOPTCD,X'80'                WRITE CHECK?               08780000
         BZ    WKNS5C51                      NO                         08800000
         LA    R5,WC(R0,R5)             ALLOW FOR WRITE CHECK    S20201 08810020
*                                       CCWS                     S20201 08820020
WKNS5C51 LA    R5,CI1-WC                START OF CP15            S20201 08830020
         USING CP15,R5                                           S20201 08840020
         ST    R5,IOBSTART-ONE                                   S20201 08860020
         MVI   IOBFLAG1,FLAGS           B1 ON- YES CC            S20201 08870020
         MVC   CI5+TWO(FIVE),DCBLETI    COUNT ADDR               S20201 08880020
         MVC   CI5(TWO),DCBLPDA+ONE     SET UP BB FOR HEAD SEEK  S20201 08900020
         LA    R6,IOBDADAD+3                                            08920000
         STH   R6,CI1+2                                                 08940000
         SRL   R6,16                                                    08960000
         STC   R6,CI1+1                 SEEK-SEARCH ADDRESS AT CI1      08980000
WKNS5G2  EQU   *                        *                               08990000
         BR    R11                                                      09020000
*                                                                       09021020
ZERO     EQU   0                        0                        S20201 09022020
ONE      EQU                            1                        S20201 09023020
TWO      EQU   2                        2                        S20201 09024020
THREE    EQU   3                        3                        S20201 09025020
FOUR     EQU   4                        4                        S20201 09026020
FIVE     EQU   5                        5                        S20201 09027020
SEVEN    EQU   7                        7                        S20201 09028020
FLAGS    EQU   X'42'                    IOB FLAGS                S20201 09029020
CCOFF    EQU   X'BF'                    TURN OFF COMAND CHAIN    S20201 09030020
HEXFF    EQU   X'FF'                    255                      S20201 09031020
RPS      EQU   X'E0'                    RPS MASK-BIT 0=P,1=I,2=O S20201 09035020
RPSCCW   DC    H'16'                    LENGTH OF RPSCCW'S       S20201 09039020
*                                                                       09043002
SP250LN  EQU   56                       BASIC IOB = 56 BYTES IN  Y02072 09047002
SP250    EQU   250                      SP 250                   Y02072 09051002
KEY0     DC    X'00'                    ZERO PROTECT KEY         Y02072 09053002
         DS    0F                       ALIGN FOR PATCH AREA     Y02072 09053102
*                                                                       09053402
PATCH    DC    XL((*-IGG019J0)/20)'00'  ZEROED PATCH AREA        Y02072 09053802
*                                                                       09054202
         EJECT                                                          09055020
*              MODULE WORK AREAS                                        09060000
WKNS5MSK DC    X'FF'                    TO SET ON SYSTEM MASK           09080000
IHABCB   DSECT                                                  , MC1F  09083018
BCBFIOB  DS    A                                                  MC1F  09086018
BCBLIOB  DS    A                                                  MC1F  09089018
BCBNAVB  DS    A                                                  MC1F  09092018
BCBSIZE  DS    A                                                  MC1F  09095018
IHAWKNCP IGGWKNCP   OPTCD=W                                      S20201 09295020
WC       EQU   LCH3C+LCH8C+LCH13C+LCH18C+LCH22C+LCB54C WRITE CHK S20201 09495020
*                                       CCWS                     S20201 09695020
         EJECT                                                          09745002
*                                                                       11540000
*              DATA EVENT CONTROL BLOCK                                 11560000
IHADECB  DSECT                                                          11580000
         DS    0F                                                       11600000
DECBECB  DS    CL4                      EVENT CONTROL BLOCK (ECB)       11620000
DECBTYP1 DS    BL1                      TYPE B6 - 1 IF LENGTH IS S      11640000
*                                            B7 - 1 IF AREA IS S        11660000
DECBTYP2 DS    BL1                           B0 - 1 IF READ K           11680000
*                                            B1 - 1 IF READ KX          11700000
*                                            B2 - 1 IF READ KU          11720000
*                                            B4 - 1 IF WRITE K          11740000
*                                            B5 - 1 IF WRITE KN         11760000
DECBLGTH DS    CL2                      LENGTH OF BLOCK                 11780000
DECBDCBA DS    A                        POINTER TO DCB                  11800000
DECBAREA DS    A                        ADDRESS OF AREA                 11820000
DECBLOGR DS    A                        POINTER TO LOGICAL RECORD       11840000
DECBKEY  DS    A                        POINTER TO KEY                  11860000
DECBEXC1 DS    BL1                      EXCPTN CD B0-RECORD NOT FOUND   11880000
*                                                 B1-RECORD LGTH CHK    11900000
*                                                 B3-INVALID REQUEST    11920000
*                                                 B4-UNCORRECTABLE IO   11940000
*                                                 B5-UNREACHABLE BLOCK  11960000
*                                                 B6-OVERFLOW RECORD    11980000
*                                                 B7-DUPLICATE REC      12000000
DECBEXC2 DS    BL1                                B7-READ KU            12020000
*        SAVE AREA FOR PRIVILEGES AND ASYNCHRONOUS ROUTINES      Y02072 12030002
IGGSAVE  DSECT                                                          12032002
IGGRETRN DS    A                        RETURN ADDRESS                  12034002
IGGPDEB  DS    A                        VALIDATED DEB ADDR              12036002
IGGUKEY  DS    X                        USER PROTECT KEY                12038002
IGGRESRV DS    XL3                      RESERVED                        12038402
IGGREGS  DS    16F                      REGISTER SAVE AREA              12039202
IGGSIZE  EQU   *-IGGSAVE                LENGTH OF SAVE AREA             12039602
         EJECT                                                          12039702
         DCBD  DSORG=(IS)                                               12040000
IHAIOB   IGGIOBD                                                        12060020
IOBSEEK  EQU   IOBDADAD                                          S20201 12080020
         SPACE 5                                                        12130002
IHADCW   IGGBISAM                                                       12140020
         SPACE 5                                                        12190002
IHADEB   IGGDEBD                                                        12220020
*                                                                       12620020
         SPACE 5                                                        12670002
IHACP47  IGGCP47   OPTCD=W                                       S20201 13020020
CP45PTR  EQU   CA02+4                                            S20201 13520020
         EJECT                                                          13570002
CVT      DSECT                                                   Y02072 13620002
         CVT                                                     Y02072 13670002
         SPACE 4                                                        13720002
         IHASCVT                                                 Y02072 13770002
         SPACE 4                                                        13820002
         IHAPSA                                                  Y02072 13870002
         END                                                            14680000
