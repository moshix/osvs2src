         TITLE 'IGG019MB - BTAM CHANNEL END/ABNORMAL END APPENDAGE'     00030000
*********************************************************************** 00150000
*                                                                     * 00200000
* MODULE NAME: IGG019MB   (OS/VS)                                     * 00450000
*                                                                     * 00470000
* DESCRIPTIVE NAME: BTAM CHANNEL END/ABNORMAL END APPENDAGE           * 00490000
*                                                                     * 00510000
* COPYRIGHT: NONE                                                     * 00530000
*                                                                     * 00550000
* STATUS: RELEASE 2                                                   * 00570000
*                                                                     * 00590000
* FUNCTION:         SERVICE BTAM DEPENDENT I/O INTERRUPTS             * 00610000
*                        1.  PROVIDE CHANNEL PROGRAM RESTARTS         * 00630000
*                        2.  POST BUFFERS FOR DYNAMIC BUFFERING       * 00650000
*                        3.  UPDATE THE USER'S DECB                   * 00670000
*                                                                     * 00690000
* ENTRY POINT:      ENTRY IS TO 1ST EXECUTABLE INSTRUCTION FROM IOS   * 00710000
*                                                                     * 00730000
* INPUT:            REGISTER  2 - ADDRESS OF THE IOB                  * 00750000
*                   REGISTER  3 - ADDRESS OF THE DEB                  * 00770000
*                   REGISTER  4 - ADDRESS OF THE DCB                  * 00790000
*                   REGISTER  7 - ADDRESS OF THE UCB                  * 00810000
*                   REGISTER 14 - RETURN ADDRESS                      * 00830000
*                                                                     * 00850000
* OUTPUT:           1.  CHANNEL PROGRAM RESTARTS - UPDATED DECB AND   * 00870000
*                        IOB FIELDS.                                  * 00890000
*                   2.  BUFFER POSTS - COMPLETION CODE IN THE BUFFER. * 00910000
*                   3.  UPDATED SENSE, COMMAND AND STATUS FIELDS IN   * 00930000
*                        THE DECB                                     * 00950000
*                                                                     * 00970000
* EXTERNAL ROUTINES:1.  REQUEST-RELEASE BUFFER ROUTINE                * 00990000
*                   2.  SUPERVISOR POST ROUTINE                       * 01010000
*                   3.  PAGE SERVICES ROUTINE (DYNAMIC                * 01030000
*                       BUFFERING ONLY)                               * 01050000
*                                                                     * 01070000
* EXIT:             RETURN TO IOS VIA REGISTER 14+0 NORMALLY,         * 01090000
*                                                +4 FOR ON-LINE TEST  * 01110000
*                                                   OR WHEN A SAD OR  * 01130000
*                                                   ENABLE ERROR      * 01150000
*                                                   OCCURS            * 01170000
*                                                +8 FOR RESTART OF CP * 01190000
*                                                                     * 01210000
* IN LINE ROUTINES: THE TP OP CODE IS USED AS AN INDEX TO BRANCH TO   * 01230000
*                        THE APPROPIATE ROUTINE WITHIN THE CHANNEL    * 01250000
*                        END APPENDAGE.  THE SEQUENCE OF PROCESSING   * 01270000
*                        IS INITIALIZATION AND CHECKING FOR ANY       * 01290000
*                        ERRORS, TP OP CODE ROUTINE, AND THEN EXITING.* 01310000
*                        THE VARIOUS ROUTINES ARE -                   * 01330000
*                        1.  POLLING RESTART - TO RESTART POLLING     * 01350000
*                             AFTER A NEGATIVE RESPONSE.              * 01370000
*                        2.  ADDRESSING RESTART - TO RESTART          * 01390000
*                             ADDRESSING AFTER A NEGATIVE RESPONSE.   * 01410000
*                        3.  READ OR WRITE DATA - TO RELEASE A BUFFER * 01430000
*                             OR PURGE A BUFFER REQUEST ON A READ     * 01450000
*                             WITH DYNAMIC BUFFERING, AND POST THE    * 01470000
*                             LAST BUFFER FOR READS AND WRITES.       * 01490000
*                        4.  ENABLE COMPLETE - TO RESTART THE CHANNEL * 01510000
*                             PROGRAM AFTER AN ENABLE HAS COMPLETED.  * 01530000
*                        5.  COMPARE TWX IDENT - TO CHECK THE TWX     * 01550000
*                             IDENTIFICATION.                         * 01570000
*                        6.  READ SKIP - TO SET APPROPRIATE ERROR     * 01590000
*                             INDICATION FOR LOST DATA.               * 01610000
*                        7.  READ RESPONSE, RESET - TO ASSURE THAT    * 01630000
*                             THE LAST BUFFER WAS POSTED.             * 01650000
*                        8.  TPXX - TO FIND THE DATA CCW.             * 01670000
*                        9.  POST BUFFER ROUTINE - TO SET UP THE      * 01690000
*                             PARAMETERS TO POST AND LINK TO THE      * 01710000
*                             SUPERVISOR POST ROUTINE.                * 01730000
*                       10.  READ INQUIRY - RESTART CHANNEL PROGRAM   * 01750000
*                             WHEN INQ IS RECEIVED.  RESET ACK        * 01770000
*                             POINTERS.                               * 01790000
*                       11.  READ RESPONSE TO INQUIRY - RESTART       * 01810000
*                             CHANNEL PROGRAM AND RESET ACK POINTERS. * 01830000
*                       12.  READ RESPONSE TO TEXT - TEST FOR PROPER  * 01850000
*                             RESPONSE AND UPDATE ACK POINTERS.       * 01870000
*                                                                     * 01890000
* ATTRIBUTES:       THIS ROUTINE IS REENTERANT, ENABLED, AND          * 01910000
*                   RUNS IN SUPERVISOR STATE WITH THE LOCAL           * 01930000
*                   LOCK HELD BY IOS.                                 * 01950000
*                                                                     * 01970000
* CHANGE ACTIVITY AS FOLLOWS:                                         * 01990000
*            APARS                           PTMS                     * 02010000
*       YA02157  (10/1/73)               YM4057  (10/3/73) NO CODE    * 02030000
*       YA02469  (10/1/73)               YM4063  (10/3/73)            * 02050000
*       YA01017  (10/19/73)              YM5663  (12/11/73) PROLOG    * 02070000
*       YA01019  (10/19/73)                                           * 02090000
*       YA01020  (10/19/73)                                           * 02110000
*       YA01026  (10/19/73)                                           * 02130000
*       YA01027  (10/19/73)                                           * 02150000
*       YA01030  (10/19/73)                                           * 02170000
*       YA01239  (10/19/73)                                           * 02190000
*       YA01275  (10/22/73)                                           * 02210000
*       YA01553  (10/22/73)                                           * 02230000
*       YA02161  (10/22/73)                                           * 02250000
*       YA02162  (10/23/73)                                           * 02270000
*       YA02163  (10/23/73)                                           * 02290000
*       YA02164  (10/23/73)                                           * 02310000
*       YA02165  (10/23/73)                                           * 02330000
*       YA02448  (10/23/73)                                           * 02350000
*       YA02453  (10/23/73)                                           * 02370000
*       YA02472  (10/24/73)                                           * 02390000
*       YA03238  (2/2/74)                                             * 02410000
*       YA03243  (2/2/74)                                             * 02430000
*       YA03266  (2/4/74)                                             * 02450000
*       YA03275  (2/7/74)                                             * 02470000
*                                                                     * 02490000
*       ZA00529  (11/14/74) REMOVED BY AZ03588                        * 02510000
*       ZA00536  (11/14/74)                                           * 02530000
*       ZA02312  (11/14/74)                                           * 02550000
*       ZA02313  (11/14/74)                                           * 02570000
*       ZA02314  (11/14/74)                                           * 02590000
*       ZA02315  (11/14/74)                                           * 02610000
*       ZA02316  (11/14/74)                                           * 02630000
*       ZA02317  (11/14/74)                                           * 02650000
*       ZA02318  (11/14/74)                                           * 02670000
*       ZA02319  (11/14/74)                                           * 02690000
*       ZA02320  (11/14/74)                                           * 02710000
*       ZA02321  (11/14/74)                                           * 02730000
*       ZA02322  (11/14/74)                                           * 02750000
*       ZA02323  (11/14/74)                                           * 02770000
*       ZA02324  (11/14/74)                                           * 02790000
*       ZA02325  (11/14/74)                                           * 02810000
*       ZA02327  (11/14/74)                                           * 02830000
*       ZA02339  (11/22/74)                                           * 02850000
*       ZA02814  (01/16/75)                                           * 02870000
*       ZA02845  (02/28/75)                                           * 02890000
*       AZ03588  (07/02/75)                                           * 02910000
*       AZ03598  (04/30/75)                                           * 02930000
*       AZ03966  (04/09/75)                                           * 02950000
*       AZ03967  (04/09/75)                                           * 02970000
*       AZ04157  (07/15/75)                                           * 02990000
*       AZ04190  (07/02/75)                                           * 03010000
*       AZ04192  (07/15/75)                                           * 03030000
*       AZ04195  (07/15/75)                                           * 03050000
*       AZ04196  (07/16/75)                                           * 03070000
*       AZ04650  (07/14/75)                                           * 03090000
*       AZ04679  (10/20/75)                                           * 03110000
*       AZ04852  (10/21/75)                                           * 03130000
*       AZ04873  (10/21/75)                                           * 03150000
*       AZ04877  (10/21/75)                                           * 03170000
*       AZ06398  (11/05/75)                                           * 03190000
*       AZ06404  (10/21/75)                                           * 03210000
*       AZ07638  (11/05/75)                                           * 03230000
*       AZ08045  (03/10/76)        AZ11419  (07/21/76)                * 03250000
*       AZ14067  (11/01/76)        AZ14068  (11/01/76)                * 03270000
*       AZ14069  (11/01/76)        AZ14070  (11/01/76)                * 03290000
*       AZ14071  (11/01/76)        AZ13190  (11/01/76)                * 03310000
*       AZ14130  (11/01/76)        AZ15402  (05/03/77)                * 03330000
*       AZ15430  (11/30/76)        AZ24728  (09/27/77)                * 03350000
*       AZ31078  (03/16/78)        AZ31183  (04/03/78)                * 03370000
*********************************************************************** 03390000
         EJECT                                                          03410000
IGG019MB CSECT                                                          03430000
         SPACE 5                                                        03450000
ZREG     EQU   0                        PARAMTER REGISTER               03470000
ICREG    EQU   1                        SINGLE BYTE WORK REGISTER       03490000
VSLREG   EQU   1                   VIRTUAL SUBAREA LIST ADDR     Y02947 03510000
IOBREG   EQU   2                        INPUT/OUTPUT BLOCK ADDRESS      03530000
DEBREG   EQU   3                        DATA EXTENT BLOCK ADDRESS       03550000
DCBREG   EQU   4                        DATA CONTROL BLOCK ADDRESS      03570000
CCWREG   EQU   5                        CHANNEL COMMAND WORD ADDRESS    03590000
CCW2REG  EQU   6                        CHANNEL COMMAND WORD ADDRESS    03610000
UCBREG   EQU   7                        UNIT CONTROL BLOCK ADDRESS      03630000
WREG     EQU   8                        ADDRESS WORK REGISTER           03650000
TCBREG   EQU   8                        TCB ADDR                 Y02947 03670000
W2REG    EQU   9                        ADDRESS WORK REGISTER           03690000
ECBREG   EQU   10                       EVENT CONTROL BLOCK ADDRESS     03710000
BUFREG   EQU   11                       BUFFER ADDRESS                  03730000
SAVEREG  EQU   11                       WORK REGISTER                   03750000
BASEREG  EQU   12                       BASE REGISTER                   03770000
SAVEAREA EQU   13                       SAVE AREA ADDRESS        Y02947 03790000
RETREG   EQU   14                       RETURN ADDRESS                  03810000
BAS2REG  EQU   14                       SECOND BASE              Y02947 03830000
BRREG    EQU   15                       ENTRY POINT ADDRESS             03850000
         SPACE 3                                                        03870000
         USING IECTDECB,ECBREG                                          03890000
         USING IECTIOB,IOBREG                                           03910000
         USING IHADCB,DCBREG                                            03930000
         USING *,BASEREG,BAS2REG                                        03950000
         STM   RETREG,SAVEAREA,DISP0(SAVEAREA)  SAVE REGISTERS   Y02947 03970000
         LR    BASEREG,BRREG                                            03990000
         LA    BAS2REG,2048(BASEREG)    SET UP SECOND                   04010000
         LA    BAS2REG,2048(BAS2REG)         BASE REGISTER              04030000
         B     LOADECB                                                  04050000
         DC    C'IGG019MB'                                       Y20947 04070000
         DC    C',VS2/R2, '                                     YA03243 04090000
         DC    XL3'017827'              PTF NUMBER                      04110000
         DC    CL8'&SYSDATE'                                            04130000
         DS    0F                                                Y02947 04150000
PATCH    DC    XL250'00'           PATCH AREA                    Y02947 04170000
FOURK    DC    F'4096'                                           Y02947 04190000
LOADECB  DS    0H                                                       04210000
         L     ECBREG,IOBECBPT          LOAD ADDRESS OF DECB            04230000
         LA    ECBREG,0(ECBREG)         CLEAR HI ORDER BYTE    @ZA08045 04250000
         LTR   ECBREG,ECBREG            IS THERE A DECB        @ZA08045 04270000
         BZ    EXITREST                 NO                     @ZA08045 04290000
         CLI   DECTYPE,XFF              IS IT A DUMMY DECB     @ZA08045 04310000
         BNE   DECBOK                   NO                     @ZA08045 04330000
         L     ECBREG,DISP4(ECBREG)      GET REAL DECB         @ZA08045 04350000
         LA    ECBREG,0(ECBREG)         CLEAR HI ORDER BYTE    @ZA08045 04370000
DECBOK   L     CCWREG,IOBCSW            LOAD CCW ADDRESS       @ZA08045 04390000
         LA    CCWREG,0(CCWREG)         INSURE VALID ADDRESS     A33189 04410000
         TM    IOBFLAG1,IOBEXE          IS ERP IN CONTROL          000B 04430000
         BO    EXITREST                 RETURN TO IOS              000B 04450000
         TM    IOBINCAM,X'80'           SAD OR ENABLE ERROR OCCUR       04470000
         BO    ERREXIT                  YES, EXIT                       04490000
         TM    IOBINCAM,SENSTA          HAS 3270 SENSE/STATUS  @ZA14130 04510000
*     MESSAGE BEEN PROCESSED? (SOH % R)                        @ZA14130 04530000
         BO    SOHRCOMP            YES, GO TURN OFF BIT AND             04550000
*                                  GET OUT                              04570000
         CLI   IOBWORK+ONE,SPFLAG  CHECK SPCAL FLAG FROM 504C  @ZA04679 04590000
         BNE   SUBTR8                   NOT ON SO BRANCH       @ZA04679 04610000
         MVI   IOBWORK+ONE,K0           ZERO OUT SPECIAL FLAG  @ZA04679 04630000
         B     REXIT1                                          @ZA04679 04650000
*                                                                       04670000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04690000
*                                                                    *  04710000
*  THIS ROUTINE IS USED TO RESET THE UCBINHIO BIT IN THE UCB COMMON  *  04730000
*  EXTENTION X'05', WHICH INHIBITS HIO WHEN IN RECEIVE MODE.         *  04750000
*                                                                    *  04770000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04790000
*                                                                       04810000
SUBTR8   TM    IOBINCAM,ONLTT          IS ONLINE TEST IN USE   @ZA24728 04830000
         BO    NOCLR                   YES DO NOT CLEAR        @ZA24728 04850000
         XC    IOBERINF(4),IOBERINF    CLEAR WORK AREA         @ZA24728 04870000
NOCLR    EQU   *                                               @ZA24728 04890000
         L     W2REG,UCBEXTPT(UCBREG)  GET ADDRESS OF UCB EXT  @ZA15402 04910000
         TM    5(W2REG),X'10'          IS UCBINHIO BIT ON?     @ZA15402 04930000
         BNO   NOHIOBIT                NO, BRANCH              @ZA15402 04950000
         L     WREG,4(W2REG)           GET 4 BYTES OF UCB EXT  @ZA15402 04970000
TRYRESET LR    IOBREG,WREG             LOAD SAME 4 BYTES       @ZA15402 04990000
         N     IOBREG,RESETMSK         RESET THE UCBHINHIO BIT @ZA15402 05010000
         CS    WREG,IOBREG,4(W2REG)    RESET BIT, IF OK        @ZA15402 05030000
         BNE   TRYRESET                IF NOT, TRY AGAIN       @ZA15402 05050000
         L     IOBREG,DISP16(SAVEAREA) RESTORE IOBREG          @ZA15402 05070000
*                                                                       05090000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  05110000
*                                                                       05130000
NOHIOBIT SH    CCWREG,K8               SUBTRACT 8 TO LAST CCW  @ZA15402 05150000
         BP    LDTP                                                     05170000
         TM    IOBSIOCC,X'30'           TEST FOR OPERATIONAL SIO        05190000
         BO    SIOCC1                   IF NOT, BRANCH                  05210000
         OI    DECERRST,SNO             SET ON SHOULD NOT OCCUR BIT     05230000
         B     CSWADR                                              000A 05250000
LDTP     IC    ICREG,5(CCWREG)          LOAD TPOP CODE                  05270000
         N     ICREG,TPMSK              AND OF BITS 0-3                 05290000
         SLL   ICREG,3                  MULTIPLY BY 8                   05310000
         TM    IOBCSW+4,X'F2'           TEST FOR ERROR IN CSW STATUS    05330000
         BNZ   SIOCC                    BRANCH IF SO                    05350000
         TM    IOBCSW+5,X'3F'           TEST CSW STATUS, 2ND BYTE       05370000
         BZ    NORMAL                   BRANCH IF NO ERRORS             05390000
SIOCC    TM    IOBSIOCC,X'30'           TEST SIO COMPLETION CODE        05410000
         BNO   SIOCC10                  BRANCH IF OPERATIONAL SIO       05430000
SIOCC1   OI    DECERRST,X'80'           SET ON BIT 0 IN ERROR STATUS    05450000
         B     CSWADR                                                   05470000
SIOCC10  TM    IOBSIOCC,X'10'           TEST FOR CSW STORED             05490000
         BZ    ABNORMAL                 BRANCH IF NOT                   05510000
CSWADR   MVC   IOBCSW+1(3),IOBSTART+1   MOVE START ADDRESS              05530000
         L     WREG,IOBCSW              LOAD IT,                        05550000
         AH    WREG,K8                  ADD 8                           05570000
         ST    WREG,IOBCSW              AND STORE                       05590000
         L     CCWREG,IOBSTART                                          05610000
         B     TPXX                                                     05630000
ABNORMAL AH    ICREG,K4                 ADD 4 FOR ABNORMAL ENTRIES      05650000
NORMAL   TM    5(CCWREG),X'30'          DETERMINE BRANCH TABLE FOR      05670000
         BZ    TP0X(ICREG)              NORMAL ENTRIES                  05690000
         BO    BSC2ONLT              3X TP FOR ERROR RECOVERY   YA02472 05710000
*                                    AND 3275 DIAL ON-LINE TEST YA02472 05730000
         TM    5(CCWREG),X'20'                                          05750000
         BZ    TP1X(ICREG)                                              05770000
         B     TP2X(ICREG)                                              05790000
         EJECT                                                          05810000
TP0X     B     TP00                               00                    05830000
         B     TP00AB                   MAL                             05850000
         B     TP01           DIS,DIAL,ENABLE     01                    05870000
         B     TPXX                ABNORMAL                             05890000
         B     TP02           EOT SEQUENCE        02               000A 05910000
         B     TP02AB              ABNORMAL                        000A 05930000
         B     TP03           POLL,ADRS CHAR      03               000A 05950000
         B     TP03AB              ABNORMAL                        000A 05970000
         B     TPXX           SPACE,SHIFT,ETC     04                    05990000
         B     TPXX                ABNORMAL                             06010000
         B     TP05           RD RESPONSE TO POLL 05                    06030000
         B     TP05AB              ABNORMAL                             06050000
         B     TP06           RD RESPONSE TO ADRS 06                    06070000
         B     TPXX                ABNORMAL                             06090000
         B     TP07           RD TWX              07                    06110000
         B     TPXX                ABNORMAL                             06130000
         B     TPXX           EOA CHARACTER       08                    06150000
         B     TPXX                ABNORMAL                             06170000
         B     TP09           AUTOPOLL NOP        09               000A 06190000
         B     TP09AB              ABNORMAL                        000A 06210000
         B     TP0A           AUTOPOLL READ INDEX 0A             A25689 06230000
         B     TP0AAB                   ABNORMAL                   000C 06250000
         B     TP0B           RD RESPONSE TO PREP 0B               000B 06270000
         B     TPXX                ABNORMAL                    @ZA14130 06290000
         B     TP0C           RD RESPONSE TO ENQ  0C               000B 06310000
         B     TPXX                          ABNORMAL              000B 06330000
TP1X     B     TP10           LINE ADDRESS        10                    06350000
         B     TP10AB              ABNORMAL                             06370000
         B     TP10           TEXT                11                    06390000
         B     TP10AB              ABNORMAL                             06410000
         B     TP12           READ SKIP           12                    06430000
         B     TP12AB              ABNORMAL                             06450000
         B     TPXX           WRT END XPARENT BLK 13               000B 06470000
         B     TPXX                ABNORMAL                        000B 06490000
         B     EXIT                  RESERVED    14            @ZA14130 06510000
         B     EXIT                  RESERVED    14            @ZA14130 06530000
TP2X     B     TP2A           READ RESPONSE       20                    06550000
         B     TP2A                ABNORMAL                             06570000
         B     TP2A           RESET               21                    06590000
         B     TP21AB              ABNORMAL                        000A 06610000
         B     EXIT           READ SKIP           22                    06630000
         B     EXIT                ABNORMAL                             06650000
         B     BRKTST        BREAK                23               000I 06670000
         B     BRKTST              ABNORMAL                        000I 06690000
         B     EXIT           SAD, DISABLE        24                    06710000
         B     EXIT                ABNORMAL                             06730000
         B     TP25           RD RESPONSE TO TXT  25               000B 06750000
         B     TP25                ABNORMAL                        000B 06770000
         EJECT                                                          06790000
*                             TP OP CODE = 00     ON LINE TERMINAL TEST 06810000
         SPACE 3                                                        06830000
TP00     TM    UCBTYP+3(UCBREG),BISYNCH IS THIS BISYNCH            000D 06850000
         BO    TSTOLT                  CHECK FOR ONLINE TEST     A43784 06870000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION FLAG ON   000D 06890000
         BZ    EXITONLT                                            000D 06910000
         TM    IOBCSW+4,CSWUE          IS UNIT EXCEPTION STATUS ON      06930000
         BZ    RSTEX                                                    06950000
         CLI   0(CCWREG),READ          IS FAILING CCW A READ            06970000
         BE    RSTEX                                                    06990000
TP00AB   TM    UCBTYP+3(UCBREG),BISYNCH IS THIS BISYNCH            000D 07010000
         BO    TSTOLT                  CHECK FOR ONLINE TEST     A43784 07030000
         TM    IOBINCAM,ONLTT           IS THIS ONLINE TEST        000D 07050000
         BZ    SETERRCC                                                 07070000
         CLI   IOBERRCT,RETRYCNT       DOES RETRY COUNT EQUAL MAXIMUM   07090000
         BE    SETERRCC                 IF SO, BRANCG                   07110000
         IC    ICREG,IOBERRCT          IF NOT , LOAD COUNT              07130000
         LA    ICREG,1(ICREG)          ADD U,                           07150000
         STC   ICREG,IOBERRCT          STORE                            07170000
         B     EXITONLT                                            000D 07190000
TSTOLT   TM    IOBINCAM,ONLTT          IS ONLINE TEST IN CTL?    A43784 07210000
         BO    EXITONLT                YES                       A43784 07230000
         TM    DECDCBAD,ONLTRFT        ONLINE TEST MACRO ISSUED? A49681 07250000
         BO    EXITONLT                YES                       A49681 07270000
         OI    DECERRST,SNO            SET SHOULD NOT OCCUR      A43784 07290000
         MVI   IOBECBPT,CCPER          INDICATE PERM ERROR       A43784 07310000
         B     EXIT                                             YA03243 07330000
         SPACE                                                          07350000
SETERRCC MVI   IOBECBPT,CCPER                                           07370000
RSTEX    L     ICREG,IOBCPA             DATA ADDRESS OF FIRST CCW  000K 07390000
         CLC   0(3,ICREG),DPREO         WRITE TO 2760              000K 07410000
         BE    EXITONLT                 YES,UE IS GOOD             000K 07430000
         NI    IOBFLAG1,MASKALL-IOBEX                              000K 07450000
         B     EXIT                                             YA03243 07470000
         SPACE 3                                                        07490000
*                           TP OP CODE # 02     EOT SEQUENCE       000A 07510000
*                                        OR                        000A 07530000
*                                       #03     POLL COMMAND -     000A 07550000
*                                          NORMAL ENTRY ONLY       000A 07570000
         SPACE 1                                                        07590000
TP02     EQU   *                                                   000A 07610000
TP02AB   EQU   *                                                   000A 07630000
TP03     TM    DECTYPE,AUTOPOLL         AUTOPOLL COMPLETION?       000A 07650000
         BZ    TPXX                IF NOT, EXIT.                   000A 07670000
         CLI   0(CCWREG),POLL           DID OPERATION TERMINATE ON 000A 07690000
         BNE   TP03NEXT            POLL COMMAND?  IF NOT, BRANCH.  000A 07710000
         CLI   5(CCWREG),X'03'          IS THE TPOP CODE 3         000E 07730000
         BNE   TP03NEXT                 IF NOT, BRANCH             000E 07750000
         L     CCW2REG,0(CCWREG)   IF SO, LOAD ENTRY ADDRESS FROM  000A 07770000
         B     TP03UPDT            POLL COMMAND AND BRANCH.        000A 07790000
TP03NEXT CLI   8(CCWREG),POLL           IS THE NEXT COMMAND A POLL 000A 07810000
         BNE   TPXX                COMMAND?  IF NOT, EXIT.  IF SO, 000A 07830000
         L     CCW2REG,8(CCWREG)   OPERATION TERMINATED ON WRITE   000A 07850000
*    COMMAND.  LOAD ENTRY ADDRESS FROM POLL COMMAND AND PROCEED.   000A 07870000
*                                                                  000A 07890000
TP03UPDT L     WREG,DECPOLPT            LOAD ADDRESS OF FIRST      000A 07910000
         BCTR  WREG,0         ENTRY IN LIST AND ADJUST TO FLAG     000A 07930000
         IC    ICREG,0(WREG)  BYTE.  THEN GET FLAG BYTE AND SHIFT  000A 07950000
         SRL   ICREG,5        OUT ALL BUT ENTRY WIDTH.             000A 07970000
         CH    ICREG,K1            IF NNN IS 0 OR 1, THAT MEANS YA01016 07990000
         BH    TP03STOR            8 OR 9, ADD 8 TO MAKE IT     YA01016 08010000
         LA    ICREG,8(ICREG)      CORRECT                      YA01016 08030000
TP03STOR EQU   *                                                 A35727 08050000
         TM    UCBTYP+DISP3(UCBREG),BISYNCH TEST FOR BSC    LD @ZA02319 08070000
         BNO   TP03STOE            BR NOT BSC               LD @ZA02319 08090000
         CLC   0(1,CCW2REG),DCBBSEOT                                    08110000
         BNE   TP03STOE                                                 08130000
TP03STPP EQU   *                                                 A35727 08150000
         L     CCW2REG,DECPOLPT                                         08170000
TP03STOE   EQU   *                                                      08190000
         BCTR  ICREG,0                 DECREMENT ENTRY WIDTH BY  A35727 08210000
*   ONE TO GET THE NUMBER OF POLLING CHARACTERS PER ENTRY        A35727 08230000
         IC    ICREG,0(ICREG,CCW2REG)   GET INDEX BYTE FROM LIST   000A 08250000
         STC   ICREG,DECPOLPT      ENTRY AND STORE IN DECPOLPT.    000A 08270000
         ST    CCW2REG,DECENTRY         STORE LIST ENTRY ADDRESS   000A 08290000
*                                  IN DECENTRY.                    000A 08310000
         SPACE 1                                                        08330000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 08350000
         MVI   EXITAP+1,BRANCH          CHANGE NOP TO AN           000A 08370000
*    UNCONDITIONAL BRANCH TO BYPASS UPDATING DECENTRY AND POLPT.   000A 08390000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 08410000
         SPACE 1                                                        08430000
         B     TPXX                                                000A 08450000
         SPACE 3                                                        08470000
*                           TP OP CODE # 03     POLL COMMAND -     000A 08490000
*                                          ABNORMAL ONLY           000A 08510000
         SPACE 1                                                        08530000
TP03AB   TM    DECTYPE,AUTOPOLL         AUTOPOLL COMPLETION?       000A 08550000
         BZ    TPXX                IF NOT, EXIT.                   000A 08570000
         SR    ICREG,ICREG         CLEAR REG                LD @ZA02814 08590000
         L     WREG,DECPOLPT            LOAD ADDRESS OF FIRST      000A 08610000
         BCTR  WREG,0         ENTRY IN LIST AND ADJUST TO FLAG     000A 08630000
         IC    ICREG,0(WREG)  BYTE.  THEN GET FLAG BYTE AND SHIFT  000A 08650000
         SRL   ICREG,5        OUT ALL BUT ENTRY WIDTH.             000A 08670000
         CH    ICREG,K1            IF NNN IS 0 OR 1, THAT MEANS YA01016 08690000
         BH    TP03AB1             8 OR 9, SO ADD 8 TO MAKE IT  YA01016 08710000
         LA    ICREG,8(ICREG)      CORRECT                      YA01016 08730000
TP03AB1  EQU   *                                                YA01016 08750000
         BCTR  WREG,DISP0          GET # OF ACT. ENTRY      LD @ZA02814 08770000
         SR    SAVEREG,SAVEREG     CLEAR REG                LD @ZA02319 08790000
         IC    SAVEREG,DISP0(WREG) TOTAL ACTIVE ENTRIES        @ZA14130 08810000
         L     W2REG,DISP0(CCWREG) LOAD ENTRY ADDR          LD @ZA02814 08830000
*                                  FROM POLL                LD @ZA02319 08850000
         LR    CCW2REG,W2REG       LOAD REG                 LD @ZA02814 08870000
         AH    CCW2REG,DISP6(CCWREG) ADD ORIG COUNT         LD @ZA02319 08890000
         SH    CCW2REG,IOBCSW+DISP6 SUB RESIDUAL CT.        LD @ZA02814 08910000
TP03AB2  EQU   *                                            LD @ZA02814 08930000
         SR    CCW2REG,W2REG       SUB ENTRY ADDRESS        LD @ZA02814 08950000
         CR    CCW2REG,ICREG       IS DIFF. GR OR EQ WIDTH  LD @ZA02814 08970000
         BH    TP03AB3             BR HIGH                  L5 @ZA02845 08990000
         B     TP03AB4             BR ON LOW OR EQUAL          @ZA14130 09010000
TP03AB3  EQU   *                                            LD @ZA02814 09030000
         AR    CCW2REG,W2REG       RESTORE REG              LD @ZA02814 09050000
         AR    W2REG,ICREG         ADD WIDTH                LD @ZA02814 09070000
         BCT   SAVEREG,TP03AB2     LOOP UNTIL FINISH        LD @ZA02814 09090000
         B     TP03STPP            NO COMPARE-USE DECPOLPT  LD @ZA02814 09110000
TP03AB4  EQU   *                                            LD @ZA02814 09130000
         TM    UCBTYP+DISP3(UCBREG),BISYNCH  TEST FOR BSC   LD @ZA02814 09150000
         BNO   TP03AB5             BR NOT BSC               LD @ZA02814 09170000
         CLC   DISP0(ONE,W2REG),DCBBSEOT  IS CHAR EOT       LD @ZA02814 09190000
         BNE   TP03AB5             CONTINUE                 LD @ZA02814 09210000
         SR    W2REG,ICREG         USE LAST NON EOT ENTRY   LD @ZA02814 09230000
TP03AB5  EQU   *                                            LD @ZA02814 09250000
         LR    CCW2REG,W2REG       RESTORE REG              LD @ZA02814 09270000
         B     TP03STOE                                     LD @ZA02814 09290000
         EJECT                                                          09310000
*                                                                       09330000
*                           TP OP CODE = 05     POLLING RESTART         09350000
         SPACE 3                                                        09370000
TP05     SH    CCWREG,K8                BACK UP 1 CCW                   09390000
         CLI   5(CCWREG),TPWPA          IS THIS WRITE POLLING CHARACTER 09410000
         BNE   TP05                     IF NOT, LOOP                    09430000
         LH    ICREG,6(CCWREG)          LOAD COUNT OF POLLING CHARACTER 09450000
         L     WREG,0(CCWREG)           LOAD CURRENT POLLING ADDRESS    09470000
         LA    WREG,0(WREG,ICREG)       INCREMENT TO THE CONTROL BYTE   09490000
         MVC   WA,ZERO                  RESET POLLING WRAP DECREMENT    09510000
TPL      TM    0(WREG),FORMAT+EOL       ARE FORMAT & EOL BITS ON        09530000
         BZ    TPR                      IF NOT, BRANCH                  09550000
         TM    0(WREG),FORMAT           TEST FORMAT BIT                 09570000
         BO    TPF                      IF ON, BRANCH                   09590000
         B     POST1ER                  IF NOT THIS IS EOL, GO POST     09610000
TPR      TM    IOBFLAG2,RESETPL         TEST RESET P/L                  09630000
         BO    POST0ER                  IF ON, BRANCH TO POST           09650000
STEP1    LA    WREG,1(WREG,ICREG)       STEP TO NEXT ENTRY CONTROL BYTE 09670000
         TM    0(WREG),SKIP             TEST SKIP BIT                   09690000
         BO    TPL                      IF ON, GO TEST EOL & FORMAT     09710000
         SR    WREG,ICREG               BACK UP TO POLLING CHARACTERS   09730000
         ST    WREG,0(CCWREG)           ST ADDRESS IN CCW               09750000
         MVI   0(CCWREG),WRITE          RESTORE WRITE COMMAND           09770000
         ST    WREG,DECPOLPT            UPDATE DECB                     09790000
         CLI   19(UCBREG),TWNTY260      IS DEVICE A 2260                09810000
         BNE   REXIT                    IF NOT, RESTART NOW             09830000
         SH    CCWREG,K8                IF SO, BACK UP TO WRITE CRCLE C 09850000
         B     REXIT                    GO TO RESTART EXIT              09870000
POST0ER  LA    WREG,1(WREG,ICREG)       STEP TO NEXT ENTRY              09890000
POST1ER  SR    WREG,ICREG               BACK UP TO POLLING CHARACTERS   09910000
         TM    17(UCBREG),X'90'         IS THIS DIAL LINE        A25694 09930000
         BNZ   POST2ER                  YES, DON'T UPDATE        A25694 09950000
         MVC   DECENTRY+1(3),DECPOLPT+1 IF NOT, UPDATE                  09970000
POST2ER  ST    WREG,DECPOLPT            UPDATE CURRENT POLLING ADDRESS  09990000
         OI    DECFLAGS,NEGRESPN        SET ON NEGATIVE RESPONSE BIT    10010000
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      10030000
         B     TPXX                                                     10050000
TPF      CLC   WA,ZERO                  IS WORK AREA ZERO               10070000
         BNE   POST1ER                  IF NOT, ALL ENTRIES ARE SKIP    10090000
         LR    W2REG,WREG               SAVE THIS ENTRY ADRS            10110000
         MVC   WA,1(WREG)               MOVE LIST DECREMENT TO WA       10130000
         AH    WREG,WA                  SET ADDRESS TO START OF LIST -1 10150000
         TM    0(W2REG),EOL             WAS LAST ENTRY EOL              10170000
         BO    POST0ER                  IF SO, GO POST                  10190000
         TM    IOBFLAG2,RESETPL         IF NOT, WAS RESET P/L ON        10210000
         BO    POST0ER                  IF SO, GO POST                  10230000
         B     STEP1                    LOOP                            10250000
TP05AB   TM    17(UCBREG),X'90'         IS THIS DIAL LINE        A25694 10270000
         BNZ   TPXX                     YES, DON'T UPDATE        A25694 10290000
         MVC   DECENTRY+1(3),DECPOLPT+1 UPDATE DECENTRY                 10310000
         B     TPXX                                                     10330000
         EJECT                                                          10350000
*                             TP OP CODE = 06     ADDRESSING RESTART    10370000
         SPACE                                                          10390000
TP06     CLI   0(CCWREG),X'03'          IS THIS ENTRY FROM ERP     1263 10410000
         BNE   CHK2740                  NO, CHECK FOR A 2740       1263 10430000
         MVI   0(CCWREG),X'02'          CHANGE NOP TO READ         1263 10450000
         MVI   IOBECBPT,CCPER          INDICATE PERM ERROR       A41139 10470000
         OI    IOBCSW+4,X'01'           SET ON UNIT EXCEPTION      1263 10490000
         B     NOT2740                                             1263 10510000
CHK2740  TM    UCBTYP+3(UCBREG),X'E0'   IS THIS TYPE I ADAPTER     1263 10530000
         BNZ   NOT2740                  NO, CAN'T BE 2740          1263 10550000
         TM    UCBTYP(UCBREG),X'09'    IS THIS 2740B               00MC 10570000
         BO    A2740                   YES, TREAT AS 2740          00MC 10590000
         TM    UCBTYP(UCBREG),X'0B'     IS THIS 2740 TERMINAL      1263 10610000
         BNZ   NOT2740                  NO, NOT A 2740             1263 10630000
A2740    EQU   *                                                   00MC 10650000
         CLI   DECRESPN,X'76'           IS THIS A CIRCLE Y         1263 10670000
         BE    REXITB                   YES, RESTART CHANNEL PROGRA1263 10690000
         CLI   DECRESPN,X'40'           THIS A CIRCLE N            1263 10710000
         BE    NOT2740                  YES, NORMAL PROCESSING     1263 10730000
         CLC   DECRESPN(2),SPACEY       THIS A SPACE + CR Y        1263 10750000
         BE    REXITB                   YES, RESTART CHANNEL PROG  1263 10770000
         CLC   DECRESPN(2),SPACEN       THIS A SPACE + CR N        1263 10790000
         BE    NOT2740                  YES, NORMAL PROCESSING     1263 10810000
         CLI   DECRESPN+1,X'40'         CIRCLE N RESPONSE        A27619 10830000
         BNE   NOTACK0                  NO, WRITE ERROR MESSAGE  A27619 10850000
         TM    DECRESPN,X'F0'           IS STATUS 1, 2, OR 4     A27619 10870000
         BZ    NOT2740                  YES, NO MESSAGE REQUIRED A27619 10890000
         B     NOTACK0                  NO, WRITE ERROR MESSAGE    1263 10910000
NOT2740  TM    IOBCSW+4,X'01'           IF UNIT EXCEPTION          1263 10930000
         BZ    NOTUNEX                  NO, BRANCH TO BISYNC    YA03266 10950000
         TM    UCBTYP+3(UCBREG),BISYNCH  TEST FO BSC           @ZA03598 10970000
         BO    BSCEOT               BRANCH IF BSC              @ZA03598 10990000
* TWENTY TWO INSTRUCTIONS REMOVED BY APAR OZ11419              @ZA11419 11010000
         B     POST2                                           @ZA03598 11030000
BSCEOT   CLC   DECRESPN(1),DCBBSEOT       BSC EOT              @ZA03598 11050000
         BE    NOIQE                    YES, SHOULD NOT OCCUR   YA03266 11070000
         B     POST2                                        LD @ZA02327 11090000
NOTUNEX  EQU   *                                                YA03266 11110000
         TM    UCBTYP+3(UCBREG),BISYNCH TEST FOR BSC               000B 11130000
         BO    BSCADRS                                             000B 11150000
         LR    CCW2REG,CCWREG           SAVE ADDRESS OF READ RESP  000B 11170000
TPA8     SH    CCWREG,K8                STEP BACK 1 CCW                 11190000
         CLI   5(CCWREG),X'03'          IS THIS WRITE ADDRESSING CHAR   11210000
         BNE   TPA8                     NO, LOOP                        11230000
         LH    ICREG,6(CCWREG)          LOAD COUNT OF ADDRESSING CHAR   11250000
         L     WREG,0(CCWREG)           LOAD ADRS OF ADDRESSING CHAR    11270000
         AR    WREG,ICREG               STEP TO CONTROL BYTE            11290000
STEP2    LA    WREG,1(WREG,ICREG)       STEP TO NEXT ENTRY'S CONTROL    11310000
         TM    0(WREG),X'40'            TEST SKIP BIT                   11330000
         BZ    TPL2                     IF OFF, GO SETUP ADRS RESTART   11350000
         TM    0(WREG),X'80'            TEST END OF LIST BIT            11370000
         BZ    STEP2                    IF OFF LOOP TO NEXT ENTRY       11390000
         L     CCWREG,IOBCSW            RESTART CHNL PROG - WRITE DATA  11410000
         B     REXIT                                                    11430000
BSCADRS  CLC   DECRESPN(1),DCBBSNAK     WAS RESPONSE NAK           000B 11450000
         BE    POST2                    IF YES, BRANCH             000B 11470000
         CLC   DECRESPN(2),DCBBSSAK     WAS RESPONSE A WACK             11490000
         BE    ISWACK                                                   11510000
         CLC   DECRESPN(2),DCBBSRVI     WAS RESPONSE RVI           000M 11530000
         BE    BSCADRS1            YES INDICATE RVI RECVD   LD @ZA02316 11550000
         CLC   DECRESPN(1),DCBBSENQ   TEST FOR ENQ CHAR.    LD @ZA13190 11570000
         BNE   CHACK               IF NOT, CHECK FOR ACK    LD @ZA02316 11590000
BSCADRS1 EQU   *                                            LD @ZA02316 11610000
         NI    DECFLAGS,NEGRESPN   TURN OFF EVERYTHING,     LD @ZA02316 11630000
*                                  EXCEPT NEG. RESP. FLAG.  LD @ZA02316 11650000
         OI    DECERRST,SNO        SET SHOULD NOT OCCUR     LD @ZA02316 11670000
         OI    DECFLAGS,RVIRCV          INDICATE RVI RECEIVED      000M 11690000
         NI    IOBFLAG1,MASKALL-IOBEX   TURN OFF IOB EXCEPTION     000M 11710000
         B     EXIT                                                     11730000
CHACK    EQU   *                                                        11750000
         CLC   DECRESPN(2),DCBBSAK0     WAS RESPONSE ACK0          000B 11770000
         BNE   NOTACK0                  BRANCH IF NOT ACK0         000B 11790000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK PTR          000B 11810000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK PTR          000B 11830000
         B     REXITA                   RESTART CHANNEL PROGRAM    000B 11850000
NOTACK0  OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION      000B 11870000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000B 11890000
         B     EXIT                                                000B 11910000
TPL2     SR    WREG,ICREG               GET ADDRESS OF ADRS CHARACTERS  11930000
         ST    WREG,0(CCWREG)           STORE IN CCW                    11950000
         MVI   0(CCWREG),X'01'          RESTORE WRITE COMMAND           11970000
         ST    WREG,DECADRPT            UPDATE POINTER IN DECB          11990000
         AR    WREG,ICREG               ADD BACK FOR CONTROL BYTE       12010000
         TM    0(WREG),X'80'            TEST END OF LIST BIT            12030000
         BO    TPCC                     IF ON                           12050000
STEP2A   LA    WREG,1(WREG,ICREG)       STEP TO NEXT ENTRY CTRL BYTE    12070000
         TM    0(WREG),X'40'            TEST SKIP BIT                   12090000
         BZ    REXIT                    IF OFF, EXIT                    12110000
         TM    0(WREG),X'80'            TEST END OF LIST BIT            12130000
         BZ    STEP2A                   IF OFF, LOOP TO NEXT ENTRY      12150000
TPCC     TM    UCBTYP+3(UCBREG),BISYNCH TEST FOR BSC               000B 12170000
         BO    REXIT1                   IF SO, EXIT                000B 12190000
         OI    4(CCW2REG),X'40'         SET ON CC FLAG             000B 12210000
         B     REXIT                                                    12230000
POST2    OI    DECFLAGS,NEGRESPN        SETON NEG RESPONSE BIT          12250000
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      12270000
         B     TPXX                                                     12290000
ISWACK   EQU   *                                                        12310000
         OI    DECFLAGS,WACKRCV         INDICATE WACK WAS RECEIVED      12330000
         B     TPXX                                                     12350000
         SPACE 3                                                        12370000
*                           TP OP CODE # 09     AUTOPOLL NOP       000A 12390000
TP09AB   EQU   *                                                   000A 12410000
TP09     LR    CCW2REG,CCWREG                                      000A 12430000
         SH    CCW2REG,K8               SUBTRACT 8 TO GET ADDRESS  000A 12450000
         L     WREG,0(CCW2REG)     OF POLL COMMAND AND LOAD POLL   000A 12470000
*                                  ADDRESS.                        000A 12490000
         AH    WREG,6(CCW2REG)          ADD COUNT FROM POLL        000A 12510000
*    COMMAND - WREG WILL NOW POINT AT THE BYTE FOLLOWING THE LAST  000A 12530000
*    ACTIVE ENTRY IN THE LIST.                                     000A 12550000
         L     W2REG,DECPOLPT           LOAD POLLING LIST ADDRESS. 000A 12570000
         BCTR  W2REG,0                  SUBTRACT ONE TO POINT AT   000A 12590000
*                                  FLAG BYTE.                      000A 12610000
         IC    ICREG,0(W2REG)           PICK UP FLAG BYTE AND      000A 12630000
         SRL   ICREG,5             SHIFT OUT ALL BUT ENTRY WIDTH.  000A 12650000
         CH    ICREG,K1            IF NNN IS 0 OR 1, THAT MEANS YA01016 12670000
         BH    TP09AB1             8 OR 9, SO ADD 8 TO MAKE IT  YA01016 12690000
         LA    ICREG,8(ICREG)      CORRECT                      YA01016 12710000
TP09AB1  EQU   *                                                YA01016 12730000
         SR    WREG,ICREG               SUBTRACT ENTRY WIDTH TO    000A 12750000
*                             GET ADDRESS OF LAST ENTRY IN LIST.   000A 12770000
         TM    UCBTYP+3(UCBREG),BISYNCH  TEST FOR BSC            000J   12790000
         BNO   TP09BA                         NO,  PROCEED         000J 12810000
         BCTR  WREG,0                    SUBTRACT ONE TO ALLOW FOR 000J 12830000
*            EOT OF DUMMY ENTRY  // PTS TO LAST ACTIVE ENTRY       000J 12850000
TP09BA   EQU   *                                                   000J 12870000
         ST    WREG,DECENTRY            UPDATE DECENTRY.           000A 12890000
         BCTR  ICREG,0                  DECREMENT ENTRY WIDTH TO   000A 12910000
*                             GET NUMBER OF POLLING CHARACTERS.    000A 12930000
         TM    UCBTYP+3(UCBREG),BISYNCH  TEST FOR BSC          @ZA14130 12950000
         BNO   TP09ABC                   NOT BSC, BRANCH       @ZA14130 12970000
         L     WREG,DECPOLPT                                            12990000
TP09ABC   EQU   *                                                       13010000
         IC    ICREG,0(ICREG,WREG)      GET INDEX BYTE AND SAVE IN 000A 13030000
         STC   ICREG,DECPOLPT      HIGH ORDER BYTE OF DECPOLPT.    000A 13050000
         OI    DECFLAGS,NEGRESPN   SET ON NEGATIVE RESPONSE BIT.   000A 13070000
         SPACE 1                                                        13090000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 13110000
         MVI   EXITAP+1,BRANCH          CHANGE NOP TO AN           000A 13130000
*    UNCONDITIONAL BRANCH TO BYPASS UPDATING DECENTRY AND POLPT.   000A 13150000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 13170000
         SPACE 1                                                        13190000
         B     TPXX                                                000A 13210000
         SPACE 2                                                        13230000
*                                       TP OP CODE = 0A READ INDEX      13250000
TP0A     EQU   *                                                 A25689 13270000
         SPACE 2                                                        13290000
TP0AAB   L     WREG,0(CCWREG)           LOAD ADDRESS OF MESSAGE    000C 13310000
         MVC   DECPOLPT(1),0(WREG)      SAVE INDEX BYTE            000C 13330000
         B     TPXX                                                000C 13350000
         EJECT                                                          13370000
*                             TP OP CODE = 0B READ INQUIRY              13390000
         SPACE 1                                                        13410000
TP0B     CLC   DECRESPN(1),DCBBSENQ     TEST FOR INQ CHAR          000B 13430000
         BNE   RESETST                  IF NOT, BRANCH             000B 13450000
         CLI   DECTYPE+1,RDINQ          OPERATION READ INQUIRY     000B 13470000
         BE    ACKSET                YES, SET ACKS AND EXIT    @ZA04196 13490000
         CLI   DECTYPE+1,RDINQMON       RD INQUIRY MONITOR       S99245 13510000
         BE    ACKSET                YES, SET ACKS AND EXIT    @ZA04196 13530000
         CLI   DECTYPE+1,WRWBT          WRITE WAIT BEFORE XMIT     000B 13550000
         BE    EXIT                     IF SO, EXIT                000B 13570000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK POINTER      000B 13590000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK POINTER      000B 13610000
         NI    11(CCWREG),FULWORD      CCW ADDRES S TO ACK-0       000B 13630000
         CLI   DECTYPE+1,RDININQ        OPERATION READ INIT INQ    000B 13650000
         BE    EXIT                     IF SO, EXIT                000B 13670000
         CLI   DECTYPE+1,WRRST                                     000B 13690000
         BNE   NOWRRST                  NO, CONTINUE            YA02453 13710000
         NI    IOBINCAM,STRVIRPT        RESET RVI SWITCH        YA02453 13730000
         B     EXIT                     EXIT                    YA02453 13750000
ACKSET   EQU   *                                               @ZA04196 13770000
         TM    UCBTYP+ONE(UCBREG),BSC2      BSC2 ?             @ZA04196 13790000
         BNO   EXIT                     EXIT                   @ZA04196 13810000
         MVI   IOBRCVPT,ACK1PT         RESET RCV ACK           @ZA04196 13830000
         MVI   IOBSNDPT,ACK0PT          RESET SEND ACK         @ZA04196 13850000
         B     EXIT                     EXIT                   @ZA04196 13870000
NOWRRST  EQU   *                                                YA02453 13890000
         CLI   DECTYPE+1,WRRSTMON       WRT RESET MONITOR        S99245 13910000
         BE    EXIT                     IF SO, EXIT              S99245 13930000
*                                                                       13950000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  13970000
*                                                                    *  13990000
*  THIS ROUTINE IS USED TO SET THE UCBINHIO BIT IN THE UCB COMMON    *  14010000
*  EXTENTION X'05', WHICH INHIBITS HIO WHEN IN RECEIVE STATUS        *  14030000
*                                                                    *  14050000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  14070000
*                                                                       14090000
RSTRT    EQU   *                                                 Y02947 14110000
         L     W2REG,UCBEXTPT(UCBREG)   GET ADD OF UCB EXT     @ZA15402 14130000
         L     WREG,4(W2REG)            GET 4 BYTES OF UCB EXT @ZA15402 14150000
TRYSET   LR    IOBREG,WREG              GET SAME 4 BYTES       @ZA15402 14170000
         O     IOBREG,SETMSK            SET MSK UCBINHIO BIT   @ZA15402 14190000
         CS    WREG,IOBREG,4(W2REG)     SET UCBINHIO BIT IF OK @ZA15402 14210000
         BNE   TRYSET                   TRY AGAIN              @ZA15402 14230000
         L     IOBREG,DISP16(SAVEAREA)  RESTORE IOBREG         @ZA15402 14250000
*                                                                    *  14270000
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  14290000
*                                                                       14310000
         B     REXITA                                              000B 14330000
RESETST  EQU   *                                                        14350000
         CLI   DECTYPE+1,RDINQMON       RD INQ. MON. (TQM)     @ZA15430 14370000
         BE    RESETST1                 YES, CHECK EOT RESP.   @ZA15430 14390000
         CLI   DECTYPE+1,RDINQ          READ INQ.  (TQ)        @ZA15430 14410000
         BE    RESETST1                 YES, CHECK EOT RESP.   @ZA15430 14430000
         CLI   DECTYPE+1,WRWBT                                   A26901 14450000
         BE    RESETST1                                          A26901 14470000
         CLI   DECTYPE+1,WRRSTMON       WRT RESET MONITOR        S99245 14490000
         BE    RESETST1                 YES, CHECK FOR RESP      S99245 14510000
         CLI   DECTYPE+1,WRRST                                   A26901 14530000
         BNE   SETINQER                                          A26901 14550000
RESETST1 NI    IOBFLAG1,MASKALL-IOBEX  SET OFF IOB EXCEPTION     A26901 14570000
         CLC   DECRESPN(1),DCBBSEOT     WAS EOT RECEIVED IN RESP   000B 14590000
         BNE   DLEEOTST                 IF NOT, BRANCH             000B 14610000
         MVI   IOBRCVPT,ACK0PT          RESET RECEIVE ACK POINTER  000B 14630000
         MVI   IOBSNDPT,ACK0PT          RESET SEND ACK POINTER     000B 14650000
         B     EXIT                                                000B 14670000
DLEEOTST CLC   DECRESPN(2),DCBBSDLE                                000B 14690000
         BE    EXIT                                                000B 14710000
SETINQER OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION      000B 14730000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000B 14750000
         B     EXIT                                                000B 14770000
         SPACE 2                                                        14790000
*   TWO LINES OF CODE REMOVED BY APAR------------------------->@ZA14130 14810000
         SPACE 3                                                        14830000
*                             TP OP CODE = 0C READ RESP TO INQ          14850000
         SPACE 1                                                        14870000
TP0C     CLC   DECRESPN(2),DCBBSAK0     TEST FOR ACK0              000B 14890000
         BNE   AORESP                   IF NOT, BRANCH             000B 14910000
         NI    IOBINCAM,STRVIRPT        RESET RVI SWITCH                14930000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK POINTER      000B 14950000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK POINTER      000B 14970000
         TM    5(CCWREG),X'80'          IS THIS LAST CCWIN CH.PGM  000H 14990000
         BO    EXIT                     YES, EXIT TO POST          000H 15010000
         B     REXITA                   RESTART THE NXT CCW    @ZA14130 15030000
AORESP   CLC   DECRESPN(2),DCBBSSAK     CHECK FOR WACK                  15050000
         BE    SETIMPRP                                            000B 15070000
         CLC   DECRESPN(1),DCBBSEOT     CHECK FOR EOT              000B 15090000
         BE    EOTRESP                                             000B 15110000
         CLC   DECRESPN(1),DCBBSENQ    CHECK FOR ENQ             A43796 15130000
         BE    ENQON                                             A43796 15150000
NOENQ    OI    IOBCSW+4,CSWUE          SET ON UNIT EXCEPTOON     A43796 15170000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000B 15190000
         B     EXIT                                                000B 15210000
ENQON    TM    DCBXCODE,DCBMASTA       THIS THE MASTER STATION?  A43796 15230000
         BNO   NOENQ                                             A43796 15250000
         OI    DECFLAGS,SLVCONT        INDICATE CONTENTION       A43796 15270000
         MVI   IOBECBPT,CCPER                                    A43796 15290000
         B     NOENQ                                             A43796 15310000
EOTRESP  NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION      000B 15330000
SETIMPRP OI    DECFLAGS,WACKRCV         INDICATE WACK RECEIVED          15350000
         B     EXIT                     EXIT                       000B 15370000
         EJECT                                                          15390000
*                             TP OP CODE = 10,11  READ OR WRITE DATA    15410000
         SPACE                                                          15430000
TP10     CLI   0(CCWREG),X'01'          IS COMMAND WRITE                15450000
         BNE   NOTWRT                   NO, BRANCH             @ZA14130 15470000
         TM    UCBTYP+3(UCBREG),X'E0'   ADAPTER TYPE I           A26916 15490000
         BNZ   WRITDATA                 NO, BRANCH             @ZA14130 15510000
         TM    UCBTYP(UCBREG),X'04'     IS IT A 2740 OR 2741?  @ZA14130 15530000
         BZ    WRITDATA                 NO, BRANCH             @ZA14130 15550000
         TM    UCBTYP(UCBREG),X'03'     IS IT A 2740?          @ZA14130 15570000
         BNM   WRITDATA                 NO ITS A 2741, BRANCH  @ZA14130 15590000
         TM    IOBCSW+4,X'01'           UNIT EXCEPTION           A26916 15610000
         BZ    WRITDATA                                          A26916 15630000
         NI    IOBINCAM,MASKALL-BUSY    SET OFF BUSY BIT         A26916 15650000
         MVI   IOBECBPT,CCPER           SET ERROR COMPLETION     A26916 15670000
         NI    IOBFLAG1,MASKALL-IOBEX   TURN OFF IOB EXCEPTION   A26916 15690000
         OI    DECFLAGS,X'02'                                    A26916 15710000
         B     EXIT                                              A26916 15730000
NOTWRT   EQU   *                                                 A26916 15750000
         NI    IOBFLAG1,X'FB'           AND OFF IOB EXCEPTION FLAG      15770000
TP10AB   EQU   *                                                   000I 15790000
*                                       TEST FOR 2741              000I 15810000
         TM    UCBTYP+3(UCBREG),X'E0'   ADAPTER TYPE 1?                 15830000
         BNZ   BSCTST                   NO, BRANCH             @ZA14130 15850000
*                                                           LD @ZA02322 15870000
*              2 LINES REMOVED FOR ----->                   LD @ZA02322 15890000
*                                                           LD @ZA02322 15910000
         TM    UCBTYP(UCBREG),X'04'     IS IT A 2740 OR 2741?  @ZA14130 15930000
         BZ    BSCTST                   NO, BRANCH             @ZA14130 15950000
         TM    UCBTYP(UCBREG),X'03'     IS IT A 2740?          @ZA14130 15970000
         BNM   BSCTST                   NO ITS A 2741,BRANCH   @ZA14130 15990000
         TM    IOBSENS0,X'40'           INTERVENTION REQUIRED      000I 16010000
         BO    EXITBRK                  SCHEDULE 2741 BREAK ROUTINE000I 16030000
*                                                                  000I 16050000
BSCTST   EQU   *                                                   000I 16070000
         CLI   0(CCWREG),X'01'          IS COMMAND WRITE           000I 16090000
         BE    TPXX                                                000I 16110000
         TM    UCBTYP+3(UCBREG),BISYNCH TEST FOR BSC               000B 16130000
         BNO   TSTDYNBF                 IF NOT, BRANCH             000B 16150000
         LH    W2REG,6(CCWREG)          GET ORIGINAL CCW COUNT          16170000
         CH    W2REG,IOBCSW+6           COMPARE TO RESIDUAL COUNT       16190000
         BE    CKENDETX                                          A30765 16210000
BSCTST1  L     WREG,DECAREA            LOAD THE AREA ADDRESS     A43780 16230000
         TM    DCBBFTEK,DYNBF           TEST FOR DYNAMIC BUFFERING 0143 16250000
         BZ    CHKEOT                                              0143 16270000
         AH    WREG,K4                  ADD FOUR                   0143 16290000
CHKEOT   CLI   IOBCPA,POLL             MULTIPOINT RD INITIAL?    A38573 16310000
         BE    CHKEOT1                 YES, CHECK FOR EOT        A38573 16330000
         CLC   0(1,WREG),DCBBSEOT      IS 1ST CHARACTER EOT?     A38573 16350000
         BE    EOTRCV                  IF SO, BRANCH               0143 16370000
         CLC   0(2,WREG),DCBBSDLE       ARE FIRST CHARS DLE-EOT    0143 16390000
         BE    EOTRCV                   IF SO, BRANCH              0143 16410000
IBCTEST  EQU   *                                                YA01239 16430000
         TM    DCBBFTEK,DYNBF           DYNAMIC BUFFERING?      YA01239 16450000
         BZ    NOTEOT                   BRANCH AROUND IBC TEST  YA01239 16470000
         TM    DCBXMODE,INTBLCHK        IBC MODE?               YA01239 16490000
         BZ    NOTEOT                   NO, BRANCH OUT          YA01239 16510000
         BCTR  W2REG,0                  SUBTRACT ONE            YA01239 16530000
         CH    W2REG,IOBCSW+6           ARE COUNTS EQUAL?       YA01239 16550000
         BE    CKENDETX                 YES, CHECK FOR END      YA01239 16570000
NOTEOT   EQU   *                                                   000M 16590000
         BAL   W2REG,FINDADDR           FIND RESPONSE ADDR         0143 16610000
         TM    DCBXMODE,INTBLCHK        INTERMED BLOCK CHK         0143 16630000
         BZ    CHKETB                   NO, BRANCH                 0143 16650000
         BCTR  WREG,0                   BACK UP ONE BYTE           0143 16670000
CHKETB   CLC   1(1,WREG),DCBBSETB       ENDING CHAR ETB            0143 16690000
         BE    UPDACK                   YES, UPDATE ACK POINTERS   0143 16710000
         CLC   1(1,WREG),DCBBSETX       ENDING CHAR ETX            0143 16730000
         BE    UPDACK                   YES, UPDATE ACK POINTERS   0143 16750000
CNTERR   OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION           16770000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000B 16790000
         B     TSTDYNBF                                            000B 16810000
CHKEOT1  CLC   1(1,WREG),DCBBSEOT      2ND BYTE EOT?             A38573 16830000
         BNE   IBCTEST                  NO, CONTINUE            YA01239 16850000
EOTRCV   MVI   IOBRCVPT,ACK0PT          RESET RCV ACK POINTER      000B 16870000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK POINTER      000B 16890000
         B     TSTDYNBF                                            000B 16910000
CKENDETX EQU   *                   END OF READ TEST             YA01026 16930000
         LR    W2REG,CCWREG        GET CCW ADDR                 YA02164 16950000
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFERING?           YA01026 16970000
         BO    DYNBFETX            YES, GOHECK OPERATION        YA01026 16990000
         SH    W2REG,K8            BACK UP ONE CCW              YA01026 17010000
         CLI   5(W2REG),RDRESP     READ RESPONSE                YA01026 17030000
         BE    SEEIFETX            YES, NOW CHECK FOR ETX       YA01026 17050000
         AH    W2REG,K8            RESTORE CCW PTR              YA01026 17070000
         B     CNTERR              GO SET ERROR FLAGS           YA01026 17090000
DYNBFETX EQU   *                   DYNAMIC BUFFERING            YA01026 17110000
         CLI   5(W2REG),RDTEXT1    FIRST READ TEXT              YA01026 17130000
         BNE   NORMDNBF            NO, PROCESS NORMALLY         YA01026 17150000
         SH    W2REG,K8            YES, BACK UP ONE CCW         YA01026 17170000
         CLI   5(W2REG),RDRESP     READ RESPOSE?                YA01026 17190000
         BE    SEEIFETX            YES, GO SEE IF ETX           YA01026 17210000
*                        ONE LINE OF CODE REMOVED BY---------->@ZA14130 17230000
NORMDNBF EQU   *                   NOT READ RESPONSE            YA01026 17250000
         L     W2REG,8(CCWREG)     ADR OF PREVIOUS              YA01026 17270000
SEEIFETX EQU   *                   CHECK FOR ETX                YA01026 17290000
         LH    WREG,6(W2REG)           COUNT OF PREVIOUS CCW     A30765 17310000
         L     W2REG,0(W2REG)          ADDRESS OF PREVIOUS BUFFERA30765 17330000
         AR    W2REG,WREG              ADJUST TO END OF BUFFER   A30765 17350000
         BCTR  W2REG,0                 POINT TO LAST CHARACTER   A30765 17370000
         TM    DCBXMODE,INTBLCHK       INTERMEDIATE BL CHECK     A30765 17390000
         BZ    CKEDETX2                                          A30765 17410000
         BCTR  W2REG,0                 YES, ADJUST POINTER       A30765 17430000
CKEDETX2 CLC   0(1,W2REG),DCBBSETX     ETX IS LAST               A30765 17450000
         BE    UPDACK                  UPDATE ACK POINTER        A30765 17470000
         CLC   0(1,W2REG),DCBBSETB     ETB IS LAST               A30765 17490000
         BNE   CNTERR                  NO, ERROR                 A30765 17510000
UPDACK   TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON        000F 17530000
         BO    TSTDYNBF                 YES, BRANCH                000F 17550000
         XI    IOBSNDPT,FLIP            UPDATE ACK POINTER         000F 17570000
         NI    DECFLAGS,FOXE       TURN OFF STX-ENQ IF ON   LD @ZA02314 17590000
         CLI   DECTYPE+1,X'16'          WRITE INQUIRY ?        @ZA31183 17592000
         BE    FLIPRCV                  UPDATE ACK POINTER     @ZA31183 17594000
         TM    DECTYPE+1,WRTIV          WRITE INITIAL CONVERS      000B 17610000
         BNO   TSTDYNBF                 IF NOT, BRANCH             000B 17630000
FLIPRCV  EQU   *                                                        17650000
         XI    IOBRCVPT,FLIP            UPDATE ACK POINTER         000B 17670000
FLAGOFF  NI    DECFLAGS,OKACK           TURN OFF WRONG RESP      A38550 17690000
TSTDYNBF TM    DCBBFTEK,DYNBF           TEST DYNAMIC BUFFERING     000B 17710000
         BZ    CHKONLT                  IF NOT, CHECK ONLINE TEST  000D 17730000
         IC    ICREG,DEBNMEXT(DEBREG)   LOCATE POINTER TO BUFFER ROUT   17750000
         SLL   ICREG,2                                                  17770000
         LA    BRREG,DEBUCBAD(ICREG,DEBREG) GET BUFFER ROUTINE @ZA14130 17790000
*                           ADDRESS FROM DEB                   @ZA14130 17810000
         SR    ICREG,ICREG                                         000B 17830000
         CLI   8(CCWREG),READ           HAS NEXT BUFFER BEEN       000B 17850000
         BE    TPPR                ASSIGNED?  IF NOT, BRANCH.      000B 17870000
         CLI   8(CCWREG),TICCMND        IS CCW TIC COMMAND       A27615 17890000
         BNE   CHKONLT                  CK FOR ONLINE TST      12121212 17910000
         L     BRREG,0(BRREG)           LOAD ADRS OF BUFFER ROUTINE     17930000
         L     CCW2REG,8(CCWREG)        IF SO RELEASE THE BUFFER        17950000
         CLC   1(3,CCW2REG),K4-1        HAS BUFFER ALREADY BEEN RELEASD 17970000
         BE    CHKONLT                  TST FOR ONLINE TST     12121212 17990000
         L     ZREG,0(CCW2REG)          LOAD THE BUFFER ADDRESS         18010000
         MVC   1(3,CCW2REG),K4-1        MOVE 4 OTHER CCW RD ADRS        18030000
         N     ZREG,MASKDB                                              18050000
         SH    ZREG,K4                                                  18070000
         LR    ICREG,DCBREG             LOAD DCB ADRE INTO REG 1        18090000
         LR    WREG,SAVEAREA            SAVE IOS SAVEAREA ADDR   YM4063 18110000
         LA    SAVEAREA,SAVE19MS        SAVE AREA ADDR FOR 19MS  YM4063 18130000
         BALR  RETREG,BRREG             LINK TO RELEASE BUFFER ROUTINE  18150000
         LR    SAVEAREA,WREG         RESTORE IOS SAVEAREA ADDR   YM4063 18170000
         L     BAS2REG,DISP4(SAVEAREA)  RESTORE                  Y02947 18190000
         A     BAS2REG,FOURK                    SECOND BASE      Y02947 18210000
         SR    ICREG,ICREG                                         000A 18230000
         B     CHKONLT                  TST FOR ONLINE TST     12121212 18250000
WRITDATA TM    4(CCWREG),PCI            IS THERE A WRITE TIC LOOP  3712 18270000
         BZ    TPXX                     IF NOT, GO POST            3712 18290000
         LR    CCW2REG,CCWREG           SAVE CCW POINTER           3712 18310000
         SH    CCW2REG,K16              POINT BACK TWO CCWS        3712 18330000
         CLI   8(CCW2REG),TICCMND       IS CCW A TIC               3712 18350000
         BE    CHKOTHER                 IF SO, BRANCH              3712 18370000
         TM    29(CCWREG),TPEOCP        END OF CHANNEL PROGRAM     3712 18390000
         BO    TPXX                     IF SO, POST                3712 18410000
         B     LOADCCW                                             3712 18430000
CHKOTHER TM    13(CCWREG),TPEOCP        END OF CHANNEL PROGRAM     3712 18450000
         BO    TPXX                     IF SO, POST                3712 18470000
LOADCCW  L     CCWREG,8(CCWREG)         GET ADDRESS OF CCW         3712 18490000
         B     REXIT                    POST FROM LAST CCW         3712 18510000
TPPR     L     WREG,8(CCWREG)           LOAD ADRS OF NEXT RD COMMAND    18530000
         C     WREG,4(BRREG)            IS IT 1ST IN QUEUE              18550000
         BNE   NOT1ST                                                   18570000
         MVC   4(4,BRREG),0(WREG)       IF SO, PLACE NEXT RD AS 1ST     18590000
         B     TP4POST                                                  18610000
NOT1ST   L     W2REG,4(BRREG)           IF NOT 1ST, LOAD ADRS OF 1ST    18630000
NXTCMP   C     W2REG,ZERO               IS IT ZERO                      18650000
         BNE   NXTCMP1             IF NOT, BRANCH.                 1838 18670000
         TM    5(CCWREG),TPFPCI         FIRST TIME PCI ON          3712 18690000
         BZ    NXTCMP2                  NO, BRANCH               A32477 18710000
         TM    IOBINCAM,ONLTT           ONLTT REQUESTED          A32477 18730000
         BZ    TP4POST                  NO, BRANCH               A32477 18750000
NXTCMP2  EQU   *                                                 A32477 18770000
         TM    15(CCWREG),X'01'        CHECK FOR PREVIOUS PCI      1265 18790000
         BO    TP4POST                 IF SO, DO NOT POST BUFFER   1265 18810000
         LR    CCW2REG,CCWREG           SAVE CCW ADDRESS           3712 18830000
         L     CCWREG,8(CCW2REG)        LOAD ADDRESS PREVIOUS READ 3712 18850000
         BAL   UCBREG,BFRPOST           POST BUFFER                3712 18870000
         LR    CCWREG,CCW2REG           RESTORE CCW ADDRESS        3712 18890000
         L     WREG,8(CCWREG)           ADDRESS OF NEXT READ       3712 18910000
         B     TP4POST                                             3712 18930000
NXTCMP1  C     WREG,0(W2REG)            IS NEXT ENRY MATCH         1838 18950000
         BE    FOUND                    IF SO, BRANCH                   18970000
         L     W2REG,0(W2REG)           IF NOT, LOAD THE NEXT ENTRY     18990000
         B     NXTCMP                   CONTINUE LOOP                   19010000
FOUND    MVC   0(4,W2REG),0(WREG)       REMOVE ENTRY FROM QUEUE         19030000
         C     WREG,8(BRREG)            WAS IT LAST ENTRY               19050000
         BNE   TP4POST                  IF NOT, BRANCH                  19070000
         ST    W2REG,8(BRREG)           IF SO, UPDATE LAST ENTRY ADRS   19090000
TP4POST  MVC   1(3,WREG),K4-1           MOVE 4 TO OTHER CCW RD ADRS     19110000
         L     UCBREG,IOBCSW           LOAD CSW                  A32477 19130000
         SH    UCBREG,K8               BACK UP TO FAILING CCW    A32477 19150000
         TM    5(UCBREG),X'12'         IS THIS READ SKIP CCW     A32477 19170000
         BNO   CHKONLT                 NO TST FOR ONLINE TST   @ZA14130 19190000
*                ONE LINE DELETED BY-------------------------->@ZA14130 19210000
TP3POST1 BAL   UCBREG,BFRPOST           POST CURRENT BUFFER    @ZA14130 19230000
         TM    IOBCSW+4,X'F2'           ANY ERRORS                 3712 19250000
         BNZ   ABNORM                   IF SO, BRANCH              3712 19270000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON        000D 19290000
         BO    EXIT                     IF SO, EXIT                000D 19310000
         TM    DECTYPE+1,RESET          WAS RESET SPECIFIED        000D 19330000
         BZ    EXIT                                              A32477 19350000
DIS      LA    CCWREG,8(CCWREG)        STEP TO NEXT CCW                 19370000
         TM    5(CCWREG),TPRESET       IS THIS A RESET COMMAND          19390000
         BO    TESTEOT                 YES, BRANCH TO TEST FOR EOT      19410000
         TM    5(CCWREG),X'80'          IS THIS LAST CCW                19430000
         BO    EXIT                     YES, EXIT                       19450000
         B     DIS                                                      19470000
TESTEOT  TM    IOBCSW+4,CSWUE          WAS AN EOT RECEIVED              19490000
         BZ    REXIT                   NO, BRANCH TO RESTART            19510000
         TM    5(CCWREG),TPEOCP        IS THIS LAST CCW                 19530000
         BO    EXIT                    YES, EXIT                        19550000
         LA    CCWREG,8(CCWREG)        STEP TO NEXT CCW (DISABLE        19570000
         B     REXIT                   COMMAND), AND BRANCH TO RESTART  19590000
ABNORM   OI    IOBFLAG1,IOBEX          SET ON IOB EXCEPTION        3712 19610000
         B     EXIT                                                3712 19630000
         SPACE 3                                                        19650000
*                             TP OP CODE = 01     ENABLE COMPLETE       19670000
         SPACE                                                          19690000
TP01     TM    UCBTYP+3(UCBREG),BISYNCH IS IT BSC OPERATION        000B 19710000
         BO    TPXX                    YES, EXIT                   000B 19730000
         CLI   0(CCWREG),X'27'          ENABLE CCW                 000B 19750000
         BNE   TPXX                     IF NOT, BRANCH                  19770000
         CLI   IOBECBCC,X'48'           IS INTERRUPT FROM HIO           19790000
         BNE   HIO                      NO, RESTART CHANNEL PROGRAM     19810000
         B     TPXX                     POST BUFFER                     19830000
HIO      EQU   *                                                 Y02947 19850000
         LA    CCWREG,8(CCWREG)                                         19870000
         B     REXIT                                                    19890000
*---------------------------------------------------------------------  19910000
         SPACE 3                                                        19930000
*                             TP OP CODE = 07     COMPARE TWX IDENT     19950000
         SPACE                                                          19970000
TP07     LH    ICREG,6(CCWREG)          LOAD IDENT COUNT                19990000
         L     WREG,0(CCWREG)           LOAD ADDRESS OF IDENT CHAR      20010000
         L     SAVEREG,DECENTRY         LOAD LIST ADDRESS          000L 20030000
         L     UCBREG,REG7(SAVEAREA)  PRIME UCB REG              Y02947 20050000
         TM    UCBTYP+THREE(UCBREG),BISYNCH     BSC ?          @ZA04195 20070000
         BNO   NOACKSET                 NO DON'T SET ACKS      @ZA04195 20090000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK          @ZA04195 20110000
         MVI   IOBSNDPT,ACK0PT          RESET SEND ACK         @ZA04195 20130000
NOACKSET EQU   *                                               @ZA04195 20150000
         CLI   0(SAVEREG),SWLST         IS THIS A SWLST            000L 20170000
         BE    SWITCH                                              000L 20190000
         CLI   0(SAVEREG),FOXE                                     000L 20210000
         BNE   NOTSW                                               000L 20230000
         MVI   0(SAVEREG),SWLST                                    000L 20250000
         B     TURNON                                              000L 20270000
SWITCH   EQU   *                                                   000L 20290000
         SR    SAVEREG,SAVEREG          CLEAR REGISTER             000L 20310000
         SH    WREG,K8                  SUBTRACT 8 FROM AREA ADDR  000L 20330000
         MVC   1(3,WREG),ZERO3          RESET ADDRESS FIELD        000L 20350000
         LA    W2REG,8(WREG,ICREG)      POINT TO DIAL DIGITS       000L 20370000
         IC    ICREG,7(WREG)            GET DIAL COUNT             000L 20390000
         AR    W2REG,ICREG              ADD TO LENGTH OF HEADER    000L 20410000
         IC    ICREG,0(W2REG)           GET ID COUNT               000L 20430000
         LA    W2REG,1(ICREG,W2REG)     POINT TO AUTHORIZED SEQ    000L 20450000
         SH    CCWREG,K8                POINT TO PREVIOUS CCW      000L 20470000
         CLI   5(CCWREG),TPWIDENQ       IS THIS WRITE ID ENQ       000L 20490000
         BE    WRTC                                                000L 20510000
         AH    CCWREG,K8                POINT BACK TO CURRENT CCW  000L 20530000
         IC    SAVEREG,4(WREG)          GET NO. OF LIST ENTRIES    000L 20550000
COMPR    EQU   *                                                   000L 20570000
         LH    ICREG,6(CCWREG)          LOAD RD-IN-AREA LENGTH     000L 20590000
         SH    ICREG,IOBCSW+6           SUBTRACT RESIDUAL COUNT    000L 20610000
         BCTR  ICREG,0                  SUBTRACT ONE FROM COUNT    000L 20630000
         EX    ICREG,COMSEQ             COMPARE SEQUENCES          000L 20650000
         BE    GOODID                                              000L 20670000
         IC    ICREG,5(WREG)            GET ENTRY LENGTH           000L 20690000
         LA    W2REG,0(ICREG,W2REG)     POINT TO NEXT SEQUENCE     000L 20710000
         BCT   SAVEREG,COMPR                                       000L 20730000
         CLC   8(1,WREG),DCBBSENQ       WAS ENQ RECEIVED           000L 20750000
         BE    EXIT                                                000L 20770000
DLEEOTCK EQU   *                                                   000L 20790000
         CLC   8(2,WREG),DCBBSDLE       WAS DLEEOT RECEIVED        000L 20810000
         BE    ISDLEEOT                                            000L 20830000
         OI    DECFLAGS,NOCOMPAR        INDICATE INVALID ID        000L 20850000
         B     NOMATCH                                             000L 20870000
ISDLEEOT EQU   *                                                   000L 20890000
         OI    DECFLAGS,EOTRCVD         INDICATE DLE EOT RECEIVED  000L 20910000
         CLI   DECTYPE+ONE,WRTTC        WRITE CONNECT ?        @ZA04190 20930000
         BNE   TPXX                     NO ,BRANCH             @ZA04190 20950000
         NI    IOBFLAG1,MASKALL-IOBEX   TURN OFF IOB EXECPTION @ZA04190 20970000
         B     TPXX                                                000L 20990000
COMSEQ   CLC   8(0,WREG),0(W2REG)                                  000L 21010000
GOODID   EQU   *                                                   000L 21030000
         ST    W2REG,0(WREG)            STORE ENTRY ADDRESS        000L 21050000
         MVI   0(WREG),SWLST            INDICATE SWLST             000L 21070000
         BAL   SAVEREG,IDMOVE           SAVE ID OF BSC2        @ZA04192 21090000
***         FIVE LINES OF CODE DELETED                         @ZA04192 21110000
         IC    ICREG,5(WREG)            GET ENTRY LENGTH           000L 21130000
         BCTR  ICREG,0                  SUBTRACT ONE FROM LENGTH   000L 21150000
         LA    W2REG,0(ICREG,W2REG)     POINT TO CONTROL BYTE      000L 21170000
         CLI   0(W2REG),ONE             IS CONTROL BYTE 1          000L 21190000
         BNE   NOTONE                                              000L 21210000
         MVC   1(3,WREG),ZERO3          ZERO OUT ADDRESS FIELD     000L 21230000
***           TWO LINES REMOVED BY---------------------------->@ZA14130 21250000
         LA    CCWREG,24(CCWREG)        DISCONNECT LINE            000L 21270000
         B     REXIT                                               000L 21290000
NOTONE   EQU   *                                                   000L 21310000
         CLI   0(W2REG),TWO             IS CONTROL BYTE VALUE 2    000L 21330000
         BNE   REXITB                                              000L 21350000
         B     EXIT                                                000L 21370000
WRTC     EQU   *                                                   000L 21390000
         AH    CCWREG,K8                POINT BACK TO PRESENT CCW  000L 21410000
         CLC   8(2,WREG),DCBBSSAK       WAS WACK RECEIVED          000L 21430000
         BNE   NOTWACK                  IF NOT, BRANCH             000L 21450000
         OI    DECFLAGS,WACKRCV         INDICATE WACK              000L 21470000
TURNON   EQU   *                                                   000L 21490000
         MVI   IOBCPA+5,CONNECT         INDICATE LINE CONNECTION   000L 21510000
         B     TPXX                                                000L 21530000
NOTWACK  EQU   *                                                   000L 21550000
         CLC   8(2,WREG),DCBBSAK0       WAS ACK0 RECEIVED          000L 21570000
         BNE   NOACK0                                              000L 21590000
*           TWO LINES OF CODE DELETED                          @ZA04195 21610000
         B     EXIT                                                000L 21630000
NOACK0   EQU   *                                                   000L 21650000
         CLC   8(1,WREG),DCBBSNAK       WAS NAK RECEIVED           000L 21670000
         BNE   NOTNAK                                              000L 21690000
         OI    DECFLAGS,IMPRESP         INDICATE NOT ACK           000L 21710000
         B     TURNON                                              000L 21730000
NOTNAK   EQU   *                                                   000L 21750000
         LA    CCW2REG,8(WREG)          GET ADDR OF READ-IN-AREA   000L 21770000
         AH    CCW2REG,6(CCWREG)        ADD ORIGINAL COUNT         000L 21790000
         SH    CCW2REG,IOBCSW+6         SUBTRACT RESIDUAL COUNT    000L 21810000
         BCTR  CCW2REG,0                SUBTRACT ONE TO PT TO CHAR 000L 21830000
         CLC   0(1,CCW2REG),DCBBSNAK    IS THIS ID-NAK             000L 21850000
         BE    IDNAK                                               000L 21870000
         BCTR  CCW2REG,0                                           000L 21890000
         CLC   0(2,CCW2REG),DCBBSAK0    IS THIS ID-ACK0 SEQUENCE   000L 21910000
         BNE   DLEEOTCK                                            000L 21930000
IDNAK    EQU   *                                                   000L 21950000
         LA    ICREG,8(WREG)            GET ADDR OF READ-IN-AREA   000L 21970000
       SR      CCW2REG,ICREG            GET LENGTH OF ID           000L 21990000
         BCTR  CCW2REG,0                SUBTRACT ONE               000L 22010000
         SR    ICREG,ICREG              CLEAR REGISTER             000L 22030000
*             5 LINES DELETED FOR THE FOLLOWING APAR            YA02448 22050000
         IC    SAVEREG,4(WREG)          GET NO. OF LIST ENTRIES    000L 22070000
COMPAGIN EQU   *                                                   000L 22090000
         EX    CCW2REG,COMSEQ           COMPARE SEQUENCES          000L 22110000
         BE    GOODSEQ                                             000L 22130000
         IC    ICREG,5(WREG)            GET ENTRY LENGTH           000L 22150000
         LA    W2REG,0(ICREG,W2REG)     POINT TO NEXT SEQUENCE     000L 22170000
         BCT   SAVEREG,COMPAGIN                                    000L 22190000
         OI    DECFLAGS,NOCOMPAR                                   000L 22210000
NOMATCH  OI    IOBCSW+4,CSWUE           SET UNIT EXCEPTION         000L 22230000
         OI    IOBFLAG1,IOBEX          SET IOB EXCEPTION           000L 22250000
         B     TPXX                                                000L 22270000
GOODSEQ  LA    SAVEREG,DONTSAVE         SET RET REG            @ZA04192 22290000
IDMOVE   TM    UCBTYP+DISP1(UCBREG),BSC2 IS THIS BSC2?         @ZA04192 22310000
         BNO   NOSAVE                   NO, DO NOT SAVE ID     @ZA04192 22330000
         SR    UCBREG,UCBREG            CLEAR WORK REG         @ZA04192 22350000
         IC    UCBREG,DCBEIOBX          GET IOB LENGTH         @ZA04192 22370000
         SH    UCBREG,K8                DISP FOR SAVE AREA     @ZA04192 22390000
         AR    UCBREG,IOBREG            ID SAVE AREA           @ZA04192 22410000
         MVC   K0(ID4BYTES,UCBREG),IDDISP(WREG)                @ZA04192 22430000
*                     SAVE 1ST 4 CHARACTERS OF TERMINAL ID     @ZA04192 22450000
         L     UCBREG,REG7(SAVEAREA)    RESTORE UCB REG        @ZA04192 22470000
NOSAVE   BR    SAVEREG                 RETURN                  @ZA04192 22490000
DONTSAVE EQU   *                                                YA02448 22510000
         ST    W2REG,0(WREG)            STORE ADDRESS OF ENTRY     000L 22530000
         MVI   0(WREG),SWLST            INDICATE SWLST             000L 22550000
         LA    W2REG,8(WREG)            LOAD ADDRESS OF RD-IN-AREA 000L 22570000
         AR    CCW2REG,W2REG                                       000L 22590000
         LA    CCW2REG,1(CCW2REG)                                  000L 22610000
         CLC   0(1,CCW2REG),DCBBSNAK    WAS IT ID-NAK              000L 22630000
         BE    GETLEN                                              000L 22650000
         MVI   IOBRCVPT,ACK1PT          RESET RCV ACK POINTER      000L 22670000
         MVI   IOBSNDPT,ACK0PT          RESET SND ACK POINTER      000L 22690000
         B     EXIT                                                000L 22710000
GETLEN   EQU   *                                                   000L 22730000
         OI    DECFLAGS,IMPRESP         INDICATE NOT ACK           000L 22750000
         IC    ICREG,5(WREG)            GET ENTRY LENGTH           000L 22770000
         BCTR  ICREG,0                  SUBTRACT ONE               000L 22790000
         LA    W2REG,0(ICREG,W2REG)     POINT TO CONTROL BYTE      000L 22810000
         CLI   0(W2REG),ONE             IS CONTROL BYTE VALUE 1    000L 22830000
         BNE TURNON                     IF NOT ,ASSUME 0           000L 22850000
         MVI   0(WREG),FOXE                                        000L 22870000
         B     NOMATCH                                             000L 22890000
NOTSW    EQU   *                                                   000L 22910000
         LA    W2REG,0(WREG,ICREG)      LOAD ADDRESS OF COMPARE CHAR    22930000
         BCTR  ICREG,0                  SUB 1 FROM COUNT                22950000
         EX    ICREG,IDCMP              COMPARE IDENTIFICATION          22970000
         BE    IDGOOD                   IF GOOD, BRANCH            000B 22990000
NOT      OI    DECFLAGS,NOCOMPAR        SET FLAG INDICATING TWX    000B 23010000
         B     TPXX                ID DID NOT COMPARE.             000B 23030000
IDCMP    CLC   0(0,WREG),0(W2REG)       COMPARE IDENT INSTRUCTION       23050000
IDGOOD   NI    DECFLAGS,MASKALL-NOCOMPAR                           000B 23070000
         TM    UCBTYP+3(UCBREG),BISYNCH TEST FOR BSC               000B 23090000
         BNO   REXITA                   IF NOT, EXIT               000B 23110000
         TM    UCBTYP+1(UCBREG),BSC2    IS IT BSC2?              S99245 23130000
         BNO   SAVENOT                  NO, DON'T SAVE ID        S99245 23150000
         SR    SAVEREG,SAVEREG            CLEAR REGISTER       @ZA04192 23170000
         IC    SAVEREG,DCBEIOBX      GET IOB LENGTH            @ZA04192 23190000
         SH    SAVEREG,K8                SAVE AREA DISP        @ZA04192 23210000
         AR    SAVEREG,IOBREG          POINT TO ID SAVE AREA   @ZA04192 23230000
         MVC   K0(ID4BYTES,SAVEREG),DISPID(WREG)               @ZA04192 23250000
*                                SAVE 1ST 4 CHARS OF TERM ID   @ZA04192 23270000
SAVENOT  EQU   *                                                 S99245 23290000
*                TWO LINES OF CODE DELETED                     @ZA04195 23310000
         TM    5(CCWREG),TPEOCP         CHK FOR LAST CCW                23330000
         BO    EXIT                     IF SO, DON'T RESTART            23350000
         B     REXITA                                              000B 23370000
         EJECT                                                          23390000
         SPACE 3                                                        23410000
*                             TP OP CODE = 12     READ SKIP             23430000
         SPACE                                                          23450000
TP12AB   TM    4(CCWREG),X'10'         TEST SKIP BIT                    23470000
         BO    TP12ALL                  IF ON, THIS IS READ-SKIP        23490000
         TM    DISP3(CCWREG),TICBIT INVALID TIC ADDR ?      LD @ZA02320 23510000
         BO    POSTBUFR            YES, PCI APP HAS NOT SET LD @ZA02320 23530000
*                                  UP NEXT WRITE YET        LD @ZA02320 23550000
         TM    IOBCSW+DISP5,PROGCHK  PROG. CHECK ?          LD @ZA02320 23570000
         BZ    TP12AC              BR IF NOT                LD @ZA02320 23590000
         CLI   DISP0(CCWREG),TICCMND  TIC COMMAND           LD @ZA02320 23610000
         BNE   TP12AC              BR IF NOT TIC            LD @ZA02320 23630000
         L     CCWREG,DISP0(CCWREG)  GET NEXT CCW           LD @ZA02320 23650000
         LA    CCWREG,DISP0(CCWREG)  CLEAR HI BYTE          LD @ZA02320 23670000
         B     REXIT               RESTART CHANNEL PROGRAM  LD @ZA02320 23690000
TP12AC   EQU   *                                            LD @ZA02320 23710000
         TM    IOBCSW+DISP4,MASKALL  ANY STATUS BUT PCI/CPC LD @ZA02320 23730000
         BNZ   POSTBUFC            YES, POST IT             LD @ZA02320 23750000
         TM    IOBCSW+DISP5,X1F    ANY STATUS BUT PCI/CPC   LD @ZA02320 23770000
         BNZ   POSTBUFC            YES, POST IT             LD @ZA02320 23790000
         L     CCWREG,DISP0(CCWREG)  SET UP RESTART ON WRT  LD @ZA02320 23810000
         B     REXIT               GO TO CHANNEL RESTART    LD @ZA02320 23830000
POSTBUFR EQU   *                                            LD @ZA02320 23850000
         MVI   CODEMSK,CCNORM      GOOD COMPLETION FOR BUFS LD @ZA02320 23870000
         SH    CCWREG,K8           BACK UP ONE CCW          LD @ZA02320 23890000
         TM    DISP5(CCWREG),WRT1ST  FIRST WRITE ?          LD @ZA02320 23910000
         BO    POSTBUF1            YES, POST BUFFER         LD @ZA02320 23930000
         LA    CCWREG,DISP16(CCWREG)  BUMP TWO CCW          LD @ZA02320 23950000
         CLI   DISP5(CCWREG),WRTTEXT  WRITE TEXT ?          LD @ZA02320 23970000
         BE    POSTBUF1            YES, POST IT             LD @ZA02320 23990000
         SH    CCWREG,K32          GO BACK 4 CCW'S          LD @ZA02320 24010000
POSTBUF1 EQU   *                                            LD @ZA02320 24030000
         CLC   DISP1(THREE,CCWREG),K4-ONE IS A BUF ADDR     LD @ZA02320 24050000
         BE    POSTBUF2            YES,DON'T POST           LD @ZA02320 24070000
         BAL   UCBREG,OKPOST       POST IT                  LD @ZA02320 24090000
         MVC   DISP1(THREE,CCWREG),K4-ONE WIPE OUT BUF ADDR LD @ZA02320 24110000
POSTBUF2 EQU   *                                            LD @ZA02320 24130000
         L     CCWREG,DISP8(CCWREG)  ADDRESS OF NEXT WRT    LD @ZA02320 24150000
         N     CCWREG,MASKDB       ADJUST TO BEGINNING      LD @ZA02320 24170000
POSTBUF4 EQU   *                                            LD @ZA02320 24190000
         CLC   DISP3(THREE,CCWREG),K4-ONE IS A BUF ADDRSS   LD @ZA02320 24210000
         BE    POSTBUF3            YES, DON'T POST          LD @ZA02320 24230000
         BAL   UCBREG,OKPOST       POST IT                  LD @ZA02320 24250000
POSTBUF3 EQU   *                                            LD @ZA02320 24270000
         LA    CCWREG,DISP16(CCWREG)  BUMP 2 CCW'S             @ZA04650 24290000
         CLI   DISP5(CCWREG),A0     TP-OP OF LAST CCW          @ZA04650 24310000
         BE    REXIT                 YES, RESTART ON NEXT CCW  @ZA04650 24330000
         OI    IOBFLAG1,IOBEX      SET ABNORMAL COMP        LD @ZA02320 24350000
         MVI   IOBECBPT,CCPER      COMPLETION CODE          LD @ZA02320 24370000
         B     EXIT                                         LD @ZA02320 24390000
POSTBUFC EQU   *                                            LD @ZA02320 24410000
         MVI   CODEMSK,CCNORM      GOOD COMPLETION CODE     LD @ZA02320 24430000
         SH    CCWREG,K8           ONLY PREVIOUS BUFFER     LD @ZA02320 24450000
*                                  SHOULD BE POSTED         LD @ZA02320 24470000
         B     POSTBUF4            POST IT                  LD @ZA02320 24490000
TP12     NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      24510000
TP12ALL  TM    4(CCWREG),X'08'          TEST FOR PCI BIT                24530000
         BO    RS1                      IF ON, THIS IS 1ST R-S COMMAND  24550000
         SH    CCWREG,K8                IF NOT BACK UP 1 CCW            24570000
         B     RSERR                                                    24590000
RS1      CLC   IOBCSW+6(2),6(CCWREG)    DOES RESIDUAL COUNT = CCW COUNT 24610000
         BE    RSP                      IF SO, NO DATA WAS LOST         24630000
RSERR    OI    DECFLAGS,X'08'           SET ERROR BIT FOR LOST DATA     24650000
RSP      SH    CCWREG,K8                BACK UP TO READ DATA CCW        24670000
RSP1     CLI   0(CCWREG),X'02'     IS THIS A READ COMMAND        A41134 24690000
         BNE    NOTREAD                NO, BRANCH OUT              2725 24710000
         L     UCBREG,8(CCWREG)        POINT TO NEXT READ DATA     2725 24730000
         CLC   1(3,UCBREG),K4-1        TEST IF BUFF REQ PURGED     2725 24750000
         BNE   PURGE                                               2725 24770000
NOTREAD  BAL   UCBREG,BFRPOST          GO TO POST BUFFER           2725 24790000
         B     EXIT                                                1838 24810000
         SPACE 3                                                        24830000
PURGE    IC    ICREG,DEBNMEXT(DEBREG)  PTR TO BUFFER ROUTINE       2725 24850000
         SLL   ICREG,2                                             2725 24870000
         LA    BRREG,DEBUCBAD(ICREG,DEBREG)                        2725 24890000
         B     TPPR                                                2725 24910000
         SPACE   2                                                      24930000
*                             TP OP CODE = 20,21  RD RESPONSE, RESET    24950000
         SPACE                                                          24970000
TP2A     TM    DCBBFTEK,X'08'           TEST FOR DYNAMIC BUFFERING      24990000
         BZ    CHKONLTS                 IF NOT, EXIT               000D 25010000
         LA    UCBREG,EXIT              SET UP E/                  1838 25030000
TP2AA    EQU   *                                                 A32454 25050000
         LA    CCWREG,0(CCWREG)         CLEAR 1ST BYTE OF REGISTER      25070000
         LA    CCW2REG,IOBCPA           LOAD ADRS OF START OF CHNL PROG 25090000
BKP      CR    CCW2REG,CCWREG           ARE WE BACKED UP TO START OF CP 25110000
         BL    BACKUP                   NO, BACKUP 0NE CCW     @ZA06404 25130000
         CLI   0(CCWREG),X'01'          IS THIS WRITE CIRCLE C   A30746 25150000
         BNE EXIT                       IF NOT, EXIT             A30746 25170000
         CLI   IOBECBCC,X'48'           IS INTERRUPT FROM HIO    A30746 25190000
         BE    FINDRW                   YES, POST RD TEXT BUFFER A30746 25210000
         CLI   IOBECBCC,X'41'           IS ECB POSTED WITH ERROR A30746 25230000
         BE    FINDRW                   YES, POST RD TEXT BUFFER A30746 25250000
         B     EXIT                     IF NOT, EXIT             A30746 25270000
BACKUP   SH    CCWREG,K8                BACK UP ONE CCW          A30746 25290000
         CLI   5(CCWREG),X'11'          IS THIS DATA CCW                25310000
         BNE   BKP                      IF NOT, LOOP                    25330000
         CLI   0(CCWREG),X'02'          IS COMMAND READ                 25350000
         BE    EXIT                     IF SO, EXIT                     25370000
         TM    4(CCWREG),DATAC          IS THIS LAST WRITE CCW          25390000
         BZ    RRR                      IF SO, DATA CHAINING BIT IS OFF 25410000
         SH    CCWREG,K16               IF NOT, BACK UP 2 MORE CCW'S    25430000
RRR      SH    ICREG,K8                 SUBTRACT 8 FROM MULTIPLIED OFST 25450000
         BM    BFRPOST                  IF MINUS THIS IS READ RESPONSE  25470000
         MVI   CODEMSK,X'7F'            IF NOT, POST WITH 7F            25490000
         B     BFRPOSTA                                                 25510000
TP21AB   CLI   DECTYPE+1,OPTPWTN        WRITE TN?  IF NOT,         000A 25530000
         BE    CHKEOCP                  DO NOT BRANCH              000C 25550000
         CLI   DECTYPE+1,OPTPWTD        WRITE TD    IF NOT,        000C 25570000
         BNE   TP2A                BRANCH.                         000A 25590000
CHKEOCP  TM    5(CCWREG),TPEOCP         END OF CHANNEL PROGRAM     000C 25610000
         BO    TP2A                IF SO, BRANCH.  IF NOT, GET     000A 25630000
         LA    CCWREG,8(CCWREG)    ADDRESS OF NEXT CCW AND GO TO   000A 25650000
         B     REXIT               RESTART CHANNEL PROGRAM ON NEXT 000A 25670000
*                                  CCW (DISABLE COMMAND).          000A 25690000
*              ONE LINE DELETED BY---------------------------->@ZA14130 25710000
*        SPACE 3                                                        25730000
*              TP OP CODE = 23  WRITE BREAK OR 2740 BREAK TEST          25750000
         SPACE 2                                                   000I 25770000
*                                                                  000I 25790000
BRKTST   CLI   0(CCWREG),PREP           2741 BREAK TEST            000I 25810000
         BNE   EXIT                     NO                         000I 25830000
PWROFF   NI    IOBFLAG1,MASKALL-IOBEX   TURN OFF IOBEXCEPTION      000I 25850000
         NI    IOBINCAM,MASKALL-BUSY    SET OFF BUSY BIT           000I 25870000
         MVI   IOBECBPT,CCPER           SET ERROR RETURN CODE      000I 25890000
         TM    IOBCSW+4,CSWUC                                      000I 25910000
         BZ    BREAK                                               000I 25930000
         OI    DECFLAGS,X'04'                                      000I 25950000
         B     EXITREST                                            000I 25970000
BREAK    OI    DECFLAGS,X'02'                                      000I 25990000
         B     EXITREST                                            000I 26010000
         SPACE 2                                                   000I 26030000
*                             TP OP CODE = 25  READ RESP TO TEXT        26050000
         SPACE 1                                                        26070000
TP25     SR    ICREG,ICREG              CLEAR REGISTER             000B 26090000
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLG  000B 26110000
         LA    WREG,DECRESPN            LOAD ADDR OF RESP FIELD    000B 26130000
         LH    W2REG,6(CCWREG)         GET ORIGINAL COUNT         23134 26150000
*                                                                       26170000
*        5 LINES REMOVED FOR ----->                         LD @ZA02317 26190000
*                                                                       26210000
         CH    W2REG,IOBCSW+DISP6  IS COUNT GREATER THAN 2  LD @ZA02317 26230000
         BE    SETUE                                        LD @ZA02317 26250000
         IC    ICREG,IOBRCVPT                               LD @ZA02317 26270000
         LA    ICREG,DCBBSAK0(ICREG)                        LD @ZA02317 26290000
         CH    W2REG,K2+TWO                                 LD @ZA02317 26310000
         BH    MOVERESP            MOVE RESP TO DECRESPN    LD @ZA02317 26330000
         CLI   IOBCSW+DISP7,ONE    1 BYTE RCVD IF CNT 1     LD @ZA02317 26350000
         BNE   DECRRESP            MUST BE TWO BYTES        LD @ZA02317 26370000
         B     NOTACK                                       LD @ZA02317 26390000
MOVERESP EQU   *                                            LD @ZA02317 26410000
         SH    W2REG,IOBCSW+RESIDCNT  SUBTRACT RSIDUAL COUNT    YA02162 26430000
         CH    W2REG,K1                 IS COUNT = 1?           YA02162 26450000
         BH    GETADDR                  NO, BRANCH              YA02162 26470000
         L     WREG,DECAREA           ADDR OF READ IN AREA  LD @ZA02317 26490000
         TM    DCBBFTEK,DYNBF           DYNAMIC BUFFERING?      YA02162 26510000
         BZ    CLRRESP                  NO, BRANCH              YA02162 26530000
         AH    WREG,K4                  INCR FOR BUFFER LINK    YA02162 26550000
CLRRESP  EQU   *                                                YA02162 26570000
         XC    DECRESPN(RESPNLNG),DECRESPN CLEAR RESP FIELD     YA02162 26590000
         MVC   DECRESPN(ONECHAR),DISP0(WREG) MOVE IN RESP       YA02162 26610000
*                                                                       26630000
*        3 LINES REMOVED FOR ----->                         LD @ZA02317 26650000
*                                                                       26670000
         B     NOTACK                                       LD @ZA02317 26690000
GETADDR  EQU   *                                                YA02162 26710000
         BAL   W2REG,FINDADDR           FIND ADDR OF RESP FIELD    000B 26730000
*                                                                       26750000
*        2 LINES DELETED FOR ----->                         LD @ZA02317 26770000
*                                                                       26790000
         MVC   DECRESPN(2),0(WREG)      PUT RESPONSE IN RESP FIELD 000F 26810000
DECRRESP EQU   *                                            LD @ZA02317 26830000
*                2 LINES DELETED BY THE FOLLOWING APAR          YA02161 26850000
*        1 LINE DELETED FOR ----->                          LD @ZA02317 26870000
*                                                                       26890000
         CLC   0(2,WREG),0(ICREG)       TEST FOR PROPER RESP       000E 26910000
         BE    RCVFLIP                  BRANCH IF SO               000F 26930000
         CLC   0(2,WREG),DCBBSSAK       CHECK FOR WACK             000J 26950000
         BNE   CHKRVI                   IF NOT, BRANCH             000F 26970000
         OI    DECFLAGS,WACKRCV         INDICATE WACK     RECVD    000J 26990000
         B     TP25A                    GO CHECK FOR CONVERSAT   A32454 27010000
CHKRVI   CLC   0(2,WREG),DCBBSRVI       CHECK FOR REVERSE INTERRUPT000F 27030000
         BNE   CHKACK                   IF NOT, CHECK OTHER ACK    000F 27050000
         OI    DECFLAGS,RVIRCV          INDICATE REVERSE INTERRUPT 000F 27070000
         XI    IOBINCAM,CKRVIRPT   TURN ON SWITCH IF PROPER RVI;   000J 27090000
*   SWITCH WAS TURNED OFF BY "RCVFLIP";  TURN OFF IF INPROPER      000J 27110000
         TM    IOBINCAM,CKRVIRPT   PROPER RVI? PROPER ONLY IF      000J 27130000
*                                        INTERVENING  ACK0-1       000J 27150000
         BO    RCVFLIP1            IN PLACE OF ACK PTR             000J 27170000
         B     SETUE               NO, SET UE FOR ERP              000J 27190000
RCVFLIP  NI    IOBINCAM,STRVIRPT   TURN OFF RVI SWITCH; PROPER     000J 27210000
         NI    DECFLAGS,OKACK                                      000J 27230000
RCVFLIP1 XI    IOBRCVPT,FLIP       UPDATE ACK POINTER              000J 27250000
         NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION      000E 27270000
         TM    5(CCWREG),TPEOCP         IS THIS LAST CCW           000E 27290000
         BO    CHKONLT1                 COMPLETE PROCESSING        000F 27310000
         TM    13(CCWREG),TPRESET       IS NEXT CCW RESET OPERATION000F 27330000
         BO    REXITB                   YES, EXECUTE               000F 27350000
CHKONLT1 TM    DECDCBAD,ONLTRFT        WAS ONLTST MACRO USED     A28612 27370000
         BZ    TP25A                    IF NOT, BRANCH           A32454 27390000
         L     WREG,DECAREA             GET ADDR OF TEXT AREA      000D 27410000
         TM    DCBBFTEK,DYNBF           IS DYNAMIC BUFFERING USED  000D 27430000
         BZ    STOREREG                 NO, STORE ADDR IN IOB      000D 27450000
         AH    WREG,K4                  INCREMENT FOR BUFFER LINK  000D 27470000
STOREREG ST    WREG,IOBERINF                                       000D 27490000
         TM    DECTYPE+1,ONLTTSTW       IS THE OPERATION WR TI     000D 27510000
         BZ    EXITONLT                 IF SO, GO SCHEDULE ONLT    000D 27530000
         NI    DECDCBAD,MASKALL-ONLTRFT   TURN ONLTST BIT OFF    A28612 27550000
         B     TP25A                    GO CHECK FOR CONVERSAT   32454  27570000
CHKACK   X     ICREG,K2                 POINT TO OTHER ACK         000B 27590000
         CLC   0(2,WREG),0(ICREG)       TEST FOR WRONG ACK         000E 27610000
         BNE   NOTACK                   IF NOT, IT'S SOMETHING ELSE000B 27630000
         OI    DECFLAGS,WRONGACK        SETON WRONG ACK BIT        000B 27650000
         B     SETUE                                               000B 27670000
*                                                                       27690000
*        2 LINES DELETED FOR ----->                         LD @ZA02317 27710000
*                                                                       27730000
NOTACK   EQU   *                                            LD @ZA02317 27750000
         OI    DECFLAGS,IMPRESP         SET NO ACK RECEIVED BIT YA02161 27770000
         CLC   0(1,WREG),DCBBSEOT       CHECK FOR EOT              000B 27790000
         BNE   TP25CONV                 BRANCH IF NOT            A32454 27810000
RESETACK EQU   *                                                 A32454 27830000
         NI    IOBRCVPT,ACK0PT          RESET ACK POINTER        A25664 27850000
         B     TP25A                                             A32454 27870000
TP25CONV CLC   1(1,WREG),DCBBSEOT       CHECK EOT ON CONVERSAT   A32454 27890000
         BE    RESETACK                 BRANCH IF YES            A32454 27910000
         TM    DCBXMODE,INTBLCHK        INTERMEDIATE BLOCK CHECK A32454 27930000
         BZ    CKETXETB                 NO, BRANCH               A32454 27950000
         BCTR  WREG,0                   YES, ADJUST POINTER      A32454 27970000
CKETXETB CLC   1(1,WREG),DCBBSETX       CHECK FOR ETX            A32454 27990000
         BE    TP25A                    YES, BRANCH              A32454 28010000
         CLC   1(1,WREG),DCBBSETB       CHECK FOR ETB            A32454 28030000
         BE    TP25A                    YES, BRANCH              A32454 28050000
SETUE    OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION      000B 28070000
         OI    IOBFLAG1,IOBEX           SET IOB EXCEPTION          000B 28090000
TP25A    EQU   *                                                 A32454 28110000
         CLI   DECTYPE+DISP1,X84   WRT CONT RESET(TTR)      LD @ZA02321 28130000
         BE    TP25B                                        LD @ZA02321 28150000
         CLI   DECTYPE+DISP1,X82   WRT INIT RESET(TIR)      LD @ZA02321 28170000
         BE    TP25B                                        LD @ZA02321 28190000
TP25C    EQU   *                                            LD @ZA02321 28210000
         CLI   DECTYPE+1,X'16'          WRITE ENQ                A32454 28230000
         BE    TP25CC                   YES, BRANCH            @ZA04852 28250000
         TM    DECTYPE+1,WRTIV          WRITE CONVERSATIONAL     A32454 28270000
         BNO   TP2A                                              A32454 28290000
SNDFLIP  CLC   DISP0(TWO,WREG),DCBBSSAK  WAS WACK RECEIVED?    @ZA04852 28310000
         BE    CHKDB               YES, DON'T UPDATE ACK PTRS   YA01027 28330000
*               ONE LINE DELETED FOR THE FOLLOWING APAR         YA02163 28350000
         CLC   ONE(ONE,WREG),DCBBSETX    CHECK FOR ETX         @ZA07638 28370000
         BNE   CHKDB            NO BRANCH                      @ZA07638 28390000
         XI    IOBSNDPT,FLIP         UPDATE SND ACK PRT        @ZA07638 28410000
         XI    IOBRCVPT,FLIP         UPDATE RCV ACK PRT        @ZA07638 28430000
CHKDB    EQU   *                                                YA01027 28450000
         TM    DCBBFTEK,X'08'      DYNAMIC BUFFER                A32454 28470000
         BZ    CHKONLTS                 NO, BRANCH               A32454 28490000
         LA    UCBREG,TP25AA                                     A32454 28510000
         B     TP2AA                                             A32454 28530000
TP25CC   LH    W2REG,DISP6(CCWREG) GET ORG COUNT 2 OR 20       @ZA04852 28550000
         CH    W2REG,IOBCSW+DISP6  IS COUNT GREATER THAN 2     @ZA04852 28570000
         BNH   TPXX                                            @ZA04852 28590000
* WREG POINTS TO END OF DATA-2 ( OR DATA-3 IF ITB)             @ZA04852 28610000
         CLC   ONE(ONE,WREG),DCBBSETX    ETX ?                 @ZA04852 28630000
         BE    SNDFLIP                                         @ZA04852 28650000
         CLC   ONE(ONE,WREG),DCBBSETB        ETB ?             @ZA04852 28670000
         BE    SNDFLIP                                         @ZA04852 28690000
         B     TPXX                                            @ZA04852 28710000
TP25B    EQU   *                                            LD @ZA00536 28730000
         SR    ICREG,ICREG         CLEAR REG                L5 @ZA03966 28750000
         IC    ICREG,IOBRCVPT      GET ACK POINTER          L5 @ZA03966 28770000
         LA    ICREG,DCBBSAK0(ICREG)  GET EXPECTED ACK      L5 @ZA03966 28790000
         CLC   0(2,WREG),0(ICREG)  CORRECT ACK              L5 @ZA03966 28810000
         BE    TP25BA              YES,CHECK FOR RESET      L5 @ZA03966 28830000
         B     CHKDB               NO, DON'T WRITE EOT      L5 @ZA03966 28850000
TP25BA   EQU   *                                            L5 @ZA03966 28870000
         TM    DISP13(CCWREG),TPRESET  IS NXT CCW RESET OP  LD @ZA00536 28890000
         BO    REXITB              YES                      LD @ZA02321 28910000
         B     TP25C               NO, CHK WRT ENQ          LD @ZA02321 28930000
TP25AA   EQU   *                                                 A32454 28950000
         L     CCWREG,IOBCSW            LOAD CCW ADDRESS         A32454 28970000
         SH    CCWREG,K8                ADJUST TO PROPER CCW     A32454 28990000
         B     TPXX                     BRANCH TO POST RD BUFFER A32454 29010000
         SPACE 3                                                        29030000
FINDADDR L     WREG,0(CCWREG)           LOAD ADDRESS OF I/O AREA   000B 29050000
         AH    WREG,6(CCWREG)           ADD MESSAGE LENGTH         000B 29070000
         SH    WREG,IOBCSW+6            SUBTRACT RESIDUAL COUNT    000B 29090000
         SH    WREG,K2+2                SUBTRACT TWO               000B 29110000
         BR    W2REG                    RETURN                     000B 29130000
         SPACE 3                                                        29150000
TPXX     TM    DCBBFTEK,X'08'           TEST FOR DYNAMIC BUFFERING      29170000
         BZ    EXIT                     NO                              29190000
         LA    UCBREG,EXIT                                         1838 29210000
FINDRW   TM    5(CCWREG),X'10'          FIND 1ST R/W DATA COMMAND       29230000
         BO    BFRPOST                  IF 1ST PCI BIT FOUND            29250000
         TM    5(CCWREG),TPEOCP         TEST FOR END OF CHNL PROGRAM    29270000
         BO    EXIT                     IF SO, EXIT                     29290000
         LA    CCWREG,8(CCWREG)         STEP TO NEXT CCW                29310000
         B     FINDRW                                                   29330000
         EJECT                                                          29350000
         SPACE 3                                                        29370000
*                             POST BUFFER ROUTINE                       29390000
         SPACE                                                          29410000
BFRPOST  MVC   CODEMSK(1),IOBECBPT                                      29430000
BFRPOSTA TM    IOBFLAG1,X'04'           IS IOB EXCEPTION FLAG ON        29450000
         BZ    OKPOST                   IF NOT, BRANCH TO POST          29470000
         CLI   IOBECBPT,X'7F'           CHECK FOR NOMRAL COMPLETION     29490000
         BE    EXIT                                                     29510000
         CLI   5(CCWREG),X'13'          IS THIS WR DLE STX       A32465 29530000
         BNE   OKPOST                   NO, BRANCH               A32465 29550000
         TM    DCBBFTEK,X'08'           DYNAMIC BUFFERING        A32465 29570000
         BZ    WRTEXT1                  NO, BRANCH               A32465 29590000
         LA    CCWREG,0(CCWREG)         ZERO HI-ORDER BYTE       A32465 29610000
         LR    BUFREG,CCWREG            LOAD INTO BUFREG         A32465 29630000
WRTEXT   SH    BUFREG,K8                BACKUP TO PREV CCW       A32465 29650000
         L     UCBREG,0(BUFREG)         LOAD DATA AREA           A32465 29670000
         LA    UCBREG,0(UCBREG)         ZERO HI-ORDER BYTE       A32465 29690000
         CR    UCBREG,CCWREG            IS THIS TIC CCW          A32465 29710000
         BNE   WRTEXT                   NO, BRANCH               A32465 29730000
         LR    CCWREG,BUFREG            LOAD WR DATA CCW         A32465 29750000
         LA    UCBREG,EXIT              LOAD EXIT REG            A32465 29770000
WRTEXT1  SH    CCWREG,K8                BACK UP TO WR TEXT       A32465 29790000
OKPOST   L     BUFREG,0(CCWREG)         LOAD BUFFER ADDRESS             29810000
         LA    BUFREG,0(BUFREG)        CLEAR OUT HIGH ORDER BYTE A27621 29830000
         LTR   BUFREG,BUFREG           TEST FOR ADDRESS OF ZERO  A27621 29850000
         BCR   8,UCBREG                BRANCH IF YES             A27621 29870000
         SH    CCWREG,K8           SUB 8 PREV CCW           LD @ZA02312 29890000
         TM    DISP5(CCWREG),RDRESP CHK RD RESP TXT OP-CODE LD @ZA02312 29910000
         BNO   NOT25               IF NOT BRANCH            LD @ZA02312 29930000
         L     BUFREG,DISP8(CCWREG)  LOAD DATA RD TXT       LD @ZA02312 29950000
         SH    BUFREG,TWENTY       SUB CNT RD RESP CCW      LD @ZA02312 29970000
         CL    BUFREG,0(CCWREG)    EQ DATA ADD OF RESP      LD @ZA04157 29990000
         BNE   NOT25               TEST CCW ? IF NOT BR     LD @ZA02312 30010000
         AH    CCWREG,K8           RESTORE CCWREG           LD @ZA02312 30030000
         B     TWENTY5             AND CONTINUE             LD @ZA02312 30050000
NOT25    EQU   *                                            LD @ZA02312 30070000
         AH    CCWREG,K8                                    LD @ZA02312 30090000
         L     BUFREG,0(CCWREG)        LOAD BUFFER ADDRESS       A27621 30110000
TWENTY5  EQU   *                                            LD @ZA02312 30130000
         N     BUFREG,MASKDB            AND TO WORD BOUNDARY            30150000
         SH    BUFREG,K4                SUB TO LINK FIELD               30170000
         TM    15(CCWREG),X'01'        CHECK FOR PREVIOUS PCI      1265 30190000
         BO    ECBREG0                 YES, DON'T POST AGAIN       1265 30210000
         CLI   0(CCWREG),WRITE                                          30230000
         BNE   NORMPOST                                                 30250000
         TM    4(CCWREG),DATAC                                          30270000
         BO    NORMPOST                                                 30290000
ECBREG0  L     ECBREG,ZERO                                         1265 30310000
         B     ORCC                                                     30330000
NORMPOST L     ECBREG,8(CCWREG)         LOAD NEXT TEXT CCW       A38543 30350000
         N     ECBREG,MASKDB            AND TO WORD BOUNDARY            30370000
         L     ECBREG,0(ECBREG)         LOAD ADDRESS OF NEXT BUF A38543 30390000
         SH    ECBREG,K4                SUB TO LINK FIELD        A38543 30410000
         N     ECBREG,MASKDB            AND OFF COMMAND CODE            30430000
ORCC     O     ECBREG,CODEMSK           OR IN COMPLETION CODE           30450000
         LR    ZREG,BASEREG             SAVE BASE REGISTER.        000B 30470000
         LR    ICREG,BAS2REG           SAVE 2ND BASE REGISTER    A41115 30490000
         L     BASEREG,DEBTCBAD(DEBREG) LOAD ADDRESS OF TCB        000D 30510000
         L     WREG,SIXT                LOAD OFFSET TO POST ROUTINE     30530000
         USING CVT,WREG                 ESTABLISH CVT ADDR       Y02947 30550000
         L     BRREG,CVT0PT01           ADRS OF SUPVR POST RT    Y02947 30570000
         DROP  WREG                     DROP CVT ADDRESSABILITY  Y02947 30590000
         BALR  RETREG,BRREG             LINK TO POST ROUTINE            30610000
         LR    BASEREG,ZREG             RESTORE BASE REGISTER.     000B 30630000
         LR    BAS2REG,ICREG           RESTORE 2ND BASE REGISTER A41115 30650000
         L     ECBREG,IOBECBPT          RESTORE ADDRESS OF DECB         30670000
         BR    UCBREG                                              1838 30690000
         EJECT                                                          30710000
CHKONLT  EQU   *                                                   000L 30730000
         CLI   DECTYPE+1,RCONTONE       READ CONNECT WITH TONE     000L 30750000
         BE    LDUCB                                               000L 30770000
         TM    DECTYPE+1,X'01'          IS OPERATION READ        A24931 30790000
         BNO   EXIT2                    NO,EXIT                  A32477 30810000
LDUCB    EQU   *                                                   000L 30830000
         L     UCBREG,REG7(SAVEAREA)    PRIME UCB REGISTER       Y02947 30850000
         TM    UCBTYP+3(UCBREG),BISYNCH IS THIS BI-SYNCH           000D 30870000
         BNO   CHKONLTS                 CHECK START STOP           000D 30890000
         L     WREG,DECAREA             LOAD ADDRESS OF AREA       000M 30910000
         TM    DCBBFTEK,DYNBF           DYNAMIC BUFFERING SPECIFIED 00M 30930000
         BZ    NODYNBF                  NO, BRANCH                 000M 30950000
         LA    WREG,4(WREG)             INCREMENT PAST LINK FIELD  000M 30970000
NODYNBF  TM    UCBTYP+1(UCBREG),X'40'   MULTIPOINT LINE            000M 30990000
         BZ    PONTPT                   NO, BRANCH                 000M 31010000
         TM    DECTYPE+1,ONLTTSTR       IS THIS READ INITIAL       000M 31030000
         BNZ   PONTPT                   NO, BRANCH                 000M 31050000
         LA    WREG,1(WREG)             INCREMENT PAST INDEX BYTE  000M 31070000
PONTPT   CLC   0(2,WREG),DCBBSONL       ARE FIRST 2 CHARS SOH %    000M 31090000
         BNE   EXIT2                    NO, BYPASS               A32477 31110000
         TM    DCBXCODE,X'0C'           EBCDIC TRANSMISSION        000M 31130000
         BNZ   CHKASCII                 NO, CHECK UNASCII          000M 31150000
         CLI   MSGTYPE(WREG),EBSLASH    IS THIRD CHAR / ?               31170000
         BE    SETRVI                   GO SET UP TO CLEAR GEN POLL     31190000
         CLI   MSGTYPE(WREG),EBR        IS THIRD CHAR R ?               31210000
         BE    RMSGEBA             SENSE/STATUS MSG RCVD       @ZA14067 31230000
         CLC   2(1,WREG),EBS            THIRD CHAR S ?             000M 31250000
         BNE   CHKEC                    NO, CHECK FURTHER          000M 31270000
SETSTMSG OI    DECFLAGS,SMSG            SET ON STATUS MSG BIT      000M 31290000
         B     EXIT2                    BRANCH OUT               A32477 31310000
CHKEC    EQU   *                                                   000M 31330000
         CLC   2(1,WREG),EBE            THIRD CHARACTER E          000M 31350000
         BE    ERRMSG                   ERROR MESSAGE RECEIVED     000M 31370000
         CLC   2(1,WREG),EBC            CHARACTER C                000M 31390000
         BE    ERRMSG                   YES, HANDLE            @ZA04877 31410000
         TM    MSGTYPE(WREG),XF0       EBCDIC NUMERIC ?        @ZA04877 31430000
         BNO   EXIT2  NO, CAN'T BE AN RFT OR RECOGNIZED SENSE/ @ZA04877 31450000
*                        STATUS MESSAGE, SO TREAT AS DATA      @ZA04877 31470000
         B     TSTONLT                 YES, BRANCH             @ZA04877 31490000
CHKASCII TM    DCBXCODE,X'04'           USASCII TRANSMISSION       000M 31510000
         BNO   TSTONLT                  6-BIT, CHECK ONLT          000M 31530000
         CLI   MSGTYPE(WREG),USSLASH    IS THIRD CHAR / ?               31550000
         BE    SETRVI                   GO SET UP TO CLEAR GEN POLL     31570000
         CLI   MSGTYPE(WREG),USR        IS THIRD CHAR R ?               31590000
         BE    RMSGASC             SENSE/STATUS MSG RCVD                31610000
         CLC   2(1,WREG),USS           THIRD CHAR S?               000M 31630000
         BE    SETSTMSG                                                 31650000
CHKUCE   CLC   2(1,WREG),USE           THIRD CHAR E?               000M 31670000
         BE    ERRMSG                  YES, INDICATE ERROR MSG REC'D    31690000
         CLC   2(1,WREG),USC            ERROR MSG                  000M 31710000
*                               ONE LINE CODE DELETED BY------>@ZA14068 31730000
         BE    ERRMSG                   YES, HANDLE            @ZA04877 31750000
         TM    MSGTYPE(WREG),X30      ASCII NUMERIC ?          @ZA04877 31770000
         BNO   EXIT2 NO CAN'T BE AN RFT OR RECOGNIZED AS SENSE @ZA04877 31790000
*                 /STATUS MESSAGE, SO TREAT AS DATA.           @ZA04877 31810000
         B     TSTONLT                 YES, BRANCH             @ZA04877 31830000
ERRMSG   ST    WREG,IOBERINF            STORE AREA ADDRESS         000M 31850000
         OI    IOBCSW+4,CSWUE           SET ON UNIT EXCEPTION      000M 31870000
         OI    IOBFLAG1,IOBEX           SET ON IOB EXCEPTION       000M 31890000
         B     EXIT2                                             A32477 31910000
TSTONLT  EQU   *                                                   000M 31930000
         TM    DCBERROP,ONLT            ARE TERMINAL TESTS SPEC'D  000D 31950000
         BZ    EXIT2                    IF NOT, DON'T TEST RFT   A32477 31970000
         B     TSTONLT2                 CHECK OPERATIONS         S99245 31990000
DIAL3270 EQU   *                                                 S99245 32010000
         MVC   MSGTYPE(DLRFTLNG,WREG),MSGSTART(WREG)             S99245 32030000
*                            CONVERT 3270 DIAL RFT TO BTAM STD   S99245 32050000
TSTONLT2 EQU   *                                                        32070000
         CLI   DECTYPE+1,RDINIT         IS THIS A READ INITIAL?         32090000
         BE    SETONLT                                                  32110000
         CLI   DECTYPE+1,RDCONECT       IS THIS A READ CONNECT          32130000
         BE    SETONLT                                                  32150000
         CLI   DECTYPE+1,RDCONT         IS THIS A READ CONTINUE ?       32170000
         BE    SETONLT             YES,CONTINUE OLT SET UP      YA01030 32190000
         CLI   DECTYPE+1,RCONTONE       READ CONNECT WITH TONE          32210000
         BNE   EXIT2                                             A32477 32230000
         B     SETONLT                                             000M 32250000
SETRVI   EQU   *                                                        32270000
         TM    DCBERROP,ONLT       ARE TERM TESTS SPEC'D                32290000
         BZ    EXIT2               NO  DON'T CONVERT                    32310000
         OI    IOBINCAM,RFTBIT     SET RFT REC'D FROM GEN POL CU        32330000
         TM    UCBTYP+1(UCBREG),BSC2    IS THIS BSC2?            S99245 32350000
         BO    DIAL3270          YES, GO CONVERT DIAL 3270 RFT   S99245 32370000
         MVC   MSGTYPE(MSGLNGTH,WREG),MSGSTART(WREG)  CONVERT           32390000
*                                       TO STANDARD BTAM RFT            32410000
         B     TSTONLT2                 CONTINUE CHECKING               32430000
RMSGEBA  EQU   *                                            LD @ZA02315 32450000
         TM    UCBTYP+ONE(UCBREG),BSC2  IS THIS BSC2 ?      LD @ZA02315 32470000
         BNO   RMSGEBC             BR IF NOT                LD @ZA02315 32490000
         NI    DECFLAGS,SOHRBIT1                            LD @ZA02315 32510000
         OI    DECFLAGS,SOHRBIT2                            LD @ZA02315 32530000
         CLC   DISP4(STATLNG,WREG),DEEBC  DVC END ALONE     LD @ZA02315 32550000
         BE    EXIT2               PROCESS NORMALLY         LD @ZA02315 32570000
         CLC   DISP4(TWO,WREG),DBEBC  DVC BUSY ALONE        LD @ZA02315 32590000
         BE    EXIT2               PROCESS NORMALLY         LD @ZA02315 32610000
         CLC   DISP4(TWO,WREG),DBOCEBC OP CK AND BUSY ALONE LD @ZA02315 32630000
         BNE   ERRMSG              NO,SCHEDULE ERP          LD @ZA02315 32650000
         B     EXIT2               PROCESS NORMALLY         LD @ZA02315 32670000
RMSGEBC  EQU   *                                                        32690000
         NI    DECFLAGS,SOHRBIT1   INDICATE SOH%R MSG RCVD              32710000
         OI    DECFLAGS,SOHRBIT2                                        32730000
         CLC   STAT(STATLNG,WREG),DEEBC DVC END ALONE                   32750000
         BE    EXIT2               YES, PROCESS NORMALLY                32770000
         CLC   STAT(STATLNG,WREG),DBEBC DVC BUSY ALONE                  32790000
         BE    EXIT2               YES, PROCESS NORMALLY                32810000
         CLC   STAT(STATLNG,WREG),DBOCEBC OP CHECK AND BUSY ALONE       32830000
         BNE   ERRMSG              NO, SCHEDULE ERP                     32850000
         B     EXIT2               PROCESS NORMALLY                     32870000
RMSGASC  EQU   *                                                        32890000
         NI    DECFLAGS,SOHRBIT1   INDICATE SOH%R RCVD                  32910000
         OI    DECFLAGS,SOHRBIT2                                        32930000
         CLC   STAT(STATLNG,WREG),DEASC DVC END ALONE                   32950000
         BE EXIT2                  YES,PROCESS NORMALLY                 32970000
         CLC   STAT(STATLNG,WREG),DBASC DVC BUSY ALONE                  32990000
         BE    EXIT2               YES, PROCESS NORMALLY                33010000
         CLC   STAT(STATLNG,WREG),DBOCASC OP CHECK AND BUSY ALONE       33030000
         BNE   ERRMSG              NO,SCHEDULE ERP                      33050000
         B     EXIT2               PROCESS NORMALLY                     33070000
CHKONLTS TM    DCBERROP,ONLT            ARE TERMINAL TESTS SPEC'D  000D 33090000
         BZ    EXIT2                    IF NOT, BYPASS ONLT TESTSA32477 33110000
         CLI   DECTYPE+1,RDINIT        IS THIS A READ INITIAL     M3962 33130000
         BE    CHKDECAR                YES, BRANCH                M3962 33150000
         TM    3(UCBREG),X'02'         IS DEVICE A 2740 CONSOLE         33170000
         BO    CHKDECAR                YES, ACCEPT ONLINE TEST          33190000
         CLI   DECTYPE+1,RDCONV        IS THIS A READ CONVERSATIONM3962 33210000
         BNE   EXIT2                    NO, BRANCH TO EXIT       A32477 33230000
CHKDECAR EQU   *                                                  M3962 33250000
         L     WREG,DECAREA             GET ADDRESS OF 1ST DATA    000D 33270000
         TM    DCBBFTEK,DYNBF           TEST FOR DYNAMIC BFR       000D 33290000
         BZ    CHK2260                                             000D 33310000
         AH    WREG,K4                  ADD 4 IF D.B. FOR LINK FLD 000D 33330000
CHK2260  CLI   19(UCBREG),TWNTY260      TEST FOR 2260              000D 33350000
         BNE   CHKCORR                                             000I 33370000
         CLC   2(5,WREG),NINE2260       COMPARE FOR 5 USASCII 9'S  000D 33390000
         BNE   EXIT2                    IF NOT, BRANCH OUT       A32477 33410000
         LA    WREG,2(WREG)            POINT TO FIRST CHAR OF MESSG     33430000
         B     SETONLT                                             000I 33450000
CHKCORR  CLI   16(UCBREG),C2741         TEST MODEL CODE            000I 33470000
         BNE   CHKNINE                                             000I 33490000
         CLC   0(5,WREG),CNINES         TEST FOR RFT (99999)       000I 33510000
         BE    SETONLT                                             000I 33530000
         B     EXIT2                                             A32477 33550000
CHKNINE  CLC   0(5,WREG),NINES          COMPARE FOR FIVE NINES     000D 33570000
         BE    SETONLT                  IF EQUAL, GO SET ONLT BIT  000D 33590000
         CLI   0(WREG),CIRCLED         IS FIRST CHAR CIRCLE D    A28625 33610000
         BE    CHK5NINE                YES, CHECK FOR 5 9'S      A28625 33630000
         TM    UCBTYP+1(UCBREG),AUTOPOL IS THIS AUTOPOLL         A28625 33650000
         BNO   EXIT2                    IF NO EXIT NO ONLT       A32477 33670000
CHK5NINE LA    WREG,1(WREG)            ADD 1 TO WORK REG         A28625 33690000
         CLC   0(5,WREG),NINES          CHECK POSITIONS 1 THRU 6   000D 33710000
         BE    SETONLT                 IF YES, SET ONLT           M2925 33730000
         TM    19(UCBREG),X'20'        TEST ADAPTER FOR 1030            33750000
         BNO   EXIT2                    IF NOT, EXIT             A32477 33770000
         TM    16(UCBREG),X'01'        TEST MODEL FOR 1030              33790000
         BNO   EXIT2                    IF NOT, EXIT             A32477 33810000
         LA    WREG,1(WREG)            ADD 1 TO WORK REG          M2925 33830000
         CLC   0(5,WREG),NINES         CHECK POSITIONS 2 THRU 7   M2925 33850000
         BNE   EXIT2                    NOT 1030 ONLT REQUEST    A32477 33870000
SETONLT  EQU   *                                                 A35733 33890000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON ?    A35733 33910000
         BO    EXIT2                    YES, BRANCH              A35733 33930000
         OI    IOBINCAM,ONLTT           SETON ONLT IN PROGRESS   A35733 33950000
         ST    WREG,IOBERINF            STORE AREA ADDRESS         000D 33970000
*                ONE LINE DELETED BY-------------------------->@ZA14130 33990000
EXIT2    EQU   *                                                 A32477 34010000
         TM    DCBBFTEK,DYNBUF          DYN BUF SPECIFIED        A32477 34030000
         BZ    EXIT                     NO, EXIT                 A32477 34050000
         TM    IOBINCAM,ONLTT           ONLT IN PROGRESS         A32477 34070000
         BO    EXIT3                    YES,BRANCH               A32477 34090000
         TM    5(CCWREG),X'2E'         TP OPCODE NOT ''11'       A32477 34110000
         BNZ   EXIT                     NO, EXIT                 A32477 34130000
         TM    5(CCWREG),X'10'          TP OPCODE 10 OR 11       A32477 34150000
         BO    TP3POST1                 YES, POST BUFFER         A32477 34170000
         B     EXIT                     NO, EXIT                 A32477 34190000
EXIT3    EQU   *                                                        34210000
         TM    IOBCSW+4,X'F2'           ANY ERRORS               A32477 34230000
         BNZ   NOTONLT1                 IF SO, BRANCH            A32477 34250000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON      A32477 34270000
         BO    NOTONLT1                 YES, BRANCH              A32477 34290000
         TM    DECTYPE+1,RESET          WAS RESET SPECIFIED      A32477 34310000
         BO    NOTONLT1                 YES, BRANCH              A32477 34330000
         B     EXIT                                              A32477 34350000
NOTONLT1 EQU   *                                                 A32477 34370000
         NI    IOBINCAM,X'FE'           TURN OFF ONLT BIT        A32477 34390000
         B     TP3POST1                                          A32477 34410000
BSC2ONLT EQU   *                   CHECK 3X TP OP CODE FOR ONLT  S99245 34430000
         TM    UCBTYP+3(UCBREG),BISYNCH  IS THIS BSC2?         @ZA06398 34450000
         BNO   EXIT                     NO, BRANCH               S99245 34470000
         TM    IOBINCAM,ONLTT      IS ON-LINE TEST IN PROGRESS   S99245 34490000
         BO    EXITONLT                 YES, SCHED ON-LINE TEST  S99245 34510000
         EJECT                                                          34530000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 34550000
*                TWO LINES DELETED BY------------------------->@ZA14130 34570000
EXIT     TM    DECTYPE,AUTOPOLL         IS THIS AN AUTOPOLL    @ZA14130 34590000
         BZ    BYPASS1             COMPLETION?  IF NOT, BRANCH.    000A 34610000
         L     WREG,DECPOLPT            LOAD POLLING LIST ADDRESS  000A 34630000
         LA    WREG,0(WREG)             CLEAR HIGH ORDER BYTE.     000A 34650000
         SH    WREG,K2+2                SUBTRACT TWO TO POINT AT   000B 34670000
*                                  NUMBER OF ACTIVE ENTRIES.       000A 34690000
         SR    ICREG,ICREG                                         000C 34710000
         IC    ICREG,1(WREG)            PICK UP FLAG BYTE.         000A 34730000
         TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON?       000A 34750000
         BZ    UPDATCNT            IF NOT, UPDATE USER COUNT.      000A 34770000
         CLI   IOBECBPT,CCNORM          NORMAL COMPLETION CODE?    000A 34790000
         BE    EXITAP              IF SO, BYPASS UPDATING USER     000A 34810000
UPDATCNT TM    IOBINCAM,ONLTT                                      000D 34830000
         BO    APOFF                                               000D 34850000
*    COUNT UNTIL THE ERROR ROUTINES HAVE COMPLETED THEIR RECOVERY  000A 34870000
*    PROCEDURES.                                                   000A 34890000
         TM    1(WREG),X'0F'       IF ALREADY 0                 YA01017 34910000
         BZ    APOFF               DON'T MAKE 15                YA01017 34930000
         BCTR  ICREG,0                  SUBTRACT ONE FROM FLAG     000D 34950000
         STC   ICREG,1(WREG)       BYTE AND STORE WITH DECREMENTED 000A 34970000
*                                  USER COUNT.                     000A 34990000
APOFF    NI    DECTYPE,MASKALL-AUTOPOLL TURN OFF AUTOPOLL          000D 35010000
*                                  OPERATION IN PROGRESS' FLAG.    000A 35030000
EXITAP   NOP   BYPASS              THIS IS A NOP/BRANCH SWITCH -   000A 35050000
*    IT WILL BE A NOP UNLESS THE CURRENT OPERATION IS AN AUTOPOLL  000A 35070000
*    OPERATION WHICH TERMINATED PRIOR TO THE READ INDEX COMMAND.   000A 35090000
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 35110000
         SPACE 2                                                        35130000
         L     CCWREG,DECAREA           LOAD ADDRESS OF MESSAGE.   000A 35150000
         TM    DCBBFTEK,DYNBUF          IS DYNAMIC BUFFERING       000A 35170000
         BO    UPDAT1              SPECIFIED?  IF SO, BYPASS       000A 35190000
*    MOVING THE INDEX BYTE FROM THE MESSAGE AREA INTO DECPOLPT.    000A 35210000
*    THE PCI APPENDAGE(IGG019MC) WILL PERFORM THIS FUNCTION ON THE 000A 35230000
*    FIRST PCI INTERRUPT.                                          000A 35250000
*                                                                       35270000
         CLI   IOBCPA+8,POLL            IS THIS AN AUTOPOLL        000A 35290000
         BNE   UPDAT1              OPERATION?  IF NOT, BRANCH.     000A 35310000
*    IT COULD BE A READ REPEAT OPERATION INITIATED BY THE ERROR    000A 35330000
*    RECOVERY ROUTINES.                                            000A 35350000
         MVC   DECPOLPT(1),0(CCWREG)    SAVE INDEX BYTE.           000A 35370000
UPDAT1   EQU   *                                                        35390000
         SRL   ICREG,5                  SHIFT OUT ALL BUT ENTRY    000A 35410000
*                                  WIDTH FROM FLAG BYTE.           000A 35430000
         SR    UCBREG,UCBREG                                       000A 35450000
         IC    UCBREG,0(WREG)           PICK UP NUMBER OF ACTIVE   000A 35470000
*                                  ENTRIES TO USE AS MULTIPLICAND. 000A 35490000
         MR    CCW2REG,ICREG            MULTIPLY ENTRY WIDTH BY    000A 35510000
*                                  NUMBER OF ACTIVE ENTRIES.       000A 35530000
         LA    WREG,1(WREG)             ADJUST PNTR. TO FLAG BYTE. 000A 35550000
         LR    CCW2REG,WREG             LOAD FLAG BYTE ADDRESS     000A 35570000
         AR    CCW2REG,UCBREG      AND ADD ACTIVE ENTRIES BYTE     000A 35590000
*    COUNT TO POINT AT INDEX BYTE IN LAST ACTIVE ENTRY.            000A 35610000
         LR    CCWREG,WREG              LOAD ADDRESS OF FLAG BYTE. 000A 35630000
         IC    W2REG,DECPOLPT           PICK UP INDEX BYTE.        000A 35650000
LOOPINDX CR    WREG,CCW2REG        END OF ACTIVE ENTRY LIST?       000A 35670000
         BE    UPDAT2              IF SO, BRANCH.                  000A 35690000
         AR    CCWREG,ICREG             ADJUST INDEX POINTER TO    000A 35710000
*                                  NEXT INDEX BYTE.                000A 35730000
         EX    W2REG,COMPARE            COMPARE INDEX TO ENTRY     000A 35750000
         BE    STORE               INDEX.  IF EQUAL, BRANCH.       000A 35770000
         AR    WREG,ICREG               ADJUST 'ENTRY MINUS ONE'   000A 35790000
*                                  POINTER TO NEXT ENTRY MINUS ONE.000A 35810000
         B     LOOPINDX                                            000A 35830000
COMPARE  CLI   0(CCWREG),0                                         000A 35850000
UPDAT2   OI    DECFLAGS,NOCOMPAR        SET FLAG INDICATING THAT   000A 35870000
*    THE INDEX DID NOT EQUAL THE INDEX BYTE IN ANY OF THE          000A 35890000
*    ACTIVE ENTRIES IN THE LIST.  THIS COULD BE CAUSED BY A CONTROL000A 35910000
*    UNIT FAILURE WHICH GARBLED THE INDX, OR BY A PROGRAM ERROR    000A 35930000
*    WHICH CLOBBERED THE LIST ADDRESS(DECPOLPT), THE INDEX ITSELF  000A 35950000
*    (THE MESSAGE AREA), OR WHICH SPECIFIED AN INVALID LIST(E.G.,  000A 35970000
*    THE WRONG NUMBER OF POLLING CHARACTERS PER ENTRY).            000A 35990000
*                                                                  000A 36010000
         B     BYPASS1                                             000A 36030000
STORE    LA    WREG,1(WREG)             ADJUST 'ENTRY MINUS ONE'   000A 36050000
*                                  TO BEGINNING OF ENTRY.          000A 36070000
         ST    WREG,DECENTRY            UPDATE DECENTRY.           000A 36090000
         NI    DECFLAGS,MASKALL-NOCOMPAR                           000B 36110000
BYPASS   MVI   EXITAP+1,NOP             CHANGE BRANCH TO A NOP.    000A 36130000
BYPASS1  TM    IOBFLAG1,IOBEX           IS IOB EXCEPTION ON?       000A 36150000
         BO    EXIT0                    IF SO, EXIT                     36170000
         TM    IOBINCAM,ONLTT           IS ONLINE TEST FLAG ON     000D 36190000
         BO    EXITONLT                                            000D 36210000
         TM    DCBERROP,LERCNT          ARE LINE ERROR COUNTS SPECIFIED 36230000
         BZ    EXIT1                    IF NOT, EXIT                    36250000
         SR    ICREG,ICREG              RESET REGISTER 1                36270000
         IC    ICREG,IOBUCBX            LOAD LINE NUMBER                36290000
         LA    W2REG,20                 MULTIPLY BY SIZE OF ERROR BLK   36310000
         MR    WREG,ICREG                                               36330000
         A     W2REG,DCBLERB            ADD ERROR BLOCK START ADDRESS   36350000
         IC    ICREG,CNT(W2REG)         LOAD TRANSMISSION COUNT         36370000
         LA    ICREG,1(ICREG)           ADD 1                           36390000
         STC   ICREG,CNT(W2REG)         UPDATE TRANSMISSION COUNT       36410000
         SR    WREG,WREG                CLEAR W REG.          @ZA14069  36430000
         IC    WREG,CNTT(W2REG)                                         36450000
         CR    ICREG,WREG               COMPARE TO THRESHHOLD COUNT     36470000
         BNE   EXIT1                                                    36490000
         A     WREG,CTNT(W2REG)         IF EQUAL, UPDATE TOTALS         36510000
         ST    WREG,CTNT(W2REG)                                         36530000
         SR    WREG,WREG                                                36550000
         IC    WREG,CDC(W2REG)          UPDATE TOTAL DATA CHECKS,       36570000
         SLL   WREG,16                                                  36590000
         IC    WREG,CIR(W2REG)                       INTERVENTIONS REQ, 36610000
         A     WREG,CTDC(W2REG)                                         36630000
         ST    WREG,CTDC(W2REG)                                         36650000
         SR    WREG,WREG                                                36670000
         IC    WREG,CTO(W2REG)                       TIME OUTS          36690000
         AH    WREG,CTTO(W2REG)                                         36710000
         STH   WREG,CTTO(W2REG)                                         36730000
         XC    CNT(4,W2REG),CNT(W2REG)               RESET COUNTERS     36750000
         B     EXIT1                                                    36770000
*                47 LINES DELETED BY (D/B V=V)---------------->@ZA14130 36790000
SOHRCOMP EQU   *                                                        36810000
         TM    DECTYPE,AUTOPOLL    AUTOPOLL OPERATION?          YA01020 36830000
         BZ    GOONOUT             NO, NO USER COUNT            YA01020 36850000
         L     WREG,DECPOLPT       LOAD POLLING LIST ADR        YA01020 36870000
         LA    WREG,0(WREG)        CLEAR HIGH BYTE              YA01020 36890000
         SH    WREG,K2+2           SUB 2 TO POINT AT            YA01020 36910000
*                                  NUMBER OF ACTIVE ENTRIES     YA01020 36930000
         SR    ICREG,ICREG         CLEAR A WORK REG             YA01020 36950000
         IC    ICREG,1(WREG)       PICK UP FLAG BYTE            YA01020 36970000
         TM    1(WREG),X'0F'       IF ALREADY ZERO,             YA01020 36990000
         BZ    GOONOUT             DON'T MAKE IT NEGATIVE       YA01020 37010000
         TM    IOBFLAG1,IOBEX      IOB EXCEPTION?               YA01020 37030000
         BZ    SOHRCMP1            NO, GO AHEAD AND DECREMENT   YA01020 37050000
         CLI   IOBECBPT,CCNORM     NORMAL COMPLETION?           YA01020 37070000
         BE    GOONOUT             YES, NO NEED TO DECREMENT    YA01020 37090000
SOHRCMP1 EQU   *                   DECREMENT USER COUNT         YA01020 37110000
         BCTR  ICREG,0             SUB 1 FROM FLAG              YA01020 37130000
         STC   ICREG,1(WREG)       BYTE AND STORE WITH          YA01020 37150000
*                                  DECREMENTED USER COUNT       YA01020 37170000
GOONOUT  EQU   *                                                YA01020 37190000
         NI    IOBINCAM,SOHRBUSY   TURN OFF SOH%R PROCESSING            37210000
*                                  COMPLETE AND BUSY BITS               37230000
         NI    DECTYPE,X'FF'-AUTOPOLL TURN OFF DECB AUTOPOLL    YA03238 37250000
         TM    UCBTYP+DISP1(UCBREG),BSC2 IS THIS DIAL (BSC2)?   YA01275 37270000
         BNO   EXIT1                    NO, RETURN              YA01553 37290000
         L     WREG,DECAREA             GET ADDR OF SOH%R MSG   YA01275 37310000
         ST    WREG,IOBERINF            SAVE IN IOB             YA01275 37330000
         B     EXIT1                    GO CLEAN UP & RETURN    YA01553 37350000
EXIT0    CLI   IOBECBPT,CCNORM          TEST FOR NAMAL COMPLETION       37370000
         BE    EXITREST                 IF NORMAL, BRANCH               37390000
EXIT1    NI    IOBINCAM,MASKALL-BUSY    SET OFF BUSY BIT                37410000
         L     CCWREG,IOBCSW            LOAD ADDRESS INTO REG           37430000
         SH    CCWREG,K8                SUBTRACT 8                      37450000
         MVC   DECCMCOD,0(CCWREG)       MOVE COMMAND CODE,              37470000
         MVC   DECTPCOD,5(CCWREG)            TP OP CODE,                37490000
         MVC   DECSENS0(2),IOBSENS0          SENSE BYTES,               37510000
         MVC   DECCOUNT(2),IOBCSW+6          RESIDUAL COUNT AND         37530000
*              TEN LINES OF CODE REMOVED BY AZ03588            @ZA03588 37550000
*              THE CODE REMOVED WAS FOR ZA00529                @ZA03588 37570000
EXITBRK1 MVC   DECCSWST(2),IOBCSW+4          CSW STATUS TO DECB         37590000
         MVI   DECDCBAD,X'00'           RESET BUFFER COUNTER            37610000
         L     WREG,REG7(SAVEAREA)      GET ADDRESS OF UCB       Y02947 37630000
         CLI   DECTYPE+1,WRRSTMON       WRT RESET MONITOR ?    @ZA31078 37650000
         BNE   EXITREST                 IF NOT BRANCH          @ZA31078 37670000
         CLI   5(CCWREG),X'08'          WRT EOT CCW ?          @ZA31078 37690000
         BNE   EXITREST                 IF NOT BRANCH          @ZA31078 37710000
         LA    CCWREG,8(CCWREG)         GET ADD OF NEXT CCW    @ZA31078 37730000
         ST    CCWREG,IOBSTART          STORE CCW START ADD    @ZA31078 37750000
         TM    IOBFLAG2,RESETPL         RESETPL ISSUED ?       @ZA31078 37770000
         BNO   REXIT                    CONTINUE CHANNEL PROG  @ZA31078 37790000
         MVI   IOBECBPT,X'48'           INDICATE HIO COMP CODE @ZA31078 37810000
*                 6 LINES REMOVED BY-------------------------->@ZA14070 37830000
EXITREST LM    RETREG,SAVEAREA,DISP0(SAVEAREA) RESTORE REGS      Y02947 37850000
         BR    RETREG                   RETIRN TO IOS                   37870000
         SPACE 3                                                        37890000
REXITA   XC    DECRESPN(2),DECRESPN     CLEAR DECB RESPONSE FIELD  000E 37910000
REXITB   LA    CCWREG,8(CCWREG)         UPDATE CCW POINTER         000E 37930000
REXIT    ST    CCWREG,IOBSTART          STORE CCW START ADDRESS         37950000
REXIT1   NI    IOBFLAG1,MASKALL-IOBEX   SET OFF IOB EXCEPTION FLAG      37970000
         LM    RETREG,SAVEAREA,DISP0(SAVEAREA)  RESTORE REGS     Y02947 37990000
         B     8(RETREG)                RETURN TO IOS+8                 38010000
ERREXIT  LM    RETREG,SAVEAREA,DISP0(SAVEAREA)  RESTORE REGS     Y02947 38030000
         B     4(RETREG)                RETURN TO IOS + 4               38050000
EXITONLT L     UCBREG,DEBIRBAD(DEBREG)  GET ADDRS OF POINTER TO IRB000E 38070000
         L     UCBREG,0(UCBREG)         GET ONLT IRB ADDRESS       000E 38090000
         BAL   WREG,IQESETUP            BRANCH TO SET UP IQE'S     000E 38110000
         B     ONLTEXIT                 ASYNCH                     000E 38130000
*                    4 LINES REMOVED BY----------------------->@ZA14070 38150000
NOIQE    OI    DECERRST,SNO            SET SHOULD NOT OCCUR      A43784 38170000
         MVI   IOBECBPT,CCPER          INDICATE PERM ERROR       A43784 38190000
*                   2 LINES REMOVED BY------------------------>@ZA14070 38210000
         B     EXIT1                                             A43784 38230000
IQESETUP EQU   *                                                 A43784 38250000
*             TWO LINES DELETED FOR THE FOLLOWING APAR          YA02165 38270000
         L     ICREG,96(UCBREG)        LOAD 1ST IQE ADDRESS      A43784 38290000
         LA    ICREG,0(ICREG)           CLEAR HIGH ORDER BYTE  @ZA14071 38310000
         LTR   ICREG,ICREG             IS THERE AN IQE ADDR?    YA02165 38330000
         BZ    NOIQE                   NO, FLAG AS AN ERROR     YA02165 38350000
         MVC   96(4,UCBREG),0(ICREG)    DEQUEUE                    000E 38370000
         XC    0(4,ICREG),0(ICREG)      ZERO LINK FIELD            000D 38390000
         ST    IOBREG,4(ICREG)          STORE IOB ADRS AS PARM     000D 38410000
*                 1 LINE REMOVED BY--------------------------->@ZA14071 38430000
         LCR   ICREG,ICREG              COMPLEMENT THE ADDRESS     000D 38450000
         L     BRREG,SIXT               LOAD CVT ADDRESS           000D 38470000
         USING CVT,BRREG                ESTABLISH CVT ADDR       Y02947 38490000
         L     BRREG,CVT0EF00           LOAD ASYNCH RT ADDRESS   Y02947 38510000
         DROP  BRREG                  DROP CVT ADDRESSABILITY    Y02947 38530000
         BALR  RETREG,BRREG             LINK TO SCHEDULE ROUTINE   000E 38550000
         L     BAS2REG,DISP4(SAVEAREA) RESTORE                   Y02947 38570000
         A     BAS2REG,FOURK                   SECOND BASE       Y02947 38590000
         BR    WREG                                                000E 38610000
*                                                                  000I 38630000
EXITBRK  EQU   *                                                   000I 38650000
         CLI   0(CCWREG),X'01'          IS COMMAND WRITE           000I 38670000
         BNE   PWROFF                                              000I 38690000
         MVC   DECCMCOD,0(CCWREG)       MOVE COMMAND CODE,       A33942 38710000
         MVC   DECTPCOD,5(CCWREG)       TP OP CODE,              A33942 38730000
         MVC   DECSENS0(2),IOBSENS0     SENSE BYTES,             A33942 38750000
         MVC   DECCOUNT(2),IOBCSW+6     RESIDUAL COUNT,          A33942 38770000
         MVC   DECCSWST(2),IOBCSW+4     AND CSW STATUS TO DECB   A33942 38790000
         L     UCBREG,DEBIRBAD(DEBREG)  GET ADDRS OF POINTER TO IRB     38810000
         LA    UCBREG,DISP0(UCBREG)  CLEAR HI BYTE          LD @ZA02324 38830000
         LTR   UCBREG,UCBREG       TEST FOR ZERO ADDRESS    LD @ZA02324 38850000
         BZ    NOIQE               BR IF ZERO ADDRESS       LD @ZA02324 38870000
         L     UCBREG,8(UCBREG)         GET 2741 BREAK IRB ADDRESS      38890000
         BAL   WREG,IQESETUP            BRANCH TO SET UP IQE'S          38910000
*                                                                  000I 38930000
ONLTEXIT LM    RETREG,SAVEAREA,DISP0(SAVEAREA)  RESTORE REGS     Y02947 38950000
         B     4(RETREG)                RETURN TO IOS + 4          000D 38970000
         EJECT                                                          38990000
K2       DC    F'2'                     TWO                        000B 39010000
CODEMSK  DC    F'0'                                                     39030000
MASKDB   DC    X'00FFFFFC'                                              39050000
TPMSK    DC    X'0000000F'                                              39070000
SETMSK   DC    X'00100000'                                     @ZA15402 39090000
RESETMSK DC    X'FFEFFFFF'                                     @ZA15402 39110000
ZERO     DC    F'0'                                                     39130000
ZERO3    DC    X'000000'                                           000L 39150000
K4       DC    H'4'                     MUST FOLLOW A ZERO FIELD        39170000
K1       DC    H'1'                     ONE                        000B 39190000
WA       DC    H'0'                                                     39210000
K8       DC    H'8'                                                     39230000
K16      DC    H'16'                                                    39250000
K32      DC    H'32'                                        LD @ZA02320 39270000
NINES    DC    5X'13'                   CODE FOR NINES             000D 39290000
TWENTY   DC    H'20'                                        LD @ZA02312 39310000
NINE2260 DC    5X'59'                   2260 CODE FOR NINES        000D 39330000
SPACEY   DC    X'0176'                                             1263 39350000
SPACEN   DC    X'0140'                                             1263 39370000
CNINES   DC    X'1616161616'            CORRESPONDENCE CODE        000I 39390000
C2741    EQU   X'55'                    2741 CORRS                 000I 39410000
DPREO    DC    X'163E4C'                CIRCLE D PRE O (2760)      000K 39430000
         DS    0F                                               YA03265 39450000
LIST     DC    X'80000000'              LIST FORM                Y02947 39470000
THREE20  DC    H'320'                   LENGTH OF BOTH IDALS     Y02947 39490000
SAVE19MS DC    18F'0'                   SAVEAREA FOR BUFFER      YM4063 39510000
*                                       ROUTINE (IGG019MS)       YM4063 39530000
A0       EQU   X'A0'                                           @ZA04650 39550000
SPFLAG   EQU   X'9F'          SPECIAL FLAG SET BY 504C         @ZA04679 39570000
DEBIRBAD EQU   8                        OFSET TO IRB ADDRESS       000D 39590000
DEBTCBAD EQU   0                        OFFSET TO TCB ADDRESS      000D 39610000
DEBNMEXT EQU   16                                                       39630000
DEBUCBAD EQU   32                                                       39650000
UCBFL1   EQU   6                        UCB FLAG 1                      39670000
CTNT     EQU   0                        TOTAL NUMBER TRANSMISSIONS      39690000
CTDC     EQU   4                        TOTAL NUMBER DATA CHECKS        39710000
CTIR     EQU   6                        TOTAL NUMBER INTERVENTIONS REQ  39730000
CTTO     EQU   8                        TOTAL NUMBER TIME OUTS          39750000
CNT      EQU   10                       NUMBER TRANSMISSIONS            39770000
CDC      EQU   11                       DATA CHECKS                     39790000
CIR      EQU   12                       INTERVENTIONS REQUIRED          39810000
CTO      EQU   13                       TIME OUTS                       39830000
CNTT     EQU   14                       THRESHHOLD TOTAL                39850000
FOXE     EQU   X'FE'                                                    39870000
CONNECT  EQU   X'DD'                                               000L 39890000
K0       EQU   X'00'                                               000L 39910000
RDINIT   EQU   X'01'                                               000L 39930000
RDCONV   EQU   X'05'                                              M3962 39950000
TPWIDENQ EQU   X'03'                                               000L 39970000
ONE      EQU   X'01'                                               000L 39990000
TWO      EQU   X'02'                                               000L 40010000
SWLST    EQU   X'FF'                                               000L 40030000
RCONTONE EQU   X'1E'                                               000L 40050000
RDCONECT EQU   X'11'                                                    40070000
OPTPWTD  EQU   X'10'                                               000C 40090000
BRANCH   EQU   X'F0'                                               000A 40110000
NOP      EQU   X'00'                                               000A 40130000
AUTOPOLL EQU   X'80'                                               000A 40150000
DYNBUF   EQU   X'08'                                               000A 40170000
ARMSEEK  EQU   X'02'                    ARM SEEKING FLAG                40190000
SIXT     EQU   X'10'                                                    40210000
RESETPL  EQU   X'01'                    RESET P/L BIT IN IOB FLAG 2     40230000
WRITE    EQU   X'01'                    WRITE COMMAND CODE              40250000
EOTRCVD  EQU   X'40'                                                    40270000
RVIRCV   EQU   X'42'                                                    40290000
WACKRCV  EQU   X'C0'                                                    40310000
POLL     EQU   X'09'                                               000A 40330000
TPWPA    EQU   X'03'                    TP OP CODE FOR WRITE POLL/ADRS  40350000
NOCOMPAR EQU   X'10'                                               000A 40370000
SLVCONT  EQU   X'10'                                           @ZA04873 40390000
DCBMASTA EQU   X'80'                                             A43796 40410000
NEGRESPN EQU   X'04'                    NEGATIVE RESP OR ALL ENTRYS SKP 40430000
FORMAT   EQU   X'20'                    FORMAT IN LIST CONTROL BYTE     40450000
DISABLE  EQU   X'2F'                    DISABLE COMMAND CODE            40470000
SKIP     EQU   X'40'                    SKIP BIT IN TERM LIST CTRL BYTE 40490000
EOL      EQU   X'80'                    EOL BIT IN TERM LIST CTRL BYTE  40510000
SNO      EQU   X'40'                    SHOULD NOT OCCUR ERROR          40530000
BUSY     EQU   X'40'                    BUSY BIT                        40550000
LERCNT   EQU   X'08'                                                    40570000
CCNORM   EQU   X'7F'                    NORMAL COMPLETION CODE          40590000
IOBEX    EQU   X'04'                    IOB EXCEPTION FLAG              40610000
IOBEXE   EQU   X'24'                                                    40630000
SENSTA   EQU   X'04'                    SENSE STATUS DONE      @ZA14130 40650000
WRWBT    EQU   X'1A'                                               000B 40670000
CSWUE    EQU   X'01'                    UNIT EXCEPTION STATUS           40690000
READ     EQU   X'02'                    READ COMMAND CODE               40710000
ONLTT    EQU   X'01'                    ON-LINE TERMINAL TEST BIT       40730000
AUTOPOL  EQU   X'40'                                             A28625 40750000
CIRCLED  EQU   X'16'                                             A28625 40770000
PCI      EQU   X'08'                                                    40790000
PCIPC    EQU   X'A0'                                                    40810000
TICCMND  EQU   X'08'                                               3712 40830000
RETRYCNT EQU   2                        MAXIMUM RETRY COUNT             40850000
MASKALL  EQU   X'FF'                    ALL 1'S                         40870000
CCPER    EQU   X'41'                    PERMANENT ERROR COMPLETION CODE 40890000
TPRESET  EQU   X'21'                    TP-OP CODE FOR ALL RESET CCW'S  40910000
TPFPCI   EQU   X'40'                    TP-OP CODE FOR FIRST PCI   1838 40930000
TPEOCP   EQU   X'80'                   TP-OP CODE FOR END OF  CHANNEL   40950000
UCBTYP   EQU   16                                                  000B 40970000
UCBEXTPT EQU   X'14'                                           @ZA15402 40990000
INTBLCHK EQU   X'40'                                               000B 41010000
FLIP     EQU   X'02'                                               000B 41030000
DYNBF    EQU   X'08'                                               000B 41050000
IMPRESP  EQU   X'40'                                               000B 41070000
BISYNCH  EQU   X'90'                                               000B 41090000
LSTCCW   EQU   X'80'                                               000B 41110000
WRRST    EQU     X'0A'                                             000B 41130000
ACK0PT   EQU   X'00'                                               000B 41150000
ACK1PT   EQU   X'02'                                               000B 41170000
FULWORD  EQU   X'FC'                                               000B 41190000
RDIDENT  EQU   X'03'                                               000B 41210000
WRTIV    EQU   X'0D'                                               000B 41230000
RDINQ    EQU   X'15'                                               000B 41250000
RDININQ  EQU   X'19'                                               000B 41270000
RDCONT   EQU   X'03'                    READ CONTINUE                   41290000
RDRESP   EQU   X'25'               READ RESPONSE TP CODE        YA01026 41310000
RDTEXT1  EQU   X'51'               FIRST READ TEXT TP CODE      YA01026 41330000
WRONGACK EQU   X'20'                                               000B 41350000
OKACK    EQU   X'9F'                                               000B 41370000
*                                  PROGRAM                              41390000
OPTPWTN  EQU   X'0A'                    WRITE TN TYPE CODE         000A 41410000
TWNTY260 EQU   X'82'                    2260 DEVICE CODE                41430000
DATAC    EQU   X'80'                    CHANNEL PROGRAM DATA CHAINING   41450000
INLTTSTW EQU   X'1D'                    MASKALL-WRITE TI OPER      000D 41470000
ONLT     EQU   X'10'                                               000D 41490000
ONLTRFT  EQU   X'80'                                             A28612 41510000
ONLTTSTR EQU   X'1E'                    MASKALL-READ TI            000D 41530000
ONLTTSTW EQU   X'0D'                    MASKALL-WRITE TI OPER      000D 41550000
CKRVIRPT EQU   X'20'               BIT 2                           000J 41570000
STRVIRPT EQU   X'DF'               ALL BITS ON EXCEPT BIT 2        000J 41590000
RESET    EQU   X'80'                    RESET BIT                  000D 41610000
PREP     EQU   X'06'                                               000I 41630000
CSWUC    EQU   X'02'                                               000I 41650000
EBC      DC    X'C3'                   EBCDIC C                    000M 41670000
EBE      DC    X'C5'                   EBCDIC E                    000M 41690000
EBS      DC    X'E2'                   EBCDIC S                    000M 41710000
USC      DC    X'43'                   USASCII C                   000M 41730000
USE      DC    X'45'                   USASCII E                   000M 41750000
USS      DC    X'53'                   USASCII S                   000M 41770000
EBSLASH  EQU   X'61'                    EBCDIC /                        41790000
EBR      EQU   X'D9'                    EBCDIC R                        41810000
USSLASH  EQU   X'2F'                    USASCII /                       41830000
USR      EQU   X'52'                    USASCII R                       41850000
SMSG     EQU   X'80'                    3270 STATUS MSG FLAG            41870000
RFTBIT   EQU   X'10'                    RFT RCVD FROM GEN POLL CU       41890000
SOHRBIT1 EQU   X'BF'                    THESE 2 BITS INDICATE AN        41910000
SOHRBIT2 EQU   X'02'                    SOH%R MSG WAS RCVD              41930000
DBOCEBC  DC    X'C8C1'             BUSY, OP CHECK                       41950000
DBEBC    DC    X'C840'             DEVICE BUSY                          41970000
DEEBC    DC    X'C240'             DEVICE END                           41990000
SOHRBUSY EQU   X'BB'               SOH%R PROCESSING COMPLETE            42010000
TIMEOUT  EQU   X'01'               TIMEOUT                      YA01019 42030000
MSGTYPE  EQU   2                        DISP IN SOH% MSGS OF TYPE       42050000
MSGLNGTH EQU   10                       LENGTH OF STD 3270 RFT  YA02157 42070000
*                                       MINUS HEADER            YA02157 42090000
MSGSTART EQU   4                        LENGTH OF 3270 RFT HEADER       42110000
STAT     EQU   6                        DISP OF S/S IN SOH%R MSG        42130000
STATLNG  EQU   2                        # OF S/S BYTES IN SOH%R MSG     42150000
*                                  AND BUSY BITS                        42170000
DBOCASC  DC    X'4841'             BUSY OP CHECK                        42190000
DBASC    DC    X'4820'             DEVICE BUSY                          42210000
DEASC    DC    X'4220'             DEVICE END                           42230000
DISP0    EQU   0                   DISPLACEMENT OF 0             Y02947 42250000
DISP1    EQU   1                   DISPLACEMENT OF 1             Y02947 42270000
DISP3    EQU   3                   DISPLACEMENT OF 3        LD @ZA02319 42290000
DISP4    EQU   4                   DISPLACEMENT OF 4             Y02947 42310000
DISP5    EQU   5                   DISPLACEMENT OF 5        LD @ZA02320 42330000
DISP6    EQU   6                   DISPLACEMENT OF 6        LD @ZA02319 42350000
DISP7    EQU   7                   DISPLACEMENT OF 7             Y02947 42370000
DISP8    EQU   8                   DISPLACEMENT OF 8             Y02947 42390000
DISP12   EQU   12                  DISPLACEMENT OF 12            Y02947 42410000
DISP13   EQU   13                  DISPLACEMENT OF 13       LD @ZA00536 42430000
DISP16   EQU   16                  DISPLACEMENT OF 16       LD @ZA02320 42450000
PGFREE   EQU   X'20'               PAGE FREE FUNCTION            Y02947 42470000
LASTVSL  EQU   X'80'               LAST VSL ENTRY                Y02947 42490000
REG7     EQU   36                  DISP INTO SAVE AREA OF REG 7  S99245 42510000
BSC2     EQU   X'90'               BSC2 FEATURE IN UCB           S99245 42530000
IDBEGIN  EQU   64             DISP PAST IOBCPA OF BSC2 TERM ID   S99245 42550000
ID4BYTES EQU   4                   LENGTH OF BSC2 TERM ID SAVED  S99245 42570000
IDDISP   EQU   8                   DISP INTO SWLIST OF TERM ID   S99245 42590000
DISPID   EQU   0                   DISP INTO NON-SWLIST OF ID    S99245 42610000
DLRFTLNG EQU   7               # OF PARMS IN DIAL 3270 RFT  LD @ZA02313 42630000
RDINQMON EQU   X'09'               READ INQUIRY MONITOR          S99245 42650000
WRRSTMON EQU   X'0B'               WRITE RESET MONITOR           S99245 42670000
RESIDCNT EQU   6                  DISP INTO CCW OF RESIDUAL CNT YA02162 42690000
RESPNLNG EQU   2                   LENGTH OF DECRESPN           YA02162 42710000
ONECHAR  EQU   1                   ONE CHAR RESPONSE LENGTH     YA02162 42730000
DISP20   EQU   20                  DISPLACEMENT OF 20            Y02947 42750000
EOTCHAR  EQU   X'37'               EOT CHARACTER                YA03266 42770000
CHKMOD   EQU   X'01'                                           @ZA03598 42790000
CKWTTA   EQU   X'60'                                           @ZA03598 42810000
CK115A   EQU   X'40'                                           @ZA03598 42830000
X10      EQU   X'10'                                        LD @ZA02319 42850000
X30      EQU   X'30'                                           @ZA04877 42870000
X82      EQU   X'82'                                        LD @ZA02321 42890000
X84      EQU   X'84'                                        LD @ZA02321 42910000
X1F      EQU   X'1F'                                        LD @ZA02320 42930000
XF0      EQU   X'F0'                                           @ZA04877 42950000
THREE    EQU   3                                            LD @ZA02320 42970000
TEN      EQU   10                                           LD @ZA02319 42990000
TICBIT   EQU   X'01'                                        LD @ZA02320 43010000
PROGCHK  EQU   X'20'                                        LD @ZA02320 43030000
WRT1ST   EQU   X'40'                                        LD @ZA02320 43050000
WRTTEXT  EQU   X'11'                                        LD @ZA02320 43070000
WRTTC    EQU   X'1C'               WRITE CONNECT               @ZA04190 43090000
XFF      EQU   X'FF'                                           @ZA08045 43110000
         CNOP  0,8                                                      43130000
         EJECT                                                          43150000
         IECTDECB                                                       43170000
         EJECT                                                          43190000
         IECTIOBX                                                       43210000
         EJECT                                                          43230000
         DCBD  DSORG=BX,DEVD=BS                                    000B 43250000
         EJECT                                                          43270000
         IKJTCB DSECT=YES,LIST=YES                                      43290000
         EJECT                                                          43310000
CVT      DSECT                                                          43330000
         CVT    LIST=NO                                                 43350000
         END                                                            43370000
