         TITLE 'GRAPHIC ATTENTION ROUTING ROUTINE'                      00020002
**********************************************************************  00032002
*                                                                       00034002
* MODULE NAME:            IGG019OE (OS/VS2)                             00036002
*                                                                       00038002
* DESCRIPTIVE NAME:       GRAPHIC ATTENTION ROUTING ROUTINE             00038402
*                                                                       00038802
* COPYRIGHT:              NONE                                          00039202
*                                                                       00039602
* STATUS:                 RELEASE 2.0                                   00039702
*                                                                       00039802
*                                                                       00039902
*******FILL IN FROM SPECS*****CONTINUED* NEXT*PAGE********************  00046602
         EJECT                                                          00048602
*FUNCTION:SECOND LEVEL GRAPHIC ATTENTION HANDLING MODULE.               00060002
*        1.DECODE ATTENTION TYPE.                                       00080002
*        2.PROVIDE MI DATA ON 2250 KEYBOARD(A/N OR PF)ATTENTIONS.       00100002
*        3.PROVIDE XY BEAN POSITION REGISTER READOUT ON LP ATTENTIONS.  00120002
*        4.PROVIDE BUFFER RESTART ON LP ATTENTION IF USER REQUESTS IT.  00140002
*        5.QUEUE DATA ON ATTENTION ROUTINE THAT IS:                     00160002
*         A.ACTIVE FOR THAT DEVICE.(ROUTINE MAY BE IN WAIT STATE.IF THE 00180002
*           ROUTINE DESIRES A PARTICULAR ATTENTION IT WILL BE POSTED.)  00200002
*         B.WILL BECOME ACTIVE SOONEST FOR THAT DEVICE IF:ALREADY HAS   00220002
*           DATA ON ITS INTERNAL QUEUE WAITING TO BE DISPATCHED.        00240002
*         C.DESIRES THE ATTENTION TYPE.                                 00260002
*         D.IF THE ATTENTION IS UNABLE TO SATISFY A,B OR C IT IS        00280002
*           DISCARDED.                                                  00300002
*        6.SCHEDULE THIRD LEVEL GRAPHIC CONTROL PROGRAM.                00320002
*ENTRY POINT:SCHEDULED BY PRIMARY GRAPHIC CONTROL PROGRAM VIA AN        00340002
*        IQE TO AEE STAGE II.                                           00360002
*INPUT:1.GR#0=IQE ADDRESS                                               00380002
*      2.GR#1=UCB ADDRESS AND STATUS BITS 32-39.                        00400002
*      3.GR#S13,14,15 AS PER CONVENTIONS.                               00420002
*OUTPUT:IQE TO AEE STAGE II TO SCHEDULE THIRD LEVEL CONTROL PROGRAM.    00440002
*       IQE CONTAINS THE DATA THAT WILL BE PLACED IN USER COMAREA.      00460002
*EXTERNAL ROUTINES:ASYNCHRONOUS EXIT EFFECTOR(AEE)STAGE TWO AND IOS.    00480002
*EXIT:VIA RETURN MACRO                                                  00500002
*TABLES/WORK AREAS:N/A                                                  00520002
*ATTRIBUTES:1.SUPERVISOR STATE                                          00540002
*           2.PRIVILEGED                                                00560000
*           3.RE-ENTRANT                                                00580002
*           4.OPERATES WITH AND WITHOUT LOCAL LOCK          D11         00600000
*NOTES:N/A                                                              00620002
IGG019OE CSECT                                                          00632002
*    SEE LABEL 'MODID' FOR LAST CHANGE DATE; FORMAT:  NAME.SYSREL.DATE  00632102
*C025400                                                      LF YM4067 00632202
* SEQ NBRS MUST BE RESPECIFIED BECAUSE OF RESEQ FOR VS                  00632302
*A27115,A61060-61120,A64260-64320,A64630-64750,A75500,A89660  LI F40815 00634002
*C48000-48400,C52000,C61060,C64260                            LI A42794 00636002
*1708,065600-066000,084800,088000,089000-0892000                   0803 00638002
*D29665                                                       LI A39419 00638402
*C89720                                                       LI A39419 00638802
*1190,084700                                                   PTM 2173 00639202
* 087404                                                         A27773 00639602
*A16630-16660,A29710-30510,A65490-65510,A92810-92900             A34795 00639702
*C88000                                                          A34795 00639802
*D29695-30400                                                    A34795 00639902
*C91900,C92100-92300                                             A35022 00646602
*A29400                                                          A35022 00648602
* 042800-043200,065510,076800,079410,080040                   LB  AOS/1 00650602
*A068700,D087539,D087548                                        YM1901  00652602
*A051700                                                     LD YA00804 00653002
* A066900-066960,C067000,D067800-068000,A068500,D077000,     LD YA01555 00653102
* C078200,D079420-079440                                     LD YA01555 00653202
* A7900,A84490-84550,C84554                                      YM5683 00655202
*A27190,D30000,A30004-30008                                  LG Z30AALG 00655400
*A26500-26520,A26909-29627,A37500-37588                      LG @ZM2360 00655600
*A86900-86984,A87708-87749,A88000,A93020                     LG @ZM2360 00655800
*C30120,C43600,C55200,C57200,C58400,C68500                  LG @ZA00524 00656000
*C87408,C87416,C87432,C87448,C87498,C87548                  LG @ZA00524 00656200
*D68600-71000,D76000                                        LG @ZA00524 00656400
*A006700,037500-037720,086900-087130,087708-087740          D11 ZA13194 00656600
*A074760-074794,075300,093195-093197                        D11 ZA13195 00656800
*A087140-087150                                             D11 ZA13196 00657300
*                                                                       00659200
         EJECT                                                          00659302
PAR0     EQU   0                       PARAM REG 0                      00659702
PAR1     EQU   1                       PARAM REG 1                      00660002
R1       EQU   1  REFERENCE REG FOR GIOCR HAND-EXPANSIONS   D11 ZA13194 00670000
BASERG   EQU   2                       BASE REG                         00680002
MAINREG  EQU   3                       REG FOR WORK AREA DSECT          00700002
RIQE     EQU   4                       IQE ADR REG                      00720002
RTCB     EQU   4                       TCB REG                          00730002
RUCB     EQU   5                       UCB ADR REG                      00740002
REBRG    EQU   6                       REB ADR REG                      00760002
R7       EQU   7                       WORK REG                         00780002
RASCB    EQU   7                       ASCB REG                  YM5683 00790002
R8       EQU   8                       WORK REG                         00800002
R9       EQU   9                       WORK REG                         00820002
R10      EQU   10                      WORK REG                         00840002
R11      EQU   11                      WORK REG                         00860002
R12      EQU   12                      WORK REG                         00880002
SAVEREG  EQU   13                      SAVE AREA REG                    00900002
R14      EQU   14                      RTN REG                          00920002
R15      EQU   15                      RTN CODE REG                     00940002
         EJECT                                                          00950002
*                                                                       00960002
*        GACB CONSTRUCTION                                              00980002
*                                                                       01000002
COMAREA  EQU   0                       OFFSET TO COMAREA ADR            01020002
DCBADR   EQU   4                       OFFSET TO DCB ADR                01040002
PFKMSK   EQU   8                       OFFSET TO PFK MASK               01060002
ATNTYP   EQU   15                      OFFSET TO ATTENTION TYPE         01080002
EP1      EQU   16                      OFFSET TO ENTRY POINT ONE ADR    01100002
EP2      EQU   20                      OFFSET TO ENTRY POINT TWO ADR    01120002
SAVE13   EQU   24                      REG 13 SAVE AREA FOR R MODE      01140002
PFKEY    EQU   28                      FUNCTION KEY SAVE AREA           01160002
SAVETYP  EQU   32                      ATTN TYPE SAVE AREA              01180002
ECB      EQU   36                      EVENT CONTROL BLOCK FOR MODE W   01200002
REBADR   EQU   40                      ROUTINE ENTRY BLOCK ADR          01220002
GACBRSVD EQU   44                      RESERVED AREA                    01240002
*                                                                       01260002
*        COMAREA CONTRUCTION                                            01280002
*                                                                       01300002
COMRSVD1 EQU   0                       RESERVED                         01320002
COMOVCOD EQU   1                       OVERLAY CODE                     01340002
COMKEY   EQU   2                       PF KEY NUMBER                    01360002
COMTYPE  EQU   3                       ATTENTION TYPE                   01380002
SENSE    EQU   4                       SENSE AREA                       01400002
COMMI    EQU   4                       MANUAL INPUT AREA                01420002
XYPOS    EQU   8                       XY POSITION REGISTERS            01440002
COMRSVD3 EQU   12                      RESERVED                         01460002
*                                                                       01480002
*        COMAREA TYPE FIELD                                             01500002
*                                                                       01520002
ENDORANK EQU   X'01'                   END OR A/N KEYBOARD ATTENTION    01540002
PFKB     EQU   X'02'                   PF KEYBOARD ATTENTION            01560002
LP       EQU   X'03'                   LIGHT PEN ATTENTION              01580002
EOS      EQU   X'04'                   END ORDER SEQUENCE ATTENTION     01600002
CANCEL   EQU   X'05'                   CANCEL KEY ATTENTION             01620002
AE       EQU   X'06'                   ASYNCHRONOUS ERROR ATTENTION     01640002
A2260    EQU   X'07'                   2260 ATTENTION                   01660002
HEX82    EQU   X'82'              CSW STATUS BITS INDICATING A LIGHT    01663002
*                            PEN  ATTENTION                             01666002
         EJECT                                                          01670002
*                                                                       01680002
*        GACB ATTNTYP FIELD                                             01700002
*                                                                       01720002
GENAN    EQU   X'01'                   END OR A/N KEYBOARD ATTENTION    01740002
GLP      EQU   X'02'                   LIGHT PEN ATTENTION              01760002
GEOS     EQU   X'04'                   END ORDER SEQUENCE ATTENTION     01780002
GCANCEL  EQU   X'08'                   CANCEL KEY ATTENTION             01800002
GAE      EQU   X'10'                   ASYNCHRONOUS ERROR ATTENTION     01820002
T2260    EQU   X'20'                   2260 KEYBOARD ATTENTION          01840002
*                                                                       01860002
*                                                                       01880002
ANKBD    EQU   X'80'                   A/N BIT                          01900002
AT2260   EQU   X'03'                   TYPE=2260                        01920002
CANCELD  EQU   X'10'                   CANCEL KEY BIT                   01940002
COMPLETE EQU   X'7F'                   POST CODE                        01960002
CVTADR   EQU   16                      CVT  ADR                         01980002
ENDD     EQU   X'20'                   END KEY BIT                      02000002
EOSDET   EQU   X'40'                   END ORDER SEQUENCE BIT           02020002
FLAGS    EQU   X'40'                   TE PTR FLAG                      02040002
GACBADR  EQU   12                      GACB ADR                         02060002
IQELNK   EQU   0                       LINK FLD                         02080002
IQEPAR   EQU   4                       PARAM FLD                        02100002
IQEIRB   EQU   8                       IRD ADR FLD                      02120002
IQETCB   EQU   12                      TCB ADR FLD                      02140002
IQEDATA  EQU   16                      DATA FLD                         02160002
LPDET    EQU   X'80'                   LIGHT PEN BIT                    02180002
NEXAVL   EQU   96                      NEXT AVAILABLE  IQE  PTR         02200002
ONE      EQU   1                       ONE                              02220002
PFKBD    EQU   X'40'                   PF BIT                           02240002
RBIQE    EQU   24                      ADR OF FIRST INPUT IQE           02260002
RTNB     EQU   4                       HIGHER REB PTR                   02280002
RTNF     EQU   0                       PTR TO NEXT REB                  02300002
RTNFLG   EQU   20                      FLAG FLD                         02320002
RTNGACB  EQU   12                      GACB ADR                         02340002
RTNIRB   EQU   16                      IRB ADR                          02360002
RTNQ1    EQU   24                      EP=0  QUEUE FIELD           2575 02370002
RTNQ2    EQU   28                      Q2 LIST PTR                      02380002
REBTCB   EQU   33                      OFFSET TO TCB ADR IN REB         02400002
RTNUCB   EQU   8                       UCB PTR                          02420002
STAGE2   EQU   4                       STAGE 2 ADR                      02440002
TEREB    EQU   4                       REB PTR                          02460002
TETCB    EQU   8                       TE TCB ADR FLD                   02480002
TWO      EQU   2                       TWO                              02500002
TYPE4    EQU   19                      UCB TYPE FLD                     02520002
UCBSEN   EQU   32                      START OF UCB SENSE     LF YM4067 02540002
UCBTE    EQU   28                      USER TE ADR                      02560002
WAITST   EQU   X'80'                   WAIT BIT                         02580002
ZERO     EQU   0                       ZERO                             02600002
MULTI    EQU   X'20'                   INDICATES MULTIPLE 2260          02620002
NEXT     EQU   4                       CONSTANTS TO STEP ADR SEARCH     02640002
TEBGIOCR EQU   32                    GIOCR ADDRESS IN TEB    LG @ZM2360 02650000
GIOCR    EQU   49                    GIOCR ADDRESS IN DCB    LG @ZM2360 02652000
ALL      EQU   X'FF'                   ACCEPT ANY 2260                  02660002
RSTRT    EQU   45                      GACB LP RESTART FLAG             02680002
RESTART  EQU   X'01'                   AUTO RESTART BIT IN GFLGS        02700002
DEBDEB   EQU   4                   DEB CHAIN IN DEB                RSTD 02702002
DEBDCB   EQU   24                  DCB IN DEB                      RSTD 02703002
DEBUCB   EQU   32                  UCB IN DEB                      RSTD 02704002
CAN      EQU   12                  CANCEL KEY RTN ADDR/SW          RSTD 02705002
T2250    EQU   X'02'               2250 BIT IN UCB TYPE FIELD      RSTD 02706002
GCB      EQU   27                                                  RSTD 02707002
*GJPBIT  EQU   X'80'               GJP NO LONGER SPTD       D11         02708000
WODMP    EQU   X'00'                                               RSTD 02709002
RTNCD    EQU   X'40'                                               RSTD 02710002
ABND     EQU   X'80'                                               RSTD 02711002
ATTNERR  EQU   X'41'                                             F40815 02711502
FOUR     EQU   4                                                        02712002
FIVE     EQU   5                                                        02713002
SIX      EQU   6                                                        02714002
ECBLN    EQU   32                                                       02714502
SIXTN    EQU   16                                                       02715002
INDGAR   EQU   X'04'                                                    02716002
REBUCB   EQU   8                       UCB ADDR                         02717002
DQCKQE   EQU   X'02'                   DEQUEUE CKQE                     02718002
EIGHT    EQU   8                       DISPLACEMENT                     02718602
THREE    EQU   3                       MASK OF 3             LG Z30AALG 02719000
         EJECT                                                          02719202
         SAVE  (14,12)                                                  02750002
         BALR  BASERG,PAR0             SET UP BASE REG                  02760002
         USING *,BASERG                DEFINE BASE REG                  02780002
         USING WORKAREA,MAINREG        DEFINE CSECT REG                 02800002
         B     MODID1                                       D11         02810000
MODID    DC    C'IGG019OE.VS2R2.&SYSDATE' EYECATCHER        D11         02820000
MODID1   LR    RIQE,PAR0               SAVE PARAMETER                   02830000
         LR    RUCB,PAR1               SAVE PARAMETER                   02840002
         L     PAR0,REQUEST            LOAD BYTE REQUEST                02860002
         GETMAIN R,LV=(0)                                               02880002
         ST    PAR1,EIGHT(SAVEREG)     BACK CHAIN SAVE AREAS            02890002
         LR    MAINREG,PAR1            LOAD DSECT REG                   02900002
         XC    RSVD(120),RSVD          CLEAR CORE                       02920002
         ST    SAVEREG,CHAIN           CHAIN SAVE AREA                  02940002
         LA    SAVEREG,SAVE             ESTABLISH NEW SAVE AREA         02960402
         L     R11,UCBTE(ZERO,RUCB)     LOAD TE ADDRESS FROM UCB        02960502
         L     R10,TEBGIOCR(R11)     GIOCR ADDR FROM TEB     LG @ZM2360 02960900
         ST    R10,SAVGIOCR          SAVE IN WORK AREA       LG @ZM2360 02962700
         L     R10,CAN(R11)            LOAD CKQE POINTER                02967602
DEQLOOP  LA    R10,ZERO(R10)           CLEAR HIGH ORDER BYTE            02969402
         LTR   R10,R10                 CKQE POINTER ZERO                02971202
         BZ    GASBACK                 YES TEST FOR ABEND               02973002
         EJECT                                                          02974802
*    CANCEL KEY PROCESSING                                              02976602
         USING CKQE,R10                BASE REG FOR CKQE DSECT          02978402
         TM    CKQEFLGA,CKQEDEQ        SHOULD CKQE BE DEQUEUED          02980202
         BZ    CKCHECK                 NO                               02982002
*                                      YES REBUILD CHAIN                02983802
         L     R12,CKQENEXT            GET NEXT CKQE ADDRESS            02985602
         ST    R12,CAN(R11)            STORE NEW CKQE ADDRESS IN TE     02987402
         LR    PAR1,R10                LOAD CKQE ADDRESS FOR FREEMAIN   02989202
         L     PAR0,CKQECORE           LOAD SUBPOOL AND BYTE REQUEST    02991002
         FREEMAIN  R,LV=(0),A=(1)      FREE CKQE                        02992802
         LR    R10,R12                 PUT NEW CKQE PTR IN REG 10 AND   02994602
         B     DEQLOOP                 TEST FOR DEQUEUE NECESSARY       02996402
CKCHECK  ST    RUCB,IOSTAT         SAVE IO STATUS                   CAN 02998202
         LA    RUCB,ZERO(RUCB)     CLEAR HIGH ORDER BYTE         CAN01  03000002
         SR    R12,R12                 CLEAR REGISTER        LG Z30AALG 03000400
         ICM   R12,THREE,CKQEUCB       GET UCB ADDRESS       LG Z30AALG 03000800
         CR    RUCB,R12                COMPARE UCB ADDRS                03002002
         BE    CHKATTN                 MATCH FOUND-CAN KEY IN CONTROL   03004002
         L     R10,ZERO(R10)           GET NEXT CKQE                    03006002
         B     DEQLOOP                 CHECK FOR MORE CKQE'S            03008002
         EJECT                                                          03008402
CHKATTN  TM    CKQEFLGA,CKQEATTN       IS ATTN EXPECTED FROM 2250       03010002
         BZ    SSM6A                 NO                    D11 @ZA00524 03012000
         TM    IOSTAT,HEX82        IS IT A LIGHT PEN ATTENTION   CAN01  03014002
         BNO   GASRMI             BRANCH TO UNLOCK KYBD          CAN01  03016002
         L     PAR1,UCBTE(RUCB)   GET TEB ADDRESS                CAN01  03018002
         MVC   SENSED(FOUR),UCBSEN(RUCB)    MOVE SENSE DATA TO WORKAREA 03020002
         TM    SENSED+ONE,LPDET        TEST FOR LIGHT PEN DETECT        03022002
         BZ    GASRMI                  NOT LP - FREE KEYBOARD           03024002
         OI    FIVE(R10),INDGAR        IND ENTRY FROM GAR W/LP ATTN     03026002
         B     GAS60                   PLACE CKQE ON TEB CKQE LIST      03028002
GASRMI   L     REBRG,TEREB(PAR1)       LOAD REB ADDRESS                 03030002
REBLOOPA LA    REBRG,ZERO(REBRG)       CLEAR HIGH ORDER BYTE            03032002
         LTR   REBRG,REBRG             DOES REB EXIST                   03034002
         BNZ   REBGOOD            BRANCH IF REB ADDR IS GOOD            03036002
         L     R8,CKQEDCB         GET DCB ADDRESS                       03038002
         B     NOREBRMI           BRANCH IF REB IS NOT FOUND            03040002
         DROP  R10                                                      03042002
REBGOOD  L     R10,REBUCB(REBRG)  GET UCB FROM REB                      03044002
         CR    R10,R12                 RIGHT REB                        03046002
         BE    DCBRMI                  YES                              03048002
         L     REBRG,ZERO(REBRG)       NO TRY ANOTHER                   03050002
         B     REBLOOPA                REB                              03052002
DCBRMI   L     R8,GACBADR(REBRG)       GET GACB ADDRESS                 03054002
         L     R8,DCBADR(R8)           GET DCB ADDRESS                  03056002
         LA    R8,ZERO(R8)             CLEAR HIGH ORDER BYTE            03058002
NOREBRMI XC    IOREQ(ECBLN),IOREQ CLEAR ECB                             03060002
         LA    PAR1,IOREQ              LOAD DECB ADDRESS                03062002
         LA    R9,MI                   INPUT AREA ADDRESS               03064002
         BAL   R7,COMNREAD            GO EXECUTE GREADR FOR RMI         03066002
         B     GASHSKP                                                  03068002
         EJECT                                                          03068402
GASBACK  L     R11,UCBTE(0,RUCB)       LOAD TE ADR FROM UCB             03070002
         L     REBRG,TEREB(0,R11)      LOAD PTR TO FIRST REB            03072002
         LR    R10,RUCB                PARAM TO WORK REG(UCB ADR)       03074002
         LA    R10,0(0,R10)            ZERO HI ORDER BYTE               03076002
GAS02    LTR   REBRG,REBRG             PTR 0                            03078002
         BZ    GASCHAIN            BRANCH IF YES            D11    RSTD 03080000
         TM    RTNFLG(REBRG),MULTI     REB POINT TO A LIST OF           03100002
*                                      UCB ADRS                         03120002
         BNO   GAS24                   BRANCH IF NO                     03140000
         SR    R15,R15                 CLEAR REG                        03160002
         IC    R15,RTNFLG+1(REBRG)     LOAD NO OF UCB ADRS              03180002
         L     R14,RTNUCB(REBRG)       LOAD PTR TO LIST                 03200002
GAS25    L     R12,ZERO(0,R14)         LOAD UCB ADR                     03220002
         LA    R12,ZERO(0,R12)         ZERO HI ORDER BYTE               03240002
         CLR   R10,R12                 UCB ADRS EQUAL                   03260002
         BE    GAS01                   BRANCH IF YES        D11         03280000
         LA    R14,NEXT(0,R14)         UPDATE PTR                       03300002
         BCT   R15,GAS25               BRANCH IF MORE UCB ADRS          03320002
         B     GAS05                   BRANCH                           03340002
GAS24    L     R12,RTNUCB(0,REBRG)     LOAD REB UCB ADR                 03360002
         CLR   R10,R12                 ADDRESSES COMPARE                03380002
         BE    GAS01                   BRANCH IF YES        D11         03400000
GAS05    L     REBRG,RTNF(0,REBRG)     LOAD PTR TO NEXT REB             03420002
         B     GAS02                                                    03440002
         EJECT                                                          03450002
*     UCB MATCH FOUND                                                   03452002
GAS01    L     R12,CODETYP             LOAD MASK                        03460002
         NR    R12,RUCB                LOAD R12 WITH ATN TYPE           03480002
         LTR   R12,R12                 TEST FOR KYBD ATTN               03500002
         BZ    GAS03                   BRANCH IF KYBD ATTN  D11         03520000
         MVC   SENSED(4),UCBSEN(RUCB)  SENSE DATA TO WORK AREA          03540002
         TM    SENSED+1,LPDET          TEST FOR LIGHT PEN               03560002
         BNO   GAS04                   BRANCH IF NOT LP     D11         03580000
         LA    R10,LP                  LOAD LP CODE                     03600002
         L     R8,GACBADR(0,REBRG)     LOAD GACB ADR                    03620002
         L     R8,DCBADR(0,R8)         LOAD DCB ADR                     03640002
         LA    R8,ZERO(0,R8)           ZERO HI ORDER BYTE               03660002
         LTR   R8,R8                   DCB ADR=0                        03680002
         BZ    GAS05                   BRANCH IF YES        D11         03700000
         XC    IOREQ(32),IOREQ              CLEAR ECB              AHD6 03710002
         LA    PAR1,IOREQ              LOAD DECB ADR                    03720002
         LA    R9,XYP                  LOAD XYP ADR                     03740002
         SPACE 3                                            D11 ZA13194 03750000
* THERE FOLLOWS A HAND-CODED EXPANSION OF THE GREADR MACRO  D11 ZA13194 03751000
*    IN ORDER TO ACCESS THE ADDRESS OF GIOCR FROM A PRO-    D11 ZA13194 03752000
*    TECTED AREA (SAVGIOCR IN TEB) IN ORDER TO AVOID A      D11 ZA13194 03753000
*    SYSTEM INTEGRITY EXPOSURE.                             D11 ZA13194 03754000
*        GREADR (1),XYP,(8),(9),MF=E                        D11 ZA13194 03760000
         SR    R15,R15             CLEAR REG                D11 ZA13194 03761000
         ST    R15,4(R1)           CLEAR TYPE AREA IN DECB  D11 ZA13194 03762000
         MVI   4(R1),X'10'         XYP TYPE TO DECB         D11 ZA13194 03763000
         LA    R15,0(R8)           DCB ADDRESS              D11 ZA13194 03764000
         ST    R15,8(0,R1)         DCB ADDRESS IN DECB      D11 ZA13194 03765000
         LA    R15,0(R9)           AREA ADDRESS             D11 ZA13194 03766000
         ST    R15,12(0,R1)        AREA ADDRESS IN DECB     D11 ZA13194 03767000
         XC    0(4,R1),0(R1)       CLEAR ECB                D11 ZA13194 03768000
         L     R15,SAVGIOCR        SAFE GIOCR ADDR FROM TEB D11 ZA13194 03769000
         BALR  R14,R15             BRANCH TO GIOCR          D11 ZA13194 03770000
*  END OF HAND-CODED EXPANSION OF GREADR MACRO              D11 ZA13194 03771000
         SPACE 3                                            D11 ZA13194 03772000
         BAL   R7,COMNWAIT             TEST FOR GOOD I/O AND WAIT       03780002
         B     TRANSLAT                BRANCH                           03800002
GAS04    TM    SENSED+1,EOSDET         TEST FOR END ORDER SEQUENCE      03820002
         BNO   GAS06                   BRANCH IF NOT EOS    D11         03840000
         LA    R10,EOS                 LOAD EOS CODE                    03860002
         B     TRANSLAT                BRANCH                           03880002
GAS06    LA    R10,AE                  LOAD AE CODE                     03900002
         B     TRANSLAT                BRANCH                           03920002
         EJECT                                                          03930002
*     KEYBOARD ATTENTION, SO CHECK DEVICE TYPE                          03932002
GAS03    CLI   TYPE4(RUCB),AT2260      IS THIS A 2260                   03940002
         BNE   GAS08                   BRANCH IF NO         D11         03960000
         LA    R10,A2260               LOAD 2260 CODE                   03980002
         B     TRANSLAT                BRANCH                           04000002
*   FOR 2250 KEYBOARD ATTENTION                                         04010002
GAS08    L     R8,GACBADR(0,REBRG)     LOAD GACB ADR                    04020002
         L     R8,DCBADR(0,R8)         LOAD DCB ADR                     04040002
         LA    R8,ZERO(0,R8)           ZERO HI ORDER BYTE               04060002
         LTR   R8,R8                   DCB ADR=0                        04080002
         BZ    GAS05                   BRANCH IF YES TO TRY D11         04100000
*                                      ANOTHER UCB ADR MATCH            04120002
         XC    IOREQ(32),IOREQ              CLEAR ECB              AHD6 04130002
         LA    PAR1,IOREQ              LOAD DECB ADR                    04140002
         LA    R9,MI                   LOAD INPUT AREA ADR              04160002
         BAL   R7,COMNREAD            GO EXECUTE GREADR FOR RMI         04190002
         TM    MI,PFKBD                TEST FOR PF KYBD ATTN            04220002
         BO    GASPF                   BRANCH IF YES        D11         04240000
GAS10    TM    MI,CANCELD              TEST FOR CANCEL KEY              04260002
         BO    GAS132                  BR IF CANCEL KEY       LB  AOS/1 04280002
GAS22    TM    MI,ANKBD+ENDD           TEST FOR AN OR END KEY ATTENTIOM 04340002
         BZ    SSM6A             BRANCH IF NOT A/N OR END  D11 @ZA00524 04360000
         LA    R10,ENDORANK            LOAD END OR A/N CODE             04380002
         EJECT                                                          04390002
TRANSLAT STC   R10,TYPE                PUT TYPE IN DATA AREA            04400002
         LA    R7,ONE                  LOAD TYPE MASK                   04420002
         LA    R8,ZERO                 ZERO PF MASK                     04440002
         CLI   TYPE,ENDORANK           TEST FOR END OR A/N              04460002
         BE    SEARCH              YES,GO SEARCH            D11         04480000
         LA    R9,TWO                  LOAD CONSTANT                    04500002
         SR    R10,R9                  DETERMINE SHIFT COUNT            04520002
         SLL   R7,ZERO(R10)            DETERMINE SEARCH ARGUMENT        04540002
         B     SEARCH                  BRANCH                           04560002
GASPF    MVC   KEY(1),MI+1             KEY NUMBER TO WORH AREA          04580002
         MVC   OV(1),MI+2              OVERLAY COSE TO WORK AREA        04600002
         MVI   TYPE,X'02'              PF CODE TO TYPE FIELD            04620002
         SR    R10,R10                 CLEAR REG                        04640002
         IC    R10,KEY                 INSERT KEY NUMBER                04660002
         LA    R7,ZERO                 ZERO TYPE REG                    04680002
         L     R8,PFKCODE              LOAD PF MASK                     04700002
         SRL   R8,ZERO(R10)            DETERMINE PF SEARCH ARGUMENT     04720002
SEARCH   L     REBRG,UCBTE(0,RUCB)     LOAD TE ADR FROM UCB             04740002
         L     REBRG,TEREB(0,REBRG)    LOAD PTR TO FIRST REB            04760002
         LA    RUCB,ZERO(0,RUCB)       ZERO HIGH ORDER BYTE             04780002
GAS28    SR    R15,R15             CLEAR REG                  LI A42794 04800002
         TM    RTNFLG(REBRG),MULTI  REB POINT TO MULTI UCBS   LI A42794 04820002
         BNO   GAS12               BRANCH IF NO             D11  A42794 04840000
         IC    R15,RTNFLG+1(REBRG)     LOAD # OF UCB ADRS               04860002
         L     R14,RTNUCB(0,REBRG)     LOAD PTR                         04880002
GAS27    L     R9,ZERO(0,R14)          LOAD UCB ADR                     04900002
         LA    R9,ZERO(0,R9)           ZERO HI ORDER BYTE               04920002
         CLR   R9,RUCB                 UCB ADRS COMPARE                 04940002
         BE    GAS26                   BRANCH IF YES        D11         04960000
         LA    R14,NEXT(0,R14)         LOAD PTR TO NEXT UCB ADR         04980002
         BCT   R15,GAS27               BRANCH IF MORE                   05000002
         B     GAS13                   BRANCH                           05020002
GAS26    SR    R14,R14                 CLEAR REG                        05040002
         IC    R14,RTNFLG+1(REBRG)     INSERT # OF EXTENTS              05060002
         LA    R14,ONE(0,R14)          INCREMENT COUNT BY ONE           05080002
         SR    R14,R15                 DETERMINE OFFSET TO UCB ADR      05100002
         STC   R14,RSVD                2260 OFFSET TO DATA AREA         05120002
         B     GAS11                   BRANCH                           05140002
GAS12    L     R9,RTNUCB(0,REBRG)      LOAD UCB ADR                     05160002
         LA    R15,ONE(R15)            INCREMENT DEV INDEX   LD YA00804 05170002
         CLR   R9,RUCB                 ADRS COMPARE                     05180002
         BE    GAS26               BRANCH IF YES            D11  A42794 05200000
GAS13    L     REBRG,RTNF(0,REBRG)     LOAD NEXT REB PTR                05220002
         LTR   REBRG,REBRG             PTR = 0                          05240002
         BNZ   GAS28                   BRANCH IF PTR NOT 0  D11         05260000
         L     REBRG,UCBTE(0,RUCB)     LOAD TE ADR                      05280002
         L     REBRG,TEREB(0,REBRG)    LOAD PTR TO FIRST REB            05300002
         LA    RUCB,0(0,RUCB)          ZERO HI ORDER BYTE               05320002
GAS56    TM    RTNFLG(REBRG),MULTI     REB POINT TO LIST OF UCB ADRS    05340002
         BNO   GAS53                   BRANCH IF NO                     05360000
         SR    R9,R9                   CLEAR REG                        05380002
         IC    R9,RTNFLG+1(REBRG)      LOAD # OF UCB ADRS               05400002
         L     R11,RTNUCB(REBRG)       LOAD PTR TO LIST                 05420002
GAS55    L     R12,ZERO(0,R11)         LOAD UCB ADR                     05440002
         LA    R12,ZERO(0,R12)         ZERO HI ORDER BYTE               05460002
         CLR   RUCB,R12                UCB ADRS COMPARE                 05480002
         BNE   GAS54                   BRANCH IF NO         D11         05500000
         LA    R12,SSM6A             LOAD RETURN ADR       D11 @ZA00524 05520000
         CLI   TYPE,LP                 IS THIS A LP ATTN                05540002
         BNER  R12                     BRANCH IF NO         D11         05560000
         L     R9,RTNGACB(0,REBRG)     LOAD GACB ADRESS                 05580002
         B     LPSTART1                BRANCH                           05600002
GAS54    LA    R11,4(0,R11)            INCREMENT PTR                    05620002
         BCT   R9,GAS55                BRANCH IF MORE UCBS              05640002
GAS57    L     REBRG,RTNF(0,REBRG)     LOAD NEXT REB PTR                05660002
         LA    REBRG,ZERO(0,REBRG)     ZERO HI ORDER BYTE               05680002
         LTR   REBRG,REBRG             PTR=0                            05700002
         BZ    SSM6A                   BRANCH IF YES       D11 @ZA00524 05720000
         B     GAS56                   BRANCH                           05740002
GAS53    L     R12,RTNUCB(0,REBRG)     LOAD UCB ADR                     05760002
         LA    R12,ZERO(0,R12)         ZERO HI ORDER BYTE               05780002
         CLR   R12,RUCB                UCB ADRS COMPARE                 05800002
         BNE   GAS57                   BRANCH IF NO         D11         05820000
         LA    R12,SSM6A               LOAD RETURN ADR     D11 @ZA00524 05840000
         CLI   TYPE,LP                 IS THIS A LP ATTN                05860002
         BNER  R12                     BRANCH IF NO         D11         05880000
         L     R9,RTNGACB(0,REBRG)     LOAD GACB ADRESS                 05900002
         B     LPSTART1                BRANCH                           05920002
GAS11    L     R10,RTNIRB(0,REBRG)     LOAD IRB ADR                     05940002
         L     R9,RBIQE(0,R10)         LOAD RB IQE PTR                  05960002
         LA    R9,ZERO(0,R9)           ZERO HI ORDER BYTE               05980002
         LTR   R9,R9                   PTR=0                            06000002
         BNZ   GAS14                   BRANCH IF NOT 0      D11         06020000
         L     R9,RTNGACB(0,REBRG)     LOAD GACB ADR                    06040002
         LA    R9,ZERO(0,R9)           ZERO HIGH ORDER BYTE             06060002
         LTR   R9,R9                   GACB ADR=0                       06080002
         BZ    GAS58                   BRANCH IF YES        D11         06100000
         CLC   ECB(FOUR,R9),INIT   WAS ECB INITALIZED         LI A42794 06106002
         BE    POSTERR             YES, BRANCH                   F40815 06112002
         TM    ECB(R9),X'80'           ECB=WAIT                         06120002
         BO    GAS16                   BRANCH IF YES        D11         06140000
GAS58    L     R9,RTNQ2(0,REBRG)       LOAD QZ PTR                      06160002
         LTR   R9,R9                   PTR=0                            06180002
         BNZ   GAS15                   BRANCH IF NO         D11         06200000
         L     R9,RTNGACB(0,REBRG)     LOAD GACB ADR                    06220002
         L     R11,PFKMSK(0,R9)        LOAD PFKMSK MASK FROM GACB       06240002
         L     R12,PFKMSK+4(0,R9)      LOAD ATTNTYP MASK FROM GACB      06260002
         NR    R12,R7                  DETERMINE IF MATCH               06280002
         NR    R11,R8                  DETERMINE IF MATCH               06300002
         LTR   R12,R12                 REG=0                            06320002
         BNZ   GAS15                   NOT 0-ATTN TYP MATCH D11         06340000
         LTR   R11,R11                 REG=0                            06360002
         BNZ   GAS15                   NOT 0-PF KEY MATCH   D11         06380000
         B     GAS13                   BRANCH                           06400002
GAS14    L     R9,RTNGACB(0,REBRG)     LOAD GACB ADR                    06420002
         CLC   ECB(FOUR,R9),INIT        WAS ECB INITALIZED    LI A42794 06426002
         BE    POSTERR             YES, BRANCH                   F40815 06432002
         TM    ECB(R9),WAITST          ROUTINE IN WAIT STATE            06440002
         BO    GAS16                   BRANCH IF YES        D11         06460000
         B     GAS15               NO, BRANCH TO LP RESTART      F40815 06463002
POSTERR  LA    PAR0,ATTNERR        LOAD ERR CODE                 F40815 06466002
         SLL   PAR0,24             SHIFT TO HIGH ORDER BYTE      F40815 06469002
         LA    PAR1,ECB(R9)        LOAD ECB ADDR                 F40815 06472002
         POST  (1),(0)             POST ECB WITH ERROR           F40815 06475002
GAS15    BAL   R12,LPSTART             BRANCH TO LP RESTART CYCLE       06480002
GAS15A   L     R9,NEXAVL(0,R10)        LOAD NEXT AVAIL IQE FLD          06500002
         LTR   R9,R9                   PTR=0                            06520002
         BNZ   GAS17                   BRANCH IF NO         D11         06540000
         LA    R9,GMAINADR             SET UP RE-ENTRANT ADR LOC   0803 06547002
         LA    PAR1,GMAINLST       POINT TO LIST                 A34795 06549002
         GETMAIN EC,LV=32,A=(9),SP=234,MF=(E,(1))             LB  AOS/1 06551002
         LTR   R15,R15               IS CORE AVAILABLE             0803 06561002
         BZ    GAS15B                  IF YES, CONTINUE PROCESSING 0803 06568002
         BNZ   GASHSKP                                                  06588002
GAS15B   EQU   *                                             LG ZA00524 06591000
         LA    SAVEREG,LOCKSAVE        GET SAVE AREA ADDR    LG ZA00524 06594000
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(LOCAL,IGG019OE(X06597000
               SSM3)),REGS=SAVE                              LG ZA00524 06600000
         LA    SAVEREG,SAVE            RESTORE SVAREA ADDR   LG ZA00524 06603000
         L     R9,GMAINADR           CLEAR IQE                     0803 06610000
         XC    ZERO(32,R9),ZERO(R9)    CLEAR CORE                       06620002
         ST    R10,IQEIRB(0,R9)        IRB ADR TO IQE                   06640002
         L     PAR1,UCBTE(0,RUCB)      LOAD TE ADR                      06660002
         MVC   IQETCB+1(3,R9),REBTCB(REBRG)    SPAR TCB ADR TO IQE      06680002
GAS17    EQU   *                                             LD YA01555 06690002
         CLI   ENABL1,ALL              FORCE PAGE-IN         LD YA01555 06692002
         CLI   EP1(R7),ALL             FORCE PAGE-IN OF GACB LD YA01555 06694002
         LA    SAVEREG,LOCKSAVE        POINT TO SETLOCK SAVE AREA       06694402
SSM1     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(LOCAL,IGG019OE(X06696002
               SSM3)),REGS=SAVE                                         06698002
         LA    SAVEREG,SAVE            RESTORE SAVE AREA ADDRESS        06698402
         MVC   NEXAVL(4,R10),IQELNK(R9) LINK ADR TO IRB NEXAVL FLD      06700002
         L     R11,RTNGACB(0,REBRG)    LOAD GACB ADR                    06720002
         ST    R11,IQEPAR(R9)          GACB ADR TO IQE                  06740002
         MVC   IQEDATA(12,R9),RSVD     DATA TO IQE                      06760002
         MVC   IQELNK(4,R9),RTNQ2(REBRG) QZ PTR TO IQE LNK FIELD        06820002
         ST    R9,RTNQ2(REBRG)         IQE ADR TO Q2 PTR FLD            06840002
         B     SSM6A                                       D11 @ZA00524 06850000
GAS16    L     R12,RTNGACB(0,REBRG)    LOAD GACB ADR                    07120002
         L     R11,PFKMSK(0,R12)       LOAD PFKMSK                      07140002
         L     R14,PFKMSK+4(0,R12)     LOAD ATTNTYP MASK                07160002
         NR    R11,R8                  DETERMINE IF MATCH               07180002
         NR    R14,R7                  DETERMINE IF MATCH               07200002
         LTR   R11,R11                 REG=0                            07220002
         BNZ   GAS19               BRANCH NOT 0-HAD A MATCH D11         07240000
         LTR   R14,R14                 REG=0                            07260002
         BZ    GAS15                                                    07290002
GAS19    BAL   R12,LPSTART             BRANCH TO LP RESTART CYCLE       07320002
         L     R12,RTNGACB(0,REBRG)    LOAD GACB ADR                    07340002
         CLI   TYPE,A2260              IS THIS A 2260 ATTN              07360002
         BNE   GAS19A                  BRANCH IF NOT 2260   D11         07380000
         CLI   GACBRSVD(R12),ALL       ACCEPT ANY 2260 ATN              07400002
         BE    GAS19A                  BRANCH IF YES        D11         07420000
         CLC   GACBRSVD(1,R12),RSVD    IS THIS THE 2260 RTN WAITING FOR 07440002
         BNZ   GAS15A                  NO                               07470002
GAS19A   L     R11,REBTCB-1(0,REBRG)   LOAD TCB ADDRESS     D11 ZA13195 07476000
         USING TCB,R11                                      D11 ZA13195 07482000
         MODESET EXTKEY=TCB,WORKREG=1   GO TO USERKEY       D11 ZA13195 07488000
         DROP  R11                                          D11 ZA13195 07494000
         L     R11,COMAREA(0,R12)      LOAD COMAREA ADR                 07500000
         MVC   ZERO(12,R11),RSVD       DATA TO COMAREA                  07520002
         MODESET EXTKEY=SUPR           BACK TO SUPERKEY     D11 ZA13195 07530000
         LA    PAR0,COMPLETE           LOAD POST CODE                   07540002
         SLL   PAR0,24             SHIFT TO HIGH ORDER BYTE      F40815 07550002
         LA    PAR1,ECB(0,R12)         LOAD ECB ADR                     07560002
         POST  (1),(0)                                                  07580002
GAS18    EQU   *                                              LB  AOS/1 07680002
         LA    SAVEREG,LOCKSAVE        POINT TO SETLOCK SAVE AREA       07690002
SSM6     SETLOCK RELEASE,TYPE=LOCAL,RELATED=(LOCAL,IGG019OE(SSM7)),REGSX07700002
               =SAVE                                                    07710002
         LA    SAVEREG,SAVE            RESTORE SAVE AREA ADDRESS        07712002
SSM6A    L     REBRG,UCBTE(RUCB)       LOAD TE ADDRESS      D11   AOS/1 07720000
         L     REBRG,TEREB(0,REBRG)    LOAD PTR TO FIRST REB            07760002
         LA    REBRG,0(0,REBRG)        ZERO HI ORDER BYTE               07780002
         LTR   REBRG,REBRG                                              07800002
         BZ    ENABL1                  BRANCH IF YES        D11 YA01555 07820000
GAS23    L     R7,RTNF(0,REBRG)        LOAD PTR TO NEXT REB             07840002
         LTR   R7,R7                   REG 0                            07860002
         BZ    GAS20                   BRANCH IF YES        D11         07880000
         LR    REBRG,R7                SAVE ADR                         07900002
         B     GAS23                   BRANCH                           07920002
* REBR6 CONTAINS ADR OF LOWEST PRIORITY REB                        2575 07927002
* R7,R8 AND PAR1 REGS AVAILABLE AS WORK REGS                       2575 07934002
GAS20    EQU   *                                              LB  AOS/1 07941002
         LA    SAVEREG,LOCKSAVE        POINT TO SETLOCK SAVE AREA       07943002
SSM7     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(LOCAL,IGG019OE(X07945002
               SSM6)),REGS=SAVE                                         07947002
         LA    SAVEREG,SAVE            RESTORE SAVE AREA ADDRESS        07947402
GAS103   L     R7,RTNGACB(REBRG)       LOAD GACB ADR FROM REB      2575 07948002
         CLC   ZERO1(4),EP1(R7)        ENTRY POINT=0               2575 07955002
         BE    GAS100                  BRANCH-EP=0                 2575 07962002
GAS110   CLC   ZERO1(4),RTNQ1(REBRG)   ANY IQES ON Q1 FIELD        2575 07969002
         BNE   GAS101                  BRANCH-Q1 HAS IQES          2575 07976002
GAS104   CLC   ZERO1(4),RTNQ2(REBRG)   ANY IQES ON Q2 FIELD        2575 07983002
         BNE   GAS102                  BRANCH-Q2 HAS IQES          2575 07990002
GAS113   TM    RTNFLG(REBRG),FLAGS     REB POINT TO A TE           2575 07997002
         BO    ENABL1                  BR IF REB POINTS TO TE LB  AOS/1 08004002
         L     REBRG,RTNB(REBRG)       LOAD NEXT REB POINTER       2575 08011002
         B     GAS103                  BRANCH TO CHECK NEXT REB    2575 08018002
GAS102   L     R7,RTNQ2(REBRG)         LOAD IQE ADR                2575 08025002
         MVC   RTNQ2(4,REBRG),IQELNK(R7)  UPDATE CHAIN             2575 08032002
         LNR   PAR1,R7                 COMPLEMENT IQE ADR TO PARAM 2575 08039002
         L     R15,CVTADR              GET CVT TABLE ADR           2575 08046002
         L     R15,STAGE2(R15)         GET ADR OF AEE STAGE 2      2575 08053002
         BALR  R14,R15                 LINK TO AEE STAGE 2         2575 08060002
         B     GAS104                  BRANCH TO TEST FOR MORE IQE 2575 08067002
GAS101   L     PAR1,RTNQ1(REBRG)       LOAD ADR OF FIR0T IQE       2575 08074002
         SR    R7,R7                   ZERO PREVIOUS IQE REG       2575 08081002
GAS106   CLC   IQELNK(4,PAR1),ZERO1    LAST IQE ON CHAIN           2575 08088002
         BE    GAS105                  BRANCH-LAST IQE ON CHAIN    2575 08095002
         LR    R7,PAR1                 SAVE ADR THIS IQE           2575 08102002
         L     PAR1,IQELNK(PAR1)       LOAD NEXT IQE ADR ONCHAIN   2575 08109002
         B     GAS106                  BRANCH TO TEST FOR END OF C 2575 08116002
GAS105   LTR   R7,R7                   PREVIOUS IQE REG = 0        2575 08123002
         BZ    GAS107                  BRANCH-YES           D11    2575 08130000
         MVC   IQELNK(4,R7),IQELNK(PAR1) REMOVE IQE FROM END OF 01 2575 08137002
         B     GAS108                  BRANCH                      2575 08144002
GAS107   MVC   RTNQ1(4,REBRG),IQELNK(PAR1)   UPDATE 01 CHAIN       2575 08151002
GAS108   XC    IQELNK(4,PAR1),IQELNK(PAR1)   ZERO IQE LINK FIELD   2575 08158002
         CLC   ZERO1(4),RTNQ2(REBRG)   02 FIE TO ZERO              2575 08165002
         BNE   GAS109                  BRANCH-02 NOT ZERO          2575 08172002
         ST    PAR1,RTNQ2(REBRG)       ADD IQE TO Q2 FIELD         2575 08179002
         B     GAS110                  BRANCH TO TEST 01 FIELD     2575 08186002
GAS109   L     R7,RTNQ2(REBRG)         LOAD 1ST IQE ADR            2575 08193002
GAS112   CLC   ZERO1(4),IQELNK(R7)     LAST IQE ON CHAIN           2575 08200002
         BE    GAS111                  BRANCH-LAST IQE ON CHAIN    2575 08207002
         L     R7,IQELNK(R7)           LOAD ADR OF NEXT IQE        2575 08214002
         B     GAS112                  BRANCH TO FIND END OF Q2 CH 2575 08221002
GAS111   ST    PAR1,IQELNK(R7)         ADD IQE TO END OF CHAIN     2575 08228002
         B     GAS110                  BRANCH TO TEST Q1 FIELD     2575 08235002
GAS100   CLC   ZERO1(4),RTNQ2(REBRG)   ANU IQES ON Q2 FIELD        2575 08242002
         BE    GAS113                  BRANCH-NO IQES ON Q2 FIELD  2575 08249002
         L     PAR1,RTNQ2(REBRG)       LOAD ADR OF FIRST IQE       2575 08256002
         SR    R7,R7                   ZERO PREVIOUS IQE REG       2575 08263002
GAS114   CLC   ZERO1(4),IQELNK(PAR1)   LAST IQE ON CHAIN           2575 08270002
         BE    GAS115                  BRANCH LAST IQE ON CH       2575 08277002
         LR    R7,PAR1                 SAVE ADR THIS IQE           2575 08284002
         L     PAR1,IQELNK(PAR1)       LOAD NEXT IQE ADR ON CHAIN  2575 08291002
         B     GAS114                  BRANCH TO TEST FOR END OF   2575 08298002
GAS115   LTR   R7,R7                   PREVIOUS IQE REG= 0         2575 08305002
         BZ    GAS116                  BRANCH-YES           D11    2575 08312000
         MVC   IQELNK(4,R7),IQELNK(PAR1) REMOVE IQE FROM END OF Q  2575 08319002
         B     GAS117                  BRANCH                      2575 08326002
GAS116   MVC   RTNQ2(4,REBRG),IQELNK(PAR1) UPDATE Q2 CHAIN         2575 08333002
GAS117   XC    IQELNK(4,PAR1),IQELNK(PAR1) ZERO IQE LINK FIELD     2575 08340002
         CLC   ZERO1(4),RTNQ1(REBRG)   Q1 FIELD ZERO               2575 08347002
         BNE   GAS118                  BRANCH-Q1 NOT ZERO          2575 08354002
         ST    PAR1,RTNQ1(REBRG)       ADD IQE TO Q1 FIELD         2575 08361002
         B     GAS100                  BRANCH TO TEST 02 FIELD     2575 08368002
GAS118   L     R7,RTNQ1(REBRG)         LOAD 1SR IQE ADR            2575 08375002
GAS119   CLC   ZERO1(4),IQELNK(R7)     LAST IQE ON CHAIN           2575 08382002
         BE    GAS120                  BRANCH LAST IQE ON CHAI     2575 08389002
         L     R7,IQELNK(R7)           LOAD ADR OF NEXT IQE        2575 08396002
         B     GAS119                  BRANCH TO FIND END OF CHA   2575 08403002
GAS120   ST    PAR1,IQELNK(R7)         ADD IQE TO END OF CHAIN     2575 08410002
         B     GAS100                  BRANCH                      2575 08417002
ENABL1   EQU   *                       LIMIT OF DISABLED CODE LB  AOS/1 08420002
GASHSKP  L     SAVEREG,CHAIN            RESTORE SAVE AREA POINTER       08427002
         LR    PAR1,MAINREG            LOAD ADDRESS TO FREE             08437002
         L     PAR0,REQUEST            LOAD BYTE COUNT                  08447002
         L     RTCB,CVTADR          GET CVT ADDRESS              YM5683 08449002
         L     RTCB,0(RTCB)         ADDRESS OF TCB TABLE         YM5683 08451002
         L     RASCB,12(RTCB)       ADDRESS OF CURRENT ASCB      YM5683 08453002
         L     RTCB,4(RTCB)         ADDRESS OF CURRENT TCB       YM5683 08455002
         FREEMAIN R,LV=(0),A=(1),BRANCH=YES                      YM5683 08455402
SSM4     SETLOCK RELEASE,TYPE=LOCAL,RELATED=(LOCAL,IGG019OE(SSM5)),REGSX08507002
               =USE                                                     08509002
GASHSKP1 RETURN (14,12)                                            RSTD 08512002
         EJECT                                                          08516002
LPSTART  CLI   TYPE,LP                 IS THIS A LP ATTN                08520002
         BNER  R12                     BRANCH IF NOT LP     D11         08540000
         L     R9,RTNGACB(0,REBRG)     LOAD GACB ADR                    08560002
         TM    RSTRT(R9),RESTART       AUTO RESTART REQUESTED           08580002
         BNOR  R12                     BRANCH IF NO         D11         08600000
LPSTART1 L     R11,DCBADR(0,R9)        LOAD DCB ADDRESS                 08620002
         LA    R9,SENSED+TWO           LOAD RESTART ADR                 08640002
         XC    IOREQ(32),IOREQ         CLEAR DECB                       08660002
         LA    PAR1,IOREQ              LOAD DECB ADR                    08680002
*        SPACE 3                                            D11 ZA13194 08690000
*   THERE FOLLOWS A HAND-CODED EXPANSION OF THIS GCNTRL     D11 ZA13194 08698400
*   MACRO CALL IN ORDER TO ACCESS A SAFE GIOCR ADDR(TEB)    D11 ZA13194 08700000
*        GCNTRL (1),STR,(11),(9),MF=E                       D11 ZA13194 08701000
         SR    R15,R15             CLEAR REG                D11 ZA13194 08702000
         ST    R15,4(R1)           CLEAR TYPE AREA IN DECB  D11 ZA13194 08703000
         MVI   4(R1),X'6C'         STR TYPE CODE TO DECB    D11 ZA13194 08704000
         LA    R15,0(R11)          DCB ADDRESS              D11 ZA13194 08705000
         ST    R15,8(R1)           DCB ADDRESS IN DECB      D11 ZA13194 08706000
         LR    R15,R9              AREA ADDRESS             D11 ZA13194 08707000
         ST    R15,24(0,R1)        START ADDRESS IN DECB    D11 ZA13194 08708000
         XC    0(4,R1),0(R1)       CLEAR ECB                D11 ZA13194 08709000
         L     R15,SAVGIOCR        SAFE GIOCR ADDR FROM TEB D11 ZA13194 08710000
         BALR  R14,R15             BRANCH TO GIOCR          D11 ZA13194 08711000
*  END OF HAND-CODED EXPANSION OF GCNTRL MACRO CALL         D11 ZA13194 08712000
         SPACE 3                                            D11 ZA13194 08713000
         LTR   R15,R15             STARTED OK?              D11 ZA13196 08714000
         BNZ   GAS06               NO,SHOW ASYNCH ERR       D11 ZA13196 08717000
         WAIT  ECB=(1)                                                  08720002
         CLI   IOREQ,COMPLETE               I/O COMPLETED          AHD6 08726002
         BNE   GAS06                        BRANCH IF NO           AHD6 08732002
         BR    R12                                                      08740002
GASCHAIN CLI   TYPE4(RUCB),T2250       IS THIS A 2250            A27773 08740402
         BNE   SSM6A                 NO                    D11 @ZA00524 08740800
         L     R12,CODETYP         LOAD MASK                       RSTD 08742002
         NR    R12,RUCB                                            RSTD 08742402
         LTR   R12,R12                                             RSTD 08742802
         BNZ   SSM6A                 IS THIS A KYBD ATTN?  D11 @ZA00524 08743200
         L     REBRG,TETCB(R11)    LOAD TCB ADDR FIELD             RSTD 08743602
         USING TCB,REBRG                                    D11         08743800
         L     REBRG,TCBDEB        LOAD DEB QUEUE                  RSTD 08744000
         DROP  REBRG                                        D11         08744200
GAS130   LTR   REBRG,REBRG         ANOTHER DEB                     RSTD 08744402
         BZ    SSM6A                 NO...RETURN           D11 @ZA00524 08744800
         L     R15,DEBUCB(REBRG)   LOAD UCB                        RSTD 08745202
         LA    R15,0(R15)          ZERO HI ORDER BYTE              RSTD 08745602
         CR    R10,R15             SAME UCB                        RSTD 08746002
         BE    GAS131              YES                             RSTD 08746402
         L     REBRG,DEBDEB(REBRG) LOAD NEXT DECB                  RSTD 08746802
         LA    REBRG,0(REBRG)      ZERO HI ORDER BYTE              RSTD 08747202
         B     GAS130              CONTINUE SEARCH                 RSTD 08747602
GAS131   L     R8,DEBDCB(REBRG)                                         08748002
         LA    R8,0(R8)            ZERO HI ORDER BYTE              RSTD 08748402
         XC    IOREQ(32),IOREQ              CLEAR ECB              AHD6 08748602
         LA    PAR1,IOREQ          LOAD DECB ADDR                  RSTD 08748802
         LA    R9,MI               INPUT AREA ADDR                 RSTD 08749202
         BAL   R7,COMNREAD            GO TO EXECUTE GREADR              08749402
         TM    MI,CANCELD              TEST FOR CANCEL KEY     RSTD     08749602
         BNO   SSM6A                 NO...RETURN           D11 @ZA00524 08749800
GAS132   L     PAR0,CKQECORE           LOAD REQUEST FOR GETMAIN         08750002
         GETMAIN  R,LV=(0)      GET CORE FOR CKQE                       08750202
         LR    R10,PAR1                 LOAD ADDR OF CORE FOR CKQE      08750402
         XC    ZERO(SIXTN,R10),ZERO(R10)       ZERO CKQE                08750602
         STH   RUCB,SIX(R10)            PUT UCB PTR IN CKQE             08750802
         LA    SAVEREG,LOCKSAVE       POINT TO SETLOCK SAVE AREA        08750902
SSM5     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(LOCAL,IGG019OE(X08751002
               SSM4)),REGS=SAVE                                         08751102
         LA    SAVEREG,SAVE           RESTORE SAVE AREA POINTER         08751202
         L     PAR1,UCBTE(RUCB)        LOAD TE ADDRESS                  08752202
         ST    R8,CAN(R10)              STORE DCB ADDR IN CKQE          08752302
         MVC   ZERO(FOUR,R10),CAN(PAR1)    ADD NEW CKQE TO TOP OF       08752402
         ST    R10,CAN(PAR1)              TE CKQE LIST                  08752502
GAS60    L     R9,ZERO(PAR1)           LOAD CANCEL KEY IRB ADDR         08752602
         L     R7,NEXAVL(R9)          GET NEXT AVAILABLE CKIQE          08752702
         LA    R7,ZERO(R7)           CLEAR HIGH ORDER BYTE              08752802
         LTR   R7,R7                 CKIQE AVAILABLE                    08752902
         BNE   UPDATE                                                   08753002
         OI    FOUR(R10),DQCKQE        CKQE NO LONGER NEEDED            08753102
         B     GASHSKP                                                  08753202
UPDATE   MVC   NEXAVL(FOUR,R9),ZERO(R7)    UPDATE NEXT AVAIL CKIQE PTR  08753502
         ST    R10,FOUR(R7)            PUT CKQE PTR IN CKIQE            08753802
         LNR   PAR1,R7                COMPLEMENT IQE ADDR TO PARM LIST  08754102
         L     R15,CVTADR              GET CVT TABLE ADDRESS            08754502
         L     R15,STAGE2(R15)         GET ADDR OF AEE STAGE 2          08754602
         BALR  R14,R15                 LINK TO AEE STAGE 2              08754702
         B     GAS18                                        LG @ZA00524 08754800
         EJECT                                                          08756802
***                                                                     08758802
*                                                                       08760802
*              COMMON GREADR FOR READ MANUAL INPUT                      08762802
*                                                                       08764802
***                                                                     08766802
COMNREAD EQU   *                                                        08768802
         SPACE 3                                            D11 ZA13194 08770800
*  THERE FOLLOWS A HAND-CODED EXPANSION OF THIS CALL OF THE D11 ZA13194 08771000
*    GREADR MACRO IN ORDER TO ACCESS A SAFE GIOCR ADDR      D11 ZA13194 08771200
*    FROM THE TASK ENTRY BLOCK IN PROTECTED STORAGE.        D11 ZA13194 08771400
*        GREADR (1),MIP,(8),(9),MF=E                        D11 ZA13194 08771600
         SR    R15,R15             CLEAR REGISTER           D11 ZA13194 08771800
         ST    R15,4(0,R1)         CLEAR TYPE AREA IN DECB  D11 ZA13194 08772000
         MVI   4(R1),X'08'         MIP TYPE TO DECB         D11 ZA13194 08772200
         LA    R15,0(R8)           DCB ADDRESS              D11 ZA13194 08772400
         ST    R15,8(0,R1)         DCB ADDRESS IN DECB      D11 ZA13194 08772600
         LA    R15,0(R9)           AREA ADDRESS             D11 ZA13194 08772800
         ST    R15,12(0,R1)        AREA ADDRESS IN DECB     D11 ZA13194 08773000
         XC    0(4,R1),0(R1)       CLEAR ECB                D11 ZA13194 08773200
         L     R15,SAVGIOCR        SAFE GIOCR ADDR FROM TEB D11 ZA13194 08773400
         BALR  R14,R15             BRANCH TO GIOCR          D11 ZA13194 08773600
*  END OF HAND-EXPANSION OF GREADR MACRO CALL               D11 ZA13194 08773800
         SPACE 3                                            D11 ZA13194 08774000
COMNWAIT LTR   R15,R15                 I/O STARTED                      08777502
         BNZ   GASHSKP                 NO -- LEAVE                      08780002
         LA    PAR1,IOREQ                                               08782502
         WAIT  ECB=(1)                                                  08785002
         CLI   IOREQ,COMPLETE          I/O GOOD                         08787502
         BNE   GAS06                   NO -- BRANCH                     08790002
         BR    R7                     RETURN                            08792502
         EJECT                                                          08795002
ZERO1    DC    1F'0'                   ZERO                        2575 08797502
REQUEST  DC    A(164)              WORK AREA DSECT SPACE     LG @ZM2360 08800000
CODETYP  DC    X'02'                                                    08820002
         DC    AL3(0)                                                   08840002
PFKCODE  DC    X'80'                                                    08860002
         DC    AL3(0)                                                   08880002
DISABLE  DC    X'00'                                                    08940002
ENABLE   DC    X'FF'                                                    08960002
         DS    0F                                                       08964002
INIT     DC    X'00FFFFFF'                                       F40815 08966002
CKQECORE DC    X'E9'                   SP 233 FOR CKQE        LB  AOS/1 08968002
         DC    AL3(26)                 LENGTH OF CKQE         LI A39419 08972002
HOLDREG0 DC    F'0'                                                     08976002
         DS    0F                                                       08980002
         CNOP  0,8                                                      09000002
         EJECT                                                          09010002
WORKAREA DSECT                                                          09020002
         ORG   WORKAREA+0                                               09040002
RSVD     DS    BL1                                                      09060002
OV       DS    BL1                                                      09080002
KEY      DS    BL1                                                      09100002
TYPE     DS    BL1                                                      09120002
MI       DS    0BL3                                                     09140002
SENSED   DS    F                                                        09160002
XYP      DS    F                                                        09180002
         ORG   WORKAREA+16                                       A35022 09190002
IOREQ    DS    4D                                                       09200002
         ORG   WORKAREA+48                                       A35022 09210002
SAVE     DS    F                                                 A35022 09220002
CHAIN    DS    F                                                 A35022 09230002
         DS    16F                                                      09240002
         ORG   WORKAREA+120                                        0803 09268002
GMAINADR DS    F                       CORE ADR FOR IQE            0803 09272002
         ORG   WORKAREA+124                                      A34795 09276002
GMAINLST DS    F                   LENGTH FOR E-TYPE GETMAIN     A34795 09280002
         DS    F                   ADDR OF ADDR LIST             A34795 09284002
         DS    C                   EC MODE GETMAIN               A34795 09288002
         DS    C                   SUB POOL VALUE                A34795 09292002
         ORG   WORKAREA+136                                             09296002
IOSTAT   DS    F                                                        09300002
LOCKSAVE DS    5F                                                       09302002
SAVGIOCR DS    F                    SAVEAREA FOR GIOCR ADDR  LG @ZM2360 09302400
         CVT   DSECT=YES                                                09304002
         SPACE 3                                                        09310002
CKQE     DSECT                                                          09312302
CKQENEXT DS    F                       CHAIN POINTER TO NEXT CKQE       09312602
CKQEFLGA DS    XL1                     TWO BYTE SWITCHES USED TO        09312902
CKQEGJP  EQU   X'80'                   CALLER IS GJP                    09313202
CKQEDUMP EQU   X'40'                   CORE DUMP REQUESTED BY USER      09313502
CKQEATTN EQU   X'20'                   SYS CAN KEY RTN EXPECTING ATTN   09313802
CKQECKPT EQU   X'10'                   CKCB POINTER VALID               09314102
CKQERESV EQU   X'08'                   RESERVED                         09314402
CKQEGJPE EQU   X'04'                   GJP ECB ADDR VALID-GJP WAITING   09314702
CKQEDEQ  EQU   X'02'                   DEQUEUE CKQE                     09315002
CKQEBUF  EQU   X'01'                   2250 BUFFER RUNNING              09315302
CKQEFLGB DS    XL1                     COMMUNICATE WITH GAR,GJP ABEND   09315602
*                                      HOOK,IFFCAN01 AND IFFCAN02.      09315902
CKQEGETA EQU   X'80'                   GETMAIN FOR USER BUFFER          09316202
CKQERLOT EQU   X'40'                   USER BUFFER FOLLED OUT           09316502
CKQEGETB EQU   X'20'                   GETMAIN 2250 I/P BUFFER AND DECB 09316802
CKQEGETC EQU   X'10'                   GETMAIN OPCB,DECB AND O/P LINES  09317102
CKQESBD  EQU   X'08'                   SYSBFDMP O/P DCB IS OPEN         09317402
CKQEGAR  EQU   X'04'                   ENTRY FROM GAR WITH LP ATTN      09317702
CKQEUCB  DS    H                       POINTER TO ASSOCIATED UCB        09318002
CKQECKCB DS    F                       POINTER TO CAN KEY CONTROL BLOCK 09318302
CKQEDCB  DS    F                       DCB ADDR FOR ASSOCIATED DEVICE   09318602
         EJECT                                                          09319002
         IHAPSA                                                         09319302
         EJECT                                              D11 ZA13195 09319500
         IKJTCB                                             D11 ZA13195 09319700
         END                                                            09320002
