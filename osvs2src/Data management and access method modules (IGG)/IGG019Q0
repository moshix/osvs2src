         TITLE 'IGG019Q0 TCAM CHANNEL I/O TRACE ROUTINE'                00000100
IGG019Q0 CSECT                                                          00000258
***************************************************************@Y17XASK 00000300
*                                                                S21903 00600022
* MODULE NAME = IGG019Q0 (TCAM, SERVICE AIDS)                  @Y17XASK 00700000
*                                                                S21903 00800022
* DESCRIPTIVE NAME = TCAM CHANNEL I/0 TRACE ROUTINE            @Y17XASK 00900000
*                                                                S21903 01000022
* COPYRIGHT = NONE                                               S21903 01100022
*                                                                S21903 01200022
* STATUS = VERSION 10.0                                        @Y17XASK 01300000
*                                                                S21903 01400022
* FUNCTION = PROVIDE A TRACE OF ALL I/O ACTIVITY ON SELECTED   @Y17XASK 01500000
*            SUBCHANNELS.  UNIT ADDRESS, CSW, CCWS, PART OR    @Y17XASK 01520000
*            ALL OF THE DATA TRANSFERRED BY EACH CCW, TRACE    @Y17XASK 01540000
*            ENTRY SEQUENCE NUMBER, IOB FLAGS, DEVICE TTCIN,   @Y17XASK 01560000
*            DEVICE NAME, POINTER TO CURRENT ENTRY IN THE      @Y17XASK 01580000
*            INVITATION LIST, CCW ADDRESS, AND TP OPCODE ARE   @Y17XASK 01600000
*            TRACED AS APPROPRIATE FOR THE TYPE OF INTERRUPT   @Y17XASK 01620000
*            BEING PROCESSED.  SEE THE DSECTS AT THE END OF    @Y17XASK 01640000
*            THE MODULE FOR THE TRACE ENTRY FORMATS.  FOR ALL  @Y17XASK 01660000
*            INTERRUPTS HEADER AND INFORMATION ENTRIES ARE     @Y17XASK 01680000
*            MADE IN THE TRACE TABLE.  FOR NORMAL INTERRUPTS   @Y17XASK 01700000
*            (NOT ASYNCHRONOUS) AN ENTRY IS MADE FOR EACH CCW. @Y17XASK 01720000
*            IF THE DATA MOVED BY THE CCW IS MORE THAN 4 BYTES @Y17XASK 01740000
*            AN ADDITIONAL DATA ENTRY IS MADE.  TRACING IS     @Y17XASK 01760000
*            DONE ON SUBCHANNELS SPECIFIED BY THE OPERATOR     @Y17XASK 01780000
*            UNTIL EXPLICITLY TERMINATED.  TRACING IS DONE ON  @Y17XASK 01800000
*            ALL SUBCHANNELS WITH ERRORS IF REQUESTED BY THE   @Y17XASK 01820000
*            OPERATOR UNTIL A CHANNEL PROGRAM COMPLETES WITH   @Y17XASK 01840000
*            NORMAL ENDING STATUS AND/OR THE OPERATOR          @Y17XASK 01860000
*            TERMINATES THE TRACING OPERATION.  UP TO 50       @Y17XASK 01880000
*            SUBCHANNELS CAN BE TRACED CONCURRENTLY.           @Y17XASK 01900000
*                                                              @G36XRSV 01906000
* NOTE:      ALL APPENDAGES EXCEPT PCI NOW RUN ENABLED.        @G36XRSV 01912000
*            PCI RUNS DISABLED THROUGH THE DIE EXIT. THIS      @G36XRSV 01918000
*            MODULE WILL BE ENTERED WITH THE LOCAL LOCK FROM   @G36XRSV 01924000
*            ERP, LINEEND, AND THE ATTENTION HANDLER TO        @G36XRSV 01930000
*            SERIALIZE THOSE INTERRUPTS. THE POSSIBILITY OF    @G36XRSV 01936000
*            PCI INTERRUPTING LINEEND, ERP, OR ATTENTION       @G36XRSV 01942000
*            STILL EXISTS, THUS DESTROYING TRACE ENTRIES AS    @G36XRSV 01948000
*            THEY ARE BEING BUILT. TO PREVENT THIS OCCURRENCE, @G36XRSV 01954000
*            ERP, LINEEND, AND ATTENTION TRACE ENTRIES         @G36XRSV 01960000
*            ARE BUILT IN A SIXTEEN ENTRY TEMPORARY TABLE      @G36XRSV 01966000
*            AND THEN MOVED TO THE TRACE TABLE WHEN COMPLETED. @G36XRSV 01972000
*            IF A NON PCI INTERRUPT REQUIRES MORE THAN 16      @G36XRSV 01978000
*            ENTRIES, ONLY THE FIRST SIXTEEN ARE RECORDED.     @G36XRSV 01984000
*                                                              @OZ17621 01986000
*            IF THE LENGTH OF THIS MODULE VARIES AROUND        @OZ17621 01988000
*            HEX 800 BYTES, THEN IGG02035 SHOULD BE CHECKED    @OZ17621 01990000
*            TO MAKE SURE THE CORRECT NUMBER OF BYTES ARE      @OZ17621 01992000
*            BEING FREED.                                      @OZ17621 01994000
*                                                                S21903 02000022
* NOTES = SEE BELOW                                              S21903 02100022
*                                                                S21903 02200022
*    DEPENDENCIES = NONE                                         S21903 02300022
*                                                                S21903 02400022
*    RESTRICTIONS = NONE                                         S21903 02500022
*                                                                S21903 02600022
*    REGISTER CONVENTIONS = SEE REGISTER EQUATES                 S21903 02700022
*                                                              @Y17XASK 02730000
*    PATCH LABEL = NONE                                        @Y17XASK 02760000
*                                                                S21903 02800022
* MODULE TYPE = PROCEDURE                                        S21903 02900022
*                                                                S21903 03000022
*    PROCESSOR = ASSEMBLER                                       S21903 03100022
*                                                                S21903 03200022
*    MODULE SIZE = APPROXIMATELY 1770 BYTES                    @Y17XASK 03300000
*                                                                S21903 03400022
*    ATTRIBUTES = SERIALLY REUSABLE                            @Y17XASK 03500000
*                                                                S21903 03600022
* ENTRY POINT = IGG019Q0                                       @Y17XASK 03700000
*                                                                S21903 03800022
*    PURPOSE = SEE FUNCTION                                      S21903 03900000
*                                                                S21903 04000022
*    LINKAGE = R15 CONTAINS ENTRY POINT ADDRESS                @Y17XASK 04100000
*              FROM IGG019RN (PCI): HIGH ORDER BYTE CONTAINS   @G36XRSV 04105000
*                 X'FF'                                        @G36XRSV 04110000
*              FROM OTHERS: HIGH ORDER BYTE CONTAINS NON X'FF' @G36XRSV 04115000
*              R14 CONTAINS RETURN ADDRESS                     @Y17XASK 04120000
*              ENTERED FROM:                                   @Y17XASK 04260000
*              IGE0004G - SS ERP                               @Y17XASK 04280000
*              IGE0004H - BSC ERP                              @Y17XASK 04300000
*              IGG019RN - PCI APPENDAGE                        @Y17XASK 04320000
*              IGG019Q4 - MINI LINE END APPENDAGE              @Y17XASK 04340000
*              IGG019Q3 - SS LINE END APPENDAGE                @Y17XASK 04360000
*              IGG019Q2 - BSC LINE END APPENDAGE               @Y17XASK 04380000
*              IGG019R0 - SS/BSC LINE END APPENDAGE            @Y17XASK 04400000
*              IGG019TH - 370X CHANNEL END APPENDAGE           @Y17XASK 04420000
*              IGG019R5 - LOCAL DEVICE ATTENTION HANDLER       @Y17XASK 04440000
*              IGE0004I - 370X ERP                             @Y17XASK 04460000
*                                                              @Y17XASK 04480000
* INPUT = CHANNEL PROGRAM(IN LCB AND TCAM BUFFER UNITS)        @Y17XASK 04500000
*         CSW(IN IOB)                                          @Y17XASK 04550000
*         ENTRY FROM IGG019R5:                                 @Y17XASA 04557000
*         R1 = ZERO                                            @Y17XASA 04564000
*         R7 = UCB ADDRESS                                     @Y17XASA 04566000
*         R9 = IOB ADDRESS                                     @Y17XASA 04568000
*         ENTRY FROM ALL OTHER MODULES:                        @Y17XASA 04571000
*         R1 = RQE ADDRESS                                     @Y17XASA 04578000
*                                                                S21903 04600022
* OUTPUT = TRACE OF INTERRUPT INFORMATION IN TCAM'S LINE TRACE   S21903 04700022
*          TABLE                                               @Y17XASK 04750000
*                                                                S21903 04800022
* EXIT-NORMAL = RETURN TO CALLER                                 S21903 04900022
*                                                                S21903 05000022
* EXIT-ERROR = NONE                                            @Y17XASK 05100000
*                                                                S21903 05200022
* EXTERNAL REFERENCES = SEE BELOW                                S21903 05300022
*                                                                S21903 05400022
*    ROUTINES = IEDQFE20-TO DUMP TRACE TABLE WHEN IT IS ABOUT    S21903 05500000
*                        TO WRAP                                 S21903 05600022
*               IEAPTRV -ADDRESS CONVERSION ROUTINE            @Y17XASA 05630000
*               IEDQTNT -TERMINAL NAME TABLE ROUTINE           @Y17XASA 05660000
*                                                                S21903 05700022
*    DATA AREAS = TCAM LINE TRACE TABLE                          S21903 05800022
*                 TCAM TERMINAL NAME TABLE                     @Y17XASK 06000000
*                                                                S21903 06100022
*    CONTROL BLOCKS = OS CVT (COMMUNICATIONS VECTOR TABLE)       S21903 06200022
*                     OS RQE (REQUEST ELEMENT TABLE)             S21903 06300022
*                     TCAM AVT (ADDRESS VECTOR TABLE)            S21903 06400022
*                     TCAM LCB (LINE CONTROL BLOCK)            @Y17XASK 06500000
*                     OS UCB (UNIT CONTROL BLOCK)              @Y17XASK 06510000
*                     OS DCB (DATA CONTROL BLOCK)              @Y17XASK 06520000
*                                                              @Y17XASK 06530000
*    TABLES = Q0SAVE1 AND Q0SAVE2 - LOCAL SAVE AREAS           @Y17XASK 06540000
*             LINETABL - TRACE CONTROL TABLE (TCT)             @Y17XASK 06550000
*                                                                S21903 06600022
* MACROS = IEDHJN,TAVTD,TLCBD,TCCWD,CVT,DCBD,TTCXD,TTNTD,      @Y17XASK 06700000
*          TTHD,TTRMD,TPRFD                                    @Y17XASK 06750000
*                                                                S21903 06800022
* CHANGE ACTIVITY = SEE BELOW                                  @Y17XASK 06802000
*A000000-999999                                                  S21903 06804000
*A341000                                                        OX02185 06806000
*A199000                                                        SA64870 06808000
*C195000,236000-237000                                          SA64870 06810000
*D084000,103000                                                 SA64870 06812000
*A109000,196000                                                 OX02202 06814000
*A287000                                                         Y00487 06816000
*A109000,134000,235000,241000,274000,366000,376000,483000,488000 X02004 06818000
*A492000,494000                                                  X02004 06820000
*C084000,106000,117000,278000,280000,284000,290000,420000,483000 X02004 06822000
*C484000-487000,488000                                           X02004 06824000
*D084000,106000,240000,324000,326000,376000                      X02004 06826000
*A463000                                                       @SA69982 06828000
*C441000-442000,451000,464000                                  @SA69983 06830000
*D465000-466000                                                @SA69983 06832000
*A588000                                                       @SA70178 06834000
*C276000-277000,329000-330000,508000                           @SA70178 06836000
*C283000                                                       @SA70179 06838000
*D318000-320000,341300-341600                                  @SA70179 06840000
*A105000,222000,503000                                         @SA70180 06842000
*D270000                                                       @SA70180 06844000
*A174000                                                       @SA70190 06846000
*C162000-163000,170000,172000                                  @SA70190 06848000
*A366000                                                       @YA07104 06850000
*C394000                                                       @YA07104 06852000
*D266000                                                       @YA10963 06854000
*A158000,162000,165000,529000                                  @OX11945 06856000
*C133000,174630-174700,176000                                  @OX11945 06858000
*D164000-165000,168000-172000,174070-174210                    @OX11945 06860000
*C000003,007000,009000,013000,015000-019000,033000,035000      @Y17XASK 06862000
*C037000,041000-045000,051000,060000,065000,067000             @Y17XASK 06864000
*D000004-005000,059000                                         @Y17XASK 06866000
*A027300-027600,045500,047500,065100-065500,067500             @Y17XASK 06868000
*A068020-068600                                                @Y17XASK 06869000
*A085000,089500,103600,122100,133300,137100-137500,138500      @Y17XASA 06870000
*A140200-140700,155500-155600,156500-156600,168200             @Y17XASA 06871000
*A179050-179650,220100-220200,221500,222000-222210             @Y17XASA 06872000
*A222270-222320,222870-222875,222890,232500-232900,241200      @Y17XASA 06873000
*A261700,274950-274960,277500,287700-287815,289100-290955      @Y17XASA 06874000
*A297500,339500-339900,385050-385980,387500,413500             @Y17XASA 06875000
*A417050-417600,458500,459500,460500,465500-465600,480000      @Y17XASA 06876000
*A494700,494740,503050,523500,529100,529400,529700-529900      @Y17XASA 06877000
*A552500,577200-577700,588650-588880                           @Y17XASA 06878000
*C167000,236000,268000,296000,365000,367000,448000,488500      @Y17XASA 06879000
*C503300                                                       @Y17XASA 06880000
*D098000,103000,104000,109000-110000,114000-115000,109100      @Y17XASA 06881000
*D156000,190000,222280-222320,235100,235600,241000,243000      @Y17XASA 06882000
*D260000,262000-265000,276000,294000-295000,329000,363000      @Y17XASA 06883000
*D364000,444600-447000,478000,479000,480000,488500,489000      @Y17XASA 06884000
*D499000,502000                                                @Y17XASA 06885000
*A310000,C494600                                               @OX12574 06885500
*C508000                                                       @OY15041 06885600
*D177200,530000                                                @OY15041 06885700
*A192000                                                       @OX14797 06892700
* A019000,041000,068857,075000,081000,083000,112500,133600,    @G36XRSV 06893000
* A134000,174560,192000,207000,211000,214000,222600,401000,    @G36XRSV 06893300
* A415800,418000,419000,420000,423000,496000,497000,507100,    @G36XRSV 06893600
* A509000,543000                                               @G36XRSV 06893900
* C065400,068040,073000-074000,134000,174700,214000,           @G36XRSV 06894200
* C217000,232200,415200,419000,423000,496000,509000            @G36XRSV 06894500
* D174630,176000,215000-216000,232300-232500,424000-466000,    @G36XRSV 06894800
* D498000                                                      @G36XRSV 06895200
*A242000,246000,269000                                         @OY18045 06895300
*D259000-260000                                                @OY18045 06895400
*C529500                                                       @OX11945 06895500
*A019840                                                       @OZ17621 06895600
*D416728-416760                                                @OZ26897 06895700
*C232200                                                       @OZ26897 06896700
*A416326,A416333                                               @OZ30460 06896886
*A114900,415910,416656,496600,503050                           @OZ30604 06896986
*C207400,415928-416624,420500-420700,507300-507400,507700      @OZ30604 06897086
*A415921                                                       @OZ28809 06897186
*****************************************************************S21903 06900022
         EJECT                                                          07000022
* R E G I S T E R   E Q U A T E S                                S21903 07100022
         SPACE                                                          07200022
RWRK0    EQU   0                        WORK REGISTER 0        @G36XRSV 07300000
RWRK1    EQU   1                        WORK REGISTER 1        @G36XRSV 07400000
RCCW     EQU   2                        CURRENT CCW            @Y17XASA 07500000
RWRK2    EQU   2                        WORK REGISTER 2        @G36XRSV 07550000
RTABL    EQU   3                        TRACE CONTROL TABLE      S21903 07600022
RLCB     EQU   4                        LCB BASE REGISTER      @Y17XASA 07700000
RGTIC    EQU   5                        TIC CCW                  S21903 07800022
RWRK6    EQU   6                        WORK REGISTER 6          S21903 07900000
RWRK7    EQU   7                        WORK REGISTER 7          S21903 07960000
RUCB     EQU   7                        UCB REGISTER REG 7     @Y17XASA 08020000
RCVTD    EQU   8                        CVT BASE REGISTER        S21903 08100022
RWRK8    EQU   8                        WORK REGISTER 8        @G36XRSV 08150000
RWRK9    EQU   9                        WORK REGISTER 9          S21903 08200000
RDCB     EQU   10                       DCB BASE REGISTER        S21903 08300000
RWRKA    EQU   10                       WORK REGISTER 10       @G36XRSV 08350000
RWRKB    EQU   11                       WORK REGISTER 11       @Y17XASA 08400000
RBASE    EQU   12                       CSECT BASE REGISTER      S21903 08600022
RAVT     EQU   13                       AVT BASE REGISTER        S21903 08700000
RBALR    EQU   14                       BALR RETURN LINKAGE      S21903 08800022
RWRKF    EQU   15                       CURRENT TRACE ENTRY    @Y17XASA 08900000
RNTRY    EQU   15                       ENTRY REG 15           @Y17XASA 08950000
         SPACE                                                          09000022
* O T H E R   E Q U A T E S                                      S21903 09100022
         SPACE                                                          09200022
BLANK    EQU   X'40'                    BLANK                  @Y17XASA 09250000
ZERO     EQU   X'00'                    INITIALIZATION           S21903 09300022
ONE      EQU   X'01'                    CONSTANT =  1            S21903 09400022
TWO      EQU   X'02'                    CONSTANT =  2            S21903 09500022
THREE    EQU   X'03'                    CONSTANT =  3            S21903 09700022
FOUR     EQU   X'04'                    CONSTANT =  4            S21903 09900022
INVTIC   EQU   X'07'                    TEST FOR INVALID TIC     S21903 10200022
TIC      EQU   X'07'                    TEST FOR TIC CCW         S21903 10350022
SEVEN    EQU   X'07'                    MASK FOR ICM OR STCM   @Y17XASA 10370000
CSWLOC   EQU   X'40'                    LOW CORE CSW LOCATION  @YM07302 10770000
LINEID   EQU   X'F0'                    LINE ENTRY INDICATOR     S21903 11200022
FA       EQU   X'FA'                    TERMINAL NAME ENTRY    @SA70180 11250056
HIBYTE   EQU   X'08'                    MASK FOR HI BYTE OF REG@G36XRSV 11330000
*                                        'IN USE'              @G36XRSV 11490000
TWO56    EQU   256                      TWO HUNDRED FIFTY-SIX  @OZ30604 11520086
PCIOP    EQU   X'80'                    PCI RUNNING INDICATOR  @OZ28809 11550086
         EJECT                                                          11600022
         USING IEDQRQE,RWRK1            RQE ADDRESSIBILITY     @Y17XASA 11650000
         USING IGG019Q0,RNTRY           TEMPORARY BASE           X02004 11700005
         USING IEDQLCB,RLCB             LCB DSECT ADDRESSIBILITY S21903 11800000
         USING IEDQCCW,RCCW             CCW DSECT ADDRESSIBILITY S21903 11900000
         USING LINETAB,RTABL            LINE TABL ADDRESSIBILITY S21903 12000022
         USING CVTDSECT,RCVTD           CVT DSECT ADDRESSIBILITY S21903 12100022
         USING IEDQUCB,RUCB             UCB DSECT ADDRESSIBILITY S21903 12150000
         USING IHADCB,RDCB              DCB ADDRESSIBILITY     @Y17XASA 12200000
         SPACE                                                          12300022
*****************************************************************S21903 12400022
*                                                                S21903 12500022
* THIS SECTION OF CODE SAVE CALLER'S REGISTERS IN A LOCAL        S21903 12600022
* SAVEAREA. THE TRACE INDICATOR (LCBTRACE) IS TESTED IN THE LCB  S21903 12700022
* TO DETERMINE IF A TRACE IS DESIRED FOR THIS LINE, IF NOT,      S21903 12800022
* CONTROL IS PASSED TO THE LABEL 'RETURN'.                       S21903 12900022
*                                                                S21903 13000022
*****************************************************************S21903 13100022
         SPACE                                                          13200022
         B     START                    BRANCH AROUND ID       @OX11945 13300058
         DC    A(LINETABL-LTSIZE)       ADCON USED BY IGCM610D @OX11945 13320058
IGG019Q0 IEDHJN ,HJN                                           @Y17XASA 13330000
START    EQU   *                                               @OX11945 13360058
         CLM   RNTRY,HIBYTE,FOXFOX      FROM PCI?              @G36XRSV 13370000
         BNE   NOPCISAV                 N-BR                   @G36XRSV 13380000
         STM   RWRK0,RNTRY,Q0SAVE1      SAVE CALLER'S REGISTERS@G36XRSV 13400000
         B     GETBASE                                         @G36XRSV 13404000
NOPCISAV DS    0H                                              @G36XRSV 13408000
         STM   RWRK0,RNTRY,Q0SAVE2      SAVE REGS FOR NON-PCI  @G36XRSV 13412000
GETBASE  DS    0H                                              @G36XRSV 13416000
         LR    RBASE,RNTRY              COPY BASE REGISTER       X02004 13420005
         DROP  RNTRY                                             X02004 13440005
         USING IGG019Q0,RBASE           CSECT ADDRESSIBILITY     X02004 13460005
         L     RCVTD,CVTPTR             CVT ADDRESS              S21903 13500000
         L     RAVT,CVTAQAVT            TCAM TCX ADDRESS         S21903 13560000
         USING TCXAVT,RAVT              TCX ADDRESSIBILITY     @Y17XASA 13620000
         L     RAVT,TCXAVT              TCAM AVT ADDRESS         S21903 13700000
         USING IEDQAVTD,RAVT            AVT DSECT ADDRESS      @Y17XASA 13710000
         LTR   RWRK1,RWRK1              ATTENTION ENTRY        @Y17XASA 13720000
         BNZ   NOTATTN1                 NO                     @Y17XASA 13730000
         LR    RLCB,RWRK9               GET IOB ADDRESS        @Y17XASA 13740000
         B     ATTNENT1                 CONTINUE               @Y17XASA 13750000
NOTATTN1 EQU   *                                               @Y17XASA 13760000
         L     RLCB,RQEIOB              IOB ADDRESS FROM RQE     S21903 13800000
ATTNENT1 EQU   *                                               @Y17XASA 13850000
         SH    RLCB,LCBBKUP             BACK UP TO LCB PROPER    S21903 13900000
         LA    RLCB,ZERO(,RLCB)         CLEAR HI-ORDER BYTE    @YM09095 13950000
         TM    LCBSTAT2,LCBTRACE        TRACING ON THIS LINE     S21903 14000022
         BO    TRACE                    YES                    @Y17XASA 14010000
         TM    AVTIOTR,AVTIOTRE         ERROR TRACE SPECIFIED  @Y17XASA 14020000
         BZ    RETURN                   NO , RETURN            @Y17XASA 14030000
         LTR   RWRK1,RWRK1              ATTENTION ENTRY        @Y17XASA 14040000
         BZ    RETURN                   YES , RETURN           @Y17XASA 14050000
         TM    LCBCSWUS,LCBUSUC         UNIT CHECK IN CSW      @Y17XASA 14060000
         BNO   RETURN                   BR NO TO RETURN          S21903 14100022
         EJECT                                                          14200022
*****************************************************************S21903 14300022
*                                                                S21903 14400022
* THIS SECTION OF CODE SCANS A MULTIPLE-ENTRY LINE CONTROL TABLE S21903 14500000
* (LINETAB DSECT) TO DETERMINE IF AN ENTRY ALREADY EXISTS FOR    S21903 14600022
* THIS LINE. IF SO CONTROL IS PASSED TO THE LABEL 'THISNTRY'.    S21903 14700022
* OTHERWISE THE TABLE IS SEARCHED FOR AN UNUSED OR AVAILABLE     S21903 14800022
* ENTRY. IF ONE IS FOUND IT IS INITIALIZED FOR THIS LINE AND     S21903 14900022
* CONTROL IS PASSED TO THE LABEL 'THISNTRY'. OTHERWISE CONTROL   S21903 15000022
* IS PASSED TO THE LABEL 'RETURN' AND NO TRACE IS PERFORMED      S21903 15100022
* ON THIS LINE EVEN THOUGH REQUESTED.                            S21903 15200022
*                                                                S21903 15300022
*****************************************************************S21903 15400022
         SPACE                                                          15500022
TRACE    EQU   *                                               @Y17XASA 15530000
         L     RDCB,LCBDCBPT            DCB ADDRESS FROM LCB   @Y17XASA 15560000
         LTR   RWRK1,RWRK1              ATTENTION ENTRY        @Y17XASA 15600000
         BZ    ATTNENT2                 YES                    @Y17XASA 15650000
         SLR   RUCB,RUCB                CLEAR REGISTER         @Y17XASK 15670000
         ICM   RUCB,3,RQEUCB            GET UCB ADDR FROM RQE  @YM06131 15700000
ATTNENT2 EQU   *                                               @Y17XASA 15800000
         LH    RWRK9,UCBCHA             CHANNEL/UNIT ADDRESS   @OX11945 15830000
         N     RWRK9,CLEARHI            CLEAR UNWANTED BITS    @OX11945 15860000
         LA    RTABL,LINETABL           LINE CONTROL TABLE ADDR  S21903 15900022
TABLSRCH EQU   *                                                 S21903 16000022
         CLI   LTCUU,AVTEFF             END OF TABLE             S21903 16100000
         BE    RESEARCH                 TEST IF TABLE FULL.    @SA70190 16200056
         TM    LTPCI,LTINUSE            ENTRY IN USE           @OX11945 16260058
         BZ    TBLSRCH1                 BRANCH NO              @OX11945 16320058
         CH    RWRK9,LTCUU              ENTRY FOR THIS ADDRESS   S21903 16600000
         BE    ATTNTEST                 BR TO TEST ATTN        @Y17XASA 16900000
TBLSRCH1 EQU   *                                               @SA70190 17250056
         LA    RTABL,LTSIZE(,RTABL)     POINT TO NEXT ENTRY      S21903 17300000
         B     TABLSRCH                 BR TO CONTINUE SEARCH    S21903 17400022
RESEARCH EQU   *                                               @SA70190 17428056
         LA    RTABL,LINETABL           RESET TO BEGINNING.    @SA70190 17435056
TBLSRCH2 EQU   *                                               @SA70190 17442056
         CLI   LTCUU,AVTEFF             TEST FOR END OF TABLE. @SA70190 17449000
         BE    RETURN                   YES - SKIP TRACE       @SA70190 17456056
         TM    LTPCI,LTINUSE            IS SLOT IN USE ?       @G36XRSV 17456300
         BO    TBLSRCH3                 Y-GET NEXT SLOT        @G36XRSV 17456600
         L     RWRKB,LTPCI              CONTAINS 'IN USE' BIT  @G36XRSV 17458000
         L     RWRKF,INUSEMSK           SET BIT IN REG         @G36XRSV 17459000
         CS    RWRKB,RWRKF,LTPCI        SET BIT IF NOT 'IN USE'@G36XRSV 17460000
         BZ    NEWENTRY                 NOT ALREADY 'IN USE'   @G36XRSV 17470000
TBLSRCH3 DS    0H                                              @G36XRSV 17473000
         LA    RTABL,LTSIZE(,RTABL)     BUMP BY TABLE WIDTH.   @SA70190 17477000
         B     TBLSRCH2                 LOOP THRU TABLE TILL   @SA70190 17484056
*                                       END OR EMPTY SLOT FOUND.SA70190 17491056
NEWENTRY EQU   *                                                 S21903 17500022
         STH   RWRK9,LTCUU              SET NEW CHAN/UNIT ADDR   S21903 17700000
         STH   RWRK7,LTUCBAD            SAVE UCB ADDRESS         S21903 17710000
         TM    DCBDSRG2,DCBDSGTR        DCB FOR 370X           @Y17XASA 17730000
         BZ    NOT370X1                 NO                     @Y17XASA 17740000
         OI    LTPCI,LTP370X            INDICATE 370X ENTRY    @Y17XASA 17750000
NOT370X1 EQU   *                                               @Y17XASA 17760000
         TM    LCBSTAT2,LCBTRACE        TRACE ACTIVE ON LINE   @Y17XASA 17770000
         BO    ATTNTEST                 YES                    @Y17XASA 17780000
         OI    LTPCI,LTFIRST+LTERROR    FIRST AND ERROR SWITCH @Y17XASA 17790000
         OI    LCBSTAT2,LCBTRACE        INDICATE TRACE IN LCB  @Y17XASA 17800000
ATTNTEST EQU   *                                               @Y17XASA 17810000
         LTR   RWRK1,RWRK1              ATTENTION ENTRY        @Y17XASA 17820000
         BNZ   THISNTRY                 NO                     @Y17XASA 17830000
         OI    LTPCI,LTLATTN            INDICATE ATTN ENTRY    @Y17XASA 17840000
         B     TRACEIT                  BRANCH TO TRACEIT      @Y17XASA 17850000
         EJECT                                                          18000022
*****************************************************************S21903 18100022
*                                                                S21903 18200022
* THIS SECTION OF CODE POINTS TO THE CURRENT TRACE ENTRY AND     S21903 18300022
* BUILDS A HEADER ENTRY FOR THIS INTERRUPT. THE FORMAT OF THIS   S21903 18400022
* ENTRY IS DESCRIBED BY THE TRACEHDR DSECT.                      S21903 18500022
*                                                                S21903 18600022
*****************************************************************S21903 18700022
         SPACE                                                          18800022
THISNTRY EQU   *                                                 S21903 18900022
         TM    LCBFLAG1,LCBERPIN+LCBEXCPN  ENTRY FROM ERP        S21903 19100000
         BNO   NOTERP                   BR NO NOTHING SPECIAL    S21903 19200022
         TM    LCBCSW+FOUR,LCBCSPCI     PCI INTERRUPT          @OX14797 19230000
         BO    TESTEND                  BRANCH YES             @OX14797 19260000
         OI    LTPCI,LTITSERP           INDICATE THIS ENTRY HAS  S21903 19300022
*                                         BEEN TRACED UNDER ERP  S21903 19400022
         B     TESTEND                  BR TO TRACE ENTRY       SA64870 19500051
NOTERP   EQU   *                                                 S21903 19600022
         CLI   LCBECBCC,LCBECB41        PERMANENT ERROR         OX02202 19630000
         BE    SETRET                   BR YES, SKIP TRACING    OX02202 19660054
         TM    LTPCI,LTERPPCI           HAS THIS ENTRY BEEN    @Y17XASA 19700000
*                                         TRACED UNDER ERP OR PCIS21903 19800022
         BNZ   SETRET                   BR YES FORGET IT NOW     S21903 19900022
TESTEND  EQU   *                                                SA64870 19950051
         TM    LCBCSWUS,LCBUSCE+LCBUSDE CHANNEL/DEVICE END       S21903 20000000
         BNO   TRACEIT                  BR NO NOT DUPLICATE      S21903 20100022
         TM    LCBCSWCS,LCBCSPCI        PCI INTERRUPT            S21903 20200000
         BNO   TRACEIT                  BR NO NOT DUPLICATE      S21903 20300022
         OI    LTPCI,LTITSPCI           ENTRY IS FROM PCI AND    S21903 20400022
*                                         WILL BE ENTERED AGAIN  S21903 20500022
*                                         FROM LINEEND-SET SKIP  S21903 20600022
TRACEIT  EQU   *                                                 S21903 20700022
         CLM   RBASE,HIBYTE,AVTHFF      ENTRY FROM PCI?        @G36XRSV 20710000
         BE    PCITRACE                 Y-BR                   @G36XRSV 20720000
         LA    RWRKF,TABLE2             POINT TO TEMP TABLE    @G36XRSV 20730000
         XC    TABLE2(TWO56),TABLE2     CLEAR TABLE            @OZ30604 20740086
         XC    TABLE2+TWO56(TWO56),TABLE2+TWO56                @OZ30604 20742086
         XC    TABLE2+TWO*TWO56(TWO56),TABLE2+TWO*TWO56        @OZ30604 20744086
         XC    TABLE2+THREE*TWO56(TWO56),TABLE2+THREE*TWO56    @OZ30604 20746086
         B     TRACEIT1                                        @G36XRSV 20750000
PCITRACE DS    0H                                              @G36XRSV 20760000
         L     RWRKF,AVTRACE            I/O TRACE CONTROL WORDS  S21903 20800000
         USING TRACNTRL,RWRKF                                    S21903 20900000
         L     RWRKF,TRACURR            POINT TO CURRENT ENTRY   S21903 21000000
         DROP  RWRKF                                             S21903 21100000
TRACEIT1 DS    0H                                              @G36XRSV 21150000
         USING TRACEHDR,RWRKF                                    S21903 21200000
         MVC   TRACCUU,LTCUU            SET CHANNEL/UNIT ADDRESS S21903 21300022
         L     RWRK1,TRACECNT           OLD SEQUENCE NUMBER    @G36XRSV 21400000
TCOUNT   DS    0H                                              @G36XRSV 21420000
         LA    RWRK2,ONE(RWRK1)         INCREMENT BY 1         @G36XRSV 21440000
         CS    RWRK1,RWRK2,TRACECNT     AND STORE              @G36XRSV 21460000
         BNZ   TCOUNT                   BR IF ALREADY UPDATED  @G36XRSV 21480000
         STH   RWRK2,TRACSEQ            TRACE SEQUENCE NUMBER  @G36XRSV 21700000
         MVC   TRACFLG1,LCBFLAG1        TRACE IOB FLAGS          S21903 21800022
         MVC   TRACPSRT,LCBSTART        TRACE CHAN PROG START    S21903 21900022
         MVC   TRACSW,LCBCSW            TRACE CSW              @Y17XASA 22000000
         TM    LTPCI,LTLATTN            ATTENTION ENTRY        @Y17XASA 22030000
         BO    TRACECSW                 BR YES, TRACE REAL CSW @YM07302 22060000
         MVC   TRACSENS,LCBSENS0        TRACE SENSE INFO       @Y17XASA 22070000
         B     TRACEITX                                        @YM07302 22080000
TRACECSW EQU   *                                               @YM07302 22090000
         MVC   TRACSW,CSWLOC+ONE        TRACE LOW CORE CSW     @YM07757 22100000
TRACEITX EQU   *                                               @Y17XASA 22150000
         BAL   RBALR,WRAPTEST           CHECK FOR END OF TRACE   S21903 22200000
         EJECT                                                 @SA70180 22202056
****************************************************************SA70180 22204056
*                                                              @SA70180 22206056
* THIS SECTION OF CODE WILL DETERMINE THE CURRENTLY ATTACHED   @SA70180 22208056
* TERMINAL AS PER THE CONTENTS OF LCBTTCIN OR LCBLNENT, IF     @SA70180 22210056
* THESE ARE INVALID OR INDETERMINATE THE UCB NAME WILL BE      @SA70180 22212000
* INSERTED INSTEAD. POSSIBLE CAUSE OF THE ABOVE WILL BE IN THE @SA70180 22214056
* CASE OF A DIAL LINE AND/OR OPEN PROCESSING.                  @SA70180 22216056
*                                                              @SA70180 22218056
****************************************************************SA70180 22220056
         SPACE 1                                               @SA70180 22222056
         USING TRACINFO,RWRKF                                  @SA70180 22224000
         MVI   TRACIND,FA               INDICATE ADDL ENTRY.   @SA70180 22226056
         MVI   TRACNAME,BLANK           MOVE BLANK TO NAME     @Y17XASA 22226400
         MVC   TRACNAME+1(L'TRACNAME-1),TRACNAME  BLANK NAME   @Y17XASA 22226800
         TM    LTPCI,LTLATTN            ATTENTION ENTRY        @Y17XASA 22227200
         BZ    NOTATTN3                 NO                     @Y17XASA 22227600
         TM    LTPCI,LTP370X            370X ENTRY             @Y17XASA 22228000
         BNO   NOTDIAL                  NO                     @Y17XASA 22229000
NOTATTN3 EQU   *                                               @Y17XASA 22230000
         LH    RWRK6,LCBTTCIN           TEST IF A TERMINAL     @SA70180 22234000
         LTR   RWRK6,RWRK6              SAVE TTCIN AND TRACE IT@SA70180 22236000
         BNZ   TNAMETBL                 NO TTCIN- TRY LINE ENT @SA70180 22238056
         TM    LCBSTAT2,LCBDIAL         TEST FOR DIAL          @SA70180 22240056
         BZ    NOTDIAL                  NO - DEFAULT TO UCB NM.@SA70180 22242056
         LH    RWRK6,LCBLNENT           TEST IF LINE ENTRY     @SA70180 22244000
         LTR   RWRK6,RWRK6              ZERO = NO LN ENTRY.    @SA70180 22246000
         BNZ   TNAMETBL                 YES = DO NAME SEARCH.  @SA70180 22248056
NOTDIAL  EQU   *                                               @SA70180 22250056
         LH    RUCB,LTUCBAD             GET UCB ADDRESS.       @SA70180 22252000
         N     RUCB,AVTCLRHI            CLEAR SIGN PROPAGATION.@SA70180 22254000
         MVC   TRACNAME(THREE),UCBNAME  TRACE UCB NAME         @SA70180 22256000
         B     TNAMEXIT                 CONTINUE TRACEING.     @SA70180 22258056
TNAMETBL EQU   *                                               @SA70180 22260056
         N     RWRK6,AVTCLRHI           CLEAR SIGN PROPAGATION @G36XRSV 22261000
         STH   RWRK6,TRACTCIN           TRACE LNENT CONTENTS.  @SA70180 22262000
         L     RWRK7,AVTRNMPT           TERMINAL NAME TABLE ADDRSA70180 22264000
         USING IEDQTNTD,RWRK7           TEMP BASE FOR TNT.     @SA70180 22266000
         LA    RWRK1,TNTFIRST           ADDR OF FIRST ENTRY.   @SA70180 22268056
         SR    RWRKB,RWRKB              CLEAR REG FOR WORK.    @SA70180 22270000
         IC    RWRKB,TNTENLEN           LTH OF EACH ENTRY.     @SA70180 22272000
         LA    RWRK7,THREE(,RWRKB)      TERM NAME + TERM CTL.  @SA70180 22274000
         BCTR  RWRK6,RWRK0              DECREMENT INDEX        @SA70180 22276000
         MR    RWRK6,RWRK6              COMPUTE DISPLACEMENT TO@SA70180 22278000
         AR    RWRK7,RWRK1              ENTRY,ADDRESS OF ENTRY.@SA70180 22280000
         BCTR  RWRKB,RWRK0              DECREMENT SIZE FOR EX. @SA70180 22282000
         EX    RWRKB,MOVENAME           MOVE TERM NAME TO SLOT.@SA70180 22284000
TNAMEXIT EQU   *                                               @SA70180 22286056
         TM    LTPCI,LTP370X            370X ENTRY             @Y17XASA 22286600
         BO    NCP370X1                 YES                    @Y17XASA 22287200
         MVC   TRACINV,LCBINVPT         TRACE LCBINVPT         @Y17XASK 22288000
NCP370X1 EQU   *                                               @Y17XASA 22289000
         BAL   RBALR,WRAPTEST           CHECK FOR END OF TBL.  @SA70180 22290000
         DROP  RWRKF                                           @SA70180 22293000
         DROP  RWRK7                                           @SA70180 22296000
         EJECT                                                          22300022
*****************************************************************S21903 22400022
*                                                                S21903 22500022
* THIS SECTION OF CODE DETERMINES THE APPROPRIATE CCW AT WHICH   S21903 22600022
* TO BEGIN THE TRACE. ON A PCI INTERRUPT THE CCW ADDRESS SAVED   S21903 22700022
* FROM THE LAST INTERRUPT IS USED. ON ANY INTERRUPT WITH ERP IN  S21903 22800022
* CONTROL THE START CCW ADDRESS IS TAKEN FROM LCBSTART.          S21903 22900022
*                                                                S21903 23000022
*****************************************************************S21903 23100022
         SPACE                                                          23200022
         TM    LTPCI,LTLATTN            ATTENTION ENTRY        @Y17XASA 23210000
         BZ    NOTATTN                  NO                     @OZ26897 23220000
         NI    LTPCI,AVTEFF-LTLATTN     RESET ENTRY            @OZ26897 23230000
         B     MOVETRAC                 ATTENTION ENTRY        @OZ26897 23240000
NOTATTN  EQU   *                                               @OZ26897 23250000
         TM    LTPCI,LTPCIN             WAS LAST INTERRUPT PCI   S21903 23300022
         BNO   USESTART                 BR NO TO TEST RESTART    S21903 23400022
         L     RCCW,LTPCI               LAST PCI INTERRUPT       S21903 23500000
         LA    RCCW,ZERO(,RCCW)         CLEAR HIGH ORDER BYTE    X02004 23510000
         CLI   CCWOPCDE,ZERO            ZERO CCW OP-CODE MEANS   X02004 23520005
*                                       VIRTUAL DATA ADDRESS     X02004 23530000
         L     RWRK6,CCWADDR-ONE        GET DATA ADDRESS         X02004 23540000
         BE    CCWSTART                 BR YES,VIRTUAL DATA ADDR X02004 23550000
         B     CONVERTX                 BR CCW FOUND           @Y17XASA 23600000
USESTART EQU   *                                                 S21903 23800022
         L     RCCW,LCBSTART-ONE        CHAN PROG START CCW      S21903 23900000
         LA    RCCW,ZERO(,RCCW)         CLEAR HIGH ORDER BYTE    S21903 23970000
CONVERTX EQU   *                                               @Y17XASA 24040000
         BAL   RBALR,CONVERT            CONVERT TO VIRTUAL       X02004 24130000
CCWSTART EQU   *                                                 X02004 24160005
         SR    RGTIC,RGTIC              CLEAR TIC INDICATOR      S21903 24200022
         SR    RWRK7,RWRK7              ZERO REG 7             @OY18045 24250000
         CLI   LCBCCW4,CCWPOLL          AUTOPOLL                 S21903 24400000
         BNE   RESTART                  BR NO NOT AUTOPOLL       S21903 24500022
         OI    LTPCI,LTAUTOPL           SET AUTOPOLL INDICATOR   S21903 24600022
         B     RESTART                  START TRACING          @OY18045 24650000
         EJECT                                                          24700022
*****************************************************************S21903 24800022
*                                                                S21903 24900022
* THIS SECTION OF CODE IS ENTERED FOR EACH TRACE ENTRY TO BE     S21903 25000022
* CONSTRUCTED. THE FORMAT OF EACH ENTRY IS DESCRIBED BY THE      S21903 25100022
* TRACELN1 DSECT. FOR CCWS WITH LESS THAN TWENTY BYTES OF DATA,  S21903 25200022
* ALL DATA IS TRACED. FOR CCWS WITH MORE THAN TWENTY BYTES OF    S21903 25300022
* DATA ONLY THE FIRST EIGHT AND LAST TEN BYTES ARE TRACED, USING S21903 25400022
* THE TRACELN1 AND TRACELN2 DSECTS AND TWO TRACE ENTRIES.        S21903 25500022
*                                                                S21903 25600022
*****************************************************************S21903 25700022
         SPACE                                                          25800022
TRACEALL EQU   *                                                 S21903 26700022
         CLM   RCCW,SEVEN,LCBCSW        FIRST CCW THE INTRPT   @Y17XASA 26800000
         BE    PREPEXIT                 BR YES , END OF TRACE  @Y17XASA 26900000
RESTART  EQU   *                                               @OY18045 26950000
         USING TRACELN1,RWRKF                                    S21903 27100000
         ST    RCCW,TRACCWAD            TRACE CCW ADDRESS        S21903 27200000
         MVI   TRACCWAD,LINEID          INDICATE LINE ENTRY      S21903 27300022
         ST    RWRK6,TRACCW             TRACE DATA ADDRESS       X02004 27400000
         MVC   TRACCW(ONE),CCWOPCDE     TRACE CCW OP CODE        X02004 27410005
         CLI   CCWOPCDE,ZERO            ZERO OP CODE             X02004 27420005
         BNE   GOODOP                   BR NO, GOOD CCW OP CODE  X02004 27430005
         MVI   TRACCW,CCWREAD           ASSUME READ CCW          X02004 27440005
         TM    LCBSTAT1,LCBSENDN        SENDING                  X02004 27450005
         BNO   GOODOP                   BR NO, READ IS RIGHT     X02004 27460005
         MVI   TRACCW,CCWWRITE          SET WRITE CCW            X02004 27470005
GOODOP   EQU   *                                                 X02004 27480005
         MVC   TRACCW+FOUR(FOUR),CCWFLAGS TRACE LAST HALF CCW    X02004 27490005
         TM    LTPCI,LTP370X            370X ENTRY             @Y17XASA 27493000
         BO    NCP370X2                 YES                    @Y17XASA 27496000
         BAL   RBALR,TRACOPCD           TRACE TP OP CODE         S21903 27500000
NCP370X2 EQU   *                                               @Y17XASA 27600000
         TM    TRACCW,TIC               TIC CCW                  X02004 27800005
         BZ    TICCCW                   BR YES HANDLE UNIQUELY   S21903 27900022
         TM    TRACCW,CCWWRITE          WRITE CCW                X02004 28000005
         BO    NOAUTOPL                 BR YES TO TRACE DATA     S21903 28100022
         TM    CCWFLAGS,CCWSKIP         SKIP DATA                S21903 28200022
         BO    DATADONE                 NO DATA FOR SKIP.      @SA70179 28300056
         CLI   TRACCW,CCWREAD           READ CCW                 X02004 28400005
         BNE   NOAUTOPL                 BR NO NO AUTOPOLL        S21903 28500022
         NI    LTPCI,AVTEFF-LTAUTOPL    RESET AUTOPOLL INDICATOR S21903 28600000
NOAUTOPL EQU   *                                                 S21903 28700022
         CLI   TRACCW,CCWNOP            NO-OP CCW                Y00487 28730054
         BNE   NOTNOP                   NO NOT NOP             @Y17XASA 28760000
         TM    LTPCI,LTP370X            370X ENTRY             @Y17XASA 28763000
         BZ    DATADONE                 NO                     @Y17XASA 28766000
         SH    RCCW,CCWBKUP             SUBTRACT 8             @Y17XASA 28769000
         CLI   CCWOPCDE,CCWBRK          PREVIOUS CCW WR-BRK    @Y17XASA 28772000
         LA    RCCW,CCWLEN(,RCCW)       BUMP TO NEXT CCW       @Y17XASA 28775000
         BNE   DATADONE                 NO                     @Y17XASA 28778000
         BAL   RBALR,WRAPTEST           CHECK FOR END OF TRACE @Y17XASA 28781000
         LA    RCCW,CCWLEN(,RCCW)       BUMP TO NEXT CCW       @Y17XASA 28784000
         CLM   RCCW,SEVEN,LCBCSW        INTERRUPTED CCW        @Y17XASA 28787000
         BNE   TICEND                   NO                     @Y17XASA 28790000
         B     SKIPPCI                  YES                    @Y17XASA 28793000
NOTNOP   EQU   *                                               @Y17XASA 28796000
         LH    RWRK1,CCWCOUNT           GET DATA COUNT           S21903 28800022
         N     RWRK1,AVTCLRHI           CLEAR HIGH HALF WORD     S21903 28900022
         TM    LTPCI,LTP370X            370X ENTRY             @Y17XASA 28904000
         BZ    NOT370X2                 NO                     @Y17XASA 28908000
         LR    RWRK9,RWRK1              SAVE COUNT             @Y17XASA 28920000
         LH    RWRK1,LCBTTCIN           GET TNT INDEX          @Y17XASA 28924000
         LR    RWRKB,RWRKF              SAVE REG 15            @Y17XASA 28928000
         L     RNTRY,AVTRNMPT           ADDRESS OF TNT ROUTINE @Y17XASA 28932000
         BALR  RBALR,RNTRY              BALR TO TNT ROUTINE    @Y17XASA 28936000
         LR    RWRKF,RWRKB              RESTORE REG 15         @Y17XASA 28940000
         SH    RWRK1,TRMPREFX           SUBTRACT PREFIX SIZE   @Y17XASA 28944000
         USING IEDNTRM,RWRK1            TERMINAL ENTRY ADDRES  @Y17XASA 28948000
         TM    TRMNCP,TRMIPLDM          IPL/DUMP OF 370X       @Y17XASA 28952000
         DROP  RWRK1                    DROP ADDRESSIBILITY    @Y17XASA 28956000
         LR    RWRK1,RWRK9              RESTORE COUNT          @Y17XASA 28960000
         BO    NOT370X2                 YES , TRACE NORMAL     @Y17XASA 28964000
         CR    RCCW,RLCB                IS CCW BEFORE LCB?     @YM04622 28964300
         BL    NOTINLCB                 YES-TRACE DATA         @YM04622 28964600
         SLR   RWRK9,RWRK9              CLEAR REGISTER         @YM04622 28964900
         IC    RWRK9,DCBEIOBX           GET LCB SIZE           @YM04622 28965200
         LA    RWRK9,ZERO(RWRK9,RLCB)   GET END OF LCB ADDRESS @YM04622 28965500
         CR    RCCW,RWRK9               IS CCW AFTER LCB?      @YM04622 28965800
         BL    DATADONE                 NO-DON'T TRACE DATA    @YM04622 28966100
NOTINLCB EQU   *                        THERE IS DATA TO TRACE @YM04622 28966400
         CLI   TRACCW,CCWREAD           READ CCW               @Y17XASA 28966700
         BNE   NOT370X2                 NO                     @Y17XASA 28967000
         LTR   RWRK7,RWRK7              START OF PIU           @Y17XASA 28968000
         BNZ   NCP370X3                 NO                     @Y17XASA 28972000
         USING IEDQPRF,RCCW             BUFFER PREFIX ADDRESS  @Y17XASA 28976000
         IC    RWRK7,PRFPIUO            GET PIU OFFSET         @Y17XASA 28980000
         LA    RWRK6,ZERO(RWRK6,RWRK7)  ADD TO DATA ADDRESS    @Y17XASA 28984000
         SR    RWRK1,RWRK7              SUBTRACT FROM COUNT    @Y17XASA 28988000
         USING IEDTH,RWRK6              TH ADDRESSIBILITY      @Y17XASA 28992000
         LH    RWRKB,TTHDCF             GET DCF                @Y17XASA 28996000
         DROP  RWRK6                                           @Y17XASA 29000000
         USING IEDQCCW,RCCW             CCW DSECT ADDRESS      @Y17XASA 29004000
         LA    RWRK7,TTHLEN(RWRK7,RWRKB) ADD TH PAD & DCF      @Y17XASA 29008000
         LH    RWRK9,AVTKEYLE           SIZE OF UNIT           @Y17XASA 29012000
         LR    RWRK0,RWRK6              SAVE DATA ADDRESS      @Y17XASA 29016000
         SR    RWRK6,RWRK6              CLEAR REG 6            @Y17XASA 29020000
         DR    RWRK6,RWRK9              COMPUTE # OF UNITS     @Y17XASA 29024000
         STH   RWRK6,LTPIURES           SAVE RESIDUAL COUNT    @Y17XASA 29028000
         LTR   RWRK6,RWRK6              REMAINDER EQ ZERO      @Y17XASA 29032000
         LR    RWRK6,RWRK0              RESTORE DATA ADDRESS   @Y17XASA 29036000
         BZ    NCP370X3                 YES                    @Y17XASA 29040000
         LA    RWRK7,ONE(,RWRK7)        ADD ONE TO QUOTIENT    @Y17XASA 29044000
NCP370X3 EQU   *                                               @Y17XASA 29048000
         BCT   RWRK7,NOT370X2           DEC REG 7 IF NE 0 BR   @Y17XASA 29052000
         LA    RWRK0,CCWLEN(,RCCW)      NEXT CCW               @Y17XASA 29056000
         CLM   RWRK0,SEVEN,LCBCSW       CURRENT EQUAL FAILING  @Y17XASA 29060000
         BE    SUBRESCT                 YES , SUBT RESIDUAL    @Y17XASA 29064000
         LH    RWRK1,LTPIURES           GET PIU RESIDUAL COUNT @Y17XASA 29068000
         B     ALLDATA                  BRANCH TO ALLDATA      @Y17XASA 29072000
NOT370X2 EQU   *                                               @Y17XASA 29076000
         TM    LCBCSWUS,LCBUSCE+LCBUSDE CHANNEL/DEVICE END       S21903 29100000
         BZ    ALLDATA                  BR NO TRACE ALL DATA     S21903 29200022
         LA    RWRK0,CCWLEN(,RCCW)      NEXT CCW                 S21903 29300000
         CLM   RWRK0,SEVEN,LCBCSW       CURRENT EQUAL FAILING  @Y17XASA 29600000
         BNE   ALLDATA                  BR NO USE CCW COUNT      S21903 29700022
SUBRESCT EQU   *                                               @Y17XASA 29750000
         SH    RWRK1,LCBCSWRC           SUBTRACT RESIDUAL COUNT  S21903 29800000
         EJECT                                                          29900022
*****************************************************************S21903 30000022
*                                                                S21903 30100022
* THIS SECTION OF CODE WILL TRACE FOUR OR LESS BYTES OF DATA IN  S21903 30200022
* SAME TRACE ENTRY. FOR CCWS WITH MORE THAN FOUR BYTES OF DATA,  S21903 30300022
* A SECOND ENTRY IS USED ALONG WITH THE FIRST TO TRACE TWENTY    S21903 30400022
* BYTES OF DATA. IF THERE ARE MORE THAN TWENTY BYTES OF DATA,    S21903 30500022
* ONLY THE FIRST EIGHT AND LAST TEN ARE TRACED.                  S21903 30600022
*                                                                S21903 30700022
*****************************************************************S21903 30800022
         SPACE                                                          30900022
ALLDATA  EQU   *                                                 S21903 31000022
         TM    CCWFLAGS,CCWIDA          TEST FOR INDIRECT ADDR @OX12574 31010000
         BNO   SKIPCK                   NO, SKIP CONVERT CODE  @OX12574 31020000
         LR    RWRK9,RWRK1              SAVE DATA COUNT        @OX12574 31030000
         L     RWRK1,ZERO(RWRK6)        GET REAL IDA           @OX12574 31040000
         BAL   RBALR,CONVERT2           CONVERT DATA ADDR      @OX12574 31050000
         LR    RWRK1,RWRK9              RESTORE DATA COUNT     @OX12574 31060000
         STCM  RWRK6,7,TRACCW+1         TRACE VIRTUAL ADDRESS  @OX12574 31070000
SKIPCK   EQU   *                        DONE WITH INDIRECT     @OX12574 31080000
         CH    RWRK1,AVTHA4             FIVE OR MORE DATA BYTES  S21903 31100000
         BH    BOTHENDS                 BR YES TRACE FIRST/LAST  S21903 31200022
         BCTR  RWRK1,RWRK0              DECREMENT FOR EXECUTE    S21903 31300000
         LTR   RWRK1,RWRK1              ANY DATA TO BE MOVED     S21903 31400022
         BM    DATADONE                 BR NO TO GET NEXT CCW    S21903 31500022
         EX    RWRK1,MVCDATA1           VARIABLE MOVE OF DATA    S21903 31600022
         B     DATADONE                 BR TO GET NEXT CCW       S21903 31700022
BOTHENDS EQU   *                                                 S21903 32100022
         MVI   TRACCWAD,AVTEFF          INDICATE DOUBLE ENTRY    S21903 32200000
         MVC   TRACDAT1,ZERO(RWRK6)     TRACE FIRST FOUR BYTES   S21903 32300000
         BAL   RBALR,WRAPTEST           NEXT TRACE ENTRY         S21903 32400000
         DROP  RWRKF                                             S21903 32500000
         USING TRACELN2,RWRKF                                    S21903 32600000
         SH    RWRK1,AVTHA4             FOUR BYTES HAVE ALREADY  S21903 33100022
*                                         BEEN TRACED            S21903 33200022
         CH    RWRK1,AVTHA16            SIXTEEN OR LESS DATA     S21903 33300000
*                                         BYTES REMAINING        S21903 33400022
         BH    TWOENDS                  BR NO TRACE TWO ENDS     S21903 33500022
         BCTR  RWRK1,RWRK0              DECREMENT FOR EXECUTE    S21903 33600000
         EX    RWRK1,MVCDATA2           TRACE ALL DATA           S21903 33700022
         B     DATADONE                 FETCH NEXT CCW           S21903 33800022
TWOENDS  EQU   *                                                 S21903 33900022
         TM    LTPCI,LTP370X            370X ENTRY             @Y17XASA 33910000
         BZ    NOT370X3                 NO                     @Y17XASA 33920000
         MVC   TRACEDAT(TRACSIZE),FOUR(RWRK6) TRACE PIU        @Y17XASA 33930000
         B     DATADONE                                        @Y17XASA 33940000
NOT370X3 EQU   *                                               @Y17XASA 33950000
         MVC   TRACEDAT,FOUR(RWRK6)     TRACE FIRST EIGHT BYTES  S21903 34000000
         LA    RWRK6,FOUR(RWRK1,RWRK6)  POINT TO END OF DATA     S21903 34100000
         SH    RWRK6,DATABKUP           BACK UP TEN BYTES        S21903 34200000
         MVC   TRACEEND,ZERO(RWRK6)     TRACE LAST TEN DATA BYTESS21903 34300000
         DROP  RWRKF                                             S21903 34400000
         USING TRACELN1,RWRKF                                    S21903 34500000
DATADONE EQU   *                                                 S21903 34600022
         BAL   RBALR,WRAPTEST           CHECK FOR END OF TRACE   S21903 34700000
         EJECT                                                          34800022
*****************************************************************S21903 34900022
*                                                                S21903 35000022
* THIS SECTION OF CODE DETERMINES IF THERE IS ANOTHER CCW TO     S21903 35100022
* BE TRACED. IF SO CONTROL IS PASSED TO THE LABEL 'TRACEALL'     S21903 35200000
* OTHERWISE CONTROL IS PASSED TO THE LABEL 'PREPEXIT'.           S21903 35300022
*                                                                S21903 35400022
*****************************************************************S21903 35500022
         SPACE                                                          35600022
         TM    CCWFLAGS,CCWCD+CCWCC     COMMAND/DATA CHAINING    S21903 35700022
         LA    RCCW,CCWLEN(,RCCW)       POINT TO NEXT CCW        S21903 35800000
         BNZ   COMPEND                  BR YES TO GET NEXT CCW   S21903 35900022
         TM    LTPCI,LTAUTOPL           AUTOPOLL                 S21903 36000022
         BNO   PREPEXIT                 BR NO PREPARE TO RETURN  S21903 36100022
COMPEND  EQU   *                                                 S21903 36200022
         CLM   RCCW,SEVEN,LCBCSW        CHANNEL PROGRAM END    @Y17XASA 36500000
         BE    PREPEXIT                 BR YES PREPARE TO RETURN S21903 36600022
TICEND   EQU   *                                               @YA07104 36620058
         BAL   RBALR,CONVERT            CONVERT TO VIRTUAL       X02004 36650000
         B     TRACEALL                 BR TO CONTINUE TRACE   @Y17XASA 36720000
         EJECT                                                          36800022
*****************************************************************S21903 36900022
*                                                                S21903 37000022
* THIS SECTION OF CODE HANDLES SPECIAL PROCESSING FOR TIC CCWS.  S21903 37100022
*                                                                S21903 37200022
*****************************************************************S21903 37300022
         SPACE                                                          37400022
TICCCW   EQU   *                                                 S21903 37500022
         TM    CCWOPCDE,CCWREAL         TIC TO REAL ADDRESS      X02004 37600000
         L     RWRK1,CCWADDR-ONE        GET TIC TO ADDRESS       X02004 37610005
         BNO   GOODAD                   BR NO, ALREADY VIRTUAL   X02004 37620005
         BAL   RBALR,CONVERT1           CONVERT TO VIRTUAL       X02004 37630000
         STCM  RWRK1,SEVEN,TRACCW+ONE   TRACE TIC TO CCW ADDRESS X02004 37640000
GOODAD   EQU   *                                                 X02004 37650005
         LA    RWRK1,ZERO(,RWRK1)                                S21903 37700000
         LA    RWRK6,CCWLEN(,RWRK1)     NEXT CCW                 S21903 37800000
         CR    RGTIC,RCCW               STATUS MODIFY CCW LOOP   S21903 37900000
         LR    RGTIC,RCCW               SAVE TIC CCW ADDRESS     S21903 38000000
         BE    NEXTTIC                  BR YES STATUS MODIFIER   S21903 38100022
         CR    RCCW,RWRK6               TIC TO PREVIOUS CCW      S21903 38200000
         BE    NEXTTIC                  BR YES GET NEXT CCW      S21903 38300022
         TM    CCWADDR+TWO,INVTIC       INVALID TIC ADDRESS      S21903 38400022
         BNZ   WRAPEND                  BR YES END OF CHAN PROG  S21903 38500022
         TM    LTPCI,LTFIRST            FIRST TIME SWITCH SET  @Y17XASA 38503000
         BZ    GOODTIC                  NO                     @Y17XASA 38506000
         TM    LCBSTAT1,LCBRECVN        LINE RECEIVING         @Y17XASA 38509000
         BO    LINERECV                 YES                    @Y17XASA 38512000
         TM    LCBSTAT1,LCBSENDN        LINE SENDING           @Y17XASA 38515000
         BZ    NOPCI                    NO                     @Y17XASA 38518000
         TM    DCBPCI,DCBPCIA2+DCBPCIR2 PCI=( ,A) OR ( ,R)     @Y17XASA 38521000
         BZ    NOPCI                    NO                     @Y17XASA 38524000
         B     CHECKTIC                 YES                    @Y17XASA 38527000
LINERECV EQU   *                                               @Y17XASA 38530000
         TM    DCBPCI,DCBPCIA1+DCBPCIR1 PCI=(A, ) OR (R, )     @Y17XASA 38533000
         BZ    NOPCI                    NO                     @Y17XASA 38536000
CHECKTIC EQU   *                                               @Y17XASA 38539000
         CR    RWRK1,RLCB               TIC BELOW LCB          @Y17XASA 38542000
         BL    GETLSPCI                 YES , GET LCBLSPCI     @Y17XASA 38545000
         SR    RWRKB,RWRKB              CLEAR REG 11           @Y17XASA 38548000
         IC    RWRKB,DCBEIOBX           SIZE OF LCB            @Y17XASA 38551000
         LA    RWRKB,ZERO(RWRKB,RLCB)   END OF LCB             @Y17XASA 38554000
         CR    RWRK1,RWRKB              TIC BEYOND LCB         @Y17XASA 38557000
         BL    GOODTIC                  NO                     @Y17XASA 38560000
GETLSPCI EQU   *                                               @Y17XASA 38563000
         ICM   RCCW,SEVEN,LCBLSPCI      GET LCBLSPCI AS NEXT   @Y17XASA 38566000
         NI    LTPCI,AVTEFF-LTFIRST     RESET FIRST TIME SW    @Y17XASA 38569000
         B     WRAPIT                   BRANCH TO USE LCBLSPCI @Y17XASA 38572000
NOPCI    EQU   *                                                        38575000
         NI    LTPCI,AVTEFF-LTFIRST     RESET FIRST TIME SW    @Y17XASA 38578000
GOODTIC  EQU   *                                               @Y17XASA 38581000
         TM    LTPCI,LTAUTOPL           AUTOPOLL CHANNEL PROG    S21903 38600022
         BO    NEXTTIC                  BR YES TRACE EVERYTHING  S21903 38700022
         LR    RCCW,RWRK1               TIC TO CCW               S21903 38800000
         B     WRAPIT                   BR TO CHECK END OF TABLE S21903 38900022
NEXTTIC  EQU   *                                                 S21903 39000022
         LA    RCCW,CCWLEN(,RCCW)       GET NEXT CCW             S21903 39100000
WRAPIT   EQU   *                                                 S21903 39200022
         BAL   RBALR,WRAPTEST           CHECK FOR END OF TABLE   S21903 39300000
         B     TICEND                   CHECK NEXT CCW         @YA07104 39400058
         EJECT                                                          39500022
*****************************************************************S21903 39600022
*                                                                S21903 39700022
* THIS SECTION OF CODE PERFORMS TERMINATION PROCESSING.          S21903 39800022
*                                                                S21903 39900022
*****************************************************************S21903 40000022
         SPACE                                                          40100022
ENDTABLE EQU   *                                               @G36XRSV 40110000
         CLI   ZERO(RNTRY),AVTEFF       IS LAST ENTRY HALF     @G36XRSV 40120000
*                                       OF X'FF' ENTRY?        @G36XRSV 40130000
         BNE   PREPEXIT                 NO, PREPARE TO EXIT    @G36XRSV 40140000
         MVI   ZERO(RNTRY),LINEID       NOT ENOUGH ROOM IN TBL @G36XRSV 40150000
*                                       FOR X'FF' ENTRY, MAKE  @G36XRSV 40160000
*                                       IT X'F0'               @G36XRSV 40170000
         B     PREPEXIT                 PREPARE TO EXIT        @G36XRSV 40180000
         SPACE 1                                               @G36XRSV 40190000
SETRET   EQU   *                                                 S21903 40200022
         NI    LTPCI,AVTEFF-LTERPPCI    RESET SKIP INDICATOR   @Y17XASA 40300000
         B     RETURN                   AND RETURN TO CALLER     S21903 40400022
WRAPEND  EQU   *                                                 S21903 40500022
         BAL   RBALR,WRAPTEST           CHECK FOR END OF TABLE   S21903 40600000
PREPEXIT EQU   *                                                 S21903 40700022
         TM    LCBCSWCS,LCBCSPCI        PCI INTERRUPT            S21903 41100000
         BNO   SKIPPCI                  BR NO SKIP INDICATOR     S21903 41200022
         OI    LTPCI,LTPCIN             SET PCI INDICATOR        S21903 41300022
         STCM  RCCW,SEVEN,LTPCIADD      SAVE LAST PCI ADDRESS  @Y17XASA 41350000
SKIPPCI  EQU   *                                                 S21903 41400022
         TM    LCBCSWUS,LCBUSCE+LCBUSDE CHANNEL/DEVICE END       S21903 41500000
         BZ    MOVETRAC                 BR NO LEAVE PCI SET    @G36XRSV 41520000
         NI    LTPCI,AVTEFF-(LTPCIN+LTAUTOPL+LTFIRST)            S21903 41540000
*                                       RESET PCI,AUTOPOLL,    @Y17XASA 41560000
*                                       AND FIRST TIME SWITCH  @Y17XASA 41580000
MOVETRAC DS    0H                       MOVE TRACE TO TABLE    @G36XRSV 41581000
         L     RWRKB,AVTRACE            ADDRESS OF TRACE CTL   @G36XRSV 41582000
         CLM   RBASE,HIBYTE,AVTHFF      ENTRY FROM PCI         @G36XRSV 41583000
         BE    NOTPASMD                 YES, BRANCH            @G36XRSV 41583500
*                                                              @G36XRSV 41584000
*        MOVE DATA FROM LINEEND ERP TABLE TO TRACE TABLE       @G36XRSV 41585000
*                                                              @G36XRSV 41586000
         OC    ZERO(TRACSIZE,RNTRY),ZERO(RNTRY) LAST ENTRY USED@G36XRSV 41587000
         BZ    NOTUSED                  NO, BRANCH             @G36XRSV 41587500
         LA    RNTRY,TRACSIZE(,RNTRY)   POINT TO TBL END       @G36XRSV 41588000
NOTUSED  EQU   *                                               @G36XRSV 41589000
         LA    RWRK0,TABLE2             GET TABLE ADDRESS      @G36XRSV 41590000
         SR    RNTRY,RWRK0              GET SIZE OF DATA       @G36XRSV 41591000
         STM   RNTRY,RWRK0,SAVESIZE     SAVE TABLE PTR & SIZE  @OZ30604 41591586
         SPACE 1                                               @G36XRSV 41592000
TRYAGAIN EQU   *                                               @G36XRSV 41592100
         L     RWRK6,CVTPTR             GET CVT ADDRESS        @OZ28809 41592886
         L     RWRK6,AVTCVTPT(,RWRK6)   GET TCX                @OZ28809 41593286
         USING IEDQTCX,RWRK6                                   @OZ28809 41593686
RECHPCI  EQU   *                                               @OZ28809 41594086
         TM    TCXDSAVE,PCIOP           PCI RUNNING            @OZ28809 41594486
         BO    RECHPCI                  BRANCH YES             @OZ28809 41594886
         DROP  RWRK6                                           @OZ28809 41595286
         LM    RWRK6,RWRK9,TRACURR-TRACNTRL(RWRKB) GET TRACE   @OZ30604 41595686
*                                       TABLE CONTROL INFO     @OZ30604 41596086
         ST    RWRK6,SAVECURR           SAVE CURRENT ENTRY     @OZ30604 41596486
         ST    RWRK6,NEWCURR            SAVE CURRENT ENTRY     @OZ30604 41596886
         LM    RNTRY,RWRK0,SAVESIZE     GET TABLE PTR & SIZE   @OZ30604 41597286
         LA    RWRK8,TRACSIZE(RWRK8)    TRUE END OF TABLE      @OZ30604 41597686
         NI    TRACFLAG-TRACNTRL(RWRKB),X'FF'-TRCNFIT-TRACMIDN-TRACENDN 41598086
*                                       RESET CONTROL FLAGS    @OZ30604 41598486
         SR    RWRK1,RWRK1              CLEAR REGISTER TO ZERO @OZ30604 41598886
         CR    RWRK6,RWRK9              IS THIS MID-POINT      @OZ30604 41599286
         BL    BEFRMID                  NO, BEFORE MID-POINT   @OZ30604 41599686
         BH    AFTRMID                  NO, AFTER MID-POINT    @OZ30604 41600086
         LA    RWRK6,TRACSIZE(RWRK6)    BUMP PAST HEADER       @OZ30604 41600486
AFTRMID  EQU   *                                               @OZ30604 41600886
         TM    TRACFLAG-TRACNTRL(RWRKB),TRACENDN PAST END OF   @OZ30604 41601286
*                                       TABLE                  @OZ30604 41601686
         BNO   AFTRMIDA                 NO, BRANCH             @OZ30604 41602086
         LA    RWRK1,1(RWRK1)           COUNT OF HALF TABLES   @OZ30604 41602486
*                                       THAT WILL NOT BE       @OZ30604 41602886
*                                       WRITTEN BY COMWRITE    @OZ30604 41603286
         NI    TRACFLAG-TRACNTRL(RWRKB),X'FF'-TRACENDN RESET   @OZ30604 41603686
*                                       END OF TABLE FLAG      @OZ30604 41604086
AFTRMIDA EQU   *                                               @OZ30604 41604486
         AR    RWRK6,RNTRY              ADD LENGTH TO CURRENT  @OZ30604 41604886
         CR    RWRK6,RWRK8              WILL DATA FIT IN       @OZ30604 41605286
*                                       LAST HALF OF TABLE     @OZ30604 41605686
         LR    RWRK2,RWRK6              SET NEW CURRENT        @OZ30604 41606086
         BE    WILLFT2                  YES, WILL FIT EXACTLY  @OZ30604 41606486
         BL    WILLFT2A                 YES, FIT WITH REMNDR   @OZ30604 41606886
         SR    RWRK6,RWRK8              AMOUNT REMAINING       @OZ30604 41607286
         LR    RWRK8,RNTRY              GET TOTAL AMOUNT       @OZ30604 41607686
         SR    RWRK8,RWRK6              AMOUNT FOR LAST HALF   @OZ30604 41608086
         TM    TRACFLAG-TRACNTRL(RWRKB),TRCNFIT IS OVERFLOW SET@OZ30604 41608486
         BNO   NOVRFLWB                 NO, BRANCH             @OZ30604 41608886
         AR    RWRK0,RWRK9              UPDATE TABLE POINTER   @OZ30604 41609286
         LR    RWRK9,RWRK2              GET CURRENT ENTRY      @OZ30604 41609686
         SR    RWRK9,RNTRY              ADJUST CURRENT ENTRY   @OZ30604 41610086
         ST    RWRK9,NEWCURR            SAVE MOVE TO ADDRESS   @OZ30604 41610486
NOVRFLWB EQU   *                                               @OZ30604 41610886
         LR    RNTRY,RWRK6              SAVE AMOUNT REMAINING  @OZ30604 41611286
         ICM   RWRK6,7,TRACSTRT-TRACNTRL+ONE(RWRKB) POINTER TO @OZ30604 41611686
*                                       START OF TABLE         @OZ30604 41612086
         LA    RWRK6,TRACSIZE(RWRK6)    SKIP HEADER ENTRY      @OZ30604 41612486
         ICM   RWRK9,7,TRACMID-TRACNTRL+ONE(RWRKB) POINTER TO  @OZ30604 41612886
*                                       MIDDLE ENTRY           @OZ30604 41613286
         OI    TRACFLAG-TRACNTRL(RWRKB),TRCNFIT+TRACENDN SET   @OZ30604 41613686
*                                       OVERFLOW AND END OF    @OZ30604 41614086
*                                       TABLE                  @OZ30604 41614486
BEFRMID  EQU   *                                               @OZ30604 41614886
         TM    TRACFLAG-TRACNTRL(RWRKB),TRACMIDN PAST MIDDLE   @OZ30604 41615286
*                                       OF TABLE               @OZ30604 41615686
         BNO   BEFRMIDA                 NO, BRANCH             @OZ30604 41616086
         LA    RWRK1,1(RWRK1)           COUNT OF HALF TABLES   @OZ30604 41616486
*                                       THAT WILL NOT BE       @OZ30604 41616886
*                                       WRITTEN BY COMWRITE    @OZ30604 41617286
         NI    TRACFLAG-TRACNTRL(RWRKB),X'FF'-TRACMIDN RESET   @OZ30604 41617686
*                                       MIDDLE OF TABLE FLAG   @OZ30604 41618086
BEFRMIDA EQU   *                                               @OZ30604 41618486
         AR    RWRK6,RNTRY              ADD LENGTH TO CURRENT  @OZ30604 41618886
         CR    RWRK6,RWRK9              WILL DATA FIT IN       @OZ30604 41619286
*                                       FIRST HALF OF TABLE    @OZ30604 41619686
         LR    RWRK2,RWRK6              SET NEW CURRENT        @OZ30604 41620086
         BE    WILLFT1                  YES, WILL FIT EXACTLY  @OZ30604 41620486
         BL    WILLFT1A                 YES, FIT WITH REMNDR   @OZ30604 41620886
         SR    RWRK6,RWRK9              AMOUNT REMAINING       @OZ30604 41621286
         LR    RWRK9,RNTRY              GET TOTAL AMOUNT       @OZ30604 41621686
         SR    RWRK9,RWRK6              AMOUNT FOR FIRST HALF  @OZ30604 41622086
         TM    TRACFLAG-TRACNTRL(RWRKB),TRCNFIT IS OVERFLOW SET@OZ30604 41622486
         BNO   NOVRFLWA                 NO, BRANCH             @OZ30604 41622886
         AR    RWRK0,RWRK8              UPDATE TABLE POINTER   @OZ30604 41623286
         LR    RWRK8,RWRK2              GET CURRENT ENTRY      @OZ30604 41623686
         SR    RWRK8,RNTRY              ADJUST CURRENT ENTRY   @OZ30604 41624086
         ST    RWRK8,NEWCURR            SAVE MOVE TO ADDRESS   @OZ30604 41624486
NOVRFLWA EQU   *                                               @OZ30604 41624886
         LR    RNTRY,RWRK6              SAVE AMOUNT REMAINING  @OZ30604 41625286
         ICM   RWRK6,7,TRACMID-TRACNTRL+ONE(RWRKB) POINTER TO  @OZ30604 41625686
*                                       MIDDLE ENTRY           @OZ30604 41626086
         LA    RWRK6,TRACSIZE(RWRK6)    SKIP HEADER ENTRY      @OZ30604 41626486
         ICM   RWRK8,7,TRACLAST-TRACNTRL+ONE(RWRKB) POINTER TO @OZ30604 41626886
*                                       LAST ENTRY             @OZ30604 41627286
         LA    RWRK8,TRACSIZE(RWRK8)    TRUE END OF TABLE      @OZ30604 41627686
         OI    TRACFLAG-TRACNTRL(RWRKB),TRCNFIT+TRACMIDN SET   @OZ30604 41628086
*                                       OVERFLOW AND MIDDLE OF @OZ30604 41628486
*                                       TABLE FLAGS            @OZ30604 41628886
         B     AFTRMID                                         @OZ30604 41629286
WILLFT1  EQU   *                                               @OZ30604 41629686
         LA    RWRK2,TRACSIZE(RWRK2)    SKIP HEADER ENTRY      @OZ30604 41630086
         OI    TRACFLAG-TRACNTRL(RWRKB),TRACMIDN SET MIDDLE OF @OZ30604 41630486
*                                       TABLE FLAG             @OZ30604 41630886
         TM    TRACFLAG-TRACNTRL(RWRKB),TRACENDN PAST END OF   @OZ30604 41631286
*                                       TABLE                  @OZ30604 41631686
         BNO   WILLFT1A                 NO, BRANCH             @OZ30604 41632086
         LA    RWRK1,1(RWRK1)           COUNT OF HALF TABLES   @OZ30604 41632486
*                                       THAT WILL NOT BE       @OZ30604 41632886
*                                       WRITTEN BY COMWRITE    @OZ30604 41633286
         NI    TRACFLAG-TRACNTRL(RWRKB),X'FF'-TRACENDN RESET   @OZ30604 41633686
*                                       END OF TABLE FLAG      @OZ30604 41634086
WILLFT1A EQU   *                                               @OZ30604 41634486
         L     RWRKA,SAVECURR           GET SAVED CURRENT      @OZ30604 41634886
*                                       ENTRY POINTER          @OZ30604 41635286
         CS    RWRKA,RWRK2,TRACURR-TRACNTRL(RWRKB) ATTEMPT TO  @OZ30604 41635686
*                                       UPDATE CURRENT ENTRY   @OZ30604 41636086
         BNE   TRYAGAIN                 BRANCH IF UNSUCCESSFUL @OZ30604 41636486
         LR    RWRK9,RWRK8              GET DATA COUNT         @OZ30604 41636886
         B     TRCMOVE                  GO MOVE DATA           @OZ30604 41637286
WILLFT2  EQU   *                                               @OZ30604 41637686
         ICM   RWRK2,7,TRACSTRT-TRACNTRL+ONE(RWRKB) POINTER TO @OZ30604 41638086
*                                       START OF TABLE         @OZ30604 41638486
         LA    RWRK2,TRACSIZE(RWRK2)    SKIP HEADER ENTRY      @OZ30604 41638886
         OI    TRACFLAG-TRACNTRL(RWRKB),TRACENDN SET END OF    @OZ30604 41639286
*                                       TABLE FLAG             @OZ30604 41639686
         TM    TRACFLAG-TRACNTRL(RWRKB),TRACMIDN PAST MIDDLE   @OZ30604 41640086
*                                       OF TABLE               @OZ30604 41640486
         BNO   WILLFT2A                 NO, BRANCH             @OZ30604 41640886
         LA    RWRK1,1(RWRK1)           COUNT OF HALF TABLES   @OZ30604 41641286
*                                       THAT WILL NOT BE       @OZ30604 41641686
*                                       WRITTEN BY COMWRITE    @OZ30604 41642086
         NI    TRACFLAG-TRACNTRL(RWRKB),X'FF'-TRACMIDN RESET   @OZ30604 41642486
*                                       MIDDLE OF TABLE FLAG   @OZ30604 41642886
WILLFT2A EQU   *                                               @OZ30604 41643286
         L     RWRKA,SAVECURR           GET SAVE CURRENT ENTRY @OZ30604 41643686
*                                       POINTER                @OZ30604 41644086
         CS    RWRKA,RWRK2,TRACURR-TRACNTRL(RWRKB) ATTEMPT TO  @OZ30604 41644486
*                                       UPDATE CURRENT ENTRY   @OZ30604 41644886
         BNE   TRYAGAIN                 BRANCH IF UNSUCCESSFUL @OZ30604 41645286
TRCMOVE  EQU   *                                               @OZ30604 41645686
         LR    RWRKA,RWRK0              MOVE FROM DATA ADDRESS @OZ30604 41646086
         TM    TRACFLAG-TRACNTRL(RWRKB),TRCNFIT IS OVERFLOW SET@OZ30604 41646486
         BNO   NOVRFLWX                 NO, BRANCH             @OZ30604 41646886
         AR    RWRKA,RWRK9              UPDATE MOVE FROM ADDR  @OZ30604 41647286
NOVRFLWX EQU   *                                               @OZ30604 41647686
         SR    RWRK6,RNTRY              MOVE TO TABLE ADDRESS  @OZ30604 41648086
         LR    RWRK7,RNTRY              SAVE DATA COUNT        @OZ30604 41648486
MOV256C  EQU   *                                               @OZ30604 41648886
         CH    RNTRY,H256               MORE THAN 256 BYTES    @OZ30604 41649286
         BNH   LNGOK3                   NO, BRANCH             @OZ30604 41649686
         LA    RNTRY,TWO56              SET TO MOVE 256 BYTES  @OZ30604 41650086
LNGOK3   EQU   *                                               @OZ30604 41650486
         BCTR  RNTRY,0                  REDUCE FOR EXECUTED MVC@OZ30604 41650886
         EX    RNTRY,MVC                MOVE DATA TO TRACE TBL @OZ30604 41651286
         AH    RWRKA,H256               UPDATE MOVE FROM ADDR  @OZ30604 41651686
         AH    RWRK6,H256               UPDATE MOVE TO ADDRESS @OZ30604 41652086
         SH    RWRK7,H256               DECREMENT DATA COUNT   @OZ30604 41652486
         BNP   CHKNFIT2                 BRANCH IF MOVE COMPLETE@OZ30604 41652886
         LR    RNTRY,RWRK7              SAVE DATA COUNT        @OZ30604 41653286
         B     MOV256C                  GO MOVE MORE DATA      @OZ30604 41653686
CHKNFIT2 EQU   *                                               @OZ30604 41654086
         TM    TRACFLAG-TRACNTRL(RWRKB),TRCNFIT IS OVERFLOW SET@OZ30604 41654486
         BNO   NOTPASMD                 NO, BRANCH             @OZ30604 41654886
         L     RWRK6,NEWCURR            MOVE TO TABLE ADDRESS  @OZ30604 41655286
         LR    RWRKA,RWRK0              MOVE FROM DATA ADDRESS @OZ30604 41655686
         LR    RNTRY,RWRK9              SAVE DATA COUNT        @OZ30604 41656086
MOV256D  EQU   *                                               @OZ30604 41656486
         CH    RNTRY,H256               MORE THAN 256 BYTES    @OZ30604 41656886
         BNH   LNGOK4                   NO, BRANCH             @OZ30604 41657286
         LA    RNTRY,TWO56              SET TO MOVE 256 BYTES  @OZ30604 41657686
LNGOK4   EQU   *                                               @OZ30604 41658086
         BCTR  RNTRY,0                  REDUCE FOR EXECUTED MVC@OZ30604 41658486
         EX    RNTRY,MVC                MOVE DATA TO TRACE TBL @OZ30604 41658886
         AH    RWRKA,H256               UPDATE MOVE FROM ADDR  @OZ30604 41659286
         AH    RWRK6,H256               UPDATE MOVE TO ADDRESS @OZ30604 41659686
         SH    RWRK9,H256               DECREMENT DATA COUNT   @OZ30604 41660086
         BNP   NOTPASMD                 BRANCH IF MOVE COMPLETE@OZ30604 41660486
         LR    RNTRY,RWRK9              SAVE DATA COUNT        @OZ30604 41660886
         B     MOV256D                  GO MOVE MORE DATA      @OZ30604 41661286
NOTPASMD EQU   *                                               @G36XRSV 41663200
         TM    TRACFLAG-TRACNTRL(RWRKB),TRACMIDN+TRACENDN      @G36XRSV 41664000
*                                       END OR MIDDLE OF TABLE @G36XRSV 41664800
         BZ    NODUMP                   NO, BRANCH             @G36XRSV 41665600
*                                                                       41666486
* REGISTER 1 CONTAINS COUNT OF HALF TABLES THAT HAVE BEEN      @OZ30604 41666586
*     LOST IN THIS ROUTINE DUE TO SMALL SIZE OF TRACE TABLE.   @OZ30604 41666686
*     THIS COUNT IS PASSED AS A PARAMETER TO IEDQFE20.         @OZ30604 41666786
*                                                                       41666886
         L     RWRK9,AVTAFE20           GET ADDRESS IEDQFE20   @G36XRSV 41667200
         CLM   RWRK9,HIBYTE,AVTHFF      IS DUMP REQUESTED      @G36XRSV 41668000
         BNE   NODUMP                   NO, BRANCH             @G36XRSV 41668800
         TS    DUMPTS                   DUMP IN USE            @G36XRSV 41669600
         BNZ   NODUMP                   YES, BRANCH            @G36XRSV 41670400
         BALR  RBALR,RWRK9              GO DUMP TABLE          @G36XRSV 41671200
         MVI   DUMPTS,ZERO              CLEAR DUMP IN USE SW   @G36XRSV 41672000
         TM    LCBCSWUS,LCBUSCE+LCBUSDE CE/DE?                 @G36XRSV 41676800
         BZ    RETURN                   N-RETURN TO CALLER     @G36XRSV 41677600
NODUMP   EQU   *                                               @G36XRSV 41678400
         TM    LTPCI,LTERROR            ERROR TRACE THIS LINE  @Y17XASA 41680000
         BZ    RETURN                   NO , EXIT              @Y17XASA 41686000
         TM    LCBCSWUS,LCBUSUC         UNIT CHECK IN CSW      @Y17XASA 41692000
         BO    RETURN                   YES , RETURN           @Y17XASA 41700000
         TM    AVTIOTR,AVTIOTRH         CONTINUE AFTER ERRORS  @Y17XASA 41710000
         BO    RETURN                   YES , RETURN           @Y17XASA 41720000
         NI    LCBSTAT2,AVTEFF-LCBTRACE RESET TRACE THIS LINE  @Y17XASA 41730000
         MVI   LTPCI,LTFREE             FREE OLD ENTRY         @Y17XASA 41740000
RETURN   EQU   *                                                 S21903 41800022
         CLM   RBASE,HIBYTE,FOXFOX      FROM PCI?              @G36XRSV 41830000
         BNE   RTN1                     N-BR                   @G36XRSV 41860000
         LM    RWRK0,RNTRY,Q0SAVE1      RESTORE CALLER'S REGS  @G36XRSV 41900000
         BR    RBALR                    RETURN TO CALLER       @G36XRSV 41920000
RTN1     DS    0H                       NON-PCI INTERRUPTS     @G36XRSV 41940000
         LM    RWRK0,RNTRY,Q0SAVE2      RESTORE CALLER'S REGS  @G36XRSV 41960000
         BR    RBALR                    RETURN TO CALLER         X02004 42000005
         SPACE 1                                               @G36XRSV 42010000
*                                                              @G36XRSV 42020000
*                                       EXECUTED INSTRUCTION   @G36XRSV 42030000
*                                                              @G36XRSV 42040000
MVC      MVC   0(0,RWRK6),0(RWRKA)      EXECUTED MOVE          @OZ30604 42050086
         EJECT                                                          42100022
* E X E C U T E D   S U B R O U T I N E S                        S21903 42200022
         SPACE 1                                               @G36XRSV 42300000
***************************************************************@G36XRSV 42302000
*                                                              @G36XRSV 42304000
* THIS ROUTINE BUMPS TO THE NEXT ENTRY IN THE TRACE TABLE OR   @G36XRSV 42306000
* TEMPORARY TABLE. IF THE TEMPORARY TABLE IS BEING USED, A     @G36XRSV 42308000
* CHECK IS MADE TO SEE IF IT IS FULL. IF SO, A BRANCH IS MADE  @G36XRSV 42310000
* TO THE ENDTABLE ROUTINE. IF THIS IS A PCI INTERRUPT AND THE  @G36XRSV 42312000
* REAL TRACE TABLE IS BEING USED, A CHECK IS MADE FOR THE      @G36XRSV 42314000
* MIDPOINT OR END OF TABLE BEING REACHED AND ,IF SO, A BIT IS  @G36XRSV 42316000
* SET.                                                         @G36XRSV 42318000
*                                                              @G36XRSV 42320000
***************************************************************@G36XRSV 42322000
         SPACE 1                                               @G36XRSV 42324000
WRAPTEST EQU   *                                               @G36XRSV 42326000
         CLM   RBASE,HIBYTE,AVTHFF      ENTRY FROM PCI         @G36XRSV 42328000
         BE    WRPTEST1                 YES, BRANCH            @G36XRSV 42330000
         LA    RWRK9,TBL2LAST           ADDRESS OF LAST ENTRY  @G36XRSV 42332000
         CR    RWRK9,RNTRY              LAST ENTRY IN TABLE    @G36XRSV 42334000
         BE    ENDTABLE                 END OF TABLE           @G36XRSV 42336000
         LA    RNTRY,TRACSIZE(,RNTRY)   GET NEXT ENTRY         @G36XRSV 42338000
         BR    RBALR                    RETURN                 @G36XRSV 42340000
         SPACE 1                                               @G36XRSV 42342000
WRPTEST1 EQU   *                                               @G36XRSV 42344000
         L     RWRK9,AVTRACE            TRACE CONTROL WORDS    @G36XRSV 42346000
         USING TRACNTRL,RWRK9                                  @G36XRSV 42348000
         LA    RNTRY,TRACSIZE(RNTRY)    GET NEXT TRACE ENTRY   @G36XRSV 42350000
         ST    RNTRY,TRACURR            UPDATE TRACE CTL WORDS @G36XRSV 42352000
         CLC   TRACURR+ONE(THREE),TRACMID+ONE MIDPOINT REACHED @G36XRSV 42354000
         BNE   TESTLAST                 BR NO TO TEST FOR LAST @G36XRSV 42356000
         OI    TRACFLAG,TRACMIDN        INDICATE MIDPOINT      @G36XRSV 42358000
         LA    RNTRY,TRACSIZE(RNTRY)    ALLOW FOR PREFIX       @G36XRSV 42360000
         ST    RNTRY,TRACURR            UPDATE TRACE CTL WORKS @G36XRSV 42362000
         B     WRAPEXIT                 RETURN                 @G36XRSV 42364000
TESTLAST EQU   *                                               @G36XRSV 42366000
         CLC   TRACURR+ONE(THREE),TRACLAST+ONE LAST ENTRY      @G36XRSV 42368000
         BNH   WRAPEXIT                 BR NO TO RETURN        @G36XRSV 42370000
SETLAST  EQU   *                                               @G36XRSV 42372000
         OI    TRACFLAG,TRACENDN        INDICATE END OF TABLE  @G36XRSV 42374000
WRAPTRAC EQU   *                                               @G36XRSV 42376000
         L     RNTRY,TRACSTRT           WRAP TRACE TABLE       @G36XRSV 42378000
         LA    RNTRY,TRACSIZE(RNTRY)    ALLOW FOR PREFIX       @G36XRSV 42380000
         ST    RNTRY,TRACURR                                   @G36XRSV 42382000
WRAPEXIT EQU   *                                               @G36XRSV 42384000
         XC    ZERO(TRACSIZE,RNTRY),ZERO(RNTRY) CLEAR ENTRY    @G36XRSV 42386000
         BR    RBALR                    RETURN                 @G36XRSV 42388000
         EJECT                                                          46700022
*****************************************************************S21903 46800022
*                                                                S21903 46900022
* THIS ROUTINE TRACES THE TP OP-CODE FOR ALL NON-TEXT TRANSFER   S21903 47000022
* CCWS WHICH ARE LOCATED IN THE CHANNEL PROGRAM AREA OF THE      S21903 47100022
* LCB (IOB). CONTROL IS THEN RETURNED TO INLINE CODE VIA BRANCH  S21903 47200022
* ON REGISTER 14.                                                S21903 47300000
*                                                                S21903 47400022
*****************************************************************S21903 47500022
         SPACE                                                          47600022
TRACOPCD EQU   *                                                 S21903 47700022
         USING TRACELN1,RWRKF                                  @Y17XASA 47800000
         LA    RWRK1,LCBCPA             POINT TO CHAN PROG AREA  S21903 48100022
         SR    RWRK1,RCCW               CCW IN LCB               S21903 48200000
         BPR   RBALR                    RETURN IF TEXT CCW     @Y17XASA 48260000
         LR    RWRK0,RWRK1              SAVE INDEX               X02004 48320000
         SR    RWRK1,RWRK1                                       X02004 48400005
         IC    RWRK1,DCBEIOBX           LCB SIZE                 X02004 48500005
         LA    RWRK1,ZERO(RWRK1,RLCB)   END OF LCB               X02004 48600000
         SR    RWRK1,RCCW               CCW IN LCB               X02004 48680000
         BNPR  RBALR                    RETURN IF TEXT CCW     @Y17XASA 48760000
         LPR   RWRK1,RWRK0              CCW OFFSET INTO CPA      S21903 48900000
         SRL   RWRK1,THREE              COMPUTE INDEX            S21903 49000022
         IC    RWRK1,LCBTPCD(RWRK1)     GET TP OP-CODE           S21903 49100022
         STC   RWRK1,TRACOPT            TRACE TP OP-CODE         S21903 49200022
         BR    RBALR                                             S21903 49300000
         EJECT                                                          49400022
*****************************************************************X02004 49404005
*                                                                X02004 49408005
* THE PURPOSE OF THIS ROUTINE IS TO CONVERT REAL ADDRESSES TO    X02004 49412005
* VIRTUAL ADDRESSES. THE VIRTUAL ADDRESS IS RETURNED IN RWRK6    X02004 49416000
* (REGISTER 6).                                                  X02004 49420000
*                                                                X02004 49424005
*****************************************************************X02004 49428005
         SPACE                                                          49432005
CONVERT  EQU   *                                                 X02004 49436005
         TM    LCBFLAG3,LCBRLAD         REAL DATA ADDRESS        X02004 49440005
         L     RWRK6,CCWADDR-ONE        GET DATA ADDRESS         X02004 49444000
         BCR   14,RBALR                 RETURN IF VIRTUAL        X02004 49448000
CONVERT1 EQU   *                                                 X02004 49452005
         L     RWRK1,CCWADDR-ONE        GET REAL DATA ADDRESS    X02004 49456005
CONVERT2 LA    RWRK1,ZERO(,RWRK1)       CLEAR HIGH ORDER BYTE  @OX12574 49460000
         LR    RWRK6,RWRKF              SAVE REGISTER 15         X02004 49464000
         L     RNTRY,CVTPTRV            CONVERT ROUTINE ADDRESS  X02004 49468005
         LR    RWRKB,RBALR              SAVE REG 14            @Y17XASA 49470000
         BALR  RBALR,RNTRY              CONVERT TO VIRTUAL       X02004 49472005
         LR    RBALR,RWRKB              RESTORE REG 14         @Y17XASA 49474000
         LR    RWRKF,RWRK6              RESTORE REGISTER 15      X02004 49476000
         LR    RWRK6,RWRK1              SAVE VIRTUAL ADDRESS     X02004 49480000
         BR    RBALR                    RETURN TO INLINE CODE    X02004 49484000
         EJECT                                                          49488005
* D E F I N E D   C O N S T A N T S                              S21903 49500022
Q0SAVE1  DC    16F'0'                   SAVEAREA FOR PCI       @G36XRSV 49600000
Q0SAVE2  DC    16F'0'                   SAVEAREA FOR NON PCI   @G36XRSV 49630000
SAVECURR DC    A(0)                     CURRENT ENTRY SAVE AREA@G36XRSV 49660000
SAVESIZE DC    2A(0)                    TABLE POINTER & SIZE   @OZ30604 49670086
NEWCURR  DC    A(0)                     MOVE TO TABLE ADDRESS  @OZ30604 49680086
CLEARHI  DC    X'00000FFF'              MASK FOR CHAN/UNIT ADDR  S21903 49700022
TRACECNT DC    F'00'                    SEQUENCE NUMBER        @G36XRSV 49720000
INUSEMSK DS    0F                       USED FOR SETTING IN USE@G36XRSV 49740000
         DC    AL1(LTINUSE)                                    @G36XRSV 49760000
         DC    AL3(0)                                          @G36XRSV 49780000
CCWBKUP  DC    AL2(CCWLEN)              BACK UP ONE CCW          S21903 50000000
DATABKUP DC    H'10'                    LAST DATA BYTE COUNT     S21903 50100022
LCBBKUP  DC    AL2(LCBPRFSZ)            BACK UP FROM IOB TO LCB  S21903 50300000
TRMPREFX DC    AL2(TRMPRFSZ)            TERMINAL PREFIX        @Y17XASA 50305000
H256     DC    H'256'                   TWO HUNDRED FIFTY-SIX  @OZ30604 50307086
         DROP  RWRKF                                           @SA70180 50310000
         USING TRACINFO,RWRKF                                  @SA70180 50360000
MOVENAME MVC   TRACNAME(1),0(RWRK7)     MOVES TERMINAL NAME.   @Y17XASA 50410000
         DROP  RWRKF                                           @SA70180 50460000
         USING TRACELN1,RWRKF                                  @SA70180 50510000
MVCDATA1 MVC   TRACDATA(0),ZERO(RWRK6)  VARIABLE MOVE OF DATA    S21903 50560000
         DROP  RWRKF                                             S21903 50610000
         USING TRACELN2,RWRKF                                    S21903 50660000
MVCDATA2 MVC   TRACEDAT(0),FOUR(RWRK6)  VARIABLE MOVE OF DATA    S21903 50710000
         SPACE 1                                               @G36XRSV 50720000
TABLE2   DC    256F'0'                  LINEEND,ERP WORK TABLE @OZ30604 50730086
TRCSIZE  EQU   16                       SIZE OF ONE ENTRY      @G36XRSV 50750000
TBL2LAST EQU   *-TRCSIZE                ADDR LAST ENTRY        @G36XRSV 50760000
LINETABL DC    100F'0'                  LINE TRACE CTL TBL.    @OY15041 50800000
FOXFOX   DC    X'FF'                    TABLE END INDICATOR      S21903 50900000
DUMPTS   DC    X'00'                    DUMP IN USE SWITCH     @G36XRSV 50950000
         EJECT                                                          51000022
* D S E C T S   U S E D   B Y   I G G 0 1 9 Q 0                  S21903 51100022
         SPACE                                                          51200022
* THE FOLLOWING DSECT IS FOR THE LINE CONTROL TABLE, A TABLE     S21903 51300022
* CONTAINED WITHIN THIS MODULE WITH ENTRIES FOR EACH OF THE      S21903 51400022
* LINES BEING TRACED. THE NUMBER OF ENTRIES IN THIS TABLE        S21903 51500000
* CAN BE INCREASED BY EXPANDING THIS MODULE.                     S21903 51600022
         SPACE                                                          51700022
LINETAB  DSECT                                                   S21903 51800022
LTCUU    DS    H                        CHANNEL/UNIT ADDRESS     S21903 51900022
LTUCBAD  DS    H                        UCB ADDRESS              S21903 52000022
LTPCI    DS    CL1                      FLAG BYTE              @Y17XASA 52100000
LTPCIN   EQU   X'80'                    PCI INTERRUPT INDICATOR  S21903 52200022
LTAUTOPL EQU   X'40'                    AUTOPOLL INT  INDICATOR  S21903 52300022
LTERPPCI EQU   X'20'                                           @Y17XASA 52350000
LTITSERP EQU   LTERPPCI                 PREVIOUS ENTRY WAS     @Y17XASA 52400000
*                                         ERP AND TRACE WILL BE  S21903 52500022
*                                         SKIPPED IN LINEEND     S21903 52600022
LTITSPCI EQU   LTERPPCI                 PREVIOUS ENTRY WAS     @Y17XASA 52700000
*                                         PCI AND TRACE WILL BE  S21903 52800022
*                                         SKIPPED IN LINEEND     S21903 52900022
LTFIRST  EQU   X'10'                    FIRST TIME SWITCH      @Y17XASA 52910000
LTP370X  EQU   X'08'                    370X ENTRY             @Y17XASA 52920000
LTLATTN  EQU   X'04'                    ATTENTION ENTRY        @Y17XASA 52930000
LTERROR  EQU   X'02'                    ERROR TRACE ENTRY      @Y17XASA 52940000
LTINUSE  EQU   X'01'                    TRACE ENTRY IN USE     @ZM47908 52950000
LTFREE   EQU   X'00'                    TRACE ENTRY FREE       @Y17XASA 52955000
LTPCIADD DS    0CL3                     LAST PCI ADDRESS       @Y17XASA 52960000
         DS    CL1                      FILLER                 @Y17XASA 52970000
LTPIURES DS    CL2                      PIU RESIDUAL COUNT     @Y17XASA 52980000
LTSIZE   EQU   *-LTCUU                  LINE TABLE ENTRY SIZE    S21903 53100022
         EJECT                                                          53200000
* THE FOLLOWING DSECT ALLOWS ADDRESSIBILITY ON THE TRACE TABLE   S21903 53300022
* CONTROL WORDS.                                                 S21903 53400022
         SPACE                                                          53500022
TRACNTRL DSECT                                                   S21903 53600022
TRACURR  DS    F                        CURRENT ENTRY            S21903 53700022
TRACSTRT DS    F                        FIRST   ENTRY            S21903 53800022
TRACLAST DS    F                        LAST    ENTRY            S21903 53900022
TRACMID  DS    F                        MIDDLE  ENTRY            S21903 54000022
TRACFLAG EQU   TRACMID                  FLAG BYTE                S21903 54100022
TRACMIDN EQU   X'20'                    MIDDLE OF TABLE IND      S21903 54200022
TRACENDN EQU   X'10'                    END OF TABLE IND         S21903 54300022
TRCNFIT  EQU   X'08'                    TRACE TABLE OVERFLOW   @G36XRSV 54350000
         SPACE                                                          54400022
* THE FOLLOWING DSECT IS FOR CREATION OF THE UNIQUE HEADER ENTRY S21903 54500022
* IN THE TRACE TABLE FOR EACH INTERRUPT FIELDED.                 S21903 54600022
         SPACE                                                          54700022
TRACEHDR DSECT                                                   S21903 54800022
TRACCUU  DS    H                        CHANNEL/UNIT ADDRESS     S21903 54900022
TRACSEQ  DS    H                        SEQUENCE NUMBER          S21903 55000022
TRACFLG1 DS    X                        IOB FLAGS                S21903 55100022
TRACPSRT DS    XL3                      CHAN PROG START ADDRESS  S21903 55200022
TRACSENS DS    XL1                      SENSE BYTE ZERO        @Y17XASA 55250000
TRACSW   DS    XL7                      CSW                    @Y17XASA 55300000
         EJECT                                                          55400022
* THE FOLLOWING DSECT IS FOR THE CREATION OF THE UNIQUE        @SA70180 55409056
* INFORMATION ENTRY FOR EACH INTERRUPT                         @SA70180 55418056
         SPACE 1                                               @SA70180 55427056
TRACINFO DSECT                                                 @SA70180 55436056
TRACIND  DS    C                        ENTRY INDICATOR IS FA  @SA70180 55445056
         DS    C                        UNUSED                 @SA70180 55454056
TRACTCIN DS    XL2                      LCBTTCIN VALUE         @SA70180 55463056
TRACNAME DS    CL8                      TERMNAME               @SA70180 55472056
         DS    X                        RESERVED               @Y17XASK 55476000
TRACINV  DS    XL3                      LCBINVPT               @Y17XASK 55481000
         SPACE 1                                               @SA70180 55490056
* THE FOLLOWING DSECT IS FOR THE ENTRIES CREATED IN THE TRACE    S21903 55500022
* TABLE FOR EACH CCW IN THE CHANNEL PROGRAM. ONE OR MORE OF      S21903 55600022
* ENTRIES WILL OCCUR FOR EACH INTERRUPT.                         S21903 55700022
         SPACE                                                          55800022
TRACELN1 DSECT                                                   S21903 55900022
TRACCWAD DS    F                        CCW ADDRESS              S21903 56000022
TRACCW   DS    XL8                      CCW                      S21903 56100022
TRACDATA DS    CL4                      TRANSFERRED DATA         S21903 56200022
         ORG   TRACDATA                                          S21903 56300022
TRACDAT1 DS    CL4                      DATA                     S21903 56400022
TRACSIZE EQU   *-TRACCWAD               TRACE ENTRY SIZE         S21903 56500022
         ORG   TRACCW+5                                          S21903 56600022
TRACOPT  DS    C                        TP OP-CODE               S21903 56700022
         SPACE                                                          56800022
* THE FOLLOWING DSECT IS USED IN TRACING DATA IN THOSE INSTANCES S21903 56900022
* WHEN MORE THAN FOUR BYTES OF DATA WERE TRANSFERRED. TWO TRACE  S21903 57000022
* ENTRIES ARE USED, THE FIRST ENTRY FORMATTED BE THE TRACELN1    S21903 57100022
* DSECT AND THE SECOND BY THE TRACELN2 DSECT.                    S21903 57200022
         SPACE                                                          57300022
TRACELN2 DSECT                                                   S21903 57400022
TRACEDAT DS    XL4                      FIRST DATA BYTES         S21903 57500022
         DS    2X                       PADDING                  S21903 57600022
TRACEEND DS    XL10                     LAST DATA BYTES          S21903 57700022
         SPACE                                                          57710000
TRACENT  DSECT                                                 @Y17XASA 57720000
ENTRY    DS    CL16                     TRACE TABLE ENTRY      @Y17XASA 57730000
         SPACE 3                                               @Y17XASA 57740000
IEDQRQE  DSECT                          RQE DSECT              @Y17XASA 57750000
         DS    H                        NEXT RQE ADDRESS       @Y17XASK 57755000
RQEUCB   DS    H                        RQE UCB ADDRESS        @Y17XASK 57760000
RQEIOB   DS    F                        RQE IOB ADDRESS        @Y17XASA 57770000
         EJECT                                                          57800022
         TAVTD                                                          57900022
         EJECT                                                          58200022
         TCCWD                                                          58300022
         EJECT                                                          58400022
CVTDSECT DSECT                                                          58500022
         CVT                                                            58600022
         EJECT                                                          58700022
         DCBD  DSORG=TX                                                 58800022
         EJECT                                                          58810000
         TLCBD                                                          58820000
         EJECT                                                 @SA70178 58830056
         TPRFD                    BUFFER PREFIX DSECT          @SA70178 58860000
         EJECT                                                 @Y17XASA 58863000
         TTCXD                    TCX DSECT                    @Y17XASA 58866000
         EJECT                                                 @Y17XASA 58869000
         TTNTD                    TERMINAL NAME TABLE DSECT    @Y17XASA 58872000
         EJECT                                                 @Y17XASA 58875000
         TTRMD                    TERMINAL TABLE DSECT         @Y17XASA 58878000
         EJECT                                                 @Y17XASA 58881000
         TTHD                     TH DSECT                     @Y17XASA 58884000
         EJECT                                                 @Y17XASA 58887000
IEDQUCB  DSECT                                                 @Y17XASA 58890000
         IEFUCBOB                 UCB DSECT                    @Y17XASA 58893000
         END                                                            58900022
