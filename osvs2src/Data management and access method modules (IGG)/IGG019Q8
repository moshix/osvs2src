19Q8     TITLE 'IGG019Q8-SUBROUTINE FOR IGG01945-CONTINUATION RESTART'  00090022
         SPACE 3                                                        00180022
IGG019Q8 CSECT                                                          00270022
         SPACE 3                                                        00360022
*CHANGE ACTIVITY = AS FOLLOWS:                                          00450022
******************** MICROFICHE FLAGS *********************** SUPT CODE 00490022
*A000000-999999                                                @Y16X5C0 00510000
*MODULE RESEQUENCED                                             SA51078 00540022
*CODES WERE SA50192,SA53610,SA52971,S21903,S21101                       00540122
*A428400                                                        SA61740 00540222
*A430200                                                        SA61740 00540322
*A477900                                                        SA61045 00540422
*A306000,405900                                                 SA61769 00540522
*C317700-345600                                                 SA61769 00540622
*A472501-472502,474301                                          SA59179 00540705
*C 824400,828000                                                SA63974 00540852
*A517500,519300                                                 SA66335 00560854
*A592200                                                        SA66921 00590805
*D607500-608400                                                 SA66921 00640805
*A091800,893700                                                 OX03959 00640905
*C884700,886500-891000,892800                                   OX03959 00641005
*A894100                                                       @SA69965 00641156
*C513900,516600,518400,765900                                  @SA70310 00641256
*A475200                                                       @SA70665 00641356
*C406100,406120                                                @SA71083 00641456
*D405980                                                       @SA71083 00641556
*A406020,406140                                                @SA71083 00641656
*A092200,895500                                                @SA71107 00641756
*D380724-381000                                                @SA71107 00641856
*C307300,312300,500400-503100,657900-659700,690300-693000      @SA71107 00641956
*C700200-701100                                                @SA71107 00642056
*A207000,907200,911700                                         @XA05305 00642156
*C036900,111600                                                @XA05305 00642256
*D478800-481500                                                @ZA02629 00642358
*A486900,875700                                                @ZA02629 00642458
*A475800                                                       @SA74049 00642558
*A875700                                                       @ZA03082 00642658
*C372900                                                       @SA72478 00642758
*A265500,386100,406140,757800                                  @SA72478 00642858
*A421200,900900                                                @SA74246 00642958
*A234900,299700,308700,354600,373500,406200,406360,422100,     @YA11145 00643058
*A450000,550800,636300,663300,674100,682200,694800,708300,     @YA11145 00643158
*A713700,720000,782100,787500,798300,804600,810900,828400,     @YA11145 00643258
*A845100,849600,901300,909900                                  @YA11145 00643358
*D378900,822600                                                @YA11145 00643458
*A416700,874800                                                @XA11306 00643558
*C484200,493200,756900,876100                                  @XA11306 00643658
*A431100,525600                                                @SA75766 00643758
*C405660,555300                                                @SA75766 00643858
*C757300,874880-874920,875240,875320,875360,875480-875520      @OS76477 00643958
*C876340,876500                                                @OS76477 00644058
*A493200,496800,901800                                         @OY11175 00644158
*C485100                                                       @OY11175 00644258
*C701000                                                       @OY12275 00644358
*A269100,902400                                                @OS76678 00644458
*C417100,875160                                                @OS76678 00644558
*A004900,245400                                                @Y17XARX 00654500
*C011700,014400,017100,245100,245400                           @Y17XARX 00664500
*D009000                                                       @Y17XARX 00674500
*A235170,901800                                                @OS77390 00684500
*A421200                                                       @OZ14161 00694500
*C484200-484800,493200,876100-876420                           @OZ08356 00695500
*D269400-269700,417100,756900-757500,874840-875580,876500      @OZ08356 00696500
*D902500-902600                                                @OZ08356 00697500
*A234930,347400,367200,592200                                  @OS77945 00698500
*C240300                                                       @OS77945 00699500
*C406580                                                       @OX16402 00700500
*A245700,421280,767700,903600                                  @OZ17620 00701500
*C406580,477050-477850                                         @OX16402 00702500
*A434700,476000                                                @OX16402 00703500
*D253000-253400,478000,782821-782857                           @OX16402 00704500
*A235530                                                       @OZ24281 00705500
*D235590                                                       @OZ24281 00706500
*A143100,144000                                                @OS80044 00706682
*A387000,758400,904000                                         @OX20945 00706782
*C476048                                                       @OX20945 00706882
         SPACE 3                                                        00720022
*********************************************************************** 00810022
*                                                                     * 00900022
*MODULE-NAME = IGG019Q8  (TCAM, CHECKPOINT/RESTART)            @Y17XARX 01170000
*                                                                     * 01260022
*DESCRIPTIVE-NAME=SUBROUTINE FOR IGG01945-CONTINUATION RESTART @Y17XARX 01350000
*                                                                     * 01440022
*COPYRIGHT = 'NONE'                                                   * 01530022
*                                                                     * 01620022
*  STATUS:  VERSION 10.0                                       @Y17XARX 01710000
*                                                                     * 01800022
*FUNCTION:THIS MODULE IS USED AS AN EXTENTION OF IGG01945 FOR         * 01890022
*   CONTINUATION RESTART.                                        CLUP21 01980022
*   WHEN ENTERED AT THE FIRST ENTRY POINT, IT SCANS THE MESSAGE  CLUP21 02070022
*   QUEUES TO RECONSTRUCT THE QUEUING CHAINS.                    CLUP21 02160022
*   WHEN ENTERED AT THE SIXTH ENTRY POINT, IT MOVES INVITATION   CLUP21 02250022
*   LIST DATA FROM THE CHECKPOINT RECORD.                        CLUP21 02340022
*   WHEN ENTERED AT THE EIGTH ENTRY POINT, IT READS A CHECKPOINT CLUP21 02430022
*   RECORD.                                                      CLUP21 02520022
*   ALL OTHER ENTRY POINTS ARE TABLE FILLERS, AND, IF USED, CAUSECLUP21 02610022
*   A DEAD LOOP.                                                 CLUP21 02700022
*                                                                     * 02790022
*ENTRY POINTS:                                                        * 02880022
*                                                                     * 02970022
*        IGG019Q8    - SCAN MESSAGE QUEUES                       CLUP21 03060022
*        IGG019Q8+4  - TABLE FILLER (IF USED, RESULTS IN A DEAD  CLUP21 03150022
*                      LOOP)                                     CLUP21 03240022
*        IGG019Q8+8  - TABLE FILLER (IF USED, RESULTS IN A DEAD  CLUP21 03330022
*                      LOOP)                                     CLUP21 03420022
*        IGG019Q8+12 - TABLE FILLER (IF USED, RESULTS IN A DEAD  CLUP21 03510022
*                      LOOP)                                     CLUP21 03600022
*        IGG019Q8+16 - CHECK INVITATION LIST FOR IGG01943      @XA05305 03690056
*        IGG019Q8+20 - MOVE DATA TO INVITATION LIST FOR IGG01943 CLUP21 03870022
*        IGG019Q8+24 - TABLE FILLER (IF USED, RESULTS IN A DEAD  CLUP21 03960022
*                      LOOP)                                     CLUP21 04050022
*        IGG019Q8+28 - CONVERT TTR AND SECTOR; THEN, READ        CLUP21 04140022
*                      CHECKPOINT RECORD FOR IGG01943 OR IGG01944CLUP21 04230022
*                                                                     * 04320022
*INPUT:REGISTER 2 HAS ADDRESS OF CHECKPOINT WORK AREA,REGISTER 12     * 04410022
*   HAS THE ADDRESS OF IGG019Q8 ENTRY POINT                           * 04500022
*                                                                     * 04590022
*OUTPUT:REGISTERS REMAIN UNCHANGED                                    * 04680022
*                                                                     * 04770022
*EXTERNAL ROUTINES:                                                   * 04860022
*                                                                     * 04950022
*        IGG019RC-ACCESS MESSAGE QUEUES DATA SET                      * 05040022
*        IGG019RC-WTORTN-DISK ERROR HANDLING                     99226  05130022
*                                                                     * 05220022
*EXITS-NORMAL:THIS MODULE BRANCHES TO ADDRESS IN REGISTER 14.         * 05310022
*                                                                     * 05400022
*EXITS-ERROR-BRANCH TO THE WTORTN OF IGG019RC ON DISK ERRORS     99226  05490022
*                                                                     * 05580022
*TABLES/WORK AREAS:                                                   * 05670022
*                                                                     * 05760022
*   AVT                                                               * 05850022
*   CHECKPOINT WORK AREA                                              * 05940022
*   TERMINAL TABLE                                                    * 06030022
*   QCB                                                               * 06120022
*                                                                     * 06210022
*ATTRIBUTES: REENTERABLE                                              * 06300022
*                                                                     * 06390022
*NOTES:THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL REPRE-   * 06480022
*   SENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT TO    * 06570022
*   THE ONE USED AT ASSEMBLY TIME. THE CODING HAS BEEN ARRANGED SO    * 06660022
*   THAT REDEFINITION OF 'CHARACTER' CONSTANTS,BY REASSEMBLY, WILL    * 06750022
*   RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.               * 06840022
*                                                                     * 06930022
*********************************************************************** 07020022
         SPACE 3                                                        07110022
*REGISTER ASSIGNMENTS                                                   07200022
         SPACE                                                          07290022
R0       EQU   0                        ZERO                     S22024 07380022
R1       EQU   1                        REG 1                    S22024 07470022
R2       EQU   2                        ADDRESS OF CKPT WORK AREA       07560022
R3       EQU   3                        ADDRESS OF CPB                  07650022
R4       EQU   4                        ADDRESS OF PREFIX               07740022
R5       EQU   5                        LENGTH OF TERMNAME              07830022
R6       EQU   6                        ADDRESS OF TERMNAME ENTRY       07920022
R7       EQU   7                        ADDRESS OF QCB                  08010022
R8       EQU   8                        ADDRESS OF TERMINAL ENTRY       08100022
RAVT     EQU   9                        ADDRESS OF AVT                  08190022
R10      EQU   10                       ADDRESS OF DATA FIELD           08280022
R11      EQU   11                       COUNT OF TERMNAME ENTRIES       08370022
R12      EQU   12                       BASE REG                        08460022
R13      EQU   13                       REG 13                   S22024 08550022
R14      EQU   14                       BRANCH REG                      08640022
R15      EQU   15                       REG 15                   S22024 08730022
         SPACE 3                                                 CLUP21 08820022
* ADDITIONAL EQUATES                                             CLUP21 08910022
         SPACE 1                                                 CLUP21 09000022
INCR     EQU   4                        FOUR                     S22024 09090022
DIV2     EQU   1                        ONE                      S22024 09180022
DIV4     EQU   2                        CONSTANT FOR DIVIDE     OX03959 09220005
ADDRSIZE EQU   3                        SIZE OF ADDRESS FIELD  @SA71107 09230056
LASTBYTE EQU   2                        OFFSET TO LAST BYTE    @SA71107 09240056
ADDR     EQU   7                        MASK FOR ICM           @SA71107 09250056
LEN2     EQU   2                        LENGTH OF TWO          @OZ08356 09260000
         SPACE 3                                                        09270022
         USING *,R12                                               0918 09360022
         SPACE 3                                                        09450022
*BRANCH TABLE FOR ENTRIES FROM IGG01945                                 09540022
         SPACE                                                          09630022
         B     Q809                     MAKE CHECKS BEFORE SCANNING0419 09720022
         B     *                        BRANCH TABLE FILLER      CLUP21 09810022
*                                       - THIS ENTRY POINT SHOULDCLUP21 09900022
*                                         NEVER BE USED AS IT    CLUP21 09990022
*                                         WILL RESULT IN A DEAD  CLUP21 10080022
*                                         LOOP                   CLUP21 10170022
         B     *                        BRANCH TABLE FILLER      CLUP21 10260022
*                                       - THIS ENTRY POINT SHOULDCLUP21 10350022
*                                         NEVER BE USED AS IT    CLUP21 10440022
*                                         WILL RESULT IN A DEAD  CLUP21 10530022
*                                         LOOP                   CLUP21 10620022
         B     *                        BRANCH TABLE FILLER      CLUP21 10710022
*                                       - THIS ENTRY POINT SHOULDCLUP21 10800022
*                                         NEVER BE USED AS IT    CLUP21 10890022
*                                         WILL RESULT IN A DEAD  CLUP21 10980022
*                                         LOOP                   CLUP21 11070022
         B     Q8INVCHK                 CHECK INV LIST SUBRTN  @XA05305 11160056
         B     Q870                     MOVE DATE TO INV LIST      0216 11610022
         B     *                        BRANCH TABLE FILLER      CLUP21 11700022
*                                       - THIS ENTRY POINT SHOULDCLUP21 11790022
*                                         NEVER BE USED AS IT    CLUP21 11880022
*                                         WILL RESULT IN A DEAD  CLUP21 11970022
*                                         LOOP                   CLUP21 12060022
*        B     Q800                     CONVERT ADDRESS AND READ CLUP21 12150022
*                                            RECORD              CLUP21 12240022
IGG019Q8 IEDHJN Q800                    ID AND DATE              CLUP21 12330022
         USING IEDQAVTD,RAVT            BASE FOR AVT               0918 12420022
         USING IEDQCKPD,R2              BASE FOR CKPT WORK AREA    0918 12510022
         USING IEDQCPB,R3               BASE FOR CPB                    12600022
         USING IEDQPRF,R4               BASE FOR PREFIX                 12690022
         USING IEDQTNTD,R6                                              12780022
         USING IEDQQCB,R7                                               12870022
         USING IEDQTRM,R8                                               12960022
         SPACE                                                          13050022
**********************************************************************  13140022
         SPACE 3                                                        13230022
*CONVERT TTR TO ABSOLUTE ADDRESS,CONVERT TRACK DATA LENGTH TO A         13320022
*SECTOR ID, AND READ A CHECKPOINT RECORD.                               13410022
         SPACE                                                          13500022
         ST    R14,CKPSAVE1             SAVE RETURN ADDRESS        0419 13590022
         L     R13,CKPCVTPT             GET CVT ADDRESS            0416 13680022
         L     R15,CKPCNTTR(,R13)       GET CONVERSION ROUTINE ADDR0416 13770022
         LR    R3,R2                    SAVE CKPT BASE             0419 13860022
         LM    R1,R2,CKPCPARM           PARAMETERS FOR TTR CONVERT 0419 13950022
         SLL   R0,CKP1BYTE              POSITION TTR               0419 14040022
         BALR  R14,R15                  CONVERT TTR TO ABSOLUTE ADD0419 14130022
         LR    R2,R3                    RESTORE CKPT BASE          0419 14220022
         L     R12,CKPSAVE1+8           RESTORE BASE REG           0506 14310022
         TM    CKPFLAGS,CKPOPNIN        ENTRY FROM IGG01944    @OS80044 14340082
         BNO   NOT1944                  NO, BRANCH             @OS80044 14370082
         ST    R15,CKPSAVE2+60          SAVE RETURN CODE           0504 14400022
NOT1944  EQU   *                                               @OS80044 14440082
         LTR   R15,R15                  CHECK RETURN CODE          0419 14490022
         BNZ   Q804                     BRANCH IF END OF DATA SET  0504 14580022
         CLI   CKPSETSC,CKPNOOP         CHECK FOR RPS FEATURE      0416 14670022
         BE    Q803                     BRANCH IF NOT SUPPORTED    0419 14760022
         LH    R0,CKPTRKLN              GET DATA ON TRACK          0416 14850022
         O     R0,Q8FLAG-2              SET FLAG FOR CNVRT  0507 S21101 14940022
         SLL   R0,CKP2BYTE              SHIFT TO LOW ORDER HALF WORD416 15030022
         IC    R0,CKPIOR                GET RECORD NUMBER               15120022
         L     R2,CKPPARM2              GET UCB INDEX AND ADDRESS  0416 15210022
         L     R13,CKPCVTPT             ADDRESS OF CVT             0419 15300022
         L     R15,CKPCNSEC(,R13)       GET ADDR ON SECTOR CONVERT 0416 15390022
         BALR  R14,R15                  GET SECTOR ID              0416 15480022
         LR    R2,R3                    RESTORE CKPT BASE          0416 15570022
Q803     EQU   *                                                   0419 15660022
         EXCP  CKPIOB                   READ CKPT RECORD           0419 15750022
         WAIT  ECB=CKPECB               WAIT FOR IO             SA51078 15840022
Q804     EQU   *                                                        15930022
         LM    R0,R10,CKPSAVE2          RESTORE REGS            SA51078 16020022
         LM    R13,R15,CKPSAVE2+R13OFF  RESTORE REMAIN REGS     SA51078 16110022
         L     R14,CKPSAVE1             RESTORE RETURN ADDR     SA51078 16200022
         TM    CKPFLAGS,CKPOPNIN        ENTRY FROM 1944         SA51078 16290022
         BCR   7,R14                    BRANCH IF YES           SA51078 16380022
         USING IEDQCDRD,R11             BASE FOR DISK RCD       SA51078 16470022
         L     R11,CKPEXCP              RESTORE ADDR OF DISK RCD        16560022
         TM    CKPECB,X'7F'             CHECK FOR DISK ERROR            16650022
         BNO   QME98                    BRANCH IF ERROR                 16740022
         CLI   CDRKEY,0                 CHECK FOR RCD NOT INITIALZ 0525 16830022
         BE    QME9805                  BR IF RCD STILL ZERO    SA51078 16920022
         LH    R15,CKPSECLT             TRACK DATA LENGTH   0419 S21101 17010022
         AH    R15,CKPBPERR             ADD LENGTH OF RCD   0419 S21101 17100022
         STH   R15,CKPSECLT             SAVE RESULT         0419 S21101 17190022
         LR    R15,R0                                                   17280022
         SPACE 3                                                        17370022
         LA    R0,1(0,R15)              GET TTR OF NEXT RECORD          17460022
         EX    R15,QMECOMPR             CHECK FOR END OF TRACK          17550022
         BNE   QME91                    BRANCH IF NOT END          1014 17640022
         LA    R0,CKP101(0,R15)         GET NEXT TRACK                  17730022
         IC    R0,QMEONE                GET 1ST RECORD                  17820022
         XC    CKPSECLT,CKPSECLT        INIT TO BEGINNING OF0419 S21101X17910022
                                        TRACK               0419 S21101 18000022
QME91    EQU   *                                                   1014 18090022
         MVC   CKPDATIM(8),CDRDATE      SAVE DATE,TIME TO COMPARE       18180022
         MVC   CKPTTRLI,CDRTTRLI        LAST INC RCD AT TIME OF ENV0922 18270022
         LA    R11,CDRTINFO(0,R11)      MOVE TO DATA FIELD              18360022
         L     R12,CKPSAVE2+R12OFF      RESTORE 1943 BASE       SA51078 18450022
         B     GOODRTN(R14)             RETURN                  SA51078 18540022
         SPACE 3                                                        18630022
*DISK ERROR -ISSUE WTO                                                  18720022
         SPACE                                                          18810022
QME98    EQU   *                                                        18900022
         L     R1,CKPCTTRA              GET ADDR OF TTR                 18990022
         XC    0(3,R1),0(R1)            CLEAR TO INDICATE DISK ERR      19080022
         SPACE 3                                                        19170022
*SUBROUTINE TO INCREMENT DISK ERROR COUNT SO THAT ERROR MSGS CAN BE1109 19260022
*WRITTEN LATER BY IGG01942                                              19350022
         SPACE                                                          19440022
QME9805  EQU   *                                                   0728 19530022
         IC    R1,CKPERRCT              PICK UP ERROR COUNT        1109 19620022
         LA    R1,1(,R1)                ADD 1 TO COUNT             1109 19710022
         STC   R1,CKPERRCT              RESTORE COUNT              1109 19800022
         L     R12,CKPSAVE2+R12OFF      RESTORE 1943 BASE       SA51078 19890022
         B     BADRTN(R14)              RETURN                  SA51078 19980022
         SPACE                                                          20070022
         DROP  R11                                              SA51078 20160022
*END OF SUBROUTINE                                                      20250022
         SPACE 2                                                        20340022
QMECOMPR CLI   CKPRPERT,0               USED TO CHECK FOR END   SA51078 20430022
*                                       OF TRACK WHEN READING   SA51078 20520022
*                                       ENVIRON RCDS            SA51078 20610022
QMEONE   DC    X'1'                     INIT RCD NO             SA51078 20700022
         EJECT                                                 @XA      20703056
*        SUBROUTINE TO CHECK INVITATION LIST FOR IGG01943      @XA05305 20706056
*                                                              @XA05305 20709056
Q8INVCHK DS    0H                                              @XA05305 20712056
*                                       RESTORE 1943'S BASE    @XA05305 20715056
         L     R12,CKPSAVE1-IEDQCKPD(,R2)                      @XA05305 20718056
*                                       INVITATION LIST DEFINED@XA05305 20721056
         CLC   QCBRELLN-IEDQQCB(RLNLEN,R7),DCBILCT-IHADCB(R10) @XA05305 20724056
         BHR   R13                      BR NO                  @XA05305 20727056
*                                                              @XA05305 20730056
*                                       GET INV LIST ADDRESS   @XA05305 20733056
         L     R4,DCBINVLI-IHADCB(R4,R10)                      @XA05305 20736056
         LA    R4,AVTEZERO(,R4)         CLEAR THE HI ORDER BYTE@XA05305 20739056
         LTR   R4,R4                    INVLIST OMITTED ON GRP @XA05305 20742056
         BZR   R13                      BR YES                 @XA05305 20745056
*                                                              @XA05305 20748056
         CLI   INVENTS(R4),AVTEZERO     DOES LIST HAVE ENTRIES @XA05305 20751056
         BZR   R13                      BR NO                  @XA05305 20754056
*                                                              @XA05305 20757056
         TM    INVSTAT(R4),CKPSET2      LIST ALREADY PROCESSED @XA05305 20760056
         BOR   R13                      BR YES                 @XA05305 20763056
*                                                              @XA05305 20766056
         B     GOODRT43(,R13)           TAKE GOOD RTRN TO 1943 @XA05305 20769056
         EJECT                                                 @XA      20772056
         SPACE 3                                                        20790022
* SUBROUTINE FOR 1943 TO MOVE DATE TO INVITATION LIST              0216 20880022
         SPACE                                                          20970022
Q870     DS    0H                                               SA51078 21060022
         CR    R3,R1                    CHECK LENGTH TO BE MOVED   1014 21150022
         BL    QME94                    BRANCH IF REST OF SEG TO MV1014 21240022
         LR    R3,R1                    USE SHORTER LENGTH         1014 21330022
QME94    EQU   *                                                   1014 21420022
         LR    R5,R3                    COPY LENGTH TO BE MOVED    1014 21510022
         SR    R1,R3                    GET REMAINDER TO BEMOVED   1022 21600022
         SRL   R3,8                     GET COUNT OF EXECUTES REQ  1014 21690022
         LA    R3,1(,R3)                ADD 1 TO COUNT             1014 21780022
         N     R5,QME000F               CLEAR ALL NUT LAST BYTE    1014 21870022
QME95    EQU   *                                                   1014 21960022
         BCTR  R5,0                     SUBTRACT 1 FOR EXECUTE     1014 22050022
         EX    R5,QMEMOVE               MOVE DATA                  1014 22140022
         LA    R4,1(R4,R5)              UPDATE POINTER TO DATA     1014 22230022
         LA    R11,1(R11,R5)            UPDATE POINTER TO RCD      1014 22320022
         LA    R5,QMEMOVEL              LENGTH FOR E NEXT EXECUTE  1014 22410022
         BCT   R3,QME95                 BRANCH IF ANOTHER EXECUTE  1014 22500022
         L     R12,CKPSAVE1             RESTORE BASE FOR 1943      0216 22590022
         BR    R13                      RETURN                          22680022
         SPACE                                                          22770022
*END OF SUBROUTINE                                                      22860022
         SPACE                                                          22950022
*********************************************************************** 23040022
         EJECT ,                                                 CLUP21 23130022
*CHECK OUT TERM ENTRY AND QCB BEFORE STARTING SCAN                      23220022
         SPACE                                                          23310022
Q809     EQU   *                                                   0419 23400022
         STM   R14,R12,AVTSAVE1+12      SAVE REGISTERS           CLUP21 23490022
         XC    CKPSAVE2(40),CKPSAVE2    CLEAR WORK AREA        @YA11145 23493058
         TM    AVTBIT3,AVTSTAYN         SCAN SPECIFIED         @OS77945 23494000
         BO    NOFORMAT                 NO, SKIP GETMAIN       @OS77945 23495000
GETMAIN  EQU   4                                               @YA11145 23496058
         MVC   AVTSAVE4+C12(GMEND-GETML),GETML  MOVE LIST      @YA11145 23499058
         LA    R1,GMAIN                 GET ADDR OF TARGET     @YA11145 23502058
         STCM  R1,ADDR,AVTSAVE4+C17     SET TARGET ADDR        @YA11145 23505058
         LA    R1,AVTSAVE4+C12          POINT LIST             @YA11145 23508058
         SVC   GETMAIN                  ISSUE GETMAIN          @YA11145 23511058
         LTR   R15,R15                  CHECK RETURN CODE      @YA11145 23514058
         BNZ   NOFORMAT                 NO CORE, SKIP FORMAT   @YA11145 23517058
         L     R3,LENGTH                GET LENGTH OF AREA     @OS77390 23517100
         L     R1,GMAIN                 GET ADDRESS            @OS77390 23517200
         MVI   LENGTH,SP250             SET SUBPOOL            @OS77390 23517300
         L     R0,LENGTH                GET LENGTH AND SUBPOOL @OS77390 23517400
         FREEMAIN R,LV=(0),A=(1)        FREE AREA              @OS77390 23517500
         SH    R3,ABNDCORE              SUBTRACT ENOUGHT FOR   @OS77390 23517600
*                                       ABEND FUNCTION         @OS77390 23517700
         XC    GMAIN(8),GMAIN           CLEAR ADDR AND LENGTH  @OS77390 23517800
         C     R3,SIZES                 IS REMAINING LENGTH    @OS77390 23517900
*                                       LESS THAN MINIMUN      @OS77390 23518000
         BL    NOFORMAT                 YES,NOT ENOUGH CORE    @OS77390 23518100
         ST    R3,SIZES+4               SET NEW UPPPER BOUND   @OS77390 23518200
         LA    R1,AVTSAVE4+C12          POINT TO LIST          @OS77390 23518300
         SVC   GETMAIN                  ISSSUE GETMAIN         @OS77390 23518400
         LTR   R15,R15                  CHECK RETURN CODE      @OS77390 23518500
         BNZ   NOFORMAT                 NO CORE,SKIP FORMAT    @OS77390 23518600
         L     R3,GMAIN                 GET ADDR OF FIRST UNIT @YA11145 23520058
         LR    R5,R3                    PUT ADDR OF FIRST UNIT @YA11145 23523058
         A     R5,LENGTH                ADD LENGTH OF AREA     @YA11145 23526058
         LA    R4,PRFSHDR-IEDQPRF       SIZE OF UNIT           @YA11145 23529058
         SR    R5,R4                    SET FOR BXLE LOOP      @YA11145 23532058
FMTLOOP  LA    R6,0(R3,R4)              POINT TO NEXT UNIT     @YA11145 23535058
         STCM  R6,ADDR,PRFTIC+1-IEDQPRF(R3) CHAIN TO NEXT UNIT @YA11145 23538058
         BXLE  R3,R4,FMTLOOP            RELOOP TO CHAIN UNITS  @YA11145 23541058
ENDFMT   SR    R3,R4                    BACK UP TO LAST UNIT   @YA11145 23544058
         XC    PRFTIC+1-IEDQPRF(3,R3),PRFTIC+1-IEDQPRF(R3)     @YA11145 23547058
*                                       CLEAR LINK OF LAST     @YA11145 23550058
         MVC   NXTAVAIL(4),GMAIN        SET POINTER TO FIRST   @YA11145 23553058
NOFORMAT EQU   *                                               @OZ24281 23554000
         LM    R14,R12,AVTSAVE1+12      RESTORE REGISTERS      @YA11145 23556058
         SPACE 3                                                SA52971 23580022
*BEGINNING OF LOOP THROUGH TERMNAME TABLE                               23670022
         SPACE                                                          23760022
         TM    AVTBIT3,AVTSTAYN         SCAN SPECIFIED          SA51078 23850022
         BO    QMJ10                    BRANCH IF NO            SA51078 23940022
         TM    AVTCKELF,AVTNQBCK        RETRIEVAL NEEDED       @OS77945 24030000
         BO    SCAN2                    NO, SKIP SCAN ONE      @OS77945 24040000
         OI    CKPFLAGS,CKPFSCN1        SET FOR FIFO SCANS     @OS77945 24050000
SCAN2    EQU   *                                               @OS77945 24060000
         OI    CKPFLAGS,CKPFSCN2        SET FOR SCAN TWO       @OS77945 24070000
*                                       SET FOR FIFO SCANS      SA51078 24120022
QMJ10    EQU   *                                                        24210022
         LA    R15,QMJ80                BRANCH ADDRESS             0825 24300022
         MVC   CKPTRMAD+1(3),0(R6)      MOVE ADDR TO WORD BOUNDARY      24390022
         L     R8,CKPTRMAD              LOAD ADDR                       24480022
         TM    TRMSTATE,TRMPROC         TPROCESS?              @Y17XARX 24510000
         BO    Q80903                   YES - CHECK QCB        @Y17XARX 24514000
         TM    TRMSTATE,TRMPREF         3705 RESOURCE?         @Y17XARX 24518000
         BNO   Q80903                   NO - CHECK QCB         @Y17XARX 24522000
         USING IEDNTRM,R7                                      @Y17XARX 24526000
         LR    R7,R8                    GET TTE PTR            @Y17XARX 24530000
         LA    R14,TRMPRFSZ             GET NEG PREFIX SIZE    @Y17XARX 24534000
         SR    R7,R14                   GET NEG TTE PTR        @Y17XARX 24538000
         CLI   TRMTYPE,TRMGRP           GROUP?                 @Y17XARX 24542000
         BER   R15                      YES - NO QCB           @Y17XARX 24546000
         CLI   TRMTYPE,TRMSSCP          SSCP?                  @Y17XARX 24550000
         BER   R15                      YES - NO QCB           @Y17XARX 24554000
Q80903   EQU   *                                               @Y17XARX 24558000
         USING IEDQQCB,R7                                      @Y17XARX 24562000
         L     R7,TRMDESTQ-1            ADDR OF QCB                     24570022
         TM    TRMSTATE,TRMLIST         IS THE LIST BIT ON      SA53610 24660022
         BNO   Q80905                   BRANCH IF NOT           SA53610 24750022
         TM    TRMSTATE,TRMLOG          IS THIS LOGTYPE         SA53610 24840022
         BCR   14,R15                   BR IF NOT               SA52971 24930022
         SPACE                                                          25020022
Q80905   EQU   *                                                SA53610 25110022
         TM    QCBDSFLG,QCBDISK         CHECK FOR DISK QUEUES           25200022
         BCR   8,R15                    BR IF CORE ONLY          CLUP21 25290022
         MVC   CKPSAVE1(1),QCBFLAG      MOVE FLAG               SA51078 25380022
         NI    CKPSAVE1,QCBCKPT         RESET ALL EXCEPT CKPT   SA51078 25470022
         CLC   CKPSAVE1(1),CKPSWCH1     QCB ALREADY DONE        SA51078 25560022
         BE    CLRCNT                   BRANCH IF YES           SA51078 25650022
         XI    QCBFLAG,QCBCKPT          INDICATE QCB DONE       SA51078 25740022
         SPACE                                                          25830022
         LA    R14,AVTADEBR             ASSUME REUSABLE          CLUP21 25920022
         TM    QCBDSFLG,QCBREUS         CHECK DISK TYPE            0602 26010022
         BO    Q810                     BRANCH IF REUSABLE DISK    0923 26100022
         LA    R14,AVTADEBN             RESET TO PERMANENT       CLUP21 26190022
Q810     EQU   *                                                   0923 26280022
         NC    AVTEZERO(4,R14),AVTEZERO(R14) CHECK FOR OPENED DEBCLUP21 26370022
         BCR   8,R15                    BR IF NOT OPENED         CLUP21 26460022
         XC    QCBMSGCT(2),QCBMSGCT     CLEAR MSG CNT TO ZERO    S21101 26550022
         MVI   AVTSAVE1,AVTEZERO        SET PRILVL INDEX=ZERO  @SA72478 26590058
         XC    AVTSAVE4+60(3),AVTSAVE4+60 CLEAR FEFO VALUE     @OX16402 26610000
QMJ35    EQU   *                                                        26640022
         TM    CKPFLAGS,CKPFSCN1+CKPFSCN2                       SA51078 26730022
*                                       FIFO SCANS IN PROGRESS  SA51078 26820022
         BZ    FEFOSCAN                 BRANCH IF NO            SA51078 26910022
         EJECT                                                  SA51078 27000022
****************************************************************SA51078 27090022
*        PERFORM TWO FIFO SCANS.                                SA51078 27180022
*                                                               SA51078 27270022
*        SCAN ONE                                               SA51078 27360022
*        SCAN THE QUEUES IN FIFO ORDER STARTING FROM            SA51078 27450022
*        CHECKPOINTED QCBPQBCK UPDATING QCBQBACK AND            SA51078 27540022
*        QCBPQBCK AS FAR AS POSSIBLE WITHOUT RECHAINING.        SA51078 27630022
*                                                               SA51078 27720022
*        SCAN TWO                                               SA51078 27810022
*        SCAN THE QUEUES IN FIFO ORDER STARTING FROM            SA51078 27900022
*        THE UPDATED QCBPQBCK.  THIS SCAN IS NECESSARY TO       SA51078 27990022
*        UPDATE QCBQBACK AND QCBPQBCK.  THE TECHNIQUE IS TO     SA51078 28080022
*        READ QCBPQBCK READ PRFNHDR READ PRFHQBCK-PRFTQBCK      SA51078 28170022
*        UNTIL EITHER A LOGICAL READ ERROR OR ONE OF THE STOP   SA51078 28260022
*        CONDITIONS OCCUR.  THEN RECHAIN EVERY THING WE HAVE    SA51078 28350022
*        READ IF WE STOPED BECAUSE OF A LOGICAL READ ERROR.     SA51078 28440022
****************************************************************SA51078 28530022
         SPACE 3                                                SA51078 28620022
FIFOSCNS EQU   *                                                SA51078 28710022
         MVC   CPBADDR+1(3),QCBDNHDR    SET TO START OF READ    SA51078 28800022
*                                       IF QCBPQBCK IS ZERO     SA51078 28890022
         NC    QCBPREVF,QCBPREVF        PREVF ZERO              SA50192 28980022
         BZ    USEDNHDR                 BRANCH IF YES           SA50192 29070022
         MVC   CPBADDR+1(3),QCBPREVF    SET START OF READ       SA50192 29160022
*                                       IF QCBPFEFO IS ZERO     SA50192 29250022
         NC    QCBPFEFO,QCBPFEFO        PFEFO ZERO              SA50192 29340022
         BNZ   USEDNHDR                 BRANCH IF NO            SA50192 29430022
         MVC   QCBPQBCK,QCBPREVF        SET PQBCK BACK          SA50192 29520022
USEDNHDR EQU   *                                                SA50192 29610022
         NC    QCBPQBCK,QCBPQBCK        PQBCK ZERO              SA51078 29700022
         BZ    RDDNHDR                  BRANCH IF YES           SA51078 29790022
         MVC   CPBADDR+1(3),QCBPQBCK    READ PQBCK              SA51078 29880022
RDDNHDR  EQU   *                                                SA51078 29970022
         MVI   ACTCODE,RKDH             SET CODE FOR READ HDR  @YA11145 30010058
         BAL   R14,QMJ91                READ                    SA51078 30060022
         CLC   CPBADDR+1(3),PRFCRCD     LOGICAL READ ERROR      SA51078 30150022
         BNE   NXTPQCB                  BRANCH IF YES           SA51078 30240022
         NC    QCBPQBCK,QCBPQBCK        PQBCK SET               SA51078 30330022
         BNZ   PQBCKSET                 BRANCH IF YES           SA51078 30420022
         NC    PRFHQBCK,PRFHQBCK        FIRST MSG ON QUEUE      SA61769 30450022
         BNZ   STBKFRST                 BRANCH IF NO            SA61769 30480022
         MVC   QCBPQBCK,PRFCRCD         SET PQBCK               SA51078 30510022
PQBCKSET EQU   *                                                SA51078 30600022
         L     R15,TRMDESTQ-1           LOAD MASTER QCB ADDR    SA61769 30603022
         NC    QCBQBACK-IEDQQCB(,R15),QCBQBACK-IEDQQCB(R15)     SA61769 30606022
*                                       QBACK SET               SA61769 30609022
         BNZ   QBCKSET                  BRANCH IF YES           SA61769 30612022
         MVC   QCBQBACK-IEDQQCB(,R15),QCBPQBCK                  SA61769 30615022
*                                       SET QBACK               SA61769 30618022
QBCKSET  EQU   *                                                SA61769 30621022
         MVC   CKPSAVE2+8(3),PRFCRCD    SAVE HDR ADDR           SA61769 30630022
         BAL   R14,READMSG              READ THE ENTIRE MSG     SA61769 30660022
         BAL   R14,CHKIFEFO             GO CHK IF FIRST         SA50192 30690022
         LA    R1,QCBDNHDR              SET MOVE TO ADDRESS    @SA71107 30730056
         LA    R15,PRFNHDR              SET MOVE FROM ADDRESS  @SA71107 30740056
         BAL   R14,MOVER                CHECK DNHDR            @SA71107 30750056
         MVC   CPBADDR+1(3),PRFNHDR     READ NXT HDR IN FIFO    SA51078 30780022
RDFIFO1  EQU   *                                                SA51078 30870022
         MVI   ACTCODE,RKDH             SET CODE FOR READ HDR  @YA11145 30910058
         BAL   R14,QMJ91                READ                    SA51078 30960022
         CLC   CPBADDR+1(3),PRFCRCD     LOGICAL READ ERROR      SA51078 31050022
         BNE   NXTPQCB                  BRANCH IF YES           SA51078 31140022
STBKFRST EQU   *                                                SA61769 31180022
         LA    R1,QCBDNHDR              SET MOVE TO ADDRESS    @SA71107 31230056
         LA    R15,PRFNHDR              SET MOVE FROM ADDRESS  @SA71107 31330056
         BAL   R14,MOVER                CHECK DNHDR            @SA71107 31430056
         MVC   CKPSAVE2+8(3),PRFCRCD    SAVE HDR ADDR           SA51078 31590022
         MVC   CKPSAVE2(3),PRFCRCD      SAVE LAST GOOD READ     SA51078 31680022
         MVC   CKPSAVE2+3(3),PRFNHDR    SAVE NXT HDR IN FIFO    SA51078 31770022
         SPACE 1                                                SA51078 31860022
         BAL   R14,READMSG              READ THE ENTIRE MSG     SA61769 31950022
CHKSTOP  EQU   *                                                SA51078 34650022
         BAL   R14,CHKIFEFO             GO CHK IF FIRST         SA50192 34740022
         TM    AVTCKELF,AVTNQBCK        RETRIEVAL NEEDED       @OS77945 34770000
         BO    SETNEXT                  NO, READ FORWARD ONLY  @OS77945 34800000
         L     R15,TRMDESTQ-1           MASTER QCB ADDR         SA51078 34830022
         CLC   QCBPQBCK,PRFCRCD         READ PQBCK              SA51078 34920022
         BE    SETPQBCK                 BRANCH IF YES           SA51078 35010022
         CLC   QCBQBACK-IEDQQCB(,R15),PRFCRCD                   SA51078 35100022
*                                       READ QBACK              SA51078 35190022
         BE    SETQBCK                  BRANCH IF YES           SA51078 35280022
         BAL   R14,SETQBKPT             SET REG 1 EQUAL QBACK   SA50192 35370022
         MVC   CPBADDR+1(3),0(R1)       SET READ ADDR           SA51078 35460022
         MVI   ACTCODE,RKDQ             SET CODE = READ QBACK  @YA11145 35500058
         BAL   R14,QMJ91                READ                    SA51078 35550022
         CLC   CPBADDR+1(3),PRFCRCD     LOGICAL READ ERROR      SA51078 35640022
         BNE   RECHAIN1                 BRANCH IF YES           SA51078 35730022
         MVC   CKPSAVE2(3),PRFCRCD      SAVE LAST GOOD READ     SA51078 35820022
         B     CHKSTOP                  BRANCH TO CHK STOP CONDXSA51078 35910022
SETPQBCK EQU   *                                                SA51078 36000022
         CLC   QCBQBACK-IEDQQCB(,R15),QCBPQBCK                  SA51078 36090022
*                                       PQBCK AND QBACK EQUAL           36180022
         BNE   SETPQCB                  BRANCH IF NO            SA51078 36270022
SETQBCK  EQU   *                                                SA51078 36360022
         MVC   QCBQBACK-IEDQQCB(,R15),CKPSAVE2+8                SA51078 36450022
*                                       UPDATE QCBQBACK         SA51078 36540022
SETPQCB  EQU   *                                                SA51078 36630022
         MVC   QCBPQBCK,CKPSAVE2+8      UPDATE PQCB BACK CHAIN  SA51078 36720022
SETNEXT  EQU   *                                               @OS77945 36760000
         MVC   CPBADDR+1(3),CKPSAVE2+3  UPDATE READ ADDR TO     SA51078 36810022
*                                       THE NEXT HDR IN FIFO    SA51078 36900022
         B     RDFIFO1                  GO READ                 SA51078 36990022
RECHAIN1 EQU   *                                                SA51078 37080022
         TM    CKPFLAGS,CKPFSCN1        FIFO SCAN 1 IN PROGRESS SA51078 37170022
         BZ    STRCHAIN                 BRANCH IF NO            SA61769 37260022
         NC    QCBPQBCK,QCBPQBCK        PQBCK SET               SA61769 37270022
         BNZ   NXTPQCB                  BRANCH IF YES           SA61769 37280022
         MVC   QCBPQBCK,CKPSAVE2+8      SET PQBCK              @SA72478 37290058
         B     USEDNHDR                 BRANCH TO RE-SCAN FIFO  SA61769 37300022
STRCHAIN EQU   *                                                SA61769 37310022
         MVC   CPBADDR+1(3),CKPSAVE2    READ LAST GOOD ONE READ SA51078 37350022
         MVI   ACTCODE,UPDATE           SET CODE FOR UPDATE    @YA11145 37390058
         BAL   R14,QMJ91                READ                    SA51078 37440022
         L     R15,TRMDESTQ-1           MASTER QCB ADDR         SA51078 37530022
         BAL   R14,SETQBKPT             SET REG 1 EQUAL QBACK   SA51078 37620022
         MVC   0(3,R1),QCBQBACK-IEDQQCB(R15)                    SA51078 37710022
*                                       LINK INTO QBACK CHAIN   SA51078 37800022
         BAL   R14,QMJ94                WRITE                   SA51078 37980022
         B     SETQBCK                  BRANCH TO UPDATE QCB    SA51078 38070022
         EJECT                                                          38071222
CHKIFEFO EQU   *                                                SA50192 38160022
         NC    QCBPFEFO,QCBPFEFO        PFEFO ZERO              SA50192 38250022
         BCR   7,R14                    BRANCH IF NO            SA50192 38340022
         TM    DATFLAGS-IEDQDATA(R4),DATIFEFO                   SA50192 38430022
*                                       INITIAL FEFO MSG        SA50192 38520022
         BCR   8,R14                    BRANCH IF NO            SA50192 38610022
         TM    PRFSTAT1,PRFNHDRN        IS THIS A HEADER       @SA72478 38616058
         BOR   R14                      NO, RETURN             @SA72478 38622058
         STM   R14,R15,AVTSAVE3+12      SAVE REGS              @SA72478 38628058
         LH    R1,PRFDEST               GET DEST OFFSET        @SA72478 38634058
         N     R1,AVTCLRHI              GET ADDR OF TNTCODE    @SA72478 38640058
         L     R15,AVTRNMPT             GET ADDR OF TNTCODE    @SA72478 38646058
         BALR  R14,R15                  LINK TO GET TERM ADDR  @SA72478 38652058
         LM    R14,R15,AVTSAVE3+12      RESTORE REGS           @SA72478 38658058
         CLC   TRMDESTQ-IEDQTRM(,R1),TRMDESTQ SAME DESTINATION @SA72478 38664058
         BNER  R14                      NO, RETURN             @SA72478 38670058
         CLC   PRFPLQCB,AVTSAVE1        SAME PRIORITY LEVEL    @SA72478 38676058
         BNER  R14                      NO, RETURN             @SA72478 38682058
         MVC   QCBPFEFO,PRFCRCD         SET VALID START POINT   SA50192 38700022
         OI    QCBCFHDR,QCBINCR         QCBPFEFO UPDATED       @OX20945 38740082
         BR    R14                      RETURN                  SA50192 38790022
SETQBKPT EQU   *                                                SA51078 38880022
         STM   R14,R15,AVTSAVE3+12      SAVE REGS               SA51078 38970022
         LA    R1,PRFTQBCK              SET REG 1 EQUAL TQBCK   SA51078 39060022
         TM    PRFSTAT1,PRFNHDRN        READ A HDR              SA51078 39150022
         BO    USETQBCK                 BRANCH IF NO            SA51078 39240022
         TM    PRFSTAT1,PRFNLSTN        HDR LAST                SA51078 39330022
         BO    USEHQBCK                 BRANCH IF NO            SA51078 39420022
         LH    R1,PRFDEST               LOAD DEST OFFSET        SA51078 39510022
         N     R1,AVTCLRHI              CLEAR HI-ORDER BYTES    SA51078 39600022
         L     R15,AVTRNMPT             TERM NAME ROUTINE       SA51078 39690022
         BALR  R14,R15                  LINK TO IT              SA51078 39780022
         CLC   TRMDESTQ-IEDQTRM(,R1),TRMDESTQ                   SA51078 39870022
*                                       SAME QCB                SA51078 39960022
         LA    R1,PRFTQBCK              SET REG 1 EQUAL TQBCK   SA51078 40050022
         BNE   USETQBCK                 BRANCH IF NO            SA51078 40140022
USEHQBCK EQU   *                                                SA51078 40230022
         LA    R1,PRFHQBCK              SET REG 1 EQUAL HQBCK   SA51078 40320022
USETQBCK EQU   *                                                SA51078 40410022
         LM    R14,R15,AVTSAVE3+12      RESTORE REGS            SA51078 40500022
         BR    R14                      RETURN                  SA61769 40506022
         SPACE 3                                                        40512022
READMSG  EQU   *                                                SA61769 40518022
*************************************************************** SA61769 40524022
*        READ MSG TEST RECORDS WHEN THE FEFO POINTER IS ZERO    SA61769 40530022
*        TO INSURE THAT RADDR AND NADDR ARE FAR ENOUGH UP       SA61769 40536022
*        AND IF A LOGICAL READ ERROR IS FOUND, UPDATE THE       SA61769 40542022
*        INPUT SEQUENCE NUMBER                                  SA61769 40548022
*************************************************************** SA61769 40554022
         ST    R14,CPBLCB               SAVE 14                 SA61769 40560022
         TM    DATFLAGS-IEDQDATA(R4),DATSENT+DATCNCLD          @SA75766 40566058
*              WAS MSG SENT OR CANCELED                        @SA75766 40567058
         BNZR  R14                      RETURN IF EITHER       @SA75766 40568058
         NC    DATFEFO-IEDQDATA(3,R4),DATFEFO-IEDQDATA(R4)     @SA75766 40569058
*                                       IS THE FEFO PTR ZERO    SA61769 40572022
*        CANCELLED AND SERVICED MESSAGES ARE NOT READ           SA61769 40578022
         BNZR  R14                      BR NOT ZERO             SA61769 40584022
CHKLAST  EQU   *                                                SA51078 40590022
         MVC   CPBADDR+1(3),PRFXTRA     XTRA ADDR               SA51078 40592022
         LH    R14,PRFSIZE              LOAD PRFSIZE            SA51078 40594022
         N     R14,AVTCLRHI             CLEAR HI-ORDER BYTES    SA51078 40596022
         SH    R14,AVTKEYLE             MORE EXTRA SEGMENTS     SA51078 40600022
         BNP   SETRRN                   BRANCH IF NO            SA51078 40602022
UNITLP   EQU   *                                               @SA71083 40603056
         L     R1,CPBADDR               LOAD RRN ADDR           SA51078 40604022
         LA    R1,INCR(R1)              INCR TO NEXT XTRA       SA51078 40606022
         ST    R1,CPBADDR               UPDATE RRN ADDR         SA51078 40608022
         SH    R14,AVTKEYLE             MORE EXTRA SEGMENTS    @SA71083 40610056
         BP    UNITLP                   BRANCH IF YES          @SA71083 40612056
         BAL   R14,QMJ96                UPDATE RADDR OR NADDR   SA51078 40614022
         LA    R15,INCR                 SET REG15 POSITIVE     @SA72478 40614558
SETRRN   EQU   *                                                        40615056
         TM    PRFSTAT1,PRFNLSTN        LAST SEGMENT            SA51078 40616022
         BZ    REREAD                   BRANCH IF YES           SA51078 40618022
         MVC   CPBADDR+1(3),PRFNTXT     READ NEXT SEGMENT       SA51078 40620022
         MVI   ACTCODE,RKDT             SET CODE FOR READ TXT  @YA11145 40621058
         BAL   R14,QMJ91                READ                    SA51078 40622022
         CLC   PRFCRCD,CPBADDR+1        LOGICAL READ ERROR      SA51078 40624022
         BE    CHKLAST                  BRANCH IF NO            SA51078 40626022
*        THIS INSTRUCTION ASSUMES THAT R15 WILL BE A POSITIVE   SA61769 40628022
*        NUMBER AS A RESULT OF THE SUBROUTINE QMJ96             SA61769 40630022
         LNR   R15,R15                  SET READ ERROR FLAG     SA61769 40632022
REREAD   EQU   *                                                SA61769 40634022
         MVC   CPBADDR+1(3),CKPSAVE2+8  RE-READ ORIG. HDR       SA61769 40636022
         MVI   ACTCODE,RKDH             SET CODE FOR READ HDR  @YA11145 40637058
         BAL   R14,QMJ91                READ                    SA61769 40638022
         LTR   R15,R15                  LOGICAL READ ERROR      SA61769 40640022
         BP    RETURN                   BR NO                   SA61769 40642022
         NC    PRFISEQ,PRFISEQ          IS THERE A SEQ IN NO    SA61769 40644022
         BZ    RETURN                   BRNO                    SA61769 40646022
         LH    R1,PRFSRCE               SOURCE OFFSET           SA61769 40648022
         N     R1,AVTCLRHI              CLEAR HI BYTE           SA61769 40650022
         BZ    RETURN                   IF NO SOURCE RTN        SA61769 40652022
         L     R15,AVTRNMPT             ADDR OF TRM OFFSET      SA61769 40654022
         BALR  R14,R15                  GET TERN ENTRY FOR SRCE SA61769 40656022
         LA    R1,TRMINSEQ-IEDQTRM(,R1) POINT TO INSEQ         @OX16402 40658000
         LH    R15,PRFISEQ              GET INPUT SEQ NUMBER   @OX16402 40658400
         N     R15,AVTCLRHI             CLEAR HI BYTES         @OX16402 40658800
         BAL   R14,Q835                 BRANCH TO UPDATE NUMBER@OX16402 40659200
*        SINCE THIS IS THE LAST MSG FROM THIS SRCE, RESET SEQ INSA61769 40660022
RETURN   EQU   *                                                SA61769 40662022
         L     R14,CPBLCB               RESTORE 14              SA61769 40664022
         BR    R14                      RETURN                  SA61769 40666022
         EJECT                                                          40667422
         SPACE 3                                                SA61769 40668022
FEFOSCAN EQU   *                                                SA51078 40680022
         TM    AVTBIT3,AVTSTAYN         CHECK FOR SCANNING SPECI-      X40770022
                                        FIED ON INTRO OPERAND 'S='      40860022
         BNO   SCANSTRT                 BR IF MSG QUEUES ARE TO SA52971 40950022
*                                         BE SCANNED            SA52971 41040022
         MVC   CPBADDR+1(3),QCBLFEFO    SET TO WRITE TO LFEFO   SA52971 41130022
         MVC   DATFLAGS-IEDQDATA(6,R4),QCBDATFL SET FLAGS AND   SA52971 41220022
*                                         SEQUENCE OUT NUMBER   SA52971 41310022
         XC    DATFEFO-IEDQDATA(3,R4),DATFEFO-IEDQDATA(R4) END  SA52971 41400022
*                                         FEFO CHAIN            SA52971 41490022
         BAL   R14,QMJ92                GO WRITE FEFO CHAIN END SA52971 41580022
SCANSTRT EQU   *                                                SA52971 41670022
         MVC   QCBINTFF,QCBFFEFO        SAVE FFEFO FIELD        SA59195 41760022
         NC    QCBFFEFO,QCBFFEFO        IS FFEFO ZERO           SA59195 41850022
         BNZ   FEFOSVD                  NO, BRANCH              SA59195 41940022
         NC    QCBLFEFO,QCBLFEFO        IS LFEFO ZERO           SA59195 42030022
         BZ    FEFOSVD                  YES, BRANCH             SA59195 42120022
         TM    AVTBIT3,AVTSTAYN         SCAN SPECIFIED         @OZ14161 42122000
         BO    NODECRE                  NO                     @OZ14161 42124000
         TM    TRMSTATE,X'24'           SYNC                   @OZ14161 42126000
         BO    NODECRE                  YES                    @OZ14161 42128000
         L     R14,TRMDESTQ-1           QCB ADDR               @OZ17620 42128100
         TM    QCBLINK+2-IEDQQCB(R14),QCBDECRE      QCB BEEN   @OZ17620 42128200
*                                          DECREMENTED         @OZ17620 42128300
         BO    NODECRE                  YES, BRANCH            @OZ17620 42128400
         OI    QCBLINK+2-IEDQQCB(R14),QCBDECRE SET FOR 2ND TIME@OZ17620 42128500
         TM    AVTBIT3,AVTSTAYN         SCAN SPECIFIED         @OZ14161 42128600
         BO    NODECRE                  NO                     @OZ14161 42128700
         TM    TRMSTATE,X'24'           SYNC                   @OZ14161 42128800
         BO    NODECRE                  YES                    @OZ14161 42128900
         CLC   TRMOUTSQ,TWO             IS THE OUTPUT SEQ TWO  @SA74246 42130058
         BNE   NODECRE                  NO, SKIP NEXT INSTRUCT.@SA74246 42140058
         MVI   TRMOUTSQ+1,ONE           SET OUTPUT SEQ TO ONE  @SA74246 42150058
NODECRE  EQU   *                                               @SA74246 42160058
         MVC   CPBADDR+1(3),QCBLFEFO    SET UP TO READ LFEFO    SA59195 42210022
         MVI   ACTCODE,RKDH             SET CODE FOR READ HDR  @YA11145 42250058
         BAL   R14,QMJ91                READ                    SA59195 42300022
         CLC   PRFCRCD,CPBADDR+1        LOGICAL READ ERROR      SA59195 42390022
         BNE   FEFOSVD                  YES, BRANCH             SA59195 42480022
         MVC   QCBINTFF,DATFEFO-IEDQDATA(R4) SAVE FEFO POINTER  SA59195 42570022
FEFOSVD  EQU   *                                                SA59195 42660022
         NC    QCBPFEFO(3),QCBPFEFO     HAVE A START POINT      SA52971 42750022
         BNZ   STRTSCAN                 YES, CONTINUE           SA52971 42840022
         TM    AVTBIT3,AVTSTAYN         IS A SCAN TO BE DONE    SA61740 42870000
         BO    STRTSCAN                 BR IF NO SCAN           SA61740 42900000
         MVC   QCBPFEFO(3),QCBDNHDR     SET TEMPORARY START POINSA52971 42930022
STRTSCAN EQU   *                                                SA52971 43020022
         NC    QCBINTFF,QCBINTFF        IS SAVED FFEFO ZERO     SA61741 43030000
         BNZ   NOSET                    BR IF SET ALREADY       SA61741 43040000
         MVC   QCBINTFF,QCBPFEFO        SET FEFO AS FOUND       SA61741 43050000
NOSET    EQU   *                                                SA61741 43060000
         MVC   CPBADDR+1(3),QCBPFEFO    MOVE RCD NUM TO CPB     SA52971 43110022
         XC    AVTSAVE4+56(3),AVTSAVE4+56                      @SA75766 43120058
         NC    QCBFFEFO,QCBFFEFO        ANYTHING IN FFEFO      @SA75766 43130058
         BZ    NOFEFO                   NO,BRANCH              @SA75766 43140058
         CLC   QCBFFEFO,QCBLFEFO        ONLY ONE MESSAGE       @SA75766 43150058
         BE    NOFEFO                   YES,BRANCH             @SA75766 43155058
         MVC   AVTSAVE4+56(3),QCBLFEFO  SAVE STOP POINT FOR    @SA75766 43160058
*                                       HEADER-TO-HEADER SCAN  @SA75766 43170058
NOFEFO   EQU   *                                               @SA75766 43180058
         SPACE 3                                                        43200022
*SCAN QUEUES AND UPDATE DISK POINTERS IN QCBS. IF CKPT FLAG IN          43290022
*QCBFLAG IS 0,THE QCB HAS ALREADY BEEN PROCESSED.                       43380022
         SPACE                                                          43470022
         MVC   AVTSAVE3+17(3),AVTSAVE4+60 SAVE PREVIOUS VALUE  @OX16402 43474000
         NC    QCBLFEFO,QCBLFEFO        ZERO LFEFO             @OX16402 43478000
         BZ    CKFFEFO                  YES, CHECK FFEFO       @OX16402 43482000
         MVC   AVTSAVE4+60(3),QCBLFEFO  SAVE LFEFO             @OX16402 43486000
         B     CKSEQRTN                 BRANCH TO COMPARE      @OX16402 43490000
CKFFEFO  EQU   *                                               @OX16402 43494000
         NC    QCBFFEFO,QCBFFEFO        FFEFO ZERO             @OX16402 43498000
         BZ    CKPFEFO                  YES                    @OX16402 43502000
         MVC   AVTSAVE4+60(3),QCBFFEFO  SAVE FFEFO             @OX16402 43506000
         B     CKSEQRTN                 BRANCH TO COMPARE      @OX16402 43510000
CKPFEFO  EQU   *                                               @OX16402 43514000
         NC    QCBPFEFO,QCBPFEFO        ZERO PFEFO             @OX16402 43518000
         BZ    CKSEQRTN                 YES,UPDATE SEQ IN      @OX16402 43522000
         MVC   AVTSAVE4+60(3),QCBPFEFO  SAVE PFEFO             @OX16402 43526000
CKSEQRTN EQU   *                                               @OX16402 43530000
         CLC   AVTSAVE3+17(3),AVTSAVE4+60 NEW VALUE GREATER    @OX16402 43534000
         BL    CLEARQCB                 YES                    @OX16402 43538000
         MVC   AVTSAVE4+60(3),AVTSAVE3+17 UPDATE COMPARE VALUE @OX16402 43542000
CLEARQCB EQU   *                                               @OX16402 43546000
         XC    QCBDATFL(6),QCBDATFL     CLEAR ALL OF QCB BUT    SA59195 43560022
         XC    QCBINTLF(9),QCBINTLF     THE SAVED FFEFO FIELD   SA59195 43650022
         MVC   QCBPREVF,QCBPQBCK        SAVE STARTING PQBCK     SA51078 43740022
         SPACE 3                                                        43830022
*BEGINNING OF LOOP THROUGH MESSAGES ON FEFO QUEUE.               CLUP21 43920022
         SPACE 3                                                SA52971 44010022
*THE FOLLOWING FIELDS ARE FOR TEMPORARY SAVING OF RECORD NUMBERS:S21101 44100022
*CKPSAVE1+4 - 6 BYTE FIELD OF CURRENT HEADER AS READ FROM DISK  SA52971 44190022
*CKPSAVE2   - 6 BYTE FIELD OF CURRENT HEADER AS READ FROM DISK  SA52971 44280022
*CKPSAVE2+8 - NUMBER OF CURRENT HEADER                          SA52971 44370022
*CPBADDR+1  - NUMBER OF MSG UNIT CURRENTLY BEING ACCESSED       SA52971 44460022
*QCBPFEFO   - NUMBER OF LAST SERVICED MSG ENCOUNTERED DURING    SA52971 44550022
*             SCAN PRIOR TO FIRST UNSERVICED MSG                SA52971 44640022
         SPACE                                                          44730022
QMJ57    EQU   *                                                        44820022
         NC    CPBADDR+1(3),CPBADDR+1   CHECK FOR ZERO RCD NUMBERS21101 44910022
         BZ    QMJ5701                  BRANCH IF END OF QUEUE   CLUP21 45000022
         MVI   ACTCODE,RKDH             SET CODE FOR READ HDR  @YA11145 45040058
         BAL   R14,QMJ91                READ HEADER (KEY AND DATA)      45090022
         MVC   CKPSAVE2+8(3),PRFCRCD    SAVE HEADER RCD NUMBER  SA52971 45180022
         CLC   CPBADDR+1(3),PRFCRCD     CHECK FOR LOGICAL READ ERR      45270022
         BNE   QMJ5701                  BR IF YES TO CHAIN END   CLUP21 45360022
         SPACE 3                                                        45450022
*CHECK TYPE OF MESSAGE FOR SERVICED,CANCELLED OR INCOMPLETE             45540022
         SPACE                                                          45630022
         LR    R13,R0                   SAVE ADDR OF DISPATCHER  A42409 45720022
         LH    R1,PRFDEST               GET DESTINATION FROM MSG   1105 45810022
         N     R1,AVTCLRHI              CLEAR HIGH ORDER HALF WORD 1105 45900022
         BZ    QMJ5701                  BRANCH IF NO DESTINATION   0108 45990022
         L     R15,AVTRNMPT             ADDR OF TERMNAME CODE      1105 46080022
         CH    R1,TNTLEN-IEDQTNTD(,R15) CHECK COUNT OF TERM ENTRIES1202 46170022
         BH    QMJ5701                  BRANCH IF INVALID OFFSET   1202 46260022
         BALR  R14,R15                  GET ADDR OF TERM ENTRY IN R1105 46350022
         LR    R0,R13                   RESTORE DISPATCHER ADDR  A42409 46440022
         CLC   TRMDESTQ,TRMDESTQ-IEDQTRM(R1) CHECK QCB ADDR        1105 46530022
         BNE   QMJ5701                  BRANCH IF MSG NOT FOR QCB  1105 46620022
         LR    R8,R1                    USE DESTINATION TERMINAL S21101 46710022
         LH    R1,PRFSRCE               GET SOURCE OFFSET FROM PRF      46800022
         N     R1,AVTCLRHI              CLEAR HIGH ORDER HALF WORD      46890022
         BZ    QMJ61                    BRANCH  IF NO SOURCE PROVID     46980022
         BALR  R14,R15                  GET ADDRESS OF TERM ENTRY       47070022
         LR    R0,R13                   RESTORE DISPATCHER ADDR  A42409 47160022
         L     R15,TRMDESTQ-1-IEDQTRM(,R1) ADDRESS OF SOURCE QCBSA52971 47250022
         TM    TRMSTATE-IEDQTRM(R1),TRMLOG PROCESS ENTRY        SA59179 47280005
         BM    QMJ59                    YES,UPDATE FIELDS       SA59179 47310005
         TM    QCBDSFLG-IEDQQCB(R15),QCBDISK CHECK FOR DISK Q'S SA52971 47340022
         BZ    QMJ61                    BRANCH IF CORE ONLY        0108 47430022
QMJ59    EQU   *                                                SA59179 47470005
         LH    R15,PRFISEQ              GET SEQ-IN FROM PREFIX     0825 47520022
         N     R15,AVTCLRHI             CHECK FOR ZERO INPUT   @SA70665 47540056
*                                       SEQUENCE NUMBER        @SA70665 47560056
         BZ    QMJ61                    YES                    @SA70665 47580056
         TM    DATFLAGS-IEDQDATA(R4),DATCNCLD WAS MSG CANCLD   @SA74049 47590058
         BO    QMJ61                    BR IF YES              @SA74049 47600058
         MVC   AVTSAVE3+17(3),PRFCRCD   SET TO COMPARE CRCD    @OX16402 47600600
         LA    R15,AVTSAVE4+60          PICK UP COMPARE ARG    @OX16402 47601200
         LA    R1,AVTSAVE3+17           TO ADDRESS             @OX16402 47601800
         BAL   R14,MOVER                COMPARE DISK ADDRESS   @OX16402 47602400
         CLC   AVTSAVE3+17(3),PRFCRCD   IS IT STILL CRCD       @OX16402 47603000
         BNE   DONTCHK                  NO,CRCD LOW            @OX16402 47603600
         CLC   AVTSAVE3+17(3),AVTSAVE4+60 EQUAL ?              @OX16402 47604200
         BNE   UPDATSQ                  NO, UPDATE SEQ NUMBER  @OX20945 47604882
         TM    QCBCFHDR,QCBINCR         QCBPFEFO UPDATED       @OX20945 47604982
         BNO   DONTCHK                  NO, DON'T UPDATE       @OX20945 47605082
UPDATSQ  EQU   *                                               @OX16402 47605400
         L     R15,AVTRNMPT             ADDR OF TERMNAME CODE  @OX16402 47606000
         LH    R1,PRFSRCE               PICK UP SOURCE         @OX16402 47606600
         BALR  R14,R15                  GET SOURCE TERM ENTRY  @OX16402 47607200
         LR    R0,R13                   RESTORE DISPATCHER ADDR@OX16402 47607800
         LH    R15,PRFISEQ              RESET ISEQ TO COMPARE  @OX16402 47608400
         LA    R1,TRMINSEQ-IEDQTRM(R1)  ADDR OF SEQUENCE NUMBER    1029 47610022
         BAL   R14,Q835                 BR TO UPDATE SEQ NUM     CLUP21 47700022
DONTCHK  EQU   *                                               @OX16402 47740000
QMJ61    EQU   *                                                        47790022
         USING IEDQTRM,R8               BASE REG FOR TERM ENTRY@OZ08356 47800000
         TM    TRMSTATE,TRMLOG          IS THIS A LOGTYPE ENTRY SA61045 47820022
         BM    SEQOK                    BR IF YES               SA61045 47850022
         TM    DATFLAGS-IEDQDATA(R4),DATSENT HAS MSG BEEN SERVCESA59195 48240022
         BO    SEQOK                    YES, BRANCH             SA59195 48330022
         TM    QCBCFHDR,QCBSQDEC        WAS SEQ NO. DECREMENTED@OZ08356 48420000
         BO    CKSEQ                                           @OY11175 48510058
CKHOLD   EQU   *                                               @OY11175 48550058
         TM    TRMSTATE,TRMHELDN        IS TERMINAL HELD        SA59195 48600022
         BO    SEQOK                    YES                     SA59195 48690022
         CLC   QCBINTFF,PRFCRCD         IS THIS FFEFO          @ZA02629 48720058
         BE    NODECR                   YES, FFEFO             @ZA02629 48750058
         LH    R15,TRMOUTSQ             GET OUTPUT SEQ NUMBER   SA59195 48780022
         BCTR  R15,0                    DECREMENT BY ONE        SA59195 48870022
         LTR   R15,R15                  CHECK FOR ZERO OR NEG   SA59195 48960022
         BNP   NODECR                   BRANCH IF ZERO OR NEG   SA59195 49050022
         STH   R15,TRMOUTSQ             BACK UP OUTPUT SEQ NUMBRSA59195 49140022
NODECR   EQU   *                                                SA59195 49230022
         OI    QCBCFHDR,QCBSQDEC        SEQ NO. WAS DECREMENTED@OZ08356 49320000
         B     SEQOK                                           @OY11175 49329058
CKSEQ    EQU   *                                               @OY11175 49338058
         LH    R15,SEQSAVE              PICK UP SAVED SEQ NO.  @OY11175 49347058
         XC    SEQSAVE(2),SEQSAVE       CLEAR SAVE AREA        @OY11175 49356058
         LTR   R15,R15                  IS IT ZERO?            @OY11175 49365058
         BZ    SEQOK                    YES                    @OY11175 49374058
         AH    R15,AVTHA2               ADD TWO                @OY11175 49383058
         CH    R15,DATSEQOT-IEDQDATA(,R4) EQUAL TO TRMOUTSQ    @OY11175 49392058
         BE    CKHOLD                   YES                    @OY11175 49401058
SEQOK    EQU   *                                                SA59195 49410022
         LH    R15,DATSEQOT-IEDQDATA(,R4) GET OUTPUT SEQ NUMBER SA52971 49500022
         LTR   R15,R15                  IS THERE ONE            SA52971 49590022
         BZ    NOSEQ                    NO, GO SEE IF ALL THERE SA52971 49680022
         STH   R15,SEQSAVE              SAVE SEQUENCE NO.      @OY11175 49720058
         LA    R1,TRMOUTSQ              ADDRESS OF SEQUENCE NUMBER 1029 49770022
         BAL   R14,Q835                 BR TO UPDATE SEQ NUM     CLUP21 49860022
NOSEQ    EQU   *                                                SA52971 49950022
         LA    R1,QCBDNHDR              SET MOVE TO ADDRESS    @SA71107 50040056
         LA    R15,PRFNHDR              SET MOVE FROM ADDRESS  @SA71107 50140056
         BAL   R14,MOVER                CHECK DNHDR            @SA71107 50240056
         SPACE 3                                                 S21101 50400022
*DETERMINE IF MESSAGE SHOULD BE RESENT(TURN OFF SERVICED FLAG)   S21101 50490022
         SPACE 1                                                 S21101 50580022
QMJ61005 EQU   *                                                 S21101 50670022
         MVC   CKPSAVE2(6),DATFLAGS-IEDQDATA(R4) SAVE DATA FIELDSA52971 50760022
         MVC   CKPSAVE1+4(6),CKPSAVE2   SAVE HERE ALSO          SA52971 50850022
         TM    AVTBIT3,AVTSTAYN         CHECK FOR NO-SCAN REQS'DSA52971 50940022
         BO    CHKSEQ                   BR IF SCAN NOT REQUESTEDSA51078 51030022
         TM    TRMSTATE,X'24'           SYNC TPROCESS           SA52971 51120022
         BNO   QMJ68                    NO, START SCAN          SA52971 51210022
CHKSEQ   EQU   *                                                SA52971 51300022
         NC    AVTEZ(2),AVTEZ           IS THIS FIRST TIME FOR @SA70310 51390056
*                                         ENTRY                 SA52971 51480022
         BNZ   NOPREP                   NO, FIELD ALREADY INIT  SA52971 51570022
         MVC   AVTEZ(2),TRMOUTSQ        INITIALIZE             @SA70310 51660056
NOPREP   EQU   *                                                SA52971 51750022
         CLC   DATSEQOT-IEDQDATA(2,R4),AVTFZERO UNSENT MSG      SA66335 51780054
         BE    QMJ62                    BRANCH IF YES           SA66335 51810054
         CLC   DATSEQOT-IEDQDATA(2,R4),AVTEZ  SENT PRIOR TO    @SA70310 51840056
*                                        CHECKPOINT              S22024 51880022
         BL    QMJ68                    YES, DON'T RESEND       SA52971 51930022
QMJ62    EQU   *                                                SA66335 51970054
         NI    CKPSAVE2,AVTEFF-DATSENT  MARK 'UNSENT'           SA52971 52020022
         SPACE 3                                                        52110022
*CHECK FOR COMPLETELY RECEIVED MESSAGE                                  52200022
         SPACE 3                                                        52290022
*BEGINNING OF LOOP THROUGH UNITS                                        52380022
         SPACE                                                          52470022
QMJ68    EQU   *                                                        52560022
         NC    AVTSAVE4+56(3),AVTSAVE4+56                      @SA75766 52568058
         BZ    XTRALOOP                 YES,SCAN EXTRAS        @SA75766 52576058
         CLC   CKPSAVE1+5(3),AVTSAVE4+56                       @SA75766 52584058
*                                       TO CHECKPOINTED LFEFO  @SA75766 52592058
         BNE   QMJ71                    YES, NO NEED TO SCAN   @SA75766 52600058
*                                       TEXT OR XTRA SEGMENTS  @SA75766 52608058
         XC    AVTSAVE4+56(3),AVTSAVE4+56 SET TO SHOW STOP     @SA75766 52616058
*                                       POINT REACHED FOR      @SA75766 52624058
*                                       HEADER-TO-HEADER SCAN  @SA75766 52632058
XTRALOOP EQU   *                                               @SA75766 52640058
         LH    R13,PRFSIZE              GET BUFFER LENGTH        CLUP21 52650022
         N     R13,AVTCLRHI             ENSURE HALF-WORD         CLUP21 52740022
         MVC   CPBADDR+1(3),PRFXTRA     GET 1ST XTRA SEGMENT RCD        52830022
         SH    R13,AVTKEYLE             HOW MANY UNITS           CLUP21 52920022
         BP    QMJ7207                  BR IF MORE THAN ONE      CLUP21 53010022
         B     QMJ71                    BRANCH IF ONLY 1 UNIT   SA52971 53100022
QMJ7205  EQU   *                                                        53190022
         L     R1,CPBADDR                                               53280022
         LA    R1,INCR(0,R1)            GET NEXT SEQUENTIAL RCD  S21101 53370022
         ST    R1,CPBADDR                                               53460022
QMJ7207  EQU   *                                                        53550022
         BAL   R14,QMJ90                READ DATA                       53640022
         TM    DATFLAGS-IEDQDATA(R4),DATNPRFX CHECK FOR PREFIX  SA52971 53730022
         BZ    QMJ7705                  BRANCH OUT OF LOOP IF PREFX0606 53820022
         CLC   CPBADDR+1(3),DATFEFO-IEDQDATA(R4) CHECK FOR LOG  SA52971 53910022
*                                         READ ERROR            SA52971 54000022
         BNE   QMJ7705                  BRANCH IF ERROR                 54090022
         SH    R13,AVTKEYLE             ANY MORE UNITS           CLUP21 54180022
         BP    QMJ7205                  YES, GO LOOK AT IT       CLUP21 54270022
         SPACE                                                          54360022
*END OF LOOP THROUGH UNITS OF BUFFER                             CLUP21 54450022
         SPACE 3                                                        54540022
*BEGINNING OF LOOP THROUGH TEXT BUFFERS                                 54630022
         SPACE                                                          54720022
QMJ71    EQU   *                                                        54810022
         TM    PRFSTAT1,PRFNLSTN        CHECK FOR LAST BUFFER           54900022
         BZ    QMJ73                    BRANCH IF LAST          SA52971 54990022
         MVC   CPBADDR+1(3),PRFNTXT                                     55080022
         MVI   ACTCODE,RKDT             SET CODE FOR READ TXT  @YA11145 55120058
         BAL   R14,QMJ91                READ TEXT RECORD                55170022
         TM    PRFSTAT1,PRFNHDRN        CHECK FOR TEXT BUFFER      1029 55260022
         BZ    QMJ7705                  BRANCH IF NOT TEXT BUFFER  1029 55350022
         CLC   CPBADDR+1(3),PRFCRCD     CHECK FOR LOGICAL READ ERR      55440022
         BE    QMJ68                    BRANCH IF NO ERROR     @SA75766 55530058
         SPACE                                                          55620022
*END OF LOOP THROUGH TEXT BUFFERS                                       55710022
         SPACE 3                                                SA52971 55800022
*RECHAIN AROUND THIS INCOMPLETE MESSAGE                         SA52971 55890022
         SPACE 1                                                SA52971 55980022
QMJ7705  EQU   *                                                        56070022
         MVC   DATFLAGS-IEDQDATA(6,R4),QCBDATFL SET NEW DATA    SA52971 56160022
         MVC   DATFEFO-IEDQDATA(3,R4),CKPSAVE2+1 FIELD          SA52971 56250022
         MVC   CPBADDR+1(3),QCBLFEFO    SET RECORD NUMBER       SA52971 56340022
         BAL   R14,QMJ92                GO CHANGE FEFO CHAIN    SA52971 56430022
         B     QMJ78                    GO GET NEXT MSG         SA52971 56520022
         SPACE 3                                                 S21101 56610022
*UPDATE FEFO IF MESSAGE IS NOT MARKED SERVICED OR CANCELED NOW   S21101 56700022
         SPACE 1                                                 S21101 56790022
QMJ73    EQU   *                                                        56880022
         CLC   CKPSAVE2(6),CKPSAVE1+4   WAS DATA FIELD CHANGED  SA52971 56970022
         BE    NOWRT                    NO, DON'T DO WRITE      SA52971 57060022
         MVC   DATFLAGS-IEDQDATA(6,R4),CKPSAVE2 SET DATA FIELD  SA52971 57150022
         MVC   CPBADDR+1(3),CKPSAVE2+8  SET RECORD NUMBER       SA52971 57240022
         BAL   R14,QMJ92                RE-WRITE FLAGS          SA52971 57330022
NOWRT    EQU   *                                                SA52971 57420022
         NC    QCBPFEFO(3),QCBPFEFO     IS THIS FIRST MSG       SA52971 57510022
         BZ    SETPF                    YES, GO INIT PFEFO      SA52971 57600022
         NC    QCBFFEFO(3),QCBFFEFO     IS FIRST UNSENT SET     SA52971 57690022
         BNZ   QMJ76                    YES, GO SET THIS AS LASTSA52971 57780022
         TM    CKPSAVE2,DATSENT+DATCNCLD SERVICED OR CANCELLED  SA52971 57870022
         BZ    SETFF                    NO, GO SET FIRST UNSENT SA52971 57960022
SETPF    EQU   *                                                SA52971 58050022
         MVC   QCBPFEFO(3),CKPSAVE2+8   SET FIRST MSG           SA52971 58140022
         TM    CKPSAVE2,DATSENT+DATCNCLD SERVICED OR CANCELLED  SA52971 58230022
         BNZ   QMJ76                    YES, GO SET THIS AS LASTSA52971 58320022
         NC    QCBFFEFO(3),QCBFFEFO     IS FIRST UNSENT SET     SA52971 58410022
         BNZ   QMJ76                    YES, GO SET THIS AS LASTSA52971 58500022
SETFF    EQU   *                                                SA52971 58590022
         MVC   QCBFFEFO(3),CKPSAVE2+8   SET FIRST UNSENT MSG    SA52971 58680022
QMJ76    EQU   *                                                SA52971 58770022
         MVC   QCBDATFL,CKPSAVE2        SAVE DATFLAGS AND       SA52971 58860022
         MVC   QCBDATSQ,CKPSAVE2+4      SEQ OUT OF LFEFO        SA52971 58950022
         MVC   QCBLFEFO,CKPSAVE2+8      UPDATE LFEFO                    59040022
         TM    AVTBIT3,AVTSTAYN         SCAN SPECIFIED          SA51078 59130022
         BO    NOQBCK                   BRANCH IF NO            SA51078 59220022
         TM    AVTCKELF,AVTNQBCK        RETRIEVAL NEEDED       @OS77945 59230000
         BO    NOQBCK                   NO, SKIP QBACK SCAN    @OS77945 59240000
         MVC   CKPSAVE1+4(3),PRFCRCD    SAVE EOM SEG            SA66921 59250005
         MVC   CKPSAVE2+4(3),PRFCRCD    SET IN CASE NO HDR FND  SA66921 59280005
         TM    AVTBIT2,AVTEXTSC         DO EXTENTED SCAN        SA51078 59310022
         BZ    NOSRCQBK                 BRANCH IF NO            SA51078 59400022
         EJECT                                                          59490022
****************************************************************SA51078 59580022
*        IF EXTENTED RESTART IS REQUESTED AN ATTEMPT WILL BE    SA51078 59670022
*        MADE TO RE-BUILD THE SOURCE QBACK CHAIN.  THE          SA51078 59760022
*        TECHNIQUE IS UPON FINDING AN EOM SEGMENT ON THE FEFO   SA51048 59850022
*        SCAN TO READ BACK THE SOURCE QBACK CHAIN TO FIND THE   SA54078 59940022
*        FIRST HDR IN THE SOURCE QBACK CHAIN TO USE AS A        SA54078 60030022
*        STOP POINT.  THEN READ FROM QCBQBACK TO DETRMINE IF    SA51078 60120022
*        THIS EOM SEGMENT IS IN THE QBACK CHAIN AND IF NOT      SA51078 60210022
*        PUT IT IN.  IF THE SOURCE IS A PUT PROCESS ENTRY OR    SA51078 60300022
*        A INPUT ONLY TERMINAL THE END OF THE QUEUE IS USED AS  SA51078 60390022
*        A STOP POINT AND THEN THE SAME TECHNIQUE APPLIED.      SA51078 60480022
****************************************************************SA51078 60570022
         SPACE 3                                                SA51078 60660022
         LH    R1,PRFSRCE               LOAD SOURCE INDEX       SA51078 60930022
         N     R1,AVTCLRHI              CLEAR HI-ORDER BYTES    SA51078 61020022
         LTR   R1,R1                    VALID SOURCE            SA51078 61110022
         BZ    NOSRCQBK                 BRANCH IF NO            SA51078 61200022
         L     R15,AVTRNMPT             TERM NAME ROUTINE       SA51078 61290022
         BALR  R14,R15                  LINK TO IT              SA51078 61380022
         L     R15,TRMDESTQ-1-IEDQTRM(R1)                       SA51078 61470022
*                                       LOAD QCB ADDR           SA51078 61560022
         CLC   TRMDESTQ-IEDQTRM(,R1),TRMDESTQ                   SA51078 61650022
*                                       SOURCE = DEST QUEUE     SA51078 61740022
         BE    NOSRCQBK                 BRANCH IF YES           SA51078 61830022
         LR    R8,R1                    SET SOURCE TERM ADDR    SA51078 61920022
         TM    QCBFLAG-IEDQQCB(R15),QCBPROC                     SA51078 62010022
*                                       PROCESS ENTRY           SA51078 62100022
         BZ    NOTPROC                  BRANCH IF NO            SA51078 62190022
         CLI   QCBDSFLG-IEDQQCB(R15),QCBFQCB                    SA51078 62280022
*                                       PUT PROCESS ENTRY       SA51078 62370022
         BE    NODSKCHK                 BRANCH IF YES           SA51078 62460022
NOTPROC  EQU   *                                                SA51078 62550022
         TM    QCBDSFLG-IEDQQCB(R15),QCBDISK                    SA51078 62640022
*                                       ANY DISK QUEUEING       SA51078 62730022
         BZ    NOSRCQBK                 BRANCH IF NO            SA51078 62820022
NODSKCHK EQU   *                                                SA51078 62910022
         CLC   QCBQBACK-IEDQQCB(,R15),PRFCRCD                   SA51078 63000022
*                                       MSG IN QBACK CHAIN      SA51078 63090022
         BE    NOSRCQBK                 BRANCH IF YES           SA51078 63180022
         NC    QCBQBACK-IEDQQCB(,R15),QCBQBACK-IEDQQCB(R15)     SA51078 63270022
*                                       QBACK ZERO              SA51078 63360022
         BZ    RECHAIN4                 BRANCH IF YES           SA51078 63450022
FNDFHDR  EQU   *                                                SA51078 63540022
         MVC   CPBADDR+1(3),PRFTQBCK    READ SRCE QBACK         SA51078 63630022
         MVI   ACTCODE,RKDQ             SET CODE = READ QBACK  @YA11145 63670058
         BAL   R14,QMJ91                READ                    SA51078 63720022
         CLC   PRFCRCD,CPBADDR+1        LOGICAL READ ERROR      SA51078 63810022
         BNE   STSRCQBK                 BRANCH IF YES           SA51078 63900022
         CLC   PRFCRCD,QCBQBACK-IEDQQCB(R15)                    SA51078 63990022
*                                       HIT QBACK PTR           SA51078 64080022
         BE    RECHAIN6                 BRANCH IF YES           SA51078 64170022
         TM    PRFSTAT1,PRFNHDRN        HDR BUFFER              SA51078 64260022
         BO    FNDFHDR                  BRANCH IF NO            SA51078 64350022
         LH    R1,PRFDEST               LOAD DEST OFFSET        SA51078 64440022
         N     R1,AVTCLRHI              CLEAR HI-ORDER BYTES    SA51078 64530022
         L     R15,AVTRNMPT             TERM NAME ROUTINE       SA51078 64620022
         BALR  R14,R15                  LINK TO IT              SA51078 64710022
         L     R15,TRMDESTQ-1           RESTORE MASTER QCB ADDR SA51078 64800022
         CLC   TRMDESTQ-IEDQTRM(,R1),TRMDESTQ                   SA51078 64890022
*                                       HDR IN SOURCE QUEUE     SA51078 64980022
         BNE   FNDFHDR                  BRANCH IF NO            SA51078 65070022
         MVC   CKPSAVE2+4(3),PRFCRCD    SAVE FIRST HDR FOUND IN SA51078 65160022
*                                       QBACK CHAIN OF SRC QCB  SA51078 65250022
*                                       TO USE AS A STOP PTR    SA51078 65340022
         SR    R1,R1                    CLEAR REG               SA51078 65430022
         IC    R1,PRFPLQCB              GET PQCB INDEX          SA51078 65520022
         MH    R1,PQCBSZ                CALC CORRECT PQCB       SA51078 65610022
         AR    R1,R15                   PQCB ADDR               SA51078 65700022
         MVC   AVTSAVE3+17(ADDRSIZE),PRFCRCD SET PARAMETER     @SA71107 65790056
         LA    R15,QCBPQBCK-IEDQQCB(R1) SET MOVE FROM ADDRESS  @SA71107 65810056
         LA    R1,AVTSAVE3+17           SET MOVE TO ADDRESS    @SA71107 65830056
         BAL   R14,MOVER                CHECK PRFCRCD          @SA71107 65850056
         L     R15,TRMDESTQ-1           RESTORE MASTER QCB ADDR@SA71107 65870056
         SR    R1,R1                    CLEAR FOR IC           @SA71107 65890056
         IC    R1,PRFPLQCB              GET PQCB INDEX         @SA71107 65910056
         MH    R1,PQCBSZ                CALC CORRECT PQCB      @SA71107 65930056
         AR    R1,R15                   GET PQCB ADDRESS       @SA71107 65950056
         CLC   AVTSAVE3+17(ADDRSIZE),QCBPQBCK-IEDQQCB(R1) WAS  @SA71107 65970056
*                                        FIELD UPDATED         @SA71107 65990056
         BNE   RECHAIN3                 YES, PRFCRCD WAS LOWER @SA71107 66010056
*                                        THAN QCBPQBCK         @SA71107 66030056
STSRCQBK EQU   *                                                SA51078 66060022
         MVC   CPBADDR+1(3),QCBQBACK-IEDQQCB(R15)               SA51078 66150022
*                                       READ SOURCE QBACK       SA51078 66240022
RDSRCQBK EQU   *                                                SA51078 66330022
         MVI   ACTCODE,RKDQ             SET CODE = READ QBACK  @YA11145 66370058
         BAL   R14,QMJ91                READ                    SA51078 66420022
         CLC   PRFCRCD,CPBADDR+1        LOGICAL READ ERROR      SA51078 66510022
         BNE   RECHAIN3                 BRANCH IF YES           SA51078 66600022
         BAL   R14,SETQBKPT             SET REG 1 EQUAL QBACK   SA51078 66690022
         CLC   0(3,R1),CKPSAVE1+4       HIT ORGINAL EOM SEG     SA51078 66780022
         BE    NOSRCQBK                 BRANCH IF YES           SA51078 66870022
         CLC   0(3,R1),CKPSAVE2+4       HIT FIRST HDR IN QBACK  SA51078 66960022
         BE    RECHAIN5                 BRANCH IF YES           SA51078 67050022
         MVC   CPBADDR+1(3),0(R1)       READ SOURCE QBACK       SA51078 67140022
         B     RDSRCQBK                 BRANCH TO READ          SA51078 67230022
RECHAIN3 EQU   *                                                SA51078 67320022
         MVC   CPBADDR+1(3),CKPSAVE1+4  RE-READ THE EOM SEG     SA51078 67410022
         MVI   ACTCODE,UPDATE           SET CODE FOR UPDATE    @YA11145 67450058
         BAL   R14,QMJ91                READ                    SA51078 67500022
         MVC   PRFTQBCK,QCBQBACK-IEDQQCB(R15)                   SA51078 67590022
*                                       PUT IN QBACK CHAIN      SA51078 67680022
         BAL   R14,QMJ94                WRITE                   SA51078 67770022
RECHAIN4 EQU   *                                                SA51078 67860022
         MVC   QCBQBACK-IEDQQCB(,R15),PRFCRCD                   SA51078 67950022
*                                       UPDATE QCBQBACK         SA51078 68040022
         B     NOSRCQBK                 BRANCH                  SA51078 68130022
RECHAIN5 EQU   *                                                SA51078 68220022
         MVI   ACTCODE,UPDATE           SET CODE FOR UPDATE    @YA11145 68240058
         BAL   R14,QMJ91                REREAD RECORD          @YA11145 68260058
         BAL   R14,SETQBKPT             SET REG 1 TO QBACK     @YA11145 68280058
         MVC   0(3,R1),CKPSAVE1+4       PUT IN QBACK CHAIN      SA51078 68310022
         BAL   R14,QMJ94                WRITE                   SA51078 68400022
         B     NOSRCQBK                 BRANCH                  SA51078 68490022
RECHAIN6 EQU   *                                                SA51078 68580022
         MVC   QCBQBACK-IEDQQCB(,R15),CKPSAVE1+4                SA51078 68670022
*                                       UPDATE QBACK            SA51078 68760022
NOSRCQBK EQU   *                                                SA51078 68850022
         L     R8,CKPTRMAD              RESTORE REG 8           SA51078 68940022
         MVC   AVTSAVE3+17(ADDRSIZE),QCBPREVF   SET PARAMETER  @SA71107 69030056
         LA    R1,AVTSAVE3+17           SET MOVE TO ADDRESS    @SA71107 69060056
         LA    R15,CKPSAVE2+8           SET MOVE FROM ADDRESS  @SA71107 69090056
         BAL   R14,MOVER                CHECK PREVF            @SA71107 69120056
         CLC   QCBPREVF(ADDRSIZE),AVTSAVE3+17 WAS FIELD UPDATED@SA71107 69150056
         BE    NOQBCK                   NO, MSG IS IN DEST     @SA71107 69180056
*                                        QBACK CHAIN           @SA71107 69210056
         MVC   AVTSAVE3+17(ADDRSIZE),CKPSAVE2+8 SET PARAMETER  @SA71107 69240056
         LA    R15,QCBPQBCK             SET MOVE FROM ADDRESS  @SA71107 69270056
         BAL   R14,MOVER                CHECK PQBCK            @SA71107 69300056
         CLC   AVTSAVE3+17(ADDRSIZE),QCBPQBCK WAS FIELD UPDATED@SA71107 69330056
         BNE   PUTONEND                 YES, BRANCH            @SA71107 69360056
         MVC   CPBADDR+1(3),QCBPQBCK    READ PQBCK              SA51078 69390022
RDBACK   EQU   *                                                SA51078 69480022
         MVI   ACTCODE,RKDQ             SET CODE = READ QBACK  @YA11145 69520058
         BAL   R14,QMJ91                READ                    SA51078 69570022
         CLC   CPBADDR+1(3),PRFCRCD     LOGICAL READ ERROR      SA51078 69660022
         BNE   NOQBCK                   BRANCH IF YES           SA51078 69750022
         TM    PRFSTAT1,PRFNHDRN        HEADER SEGMENT          SA51078 69840022
         BO    SETRDBK                  BRANCH IF NO            SA51078 69930022
         MVC   AVTSAVE3+17(ADDRSIZE),CKPSAVE2+8 SET PARAMETER  @SA71107 70020056
         LA    R1,AVTSAVE3+17           SET MOVE TO ADDRESS    @SA71107 70040056
         LA    R15,PRFCRCD              SET MOVE FROM ADDRESS  @SA71107 70060056
         BAL   R14,MOVER                CHECK PRFCRCD          @SA71107 70080056
         CLC   AVTSAVE3+17(ADDRSIZE),PRFCRCD WAS FIELD         @OY12275 70100058
*                                        UPDATED               @SA71107 70120056
         BNE   RECHAIN2                 YES, RIGHT PLACE TO    @SA71107 70140056
*                                        PUT MSG               @SA71107 70160056
SETRDBK  EQU   *                                                SA51078 70200022
         MVC   CKPSAVE1+4(3),PRFCRCD    SAVE LAST SEGMENT READ  SA51078 70290022
         BAL   R14,SETQBKPT             SET R1 EQUAL QBACK      SA51078 70380022
         MVC   CPBADDR+1(3),0(R1)       SET READ ADDR           SA51078 70470022
         B     RDBACK                   GO READ BACK            SA51078 70560022
RECHAIN2 EQU   *                                                SA51078 70650022
         MVC   CKPSAVE2+4(3),PRFCRCD    SAVE CHAIN TO ADDR      SA51078 70740022
         MVC   CPBADDR+1(3),CKPSAVE1+4  RE-READ PREVIOUS SEG    SA51078 70830022
         MVI   ACTCODE,UPDATE           SET CODE FOR UPDATE    @YA11145 70870058
         BAL   R14,QMJ91                READ                    SA51078 70920022
         BAL   R14,SETQBKPT             SET R1 EQUAL QBACK      SA51078 71010022
         MVC   0(3,R1),CKPSAVE2+8       INSERT ORIGINAL HDR IN  SA51078 71100022
*                                       QBACK CHAIN             SA51078 71190022
         BAL   R14,QMJ94                WRITE UPDATED RECORD    SA51078 71280022
         MVC   CPBADDR+1(3),CKPSAVE2+8  READ ORGINAL HDR        SA51078 71370022
         MVI   ACTCODE,UPDATE           SET CODE FOR UPDATE    @YA11145 71410058
         BAL   R14,QMJ91                READ                    SA51078 71460022
         MVC   PRFHQBCK,CKPSAVE2+4      LINK THIS HDR           SA51078 71550022
*                                       TO ORGINAL HDR          SA51078 71640022
         BAL   R14,QMJ94                WRITE UPDATED HDR       SA51078 71730022
         B     NOQBCK                   BRANCH TO END           SA51078 71820022
PUTONEND EQU   *                                                SA51078 71910022
         MVC   CPBADDR+1(3),CKPSAVE2+8  READ ORGINAL HDR        SA51078 72000022
         MVI   ACTCODE,UPDATE           SET CODE FOR UPDATE    @YA11145 72040058
         BAL   R14,QMJ91                READ                    SA51078 72090022
         L     R15,TRMDESTQ-1           LOAD QCB ADDR           SA51078 72180022
         MVC   PRFHQBCK,QCBQBACK-IEDQQCB(R15)                   SA51078 72270022
*                                       SET QBACK PTR           SA51078 72360022
         MVC   QCBQBACK-IEDQQCB(,R15),PRFCRCD                   SA51078 72450022
*                                       UPDATE QCB BACK CHAIN   SA51078 72540022
         MVC   QCBPQBCK,PRFCRCD         UPDATE PQCB BACK CHAIN  SA51078 72630022
         BAL   R14,QMJ94                WRITE UPDATED HDR       SA51078 72720022
NOQBCK   EQU   *                                                SA51078 72810022
         TM    QCBDATFL,DATSENT+DATCNCLD WILL MSG BE SENT       SA52971 72900022
         BNZ   QMJ78                    NO, DON'T COUNT IT      SA52971 72990022
         L     R1,TRMDESTQ-1            ADDRESS OF MASTER QCB           73080022
         LA    R14,1                    INCREMENT                       73170022
         AH    R14,QCBMSGCT-IEDQQCB(,R1) ADD 1 TO COUNT OF MSG  SA52971 73260022
         STH   R14,QCBMSGCT-IEDQQCB(,R1) RESTORE COUNT          SA52971 73350022
QMJ78    EQU   *                                                SA52971 73440022
         MVC   CPBADDR+1(3),CKPSAVE2+1  GET NEXT HDR IN FEFO    SA52971 73530022
         B     QMJ57                    READ HEADER                     73620022
         SPACE                                                          73710022
*END OF LOOP FOR THIS MESSAGE                                           73800022
         SPACE 3                                                        73890022
*LOGICAL READ ERROR-RECORD READ WAS NOT RECORD REQUESTED.END OF         73980022
*FEFO CHAIN                                                     SA52971 74070022
         SPACE                                                          74160022
QMJ5701  EQU   *                                                   1105 74250022
         MVC   CPBADDR+1(3),QCBDNHDR    GET NEXT ASSIGNED HDR    S21101 74340022
         BAL   R14,QMJ96                COMPARE QCBDNHDR+1 WITH    0915X74430022
                                       RADDR OR NADDR              0915 74520022
         MVC   QCBPREVF(3),QCBPFEFO     INITIALIZE PREVIOUS FEFOSA52971 74610022
*                                         POINTER               SA52971 74700022
         MVC   CPBADDR+1(3),QCBLFEFO    LAST UNSERVICED MSG-FEFO        74790022
         MVC   DATFLAGS-IEDQDATA(6,R4),QCBDATFL RESET LFEFO'S   SA52971 74880022
*                                         FLAGS AND SEQ OUT     SA52971 74970022
         XC    DATFEFO-IEDQDATA(3,R4),DATFEFO-IEDQDATA(R4) CLEARSA52971 75060022
*                                         FEFO POINTER          SA52971 75150022
         BAL   R14,QMJ92                WRITE DATA                      75240022
         SPACE 3                                                        75330022
*GET NEXT PRIORITY LEVEL QCB.                                           75420022
         SPACE                                                          75510022
         XC    QCBINTFF,QCBINTFF        CLEAR OUT SAVED FFEFO   SA59195 75600022
         NI    QCBCFHDR,AVTEFF-QCBSQDEC RESET BIT              @OZ08356 75690000
NXTPQCB  EQU   *                                                SA51078 75780022
         IC    R14,AVTSAVE1             GET PRILVL INDEX       @SA72478 75800058
         LA    R14,ONE(R14)             BUMP BY ONE            @SA72478 75820058
         STC   R14,AVTSAVE1             SET NEW INDEX          @SA72478 75840058
         TM    CKPFLAGS,CKPFSCN1+CKPFSCN2  IN FEFO SCAN        @OX20945 75846082
         BNZ   CHECKPRI                 NO, BRANCH             @OX20945 75852082
         NI    QCBCFHDR,AVTEFF-QCBINCR  TURN OFF FLAG          @OX20945 75858082
CHECKPRI EQU   *                                               @OX20945 75864082
         CLI   QCBPRIPQ,0               CHECK FOR 0-LEVEL QCB(LAST)     75870022
         LA    R7,QCBPSIZE(0,R7)        GET NEXT QCB                    75960022
         BNE   QMJ35                    NO, BR TO PROCESS THIS  SA52971 76050022
         L     R7,TRMDESTQ-1            QCB ADDR               @OZ17620 76080000
         NI    QCBLINK+2-IEDQQCB(R7),AVTEFF-QCBDECRE RESET BIT @OZ17620 76110000
         SPACE                                                          76140022
*END OF LOOP THROUGH PRIORITY LEVEL QCBS                                76230022
         SPACE 3                                                        76320022
CLRCNT   EQU   *                                                SA52971 76410022
         L     R8,CKPTRMAD              GET CURRENT TERMINAL ENTSA52971 76500022
         XC    AVTEZ(2),AVTEZ           CLEAR TEMPORARILY USED @SA70310 76590056
*                                         SEQ NUM COUNTER       SA52971 76680022
QMJ80    EQU   *                                                   0819 76770022
         LA    R6,3(R5,R6)              MOVE PAST ADDR FIELD     S21101 76860022
         BCT   R11,QMJ10               SUB FROM NO. OF TNT ENTRSSS21101 76950022
         LM    R14,R12,AVTSAVE1+12      RESTORE REGISTERS        CLUP21 77040022
         TM    CKPFLAGS,CKPFSCN1        END OF SCAN1            SA51078 77130022
         BO    RSETSCN1                 BRANCH IF YES           SA51078 77220022
         TM    CKPFLAGS,CKPFSCN2        END OF SCAN 2           SA51078 77310022
         BZ    FREECORE                 BRANCH IF NO           @YA11145 77400058
*                                       END OF FEFO SCAN        SA51078 77490022
*                                       RETURN TO 1645          SA51078 77580022
         NI    CKPFLAGS,255-CKPFSCN2    RESET SCAN 2 IN PROG    SA51078 77670022
RSETSCN1 EQU   *                                                SA51078 77760022
         NI    CKPFLAGS,255-CKPFSCN1    RESET SCAN 1 IN PROG    SA51078 77850022
         XI    CKPSWCH1,CKPSET1         FLIP SWITCH             SA51078 77940022
         B     QMJ10                    BRANCH TO DO NEXT SCAN  SA51078 78030022
         SPACE                                                          78120022
**********************************************************************  78210022
         SPACE 2                                                        78216058
*  EXIT FROM QUEUE SCANS - FREE GOTTEN CORE AND RETURN         @YA11145 78222058
         SPACE 2                                                        78228058
FREECORE EQU *                                                 @YA11145 78234058
         OC    LENGTH(4),LENGTH         ANY CORE TO FREE       @YA11145 78240058
         BZ    RETREGS                  NO,RETURN              @YA11145 78246058
         MVI   ACTCODE,AVTEZERO         CLEAR ACTION CODE      @YA11145 78252058
         L     R1,GMAIN                 GET AREA TO FREE       @YA11145 78258058
         MVI   LENGTH,SP250                                    @YA11145 78264058
         L     R0,LENGTH                GET LENGTH             @YA11145 78270058
         FREEMAIN R,LV=(0),A=(1)        FREE AREA              @YA11145 78276058
RETREGS  LM    R14,R12,AVTSAVE1+12      RESTORE REGISTERS      @YA11145 78282058
         BR      R14                    AND RETURN             @YA11145 78288058
         SPACE 3                                                        78300022
*SUBROUTINE TO ACCESS MESSAGE QUEUES DATA SET.                          78390022
         SPACE 3                                                        78480022
*READ DATA                                                              78570022
         SPACE                                                          78660022
QMJ90    EQU   *                                                        78750022
         MVI   ACTCODE,RD               SET CODE = READ DATA   @YA11145 78790058
         MVI   CPBRDWR,CPBRDC           PUT READ DATA CODE IN 1ST       78840022
         B     QMJ9205                  SET UP NO-OP               0818 78930022
         SPACE                                                          79020022
*READ KEY AND DATA                                                      79110022
         SPACE                                                          79200022
QMJ91    EQU   *                                                        79290022
         MVI   CPBRDWR,CPBRDKC          READ KEY,DATA CODE IN 1ST       79380022
         MVI   CPBXDWR,CPBRDC           READ DATA CODE IN 2ND CCW       79470022
         B     QMJ93                    BRANCH TO QMJ93          S22024 79560022
*WRITE KEY AND DATA                                             SA51078 79650022
         SPACE 2                                                SA51078 79740022
QMJ94    EQU   *                                                SA51078 79830022
         MVI   ACTCODE,RD               SET ACTION CODE SAME   @YA11145 79850058
*                                        AS RD DATA SO EXCP TO @YA11145 79870058
*                                        DISK IS DONE          @YA11145 79890058
         MVI   CPBRDWR,CPBWRKC          WRITE KEY AND DATA      SA51078 79920022
         MVI   CPBXDWR,CPBWRC           WRITE DATA              SA51078 80010022
         B     QMJ93                    BRANCH                  SA51078 80100022
         SPACE 3                                                        80190022
*WRITE DATA                                                             80280022
         SPACE                                                          80370022
QMJ92    EQU   *                                                        80460022
         MVI   ACTCODE,WD               SET CODE = WRITE DATA  @YA11145 80500058
         MVI   CPBRDWR,CPBWRC           WRITE CODE IN 1ST CCW           80550022
QMJ9205  EQU   *                                                   0818 80640022
         MVI   CPBXDWR,CPBNOPC          NOOP CODE IN 2ND CCW            80730022
QMJ93    EQU   *                                                        80820022
         NC    CPBADDR+1(3),CPBADDR+1   ANY THERE               SA52971 80910022
         BCR   8,R14                    NO, RETURN              SA52971 81000022
         STM   R14,R12,AVTSAVE3+12      SAVE REGS           0407 S20018 81090022
         ST    R13,AVTSAVE1+8           SAVE REG               @YA11145 81091058
         SPACE 3                                                        81092058
*  THE FOLLOWING CODE CHECKS THE TYPE OF OPERATION BEING DONE  @YA11145 81093058
*  AND IF THIS IS A READ, A SCAN OF THE SAVED PREFIXES IS DONE @YA11145 81094058
*  TO SEE IF THE SEGMENT HAS ALREADY BEEN READ FROM DISK.  IF  @YA11145 81095058
*  SO THE PREFIX IS MOVED TO THE BUFFER WITHOUT ANY DISK I/O   @YA11145 81096058
*  BEING DONE.                                                 @YA11145 81097058
         SPACE 2                                                        81098058
         SR    R14,R14                  CLEAR FOR IC           @YA11145 81099058
         IC    R14,ACTCODE              PICK UP ACTION CODE    @YA11145 81100058
         B     TABLE(R14)               USE BRANCH TABLE       @YA11145 81101058
TABLE    B     GOEXCP                   READ DATA FOR EXTRAS   @YA11145 81102058
         B     WRTDATA                  WRITE DATA FOR HDRS    @YA11145 81103058
         B     READHDR                  READ HDR KEY AND DATA  @YA11145 81104058
         B     READTXT                  READ TXT KEY AND DATA  @YA11145 81105058
         B     RDQBACK                  READ HDR OR TXT QBACK  @YA11145 81106058
*        B     RUPDATE                  READ WITH UPDATE       @YA11145 81107058
RUPDATE  EQU   *                                               @YA11145 81108058
         BAL   R14,HDRSCAN              CHECK HDR QUEUE        @YA11145 81109058
         BAL   R14,TXTSCAN              CHECK TXT QUEUE        @YA11145 81110058
         B     GOEXCP                   AND DO EXCP            @YA11145 81111058
         SPACE 2                                                        81112058
RDQBACK  EQU   *                                               @YA11145 81113058
         BAL   R14,HDRSCAN              CHECK HDR QUEUE        @YA11145 81114058
         BAL   R14,TXTSCAN              CHECK TXT QUEUE        @YA11145 81115058
MOVE     EQU   *                                               @YA11145 81116058
         LTR   R1,R1                    ANYTHING FOUND         @YA11145 81117058
         BZ    GOEXCP                   NO, DO EXCP            @YA11145 81118058
         MVC   DATFLAGS-IEDQDATA(6,R4),DATFLAGS-IEDQDATA(R1)   @YA11145 81119058
*                                       MOVE DATA TO BUFFER    @YA11145 81120058
         MVC   PRFSUNIT(PRFSHDR-PRFSUNIT),PRFSUNIT-IEDQPRF(R1) @YA11145 81121058
*                                        MOVE PREFIX TO BUFFER @YA11145 81122058
         B     RESTORE                  RESTORE REGS AND RETURN@YA11145 81123058
         SPACE 2                                                        81124058
READTXT  EQU   *                                               @YA11145 81125058
         SR    R1,R1                    CLEAR RETURN CODE      @YA11145 81126058
         LA    R14,MOVE                 SET RETURN ADDR        @YA11145 81127058
TXTSCAN  EQU   *                                               @YA11145 81128058
         LTR   R1,R1                    FOUND DURING HDR SCAN  @YA11145 81129058
         BNZR  R14                      YES, RETURN            @YA11145 81130058
         LA    R15,TXTQ-8               SET UP FOR LOOP        @YA11145 81131058
TXTLOOP  EQU   *                                               @YA11145 81132058
         ST    R15,PREV                 SAVE PTR TO PREVIOUS   @YA11145 81133058
         ICM   R1,ADDR,PRFTIC+1-IEDQPRF(R15) GET NEXT          @YA11145 81134058
         ST    R1,LAST                  SAVE THIS ONE          @YA11145 81135058
         LR    R15,R1                   SAVE PREVIOUS          @YA11145 81136058
         BZR   R14                      END OF CHAIN, RETURN   @YA11145 81137058
         CLC   CPBADDR+1(3),PRFCOUNT-IEDQPRF(R1) THIS THE ONE  @YA11145 81138058
         BER   R14                      YES,RETURN             @YA11145 81139058
         BH    TXTLOOP                  HIGH-CONTINUE SCAN     @YA11145 81140058
         SR    R1,R1                    CLEAR RETURN CODE      @YA11145 81141058
         ST    R1,LAST                  CLEAR LAST POINTER     @YA11145 81142058
         BR    R14                      AND RETURN             @YA11145 81143058
         SPACE 2                                                        81144058
READHDR  EQU   *                                               @YA11145 81145058
         LA    R14,MOVE                 SET RETURN ADDR        @YA11145 81146058
HDRSCAN  EQU   *                                               @YA11145 81147058
         SR    R1,R1                    CLEAR RETURN CODE      @YA11145 81148058
         LA    R15,HDRQ-8               SET UP FOR LOOP        @YA11145 81149058
         B     TXTLOOP                  ENTER LOOP             @YA11145 81150058
         SPACE 2                                                        81151058
WRTDATA  EQU   *                                               @YA11145 81152058
         BAL   R14,HDRSCAN              CHECK HDR QUEUE        @YA11145 81153058
GOEXCP   EQU   *                                               @YA11145 81154058
         BAL   R14,QMJ96                CHECK AGAINST ADDRESS   SA52971 81180022
         MVI   AVTCPBCB+4,X'FF'         SET PRIORITY SO CPB WILL NO1110X81270022
                                        T BE POSTED TO CPB CLEAN-UP1110 81360022
         SPACE 3                                                        81450022
*ENQUEUE CPB ON INPUT QUEUE FOR EXCP DRIVER                             81540022
         SPACE                                                          81630022
         XC    CPBNEXT,CPBNEXT          CLEAR LINK FIELD                81720022
         ST    R3,AVTINCPQ+4            MAKE NEW CPB LAST ON QUEUE 0318 81810022
         MVC   AVTINCPQ+1(3),AVTINCPQ+5 PUT CPB ON QUEUE         S21101 81900022
         L     R15,AVTFL                ADDRESS OF EXCP DRIVER          81990022
         LA    R14,QNC30-(DSPDISP-IEDQDISP)   RETURN ADDRESS       0918 82080022
         ST    R14,AVTEA                STORE FOR EXCP D.TO PICK UP     82170022
         LA    R13,AVTSAVE2                                             82350022
         MVI   AVTCKECA,AVTEZERO        CLEAR COMPLETION CODES  SA63974 82440052
         BR    R15                      BRANCH TO EXCP DRIVER           82530022
         USING AVTSAVE2,R13             TEMP BASE                       82620022
QNC30    EQU   *                                                   0918 82710022
         WAIT  ECB=AVTCKECA             WAIT FOR I/O COMPLETION SA63974 82800052
         MVI   AVTCKECA,AVTEZERO        CLEAR COMPLETION CODES  SA63974 82840052
         LM    R14,R12,AVTSAVE3+12      RESTORE SYSTEM REGS        0503 82890022
         XC    AVTDKAPQ+1(3),AVTDKAPQ+1 CLEAR CPB FROM QUEUE     S21101 82980022
*                                       WHERE IT WAS PLACED BY DISK END 83070022
         EJECT ,                                                 99226  83160022
*                                                                99226  83250022
* WHEN THE CPB COMES BACK FROM APPENDAGE, A TEST IS MADE TO      99226  83340022
* DETERMINE IF THERE WAS A DISK ERROR . IF SO IT PICKS UP A      99226  83430022
* WTO ROUTINE IN IGG019RC TO HANDLE IT.                          99226  83520022
*                                                                99226  83610022
CPBER    EQU   X'01'                    CPB FLAG FROM DISK ERROR 99226  83700022
         TM    CPBFLAG,CPBER            DID CPB HAVE I/O ERROR   99226  83790022
         BZ    GOODCPB                    NO, GOOD CPB           99226  83880022
*                                         YES, I/O ERROR         99226  83970022
         ST    R0,AVTEA                 RESTORE DISP ADDR        99226  84060022
         LR    R7,R3                    GET CPB FOR WTO          99226  84150022
         L     R15,AVTFL                GET ADDRESS OF IGG019RC  99226  84240022
         L     R15,4(,R15)              GET 2ND WORD OF RC       99226  84330022
         BALR  R14,R15                  CALL DISK ERROR WTO RTN  99226  84420022
*                                                                99226  84510022
         LM    R14,R12,AVTSAVE3+12      RESTORE SYS REGS         99226  84600022
GOODCPB  EQU   *                                                 99226  84690022
         L     R13,AVTSAVE1+8           RESTORE R13              CLUP21 84780022
         DROP  R13                                               99226  84870022
         OC    LENGTH(4),LENGTH         WAS CORE GOTTEN        @YA11145 84873058
         BZ    NOSAVE                   NO, DON'T SAVE         @YA11145 84876058
         L     R1,LAST                  GET LAST READ PRF      @YA11145 84879058
         CLI   ACTCODE,WD               CHECK FOR WRITE DATA   @YA11145 84882058
         BE    SAVEDATA                 YES, SAVE NEW DATA     @YA11145 84885058
         BH    SAVENEW                  READ, GO SAVE PREFIX   @YA11145 84888058
         CLI   CPBRDWR,CPBRDC           READ DATA COMMAND      @YA11145 84891058
         BE    NOSAVE                   YES, DON'T SAVE        @YA11145 84894058
*                                       FALL THROUGH ON WRITE  @YA11145 84897058
*                                        KEY AND DATA          @YA11145 84900058
SAVEPRF  EQU   *                                               @YA11145 84903058
         MVC   PRFSUNIT-IEDQPRF(PRFSHDR-PRFSUNIT,R1),PRFSUNIT  @YA11145 84906058
*                                       SAVE BFR PREFIX        @YA11145 84909058
         MVC   PRFCOUNT-IEDQPRF(3,R1),CPBADDR+1 SAVE CPBADDR   @YA11145 84912058
SAVEDATA EQU   *                                               @YA11145 84915058
         LTR   R1,R1                    WAS OLD DATA AVAILABLE @YA11145 84918058
         BZ    NOSAVE                   NO, DON'T SAVE NEW     @YA11145 84921058
         MVC   DATFLAGS-IEDQDATA(6,R1),DATFLAGS-IEDQDATA(R4)   @YA11145 84924058
*                                       SAVE NEW DATA          @YA11145 84927058
NOSAVE   EQU   *                                               @YA11145 84930058
RESTORE  EQU   *                                               @YA11145 84933058
         LM    R14,R12,AVTSAVE3+12                             @YA11145 84936058
         BR    R14                      RETURN TO IGG01945         0318 84960022
         SPACE 3                                                        84962058
SAVENEW  EQU   *                                               @YA11145 84964058
         LTR   R1,R1                    WAS PREFIX FOUND?      @YA11145 84966058
         BNZ   NOSAVE                   YES, UPDATE BEING DONE @YA11145 84968058
*                                       ON QBACK FIELDS SAVED  @YA11145 84970058
*                                       DATA WILL BE CHANGED   @YA11145 84972058
         CLI   ACTCODE,RKDQ             READING QBACK OR UPDATE@YA11145 84974058
         BL    INSERT                   NO,BRANCH              @YA11145 84976058
         TM    PRFSTAT1,PRFNHDRN        TEXT BUFFER            @YA11145 84978058
         BO    INSERT                   YES, BRANCH            @YA11145 84980058
         BAL   R14,HDRSCAN              SEARCH FOR SLOT IN     @YA11145 84982058
*                                       HDRQ TO INSERT NEW     @YA11145 84984058
*                                       PREFIX                 @YA11145 84986058
INSERT   EQU   *                                               @YA11145 84988058
         LA    R15,NXTAVAIL             SET TO DELINK UNIT     @YA11145 84990058
         ICM   R1,ADDR,NXTAVAIL+1       GET NEXT AVAILABLE     @YA11145 84992058
         BNZ   DELINK                   BRANCH IF ONE THERE    @YA11145 84994058
         LA    R15,TXTQ                 STEAL OLDEST TXT UNIT  @YA11145 84996058
         ICM   R1,ADDR,TXTQ+1           GET FIRST TEXT UNIT    @YA11145 84998058
         BNZ   DELINK                   BRANCH IF ONE THERE    @YA11145 85000058
         LA    R15,HDRQ                 STEAL OLDEST HDR UNIT  @YA11145 85002058
         ICM   R1,ADDR,HDRQ+1           GET FIRST HDR UNIT     @YA11145 85004058
         BZ    NOSAVE                   NONE HERE EITHER,      @YA11145 85006058
*                                         SHOULD NOT OCCUR     @YA11145 85008058
DELINK   EQU   *                                               @YA11145 85010058
         ST    R1,LAST                  SAVE POINTER TO LAST   @YA11145 85012058
*                                       SEGMENT READ           @YA11145 85014058
         C     R1,PREV                  ATTEMPTING TO DELINK   @YA11145 85016058
*                                        UNIT PREVIOUS TO WHERE@YA11145 85018058
*                                        THIS ONE WILL BE      @YA11145 85020058
*                                        INSERTED IN CHAIN     @YA11145 85022058
         BE    SAVEPRF                  YES, ALREADY IN PROPER @YA11145 85024058
*                                        SLOT, DON'T REMOVE    @YA11145 85026058
         MVC   QCBELCHN-IEDQQCB(3,R15),PRFTIC+1-IEDQPRF(R1)    @YA11145 85028058
*                                       DELINK THIS UNIT       @YA11145 85030058
         L     R15,PREV                 GET POINTER TO UNIT    @YA11145 85032058
*                                        TO LINK THIS ONE      @YA11145 85034058
*                                        BEHIND                @YA11145 85036058
         MVC   PRFTIC+1-IEDQPRF(3,R1),PRFTIC+1-IEDQPRF(R15)    @YA11145 85038058
*                                       LINK THIS ONE TO NEXT  @YA11145 85040058
         STCM  R1,ADDR,PRFTIC+1-IEDQPRF(R15) LINK PREVIOUS     @YA11145 85042058
*                                        TO THIS ONE           @YA11145 85044058
         B     SAVEPRF                  AND GO MOVE PREFIX     @YA11145 85046058
         SPACE 3                                                        85050022
         SPACE                                                          85140022
**********************************************************************  85230022
         SPACE 3                                                        85320022
*CHECK SEQUENCE NUMBERS IN TERM ENTRY TO SEE IF THEY NEED UPDATING 1029 85410022
         SPACE                                                          85500022
Q835     EQU   *                                                   1029 85590022
         LA    R15,1(,R15)              ADD 1 TO SEQUENCE NUMBER   1029 85680022
         LH    R10,Q8MAX                GET MAX SEQ NUM         SA52971 85770022
         CR    R15,R10                  CHECK FOR MAX           SA52971 85860022
         BNE   Q837                     BRANCH IF MAX NOT REACHED  1029 85950022
         LA    R15,1                    INITIALIZE SEQ NUMBR TO 1  1029 86040022
Q837     EQU   *                                                   1029 86130022
         SRL   R10,DIV2                 DIVIDE BY TWO           SA52971 86220022
         LH    R13,0(,R1)               GET SEQ NUMBR FROM TERM    1029 86310022
         SR    R13,R15                  GET DIFFERENCE BETWEEN TWO 1029 86400022
         BP    Q839                     BR IF TERM SEQ HIGHER   SA52971 86490022
         SPACE 3                                                        86580022
*THE SEQUENCE NUMBER IN THE TERMINAL ENTRY IS LOWER THAN THE    SA52971 86670022
*NUMBER IN THE MESSAGE.  MAKE COMPARE VALUE NEGATIVE SO THAT    SA52971 86760022
*CONDITION CODES WILL BE CONSISTENT.                            SA52971 86850022
         SPACE                                                          86940022
         LNR   R10,R10                  NEGATE COMPARE VALUE    SA52971 87030022
Q839     EQU   *                                                SA52971 87120022
         CR    R13,R10                  CHECK DIFFERENCE        SA52971 87210022
         BCR   4,R14                    BR IF DIFFERENCE IS      CLUP21X87300022
                                        SMALLER THAN HALF THE      1029X87390022
                                        LARGEST POSSIBLE DIFFERENCE1029 87480022
         STH   R15,0(,R1)               UPDATE SEQUENCE NUMBER-TERM1029 87570022
         LA    R15,TRMOUTSQ             ADDR OF OUTPUT SEQ NUM @ZA03082 87580058
         CR    R15,R1                   IS THIS OUTPUT SEQ NR? @ZA03082 87590058
         BNER  R14                      NO, RETURN             @ZA03082 87600058
         OI    QCBCFHDR,QCBSQDEC        SET SEQ DEC SWITCH     @OZ08356 87610000
         BR    R14                      RETURN TO IGG01945         1029 87660022
         SPACE                                                          87750022
**********************************************************************  87840022
         SPACE 3                                                        87930022
*SUBROUTINE TO COMPARE THE VALUE IN CPBADDR WITH RADDR OR NADDR TO      88020022
*SEE IF THIS RECORD NUMBER SHOULD BE USED TO UPDATE RADDR OR NADDR.     88110022
         SPACE                                                          88200022
QMJ96    EQU   *                                                   0915 88290022
         L     R1,CPBADDR               GET RECORD NUMBER       OX03959 88470005
         LA    R1,INCR(,R1)             BUMP TO NEXT RECORD     OX03959 88510005
         TM    CPBADDR+3,CPBQTYPE       REUS RRN                SA51078 88560022
         BO    Q855                     BRANCH IF YES           OX03959 88650005
         C     R1,AVTNADDR              IS ADDRESS THAT HIGH    OX03959 88850005
         BCR   13,R14                   YES, RETURN             SA52971 89190022
         ST    R1,AVTNADDR              BUMP ADDRESS            OX03959 89280005
         BR    R14                      RETURN TO IGG01945         1111 89370022
         SPACE 1                                                        89374005
Q855     EQU   *                                                OX03959 89378005
         L     R15,AVTRADDR             GET REUS RRN            OX03959 89382005
         SR    R15,R1                   GET DIFFERENCE          OX03959 89386005
         BM    Q865                     BRANCH IF CPBADDR HIGH  OX03959 89390005
         SRL   R15,DIV4                 DIVIDE BY 4 TO GET REAL OX03959 89394005
*                                        RRN DIFFERENCE         OX03959 89398005
         C     R15,AVTTOTNR             IS DIFFERENCE MORE THAN OX03959 89402005
*                                        DISK SIZE              OX03959 89406005
         BNHR  R14                      NO, RETURN -CPBADDR LOW OX03959 89410005
         L     R15,AVTTOTNR             GET TOTAL RECORDS      @SA69965 89410556
         SRL   R15,DIV4                 GET 1/4 OF TOTAL       @SA69965 89411056
         ST    R15,AVTLODPT             RESET NEXT REUS CYCLE  @SA69965 89411556
         SRL   R15,DIV2                 GET 1/8 OF TOTAL       @SA69965 89412056
         A     R15,AVTLODPT             ADD TO GET 3/8 OF TOTAL@SA69965 89412556
         ST    R15,AVTLODPT             SET NEXT REUS CYCLE    @SA69965 89413056
Q860     EQU   *                                                OX03959 89414005
         ST    R1,AVTRADDR              SAVE NEW ADDRESS        OX03959 89418005
         BR    R14                      AND RETURN              OX03959 89422005
Q865     EQU   *                                                OX03959 89426005
         LPR   R15,R15                  GET POSITIVE DIFFERENCE OX03959 89430005
         SRL   R15,DIV4                 DIVIDE BY 4 TO GET REAL OX03959 89434005
*                                        RRN DIFFERENCE         OX03959 89438005
         C     R15,AVTTOTNR             IS DIFFERENCE MORE THAN OX03959 89442005
*                                        DISK SIZE              OX03959 89446005
         BNLR  R14                      YES, RETURN -RADDR HIGH OX03959 89450005
         B     Q860                     NO, GO UPDATE RADDR     OX03959 89454005
         SPACE                                                          89460022
**********************************************************************  89550022
         SPACE 3                                               @SA71107 89552056
MOVER    EQU   *                                               @SA71107 89554056
         STM   R1,R12,AVTSAVE3+20       SAVE REGISTERS         @SA71107 89556056
         TM    LASTBYTE(R1),CPBQTYPE    REUS RRN               @SA71107 89558056
         BNO   COMPARE                  NO, DO STRAIGHT COMPARE@SA71107 89560056
         SR    R4,R4                    CLEAR FOR ICM          @SA71107 89562056
         SR    R5,R5                    CLEAR FOR ICM          @SA71107 89564056
         ICM   R4,ADDR,AVTEZERO(R1)     GET 'TO' VALUE         @SA71107 89566056
         ICM   R5,ADDR,AVTEZERO(R15)    GET 'FROM' VALUE       @SA71107 89568056
         SR    R5,R4                    GET DIFFERENCE         @SA71107 89570056
         BM    RECHECK                  FROM LESS THAN TO      @SA71107 89572056
         SRL   R5,DIV4                  GET REAL RRN DIFFERENCE@SA71107 89574056
         C     R5,AVTTOTNR              IS DIFFERENCE MORE THAN@SA71107 89576056
*                                        DISK SIZE             @SA71107 89578056
CKCODE   BH    SKIPMOVE                 YES, FROM VALUE IS     @SA71107 89580056
*                                        PRE-WRAP NUMBER       @SA71107 89582056
MOVEIT   MVC   AVTEZERO(ADDRSIZE,R1),AVTEZERO(R15) UPDATE VALUE@SA71107 89584056
*                                        WITH HIGHER RELATIVE  @SA71107 89586056
*                                        NUMBER                @SA71107 89588056
SKIPMOVE EQU   *                                               @SA71107 89590056
         LM    R1,R12,AVTSAVE3+20       RESTORE REGISTERS      @SA71107 89592056
         BR    R14                      AND RETURN             @SA71107 89594056
RECHECK  EQU   *                                               @SA71107 89596056
         LPR   R5,R5                    GET POSITIVE DIFFERENCE@SA71107 89598056
         SRL   R5,DIV4                  GET REAL RRN DIFFERENCE@SA71107 89600056
         C     R5,AVTTOTNR              IS DIFFERENCE MORE THAN@SA71107 89602056
*                                        DISK SIZE             @SA71107 89604056
         BL    SKIPMOVE                 NO, TO VALUE IS PRE-   @SA71107 89606056
*                                        WRAPPED NUMBER AND IS @SA71107 89608056
*                                        HIGHER THAN FROM VALUE@SA71107 89610056
         B     MOVEIT                   GO UPDATE NUMBER       @SA71107 89612056
COMPARE  CLC   AVTEZERO(ADDRSIZE,R1),AVTEZERO(R15) DO STRAIGHT @SA71107 89614056
*                                        COMPARE FOR NON-REUS  @SA71107 89616056
         B     CKCODE                   BRANCH TO CHECK        @SA71107 89618056
*                                        CONDITION CODE        @SA71107 89620056
         SPACE 3                                                        89640022
         DS    0F                       WORD BOUNDARY              0216 89730022
QME000F  DC    X'000000FF'              CLEAR THREE HIGH-ORDER BTS 0216 89820022
Q8MAX    DC    H'10000'                 MAXIMUM SEQUENCE NUMBER SA52971 89910022
Q8FLAG   DC    X'8000'                  FLAG FOR SECTR CNVRT0507 S21101 90000022
PQCBSZ   DC    AL2(QCBPSIZE)            PQCB SIZE               SA51078 90090022
TWO      DC    H'2'                                            @SA74246 90130058
SIZES    DC    F'1024',F'8388608'       MIN AND MAX SIZES      @YA11145 90140058
*                                        FOR GETMAIN           @YA11145 90150058
GETML    GETMAIN VC,LA=SIZES,A=GETML,SP=250,MF=L               @YA11145 90160058
GMEND    EQU   *                                               @YA11145 90170058
QMEMOVE   MVC   0(0,R4),0(R11)          MOVE INVITATION LIST       0216 90180022
ABNDCORE DC    H'4096'                  SIZE FOR ABEND         @OS77390 90190000
         DC    CL6'SEQNO'               SEQUENCE NO.           @OY11175 90210058
SEQSAVE  DC    XL2'00'                  SEQUENCE NUMBER        @OY11175 90240058
H5000    DC    H'5000'                  HALF OF HIGHEST SEQ NUM@OZ08356 90250000
H9000    DC    H'9000'                  SEQ NUM ABOUT TO WRAP  @OZ08356 90260000
QMEMOVEL  EQU   X'100'                  MAXIMUM MOVE LENGTH        0216 90270022
QCBSQDEC EQU   X'80'                    SEQ DECREMENT FLAG      SA59195 90360022
QCBDECRE EQU   X'40'                    ALREADY DECREMENTED FLG@OZ17620 90400000
QCBINCR  EQU   X'20'                    QCBPFEFO UPDATED FLAG  @OX20945 90420082
GOODRTN  EQU   4                        OFFSET FOR GOOD RETURN  SA51078 90450022
BADRTN   EQU   0                        OFFSET FOR BAD RETURN   SA51078 90540022
R12OFF   EQU   48                       OFFSET OF 1943 BASE    SA51078  90630022
R13OFF   EQU   52                       R13 OFFSET IN SA        SA51078 90720022
RLNLEN   EQU   1                        LENGTH FOR RLN COMPARE @XA05305 90730056
INVENTS  EQU   0                        OFFSET TO INVL ENTRIES @XA05305 90740056
INVSTAT  EQU   3                        OFFSET TO INVLIST STATU@XA05305 90750056
GOODRT43 EQU   2                        GOOD RET OFFSET TO 1943@XA05305 90760056
ONE      EQU   1                        INDEX INCREMENT        @SA72478 90780058
         DS    0F                                                       90810022
         TAVTD                                                          90900022
         TCKPD 3330                     MERLIN VERSION OF DSECT    0419 90990022
         SPACE 3                                                        90993058
*   THE FOLLOWING FIELDS ARE DEFINED IN CKPSAVE2 AND ARE USED  @YA11145 90996058
*   TO KEEP TRACK OF UNITS FROM DISK WHICH HAVE BEEN SAVED IN  @YA11145 90999058
*   CORE.  THIS PROVIDES CORE QUEUEING FOR THE DISK DATA SETS  @YA11145 91002058
*   SO THAT DISK READS WILL BE KEPT AT A MINIMUM.              @YA11145 91005058
         SPACE 2                                                        91008058
NXTAVAIL EQU   CKPSAVE2+12              NEXT AVAILABLE UNIT    @YA11145 91011058
ACTCODE  EQU   CKPSAVE2+16              ACTION CODE            @YA11145 91014058
RD       EQU   0                        READ DATA              @YA11145 91017058
WD       EQU   4                        WRITE DATA             @YA11145 91020058
RKDH     EQU   8                        READ HDR KEY AND DATA  @YA11145 91023058
RKDT     EQU   12                       READ TXTKEY AND DATA   @YA11145 91026058
RKDQ     EQU   16                       READ QBACK (HDR OR TXT)@YA11145 91029058
UPDATE   EQU   20                       READ WITH UPDATE       @YA11145 91032058
GMAIN    EQU   CKPSAVE2+16              GETMAIN AREA           @YA11145 91035058
LENGTH   EQU   CKPSAVE2+20              LENGTH OF GETMAIN AREA @YA11145 91038058
HDRQ     EQU   CKPSAVE2+24              CHAIN OF HDR UNITS     @YA11145 91041058
TXTQ     EQU   CKPSAVE2+28              CHAIN OF TXT UNITS     @YA11145 91044058
LAST     EQU   CKPSAVE2+32              LAST UNIT FOR WHICH A  @YA11145 91047058
*                                        READ WAS ISSUED       @YA11145 91050058
PREV     EQU   CKPSAVE2+36              PREVIOUS UNIT IN CHAIN @YA11145 91053058
C12      EQU   12                       OFFSET TO FOURTH WORD  @YA11145 91056058
C17      EQU   17                       OFFSET TO ADDR IN FIFTH@YA11145 91059058
*                                       WORD                   @YA11145 91062058
SP250    EQU   250                                             @YA11145 91065058
CKPFIRST EQU   X'40' .                  INDICATES EMPTY FEFO QUEUS21101 91080022
CKPSTAYN EQU   X'20'                    NO-SCAN SPECIFIED-S=WY   S21101 91170022
         EJECT                                                 @XA      91190056
         DCBD  DSORG=TX                                        @XA05305 91210056
         EJECT                                                 @XA      91230056
         TQCBD                                                          91260022
         TTNTD                                                          91350022
         TTRMD                                                          91440022
         TDISPD                                                         91530022
         TCPBD 3330                     MERLIN VERSION             0421 91620022
         TPRFD                                                          91710022
         TDATAD                                                         91800022
         END                                                            91890022
