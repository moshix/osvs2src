         TITLE 'IGG019Q9 -- CONCENTRATOR SEND SCHEDULER'                00100022
IGG019Q9 CSECT                                                          00200022
*A-000000-999999                                               @X31X8I0 00205008
         SPACE 3                                                        00210022
*CHANGE-ACTIVITY = AS FOLLOWS:                                          00220022
******************** MICROFICHE FLAGS *********************** SUPT CODE 00230022
*A178810-178950                                                 SA58993 00250022
*D484000-486000,A484000-486100                                  SA56606 00250122
*A601030-601810                                                  Y05331 00250205
*A002000,624000                                                @Z30X8IM 00250308
*C005000,194000,287000,298000,405000,452000                    @Z30X8IM 00250408
*D195000-196000,288000-289000,299000-300000,406000-407000      @Z30X8IM 00250508
*D453000-454000                                                @Z30X8IM 00250608
*A235000,484000,600000,601000,629000                           @OY21862 00270600
* $N1=2        JTC2412  81.02.10 398332: MULTIPLE TCAM HIT         @N1A 00280629
* $21=OZ52350  JTC2402  81.09.10 076195: SCB ERROR                 @21A 00285327
* $N2=2        JTC2412  81.07.21 937763:                           @N2A 00290227
* $22=OZ55529  JTC2412  81.12.21 460025: INCREASE LOOP COUNT       @22A 00292627
         EJECT                                                     @N2A 00295127
*********************************************************************** 00300022
*                                                                     * 00400022
*  $MOD(IGG019Q9) COMP(E@) PROD(TCAM):                             @N1C 00410029
*                                                                     * 00420027
*  DESCRIPTIVE NAME = CONCENTRATOR SEND SCHEDULER                     * 00430027
*                                                                     * 00440027
*  COPYRIGHT -- 5735-RC3 (C) COPYRIGHT IBM CORP 1981               @N2C 00462827
*    LICENSED MATERIAL - PROGRAM PROPERTY OF IBM                   @N1A 00485629
*    REFER TO COPYRIGHT INSTRUCTIONS FORM NUMBER G120-2083         @N1A 00508429
*                                                                     * 00531229
*  STATUS -- ACF/TCAM VERSION 2  RELEASE 4                         @N1C 00554029
*                                                                     * 00576829
*                                                                     * 00600022
* FUNCTION -- TO SCHEDULE A SENDING OPERATION AND TO EFFECT READING   * 00700022
*    FROM MULTIPLE QCBS FOR CONCENTRATOR OUTPUT.                      * 00800022
*                                                                     * 00900022
* ENTRY POINTS --                                                     * 01000022
*         FIRST EXECUTALBE INSTRUCTION                                * 01100022
*         'DESTENT' WHEN BRANCHED TO BY DESTINATION ASSIGNMENT        * 01200022
*                                                                     * 01300022
* INPUT --                                                            * 01400022
*    WHEN ACTIVATED BY THE DISPATCHER -                               * 01500022
*    R1 POINTS TO A BUFFER, LCB OR ERB                                * 01600022
*    R3 ADDRESS OF STCB                                               * 01700022
*    R7 ADDRESS OF QCB                                                * 01800022
*    R11 DISPATCHER BASE                                              * 01900022
*    R13 ADDRESS OF AVTSAVE2                                          * 02000022
*    R15 ENTRY POINT ADDRESS                                          * 02100022
*                                                                     * 02200022
*    'DESTENT' -                                                      * 02300022
*    R7 ADDRESS OF QCB                                                * 02400022
*    R13 ADDRESS OF AVTSAVE2                                          * 02500022
*    R14 RETURN ADDRESS                                               * 02600022
*    R15 ENTRY POINT ADDRESS                                          * 02700022
*                                                                     * 02800022
* OUTPUT --                                                           * 02900022
*    R1 POINTS TO A BUFFER, LCB OR ERB                                * 03000022
*    R3 ADDRESS OF STCB                                               * 03100022
*    R11 DISPATCHER BASE                                              * 03200022
*    R13 ADDRESS OF AVTSAVE2                                          * 03300022
*                                                                     * 03400022
* EXTERNAL REFERENCES --                                              * 03500022
*         DSPPOSTR                                                    * 03600022
*         DSPUNAVR                                                    * 03700022
*         DSPPRIOR                                                    * 03800022
*                                                                     * 03900022
* EXITS,NORMAL --                                                     * 04000022
*         DSPDISP                                                     * 04100022
*         DSPBYPAS                                                    * 04200022
*         DSPPOST                                                     * 04300022
*         BR 14 RETURN TO DESTINATION ASSIGMENT                       * 04400022
*                                                                     * 04500022
* EXITS,ERROR --                                                      * 04600022
*         NONE                                                        * 04700022
*                                                                     * 04800022
* TABLES/WORK AREAS --                                                * 04900022
*    AVT                                                              * 05000022
*    LCB                                                              * 05100022
*    QCB                                                              * 05200022
*    QCBE                                                             * 05300022
*    SCB                                                              * 05400022
*    DCB                                                              * 05500022
*    DEB                                                              * 05600022
*    TERMINAL ENTRY                                                   * 05700022
*    DRQ                                                              * 05800022
*                                                                     * 05900022
* ATTRIBUTES --                                                       * 06000022
*    RE-ENTRANT, REFRESHABLE, PROBLEM PROGRAM MODE                    * 06100022
*                                                                     * 06200022
* CHARACTER CODE DEPENDENCY --                                          06300022
*    THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A PARTICULAR   * 06400022
*    INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER SET.           * 06500022
*                                                                     * 06600022
* NOTES --                                                            * 06700022
*    STANDARD TCAM LINKAGES AND DEVIATIONS FROM STANDARDS.            * 06800022
*    THE ADDRESS OF THE SCHEDULER IS STORED BY OPEN IN THE AVT.       * 06900022
*    DESTINATION ASSIGNMENT EXPECTS THE OFFSET TO 'DESTENT' TO BE     * 07000022
*    THE FIRST TWO BYTES OF THIS MODULE.                              * 07100022
*                                                                     * 07200022
*********************************************************************** 07300022
         EJECT                                                          07400022
*********************************************************************** 07500022
*        SYMBOLIC REGISTERS                                           * 07600022
*********************************************************************** 07700022
         SPACE 1                                                        07800022
RZERO    EQU   0                         WORK REGISTER                  07900022
RPARM    EQU   1                         PARAMETER REGISTER             08000022
RWORKA   EQU   2                        WORK REG                        08100022
RQCBE    EQU   3                        QCBE REG                        08200022
RSTCB    EQU   3                         STCB                           08300022
RLCB     EQU   4                         LCB                            08400022
RWORKB   EQU   5                        WORK REG                        08500022
RPQCB    EQU   5                         PPIORTY LEVEL QCB              08600022
RDRQ     EQU   6                         DRQ                            08700022
RQCB     EQU   7                         QCB                            08800022
RWORKC   EQU   8                        WORK REG                        08900022
RTERM    EQU   8                         TERMINAL ENTRY                 09000022
RSCB     EQU   9                         SCB                            09100022
RDCB     EQU   10                        DCB                            09200022
RDISP    EQU   11                        DISPATCHER BASE                09300022
RBASE    EQU   12                        CSECT BASE                     09400022
RAVT     EQU   13                        AVT BASE                       09500022
RRETURN  EQU   14                        RETURN REGISTER                09600022
RENTRY   EQU   15                        ENTRY POINT ADDRESS            09700022
         SPACE 1                                                        09800022
*********************************************************************** 09900022
*        ESTABLISH CSECT AND CONTROL BLOCK ADDRESSABILITY             * 10000022
*********************************************************************** 10100022
         SPACE 2                                                        10200022
         USING IEDQDISP,RDISP           DISP                            10300022
         USING AVTSAVE2,RAVT            AVT                             10400022
         USING IEDQQCB,RQCB             QCB                             10500022
         USING IEDQSCB,RSCB             SCB                             10600022
         USING IEDQLCB,RLCB             LCB                             10700022
         USING IEDQTRM,RTERM            TERMINAL ENTRY                  10800022
         USING IHADCB,RDCB              DCB                             10900022
         USING IEDQSTCB,RSTCB           STCB                            11000022
         USING IEDQDRQ,RDRQ             DRQ                             11100022
         SPACE 2                                                        11200022
         DC    AL2(DESTENT-IGG019Q9)     OFFSET TO DESTENT              11300022
         SPACE 2                                                        11400022
         USING *,RENTRY                                                 11500022
         B     SETBASE                  BRANCH/DUMMY QCB                11600022
         DC    H'0'                     FILLER                          11700022
         DC    AL1(DSPMCPL6)            STCB                            11800022
         DC    AL3(*-1)                 STCB ADDR                       11900022
         DC    H'0'                     FILLER                          12000022
SETBASE  BALR  RBASE,0                  SET BASE REG                    12100022
         DROP  RENTRY                                                   12200022
         USING *,RBASE                                                  12300022
         LR    RLCB,RPARM               ASSUME LCB                      12400022
         CLI   LCBRSKEY-IEDQLCB(RPARM),RSVTO                            12500022
*                                       ELEMENT A LCB                   12600022
         BE    SETREGS                  BRANCH IF YES                   12700022
         TM    PRFTIC-IEDQPRF(RPARM),CCWTIC                             12800022
*                                       ELEMENT A BUFFER                12900022
         BZ    SETERB                   BRANCH IF NO                    13000022
         SPACE 1                                                        13100022
**********************************************************************  13200022
*        ELEMENT IS A BUFFER                                          * 13300022
**********************************************************************  13400022
         SPACE 1                                                        13500022
         L     RSTCB,QCBSLINK-1          ADDRESS OF DEST SCH STCB       14300022
         B     DSPBYPAS                  ACTIVATE DEST SCH              14400022
         DC    CL8'IGG019Q9'            MODULE ID                       14500022
         IEDHJN                                                         14600022
SETERB   EQU   *                                                        14700022
         LA    RWORKA,LCBERB-IEDQLCB    ERB OFFSET INTO LCB             14800022
         SR    RLCB,RWORKA              COMPUTE LCB                     14900022
SETREGS  EQU   *                                                        15000022
         L     RSCB,LCBSCBA-1           SCB                             15100022
         L     RDCB,LCBDCBPT            DCB                             15200022
         L     RDRQ,LCBSTCBA-1          STCB ADDR                       15300022
         LA    RWORKA,DRQSTVTO-IEDQDRQ  STCB OFFSET IN DRQ              15400022
         SR    RDRQ,RWORKA              OF DRQ                          15500022
         CLI   LCBRSKEY-IEDQLCB(RPARM),RSVTO                            15600022
*                                       ELEMENT A LCB                   15700022
         BE    LCB                      BRANCH IF YES                   15800022
         SPACE 1                                                        15900022
*********************************************************************** 16000022
*        ELEMENT IS AN ERB                                            * 16100022
*********************************************************************** 16200022
         SPACE 1                                                        16300022
         NI    LCBERBST,255-LCBDLNKN    MARK ERB UNAVAILABLE            16350022
         L     RWORKC,LCBSCBDA-1        LINE SCB ADDR                   16400022
         TM    SCBSTAT1-IEDQSCB(RWORKC),SCBCEND                         16500022
*                                       CONC END OF MSG                 16600022
         BO    RELERB                   BRANCH IF YES                   16700022
         L     RQCB,SCBDESTQ-1          QCB ADDR                        16800022
         LH    RQCBE,QCBEXTO            EXTENSION OFFSET                16900022
         AR    RQCBE,RQCB               QCBE                            17000022
         USING IEDQQCBE,RQCBE                                           17100022
         L     RDRQ,QCBECONC-1          CONC TERM ENTRY                 17200022
         L     RDRQ,TRMDESTQ-1-IEDQTRM(RDRQ)                            17300022
*                                       DRQ ADDR                        17400022
         TM    LCBSTAT1,LCBRCLLN        ERB FROM RECALL                 17500022
         BNO   GETNXTQ                  BRANCH IF NO                    17600022
         NI    DRQFLAG3,AVTEFF-DRQERBAV MARK ERB AVAILABLE FOR  SA56908 17630022
*                                       PCI                     SA56908 17660022
         NI    LCBSTAT1,255-LCBRCLLN    RESET RECALL                    17700022
         L     RPARM,LCBERBCH-1         RECALLED BUFFER ADDR            17800022
         TM    LCBERBST,LCBERROR        LINE ERROR                      17805022
         BZ    CHKEOB                   BRANCH IF NO                    17810022
         LA    RWORKA,AVTBFRTB          BUFFER RET QUEUE                17815022
         ST    RWORKA,PRFQCBA-1-IEDQPRF(RPARM)                          17820022
*                                       SET QCB ADDR                    17825022
         LA    RWORKA,LCBERB            ERB ADDR                        17830022
         ST    RWORKA,PRFLINK-1-IEDQPRF(RPARM)                          17835022
*                                       LINK ERB TO BUFFER              17840022
         MVI   PRFPRI-IEDQPRF(RPARM),PRIBFRTB                           17845022
*                                       SET BUFFER PRIORITY             17850022
         L     RWORKA,LCBRCQCB          RETURN QCB ADDR                 17855022
         ST    RWORKA,LCBERB            SET QCB ADDR                    17860022
         XC    LCBERBLK,LCBERBLK        ZERO LINK FIELD                 17865022
         MVI   LCBERBPY,PRIDSPLB-1      SET ERROR PRIORITY              17870022
         B     DSPCHAIN                 POST ERB AND BUFFER             17875022
CHKEOB   EQU   *                                                        17880022
         LTR   RPARM,RPARM              IS THERE A BUFFER       SA58993 17881022
         BNZ   NORDERR                  YES,CONT PROCESSING     SA58993 17882022
         SPACE 1                                                        17883022
**********************************************************************  17884022
*                                                                    *  17885022
* IF NO BUFFER HAS BEEN RETURNED, ISSUE 045-3 ABEND AS IEDQFA WOULD  *  17886022
*  HAVE DONE HAD LCBRCLLN NOT BEEN SET                               *  17887022
*                                                                    *  17888022
**********************************************************************  17889022
         SPACE 1                                                        17890022
         LA    RENTRY,ABCODE3           SET ABEND CODE IN RG 15 SA58993 17891022
         BAL   RRETURN,AVTABEND         BRANCH TO ABEND IN AVT  SA58993 17892022
ABCODE3  EQU   X'03'                    ABEND CODE              SA58993 17893022
         SPACE 3                                                        17894022
NORDERR  EQU   *                                                        17895022
         NC    SCBEOB,SCBEOB            BUFFER BEEN USED                17900022
         BZ    NOCNCL                   BRANCH IF NO                    18000022
         OI    PRFSTAT1-IEDQPRF(RPARM),PRFCNCLN                         18100022
*                                       SET CANCEL MSG                  18200022
NOCNCL   EQU   *                                                        18300022
         MVC   LCBISZE,PRFSCAN+1-IEDQPRF(RPARM)                         18400022
*                                       SET IDLE COUNT                  18500022
         LH    RWORKB,PRFSIZE-IEDQPRF(RPARM)                            18600022
*                                       GET DATA AMOUNT                 18700022
         SH    RWORKB,SCBEOB            REMAINING DATA                  18800022
         LTR   RWORKB,RWORKB            CAN AMOUNT BE CALCULATED        18900022
         BP    AMTVALID                 BRANCH IF YES                   19000022
         SR    RWORKB,RWORKB            ZERO REG                        19100022
AMTVALID EQU   *                                                        19200022
         LA    RWORKA,AVTINOUT          INMSG/OUTMSG DELIMITER          19300022
         STCM  RWORKA,ADR,SCBMACR       RESET MACRO ADDRESS    @Z30X8IM 19400008
         NI    SCBHBFNO,CLRQPTR         RESET QTYPE FROM WHERE          19700022
*                                       IEDQBD SAVES IT                 19800022
         MVC   SCBUNTCT,SCBDEOB                                         19900022
         MVC   SCBDEOB,SCBCPBNO-IEDQSCB(RWORKC)                         20000022
*                                       RESTORE AFTER RECALL            20100022
         LA    RZERO,ONE                SET REG TO ONE                  20200022
         LA    RWORKA,AVTACTIB          ACTIVATE QCB ADDR               20300022
         MVI   LCBERBPY,PRIINTRQ        SET INITIAL PRTY                20400022
         TM    LCBERBST,LCBEOMSG        EOM IN RECALLED BUFFER          20500022
         BO    CHKCBGN                  BRANCH IF YES                   20600022
         LNR   RWORKB,RWORKB            SET REG NEG                     20700022
         AH    RWORKB,SCBCTBSZ          SET REMAINING SIZE              20800022
         BC    3,BLDERB                 BRANCH IF MORE THAN ONE BUF     20900022
*                                       NEEDED TO FILL CTB              21000022
CHKCBGN  EQU   *                                                        21100022
         OI    LCBERBST,LCBDLNKN        RELEASE ERB                     21200022
         TM    SCBSTAT1-IEDQSCB(RWORKC),SCBCBGN                         21300022
*                                       CONC MSG BEGIN                  21400022
         BO    SETEDATA                 BRANCH IF YES                   21500022
         XC    LCBERBCH,LCBERBCH        CLEAR BUFFER ADDR               21600022
         MVC   PRFQCBA-IEDQPRF(THREE,RPARM),DCBMH                       21800022
*                                       SET POST QCB                    21900022
         MVI   PRFPRI-IEDQPRF(RPARM),PRIMHBFR                           22000022
*                                       POST PRTY                       22100022
         B     DSPPOST                  POST BUFFER TO MH               22200022
         SPACE 1                                                        22300022
*********************************************************************** 22400022
*        ELEMENT IS A LCB                                             * 22500022
*********************************************************************** 22600022
         SPACE 1                                                        22700022
LCB      EQU   *                                                        22800022
         TM    LCBSTAT1,LCBOCNI         STOPLINE                        22900022
         BO    STOPLINE                 BRANCH IF YES                   23000022
         TM    AVTBIT1,AVTCLOSN+AVTQUCKN                                23100022
*                                       QUICK CLOSE                     23200022
         BO    NOSEND                   BRANCH IF YES                   23300022
         TM    DRQSTAT,DRQTRMHO         CONC HELD                       23400022
         BO    RMVDRQST                 BRANCH IF YES                   23500022
         L     RSCB,LCBSCBDA-1          GET CONC'S SCB ADDRESS     @21A 23500927
         TM    SCBBSCFM,SCBMLMTN        MESSAGE LIMIT REACHED      @21A 23501827
         BZ    NOLMT                    NO, BRANCH                 @21A 23502727
         NI    SCBBSCFM,SCBMLMTF        RESET MSGLIMIT             @21A 23503627
         MVI   SCBSNDCT,AVTEZERO        CLEAR SEND COUNT           @21A 23504527
         LR    RSTCB,RLCB               UNAVAIL PARAMETER          @21A 23505427
         LR    RQCB,RLCB                RESTORE QCB ADDR           @21A 23506327
         B     POSTIT                   POST LCB TO ITSELF         @21A 23507227
         SPACE 2                                                   @21A 23508127
NOLMT    EQU   *                                                   @21A 23509027
         TM    DRQELCHN+2,QCBCNTEN      BUFFER BUSY            @OY21862 23510000
         BZ    NOTBUSY                  BRANCH NO              @OY21862 23520000
         NI    DRQELCHN+2,AVTEFF-QCBCNTEN  RESET BUSY          @OY21862 23530000
         L     RSTCB,QCBSLINK-1         GET NEXT STCB              @21A 23531627
         CLI   STCBPRI-IEDQSTCB(RSTCB),ZERO IS QEVENT NEXT         @21A 23533227
         BNE   BYPASS                   NO, GO TO NEXT SCHED       @21A 23534827
         TM    LCBINSRC+2,DELAY         LCB IN TIME DELAY          @21A 23536427
         BNZ   BYPASS                   YES DISPATCH QEVENT        @21A 23538027
         LA    RQCBE,LCBRSKEY           BYPASS TO              @OY21862 23540000
         B     BYPASS                   RECEIVE SCHEDULER      @OY21862 23550000
NOTBUSY  EQU   *                                               @OY21862 23560000
         SR    RZERO,RZERO              INDICATE DRQ STCB SHOULD        23600022
*                                       BE REMOVED IF NO STCBS          23700022
*                                       IN DRQ CHAIN                    23800022
         LR    RWORKA,RDRQ              DRQ ADDR                        23900022
         SH    RWORKA,AVTHA4            SUB FOUR                        24000022
DRQLPA   EQU   *                                                        24100022
         L     RWORKA,FOUR(RWORKA)      FIRST/NEXT STCB                 24200022
         CLI   FOUR(RWORKA),ZERO        LAST ELEMENT                    24300022
         BE    DRQLPAND                 BRANCH IF YES                   24400022
         LR    RQCB,RWORKA              STCB ADDR                       24500022
         LA    RZERO,QCBSTVTO-IEDQQCB   STCB OFFSET INTO QCB            24600022
         SR    RQCB,RZERO               QCB ADDR                        24700022
         LH    RQCBE,QCBEXTO            QCB EXTENSION OFFSET            24800022
         AR    RQCBE,RQCB               QCBE ADDR                       24900022
         USING IEDQQCBE,RQCBE                                           25000022
         NI    QCBEFLG,255-QCBESRVC     RESET SERVICED                  25100022
         TM    QCBEFLG,QCBEOPL          PROIRITY QUEUEING               25200022
         BNO   DRQLPA                   BRANCH IF NO                    25300022
         SR    RWORKC,RWORKC            ZERO REG                        25400022
         IC    RWORKC,QCBENPLV          NUMBER OF PRTY LEVLES           25500022
QCBELPA  EQU   *                                                        25600022
         SR    RWORKB,RWORKB            ZERO REG                        25700022
         IC    RWORKB,QCBELGTH          QCBE ENTRY LENGTH               25800022
         AR    RQCBE,RWORKB             NEXT ENTRY                      25900022
         NI    QCBEFLG,255-QCBESRVC     RESET SERVICED                  26000022
         BCT   RWORKC,QCBELPA           LAST LEVEL                      26100022
         B     DRQLPA                   BRANCH IF YES                   26200022
DRQLPAND EQU   *                                                        26300022
         LTR   RZERO,RZERO              ANY STCBS                       26400022
         BZ    RMVDRQST                 BRANCH IF NO                    26500022
         L     RSCB,LCBSCBDA-1          LINE SCB ADDRESS                26550022
         MVI   SCBSTAT1,SCBCBGN         SET CONC MSG BEGIN              26600022
         MVI   LCBSTAT1,LCBSENDN        SET SENDING                     26700022
         XC    LCBRECAD,LCBRECAD        ZERO FIELDS                     26800022
         XC    LCBRECOF,LCBRECOF                                        26900022
         MVI   DRQBUFCT,ZERO            CLEAR BUFCT                     27000022
         MVN   DRQBUFCT,DCBBUFOU        SET BUFOUT                      27100022
         OI    DRQFLAG3,DRQFSPCI        SET FIRST PCI                   27200022
CLRCURQ  EQU   *                                                        27300022
         XC    DRQCURQ,DRQCURQ          CLEAR CURRENT QCB POINTER       27400022
GETNXTQ  EQU   *                                                        27500022
         L     RQCB,DRQCURQ-1           GET CURRENT QCB                 27600022
         LA    RQCB,ZERO(RQCB)          CLEAR HI-ORDER BYTE             27700022
         LTR   RQCB,RQCB                CURRENT QCB                     27800022
         BNZ   DRQLPBND                 BRANCH IF YES                   27900022
         LA    RZERO,QCBSTVTO-IEDQQCB  STCB OFFSET INTO QCB             28000022
         LR    RWORKA,RDRQ              DRQ ADDR                        28100022
         SH    RWORKA,AVTHA4            SUB FOUR                        28200022
DRQLPB   EQU   *                                                        28300022
         L     RQCB,FOUR(RWORKA)        FIRST/NEXT STCB                 28400022
         CLI   FOUR(RQCB),ZERO          ANY STCBS                       28500022
         BE    RMVDRQST                 BRANCH IF NO                    28600022
         STCM  RWORKA,ADR,DRQPRVLK      SAVE PREV LINK FIELD   @Z30X8IM 28700008
         LR    RWORKA,RQCB              UPDATE LOOP REG                 29000022
         SR    RQCB,RZERO               QCB ADDR                        29100022
DRQLPBND EQU   *                                                        29200022
         LH    RQCBE,QCBEXTO            QCB EXTENSION OFFSET            29300022
         AR    RQCBE,RQCB               QCBE ADDR                       29400022
         TM    QCBEFLG,QCBESRVC+QCBEHELD                                29500022
*                                       SERVICED OR TEMP HOLD           29600022
         BNZ   DRQLPB                   BRANCH IF EITHER                29700022
         STCM  RQCB,ADR,DRQCURQ         UPDATE CURRENT QUEUE   @Z30X8IM 29800008
         SR    RWORKA,RWORKA            ZERO REG                        30100022
         SR    RSCB,RSCB                ZERO REG                        30200022
         IC    RSCB,QCBSCBOF            QCB OFFSET TO SCB               30300022
         IC    RWORKA,AVTSCBSZ          SIZE OF SCB                     30400022
         MR    RSCB-1,RWORKA            COMPUTE DISP OF SCB             30500022
         AL    RSCB,LCBSCBDA-ONE        COMPUTE SCB ADDRESS             30600022
         LH    RWORKB,SCBCTBSZ          SET REG                         30700022
         LR    RPARM,RQCBE              SET REG TO QCBE                 30800022
         TM    SCBQTYPE,SCBBFMM         MIDDLE OF MSG                   30900022
         BNO   INITIAL                  BRANCH IF NO                    31000022
         MVI   LCBERBPY,PRISBPCI        SET NOT INITIAL PRTY            31100022
         TM    QCBEFLG,QCBEOPL          PRTY QUEUEING                   31200022
         BZ    NOTPRTYQ                 BRANCH IF NO                    31300022
         IC    RWORKA,SCBPRI            PRTY QUE INDEX                  31400022
         BAL   RRETURN,FINDQCBE         GET CORRECT QCBE                31500022
NOTPRTYQ EQU   *                                                        31600022
         MVC   LCBTTCIN,QCBETCIN-IEDQQCBE(RPARM)                        31700022
*                                       SET TTCIN                       31800022
         MVC   LCBTTBIN,LCBTTCIN        SET TTBIN FOR KA                31900022
         NC    SCBDEOB,SCBDEOB          EMBEDDED RS                     32000022
         BZ    BUILDERB                 BRANCH IF NO                    32100022
         TM    SCBQTYPE,SCBCOREQ        CORE QUEUEING                   32200022
         BO    COREONLY                 BRANCH IF YES                   32300022
         TM    SCBSTAT1,PRFNLSTN        EOM BUFFER                      32400022
         BO    NOTLAST                  BRANCH IF NO                    32500022
         CLC   SCBDEOB+1(THREE),SCBCRCD SENDING LAST SEG                32600022
         BNL   COREONLY                                         SA60792 32700022
         NC    SCBXTRA(THREE),SCBXTRA                           SA60792 32710022
         BZ    RSET                                             SA60792 32720022
         CLC   SCBDEOB+ONE(THREE),SCBXTRA                       SA60792 32730022
         BNL   COREONLY                                         SA60792 32740022
RSET     EQU   *                                                SA60792 32750022
         OI    SCBSTAT1,PRFNLSTN        SET NOT LAST                    32800022
NOTLAST  EQU   *                                                        32900022
         XC    SCBXTRA,SCBXTRA          CLEAR FOR RECALL                33000022
         XC    SCBNTXT,SCBNTXT          CLEAR FOR RECALL                33100022
COREONLY EQU   *                                                        33200022
         MVZ   SCBHBFNO,SCBQTYPE        SET QTYPE FLGS FOR FA   SA52971 33250022
         L     RWORKC,LCBSCBDA-1        LINE SCB ADDR                   33300022
         MVC   SCBCPBNO-IEDQSCB(FOUR,RWORKC),SCBDEOB                    33400022
*                                       SAVE OVER RECALL                33500022
         OI    LCBSTAT1,LCBRCLLN        SET RECALL BIT                  33600022
         OI    DRQFLAG3,DRQERBAV        MARK ERB NOT AVAILABLE  SA56908 33630022
*                                       FOR PCI                 SA56908 33660022
         L     RWORKA,AVTCSCH           CONC SCH ADDR                   33700022
         SH    RWORKA,AVTHA2            SUB TWO                         33800022
         ST    RWORKA,LCBRCQCB          SET RETURN ADDR                 33900022
         LA    RZERO,ONE                SET REG                         34100022
         B     SETQCBAD                 GO POST THE ERB TO RECALL       34200022
INITIAL  EQU   *                                                        34300022
         MVI   LCBERBPY,PRIINTRQ        INITIAL REQUEST PRI             34400022
         TM    QCBDSFLG,QCBHELD         REUSABILITY RUNNING             34500022
         BO    RMVSTCB                  BRANCH IF YES                   34600022
         TM    QCBSTAT,QCBTRMHO         TERMINAL HELD                   34700022
         BO    RMVSTCB                  BRANCH IF YES                   34800022
         NC    SCBCTBSZ,SCBCTBSZ        CTBSZ ZERO                      34900022
         BNZ   CTBSZOK                  BRANCH IF NO                    35000022
         MVC   SCBCTBSZ,QCBEDAMT        SET DATA AMOUNT                 35100022
CTBSZOK  EQU   *                                                        35200022
         SR    RRETURN,RRETURN          INDICATE STCB SHOULD BE         35300022
*                                       REMOVED IF NO DATA              35400022
PQCBLP   EQU   *                                                        35500022
         LA    RWORKA,ONE               SET REG TO ONE                  35600022
         LNR   RWORKA,RWORKA            SET NEG                         35700022
         LA    RPQCB,QCBMSIZE-QCBPSIZE(RQCB)                            35800022
*                                       SET REG INITIALLY               35900022
         USING IEDQPQCB,RPQCB                                           36000022
NXTPQCB  EQU   *                                                        36100022
         LA    RPQCB,QCBPSIZE(RPQCB)    FIRST/NEXT PQCB                 36200022
         LA    RWORKA,ONE(RWORKA)       SET REG TO PQCB INDEX           36300022
         TM    QCBEFLG,QCBEOPL          LEVEL QUEUEING                  36309022
         BZ    CHKFEFO                  BRANCH IF NO                    36318022
         LTR   RRETURN,RRETURN          PREVIOUS LEVEL SERVICED OR HELD 36327022
         BNZ   CHKFEFO                  BRANCH IF YES                   36336022
         BAL   RRETURN,FINDQCBE         GET CORRECT QCBE                36345022
         TM    QCBEFLG-IEDQQCBE(RPARM),QCBEHELD+QCBESRVC                36354022
*                                       LEVEL SERVICED OR HELD          36363022
         BNZ   CHKLAST                  BRANCH IF YES                   36372022
         SR    RRETURN,RRETURN          ZERO FLAG REG                   36381022
CHKFEFO  EQU   *                                                        36390022
         NC    QCBFFEFO,QCBFFEFO        UNSENT MESSAGE                  36400022
         BZ    CHKLAST                  BRANCH IF NO                    36500022
         TM    QCBEFLG,QCBEOPL          LEVEL QUEUEING                  36600022
         BNO   BUILDSCB                 BRANCH IF NO                    36700022
         BAL   RRETURN,FINDQCBE         GET CORRECT QCBE                36800022
         TM    QCBEFLG-IEDQQCBE(RPARM),QCBESRVC+QCBEHELD                36900022
*                                       LEVEL SERVICED OR HELD          37000022
         BNZ   CHKLAST                  BRANCH IF EITHER                37100022
         OI    QCBEFLG-IEDQQCBE(RPARM),QCBEDATA                         37200022
*                                       SET DATA IN MSG                 37300022
         B     BUILDSCB                 BRANCH                          37400022
CHKLAST  EQU   *                                                        37500022
         CLI   QCBPRIPQ,ZERO            LAST PRTY LEVEL                 37600022
         BNE   NXTPQCB                  BRANCH IF NO                    37700022
         LA    RWORKA,QCBSTVTO-IEDQQCB(RQCB)                            37800022
*                                       SET RWORKA                      37900022
         XC    DRQCURQ,DRQCURQ          CLEAR CURRENT QUEUE             38000022
         LA    RZERO,QCBSTVTO-IEDQQCB   SET REG                         38100022
         LTR   RRETURN,RRETURN          REMOVE STCB FROM DRQ            38200022
         BNZ   DRQLPB                   BRANCH IF NO                    38300022
RMVSTCB  EQU   *                                                        38400022
         L     RWORKA,DRQPRVLK-1        GET PREVIOUS LINK FIELD         38500022
         MVC   FIVE(THREE,RWORKA),QCBSLINK                              38600022
*                                       DE-LINK STCB FROM DRQ           38700022
         MVC   QCBSLINK,QCBSTCHN        MOVE DEST SCH TO LAST           38800022
         LA    RWORKA,QCBSTVTO          ADDR OF CONC STCB               38900022
         ST    RWORKA,QCBSTCHN-1        STORE IN QCB                    39000022
         MVI   QCBSTVTO,CSVTO           RESTORE CONC SCH VTO            39100022
         NI    QCBEFLG-IEDQQCBE(RPARM),255-QCBEHELD                     39200022
*                                       RESET TEMPORARY HOLD            39300022
         B     CLRCURQ                  GET NEXT STCB                   39400022
BUILDSCB EQU   *                                                        39500022
         OI    QCBFLAG,QCBSDFFO         SET FIRST FFEFO                 39600022
         MVI   LCBTTCIN+ONE,ONE                                 SA60792 39650022
         MVC   SCBSCHDR,QCBFFEFO        MOVE REL REC NO                 39700022
         MVC   SCBSCSEG,QCBFFEFO        MOVE REL REC NO                 39800022
         STC   RWORKA,SCBPRI            PRTY LEVEL                      39900022
         XC    SCBFEFO(THREE),SCBFEFO   ZERO FIELD                      40000022
         NI    SCBQTYPE,255-SCBNREUS-SCBREUS-SCBCOREQ-SCBNORCL          40100022
*                                       RESET QTYPE                     40200022
         LA    RZERO,AVTINOUT           ADDR OF 0100                    40300022
         ST    RZERO,SCBMACR-1          SET SCBMACR                     40400022
         STCM  RQCB,ADR,SCBDESTQ        QCB ADDRESS            @Z30X8IM 40500008
         LH    RWORKB,SCBCTBSZ          SET REG                         40800022
BUILDERB EQU   *                                                        40900022
         SR    RZERO,RZERO              ZERO REG                        40920022
         IC    RZERO,DRQBUFCT           GET BUFFER COUNT                40940022
         LTR   RZERO,RZERO              BUFFER COUNT ZERO               40960022
         BNZ   BUFCTSET                 BRANCH IF NO                    40980022
         LA    RZERO,ONE                SET TO ONE                      41000022
BUFCTSET EQU   *                                                        41020022
         TM    QCBEFLG,QCBECNT          QCNTRL EQUAL SIZE               41100022
         BNO   SETQCBAD                 BRANCH IF NO                    41200022
         SR    RZERO,RZERO              ZERO REG                        41300022
BLDERB   EQU   *                                                        41400022
         L     RTERM,QCBECONC-1         CONC TERM ADDR                  41500022
         LA    RWORKA,DCBBUFSI          DCB BUF SIZE                    41600022
         TM    TRMDEVFL,X'80'           BUF SZ SPECIFIED                41700022
         BNO   GETBUFSZ                 BRANCH IF NO                    41800022
         LA    RWORKA,TRMOPNO+1         LOC OF BUF SZ IF NO OPT         41900022
         TM    TRMSTATE,TRMOPTFN        OPT FIELDS                      42000022
         BNO   GETBUFSZ                 BRANCH IF NO                    42100022
         SR    RWORKA,RWORKA            ZERO REG                        42200022
         IC    RWORKA,TRMOPNO           NO OF OPT FIELDS                42300022
         LA    RWORKA,TRMOPT+1(RWORKA)  LOC OF BUF SIZE                 42400022
GETBUFSZ EQU   *                                                        42500022
         SR    RPARM,RPARM              ZERO REG                        42600022
         IC    RPARM,ZERO(RWORKA)       FIRST BYTE                      42700022
         SLL   RPARM,EIGHT              SHIFT                           42800022
         IC    RPARM,ONE(RWORKA)        SECOND BYTE                     42900022
         SR    RWORKA,RWORKA            ZERO REG                        43000022
         IC    RWORKA,DCBRESER          HDR RESERVE CHARS               43100022
         LA    RWORKA,AVTHDRSZ(RWORKA)  AVAIL BUF SIZE                  43200022
         TM    SCBQTYPE,SCBBFMM         MID-MESSAGE                     43300022
         BNO   USEHDR                   BRANCH IF NO                    43400022
BUFCTLP  EQU   *                                                        43500022
         LA    RWORKA,AVTTXTSZ          AVAIL BUFF SIZE                 43600022
USEHDR   EQU   *                                                        43700022
         LNR   RWORKA,RWORKA            SET REG NEG                     43800022
         AR    RWORKA,RPARM             DATA AMOUNT                     43900022
         AH    RZERO,HALFONE            COUNT BUFFER                    44000022
         SR    RWORKB,RWORKA            SUB DATA AMOUNT                 44100022
         BP    BUFCTLP                  BRANCH IF NOT ENOUGH BUFFERS    44200022
SETQCBAD EQU   *                                                        44300022
         LA    RWORKA,AVTDSIOB          DISK I/O QCB ADDR               44400022
SETEDATA EQU   *                                                        44500022
         OI    QCBEFLG,QCBEDATA         SET DATA IN MSG                 44600022
         OI    SCBQTYPE,SCBBFMM         SET MID-MESSAGE                 44700022
SETERBCT EQU   *                                                        44800022
         STC   RZERO,DRQERBCT           SAVE ERB COUNT                  44900022
         CLC   DRQBUFCT,DRQERBCT        BUF COUNT EQUAL OR HIGH         44920022
         BNL   BUFCTOK                  BRANCH IF YES                   44940022
         MVC   DRQBUFCT,DRQERBCT        SET BUFFER COUNT                44960022
BUFCTOK  EQU   *                                                        44980022
         NC    LCBERBCH,LCBERBCH        RECALLED BUFFER THERE           44984022
         BZ    ERBCTOK                  BRANCH IF NO                    44988022
         BCTR  RZERO,ZERO               SUBTRACT ONE                    44992022
ERBCTOK  EQU   *                                                        44996022
         STC   RZERO,LCBERBCT           SET ERB COUNT                   45000022
         MVI   LCBERBCT+1,ZERO          ZERO DISABLED COUNT             45100022
         STCM  RSCB,ADR,LCBSCBA         STORE ADDR OF CURR SCB @Z30X8IM 45200008
         NI    LCBERBST,255-LCBEOMSG    RESET EOM READ                  45500022
POSTERB  EQU   *                                                        45600022
         ST    RWORKA,LCBERB            QCB ADDR IN ERB                 45700022
         XC    LCBERBLK,LCBERBLK        ZERO LINK                       45800022
         LA    RPARM,LCBERB             ERB ADDR                        45900022
         B     DSPPOST                  POST                            46000022
RMVDRQST EQU   *                                                        46100022
         L     RSCB,LCBSCBDA-1          LINE SCB ADDR                   46200022
         SR    RWORKB,RWORKB            CLEAR REG                       46300022
         IC    RWORKB,AVTCSCH           IEDQGH OFFSET INTO VCON TAB     46400022
         L     RWORKA,AVTMSGS-1         VCON TAB ADDR                   46500022
         L     RWORKA,ZERO(RWORKB,RWORKA)                               46600022
*                                       IEDQGH ADDRESS                  46700022
         CR    RPARM,RLCB               ELEMENT A LCB                   46800022
         BE    RMVST                    BRANCH IF YES                   46900022
         TM    SCBSTAT1,SCBCBGN         CONC MSG BEGIN                  47000022
         BZ    POSTERB                  BRANCH IF NO                    47100022
RMVST    EQU   *                                                        47200022
         LR    RQCB,RLCB                SET REGS                        47300022
         LR    RSTCB,RDRQ               FOR UNAVR                       47400022
POSTIT   EQU   *                                                   @21A 47450027
         ST    RLCB,LCBQCBA-1           SET QCB ADDR                    47500022
         XC    LCBLINK,LCBLINK          ZERO LINK FIELD                 47600022
         NI    LCBSTAT1,LCBOCNI         RESET ALL EXCEPT STOPLINE       47700022
         OI    LCBSTAT1,LCBRECVN        SET LINE RECVN                  47800022
         MVC   LCBSCBA,LCBSCBDA         RESET SCB ADDR                  47900022
         BAL   RRETURN,DSPUNAVR         MOVE CONC STCB FROM LCB TO DRQ  48000022
         LR    RPARM,RLCB               SET REG                         48100022
         B     DSPPOST                  POST LCB TO LCB                 48200022
STOPLINE EQU   *                                                        48300022
         L     RSTCB,STCBLINK-1-IEDQSTCB(RSTCB)  NEXT STCB      SA56606 48400022
BYPASS   EQU   *                                               @OY21862 48430000
         LR    RPARM,RLCB               ELEMENT ADDR            SA56606 48470022
         LR    RQCB,RLCB                QCB ADDR                SA56606 48540022
         B     DSPBYPAS                 EXIT-NEXT STCB          SA56606 48610022
NOSEND   EQU   *                                                        48700022
         MVI   LCBSTAT1,LCBFREEN        SET LCB FREE                    48800022
         LA    RPARM,AVTOPCOB+FOUR      OP CNTRL ECB                    48900022
         POST  (1)                      POST OPCTL                      49000022
RELERB   EQU   *                                                        49100022
         OI    LCBERBST,LCBEOMSG+LCBDLNKN                               49200022
*                                       RELEASE ERB                     49300022
         B     DSPDISP                  RETURN                          49400022
         SPACE 1                                                        49500022
*********************************************************************** 49600022
*        ROUTINE TO FIND CORRECT QCBE FOR LEVEL QUEUEING              * 49700022
*        INPUT     RWORKA - INDEX TO PRIORTY QUEUE                    * 49800022
*        WORK      RWORKC RZERO                                       * 49900022
*        OUTPUT    RPARM - CORRECT QCBE                               * 50000022
*********************************************************************** 50100022
         SPACE 1                                                        50200022
FINDQCBE EQU   *                                                        50300022
         SR    RPARM,RPARM              ZERO REG                        50400022
         SR    RWORKC,RWORKC            ZERO REG                        50500022
         IC    RWORKC,QCBELGTH          EXTENSION LENGTH                50600022
         AR    RWORKC,RQCBE             NEXT ENTRY                      50700022
         IC    RPARM,QCBELGTH-IEDQQCBE(RWORKC)                          50800022
*                                       NEXT ENTRY LENGTH               50900022
         MR    RPARM-1,RWORKA           COMPUTE QCBE ADDR               51000022
         AR    RPARM,RWORKC             QCBE ADDR                       51100022
         BR    RRETURN                  RETURN                          51200022
         EJECT                                                          51300022
*********************************************************************** 51400022
*        THIS LOGIC IS ACTIVATED BY THE DESTINATION SCHEDULER         * 51500022
*        WHEN A EOM BUFFER IS POSTED TO A DESTINATION QCB             * 51600022
*********************************************************************** 51700022
         SPACE 1                                                        51800022
DESTENT  EQU   *                                                        51900022
         USING *,RENTRY                  ESTABLISH ADDRESSIBILITY       52000022
         L     RDCB,QCBDCBAD-1           DCB                            52100022
         TM    DCBOFLGS,OPEN             DCB OPEN                       52200022
         BCR   8,RRETURN                 BRANCH IF NO                   52300022
         L     RPARM,DCBDEBAD            DEB                            52400022
         TM    DEBOPATB-DEBNMSUB(RPARM),OUTPUT                          52500022
*                                        OPEN FOR OUTPUT                52600022
         BCR   8,RRETURN                 BRANCH IF NO                   52700022
         SR    RWORKA,RWORKA            ZERO REG                        52800022
         IC    RWORKA,DEBNMEXT-DEBNMSUB(RPARM)                          52900022
*                                        NUMBER OF LCBS                 53000022
         SR    RPARM,RPARM               ZERO REG                       53100022
         IC    RPARM,QCBRELLN            QCB STARTING RLN               53200022
         LR    RLCB,RPARM                SAVE RLN                       53300022
         BCTR  RLCB,RZERO                SUB  1                         53400022
         SR    RWORKA,RLCB              COUNT OF LCBS TO SCAN           53500022
         BCR   13,RRETURN                BRANCH IF RLN < DRBNMEXT       53600022
         SR    RWORKA,RWORKA            ZERO REG                        53700022
         IC    RWORKA,DCBEIOBX          LCB SIZE                        53800022
         MR    RPARM-1,RWORKA           STARTING LCB OFFSET             53900022
         AL    RPARM,DCBIOBAD            POINT TO 1OB                   54000022
         LA    RWORKA,LCBFLAG1-IEDQLCB  IOB OFFSET                      54100022
         SR    RPARM,RWORKA             ADJUST TO START OF LCB          54200022
         LR    RLCB,RPARM                LCB                            54300022
         LR    RZERO,RRETURN            SAVE RRETURN                    54400022
         SPACE 1                                                        54500022
*********************************************************************** 54600022
*        WHEN ENTERED WITH THE DRQ A CONCENTRATOR OR A QACTION        * 54700022
*        RELEASE WAS DONE                                             * 54800022
*********************************************************************** 54900022
         SPACE 1                                                        55000022
         LR    RWORKA,RQCB              SAVE DRQ REG                    55100022
         TM    QCBDSFLG,QCBDRQQ         DRQ                             55200022
         BO    RELDRQ                   BRANCH IF YES                   55300022
         SPACE 1                                                        55400022
*********************************************************************** 55500022
*        LOCATE DATA READY Q                                          * 55600022
*********************************************************************** 55700022
         SPACE 1                                                        55800022
         LH    RQCBE,QCBEXTO            EXTENSION OFFSET                55900022
         AR    RQCBE,RQCB               QCBE ADDR                       56000022
         L     RTERM,QCBECONC-IEDQQCBE-1(RQCBE)                         56100022
         LA    RPARM,QCBSTCHN-1         ADDRESS OF STCB                 56200022
         MVC   QCBSTCHN,QCBSLINK         REMOVE STCB                    56300022
         L     RQCB,TRMDESTQ-1           DRQ                            56400022
         LR    RWORKA,RQCB              SAVE DRQ ADDR                   56500022
         BAL   RRETURN,DSPPRIOR          ENQ STCB                       56600022
         LR    RRETURN,RZERO             RESTORE RRETURN                56700022
         LR    RQCB,RWORKA              RESTORE DRQ REG                 56800022
RELDRQ   EQU   *                                                        56900022
         TM    DRQSTAT-IEDQDRQ(RQCB),DRQTRMHO                           57000022
*                                       CONC HELD                       57100022
         BCR   ONE,RRETURN              BRANCH IF YES                   57200022
         L     RSTCB,DRQSTCHN-IEDQDRQ-1(RQCB)                           57300022
*                                        GET FIRST STCB                 57400022
         LA    RSTCB,ZERO(RSTCB)        ZERO HI-ORDER BYTE              57500022
         LA    RPARM,DRQSTCHN-IEDQDRQ-1(RQCB)                           57600022
*                                        ADDRESS OF MAIN STCB           57700022
         CLR   RSTCB,RPARM               MAIN STCB FIRST                57800022
         BCR   7,RRETURN                 BRANCH IF NO                   57900022
         TM    LCBSTAT1,LCBFREEN         LINE FREE                      58000022
         BNO   LINKSTCB                  BRANCH IF NO                   58100022
         CLI   LCBPRI,PRILCBDL           SYSTEM INTERVAL                58200022
         BE    LINKSTCB                  BRANCH IF YES                  58300022
         NI    LCBSTAT1,LCBOCNI          PRESERVE STOPLINE FLAG         58400022
         OI    LCBSTAT1,LCBSENDN         SET SENDING                    58500022
         ST    RLCB,LCBQCBA-1            PREPARE TO POST LCB TO LCB     58600022
         XC    LCBLINK,LCBLINK           ZERO LINK FIELD                58700022
         LR    RPARM,RLCB               SET POST REG                    58800022
         BAL   RRETURN,DSPPOSTR          POST LCB                       58900022
         LR    RQCB,RWORKA              RESTORE DRQ REG                 59000022
LINKSTCB EQU   *                                                        59100022
         LR    RSTCB,RLCB                SET UNAVL REG                  59200022
         L     RDCB,LCBDCBPT             DCB ADDRESS                    59300022
         TM    DCBCPRI,EQPRI            EQUAL PRIORITY                  59400022
         BO    PRIEQ                    BRANCH IF YES                   59500022
         OI    LCBSTAT2,LCBSNDPR         SET SEND PRIORITY              59600022
PRIEQ    EQU   *                                                        59700022
         BAL   RRETURN,DSPUNAVR          MOVE STCB TO LCB               59800022
         LR    RRETURN,RZERO             RESTORE REG                    59900022
         CLI   LCBCPA+24,CCWPOLL         LINE IN AUTOPOLL               60000022
         BE    AUTOP                    BRANCH YES             @OY21862 60004000
         CLI   LCBCPA+16,CCWPREP        POINT TO POINT RECEIVE @OY21862 60008000
         BNER  RRETURN                  BRANCH NO              @OY21862 60012000
         TS    LCBTSTSW                 DATA TRANSFERRED       @OY21862 60016000
         BNZR  RRETURN                  BRANCH YES             @OY21862 60020000
         SLR   RPARM,RPARM              CLEAR WORK REGISTER    @OY21862 60024000
         IC    RPARM,LCBUCBX            GET RLN MINUS 1        @OY21862 60028000
         SLL   RPARM,2                  MULTIPLY BY 4          @OY21862 60032000
         L     RQCBE,DCBDEBAD           LOAD DEB ADDRESS       @OY21862 60036000
         L     RPARM,DEBUCBAD-DEBNMSUB(RPARM,RQCBE) GET UCB    @OY21862 60040000
         LA    RPARM,0(,RPARM)          CLEAR HIGH ORDER       @OY21862 60044000
         LR    RWORKA,RRETURN           SAVE RETURN ADDRESS    @OY21862 60048000
         LR    RSTCB,RENTRY             SAVE BASE ADDRESS      @OY21862 60052000
FFF      EQU   4095                     CONTROL COUNT              @22A 60052627
         LA    RWORKC,FFF(,0)           LOAD CONTROL COUNT         @22A 60053227
         EJECT                                                     @N2A 60054027
HIOAGAIN EQU   *                                               @OY21862 60056000
         MVC   LCBFLAG1(5),NORMHIO      ERP NOT IN CONTROL     @OY21862 60060000
         IOHALT (1)                                            @OY21862 60064000
         LTR   RENTRY,RENTRY            HIO COMPLETE?              @22A 60064527
         BZ    HIOEND                   BRANCH YES                 @22A 60065027
         OC    LCBCSW,LCBCSW            CSW STORED?                @22A 60065527
         BNZ   HIOEND                   YES RETURN TO MAINLINE     @22A 60066027
         BCT   RWORKC,HIOAGAIN          BRANCH NO-REISSUE HIO      @22A 60066527
HIOEND   EQU   *                                                   @22A 60067027
         LR    RENTRY,RSTCB             RESTORE BASE           @OY21862 60068000
         LR    RRETURN,RWORKA           AND RETURN ADDRESS     @OY21862 60072000
         BR    RRETURN                  RETURN                 @OY21862 60076000
         EJECT                                                     @N2A 60078027
AUTOP    EQU   *                                               @OY21862 60080000
         IEDGETCB REG1=RWORKA,CBNAME=AVT FIND THE AVT              @N2C 60090627
         SPACE 1                                                   @N2A 60101227
         ST    RLCB,AVTSAVE2-IEDQAVTD(0,RWORKA)  SAVE LCB PTR    Y05331 60112005
         L     RWORKA,AVTSAVTP-IEDQAVTD(0,RWORKA) SEC AVT PTR      @N2M 60115027
         USING IEDNSVTD,RWORKA                                   Y05331 60118005
         TM    SAVTDIAF,SAVTVIRT        IN VIRTUAL ENVIRONMENT ? Y05331 60121005
         BNO   NOVIRT                   BRANCH IF NO             Y05331 60124027
         ST    RENTRY,AVTSAVE2+28       SAVE BASE                Y05331 60127005
         L     RENTRY,SAVTDIAG          VIRTUAL DIAGNOSE ROUTINE Y05331 60130005
         LR    RDCB,RRETURN             SAVE RETURN ADDRESS      Y05331 60133005
         LA    RZERO,LCBCPA+32          TIC ADDRESS              Y05331 60136005
         MVI   LCBCPA+32,CCWNOP         NOP VIRTUAL TIC          Y05331 60139005
         BAL   RRETURN,4(,RENTRY)       NOP REAL TIC,STOP AUTOPOLY05331 60142005
         SPACE 1                                                   @N2A 60145727
         IEDGETCB REG1=RWORKA,CBNAME=SAVT FIND THE SAVT            @N2C 60149427
         SPACE 1                                                   @N2A 60153127
         L     RENTRY,SAVTDIAG          VIRTUAL DIAGNOSE ROUTINE Y05331 60157005
         DROP  RWORKA                                            Y05331 60160005
         LA    RZERO,LCBCPA+56          TIC ADDRESS              Y05331 60163005
         MVI   LCBCPA+56,CCWNOP         NOP VIRTUAL TIC          Y05331 60166005
         BAL   RRETURN,4(,RENTRY)       NOP REAL TIC,STOP AUTOPOLY05331 60169005
         LR    RRETURN,RDCB             RESTORE RETURN ADDRESS   Y05331 60172005
         L     RENTRY,AVTSAVE2+28       RESTORE BASE             Y05331 60175005
         BR    RRETURN                  RETURN                   Y05331 60178005
         SPACE 1                                                   @N2A 60179527
NOVIRT   EQU   *                        NON VIRTUAL ENVIRONMENT  Y05331 60181005
         MVI   LCBCPA+32,CCWNOP         NOP TICS                        60200022
         MVI   LCBCPA+56,CCWNOP         AFTER POLLS                     60300022
         BR    RRETURN                  RETURN                          60400022
         EJECT                                                          60500022
*********************************************************************** 60600022
*        EQUATES                                                      * 60700022
*********************************************************************** 60800022
ZERO     EQU   0                        ZERO                            60900022
ONE      EQU   1                        ONE                             61000022
TWO      EQU   2                        TWO                             61100022
THREE    EQU   3                        THREE                           61200022
FOUR     EQU   4                        FOUR                            61300022
FIVE     EQU   5                        FIVE                            61400022
SIX      EQU   6                        SIX                             61500022
SEVEN    EQU   7                        SEVEN                           61600022
EIGHT    EQU   8                        EIGHT                           61700022
NINE     EQU   9                        NINE                            61800022
EQPRI    EQU   X'02'                    PRIORITY                        61900022
OPEN     EQU   X'10'                    OPEN FLAGS                      62000022
OUTPUT   EQU   X'01'                    DCB FLAGS                       62100022
CSVTO    EQU   X'20'                    CONC VTO                        62200022
RSVTO    EQU   X'0C'                    RCV VTO                         62300022
CLRQPTR  EQU   X'0F'                    QUEUEING MASK                   62400022
ADR      EQU   7                        MASK FOR ADDR STORE    @Z30X8IM 62450008
DELAY    EQU   X'02'                    MASK FOR LCB IN DELAY      @21A 62475027
         EJECT                                                          62500022
*********************************************************************** 62600022
*        CONSTANTS                                                    * 62700022
*********************************************************************** 62800022
HALFONE  DC    H'1'                     ONE                             62900022
NORMHIO  DC    X'C210000048'            NORMAL HALT            @OY21862 62950000
         EJECT                                                          63000022
*********************************************************************** 63100022
*        DSECTS                                                       * 63200022
*********************************************************************** 63300022
         TPRIOR                                                         63400022
         TAVTD                                                          63500022
         IHAASCB                                                  @N1A  63550029
         TQCBD                                                          63600022
         TLCBD                                                          63700022
         TSCBD                                                          63800022
         TDEBD                                                          63900022
         DCBD  DSORG=TX                                                 64000022
         TDISPD                                                         64100022
         TTRMD                                                          64200022
         TRECBD                                                         64300022
         TSTCBD                                                         64400022
         TPRFD                                                          64500022
         TCCWD                                                          64600022
         TDRQD                                                          64700022
         TQCBED                                                         64800022
         TTCXD                                                  @N1A    64833329
         IHAPSA                                                  @N1A   64866629
         END                                                            64900022
