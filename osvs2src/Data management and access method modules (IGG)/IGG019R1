19R1     TITLE ' IGG019R1 - DIAL RECEIVE SCHEDULER '                    00000505
         SPACE 1                                                        00001005
IGG019R1 CSECT                                                          00001505
         SPACE 3                                                        00002005
         SPACE 3                                                        00400122
*CHANGE ACTIVITY= AS FOLLOWS:                                           00400222
******************** MICROFICHE FLAGS *********************** SUPT CODE 00400352
*A434000                                                        SA59166 00404205
*C458040                                                         S22029 00404305
*D598000,458070                                                  S22029 00404405
*A274000,396000,458030,588000                                    S22025 00404505
*C206000,278000,293200,458060                                    S22025 00404605
*D283000-286000,414000,594500,598000-610000                      S22025 00404705
*C204000,293236.293242,451000,664000,762000,778800-780400,781800 S22025 00404805
*A232000,292000                                                 SA53611 00404905
*C012000                                                         S21903 00405005
*D612000                                                         S21903 00405105
*A534000,548000                                                 SA59006 00405205
*C072200,664000                                                  X01004 00405305
*D776000                                                         X01004 00405405
*C808000                                                         Y01948 00405505
*A184000,750000,781800                                           Y05330 00405605
*C200000-204000,246000,262000-272000,293220-293224,293390-293400,Y05330 00405705
*C368000-372000,448000-450000,740000                             Y05330 00405805
*D190000-191000,204000,250000-252000,262000-272000,293230-293242,Y05330 00405905
*D293400,368000-372000,454000-456000                             Y05330 00406005
*A 549000                                                       SA68698 00406105
*D 558000-564000                                                SA68698 00406205
*C502000                                                        SA69638 00406305
*A578000                                                       @YA08092 00426309
*A676000                                                       @SA73490 00446309
*A676600,677400                                                @SA74959 00466309
*A293450                                                       @SA75440 00486309
*D676200-677700                                                @SA75437 00506309
*C535200                                                       @YA10696 00526309
*C408000,A770000                                               @OY12954 00526491
*C438000,A774000                                               @OY13276 00526591
*C420000                                                       @OY13287 00526691
*C534200                                                       @OY13624 00526791
*A219000                                                       @OY14092 00526891
*C276000,595000-595500                                         @OY14092 00526991
*A308000,380000                                                @OY14058 00527091
*A626000,644000,652000-660000                                  @OX17150 00535000
*D438000-439000                                                @OX19964 00565000
*A655000                                                       @OY21190 00575000
*C645530                                                       @OZ37052 00585000
*A396000,645440,781800                                         @OZ35319 00592012
* $01=OZ41191  ETC2202  79.10.18  547784:                          @01A 00595927
* $02=OZ41524  ETC2202  79.11.17  098061:                          @02A 00645927
* $21=OZ54129  ETC2412  81.08.25  760058:                          @21A 00670927
*                                                                       00695925
         SPACE 3                                                        00745925
*********************************************************************** 00795925
*                                                                     * 00845925
*$MOD(IGG019R1) COMP(I@) PROD(TCAM):                               @01C 00895925
*                                                                S21903 01240022
*DESCRIPTIVE-NAME= DIAL RECEIVE SCHEDULER                        S21903 01280022
*                                                                S21903 01320022
*COPYRIGHT= 'NONE'                                               S21903 01360022
*                                                                     * 01400020
*  STATUS:  CHANGE LEVEL 5                                            * 01600052
*                                                                     * 01800020
*FUNCTION -- TO INITIATE A RECEIVE OPERATION AND TO SCAN THE DIAL OUT * 02000020
*   CALL QUEUE WHEN A LINE IS AVAILABLE FOR OUTPUT.  TO POST A        * 02200020
*   DESTINATION QCB TO THE TIME QUEUE TO OBSERVE A SPECIFIED DELAY    * 02400020
*   (CLOCK OR INTVL OPTION ON TERMINAL MACRO).                        * 02600020
*                                                                     * 02800020
*ENTRY POINTS -- FIRST EXECUTABLE INSTRUCTION                         * 03000020
*                                                                     * 03200020
*INPUT --                                                             * 03400020
*   R1 - POINTS TO ELEMENT (LCB OR QCB)                               * 03600020
*   R11  DISPATCHER BASE                                              * 03800020
*   R13  ADDRESS OF AVTSAVE2                                          * 04000020
*   R15  ENTRY POINT ADDRESS                                          * 04200020
*                                                                     * 04400020
*OUTPUT --                                                            * 04600020
*   1.  LCB IS POSTED TO ITSELF TO ACTIVATE NEXT STCB                 * 04800020
*   2. ERB IS POSTED TO OBTAIN BUFFERS FOR RECEIVE OPERATION          * 05000020
*   3.  LCB IS POSTED TO TIME QUEUE WHEN CORE OR DISK QUEUE IS FULL   * 05200020
*   4.  NEXT STCB IN THE LCB'S STCB CHAIN IS TO ACTIVATED             * 05400020
*   R1  POINTS TO ELEMENT IF POSTING IS TO BE DONE                    * 05600020
*   R11 DISPATCHER BASE                                               * 05800020
*   R13  ADDRESS OF AVTSAVE2                                          * 06000020
*                                                                     * 06200020
*EXTERNAL ROUTINES --                                                 * 06400020
*   'IEDQTNT' TO CONVERT TWO BYTE TNT OFFSET TO TERMINAL ADDRESS      * 06600020
*                                                                     * 06800020
*   'TIME' MACRO - TO OBTAIN TIME OF DAY TO COMPUTE DELAY             * 07000020
*                                                                     * 07200020
*   EXCPVR - TO DISABLE AN OUTPUT ONLY LINE                           * 07220005
*                                                                     * 07240020
*   DSPUNAVR - TO ADJUST STCB CHAIN OF LCB                            * 07260020
*                                                                     * 07280020
*   DSPLIFOR - TO PLACE SEND STCB AT TOP OF LCB CHAIN                 * 07300020
*                                                                     * 07320020
*EXITS-NORMAL --                                                      * 07400020
*   R1  ADDRESS OF ELELMENT IS POSTING IS DONE                        * 07600020
*   R13  ADDRESS OF AVTSAVE2                                          * 07800020
*   R11  DISPATCHER BASE                                              * 08000020
*   RETURN IS ON R11 WITH AND OFFSET TO HAVE THE DISPATCHER PROVIDE   * 08200020
*   THE DESIRED SERVICE.                                              * 08400020
*                                                                     * 08600020
*EXITS-ERROR -- NONE                                                  * 08800020
*                                                                     * 09000020
*TABLES/WORK AREAS --                                                 * 09200020
*   TSCTBD                                                            * 09400020
*   TAVTD                                                             * 09600020
*   TLCBD                                                             * 09800020
*   TQCBD                                                             * 10000020
*   DCBD                                                              * 10200020
*   TTRMD                                                             * 10400020
*   TCCWD                                                             * 10600020
*   TDEBD                                                             * 10800020
*                                                                     * 11000020
*ATTRIBUTES -- ENABLED, PROBLEM PROGRAM MODE, RE-USABLE, REFRESHABLE  * 11200020
*                                                                     * 11400020
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         * 11600020
*   PARTICUALR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER      * 11800020
*   SET.                                                              * 12000020
*                                                                     * 12200020
*   THE DIAL OUT CALL QUEUE IS SCANNED FOR AN OUTGOING CALL WHENEVER  * 12400020
*   THE NEGATIVE RESPONSE BIT IS SET IN LCBSTAT2.  THE MOST ECONOMICAL* 12600020
*   CALL WILL BE MADE (WATS TECHNIQUE - LOWEST RLN) UNLESS MESSAGE    * 12800020
*   PRIORITY LEVELS ARE SPECIFIED.  THE HIGHEST PRIORITY MESSAGE      * 13000020
*   WILL BE SENT  USING THE LINE THAT IS CURRENTLY AVAILABLE.         * 13200020
*                                                                     * 13400020
*   FOR QCB'S WITH CLOCK OR INTVL, THIS MODULE WILL COMPUTE THE TNT   * 13600020
*   OFFSET FOR THE TERMINAL WHICH IS TO BE CALLED AND WILL POST THE   * 13800020
*   QCB TO THE TIME QUEUE AFTER THE CALL IS MADE.                     * 14000020
*                                                                     * 14200020
*********************************************************************** 14400020
         EJECT                                                          14600020
*                                                                       14800020
*        REGISTER EQUATES                                               15000020
*                                                                       15200020
R0       EQU   0                                                        15400020
R1       EQU   1                        ELEMENT REGISTER                15600020
R2       EQU   2                        WORK REGISTER                   15800020
RSTCB    EQU   3                  STCB BASE                             16000020
RLCB     EQU   4                        LCB BASE                        16200020
RA       EQU   5                        WORK REGISTER                   16400020
RWORK    EQU   6                  TEMPORARY WORK REG                    16600020
RQCB     EQU   7                        ENTRY QCB ADDRESS (LCB)         16800020
RB       EQU   8                        WORK REGISTER                   17000020
RDCB     EQU   10                 DCB ADDR                              17200020
RSUPBASE EQU   11                       DISPATCHER BASE REGISTER        17400020
RBASE    EQU   12                 SUBTASK BASE REG                      17600020
R13      EQU   13                       SAVE AREA ADDRESS (AVTSAVE2     17800020
R14      EQU   14                 RETURN ADDR REG                       18000020
R15      EQU   15                       ENTRY BASE REGISTER             18200020
*                                                                       18400020
         USING *,R15                                             Y05330 18500005
         BAL   RBASE,ID                 BYPASS ID - SET NEW BASE Y05330 18600005
         DROP  R15                      DROP TEMPORARY BASE  ASE Y05330 18700005
         USING *,RBASE                                                  18800020
IGG019R1 IEDHJN                                                         19000005
         SPACE 1                                                 S22025 19150022
         USING IEDQSTCB,RSTCB                                           19200020
         USING IEDQQCB,RQCB                                             19400020
         USING IEDQDISP,RSUPBASE                                        19600020
         USING AVTSAVE2,R13                                             19800020
ID       DS    0H                                                Y05330 20000005
         LA    RLCB,AVTEZERO(,R1)       SET THE LCB ADDRESS      S22025 20900022
         CLI   QCBSTVTO,DSPDIASC       THIS AN LCB OR QCB               21000020
         BE    LCB                      BRANCH, IT'S AN LCB             21200020
         SH    RSTCB,QCBBKUP            BACK UP TO LCB                  21400020
         LR    RLCB,RSTCB               LCB ADDRESS TO LCB REGISTER     21600020
         USING IEDQLCB,RLCB                                             21800020
         L     RDCB,LCBDCBPT            GET DCB BASE                    21900020
         NI    LCBCHAIN,AVTEFF-LCBCTLMD CLEAR DIAL-UP REQUEST  @OY14092 21950091
         TM    QCBSTAT,QCBSCHDL         QCB COME OFF TIME Q WITH        22000020
*                                         LCB FOUND BY SEND SCHEDULER   22200020
         BZ    NOSRCH                   NO                              22400020
         EJECT                                                          22600020
TNTFIND  EQU   *                                                        22800020
*        SOURCE MUST BE FOUND AND DIAL UP TO POLL                       23000020
         LA    RQCB,AVTEZERO(,RQCB)    CLEAR HI ORDER BYTE              23100020
         NI    QCBSTAT,AVTEFF-QCBSCHDL  TURN OFF SEITCH                 23200020
         L     RWORK,DCBDEBAD-IHADCB(,RDCB) DEB ADDRESS         SA53611 23250022
         TM    DEBOPATB-DEBNMSUB(RWORK),OUTPUT OUTPUT ONLY      SA53611 23300022
         BO    POSTFRE                  BRANCH IF YES           SA53611 23350022
         SR    R2,R2                    CLEAR TNT REGISTER              23400020
         LR    RB,R2                    CLEAR WORK REGISTER             23600020
         L     RA,AVTRNMPT              TNT CODE BASE                   23800020
         USING IEDQTNTD,RA              TERMINAL NAME TABLE DSECT       24000020
         IC    RB,TNTENLEN              GET THE SIZE OF A NAME          24200020
*                                         TABLE ENTRY                   24400020
         LA    RA,TNTFIRST-THREE        FIRST ENTRY - 3          Y05330 24600005
*                                         FIRST ENTRY IN THE TABLE      24800020
TNTLOOP  EQU   *                                                        25400020
         LA    R2,1(,R2)                BUMP TNT OFFSET                 25600020
         LA    RA,THREE(RB,RA)          POINT TO THE TERMINAL ENTRY     25800020
*                                         ADDRESS                       26000020
         ICM   RWORK,AD,0(RA)           TERMINAL ENTRY ADDRESS   Y05330 26200005
         CLM   RQCB,AD,ONE(RWORK)       SAME QCB ADDRESS         Y05330 26800005
         BNE   TNTLOOP                  NO, LOOP                        27400020
         OI    LCBCHAIN,LCBCTLMD        SET DIAL=UP REQUEST    @OY14092 27600091
         STH   R2,LCBTTCIN              SET UP THE SOURCE        S22025 27800022
REPOLL   EQU   *                                                 S22025 28000022
         NI    LCBSTAT2,X'FF'-LCBNEGRP  RESET NEG RESPONSE       S22025 28200022
         B     POLL                     REQUEST BUFFERS          S22025 28400022
         EJECT                                                          29000020
NOSRCH   EQU   *                                                        29200020
         L     RWORK,DCBDEBAD-IHADCB(,RDCB) DEB ADDRESS         SA53611 29210022
         TM    DEBOPATB-DEBNMSUB(RWORK),OUTPUT OUTPUT ONLY      SA53611 29220022
         BNO   NOUTONLY                 BRANCH IF NO            SA53611 29230022
         OI    LCBSTAT2,LCBNEGRP        SET NEG RESPONSE        SA53611 29240022
NOUTONLY EQU   *                                                SA53611 29250022
         TM    LCBSTAT2,LCBNEGRP        NEGATIVE RESP READ TO DISAB     29260020
         BZ    LCB                      BRANCH IF NO             S22025 29290022
         BAL   R14,TNTSUB               GET DESTINATION ADDRESS  Y05330 29322005
         SPACE 1                                                 Y05330 29322305
         BZ    NORETRY                  ZERO, NO COUNT TO CLEAR  S22025 29322622
         USING IEDQTRM,R1                                        S22025 29325022
         SR    R2,R2                    CLEAR REGISTER TO ZERO   S22025 29326022
         LH    R2,TRMDEVFL              GET DEVICE FLAGS         S22025 29327022
         SLL   R2,TWEN6                 SHIFT TO RETRY BIT       S22025 29328022
         LTR   R2,R2                    RETRY VALUE SPECIFIRD    S22025 29329022
         BNL   NORETRY                  BRANCH IF NOT            S22025 29330022
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS SPECIFIED  S22025 29331022
         BO    OPTFL                    BRANCH IF YES            S22025 29332022
         LA    RWORK,TRMOPNO            GET ADDR OF FIRST DEVICE S22025 29333022
*                                         DEPENDENT FIELD        S22025 29334022
         B     RSCAN                    GO FIND RETRY COUNT FIELDS22025 29335022
OPTFL    EQU   *                                                 S22025 29336022
         SR    R14,R14                  CLEAR REGISTER TO ZERO   S22025 29337022
         IC    R14,TRMOPNO              NUMBER OF OPTION FIELDS  S22025 29338022
         LA    RWORK,TRMOPT(R14)        DEVICE DEPENDENT ADDR    Y05330 29339005
*                                         FIELD                  S22025 29341022
RSCAN    EQU   *                                                 S22025 29342022
         SR    R14,R14                  CLEAR REGISTER TO ZERO   S22025 29343022
         SR    R15,R15                  CLEAR REGISTER TO ZERO   S22025 29344022
         LH    R14,TRMDEVFL             DEV DEP FIELD FLAGS      S22025 29345022
         N     R14,AVTCLRHI             CLEAR HIGH TWO BYTES   @SA75440 29345509
         SR    RB,RB                    CLEAR REGISTER TO ZERO   S22025 29346022
         SRL   R14,FIVE                 ELIMINATE FIVE BITS      S22025 29347022
SHIFT    EQU   *                                                 S22025 29348022
         SRDL  R14,ONE                  MOVE IN ONE BIT          S22025 29349022
         SRL   R15,THIRTY1              MAKE REG ONE OR ZERO     S22025 29350022
         AR    RB,R15                   BUMP D.D. COUNTER        S22025 29351022
         LTR   R14,R14                  ALL BITS TESTED          S22025 29352022
         BNZ   SHIFT                    BRANCH IF NOT            S22025 29353022
BUMP     EQU   *                                                 S22025 29354022
         CH    RB,HONE                  RETRY COUNT FOUND        S22025 29355022
         BE    CLEAR                    BRANCH IF YES            S22025 29356022
         IC    R14,0(0,RWORK)           SIZE OF D.D. FIELD       S22025 29357022
         LA    RWORK,1(R14,RWORK)       BUMP PAST THIS D.D. FIELDS22025 29358022
         BCT   RB,BUMP                  CONTINUE LOOP TO RETRY   S22025 29359022
*                                         COUNT                  S22025 29360022
CLEAR    EQU   *                                                 S22025 29361022
         MVI   2(RWORK),AVTEZERO        MAKE RETRY FIELD ZERO    S22025 29362022
NORETRY  EQU   *                                                 S22025 29363022
         LR    R2,RLCB                  SAVE LCB ADDRESS                29400020
         LR    RWORK,RQCB               SAVE QCB ADDRESS                29600020
         LR    RSTCB,RQCB               SET FOR UNAVR                   29800020
         LR    RQCB,RLCB                FOR UNVAR                       30000020
         BAL   R14,DSPUNAVR             REMAOVE SEND SCHEDUALER         30200020
         LR    RQCB,RWORK               RESTORE QCB BASE                30400020
         LH    RWORK,QCBINTVL           GET THE AMOUNT OF DELAY         30600020
         N     RWORK,AVTCLRHI           CLEAR HIGH ORDER HALF WORD      30800020
         BZ    NOTIMEQ                  DIAL-UP READ ONLY      @OY14058 30900091
         CLI   QCBSTPRI,CLOCK           CLOCK OR INTVL                  31000020
         BNE   TIMEEXIT                 BRANCH IF INTVL                 31200020
*                                                                       31400020
         AR    RWORK,RWORK              DOUBLE                          31600020
         TIME  BIN                      GET TIME OF DAY                 31800020
         SRDL  R0,HALF                  SHIFT TIME TO R1                32000020
         D     R0,HUND                  CONVERT TIME TO SECONDS         32200020
*                          RESULT IS IN R0 + 1                          32400020
         N     R1,CLRMASK               CLEAR UNNEEDED BITS             32600020
         CLR   R1,RWORK                 COMPARE TIME OF DAY TO CLOCK    32800020
*                                       REQUES                          33000020
         BL    SAMEDAY                  BRANH IF REQUESTED TIME IS      33200020
*                                       TODAY                           33400020
*                                                                       33600020
         A     RWORK,TW24HRS            ADD 24 HOURS - REQUESTED        33800020
*                                       INTERVAL TIME GOES PAST         34000020
*                                       MIDNIGHT                        34200020
SAMEDAY  EQU   *                                                        34400020
         SR    RWORK,R1                 DELAY (IN SECONDS)              34600020
TIMEEXIT EQU   *                                                        34800020
         C     RWORK,TWELVHRS           IS DELAY OVER 12 HOURS          35000020
         BNH   LESS12                   BRANCH YES                      35200020
*                                                                       35400020
         S     RWORK,TWELVHRS           DECREMENT 12 HORRS              35600020
         OI    QCBSTAT,QCBTIME          INDICATE MORE THAN 12 HOURS     35800020
LESS12   EQU   *                                                        36000020
         STH   RWORK,QCBEOLDT           SET DELAY REQUESY               36200020
         MVI   QCBLKRLN,AVTEZERO        SET THE OFFSET TO THE QCB       36400020
*                                         FOR TIME DELAY                36600020
         STCM  RQCB,AD,QCBELCHN         QCB ADDRESS FOR POST     Y05330 36800005
         MVC   QCBSTCHN,QCBSLINK        REMOVE SEND SCHEDULER           37400020
         MVI   QCBPRI,PRIDSKRQ          SET QCB PRTY HIGHER     SA63954 37500052
         LR    R1,RQCB                  TIME Q PARAMETER                37600020
         L     R15,AVTHG01              BALR ENTRY                      37800020
         BALR  R14,R15                  LINK TO IT                      38000020
NOTIMEQ  EQU   *                                               @OY14058 38100091
         LR    RLCB,R2                  RESTORE LCB AADDRESS            38200020
         MVI   LCBTSTSW,AVTEFF          INDICCATE NO SOURCDE            38300020
         B     POSTFRE                  POST LCB TO ITSELF              38400020
         EJECT                                                          38600020
LCB      EQU   *                                                        38800020
         L     RDCB,LCBDCBPT            DCB BASE                        39400020
         USING IHADCB,RDCB                                              39600020
         L     RWORK,LCBSCBA-1          GET THE SCB ADDRESS      S22025 39640022
         USING IEDQSCB,RWORK                                     S22025 39680022
         TM    SCBQTYPE,SCBBFMM         MIDDLE OF MESSAGE        S22025 39720022
         BO    REPOLL                   YES, BRANCH              S22025 39760022
         TM    AVTBIT1,AVTCLOSN         IS CLOSE DOWN IN PROGRESS       39800020
         BO    OUTONLY                  BRANCH YES-SEARCH QUEUE         40000020
         TM    LCBSTAT1,LCBOCNI         STOP LINE IN PROGRESS           40200020
         BZ    NOSTOP                   NO                              40400020
         MVC   LCBQCBA,AVTHK+1          SET QCB ADDRESS FOR POST        40600020
         L     RQCB,LCBSTCBA-1          GET STCB               @OY12954 40800091
         LA    RQCB,0(RQCB)             CLEAR HIGH-ORDER BYTE  @OY12954 40810091
         SH    RQCB,QCBBKUP             BACKUP TO QCB          @OY12954 40820091
         CLI   QCBSTVTO,DSPSNDSC        IS SEND SCHED IN CHAIN @OY12954 40830091
         BNE   POSTIT                   BRANCH-NO              @OY12954 40840091
         CLI   QCBSTPRI,CALLOPT         CLOCK OR CINTVL        @OY12954 40850091
         BL    POSTIT                   BRANCH-NO              @OY12954 40860091
         NC    QCBMSGCT,QCBMSGCT        ANY MSGS ON QUEUE      @OY12954 40870091
         BNZ   POSTIT                   BRANCH-YES             @OY12954 40880091
         OI    LCBSTAT2,LCBNEGRP        TURN ON NEGREP         @OY12954 40890091
         B     NOUTONLY                 GO REMOVE SCH AND      @OY12954 40900091
*                                       OBSERVE NEW INTVL      @OY12954 40910091
*                                                                       41000020
NOSTOP   EQU   *                                                        41200020
         USING IEDQSCB,RWORK                                            41600020
         TM    SCBSTATE,SCBLCK1N+SCBMSGLN EXTENDD LOCK                  41800020
         BNZ   REPOLL                   RE-POLL                @OY13287 42000091
         DROP  RWORK                                                    42200020
         TM    AVTBIT1,AVTTSON          IS TSO IN SYSTEM?           TSO 42400020
         BZ    TSO1                     BRANCH ON NO                TSO 42600020
         L     RWORK,AVTTSOPT           GET ADDRESS OF TSO SCHED    TSO 42800020
         L     RWORK,TSISCHED-IEDQTSI(,RWORK)                       TSO 43000020
         BAL   R2,4(,RWORK)             BRANCH TO ROUTINE           TSO 43200020
TSO1     EQU   *                                                    TSO 43400020
         L     R2,DCBDEBAD              DEB ADDRESS             SA59166 43430022
         TM    DEBOPATB-DEBNMSUB(R2),OUTPUT OUTPUT ONLY LINE    SA59166 43460022
         BNO   TSO1A                    BRANCH IF NO            SA59166 43490022
         OI    LCBSTAT2,LCBNEGRP        SET NEG RESP FLAG       SA59166 43520022
TSO1A    EQU   *                                                SA59166 43550022
         TM    LCBSTAT2,LCBNEGRP        NEGATIVE RESPONSE TO POLL       43600020
         BNO   POLL                     NO,POLL AGAIN          @OY13276 43920091
         EJECT                                                          44000020
OUTONLY  EQU   *                                                        44200020
         SR    R2,R2                    CLEAR WORK REGISTER             44400020
         SR    RQCB,RQCB                ASSUME ORIGIN NOT USED          44600020
         BAL   R14,TNTSUB               GET DESTINATION ADDRESS  Y05330 44800005
         SPACE 1                                                 Y05330 44900005
         BZ    NOSOURCE                 BRANCH IF NO ORIGIN      S22025 45100022
         CLI   LCBTSTSW,AVTEFF          NO LONGER HAVE CONNECTION       45260020
         BE    NOSOURCE                 BRANCH IF YES                   45320020
         L     RQCB,TRMDESTQ-1-IEDQTRM(,R1) QCB ADDRESS                 45800020
         TM    QCBDSFLG,QCBDISK+QCBCORE TIME-SHARING QUEUES?        TSO 45803020
         BZ    REQBUF                  YES SKIP DIAL CALL QUEUE  S22029 45804022
         TM    QCBFLAG,QCBTSSES        QCB IN TSO SESSION        S22029 45804322
         BO    REQBUF                  YES SKIP DIAL CALL QUEUE  S22029 45804622
         TM    AVTBIT1,AVTCLOSN         IS IT CLOSEDOWN          S22025 45805022
         BO    NEXSTCB                  YES, BRANCH              S22025 45806022
         CLI   QCBSTPRI,CLOCK           IS IT CLOCK                     45810020
         BE    NOCALLUP                 BRANCH IF YES                   45820020
         TM    QCBINSRC+2,TIMEQ         IS QCB ON TIME Q                45830020
         BZ    NOCALLUP                 BRANCH NO                       45850020
         LR    R1,RQCB                  SET FOR CALLING HG              45860020
         L     R15,AVTHG02              GET ENTRY POINT OF HG           45870020
         BALR  R14,R15                  LINK TO IT                      45880020
         NI    QCBSTAT,AVTEFF-QCBSCHDL  INDICATE SOURCE SET             45890020
         LA    R1,QCBSTVTO              SET SUBTASK ADDRESS             45900020
         B     MOVESTCB                 MOVE SCHEDULER                  45910020
NOCALLUP EQU   *                                                        45920020
         LA    RQCB,QCBSTVTO      GET SEND SCH STCB ADDR                46000020
NOSOURCE EQU   *                                                        46200020
         SR    R0,R0              ZERO FLAG REG                         46400020
         XC    AVTDOUBL(8),AVTDOUBL     CLEAR WORK AREA                 46600020
         LA    RA,AVTDOUBL-QCBPRLVL+QCBSTVTO TO 0 PRI LEVEL AND RLN     46800020
         L     RWORK,DCBIOBAD           ADD IOB LESS LCB SIZE           47000020
         SR    RB,RB                    CLEAR WORK REGISTER             47200020
         IC    RB,DCBEIOBX              SIZE OF AN LCB                  47400020
         AR    RWORK,RB                 POINT O IOB OF LCB              47600020
         SH    RWORK,DOCQ               CALL Q IS 8 BYTE PREFIX         47800020
*                                         OF 1ST LCB IN GROUP           48000020
LOOPOCQ  EQU   *                                                        48200020
         LR    RSTCB,RWORK        SAVE PREVIOUS ITEM                    48400020
         L     RWORK,STCBLINK-1   GET ADDR OF NEXT ITEM IN CHAIN        48600020
         CLI   STCBPRI-IEDQSTCB(RWORK),AVTEZERO  IS THIS THE LAST       48800020
*                                                ITEM IN THE CHAIN      49000020
         BE    ENDOCQ             YES, GO SEE IF CALL FOUND             49200020
         LA    RWORK,0(0,RWORK)   ZERO HI-ORDER BYTE                    49400020
         CLR   RWORK,RQCB         ARE WE CONNECTED TO THIS TERMINAL     49600020
         BNE   TESTCALL                 NOT SAME DESTINATION            49800020
         MVI   LCBTSTSW,F0              PREVENT DIAL UP                 50000020
         NI    QCBSTAT-QCBSTVTO(RQCB),AVTEFF-QCBSCHDL TTCIN SET SA69638 50200005
REMOVEOC EQU   *                                                        50400020
         MVC   STCBLINK(3),STCBLINK-IEDQSTCB(RWORK) REMOVE FROM Q       50600020
         LR    R1,RWORK                 USE DISPATCHER CODE             50800020
MOVESTCB EQU   *                                                        50900020
         LA    RQCB,LCBSTCBA-1    SET CHAIN AS LCB'S STCB CHAIN         51000020
         BAL   R14,DSPLIFOR       GO PLACE SEND SCHEDULER AT TOP OF CHN 51200020
         MVI   LCBPRI,PRILNFRE          POST PRIORITY                   51400020
         ST    RLCB,LCBQCBA-1           POST TO ITSELF                  51600020
         LR    R1,RLCB                  ELEMENT FOR POST                51800020
         L     RQCB,LCBSTCBA-1          POINT TO SEND SCHEDULER         52000020
         TM    QCBSTAT-QCBSTVTO(RQCB),QCBSCHDL CLOCK OR INTVL           52200020
         BZ    DSPPOST                  BRANCH NO                       52400020
         SH    RQCB,QCBBKUP             ADJUST QCB BASE                 52600020
         B     TNTFIND                  SET SOURCE FOR DIAL UP          52800020
TESTCALL EQU   *                                                        53000020
         CLI   STCBPRI-IEDQSTCB(RWORK),CALLPRI IS THIS CALL=NONE        53200020
         BE    LOOPOCQ                  YES LOOK AT NEXT ENTRY          53400020
         TM    QCBFLAG-QCBSTVTO(RWORK),QCBTERMQ QUEUED BY TRM  @OY13624 53420091
         BZ    USERLN                   NO, BRANCH             @YA10696 53440009
         TM    QCBSTAT-QCBSTVTO(RWORK),QCBTRMHO IS QUEUE HELD   SA59006 53460022
         BO    LOOPOCQ                  LEAVE HELD QCB ON DOCQ @YA10696 53520009
USERLN   EQU   *                                               @YA10696 53560009
         CLC   QCBPRLVL-QCBSTVTO(1,RWORK),QCBPRLVL-QCBSTVTO(RA)         53600020
*                                         ARE THE HIGHEST MESSAGE       53800020
*                                         PRIORITIES THE SAME           54000020
         BL    LOOPOCQ                  ITS LOWER LOOK AT NEXT ENTRY    54200020
         BH    SAVECALL                 SAVE THIS CALL                  54400020
         CLI   QCBPRLVL-QCBSTVTO(RWORK),AVTEZERO 0 PRIORITY LEVEL       54600020
         BNE   LOOPOCQ                  NO WE HAVE TRUE PRIORITY        54800020
         CLC   QCBRELLN-QCBSTVTO(1,RWORK),QCBRELLN-QCBSTVTO(RA) SA68698 54920005
*                                       IS THIS A HIGHER RLN    SA68698 54940005
         BNH   LOOPOCQ                  NO, BRANCH              SA68698 54960005
SAVECALL EQU   *                                                SA68698 54980005
         IC    R2,QCBRELLN-QCBSTVTO(0,RWORK) GET RLN FOR QCB            55000020
         BCTR  R2,R0              SUBTRACT ONE                          55200020
         EX    R2,RLNCLI          CAN CALL BE DONE ON THIS LINE         55400020
         BL    LOOPOCQ                  BRANCH LCB RLN LESS THAN QCB    55600020
         LR    RA,RWORK                 SAVE A CALL                     56600020
         LR    R0,RSTCB                 SAVE FOR DELINK                 56800020
         B     LOOPOCQ                  LOOK AT NEXT ENTRY              57000020
         SPACE                                                          57200020
         SPACE                                                          57400020
         SPACE 1                                                        57600020
ENDOCQ   EQU   *                                                        57800020
         XC    LCBTTCIN,LCBTTCIN        CLEAR PREV SOURCE      @YA08092 57900009
         MVI   LCBTSTSW,AVTEFF          INSURE A DIAL UP                58000020
         LR    RWORK,RA                 RESTORE  THE CALL               58200020
         LTR   RSTCB,R0                 WAS A CALL FOUND                58400020
         BNZ   REMOVEOC                 YES                             58600020
         MVC   LCBTTCIN,LCBLNENT        SET LINE ENTRY AS SOURCE        58800020
REQBUF   EQU   *                                                        58820022
         TM    AVTBIT1,AVTCLOSN         IS CLOSE IN PROGRESS            58840022
         BZ    POLL                     NO, BRANCH               S22025 58860022
NEXSTCB  EQU   *                                                 S22025 58880022
         L     RSTCB,LCBRSLNK-1         GET QEVENT                      58900022
         LR    R1,RLCB                  BYPASS PARAMETER                58920022
         B     DSPBYPAS                 CONTROL TO QEVENT               58940022
         EJECT                                                          59000020
POLL     EQU   *                                                        59200020
         MVC   LCBTTBIN,LCBTTCIN        SAVE SOURCE INFORMATION         59400020
         NI    LCBSTAT1,LCBOCNI+LCBOCWTN RESET ALL EXCEPT OP   @OY14092 59500091
*                                       CONTROL BITS           @OY14092 59550091
*                                         PRE ENT WAIT STATE IF         59600020
*                                         CLOSE DOWN IN PROGRESS        59650020
         OI    LCBSTAT1,LCBRECVN        SET LCBSTATE                    59700020
         L     RWORK,DCBDEBAD           GET DEB ADDRESS                 61400020
         USING DEBNMSUB,RWORK                                           61600020
         TM    DEBOPATB,OUTPUT          OPENED FOR OUPUT ONLY           61800020
         BNO   TRYRCVT                  NO, POST ERB TO RECEIVE         62000020
         DROP  RWORK                                                    62200020
         CLI   LCBCPA,CCWDISAB          DID WE ALREADY DISCONNECT       62400020
         BE    SETFREE                  BRANCH YES, SET LINE FREE       62600020
         CLI   LCBCPA+8,CCWDISAB        DID WE ALREADY DISC.   @OX17150 62650000
         BE    SETFREE                  BRIF YES. SET LINE FREE@OX17150 62700000
         SPACE                                                          62800020
         TM    LCBSTAT2,LCBSYNC         BSC                             63000020
         BZ    DISAB                    BRANCH NO                       63200020
         TM    LCBSTAT2,LCBNEGRP        NEGATIVE RESPONSE SET           63400020
         BO    DISAB                    YES                             63600020
         OI    LCBSTAT2,LCBNEGRP        INDICATE NEGATIVE RESPONSE      63800020
         LR    R1,RLCB                  POST PARAMETER                  64000020
         B     DSPPOST                  POST LCB                        64200020
DISAB    EQU   *                                                        64400020
         LA    RB,LCBCPA+8              GET START CCW              @21C 64409027
         L     RWORK,LCBSCBA-1          GET THE SCB ADDRESS    @OX17150 64418000
         USING IEDQSCB,RWORK                                   @OX17150 64427000
         TM    SCBBSCFM,SCBNOEOT        EOT SENT               @OX17150 64436000
         BZ    DISAB1                   BR IF YES                  @01C 64445000
         DROP  RWORK                                           @OX17150 64454000
         L     RWORK,DCBSCTAD-1         GET SCT ADDRESS        @OX17150 64463000
         SR    RA,RA                    CLEAR FOR INSERT       @OX17150 64472000
         IC    RA,0(RWORK)              INDEX INTO SEQUENCE    @OX17150 64481000
         LA    RWORK,0(RA,RWORK)        POINT TO COUNT         @OX17150 64490000
         IC    RA,0(RWORK)              GET SEQUENCE COUNT     @OX17150 64499000
         LA    RWORK,1(RWORK)           POINT TO EOT CHARS     @OX17150 64508000
         ST    RWORK,LCBCPA             SET CCW ADDRESS        @OX17150 64517000
         ST    RA,LCBCPA+4              SET CCW COUNT          @OX17150 64526000
         MVI   LCBCPA,CCWWRITE          SET COMMAND CODE       @OX17150 64535000
         MVI   LCBCPA+4,CCWCC+CCWSLI    SET FLAGS              @OX17150 64544000
DISABLE  EQU   *                                               @OZ35319 64553000
         MVI   LCBTPCD,TPOPEN           SET TP OPCODE              @01C 64562000
DISAB1   EQU   *                                               @OZ35319 64571012
         ST    RB,LCBSTART-1            SET START                  @21C 64580027
         ST    RLCB,LCBQCBA-1           SET FOR RETURN FROM LINE END    64600020
         XC    LCBTTCIN,LCBTTCIN        CLEAR CURRENTLY CONNECTID       64800020
         LA    RLCB+1,1                 FLAGS AND COUNT                 65000020
         STM   RLCB,RA,LCBCPA+8         SET IN CCW             @OX17150 65200000
         MVI   LCBCPA+8,CCWDISAB        SET COMMAND CODE       @OX17150 65240000
         MVI   LCBCPA+12,CCWCC+CCWSLI   SET FLAGS              @OX17150 65280000
         MVI   LCBTPCD+1,TPOPEN         SET TP CODE            @OX17150 65320000
         MVI   LCBTPCD,TPOPEN           SET TP CODE                @21A 65360027
         MVI   LCBCPA,CCWDISAB          SET COMMAND CODE                65400020
         STM   RLCB,RA,LCBCPA+16        NO-OP CCW              @OX17150 65450000
         MVI   LCBCPA+16,CCWNOP         SET NO-OP CC           @OX17150 65500000
         MVI   LCBINCAM,AVTEZERO        ZERO RETRY COUNT       @OY21190 65520000
         MVI   LCBTPCD+2,TPOPEN         SET TP CODE            @OX17150 65550000
         LA    R1,LCBFLAG1              SET FOR IOS                     66200020
         EXCPVR (R1),SUBSYS                                      X01004 66400005
         B     DSPDISP                  EXIT TO DISPATCHER              66600020
SETFREE  EQU   *                                                        66800020
         MVI   LCBTSTSW,0               NO CONNECTION                   67000020
         MVI   LCBSTAT1,LCBFREEN        SET LINE 'FREE'                 67200020
         B     DSPDISP                  EXIT                            67400020
TRYRCVT  EQU   *                                                        67600020
         TM    AVTBIT3,AVTRECVN+AVTRFULN IS RECEIVE OPERATION           67800020
*                                         POSSIBLE                      68000020
         BZ    GOTUNIT                  BRANCH IF YES                   68200020
         SPACE                                                          68400020
         L     RWORK,LCBSTCBA-1         GET TOP STCB                    68800020
         CLI   AVTEZERO(RWORK),DSPDIASC RECEVIE SCHEDULAER AT TOP       69100020
         BE    DELAYIT                  BRANCH YES TO PLACE ON TIME Q   69400020
         OI    LCBSTAT2,LCBNEGRP        SET NEGATIVE RESPONSE-TO PRE    69440020
*                                         VENT LOOPNBETWEEN SCHEDULERS  69480020
*                                         FOR DIAL UP AND NO MSGS       69520020
*                                         ON DEST. QUEUE                69560020
         SPACE                                                          69600020
POSTFRE  EQU   *                                                        69800020
         ST    RLCB,LCBQCBA-1           POST LCB TO ITSELF FOR SEND     70000020
POSTIT   EQU   *                                                        70200020
         LR    R1,RLCB                  ELEMENT FOR POST                70600020
         B     DSPPOST                  POST LCB TO ITSELF              70800020
DELAYIT  EQU   *                                                        71000020
         LA    R0,1                     SET FOR 1 SECOND DELAY          71200020
         STH   R0,LCBEOLTD              SET PARAMETER                   71400020
         MVI   LCBTDL,LCBINSRC-1-IEDQLCB  SET INDEX FOR TIME DELAY      71600020
         MVC   LCBSTCBA,LCBRSLNK        REMOVE RCV SCHED AND MOVE IN    71800020
*                                         QEVENT IN ITS PLACE           72000020
         LA    R0,AVTDELYB              TIME DELAY QUEUE                72200020
         ST    R0,LCBQCBA-1             SET IN LCB                      72400020
         B     POSTIT                   COMMON EXIT                     72600020
GOTUNIT  EQU   *                                                        72800020
         LA    RA,AVTBFREB              BUFFER REQUEST QUEUE            73000020
         ST    RA,LCBERB                POST ERB                        73200020
         MVI   LCBERBPY,PRIINTRQ        INITIAL REQUEST                 73400020
         SR    RWORK,RWORK              CLEAR WOF REGISTER              73600020
         STH   RWORK,LCBRECOF           RESET OFFSET INTO RECORD        73800020
         STCM  RWORK,AD,LCBRECAD        RESET FIRST EOB RECORD   Y05330 74000005
         IC    RWORK,DCBBUFIN           NO. OF INITIAL BUFFERS          74200020
         SRL   RWORK,4                  SHIFT TO LOW ORDER BITS         74400020
         STC   RWORK,LCBERBCT           SET COUNT                       74600020
         LA    R1,LCBERB                POST ERB FOR BUFFERS            74800020
         B     DSPPOST                  GO POST ERB FOR BUFFERS         75000020
         SPACE 3                                                 Y05330 75020005
TNTSUB   DS    0H                                                Y05330 75040005
         L     R15,AVTRNMPT             ADDRESS OF TERM NAME     Y05330 75060005
         LH    R1,LCBTTCIN              DESTINATION KEY          Y05330 75080005
         N     R1,AVTCLRHI              CLEAR HIGH ORDER HALF    Y05330 75100005
         BZR   R14                      RETURN IF ZERO           Y05330 75120005
         LA    R14,FOUR(,R14)           BUMP RETURN ADDRESS      Y05330 75140005
         BR    R15                      LINK TO IEDQTNT          Y05330 75160005
         SPACE 3                                                 Y05330 75180005
DOCQ     DC    AL2(LCBFLAG1-IEDQLCB+8)  OFFSET TO OBTAIN CALL Q         75200020
RLNCLI   CLI   LCBUCBX,AVTEZERO                                         75400020
         EJECT                                                          75600020
TWELVHRS DC    F'43200'                 12 HOURS                        75800020
TW24HRS  DC    F'86400'                 NUMBER SECONDS PER DAY          76000020
QCBBKUP  DC    AL2(QCBSTVTO-IEDQQCB)    OFFSET FROM STCB TO QCB  S22025 76200022
THREE    EQU   3                                                        76400020
TIMEQ    EQU   X'02'                   FLAG FOR ELEMENT ON TIME Q       76600020
CALLPRI  EQU   X'50'                    SEND PRI WITH CALL=NONE         76800020
CLOCK    EQU   X'80'                    SEND SCH PRI FOR CLOCK          77000020
CALLOPT  EQU   X'70'                    MASK FOR STCB PRIORITY @OY12954 77060091
*                                       CLOCK OR INTVL         @OY12954 77120091
F0       EQU   X'F0'                    MASK FOR NO DAIL UP             77200020
OUTPUT   EQU   X'03'                    DEB MASK FOR OUTPUT ONLY        77400020
MASTER   EQU   X'20'                    MASTER/SLAVE STATUS    @OY13276 77600091
HALF     EQU   32                                                       77800020
HUND     DC    F'100'                   USED TO CONVERT TIME TO  S22025 77880022
CLRMASK  DS    0F                       SECONDS                  S22025 77960022
         DC    X'7FFFFFFF'              MASK TO MAKE POSITIVE    S22025 78040022
THIRTY1  EQU   31                                                S22025 78130022
TWEN6    EQU   26                                                S22025 78140022
FIVE     EQU   5                                                 S22025 78150022
ONE      EQU   1                                                 S22025 78160022
HONE     DC    H'1'                     TO CHECK RETRY COUNT     S22025 78180022
AD       EQU   7                        MASK FOR ADDRESS ICM     Y05330 78186005
FOUR     EQU   4                        CONSTANT OF FOUR         Y05330 78192005
         EJECT                                                          78200020
         TTNTD                                                          78400020
         EJECT                                                          78600020
         TTPD                                                           78800020
         TPRIOR                                                         79000020
         EJECT                                                          79200020
         TAVTD                                                          79400020
         EJECT                                                          79600020
         TDISPD                                                         79800020
         EJECT                                                          80000020
         TLCBD                                                          80200020
         EJECT                                                          80400020
         TQCBD                                                          80600020
         EJECT                                                          80800005
         TSTCBD                                                         81000020
         TTRMD                                                          81200020
         TTSID                                                      TSO 81400020
         TSCBD                                                          81600020
         DCBD  DSORG=TX                                                 81800020
         TCCWD                                                          82000020
         TDEBD                                                          82200020
         END                                                            82400020
