RF       TITLE '''IGG019RF'' - EXCP DRIVER, SINGLE CPB'                 00200020
IGG019RF CSECT                                                          00400020
         SPACE 3                                                        00410054
*  CHANGE ACTIVITY AS FOLLOWS                                 SUPT CODE 00420054
*A156000,196600,218000,372000                                    S21101 00450020
*C194000,199600,280000,310000-326000,626000,666000,922000-924000 S21101 00500020
*D212000-216000                                                  S21101 00550020
*C114000                                                       @XA11330 00550110
*C242000,288000,814000,852000                                    S21903 00560022
*D890000                                                         S21903 00570022
*A196750                                                         X01004 00570104
*C020000,080000,086000-088000,134000,218000-219200,236000-240000,X01004 00570204
*C315400-315600,336000-338000,344000,634000-638000,774000,778000 X01004 00570304
*D373000,624000                                                  X01004 00570404
*C873200,873600,875000                                          OX02204 00570554
         SPACE 3                                                        00600054
*********************************************************************** 00660054
*                                                                     * 00720054
*TITLE 'IGG019RF' - EXCP DRIVER, SINGLE CPB                           * 00800020
*                                                                     * 01000020
*  MODULE NAME= IGG019RF                                              * 01200054
*                                                                     * 01220054
*  DESCRIPTIVE NAME = EXCP DRIVER , SINGLE CPB                        * 01240054
*                                                                     * 01260054
*  COPYRIGHT = 'NONE'                                                 * 01280054
*                                                                     * 01300054
*  STATUS = CHANGE LEVEL 5                                            * 01320054
*                                                                     * 01400020
*FUNCTION -- THIS MODULE TAKES THE CPB BEGUN BY IEDQFA, FINISHES      * 01600020
*   BUILDING THE CCWS, ADD SEARCH-TIC CCWS, TRANSLATES ABSOLUTE       * 01800020
*   DISK ADDRESS TO MBBCCHHR, CALLS IOS TO DO EXCPVR, AND RETURNS TO  * 02000004
*   THE DISPATCHER, ENDING DISK I/O SUBTASK.                          * 02200020
*                                                                     * 02400020
*                                                                99226  02420022
*   A ROUTINE ALSO RESIDES HERE WHICH WRITES A MESSAGE TO THE    99226  02440022
*   OPERATOR IN THE EVENT OF DISK ERROR                          99226  02460022
*   A DISK WRITE ERROR REQUESTS A QUICK CLOSEDOWN                99226  02480022
*   A DISK READ ERROR ISSUES AN ABEND                            99226  02500022
*                                                                99226  02520022
*ENTRY POINTS -- ONLY ONE ENTRY POINT, CALLED BY IEDQFA               * 02600020
*        'IGG019RF' - START DISK I/O FOR ONE CPB                      * 02800020
*   CALLING SEQUENCE -                                                * 03000020
*        L     15,AVTFL GET ADDR OF ENTRY OF IGG019RF                 * 03200020
*        BR    15                                                     * 03400020
*                                                                     * 03600020
*INPUT -- THERE ARE 3 TYPES OF INPUT, REGISTERS, AVT CONSTANTS, AND   * 03800020
*   THE CPB PREPARED BY IEDQFA.                                       * 04000020
*   REGISTER INPUT --                                                 * 04200020
*   R15 HAS ADDR OF ENTRY POINT                                       * 04400020
*   R13 HAS ADDR OF AVTSAVE2                                          * 04600020
*                                                                     * 04800020
*   AVT CONSTANTS --                                                  * 05000020
*   AVTINCPQ HAS ADDR OF CPB.                                         * 05200020
*   AVTIOBR HAS ADDR OF REUSABLE DISK IOB.                            * 05400020
*   AVTIOBN HAS ADDR OF NON-REUSABLE DISK IOB.                        * 05600020
*   AVTDSKCT HAS NUMBER OF WRITING CPBS.                              * 05800020
*                                                                     * 06000020
*   CPB FIELDS EXPECTED TO BE DONE --                                 * 06200020
*   CPBRDWR HAS READ OR WRITE CCW OP CODE.                            * 06400020
*   CPBXDWR HAS A NO-OP, OR READ, OR WRITE OP CODE.                   * 06700020
*   CPBXREA HAS ADDR OF UNIT.                                         * 07000020
*   CPBNEXT IS ASSUMED ZERO.                                          * 07200020
*   CPBFLAG INDICATES REUSABLE OR NON-REUSABLE DISK MSG QUEUE.        * 07400020
*   CPBADDR HAS ABSOLUTE DISK ADDRESS.                                * 07600020
*                                                                     * 07800020
*OUTPUT -- EXCPVR IS STARTED ON THE COMPLETED CPB.                    * 08000004
*   AVTDSKCT IS BUMPED BY 1 IF CPB WAS A 'WRITE'.                     * 08200020
*                                                                     * 08400020
*EXTERNAL ROUTINES -- EXCPVR MACRO GENERATES CALL TO                  * 08600004
*        'SVC 114' - START DISK I/O                                   * 08800004
*                                                                     * 09000020
*EXITS-NORMAL -- EXITS TO DISPATCHER.                                 * 09200020
*                                                                     * 09400020
*EXITS-ERROR -- N/A                                                   * 09600020
*                                                                     * 09800020
*TABLES/WORKAREAS -- THESE MACROS GENERATE DSECTS -                   * 10000020
*   TIOBD                                                             * 10200020
*   TDEBD                                                             * 10400020
*   TCPBD                                                             * 10600020
*   TAVTD                                                             * 10800020
*   TDISPD                                                            * 11000020
*                                                                     * 11200020
*ATTRIBUTES -- RESIDENT, REUSABLE, PROBLEM PROGRAM            @XA11330* 11400010
*   MODE, LOADED BY DISK MSG Q OPEN IF ON INTRO CPB=1.                * 11600020
*                                                                     * 11800020
*NOTES -- THE OPERATION OF THIS SUBROUTINE DEPENDS UPON AN INTERNAL   * 12000020
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  * 12200020
*   TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED   * 12400020
*   SO THAT REDIFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY,     * 12600020
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITION.           * 12800020
*                                                                     * 13000020
*   THERE ARE THREE MAJOR STEPS - BUILD CCWS, CONVERT ABSOLUTE ADDR   * 13200020
*   TO MBBCCHHR, AND ISSUE EXCPVR.                                    * 13400004
*                                                                     * 13600020
R15      EQU   15                       ENTRY ADDR                      13800020
R14      EQU   14                                                       14000020
RIOBINDX EQU   14                       SIZE OF AN IOB                  14200020
R13      EQU   13                       SAVE2                           14400020
RAVT     EQU   13                       AVT DSECT BASE                  14600020
R12      EQU   12                                                       14800020
RBASE    EQU   12                       PROGRAM BASE                    15000020
R11      EQU   11                       DISPATCHER ADDRESS       99226  15200022
RIOB     EQU   11                       IOB DSECT BASE                  15400020
R10      EQU   10                                                       15600020
RDUMCPB  EQU   10                       PSEUDO CPB BASE          S21101 15700021
R9       EQU   9                                                        15800020
R8       EQU   8                                                        16000020
R7       EQU   7                                                        16200020
RCPB     EQU   7                        CPB DSECT BASE                  16400020
R6       EQU   6                                                        16600020
RPREFIX  EQU   6                        PREFIX DSECT BASE        99226  16700022
RDEB     EQU   5                        DEB DSECT BASE                  16800020
R5       EQU   5                        WORK REGISTER            99226  16900022
R4       EQU   4                                                        17000020
R3       EQU   3                                                        17200020
R2       EQU   2                                                        17400020
R1       EQU   1                        PARAMETER PASSER                17600020
R0       EQU   0                                                        17800020
*                                                                       18000020
         USING IEDQCPB,RCPB                                             18200020
         USING IEDQAVTD,RAVT                                            18400020
         USING IEDQIOB,RIOB                                             18600020
         USING IEDQPRF,RPREFIX          PREFIX DSECT             99226  18700022
         USING IEDQDEB,RDEB                                             18800020
         USING *,R15                                                    19000020
*                                                                       19200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19220020
*                                                                       19240020
*                       LOCAL EQUATES                                   19260020
*                                                                       19280020
HISREG14 EQU   12                       OFFSET INTO SAVEAREA OF R14     19300020
HISREG15 EQU   16                       OFFSET INTO SAVEAREA OF R15     19320020
SAVECCW  EQU   12                       OFFSET INTO SAVE2 WHERE 3       19340020
*                                         CCWS ARE SAVED                19360020
THREECCW EQU   20                       LENGTH OF CCWS SAVED IN SAVE2   19380020
RPS      EQU   X'10'                    RPS DEVICE IN UCBTBYT2   S21101 19400021
FULLSHIF EQU   32                       DOUBLE REG SHIFT ENTIRE REG     19420020
BYTESHIF EQU   8                        SHIFT COUNT FOR 1 BYTE          19440020
THRESHFF EQU   X'FF'                    VALUE IN AVTHRESS - MEANS       19460020
*                                         ELE NOT YET ACTIVATED         19480020
THRESHF7 EQU   X'F7'                    VALUE IN AVTHRESS - MEANS       19500020
*                                         ELE IS REQUESTED TO BE        19520020
*                                         POSTED UPON EXIT FROM '-RF'   19540020
THRESHF0 EQU   X'F0'                    VALUE IN AVTHRESS - MEANS       19560020
*                                         ELE HAS BEEN POSTED TO READY  19580020
ABEND1   EQU   1                        ABEND SUBCODE, OUT OF           19600020
*                                         SPACE, NON-REUS DISK          19620020
ABEND5   EQU   5                        ABEND SUBCODE, DISK DCB         19640020
*                                         NOT OPEN                      19660020
ROUNDER  EQU   3                        VALUE FOR RRN ADJUSTMENT S21101 19665020
LORDER   EQU   3                        OFFSET VALUE             S21101 19670020
DIV4     EQU   2                        VALUE FOR RRN ADJUSTMENT S21101 19675020
SEVEN    EQU   7                        3-BYTE ICM/STCM MASK.    X01004 19676004
ALL      EQU   15                       4-BYTE ICM/STCM MASK.    X01004 19677004
ONE      EQU   1                                                 X01004 19678004
TWO      EQU   2                        1-BYTE ICM MASK          X01004 19679004
*                                                                       19680020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19700020
*                                                                       19720020
*                       ENTRY - EXCP DRIVER                             19740020
*                          FOR ONE CPB                                  19760020
*                                                                       19780020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19800020
*                                                                       19820020
         BAL   RBASE,TAG                SKIP CONSTANTS AND              19840020
*                                         SET PROGRAM BASE              19860020
         DROP  R15                      FORGET TEMPORARY                19880020
         USING *,RBASE                  ESTABLISH ADDRESSABILITY        19900020
*                                                                       19920020
*                                                                99226  19924022
* THIS CONSTANT ALLOWS ANOTHER ROUTINE ACCESS TO THE DISK ERP WTO99226  19928022
*                                                                99226  19932022
         DC    A(WTORTN)                WTO ROUTINE FOR DISK ERP 99226  19936022
IGG019RF IEDHJN ,                                                S22025 19940022
*                                                                       19980020
TAG      DS    0H                                                       20200020
         SR    RCPB,RCPB                CLEAR FOR ICM.           X01004 21800004
         ICM   RCPB,SEVEN,AVTINCPQ+ONE  FIRST CPB ON INPUT QUEUE X01004 21840004
         BZ    EXIT                     EXIT IF THE INPUT QUEUE  X01004 21880004
*                                         IS EMPTY.              X01004 21920004
*                                         NO, GOT CPB            S21101 21960021
         MVI   CPBXWFL,AVTEZERO         CLEAR FLAG BYTE 2ND CCW         22000020
         CLI   CPBXDWR,CPBNOPC          IS SECOND CCW A NO-OP           22200020
         BE    NOPCODE                    YES, IT IS A NO-OP            22400020
*                                         NO, READ/WRITE                22600020
         MVI   CPBRWFL,CPBCDC+CPBSLIC   SET 'DATA CHAIN' AND 'SLI'      22800020
         MVC   CPBCOUNT(2),AVTKEYLE     SET KEYLENGTH                   23000020
         L     R15,CPBXREAF             GET UNIT ADDRESS                23200020
         LA    R15,AVTUMALN(,R15)       BUMP TO KEY PART OF BUFFER      23400020
         STCM  R15,SEVEN,CPBAREA        SET KEY BUFFER ADDRESS.  X01004 23600004
         B     DISKCPB                  BR AROUND NO-OP CODE     S21903 24200022
*                                                                       24400020
NOPCODE  EQU   *                                                        24600020
         MVI   CPBRWFL,AVTEZERO         CLEAR CCWFLAG BYTE 1ST CCW      24800020
         LA    R15,AVTDATLN             GET DATA RECORD SIZE            25000020
         STH   R15,CPBCOUNT               TO 1ST CCW                    25200020
         MVC   CPBAREA,CPBXREA          DATA FROM UNIT                  25400020
*                                                                       25600020
DISKCPB  EQU   *                                                        25800020
         LA    R15,IEDQFP               GET ADDR OF CONVERT ROUTINE     26000020
         BALR  R14,R15                  CHANGE ABSOLUTE RECORD NO.      26200020
*                                         TO MBBCCHHR                   26400020
         TM    CPBRDWR,CPBWRITB         'WRITE'                         26600020
         BO    SKIPBUMP                   YES, SKIP COUNTER             26800020
*                                         NO, COUNT 'READS'             27000020
         LH    R1,AVTDSKCT              GET PREVIOUS COUNT              27200020
         LA    R1,1(,R1)                BUMP IT BY 1                    27400020
         STH   R1,AVTDSKCT              RESTORE NEW COUNT               27600020
SKIPBUMP EQU   *                                                        27800020
         TM    CPBADDR+LORDER,CPBQTYPE  REUS DISK                S21101 28000020
         BO    LEUSDISK                   YES, REUS                     28200020
*                                         NO, NON-REUS                  28400020
         L     RIOB,AVTIOBN             GET NON-REUS FIRST IOB          28600020
         B     SKIP                     BR AROUND REUS CODE      S21903 28800022
*                                                                       29000020
LEUSDISK EQU   *                                                        29200020
         L     RIOB,AVTIOBR             GET REUS FIRST IOB              29400020
SKIP     EQU   *                                                        29600020
         SR    R15,R15                  CLEAR WORK REG                  29800020
         IC    R15,CPBABSAD             GET M OF MBBCCHHR               30000020
         LA    RIOBINDX,IOBEND-IEDQIOB  SIZE OF IOB                     30200020
         MR    R15-1,RIOBINDX           SIZE IOBS TO BE SKIPPED         30400020
         AR    RIOB,R15                 GO TO PROPER IOB                30600020
         MVC   SAVECCW(THREECCW,R13),CPBRDWR SAVE RD/WR CCWS            30800020
         LR    RDUMCPB,RCPB             SET PSEUDO CPB BASE      S21101 30820021
         SH    RDUMCPB,HALF8            ADJUST FOR MISSING       S21101 30840021
*                                         SEEK CCW               S21101 30860021
         L     R2,IOBDCBPT-1            GET DCB                  S21101 30880021
         L     R2,DCBDEBAD-IHADCB(,R2)  GET DEB                  S21101 30900021
         L     R2,DEBUCBAD-IEDQDEB-(DEBNMSUB-IEDQDEB)(,R2)       S21101 30920021
*                                         GET UCB                S21101 30940021
         TM    UCBTBYT2-UCB(R2),RPS     IS RPS SUPPORTED         S21101 30960021
         BO    BUILDRPS                   YES, GO BUILD SET      S21101 30980021
*                                         SECTOR CCW             S21101 31000021
*                                         NO, SKIP SET SECTOR    S21101 31020021
         SH    RDUMCPB,HALF8            ADJUST PSEUDO CPB BASE FOS21101 31040021
*                                         MISSING SET SECTOR CCW S21101 31060021
         B     SKIPRPS                  SKIP SET SECTOR CCW      S21101 31080021
*                                                                S21101 31100021
BUILDRPS EQU   *                        BUILD SET SECTOR CCW     S21101 31120021
* SET UP PARAMETERS TO CALL SECTOR CONVERT ROUTINE               S21101 31140021
* R0 HAS DDKR                                                    S21101 31160021
*        DD -  PHYSICAL BLOCK SIZE                               S21101 31180021
*        K  -  KEYLENGTH                                         S21101 31200021
*        R  -  RECORD NUMBER                                     S21101 31220021
* R2 HAS DAAA                                                    S21101 31240021
*        D  -  UCB DEVICE TYPE CODE FROM UCB+19                  S21101 31260021
*        AAA-  POINTER TO ONE BYTE AREA TO RECEIVE SECTOR VALUE  S21101 31280021
* R14 HAS RETURN ADDRESS                                         S21101 31300021
* R15 HAS ENTRY ADDRESS (FROM CVT+232)                           S21101 31320021
*                                                                S21101 31340021
* R2 HOW HAS ADDRESS OF UCB                                      S21101 31360021
*                                                                S21101 31380021
         IC    R2,UCBTBYT4-UCB(R2)      DEVICE TYPE CODE         S21101 31400021
         LA    R3,CPBSECTR-IEDQCPB(,RDUMCPB) SECTOR VALUE ADDRESSS21101 31420021
         ST    R3,CPBSETAF-IEDQCPB(,RDUMCPB) POINT CCW TO        S21101 31440021
*                                         SECTOR VALUE           S21101 31460021
         SLL   R3,BYTESHIF              ADDRESS TO TOP 3 BYTES   S21101 31480021
         SLDL  R2,FULLSHIF-BYTESHIF     R2 NOW HAS DAAA          S21101 31500021
*                                                                S21101 31520021
         L     R0,ZEROPARM              R0 NOW HAS DDKX          S21101 31560021
         ICM   R0,TWO,AVTKEYLE+ONE      GET K OF DDKR            X01004 31570004
         IC    R0,CPBABSAD+7            R0 NOW HAS DDKR          S21101 31580021
*                                                                S21101 31600021
         L     R15,CVTPTR               GET CVT                  S21101 31620021
         USING CVT,R15                                           S21101 31640021
         L     R15,CVT0SCR1             GET ENTRY TO SECTOR      S21101 31660021
*                                         CONVERSION ROUTINE     S21101 31680021
         STM   R0,R12,AVTSAVE4          SAVE REGS CLOBBERED      S21101 31700021
*                                         BY CONVERT ROUTINE     S21121 31720021
         BALR  R14,R15                  CALCULATE SECTOR VALUE   S21101 31740021
*                                       BUILD SET SECTOR CCW     S21101 31760021
         DROP  R15                                               S21101 31780021
         LM    R0,R12,AVTSAVE4          RESTORE REGS             S21101 31800021
         MVI   CPBSET-IEDQCPB(RDUMCPB),CPBSETC SET SECTOR OP CODES21101 31820021
         LA    R15,CPBSET1              GET COUNT OF 1           S21101 31840021
         ST    R15,CPBSETCT-2-IEDQCPB(RDUMCPB) CCW AND CLEAR     S21101 31860021
*                                         UNUSED BYTE            S21101 31880021
         MVI   CPBSETFL-IEDQCPB(RDUMCPB),CPBCCC COMMAND CHAIN    S21101 31900021
SKIPRPS  EQU   *                                                 S21101 31920021
         LA    R15,CPBABSAD+3           ADDR OF CCHHR            S21101 31940021
         ST    R15,CPBSRECF-IEDQCPB(,RDUMCPB) STORE ADDR OF CCHHRS21101 31960021
         MVI   CPBSRCH-IEDQCPB(RDUMCPB),CPBSRCHC SEARCH ID EQ    S21101 31980021
*                                         OP CODE                S21101 32000021
         MVI   CPBSRHFL-IEDQCPB(RDUMCPB),CPBCCC COMMAND CHAIN    S21101 32020021
         LA    R15,CPBSRH5              GET LENGTH OF 5          S21101 32040021
         STH   R15,CPBSRHCT-IEDQCPB(RDUMCPB) TO SEARCH CCW       S21101 32060021
         LA    R15,CPBSRCH-IEDQCPB(,RDUMCPB) GET SEARCH CCW ADDR S21101 32070021
         ST    R15,CPBTICSF-IEDQCPB(,RDUMCPB) TIC BACK TO SEARCH S21101 32080021
         MVI   CPBTIC1-IEDQCPB(RDUMCPB),CPBTICC TIC OP CODE      S21101 32100021
         MVC   CPBRDWR-IEDQCPB(THREECCW,RDUMCPB),SAVECCW(R13)    S21101 32120021
*                                         GET RD/WR CCWS         S21101 32140021
         NC    CPBADDR+1(3),CPBADDR+1   IS ADDRESS ZERO                 32800020
         BNZ   OK                         NO, GO DO I/O                 32830020
*                                       YES, ERROR               S22025 32860022
* THIS SHOULD NEVER OCCUR.  BUT, JUST IN CASE, BETTER KILL IT NOW       32890020
* BEFORE ALL TRACE OF WHY THE FALSE REQUEST WAS MADE IS LOST.           32920020
*                                                                       32950020
         DC    H'0'                     CPB REQUESTS DISK REC ZERO      32980020
*                                                                       33010020
* THIS IS AN INTENTIONAL PROGRAM CHECK TO TRAP A TYPE OF INTERNAL       33040020
* TCAM LOGICAL BUG THAT CAUSES RECORD ZERO TO INCORRECTLY BE REFERENCED 33070020
* IN THE CPB.  THERE IS NO SUCH RECORD.                                 33100020
* THE FIX LIES NOT IN IGG019RF BUT IN WHOEVER BUILT THE CPB AND GAVE    33130020
* IT TO IGG019RF FOR ITS INPUT QUEUE.  RCPB POINTS TO CPB.              33160020
* CPBFLAG X'80' BIT ON SAYS CPB BUILT BY IGG019RP, REUS/COPY.           33190020
* IF THAT NOT ON, CHECK 'READY HAD BEEN EXECUTED' BIT IN AVT.           33220020
* IF ON, PROBABLY BUILT BY IEDQFA.  IF NOT ON, WARMSTART BUILT CPB.     33250020
*                                                                       33310020
OK       DS    0H                       NON-ZERO CPBADDR                33340020
         MVC   IOBSEEK,CPBABSAD         SET MBBCCHHR TO IOB             33400020
         MVC   IOBSTART,AVTINCPQ+ONE    POINT IOB TO CPB.        X01004 33600004
         XC    AVTINCPQ+ONE(ROUNDER),AVTINCPQ+ONE  CLEAR INPUT Q X01004 33800004
         XC    IOBXECB,IOBXECB          CLEAR ECB                       34000020
         LR    R1,RIOB                  PASS IOB ADDR                   34200020
         EXCPVR (1),SUBSYS              DO DISK I/O.             X01004 34400004
*                                                                       34600020
EXIT     EQU   *                                                        34800020
         L     R11,AVTEA                                                35000020
         CLI   AVTHRESS,THRESHF7        DOES ELE NEED POSTING           35200020
         USING IEDQDISP,R11                                             35400020
         BNE   DSPDISP                    NO, DO NOT POST               35600020
*                                           EXIT TO DISPATCHER          35800020
*                                         YES, POST THRESH ELE          36000020
         LA    R1,AVTHRESE              PASS ADDR OF THRESH ELE         36600020
         MVI   AVTHRESS,THRESHF0        MARK ELEMENT 'POSTED'           36800020
         BAL   R14,DSPPOST              EXIT TO DISPATCHER     @Y17XAQX 37000010
*                                                                       37200020
*                        LOCAL CONSTANTS                         S21101 37220021
         DS    0F                       R0 PARAM TO SET SECTOR   S21101 37240021
*                                         ROUTINE                S21101 37260021
ZEROPARM DC    H'6'                     DATALENGTH OF DISK RECORDS21101 37280021
HALF8    DC    H'8'                     ADJUSTS FOR MISSING CCW  S21101 37320021
         EJECT ,                                                 99226  37320722
*                                                                99226  37321422
* THE WTORTN IS A WTO MESSAGE WRITTEN AT DISK ERP TIME.          99226  37322122
*   IT IS CALLED UPON TO SEND A MESSAGE TO THE OPERATOR BY       99226  37322822
*   IEDQFQ, IGG019Q8,IGG019R6                                    99226  37323522
*                                                                99226  37324222
* A CHECK IS ALSO MADE FOR THE TYPE OF DISK ERROR.               99226  37324922
*   IF IT IS A DISK WRITE ERROR, A QUICK CLOSEDOWN IS REQUESTED. 99226  37325622
*   IF IT IS A DISK READ ERROR, AN ABEND IS ISSUED.              99226  37326322
*                                                                99226  37327022
*   ENTRY HERE IS THROUGH A BRANCH TO THE ADDRESS IN THE         99226  37327722
*          SECOND WORD OF IGG019RF                               99226  37328422
*                                                                99226  37329122
*   INPUT--R13 HAS AVTSAVE2                                      99226  37329822
*          R7 HAS CPB BASE                                       99226  37330522
*          R14 HAS RETURN ADDRESS                                99226  37331222
*          R15 HAS ENTRY POINT                                   99226  37331922
*                                                                99226  37332622
*   OUTPUT-ALL REGISTERS ARE UNCHANGED                           99226  37333322
*                                                                99226  37334022
*   EXTERNAL ROUTINES--DSPPOSTR--PUTS CLOSEDOWN ELEMENT ON       99226  37334722
*          READY QUEUE IN CASE OF DISK WRITE ERRORS              99226  37335422
*                                                                99226  37336122
*   EXITS-NORMAL - N/A                                           99226  37336822
*                                                                99226  37337522
*   EXITS-ERROR                                                  99226  37338222
*          AVTABEND--TO ABEND S045 U008 DISK READ ERROR          99226  37338922
*                                                                99226  37339622
*          RETURN TO CALLING PROGRAM TO AWAIT CLOSEDOWN ON       99226  37340322
*          DISK WRITE ERRORS                                     99226  37341022
*                                                                99226  37341722
*                                                                99226  37342422
*                                                                99226  37343122
WTORTN   DS    0H                                                99226  37343822
         STM   R14,R12,12(R13)                                   99226  37344522
         BALR  RBASE,0                  ESTABLISH                99226  37345222
         USING *,RBASE                  ADDRESSABILITY           99226  37345922
         USING IEDQCPB,RCPB                                      99226  37346622
*        USING IEDQAVTD,RAVT                                     99226  37347322
*        USING IEDQPRF,RPREFIX                                   99226  37348022
         DROP  RIOB                                              99226  37348722
         USING IEDQDISP,R11                                      99226  37349422
         UNPK  MSGECBCC(3),CPBECBCC(2)  GET COMPLETION CODE      99226  37350122
         UNPK  MSGFLAG1(9),CPBFLAG1(5)  GET FLAG1-2,SENS0-1      99226  37350822
         UNPK  MSGCSW(9),CPBFLAG3(5)    GET FLAG3 AND HALF CSW   99226  37351522
         UNPK  MSGCSW+8(9),CPBCSW+3(5)  GET LAST HALF CSW        99226  37352222
         MVC   MSGUCBID(3),CPBUCBID     GET UCB IDENTIFICATION   99226  37352922
         UNPK  MSGADDR(7),CPBADDR+1(4)  GET DISK ADDRESS         99226  37353622
         TR    MSGECBCC(46),TRTABLE     MAKE IT PRINTABLE        99226  37354322
         MVC   MSGECBCC+2(2),COMBLNK    SEPARATE WITH FIELD      99226  37355022
         MVC   MSGFLAG1+8(2),COMBLNK      SEPARATORS, A COMMA    99226  37355722
         MVC   MSGCSW+16(2),COMBLNK       AND A BLANK            99226  37356422
         MVC   MSGUCBID+3(2),COMBLNK                             99226  37357122
         MVI   MSGADDR+6,AVTEPER        PUT PERIOD AT END        99226  37357822
         TM    CPBRDWR,CPBWRITB         IS CPB FOR WRITE         99226  37358522
         BZ    BADREAD                    NO, READ               99226  37359222
*                                         YES, WRITE             99226  37359922
         MVC   MSGRDWR(3),WR            SET TO WRITE             99226  37360622
*                                                                99226  37361322
* REQUEST A CLOSEDOWN IF NOT ALREADY REQUESTED                   99226  37362022
*                                                                99226  37362722
         CLI   AVTHRESS,THRESHFF        REQUEST FOR CLOSEDOWN YET99226  37363422
         BNE   DISKERR                    YES, CONTINUE          99226  37364122
*                                         NO,REQUEST IT          99226  37364822
         LA    R1,AVTHRESE              PASS ADDRESS OF CLOSEDOWN99226  37365522
*                                         ELEMENT TO DISPATCHER  99226  37366222
*                                         TO BE POSTED TO QUICK  99226  37366922
*                                         CLOSEDOWN              99226  37367622
         MVI   AVTHRESE+CLOSETYP,QUICK  SET CLOSE AS QUICK       99226  37368322
         MVI   AVTHRESS,THRESHF0        MARK ELEMENT POSTED      99226  37369022
         L     R11,AVTEA                GET DISPATCHER           99226  37369722
         LR    R5,R7                    SAVE CPB BASE            99226  37370422
         BAL   R14,DSPPOSTR             GO TO DISPATCHER         99226  37371122
*                                                                99226  37371822
         LR    R7,R5                    RESTORE CPB BASE         99226  37372522
         B     DISKERR                  GO TO WTO                99226  37373222
*                                                                99226  37373922
BADREAD  EQU   *                                                 99226  37374622
         MVC   MSGRDWR(3),RD            SET TO READ              99226  37375322
*                                                                99226  37376022
DISKERR  EQU   *                                                 99226  37376722
         CLI   CNT,MSGCNT               TEST COUNT EXCEEDED      99226  37377422
         BNL   RETURNX                    IF YES,SKIP WTO        99226  37378122
*                                         IF NO, WRITE MSG       99226  37378822
         SR    R3,R3                    INCREMENT WTO COUNT      99226  37379522
         IC    R3,CNT                                            99226  37380222
         LA    R3,1(,R3)                                         99226  37380922
         STC   R3,CNT                                            99226  37381622
         WTO   MF=(E,MSGNAME)           DISPLAY ERROR MESSAGE    99226  37382322
*                                                                99226  37383022
         CLI   CNT,MSGCNT               TEST LAST OF COUNT       99226  37383722
         BL    RETURNX                    IF NO, SKIP LAST MSG   99226  37384422
*                                         IF LAST, WRITE SUCH MSG99226  37385122
         WTO   MF=(E,MSGNAME2)          PRINT STOPPED MSG        99226  37385822
RETURNX  DS    0H                                                99226  37386522
         TM    CPBRDWR,CPBWRITB         IS CPB FOR WRITE         99226  37387222
         BNZ   RETURN                     YES, RETURN            99226  37387922
*                                         NO, ABEND              99226  37388622
         LA    R15,ABCODE               SET ABEND CODE           99226  37389322
         BAL   R14,AVTABEND             ABEND                    99226  37390022
*                                                                99226  37390722
RETURN   RETURN (14,12)                 RETURN TO CALLER         99226  37391422
*                                                                99226  37392122
CLOSETYP EQU   8                        CLOSEDOWN TYPE           99226  37392822
QUICK    EQU   X'30'                    QUICK CLOSE IN CLOSEDOWN 99226  37393522
CNT      DC    X'00'                    COUNTER FOR DISK WTOS    99226  37394222
MSGCNT   EQU   X'05'                    DISK WTO MAX             99226  37394922
ABCODE   EQU   X'08'                    DISK READ ERROR CODE     99226  37395622
RD       DC    CL3'RD '                 READ IDENTIFIER          99226  37396322
WR       DC    CL3'WR '                 WRITE IDENTIFIER         99226  37397022
EXCLVAL  EQU   X'01'                    REVERSE BIT              99226  37397722
COMBLNK  DC    CL2', '                  FIELD SEPARATOR          99226  37398422
*                                                                99226  37399122
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 37400020
*                                                                       37600020
IEDQFP   DS    0H                                                       38000020
*                                                                     * 38200020
*TITLE   'IEDQFP' - ABSOLUTE RECORD NUMBER TO MBBCCHHR CONVERTER      * 38400020
*                                                                     * 38600020
*STATUS - CHANGE LEVEL 0                                              * 38800020
*                                                                     * 39000020
*FUNCTION/OPERATION - THE PURPOSE OF THIS ROUTINE IS TO CONVERT       * 39200020
*   THE ABSOLUTE RECORD NUMBER INTO AN MBBCCHHR DISK ADDRESS FOR      * 39400020
*   A MULTIVOLUME TCAM DISK MESSAGE QUEUE.                       S22025 39600022
*                                                                     * 39800020
*   THE DISK MESSAGE QUEUE CONSISTS OF ONE OR MORE SIMILAR EXTENTS    * 40000020
*   OF ONE FIXED, UNBLOCKED DATA SET, ONE ON EACH OF ONE OR MORE      * 40200020
*   DISK DRIVES OF THE SAME TYPE.  EACH EXTENT MUST CONTAIN THE       * 40400020
*   SAME NUMBER OF CONTINUOUS CYLINDERS ON A CYLINDER BOUNDARY.       * 40600020
*                                                                     * 40800020
*   THE RECORDS ARE ASSIGNED TO THE DISKS IN THE FOLLOWING ORDER -    * 41000020
*   SEQUENTIALLY ON THE FIRST TRACK ON THE FIRST CYLINDER OF THE      * 41200020
*   FIRST EXTENT.  THEN SEQUENTIALY ON THE FIRST TRACK OF THE         * 41400020
*   FIRST CYLINDER ON THE SECOND EXTENT, AND SO ON UNTIL THE FIRST    * 41600020
*   TRACK OF ALL EXTENTS ARE ASSIGNED.  THEN CONTINUE BACK ON THE     * 41800020
*   FIRST EXTENT WITH THE SECOND TRACK OF THE FIRST CYLINDER. THEN    * 42000020
*   THE SAME FOR THE SECOND EXTENT, AND SO ON.  THIS PROCESS IS       * 42200020
*   REPEATED FOR THE REST OF THE FIRST CYLINDER OF ALL EXTENTS.       * 42400020
*   PROCEED TO THE SECOND CYLINDER, AND CONTINUE THRU THE DATA SET.   * 42600020
*   THIS ALGORITHM IS DESIGNED FOR USE WITH MULTIPLE ARM SUPPORT.     * 42800020
*                                                                     * 43000020
*ENTRY POINTS -                                                       * 43200020
*        'IEDQFP - CONVERT ABSOLUTE RECORD NUMBER TO MBBCCHHR         * 43400020
*   CALLING SEQUENCE IS                                               * 43600020
*        LA    R15,IEDQFP                                             * 43800020
*        BALR  R14,R15                                                * 44000020
*                                                                     * 44200020
*INPUT - RCPB HAS THE ADDR OF THE CPB WHICH CONTAINS IN THE CPBADDR   * 44400020
*   FIELD THE ABSOLUTE RECORD NUMBER TO BE CONVERTED.  REGISTER 13    * 44600020
*   POINTS TO AVTSAVE2. R15 HAS ENTRY ADDRESS.R14 HAS EXIT ADDRESS    * 44800020
*                                                                     * 45000020
*   THE AVT HAS TWO 6 WORD AREAS INITIALIZED TO HAVE THE FOLLOWING    * 45200020
*   FULLWORD VALUES.  A BIT IN CPBFLAG DETERMINES WHICH 6 WORD AREA   * 45400020
*   IS TO BE USED.  (ONE GROUP IS FOR REUSABLE DISK, THE OTHER FOR    * 45600020
*   NON-REUSABLE DISK QUEUES.)                                        * 45800020
*                                                                     * 46000020
*        AVTDQDEB DC F'0' ADDRESS OF DEB OF DISK QUEUE DCB            * 46200020
*        AVTNOVOL DC F'0' NUMBER OF EXTENTS                           * 46400020
*        AVTRCTRK DC F'0' NUMBER OF RECORDS PER TRACK                 * 46600020
*        AVTTRCYL DC F'0' NUMBER OF TRACKS PER CYLINDER               * 46800020
*        AVTTOTNO DC F'0' NUMBER OF RECORDS IN ENTIRE DATA SET        * 47000020
*        AVTVOLRT DC F'0' PRODUCT OF NO. OF VOLUMES * NO. RECORDS     * 47200020
*                          PER TRACK                                  * 47400020
*                                                                     * 47600020
*OUTPUT - ALL REGISTERS ARE UNCHANGED.  IN THE CPB, THE               * 47800020
*   CPBABSAD FIELD OF THE CPB NOW CONTAINS THE MBBCCHHR.  ALL OTHER   * 48000020
*   FIELDS, INCLUDING THE INPUT FIELD, CPBADDR, ARE UNCHANGED,        * 48200020
*   EXCEPT THE COMMAND CHAIN BIT IN SECOND READ/WRITE CCW IS          * 48400020
*   TURNED OFF.                                                       * 48600020
*                                                                     * 48800020
*EXTERNAL REFERENCES - THE ABSOLUTE CYLINDER ID COMES FROM DEB EXTENT * 49000020
*                                                                     * 49200020
*   THE DSECT OF THE AVT IS TO BE PROVIDED BY THE MACRO, 'AVT'.       * 49400020
*                                                                     * 49600020
*   THE ROUTINE MAKES NO CALL TO ANY EXTERNAL SUBROUTINE.  THUS IT    * 49800020
*   DOES NOT CHANGE THE VALUE IN R13, HAVING NO SAVEAREA OF ITS OWN.  * 50000020
*                                                                     * 50200020
*EXITS-NORMAL - ALL REGISTERS REMAIN UNCHANGED.  NO RETURN CODE.      * 50400020
*   CPBABSAD FIELD OF THE CPB NOW CONTAINS THE REQUIRED MBBCCHHR.     * 50600020
*   RETURN IS MADE TO THE ADDRESS IN R14                              * 50800020
*                                                                     * 51000020
*EXITS-ERROR  --  ABEND CODE S045 U001 - NON-REUS DISK WRAP           * 51200020
*   ABEND CODE S045 U005 - CPB REQUESTING I/O ON UNOPENED DATA SET    * 51400020
*                                                                     * 51600020
*TABLES/WORKAREAS - ALL LOCAL STORAGE IS IN REGISTERS. REFERENCE      * 51800020
*   IS MADE TO THE AREAS OF THE AVT DESCRIBED UNDER 'INPUT' ABOVE.    * 52000020
*   IN THE CPB, THE FIELD CPBTTR IS REFERENCED, AND THE FIELD         * 52200020
*   CPBABSAD MODIFIED.                                                * 52400020
*                                                                     * 52600020
*ATTRIBUTES - REUSABLE, REFRESHABLE                                   * 52800020
*                                                                     * 53000020
*NOTES - THE OPERATION OF THIS SUBROUTINE DOES NOT DEPEND UPON A      * 53200020
*   PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER      * 53400020
*   SET.                                                              * 53600020
*                                                                     * 53800020
*   A MESSAGE IS DISPLAYED WITH 'WTO',ROUTCDE=(2,11),DESC=6           * 54000020
*   'IED076I TCAM NON-REUSABLE DISK THRESHOLD CLOSEDOWN' - THE SYSTEM * 54200020
*   IS CLOSING DOWN DUE TO AN IMPENDING FULLNESS OF THE DISK.         * 54400020
*                                                                     * 54600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 54800020
*                                                                       55000020
*                        REGISTER USAGE DEFINITIONS                     55200020
*                                                                       55400020
*15      EQU   15                       PROGRAM BASE                    55600020
*14      EQU   14                       RETURN ADDRESS                  55800020
*13      EQU   13                       CALLER'S SAVEAREA               56000020
*12      EQU   12                                                       56200020
RVOLRT   EQU   12                       PRODUCT OF NO. OF VOLUMES       56400020
*                                         TIMES NO. RECORDS PER TRK     56600020
RTOTNO   EQU   11                       TOTAL NO. OF RECORDS IN         56800020
*                                         ENTIRE DATA SET               57000020
RTRCYL   EQU   10                       NO. TRACKS PER CYLINDER         57200020
RRCTRK   EQU   9                        NO. RECORDS PER TRACK           57400020
RNOVOL   EQU   8                        NO. OF EXTENTS                  57600020
RDEBX    EQU   7                        ADDR OF DEB OF DISK Q           57800020
*7       EQU   7                        7-12 LOADED FROM AVT            58000020
RCPBX    EQU   6                        BASE OF CPB DSECT               58200020
*5       EQU   5                        UNUSED IN CONVERT ROUTINE       58400020
*4       EQU   4                        UNUSED IN CONVERT ROUTINE       58600020
*3       EQU   3                        2-3 EVEN ODD PAIR FOR DIVISION  58800020
*2       EQU   2                        2-3 EVEN ODD PAIR FOR DIVISION  59000020
*1       EQU   1                        1-0 EVEN ODD PAIR FOR DIVISION  59200020
*0       EQU   0                        1-0 EVEN ODD PAIR FOR DIVISION  59400020
*                                                                       59600020
         DROP  RCPB                                                     59800020
         DROP  RDEB                                                     60000020
         USING *,R15                    PROGRAM BASE                    60200020
         USING IEDQCPB,RCPBX            BASE OF CPB DSECT               60400020
         USING IEDQDEBX,RDEBX           BASE OF DEB EXTENT DSECT        60600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60800020
*                                                                       61000020
*                        ENTRY POINT                                    61200020
*                                                                       61400020
         STM   R14,R12,HISREG14(R13)    SAVE REGISTERS                  61600020
         LA    RCPBX,0(,RCPB)           CLEAR HIGH BYTE AND             61800020
*                                         SET CPB DSECT BASE            62000020
         L     R1,CPBADDR               GET ABS. REC. NO. FROM CPB      62200020
         LA    R1,ROUNDER(R1)           ADJUST THE               S21101 62500020
         SRL   R1,DIV4                    RELATIVE RECORD NO.    S21101 62600020
         TM    CPBADDR+LORDER,CPBQTYPE  IS CPB FOR REUSABLE DISK S21101 62700020
         BO    PEUSDISK                   YES, REUSABLE DISK            62800020
*                                         NO, NON-REUSABLE              63000020
         LM    R7,R12,AVTADEBN          GET VALUES FROM AVT             63200020
         CLM   R1,ALL,AVTHRESN          DOES THIS RECORD EXCEED  X01004 63400004
*                                         THE THRESHOLD VALUE    X01004 63600004
         BH    EXCEED                     YES, THRESHOLD EXCEEDED       64000020
*                                         NO, WITHIN LIMITS OK          64200020
*                                                                       64400020
* ABSOLUTE RECORD NUMBER / TOTAL NO OF RECORDS GIVES                    64600020
* QUOTIENT - IGNORED                                                    64800020
* REMAINDER- RELATIVE RECORD NUMBER                                     65000020
CONTINUE EQU   *                                                        65200020
         LTR   RTOTNO,RTOTNO            HAS OPEN DONE THIS TYPE OF      65400020
*                                         DISK MSG Q                    65600020
         BZ    NOTOPEN                    NO, DATA SET NOT OPEN         65800020
*                                         YES, IT IS OPEN OK            66000020
         SR    R0,R0                    CLEAR EVEN REG FOR DIVISION     66200020
         DR    R1-1,RTOTNO                                              66400020
         TM    CPBADDR+LORDER,CPBQTYPE  IS CPB FOR REUSABLE DISK S21101 66600020
         BO    NOTWRAP                    YES, REUSABLE DISK            66800020
*                                         NO, NON-REUSABLE DISK         67000020
         LTR   R1,R1                    HAS ENTIRE DATA BEEN USED       67200020
         BZ    NOTWRAP                    NO, NOT WRAPPED               67400020
*                                         YES, NON-REUSABLE DISK        67600020
*                                           IS TRYING TO WRAP           67800020
         LA    R15,ABEND1               PASS SUBCODE IN R15             68000020
         BAL   R14,AVTABEND             ABEND, OUT OF SPACE NON REUS    68200020
*                                                                       68400020
NOTOPEN  EQU   *                                                        68600020
         LA    R15,ABEND5               PASS SUBCODE IN R15             68800020
         BAL   R14,AVTABEND             ABEND, DISK DCB NOT OPEN        69000020
*                                                                       69600020
NOTWRAP  EQU   *                                                        69800020
         SRDA  R0,FULLSHIF              MOVE REMAINDER TO ODD REG       70000020
*                                                                       70200020
* RELATIVE RECORD NUMBER / PRODUCT OF NO. VOLS AND NO. REC PER TRK      70400020
* QUOTIENT - RELATIVE TRACK                                             70600020
* REMAINDER - RELATIVE RECORD NO. ON THIS ROW OF TRACKS                 70800020
*                                                                       71000020
         DR    R1-1,RVOLRT                                              71200020
*                                                                       71400020
* R1 HAS RELATIVE TRACK, R0 HAS RELATIVE RECORD NO. ON THIS ROW         71600020
*                                                                       71800020
         LR    R3,R1                    GET RELATIVE TRACK              72000020
         SR    R2,R2                    CLEAR EVEN REG FOR DIVISION     72200020
*                                                                       72400020
* RELATIVE TRACK / NO. TRACKS PER CYL GIVES                             72600020
* QUOTIENT - RELATIVE CYLINDER NO.                                      72800020
* REMAINDER- RELATIVE TRACK NO.                                         73000020
*                                                                       73200020
         DR    R3-1,RTRCYL                                              73400020
*                                                                       73600020
* R3 HAS RELATIVE CYLINDER NO, R2 HAS RELATIVE TRACK NO.                73800020
*                                                                       74000020
* RELATIVE RECORD NO. ON THIS ROW OF TRACKS / NO RECORDS PER TRACK      74200020
* QUOTIENT - RELATIVE DRIVE NUMBER                                      74400020
* REMAINDER- RELATIVE RECORD NUMBER                                     74600020
*                                                                       74800020
         SRDA  R0,FULLSHIF              CLEAR EVEN REG.                 75000020
         DR    R1-1,RRCTRK                                              75200020
*                                                                       75400020
* R1 HAS RELATIVE DRIVE NUMBER, R0 HAS RELATIVE RECORD NUMBER           75600020
*                                                                       75800020
         XR    R1,R0                    SWAP REGISTERS R0, R1           76000020
         XR    R0,R1                                                    76200020
         XR    R1,R0                                                    76400020
*                                                                       76600020
* R0 HAS RELATIVE DRIVE NUMBER, R1 HAS RELATIVE RECORD NUMBER           76800020
*                                                                       77000020
         STC   R0,CPBABSAD              SET M OF MBBCCHHR               77200020
         XC    CPBABSAD+ONE(TWO),CPBABSAD+ONE  SET BB TO ZERO    X01004 77400004
         LA    R1,1(R1)                 MAKE REC NO. REL. TO 1          77600020
         STC   R1,CPBABSAD+SEVEN        SET R OF MBBCCHHR.       X01004 77800004
         STC   R2,CPBABSAD+6            GET REL TRACK NO.               78000020
         SRL   R2,BYTESHIF                                              78200020
         STC   R2,CPBABSAD+5                                            78400020
*                                                                       78600020
         LA    R1,DEBEXTLM              GET SIZE OF EACH DEB EXTENT     78800020
         MR    R1-1,R0                  MULT BY RELATIVE DRIVE NO.      79000020
         LA    RDEBX,DEBEXTPT(RDEBX,R1) BUMP DEB PT TO PROPER EXT       79200020
         AH    R3,DEBSTRCC              GET ABSOLUTE CYLINDER ADDR      79400020
         STC   R3,CPBABSAD+4              INTO MBBCCHHR                 79600020
         SRL   R3,BYTESHIF                                              79800020
         STC   R3,CPBABSAD+3                                            80000020
         LM    R14,R12,HISREG14(R13)    RESTORE REGISTERS               80200020
         BR    R14                      RETURN TO MAIN ROUTINE          80400020
*                                                                       80600020
*                                                                       80800020
PEUSDISK EQU   *                                                        81000020
         LM    R7,R12,AVTADEBR          GET VALUES FROM AVT             81200020
         B     CONTINUE                 GO TO SET UP MBBCCHHR    S21903 81400022
*                                                                       81600020
EXCEED   EQU   *                                                        81800020
         TM    AVTBIT1,AVTREADN         IS CHECKPOINT OPEN DOING        82000020
*                                         THIS CPB (OR, HAS READY NOT   82200020
*                                         BEEN EXECUTED YET)            82400020
         BZ    CONTINUE                   YES, CKPOINT,IGNORE THRESHOLD 82600020
*                                         NO, USUAL DISK TRAFFIC        82800020
         CLI   AVTHRESS,THRESHFF        HAS CLOSEDOWN BEEN REQUESTED    83000020
         BNE   CONTINUE                   YES, IGNORE THRESHOLD         83200020
*                                         NO, REQUEST THRESHOLD         83400020
         MVI   AVTHRESS,THRESHF7        MARK IT AS REQUESTED            83600020
         LR    R3,R1                    SAVE VALUE OF ADDR              83800020
*                                                                       84000020
         WTO   MF=(E,IED076I)           THRESHOLD CLOSEDOWN MSG         84300020
*                                                                       84600020
         L     R15,HISREG15(,R13)       RELOAD PROGRAM BASE             84800020
         LR    R1,R3                    RESTORE VALUE OF ADDR           85000020
         B     CONTINUE                 GO TO SET UP MBBCCHHR    S21903 85200022
*                                                                       85400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 85600020
*                                                                       85800020
*                       WRITE - TO - OPERATOR                           86100020
*                                                                       86400020
IED076I  WTO   'IED076I TCAM NON-REUSABLE DISK THRESHOLD CLOSEDOWN',   *86700020
               ROUTCDE=(2,11),DESC=4,MF=L                               87000020
         ENTRY IED076I                                                  87300020
IED140I  WTO   'IED140I TCAM DISK ERROR 41, F1F2S0S1, F3CSWCSWCSWCSWCS,*87320054
               UCB, RD ADDRESS',ROUTCDE=(2,10,11),DESC=4,MF=L   OX02204 87340054
MSGNAME  EQU   IED140I                                          OX02204 87360054
MSGECBCC EQU   MSGNAME+28               2 BYTE ECB CODE          99226  87380022
MSGFLAG1 EQU   MSGNAME+32               8 BYTE FLAG1-2,SENS0-1   99226  87400022
MSGCSW   EQU   MSGNAME+42               16 BYTE FLAG3 AND CSW    99226  87420022
MSGUCBID EQU   MSGNAME+60               3 BYTE UCBID             99226  87440022
MSGRDWR  EQU   MSGNAME+65               2 BYTE TYPE OPERATION    99226  87460022
MSGADDR  EQU   MSGNAME+68               6 BYTE DISK ADDR         99226  87480022
         ENTRY IED140I                                          OX02204 87500054
IED139I  WTO   'IED139I PRINTING STOPPED',                       99226 *87520022
               ROUTCDE=(2,10,11),DESC=4,MF=L                     99226  87540022
MSGNAME2 EQU   IED139I                                           99226  87560022
         ENTRY IED139I                                           99226  87580022
TRTABLE  EQU   *-239                    TRANSLATE TABLE          99226  87600022
         DC    C' 0123456789ABCDEF'     TRANSLATE TABLE          99226  87620022
*                                                                99226  87640022
*                                                                       87800020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 88000020
*                                                                       88200020
*                        DSECTS                                         88400020
*                                                                       88600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 88800020
IEDQDEBX DSECT                                                          89200020
DEBEXTPT EQU   68                       POINTER TO FIRST DEB EXTENT     89400020
DEBEXTLM EQU   16                       LENGTH OF EACH EXTENT           89600020
DEBDVMO  DS    0C                       DEVICE MODIFIER                 89800020
DEBUCBA  DS    A                        ADDRESS OF UCB                  90000020
         DS    2C                       RESERVED                        90200020
DEBSTRCC DS    CL2                      CYLINDER START ADDRESS          90400020
DEBSTRHH DS    CL2                      READ OR WRITE TRACK START ADDR  90600020
DEBENDCC DS    CL2                      CYLINDER END ADDRESS            90800020
DEBENDHH DS    CL2                      READ OR WRITE TRACK END ADDR    91000020
DEBNMTRK DS    H                        NUMBER OF TRACKS ALLOCATED      91200020
*                                         IN THIS EXTENT                91400020
*                                                                       91600020
         TCPBD 3330                                              S21101 91800021
*                                                                99226  91810022
* IN DISK ERROR CONDITIONS, DISK APPENDAGE PASSE                 99226  91820022
* ERROR STATUS INFORMATION IN THE CPB AS FOLLOWS                 99226  91830022
*                                                                99226  91840022
         ORG   CPBSEEK                  REDEFINE FROM CPB START  99226  91850022
         DS    A                        RESERVED FOR IEDQFQ      99226  91860022
CPBFLAG3 DS    C                        FROM IOBFLAG3            99226  91870022
CPBCSW   DS    CL7                      FORM IOBCSW              99226  91880022
CPBFLAG1 DS    C                        FORM IOBFLAG1            99226  91890022
CPBFLAG2 DS    C                        FORM IOBFLAG2            99226  91900022
CPBSENS0 DS    C                        FORM IOBSENS0            99226  91910022
CPBSENS1 DS    C                        FROM IOBSENS1            99226  91920022
CPBECBCC DS    C                        FORM IOBECBCC            99226  91930022
CPBUCBID DS    CL3                      FROM UCBNAME             99226  91940022
*                                                                99226  91950022
CVT      DSECT                                                   S21101 92000021
         CVT   RPS=YES                                           S21101 92200021
UCB      DSECT                                                   S21101 92400021
         IEFUCBOB                                                S21101 92600021
         DCBD  DSORG=TQ                                          S21101 92800021
         TIOBD                                                          93200020
         TDEBD                                                          94000020
         TDATAD                                                  99226  94100022
         TPRFD                                                   99226  94200022
         TDISPD                                                         94400020
         TAVTD 2                                                        94800020
         END                                                            95000020
