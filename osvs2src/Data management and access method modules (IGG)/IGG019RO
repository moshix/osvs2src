19RO     TITLE '''IGG019RO'' - TCAM DISPATCHER SUBTASK AND POST TRACE'  00100000
IGG019RO CSECT                                                          00200020
         SPACE 3                                                        00200100
*A000000-999999                                                @Z30X8D0 00200200
********************* MICROFICHE FLAGS ********************** SUPT CODE 00200300
*A545600-545800,596700                                           S22027 00205000
*A545500,596500                                                  S22026 00205100
*A268000,561000,639600                                           A42413 00205200
*C289600,561200                                                  A42413 00205300
*C250000,289600,290300,314000,639600                             S21903 00205400
*C564000-564500                                                 SA60006 00205500
*C561500                                                        SA60010 00205600
*C007000,545600                                                  S22024 00286022
*A596700                                                         S22024 00292022
*C631000-632000                                                @ZA01127 00292256
*C631000-632000                                                @ZA01127 00293056
*C545600,545700,596800,298000                                           00294007
*D108000-118000,315000-322000                                           00296007
*A596900                                                                00298007
*C007006,277000-285000                                         @Y17XADU 00298100
*A314000,639600,268000,265000                                  @Y17XADU 00298200
*D250000,270000,287000-290300,298000                           @Y17XADU 00298300
*A256000,260000,268200,662000                                  @Y17XADU 00298400
*D268500                                                       @Y17XADU 00298500
*C496000-497000,550000,640000                                  @Y17XADU 00298600
*A338500,361500,384500,388020-388900,494500,501710             @Y17XADA 00298700
*A555300-555400,555700,560200-560300,560700                    @Y17XADA 00298800
*A568500-568600,573500-573600,578500-578600,583500-583600      @Y17XADA 00298900
*A600500-600600,622010-622750,625500,633450-634500             @Y17XADA 00299000
*A638100-638700,640922-640990,643500-644500-647500,648500      @Y17XADA 00299100
*A662900                                                       @Y17XADA 00299200
*C480000,633500                                                @Y17XADA 00299300
*D478000-479000,634000,615000-618000,633600-634000             @Y17XADA 00299400
*D104000-194000,639300-639600                                  @Y17XADA 00299500
* A561000,563000,661100                                        @G36XRDV 00299600
*A621000,662400                                                @OY19395 00299700
*C560300                                                       @OY19395 00319700
*D622004                                                       @OY19395 00339700
*A460000                                                       @OY19919 00339886
*********************************************************************** 00359700
*                                                                     * 00400020
*TITLE:'IGG019RO' DISPATCHER                                          * 00500020
*                                                                     * 00600020
* MODULE-NAME=IGG010RO                                                * 00700000
*                                                                     * 00700100
* DESCRIPTIVE-NAME= TCAM DISPATCHER                            @Y17XADA 00700200
*                                                                     * 00700300
* COPYRIGHT='NONE'                                                    * 00700400
*                                                                     * 00700500
* STATUS: CHANGE LEVEL A                                       @Y17XADU 00700600
*                                                                     * 00800020
*FUNCTION: THIS MODULE ALLOCATES AND SCHEDULES SYSTEM RESOURCES. THE  * 00900020
*   VARIOUS RESOURCES OR ELEMENTS WAIT IN QUEUES FOR ALLOCATION.  THE * 01000020
*   ACTIVITY OF THESE QUEUES IS CONTROLLED BY THE 'READY QUEUE' WHICH * 01100020
*   CONTAINS RESOURCES TO BE PASSED FROM ONE SUBTASK TO ANOTHER.      * 01200020
*   ASSOCIATED WITH EACH RESOURCE ON THE READY QUEUE IS THE QUEUE TO  * 01300020
*   WHICH THE RESOURCE IS DIRECTED.                                   * 01400020
*                                                                     * 01500020
*   REPRESENTING EACH QUEUE IN THE SYSTEM IS A QUEUE CONTROL BLOCK    * 01600020
*   (QCB) WHICH IS THE CONNECTING LINK BETWEEN ELEMENTS AND SUBTASKS  * 01700020
*   WAITING FOR ELEMENTS. EACH WAITING SUBTASK IS REPRESENTED BY A    * 01800020
*   SUBTASK CONTROL BLOCK(STCB). EACH ELEMENT IS PREFACED BY A        * 01900020
*   RESOURCE CONTROL BLOCK(RCB).                                      * 02000020
*                                                                     * 02100020
*   ELEMENTS AND STCB'S ARE INSERTED IN THEIR RESPECTIVE CHAINS       * 02200020
*   WITHIN THE QCB IN PRIORITY/FIFO ORDER(FIRST IN, FIRST OUT) BY     * 02300020
*   PRIORITY.                                                         * 02400020
*                                                                     * 02500020
*                  QUEUE CONTROL BLOCK(QCB)                           * 02600020
*                                                                     * 02700020
*     DEC                                                             * 02800020
*        *******************************                              * 02900020
*      0 *       *       ELCHN         *                              * 03000020
*        *******************************                              * 03100020
*      4 *       *                     *                              * 03200020
*        *******************************                              * 03300020
*      8 *       *       STCHN         *                              * 03400020
*        *******************************                              * 03500020
*                                                                     * 03600020
*   ELCHN - ADDRESS OF FIRST ELEMENT CONTROLLED BY THIS QCB, IF       * 03700020
*           THIS QCB CONTROLS ANY ELEMENTS.                           * 03800020
*   STCHN - ADDRESS OF FIRST SUBTASK CONTROL BLOCK TO RECEIVE         * 03900020
*           CONTROL WHEN AN ELEMENT IS QPOSTED TO THIS QCB.           * 04000020
*   ALL OTHER FIELDS ARE IGNORED BY THE DISPATCHER.                   * 04100020
         EJECT                                                          04200020
*                  RESOURCE CONTROL BLOCK(RECB)                       * 04300020
*     DEC                                                             * 04400020
*        *******************************                              * 04500020
*      0 *       *       QCBA          *                              * 04600020
*        *******************************                              * 04700020
*      4 *  PRI  *       LINK          *                              * 04800020
*        *******************************                              * 04900020
*                                                                     * 05000020
*   QCBA - ADDRESS OF QCB TO WHICH RECB IS QPOSTED.                   * 05100020
*   PRI  - READY QUEUE AND CHAINING PRIORITY OF THE RECB.             * 05200020
*                                                                     * 05300020
*   LINK - ADDRESS OF NEXT ITEM IN CHAIN IN WHICH THIS ONE APPEARS.   * 05400020
*     ALL OTHER FIELDS ARE IGNORED BY THE DISPATCHER.                 * 05500020
*                                                                     * 05600020
*                                                                     * 05700020
*                  SUBTASK CONTROL BLOCK(STCB)                        * 05800020
*                                                                     * 05900020
*     DEC                                                             * 06000020
*        *******************************                              * 06100020
*      0 *  VTO  *                     *                              * 06200020
*        *******************************                              * 06300020
*      4 *  PRI  *       LINK          *                              * 06400020
*        *******************************                              * 06500020
*                                                                     * 06600020
*   VTO  - SUBTASK ENTRY CODE.                                        * 06700020
*   PRI  - PRIORITY OF THE SUBTASK.                                   * 06800020
*   LINK - ADDRESS OF NEXT ITEM IN CHAIN IN WHICH THIS ONE APPEARS.   * 06900020
*      ALL OTHER FIELDS ARE IGNORED BY THE DISPATCHER.                * 07000020
         EJECT                                                          07100020
*                                                                     * 07200020
*   WHEN AN ELEMENT REACHES THE TOP OF THE READY QUEUE, THE HIGHEST-  * 07300020
*   PRIORITY SUBTASK ASSOCIATED WITH THE QCB SPECIFIED IN THE RECB    * 07400020
*   IS ACTIVATED. THIS ELEMENT BECOMES THE PARAMETER PASSED TO THE    * 07500020
*   NEWLY ACTIVATED SUBTASK.                                          * 07600020
*                                                                     * 07700020
*   WHEN AN ELEMENT IS POSTED TO A QCB REPRESENTING AN ATTACHED TCAM  * 07800020
*   SUBTASK, THE DISPATCHER LINKS THE RECB INTO THE ELEMENT CHAIN OF  * 07900020
*   THE QCB AND POSTS THE EVENT CONTROL BLOCK(SECOND WORD OF QCB IN   * 08000020
*   THIS CASE) FOR THE ATTACHED TASK COMPLETE.                        * 08100020
*                                                                     * 08200020
*   THE FOLLOWING REGISTERS MUST BE PRESERVED FOR THE DISPATCHER BY   * 08300020
*   ALL MCP SUBTASKS:                                                 * 08400020
*                                                                     * 08500020
*   REGISTER 11 - ADDRESS OF DISPATCHER                               * 08600020
*   REGISTER 13 - ADDRESS OF DISPATCHER'S SAVE AREA                   * 08700020
*                                                                     * 08800020
*   EACH TIME A SUBTASK IS ACTIVATED, AN ENTRY IS MADE IN THE WRAP-   * 08900020
*   AROUND TRACE TABLE POINTED TO BY THE AVT(AVTDISTR) IF DTRACE=ON   * 09000000
*   SPECIFIED                                                  @Y17XADA 09100000
*ENTRY POINTS: PRIMARY ENTRY POINT IS IGG019RO. HOWEVER, THE          * 09200000
*   DISPATCHER ALSO PROVIDES SOME SERVICE FUNCTIONS OF A QUEUE MANAGER* 09300020
*   AS WELL AS DISPATCHING FUNCTIONS AND SERVICES. THESE FUNCTIONS ARE* 09400020
*   GENERATED BY THE TDISP DSECT. ENTRY POINT LABELS NOT ENDING IN 'R'* 09500020
*   RESULT IN LOSS OF CONTROL BY THE BRANCHING SUBTASK. THOSE ENDING  * 09600020
*   IN 'R' RESULT IN AN IMMEDIATE RETURN TO THE BRANCHING SUBTASK     * 09700020
*   AFTER THE REQUESTED FUNCTION HAS BEEN PERFORMED.                  * 09800020
         EJECT                                                          19500020
*INPUT: SEE 'ENTRY POINTS' BELOW.                                     * 19600000
*                                                                     * 19700020
*OUTPUT: REGISTERS 1,3,7,11,13, AND 15 CONTAIN THE FOLLOWING:         * 19800020
*           1- ADDRESS OF LAST DISPATCHED RECB.                       * 19900020
*           3- ADDRESS OF LAST DISPATCHED STCB.                       * 20000020
*           7- ADDRESS OF LAST DISPATCHED QCB.                        * 20100020
*           11- ADDRESS OF DISPATCHER.                                * 20200020
*           13- ADDRESS OF DISPATCHER'S REGISTER SAVEAREA(AVTSAVE2)   * 20300020
*           15- ENTRY POINT ADDRESS OF ACTIVATED SUBTASK.             * 20400020
*                                                                     * 20500020
*EXTERNAL ROUTINES:                                                   * 20600020
*           NONE                                                      * 20700020
*                                                                     * 20800020
*EXITS-NORMAL:                                                        * 20900020
*           1- ENTRY POINT ADDRESS OF ACTIVATED SUBTASK.              * 21000020
*           2- ADDRESS IN REGISTER 14 IF DISPATCHER IS USED AS A      * 21100020
*              QUEUE MANAGEMENT SERVICE ROUTINE.                      * 21200020
*                                                                     * 21300020
*EXITS-ERROR:                                                         * 21400020
*           NONE                                                      * 21500020
*                                                                     * 21600020
*TABLES/WORK AREAS:                                                   * 21700020
*   AVT(AVTDISP,AVTOSECB,AVTREADD,AVTREADY,AVTSAVE2)                  * 21800020
*   QCB                                                               * 21900020
*   RECB                                                              * 22000020
*   STCB                                                              * 22100020
*                                                                     * 22200020
*ATTRIBUTES:                                                          * 22300020
*   RE-USEABLE                                                        * 22400000
*   REFRESHABLE                                                       * 22500020
*                                                                     * 22600020
         EJECT                                                          22700020
*NOTES:                                                               * 22800020
*   IF A SUBTASK WISHES TO EXECUTE WITHOUT BEING PASSED AN ELEMENT,   * 22900020
*   IT MUST QPOST ITS STCB AS IF IT WERE AN RECB, WITH STCBVTO        * 23000020
*   CONTAINING THE CORRECT VALUE TO ACTIVATE THE SUBTASK, THE NEXT    * 23100020
*   THREE BYTES CONTAINING THE ADDRESS OF AVTREADY-8. STCBPRI MUST    * 23200020
*   CONTAIN A PRIORITY VALUE, AND STCBLINK MUST BE RESERVED FOR A     * 23300020
*   LINK FIELD.                                                       * 23400020
*                                                                     * 23500020
*   TO SUPPORT DISPATCHING WHILE ENABLED FOR INTERRUPTION, TWO READY  * 23600020
*   QUEUES ARE USED.  ONE OF THESE IS DESIGNATED AS THE 'ASYNCHRONOUS * 23700000
*   READY QUEUE'.  IT IS USED BY DISABLED TCAM CODE(APPENDAGES AND    * 23800020
*   AQCTL SVC) AS A MEANS OF PASSING ELEMENTS TO THE MCP.THE  @Y17XADA* 23900000
*   READY QUEUE IS PRIORITY-FIFO,THE ASYNC IS LIFO , CONVERTED@Y17XADA* 24000000
*   TO FIFO WHEN MERGED WITH THE READY QUEUE                  @Y17XADA* 24100000
*   THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL             * 24200020
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  * 24300020
*   TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED   * 24400020
*   SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY,     * 24500020
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.          * 24600020
*                                                                     * 24700020
*********************************************************************** 24800020
         EJECT                                                          25100000
*                                      REGISTER EQUATES                 25200020
         SPACE 2                                                        25300020
R0       EQU   0                        GENERAL WORK REGISTER           25400020
RRECB    EQU   1                  ELEMENT ADDRESS                       25500020
TBASE    EQU   2                  TRACE TABLE ENTRY BASE REG            25600020
RWORK    EQU   2                        WORK REGISTER          @Y17XADU 25650000
RSTCB    EQU   3                  LAST DISPATCHED STCB                  25700020
RLIST    EQU   4                  LIST POINTER                          25800020
TCBASE   EQU   5                        TRACE TABLE CONTROL BLOCK       25900020
*                                       BASE REGISTER                   26000020
RNEXT    EQU   5                        WORK REGISTER          @Y17XADU 26020000
RTCX     EQU   6                        TCX BASE               @Y17XADU 26040000
RCVT     EQU   6                        CVT BASE               @Y17XADU 26060000
RQCB     EQU   7                  LAST DISPATCHED QCB                   26100020
R8       EQU   8                  TEMPORARY WORK REG                    26200020
RAVT     EQU   9                  AVT ADDR                              26300020
R10      EQU   10                 TEMPORARY WORK REGISTER               26400020
RBASE    EQU   11                 DISPATCHER BASE REGISTER     @Y17XADA 26500000
R12      EQU   12                 REGISTER 12                  @Y17XADU 26550000
RSAVE    EQU   13                 SAVE AREA ADDR IN AVT                 26600020
RETURN   EQU   14                 RETURN REGISTER                       26700020
RENTRY   EQU   15                 ENTRY POINT, RETURN CODE REG          26800020
ONE      EQU   1                        CONSTANT VALUE 1       @Y17XADA 26801000
TWO      EQU   2                        CONSTANT VALUE 2       @Y17XADA 26802000
DISPL04  EQU   4                        CONSTANT VALUE 4       @Y17XADU 26810000
DISPL12  EQU   12                       CONSTANT VALUE 12      @Y17XADU 26820000
ADRMSK   EQU   7                        ADDRESS MASK           @Y17XADU 26822000
ADROFF   EQU   1                        ADDRESS OFFSET         @Y17XADU 26824000
         SPACE 1                                                        27100020
         USING IEDQRECB,RRECB                                           27200020
         USING IEDQSTCB,RSTCB                                           27300020
         USING IEDQQCB,RQCB                                             27400020
         USING AVTSAVE2,RSAVE                                           27500020
         EJECT                                                          27600000
         TDISPD CSECT=YES               DISPATCHER CSECT       @Y17XADU 27670000
         SPACE 3                                               @Y17XADA 27690000
IGG019RO IEDHJN ,                       HJN                    @Y17XADA 27710000
         EJECT                                                          32300020
TRCHAIN  EQU   *                                                        32310000
         ST    RETURN,SAVERET     SAVE REG 14 AT ENTRY TO CHAIN@Y17XADA 32320000
CHAIN    EQU   *                                                        33800020
         LR    RLIST,RRECB        SET REG FOR LOOP                      33900020
         BALR  RETURN,0           SET RETURN POINT FROM QUEUER          34000020
         LA    RRECB,0(,RLIST)    ZERO HI-ORDER BYTE                    34200000
         LTR   RRECB,RRECB        IS THERE ANOTHER ITEM                 34300020
CBDISP   BZ    DISPATCH           NO, GO TO DISPATCH READY QUEUE        34400000
         L     RLIST,RECBLINK-1   SAVE NEXT ITEM'S ADDRESS              34500020
         B     POSTR              GO PLACE THIS ONE ON READY QUEUE      34600020
         SPACE 3                                                        35900000
TRLIST   EQU   *                                                        35910000
         ST    RETURN,SAVERET     SAVE REG 14 AT ENTRY TO LIST @Y17XADA 35920000
LIST     EQU   *                                                        36100020
         LR    RLIST,RRECB        SET LIST POINTER                      36200020
         BALR  RETURN,0           SET LOOP RETURN POINT                 36300020
         L     RRECB,0(0,RLIST)   GET NEXT ITEM TO QPOST                36500020
         TM    0(RLIST),AVTE80    IS THIS LAST ITEM                     36600020
         LA    RLIST,4(,RLIST)    BUMP TO NEXT ITEM, IF ANY             36700000
         BZ    POSTR              NO, GO QPOST THIS ONE AND RETURN      36800020
         SPACE 3                                                        36850000
TRPOST   EQU   *                                                        37250000
         ST    RETURN,POSTR14     SAVE REG 14 AT ENTRY TO POST @Y17XADA 37650000
POST     EQU   *                                                        38400020
PLADISP  LA    RETURN,DISPATCH    GET EXIT POINT ADDR                   38500000
POSTR    EQU   *                                                        38700020
         LA    RQCB,AVTREADY      GET READY QUEUE ADDR                  38800020
         SPACE 1                                               @Y17XADA 38800500
************************************************************** @Y17XADA 38801000
*        THE FOLLOWING INSTRUCTION BYPASSES POST TRACE CODE  * @Y17XADA 38801400
*             WHEN POST TRACE IS ACTIVE IT WILL BE CHANGED TO* @Y17XADA 38801800
*             A NOP PRIORITR BY CODE IN ROUTINE TEST         * @Y17XADA 38802200
************************************************************** @Y17XADA 38802600
         SPACE 1                                               @Y17XADA 38803400
TRC      B     PRIORITR           B IF POST TRACE NOT ACTIVE   @Y17XADA 38803800
         EJECT                                                 @Y17XADA 38804000
************************************************************** @Y17XADA 38804200
*   THIS ROUTINE WILL TRACE ELEMENTS PLACED ON THE ENABLED   * @Y17XADA 38804300
*   READY QUEUE IF DTRACE=POST SPECIFIED . THIS ROUTINE WILL * @Y17XADA 38804400
*   TRACE THE INFORMATION RELATED TO THE TYPE OF POST        * @Y17XADA 38804500
*        1. ENTRY FROM CHAIN OR DSPCHAIN                     * @Y17XADA 38804600
*        2. ENTRY FROM LIST  OR DSPLIST                      * @Y17XADA 38804700
*        3. ENTRY TO   POST  OR DSPPOST                      * @Y17XADA 38804800
*        4. ENTRY TO   POSTR OR DSPPOSTR                     * @Y17XADA 38804900
* ********************************************************** * @Y17XADA 38805000
* * X'FE' * ELEMENT * EXIT-ADDRESS *   REG12   *   REG15   * * @Y17XADA 38805100
* ********************************************************** * @Y17XADA 38805200
*        5. ENTRY FROM CLEARRQ                               * @Y17XADA 38805300
* ********************************************************** * @Y17XADA 38805400
* * X'FF' * ELEMENT *    ZERO      *   ZERO    *    ZERO   * * @Y17XADA 38805500
* ********************************************************** * @Y17XADA 38805600
         SPACE 1                                               @Y17XADA 38805700
         STM   TBASE,TCBASE,SAVEREGS  SAVE REGS 2 - 5          @Y17XADA 38806000
         USING TABCB,TCBASE       TRACE TABLE CONTROL BLOCK    @Y17XADA 38807000
*                                 ADDRESSABILITY               @Y17XADA 38809000
         USING SENTRY,TBASE       SUBTASK TRACE TABLE ENTRY    @Y17XADA 38811000
*                                 ADDRESSABILITY               @Y17XADA 38813000
         L     TCBASE,AVTDISTR    ADDRESS OF TRACE TABLE       @Y17XADA 38815000
         L     TBASE,SCURRENT     ADDRESS OF CURRENT ENTRY     @Y17XADA 38817000
         ST    RRECB,STRECB       ELEMENT ADDRESS              @Y17XADA 38819000
         NC    ENTRY,ENTRY        ENTRY FROM IGG019RO          @Y17XADA 38821000
         BNZ   POSTRX             YES , TEST ENTRY ADDRESS     @Y17XADA 38823000
         ST    RETURN,STEPA       RETURN ADDRESS               @Y17XADA 38825000
         CLC   STRET,POSTRET      POST ENTRY FROM SUBTASK      @Y17XADA 38827000
         BNE   RETURNOK           NO , FORMAT TRACE ENTRY      @YM06934 38829000
         MVC   STEPA,POSTR14      MOVE SUBTASK ENTRY ADDRESS   @Y17XADA 38831000
         B     RETURNOK           BRANCH TO CONTINUE           @YM06934 38833000
POSTRX   EQU   *                                               @Y17XADA 38835000
         CLC   ENTRY,ASYNCMER     ASYNC MERGE RETURN ADDRESS   @YM06934 38839000
         BNE   NOTMERGE           NO , CONTINUE NORMALLY       @Y17XADA 38841000
         MVI   STEPRI,FF          INDICATE MERGE ENTRY         @Y17XADA 38843000
         XC    STEPALL,STEPALL    CLEAR REG14 REG12 & REG15    @Y17XADA 38845000
         B     MRGASYNC           BRANCH TO CONTINUE           @Y17XADA 38847000
NOTMERGE EQU   *                                               @Y17XADA 38849000
         MVC   STEPA,SAVERET      MOVE RETURN ADDRESS          @Y17XADA 38850000
RETURNOK EQU   *                                               @YM06934 38851000
         MVI   STEPRI,FE          INDICATE POST ENTRY          @Y17XADA 38853000
         ST    R12,STQCB          REG 12                       @Y17XADA 38855000
         ST    RENTRY,STSTCB      REG 15                       @Y17XADA 38857000
MRGASYNC EQU   *                                               @Y17XADA 38859000
         C     TBASE,SLAST        CURRENT EQ LAST              @Y17XADA 38861000
         BL    POSTRNX            NO , UPDATE TO NEXT          @Y17XADA 38863000
         MVC   SCURRENT,SFIRST    WRAP AROUND TRACE TABLE      @Y17XADA 38865000
         TM    AVTAFE10,AVTEFF    IS DUMP REQUESTED            @Y17XADA 38867000
         BZ    POSTRNO            NO , CONTINUE                @Y17XADA 38869000
         L     TBASE,AVTAFE10     ADDRESS OF IEDQFE10          @Y17XADA 38871000
         ST    RETURN,SAVE14      SAVE REG 14                  @Y17XADA 38875000
         BALR  RETURN,TBASE       GO DUMP TRACE TABLE          @Y17XADA 38876000
         L     RETURN,SAVE14      RESTORE REG 14               @Y17XADA 38877000
         B     POSTRNO            BYPASS UPDATING NEXT ENTRY   @Y17XADA 38879000
POSTRNX  EQU   *                                               @Y17XADA 38881000
         LA    TBASE,ENLEN(,TBASE)   INCREMENT CURRENT ENTRY   @Y17XADA 38883000
         ST    TBASE,SCURRENT     SAVE ADDRESS OF NEXT ENTRY   @Y17XADA 38885000
POSTRNO  EQU   *                                               @Y17XADA 38887000
         LM    TBASE,TCBASE,SAVEREGS  RESTORE REGS 2 - 5       @Y17XADA 38889000
         B     PRIORITR           GO PLACE ELEMENT BY PRIORITY          38900020
         EJECT                                                          39000020
QWAIT    EQU   *                                                        40500020
         L     RRECB,QCBELCHN-1-IEDQQCB(0,RSTCB) GET ELEMENT ADDR       40600020
         MVC   QCBELCHN-IEDQQCB(3,RSTCB),RECBLINK DE-LINK ELEMENT       40700020
         CLI   RECBPRI,AVTEZERO   IS THERE AN ELEMENT                   40800020
         BNE   BYPASS             GO DISPATCH SUBTASK                   40900020
         SPACE 2                                                        41000020
***  FALL THROUGH TO TESTQ AND UNAVAIL TO CAUSE SUBTASK TO WAIT         41100020
         SPACE 2                                                        42400020
TESTQ    EQU   *                                                        42600020
         LA    RETURN,DISPATCH    GET EXIT POINT ADDR                   42700020
TESTQR   EQU   *                                                        42900020
         LA    RSTCB,0(,RSTCB)    ZERO HI-ORDER BYTES                   43000000
         LA    RQCB,0(,RQCB)                                            43100000
         CLR   RQCB,RSTCB         IS STCB IN CORRECT QCB                43200020
         BCR   8,RETURN           YES, RETURN                           43300020
         SPACE 3                                                        43400000
UNAVAILR EQU   *                                                        43600020
         L     RRECB,QCBSTCHN-1   GET STCB TO MOVE                      43700020
         MVC   QCBSTCHN(3),STCBLINK-IEDQSTCB(RRECB) DE-LINK STCB        43800020
         LA    RSTCB,QCBSTCHN-5-IEDQQCB(,RSTCB)  SET STCB CHAIN AS      43900000
*                                      RECIPIENT                        44000020
         SPACE 3                                                        44100000
***  FALL THROUGH TO PRIORITY SEARCH ROUTINE                            44200020
         SPACE 3                                                        45300000
SCAN     EQU   *                                                        45400020
         LA    RQCB,RECBLINK-1-IEDQRECB(,RSTCB)  POINT AT NEXT RECB     45500000
PRIORITR EQU   *                                                        45700020
         L     RSTCB,QCBELCHN-1   GET NEXT ELEMENT ADDR                 45800020
         CLC   RECBPRI-IEDQRECB(1,RSTCB),RECBPRI COMPARE PRIORITIES     45900020
         BH    SCAN                     IF HIGH GET NEXT ELEM  @OY19919 46000086
         BL    LIFOR                    IF LOW INSERT ELEMENT  @OY19919 46030086
         CLM   RRECB,ADRMSK,QCBELCHN    ELEMENT ALREADY ON QUE @OY19919 46100086
         BNE   SCAN                     NO, GET NEXT ELEMENT   @OY19919 46130086
         SPACE 1                                               @OY19919 46200086
ABDEBUG  EX    RRECB,ABDEBUG            FORCE ABEND0C6         @OY19919 46230086
         SPACE 3                                                        47400000
LIFOR    EQU   *                                                        47600020
         MVC   RECBLINK(3),QCBELCHN INSERT ITEM AT THIS POINT           47700020
         STCM  RRECB,ADRMSK,QCBELCHN INSERT ELEMENT ON CHAIN   @YM05632 48000000
         BR    RETURN             EXIT                                  48100020
         EJECT                                                          48200020
TRDISP   EQU   *                                               @Y17XADA 48250000
         XC    ENTRY,ENTRY              CLEAR ENTRY ADDRESS    @Y17XADA 48750000
DISPATCH EQU   *                                                        49400020
         L     RCVT,CVTPTR              GET CVT ADDRESS        @Y17XADU 49500000
         USING CVTMAP,RCVT              SET CVT ADDRESSABILITY @Y17XADU 49510000
         L     RTCX,CVTAQAVT            GET TCX ADDRESS        @Y17XADU 49520000
         DROP  RCVT                                            @Y17XADU 49530000
         USING IEDQTCX,RTCX             SET TCX ADDRESSABILITY @Y17XADU 49540000
         L     RLIST,TCXREADY           GET ELEMENT            @YM05632 50104000
         LTR   RLIST,RLIST              ELEMENT EXIST          @YM05632 50104500
         BZ    TESTRQ                   NO-TEST SYSCHRONOUS Q  @Y17XADU 50106000
***  THIS ROUTINE RE-ORDERS THE ASYNCHRONOUS READY QUEUE       @Y17XADU 50108000
***  FROM LIFO ORDERING TO FIFO THEN MERGES THIS FIFO          @Y17XADU 50110000
***  QUEUE WITH THE ENABLED READY QUEUE.                       @Y17XADU 50112000
LIFOFIFO EQU   *                                               @Y17XADU 50114000
         SLR   RWORK,RWORK              CLEAR WORK REGISTER    @Y17XADU 50116000
CLEARRQ  EQU   *                                               @Y17XADU 50118000
         CS    RLIST,RWORK,TCXREADY     REMOVE LIST OF ELEMENTS         50120000
*                                       FROM LIFO-ORDERED ASYNCH        50122000
*                                       READY QUEUE            @Y17XADU 50124000
         BNE   CLEARRQ                  IF ASYNCHRONOUSLY               50126000
*                                       UPDATED, TRY AGAIN     @Y17XADU 50128000
         SLR   RNEXT,RNEXT              CLEAR NEXT PTR REG     @YM02947 50129000
REORDER  EQU   *                                               @Y17XADU 50130000
         LR    RRECB,RLIST              PUSH LIFO ELEMENT ONTO          50130600
*                                       FIFO LIST              @Y17XADU 50132600
         ICM   RNEXT,ADRMSK,RECBLINK    GET NEXT ELEMENT                50136000
*                                       FROM LIFO QUEUE        @Y17XADU 50138000
         STCM  RWORK,ADRMSK,RECBLINK    LINK NEW 1ST ELEMENT            50140000
*                                       TO FORMER FIRST ELEMENT         50142000
*                                       OF FIFO QUEUE          @Y17XADU 50144000
         LR    RWORK,RLIST              UPDATE ADDRESS OF CURRENT       50146000
*                                       FIRST ELEMENT ON FIFO           50148000
*                                       QUEUE                  @Y17XADU 50150000
         LTR   RLIST,RNEXT              UPDATE ADDRESS OF NEXT          50152000
*                                       ELEMENT ON LIFO QUEUE  @Y17XADU 50154000
         BNZ   REORDER                  CONTINUE LIFO TO FIFO           50156000
*                                       REORDERING IF LIFO QUEUE        50158000
*                                       HAS NOT BEEN EXHAUSTED @Y17XADU 50160000
ASYNCBAL BAL   RETURN,CHAIN             PLACE ELEMENT ON READY @Y17XADA 50168000
*                                       QUEUE BY PRIORITY      @Y17XADU 50170000
ASYNCRET EQU   *                                               @Y17XADA 50171000
         DROP  RTCX                                            @Y17XADU 50180000
************************************************************** @Y17XADU 50182000
         SPACE 2                                                        50200020
TESTRQ   EQU   *                                                        50300020
         L     RRECB,AVTREADY     GET HIGHEST PRIORITY READY ELEM       50400020
         L     RQCB,RECBQCBA-1    GET QCB ADDR                          50500020
         L     RSTCB,QCBSTCHN-1   GET HIGHEST PRIORITY STCB ADDR        50600020
         L     RLIST,RECBLINK-1   DE-LINK IT FROM CHAIN                 50700020
         ST    RLIST,AVTREADY                                           50800020
         SPACE 2                                                        50900000
BYPASS   EQU   *                                                        52200020
         SLR   R8,R8              ZERO INDEX REG               @Y17XADA 52300000
         IC    R8,STCBVTO         GET SUBTASK ENTRY CODE                52400020
         LH    R10,INDEX(R8)      GET ACTIVATION ROUTINE INDEX          52500020
         B     ROUTINES(R10)      GO TO ACTIVATION ROUTINE              52600020
         EJECT                                                          52700000
INDEX    EQU   *   INDEX TO SUBTASKS                           @Y17XADA 52710000
         DC    AL2(MCPWAIT-ROUTINES)     0 - ISSUE SYSTEM WAIT          52810000
         SPACE 2                                               @Y17XADA 52820000
************************************************************** @Y17XADA 52830000
*                                                            * @Y17XADA 52840000
*   TO MAXIMIZE PERFORMANCE THE FOLLOWING TABLE WILL BE      * @Y17XADA 52850000
*        MODIFIED TO ALLOW ACTIVATION ROUTINE TO BE          * @Y17XADA 52860000
*        DISPATCHED FROM ONE OF TWO TABLES                   * @Y17XADA 52870000
*             1. INDEX  WHEN SUBTASK TRACE IS NOT ACTIVE     * @Y17XADA 52880000
*             2. TINDEX WHEN SUBTASK TRACE IS     ACTIVE     * @Y17XADA 52890000
*                                                            * @Y17XADA 52900000
*   BY ALTERING THE TABLE THE APPROPRIATE ACTIVATION         * @Y17XADA 52910000
*        ROUTINE WILL GET CONTROL , THAT WILL CONTAIN THE    * @Y17XADA 52920000
*        CODE REQUIRED TO BRANCH TO TRACE IF SUBTASK TRACE   * @Y17XADA 52930000
*        IS ACTIVE                                           * @Y17XADA 52940000
*                                                            * @Y17XADA 52950000
************************************************************** @Y17XADA 52960000
         SPACE 2                                                        52970000
VRINDXST EQU   *                         * VARIABLE INDEX START@Y17XADA 52980000
         DC    AL2(ATTPOST-ROUTINES)     2 - POST ATTACHED TASK         53000000
         DC    AL2(MCP2-ROUTINES)        4 - ACTIVATE 2-BYTE STCB       53070000
         DC    AL2(MCP4-ROUTINES)        6 - ACTIVATE 4-BYTE STCB       53140000
         DC    AL2(MCP6-ROUTINES)        8 - ACTIVATE 6-BYTE STCB       53210000
         DC    AL2(MCP8-ROUTINES)        10 - ACTIVATE 8-BYTE STCB      53350000
VRINDXSP EQU   *                         * VARIABLE INDEX STOP @Y17XADA 53380000
VRINDXLN EQU   VRINDXSP-VRINDXST         * LENGTH VAR INDEXES  @Y17XADA 53420000
SPECIALS EQU   *                                               @Y17XADA 53500000
         DC    AL2(RCVSCH-ROUTINES)      12 - RECEIVE SCHEDULER         53580000
         DC    AL2(SNDSCH-ROUTINES)      14 - SEND SCHEDULER            53660000
         DC    AL2(GETSCH-ROUTINES)      16 - GET SCHEDULER             53740000
         DC    AL2(PUTSCH-ROUTINES)      18 - PUT SCHEDULER             53820000
         DC    AL2(GFFSCH-ROUTINES)      20 - GET FIFO ROUTINE          53980000
         DC    AL2(LOGSCH-ROUTINES)      22 - LOG SCHEDULER             54060000
         DC    AL2(DIASCH-ROUTINES)      24 - DIAL SCHEDULER            54140000
         DC    AL2(DIASCH-ROUTINES)      26 - BUFFERED SCHEDULER        54220000
         DC    AL2(DIASCH-ROUTINES)      28 - RETRIEVE SCHEDULER        54380000
         DC    AL2(LOCSCH-ROUTINES)      30 - 2260 LOCAL SCHEDULER      54440000
         DC    AL2(CONCSCH-ROUTINES)     32 - CONC SCHEDULER     S22026 54500000
         DC    AL2(VTSSCH-ROUTINES)      34 - NCP SEND SCHEDULER X03039 54560000
         DC    AL2(VTRSCH-ROUTINES)      36 - NCP RECV SCHEDULER X03039 54570000
         DC    AL2(COMBSCH-ROUTINES)     38 - COMBUF SCHEDULER   S22027 54580000
         SPACE 3                                                        54610000
***            END OF TABLE                                    @Y17XADA 54650000
         EJECT                                                          54720000
***  ROUTINES TO ACTIVATE SUBTASKS -                           @Y17XADA 54820000
         SPACE 2                                                        54920000
ROUTINES EQU   *                                                        55100020
MCPWAIT  EQU   *                                                        55200020
         MVI   AVTOSECB,AVTEZERO        SET MCP ECB FOR WAIT            55300020
         L     RCVT,CVTPTR              GET CVT ADDRESS        @Y17XADU 55400000
         USING CVTMAP,RCVT              SET CVT ADDRESSABILITY @Y17XADU 55408000
         L     RTCX,CVTAQAVT            GET TCX ADDRESS        @Y17XADU 55416000
         DROP  RCVT                                            @Y17XADU 55424000
         USING IEDQTCX,RTCX             SET TCX ADDRESSABILITY @Y17XADU 55432000
         L     RLIST,TCXREADY           GET ELEMENT            @YM05632 55512000
         LTR   RLIST,RLIST              ELEMENT EXIST          @YM05632 55514000
         BNZ   LIFOFIFO                 YES MERGE ASYNCH QUEUE @Y17XADU 55520000
         DROP  RTCX                                            @Y17XADU 55528000
MCPWAITB NOP   TRACE              BAL   RENTRY,TRACE  OR  NOP  @Y17XADA 55550000
         WAIT  ECB=AVTOSECB       WAIT ON INTERRUPT                     55700000
         B     DISPATCH           GO DISPATCH                           55800020
         SPACE 1                                                        55900020
TATTPOST EQU   *                                                        56020000
         L     TCBASE,AVTDISTR    LOAD ADDRESS CURRENT         @OY19395 56030000
         L     TBASE,SCURRENT     TRACE TABLE ENTRY            @OY19395 56035000
         L     RENTRY,RECBELAD    GET ADDRESS BUFFER           @OY19395 56040000
         ST    RENTRY,STEPA       STORE ENTRY POINT            @OY19395 56045000
         BAL   RENTRY,TRACE1      TRACE ELEMENT                @OY19395 56050000
ATTPOST  EQU   *                                                        56060000
         LR    R10,RQCB                 SAVE QCB ADDRESS                56100020
         LR    R8,RRECB           SAVE ELEMENT POINTER         @G36XRDV 56110000
         MODESET MODE=SUP         ENTER SUPERVISOR STATE       @G36XRDV 56120000
         MODESET EXTKEY=SUPR      ENTER KEY ZERO               @G36XRDV 56130000
SETATSK  DS    0H                                              @G36XRDV 56140000
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,REGS=USE,       @G36XRDVC56150000
               RELATED=ATTACHED-TASKS-IEDQWA1(SETATSK)-        @G36XRDVC56160000
               IGC0010D(SETATSK)-IEDQNF(SETATSK)-              @G36XRDVC56170000
               IEDQNS(SETATSK)-IEDQNQ(SETATSK)                 @G36XRDV 56180000
         LR    RRECB,R8           RESTORE ELEMENT POINTER      @G36XRDV 56190000
         BAL   RETURN,PRIORITR    GO QUEUE THE ELEMENT                  56200020
         LR    RQCB,R10                 RESTORE QCB ADDRESS             56300020
         SETLOCK RELEASE,TYPE=LOCAL,REGS=USE,                  @G36XRDVC56330000
               RELATED=IGG019RO(SETATSK)                       @G36XRDV 56360000
         MODESET EXTKEY=TCAM      SET TO TCAM KEY              @G36XRDV 56390000
         MODESET MODE=PROB        SET TO PROBLEM STATE         @G36XRDV 56420000
         POST  QCBPRI                   POST THE TASK           SA60006 56450000
         B     DISPATCH           GO DISPATCH                           56500020
         SPACE 1                                                        56600020
MCP2     EQU   *                                                        56700020
         LA    RENTRY,2(,RSTCB)   GET SUBTASK ENTRY POINT ADDR          56800000
         BR    RENTRY             BRANCH TO SUBTASK                     56830000
         SPACE 1                                                        56830800
TMCP2    EQU   *                                               @Y17XADA 56831600
         LA    RENTRY,2(,RSTCB)   GET SUBTASK ENTRY POINT ADDR @Y17XADA 56832400
         B     TRACE              BRANCH TO TRACE THEN SUBTASK @Y17XADA 56833200
         SPACE 1                                               @Y17XADA 56834000
MCP4     EQU   *                                                        57200020
         LA    RENTRY,4(,RSTCB)   GET SUBTASK ENTRY POINT ADDR          57300000
         BR    RENTRY             BRANCH TO SUBTASK                     57330000
         SPACE 1                                                        57331000
TMCP4    EQU   *                                               @Y17XADA 57332000
         LA    RENTRY,4(,RSTCB)   GET SUBTASK ENTRY POINT ADDR @Y17XADA 57333000
         B     TRACE              BRANCH TO TRACE THEN SUBTASK @Y17XADA 57334000
         SPACE 1                                               @Y17XADA 57336000
MCP6     EQU   *                                                        57700020
         LA    RENTRY,6(,RSTCB)   GET SUBTASK ENTRY POINT ADDR          57800000
         BR    RENTRY             BRANCH TO SUBTASK                     57830000
         SPACE 1                                                        57831000
TMCP6    EQU   *                                               @Y17XADA 57832000
         LA    RENTRY,6(,RSTCB)   GET SUBTASK ENTRY POINT ADDR @Y17XADA 57833000
         B     TRACE              BRANCH TO TRACE THEN SUBTASK @Y17XADA 57834000
         SPACE 1                                               @Y17XADA 57836000
MCP8     EQU   *                                                        58200020
         LA    RENTRY,8(,RSTCB)   GET SUBTASK ENTRY POINT ADDR          58300000
         BR    RENTRY             BRANCH TO SUBTASK                     58330000
         SPACE 1                                                        58330800
TMCP8    EQU   *                                               @Y17XADA 58331600
         LA    RENTRY,8(,RSTCB)   GET SUBTASK ENTRY POINT ADDR @Y17XADA 58332400
         B     TRACE              BRANCH TO TRACE THEN SUBTASK @Y17XADA 58333200
         SPACE 1                                               @Y17XADA 58334000
RCVSCH   EQU   *                                                        58700020
SNDSCH   EQU   *                                                        58800020
GETSCH   EQU   *                                                        58900020
PUTSCH   EQU   *                                                        59000020
GFFSCH   EQU   *                                                        59100020
LOGSCH   EQU   *                                                        59200020
DIASCH   EQU   *                                                        59300020
BUFSCH   EQU   *                                                        59400020
RETSCH   EQU   *                                                        59500020
LOCSCH   EQU   *                                                        59600020
CONCSCH  EQU   *                                                 S22026 59650022
COMBSCH  EQU   *                                                 S22027 59670022
VTSSCH   EQU   *                                                 X03039 59680007
VTRSCH   EQU   *                                                 X03039 59690007
         LA    RENTRY,0(R8,R8)    MULTIPLY BY TWO TO WORD INDEX         59800000
         L     RENTRY,AVTDISP-2*(SPECIALS-INDEX)(RENTRY)  ADDR OF CODE  59900000
MCPXBE   BR    RENTRY             BRANCH TO ENTRY OR           @Y17XADA 60200000
*                                 FALL THROUGH TO TRACE        @Y17XADA 60220000
         EJECT                                                          61300020
************************************************************** @Y17XADA 61305000
*   THIS ROUTINE WILL TRACE ELEMENTS DISPATCHED IF SUBTASK   * @Y17XADA 61310000
*   TRACE ACTIVE THE TRACE TABLE WILL HAVE THE FOLLOWING     * @Y17XADA 61315000
*                       FORMATS                              * @Y17XADA 61320000
*                                                            * @Y17XADA 61325000
*        1. NORMAL DISPATCHER TRACE ENTRY                    * @Y17XADA 61330000
*                                                            * @Y17XADA 61335000
* ********************************************************** * @Y17XADA 61340000
* * P * ELEMENT *   * ENTRY-@ * QP * QCB-@ * MCPL * STCB-@ * * @Y17XADA 61345000
* ********************************************************** * @Y17XADA 61350000
*                                                            * @Y17XADA 61355000
*        2. ELEMENT DISPATCHED IS A BUFFER                   * @Y17XADA 61360000
*                                                            * @Y17XADA 61365000
* ********************************************************** * @Y17XADA 61370000
* * P * ELEMENT * FE * ENTRY-@ * QP * QCB-@ * MCPL * LCB-@ * * @Y17XADA 61375000
* ********************************************************** * @Y17XADA 61380000
*                                                            * @Y17XADA 61385000
************************************************************** @Y17XADA 61390000
         SPACE 2                                                        61395000
TRACE    EQU   *                                                        61400020
         L     TCBASE,AVTDISTR          ADDRESS OF TRACE TABLE          61900020
*                                       CONTROL BLOCK FROM AVT          62000020
         L     TBASE,SCURRENT .         ADDRESS OF CURRENT ENTRY        62100020
         ST    RENTRY,STEPA             SAVE ENTRY POINT       @OY19395 62130000
TRACE1   EQU   *                                               @OY19395 62160000
         ST    RRECB,STRECB .           ELEMENT ADDRESS                 62200020
         USING IEDQPRF,RRECB            USING BUFFER DSECT     @Y17XADA 62210000
         CLM   RRECB,ADRMSK,AVTCOREC+1  ADDRESS GT BUFFER POOL @Y17XADA 62220000
         BL    NOTBUF                   NO , NOT BUFFER        @Y17XADA 62225000
         TM    PRFTIC,TIC               ELEMENT + 8 TIC        @Y17XADA 62230000
         BZ    NOTBUF                   NO , NOT BUFFER        @Y17XADA 62235000
         TM    PRFTIC,NOTTIC            ELEMENT + 8 TIC        @Y17XADA 62240000
         BNZ   NOTBUF                   NO , NOT BUFFER        @Y17XADA 62245000
         MVI   STEPFE,FE                INDICATE ELEMENT BUFFER@Y17XADA 62250000
         MVC   STSTLCB,PRFLCB           MOVE LCB ADDRESS       @Y17XADA 62255000
         B     NOTSTCB                  BYPASS STCB CODE       @Y17XADA 62260000
         USING IEDQRECB,RRECB           USING RECB DSECT       @Y17XADA 62265000
NOTBUF   EQU   *                                               @Y17XADA 62270000
         ST    RSTCB,STSTCB .           STCB ADDRESS                    62400020
         MVI   STEPFE,AVTEZERO          INDICATE NOT BUFFER    @Y17XADA 62410000
NOTSTCB  EQU   *                                               @Y17XADA 62420000
         STC   R8,STMCPL                VECTOR TABLE OFFSET    @Y17XADA 62430000
         ST    RQCB,STQCB .             QCB ADDRESS                     62600020
         MVC   STQDSFLG,QCBDSFLG        QCB FLAG BYTE                   62700000
         MVC   STEPRI,RECBPRI           ELEMENT'S CURRENT PRIORITY      62800000
         C     TBASE,SLAST              CURRENT EQ LAST        @ZA01127 63100056
         BL    SBUMP                    BR IF NO               @ZA01127 63200056
         MVC   SCURRENT,SFIRST .        WRAP AROUND TRACE TABLE         63300000
         TM    AVTAFE10,AVTEFF          IS DUMP REQUESTED               63310020
         BZ    NOTRACE                  BRANCH IF NO                    63320020
R2       EQU   2                        TWO                      S22024 63330022
         L     R2,AVTAFE10              ADDRESS OF IEDQFE10             63340020
         BALR  RETURN,R2                GO DUMP TRACE TABLE    @Y17XADA 63350000
         B     NOTRACE                  BYPASS UPDATING TRACE  @Y17XADA 63430000
SBUMP    EQU   *                                                        63500020
         LA    TBASE,ENLEN(,TBASE) .   INCREMENT CURRENT ENTRY          63600000
*                                       POINTER BY ENTRY LENGTH         63700020
         ST    TBASE,SCURRENT .         SAVE ADDR OF NEXT ENTRY         63800020
NOTRACE  EQU   *                                               @Y17XADA 63810000
         CLC   AVTDTRAP,AVTFZERO        TRAP LOADED            @Y17XADA 63820000
         BER   RENTRY                   NO,RETURN OR ENTER ST  @Y17XADA 63830000
         ST    RENTRY,SAVE15            SAVE REG 15            @Y17XADA 63840000
         L     RENTRY,AVTDTRAP          LOAD ENTRY ADDRESS     @Y17XADA 63850000
         BALR  RETURN,RENTRY            ENTER ROUTINE          @Y17XADA 63860000
         L     RENTRY,SAVE15            RESTORE REG 15         @Y17XADA 63870000
         BR    RENTRY                   RETURN OR ENTER ST     @Y17XADA 63900000
         EJECT                                                 @Y17XADU 63930000
*        FIRST ENTRY SET-UP CODE                               @Y17XADU 63966000
*                                                              @Y17XADU 63969000
SAVE     DS    0H                       BOUNDARY ALLIGNMENT    @Y17XADU 63972000
         STM   RETURN,R12,DISPL12(RSAVE) SAVE CALLER'S REGS    @Y17XADU 63975000
         LM    RETURN,R12,DISPL12(RRECB) RESTORE CALLER'S REGS @Y17XADU 63978000
         ST    RSAVE,AVTSAVE2+DISPL04-IEDQAVTD(,RAVT) SAVE     @Y17XADU 63981000
*                                       CALLER'S SAVE AREA PTR @Y17XADU 63984000
         LA    R10,AVTSAVE2-IEDQAVTD(,RAVT) AVE AREA ADDRESS   @Y17XADU 63987000
         ST    R10,AVTECD8(,RSAVE)      SAVE ADDRESS           @Y17XADU 63990000
         LR    RSAVE,R10                SET SAVE AREA REG      @Y17XADU 63993000
         SLR   RQCB,RQCB                INDICATE INITIAL ENTRY @Y17XADA 63993100
         B     TEST                     TEST INTRO OPTIONS     @Y17XADA 63993300
         SPACE 1                                               @Y17XADA 63993500
************************************************************** @Y17XADA 63993700
*                                                            * @Y17XADA 63993900
*        SUBTASK TO MODIFY / SETUP TRACE OPTIONS             * @Y17XADA 63994000
*                                                            * @Y17XADA 63994100
************************************************************** @Y17XADA 63994200
         DS    0F                                              @Y17XADA 63994300
         SPACE 1                                               @Y17XADA 63994400
TRCQCB   EQU   *-8                                             @Y17XADA 63994600
TRCSTCB  DC    AL1(DSPMCPL4),AL3(TRCSTCB)                      @Y17XADA 63994800
TEST     EQU   *                        ENTRY TO MODIFY TRACE  @Y17XADA 63995000
         TM    AVTSUBT,AVTSUBON         SUBTASK TRACE ACTIVE   @Y17XADA 63995200
         BZ    RESET1                   NO , RESET NORM TRACE  @Y17XADA 63995400
         MVC   VRINDXST(VRINDXLN),TINDEX INITILIZE TO TINDEX   @Y17XADA 63995600
         MVC   MCPWAITB(TWO),BAL        INITILIZE MCPWAITB BAL @Y17XADA 63995800
         MVI   MCPXBE+1,AVTEZERO        INITILIZE MCPXBE '0700 @Y17XADA 63996000
         TM    AVTSUBT,AVTSUBPT         POST TRACE ACTIVE      @Y17XADA 63996100
         BZ    RESET2                   NO , RESET POST TRACE  @Y17XADA 63996300
         MVC   DSPLIST+TWO(TWO),TLIST   INITILIZE TO TRLIST    @Y17XADA 63996400
         MVC   DSPCHAIN+TWO(TWO),TCHAIN INITILIZE TO TRCHAIN   @Y17XADA 63996500
         MVC   DSPPOST+TWO(TWO),TPOST   INITILIZE TO TRPOST    @Y17XADA 63996600
         MVC   CBDISP+TWO(TWO),TDISP    INITILIZE TO TRDISP    @Y17XADA 63996700
         MVC   PLADISP+TWO(TWO),TDISP   INITILIZE TO TRDISP    @Y17XADA 63996800
         MVI   TRC+ONE,AVTEZERO         INITILIZE POST TRACE   @Y17XADA 63996900
         MVC   ASYNCBAL+TWO(TWO),TCHAIN INITILIZE TO TRCHAIN   @Y17XADA 63997000
         B     TESTEND                  BRANCH TO TESTEND      @Y17XADA 63997100
RESET1   EQU   *                        RESET SUPTASK TRACE    @Y17XADA 63997200
         MVC   VRINDXST(VRINDXLN),NINDEX RESET TO NINDEX       @Y17XADA 63997300
         MVC   MCPWAITB(TWO),NOP        RESET MCPWAITB 'NOP'   @Y17XADA 63997400
         MVI   MCPXBE+1,FF              RESET MCXBE '07FF'     @Y17XADA 63997500
RESET2   EQU   *                        RESET POST TRACE       @Y17XADA 63997600
         MVC   DSPLIST+TWO(TWO),NLIST   RESET TO LIST          @Y17XADA 63997700
         MVC   DSPCHAIN+TWO(TWO),NCHAIN RESET TO CHAIN         @Y17XADA 63997800
         MVC   DSPPOST+TWO(TWO),NPOST   RESET TO POST          @Y17XADA 63997900
         MVC   CBDISP+TWO(TWO),NDISP    RESET TO DISPATCH      @Y17XADA 63998000
         MVC   PLADISP+TWO(TWO),NDISP   RESET TO DISPATCH      @Y17XADA 63998100
         MVI   TRC+ONE,F0               RESET POST TRACE       @Y17XADA 63998200
         MVC   ASYNCBAL+TWO(TWO),NCHAIN RESET TO CHAIN         @Y17XADA 63998300
TESTEND  EQU   *                                               @Y17XADA 63998400
         LTR   RQCB,RQCB                INITIAL ENTRY          @Y17XADA 63998500
         BNZ   FREEUNIT                 NO , FREE UNIT         @Y17XADA 63998600
         BAL   RETURN,DSPCHAIN          YES , BEGIN PROCESSING @Y17XADA 63998700
FREEUNIT EQU   *                                               @Y17XADA 63998800
         LA    RQCB,AVTBFRTB            BUFFER RETURN QCB ADDR @Y17XADA 63998900
         ST    RQCB,RECBQCBA-1          INITILIZE ELEMENT      @Y17XADA 63999000
         MVI   RECBPRI,PRIBFRTB         SET PRIORITY           @Y17XADA 63999100
         USING IEDQPRF,RRECB            USING BUFFER DSECT     @Y17XADA 63999200
         MVI   PRFNBUNT,ONE             INITILIZE COUNT TO 1   @Y17XADA 63999300
         BAL   RETURN,DSPPOST           POST TO BUFFER RETURN  @Y17XADA 63999400
         EJECT                                                          63999700
POSTR14  DS    F                        ENTRY ADDRESS TO POST  @Y17XADA 64000000
SAVERET  DS    0F                       SAVE AREA FOR REG 14   @Y17XADA 64092800
SAVERETX DS    CL1                      LIST OR CHAIN ENTRY    @Y17XADA 64093200
ENTRY    DC    AL3(0)                   POST ENTRY ADDRESS     @Y17XADA 64093600
SAVEREGS DS    4F                       SAVE AREA REGS 2 - 5   @Y17XADA 64094400
SAVE14   DS    F                        SAVE AREA REG 14       @Y17XADA 64094600
SAVE15   DS    F                        SAVE AREA REG 15       @Y17XADA 64094800
         SPACE 3                                               @Y17XADA 64095200
NLIST    DC    S(LIST)                  BASE + DISP OF LIST    @Y17XADA 64095300
NCHAIN   DC    S(CHAIN)                 BASE + DISP OF CHAIN   @Y17XADA 64095400
NPOST    DC    S(POST)                  BASE + DISP OF POST    @Y17XADA 64095500
NDISP    DC    S(DISPATCH)              BASE + DISP OF DISPATCH@Y17XADA 64095600
TLIST    DC    S(TRLIST)                BASE + DISP OF TRLIST  @Y17XADA 64095700
TCHAIN   DC    S(TRCHAIN)               BASE + DISP OF TRCAHIN @Y17XADA 64095800
TPOST    DC    S(TRPOST)                BASE + DISP OF TRPOST  @Y17XADA 64095900
TDISP    DC    S(TRDISP)                BASE + DISP OF TRDISP  @Y17XADA 64096000
         SPACE 3                                               @Y17XADA 64096100
ASYNCMER DC    AL3(ASYNCRET)            RETURN ASYNC MERGE RTN @Y17XADA 64096200
POSTRET  DC    AL3(TRDISP)              RETURN POST RTN        @Y17XADA 64096300
         SPACE 3                                               @Y17XADA 64096400
F0       EQU   240                      X'F0' INDICATOR        @Y17XADA 64096500
FE       EQU   254                      X'FE' INDICATOR        @Y17XADA 64096600
FF       EQU   255                      X'FF' INDICATOR        @Y17XADA 64096800
TIC      EQU   8                        X'08' TIC TEST 1       @Y17XADA 64096900
NOTTIC   EQU   X'17'                    X'17' TIC TEST 2       @Y17XADA 64097000
         SPACE 2                                                        64097100
BAL      DC    X'45F0'                  BAL   RENTRY           @Y17XADA 64097200
NOP      DC    X'4700'                  NOP   RENTRY           @Y17XADA 64097300
         EJECT                                                          64097400
NINDEX   EQU   *                                               @Y17XADA 64097500
         DC    AL2(ATTPOST-ROUTINES)  2 - POST ATTACHED TASK   @Y17XADA 64097600
         DC    AL2(MCP2-ROUTINES)     4 - ACTIVATE 2-BYTE STCB @Y17XADA 64097700
         DC    AL2(MCP4-ROUTINES)     6 - ACTIVATE 4-BYTE STCB @Y17XADA 64097800
         DC    AL2(MCP6-ROUTINES)     8 - ACTIVATE 6-BYTE STCB @Y17XADA 64097900
         DC    AL2(MCP8-ROUTINES)    10 - ACTIVATE 8-BYTE STCB @Y17XADA 64098000
TINDEX   EQU   *                                               @Y17XADA 64098100
         DC    AL2(TATTPOST-ROUTINES) 2 - POST ATTACHED TASK   @Y17XADA 64098200
         DC    AL2(TMCP2-ROUTINES)    4 - ACTIVATE 2-BYTE STCB @Y17XADA 64098300
         DC    AL2(TMCP4-ROUTINES)    6 - ACTIVATE 4-BYTE STCB @Y17XADA 64098400
         DC    AL2(TMCP6-ROUTINES)    8 - ACTIVATE 6-BYTE STCB @Y17XADA 64098500
         DC    AL2(TMCP8-ROUTINES)   10 - ACTIVATE 8-BYTE STCB @Y17XADA 64098600
         SPACE 3                                               @Y17XADA 64098800
SENTRY   DSECT                          TRACE TABLE ENTRY               64100020
STEPRI   DS    0FL1                     ELEMENT PRIORITY                64200020
STRECB   DS    F .                      ELEMENT ADDRESS                 64300020
STEPALL  DS    0CL12                    REG14 REG12 & REG15    @Y17XADA 64320000
STEPA    DS    0FL4                     ENTRY ADDRESS          @Y17XADA 64360000
STEPFE   DS    CL1                      HIGH ORDER BYTE        @Y17XADA 64400000
STRET    DS    CL3                      SUBTASK RETURN ADDRESS @Y17XADA 64450000
STQDSFLG DS    0FL1                     QCB FLAG BYTE                   64500020
STQCB    DS    F .                      QCB ADDRESS                     64600020
STSTCB   DS    0FL4                     STCB ADDRESS           @Y17XADA 64700000
STMCPL   DS    CL1                      VECTOR TABLE OFFSET    @Y17XADA 64760000
STSTLCB  DS    CL3                      LCB ADDRESS STSTFE=FE  @Y17XADA 64830000
ENLEN    EQU   16 .                     TRACE TABLE ENTRY LENGTH        64900020
         SPACE 4                                                        65000020
TABCB    DSECT                          TRACE TABLE CONTROL BLOCK       65100020
SCURRENT DS    A                        ADDRESS OF CURRENT ENTRY        65200020
SFIRST   DS    A                        ADDRESS OF FIRST ENTRY          65300020
SLAST    DS    A                        ADDRESS OF LAST ENTRY           65400020
         EJECT                                                          65500020
         TAVTD                          DSECT AVT              @Y17XADA 65600000
         EJECT                                                          65700020
CVTMAP   CVT                            DSECT CVT              @Y17XADA 65800000
         EJECT                                                          65900020
         TPRFD                          DSECT BUFFER           @Y17XADA 66000000
         EJECT                                                          66100020
         TPRIOR                         DSECT PRIORITY         @Y17XADA 66110000
         EJECT                                                 @G36XRDV 66113000
         IHAPSA                                                @G36XRDV 66116000
         EJECT                                                          66120000
         TQCBD                          DSECT QCB              @Y17XADA 66130000
         EJECT                                                          66220000
         TRECBD                         DSECT RECB             @Y17XADA 66240000
RECBELAD DS    XL4                      ADDRESS ELEMENT POSTED @OY19395 66246000
*                                       TO OPERATOR CONTROL    @OY19395 66252000
         EJECT                                                          66260000
         TSTCBD                         DSECT STCB             @Y17XADA 66280000
         EJECT                                                          66283000
         TTCXD                          DSECT TCX              @Y17XADA 66286000
         END                                                            66300020
