RP       TITLE '''IGG019RP'' - REUSABILITY SUBTASK'              S21903 00050022
         SPACE 1                                                        00050122
         MACRO                                                          00070022
         REUSPOOL &K                                                    00100021
.* &K IS NUMBER OF PAIRS OF LCB + SCB TO BE GENERATED                   00150021
         LCLA  &CNT                                                     00200021
&CNT     SETA  &K                                                       00250021
*                                                                       00300021
* FREEPOOL OF ELEMENTS TO SERVICE A TERMINAL NAME TABLE ENTRY.          00350021
* ELEMENTS ARE A PAIR OF BLOCKS, AN LCB WITH AN SCB ATTACHED.           00400021
*                                                                       00450021
         DS    0F .                     WORD BOUNDARY                   00500021
POOLCB   DC    AL1(0) .                 COUNT OF ACTIVE ELE NOT IN POOL 00550021
         DC    AL3(*+3) .               ADDR OF FIRST LCB IN POOL,      00600021
*                                         ZERO IF POOL EMPTY            00650021
.AGN     ANOP                                                           00700021
*                                                                       00750021
*                       LCB                                             00800021
         DC    AL1(&CNT) .                 LCB ID                       00850021
         DC    AL3(*-1) .               LCB TO BE POSTED TO ITSELF      00900021
&CNT     SETA  &CNT-1                   DECREMENT COUNT OF ELEMENTS     00950021
         AIF   (&CNT LT 1).LNKZ                                         01000021
         DC    A(*+232) .               ADDR OF NEXT LCB IN POOL        01050021
         AGO   .SKP                                                     01100021
.LNKZ    DC    A(0) .                   ZERO LINK, LAST LCB IN POOL     01150021
.SKP     ANOP                                                           01200021
         DC    21A(0) .                 LCB PROPER                      01250021
         DC    A(*+60) .                LCBSCBA POINTS TO SCB           01300021
         DC    14A(0) .                 REST OF LCB                     01350021
*                       SCB                                             01400021
         DC    21A(0) .                 SCB BELONGING TO THIS LCB       01450021
         AIF   (&CNT GT 0).AGN                                          01500021
*                                                                       01550021
*                       END OF LCB-SCB FREEPOOL                         01600021
*                                                                       01650021
         MEND                                                           01700021
         SPACE 3                                                        01700122
IGG019RP CSECT                                                        * 01710100
         SPACE 3                                                      * 01720100
******************** MICROFICHE FLAGS **********************  SUPT CODE 01730100
*CHANGE ACTIVITY AS FOLLOWS:                                          * 01740100
*A000000-999999                                                @Y17XARX 01750100
*A798000,859500                                                  S22029 01810022
*C144500,409360                                                  A47133 01810122
*A120000,334500,335000,371500,382000,501500,514000,540000,555500SA52971 01810222
*A567000,568000,659000,705000,771500,859000                     SA52971 01810322
*C050500-052000,093500-098000,119000,267500,288500,290500,302000SA52971 01810422
*C313000-313500,317500-332500,333200,333500,334500,337000-341500SA52971 01810522
*C343000-345000,351500-371000,375500-376400,415000-459500       SA52971 01810622
*C478250-478256,478270,518000-518500,520500-522000,523000-525000SA52971 01810722
*C541000,603500-603700,640500-641100,665500,686500-687100       SA52971 01810822
*C858000-858500,868000-869500                                   SA52971 01810922
*D346000-350000,405500,408520-408920,409060-409500,410500-411000SA52971 01811022
*D478000,478170-478200,516500-517000,526000-526500,527500-528500SA52971 01811122
*D544500-547000,558000-558500,565000-565500,571500,605000       SA52971 01811222
*D643500-654500,663000-663500,698500-703000,773500-774000       SA52971 01811322
*C706000-709000,759000-759600,776000-794500,832000-836000,851000SA52971 01811422
*D819500-823500                                                 SA52971 01811522
*D070000-070500                                                  S21903 01811622
*A070000                                                         S21903 01811722
*A037100-037400,040100-040400,042030-042450,066100-066200       SA51783 01811822
*C107000,112000                                                 SA51783 01811922
*A114100-114200                                                 SA51783 01812022
*D343500-343800                                                 SA51783 01812122
*A356250-356350                                                 SA51783 01812222
*D357600-357800                                                 SA51783 01812322
*A358320-358500                                                 SA51783 01812422
*D362000                                                        SA51783 01812522
*A362000-362320,362550-362950,364600-364900                     SA51783 01812622
*D371900-372100                                                 SA51783 01812722
*A373160-373220                                                 SA51783 01812822
*D375500-375660                                                 SA51783 01812922
*A375120-375660                                                 SA51783 01813022
*D375720-376250                                                 SA51783 01813122
*A375720-376160,378070-378420                                   SA51783 01813222
*D384200-384600                                                 SA51783 01813322
*D409030                                                        SA51783 01813422
*A409030-409430                                                 SA51783 01813522
*C413500                                                        SA51783 01813622
*A739070-739420                                                 SA51783 01813722
*D742070-742420                                                 SA51783 01813822
*D837000-839500                                                 SA51783 01813922
*A836960-839480,845940-845960,863600-863800                     SA51783 01814022
*A357010-357150                                                 SA58992 01814122
*A138500,352900,863000                                         SA63961  01814252
*A 472000                                                        S21903 01814352
*D 472300,472520-472620                                          S21903 01814452
*C845590                                                        SA59961 01824122
*D336000,336500                                                 SA61811 01824222
*A336000-336600,375501-375512                                   SA61811 01824322
*C273000,538500,812500-813000                                   SA61768 01824400
*C219000                                                        SA65862 01824554
*A712000                                                        OX02207 01824654
*C714700-716000                                                 OX02207 01824754
*D719320                                                        OX02207 01824854
*C024920                                                         X03039 01824907
*D218650,218950                                                  X03039 01825007
*A353072                                                       @SA64353 01825356
*C358380,358400                                                @SA70208 01825856
*D715600                                                       @SA70208 01826356
*A271500                                                       @XA06353 01826856
*A353064                                                       @SA74235 01828809
*C353024-353028                                                @SA74235 01830809
*D353004                                                       @SA74235 01832809
*A189500                                                       @SA69999 01834809
*C191500-194000,293000-293500,352980-352992,353084-353100      @SA69999 01836809
*C356400-357000,357100-357130                                  @SA69999 01838809
*A353020                                                     * @SA75126 01839400
*D353072                                                     * @SA75126 01840000
*C353200                                                     * @OS76478 01840800
*C845560-845590                                              * @OY11984 01841300
*A845680                                                     * @OY11984 01841800
*C271800                                                     * @OS76714 01842300
*A275500,138700                                              * @OS76714 01843000
*C353024-353044                                              * @OS76987 01843100
*C024500,024920,247000                                         @Y17XARX 01844100
*D023500                                                       @Y17XARX 01845100
*A124000,353140                                                @OS77008 01846700
*D192300-193900                                                @OS77008 01847100
*A194500,845500                                                @OS77388 01847500
*C292000,293000-293700,352952-352996,356480-356520             @OS77388 01847900
*C356600-356850,357106-357112-357124                           @OS77388 01848300
*D353084-353250,356950                                         @OS77388 01848700
*C845560                                                       @OS77826 01849100
         SPACE 3                                                        01850022
*********************************************************************** 01850122
* THIS ENTIRE MODULE HAS BEEN REWRITTEN, DIFFERING FROM THE      S21101 01900021
* FIRST RELEASE.  WHEREAS THE PREVIOUS VERSION USED ONE CPB TO   S21101 01950021
* DO ALL REUSABILITY PROCESSING, THIS VERSION ACTS MORE LIKE A   S21101 02000021
* GET OR PUT SCHEDULER IN THAT DISK I/O IS DONE BY POSTING ERBS  S21101 02050021
* AND BUFFERS.  SEVERAL QUEUES ALSO MAY BE SERVICED              S21101 02100021
* SIMULTANEOUSLY INSTEAD OF JUST ONE AT A TIME AS DONE BY THE    S21101 02150021
* PREVIOUS VERSION.                                              S21101 02200021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02250021
*                                                                     * 02400021
*  MODULE NAME = IGG019RP (TCAM, QMANAGER)                     @Y17XARX 02450000
*                                                                     * 02457000
*  DESCRIPTIVE NAME = REUSABILITY / COPY SUBTASK                      * 02464000
*                                                                     * 02471000
*  COPYRIGHT = 'NONE'                                                 * 02478000
*                                                                     * 02485000
*  STATUS = VERSION 10.0                                       @Y17XARX 02492000
*                                                                     * 02500021
*FUNCTION -- THIS MODULE IS TO MAKE THE DISK DATA SET DEFINED AS      * 02550021
*   REUSABLE ACTUALLY REUSABLE BY PERFORMING PERIODICALLY TWO         * 02600021
*   FUNCTIONS,(1) MOVING UNUSED HEADERS INTO CURRENT ZONE BY          * 02650021
*   SENDING A CANCELLED HEADER TO OLD HEADER, (2) COPYING UNSENT      * 02700021
*   MESSAGES INTO THE CURRENT ZONE AND ENQUEUEING THEM FOR            * 02750021
*   TRANSMISSION TO AN ALTERNATE DESTINATION.                         * 02800021
*                                                                     * 02850021
*   THE COPY SUBTASK IS ACTIVATED TO COPY A MESSAGE FROM ONE          * 02900021
*   QUEUE MEDIUM TO ANOTHER.  THIS IS DONE WHENEVER TWO RECEIVERS     * 02950021
*   HAVE THEIR QUEUE ON TWO DIFFERENT QUEUE MEDIA, OR WHEN            * 03000021
*   MULTIPLE HEADER MESSAGES WOULD HAVE SECONDARY HEADER(S) IN        * 03050021
*   A ZONE DIFFERENT FROM TEXT RECORDS.                               * 03100021
*                                                                     * 03150021
*ENTRY POINTS -- THERE IS ONLY ONE DEFINED ENTRY POINT, IGG019RP,     * 03200021
*   BUT THERE ARE SEVERAL OTHER LOGICAL ENTRY POINTS -                * 03250021
*                                                                     * 03300021
*        'REUSQCB' QCB IS POSTED TO ITSELF BY IEDQHM TO ACTIVATE      * 03350021
*   REUSABILITY SERVICING WHENEVER AVTRADDR PASSES AVTLODPT.          * 03400021
*   CALLING SEQUENCE --                                               * 03450021
*        L     1,AVTIA                  POST REUS QCB TO ITSELF       * 03500021
*        BAL   14,DSPPOSTR                                            * 03550021
*                                                                     * 03600021
*        'WRITQCB' - QCB POINTED TO BY LCB WHICH IS POSTED BY         * 03650021
*   REUS TO ITSELF AFTER POSTING BUFFER TO BE WRITTEN.                * 03700021
*   ALSO, QCB TO WHICH ERB IS POSTED AFTER A CANCELLED          SA51783 03710022
*   HEADER HAS BEEN WRITTEN IN THE CURRENT ZONE AND SET AS      SA51783 03720022
*   PFEFO TO INSURE THAT AT LEAST ONE MESSAGE IN THE FEFO       SA51783 03730022
*   CHAIN IS IN A GOOD ZONE.                                    SA51783 03740022
*                                                                     * 03750021
*        'READONE' - QCB TO WHICH ERB IS POSTED WHEN A READ IS DONE.  * 03800021
*   LCB HAS BUFFER(S) JUST READ CHAINED ONTO LCBERBCH.                * 03850021
*                                                                     * 03900021
*        'UNITQCB' - QCB TO WHICH ERB IS POSTED WHEN A REQUESTED      * 03950021
*   UNIT BECOMES AVAILABLE FROM THE AVAILABLE BUFFER POOL.            * 04000021
*   ALSO, QCB TO WHICH ERB IS POSTED AFTER A FEFO POINTER       SA51783 04010022
*   HAS BEEN UPDATED TO REMOVE A MESSAGE IN A BAD ZONE          SA51783 04020022
*   FROM THE FEFO CHAIN.                                        SA51783 04030022
*                                                               SA51783 04040022
*                                                                     * 04050021
*        'COPY' - QCB TO WHICH BUFFER IS POSTED TO BE COPIED FROM     * 04100021
*   ONE QUEUE TO ANOTHER.                                             * 04150021
*                                                                     * 04200021
*        'NEWPFEFO' - IS A SUBROUTINE BRANCHED TO OUT OF        SA51783 04203022
*   IEDQFA AFTER AN 'EE' REQUEST FOR A CPB BY REUSABILITY.      SA51783 04206022
*   THIS SUBROUTINE BUILDS THE CPB PASSED TO IT BY IEDQFA       SA51783 04209022
*   TO WRITE A CANCELLED HEADER AT THE DNHDR SLOT.  THE         SA51783 04212022
*   CANCELLED HEADER IS MADE PFEFO AND ITS FEFO POINTER         SA51783 04215022
*   IS SET TO POINT TO THE ORIGINAL PFEFO THAT WAS FOUND IN     SA51783 04218022
*   A BAD ZONE.  THIS WILL INSURE THAT THERE EXISTS AT LEAST    SA51783 04221022
*   ONE MESSAGE IN THE FEFO CHAIN THAT IS IN A GOOD ZONE.       SA51783 04224022
*                                                               SA51783 04227022
*        'UPFEFO' - IS A SUBROUTINE BRANCHED TO OUT OF IEDQFA   SA51783 04230022
*   AFTER AN 'EE' REQUEST FOR A CPB BY REUSABILITY.  THIS       SA51783 04233022
*   SUBROUTINE BUILDS THE CPB PASSED TO IT FROM IEDQFA          SA51783 04236022
*   TO UPDATE A FEFO POINTER TO REMOVE A MESSAGE IN A BAD       SA51783 04239022
*   ZONE FROM A FEFO CHAIN.                                     SA51783 04242022
*                                                               SA51783 04245022
*INPUT -- CERTAIN REGISTERS ARE EXPECTED TO BE SET BY THE DISPATCHER  * 04250021
*   R13 ADDRESS OF AVTSAVE2                                           * 04300021
*   R11 ADDRESS OF DISPATCHER                                         * 04350021
*   R1  ADDRESS OF POSTED ELEMENT                                     * 04400021
*                                                                     * 04450021
*OUTPUT -- WHEN REUS EXITS TO DISPATCHER TO 'DSPCHAIN',               * 04500021
*   R1 HAS ADDRESS OF FIRST OF A CHAIN OF ELEMENTS TO BE TPOSTED,     * 04550021
*        OR ZERO IF NOTHING IS TO BE TPOSTED.                         * 04600021
*   R13 HAS ADDRESS OF AVTSAVE2.                                      * 04650021
*   R11 HAS DISPATCHER BASE FROM AVTEA.                               * 04700021
*                                                                     * 04750021
*EXTERNAL ROUTINES -- SEVERAL SUBROUTINES ARE USED.                   * 04800021
*        'IEDQHG02' - TIME DELAY (DELINK FUNCTION)                    * 04850021
*   WHEN REUS FINISHES, IT GETS THE CHECKPOINT ELEMENT OFF TIME       * 04900021
*   DELAY QUEUE AND POSTS IT TO ACTIVATE CHECKPOINT.                  * 04950021
*                                                                     * 05000021
*        'IEDQHM03' - ANSWERS THE QUESTION, IS THE CURRENT      SA52971 05050022
*   MESSAGE BEING SENT, AND/OR IF SO, UPDATES THE FIELD(S)      SA52971 05100022
*   IN WHICH THE FEFO POINTER IS SAVED.  ADDRESS OF HM03 ENTRY  SA52971 05150022
*   IS ONE WORD IN IEDQHM, JUST BEFORE THE IEDQHM02 ENTRY POINT.SA52971 05200022
*                                                                     * 05250021
*        'IEDQTNT' - TERMNAME TABLE LOOKUP ROUTINE - CONVERTS THE     * 05300021
*   INDEX TO THE TERMNAME TABLE INTO THE ADDRESS OF THE               * 05350021
*   CORRESPONDING TERMINAL TABLE ENTRY.                               * 05400021
*                                                                     * 05450021
*        'POST' (SVC 2) WHEN REUS FINISHES SERVICING A ZONE,          * 05500021
*   THE OS 'POST' MACRO IS ISSUED TO ACTIVATE OPERATOR CONTROL        * 05550021
*   IN CASE CLOSEDOWN IS WAITING FOR REUS TO QUIT.                    * 05600021
*                                                                     * 05650021
*EXIT-NORMAL -- RETURN TO DISPATCHER AT DSPCHAIN WITH R1 HAVING       * 05700021
*   ADDRESS OF A CHAIN OF ELEMENTS TO BE POSTED.                      * 05750021
*                                                                     * 05800021
*EXIT-ERROR -- WHEN AN ERB IS RECEIVED FOLLOWING A READ REQUEST,      * 05850021
*   IF THE READ RESULTED IN A LOGICAL READ ERROR, INDICATED BY        * 05900021
*   ZERO IN LCBERBCH, REUS ABENDS TCAM WITH S045, REG 15 HAS 2.       * 05950021
*                                                                     * 06000021
*TABLES/WORKAREAS -- DSECTS ARE MACRO GENERATED,                      * 06050021
*   TAVTD                                                             * 06100021
*   TSCBD                                                             * 06150021
*   TRECBD                                                            * 06200021
*   TTRMD                                                             * 06250021
*   TPRFD                                                             * 06300021
*   TPRIOR                                                            * 06350021
*   TDISPD                                                            * 06400021
*   TTNTD                                                             * 06450021
*   TQCBD                                                             * 06500021
*   TLCBD                                                             * 06550021
*   DCBD                                                              * 06600021
*   TCPBD 3330                                                  SA51783 06610022
*   TDATAD                                                      SA51783 06620022
*                                                                     * 06650021
*   TO LET REUS SERVICE MORE THAN ONE QUEUE AT A TIME, A DUMMY        * 06700021
*   LCB/SCB PAIR IS GENERATED FOR EACH SIMULTANEOUSLY PROCESSED       * 06750021
*   QCB.  PART OF THE LCB, STARTING AT LCBSNSV IS USED AS A LOCAL     * 06800021
*   WORKAREA SHOWING STATUS OF SERVICING ON THIS QUEUE.  THE          * 06850021
*   NUMBER OF QUEUES THAT CAN BE SIMULTANEOUSLY SERVICED IS THE       * 06900021
*   OPERAND ON THE 'REUSPOOL' MACRO STATEMENT IN CONSTANTS AREA       * 06950021
*   AT THE END OF THE MODULE.                                    S21903 07000022
*                                                                     * 07051021
* THIS ROUTINE USES CERTAIN FIELDS TO TEMPORARILY SAVE FIELDS IN      * 07052021
* PLACES THAT WERE NOT ORIGINALLY INTENDED FOR THIS PURPOSE.          * 07053021
*   1. FOR BOTH REUS AND COPY, A PORTION OF THE LCB IS REDEFINED      * 07054021
*        AS A LOCAL WORKAREA.  SEE LOCAL ADDITION TO LCB DSECT.       * 07055021
*   2. LCBSTART AND SCBDNSEG ARE SWAPPED BEFORE AND AFTER A READ.     * 07056021
*        THIS IS DONE BECAUSE THE SAME SCB IS USED TO RECALL A        * 07057021
*        BUFFER FROM THE SOURCE AND TO POST THAT BUFFER TO ITS        * 07058021
*        DESTINATION.  SEE TAG 'SWAP'.                                * 07059021
*   3. IN COPY, THE ORIGINAL BUFFER POSTED TO COPY IS MODIFIED        * 07060021
*        IF THE SOURCE QUEUE IS CORE ONLY.                            * 07061021
*        A. 'PRFNTXT' IS CHANGED TO HAVE THE PRFNTXT FROM THE         * 07062021
*              ORIGINAL HEADER STILL ON CORE Q.  SEE TAG 'SNDCORE'.   * 07063021
*        B. 'PRFCRCD' IS CHANGED TO POINT TO THE FIRST XTRA UNIT      * 07064021
*              OF THE HEADER BUFFER STILL ON CORE Q, AS MOVED         * 07065021
*              FROM THE TIC FIELD OF THE CORE QUEUED HEADER.          * 07066021
*              SEE TAG 'SNDCORE'.                                     * 07067021
*   4. IN COPY, THE ORIGINAL BUFFER POSTED TO COPY IS MODIFIED        * 07068021
*        REGARDLESS OF THE SOURCE QTYPE.                              * 07069021
*        A. 'PRFLINK' SAVES CONTENTS OF SCBDEOB+1, WHICH IS WHERE     * 07070021
*              MULTIPLE ROUTE WILL DO ITS NEXT RECALL.                * 07071021
*              SEE TAGS 'DISKRECL' AND 'CLEANCPY'.                    * 07072021
*        B. 'PRFQCBA' SAVES SCBSCHDR.  SEE TAG 'GOTCOPY'.  IF REUS    * 07073021
*              AND NOT COPY, SCBSCHDR IS SAVED IN WORKAREA            * 07074021
*              'SAVSCHDR' INSTEAD.  THIS CHOICE MADE AT TAG 'SWAP'.   * 07075021
*   5. IN COPY, 'LCBRECAD' IS USED TO SAVE LCBERBCH FOR MULTIPLE      * 07076021
*        ROUTE.  SEE TAGS 'DISKRECL' AND 'CLEANCPY'.                  * 07077021
*                                                                     * 07078021
*                                                                     * 07100021
*ATTRIBUTES -- REUSABLE, NON-REFRESHABLE, ENABLED, PROBLEM            * 07150021
*   PROGRAM MODE.                                                     * 07200021
*                                                                     * 07250021
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A PAR-    * 07300021
*   TICULAR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER SET.    * 07350021
*                                                                     * 07400021
*   THE COPY QCB IS FOUND BY OPEN BY A FULLWORD OFFSET AT THE         * 07450021
*   START OF THE MODULE POINTING IN TO THE COPY SUBTASK.              * 07500021
*                                                                     * 07550021
*   THE 'REUSABILITY' FUNCTION -- THE USER SPECIFIED 'QUEUES=DR'      * 07600021
*   (OR 'MR') ON THE TERMINAL (OR TPROCESS OR LOGTYPE) MACRO, AND     * 07650021
*   'OPTCD=R' ON THE DCB DEFINING THE REUSABLE DISK MESSAGE QUEUE     * 07700021
*   DATA SET.  THIS DISK DATA SET IS LOGICALLY DIVIDED INTO 4         * 07750021
*   ZONES.  WHEN DESTINATION ASSIGNMENT 'IEDQHM' FINDS THAT THE       * 07800021
*   VALUE IN AVTRADDR HAS PASSED AVTLODPT, IT POSTS THE REUS QCB      * 07850021
*   TO ITSELF TO ACTIVATE REUSABILITY.  THIS ACTIVATION OCCURS        * 07900021
*   AT MID-ZONE.  TO SEE HOW ZONES ARE USED, ASSUME ZONES ARE         * 07950021
*   CALLED A,B,C, AND D.  'REUS' IS CALLED WHEN AVTRADDR REACHES      * 08000021
*   MIDZONE OF 'D'.  AVTLODPT IS BUMPED TO MIDPOINT OF NEXT ZONE,     * 08050021
*   'A'.  REUS DOES (1) SENDS CANCELLED HEADER TO ALL UNUSED          * 08100021
*   HEADERS IN ZONE 'C' AND REASSIGNS NEW UNUSED HEADER TO ZONE       * 08150021
*   'D' AND (2) COPIES ALL UNSENT MESSAGES WHOSE HEADERS ARE IN       * 08200021
*   ZONE 'B' TO CURRENT ZONE 'D' AND ENQUEUES THEM TO THE             * 08250021
*   ALTERNATE DESTINATION.                                            * 08300021
*                                                                     * 08350021
*   REUS CAN CAUSE A 'SLOWDOWN' WHICH IS A CESSATION OF ALL           * 08400021
*   POLLING BY TURNING ON THE 'REUS DISK IS FULL' BIT (AVTBIT3,       * 08450021
*   X'40').  TCAM WILL ONLY SEND UNTIL REUS CLEARS THIS BIT.          * 08500021
*   REUS STARTS 'SLOWDOWN' WHENEVER IEDQHM POSTS THE REUS QCB TO      * 08550021
*   REQUEST A ZONE TO BE SERVICED, BUT REUS FINDS THAT REUS IS        * 08600021
*   ALREADY RUNNING, SO REUS REQUESTS 'SLOWDOWN' AND SETS 'REUS       * 08650021
*   FIRST TIME SWITCH' SO WHEN CURRENT ZONE IS FINALLY CLEANED        * 08700021
*   UP, THE 'FIRST TIME BIT' WILL INDICATE A NEED TO START            * 08750021
*   IMMEDIATELY ON THE NEXT ZONE.  THE 'SLOWDOWN' STAYS IN EFFECT     * 08800021
*   UNTIL REUS COMPLETES SERVICING ON ALL REQUESTED ZONES.            * 08850021
*                                                                     * 08900021
*   DEFINITION - 'SOURCE', AS USED IN COMMENTS IN THIS MODULE, IS     * 08950021
*   REFERRING TO THE ORIGINAL DESTINATION OF A MESSAGE.  REUS         * 09000021
*   READS THE MESSAGE FROM THE 'SOURCE' QCB AND ENQUEUES IT TO        * 09050021
*   THE 'DESTINATION' QCB (AS SPECIFIED BY ALTDEST KEYWORD ON         * 09100021
*   'SOURCE' QCB)                                                     * 09150021
*                                                                     * 09200021
*   REGISTERS FOR QCB DSECT - THERE ARE 3 REGS DEFINED FOR QCB--      * 09250021
*   RQCBSM (SOURCE MASTER), RQCBSP (SOURCE PRIORITY), AND RQCBD       * 09300021
*   (ALTDEST MASTER).  THE USING STATEMENTS USE RQCBSM AS THE   SA52971 09350022
*   STANDARD MASTER QCB DSECT BASE AND RQCBSP AS THE STANDARD   SA52971 09450022
*   PRIORITY LEVEL QCB DSECT BASE.  IF THE FIELD IS BEING       SA52971 09550022
*   REFERENCED BY THE OTHER REGS, THE USING IS OVERRIDDEN, AND  SA52971 09650022
*   THE BASE IS EXPLICITLY DEFINED.                             SA52971 09750022
*                                                                     * 09850021
*   FIXED REGISTERS - RDISP (REG 11) AND RAVT (REG 13) ARE            * 09900021
*   EXPECTED SET AT ENTRY, WILL NEVER BE MODIFIED BY IGG019RP,        * 09950021
*   AND WILL REMAIN SO SET AT EXIT.                                   * 10000021
*                                                                     * 10050021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10100021
         EJECT                                                          10150021
*                       REGISTER USAGE                                  10200021
R15      EQU   15                       ENTRY ADDRESS, WORK REG         10250021
R14      EQU   14                       RETURN ADDRESS FROM             10300021
*                                         INTERNAL SUBROUTINES          10350021
R13      EQU   13                       SAVEAREA ADDRESS - AVTSAVE2     10400021
RAVT     EQU   13                       AVT DSECT BASE                  10450021
RBASE    EQU   12                       PROGRAM BASE                    10500021
R12      EQU   12                       TWELVE                   S22024 10550022
RDISP    EQU   11                       DISPATCHER BASE                 10600021
R11      EQU   11                       REG 11                   S22024 10650022
R10      EQU   10                       WORK REG IN CPB SUBRTNS SA51783 10700022
RQCBD    EQU   9                        DESTINATION MASTER QCB          10750021
R9       EQU   9                        REG 9                    S22024 10800022
RQCBSP   EQU   8                        SOURCE PRIORITY QCB             10850021
R8       EQU   8                        REG 8                    S22024 10900022
RQCBSM   EQU   7                        SOURCE MASTER QCB               10950021
*                                       QCB DSECT BASE                  11000021
R7       EQU   7                        REG 7                    S22024 11050022
RPREFIX  EQU   6                        BUFFER ADDRESS                  11100021
R6       EQU   6                        REG 6                    S22024 11150022
RCPB     EQU   5                        CPB ADDR IN CPB SUBRTNS SA51783 11200022
RLCB     EQU   4                        LCB ADDRESS                     11250021
R4       EQU   4                        REG 4                    S22024 11300022
RSCB     EQU   3                        SCB ADDRESS                     11350021
R3       EQU   3                        REG 3                    S22024 11400022
RDAT     EQU   2                        DATA FIELDS REG FOR CPB SA51783 11410022
*                                       SUBROUTINES             SA51783 11420022
R2       EQU   2                        TEMP SCB BASE, SET BY HM03      11450021
*                                       WORK REG                        11500021
*                                       ALTERNATE BUFFER ADDRESS        11550021
R1       EQU   1                        PARAMETER PASSER                11600021
*                                       TEMPORARY TERM TABLE ADDR       11650021
RTIME    EQU   1                        TIME STAMP WORK REG     SA52971 11670022
R0       EQU   0                        WORK REGISTER                   11700021
*                                                                       11750021
         USING REUSQCB,RBASE            ESTABLISH ADDRESSABILITY        11800021
         USING IEDQDISP,RDISP           DISPATCHER DSECT BASE           11850021
         USING    AVTSAVE2,RAVT         AVT DSECT BASE          SA52971 11900022
         USING IEDQPRF,RPREFIX          BUFFER DSECT BASE               11950021
         USING IEDQQCB,RQCBSM           QCB DSECT BASE                  12000021
         USING IEDQPQCB,RQCBSP          PRIORITY QCB DSECT BASE SA52971 12020022
         USING IEDQLCB,RLCB             LCB DSECT BASE                  12050021
         USING IEDQSCB,RSCB             SCB DSECT BASE                  12100021
         EJECT                                                          12150021
*                       EQUATES                                         12200021
*                                                                       12250021
BYFOUR   EQU   2                        DIVIDE BY 4 USING SHIFT         12300021
TAKEHALF EQU   1                        DIVIDE BY 2 USING SHIFT         12350021
ONE      EQU   1                        INCREMENTOR                     12400021
THREE    EQU   3                        CONSTANT               @OS77008 12420000
FOUR     EQU   4                        BYTES PER WORD                  12450021
TESTLOG  EQU   X'60'                    LOGTYPE ENTRY IN                12600021
*                                         TERMINAL TABLE                12650021
PROSING  EQU   X'C0'                    BOTH BITS IN SINGLE OR          12700021
*                                         PROCESS Q IN 'TRMSTATE'       12750021
QTYPE    EQU   X'03'                    LOW 2 BITS OF UNIT ADDR         12800021
*                                         DETERMINE Q TYPE              12850021
*                                         X'03' - REUS                  12900021
*                                         X'01' - NON REUS              12950021
*                                         X'00' - CORE                  13000021
*                                         X'10' - RESERVED              13050021
DUMBUFOU EQU   2                        DEFAULT DCBBUFOU                13070021
HISREG3  EQU   32                       OFFSET INTO SAVEAREA OF R3      13100021
HISREG4  EQU   36                       OFFSET INTO SAVEAREA OF R4      13150021
HMBASE   EQU   6                        OFFSET PAST V(HM) OF HM BASE    13200021
TIC      EQU   X'08'                    TIC CCW OP CODE                 13250021
TOGGLE   EQU   X'F0'                    TOGGLES CONDITIONAL BRANCH      13300021
X0101    EQU   X'0101'                  REQUESTS ONE SINGLE UNIT BUF    13350021
CHAR     EQU   C'C'                     FILL CHAR FOR CANCELLED HEADERS 13400021
ABEND2   EQU   2                        ABEND S045 SUBCODE IN R15       13450021
*                                         FOR REUS LOGICAL READ ERROR   13500021
X0F      EQU   X'0F'                    BUFOUT MASK IN DCB              13550021
*                                                                       13600021
*                                       CONDITION CODES                 13650021
NZ       EQU   7                        NON-ZERO                        13700021
Z        EQU   8                        ZERO                            13750021
ALWAYS   EQU   X'F0'                    MAKES BRANCH UNCONDITIONAL      13800021
NEVER    EQU   X'00'                    MAKES BRANCH NO-OP              13850021
BYTWO    EQU   1                        DIVIDE BY TWO          SA63961  13870052
         EJECT                                                          13900021
         DC    A(COPY-*)                OFFSET TO COPY QCB, USED        13950021
*                                         BY OPEN                       14000021
*                                                                       14050021
REUSQCB  DC    A(*)                     REUSABILITY QCB, POSTED TO      14100021
         DC    AL1(PRIREUSX),AL3(0)       ITSELF BY IEDQHM WHEN IT      14150021
*                                         FINDS THAT AVTRADDR           14200021
*                                         REACHES AVTLODPT              14250021
         DC    A(REUSSTCB)              ADDRESS OF STCB                 14300021
*                                                                       14350021
IGG019RP IEDHJN ,                       MODULE ID AND DATE       A50184 14400022
*                                                                       14500021
         DS    0H                       HALFWORD BOUNDARY               14550021
REUSSTCB DC    AL1(DSPMCPL2),AL1(0)     STCB                            14600021
*                                                                       14650021
* CONDITIONS AT ENTRY TO REUSABILITY                                    14700021
* R13 - ADDRESS OF AVTSAVE2                                             14750021
* R11 - ADDRESS OF DISPATCHER                                           14800021
* R1  - ADDRESS OF REUS QCB                                             14850021
*                                                                       14900021
         LR    RBASE,R1                 SET PROGRAM BASE TO VALUE       14950021
*                                         FOUND IN AVTIA.               15000021
*                                       HERE SET SINCE REUS QCB         15050021
*                                         IS POSTED TO ITSELF           15100021
         TM    AVTBIT2,AVTREUSN         IS REUS ALREADY RUNNING         15150021
         BZ    FIRSTIME                   NO, NOT RUNNING YET           15200021
*                                         YES, ALREADY RUNNING          15250021
         OI    FLAG,RUFTN               TURN ON REUS 1ST TIME SWITCH    15300021
         TM    AVTBIT3,AVTRFULN         IS SLOWDOWN ALREADY DONE        15350021
         BO    EXIT                       YES, QUIT                     15400021
*                                         NO, START SLOWDOWN            15450021
         MVC   NAMETAG(MLN),FULL        MOVE MESSAGE TAG        SA52971 15500022
         BAL   R14,WRTOP                DO WRITE TO OPERATOR    SA52971 15520022
*                                                                       15900021
*                                                                       15950021
* 'SLOWDOWN' MEANS STOP RECEIVING.  THIS IS RESULT OF REUS FINDING      16000021
* BOTH 'REUS IS RUNNING' BIT AND 'REUS FIRST TIME SWITCH' BITS ON.      16050021
         OI    AVTBIT3,AVTRFULN         TURN ON 'REUS IS FULL' BIT      16100021
*                                         TO REQUEST SLOWDOWN           16150021
*                                                                       16200021
EXIT     EQU   *                                                        16250021
         L     R1,POSTQ                 PICK UP CHAIN OF ELEMENTS       16300021
*                                         TO BE POSTED TO DISPATCHER    16350021
         XC    POSTQ+1(3),POSTQ+1       CLEAR POSTQ TO INDICATE         16400021
*                                         IT IS EMPTY                   16450021
         B     DSPCHAIN                 RETURN TO DISPATCHER,           16500021
*                                         PASSING IT A CHAIN OF ELE     16550021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 16600021
*                                                                       16650021
RFULF    EQU   *                                                        16700021
         TM    AVTBIT3,AVTRFULN         IS SLOWDOWN IN PROGRESS         16750021
         BZ    EXIT                       NO, QUIT                      16800021
*                                         YES, TERMINATE SLOWDOWN       16850021
         MVC   NAMETAG(MLN),END         MOVE MESSAGE TAG        SA52971 16900022
         BAL   R14,WRTOP                DO WRITE TO OPERATOR    SA52971 16920022
         NI    AVTBIT3,X'FF'-AVTRFULN   TURN OFF 'REUS IS FULL' BIT     17350021
         B     EXIT                     NOW QUIT                        17400021
*                                                                       17450021
CKFTS    EQU   *                                                        17500021
         TM    FLAG,RUFTN               IS 'REUS 1ST TIME SWITCH' SET   17550021
         BZ    RFULF                      NO, QUIT                      17600021
*                                         YES, CONTINUE                 17650021
FIRSTIME EQU   *                        'REUS FIRST TIME SWITCH' SET    17700021
         MVC   NAMETAG(MLN),START       MOVE MESSAGE TAG        SA52971 17750022
         BAL   R14,WRTOP                DO WRITE TO OPERATOR    SA52971 17770022
         NI    FLAG,X'FF'-RUFTN         CLEAR 1ST TIME SWITCH           18200021
         OI    AVTBIT2,AVTREUSN         SET 'REUS IS RUNNING' BIT       18250021
*                                                                       18300021
* CALCULATE ZONE ADDRESSES                                              18350021
*                                                                       18400021
         L     R15,AVTTOTNR             GET SIZE OF REUS DATA SET       18450021
         LR    R1,R15                   SAVE ZONESIZE IN R1             18500021
         SRL   R15,TAKEHALF             GET SIZE OF HALF A ZONE         18550021
         L     R14,AVTLODPT             GET CURRENT LOAD POINT          18600021
         SLL   R14,BYFOUR               ADJUST LOADPOINT                18650021
         SR    R14,R15                  BACK UP LOAD POINT HALF A       18700021
*                                         ZONE TO END OF 'CURRENT'      18750021
*                                         ZONE                          18800021
         SR    R14,R1                   BACK UP TO START OF             18850021
*                                         'CURRENT ZONE'                18900021
         ST    R14,BOUNDS3              SAVE START OF 'CURRENT ZONE'    18950021
         BNM   NOCLEAR                  BR ON NEG VALUE FOR    @SA69999 18958009
*                                        START OF CURRENT ZONE @SA69999 18966009
         XC    BOUNDS3,BOUNDS3          SET START OF 'CANCEL   @SA69999 18974009
*                                        ZONE' TO ZERO         @SA69999 18982009
NOCLEAR  EQU   *                                               @SA69999 18990009
         SR    R14,R1                   BACK UP TO START OF             19000021
*                                         'CANCEL ZONE'                 19050021
         ST    R14,BOUNDS2              SAVE START OF 'CANCEL ZONE'     19100021
         BNM   STAY                     NEGATIVE NUMBER MEANS  @SA69999 19150009
*                                        POSSIBLE RRN WRAP     @SA69999 19170009
         XC    BOUNDS2,BOUNDS2          SET START OF CURRENT   @OS77008 19200000
*                                        ZONE TO ZERO          @OS77008 19250000
STAY     EQU   *                        GET TERMNAME TABLE DESCRIPTION  19450021
         LR    R15,R1                   COPY ZONE SIZE         @OS77388 19451000
         LR    R14,R15                  COPY ZONE SIZE         @OS77388 19452000
         SRL   R14,BYTWO                OFFSET OF EIGHTH LOAD  @OS77388 19453000
*                                        POINT                 @OS77388 19454000
         SLL   R15,BYFOUR               DISK SIZE              @OS77388 19455000
BS45LOOP EQU   *                                               @OS77388 19456000
         AR    R14,R15                  BUMP BY DISK SIZE      @OS77388 19457000
         SLL   R14,BYTELEN              SHIFT FOR TEST         @OS77388 19458000
         LTR   R14,R14                  TEST FOR RADDR WRAPP   @OS77388 19459000
         SRL   R14,BYTELEN              MOVE LENGTH BACK       @OS77388 19460000
         BP    BS45LOOP                 NO, NOT RADDR WRAP     @OS77388 19461000
         LR    R15,R1                   COPY ZONE SIZE         @OS77388 19462000
         SRL   R15,BYTWO                GET LOAD POINT         @OS77388 19463000
         SR    R14,R15                  GET CURRENT WRAP ZONE  @OS77388 19464000
         NC    BOUNDS3,BOUNDS3          BOUNDS3 ZERO MEANS WRAP@OS77388 19465000
*                                        OF RADDR              @OS77388 19466000
         BNZ   SETBS45                  NO, NORMAL CASE        @OS77388 19467000
         ST    R14,BOUNDS5              SAVE CURRENT WRAP ZONE @OS77388 19468000
         SR    R14,R1                   GET CANCEL WRAP ZONE   @OS77388 19469000
         ST    R14,BOUNDS4              SAVE CANCEL WRAP ZONE  @OS77388 19470000
         B     STAY1                    START REUSE PROCESS    @OS77388 19471000
SETBS45  EQU   *                                               @OS77388 19472000
         LR    R15,R14                  COPY RADDR WRAP ADDRESS@OS77388 19473000
         A     R15,BOUNDS2              GET VALUE FOR BOUNDS4  @OS77388 19474000
         ST    R15,BOUNDS4              SAVE CANCEL WRAP ZONE  @OS77388 19475000
         A     R14,BOUNDS3              GET BOUNDS5 VALUE      @OS77388 19476000
         ST    R14,BOUNDS5              SAVE CURRENT WRAP ZONE @OS77388 19477000
STAY1    EQU   *                                               @OS77388 19478000
         L     R15,AVTRNMPT             GET START OF TERMNAME TABLE     19500021
         MVC   LENTNT+2(L'TNTLEN),TNTLEN-IEDQTNTD(R15) PRESET INDEX     19550021
*                                         THROUGH TERMNAME TABLE TO     19600021
*                                         NO. OF TABLE ENTRIES          19650021
         B     GETBLKS                  GO GET REUS LCB                 19700021
*                                                                       19750021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 19800021
*                                                                       19850021
LOOP     EQU   *                        AS EACH Q IS SERVICED AS        19900021
*                                         FAR AS POSSIBLE, ITS          19950021
*                                         APPROPRIATE ELEMENTS PUT      20000021
*                                         TO POSTQ FOR DISPATCHING,     20050021
*                                         START HERE TO PROCESS         20100021
*                                         ANOTHER Q SIMULTANEOUSLY      20150021
         TM    BITS,COPYBIT             REUS OR COPY LCB                20200021
         BO    EXIT                       COPY, QUIT                    20250021
*                                         REUS, TRY FOR AN LCB          20300021
GETBLKS  EQU   *                        REMOVE AN LCB AND SCB FROM      20350021
*                                         FREEPOOL, IF ANY AVAILABLE    20400021
         SR    R15,R15                  CLEAR WORK REG                  20450021
         L     RLCB,POOLCB              GET ADDR OF FIRST LCB ON        20500021
         LA    RLCB,0(,RLCB)              POOL, IF ANY                  20550021
         LTR   RLCB,RLCB                WAS ONE AVAILABLE               20600021
         BZ    EXIT                     NO, NONE AVAILABLE, QUIT        20650021
*                                         YES, GOT LCB                  20700021
         L     RSCB,LCBSCBA-1           SET SCB REG WITH SCB            20750021
*                                         ATTACHED TO THIS LCB          20800021
         MVC   POOLCB+1(3),LCBLINK      MOVE NEXT LCB TO FREEPOOL       20850021
         IC    R15,POOLCB               GET LCB COUNT                   20900021
         LA    R15,ONE(,R15)            BUMP COUNTER                    20950021
         STC   R15,POOLCB               SAVE NEW COUNT                  21000021
*                                                                       21050021
*                                       GOT THEM - RLCB AND RSCB        21100021
*                                         ARE NOW SET                   21150021
GETTNT   EQU   *                        THIS PAIR OF LCB + SCB HAS      21200021
*                                         FINISHED A TERM ENTRY.        21250021
*                                       USE THEM TO DO ANOTHER          21300021
*                                         TERMINAL ENTRY.               21350021
         XC    1(LCBSCBA-IEDQLCB-1,RLCB),1(RLCB) CLEAR LCB              21400021
         XC    ALTDESX(BUFFERCN-ALTDESX+L'BUFFERCN),ALTDESX             21450021
*                                         AND WORKAREA                  21500021
         XC    0(SCBRGSAV-IEDQSCB,RSCB),0(RSCB) CLEAR SCB               21550021
         L     R1,LENTNT                GET INDEX TO TERMNAME TABLE     21600021
         BAL   R14,CALLTNT              CONVERT INDEX IN R1 TO          21650021
*                                         TERM TABLE ADDRESS IN R1      21700021
         USING IEDQTRM,R1                                        S22024 21750022
         TM    TRMSTATE,TESTLOG         IS IT LOGTYPE ENTRY ?    S22024 21770022
         BO    SINGORPR                   YES, GO CHECK IT              21800021
*                                       NO NOT LOGTYPE           S22025 21850022
         TM    TRMDSORG,TRMLGB          IS IT A 3705 LGB ?       S22024 21855022
         BO    BUMPINDX                 YES, GET NEXT ENTRY      S22024 21860022
         TM    TRMSTATE,TRMLIST         PROCESS,SINGLE,LINE     SA65862 21900054
         BZ    SINGORPR                 YES, GO CHECK IT         S22025 21950022
*                                         NO, TRY NEXT TERMINAL         22000021
         DROP  R1                                                S22024 22020022
BUMPINDX EQU   *                                                        22050021
         L     R1,LENTNT                GET INDEX OF OLD TERMINAL       22100021
         BCT   R1,GONEXTRM              BUMP INDEX TO NEXT TERMNAME     22150021
*                                                                       22200021
         MVC   LCBLINK,POOLCB+1         HANG FREE LCBS ONTO NEW LCB     22250021
         SR    R15,R15                  CLEAR WORK REG                  22300021
         IC    R15,POOLCB               GET FREEPOOL COUNT              22350021
         BCTR  R15,0                    DECREMENT COUNT OF STILL        22400021
*                                         ACTIVE LCBS                   22450021
         ST    RLCB,POOLCB              HANG NEW LCB ONTO FREEPOOL      22500021
         STC   R15,POOLCB               RESTORE NEW COUNT               22550021
         LTR   R15,R15                  SET CONDITION CODE              22600021
*                                         IF R15 IS NOW ZERO, ALL       22650021
*                                         LCBS ARE BACK INTO FREEPOOL   22700021
*                                       ARE ALL LCB + SCB BACK TO POOL  22750021
         BNZ   EXIT                       NO, REST WILL QUIT SOON       22800021
*                                         YES, REUS IS FINISHED         22850021
         MVC   NAMETAG(MLN),QUIT        MOVE MESSAGE TAG        SA52971 22900022
         BAL   R14,WRTOP                DO WRITE TO OPERATOR    SA52971 22920022
*                                                                       23300021
* NOW THAT REUS HAS FINISHED, THE SERVICED BIT IN EACH QCB IS SET TO    23350021
* INDICATE THE QCB IS SERVICED BY REUS.  NEXT TIME REUS IS ENTERED,     23400021
* REDEFINE THE BIT SO THIS SAME SETTING MEANS 'NOT SERVICED'.  DO       23450021
* THIS BY TOGGLING THE CONDITION CODE OF A CONDITIONAL BRANCH           23500021
*                                                                       23550021
FLIPTEST XI    TEST+1,TOGGLE            REVERSE BIT DEFINITION BY       23600021
*                                         MODIFYING A CONDITIONAL       23650021
*                                         BRANCH INSTRUCTION            23700021
*                                                                       23750021
* IF TCAM IS TRYING TO CLOSEDOWN, IT IS WAITING FOR REUS TO GET         23800021
* THROUGH.  IF SO, NO NEED TO REQUEST A CHECKPOINT, SINCE CLOSEDOWN     23850021
* WILL DO A CHECKPOINT.                                                 23900021
*                                                                       23950021
         TM    AVTBIT1,AVTCLOSN         IS CLOSEDOWN IN PROGRESS        24000021
         BZ    CKCK                       NO, CHECK CHECKPOINT          24050021
*                                         YES, CLOSING DOWN             24100021
         LA    R1,AVTOPCOB+4            PASS ADDR OF OPERATOR           24150021
*                                         CONTROL'S ECB                 24200021
*                                       CLOSEDOWN (ACTIVATED BY         24250021
*                                         OPERATOR CONTROL) CAN         24300021
*                                         TRY AGAIN NOW THAT REUS       24350021
         POST  (1)                        HAS FINISHED A ZONE           24400021
*                                                                       24450021
         B     OFFRUN                   FORGET CHECKPOINT, GO SEE       24500021
*                                         IF NEXT ZONE IS READY         24550021
*                                         FOR REUS SERVICEING           24600021
CKCK     EQU   *                                                        24650021
         TM    AVTCKFLG,AVTCKTAC       IS CHECKPOINT IN SYSTEM @Y17XARX 24700000
         BZ    OFFRUN                     NO, FORGET CHECKPOINT         24750021
*                                         YES, REQUEST CHECKPOINT       24800021
*                                                                       24850021
* GO TO TIME DELAY SUBTASK AND GET CHECKPOINT ELEMENT                   24900021
*                                                                       24950021
         LA    R1,AVTCKELE              REQUEST CKPT ELE FROM TIME Q    25000021
         L     R15,AVTHG02              GET DELINK TIME ELE ROUTINE     25050021
         BALR  R14,R15                  REMOVE CKPT ELE FROM TIME Q     25100021
*                                                                       25150021
         TM    AVTCKELF,AVTCRTLN        IS CKPT ELE ALREADY POSTED      25200021
         BO    OFFRUN                     YES, FORGET CHECKPOINT,       25250021
*                                           IT IS ALREADY REQUESTED     25300021
*                                         NO, NOT REQUESTED YET         25350021
         TM    AVTCKELF,AVTCPIPN        IS CKPT IN PROGRESS             25400021
         BO    FLAGELE                    YES, FLAG CKPT ELE TO TELL    25450021
*                                           CKPT TO DO IT AGAIN         25500021
*                                         NO, CKPT NOT IN PROGRESS      25550021
*                                                                       25600021
* NOW THAT A ZONE IS CLEANED UP, ACTIVATE CHECKPOINT.                   25650021
*                                                                       25700021
         MVC   AVTCKELE+(RECBQCBA-IEDQRECB)(3),AVTCKQAD CKPT QCB ADDR   25750021
         LA    R1,AVTCKELE              PASS CKPT ELE TO DISPATCHER     25800021
         MVI   AVTCKELE+(RECBPRI-IEDQRECB),PRICKPT SET PRIORITY         25850021
         BAL   R14,POSTCHAN             PUT CKPT ELE ONTO READY Q       25900021
*                                                                       25950021
FLAGELE  EQU   *                                                        26000021
         OI    AVTCKELF,AVTCRTLN        MARK CKPT ELE AS 'POSTED'       26050021
*                                                                       26100021
OFFRUN   EQU   *                                                        26150021
         NI    AVTBIT2,X'FF'-AVTREUSN   CLEAR 'REUS IS RUNNING' BIT     26200021
         B     CKFTS                    GO SEE IF NEXT ZONE IS READY    26250021
*                                         FOR REUS CLEANUP              26300021
*                                                                       26350021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 26400021
*                                                                       26450021
* ONE PORIORTY LEVEL DESTINATION QCB HAS BEEN PROCESSED.  REPEAT        26500021
* FOR LOWER PRIORITY LEVELS ON THIS SAME QCB.                           26550021
*                                                                       26600021
NEXTPRI  EQU   *                                                        26650021
         MVI   BITS,AVTEZERO            CLEAR FLAGS                     26700021
         CLI   QCBPRIPQ,AVTEZERO        IS THIS THE LOWEST      SA52971 26750022
         BE    GOSCHED                    YES, LAST PRI QCB             26800021
*                                         NO, ANOTHER LOWER LEVEL       26850021
         LA    RQCBSP,QCBPSIZE(,RQCBSP) BUMP TO NEXT PRI QCB            26900021
         B     NEWPRI                   SERVICE NEW PRI QCB             26950021
*                                                                       27000021
GOSCHED  EQU   *                                                        27050021
         XI    QCBFLAG,QCBRSRV          MARK MASTER SOURCE QCB SERVICED 27100021
         NI    QCBDSFLG,X'FF'-QCBHELD   PERMIT SENDING AGAIN            27150021
*                                       INITIALIZE FOR PRIORITY@XA06353 27153056
*                                       LEVEL SCAN             @XA06353 27156056
         LA    RQCBSP,IEDQQCB+QCBMSIZE-QCBPSIZE                @XA06353 27159056
SCANLOOP EQU   *                                               @XA06353 27162056
         LA    RQCBSP,QCBPSIZE(,RQCBSP) BUMP TO NEXT PRI LEVEL @XA06353 27165056
         OC    QCBFFEFO,QCBFFEFO        AND UNSENT MESSAGES    @XA06353 27168056
         BNZ   SCHEDSS                  BR YES                 @XA06353 27171056
*                                                              @XA06353 27174056
         CLI   QCBPRIPQ,AVTEZERO        LAST PRI LEVEL         @XA06353 27177056
         BE    CLOSPROC                 BR IF YES              @OS76714 27180091
*                                                              @XA06353 27183056
         B     SCANLOOP                 CHECK NEXT PRI LEVEL   @XA06353 27186056
*                                                              @XA06353 27189056
SCHEDSS  EQU   *                                               @XA06353 27192056
         BAL   R14,ACTSCHED             ACTIVATE THE SCHEDULER          27200021
*                                         TO SEND TO SOURCE QCB         27250021
         LR    R12,R0                   RESTORE BASE REG        SA61768 27300000
         B     BUMPINDX                 GO SERVICE NEXT TERMINAL        27350021
*                                                                       27400021
GONEXTRM EQU   *                        ANOTHER TNT ENTRY TO BE DONE    27450021
         ST    R1,LENTNT                SAVE NEW INDEX                  27500021
         B     GETTNT                   CHECK OUT NEXT TNT ENTRY        27550021
CLOSPROC EQU   *                                               @OS76714 27553091
         TM    QCBFLAG,QCBPROC          PROCESS ENTRY          @OS76714 27556091
         BNO   BUMPINDX                 BR IF NO               @OS76714 27559091
         L     R1,QCBPREN               PROCESS ENTRY ADDR     @OS76714 27562091
         NC    TRMSTAT+1-IEDQTRM(2,R1),TRMSTAT+1-IEDQTRM(R1)   @OS76714 27565091
*                                       PROCESS ENTRY CLOSED?  @OS76714 27568091
         BZ    BUMPINDX                 BR IF YES              @OS76714 27571091
         L     R1,TRMSTAT-IEDQTRM(,R1)   PEWA ADDR             @OS76714 27574091
         TM    PEWAFLG-IEDQPEWA(R1),CFLG  CLOSE IN PROGRESS    @OS76714 27577091
         BO    SCHEDSS                  BR IF YES TO CAUSE     @OS76714 27580091
*                                       IEDQEW TO RUN          @OS76714 27583091
         B     BUMPINDX                 CONTINUE               @OS76714 27586091
         EJECT                                                          27589091
*                                                                       27600021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 27650021
*                                                                       27700021
SINGORPR EQU   *                        A SINGLE OR PROCESS TERMINAL    27750021
*                                         TABLE ENTRY HAS BEEN FOUND    27800021
         L     RQCBSM,TRMDESTQ-1-IEDQTRM(R1) GET SOURCE MASTER QCB      27850021
         TM    QCBDSFLG,QCBREUS         IS Q=MR OR DR                   27900021
         BZ    BUMPINDX                   NEITHER, GET NEXT TERMINAL    27950021
*                                         YES, USES REUS DISK QUEUE     28000021
         TM    QCBFLAG,QCBRSRV          IS THIS QCB SERVICED YET        28050021
*                                                                       28100021
* (NEXT INSTRUCTION MODIFIED AT TAG 'FLIPTEST'.)                        28150021
*                                                                       28200021
TEST     BNZ   BUMPINDX                   YES, ALREADY DONE             28250021
*                                         NO, NOT DONE YET, DO IT       28300021
         TM    QCBDSFLG,QCBHELD         IS THIS QCB BEING               28350021
*                                         SERVICED ALREADY              28400021
*                                         BY REUSABILITY                28450021
         BO    BUMPINDX                   YES, SKIP IT                  28500021
*                                         NO, START CHECKING            28550021
         OI    QCBDSFLG,QCBHELD         STOP SENDING TO THIS SOURCE     28600021
*                                         MASTER QCB UNTIL REUS IS      28650021
*                                         FINISHED WITH THIS ONE QCB    28700021
         MVC   SOURCTNT,LENTNT+2        SAVE THIS SOURCE INDEX          28750021
         ST    RQCBSM,SOURCQCB          SAVE SOURCE MASTER QCB          28800021
         LA    RQCBSP,QCBMSIZE(,RQCBSM) SET SOURCE PRI QCB TO   SA52971 28850022
*                                         HIGHEST PRI QCB               28900021
NEWPRI   EQU   *                                                        28950021
         ST    RQCBSP,SQCB              SAVE SOURCE PRI QCB             29000021
         MVC   AVTDOUBL+1(3),QCBDNHDR   GET ADDR OF             SA52971 29050022
         L     R14,AVTDOUBL               NEXT ASSIGNED-AHEAD HEADER    29100021
         LA    R14,0(,R14)              CLEAR HIGH BYTE                 29150021
         LA    R15,BOUNDS3              ADDR OF CURRENT ZONE   @OS77388 29200000
         C     R14,AVTRADDR             POSSIBLE WRAP          @OS77388 29208000
         BNH   NOCHEK                   NO, BRANCH             @OS77388 29216000
         LA    R15,BOUNDS5              ADD CURRENT WRAP ZONE  @OS77388 29224000
NOCHEK   EQU   *                                               @OS77388 29232000
         C     R14,0(R15)               IS UNUSED HEADER IN CUR@OS77388 29240000
*                                         ZONE' AND THUS OK             29250000
         BH    UNSENT                   YES, BRANCH            @OS77388 29300000
*                                                                       29400021
* SEND CANCEL HEADER TO THIS PRI QCB TO CAUSE REASSIGNMENT OF A NEW     29450021
* HEADER IN 'CURRENT ZONE'.                                             29500021
*                                                                       29550021
         BAL   R14,BUFPOOL              GET UNIT FROM AVAILABLE BUF     29600021
*                                         POOL                          29650021
         ST    RPREFIX,BUFFER           SAVE UNIT ADDRESS               29700021
*                                                                       29750021
* A BUFFER UNIT IS NOW AVAILABLE.  BUILD IT INTO A CANCELLED HEADER.    29800021
*                                                                       29850021
         ST    RLCB,PRFLCB-1            PASS ADDR OF REUS LOCAL LCB     29900021
         MVI   PRFNBUNT,ONE             SINGLE UNIT BUFFER              29950021
         XC    PRFSRCE(PRFDEST-PRFSRCE),PRFSRCE CLEAR PREFIX            30000021
         MVC   PRFDEST,SOURCTNT         SOURCE TERMINAL INDEX           30050021
         MVI   SCBQTYPE,SCBREUS         SET TO HAVE RADDR BUMPED        30100021
         OI    PRFSTAT1,PRFCNCLN        MARK MSG CANCELLED              30150021
         MVC   SCBPRI(1),QCBPRIPQ       PASS PRI OF SOURCE      SA52971 30200022
         LH    R15,AVTKEYLE             GET KEYLENGTH                   30250021
         STH   R15,PRFSIZE              SET FOR SINGLE UNIT BUFFER      30300021
         LA    R14,AVTHDRSZ             REMOVE SIZE OF HEADER           30350021
         SR    R15,R14                    FROM KEYLENGTH                30400021
         MVI   PRFSHDR,CHAR             GET FILL CHARACTER              30450021
         BCTR  R15,0                    ADJUST TEXT SIZE FOR EX INSTR   30500021
         BCTR  R15,0                    ADJUST FOR 1ST CHAR DONE        30550021
         EX    R15,FILL                 PUT FILL CHAR TO CANCEL HEADER  30600021
*                                                                       30650021
* BUFFER IS READY TO BE POSTED TO DISK I/O TO BE WRITTEN AS A           30700021
* CANCELLED HEADER.  SET UP LCB TO BE POSTED BACK TO REUS SO IT         30750021
* KNOWS WHEN BUFFER HAS GONE TO DISK.  LCB USES LOWER PRI THAN BUF.     30800021
*                                                                       30850021
         LR    RQCBD,RQCBSM             SEND CANCEL HEADER TO           30900021
*                                         SOURCE MASTER                 30950021
         BAL   R14,WRITE                'WRITE' POSTS BUFFER TO         31000021
*                                         DISK I/O SUBTASK AND          31050021
*                                         ERB TO IGG019RP               31100021
UNSENT   EQU   *                        COME HERE IF NO CANCEL MSG      31150021
*                                         WAS NEEDED, OR IF CANCEL      31200021
*                                         MSG HAS JUST BEEN WRITTEN     31250021
         NC    QCBINTFF(3),QCBINTFF     ANY HELD MESSAGES       SA52971 31300022
         BZ    NOINT                      NO, FORGET INTERCEPTED        31400021
*                                           MSG PROCESSING              31450021
*                                         YES, INTFF FIELD USED         31500021
         TM    QCBFLAG,QCBPROC          IS THIS A PROCESS Q             31550021
         BO    NOINT                      YES, PROCESS Q USES INTFF     31600021
*                                           FOR OTHER THAN INT MSGS     31650021
*                                         NO, INTFF HAS INT MSGS        31700021
         MVC   QCBFFEFO(3),QCBINTFF     MOV HELD MSG TO FEFO    SA52971 31750022
         XC    QCBINTFF(3),QCBINTFF     CLEAR FIRST HELD FEFO   SA52971 32250022
         MVC   QCBPREVF(3),QCBPFEFO     RESET SHUFFLE SPOT      SA52971 32750022
NOINT    EQU   *                                                        33300021
         XC    IDBADPTR(3),IDBADPTR     SET NO GOOD PREV MSG    SA52971 33320022
         MVC   RESUME(3),QCBPFEFO       GET ADDRESS OF 1ST MSG  SA52971 33350022
HOLDOUT  EQU   *                                                        33400021
         MVC   AVTDOUBL+1(3),RESUME     SET WHERE TO RESUME     SA52971 33450022
         NI    BITS,X'FF'-(SDFFO+LMSGN) RESET MSG ORIENTED FLGS SA52971 33470022
         L     R15,AVTDOUBL                                             33500021
         LA    R15,AVTEZERO(,R15)       CLEAR HI-ORDER BYTE     SA52971 33520022
         LTR   R15,R15                  ARE THERE ANY UNSENT MSGS       33550021
         BNZ   PROCESS                  BR YES                  SA61811 33600022
         NC    QCBPREVF,QCBPREVF        PREVF ZEROED BY REUS    SA61811 33610022
         BNZ   NEXTPRI                  BR NO                   SA61811 33620022
         MVC   QCBPREVF,QCBPFEFO        SET PREVF TO PFEFO      SA61811 33630022
         B     NEXTPRI                  PROCESS NEXT PRI LEVEL  SA61811 33640022
         SPACE                                                          33650022
PROCESS  EQU   *                                                SA61811 33660022
         LA    R9,AVTDOUBL+1            SET SEARCH ARGUEMENT    SA52971 33700022
         SR    R10,R10                  SET 'LET ME KNOW'       SA52971 33900022
         BAL   R14,FINDHM03             IS FIRST MSG ON THIS PRI        34200021
*                                         QCB BEING SENT                34250021
         MVC   AVTDOUBL+1(3),RESUME     RESET RCD NUM TO BNDRY  SA52971 34300022
         LTR   R14,R14                  WAS MSG FOUND SENDING   SA52971 34310022
         BNM   SDFFONO                  NO, EVERYTHING'S FINE   SA52971 34320022
         OI    BITS,SDFFO               SET 'BEING SENT'        SA52971 34330022
SDFFONO  EQU   *                                                SA52971 34340022
         CLC   AVTDOUBL+1(3),QCBLFEFO   IS THE LAST ON QUEUE    SA52971 34390022
         BNE   NOLFEFO                  NO, CONTINEU            SA52971 34400022
         OI    BITS,LMSGN               REMEMBER THAT IT WAS    SA52971 34410022
*                                         AT READ               SA52971 34420022
NOLFEFO  EQU   *                                                SA52971 34430022
         L     R15,AVTDOUBL             AGAIN GET FFEFO MSG ADDR        34550021
         BAL   R14,READHEAD             GET ADDR OF HEADER BUFFER       35050021
*                                         TO RPREFIX                    35100021
         TM    BITS,SDFFO               WAS IT BEING SENT       SA52971 35150022
         BZ    NOSDFFO                  NO, WE'RE OK            SA52971 35170022
         LA    R9,PRFCRCD               GET THIS RRN            SA52971 35190022
         SR    R10,R10                  SET 'LET ME KNOW'       SA52971 35210022
         BAL   R14,FINDHM03             GO SEE IF STILL BEING   SA52971 35230022
*                                         SENT                  SA52971 35250022
         LTR   R14,R14                  WAS MSG FOUND SENDING   SA52971 35270022
         BNM   REREAD                   NO, GO REREAD BUFFERS   SA52971 35290022
         TM    QCBFLAG,QCBPROC          IS THIS AN APPL PGM    SA63961  35290452
         BNO   NOTAPPL                  BR IF NOT AN APPL. PGM.SA63961  35290852
*        IF THE APPLICATION PROGRAM NEVER DOES A GET OR WAITS  SA63961  35291252
*        BETWEEN GETS FOR A COMPLETE ZONE, RP WILL NEVER MOVE  SA63961  35291652
*        THE MESSAGES ON THE REQCB OR IN EOMSAVE.  TO PREVENT  SA63961  35292052
*        045 ABENDS, WHEN A MESSAGE THAT IS UCRRENTLY BEING    SA63961  35292452
*        SENT (SDFFO ON) IS MORE THAN ONE AND ONEHALF ZONES    SA63961  35292852
*        BACK, RP WILL EITHER MOVE IT ANYWAY OR MARK IT        SA63961  35293252
*        SERVICED.  AT THIS TIME THE PROCESS QUEUE WILL BE     SA63961  35293652
*        MARKED AS STOP AND THE APPLICATION PROGRAM WILL BE    SA63961  35294052
*        GIVEN A RETURN CODE ON THE NEXT OPERATION, INDICATING SA63961  35294452
*        THAT THIS DCB MUST BE CLOSED AND REOPENED.            SA63961  35294852
         L     R1,AVTTOTNR              TOTAL RECORDS OR ADDR  @OS77388 35295200
*                                        FOR 1/4 OF DISK       @OS77388 35295400
         SRL   R1,BYTWO                 DIVIDE FOR 1/8         @OS77388 35295600
         L     R15,BOUNDS2              CURRENT ZONE BOUNDARY  @OS77388 35296000
         L     R14,PRFCRCD-1            CURRENT HEADER ADDRESS @OS77388 35296400
         LA    R14,AVTEZERO(R14)        CLEAR FOR COMPARE      @OS77388 35296600
         C     R14,AVTRADDR             POSSIBLE WRAP          @OS77388 35296800
         BNH   RETA                     NO, BRANCH             @OS77388 35297200
         L     R15,BOUNDS4              ADDR OF CANCEL WRAP ZON@OS77388 35297600
RETA     EQU   *                                               @OS77388 35297800
         SR    R15,R1                   NEW ZONE BOUNDARY      @OS77388 35298000
         CR    R14,R15                  IS MSG IN 'BAD ZONE'   @OS77008 35298300
         BH    NOTAPPL                  BR IF MSG OK           @OS77008 35298600
         NI    QCBFLAG,X'FF'-QCBSDFFO   RESET DSFFO TO ENABLE  @OS77008 35298900
*   THIS MSG TO BE MOVED IF NECESSARY                          @OS77008 35299200
         L     R14,QCBPREN              ADDR OF PROCESS ENTRY  @OS77008 35299600
         L     R14,TRMSTAT-IEDQTRM(,R14)   PEWA ADDR           SA63961  35300052
         NC    EOMSAVE+1-IEDQPEWA(3,R14),EOMSAVE+1-IEDQPEWA(R14) A63961 35300852
         BZ    REREAD                   IF NOT IN EOMSAVE      SA63961  35301252
*        TREAT AS IF THIS MSG WAS NOT BEING SENT - MOVE IT     SA63961  35301652
         L     R15,EOMSAVE-IEDQPEWA(,R14)  EOM BFR             SA63961  35302052
         ST    R15,BUFFERCN             EOM TO MARK SERVICED   @SA75126 35302209
*                                       R6=RECALLED HDR        @OS76987 35302400
         LA    R1,PRFCRCD-IEDQPRF(,R15)  ASSUME HDR            @OS76987 35302500
         TM    PRFSTAT1-IEDQPRF(R15),PRFNHDRN  IS IT A HDR     @OS76987 35302600
         BNO   HDR                      BR YES                 @OS76987 35302700
         LA    R1,PRFCHDR-IEDQPRF(,R15)   RESET HDR PTR        @OS76987 35302800
HDR      EQU   *                                               @OS76987 35302900
         TM    L'PRFCRCD-1(R1),CPBQTYPE   DISK HDR?            @OS76987 35303000
         BNZ   DISK                     BR IF YES              @OS76987 35303100
         MVC   AVTDOUBL+1(3),AVTEZERO(R1)  MOVE HDR PTR        @OS76987 35303200
         L     R15,AVTDOUBL             GET CORE Q PTR         @OS76987 35303300
         LA    R1,PRFCRCD-IEDQPRF(,R15)   POINT TO CORE COPY   @OS76987 35303400
DISK     EQU   *                                               @OS76987 35303500
*                                       R1=PTR TO ADDR OF      @OS76987 35303600
*                                        EOMSAVE HDR           @OS76987 35303700
         CLC   AVTEZERO(3,R1),PRFCRCD   IS THIS HDR TO BE      @OS76987 35303800
*                                           SERVICED           @OS76987 35303900
         BNE   REREAD                   BR IF NOT THIS ONE     SA63961  35304852
MKSRVCD  EQU   *                                               SA63961  35305252
*        IF THIS IS THE MSG IN EOMSAVE MARK IT SERVICED        SA63961  35305652
         XC    EOMSAVE-IEDQPEWA(4,R14),EOMSAVE-IEDQPEWA(R14)   SA63961  35306052
*                                       CLEAR EOMSAVE FOR QEU  SA63961  35306452
         OI    PEWAFLG-IEDQPEWA(R14),PEWASTOP                  @SA74235 35306509
*                                       SET ERROR FLG          @SA74235 35306609
         ST    RPREFIX,BUFFER           ORIG HDR BFR TO FREE   SA63961  35306852
*                                       POST A.P. ECB FOR      @SA64353 35306910
*                                       DISABLED TPROCESS ENTRY@SA64353 35307010
         MVC   PEWASAVE+TWENTY8-IEDQPEWA(4,R14),PEWAECBA-IEDQPEWA(R14)  35307110
*                                       MOVE ECB TO PARM LIST  @SA64353 35307210
         XC    PEWAECBA-IEDQPEWA(4,R14),PEWAECBA-IEDQPEWA(R14) @SA64353 35307310
*                                       CLEAR ECB              @SA64353 35307510
         NI    PEWAFLG-IEDQPEWA(R14),POSTOFFF  RESET POST FLAG @SA64353 35307610
         MVI   PEWASAVE+TWENTY8-IEDQPEWA(R14),ZERO CLEAR HI ORD@SA64353 35307910
         L     R15,PEPCBAD-IEDQPEWA(R14)  GET PCB ADDR         @SA64353 35308410
         L     R15,PCBPEBAD-IEDQPCB(R15)   GET PEB ADDR        @SA64353 35308910
         MVC   PEWASAVE+THIRTY2-IEDQPEWA(4,R14),PEBASCB-IEDQPEB(R15)    35309410
*                                       ASCB ADDR TO PARM LIST @SA64353 35325510
         L     R15,CVTPTR               CVT PTR                @SA64353 35325610
         LA    R15,CVTBRET-CVTMAP(R15)  ERROR RTN ADDR         @SA64353 35325710
         ST    R15,PEWASAVE+THIRTY6-IEDQPEWA(R14) TO PARM LIST @SA64353 35325810
         ST    R0,PEWASAVE+TWENTY4-IEDQPEWA(R14)  SAVE R0      @SA64353 35325910
         LA    R0,STOPQ                 DISABLE ENTRY CODE     @SA64353 35326010
         LA    R1,PEWASAVE+TWENTY8-IEDQPEWA(R14)  ADDR OF PARM @SA64353 35326110
*                                       LIST                   @SA64353 35326210
         NC    1(3,R1),1(R1)            IF PARM LIST ADDR      @ZM47770 35326310
         BZ    SKPOST                    EQUALS ZERO, BRANCH   @ZM47770 35326410
         POST  ,(0),MF=(E,(1))          POST A.P.              @SA64353 35327610
SKPOST   EQU   *                                               @ZM47770 35328410
         L     R0,PEWASAVE+TWENTY4-IEDQPEWA(R14)  RESTORE R0   @SA64353 35330810
*        ALL FIELDS NEEDED HAVE BEEN SET BY EW ALREADY         SA63961  35331610
         B     NOALTSP                  MARK THIS MSG SRVCD    SA63961  35332410
SETREL   EQU   *                                               @SA69999 35333210
*                                                             *@SA69999 35334010
*   THIS SUBROUTINE CONVERTS VALUE IN R14 TO A VALUE RELATIVE *@SA69999 35334810
*   TO ZERO.  THIS ALLOWS A COMPARISON OF A WRAPPED AND AN    *@SA69999 35335610
*   UNWRAPPED RELATIVE RECORD NUMBER.                         *@SA69999 35336410
*                                                             *@SA69999 35337210
         ST    R15,AVTDOUBL             SAVE FOR CALLER        @SA69999 35338010
         LR    R15,R14                  SET UP FOR DIVISION    @SA69999 35338810
         SR    R14,R14                  CLEAR LEFT MEMBER OF   @SA69999 35339610
*                                        REGISTER              @SA69999 35340410
         L     R0,AVTTOTNR              GET NUMBER OF RECORDS  @SA69999 35341210
*                                        IN REUS DATA SET      @SA69999 35342010
         SLL   R0,BYFOUR                MULTIPLY FOR FULL DISK @SA76478 35342810
*                                        SIZE                  @SA69999 35343610
         DR    R14,R0                   DO THE MODULO DIVIDE TO@SA69999 35344410
*                                        GET TRUE REL RECL NO  @SA69999 35345210
         L     R15,AVTDOUBL             RESTORE FOR CALLER     @SA69999 35346010
         BR    R1                       RETURN                 @SA69999 35346810
NOTAPPL  EQU   *                                               @SA69999 35347610
         OI    BITS,SDPREV              SET 'SENDING PREVIOUS   SA52971 35348410
         MVC   RESUME(3),SCBFEFO        SET TO RESUME SEARCH    SA52971 35349210
         B     OKMSG                    GO TREAT AS GOOD MSG    SA52971 35350022
         SPACE 1                                                SA52971 35370022
NOSDFFO  EQU   *                                                SA52971 35390022
         TM    BITS,LMSGN               WAS IT LAST             SA52971 35410022
         BZ    NOTLAST                  NO, SEE IT BAD          SA52971 35430022
         CLC   PRFCRCD(3),QCBLFEFO      IS IT STILL LAST        SA52971 35450022
         BNE   REREAD                   NO, GO REREAD IT TO     SA52971 35470022
*                                         OBTAIN CHANGED FEFO   SA52971 35490022
*                                         POINTER               SA52971 35510022
NOTLAST  EQU   *                                                SA52971 35530022
         MVC   RESUME,SCBFEFO           SAVE FEFO POINTER TO WHERE      35600022
*                                         TO RESUME SEARCH              35620022
         CLC   IDBADPTR,PRFCRCD         REREAD OF A SENDING MSG SA51783 35625022
         BE    SAVDATA                  BR YES                  SA51783 35630022
         SPACE                                                          35635022
         L     R14,PRFCRCD-1            GET THIS RECORD NUMBER @SA69999 35640009
         LA    R14,AVTEZERO(,R14)       CLEAR HIGH-ORDER BYTE  @SA69999 35644009
         LA    R15,BOUNDS2              ADDRESS OF CANCEL ZONE @OS77388 35648000
         C     R14,AVTRADDR             PROBABLE WRAP          @SA69999 35656009
         BNH   RETB                     NO, BRANCH             @OS77388 35660000
         LA    R15,BOUNDS4              ADDR OF CANCEL WRAP ZON@OS77388 35664000
RETB     EQU   *                                               @OS77388 35668000
         C     R14,0(R15)               IS MSG IN 'BAD ZONE'   @OS77388 35676000
         BL    DLNKFEFO                 BR YES                 @SA69999 35690009
         MVC   AVTDOUBL+1(3),PRFXTRA    ASSUME MORE THAN 1 UNIT SA58992 35701022
         CLI   PRFNBUNT,ONE             ARE THERE ANY EXTRAS    SA58992 35702022
         BNE   PASTNTXT                 BR YES                  SA58992 35703022
         SPACE                                                          35704022
         TM    PRFSTAT1,PRFNLSTN        LAST BUFFER             SA58992 35705022
         BZ    SETNOTSD                 BR YES                  SA58992 35706022
         SPACE                                                          35707022
         MVC   AVTDOUBL+1(3),PRFNTXT    POINTER TO NEXT TEXT    SA58992 35708022
PASTNTXT EQU   *                                                SA58992 35709022
         L     R14,AVTDOUBL             GET VALUE OF XTRA OR   @SA69999 35710009
*                                        NTXT TO BE CHECKED    @SA69999 35710209
         LA    R14,AVTEZERO(,R14)       CLEAR HIGH-ORDER BYTE  @SA69999 35710409
         LA    R15,BOUNDS2              ADDRESS OF CANCEL ZONE @OS77388 35710600
         C     R14,AVTRADDR             PROBABLE WRAP          @SA69999 35711009
         BNH   RETC                     NO, BRANCH             @OS77388 35711200
         LA    R15,BOUNDS4              ADDR OF CANCEL WRAP ZON@OS77388 35711400
RETC     EQU   *                                               @OS77388 35711800
         C     R14,0(R15)               IS MSG IN 'BAD ZONE'   @OS77388 35712000
         BL    DLNKFEFO                 BR YES                 @SA69999 35712609
         SPACE                                                          35714022
SETNOTSD EQU   *                                                SA58992 35715022
         NI    BITS,X'FF'-SDPREV        SET 'NOT SENDING PREVIOUSA52971 35720022
OKMSG    EQU   *                                                SA52971 35740022
         MVC   IDBADPTR,PRFCRCD         SAVE ID OF MSG THAT MIGHT       35800022
*                                         POINT TO A BAD MSG            35830022
SAVDATA  EQU   *                                                SA51783 35832022
*                                       SAVE DATA FLAGS         SA51783 35834022
         MVC   SCBMACR(ONE),DATFLAGS-IEDQDATA(RPREFIX)          SA51783 35836022
         MVC   SCBMACR+ONE(SEQLEN),SCBOSEQ SAVE SEQOUT NUMBER  @SA70208 35838056
         TM    BITS,LMSGN               LAST MSG ENCOUNTERED    SA51783 35842022
         BNO   REREAD                   BR NO                   SA51783 35844022
         SPACE                                                          35846022
         MVC   QCBDATFL,SCBMACR         SAVE DATA FLAGS         SA51783 35848022
         MVC   QCBDATSQ,SCBMACR+ONE     SAVE SEQ OUT NUMBER     SA51783 35850022
REREAD   EQU   *                                                SA52971 35860022
         BAL   R14,RETBUF               FREE UP BUFFER                  35900022
         B     HOLDOUT                  GO LOOK AT NEXT MSG     SA52971 35950022
*                                                               SA52971 36000022
DLNKFEFO EQU   *                                                SA52971 36050022
         CLC   QCBPFEFO(3),PRFCRCD      IS THIS START POINT     SA52971 36100022
         BNE   NOPFEFO                  NO, DON'T CHANGE        SA52971 36150022
         SPACE                                                          36200022
EEPOST1  EQU   *                                                SA51783 36202022
         BAL   R14,BUFPOOL              GET UNIT TO POST TO FA  SA51783 36204022
         SPACE                                                          36206022
         LA    R0,NEWPFEFO              ADDR OF SUBRTN TO WRITE SA51783 36208022
*                                       A CNCLD HDR IN A GOOD   SA51783 36210022
*                                       ZONE AND SET IT AS PFEFOSA51783 36212022
         LA    R1,WRITQCB               QCB TO POST ERB TO      SA51783 36214022
         BAL   R14,EEPOST               POST BFR TO IEDQFA WITH SA51783 36216022
*                                       EE PRI TO GET A CPB     SA51783 36218022
         L     RPREFIX,BUFFER           ADDR OF HDR JUST READ   SA51783 36220022
         BAL   R14,RETBUF               RETURN BFRS TO BFR RET  SA51783 36222022
         SPACE                                                          36224022
         LA    R14,NOINT                SET RESUME ADDR WHEN    SA51783 36226022
         ST    R14,SAVE14               ERB COMES BACK          SA51783 36228022
         B     LOOP                     GO SERVICE ANOTHER TRM  SA51783 36230022
         SPACE                                                          36232022
NOPFEFO  EQU   *                                                SA52971 36250022
         CLC   IDBADPTR,AVTFZERO        FOUND GOOD MSG YET      SA51783 36255022
         BNE   TSTPREVS                 BR YES                  SA51783 36260022
*                                       IF NOT THEN PFEFO MUST  SA51783 36265022
*                                       HAVE CHANGED .          SA51783 36270022
         BAL   R14,RETBUF               RETURN BFRS OF MSG READ SA51783 36275022
         SPACE                                                          36280022
         B     NOINT                    START FROM PFEFO AGAIN  SA51783 36285022
         SPACE                                                          36290022
TSTPREVS EQU   *                                                SA51783 36295022
         CLC   QCBPREVF(3),PRFCRCD      IS THIS IN SHUFFLE      SA52971 36300022
         BNE   NOPREVS                  NO, DON'T CHANGE        SA52971 36350022
         MVC   QCBPREVF(3),SCBFEFO      CHANGE SHUFFLE SPOT     SA52971 36400022
NOPREVS  EQU   *                                                SA52971 36450022
         CLC   QCBINTFF(3),PRFCRCD      FIRST HELD MESSAGE      SA51783 36460022
         BNE   NOINTFF                  BR NO                   SA51783 36470022
         MVC   QCBINTFF(3),SCBFEFO      UPDATE FIRST HELD       SA51783 36480022
NOINTFF  EQU   *                                                SA51783 36490022
         CLC   QCBFFEFO(3),PRFCRCD      HAS FFEFO BEEN          SA52971 36500022
*                                         UPDATED TO BAD MSG YET        36670022
         BNE   NOTIDBAD                   NO, FFEFO SAME AS WAS         36730022
*                                         YES, A SEND OPERATION         36790022
*                                           HAS ALREADY UPDATED         36850022
*                                           FFEFO WITH LINE             36910022
*                                           SCBFEFO FROM MSG            36970022
*                                           JUST SENT                   37030022
         MVC   QCBFFEFO(3),SCBFEFO      REMOVE BAD MESSAGE      SA52971 37090022
*                                         FROM FEFO CHAIN               37150021
NOTIDBAD EQU   *                                                SA52971 37170022
         TM    BITS,LMSGN               IS THIS LAST MSG        SA52971 37230022
         BZ    FIXFEFO                  NO, NO NEED TO UPDATE   SA52971 37250022
         MVC   QCBLFEFO(3),IDBADPTR     MESSAGE THAT POINTED    SA52971 37270022
*                                         TO BAD MSG BECOMES    SA52971 37290022
*                                         NEW LAST MSG          SA52971 37310022
         MVC   QCBDATFL,SCBMACR         SAVE DATA FLAGS         SA51783 37316022
         MVC   QCBDATSQ,SCBMACR+ONE     SAVE SEQ OUT NUMBER     SA51783 37322022
FIXFEFO  EQU   *                                                SA52971 37330022
         LA    R9,IDBADPTR              GET PREV HDR ADDR       SA52971 37350022
         MVC   AVTDOUBL(3),SCBFEFO      MOVE NEXT HDR ADDR      SA52971 37370022
         NC    AVTDOUBL(3),AVTDOUBL     IS  THERE ONE           SA52971 37390022
         BNZ   NOSPEC                   YES, GO RESET IT        SA52971 37410022
         OI    AVTDOUBL+L'SCBFEFO-1,LASTNOFF SET SPECIAL        SA52971 37430022
*                                         'UPDATED' FLAG FOR FA SA52971 37450022
NOSPEC   EQU   *                                                SA52971 37470022
         LA    R10,AVTDOUBL             GET NEXT HDR ADDR       SA52971 37490022
         BAL   R14,FINDHM03             GO RESET SAVED FEFO PTR SA52971 37510022
*                                                               SA51783 37512022
* THE FEFO POINTER IN THE DATA RECORD OF THE MSG THAT POINTED   SA51783 37514022
* TO THIS BAD MSG MUST BE CHANGED.  IT SHOULD POINT TO THE MSG  SA51783 37516022
* POINTED TO BY THE BAD MSG, OR ZEROED IF IT IS LAST ON QUEUE.  SA51783 37518022
*                                                               SA51783 37520022
* IDBADPTR IS THE RECORD WHOSE DATA FIELD SHOULD BE CHANGED.    SA51783 37522022
* SCBFEFO HAS THE DATA FIELD OF THE BAD MSG JUST READ.          SA51783 37524022
* SCBSCHDR IS THE BAD MSG BEING REMOVED.                        SA51783 37526022
*                                                               SA51783 37528022
         TM    BITS,SDPREV              LAST GOOD MSG BEING SENTSA51783 37530022
         BNO   EEPOST2                  BR NO                   SA51783 37532022
         SPACE                                                          37534022
         LA    R9,IDBADPTR              GET RRN OF LAST GOOD MSGSA51783 37536022
         SR    R10,R10                  SET NOT TO UPDATE FEFO  SA51783 37538022
         BAL   R14,FINDHM03             SEE IF STILL BEING SENT SA51783 37540022
         SPACE                                                          37542022
         LTR   R14,R14                  STILL BEING SENT        SA51783 37544022
         BM    EEPOST2                  BR YES                  SA51783 37546022
         SPACE                                                          37548022
         NI    BITS,X'FF'-SDPREV-SDFFO  TURN OFF BITS           SA51783 37550022
         CLC   QCBPREVF,IDBADPTR        GOOD MSG IN SHUFFLE SPOTSA61811 37550122
         BNE   NOTPREVF                 BR NO                   SA61811 37550222
         MVC   QCBPREVF,PRFCRCD         UPDATE SHUFFLE SPOT     SA61811 37550322
NOTPREVF EQU   *                                                SA61811 37550422
         CLC   QCBINTFF,IDBADPTR        GOOD MSG FIRST HELD     SA61811 37550522
         BNE   NOTINTFF                 BR NO                   SA61811 37550622
         MVC   QCBINTFF,PRFCRCD         UPDATE FIRST HELD       SA61811 37550722
NOTINTFF EQU   *                                                SA61811 37550822
         CLC   QCBFFEFO,IDBADPTR        GOOD MSG FIRST FEFO     SA61811 37550922
         BNE   NOTFFEFO                 BR NO                   SA61811 37551022
         MVC   QCBFFEFO,PRFCRCD         UPDATE FIRST FEFO       SA61811 37551122
NOTFFEFO EQU   *                                                SA61811 37551222
         MVC   AVTDOUBL+1(3),IDBADPTR   RE-READ GOOD MSG SINCE  SA51783 37552022
*                                       ITS DATA FIELDS HAVE    SA51783 37554022
*                                       CHANGED.                SA51783 37556022
         BAL   R14,RETBUF               FREE UP BAD MSG BFR     SA51783 37558022
         SPACE                                                          37560022
         B     NOLFEFO                  BR TO RE-READ GOOD MSG  SA51783 37562022
         SPACE                                                          37564022
EEPOST2  EQU   *                                                SA51783 37566022
         BAL   R14,BUFPOOL              REQUEST UNIT FROM FREEPOOL      37568022
*                                                                       37570022
         LA    R0,UPFEFO                ADDR OF THE SUBRTN TO   SA51783 37572022
*                                       UPDATE THE FEFO PTR OF  SA51783 37576022
*                                       THE LAST GOOD MSG FOUND SA51783 37580022
*                                       IN THE FEFO CHAIN       SA51783 37584022
         LA    R1,UNITQCB               QCB TO POST ERB TO      SA51783 37588022
         BAL   R14,EEPOST               POST BFR TO IEDQFA WITH SA51783 37592022
*                                       EE PRI TO GET A CPB     SA51783 37596022
         LA    R14,AFTERUPD             SET RESUME ADDR WHEN    SA51783 37600022
         ST    R14,SAVE14               ERB COMES BACK          SA51783 37604022
         B     LOOP                     GO SERVICE ANOTHER TRM  SA51783 37608022
         SPACE                                                          37612022
AFTERUPD EQU   *                                                SA51783 37616022
         L     RPREFIX,BUFFER           GET BAD HEADER                  37630022
GETALTD  EQU   *                                                SA52971 37635022
         LH    R1,PRFDEST               GET ORIGINAL DEST INDEX SA52971 37640022
         BAL   R14,CALLTNT              GET ORIGINAL DEST TERMINAL      37650021
*                                         TABLE ADDR TO R1              37700021
         LH    R1,TRMALTD-IEDQTRM(,R1)  GET ALT DEST INDEX              37750021
         STH   R1,ALTDESX               SAVE ALT DEST INDEX             37800021
         XC    BUFFERCN(4),BUFFERCN     CLEAR POINTER           SA51783 37807022
         TM    DATFLAGS-IEDQDATA(RPREFIX),(DATSENT+DATCNCLD) IS SA51783 37814022
*                                       MESSAGE CANCELLED OR    SA51783 37821022
*                                       FLAGGED SERVICED        SA51783 37828022
         BNZ   NOALTSP                  BR YES                  SA51783 37835022
*                                       NO, SEND TO ALT DEST    SA51783 37842022
         BAL   R14,BUFPOOL              GET EXTRA UNIT TO BE USED       37850021
*                                         TO MARK MSG SERVICED          37900021
*                                         TO RPREFIX                    37950021
         L     R2,BUFFER                GET ADDR OF HEADER UNIT         38000021
         MVC   PRFLCB(PRFSHDR-PRFLCB),PRFLCB-IEDQPRF(R2) MOVE           38050021
*                                         PREFIX TO XTRA UNIT           38100021
         ST    RPREFIX,BUFFERCN         SAVE EXTRA UNIT ADDR            38200021
         MVC   PRFSRCE(3),SCBFEFO       PASS THE FEFO PTR        A47133 38210022
         MVC   PRFTQBCK+1(2),SCBOSEQ    PASS SEQ NO. TO FA              38220022
         NI    PRFSTAT1,X'FF'-(PRFNLSTN+PRFNHDRN) SET HDR-EOM   SA52971 38230022
         MVC   PRFTQBCK(1),SCBPRI       SET PRI QCB INDEX       SA52971 38240022
         LR    RPREFIX,R2               RESTORE BAD HEADER ADDR         38250021
         LH    R1,ALTDESX               GET ALT DEST INDEX              38300021
         LTR   R1,R1                    WAS ALT DEST SPECIFIED          38350021
         BZ    NOALTSP                    NO, NO ALT DEST               38400021
*                                         YES, ALTDEST SPECIFIED        38410021
         STH   R1,PRFDEST               CHANGE DEST TO ALTERNATE        38500021
         BAL   R14,CALLTNT              GET ALT DEST TERM TABLE ADDR    38550021
*                                         TO R1                         38600021
         L     RQCBD,TRMDESTQ-1-IEDQTRM(,R1) GET ALT DEST QCB           38650021
         ST    RQCBD,DESTQCB            SAVE DEST QCB ADDR              38700021
         MVC   SCBPRI(1),QCBPRIPQ       SET PRI FROM QCB        SA52971 38720022
*                                                                       38750021
* POST THIS BUFFER TO DESTINATION QCB TO BE WRITTEN TO QUEUE.           38800021
* POST REUS ERB TO ITSELF AT LOWER PRIORITY SO REUS KNOWS WHEN          38850021
* BUFFER HAS BEEN WRITTEN.                                              38900021
*                                                                       38950021
PUTBUF   EQU   *                                                        39100021
         OI    BITS,PUTBUFB             SET FLAG TO CAUSE MULTIPLE      39150021
*                                         BUFFERS POSTED BY 'WRITE'     39200021
         TM    QCBDSFLG-IEDQQCB(RQCBD),QCBDISK IS DEST Q=MO ONLY        39201021
         BNZ   DOWRITE                    NO, WRITE TO DISK             39202021
*                                         YES, WRITE TO CORE ONLY Q     39203021
         TM    SCBERR3,SCBLOSTN         WAS PREVIOUS WRITE OK           39207021
         BNO   DOWRITE                    YES, GO WRITE THIS BUF        39214021
*                                         NO, MAKE THIS WRITE           39221021
*                                           THE LAST ONE                39228021
         NI    BITS,X'FF'-PUTBUFB       DO NOT DO MULTIPLE              39230021
*                                         BUFFER POST                   39232021
         NI    PRFSTAT1,X'FF'-PRFNLSTN  MARK THIS BUFFER AS LAST        39235021
DOWRITE  EQU   *                                                        39242021
         BAL   R14,WRITE                POST BUFFER AND ERB             39250021
*                                                                       39300021
COPYLOOP EQU   *                                                        39350021
         TM    SAVSTAT1,PRFNLSTN        WAS THAT THE LAST BUFFER        39400021
         BZ    SERVICED                   YES, LAST BUFFER WRITTEN      39450021
*                                         NO, MORE BUFFERS TO GO        39500021
         BAL   R14,GETBUF               GET NEXT BUFFER OF MSG          39700021
*                                         FROM SOURCE QCB               39750021
         B     PUTBUF                   GO SEND BUF TO ALT DEST Q       39800021
*                                                                       39850021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 39900021
*                                                                       39950021
SERVICED EQU   *                        MSG SENT FROM SOURCE TO ALT     40150021
*                                         DEST QCB                      40200021
         L     RPREFIX,LCBERBCH-1       GET ANY BUFFERS THAT MAY        40300021
         LA    RPREFIX,0(,RPREFIX)        STILL BE ON Q                 40350021
         LTR   RPREFIX,RPREFIX          ANY BUFFERS STILL THERE         40400021
         BZ    NOFREE                     NO, NONE THERE                40450021
*                                         YES, STILL HAVE BUFFERS       40500021
NOALTSP  EQU   *                        NO ALT DEST SPECIFIED           40520021
         BAL   R14,RETBUF               PUT THEM BACK TO FREEPOOL       40600021
*                                                                       40650021
NOFREE   EQU   *                                                        40700021
         NI    BITS,X'FF'-PUTBUFB       FORBID MULT POST OF BUFFERS     40720021
         TM    BITS,COPYBIT             REUS OR COPY LCB                40750021
         BO    CLEANCPY                   COPY, GO RETURN BUFFER        40800021
*                                         REUS, SET TO FLAG SERVICED    40850021
         L     RPREFIX,BUFFERCN         GET COPY OF HEADER BUFFER       40900021
         LTR   RPREFIX,RPREFIX          TO BE MARKED SERVICED   SA51783 40903022
         BZ    NOSRVCED                 NO, THEN AVOID IT       SA51783 40943022
         MVI   PRFPRI,PRIDKSRV          SET PRIORITY INTO BUFFER        41000021
         LR    RQCBD,RQCBSM             WRITE TO SOURCE MASTER QCB      41150021
         LA    R14,AVTDSIOB             POST BUFFER TO WRITE            41200021
         ST    R14,PRFQCBA-1              SERVICED TO IEDQFA            41250021
         BAL   R14,WRITCN               WRITE MESSAGE SERVICED BIT      41300021
NOSRVCED EQU   *                                                SA51783 41350022
         MVI   SAVSTAT1,AVTEZERO        CLEAR BOTH                      41400021
         MVI   SCBERR3,AVTEZERO           STATUS BYTES                  41450021
         B     HOLDOUT                  GO CHECK NEXT MESSAGE   SA52971 41500022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 46000021
         EJECT                                                          46050021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 46100021
*                                                                       46150021
*                       COPY SUBTASK                                    46200021
*                                                                       46250021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 46300021
*                                                                       46350021
         DS    0F                       WORD BOUNDARY                   46400021
COPY     EQU   *-8                      COPY QCB                        46450021
         DC    AL1(DSPMCPL4),AL3(*-1)   STCB                            46500021
*                                                                       46550021
         L     RBASE,AVTIA              SET PROGRAM BASE                46600021
         LR    RPREFIX,R1               GET ADDR OF BUFFER POSTED       46650021
*                                         TO BE COPIED                  46700021
         L     RLCB,PRFLCB-1            GET DESTINATION LCB ADDR        46750021
         L     RSCB,LCBSCBA-1           GET DESTINATION SCB ADDR        46800021
         L     RQCBD,SCBDESTQ-1         GET DESTINATION QCB ADDR        46850021
         MVI   BITS,COPYBIT             FLAG LCB AS BELONGING TO        46900021
*                                         COPY, CLEAR OTHER BITS        46950021
         ST    RPREFIX,AVTDOUBL         SAVE ORIGINAL BUFFER            47000021
         MVC   SAVCOPY(3),AVTDOUBL+1      POSTED TO COPY                47050021
         TM    SCBHBFNO,SCBREUS+SCBNREUS WAS SOURCE Q=MO                47100021
         BNZ   DISKRECL                   NO, RECALLED FROM DISK        47150021
*                                         YES, SOURCE Q=MO              47200021
         MVC   AVTDOUBL+1(3),SCBCCHDR   GET ORIG CORE Q HDR      S21903 47202052
*                                       ASSUME RECEIVE           S21903 47204052
         TM    LCBSTAT1,LCBSENDN        IS LCB SENDING                  47206021
         BZ    RECCORE                    NO, RECEIVING                 47212021
*                                         YES, SENDING                  47218021
         MVC   AVTDOUBL+1(3),SCBSCHDR   SAVE SEND SIDE ADDR             47224021
*                                                                       47236021
RECCORE  EQU   *                                                        47242021
         L     R2,AVTDOUBL                ADDR TO TEMPORARY REG         47300021
         MVC   PRFNTXT,PRFNTXT-IEDQPRF(R2) GET NTXT FROM CORE Q         47350021
*                                         TO MY COPY                    47400021
         MVC   PRFCRCD,PRFTIC+1-IEDQPRF(R2) GET XTRA FROM CORE Q        47450021
*                                         TO MY COPY                    47500021
DISKRECL EQU   *                                                        47600021
         ST    RQCBD,DESTQCB            SAVE DESTINATION MASTER QCB     47650021
         ST    RQCBD,SOURCQCB                                           47700021
         LR    RQCBSM,RQCBD             FOR COPY, SET SOURCE=DEST QCB   47720021
         MVC   LCBRECAD,LCBERBCH        SAVE ERBCH FOR MULT ROUTE       47750021
         MVC   PRFLINK,SCBDEOB+1        SAVE DEOB FOR MULT ROUTE        47810021
         MVC   SAVRCQCB,LCBRCQCB        SAVE ADDR OF QCB TO RETURN      47811021
*                                         ORIGINAL BUFFER TO            47812021
*                                                                       47813021
* TO RECALL THE FIRST BUFFER, COPY MUST NOW FIND WHERE THAT             47814021
* BUFFER IS.                                                            47815021
*                                                                       47816021
*                                         NO, RECALL FROM DISK          47821021
         L     R2,SCBTRANS-1            ONE RECALL ALREADY DONE TO      47822021
*                                         GET BUFFER POSTED TO COPY     47823021
*                                         SCBTRANS WAS SET THEN.        47824021
         TM    SCBHBFNO,SCBREUS+SCBNREUS IS MSG TO BE RECALLED          47825022
*                                         FROM CORE                     47825322
         BNZ   TESTSEND                 NO, RECALL FROM DISK    SA52971 47825622
*                                         SINCE RECALL IS FROM DISK     47826021
         L     R2,SCBCCHDR-1            GUESS CORE RECALL               47827022
         TM    SCBERR3,SCBLOSTN         MSG WILL BE RECALLED FROM CORE  47828021
*                                       IS THE ENTIRE MSG AVAILABLE     47829021
         BO    CLEANCPY                   NO, PARTLY LOST, FORGET IT    47830021
*                                         YES, GOT ENTIRE MSG           47831021
TESTSEND EQU   *                                                        47832021
         TM    LCBSTAT1,LCBSENDN        IS LCB SENDING                  47833021
         BZ    OKCORE                     NO, ON RECEIVE SIDE OF MH     47834021
*                                         YES, SEND SIDE RECALL         47835021
         L     R2,SCBSCHDR-1            SEND SIDE RECALL ADDR           47836021
*                                         NOT IN SCBTRANS               47837021
OKCORE   EQU   *                                                        47838021
         LA    R2,0(,R2)                CLEAR HIGH BYTE                 47839021
         ST    R2,SCBDEOB               REQUEST FIRST BUFFER            47840021
*                                         BE RECALLED                   47841021
         EX    R0,CLR                   CLEAR SCB FIELDS                47842021
         EX    R0,CLR1                  CLEAR SCB FIELDS                47942021
         BAL   R14,NOBUF                RECALL FIRST BUFFERS            48042021
*                                                                       48242021
         MVC   AVTDOUBL+1(3),SAVCOPY    GET ORIGINAL BUFFER POSTED      48442021
         L     R2,AVTDOUBL                TO COPY                       48642021
         MVC   PRFDEST,PRFDEST-IEDQPRF(R2) MOVE DESTINATION FROM        48842021
         MVC   PRFLCB,PRFLCB-IEDQPRF(R2) ORIGINAL BUF TO RECALLED COPY  49042021
*                                                                       49650021
* THERE ARE NOW 2 COPIES OF FIRST BUFFER.  THE ORIGINAL BUFFER IS       49700021
* IN SAVCOPY WHERE IT STAYS UNTIL COPY IS DONE.  THE NEW BUFFER         49750021
* IN RPREFIX IS TO BE ASSIGNED A POSITION ON THE DESTINATION QUEUE      49800021
* AND WRITTEN TO THAT QUEUE.                                            49850021
*                                                                       49900021
         MVC   LCBSTART,SCBDNSEG        SAVE DNSEG BEFORE HM            50050021
*                                         CHANGES IT                    50100021
         NI    PRFSTAT1,X'FF'-PRFDUPLN  TURN OFF DUP HEADER BIT         50150021
         LR    R15,RQCBD                CORE QUEUED BUF GOES TO DEST    50160022
*                                         QCB WITHOUT HM02 FIRST        50170022
         TM    QCBDSFLG-IEDQQCB(RQCBD),QCBDISK IS DEST Q=MO             50200021
         BZ    COREONLY                   YES, CORE ONLY                50250021
*                                         NO, DISK                      50300021
         SR    R15,R15                  CLEAR WORK REG                  50350021
         IC    R15,SCBPRI               GET PRIORITY LEVEL FROM SCB     50400021
         LA    R14,QCBPEND-QCBMEND      GET SIZE OF PRIORITY QCB        50450021
         MR    R15-1,R14                GET OFFSET TO PRI QVB           50500021
         LA    RQCBSP,IEDQPQCB-IEDQQCB(RQCBSM,R15) BUMP MASTER QCB      50550021
*                                         ADDR TO PRIORITY QCB          50600021
*                                                                       50650021
* CALL DESTINATION ASSIGNMENT TO GET NEW BUFFER ASSIGNED TO QUEUE.      50700021
*                                                                       50750021
* INPUT EXPECTED BY IEDQHM02 (DESTINATION ASSIGNEMENT)                  50800021
* R8 - (RQCBSP) PRIORITY DESTINATION QCB                                50850021
* R7 -(RQCBSM) MASTER DESTINATION QCB                                   50900021
* R6 - (RPREFIX) BUFFER                                                 50950021
* R3 - (RSCB) SCB                                                       51000021
* R4 - (RLCB) LCB                                                       51050021
* R13- (RAVT) AVTSAVE2                                                  51100021
* R14- RETURN ADDRESS                                                   51150021
* R15- ENTRY ADDRESS TO IEDQHM02                                        51200021
*                                                                       51250021
         L     R15,AVTHM02              GET ADDR OF IEDQHM02            51300021
         BALR  R14,R15                  CALL DESTINATION ASSIGNEMNT     51350021
*                                                                       51400021
         MVC   AVTDOUBL(3),PRFNTXT      SAVE NEXT TEXT POINTER          51420022
         CLI   PRFNBUNT,ONE             SINGLE UNIT BUFFER              51450021
         BE    NOXTRA                     YES, NO XTRA UNITS            51500021
*                                         NO, HAS XTRA UNITS            51550021
         MVC   AVTDOUBL(3),PRFXTRA      SAVE XTRA UNIT POINTER          51600021
NOXTRA   EQU   *                                                        51750021
         LA    R15,SCBMBSSA+4           ASSUME PERMANENT DISK   SA52971 51800022
         TM    QCBDSFLG-IEDQQCB(RQCBD),QCBREUS REUS DISK                51900021
         BZ    NON                        NO, NON-REUS                  51950021
*                                         YES, REUS DISK                52000021
         LA    R15,SCBMBSSA             RESET FOR REUSABLE DISK SA52971 52050022
NON      EQU   *                                                        52250021
         MVC   AVTEZERO(3,R15),AVTDOUBL SET NEXT RCD PTR        SA52971 52300022
         LA    R15,AVTDSIOB             POST BUFFER TO IEDQFA           52550021
COREONLY EQU   *                                                        52700021
         MVI   PRFPRI,ED           PUT PRIORITY TO BUFFER               52900021
         ST    R15,PRFQCBA-1              TO BE WRITTEN TO DESTINATION  52950021
         BAL   R14,WRITCPY              PASS BUFFER AND ERB             53000021
*                                         TO DISPATCHER                 53050021
         B     COPYLOOP                 MOVE REST OF MSG                53100021
*                                                                       53150021
CLEANCPY EQU   *                        MSG HAS BEEN COMPLETELY MOVED   53200021
         L     R15,SAVRCQCB             GET ADDR OF QCB TO RETURN       53250021
         ST    R15,LCBRCQCB               BUFFER TO RESTORED            53300021
         MVC   AVTDOUBL+5(3),SAVCOPY    GET ORIGINAL BUFFER             53350021
         L     RPREFIX,AVTDOUBL+4         POSTED TO COPY                53400021
         ST    R15,PRFQCBA-1            POST BUFFER TO DESIGNATED QCB   53450021
         MVC   LCBERBCH,LCBRECAD        RESTORE ERBCH FOR MULT ROUTE    53500021
         MVC   SCBDEOB+1(3),PRFLINK     RESTORE DEOB FOR MULT RT        53520021
         LR    R1,RPREFIX               PASS BUFFER TO BE POSTED        53550021
         BAL   R14,POSTCHAN             PUT BUFFER TO DISPATCHER        53600021
*                                                                       53650021
         LR    RQCBSM,RQCBD             PASS DESTINATION QCB            53700021
         BAL   R14,ACTSCHED             ACTIVATE SEND SCHEDULER         53750021
*                                                                       53800021
         LR    R12,R0                   RESTORE BASE REG        SA61768 53850000
         TM    SCBHBFNO,SCBREUS+SCBNREUS WAS SOURCE Q=MO                53900021
         BNZ   EXIT                       NO, DISK                      53950021
*                                         YES, SOURCE IN CORE           54000021
         MVC   AVTDOUBL+1(3),PRFCRCD    GET ADDR OF CORE Q XTRA         54010022
*                                         SAVED FROM PRFTIC OF          54020022
*                                         ORIGINAL BUFFER               54030022
         CLI   PRFNBUNT,ONE             ANY XTRA UNITS                  54050021
         BNE   GOCKCNT                  YES, GOT EXRA UNITS     SA52971 54100022
*                                         NO, NO XTRAS                  54150021
         TM    PRFSTAT1,PRFNLSTN        IS THIS THE LAST BUFFER         54200021
         BZ    EXIT                       YES, SOURCE WAS A SINGLE      54250021
*                                           UNIT,SINGLE BUF MSG         54300021
*                                         NO, ANOTHER BUFFER            54350021
         MVC   AVTDOUBL+1(3),PRFNTXT    GET ADDR OF NEXT BUFFER         54400021
GOCKCNT  EQU   *                                                        54750021
         L     RPREFIX,AVTDOUBL         GET ADDR OF 2ND UNIT OF MSG     54800021
         SR    R15,R15                  CLEAR WORK REG                  54850021
         IC    R15,PRFTIC               GET MULT. ROUTE COUNT           54900021
         LTR   R15,R15                  IS MSG READY TO BE FREED        54950021
*                                         (IS USE COUNT ZERO)           55000021
         BZ    RETPOL                     YES, FREE CORE Q MSG          55050021
*                                         NO, MORE ROUTING TO GO        55100021
         BCTR  R15,0                    DECREMENT USE COUNT BY 1        55150021
         STC   R15,PRFTIC               SAVE DECREMENTED COUNTER        55200021
         B     EXIT                     FINISHED WITH CORE SOURCE       55250021
*                                         THIS TIME. MAYBE NEXT         55300021
*                                         TIME FREE CORE UNITS.         55350021
RETPOL   EQU   *                        USE COUNT IS ZERO, PASS         55400021
*                                         ALL BUFFERS OF THIS CORE      55450021
*                                         Q MSG TO AVAIL BUF POOL       55500021
         L     RPREFIX,AVTDOUBL+4       GET ADDR OF FIRST UNIT OF MSG   55550021
         LR    R2,RPREFIX               SET FOR LOOP ENTRY      SA52971 55570022
         IC    R15,PRFNBUNT             GET NO. UNITS IN 1ST BUF        55600021
         BCT   R15,DOUNIT               IS 1ST BUF MULTIUNIT            55650021
*                                         YES, BRANCH                   55700021
*                                         NO, CONTINUE                  55750021
         B     GORETBUF                 GO RETURN REST OF BUFS TO POOL  55900021
*                                                                       55950021
DOUNIT   EQU   *                                                        56000021
         MVC   AVTDOUBL+1(3),PRFCRCD    GET 2ND UNIT OF 1ST BUF FROM    56050021
         L     R14,AVTDOUBL               SAVED TIC OF CORE QUEUED      56100021
*                                         ORIGINAL HEADER UNIT          56150021
         MVC   PRFNTXT-IEDQPRF(,R14),PRFNTXT HANG NEXT BUFFER OFF       56200021
*                                         NEW 'HEADER' BUFFER           56250021
         LR    RPREFIX,R14              SHIFT TO WHAT WAS               56300021
*                                         2ND UNIT FIRST BUFFER         56350021
         STC   R15,PRFNBUNT             SET NEW 'BUFFER' TO HAVE 1      56400021
*                                         LESS UNIT THAN ORIGINALLY     56450021
CLRLNK   XC    PRFLINK,PRFLINK          LINK NOT USED TO GO TO          56600021
*                                         2ND BUFFER                    56650021
         LR    R2,RPREFIX               SAVE BUF ADDR                   56700021
DECADDR  EQU   *                        WHEN RETURNING CORE Q UNITS,    56706022
*                                         DECREMENT CORE Q COUNT        56712022
         L     R15,AVTCADDR             GET ORIGINAL CORE Q COUNT       56718022
         SR    R1,R1                    CLEAR WORK REG                  56724022
         IC    R1,PRFNBUNT              GET NO. OF UNITS IN BUFFER      56730022
         SR    R15,R1                   DECREMENT UNIT COUNT            56736022
         ST    R15,AVTCADDR             RESTORE DECREMENTED COUNT       56742022
         BAL   R14,RETBUF               FREE ENTIRE CORE Q MSG          56750021
*                                                                       56800021
GORETBUF EQU   *                                                        56820022
         MVC   AVTDOUBL+1(3),PRFNTXT-IEDQPRF(R2) GET ADDR OF NEXT       56850021
         L     RPREFIX,AVTDOUBL           BUFFER                        56900021
         LA    RPREFIX,0(,RPREFIX)      CLEAR HIGH BYTE                 56950021
         LTR   RPREFIX,RPREFIX          IS THERE ANOTHER BUFFER         57000021
         BNZ   CLRLNK                     YES, ANOTHER BUFFER           57050021
*                                         NO, END OF LOOP               57100021
         B     EXIT                     QUIT COPY                       57200021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57250021
         EJECT                                                          57300021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57350021
*                                                                       57400021
*                       SUBROUTINES                                     57450021
*                                                                       57500021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 57550021
*                                                                       57600021
CALLTNT  EQU   *                        CONVERT TERMNAME TABLE INDEX    57650021
*                                         TO ADDR OF TERMINAL TABLE     57700021
* INPUT - R1 HAS INDEX TO TERMNAME TABLE                                57750021
*        R14 HAS RETURN ADDRESS                                         57800021
*        R15 IS USED FOR SCRATCH                                        57850021
*                                                                       57900021
* OUTPUT - R1 WILL HAVE ADDR OF TERMINAL TABLE                          57950021
*                                                                       58000021
         N     R1,AVTCLRHI              CLEAR HIGH HALF WORD            58050021
         L     R15,AVTRNMPT             GET TNT ENTRY ADDRESS           58100021
         BR    R15                      CALL INDEX LOOKUP ROUTINE       58150021
*                                         WHO RETURNS TO R14,           58200021
*                                         ALREADY SET                   58250021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 58300021
         EJECT                                                          58350021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 58400021
POSTCHAN EQU   *                                                        58450021
* INPUT - R1 HAS ADDR OF ELE TO BE ADDED TO POSTQ, A FIFO Q OF          58500021
*        ELEMENTS TO BE POSTED TO DISPATCHER AT EXIT TIME.              58550021
*        R14 HAS RETURN ADDRESS                                         58600021
*        R15 USED AS WORK REGISTER                                      58650021
*                                                                       58700021
         XC    RECBLINK-IEDQRECB(3,R1),RECBLINK-IEDQRECB(R1)            59900021
*                                       CLEAR LINK FIELD ON NEW ELE     59950021
*                                         TO BECOME LAST ON FIFO Q      60000021
         L     R15,POSTQ+4              GET ADDR OF LAST ELE (IF        60050021
*                                         ANY) ALREADY ON Q             60100021
         ST    R1,POSTQ+4               PUT NEW ELE AT END OF Q         60150021
         NC    POSTQ+1(3),POSTQ+1       WAS FIFO Q EMPTY                60200021
         BNZ   NOTEMPTY                   NO, SOMETHING ON Q            60250021
*                                         YES, Q WAS EMPTY              60300021
         LA    R15,POSTQ-(RECBLINK-1-IEDQRECB) SINCE NEW ELEMENTSA52971 60350022
*                                         IS ONLY ELEMENT       SA52971 60370022
*                                         ON Q, ADDR OF FIRST ELE       60400021
*                                         IS SAME AS ADDR OF LAST       60450021
NOTEMPTY EQU   *                        NEW ELE IS TO BE ADDED TO       60550021
*                                         ELEMENT(S) ALREADY ON Q       60600021
         MVC   RECBLINK-IEDQRECB(3,R15),POSTQ+5 PUT ADDR OF NEW ELE     60650021
*                                         INTO FORWARD POINTER OF       60700021
*                                         OLD LAST ELEMENT              60750021
         BR    R14                      RETURN TO MAIN CODE             60800021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60850021
         EJECT                                                          60900021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60950021
WRITE    EQU   *                                                        61000021
* THIS ROUTINE IS TO PREPARE A BUFFER FOR WRITING, POST IT TO           61050021
* DESTINATION QCB (IEDQHM) TO BE WRITTEN.  IT ALSO POSTS THE ERB TO     61100021
* IGG019RP WITH A LOWER PRIORITY, SO THAT WHEN THE ERB RETURNS,         61150021
* REUS KNOWS THE BUFFER HAS BEEN SERVICED BY DISK I/O.                  61200021
*                                                                       61250021
* INPUT - RPREFIX HAS ADDR OF BUFFER TO BE WRITTEN                      61300021
*        RQCBD IS THE DESTINATION QCB TO RECEIVE THE BUFFER             61350021
*        SCBPRI HAS THE PRIORITY OF SOURCE QCB                          61400021
*        R14 HAS RETURN ADDRESS                                         61450021
*        RLCB HAS LCB WHOSE ERB IS TO BE POSTED TO IGG019RP.            61500021
*        R0 IS USED AS SCRATCH REGISTER                                 61550021
*                                                                       61600021
* POST BUFFER TO POSTQ                                                  61650021
*                                                                       61700021
         MVI   PRFPRI,ED                PUT PRIORITY TO BUFFER          61750021
         ST    RQCBD,PRFQCBA-1          PASS BUFFER TO DESTINATION QCB  61800021
WRITCN   EQU   *                                                        61850021
         MVI   PRFTIC,TIC               MARK IT AS A BUFFER             61900021
         IC    R0,PRFLCB-1                                              61950021
         ST    RLCB,PRFLCB-1            PUT LCB ADDR INTO BUFFER        62000021
         STC   R0,PRFLCB-1                                              62050021
WRITCPY  EQU   *                                                        62100021
         ST    R14,SAVE14               SAVE RETURN ADDRESS             62150021
         NI    PRFSTAT1,X'FF'-PRFDUPLN  NEVER WRITE A DUPLICATE         62200021
*                                         HEADER, REUS OR COPY          62250021
         MVC   SAVSTAT1(1),PRFSTAT1     SAVE STATUS OF BUFFER           62300021
         LR    R1,RPREFIX               PASS ADDR OF BUFFER AS          62350021
*                                         ELE TO BE ADDED TO POSTQ      62400021
         BAL   R14,POSTCHAN             POST BUFFER TO DEST QCB         62450021
*                                                                       62500021
         TM    BITS,PUTBUFB             IS MULTIPLE POST REQUESTED      62550021
         BZ    POSTE                      NO, GO POST ERB AND           62600021
*                                           WAIT FOR THIS ONE BUF       62650021
*                                         YES, TRY TO POST ANOTHER      62700021
*                                           BUFFER, IF AVAILABLE        62750021
         NC    LCBERBCH,LCBERBCH        IS ANOTHER BUFFER AVAILABLE     62800021
         BZ    POSTE                      NO, POST ERB AND WAIT         62850021
*                                         YES, STILL ANOTHER BUF        62900021
         BAL   R14,GETBUF               GO DELINK BUF FROM ERBCH        62950021
*                                                                       63000021
         L     R14,SAVE14               RESTORE RETURN ADDR             63050021
         B     WRITE                    GO POST NEW BUFFER              63100021
*                                                                       63150021
POSTE    EQU   *                                                        63200021
         IC    R0,SCBDESTQ-1            SAVE HIGH BYTE                  63250021
         ST    RQCBD,SCBDESTQ-1         PUT DEST QCB ADDR TO SCB        63300021
         STC   R0,SCBDESTQ-1            RESTORE HIGH BYTE               63320021
*                                                                       63350021
* POST ERB TO IGG019RP                                                  63400021
*                                                                       63450021
         MVI   LCBERBPY,PRILNFRE        SET PRIORITY INTO ERB           63500021
*                                         (MUST BE LOWER THAN PRI       63550021
*                                         USED TO POST BUFFER)          63600021
         LA    R15,WRITQCB              PASS ADDR OF QCB TO GET         63650021
*                                         CONTROL WHEN ERB IS POSTED    63700021
         B     POSTE2                   GO POST ERB                     63750021
*                                                                       63800021
         DS    0F                                                       63850021
WRITQCB  EQU   *-8                      QCB                             63900021
         DC    AL1(DSPMCPL4),AL3(*-1)   STCB TO GET LCB WHEN            63950021
*                                         WRITE IS DONE                 64000021
         USING *,R15                                            SA52971 64050022
         BAL   R14,SETERB               RESET REGISTERS         SA52971 64080022
         DROP  R15                                              SA52971 64110022
*                                                                       64150021
         L     R14,SAVE14               RESTORE RETURN ADDR             64200021
         BR    R14                      RETURN TO MAIN ROUTINE          64250021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 64300021
         EJECT                                                          65500021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 65550021
READHEAD EQU   *                                                        65600021
* TO READ THE FIRST BUFFER OF A MESSAGE, SET SCBDEOB TO ADDRESS OF      65650021
* HEADER DESIRED.  OTHER INPUT IN REGISTERS --                          65700021
* RQCBSM - SOURCE MASTER QCB                                            65750021
* R14 - RETURN ADDRESS                                                  65800021
* R15 - ADDRESS OF RECORD TO BE READ                                    65850021
*                                                                       65900021
         LA    R15,AVTEZERO(,R15)       SET TO GET BEGINNING OF SA52971 65910022
*                                         BUFFER                SA52971 65920022
         ST    R15,SCBDEOB              PASS ADDR OF RECORD             65950021
*                                         TO BE READ                    66000021
         MVI   LCBCHAIN,LCBBFRSZ                                        66050021
         BAL   R1,ERBCT                 SET ERBCT TO DCBBUFOU           66100021
*                                                                       66150021
         MVI   LCBSTAT1,LCBRCLLN+LCBRECVN SET FOR RETRIEVE              66200021
*                                         TO READ ENTIRE BUFFER(S)      66250021
         IC    R0,SCBDESTQ-1            SAVE HIGH BYTE                  66400021
         ST    RQCBSM,SCBDESTQ-1        PASS ADDR OF SOURCE MASTER      66450021
*                                         QCB TO BE READ FROM           66500021
         STC   R0,SCBDESTQ-1            RESTORE HIGH BYTE               66520021
         LR    R1,RQCBSP                GET THIS PRI LVL        SA52971 66550022
         LA    R0,QCBMSIZE(,RQCBSM)     GET FIRST PRI LVL       SA52971 66620022
         SR    R1,R0                    GET OFFSET              SA52971 66690022
         SR    R0,R0                    ZERO DIVIDE REG         SA52971 66760022
         LA    R15,QCBPSIZE             GET PRI LVL SIZE        SA52971 66830022
         DR    R1-1,R15                 DIVIDE FOR INDEX        SA52971 66900022
         STC   R1,SCBPRI                SET PRI LVL INDEX       SA52971 66970022
         NI    SCBQTYPE,X'FF'-(SCBNREUS+SCBREUS+SCBCOREQ+AVTE80) CLEAR  67100021
*                                         TYPE OF Q INDICATOR           67150021
         MVC   LCBSTART,SCBDNSEG        SAVE DNSEG BEFORE READ          67200021
CLR      XC    SCBSRCE(L'SCBSRCE+L'SCBSIZE+L'SCBSTAT1+L'SCBXTRA),SCBSRCE67210021
               E                        CLEAR SCB FIELDS                67220021
CLR1     XC    SCBNTXT(L'SCBNTXT+L'SCBCRCD+L'SCBCHDR),SCBNTXT ** S22024 67230022
*                                       CLEAR SCB FIELDS, SAVING        67240021
*                                         SCBOSEQ                       67250021
         B     SKERBCT                  ERBCT ALREADY SET               67300021
*                                                                       67350021
NOBUF    EQU   *                                                        67400021
         BAL   R1,ERBCT                 SET ERBCT TO DCBBUFOU           67450021
*                                                                       67500021
SKERBCT  EQU   *                                                        67550021
         TM    BITS,COPYBIT             REUS OR COPY                    67558021
         BO    HBFNOSET                   COPY, SKIP RESET HBFNO        67566021
*                                         REUS, SET HBFNO               67574021
         MVI   SCBHBFNO,SCBREUS         SET TO READ FROM REUS DISK      67582021
HBFNOSET EQU   *                                                        67590021
         LA    R15,READONE              REQUEST ERB TO BE RETURNED      67600021
         ST    R15,LCBRCQCB               TO REUS QCB WHEN READ DONE    67650021
         MVC   SCBUNTCT,SCBDEOB         PASS UNIT COUNT                 67700021
         BAL   R1,SWAP                  SWAP LCBSTART+SCBDNSEG          67750021
*                                                                       67800021
         MVC   1(3,R15),SCBSCHDR        SAVE SCHDR BEFORE READ          67850021
*                                         (R15 SET BY ROUTINE 'SWAP')   67900021
         XC    LCBERBST(L'LCBERBST+L'LCBERBCH),LCBERBST CLEAR           67950021
*                                         BOTH LCBERBST+LCBERBCH        68000021
*                                                                       68050021
* POST ERB TO DISK I/O TO REQUEST A READ OF BUFFERS BY IEDQFA.          68100021
*                                                                       68150021
         LA    R15,AVTDSIOB             DISK I/O SUBTASK IS TO          68200021
*                                         RECEIVE THIS ERB              68250021
         B     POSTERB                  GO TPOST ERB                    68300021
*                                                                       68350021
         DS    0F                       WORD BOUNDARY                   68400021
READONE  EQU   *-8                      QCB                             68450021
         DC    AL1(DSPMCPL4),AL3(*-1)   STCB THAT GETS CONTROL          68500021
*                                         WHEN ERB IS POSTED BACK       68550021
*                                         TO REUS WHEN READ IS DONE     68600021
         USING *,R15                                            SA52971 68650022
         BAL   R14,SETERB               PRESET REGISTERS        SA52971 68680022
         DROP  R15                                              SA52971 68710022
*                                                                       68750021
         LA    RPREFIX,0(,RPREFIX)      CLEAR HIGH BYTE                 68800021
         LTR   RPREFIX,RPREFIX          WAS A BUFFER READ               68850021
         BZ    READEROR                   NO, NO BUFFER READ            68900021
*                                         YES, A BUFFER WAS READ        68950021
         TM    LCBERBST,LCBRDERR        WAS RIGHT BUFFER READ           69000021
         BO    READEROR                   NO, READ ERROR                69050021
*                                         YES, GOT GOOD BUFFER          69100021
         BAL   R1,SWAP                  SWAP LCBSTART+SCBDNSEG          69150021
*                                                                       69200021
         MVC   SCBSCHDR,1(R15)          RESTORE SCHDR AFTER READ        69250021
*                                         (R15 SET BY ROUTINE 'SWAP')   69300021
         L     R14,SAVE14               RESTORE ORIGINAL RETURN ADDR    69350021
         TM    PRFSTAT1,PRFNHDRN        IS THIS A HEADER                69400021
         BO    GOTBUF                     NO, NOT HEADER                69450021
*                                         YES,IT IS A HEADER            69500021
         TM    BITS,COPYBIT             REUS OR COPY                    69550021
         BO    GOTBUF                     COPY                          69600021
*                                         REUS                          69650021
         MVC   SCBFEFO,DATFEFO-IEDQDATA(RPREFIX) GET FEFO POINTER       69700021
         B     GOTBUF                   GO TO LINK IN BUFFER     S21903 69750022
*                                                                       69800021
SWAP     EQU   *                                                        70350021
         XC    LCBSTART,SCBDNSEG        SWAP LCBSTART AND SCBDNSEG      70400021
         XC    SCBDNSEG,LCBSTART                                        70450021
         XC    LCBSTART,SCBDNSEG        SWAP LCBSTART AND SCBDNSEG      70500021
         LA    R15,SAVSCHDR             GET ADDR OF A PLACE WHERE       70510022
*                                         TO SAVE SCBSCHDR              70520022
         TM    BITS,COPYBIT             REUS OR COPY                    70550021
         BCR   8,R1                       REUS, GO IT;  RETURN  SA52971 70600022
*                                         COPY                  SA52971 70700022
         MVC   AVTDOUBL+1(3),SAVCOPY    GET ADDR OF BUF POSTED TO COPY  70950021
         L     R15,AVTDOUBL               TO USE ITS FIRST WORD AS      71000021
*                                         A PLACE TO SAVE SCBSCHDR      71050021
         BR    R1                       RETURN TO MAIN CODE             71100021
*                                                                       71150021
ERBCT    EQU   *                                                        71200021
         LA    R0,DUMBUFOU              SET DEFAULT BUFOUT      OX02207 71270054
         TM    BITS,COPYBIT             REUS OR COPY                    71350021
         BO    NOSETDCB                   COPY, DCB ADDR ALREADY SET    71400021
*                                         REUS, SET DCB ADDR            71450021
         MVC   LCBDCBPT+1(L'QCBDCBAD),QCBDCBAD SET DCB ADDRESS  OX02207 71470054
NOSETDCB EQU   *                                                        71650021
         STH   R0,LCBERBCT              REQUEST DEFAULT NO. BUFS        71941021
         BR    R1                       RETURN TO MAIN ROUTINE          71950021
*                                                                       72000021
READEROR EQU   *                                                        72050021
         LA    R15,ABEND2               PASS SUBCODE FOR LOGICAL        72100021
*                                         READ ERROR FROM REUS/COPY     72150021
         BAL   R14,AVTABEND             ABEND SYSTEM 045                72200021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 72250021
         EJECT                                                          72300021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 72350021
GETBUF   EQU   *                                                        72400021
* TO GET A NON-FIRST BUFFER FROM AN LCB.  IF ONE IS NOT THERE, POST     72450021
* ERB TO GET BUFFER(S) READ.                                            72500021
*                                                                       72550021
* INPUT - R14 HAS RETURN ADDRESS                                        72600021
*        RQCBSM HAS SOURCE MASTER QCB ADDR                              72650021
*                                                                       72700021
* OUTPUT - RPREFIX HAS ADDR OF BUFFER                                   72750021
*                                                                       72800021
         L     RPREFIX,LCBERBCH-1       GET BUFFER, IF ANY              72850021
         LA    RPREFIX,0(,RPREFIX)      CLEAR HIGH BYTE                 72900021
         LTR   RPREFIX,RPREFIX          IS BUFFER AVAILABLE             72950021
         BZ    NOBUF                      NO, GO READ BUFFERS           73000021
*                                         YES, GOT ONE                  73050021
GOTBUF   EQU   *                                                        73100021
         ST    RPREFIX,BUFFER           SAVE BUFFER ADDR                73150021
         MVC   LCBERBCH,PRFLINK         HANG NEXT BUFFER IN CHAIN       73200021
*                                         OFF LCB                       73250021
         BR    R14                      RETURN TO CALLER WITH           73300021
*                                         BUFFER IN RPREFIX             73350021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 73400021
         EJECT                                                          73450021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 73500021
BUFPOOL  EQU   *                                                        73550021
* REQUEST A BUFFER (SINGLE UNIT) FROM THE AVAILABLE BUFFER POOL.        73600021
* THIS UNIT MAY BE NEEDED TO EITHER WRITE A CANCELLED HEADER TO         73650021
* AN UNUSED PRI QCB, OR TO WRITE A MESSAGE SERVICED FLAG,               73700021
* OR TO UPDATE A FEFO POINTER                                           73750021
*                                                                       73800021
* OUTPUT - ADDR OF BUFFER UNIT IS RETURNED IN RPREFIX.                  73850021
*                                                                       73900021
* TEMPORARILY SAVE 'BUFFER' AND 'LCBERBCH'                      SA51783 73907022
*                                                               SA51783 73914022
         MVC   BUFFERCN+1(3),BUFFER+1   SAVE ADDRESS OF BAD     SA51783 73921022
*                                       HEADER JUST READ        SA51783 73928022
         MVC   DESTQCB+1(3),LCBERBCH    SAVE ADDR OF 2ND BFR OF SA51783 73935022
*                                       BAD MSG ALREADY READ    SA51783 73942022
         L     RPREFIX,AVTBFREB         GET A UNIT FROM AVAILABLE       73950021
         LA    RPREFIX,0(,RPREFIX)        BUFFER POOL                   74000021
         LTR   RPREFIX,RPREFIX          WAS A BUFFER AVAILABLE          74050021
         BNZ   GOTBUFU                    YES, A BUFFER UNIT IS READY   74100021
*                                         NO, UNIT POOL IS EMPTY        74150021
*                                                                       74200021
* REUS NEEDS A BUFFER UNIT.  POST ERB TO AVAILABLE BUFFER Q TO          74250021
* REQUEST A BUFFER UNIT BE RETURNED TO REUS.                            74300021
*                                                                       74350021
         LA    R15,X0101                REQUEST ONE SINGLE UNIT BUF     74400021
         STH   R15,LCBERBCT               FROM AVAILABLE BUF SUBTASK    74450021
*                                                                       74500021
* LCBERBCT IS A 2 BYTE FIELD.  THE UPPER BYTE IS THE NUMBER OF          74550021
* BUFFERS REQUESTED.  THE LOWER BYTE IS THE NUMBER OF UNITS PER         74600021
* BUFFER TO BE BUILT.                                                   74650021
*                                                                       74700021
         LA    R15,UNITQCB              GET ADDR OF QCB TO GET          74900021
         ST    R15,LCBRCQCB             CONTROL WHEN UNIT IS            74950021
*                                         PASSED BACK TO REUS           75000021
         OI    LCBERBST,LCBPRCPG        ERB TO BE POSTED TO QCB         75050021
*                                         IN LCBRCQCB                   75100021
         LA    R15,AVTBFREB             GET ADDR OF BUFFER REQUEST      75150021
POSTERB  EQU   *                                                        75200021
         ST    R14,SAVE14               SAVE RETURN ADDR                75250021
         MVI   LCBERBPY,PRIINTRQ        SET PRIORITY INTO ERB           75300021
POSTE2   EQU   *                                                        75350021
         ST    R15,LCBERBQB-1           SET QCB TO POST ERB TO          75400021
         LA    R1,LCBERB                PASS ADDR OF ERB TO POSTQ       75450021
         BAL   R14,POSTCHAN             HANG ERB ONTO POSTQ TO GO       75500021
*                                         TO DISPATCHER AT EXIT         75550021
         B     LOOP                     GO SERVICE ANOTHER TERMINAL     75600021
*                                                                       75650021
         DS    0F                                                       75700021
UNITQCB  EQU   *-8                      QCB TO RECEIVE UNIT FROM        75750021
         DC    AL1(DSPMCPL4),AL3(*-1)     AVAIL BUF POOL                75800021
*                                                                       75850021
         USING *,R15                                            SA52971 75900022
         BAL   R14,SETERB               PRESET REGS             SA52971 75930022
         DROP  R15                                              SA52971 75960022
*                                                                       76000021
*                                                                       76010021
* 'SETERB' WILL CLOBBER 'BUFFER' AND SET RPREFIX TO NEW EMPTY UNIT      76020021
* FROM FREEPOOL.                                                        76030021
* RESTORE 'BUFFER' AND 'LCBERBCH' FROM THEIR TEMPORARY HIDING PLACE.    76040021
*                                                                       76050021
         MVC   BUFFER+1(3),BUFFERCN+1   RESTORE ADDR OF BAD HEADER      76060021
         MVC   LCBERBCH,DESTQCB+1       RESTORE ADDR OF 2ND BUFFER      76070021
*                                         OF BAD MSG ALREADY READ       76080021
         L     R14,SAVE14               RESTORE RETURN ADDR             76100021
         BR    R14                      RETURN TO MAIN ROUTINE          76150021
*                                         TO CALLER                     76200021
*                                                                       76250021
GOTBUFU  EQU   *                        REUS REMOVED UNIT FROM POOL     76300021
         MVC   AVTBFREB+1(3),PRFLINK    LEAVE OTHER UNITS IN POOL       76350021
         LH    R15,AVTAVFCT             GET COUNT OF AVAILABLE UNITS    76400021
         N     R15,AVTCLRHI             FORCE POSITIVE                  76450021
         BCTR  R15,0                    DECREMENT COUNT BY ONE          76500021
         STH   R15,AVTAVFCT             RESTORE NEW COUNT               76550021
         MVI   PRFNBUNT,ONE             SET TO SINGLE UNIT BUFFER       76600021
         XC    PRFTIC+1(3),PRFTIC+1     CLEAR XTRA UNIT ADDR            76650021
         BR    R14                      RETURN TO MAIN CODE             76700021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 76750021
         EJECT                                                          76800021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 76850021
FINDHM03 EQU   *                                                        76900021
* IS THE ONLY MSG ON THIS PRIORITY QCB BEING SENT, IF SO GET SCB TO R2  76950021
* IEDQHM03 EXPECTS CERTAIN REGISTERS TO BE PRESET -                     77000021
*        R13   AVTSAVE2                                                 77050021
*        R7    MASTER QCB                                               77100021
*        R8    PRIORITY QCB                                             77150021
*        R9    ADDR OF PREVIOUS MESSAGE HEADER                  SA52971 77160022
*        R10   IN NON-ZERO, ADDR OF THING TO GO INTO DATFEFO    SA52971 77170022
*              IF ZERO, REQUEST TO KNOW IF MESSAGE IN R9 BEING  SA52971 77180022
*                SENT                                           SA52971 77190022
*        R14   RETURN ADDR                                              77200021
*        R15   ENTRY TO IEDQHM03                                        77250021
*                                                                       77300021
         L     R15,AVTHM02              THE ADDRESS OF HM03 IS IN       77450021
         SH    R15,AVTHA4                 THE WORD JUST PRECEEDING      77500021
         L     R15,0(,R15)                THE ENTRY TO HM02             77550021
         BR    R15                      GO TO HM03              SA52971 77600022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 79500021
         EJECT                                                          79550021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 79600021
ACTSCHED EQU   *                                                        79650021
* USING COMMON CODE IN IEDQHM, ACTIVATE SCHEDULER                       79700021
* RQCBSM HAS ADDR OF MASTER QCB.                                        79750021
*                                                                       79800021
         TM    QCBDSFLG,QCBTSQ         TSO OR MIXED DEST QCB     S22029 79807022
         BZ    GETHM                   NO GET IEDQHM FROM QCB    S22029 79814022
         L     R15,AVTTSOPT            GET V(IEDQHM) FROM        S22029 79821022
         L     R15,TSIDEST-IEDQTSI(R15) TSINPUT QCB              S22029 79828022
         B     FOUNDHM                 IEDQHM NOW FOUND          S22029 79835022
GETHM    EQU   *                                                 S22029 79842022
         L     R15,QCBSTCHN-1           GET FIRST STCB ON DEST QCB      79850021
         CLI   0(R15),DSPMCPL6          IS IEDQHM THERE                 79900021
         BE    FOUNDHM                    YES, V(IEDQHM) IN R15         79950021
*                                         NO, HM MUST BE IN NEXT WORD   80000021
         L     R15,QCBSLINK-1           GET V(IEDQHM) IN R15            80050021
FOUNDHM  EQU   *                                                        80100021
         LR    R0,R12                   SAVE BASE REG           SA61768 80150000
         LA    R12,HMBASE(,R15)         SET HM BASE 6 PAST V(HM)        80850021
         L     R15,0(,R15)              1ST WORD OF HM HAS ADDR OF      80900021
*                                       SPECIAL ENTRY POINT             80950021
         BR    R15                      GO TELL HM TO ACTIVATE          81000021
*                                       SEND SCHEDULER                  81050021
*                                                                       81100021
*                                         HM RETURNS TO R14,ALREADY     81150021
*                                         SET BY 'BAL' IN MAIN CODE     81200021
*        LR    R12,R0                   MAIN CODE MUST DO THIS  SA61768 81250000
*        IMMEDIATELY UPON RETURN                                SA61768 81300000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 81350021
         EJECT                                                          81400021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 81450021
RETBUF   EQU   *                        RETURN BUFFER TO AVAILABLE      81500021
*                                         BUFFER POOL                   81550021
* INPUT - RPREFIX HAS ADDR OF BUFFER TO BE RETURNED.                    81600021
*        R14 HAS RETURN ADDRESS                                         81650021
*                                                                       81700021
* OUTPUT - THE BUFFER IS ENQUEUED ONTO 'POSTQ' TO BE POSTED TO          81750021
*        BUFFER RETURN AT EXIT TIME.                                    81800021
*        R15 AND R1 USED AS WORK REGS.                                  81850021
*                                                                       81900021
         LA    R15,AVTBFRTB             GET ADDR OF BUFFER RETURN QCB   82400021
         ST    R15,PRFQCBA-1              TO 1ST WORD OF BUFFER         82450021
         MVI   PRFPRI,PRIBFRTB          SET PRIORITY FOR RETURNING      82500021
*                                         A BUFFER                      82550021
         LR    R1,RPREFIX               PASS ADDR OF BUFFER TO          82600021
*                                         TO BE POSTED TO DISPATCHER    82650021
         ST    R14,SAVE14               PRESERVE RETURN ADDR            82700021
         L     RPREFIX,PRFLINK-1        GET ADDR OF NEXT BUF, IF ANY    82750021
         BAL   R14,POSTCHAN             GO FREE BUF                     82800021
*                                                                       82850021
         L     R14,SAVE14               RESTORE RETURN ADDR             82900021
         LA    RPREFIX,0(,RPREFIX)      CLEAR HIGH BYTE                 82950021
         LTR   RPREFIX,RPREFIX          IS THERE A NTXT BUFFER          83000021
         BCR   Z,R14                      NO, RETURN TO MAIN ROUTINE    83050021
*                                         YES, STILL ANOTHER NTXT       83100021
         B     RETBUF                   GO POST BUF TO AVAIL BUF Q      83150021
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 83200022
         EJECT                                                          83250022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 83260022
SETERB   EQU   *                                                        83270022
* AT CERTAIN ENTRY POINTS, THIS ROUTINE IS CALLED TO PRESET CERTAIN     83280022
* REGISTERS.  R11 ALREADY POINTS TO DISPATCHER.  RBASE IS PROG BASE.    83290022
*                                                                       83300022
* INPUT - R1 IS THE ELE POSTED TO REUS BY DISPATCHER, THE ERB           83310022
*        R14 IS RETURN ADDRESS                                  SA52971 83320022
         L     RBASE,AVTIA              SET PROGRAM BASE                83400022
         SH    R1,ERBFS                 BACK UP FROM ERB TO LCB         83450022
         MVC   BUFFER+1-IEDQLCB(3,R1),LCBERBCH-IEDQLCB(R1) GET          83460022
*                                         BUFFER RETURNED               83470022
*                                         ON ERB                        83480022
         LR    RLCB,R1                  SET LCB BASE                    83490022
         LM    RPREFIX,RQCBD,BUFFER     SET SEVERAL REGISTERS           83500022
*                                         RPREFIX                       83510022
*                                         RQCBSM                        83520022
*                                         RQCBSP                        83530022
*                                         RQCBD                         83540022
         L     RSCB,LCBSCBA-1           SET SCB BASE                    83550022
         BR    R14                      RETURN                  SA52971 83560022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 83650021
WRTOP    EQU   *                                                SA52971 83653022
         TIME  DEC                      GET TIME                SA52971 83656022
         ST    R0,TIME                  STORE TIME IN WORKAREA  SA52971 83659022
         UNPK  TIME(UTLEN),TIME(PTLEN)  UNPACK THE TIME         SA52971 83662022
         LH    RTIME,TIME+4             MOVE SECONDS            SA52971 83665022
         STH   RTIME,TIME+6               TO RIGHT              SA52971 83668022
         LH    RTIME,TIME+2             PICK UP MINUTES         SA52971 83671022
         STC   RTIME,TIME+4             STORE SECOND BYTE       SA52971 83674022
         SRL   RTIME,BYTELEN            SHIFT AND               SA52971 83677022
         STC   RTIME,TIME+3             STORE FIRST BYTE        SA52971 83680022
         MVI   TIME+2,AVTEPER           STORE PERIODS           SA52971 83683022
         MVI   TIME+5,AVTEPER             IN TIME               SA52971 83686022
         LA    R1,MESSAGE1              GET MESSAGE ADDRESS     SA52971 83689010
         WTO   MF=(E,(1))               WRITE IT                SA52971 83692022
         BR    R14                      RETURN TO CALLER        SA52971 83695022
         EJECT                                                          83696022
EEPOST   EQU   *                                                SA51783 83697022
         SPACE 3                                                        83698022
****************************************************************SA51783 83699022
*                                                              *SA51783 83700022
* THIS SUBROUTINE IS USED TO SET UP THE FIELDS NECESSARY TO    *SA51783 83701022
* POST A BUFFER TO IEDQFA TO REQUEST A CPB.                    *SA51783 83702022
* R0 CONTAINS THE ADDRESS OF THE SUBROUTINE TO BE BRANCHED TO  *SA51783 83703022
* OUT OF IEDQFA WHEN A CPB HAS BEEN OBTAINED.                  *SA51783 83704022
* R1 CONTAINS THE ADDRESS OF THE QCB THAT THE ERB SHOULD BE    *SA51783 83705022
* POSTED TO WHEN THE SUBROUTINE POSTS THE ERB.                 *SA51783 83706022
*                                                              *SA51783 83707022
****************************************************************SA51783 83708022
         SPACE 3                                                        83709022
         ST    R0,PRFTIC                PUT ADDR OF SUBRTN TO   SA51783 83710022
*                                       GET CONTROL IN THE BFR  SA51783 83711022
         MVI   PRFTIC,TIC               MARK IT AS A BUFFER     SA51783 83712022
         MVI   PRFPRI,PRIFEFO           PRIORITY TO GET A CPB   SA51783 83713022
         ST    RLCB,PRFLCB-1            PASS LCB ADDR           SA51783 83714022
         MVI   PRFNBUNT,ONE             SET AS SINGLE UNIT BFR  SA51783 83715022
         ST    R1,LCBERBQB-1            SET QCB FOR SUBROUTINE  SA51783 83716022
*                                       TO POST THE ERB TO      SA51783 83717022
         MVI   LCBERBPY,PRIINTRQ        SET PRIORITY FOR ERB    SA51783 83718022
         LA    R15,AVTDSIOB             ADDR OF DISK I/O QCB    SA51783 83719022
         ST    R15,PRFQCBA-1            STORE IN BUFFER         SA51783 83720022
         LR    R1,RPREFIX               PASS BUFFER AS ELEMENT  SA51783 83721022
         ST    R14,SAVE14               SAVE RETURN ADDR        SA51783 83722022
         BAL   R14,POSTCHAN             TPOST BFR TO DISPATCHER SA51783 83723022
         SPACE                                                          83724022
         L     R14,SAVE14               RESTORE RETURN ADDR     SA51783 83725022
         BR    R14                      RETURN                  SA51783 83726022
         EJECT                                                          83727022
NEWPFEFO EQU   *                                                SA51783 83728022
         SPACE 3                                                        83729022
****************************************************************SA51783 83730022
*                                                              *SA51783 83731022
* THIS SUBROUTINE IS BRANCHED TO OUT OF IEDQFA AFTER A REQUEST *SA51783 83732022
* FOR A CPB BY THE REUSABILITY SUBTASK HAS BEEN FULFILLED.  IT *SA51783 83733022
* BUILDS THE CPB AND DATA FIELDS NECESSARY TO WRITE A          *SA51783 83734022
* CANCELLED MESSAGE AT THE DNHDR SLOT WHICH WE KNOW AT THIS    *SA51783 83735022
* TIME IS IN A GOOD ZONE.  THIS CANCELLED MESSAGE IS MADE      *SA51783 83736022
* PFEFO AND ITS FEFO PTR POINTS TO THE OLD PFEFO.  THEREFORE,  *SA51783 83737022
* WE HAVE INSURED THAT PFEFO IS IN A GOOD ZONE AND THAT THERE  *SA51783 83738022
* IS AT LEAST ONE MESSAGE ON THE QUEUE THAT IS IN A GOOD ZONE. *SA51783 83739022
* THIS FORCES LFEFO TO BE UPDATED TO A MESSAGE IN A GOOD ZONE  *SA51783 83740022
* IF NECESSARY.                                                *SA51783 83741022
* THIS SUBROUTINE ALSO POSTS THE ERB BACK TO THE QCB ALREADY   *SA51783 83742022
* SET BY THE REUSABILITY SUBTASK BEFORE THE EE POST.           *SA51783 83743022
* THE ERB IS POSTED IN ORDER TO GIVE CONTROL BACK TO           *SA51783 83744022
* REUSABILITY TO CONTINUE PROCESSING THE QUEUE.                *SA51783 83745022
* THE EE BUFFER IS THEN RETURNED TO BUFFER RETURN BY A BRANCH  *SA51783 83746022
* TO DSPPOSTR WITH REGISTER 14 SET TO THE RETURN ADDR IN       *SA51783 83747022
* IEDQFA TO ENQUEUE THE CPB.                                   *SA51783 83748022
*                                                              *SA51783 83749022
****************************************************************SA51783 83750022
         SPACE 3                                                        83751022
         DROP  RBASE                    DROP BASE FOR 19RP      SA51783 83752022
         USING *,R15                    BASE FOR THIS SUBROUTINESA51783 83753022
         USING IEDQCPB,RCPB             CPB                     SA51783 83754022
         SPACE 3                                                        83755022
****************************************************************SA51783 83756022
* INITIALIZE REGISTERS                                         *SA51783 83757022
****************************************************************SA51783 83758022
         SPACE                                                          83759022
         L     RCPB,PRFTIC              ADDR OF CPB FROM IEDQFA SA51783 83760022
         L     RDAT,CPBXREAF            UNIT ADDR               SA51783 83761022
         L     RLCB,PRFLCB-1            LCB ADDR                SA51783 83762022
         L     RSCB,LCBSCBA-1           SCB ADDR                SA51783 83763022
         LM    RQCBSM,RQCBSP,SOURCQCB   MASTER AND PRI QCB      SA51783 83764022
         EJECT                                                          83765022
****************************************************************SA51783 83766022
* BUILD A CANCELLED HEADER                                     *SA51783 83767022
****************************************************************SA51783 83768022
         SPACE                                                          83769022
         DROP  RPREFIX                  DROP EE BFR POSTED TO FASA51783 83770022
         USING IEDQPRF,RDAT             CANCELLED HDR REG       SA51783 83771022
         SPACE                                                          83772022
         ST    RLCB,PRFLCB-1            PUT LCB ADDR IN BUFFER  SA51783 83773022
         MVC   PRFPLQCB,SCBPRI          SET PRIORITY LEVEL      SA51783 83774022
         MVI   PRFTIC,TIC               MARK UNIT AS BUFFER     SA51783 83775022
*                                       CLEAR PREFIX            SA51783 83776022
         XC    PRFSRCE(PRFDEST-PRFSRCE),PRFSRCE                 SA51783 83777022
         MVC   PRFDEST,SOURCTNT         SET SAVED DEST TNT INDX SA51783 83778022
         OI    PRFSTAT1,PRFCNCLN        MARK MSG CANCELLED      SA51783 83779022
         LH    R10,AVTKEYLE             UNIT SIZE               SA51783 83780022
         STH   R10,PRFSIZE              SET PRFSIZE             SA51783 83781022
         LA    R9,AVTHDRSZ              HEADER SIZE             SA51783 83782022
         N     R10,AVTCLRHI             CLEAR HI HALF           SA51783 83783022
         SR    R10,R9                   GET AMOUNT OF DATA      SA51783 83784022
         MVI   PRFSHDR,CHAR             GET FILL CHARACTER      SA51783 83785022
         BCTR  R10,0                    ADJUST DATA SIZE FOR EX SA51783 83786022
         BCTR  R10,0                    ADJUST FOR 1ST CHAR DONESA51783 83787022
         EX    R10,FILL2                PUT FILL CHAR IN MSG    SA51783 83788022
         MVC   PRFCRCD,QCBDNHDR         SET CURRENT RCD NUMBER  SA51783 83789022
         MVC   PRFHQBCK,QCBQBACK        SET Q BACK POINTER      SA51783 83790022
         MVC   QCBQBACK,PRFCRCD         UPDATE Q BACK POINTER   SA51783 83791022
         MVC   QCBPQBCK,PRFCRCD         UPDATE PRI Q BACK PTR   SA51783 83792022
         MVC   QCBDNHDR,AVTRADDR+ONE    UPDATE NEXT HEADER SLOT SA51783 83793022
         MVC   PRFNHDR,QCBDNHDR         SET NEXT HEADER         SA51783 83794022
         L     R10,AVTRADDR             BUMP NEXT               SA51783 83795022
         LA    R10,INCR(,R10)           AVAILABLE RECORD        SA51783 83796022
         ST    R10,AVTRADDR             BY FOUR                 SA51783 83797022
         SPACE 3                                                        83798022
****************************************************************SA51783 83799022
* BUILD DATA FIELDS                                            *SA51783 83800022
****************************************************************SA51783 83801022
         SPACE                                                          83802022
         DROP  RDAT                     DROP CANCELLED HDR REG  SA51783 83803022
         USING IEDQDATA,RDAT            DATA FIELDS REG         SA51783 83804022
         SPACE                                                          83805022
         MVI   DATFLAGS,DATCNCLD        MARK AS CANCELLED       SA51783 83806022
         MVC   DATFEFO,QCBPFEFO         POINT TO PREVIOUS PFEFO SA51783 83807022
         XC    DATSEQOT,DATSEQOT        ZERO SEQ OUT NUMBER     SA51783 83808022
         EJECT                                                          83809022
****************************************************************SA51783 83810022
* BUILD CPB                                                    *SA51783 83811022
****************************************************************SA51783 83812022
         SPACE                                                          83813022
         DROP  RDAT                     DROP DATA FIELDS REG    SA51783 83814022
         USING IEDQPRF,RDAT             CANCELLED HDR REG       SA51783 83815022
         SPACE                                                          83816022
         MVC   CPBADDR+1(3),PRFCRCD     SET RECORD ADDR         SA51783 83817022
         MVI   CPBRDWR,CPBWRKC          SET WRITE KEY AND DATA  SA51783 83818022
         MVI   CPBXDWR,CPBWRC           SET WRITE DATA          SA51783 83819022
         SPACE                                                          83820022
         MVC   QCBPFEFO,PRFCRCD         SET THIS AS PFEFO       SA51783 83821022
         SPACE 3                                                        83822022
****************************************************************SA51783 83823022
* POST THE ERB BACK TO THE QCB ALREADY SET BY REUSABILITY      *SA51783 83824022
****************************************************************SA51783 83825022
         SPACE                                                          83826022
         DROP  RDAT                     DROP CANCELLED HDR REG  SA51783 83827022
         USING IEDQPRF,RPREFIX          EE BFR POSTED TO FA     SA51783 83828022
         SPACE                                                          83829022
         ST    R14,PRFQCBA-1            SAVE RETURN ADDR IN FA  SA51783 83830022
         LA    R1,LCBERB                SET ERB AS ELEMENT      SA51783 83831022
         BAL   R14,DSPPOSTR             POST ERB BACK TO REUS   SA51783 83832022
         SPACE                                                          83833022
         L     R14,PRFQCBA-1            RESTORE FA'S RETURN ADDRSA51783 83834022
         SPACE 3                                                        83835022
****************************************************************SA51783 83836022
* RETURN THE BUFFER POSTED WITH EE PRIORITY TO IEDQFA TO       *SA51783 83837022
* REQUEST A CPB TO BUFFER RETURN AND GO TO IEDQFA TO WRITE     *SA51783 83838022
* THE NEW CANCELLED HEADER TO DISK.                            *SA51783 83839022
****************************************************************SA51783 83840022
         SPACE                                                          83841022
         MVI   PRFPRI,PRIBFRTB          SET RETURN BFR PRIORITY SA51783 83842022
         LA    R10,AVTBFRTB             BFR RETURN QCB ADDR     SA51783 83843022
         ST    R10,PRFQCBA-1            PUT IT IN BUFFER        SA51783 83844022
         LR    R1,RPREFIX               SET BUFFER AS ELEMENT   SA51783 83845022
         LR    R15,RCPB                 PASS CPB BACK TO IEDQFA SA51783 83846022
         B     DSPPOSTR                 POST BUFFER TO BUFFER   SA51783 83847022
*                                       RETURN AND RETURN TO    SA51783 83848022
*                                       IEDQFA ON REGISTER 14   SA51783 83849022
*                                       TO WRITE MSG TO DISK    SA51783 83850022
****************************************************************SA51783 83851022
* MOVE FILL CHARACTERS INTO CANCELLED HEADER                   *SA51783 83852022
****************************************************************SA51783 83853022
         SPACE                                                          83854022
         DROP  RPREFIX                  DROP EE BFR POSTED TO FASA51783 83855022
         USING IEDQPRF,RDAT             CANCELLED HDR REG       SA51783 83856022
         SPACE                                                          83857022
FILL2    MVC   PRFSHDR+ONE(AVTEZERO),PRFSHDR                    SA51783 83858022
         SPACE                                                          83859022
         DROP  RCPB                     DROP CPB                SA51783 83860022
         DROP  RDAT                     DROP CANCELLED HDR REG  SA51783 83861022
         DROP  R15                      DROP SUBROUTINE BASE    SA51783 83862022
         EJECT                                                          83863022
UPFEFO   EQU   *                                                SA51783 83864022
         SPACE 3                                                        83865022
****************************************************************SA51783 83866022
*                                                              *SA51783 83867022
* THIS SUBROUTINE IS BRANCHED TO OUT OF IEDQFA AFTER A REQUEST *SA51783 83868022
* FOR A CPB BY THE REUSABILITY SUBTASK HAS BEEN FULFILLED.  IT *SA51783 83869022
* BUILDS THE CPB AND DATA FIELDS NECESSARY TO CHANGE THE FEFO  *SA51783 83870022
* POINTER IN THE DATA FIELDS OF THE MESSAGE THAT POINTS TO THE *SA51783 83871022
* BAD MESSAGE FOUND.  THE FEFO POINTER SHOULD POINT TO THE     *SA51783 83872022
* MESSAGE POINTED TO BY THE BAD MESSAGE OR ZERO IF IT IS LAST  *SA51783 83873022
* ON THE QUEUE.                                                *SA51783 83874022
* THIS SUBROUTINE ALSO POSTS THE ERB BACK TO THE QCB ALREADY   *SA51783 83875022
* SET BY THE REUSABILITY SUBTASK BEFORE THE EE POST.           *SA51783 83876022
* THE ERB IS POSTED IN ORDER TO GIVE CONTROL BACK TO           *SA51783 83877022
* REUSABILITY TO CONTINUE PROCESSING THE QUEUE.                *SA51783 83878022
* THE EE BUFFER IS THEN RETURNED TO BUFFER RETURN BY A BRANCH  *SA51783 83879022
* TO DSPPOSTR WITH REGISTER 14 SET TO THE RETURN ADDR IN       *SA51783 83880022
* IEDQFA TO ENQUEUE THE CPB.                                   *SA51783 83881022
*                                                              *SA51783 83882022
****************************************************************SA51783 83883022
         SPACE 3                                                        83884022
         USING *,R15                    BASE FOR THIS SUBRNT    SA51783 83885022
         USING IEDQCPB,RCPB             CPB                     SA51783 83886022
         USING IEDQPRF,RPREFIX          EE BFR POSTED TO IEDQFA SA51783 83887022
         USING IEDQDATA,RDAT            DATA FIELDS             SA51783 83888022
         SPACE 3                                                        83889022
****************************************************************SA51783 83890022
* INITIALIZE REGISTERS                                         *SA51783 83891022
****************************************************************SA51783 83892022
         SPACE                                                          83893022
         L     RCPB,PRFTIC              ADDR OF CPB FROM IEDQFA SA51783 83894022
         L     RDAT,CPBXREAF            UNIT ADDR               SA51783 83895022
         L     RLCB,PRFLCB-1            LCB ADDR                SA51783 83896022
         L     RSCB,LCBSCBA-1           SCB ADDR                SA51783 83897022
         SPACE 3                                                        83898022
****************************************************************SA51783 83899022
* BUILD CPB TO CHANGE DATFEFO                                  *SA51783 83900022
****************************************************************SA51783 83901022
         SPACE                                                          83902022
         MVI   CPBRDWR,CPBWRC           WRITE DATA COMMAND      SA51783 83903022
         MVI   CPBXDWR,CPBNOPC          NOP COMMAND             SA51783 83904022
         MVC   CPBADDR+1(3),IDBADPTR    SET LAST GOOD MSG'S RRN SA51783 83905022
         EJECT                                                          83906022
****************************************************************SA51783 83907022
* BUILD DATA FILEDS                                            *SA51783 83908022
****************************************************************SA51783 83909022
         SPACE                                                          83910022
         MVC   DATFLAGS,SCBMACR         SET SAVED DATA FLAGS    SA51783 83911022
         MVC   DATSEQOT,SCBMACR+ONE     SET SAVED SEQ OUT NUM   SA51783 83912022
         MVC   DATFEFO,SCBFEFO          SET BAD MSG'S FEFO PTR  SA51783 83913022
         SPACE 3                                                        83914022
****************************************************************SA51783 83915022
* POST THE ERB BACK TO THE QCB ALREADY SET BY REUSABILITY      *SA51783 83916022
****************************************************************SA51783 83917022
         SPACE                                                          83918022
         ST    R14,PRFQCBA-1            SAVE RETURN ADDR IN FA  SA51783 83919022
         LA    R1,LCBERB                SET ERB AS ELEMENT      SA51783 83920022
         BAL   R14,DSPPOSTR             POST ERB BACK TO REUS   SA51783 83921022
         SPACE                                                          83922022
         L     R14,PRFQCBA-1            RESTORE FA'S RETURN ADDRSA51783 83923022
         SPACE 3                                                        83924022
****************************************************************SA51783 83925022
* RETURN THE BUFFER POSTED WITH EE PRIORITY TO IEDQFA TO       *SA51783 83926022
* REQUEST A CPB TO BUFFER RETURN AND GO TO IEDQFA TO UPDATE    *SA51783 83927022
* THE FEFO POINTER OF THE LAST GOOD MESSAGE.                   *SA51783 83928022
****************************************************************SA51783 83929022
         SPACE                                                          83930022
         MVI   PRFPRI,PRIBFRTB          SET RETURN BFR PRIORITY SA51783 83931022
         LA    R10,AVTBFRTB             BFR RETURN QCB ADDR     SA51783 83932022
         ST    R10,PRFQCBA-1            PUT IT IN BUFFER        SA51783 83933022
         LR    R1,RPREFIX               SET BUFFER AS ELEMENT   SA51783 83934022
         LR    R15,RCPB                 PASS CPB BACK TO IEDQFA SA51783 83935022
         B     DSPPOSTR                 POST BUFFER TO BUFFER   SA51783 83936022
*                                       RETURN AND RETURN TO    SA51783 83937022
*                                       IEDQFA ON REGISTER 14   SA51783 83938022
*                                       TO WRITE DATA FIELDS    SA51783 83939022
         DROP  RDAT                     DROP DATA FIELDS BASE   SA51783 83940022
         DROP  RCPB                     DROP CPB BASE           SA51783 83941022
         DROP  R15                      DROP SUBROUTINE BASE    SA51783 83942022
         EJECT                                                          83943022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 83944022
*                                                                     * 83945022
*                       CONSTANTS                                     * 83946022
*                                                                     * 83947022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 83948022
*                                                                       84000021
FILL     MVC   PRFSHDR+1(0),PRFSHDR     FILL TEXT OF CANCEL HEADER      84100021
ERBFS    DC    AL2(LCBERB-IEDQLCB)      OFFSET INTO LCB OF ERB          84150021
FLAG     DS    0X                       FLAG BITS                       84200021
*                       BIT DEFINITIONS                                 84250021
RUFTN    EQU   X'40'                    REUS FIRST TIME SWITCH          84300021
*                                         NEXT ZONE READY FOR REUS      84350021
POSTQ    DC    2F'0'                    FIFO Q OF ELE TO BE DISPATCHED  84400021
LENTNT   DC    F'0'                     INDEX TO TERMNAME TABLE         84450021
BOUNDS3  DC    A(0)                     START OF 'CURRENT ZONE'         84500021
BOUNDS2  DC    A(0)                     START OF 'CANCEL XONE'          84550021
BOUNDS5  DC    A(0)                     START CURRENT ZONE WRAP@OS77388 84551000
BOUNDS4  DC    A(0)                     START CANCEL ZONE WRAP @OS77388 84552000
MESSAGE1 DS    0F                                               SA52971 84553010
         DC    H'32'                    MESSAGE LENGTH         @OS77826 84556000
         DC    X'8000'                  MCS FLAGS              @OY11984 84559091
         DC    C'IED159I REUS '         MESSAGE TEXT            SA52971 84562022
NAMETAG  DC    CL7' '                   REUS DESCRIPTOR         SA52971 84565022
TIME     DC    CL8' '                   TIME STAMP              SA52971 84568022
         DC    X'1000'                  DESCRIPTOR CODES       @OY11984 84569091
         DC    X'0100'                  ROUTING CODES          @OY11984 84570091
START    DC    C'STARTS'                REUS STARTED            SA52971 84571022
QUIT     DC    C'QUITS '                REUS ENDED              SA52971 84574022
FULL     DC    C'FULL  '                REUS FULL               SA52971 84577022
END      DC    C'ENDS  '                REUS ENDED              SA52971 84580022
BYTELEN  EQU   8                        SHIFT FACTOR FOR ONE BT SA52971 84583022
MLN      EQU   6                        MESSAGE TAG LENGTH      SA52971 84586022
UTLEN    EQU   7                        LENGTH OF TIME UNPACKED SA52971 84589022
PTLEN    EQU   4                        LENGTH OF TIME PACKED   SA52971 84592022
INCR     EQU   4                        TO BUMP AVTRADDR        SA51783 84594022
SEQLEN   EQU   2                        LENGTH OF SEQ OUT NUM   SA51783 84596022
TWENTY4  EQU   24                       OFFSET INTO PEWASAVE   @SA64353 84596510
TWENTY8  EQU   28                       OFFSET INTO PEWA SAVE  @SA64353 84597010
THIRTY2  EQU   32                       OFFSET INTO PEWASAVE   @SA64353 84597510
THIRTY6  EQU   36                       OFFSET INTO PEWASAVE   @SA64353 84598010
ZERO     EQU   X'00'                    CONSTANT               @SA64353 84598510
STOPQ    EQU   X'14'                    DISABLED ENTRY R.C.    @SA64353 84599010
*                                                                       84600021
*                                                                       84650021
*                                                                       84700021
         REUSPOOL 6                                             SA52971 85100022
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 85600021
*                                                                       85650021
*                       DSECTS                                          85700021
*                                                                       85750021
         TAVTD ,                                                SA52971 85800022
         TSCBD                                                          85900021
LASTNOFF EQU   X'04'                    SCBFEFO HAS BEEN FORCED SA52971 85906022
*                                         TO ZEROES BY REUS     SA52971 85912022
*                                         BECAUSE THE MESSAGE   SA52971 85918022
*                                         WHICH WAS LAST FEFO   SA52971 85924022
*                                         WAS COPIED BY REUS ANDSA52971 85930022
*                                         THIS ONE WAS FORCED TOSA52971 85936022
*                                         LAST                  SA52971 85942022
         TRECBD                                                         85950021
         TTSID                                                          85970022
         TTRMD                                                          86000021
         TPRFD                                                          86050021
         TDATAD                                                         86100021
         TPRIOR                                                         86150021
ED       EQU   PRIFEFO-1                POST BUFS TO DEST QCB           86170021
         TDISPD                                                         86200021
         TTNTD                                                          86250021
         TQCBD                                                          86300021
         TPEWAD                                                SA63961  86320052
         DCBD  DSORG=TX                                                 86350021
         EJECT                                                          86360022
         TCPBD 3330                                             SA51783 86370022
         EJECT                                                          86380022
         TLCBD                                                          86400021
*                                                                       86450021
*                       WORKAREA IN LCB                                 86500021
         ORG   LCBSNSV                  ESTABLISH ADDRESSABILITY S21903 86550022
ALTDESX  DS    H                        INDEX TO ALT DEST               86600021
SAVSTAT1 DS    X                        PRFSTAT1 OF HEADER              86650021
BITS     DS    X                        FLAGS                           86700021
*                       BIT DEFINITIONS                                 86750021
SDPREV   EQU   X'80'                    SENDING IDBADPTR        SA52971 86800022
SDFFO    EQU   X'40'                    SENDING MSG BEFORE READ SA52971 86850022
LMSGN    EQU   X'20'                    LAST MSG BEFORE READ    SA52971 86900022
FMSGN    EQU   X'10'                    FIRST FEFO MSG ENCOUNTERSA52971 86950022
COPYBIT  EQU   X'08'                    LCB BELONGS TO COPY             87000021
PUTBUFB  EQU   X'04'                    REQUEST MULTIBUFFER WRITE       87050021
*                                                                       87100021
SAVE14   DS    A                        RETURN ADDR FROM SUBRT          87150021
         DS    0A                       USED BY APPL PROG, NOT          87200021
*                                         AVAILABLE TO COPY             87250021
SAVSCHDR DS    A                        HIGH BYTE UNUSED, AL3 USED BY   87300021
*                                         REUS ONLY TO SAVE SCBSCHDR    87350021
BUFFER   DS    A                        ADDR OF BUFFER                  87400021
SOURCQCB DS    A                        SOURCE MASTER QCB               87450021
SQCB     DS    A                        SOURCE PRIORITY QCB             87500021
DESTQCB  DS    A                        DEST MASTER QCB                 87550021
RESUME   DS    AL3                      WHERE TO RESUME TESTING         87600021
IDBADPTR DS    AL3                      ID OF MSG THAT POINTED          87650021
*                                         TO BAD MSG                    87700021
SOURCTNT DS    H                        INDEX TO SOURCE TERMNAME        87750021
*                                         TABLE ENTRY                   87800021
BUFFERCN DS    A                        EXTRA BUFFER ADDR - USED        87850021
*                                         TO WRITE SERVICED             87900021
*                                                                       87908021
* NOTE -- IN REUS, SUBROUTINE 'BUFPOOL' WILL CLOBBER 'BUFFERCN'         87916021
* AND 'DESTQCB' WITH 'BUFFER' AND 'LCBERBCH' RESPECTIVELY, IF THE       87924021
* AVAILABLE BUFFER POOL IS EMPTY AND AN ERB MUST BE POSTED TO           87932021
* REQUEST AN EMPTY UNIT FROM THE BUFFER POOL.                           87940021
*                                                                       87950021
* THE FOLLOWING WORDS, USED ONLY IN COPY, ARE NOT DEFINED FOR           88000021
* THE POOL OF DUMMY LCBS GENERATED FOR REUS.                            88050021
*                                                                       88100021
SAVCOPY  EQU   IDBADPTR                 ORIG BUF POSTED TO COPY         88150021
SAVRCQCB EQU   BUFFERCN                 QCB TO RETURN BUF TO            88200021
         EJECT                                                          88200510
CVTMAP   CVT   DSECT=YES                                       @SA64353 88201010
         EJECT                                                          88201510
         TPCBD                                                 @SA64353 88202010
         EJECT                                                          88202510
         TPEBD                                                 @SA64353 88203010
         END                                                            88250021
