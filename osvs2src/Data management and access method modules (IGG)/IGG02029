         TITLE 'IGG02029 - SCAN MODE CLOSE MODULE'                      00012000
IGG02029 CSECT                                                          00013002
*                                                                       00014002
*********************************************************************** 00015002
*                                                                     * 00016002
* MODULE-NAME = IGG02029                                              * 00017002
*                                                                     * 00018002
* DESCRIPTIVE-NAME = ISAM CLOSE, SCAN MODE                            * 00019002
*                                                                     * 00020002
* COPYRIGHT = NONE                                                    * 00021002
*                                                                     * 00022002
* STATUS = RELEASE OS/VS2-02, LEVEL 01                                * 00023002
*                                                                     * 00024002
* FUNCTION = IF ABEND IS NOT IN CONTROL, AND A READ IS IN PROGRESS,   * 00025002
*            WAIT FOR THE READ TO COMPLETE.  IF ANY WRITE ERRORS HAVE * 00026002
*            OCCURRED, SYNCH TO EINFO ROUTINE OF GET MODULE.  IF AN   * 00027002
*            UNWRITABLE RECORD IS ENCOUNTERED, THE EINFO ROUTINE SETS * 00028002
*            UNCORRECTABLE FLAG IN DCBEXCD1, AND RETURNS TO THE CLOSE * 00029002
*            ROUTINE, WHICH THEN SYNCHES TO USER'S SYNAD ROUTINE.     * 00030002
*            AFTER ALL WRITE ERRORS ARE CLEARED, IF ANY EXISTED, AND  * 00031002
*            IF CLOSE HAS NOT GONE TO THE ESETL ROUTINE OF THE GET    * 00032002
*            MODULE ALREADY, SYNCH TO ESETL.  UPON RETURN, WAIT ON    * 00033002
*            OUTSTANDING WRITES, IF ANY.  IF WRITE ERRORS OCCUR,      * 00033202
*            SYNCH TO EINFO ROUTINE AGAIN.  UPON RETURN, RESTRUCTURE  * 00033402
*            THE BUFFER POOL.  THEN, IF DCB WAS OPENED FOR SHR,       * 00033602
*            ACQUIRE LOCAL AND CMS LOCKS; REFRESH DCB FROM THE FIELD  * 00033802
*            AREA; AND DECREMENT THE FIELD AREA, AND ASID USE COUNTS  * 00033902
*            AS REQUIRED.  FREE FIELD AREA OR FIELD AREA EXTENSION    * 00034002
*            CORE, IF REQUIRED.  FINALLY, FREE SCAN MODE WORK AREA.   * 00034202
*                                                                     * 00034402
* NOTES = SEE BELOW                                                   * 00035002
*                                                                     * 00036002
*    DEPENDENCIES = NONE                                              * 00037002
*                                                                     * 00038002
*    RESTRICTIONS = NONE                                              * 00039002
*                                                                     * 00040002
*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES.                     * 00041002
*                                                                     * 00042002
*    PATCH-LABEL = PATCH, A DC STATEMENT.                             * 00043002
*                                                                     * 00044002
* MODULE-TYPE = CLOSE EXECUTOR                                        * 00045002
*                                                                     * 00046002
*    PROCESSOR = ASSEMXF-370R                                         * 00047002
*                                                                     * 00048002
*    MODULE-SIZE = 1341 DECIMAL BYTES                                 * 00049002
*                                                                     * 00050002
*    ATTRIBUTES = PRIVILEGED, REENTRANT                               * 00051002
*                                                                     * 00052002
* ENTRY-POINT = IGG02029                                              * 00053002
*                                                                     * 00054002
*    PURPOSE = SEE FUNCTION                                           * 00055002
*                                                                     * 00056002
*    LINKAGE = RECEIVES CONTROL FROM IOS CLOSE FOR SCAN MODE ONLY.    * 00057002
*              RECEIVES CONTROL IN STORAGE PROTECT KEY 5 AND          * 00058002
*              PRIVILEGED STATE.                                      * 00059002
*                                                                     * 00060002
* INPUT = REGISTERS ESTABLISHED UPON ENTRY ARE                        * 00061002
*         REG 5 (RPAR) POINTS TO THE DCB COPY PARAMETER LIST          * 00062002
*         REG 6 (RWTG) POINTS TO THE O/C/EOV WHERE-TO-GO TABLE        * 00063002
*         REG 7 (RPARC) POINTS TO THE CURRENT ENTRY IN THE DCB COPY   * 00064002
*               PARAMETER LIST                                        * 00065002
*         REG 8 (RWTGC) POINTS TO THE CURRENT ENTRY IN THE WTG TABLE  * 00066002
*                                                                     * 00067002
* OUTPUT = REGISTERS 5 THROUGH 8 WILL BE IN THE SAME CONDITION AS     * 00068002
*          UPON ENTRY TO THIS MODULE                                  * 00069002
*                                                                     * 00070002
* EXIT-NORMAL = XCTL TO ISAM CLOSE EXECUTOR IGG0202D IN STORAGE       * 00071002
*               PROTECT KEY 5.                                        * 00071202
*                                                                     * 00072002
* EXIT-ERROR = SYNCH TO USER'S SYNAD ROUTINE.  THE USER MUST, HOWEVER,* 00073002
*              RETURN TO THIS CLOSE MODULE.                           * 00074002
*                                                                     * 00078002
* EXTERNAL-REFERENCES = SEE BELOW                                     * 00079002
*                                                                     * 00080002
*    ROUTINES = EINFO ROUTINE OF THE GET MODULE                       * 00081002
*               ESETL ROUTINE OF THE GET MODULE                       * 00082002
*               USER'S SYNAD ROUTINE                                  * 00082202
*                                                                     * 00083002
*    DATA-AREAS = AREAS REFERENCED ARE:                               * 00084002
*                 FORCORE - CLOSE WORK AREA                           * 00085002
*                 IGGSCAN - ISAM SCAN MODE WORK AREA                  * 00086002
*                 IHAPSA - LOW CORE ADDRESSABILITY                    * 00086202
*                                                                     * 00087002
*    CONTROL-BLOCKS = DCB, DCB COPY, DEB, TCB, CVT, SVRB, DCBFA AND   * 00088002
*                     ASCB                                            * 00088202
*                                                                     * 00089002
* TABLES = NONE                                                       * 00090002
*                                                                     * 00091002
* MACROS = MODESET, WAIT, SYNCH, SETLOCK, FREEMAIN, AND XCTL          * 00092002
*                                                                     * 00093002
* CHANGE-ACTIVITY = AS FOLLOWS:                                       * 00094002
*                                                                     * 00095002
*          RELEASE OS/VS2-02 DELETIONS                                * 00145002
*                                                               YM01420 00195002
*                                                               YM05395 00245002
*                                                               YM06516 00295002
*                                                               YM07002 00345002
*                                                                     * 00801002
*********************************************************************** 00802002
         EJECT                                                          00803002
         USING IHADCB,R2                                                00804002
         USING SISWORK1,R15                                             00820000
         BALR  R3,0                                                     00840000
         USING *,R3                                                     00860000
RE       EQU   0                                                        00880000
RF       EQU   1                                                        00900000
RDCB     EQU   2                                                        00920000
RBASE    EQU   3                                                        00940000
RG       EQU   4                                                        00960000
RPAR     EQU   5                        CONTAIN PARAMETER LIST ADDRESS  00980000
RWTG     EQU   6                        ADDR OF BEGIN OF WTG TABLE      01000000
RPARC    EQU   7                        CURRENT ENTRY IN PARAMETER LIST 01020000
RWTGC    EQU   8                        CURRENT ENTRY IN WTG TABLE      01040000
RTIOT    EQU   9                                                        01060000
RUCB     EQU   10                                                       01080000
RA       EQU   11                                                       01100000
RB       EQU   12                                                       01120000
RC       EQU   13                                                       01140000
RD       EQU   14                                                       01160000
RJ       EQU   15                                                       01180000
         SPACE 2                                                        01200000
R0       EQU   0                                                        01220000
R1       EQU   1                                                        01240000
R2       EQU   2                                                        01260000
R3       EQU   3                                                        01280000
R4       EQU   4                                                        01300000
R5       EQU   5                                                        01320000
R6       EQU   6                                                        01340000
R7       EQU   7                                                        01360000
R8       EQU   8                                                        01380000
R9       EQU   9                                                        01400000
R10      EQU   10                                                       01420000
R11      EQU   11                                                       01440000
R12      EQU   12                                                       01460000
R13      EQU   13                                                       01480000
R14      EQU   14                                                       01500000
R15      EQU   15                                                       01520000
FOUR     EQU   4                        CONSTANT OF 4            Y01021 01524000
SHR      EQU   X'80'                   INDICATOR FOR DISP=SHR    A47331 01530021
CLOSE    EQU   X'20'                    IND CLOSE IN PROCESS     Y02072 01532002
SP241    EQU   241                      SUBPOOL FOR FIELD AREA   Y02072 01534002
ESETL    EQU   X'40'                     CLOSE-ESETL INDICATOR          01540002
ABENDBIT EQU   X'80'                     ABEND INDICATOR IN TCB         01550002
WAITBIT  EQU   X'40'                     WAIT BIT IN ECB                01552002
DMCODE   EQU   250                      INTERNAL PROB DET CODE  YM05395 01554002
         SPACE 2                                                        01560000
SISC4A1  L     R2,0(0,RPARC)            SET BASE FOR DCB                01580000
         L     R15,DCBWKPT1             SET BASE FOR WORK AREA          01600000
         USING WTGTBL,RWTGC             WHERE TO GO TABLE        Y02072 01610502
         L     R9,OPENWA                CLOSE WORK AREA ADDR     Y02072 01660502
         USING FORCORE,R9               CLOSE WA ADDRESSABILITY  Y02072 01660902
         LR    RG,R2                    COPY DCB ADDR            Y02072 01661302
         L     R1,DCBDEBAD              PROTECTED DEB ADDR       Y02072 01661702
         L     R2,DXUDCBAD              USERS DCB ADDR           Y02072 01661802
         L     R1,0(R1)                 GET TCB ADDR            SA56350 01662002
         USING TCB,R1                                                   01662102
         TM    TCBFLGS,ABENDBIT         IS ABEND BIT ON?        SA56350 01662402
         BO    SISABEND                 YES, BR TO FREE DCBFA   SA56350 01662802
         DROP  R1                       END TCB ADDRESSABILITY  YM06516 01664802
         SPACE 2                                                        01665402
         MODESET  KEYADDR=DXUKEY,WORKREG=11  CHANGE TO USER KEY  Y02072 01668202
         SPACE 2                                                        01670202
         TM    W1ECBI,WAITBIT          IS A READ IN PROGRESS       7490 01670802
         BO    SISC4A2                 NO                          7490 01673402
         LR    R10,R1                   NO, LET US WAIT            7490 01676000
         LA    R1,W1ECBI               ADDRESS OF ECB              7490 01680000
*                                                                       01690002
         WAIT  ECB=(1)                 WAIT MAN WAIT               7490 01700000
*                                                                       01710002
         LR    R1,R10                  RESTORE R1                  7490 01720000
         L     R15,DCBWKPT1            REINSTATE R15               7490 01740000
SISC4A2  OI    DCBEXCD2,X'20'   INDICATE TO USER THAT CLOSE IN PROC7490 01760000
         SPACE 2                                                        01760402
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 01762002
         SPACE 2                                                        01764002
         STM   RG,R8,DXCCW1             SAVE REGISTERS 4-8       Y02072 01770002
         SPACE 2                                                        01772002
         MODESET  KEYADDR=DXUKEY,WORKREG=4   CHANGE TO USER KEY  Y02072 01780002
         SPACE 2                                                        01782002
         DROP  R9                       END CLOSE WA USING       Y02072 01783002
         LR    RWTG,R9                  CLOSE WORK AREA ADDR     Y02072 01785002
         USING FORCORE,RWTG             CLOSE WA ADDRESSABILITY  Y02072 01785402
         LA    R4,XXXC4C2               SYNCH RETURN - NON-ERROR        01786000
         STM   R3,R4,W1CN11             SAVE BASE AND RETURNS   YM07002 01840002
         DROP  R2                       END USING ON USER DCB    Y02072 01842002
         L     R10,DXCCW1               COPY DCB ADDR            Y02072 01844002
         USING IHADCB,R10               COPY ADDRESSABILITY      Y02072 01844402
         L     R10,DCBDEBAD             PROTECTED DEB ADDR       Y02072 01844802
         USING IHADCB,R2                USER DCB ADDRESSABILITY  Y02072 01845202
         USING IHADEB,R10                                        S21045 01846021
         L     R10,DEBEXPTR              GET ADDR OF DEB         S21045 01849021
*                                       EXTENSION PTR            S21045 01852021
         USING DEBEXT,R10                                        S21045 01855021
         TM    W1OSBIT2,X'80'           ANY WRITE ERRORS                01860000
         BZ    SISC4F1                  NO,GO TO ESETL                  01880000
*                                       YES                             01900000
SISC4B1  EQU   *                                                 S21045 01910021
         L     R11,DEBGET                LOAD ADDR OF GET MODULE S21045 01920021
         A     R11,12(0,R11)            R11 CONTAINS EINFO ADDRESS      01940000
         LR    R1,R2                    SET R1 TO DCB ADDRESS           01960000
         L     R2,DCBWKPT1              SET WORKAREA BASE FOR EINFO     01980000
         LA    R14,XXXC4D1              SYNCH RETURN - ERROR    YM07002 01980402
         ST    R14,W1CN12               SAVE RETURN FOR EINFO   YM07002 01980802
         LA    R15,SISEINFO             ADDRESS FOR SYNCH        Y02072 01982002
         BAL   R14,SYNCHRTN             SYNCH TO EINFO           Y02072 01982402
         CLI   W1CN8,C4D1               ANY BAD BUFFERS                 01984000
         BE    SISC4D1                  YES - ERROR ROUTINE             01985000
         B     SISC4C2                  NO - NORMAL ROUTINE             01986000
C4D1     EQU   1                        RETURN INDICATOR - ERROR        01987000
NOTC4D1  EQU   0                        RETURN INDICATOR - O.K.         01988000
XXXC4C2  EQU   *                        NON-ERROR RETURN                01989000
         MVI   W1CN8,NOTC4D1            SET  NO ERROR INDICATOR         01990000
         BR    R14                      RETURN                          01991000
XXXC4D1  EQU   *                        ERROR RETURN                    01992000
         MVI   W1CN8,C4D1               SET ERROR INDICATOR             01993000
         BR    R14                      RETURN                          01994000
SISEINFO EQU   *                        EINFO LINK ROUTINE              01995000
         BALR  R9,R11                   GO TO EINFO TO SET REGISTERS    02000000
*                                       FOR ERROR EXIT                  02020000
         B     XXXC4D1                  ERROR RETURN                    02030000
         SPACE 4                                                        02040002
SYNCHRTN EQU   *                        SYNCH TO PROCESSING RTNS Y02072 02050002
         SPACE 2                                                        02050402
         MODESET  EXTKEY=DATAMGT        SET DATA MGT KEY (5)     Y02072 02050802
         SPACE 2                                                        02051202
         ST    R14,DXCCW6               SAVE RETURN ADDRESS     YM07002 02052002
         USING PSA,R0                   LOW CORE ADDRESSABILITY  Y02072 02056002
         L     R14,PSATOLD              ADDR OF TCB              Y02072 02058002
         USING TCB,R14                  TCB ADDRESSABILITY       Y02072 02058402
         L     R14,TCBRBP               ADDR OF SVRB             Y02072 02058802
         USING RBBASIC,R14              SVRB ADDRESSABILITY      Y02072 02059202
         SPACE 1                                                        02059602
         MODESET  KEYADDR=KEY0,WORKREG=5  SET PROTECTION KEY 0   Y02072 02059702
         SPACE 1                                                        02059802
         STM   R2,R12,RBEXSAVE          SAVE REGS 2-12           Y02072 02059902
         DROP  R14                      END USING ON SVRB        Y02072 02066602
         SPACE 2                                                        02068602
         SYNCH (15)                     SYNCH TO PROCESS RTN     Y02072 02070602
         SPACE 2                                                        02072602
         USING PSA,R0                   LOW CORE ADDRESSABILITY  Y02072 02073102
         L     R14,PSATOLD              ADDRESS OF TCB           Y02072 02073202
         USING TCB,R14                  TCB ADDRESSABILITY       Y02072 02079902
         L     R14,TCBRBP               ADDRESS OF SVRB          Y02072 02081902
         USING RBBASIC,R14              SVRB ADDRESSABILITY      Y02072 02083902
         LM    R2,R12,RBEXSAVE          RESTORE REGS 2-12        Y02072 02085902
         DROP  R14                      END USING ON SVRB        Y02072 02086002
         SPACE 1                                                        02086302
         MODESET  KEYADDR=DXUKEY,WORKREG=14  SET USER'S KEY      Y02072 02086402
         SPACE 1                                                        02086502
         L     R14,DXCCW6               RESTORE RETURN ADDRESS  YM07002 02093202
         L     R2,DXUDCBAD              RESTORE USER DCB ADDRESS Y02072 02093602
         L     R15,DCBWKPT1             RESTORE WORK AREA ADDR   Y02072 02094002
         BR    R14                      RETURN                   Y02072 02095202
         SPACE 4                                                        02097202
*        EINFO RETURNS HERE IF A BAD BUFFER EXISTS                      02099902
SISC4D1  EQU   *                        GET SVRB ADDRESSABILITY  Y02072 02106602
         USING PSA,R0                   LOW CORE ADDRESSABILITY  Y02072 02113302
         L     R5,PSATOLD               TCB ADDRESS              Y02072 02120002
         L     R2,DCBDEBAD              DEB ADDRESS             YM06516 02130002
         LA    R2,0(R2)                 CLEAR HIGH ORDER BYTE   YM06516 02132002
         SH    R2,ISL8                  PT TO DEB EXTENSION PTR YM06516 02132402
         L     R2,0(R2)                 ADDRESS DEB EXTENSION   YM06516 02132802
         USING DEBXTN,R2                DEB EXT. ADDRESSABILITY YM06516 02133202
         TM    DEBXFLG1,DEBXTSKC        TASK CLOSE CLOSING DCB  YM06516 02133602
         BZ    SISSYNAD                 BR NO - TAKE SYNAD EXIT YM05395 02134002
         DROP  R2                       END DEB EXTENSION ADDR. YM06516 02134402
         SPACE 2                                                        02136002
*        USER DID NOT ISSUE CLOSE - WAS ISSUED BY TASK TERMINATION,     02138002
*        ISSUE MESSAGE IEC203I AND TERMINATE TASK WITH 031 ABEND.       02138402
         SPACE 2                                                        02138802
         MODESET EXTKEY=DATAMGT         SET DATA MGT KEY        YM05395 02138902
         SPACE 2                                                        02139002
         DROP  RWTG                     END ADDR ON CLOSE WA    YM07002 02140402
         LR    R14,RWTG                 CLOSE WORK AREA ADDRESS YM07002 02141602
         USING FORCORE,R14              CLOSE WA ADDRESSABILITY YM07002 02143602
         LM    RG,R8,DXCCW1             RESTORE CLOSE REGISTERS YM07002 02144402
         LR    RG,R14                   CLOSE WA FOR PROB DET.  YM07002 02144802
         SPACE 1                                                        02146402
         DMABCOND DMCODE,PDLOAD,RETURN=NONE,RES=NO,REGSAVE=YES  YM05395 02147002
         SPACE 1                                                        02149002
         LR    R1,R14                   CLOSE WA ADDR FOR XCTL  YM07002 02149402
         DROP  R14                      END CLOSE WA USING      YM07002 02149502
         B     TCTLRTN                  XCTL TO PROB DET MODULE YM05395 02149602
         USING FORCORE,RWTG             CLOSE WA ADDRESSABILITY YM07002 02151602
         SPACE 2                                                        02152202
SISSYNAD EQU   *                        TAKE SYNAD EXIT         YM05395 02154802
         L     R5,0(R5)                 SVRB ADDRESS                    02157402
         SPACE                                                          02160000
*   THE WORKPOINT BASE HAS ALREADY BEEN LOADED BY EINFO                 02180000
         SPACE                                                          02200000
         L     R2,DXUDCBAD              RESTORE USER DCB ADDR    Y02072 02220002
         USING IHADCB,R2                DCB ADDRESSABILITY      YM06516 02230002
         L     R15,DCBSYNAD             GO TO ERROR ROUTINE             02260000
         SPACE 2                                                        02262002
         MODESET  KEYADDR=KEY0,WORKREG=14 CHANGE TO USER KEY     Y02072 02270002
         SPACE 2                                                        02272002
         STM   R2,R12,96(R5)           SAVE SCAN REGS                   02280000
         LM    R2,R12,40(R5)           RESTORE USERS REG                02300000
         SYNCH (15)                    TAKE SYNAD EXIT                  02320000
         SPACE                                                          02340000
*   THE USER MUST RETURN BY R14 WHICH CONTAINS THE ADDR. OF N.S.I.      02360000
         SPACE                                                          02380000
SISC4C1  L     R5,PSATOLD              TCB ADDRESS               Y02072 02400002
         L     R5,0(R5)                                                 02420000
         LM    R2,R12,96(R5)           RESTORE SCAN REGS                02480000
* UPON RETURN,R2 WILL HAVE DCB ADDR.                                    02500000
         SPACE 2                                                        02502002
         MODESET  KEYADDR=DXUKEY,WORKREG=15  CHANGE TO USER KEY  Y02072 02510002
         SPACE 2                                                        02512002
         L     R15,DCBWKPT1             SET R15 TO WORK POINT           02520000
         B     SISC4B1                  CHECK FOR MORE WRITE ERRORS     02540000
         SPACE 3                                                        02560000
* EINFO WILL RETURN HERE WHEN ALL WRITE ERRORS HAVE BEEN TAKEN CARE OF  02580000
* AND THE WRITE QUEUE IS EMPTY                                          02600000
         SPACE                                                          02620000
SISC4C2  EQU   *                                                        02630002
         DROP  R2                       END USING ON USER DCB    Y02072 02630402
         L     R10,DXCCW1               COPY DCB ADDR            Y02072 02630802
         USING IHADCB,R10               COPY DCB ADDRESSABILITY  Y02072 02631202
         L     R10,DCBDEBAD             ADDR OF DEB FROM DCB    SA56388 02632002
         DROP  R10                      END USING ON COPY DCB    Y02072 02632102
         USING IHADCB,R2                USER DCB ADDRESSABILITY  Y02072 02632502
         USING IHADEB,R10                                       SA56388 02634002
         L     R10,DEBEXPTR             ADDR OF DEB EXTENSION   SA56388 02636002
         USING DEBEXT,R10                                       SA56388 02638002
         TM    W1OSBIT3,ESETL           HAS CLOSE GONE TO ESETL SA56388 02640002
         BO    SISC4J1                  YES, GO TO FREE WORK AREA       02660000
         SPACE 2                                                        02680000
* GO TO ESETL                                                           02700000
SISC4F1  LR    R1,R2                   SET R1 TO DCB ADDR FOR ESETL     02720000
         LA    R13,W1CN8+FOUR           POINT TO SAVE AREA       Y01021 02724000
         L     R15,DEBGET                LOAD ADDR OF GET MODULE S21045 02740021
         DROP  R10                      END USING ON DEB EXT.    Y02072 02750002
         A     R15,40(0,R15)                                            02760000
         SPACE                                                          02820000
*        R13 CONTAINS THE ADDRESS OF A REGISTER SAVE AREA               02840000
*        THAT WILL BE USED BY ESETL                                     02860000
         SPACE                                                          02862002
         BAL   R14,SYNCHRTN             GO TO ESETL                     02868002
         SPACE                                                          02920000
         TM    W1ECBO,X'40'             HAVE WRITES COMPLETED           02960000
         BO    SISC4G1                  YES                             02980000
         LR    R11,R15                                                  03000000
         LA    R1,W1ECBO                WAIT FOR WRITES TO COMPLETE     03020000
         WAIT  ECB=(1)                                                  03040000
         LR    R15,R11                                                  03060000
SISC4G1  TM    W1OSBIT2,X'80'     ANY WRITE ERRORS FROM ESETL WRITES    03080000
         BO    SISC4B1                  YES, GO TO EINFO                03100000
*                                       NO, FREE BUFFERS AND WORKAREA   03120000
         SPACE 2                                                        03140002
*********************************************************************** 03150002
* RESTRUCTURE BUFFER POOL                                               03160000
*********************************************************************** 03170002
         SPACE 2                                                        03180002
* OBTAIN BUFFER ADDRESSES FROM CHANNEL PROGRAMS (ALL ON EITHER WRITE OR 03200000
* FREE QUEUES) AND CHAIN BUFFERS TOGETHER WITH 1ST SCAN MODE BUFFER     03220000
* POINTING TO BUFFER PREVIOUSLY POINTED TO BY BUFCB AND BUFCB CONTENTS  03240000
* POINTING TO LAST SCAN MODE BUFFER AND INTERMEDIATE  BUFFERS CHAINED   03260000
* TOGETHER.                                                             03280000
         SPACE 2                                                        03300002
SISC4J1  L     R5,DCBBUFCB                                              03320000
         L     R5,0(R5)                 R5 POINTS TO 1ST BUFFER         03340000
         CLC   W1WRITEC(2),LAST         IS WRITE QUEUE EMPTY            03360000
         BE    SISC4J2                  YES                             03380000
         L     R4,W1WR1ST               NO, GET CP ADDRESS              03400000
SISC4J11 L     R1,52(R4)                BUFFER ADDRESS                  03420000
         ST    R5,0(R1)                 CHAIN TO LAST BUFFER            03440000
         LR    R5,R1                    R5 NOW POINTS TO NEW BUFFER     03460000
         CLC   33(3,R4),LAST            END OF Q                        03480000
         BE    SISC4J2                  YES                             03500000
         L     R4,32(R4)                NO, GET ADDRESS OF NEXT CP      03520000
         B     SISC4J11                 LOOP                            03540000
SISC4J2  CLC   W1FREEC(2),LAST          IS FREE QUEUE EMPTY             03560000
         BE    SISC4J3                  YES                             03580000
         L     R4,W1FR1ST               NO, GET ADDRESS 1ST FREE Q C P  03600000
SISC4J22 L     R1,52(R4)                BUFFER ADDRESS                  03620000
         ST    R5,0(R1)                 CHAIN TO LAST BUFFER            03640000
         LR    R5,R1                    R5 NOW POINTS TO NEW BUFFER     03660000
         CLC   33(3,R4),LAST            END OF Q                        03680000
         BE    SISC4J3                  YES                             03700000
         L     R4,32(R4)                NO, GET ADDRESS OF NEXT CP      03720000
         B     SISC4J22                 LOOP                            03740000
*                                                                       03750002
SISC4J3  L     R1,DCBBUFCB              GET BUFCB ADDRESS               03760000
         ST    R5,0(R1)                 BUFCB POINTS TO NEW 1ST BUFFER  03780000
         B     SISABND2                 SKIP REGISTER SAVE              03780100
         DROP  RWTG                     END CLOSE WA USING       Y02072 03780202
         SPACE 2                                                        03780302
SISABEND  EQU  *                                                 SM4372 03784502
         USING FORCORE,R9               CLOSE WA ADDRESSABILITY  Y02072 03786002
         STM   RG,R8,DXCCW1             SAVE REGISTERS 4-8       Y02072 03787502
         DROP  R9                       END USING ON CLOSE WA    Y02072 03789002
         LR    RWTG,R9                  CLOSE WORK AREA ADDR     Y02072 03790502
         USING FORCORE,RWTG             CLOSE WA ADDRESSABILITY  Y02072 03792002
         SPACE 2                                                        03793502
         MODESET  KEYADDR=DXUKEY,WORKREG=5   CHANGE TO USER KEY  Y02072 03795002
         SPACE 2                                                        03796502
SISABND2 EQU   *                        CONTINUE                        03798002
         DROP  R2                       END USING ON USER DCB    Y02072 03799502
         L     R5,DXCCW1                ADDR OF COPY DCB         Y02072 03801002
         USING IHADCB,R5                USE COPY DCB             Y02072 03801402
         L     R5,DCBDEBAD              PROTECTED DEB ADDR       Y02072 03801802
         USING IHADCB,R2                USER DCB ADDRESSABILITY  Y02072 03801902
         USING IHADEB,R5                DEB ADDRESSABILITY       Y02072 03802002
         L     R5,DEBEXPTR              PTR TO DEB EXTENSION     Y02072 03802102
         USING DEBEXT,R5                DEB EXTENSION            Y02072 03802202
         TM    DEBDCBFA,SHR             OPENED DISP EQ SHR       Y02072 03802302
         BZ    FREEWA                   BR NO TO FREE WA         Y02072 03802702
         XC    W1DCBFA,W1DCBFA          CLEAR FA PTR IN WORKAREA Y02072 03803102
         SPACE 2                                                        03803202
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 03803402
         SPACE 2                                                        03803502
         L     RF,DEBDCBFA              ADDR OF FIELD AREA       Y02072 03804002
         LA    RF,0(,RF)                CLEAR HIGH ORDER BYTE    Y02072 03804102
         SR    R15,R15                  SET REG TO ZERO          Y02072 03804202
         ST    R15,DEBDCBFA             CLEAR FIELD AREA PTR     Y02072 03804302
         ST    R15,DXCCW9               IND. NO DCBFA TO FREE    Y02072 03804402
         DROP  R5                       END USING ON DEB         Y02072 03804802
         LR    R5,RF                    FIELD AREA ADDR          Y02072 03805002
         SPACE 2                                                        03805102
*********************************************************************** 03805202
*        ACQUIRE LOCAL AND CMS LOCKS, BOTH FREED IN THIS ROUTINE.       03805502
*********************************************************************** 03805602
         SPACE 2                                                        03806002
         MODESET  KEYADDR=KEY0,WORKREG=11 CHANGE TO KEY ZERO     Y02072 03806102
         SPACE 2                                                        03806202
GLCL1    SETLOCK  OBTAIN,TYPE=LOCAL,MODE=UNCOND,  OBTAIN THE     Y02072*03806402
               RELATED=(DCBFA,IGG02029(FLCL1))  LOCAL LOCK       Y02072 03806502
         SPACE 2                                                        03806602
GCMS1    SETLOCK  OBTAIN,TYPE=CMS,MODE=UNCOND,  OBTAIN CROSS     Y02072*03806702
               RELATED=(DCBFA,IGG02029(FCMS1))  MEMORY SERVICES  Y02072 03806802
*                                               LOCK             Y02072 03806902
         SPACE 2                                                        03807002
         MODESET  KEYADDR=DXUKEY,WORKREG=15 SET USER'S KEY       Y02072 03807102
         SPACE 2                                                        03807202
         LR    R15,R5                                            A42900 03807702
         USING DCBFA,R15                                         A35340 03807802
         CLC   DFAID,DCBWKPT3       ?   TEST IF CORRECT ID       A47331 03807902
         BNE   NOREFRSH             ?   B IF NOT TO SKIP REFRSH  A47331 03808002
*                                                                       03808102
*       REFRESH DCB FROM DCBFA TO ENSURE CORRECT DSCB MERGE             03808202
         SPACE 2                                                        03808302
         MVC   DCBRORG3(9),DFARORG3     RORG3,NREC,ST            A36467 03809002
         MVC   DCBLPDA,DFALPDA          LP                       A36467 03809102
         MVC   DCBNBOV,DFANBOV          NBOV                     A36467 03809202
         MVC   DCBRORG2,DFARORG2        RORG2                    A36467 03810002
         MVC   DCBNOREC(12),DFANOREC    NOREC,LIOV,ROR71         A36467 03811002
         SPACE 2                                                        03811402
*********************************************************************** 03812002
NOREFRSH EQU   *                                                        03813002
         SPACE 2                                                        03813402
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 03813802
         SPACE 2                                                        03813902
         LH    R5,DFAUSE                GET USE COUNT            A35340 03814002
         BCT   R5,NOFREED               DECREMENT, FREE  AREA IF A35340 03815002
*                                       ZERO                     A35340 03816002
         L     RF,CVTPTR                GET CVT ADDR                    03817002
         USING CVT,RF                                                   03818002
         L     RF,CVTEXT1               GET CVT EXTENSION ADDR   A47331 03819002
         USING CVTXTNT1,RF                                              03820002
         L     R5,CVTFACHN              GET ADDR OF FIRST FA     A47331 03821002
*                                       0                        A35340 03822002
         LA    R5,0(R5)                 CLEAR HIGH BYTE          A47331 03823002
         DROP  R15                                                      03824002
         USING DCBFA,R5                                                 03825002
         LTR   R5,R5                    IS THERE A FA CHAIN      A47331 03826002
         BZ    ERR                      B IF NOT - ERROR         A47331 03827002
         LA    RB,CVTFACHN              INITLZ FOR CHAIN RESET   A47331 03828002
         LR    R0,RB                    SAVE ADDR OF CVT FA PTR  Y02072 03828402
         SPACE 2                                                        03828802
*********************************************************************** 03829002
*             SEARCH CHAIN FOR FIELD AREA TO FREE                       03830002
*********************************************************************** 03831002
         SPACE 2                                                        03831402
CHNSRCH  CR    R5,R15                   IS IT THE SAME FA ADDR   A47331 03832002
         BNE   NEXTFA                   B IF NOT TO GET NEXT IN  A47331 03833002
*                                       CHAIN                           03834002
         SPACE 2                                                        03834402
         MODESET  KEYADDR=DXUKEY,WORKREG=9  SET USERS KEY       YM01420 03834802
         SPACE 2                                                        03834902
         CLC   DFAID,DCBWKPT3           CHECK IF SAME ID         A47331 03835002
         BE    FOUNDFA                  B IF SO TO FREE         YM01420 03836002
         SPACE 2                                                        03836402
         MODESET  EXTKEY=DATAMGT        SET DATA MGT KEY (5)    YM01420 03836802
         SPACE 2                                                        03836902
NEXTFA   LA    RB,DFACHAIN              NEXT CHAIN ADDR          A47331 03837002
         CLC   DFACHAIN+1(EOCLN),EOC    END OF CHAIN             A47331 03838002
         BE    ERR                      IF SO, NO FA - ERROR     A47331 03839002
         L     R5,DFACHAIN              GET NEXT FA IN CHAIN     A47331 03840002
         B     CHNSRCH                  B TO CONTINUE SEARCH     A47331 03841002
         SPACE 2                                                        03841402
*********************************************************************** 03842002
*             FOUND FIELD AREA, MUST UNCHAIN AND FREE AREA              03843002
*********************************************************************** 03844002
         SPACE 2                                                        03844402
FOUNDFA  EQU   *                        FIND FA IN FA CHAIN     YM01420 03844802
         MODESET  EXTKEY=DATAMGT        SET DATA MGT KEY (5)    YM01420 03845202
         SPACE 2                                                        03845602
FNDFA    CLC   DFACHAIN+1(EOCLN),EOC    LAST IN CHAIN            A47331 03846002
         BNE   UNCHAIN                  IF NOT, MOVE CHAINS      A47331 03847002
         USING CHAIN,RB                                          A47331 03848002
         CLC   LSTCHAIN,CVTFACHN        FIRST AND LAST IN CHAIN  A47331 03849002
         BNE   UNCHAIN                  B IF NOT, MOVE CHAINS    A47331 03850002
         SPACE 2                                                        03850402
         MODESET  KEYADDR=KEY0,WORKREG=14 SET PROTECT KEY ZERO   Y02072 03850802
         SPACE 2                                                        03850902
         XC    CVTFACHN,CVTFACHN        CLEAR CVT PT IF NO CHAIN A47331 03851002
         SPACE 2                                                        03851402
         MODESET  EXTKEY=DATAMGT        SET DATA MGT KEY (5)     Y02072 03851802
         SPACE 2                                                        03851902
         B     FREEFA                   B TO FREE AREA           A47331 03852002
*                                                                       03852402
UNCHAIN  CR    R0,RB                    DELETING FIRST DCBFA     Y02072 03852802
         BNE   UNCHNFA                  BR IF NOT FIRST IN CHAIN Y02072 03852902
         SPACE 2                                                        03853902
         MODESET  KEYADDR=KEY0,WORKREG=14 SET PROTECT KEY ZERO   Y02072 03855902
         SPACE 2                                                        03857902
UNCHNFA  MVC   LSTCHAIN,DFACHAIN        MOVE CHAIN PTR           A47331 03858002
         SPACE 2                                                        03858402
         MODESET  EXTKEY=DATAMGT        SET DATA MGT KEY (5)     Y02072 03858802
         SPACE 2                                                        03858902
FREEFA   XC    DCBFA(DFASIZE),DCBFA     CLEAR FIELD AREA         A47331 03859002
         LA    R0,SP241                 DCB FIELD AREA SUBPOOL   Y02072 03860002
         SLL   R0,24                                             A35340 03861002
         LA    R5,DFASIZE               SIZE OF WORK AREA        A35340 03862002
         OR    R0,R5                    SIZE AND SUBPOOL IN REG0 A35340 03863002
         LR    RF,R15                   ADDR OF CORE TO BE FREED Y02072 03864002
         STM   R0,RF,DXCCW9             SAVE SIZE, SUBPOOL AND   Y02072 03865002
*                                       SAVE CORE ADDRESS        Y02072 03866002
         B     FREELOCK                 RELEASE LOCAL,CMS LOCKS  Y02072 03867002
         DROP  R5                                                       03868002
         USING DCBFA,R15                                                03869002
NOFREED  STH   R5,DFAUSE                STORE NEW USE COUNT      Y02072 03870002
         BAL   R14,ASIDRTN              FIND ASID USE COUNT      Y02072 03871002
ERR      EQU   *                                                 A47331 03872002
         SPACE 2                                                        03872402
FREELOCK MODESET  KEYADDR=KEY0,WORKREG=11 CHANGE TO KEY ZERO     Y02072 03873002
         SPACE 2                                                        03873402
*********************************************************************** 03873802
*        RELEASE CMS AND LOCAL LOCKS, ACQUIRED AT GCMS1 AND GLCL1.      03874002
*********************************************************************** 03874402
         SPACE 2                                                        03874802
FCMS1    SETLOCK  RELEASE,TYPE=CMS,   RELEASE CROSS MEMORY       Y02072*03875002
               RELATED=(DCBFA,IGG02029(GCMS1))  SERVICES LOCK    Y02072 03876002
         SPACE 2                                                        03876402
FLCL1    SETLOCK  RELEASE,TYPE=LOCAL,  FREE THE                  Y02072*03877002
               RELATED=(DCBFA,IGG02029(GLCL1))  LOCAL LOCK       Y02072 03878002
         SPACE 2                                                        03878402
         MODESET EXTKEY=DATAMGT         SET DATA MGT KEY (5)     Y02072 03878802
         SPACE 2                                                        03879202
         LM    R0,R1,DXCCW9             TEST FOR FIELD AREA TO   Y02072 03879802
         LTR   R0,R0                    BE FREED                 Y02072 03879902
         BZ    FREESWA                  BR NO FA OR FA EXT TO    Y02072 03883902
*                                       BE FREED                 Y02072 03885902
         FREEMAIN R,LV=(0),A=(1)        FREE DCBFA OR FA EXT.    Y02072 03887902
         SPACE 2                                                        03888302
FREESWA  MODESET  KEYADDR=DXUKEY,WORKREG=15  CHANGE TO USER KEY  Y02072 03888702
         SPACE 2                                                        03892902
FREEWA   EQU   *                        FREE SCAN WORK AREA      Y02072 03906402
         L     R15,DCBWKPT1             RESTORE PTR TO WORKAREA  A35340 03910602
         USING SISWORK1,R15                                      A35340 03914802
*              FREE QISAM SCAN WORK AREA                                03919002
*                                                                       03923202
         LH    R0,W1WPLEN                                               03927402
         LA    R1,250                                                   03931602
         SLL   R1,24                                                    03935802
         OR    R0,R1                   R0 NOW HAS SUBPOOL AND LENGTH    03940002
         L     R1,DCBWKPT1                                       A42900 03950021
         XC    DCBWKPT1,DCBWKPT1                                 A42900 03960021
         FREEMAIN R,LV=(0),A=(1)                                 A42900 03970021
         SPACE 2                                                        03980002
*   FINISHED WITH THIS DCB                                              04000000
         SPACE 2                                                        04020000
         LM    RG,R8,DXCCW1             RESTORE REGISTERS 4-8    Y02072 04030002
         DROP  RWTG                     END USING ON CLOSE WA    Y02072 04032002
         SPACE 2                                                        04032402
         MODESET  EXTKEY=DATAMGT        CHANGE TO DATA MGT KEY   Y02072 04034002
         SPACE 2                                                        04036002
         MVC   0(L'LOAD2D,RWTGC),LOAD2D ID OF NEXT LOAD-IGG0202D Y02072 04040002
         L     R1,4(RWTGC)             SET BASE FOR WTG TABLE           04060000
RELOOP   LA    RWTGC,8(RWTGC)           INCREMENT WTG CURR ENTRY        04080000
         LA    RPARC,4(RPARC)                                           04100000
         CLC   0(2,RWTGC),THISLOD                                       04120000
         BCR   8,RBASE                  BRANCH EQ TO BEGINNING THIS MOD 04140000
         CLC   0(1,RWTGC),OPLOD7        IS IT END OF WTG TABLE          04160000
         BNE   RELOOP                   NO                              04180000
ATEND    LR    RPARC,RPAR               INITIALIZE RPARC AND RWTGC      04200000
         LA    RWTGC,32(RWTG)                                           04220000
ZCHECK   CLI   0(RWTGC),X'00'           TEST FOR ENTRY = ZERO           04240000
         BNE   TCTLRTN                  ENTRY NOT ZERO                  04260000
ITSZERO  LA    RWTGC,8(RWTGC)                                           04280000
         LA    RPARC,4(RPARC)                                           04300000
         B     ZCHECK                                                   04320000
TCTLRTN  MVC   6(2,RWTG),0(RWTGC)       MOVE ID                         04340000
*                                                                       04360002
         USING FORCORE,R1               R1 = CLOSE WORKAREA ADDR Y01021 04364000
         LA    RJ,DXXCTL                WA ADDRESS               Y01021 04380002
         XC    DXXCTL,DXXCTL            CLEAR PARM LIST, NO DCB YM07002 04390002
*                                       FOR LPALIB              YM07002 04392002
         XCTL  EPLOC=(RWTG),SF=(E,(15)) XCTL TO IGG0202D         Y02072 04400002
         DROP  R1                       END USING ON CLOSE WA    Y02072 04410002
         DS    0F                                                       04420000
ISL8     DC    H'8'                     DECR DEB PTR TO EXT PTR YM06516 04422002
PDLOAD   DC    C'6M'                    MODULE IGG0206M         YM05395 04430002
LAST     DC    F'0'                                                     04440000
KEY0     EQU   LAST                     PROTECT KEY ZERO         Y02072 04490002
OPLOD7   DC    C'0'                                                     04500000
THISLOD  DC    C'29'                                                    04520000
EOC      DC    XL3'FFFFFF'              END OF CHAIN INDICATOR   A47331 04534021
EOCLN    EQU   3                        LENGTH OF EOC FIELD             04536000
*                                                                       04540000
         EJECT                                                          04540402
**********************************************************************  04540802
*    TOTAL USE COUNT DID NOT GO TO ZERO.  FIND THE ADDRESS SPACE USE *  04541202
*    COUNT (ASID) AND DECREMENT IT BY ONE.  IF IT GOES TO ZERO, MOVE *  04541602
*    THE LAST ASID USE COUNT ENTRY TO REPLACE THE ENTRY WHICH USE    *  04541702
*    COUNT WENT TO ZERO.  THEN SET THE LAST ASID USE COUNT TO ZERO.  *  04541802
**********************************************************************  04541902
         SPACE 2                                                        04543402
         USING FORCORE,RWTG             CLOSE WA ADDRESSABILITY  Y02072 04546502
*                                                                       04548002
ASIDRTN  STM   RPARC,RD,DXCCW4          SAVE REGISTERS 7-14      Y02072 04550002
*                                                                       04552002
         USING PSA,R0                   LOW CORE ADDRESSABILITY  Y02072 04554002
         L     R11,PSAAOLD              ADDRESS OF ASCB          Y02072 04556002
         USING ASCB,R11                 ASCB ADDRESSABILITY      Y02072 04558002
         LH    R11,ASCBASID             ADDRESS SPACE ID         Y02072 04559702
         DROP  R11                      END USING ON ASCB        Y02072 04559802
*                                                                       04560002
         USING DCBFA,R15                FIELD AREA ADDR          Y02072 04566602
         LA    RB,DFAASID1              ADDR FIRST ASID FIELD    Y02072 04568602
         USING DFAASID,RB               USER ASID FIELDS         Y02072 04570602
         SR    R9,R9                    IND SEARCH FIELD AREA    Y02072 04572602
*                                                                       04572702
NOASIDS  LA    RC,DFANOIDS              NO. ASIDS IN FIELD AREA  Y02072 04572802
         B     ASIDSRCH                 SEARCH FA FOR THIS ASID  Y02072 04575302
*                                                                       04577302
NEXTASID LA    RB,DFANXPTR(RB)          PT TO NEXT ASID          Y02072 04577702
ASIDSRCH LH    RD,DFAASIDX              USER ASID                Y02072 04578202
         CR    R11,RD                   ASID EQ THIS ADDR SPACE  Y02072 04580702
         BE    FNDASID                  BR IF THIS ADDR SPACE    Y02072 04583202
         LTR   RD,RD                    IS THERE AN ASID         Y02072 04585702
         BZ    ENDSRCH                  BR IF NO ASID            Y02072 04588202
         BCT   RC,NEXTASID              BR IF MORE ASIDS         Y02072 04593202
*                                                                       04595702
         LA    R8,DFAPTR                SAVE ADDR OF EXT PTR     Y02072 04597702
         L     RB,DFAPTR                PTR TO EXTENSION         Y02072 04598202
         LTR   R9,RB                    ANOTHER EXTENSION        Y02072 04600702
         BZ    ENDSRCH                  ASID NOT FOUND           Y02072 04603202
         B     NOASIDS                  SEARCH EXTENSION         Y02072 04623202
*                                                                       04623602
*        DECREMENT ASID USE COUNT                                       04625202
*                                                                       04625302
FNDASID  LH    RPARC,DFAUSEX            ASID USE COUNT           Y02072 04625602
         BCT   RPARC,STORECNT           SUBTRACT ONE, BR NOT 0   Y02072 04626002
*                                                                       04626102
*        FIND LAST ASID ENTRY IN FIELD AREA OR EXTENSION                04626402
*                                                                       04628602
         LR    RPARC,RB                 ASID FIELD PTR           Y02072 04634202
         LR    R11,RB                   ADDR LAST ASID ENTRY     Y02072 04636402
*                                                                       04638402
         DROP  RB                       END USER ASID ADDR       Y02072 04638502
         USING DFAASID,RPARC            EST USER ASID ADDR       Y02072 04640602
NXTFLD   BCT   RC,NXTASID               BR IF MORE ASIDS         Y02072 04646602
         LA    R8,DFAPTR                SAVE ADDR OF EXT PTR     Y02072 04648602
         L     RPARC,DFAPTR             PTR TO EXTENSION         Y02072 04648702
         LTR   RPARC,RPARC              ANOTHER EXTENSION        Y02072 04650802
         BNZ   NUMIDS                   BR IF ANOTHER EXTENSION  Y02072 04652902
         CR    R11,RB                   ASID LAST IN EXTENSION   Y02072 04655002
         BE    CLEAR                    CLEAR LAST ASID          Y02072 04657102
         B     RESET                    MOVE LAST ASID TO FILL   Y02072 04659202
*                                       FIELD WITH ZERO COUNT    Y02072 04661302
*                                                                       04663402
NXTASID  LA    RPARC,DFANXPTR(RPARC)    PT TO NEXT ASID          Y02072 04665502
         B     GETID                    TEST NEXT ASID           Y02072 04667602
NUMIDS   LA    RC,DFANOIDS              NO. ASIDS IN EXTENSION   Y02072 04669702
         LR    R11,RPARC                ASID PTR                 Y02072 04671802
         LR    R9,RPARC                 ADDR OF EXTENSION        Y02072 04673902
GETID    LH    RD,DFAASIDX              ASID                     Y02072 04676002
         LTR   RD,RD                    IS THERE AN ASID         Y02072 04678102
         BZ    RESET                    BR NO ASID               Y02072 04680202
         LR    R11,RPARC                ADDR LAST ASID FOUND     Y02072 04682302
         B     NXTFLD                   TEST NEXT ASID           Y02072 04684402
*                                                                       04686502
         DROP  RPARC                    END USER ASID ADDR       Y02072 04687402
         USING DFAASID,RB               EST USER ASID ADDR       Y02072 04687802
STORECNT EQU   *                        STORE NEW ADDRESS        Y02072 04688602
         STH   RPARC,DFAUSEX            SPACE USE COUNT          Y02072 04690702
         B     ENDSRCH                  RETURN                   Y02072 04692802
*                                                                       04694902
RESET    L     RPARC,0(R11)             LAST ASID ENTRY TO FILL  Y02072 04697002
         ST    RPARC,0(RB)              * FIELD WITH ZERO COUNT  Y02072 04699102
CLEAR    SR    RPARC,RPARC              SET REG TO ZERO          Y02072 04701202
         ST    RPARC,0(R11)             CLEAR LAST ASID          Y02072 04703302
         CR    R9,R11                   LAST ASID ONLY ENTRY     Y02072 04705402
         BNE   ENDSRCH                  FREE LOCKS               Y02072 04707502
*                                                                       04709602
         SR    R11,R11                  ZERO REG                 Y02072 04711602
         ST    R11,0(,R8)               ZERO EXTENSION PTR       Y02072 04712202
         LA    R8,SP241                 EXTENSION SUBPOOL        Y02072 04713402
         SLL   R8,24                    SUBPOOL TO HIGH BYTE     Y02072 04713802
         LA    R11,DFEXSIZE             SIZE OF EXTENSION        Y02072 04715902
         LA    R11,0(R11)               CLEAR HIGH BYTE          Y02072 04718002
         OR    R8,R11                   SIZE AND SUBPOOL         Y02072 04720102
         STM   R8,R9,DXCCW9             STORE SIZE, SUBPOOL, AND Y02072 04722202
*                                       ADDRESS FOR FREEMAIN     Y02072 04724302
*                                                                       04726402
ENDSRCH  LM    RPARC,RD,DXCCW4          RESTORE REGS 7-14        Y02072 04728502
         BR    R14                      RETURN                   Y02072 04730602
         SPACE 3                                                        04732702
*                                                                       04734802
*  TTR TABLE                                                            04736902
*                                                                       04739002
LOAD2D   DC    C'2D'                    ID OF MODULE IGG0202D    Y02072 04741102
*                                                                       04743202
PATCH    DC    XL((*-IGG02029)/20)'00'  ZEROED PATCH AREA        Y02072 04745302
         EJECT                                                          04747402
         IECDSECS MAIN,EXPAND=YES                               YM05395 04751602
         SPACE 5                                                        04753702
         DCBD  DSORG=(IS)                                               04755802
IHADEB   IGGDEBD                                                        04757902
DEBXTN   DSECT                                                          04759902
DEBXLNGH  DS   H                        LENGTH DEB EXTENSION            04766602
DEBXFLG1  DS   B                        FLAG BYTE                       04768602
DEBXTSKC EQU   X'40'                    TASK CLOSE CLOSING DCB          04770602
         EJECT                                                          04773302
SISWORK1 IGGSCAN              SCAN MODE WORK AREA                A35340 04780020
*                                  ****END OF FIXED LENGTH FIELDS ****  07240000
         EJECT                                                          07246020
DCBFA    IGGDCBFA                                                       07252020
CHAIN    DSECT                                                          07254021
LSTCHAIN DS    F                                                        07256021
WTGTBL   DSECT                                                          07256402
IDTTR    DS    F                        MODULE ID AND TTR               07256802
OPENWA   DS    A                        ADDRESS OF WORK AREA            07257202
         CVT   DSECT=YES                                                07258402
         SPACE 2                                                        07258802
TCB      IKJTCB                                                         07259202
         SPACE 4                                                        07260002
         IKJRB                                                   Y02072 07410002
         EJECT                                                          07460002
         IHAASCB                                                        07470002
         EJECT                                                          07480002
         IHAPSA                                                  Y02072 07510002
         END                                                            07560002
