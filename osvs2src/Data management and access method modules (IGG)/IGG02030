         TITLE 'IGG02030 TCAM MESSAGE QUEUES CLOSE'                     00010004
IGG02030 CSECT                                                          00020004
*A-000000-999999                                               @X31X8T0 00025008
         SPACE 3                                                        00030004
*CHANGE-ACTIVITY = AS FOLLOWS:                                   S21903 00040004
******************** MICROFICHE FLAGS *********************** SUPT CODE 00050004
*A152000,312000,696000,808000                                    X01004 00060004
*C066000-068000,174000-176000,288000-298000,382000-660000,672000-X01004 00070004
*C674000                                                         X01004 00080004
*A312200                                                         Y01004 00090004
*C186000-188000,244000                                           Y01004 00100004
*A312340,312390,321640,697400,809600                             X02004 00110004
*C153000,312090-312120,312280,312710-312970                      X02004 00120004
*A184000                                                         A52482 00430022
*A164000                                                         A49219 00430122
*C168000,190000                                                  A49219 00430222
*A004000,006000                                                  S21903 00430322
*C156000,330000,334000,338000,704000-708000                      S21903 00430422
*C712000,730000,736000-742000,760000-766000                      S21903 00430522
*A312210,312970,697000                                           Y05330 00430605
*C312730                                                         Y05330 00430705
*A312250,312290,697600                                          OY00465 00430805
*C313050-313070                                                 OY00451 00430905
*D692500                                                        OY00451 00431005
*C313056,313100                                                 OY00541 00431105
*A313074                                                        OY00541 00431205
*A313120                                                        OY00532 00431305
*C313190-313200                                                 OX02223 00432054
*A809600                                                        OX02223 00433054
*A313145                                                        OY03847 00433505
*A312430                                                        OY00512 00513505
*C008000,018000,034000,040000,056500,082000-086000,153500        Y02027 00522506
*C172000-180000,188000,244000,312180,312190,312210,312215,312250 Y02027 00531506
*C312260,390000                                                  Y02027 00540506
*D182000-184000,697300                                           Y02027 00549506
*A057000,057500,076600,077200,153700,164000,364500-365500        Y02027 00558506
*A702500,808480-808720                                           Y02027 00567506
*A313074                                                        OY00541 00576506
*A313120                                                        OY00532 00585506
*A312660,312680                                                @YA03928 00586561
*A689500                                                         X03039 00592508
*C008000,189200,244000,312730,313105                             X03039 00600008
*D312215,312971-312981,313120-313123                             X03039 00606008
*A714000                                                       @Z30X8TM 00607008
*C008000,240000-242000,313080-313090,668000,691500,716000      @Z30X8TM 00608008
*D728000,742000                                                @Z30X8TM 00609008
*A092000,154000,405000,746000,750000,752000,754000,756000      @Z40X9TG 00609109
*A808800,809200                                                @Z40X9TG 00609209
*C008000,014000-028000,090000,166000,186000,250000-260000      @Z40X9TG 00609309
*C262000-264000,272000-274000,278000-293000,300000-302000      @Z40X9TG 00609409
*C312100,312110,718000-726000                                  @Z40X9TG 00609509
*D173000,687000,690500,758000-806000                           @Z40X9TG 00609609
*                                                              @G36XRTP 00610000
*A809000                                                       @G36XRTP 00610400
*C240000,312650,312660,313030,313112-313114,313119             @G36XRTP 00610800
*D240500-242500                                                @G36XRTP 00611200
*C726400-741100                                                @OZ26164 00611600
*C153300,176000                                                @OZ30722 00611786
*D182000-185600                                                @OZ30722 00611886
*A187500                                                       @OZ30722 00611986
         SPACE 3                                                        00612008
*********************************************************************** 00620022
*                                                                     * 00640022
*MODULE-NAME = IGG02030       (TCAM,TERMINATION)               @G36XRTP 00660000
*                                                                S21903 00680022
*DESCRIPTIVE-NAME = CLOSE ROUTINE FOR TCAM MESSAGE QUEUES        S21903 00700022
*                                                                S21903 00720022
*COPYRIGHTS = 'NONE'                                             S21903 00740022
*                                                                S21903 00760022
*STATUS - VERSION 10.0                                         @G36XRTP 00800000
*                                                                     * 01000020
*FUNCTION - OPERATION                                                 * 01200020
*   FOR MESSAGE QUEUE CLOSE, THIS MODULE FREES THE IOSBE'S.    @Z40X9TG 01400009
*   FOR CHECKPOINT CLOSE, THIS MODULE XCTL'S TO IGG02041.      @Z40X9TG 01700009
*   IF THE MESSAGE QUEUE DCB IS THE LAST OPEN DCB IN THE MCP,  @Z40X9TG 02000009
*   THEN FIXED CONTROL BLOCKS (FOR EXAMPLE, THE AVT) ARE       @Z40X9TG 02300009
*   PAGE FREED.                                                @Z40X9TG 02600009
*                                                                     * 03000020
*INPUT - THE REGISTERS 5, 6, 7, AND 8 ARE THE INPUT AS FOLLOWS        * 03200020
*   5 -  THE ADDRESS OF THE BEGINNING OF THE WTG TABLE PREFIX    Y02027 03400006
*   6 -  THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE        * 03800020
*   7 -  THE ADDRESS OF THE COPY OF THE CURRENT DCB              Y02027 04000006
*   8 -  THE ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO          * 04400020
*        TABLE                                                        * 04600020
*                                                                     * 04800020
*ENTRY POINTS - THIS ROUTINE IS ENTERED AT IGG02030 VIA AN            * 05000020
*   XCTL FROM AN I/O SUPPORT MODULE OR IT MAY BE RE-ENTERED           * 05200020
*   FROM THE RELOOP PORTION OF THIS EXECUOTR IF IT IS DETERMINED      * 05400020
*   THAT THERE IS ANOTHER DATA CONTROL BLOCK TO BE CLOSED             * 05600020
*   IF ENTRY IS FROM THE I/O SUPPORT MODULE, THEN THE MODULE     Y02027 05650006
*   MUST ISSUE MODESET TO GET FROM KEY OF DATA MANAGEMENT TO     Y02027 05700006
*   KEY 0.                                                       Y02027 05750006
*                                                                     * 05800020
*OUTPUT - REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT            * 06000020
*   ENTRIES IN THE WTG TABLE PREFIX AND THE WHERE-TO-GO TABLE    Y02027 06200006
*   RESPECTIVELY.                                                Y0202M 06400006
*                                                                     * 06600020
*EXTERNAL ROUTINES -- AOS PAGE SUPERVISOR SERVICE INTERFACE (SVC 113) * 06700004
*   TO FREE PAGES CONTAINING CPB'S FROM REAL MEMORY.                  * 06800004
*                                                                     * 07000020
*EXITS - NORMAL                                                       * 07200020
*   THIS ROUTINE EXITS VIA AN XCTL TO THE EXECUTOR IDENTIFIED         * 07400020
*   BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE.              * 07600020
*   IF THE EXIT IS TO TCAM ERROR MODULE, THEN EXIT IN KEY 0;     Y02027 07660006
*   OTHERWISE, EXIT IN DATA MANAGEMENT PROTECT KEY.              Y02027 07720006
*                                                                     * 07800020
*TABLES - WORK AREAS - THE WHERE-TO-GO TABLE CONTAINS THE             * 08000020
*   ID AND TTR OF THE CLOSE EXECUTORS.  THE WTG TABLE PREFIX     Y02027 08200006
*   CONTAINS THE ADDRESSES OF THE COPIES OF THE DCB'S            Y02027 08400006
*   CURRENTLY BEING CLOSED                                       Y02027 08600006
*                                                                     * 08800020
*ATTRIBUTES - THIS ROUTINE IS EXECUTED IN LPALIB AND RUNS      @Z40X9TG 09000009
*   ENABLED, PRIVILEGED, AND RE-ENTRANT.                              * 09200020
*********************************************************************** 09300009
         EJECT                                                          09400020
*                                                                       09600020
* REGISTER USAGE                                                        09800020
*                                                                       10000020
RE       EQU   0                        WORK REGISTER                   10200020
RF       EQU   1                        WORK REGISTER                   10400020
RDCB     EQU   2                        ADDRESS OF THE CURRENT DCB      10600020
RTIOT    EQU   3                        ADDRESS OF THE TIOT             10800020
RCORE    EQU   4                        ADDRESS OF DCB WORK AREA        11000020
RPAR     EQU   5                        ADDRESS OF FIRST ENTRY IN       11200020
*                                         DCB PARAMETER LIST            11400020
RWTG     EQU   6                        ADDRESS OF WHERE-TO-GO          11600020
*                                         TABLE                         11800020
RPARC    EQU   7                        ADDRESS OF CURRENT ENTRY IN     12000020
*                                         DCB PARAMETER LIST            12200020
RWTGC    EQU   8                        ADDRESS OF THE CURRENT          12400020
*                                         ENTRY IN THE WTG TABLE        12600020
RAVT     EQU   9                        ADDRESS OF THE AVT              12800020
RUCB     EQU   10                       ADDRESS OF THE CURRENT UCB      13000020
RDEB     EQU   11                       ADDRESS OF THE DEB              13200020
RBASE    EQU   12                       BASE OF THIS ROUTINE            13400020
RC       EQU   13                       WORK REGISTER                   13600020
RD       EQU   14                       WORK REGISTER                   13800020
RJ       EQU   15                       WORK REGISTER                   14000020
*                                                                       14200020
         USING FORCORE,RCORE            DSCB DSECT                      14400020
         USING IHADCB,RDCB              DCB DSECT                       14600020
         USING IEDQDEB+36,RDEB          DEB DSECT                       14800020
         USING IEDQAVTD,RAVT            AVT DSCECT BASE                 15000020
         USING IEDQTCB,RD               TCB DSECT                       15200020
         USING IEDQTNTD,RUCB                                     X02004 15300004
         USING IEDQTCX,RC               TCX DSECT              @OZ30722 15330086
         USING CVTD,RF                  CVT DSECT                Y02027 15360006
*                                                                       15400020
         EJECT                                                 @Z40X9TG 15500009
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY S21903 15600022
         USING *,RBASE                                                  15800020
         SPACE 2                                                        15900006
         SR    RTIOT,RTIOT              CLEAR COUNT OF PASSES THROUGH   16000020
*                                       THIS MODULE                     16200020
         MODESET EXTKEY=SUPR            GET INTO KEY 0           Y02027 16400006
         SPACE 2                                                        16450006
IGG02030 IEDHJN RESTART                 MODULE ID AND DATE       S22025 16500022
         SPACE 1                                               @Z40X9TG 16600009
         LA    RTIOT,1(,RTIOT)          ADD 1 TO COUNT OF PASSES        17000020
         L     RCORE,FOUR(RWTGC)        ADDR OF OPEN WORK AREA   Y02027 17200006
         L     RDCB,DXUDCBAD            ADDR OF THE CURRENT DCB  Y02027 17250006
         SPACE 2                                                        17350006
         L     RF,CVTPTR                ADDRESS OF CVT           Y02027 17400006
         L     RC,CVTAQAVT              GET THE TCX ADDR       @OZ30722 17600086
         L     RAVT,TCXAVT              GET THE AVT ADDRESS      Y02027 18000006
         EJECT                                                 @Z40X9TG 18600009
         DEBCHK (RDCB),TYPE=VERIFY,AM=TCAM VALIDATE DEB          Y01004 18650004
         SPACE 2                                                        18700004
         LR    RJ,RF                    SAVE DEB ADDRESS         Y01004 18750004
         OI    TCXFLAG1,TCXMCPCD        MCP IS TERMINATING     @OZ30722 18756086
         L     RC,AVTCOMPT              GET CONSOLE CSCB       @OZ30722 18762086
         L     RC,0(RC)                 GET CONSOLE ECB ADDRESS@OZ30722 18768086
         MVI   0(RC),AVTEZERO           CLEAR ECB TO PREVENT   @OZ30722 18774086
*                                       301 ABENDS ON REATTACH @OZ30722 18780086
         DROP  RC                                              @OZ30722 18786086
         USING IEDQTCX,RJ               TCX DSECT              @OZ30722 18792086
         L     RF,CVTPTR                ADDRESS OF CVT           Y02027 18800006
         L     RD,AVTEZERO(,RJ)         TCB ADDRESS              A49219 19000022
         L     RDEB,TCBDEB              LOAD THE ADDRESS OF THE         19200020
*                                         FIRST DEB ON THE CHAIN        19400020
         SR    RUCB,RUCB                CLEAR COUNT OF DEBS ON TCB      19600020
CLRDEBAD EQU   *                                                        19800020
         L     RC,DEBDCBAD              LOAD THE ADDRESS OF THE DCB     20000020
*                                         FOR THIS DEB                  20200020
         TM    DSORG(RC),DISKDCB        IS THIS A MESSAGE QUEUES        20400020
*                                         DCB                           20600020
         BNO   LASTEST                  NO, BRANCH                      20800020
         LA    RUCB,1(,RUCB)            ADD 1 TO COUNT OF DEBS IN CHAIN 21000020
LASTEST  EQU   *                                                        21200020
         NC    5(3,RDEB),5(RDEB)        IS THIS THE LAST DEB IN THE     21400020
*                                         CHAIN                         21600020
         BE    LASTMSGQ                 YES, BRANCH                     21800020
         L     RDEB,4(RDEB)             NO, LOAD THE ADDRESS OF THE     22000020
*                                         NEXT DEB IN THE CHAIN         22200020
         B     CLRDEBAD                 BRANCH                          22400020
LASTMSGQ EQU   *                                                        22600020
         CR    RTIOT,RUCB               COMPARE NO.CLOSED DEBS IN       22800020
*                                       TCB CHAIN WITH TOTAL NO. OF     23000020
*                                       DEBS IN TCB CHAIN               23200020
         BE    LASTIME                  BRANCH IF ALL MSG QUEUE(OR      23400020
*                                       CKPT) DEBS ARE CLOSED           23600020
CHKPOINT EQU   *                                                        23800020
         TM    DCBOPTCD,CKPOINT+CKP3705 IS THIS CHKPOINT DCB   @G36XRTP 24000000
         BNZ   CHKPTID                  YES, BRANCH            @ZM47734 24050000
RESTDEB  EQU   *                                               @Z30X8TM 24300008
         L     RDEB,DCBDEBAD            RESTORE ADDRESS OF THE   Y02027 24400006
*                                         CURRENT DEB                   24600020
         EJECT                                                          24800020
************************************************************** @Z40X9TG 25000009
*                                                            * @Z40X9TG 25200009
*        FREE THE IOSBE'S                                    * @Z40X9TG 25400009
*                                                            * @Z40X9TG 25600009
************************************************************** @Z40X9TG 25800009
         L     RJ,AVTIOBN               LOAD ADDR OF THE       @Z40X9TG 26200009
*                                       NON-REUS IOSBE'S       @Z40X9TG 26400009
         TM    DCBOPTCD,NONREUS         IS THIS A NON-REUSABLE DISK     26600020
*                                         DATA SET                      26800020
         BO    REUS                     YES, BRANCH                     27000020
         L     RJ,AVTIOBR               LOAD ADDR OF THE       @Z40X9TG 27200009
*                                       REUS IOSBE'S           @Z40X9TG 27400009
REUS     EQU   *                                                        27600020
         SLR   RF,RF                    CLEAR FOR INSERT       @Z40X9TG 27800009
         IC    RF,DEBNMEXT              NUMBER OF EXTENTS      @Z40X9TG 28000009
         MH    RF,SZIOSBE               GET SIZE OF ALL        @Z40X9TG 28200009
*                                       IOSBE'S                @Z40X9TG 28400009
         LR    RC,RF                    SAVE SIZE              @Z40X9TG 28600009
         LR    RCORE,RJ                 SAVE IOSBE ADDRESS     @Z40X9TG 28800009
         BAL   RD,FREEPG                PAGE FREE IOSBE'S      @Z40X9TG 29400009
*                                                                X01004 29500004
         LR    RE,RC                    LENGTH TO FREE           X01004 29600004
         LR    RF,RCORE                 ADDRESS OF IOB'S TO FREE X01004 29700004
         ICM   RE,HI,SPIOSBE            SET SUBPOOL ID         @Z40X9TG 30000009
         FREEMAIN  R,LV=(0),A=(1)       FREEMAIN THE IOBS               30400020
         EJECT                                                          30600020
ENDLOAD  EQU   *                                                        30800020
         XC    0(4,RWTGC),0(RWTGC)      INDICATE THE COMPLETION OF      31000020
*                                         THIS EXECUTOR                 31200020
         LA    RF,DCBEND                LENGTH OF DCB            X01004 31201004
         LR    RJ,RDCB                  ADDRESS OF DCB           X01004 31202004
         BAL   RD,FREEPG                UNFIX DCB                X01004 31203004
*                                                                X01004 31204004
         LA    RF,DEBPRFIX              ADDR OF APPENDAGE TABLE  X01004 31205004
         SR    RDEB,RF                  ADJUST BASE              X01004 31206004
         DROP  RDEB                                              X01004 31207004
         USING IEDQDEB,RDEB                                      X01004 31208004
         L     RJ,DEBCEA                ADDRESS OF DISK END APP. X02004 31209004
         LA    RF,APPSTART-APP          GET OFFSET TO ENTRY PT @Z40X9TG 31210009
         SR    RJ,RF                    ADJUST TO START OF     @Z40X9TG 31210309
*                                       LOAD MODULE            @Z40X9TG 31210609
         LH    RF,APPLEN-APP(,RJ)       GET LENGTH FROM START  @Z40X9TG 31211009
*                                       OF APPENDAGE           @Z40X9TG 31211509
         BAL   RD,FREEPG                UNFIX APPENDAGE          X02004 31212004
         LR    RF,RDEB                  COPY DEB ADDRESS         Y01004 31213004
         ICM   RF,EIGHT,DEBLNGTH        DOUBLE WORD LENGTH OF DEBY01004 31214004
         BAL   RD,FREEPG1               PAGE FREE THE DEB        Y01004 31215004
*                                                                X01004 31216004
ENDLOAD1 EQU   *                                                 X01004 31217004
         L     RF,CVTPTR                ADDRESS OF CVT           Y02027 31218006
         TM    CVTTCMFG,LASTDCB         LAST TCAM DCB IS CLOSED  Y02027 31219006
         BNO   ENDLOAD2                 NO, BRANCH               X01004 31220004
         L     RJ,CVTAQAVT              ADDRESS OF TCX           Y02027 31221006
         SR    RCORE,RCORE              CLEAR FOR INSERT         X02004 31224004
         IC    RCORE,TCXTOTE            NUMBER OF TOTE ENTRIES   Y02027 31225006
         LM    RE,RF,TCXBUFA            ADDR AND LENGTH OF I/O   Y02027 31226006
*                                       TRACE, BUFFERS AND CPB'S X01004 31227004
         LR    RJ,RE                    COPY ADDRESS OF BUFFERS  X01004 31228004
         BAL   RD,FREEPG                UNFIX BUFRS-TRACE & CPB  X01004 31229004
         L     RUCB,AVTRNMPT            ADDRESS OF TERMINAL NAME X02004 31230004
*                                         TABLE (TNT)            X01004 31231004
         SR    RF,RF                                             X01004 31232004
         IC    RF,TNTENLEN              LENGTH OF ENTRY          X01004 31233004
         LA    RE,THREE                                          X01004 31234004
         AR    RF,RE                    BUMP FOR TNT POINTERS    X01004 31235004
         LR    RJ,RF                    SAVE ENTRY LENGTH        X02004 31236004
         MH    RF,TNTLEN                MULTIPLY LENGTH OF ENTRY X01004 31237004
*                                         BY NUMBER OF ENTRIES   X01004 31238004
         LA    RF,TNTOFF(RF)            ADD TO LENGTH THE CORDE  X01004 31239004
*                                         BEFORE THE FIRST ENTRY X01004 31240004
         LR    RD,RCORE                 NUMBER OF TOTE ENTRIES   X02004 31241004
         MR    RD,RD                    ENTRIES TO FIX FOR TOTE  X02004 31242004
         AR    RF,RJ                    ADD TOTE TO TNT LENGTH   X02004 31243004
         LTR   RJ,RJ                    ANY TOTE ENTRIES?       OY00512 31243205
         BNZ   TOTE                     BRANCH IF YES           OY00512 31243405
         LA    RF,ONE(,RF)              BUMP LENGTH BY ONE      OY00512 31243605
TOTE     EQU   *                                                OY00512 31243805
         LR    RJ,RUCB                  COPY TNT START ADDRESS   X02004 31244004
         AR    RF,RE                    ROUND TO WORD BOUNDARY   X01004 31245004
         SRL   RF,TWO                   SHIFT OUT 2 LO-ORD BITS  X01004 31246004
         SLL   RF,TWO                   SHIFT BACK               X01004 31247004
         LA    RCORE,ZERO(RF,RJ)                                 X01004 31248004
         ICM   RCORE,ALL,ZERO(RCORE)    GET ADDRESS OF TERMINAL  X01004 31249004
*                                         TABLE                  X01004 31250004
         BAL   RD,FREEPG                UNFIX TNT                X01004 31251004
         L     RF,ZERO(RCORE)           ADDRESS OF END OF THE    X01004 31252004
*                                       TERMINAL TAB AND QCBS    X01004 31253004
         LR    RUCB,RF                  SAVE ADDRESS OF SCBS     X01004 31254004
         SR    RF,RCORE                 GET LENGTH OF TERM TABLE X01004 31255004
         LR    RJ,RCORE                 ADDR OF TERMINAL TABLE   X01004 31256004
         L     RCORE,FOUR(RCORE)        ADDRESS OF THE NUMBER OF X01004 31257004
*                                         ENTRIES IN DEVICE      X01004 31258004
*                                         CHARACTERISTICS TABLE  X01004 31259004
         BAL   RD,FREEPG                UNFIX TERMINAL TABLE AND X01004 31260004
*                                         QUEUE CONTROL BLOCKS   X01004 31261004
         LH    RF,ZERO(RCORE)           NUMBER OF ENTRIES IN     X01004 31262004
*                                         DEVICE CHARACTERISTICS X01004 31263004
*                                         TABLE                  X01004 31264004
         MH    RF,AVTDCTLN              MULTIPLY BY THE SIZE   @G36XRTP 31265000
*                                       OF A DCT ENTRY         @G36XRTP 31265600
         LTR   RF,RF                    ZERO LENGTH            @YA03928 31266361
         BZ    ZERODCT                  BRANCH IF YES          @YA03928 31266661
         L     RJ,AVTCSTCS              ADDRESS OF DCT           X01004 31267004
         BAL   RD,FREEPG                UNFIX DCT                X01004 31268004
ZERODCT  EQU   *                                               @YA03928 31268561
         LR    RJ,RUCB                  ADDRESS OF SCBS          X01004 31269004
         LH    RF,TWO(RCORE)            SCB LGTH IN DOUBLEWORDS  X01004 31270004
         BAL   RD,FREEPG2               UNFIX SCB'S              X01004 31271004
         TM    AVTSCOPT,AVTCMBUF        COMMON BUFFER USED       X02004 31272004
         BZ    CKTSO                    NO, CHECK FOR TSO        X03039 31273008
         L     RUCB,AVTCBQCB            ADDRESS OF MASTER QCB    X02004 31274004
         USING IEDCMB,RUCB                                       X02004 31275004
         L     RCORE,CMBFIRST-ONE       ADDRESS OF FIRST PREFIX  X02004 31276004
         LR    RJ,RUCB                  ADDR. OF QCB, STCB'S AND X02004 31277004
*                                       PREFIXES FOR COMMBUF     X02004 31278004
         L     RF,CMBLAST-ONE           ADDRESS OF LAST PREFIX   X02004 31279004
         LA    RF,PRELNG(,RF)           ADDR. END OF LAST PREFIX X02004 31280004
         SR    RF,RJ                    LENGTH OF QCB'S, ETC.    X02004 31281004
         BAL   RD,FREEPG                FREE COMMBUF CNTRL BLOCKSX02004 31282004
         LH    RTIOT,CMBDAREA           NUMBER OF DATA AREAS     X02004 31283004
         N     RTIOT,AVTCLRHI           FORCE POSITIVE           X02004 31284004
COMLOOP  EQU   *                                                 X02004 31285004
         LA    RE,EIGHT                 CONSTANT TO LOCATE IDA   X02004 31286004
         SR    RJ,RJ                    CLEAR FOR ICM            X02004 31287004
         ICM   RJ,AD,ONE(RCORE)         ADDRESS OF DATA AREA     X02004 31288004
         SR    RJ,RE                    ADJUST TO IDA LIST PTR   X02004 31289004
         L     RF,FOUR(RJ)              TOTAL LENGTH TO FIX      X02004 31290004
         TM    ZERO(RJ),CCWIDA          IDA TO BE USED           X02004 31291004
         BNO   COMLOOP2                 NO, FIX BUFFER           X02004 31292004
         L     RJ,ZERO(RJ)              ADDRESS OF IDA LIST      X02004 31293004
COMLOOP2 EQU   *                                                 X02004 31294004
         BAL   RD,FREEPG                FREE COMMBUF DATA AREA   X02004 31295004
         LA    RCORE,PRELNG(RCORE)      BUMP TO NEXT PREFIX      X02004 31296004
         BCT   RTIOT,COMLOOP            FREE NEXT DATA AREA      X02004 31297005
CKTSO    EQU   *                        CHECK PRESENCE OF TSO    X02004 31298205
         TM    AVTBIT1,AVTTSON          TSO OR MIXED ENVIORNMENT X01004 31299004
         BZ    FREEAVT                  NO, BRANCH               X01004 31300004
         ICM   RJ,ALL,AVTTSOPT          ADDR. OF TSINPUT QCB     X02004 31301004
         BZ    FREEAVT                  BRANCH IF IT'S ZERO      X02004 31302004
         LA    RF,TSILEN(RE)            LENGTH TO FREE         @G36XRTP 31303000
         BAL   RD,FREEPG                PAGE FREE TSINPUT QCB    X02004 31304004
         L     RJ,AVTKA02               ADDRESS OF IEDQKA02     OY00451 31305005
         LTR   RF,RJ                    IS KA IN THE SYSTEM     OY00541 31305605
         BZ    NOKA                     NO, SKIP PAGEFREE       OY00541 31305905
         SH    RF,AVTHA4                ADJUST TO LENGTH        OY00451 31306205
         L     RF,ZERO(RF)              LENGTH TO PAGE FREE     OY00451 31306805
         BAL   RD,FREEPG                UNFIX IEDQKA02          OY00451 31307405
NOKA     EQU   *                                                OY00541 31307705
         LA    RF,AYZLNG                LENGTH OF IEDAYZ       @Z30X8TM 31308008
         L     RJ,AVTTSOPT              ADDRESS OF IEDAYZ      @Z30X8TM 31309008
         ICM   RJ,ALL,TSISCHED-IEDQTSI(RJ)  ADDRESS OF IEDAYZ   OY00541 31310005
         BZ    FREEAVT                  SKIP PAGEFREE IF NO AYZ OY00541 31310508
         BAL   RD,FREEPG                PAGE FREE OEDAXZ         X01004 31310608
FREEAVT  EQU   *                                                 X01004 31310708
         ICM   RJ,ALL,AVTSAVTP          GET SECONDARY AVT ADDR  OY00532 31310808
         BZ    NOSAVT                   SKIP PAGEFREE IF NO SVT OY00532 31310908
         LA    RF,SAVTVMSZ              VM ONLY                  X03039 31311008
         TM    AVTSAVTF,AVTVTMCP        3705 IN THE SYSTEM?    @G36XRTP 31311200
         BZ    ONLYEP                   NO BRANCH TO FREE      @G36XRTP 31311400
         LA    RF,SAVTSIZE              ENTIRE LENGTH            X03039 31311608
ONLYEP   EQU   *                                               @G36XRTP 31311800
         BAL   RD,FREEPG                UNFIX SECONDARY AVT     OY00532 31312405
NOSAVT   EQU   *                                                OY00532 31312505
         ICM   RF,ALL,AVTIOT            ADDR OF I/O TRACE RTNE   X01004 31313004
         BZ    FREEAVT1                 I/O TRACE NOT PRESENT  E X01004 31314004
         XC    AVTIOT,AVTIOT            CLEAR I/O TRACE POINTER OY03847 31314505
         BAL   RD,FREEPG3               PAGE FREE I/O TRACE RTN@ZM47865 31315000
FREEAVT1 EQU   *                                                 X01004 31316004
         LR    RJ,RAVT                  ADDRESS OF AVT           X01004 31317004
         LA    RF,AVTLNG                LENGTH TO UNFIX          X01004 31318004
         BAL   RD,FREEPG                UNFIX AVT               OX02223 31319054
ENDLOAD2 EQU   *                                                OX02223 31391054
         L     RCORE,4(RWTGC)           LOAD THE ADDRESS OF THE         31400020
*                                         OPEN WORK AREA                31600020
         ST    RAVT,EIGHT(RCORE)        SAVE AVT ADDRESS FOR     S22024 31660022
*                                        CHECKPOINT CLOSE        S22024 31720022
RELOOP   EQU   *                                                        31800020
         LA    RWTGC,8(RWTGC)           BUMP THE CURRENT WTG POINTER    32000020
         LA    RPARC,4(RPARC)           GET THE NEXT ENTRY IN THE       32200020
*                                         DCB PARAMETER LIST            32400020
         CLC   0(2,RWTGC),AMIDCNST      IS THIS EXECUTOR REQUIRED       32600020
*                                         AGAIN                         32800020
         BE    RESTART                  GO TO EXECUTOR           S21903 33000022
         CLC   0(2,RWTGC),CLOSEIDL                                      33200020
         BL    RELOOP                   GET NEXT ENTRY           S21903 33400022
         CLC   0(2,RWTGC),CLOSEIDH                                      33600020
         BH    RELOOP                   GET NEXT ENTRY           S21903 33800022
*                                                                       34000020
         LR    RPARC,RPAR               INITIALIZE CURRENT DCB REG      34200020
         LA    RWTGC,32(RWTG)           AND WHERE-TO-GO REGISTERS       34400020
*                                                                       34600020
ZCHECK   EQU   *                                                        34800020
         CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETED         35000020
         BNE   XCTLRTNE                 IF ENTRY IS NOT COMPLETE,       35200020
*                                         TRANSFER CONTROL              35400020
         LA    RWTGC,EIGHT(RWTGC)       BUMP POINTER TO TEST FOR        35600020
         LA    RPARC,FOUR(RPARC)          COMPLETION OF THE NEXT        35800020
*                                         ENTRY                         36000020
         B     ZCHECK                   TEST THE NEXT ENTRY             36200020
XCTLRTNE EQU   *                                                        36400020
         MODESET EXTKEY=DATAMGT         RETURN TO KEY 5          Y02027 36460006
         SPACE 2                                                        36520006
         LA    RJ,DXCCW12               LOAD THE ADDRESS OF THE         36600020
*                                         LAST DOUBLE WORD LIST         36800020
         MVC   6(TWO,RWTG),0(RWTGC)     MOVE ID TO NAME FIELD     *     37000020
         MVC   14(THREE,RWTG),TWO(RWTGC) MOVE TTR TO WTG TABLE    *     37200020
         XCTL  DE=(RWTG),SF=(E,(15))    TRANSFER CONTROL                37400020
         EJECT                                                          37600020
LASTIME  EQU   *                                                        38000020
         OI    CVTTCMFG,LASTDCB         SET LAST DCB TO BE CLOSD Y02027 39000006
         B     CHKPOINT                 RETURN TO IN-LINE CODE   X01004 40000004
         SPACE 3                                                        40500006
************************************************************** @Z40X9TG 40700009
*                                                            * @Z40X9TG 40900009
*        PAGE FREE SUBROUTINE                                * @Z40X9TG 41100009
*                                                            * @Z40X9TG 41300009
************************************************************** @Z40X9TG 41500009
FREEPG1  EQU   *                                                 X01004 42000004
         LR    RJ,RF                    COPY ADDRESS TO UNFIX    X01004 43000004
         SRL   RF,HIGHBYTE              GET NUM OF DOUBLEWORDS   X01004 44000004
FREEPG2  EQU   *                                                 X01004 45000004
         SLL   RF,THREE                 CONVERT TO BYTE LENGTH   X01004 46000004
FREEPG   EQU   *                                                 X01004 47000004
         LR    RE,RJ                    SAVE START ADDRESS       Y02027 48000006
         LA    RJ,ZERO(RF,RJ)           BUMP TO END ADDR + 1     Y02027 50000006
         LR    RF,RE                    SET START ADDRESS        Y02027 52000006
         PGFREE R,A=(1),EA=(15)         ISSUE PAGE FREE          Y02027 54000006
         BR    RD                       RETURN TO CALLER         X01004 56000004
*                                                                       66200020
FREEPG3  EQU   *                                               @ZM47865 66230000
         LR    RJ,RF                    COPY ADDR TO UNFIX     @ZM47865 66260000
         SRL   RF,HIGHBYTE              GET NUM OF DOUBLE WORDS@ZM47865 66290000
         LA    RF,TWO56(RF)             ADD BACK 2K OF MOD     @ZM47865 66320000
         B     FREEPG2                  GO GET BYTE LENGTH     @ZM47865 66350000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     66400020
CHKPTID  EQU   *                                                        66600020
         MVC   0(TWO,RWTGC),CKPTCLOZ    SET THE ID FOR         @Z30X8TM 66800008
*                                         CHECKPOINT CLOSE              67000020
         B     ENDLOAD1                 RETURN TO END OF LOAD    X01004 67200004
         EJECT                                                          67600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     67800020
TWO56    EQU   256                      2K IN DOUBLE WORDS     @ZM47865 67850000
TWO      EQU   2                        VALUE 2                  S22024 68000022
THREE    EQU   3                        VALUE 3                  S22024 68100022
FOUR     EQU   4                        VALUE 4                  S22024 68200022
SIX      EQU   6                        VALUE 6                  S22024 68300022
EIGHT    EQU   8                        VALUE 8                  S22024 68400022
TWELVE   EQU   12                       VALUE 12                 S22024 68500022
CVT      EQU   16                       VALUE 16                 S22024 68600022
DSORG    EQU   27                       VALUE 27                 S22024 68800022
NONREUS  EQU   X'02'                    NON REUSE                S22024 68900022
DEBPRFIX EQU   36                       LENGTH OF DEB PREFIX     X01004 68950004
AVTLNG   EQU   X'500'                   AVT LENGTH TO FREE       X01004 69100004
AYZLNG   EQU   X'AF4'                   LENGTH OF IEDAYZ       @Z30X8TU 69150000
LASTDCB  EQU   X'0F'                    LAST ENTRY SWITCH        X01004 69200004
ALL      EQU   15                       ICM/STCM MASK            X01004 69300004
SIXTEN   EQU   16                       NUMERIC CONSTANT         X01004 69350004
HIGHBYTE EQU   24                       SHIFT TO HIGH-ORDER BYTE X01004 69400004
ZERO     EQU   0                        NUMERIC CONSTANT         X01004 69450004
ONE      EQU   1                        NUMERIC CONSTANT         X01004 69500004
HI       EQU   8                        ICM/STCM MASK            X01004 69550004
CCWIDA   EQU   4                        INDIRECT ADDRESSING FLAG X02004 69600004
AD       EQU   7                        ICM/STCM MASK            X02004 69650004
PRELNG   EQU   12                       LENGTH OF COMMBUF PREFIX X02004 69700004
LCB3705  EQU   184                      PLCB SIZE                Y05330 69760005
CKP3705  EQU   X'10'                    OPTCD=I 3705 CHECKPOINT  S22024 69860022
CKPOINT  EQU   X'20'                    OPTCD=C TCAM CKPT DCB    S22024 69920022
DISKDCB  EQU   X'20'                    VALUE                    S22024 70000022
IOTRCSIZ EQU   32                       LENGTH OF IO TRACE ENTRY   0610 70200020
FIVE     EQU   5                        OFFSET                   Y02027 70300006
HWORD    DC    H'0'                     NUMERIC CONSTANT         S21903 70400022
CLOSEIDL DC    C'0B'                    ID OF LAST CLOSE MODULES S21903 70600022
CLOSEIDH DC    C'0G'                    ID OF LAST CLOSE MODULES S21903 70800022
AMIDCNST DC    C'30'                    ID OF THIS CLOSE EXECUTOR       71000020
H7       DC    H'7'                     NUMERIC CONSTANT         S21903 71200022
H20      DC    H'20'                    NUMERIC CONSTANT                71400020
CKPTCLOZ DC    C'41'                    ID FOR CHECKPOINT CLOSE         71500008
         DS    0F                                              @Z30X8TM 71600008
SZIOSBE  DC    AL2(IOSBELEN)            SIZE OF IOSBE          @Z40X9TG 71800009
SPIOSBE  DC    AL1(250)                 SUBPOOL FOR IOSBE'S    @Z40X9TG 71870009
         EJECT                                                 @Z40X9TG 71940009
*        OVERLAY FOR START OF DISK END APPENDAGE               @Z40X9TG 72010009
         SPACE 1                                               @Z40X9TG 72080009
APP      DSECT                                                 @Z40X9TG 72150009
APPLEN   DS    H                        LENGTH IN BYTES        @Z40X9TG 72220009
APPSIO   DS    H                        OFFSET TO DISKSIO APP  @Z40X9TG 72290009
APPNAME  DS    CL8                      NAME OF APPENDAGE      @Z40X9TG 72360009
APPHJN   DS    CL2                      HJN                    @Z40X9TG 72430009
APPSTART DS    H                        START OF CHE AND ABE   @Z40X9TG 72500009
         SPACE 4                                               @Z40X9TG 72570009
         TIOSBED                                               @OZ26164 72640000
         EJECT                                                 @Z40X9TG 74180009
         EJECT                                                          74400020
         TTCXD                                                   Y02027 74460006
         EJECT                                                          74520006
         TAVTD                                                          74600020
         EJECT                                                 @Z40X9TG 74700009
FORCORE  DSECT                                                          74800020
         IECDSECT                                                       75000020
         EJECT                                                 @Z40X9TG 75100009
         TCPBD                                                          75200020
         EJECT                                                 @Z40X9TG 75300009
         TDEBD                                                          75400020
         EJECT                                                 @Z40X9TG 75500009
         TTCBD                                                          75600020
         EJECT                                                 @Z40X9TG 75700009
         DCBD  DSORG=(TQ,DA)                                   @G36XRYP 80800000
DCBEND   EQU   X'40'                                             X01004 80840004
         EJECT                                                   Y02027 80848006
CVTD     DSECT                          CVT DSECT                Y02027 80856006
         CVT                            CVT                      Y02027 80864006
         EJECT                                                   Y02027 80872006
         TTNTD                                                   X01004 80880004
         EJECT                                                 @Z40X9TG 80900009
         TTSID                                                   X01004 80920004
         EJECT                                                          80926000
         TTSWD                                                          80932000
         EJECT                                                 @Z40X9TG 80940009
         IEDCMB                                                  X02004 80960004
         END                                                            81000020
