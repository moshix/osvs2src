         TITLE 'SECOND LOAD OF LINE CLOSE - IGG02036'                   00005008
IGG02036 CSECT                                                          00010008
*A-000000-999999                                               @X31X8T0 00015008
         SPACE 3                                                        00020008
*CHANGE-ACTIVITY = AS FOLLOWS:                                   S21903 00025008
******************** MICROFICHE FLAGS *********************** SUPT CODE 00030008
*C279000,506500                                                  A49239 00035008
*A221000,506000                                                  A41030 00040008
*C098000                                                         A49219 00045008
*A083100-083700                                                  S22025 00050008
*D506500,541000                                                  S22025 00055008
*A002000                                                         S21903 00060008
*C003000,081000,540000-548000                                    S21903 00065008
*A175000,531000                                                 SA60820 00070008
*D221300-221600                                                 SA60820 00075008
*A079000,334000,405000,536000,549000,551000                      X01004 00080008
*C187000,301000-307000,317600,320000-324000,326000,374000-380000,X01004 00085008
*C477000-488000,507000,539000                                    X01004 00090008
*D329000,422000-475000                                           X01004 00095008
*A097000,128000,374483,534000                                    Y01004 00100008
*A376720,376920,377920,539000,559400                             X02004 00105008
*C079500,375120-375160,375240-375280,375360,375520-375560,       X02004 00110008
*C376480,379240-379360                                           X02004 00115008
*A374210,374270,376150,379320,507800                             Y05330 00120008
*C378240                                                         Y05330 00125008
*D110000,261000,507150,513000,515000,523000                      Y01948 00130008
*A376360,376390,378040,507880                                   OY00465 00135008
*D378280-378360                                                 OY00465 00140008
*C379640-379720                                                 OY00451 00145008
*D507100                                                        OY00451 00150008
*A303000                                                        SA65392 00155008
*C261500                                                        SA65392 00160008
*D522000,532000                                                 SA65392 00165008
*A261800-261900,534500                                          SA64788 00170008
*A261000,514000                                                 SA62357 00175008
*C261000,263000                                                 SA62357 00180008
*D264000-279000,290000,523000                                   SA62357 00185008
*A380500,559600                                                 OX02223 00190008
*A 374780,507450                                                OY00530 00195008
*C375300                                                        OY03847 00200008
*D375450-375650,379960-380200                                   OY03847 00205008
*A317600                                                        OY03895 00210008
*A377036,377054                                                 OY00512 00215008
*A514100,514200                                                 OY03305 00220008
*C262000-280000,157700                                          OY03305 00225008
*D376360                                                        OY00541 00250905
*A376370,379720                                                 OY00541 00251005
*C379660,379840                                                 OY00541 00251105
*A379920                                                        OY00532 00251205
*A380500,559600                                                 OX02223 00253854
*C090000,128000,137000-138000,212350,333000,376060-376090,376150 Y02027 00253906
*C376160,376270,376300,418200,428000-432000                      Y02027 00254006
*D507840,37770-377790,543000-549200                              Y02027 00254106
*A019200-019800,042000,089200,089500,090700-092100,138200,148300 Y02027 00254206
*A148600,212320,332100-332500,334050-334150,376100,376155,380750 Y02027 00254306
*A402300-403000,418820,118320,471000,554300                      Y02027 00254406
*A402300-403000,418820,418320,471000,554300                      Y02027 00254506
*C160000,161000,222000,261500-261000,280000,317300,318000        Y02027 00254606
*C354000,355000,376270,514500                                    Y02027 00254706
*D516000,520000,521000                                           Y02027 00254806
*A222050,262100-262700,549700-549900                             Y02027 00254906
*C321000-321300,325500-326100                                    Y02027 00255006
*D322000-322400,334200-334600                                    Y02027 00255106
*C301600                                                       @ZA01133 00255661
*A537500                                                       @ZA01133 00256161
*A377960,378040                                                @YA03928 00257161
*A549000,549200                                                @SA70907 00257261
*C216000,537000,377780                                         @SA70907 00257361
*D217000-226000,527500,535000-536000,542500-547000             @SA70907 00257461
*D376160,379326-379353                                           X03039 00273808
*C004000,105000-106000,146000,150000,378240,379760-379800      @Z30X8TM 00281808
*C379880,507250                                                @Z30X8TM 00287808
*D379323,542500,549600                                         @Z30X8TM 00293808
*A301400,374870,514100                                         @XA03965 00296809
*C375800,551300                                                @ZA06161 00297009
*C159000                                                       @OY11974 00297191
*C537500                                                       @OZ24288 00297300
*                                                              @G36XRTP 00297600
*A379880                                                       @G36XRTP 00298100
*C105000,379440,379520,379560,507250                           @G36XRTP 00298600
*D379926-379942                                                @G36XRTP 00299100
         SPACE 3                                                        00300022
*********************************************************************** 00310022
*                                                                     * 00320022
*MODULE-NAME = IGG02036    (TCAM,TERMINATION)                  @G36XRTP 00330000
*                                                                S21903 00340022
*DESCRIPTIVE-NAME = SECOND LOAD OF LINE CLOSE                    S21903 00350022
*                                                                S21903 00360022
*COPYRIGHTS = 'NONE'                                             S21903 00370022
*                                                                S21903 00380022
*STATUS = VERSION 10.0                                         @G36XRTP 00400000
*                                                                     * 00500020
*FUNCTION - OPERATION                                                 * 00600020
*   IGG02036 EXAMINES THE TCB DEB CHAIN TO DETERMINE IF THERE         * 00700020
*   ARE ADDITIONAL TCAM LINE GROUP OR MESSAGE QUEUES DCB'S TO         * 00800020
*   BE CLOSED, IF THERE ARE NONE THE ADDRESS OF THE TCAM              * 00900020
*   DISPATCHER IS ZEROED IN THE CVT, ANY LINE BUFFERS AND/OR          * 01000020
*   CORE QUEUE DATA SETS ARE FREED UP ALONG WITH ANY LINE             * 01100020
*   CROSS REFERENCE TABLE.  I/O OPERATIONS ARE PURGED ON ALL          * 01200020
*   THE LINES AND THE LINES ARE DISABLED.  THE ERROR TAB AND          * 01300020
*   ATTENTION TAB FIELDS IN THE UCBS FOR THESE LINES WILL BE          * 01400020
*   RESET AND ALL LINE CONTROL BLOCKS FOR THIS DCB WILL BE            * 01500020
*   FREED UP.  IF THERE IS A LINE CROSS REFERENCE TABLE, THE          * 01600020
*   ENTRIES USED BY THESE LINES WILL BE RE-INITIALIZED AND            * 01700020
*   CAN BE USED AGAIN.                                                * 01800020
*                                                                     * 01900020
*   MODIFICATIONS TO THE DCB ARE MADE TO THE COPY OF THE         Y02027 01920006
*   DCB SINCE COMMON CLOSE WILL OVERLAY THE REAL DCB WITH        Y02027 01940006
*   THE COPY OF THE DCB.                                         Y02027 01960006
*                                                                     * 01980006
*INPUT - THE REGISTERS 5, 6, 7, AND 8 ARE THE INPUT AS FOLLOWS        * 02000020
*   5 -  THE ADDRESS OF THE WTG TABLE PREFIX                     Y02027 02100006
*   6 -  THE ADDRESS OF THE BEGINNING OF THE WHERE-TO-GO TABLE        * 02300020
*   7 -  THE ADDRESS OF THE COPY OF THE CURRENT DCB              Y02027 02400006
*   8 -  THE ADDRESS OF THE CURRENT ENTRY IN THE WHERE-TO-GO          * 02600020
*        TABLE                                                        * 02700020
*                                                                     * 02800020
*ENTRY POINTS - THIS ROUTINE IS ENTERED AT IGG02036 VIA AN            * 02900020
*   XCTL FROM THE CLOSE EXECUTOR IGG02035 OR IT MAY BE RE-ENTERED     * 03000020
*   FROM THE RELOOP PORTION OF THIS EXECUOTR IF IT IS DETERMINED      * 03100020
*   THAT THERE IS ANOTHER DATA CONTROL BLOCK TO BE CLOSED. THE   Y02027 03200006
*   MODULE RECEIVES CONTROL FROM IGG02035 IN PROTECT KEY 0       Y02027 03250006
*                                                                     * 03300020
*OUTPUT - REGISTERS 7 AND 8 WILL BE POSITIONED AT THE NEXT            * 03400020
*   ENTRIES IN THE WHERE-TO-GO TABLE PREFIX AND THE WHERE-       Y02027 03500006
*   TO-GO TABLE RESPECITIVELY.                                   Y02027 03600006
*                                                                     * 03700020
*EXTERNAL ROUTINES - NONE                                             * 03800020
*                                                                     * 03900020
*EXITS - NORMAL                                                       * 04000020
*   THIS ROUTINE EXITS VIA AN XCTL TO THE EXECUTOR IDENTIFIED         * 04100020
*   BY THE NEXT NON-ZERO ENTRY IN THE WHERE-TO-GO TABLE.              * 04200020
*   THE EXIT IS MADE IN THE PROTECT KEY OF DATA MANAGEMENT.      Y02027 04250006
*                                                                     * 04300020
*TABLES - WORK AREAS - THE WHERE-TO-GO TABLE CONTAINS THE             * 04400020
*   ID AND TTR OF THE CLOSE EXECUTORS, AND THE WHERE-TO-         Y02027 04500006
*   GO TABLE PREFIX CONTAINS THE ADDRESS OF A COPY OF            Y02027 04550006
*   EACH DCB SPECIFIED IN THE CLOSE MACRO INSTRUCTION            Y02027 04600006
*   SPECIFIED IN THE CLOSE MACRO INSTRUCTION.                         * 04700020
*                                                                     * 04800020
*ATTRIBUTES - THIS ROUITNE IS EXECUTED IN THE TRANSIENT AREA AS       * 04900020
*   ENABLED, PRIVILEGED, AND RE-ENTRANT.                              * 05000020
*********************************************************************** 05020052
*********************************************************************** 05050022
         EJECT                                                          05100020
* REGISTER USAGE                                                        05200020
*                                                                       05300020
RE       EQU   0                        WORK REGISTER                   05400020
RF       EQU   1                        WORK REGISTER                   05500020
RDCB     EQU   2                        ADDRESS OF THE CURRENT DCB      05600020
RTIOT    EQU   3                        ADDRESS OF THE TIOT             05700020
RCORE    EQU   4                        ADDRESS OF DCB WORK AREA        05800020
RPAR     EQU   5                        ADDRESS OF FIRST ENTRY IN       05900020
*                                         DCB PARAMETER LIST            06000020
RWTG     EQU   6                        ADDRESS OF WHERE-TO-GO          06100020
*                                         TABLE                         06200020
RPARC    EQU   7                        ADDRESS OF CURRENT ENTRY IN     06300020
*                                         DCB PARAMETER LIST            06400020
RWTGC    EQU   8                        ADDRESS OF CURRENT ENTRY IN     06500020
*                                         IN WTG TABLE                  06600020
RAVT     EQU   9                        ADDRESS OF THE AVT              06700020
RUCB     EQU   10                       ADDRESS OF THE CURRENT UCB      06800020
RDEB     EQU   11                       BASE OF THIS ROUTINE            06900020
RBASE    EQU   12                       WORK REGISTER                   07000020
RC       EQU   13                       WORK REGISTER                   07100020
RD       EQU   14                       WORK REGISTER                   07200020
RJ       EQU   15                       WORK REGISTER                   07300020
*                                                                       07400020
         USING IEDQDEB+36,RDEB          DEB DSECT                       07500020
         USING IEDQTCB,RD               TCB DSECT                       07600020
         USING IHADCB,RDCB                                              07700020
         USING IEDQLCB,RCORE            LCB DSECT                       07800020
         USING IEDQAVTD,RAVT                                            07900020
         USING IEDQTNTD,RUCB                                     X02004 07950005
*                                                                       08000020
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY S21903 08100022
         USING *,RBASE                                                  08200020
         SPACE 2                                                        08250006
IGG02036 IEDHJN START                                            Y02027 08300006
         SPACE 2                                                        08350006
         SR    RTIOT,RTIOT              CLEAR A COUNT REGISTER          08400020
         EJECT                                                          08500020
RESTART  EQU   *                                                        08600020
         LA    RTIOT,ONE(RTIOT)         INCREMENT THE COUNT OF THE      08700020
*                                         PASSES THRU THIS MODULE       08800020
         L     RJ,FOUR(RWTGC)           ADDR OF OPEN WORK AREA   Y02027 08900006
         USING FORCORE,RJ               OPEN WORK AREA DSECT     Y02027 08930006
         L     RDCB,DXUDCBAD            GET CURRENT DCB ADDRESS  Y02027 08960006
         L     RF,CVTPTR                LOAD ADDRESS OF CVT      Y02027 09000006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 09050006
         L     RF,CVTAQAVT              GET TCX ADDRESS          Y02027 09100006
         USING IEDQTCX,RF               TCX ADDRESSABILITY       Y02027 09200006
         L     RAVT,TCXAVT              GET THE AVT ADDRESS      Y02027 09300006
         L     RDEB,DCBDEBAD            GET THE DEB ADDRESS      Y02027 09500006
         L     RD,DEBTCBAD              GET THE TCB ADDRESS      Y02027 09700006
         L     RDEB,TCBDEB              LOAD THE ADDRESS OF THE         09900020
*                                         FIRST DEB ON THE CHAIN        10000020
         SR    RUCB,RUCB                CLEAR A COUNT REGISTER          10100020
CLRDEBAD EQU   *                                                        10200020
         L     RC,DEBDCBAD              LOAD THE ADDRESS OF THE DCB     10300020
*                                         FOR THIS DEB                  10400020
         TM    DSORG(RC),LINEDCB+DISKDCB+DCB3705    LINE GRP   @G36XRTP 10500000
*                                       OR MSG Q OR                     10600000
*                                       CHECKPOINT DCB           S22024 10700022
         BZ    LASTEST                  NO, BRANCH               S22024 10800022
         LA    RUCB,ONE(RUCB)           INCREMENT THE COUNT OF DEBS     11100020
*                                         ON THE CHAIN                  11200020
LASTEST  EQU   *                                                        11300020
         L     RDEB,FOUR(RDEB)          GET NEXT DEB ADDRESS     S22024 11400022
         LA    RDEB,AVTEZERO(RDEB)      CLEAR HIGH ORDER BYTE    S22024 11500022
         LTR   RDEB,RDEB                ANY MORE DEBS IN CHAIN   S22024 11600022
         BNZ   CLRDEBAD                 YES, CHECK THEM          S22024 11700022
         CR    RTIOT,RUCB               COMPARE THE NUMBER OF PASSES    12100020
*                                         THROUGH THIS MODULE WITH      12200020
*                                         THE NUMBER OF DEBS ON THE     12300020
*                                         TCB CHAIN                     12400020
         BE    LASTIME                  IF EQUAL, DO THE FINAL          12500020
*                                         OPERATIONS                    12600020
SETDEB   EQU   *                                                        12700020
         L     RDEB,DCBDEBAD            RESTORE THE DEB ADDRESS  Y02027 12800006
         LA    RC,SETLCB                SET A BRANCH ADDRESS            12950020
         EJECT                                                          13000020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     13100020
*                                                                 *     13200020
*              PURGE I/O ON ALL THE LINES                         *     13300020
*                                                                 *     13400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     13500020
PURGELIN EQU   *                                                        13600020
         L     RF,CVTPTR                LOAD ADDRESS OF CVT      Y02027 13700006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 13750006
         MVC   DEBEXSCL+1(THREE),CVTXAPG+1 MOVE IN THE ADDR OF   Y02027 13800006
*                                         IOS APPENDAGES                13900020
         L     RF,4(RWTGC)              LOAD THE ADDRESS OF THE         14000020
*                                         OPEN WORK AREA                14100020
         ST    RDEB,0(RF)               STORE DEB ADDRESS IN            14200020
*                                         PARAMETER LIST                14300020
         MVI   0(RF),OPTION             MOVE IN THE OPTION BYTE         14400020
         XC    FOUR(EIGHT,RF),FOUR(RF)  CLEAR FOR PURGE                 14500020
         PURGE (1)                      PURGE I/O ON ALL LINES @Z30X8TM 14600008
*                                                                       14700020
         LA    RE,ONE                   LOAD THE WAIT COUNT             14800020
         L     RF,4(RWTGC)              LOAD THE ADDRESS OF THE  Y02027 14830006
*                                       OPEN WORK AREA           Y02027 14860006
         LA    RF,FOUR(RF)              GET ECB ADDRESS                 14900020
         WAIT  ECB=(1)                  WAIT FOR PURGE         @Z30X8TM 15000008
*                                                                       15100020
         BR    RC                       BR ON PRE-SET REGISTER   S22024 15150022
         EJECT                                                          15200020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     15300020
*                                                                 *     15400020
*    DISABLE ALL LINES UNLESS A TYPE III ADAPTER OR 3705         S22024 15500022
*                                                                 *     15600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     15700020
SETLCB   EQU   *                                                        15750020
         TM    DCBDSORG+ONE,DCB3705     IS THIS A 3705 DCB       S22024 15760022
         BO    OUT                      YES, SKIP DISABLE       OY03305 15770005
         SR    RC,RC                    CLEAR FOR LINE COUNT            15800020
         SR    RF,RF                    CLEAR                  @OY11974 15900091
         IC    RC,DEBNMEXT              NUMBER OF LINES        @OY11974 15910091
SCAN     EQU   *                                               @OY11974 15920091
         L     RUCB,DEBUCBAD(RF)        UCB POINTER            @OY11974 15930091
         LTR   RUCB,RUCB                IS IT DUMMY            @OY11974 15940091
         BNZ   CONT                     BR, NO                 @OY11974 15950091
         LA    RF,FOUR(RF)              INCREMENT INDEX        @OY11974 15960091
         BCT   RC,SCAN                  CHECK NEXT LINE        @OY11974 15970091
         B     OUT                      ALL LINES DUMMY        @OY11974 15980091
CONT     EQU   *                                               @OY11974 15990091
         TM    UCBUNTYP-UCBOB(RUCB),TYPE3 IS THIS AN IBM TERMINALY02027 16000006
*                                       ADAPTER , TYPE III       Y02027 16100006
         BZ    OUT                      YES, BRANCH                     16200020
         L     RCORE,DCBIOBAD           LOAD THE ADDRESS OF THE LCB     16300020
*                                         AREA                          16400020
         LA    RJ,IOBPTR                LOAD THE DISPLACEMENT OF        16500020
*                                         THE IOB                       16600020
         SR    RCORE,RJ                 ACCESS THE BEGINNING OF THE     16700020
*                                         LCB AREA                      16800020
         SR    RUCB,RUCB                CLEAR AN INDEX REGISTER         16850020
         SR    RD,RD                    CLEAR A SIZE REGISTER           16900020
         IC    RD,DCBEIOBX              GET THE SIZE OF AN LCB          17000020
         IC    RC,DEBNMEXT              LOAD THE NUMBER OF LINES        17100020
*                                                                       17200020
LOOP     EQU   *                                                        17300020
         AR    RCORE,RD                 ACCESS THE BEGINNING OF THE     17400020
*                                         FIRST/NEXT LCB                17500020
         MVI   LCBCPA+20,POST           POST LCB FOR DUMMY LINE SA60820 17510022
         L     RJ,DEBUCBAD(RUCB)        LOAD THE UCB ADDRESS            17520020
         LTR   RJ,RJ                    IS THIS A DUMMY LINE            17540020
         BZ    LOOP01                   YES, BRANCH                     17560020
         MVC   LCBCPA(8),DISABLE        SET A DISABLE COMMAND           17600020
*                                         CHANNEL PROGRAM AREA          17700020
         XC    LCBCPA+20(FOUR),LCBCPA+20 CLEAR FOR DISABLE              17800020
         LA    RF,LCBCPA+20             GET ECB ADDRESS FOR IOS         17900020
         ST    RF,LCBECBCC              STORE THE ECB ADDRESS IN        18000020
*                                         THE LCB                       18100020
         LA    RF,LCBCPA                GET ADDRESS OF CHANNEL          18200020
*                                         PROGRAM AREA                  18300020
         ST    RF,LCBSIOCC              STORE IN FIRST CCW POINTER      18400020
         LA    RF,LCBFLAG1              LOAD THE ADDRESS OF THE IOS     18500020
*                                         FLAG BYTES                    18600020
         EXCPVR (1),SUBSYS              DISABLE THE LINE         X01004 18700005
LOOP01   EQU   *                                                        18730020
         LA    RUCB,FOUR(RUCB)          INCREMENT THE INDEX             18760020
         BCT   RC,LOOP                    BRANCH IF THERE ARE MORE      18800020
*                                         LINES TO DISABLE              18900020
         EJECT                                                          19000020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     19100020
*                                                                 *     19200020
*        WAIT FOR THE DISABLE COMMANDS TO COMPLETE                *     19300020
*                                                                 *     19400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     19500020
         L     RCORE,DCBIOBAD           LOAD THE BEGINNING ADDRESS      19600020
*                                         OF THE LCB AREA               19700020
         LA    RJ,IOBPTR                LOAD THE DISPLACEMENT OF        19800020
*                                         THE IOB                       19900020
         SR    RCORE,RJ                 ACCESS THE BEGINNING OF         20000020
*                                         THE LCB AREA                  20100020
         IC    RC,DEBNMEXT              GET NUMBER OF LINES             20200020
         TIME  BIN                      GET TIME FOR COMPARE       0616 20300020
         L     RJ,FOUR(RWTGC)           LOAD THE ADDRESS OF THE         20320020
*                                         OPEN WORK AREA                20340020
         ST    RTIOT,0(RJ)              SAVE REG3 IN WORK AREA   S22024 20360022
         LR    RTIOT,RE                 SAVE THE ORIGINAL TIME          20380020
WAITLOOP EQU   *                                                        20500020
         AR    RCORE,RD                 ACCESS THE FIRST/NEXT LCB       20600020
TESTPCD  EQU   *                                                   0616 20700020
         TM    LCBCPA+20,X'40'          CHECK ECB FOR COMPLETION   0616 20800020
         BZ    TESTDLAY                 BRANCH IF NOT COMPLETE     0616 20900020
BCT      EQU   *                                                        21000020
         BCT   RC,WAITLOOP              LOOP FOR NEXT WAIT              21100020
         LA    RC,OUT                   SET A BRANCH ADDRESS            21210020
         L     RJ,FOUR(RWTGC)           GET THE ADDRESS OF THE OPEN     21220020
*                                         WORK AREA                     21230020
         USING FORCORE,RJ               OPEN WORK AREA DSECT     Y02027 21233006
         L     RDCB,DXUDCBAD            RESTORE THE DCB ADDRESS  Y02027 21236006
         L     RTIOT,0(RJ)              RESTORE REGISTER 3              21240020
         B     PURGELIN                 PURGE I/O ON ALL LINES          21250020
TESTDLAY EQU   *                                                   0616 21400020
         LTR   RDCB,RDCB                CHECK FOR DELAY DONE       0616 21500020
         BZ    BCT                      BR YES, CHECK NEXT LINE@SA70907 21600061
         TIME  BIN                      GET CURRENT TIME           0616 22700020
         LTR   RTIOT,RTIOT              TEST THE ORIGINAL TIME          22800020
         BNM   COMPUTE                  BRANCH IF NOT NEGATIVE     0616 22900020
         LTR   RE,RE                    CHECK CURRENT TIME         0616 23000020
         BM    COMPUTE                  BRANCH IF MINUS            0616 23100020
         LCR   RTIOT,RTIOT              COMPLIMENT THE ORIGINAL TIME    23120020
         ALR   RE,RTIOT                 ADD THE TIMES                   23140020
         LCR   RTIOT,RTIOT              RESTORE THE ORIGINAL TIME       23160020
         B     COMPARE2                 SKIP SUBTRACT              0617 23500020
COMPUTE  EQU   *                                                   0616 23600020
         SLR   RE,RTIOT                 SUBTRACT THE TIMES IF THEY      23660020
*                                         ARE POSITIVE                  23720020
COMPARE2 EQU   *                                                   0617 23800020
         CH    RE,LIMIT                 CHECK FOR 28 SECOND LIMIT  0616 23900020
         BL    TESTPCD                  BRANCH IF NOT REACHED      0616 24000020
         SR    RDCB,RDCB                CLEAR REG TO INDICATE DELAY0616 24100020
         B     TESTPCD                  CHECK ECB AGAIN            0616 24200020
         EJECT                                                          24300020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     24400020
*                                                                 *     24500020
*        THIS SECTION OF CODE RESETS THE ERROR TAB AND            *     24600020
*        ATTENTION TAB FIELDS IN THE UCBS FOR ALL LINES           *     24700020
*                  IN THIS LINE GROUP                             *     24800020
*                                                                 *     24900020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     25000020
OUT      EQU   *                                                   0616 25100020
         SR    RE,RE                    CLEAR FOR A LINE COUNT          25200020
         IC    RE,DEBNMEXT              GET THE NUMBER OF LINES IN      25300020
*                                         THIS LINE GROUP               25400020
         SR    RD,RD                    CLEAR AN INDEX REGISTER         25500020
GETADDR  EQU   *                                                        25600020
         L     RF,DEBUCBAD(RD)          LOAD THE ADDRESS OF THE         25700020
*                                         FIRST/NEXT UCB                25800020
         LTR   RF,RF                    IS THIS A // DD DUMMY ENTRY     25900020
         BZ    NEXTUCB                  YES, BRANCH                     26000020
         SR    RCORE,RCORE              CLEAR IC REGISTER       SA62357 26110052
         IC    RCORE,DEBNMEXT           NUMBER OF EXTENTS       SA62357 26120052
         SLL   RCORE,TWO                TIMES FOUR              SA62357 26130052
         LA    RCORE,DEBUCBAD(RCORE)    POINT TO ACCESS METHOD  SA62357 26140052
         NI    ONE(RF),XFB              GUARANTEE UCBNALOC BIT  SA64788 26180054
*                                         SET BY TOTE IS OFF    SA64788 26190054
         L     RJ,UCBEXTPT-UCBOB(,RF)   POINT TO UCB EXTENSION   Y02027 26195006
         MVC   UCBETI-UCBCMEXT(ONE,RJ),FOUR(RCORE) RESTORE       Y02027 26200006
*                                       ERRTAB OF REPRESENTATIVE Y02027 26500006
*                                       UCB                      Y02027 26800006
         MVC   UCBATI-UCBCMEXT(ONE,RJ),FIVE(RCORE) RESTORE ATTN  Y02027 27100006
*                                       TAB                      Y02027 27400006
NEXTUCB  EQU   *                                                        28100020
         LA    RD,FOUR(RD)              INCREMENT THE UCB INDEX         28200020
         BCT   RE,GETADDR               RESET THE NEXT LINE             28300020
         EJECT                                                          28400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     28500020
*                                                                 *     28600020
*        FREEMAIN ALL OF THE LCB'S                                *     28700020
*                                                                 *     28800020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     28900020
TYPEIII  EQU   *                                                        29000020
         L     RCORE,DCBIOBAD           LOAD THE BEGINNING ADDRESS      29100020
*                                         OF THE LCB AREA               29200020
         LA    RJ,IOBPTR                LOAD THE DISPLACEMENT OF        29300020
*                                         THE IOB                       29400020
         SR    RCORE,RJ                 ACCESS THE BEGINNING OF         29500020
*                                         THE LCB AREA                  29600020
         SR    RD,RD                    CLEAR A SIZE REGISTER           29700020
         IC    RD,DCBEIOBX              GET THE SIZE OF AN LCB          29800020
         AR    RCORE,RD                 GET THE ADDRESS OF THE          29900020
*                                         FIRST LCB                     30000020
         LR    RF,RD                    COPY SIZE OF AN LCB      X01004 30050005
         IC    RD,DEBNMEXT              NUMBER OF LINE GROUPS    X01004 30100005
         TM    DCBDSRG2,DCBDSGTR        IS THIS A 3705 LCB      SA65392 30120005
         BO    LCB3705A                 YES,SKIP THRESHOLD CODE SA65392 30140005
         MVC   AVTDOUBL(1),LCBRSKEY     SAVE LINE SCHEDULER'S  @XA03965 30146009
*                                       DISP CODE              @XA03965 30152009
         AH    RF,THRESHL               ADD LENGTH OF          @ZA01133 30160061
*                                         THRESHHOLD VALUES     SA65392 30220005
LCB3705A EQU   *                                                SA65392 30260005
         MR    RE,RD                    GET TOTAL LCB AREA SIZE  X01004 30300005
         LA    RJ,DEBUCBAD              LOAD A POINTER TO THE UCB       30800020
*                                         ADDRESSES                     30900020
GETUCBAD EQU   *                                                        31000020
         L     RC,0(RJ)                 LOAD A UCB ADDRESS              31100020
         LA    RC,0(RC)                 CLEAR THE HIGH ORDER BYTE       31200020
         LTR   RC,RC                    IS THIS A VALID ADDRESS         31300020
         BNZ   DIALTEST                 YES, BRANCH                     31400020
         LA    RJ,FOUR(RJ)              INCREMENT THE UCB POINTER       31500020
         B     GETUCBAD                 GET THE NEXT UCB ADDRESS        31600020
DIALTEST EQU   *                                                        31700020
         TM    UCBDVCLS-UCBOB(RC),GRAPHICS IS THIS A GRAPHICS DEVY02027 31730006
         BO    FREE2260                 YES-BR TO UNFIX 2260 RTN X01004 31760005
         TM    DCBDSORG+ONE,DCB3705     IS THIS A 3705 DCB      OY03895 31770005
         BO    FREE2260                 YES, BRANCH             OY03895 31780005
         TM    UCBTBYT2-UCBOB(RC),DIAL  IS THIS A DIAL LINE      Y02027 31800006
         BZ    COPYSIZE                 NO, BRANCH                      31900020
         LA    RC,EIGHT(RF)             ADD 8 BYTES FOR DIAL-OUT X01004 32000005
*                                        CALL QUEUE              X01004 32020005
         SR    RF,RF                                             X01004 32040005
         IC    RF,AVTSCBSZ              SIZE OF AN SCB           X01004 32060005
         MR    RE,RD                    TOTAL SCB AREA           X01004 32080005
         ST    RF,LCBCPA                SAVE LENGTH OF SCB AREA  Y02027 32100006
         L     RJ,LCBMSGFM              ADDRESS OF SCB'S         Y02027 32110006
         BAL   RD,FREEPG                FREE SCB AREA            Y02027 32120006
         L     RE,LCBCPA                GET LENGTH OF SCB AREA   Y02027 32130006
         L     RF,LCBMSGFM              ADDRESS OF SCB'S         X01004 32140005
         ICM   RE,HI,SP250              SET SUBPOOL FOR FREEMAIN X01004 32160005
         FREEMAIN R,LV=(0),A=(1)                                 X01004 32180005
         LA    RE,EIGHT                                          X01004 32260005
         SR    RCORE,RE                 ADJ STRT OF LCB FOR DIAL X01004 32280005
COPYSIZ1 EQU   *                                                 X01004 32300005
         LR    RF,RC                    COPY LENGTH OF LCB AREA  X01004 32350005
COPYSIZE EQU   *                                                        32500020
         LR    RC,RF                    SAVE LCB LENGTH          Y02027 32550006
         LR    RJ,RCORE                 ADDRESS OF LCB'S         Y02027 32560006
         BAL   RD,FREEPG                FREE LCB AREA            Y02027 32570006
         LR    RE,RC                    LENGTH OF LCB AREA       Y02027 32600006
         ICM   RE,HI,SP250              SET SUBPOOL FOR FREEMAIN X01004 32650005
         LR    RF,RCORE                 COPY THE LCB AREA STARTING      32700020
*                                         ADDRESS                       32800020
*                                         FOR PROBLEM PROGRAM MODE      33000020
*                                                                       33100020
         FREEMAIN  R,LV=(0),A=(1)                                       33200020
         SPACE 2                                                 Y02027 33210006
*        CLEAR THE DCB FIELDS IN THE COPY OF THE DCB.            Y02027 33220006
         DROP  RDCB                     DROP RDCB AS DCB BASE    Y02027 33230006
         USING IHADCB,RF                ADDR OF COPY OF THE DCB  Y02027 33240006
         L     RF,ZERO(RPARC)           POINT TO COPY OF DCB     Y02027 33250006
         STCM  RAVT,AD,DCBIOBAA         RESTORE AVT ADDR IN DCB  Y02027 33300006
         XC    DCBEIOBX(1),DCBEIOBX     CLEAR SIZE OF LCB               33400020
         DROP  RF                       DROP RF AS DCB BASE      Y02027 33405006
         USING IHADCB,RDCB              ADDR THE REAL DCB        Y02027 33410006
         SPACE 2                                                 Y02027 33415006
         EJECT                                                          33500020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     33600020
*                                                                 *     33700020
*        THIS SECTION OF CODE REMOVES AN ENTRY FROM THE           *     33800020
*        CROSS REFERENCE TABLE AND MAKES THE SPACE IT             *     33900020
*        FORMERLY OCCUPIED AVAILABLE TO SUBSEQUENT OPENS          *     34000020
*                                                                 *     34100020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     34200020
         NC    AVTCRSRF(4),AVTCRSRF     DO WE HAVE A CROSS              34300020
*                                         REFERENCE TABLE               34400020
         BZ    ENDLOAD                  NO, BRANCH                      34500020
         SR    RE,RE                    CLEAR FOR A LINE COUNT          34600020
         IC    RE,DEBNMEXT              GET THE NUMBER OF LINES IN      34700020
*                                         THIS LINE GROUP               34800020
         SR    RD,RD                    CLEAR FOR THE UCB INDEX         34900020
CROSSREF EQU   *                                                        35000020
         L     RJ,DEBUCBAD(RD)          LOAD THE ADDRESS OF THE         35100020
*                                         FIRST/NEXT UCB IN THIS        35200020
*                                         LINE GROUP                    35300020
         L     RJ,UCBNAME-ONE-UCBOB(,RJ) LOAD THE UCB NAME       Y02027 35400006
*                                       FROM THE UCB             Y02027 35500006
         L     RF,AVTCRSRF              LOAD THE ADDRESS OF THE         35600020
*                                         CROSS REFERENCE TABLE         35700020
         LA    RC,EIGHT(RF)             LOAD THE ADDRESS OF THE         35800020
*                                         FIRST ENTRY IN THE TABLE      35900020
COMPUCB  EQU   *                                                        36000020
         C     RJ,0(RC)                 ARE THE UCB NAMES THE SAME      36100020
         BNE   CHKNEXT                  NO, BRANCH                      36200020
         XC    0(CRSFSIZE,RC),0(RC)     YES, CLEAR ALL INFORMATION      36300020
*                                         FROM THIS ENTRY               36400020
         MVC   ONE(THREE,RC),ONE(RF)    MOVE THE ADDRESS OF THE         36500020
*                                         NEXT AVAILABLE ENTRY INTO     36600020
*                                         THE ENTRY CHAIN               36700020
         ST    RC,0(RF)                 MAKE THIS ENTRY THE NEXT        36800020
*                                         AVAILABLE ENTRY IN THE        36900020
*                                         CROSS REFERENCE TABLE         37000020
NEXTENTY EQU   *                                                        37100020
         LA    RD,FOUR(RD)              INCREMENT THE UCB POINTER       37200020
         BCT   RE,CROSSREF              DECREMENT THE LINE COUNT        37300020
ENDLOAD  EQU   *                                                 X01004 37400005
         SR    RCORE,RCORE                                       X01004 37403005
         IC    RCORE,DCBILCT            NUM OF INVITATION LISTS  X01004 37406005
         LA    RF,DEBPRFIX              LENGTH OF DEB PREFIX     X01004 37409005
         SR    RDEB,RF                  ADJ DEB BASE TO PREFIX   X01004 37412005
         DROP  RDEB                                              X01004 37415005
         USING IEDQDEB,RDEB                                      X01004 37418005
         L     RJ,DEBCEA                ADDRESS OF LINE END APP. X02004 37421005
         TM    DCBDSORG+ONE,DCB3705     3705 DCB                 Y05330 37421605
         BNO   NOT3705                  NO, BRANCH               Y05330 37422205
         SH    RJ,AVTHA4                ADJUST START ADDRESS     Y05330 37422805
NOT3705  EQU   *                        SET TO PAGE FREE APPEND. Y05330 37423405
         BAL   RD,FREEPG3               UNFIX PAGES OCCUPIED BY  X02004 37424005
*                                        LINE END APPENDAGE      X01004 37427005
         TM    DCBDSORG+ONE,DCB3705     3705 DCB                 Y05330 37428005
         BO    FREEDCB                  YES, FREE DCB AND DEB    Y05330 37429005
INVFREE  EQU   *                                                 X01004 37430005
         LR    RD,RCORE                 GET INVITATION LISTS YET X01004 37433005
*                                        TO FREE                 X01004 37436005
         BCTR  RD,ZERO                  SUBTRACT ONE             X01004 37439005
         AR    RD,RD                    CONVERT BYTE INDEX TO    X01004 37442005
         AR    RD,RD                     FOUR BYTE INDEX         X01004 37445005
         L     RUCB,DCBINVLI(RD)        ADDRESS OF INVITATION    X01004 37448005
*                                         LIST                   X01004 37451005
         SR    RC,RC                                             X01004 37454005
         SR    RF,RF                                             X01004 37457005
         IC    RC,0(RUCB)               GET NUMBER OF ENTRIES    X01004 37460005
         IC    RF,TWO(RUCB)             GET LENGTH OF EACH ENTRY X01004 37463005
         MR    RE,RC                    GET LENGTH OF LIST       X01004 37466005
         AR    RC,RC                    MULTIPY NUM OF ENTRIES   X01004 37469005
*                                       BY TWO TO GET SIZE OF           37472005
*                                         INVITATION LIST PREFIX X01004 37475005
         AR    RF,RC                    SET LENGTH TO FIX        X01004 37478005
         LA    RF,INVSIZE(RF)           INCREMENT SIZE TO       OY00530 37478354
*                                       INCLUDE DOUBLE WORD     OY00530 37478654
*                                       CONTROL FIELD AND       OY00530 37478954
*                                       DELIMITER               OY00530 37479254
         TM    STATUS(RUCB),INVEOT      WAS EOT SPECIFIED ON    OY00530 37479554
*                                       INVLIST MACRO           OY00530 37479854
         BZ    INVADDR                  NO, BRANCH              OY00530 37480154
         LA    RF,ONE(RF)               ADD 1 TO SIZE - FOR EOT OY00530 37480454
INVADDR  EQU   *                                                OY00530 37480754
         SR    RUCB,RC                  GET ADDRESS OF PREFIX    X01004 37481005
         LR    RJ,RUCB                  ADDRESS TO FIX           X01004 37484005
         BAL   RD,FREEPG                UNFIX INVITATION LIST    X01004 37487005
         LR    RD,RCORE                 GET NO. OF INVLISTS YET@XA03965 37487109
*                                       TO BE FREED            @XA03965 37487209
         BCTR  RD,ZERO                  SUBTRACT ONE           @XA03965 37487309
         AR    RD,RD                    CONVERT BYTE INDEX TO  @XA03965 37487409
         AR    RD,RD                    FOUR-BYTE INDEX        @XA03965 37487509
         L     RUCB,DCBINVLI(RD)        INVLIST ADDRESS        @XA03965 37487609
         CLI   AVTDOUBL,BUFKEY          BUFF TERM LINE?        @XA03965 37487709
         BE    NOCPUID                  BRANCH IF YES          @XA03965 37487809
         CLI   FIVE(RUCB),ZERO          CPUID ADDRESS HERE     @XA03965 37487909
         BE    NOCPUID                  BRANCH IF NO           @XA03965 37488009
         L     RJ,FOUR(,RUCB)           CPUID ADDRESS          @XA03965 37488109
         SR    RF,RF                    CLEAR FOR INSERT       @XA03965 37488209
         IC    RF,ZERO(,RJ)             NO. OF CHARS IN CPUID  @XA03965 37488309
         LA    RF,ONE(,RF)              ADD ONE FOR PREFIX     @XA03965 37488409
         BAL   RD,FREEPG                UNFIX CPUID            @XA03965 37488509
NOCPUID  EQU   *                                               @XA03965 37488609
         BCT   RCORE,INVFREE            RELEASE NEXT LIST        X01004 37490005
         L     RJ,DEBSIOA               ADDRESS OF START I/O APP X02004 37500005
         BAL   RD,FREEPG3               UNFIX APPENDAGE          X02004 37505005
         ICM   RF,AD,DCBSCTAD           ADDRESS OF SCT           X01004 37510005
         ICM   RF,HI,DEBEOEA+THREE      LENGTH OF SCT            X02004 37515005
         BAL   RD,FREEPG1               UNFIX SCT                X01004 37520005
         TM    DCBPCI,PCI               PCI PRESENT              X01004 37525005
         BO    FREEDCB                  NO, BRANCH              OY03847 37530005
         L     RJ,DEBPCIA               ADDRESS OF PCI           X02004 37535005
         BAL   RD,FREEPG3               UNFIX PCI APPENDAGE      X02004 37540005
FREEDCB  EQU   *                                                 X01004 37570005
         LR    RJ,RDCB                  DCB ADDRESS              X01004 37575005
         SR    RF,RF                    CLEAR REG              @ZA06161 37580009
         IC    RF,DCBILCT               NUMBER OF ELEMENTS IN  @ZA06161 37581009
*                                        INVITATION LIST       @ZA06161 37582009
         SLL   RF,TWO                   INVITATION LIST LENGTH @ZA06161 37583009
         LA    RF,DCBEND(0,RF)          LENGTH OF DCB          @ZA06161 37584009
         BAL   RD,FREEPG                FREE DCB                 X01004 37585005
         LR    RF,RDEB                  COPY DEB ADDRESS         Y01004 37590005
         ICM   RF,HI,DEBLNGTH           DOUBLE WORD LENGTH OF DEBY01004 37600005
         BAL   RD,FREEPG1               PAGE FREE THE DEB        Y01004 37603005
         L     RF,CVTPTR                ADDRESS OF CVT           Y02027 37606006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 37607006
         TM    CVTTCMFG,LASTDCB         LAST TCAM DCB CLOSED     Y02027 37609006
         BNO   ENDLOAD1                 NO, BRANCH               X01004 37612005
         L     RJ,CVTAQAVT              ADDRESS OF TCX           Y02027 37615006
         USING IEDQTCX,RJ               TCX ADDRESSABILITY       Y02027 37615506
         SR    RCORE,RCORE              CLEAR FOR INSERT         X02004 37624005
         IC    RCORE,TCXTOTE            NUMBER OF TOTE ENTRIES   Y02027 37627006
         LM    RE,RF,TCXBUFA            ADDR AND LENGTH OF I/O   Y02027 37630006
*                                       TRACE, BUFFERS AND CPB'S X01004 37633005
         LR    RJ,RE                    COPY ADDRESS OF BUFFERS OY00541 37638005
         BAL   RD,FREEPG                UNFIX BFRS-TRACE AND CPB X01004 37639005
         L     RUCB,AVTRNMPT            ADDRESS OF TERMINAL NAME X02004 37642005
*                                         TABLE (TNT)            X01004 37645005
         SR    RF,RF                    CLEAR REG FOR INSERT     X01004 37648005
         IC    RF,TNTENLEN              LENGTH OF ENTRY          X01004 37651005
         LA    RE,THREE                                          X01004 37654005
         AR    RF,RE                    BUMP FOR TNT POINTERS    X01004 37657005
         LR    RJ,RF                    SAVE ENTRY LENGTH        X02004 37660005
         MH    RF,TNTLEN                MULTIPLY LENGTH OF ENTRY X01004 37663005
*                                         BY NUMBER OF ENTRIES   X01004 37666005
         LA    RF,TNTOFF(RF)            ADD TO LENGTH THE CORDE  X01004 37669005
*                                         BEFORE THE FIRST ENTRY X01004 37672005
         LR    RD,RCORE                 NUMBER OF TOTE ENTRIES   X02004 37675005
         MR    RD,RD                    ENTRIES TO FIX FOR TOTE  X02004 37700005
         AR    RF,RJ                    ADD TOTE TO TNT LENGTH   X02004 37703005
         LTR   RJ,RJ                    ANY TOTE ENTRIES        OY00512 37703605
         BNZ   TOTEYES                  YES, BRANCH             OY00512 37704205
         LA    RF,ONE(RF)               ADJUST TERM TABLE OFFSETOY00512 37704805
TOTEYES  EQU   *                                                OY00512 37705405
         LR    RJ,RUCB                  COPY TNT START ADDRESS   X02004 37706005
         AR    RF,RE                    ROUND TO WORD BOUNDARY   X01004 37710005
         SRL   RF,2                     SHIFT OUT 2 LO-ORD BITS  X01004 37715005
         SLL   RF,2                     SHIFT BACK               X01004 37720005
         LA    RCORE,0(RF,RJ)                                    X01004 37723005
         ICM   RCORE,ALL,0(RCORE)       GET ADDRESS OF TERMINAL  X01004 37726005
*                                         TABLE                  X01004 37730005
         BAL   RD,FREEPG                UNFIX TNT                X01004 37735005
         L     RF,0(RCORE)              ADDRESS OF END OF THE    X01004 37740005
*                                       TERMINAL TABLE AND QCBS  X01004 37743005
         LR    RUCB,RF                  SAVE ADDRESS OF SCBS     X01004 37746005
         SR    RF,RCORE                 GET LENGTH OF TERM TABLE X01004 37750005
         LR    RJ,RCORE                 ADDR OF TERMINAL TABLE   X01004 37755005
         L     RCORE,FOUR(RCORE)        ADDRESS OF THE NUMBER OF X01004 37760005
*                                         ENTRIES IN DEVICE      X01004 37764005
*                                         CHARACTERISTICS TABLE  X01004 37768005
         BAL   RD,FREEPG                UNFIX TERMINAL TABLE AND X01004 37772005
*                                         QUEUE CONTROL BLOCKS   X01004 37776005
         LH    RF,0(RCORE)              NUMBER OF ENTRIES IN     X01004 37780005
*                                         DEVICE CHARACTERISTICS X01004 37784005
*                                         TABLE                  X01004 37788005
         SLL   RF,TWO                  MULTIPLY BY 4 TO GET      X01004 37792005
*                                         LENGTH OF DCT          X01004 37796005
         LTR   RF,RF                    NO DEV CHAR TABLE      @YA03928 37797061
         BZ    NODEVC                   BRANCH IF YES          @YA03928 37798061
         L     RJ,AVTCSTCS              ADDRESS OF DCT           X01004 37800005
         BAL   RD,FREEPG                UNFIX DCT                X01004 37804005
NODEVC   EQU   *                                               @YA03928 37806061
         LR    RJ,RUCB                  ADDRESS OF SCBS          X01004 37808005
         LH    RF,TWO(RCORE)            SCB LGTH IN DOUBLEWORDS  X01004 37812005
         BAL   RD,FREEPG2               UNFIX SCB'S              X01004 37816005
         TM    AVTSCOPT,AVTCMBUF        COMMON BUFFER USED       X02004 37820005
         BZ    CKTSO                    NO, CHECK FOR TSO      @Z30X8TM 37824008
         L     RUCB,AVTCBQCB            ADDRESS OF MASTER QCB    X02004 37840005
         USING IEDCMB,RUCB                                       X02004 37844005
         L     RCORE,CMBFIRST-ONE       ADDRESS OF FIRST PREFIX  X02004 37848005
         LR    RJ,RUCB                  ADDR. OF QCB, STCB'S AND X02004 37852005
*                                       PREFIXES FOR COMMBUF     X02004 37856005
         L     RF,CMBLAST-ONE           ADDRESS OF LAST PREFIX   X02004 37860005
         LA    RF,PRELNG(,RF)           ADDR. END OF LAST PREFIX X02004 37864005
         SR    RF,RJ                    LENGTH OF QCB'S, ETC.    X02004 37868005
         BAL   RD,FREEPG                FREE COMMBUF CNTRL BLOCKSX02004 37872005
         LH    RTIOT,CMBDAREA           NUMBER OF DATA AREAS     X02004 37876005
         N     RTIOT,AVTCLRHI           FORCE POSITIVE           X02004 37880005
COMLOOP  EQU   *                                                 X02004 37884005
         LA    RE,EIGHT                 CONSTANT TO LOCATE IDA   X02004 37888005
         SR    RJ,RJ                    CLEAR FOR ICM            X02004 37892005
         ICM   RJ,AD,ONE(RCORE)         ADDRESS OF DATA AREA     X02004 37896005
         SR    RJ,RE                    ADJUST TO IDA LIST PTR   X02004 37900005
         L     RF,FOUR(RJ)              TOTAL LENGTH TO FIX      X02004 37904005
         TM    ZERO(RJ),CCWIDA          IDA TO BE USED           X02004 37908005
         BNO   COMLOOP2                 NO, FIX BUFFER           X02004 37912005
         L     RJ,ZERO(RJ)              ADDRESS OF IDA LIST      X02004 37916005
COMLOOP2 EQU   *                                                 X02004 37920005
         BAL   RD,FREEPG                FREE COMMBUF DATA AREA   X02004 37924005
         LA    RCORE,PRELNG(RCORE)      BUMP TO NEXT PREFIX      X02004 37928005
         BCT   RTIOT,COMLOOP            FIX NEXT DATA AREA       X02004 37932005
CKTSO    EQU   *                        CHECK PRESENCE OF TSO    X02004 37936005
         TM    AVTBIT1,AVTTSON          TSO OR MIXED ENVIOR.     X01004 37940005
         BZ    FREEPOOL                 NO, BRANCH             @G36XRTP 37944000
         ICM   RJ,ALL,AVTTSOPT          ADDR. OF TSINPUT QCB     X02004 37948005
         BZ    FREEPOOL                 BRANCH IF IT'S ZERO    @G36XRTP 37952000
         LA    RF,TSILEN                LENGTH TO FREE         @G36XRTP 37956000
         BAL   RD,FREEPG                PAGE FREE TSINPUT QCB    X02004 37960005
         L     RJ,AVTKA02               ADDRESS OF IEDQKA02     OY00451 37964005
         LTR   RF,RJ                    IS KA IN THE SYSTEM     OY00541 37966005
         BZ    NOKA                     NO, SKIP PAGE FREE      OY00541 37967005
         SH    RF,AVTHA4                ADJUST TO LENGTH        OY00451 37968005
         L     RF,ZERO(RF)              LENGTH TO PAGE FREE     OY00451 37970005
         BAL   RD,FREEPG                UNFIX IEDQKA02          OY00451 37972005
NOKA     EQU   *                                                OY00541 37974005
         LA    RF,AYZLNG                LENGTH OF IEDAYZ       @Z30X8TM 37976008
         L     RJ,AVTTSOPT              ADDRESS OF IEDAYZ      @Z30X8TM 37980008
         ICM   RJ,ALL,TSISCHED-IEDQTSI(RJ)  ADDRESS OF IEDAYZ   OY00541 37984005
         BZ    FREEPOOL                 SKIP PAGEFREE IF NO AYZ@G36XRTU 37986000
         BAL   RD,FREEPG                PAGE FREE IEDAYZ         X01004 37988008
         EJECT                                                          37988100
************************************************************** @G36XRTP 37988200
*        FREEMAIN STORAGE FOR POOLED CONTROL BLOCKS            @G36XRTP 37988300
*               ( PLCB, SAT, SIB, RVT, NAT )                   @G36XRTP 37988400
************************************************************** @G36XRTP 37988500
FREEPOOL EQU   *                                               @G36XRTP 37988600
         ICM   RJ,ALL,AVTSAVTP          GET SAVT ADDRESS       @G36XRTP 37988700
         BZ    NOSAVT                   NO SAVT, SKIP FREEMAIN @G36XRTP 37988800
*                                       FOR POOL AND SAVT      @G36XRTP 37988900
         BM    FREEPLCB                 FREE PLCB'S AND SAVT   @G36XRTP 37989000
         LA    RF,SAVTVMSZ              SIZE OF SAVT IF VM     @G36XRTP 37989100
*                                       ONLY                   @G36XRTP 37989200
         B     FREEAVT                  FREE SAVT ONLY         @G36XRTP 37989300
FREEPLCB EQU   *                                               @G36XRTP 37989400
         L     RF,SAVTPOOL-IEDNSVTD(RJ) GET CONTROL BLOCK      @G36XRTP 37989500
*                                       POOL ADDRESS           @G36XRTP 37989600
         LH    RE,SAVTPLSZ-IEDNSVTD(RJ) GET NUMBER OF DOUBLE   @G36XRTP 37989700
*                                       WORDS IN POOL          @G36XRTP 37989800
         N     RE,AVTCLRHI              CLEAR HIGH ORDER       @G36XRTP 37989900
*                                       HALF-WORD              @G36XRTP 37990000
         SLL   RE,THREE                 MULTIPLY BY 8 FOR      @G36XRTP 37990100
*                                       NUMBER OF BYTES        @G36XRTP 37990200
         ICM   RE,HI,SP250              SUBPOOL 250            @G36XRTP 37990300
         FREEMAIN R,LV=(0),A=(1)        FREE CTL BLK POOL      @G36XRTP 37990400
         LA    RF,SAVTSIZE              GET LENGTH OF SAVT     @G36XRTP 37990500
FREEAVT  EQU   *                                                 X01004 37992005
         ICM   RJ,ALL,AVTSAVTP          GET SAVT ADDRESS       @G36XRYP 37992300
         BAL   RD,FREEPG                UNFIX SECONDARY AVT     OY00532 37994405
NOSAVT   EQU   *                                                OY00532 37995005
         LR    RJ,RAVT                  ADDRESS OF AVT           X01004 38030005
         LA    RF,AVTLNG                LENGTH TO UNFIX          X01004 38040005
         BAL   RD,FREEPG                UNFIX AVT                X01004 38050005
         EJECT                                                          38054806
ENDLOAD1 EQU   *                                                 X01004 38060005
         L     RJ,FOUR(RWTGC)           ADDRESS OF NEXT ENTRY    X01004 38070005
         USING FORCORE,RJ               OPEN WORK AREA DSECT     Y02027 38075006
         XC    ZERO(FOUR,RWTGC),ZERO(RWTGC)  CLOSE COMPLETE      X01004 38080005
RELOOP   EQU   *                                                        38100020
         LA    RWTGC,EIGHT(RWTGC)       BUMP   CURRENT WTG POINTER      38200020
         LA    RPARC,FOUR(RPARC)        LOAD THE POINTER TO THE NEXT    38300020
*                                         ENTRY IN THE DCB              38400020
*                                         PARAMETER LIST                38500020
         CLC   0(2,RWTGC),AMIDCNST      IS THIS EXECUTOR REQUIRED       38600020
*                                         AGAIN                         38700020
         BE    RESTART                  YES, BRANCH TO BEGINNING        38800020
         CLC   0(2,RWTGC),CLOSEIDL      THIS CODE IS USED TO            38900020
         BL    RELOOP                   DETERMINE WHICH OF THE          39000020
         CLC   0(2,RWTGC),CLOSEIDH      CLOSE EXECUTORS TO GIVE         39100020
         BH    RELOOP                   CONTROL TO                      39200020
         LR    RPARC,RPAR               INITIALIZE CURRENT DCB REG      39300020
         LA    RWTGC,32(RWTG)             AND WTG REGISTER              39400020
ZCHECK   EQU   *                                                        39500020
         CLI   0(RWTGC),X'00'           IS THIS ENTRY COMPLETED         39600020
         BNE   XCTLRTNE                 NO, THEN BRANCH          S22024 39700022
         LA    RWTGC,EIGHT(RWTGC)       BUMP POINTER TO TEST FOR        39800020
         LA    RPARC,FOUR(RPARC)          COMPLETION OF THE NEXT        39900020
*                                         ENTRY                         40000020
         B     ZCHECK                   TEST THE NEXT ENTRY      S22024 40100022
XCTLRTNE EQU   *                                                  *     40200020
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           Y02027 40230006
         SPACE 2                                                        40260006
         LA    RJ,DXCCW12               LOAD THE ADDRESS OF THE  Y02027 40300006
*                                         LAST DOUBLE WORD IN THE       40400020
*                                         OPEN WORK AREA                40500020
         OI    TWOTWO(RWTG),NORLD       RESET LENGTH INDICATORS  X01004 40530005
         MVC   TWOFIV(TWO,RWTG),TWOSEV(RWTG) FOR NEXT LOAD TO 1K X01004 40560005
         MVC   6(TWO,RWTG),0(RWTGC)     MOVE ID TO NAME FIELD     *     40600020
         MVC   14(THREE,RWTG),TWO(RWTGC) MOVE TTR TO WTG TABLE          40700020
         XCTL  DE=(RWTG),SF=(E,(15))    TRANSFER CONTROL          *     40800020
         EJECT                                                          40900020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     41000020
*                                                                 *     41100020
*        THIS SECTION OF CODE REMOVES THE AVT ADDRESS FROM        *     41200020
*        THE DISPATCHER PREFIX, AND FREEMAINS ANY LINE BUFFERS    *     41300020
*        AND/OR USER REQUESTED CROSS REFERENCE TABLE AFTER        *     41400020
*        DETERMINING THAT THERE ARE NO MORE DCB'S TO BE CLOSED    *     41500020
*                                                                 *     41600020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     41700020
LASTIME  EQU   *                                                        41800020
         L     RF,CVTPTR                GET CVT ADDRESS          Y02027 41820006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 41826006
         OI    CVTTCMFG,LASTDCB         INDICATE THAT THE TCAM   Y02027 41832006
*                                         POINTER IN THE CVT IS TO      41840020
*                                         BE CLEARED                    41860020
         B     SETDEB                   RETURN                   X01004 42200005
FREE2260 EQU   *                                                 X01004 42400005
         LR    RC,RF                    SAVE LCB SIZE            X01004 42600005
         L     RF,CVTPTR                ADDRESS OF CVT           Y02027 42800006
         USING CVTD,RF                  CVT ADDRESSABILITY       Y02027 42900006
         L     RF,CVTAQAVT              ADDRESS OF TCX           Y02027 43000006
         USING IEDQTCX,RF               TCX ADDRESSABILITY       Y02027 43100006
         L     RF,TCXATTEN              ADDR OF 2260 ATTEN RTN   Y02027 43200006
         BAL   RD,FREEPG1               UNFIX 2260 ROUTINE       X01004 43400005
         B     COPYSIZ1                 GO FREE LCB              X01004 43600005
FREEPG3  EQU   *                        FREE PAGE ENTRY FOR APP. X02004 43800005
         SH    RJ,AVTHA4                ADJUST TO LOAD START     X02004 44000005
         L     RF,ZERO(RJ)              LENGTH OF MODULE         X02004 44200005
         B     FREEPG                   PAGE FREE MODULE CORE    X02004 44400005
FREEPG1  EQU   *                                                 X01004 44600005
         LR    RJ,RF                    COPY ADDRESS TO UNFIX    X01004 44800005
         SRL   RF,HIGHBYTE              GET NUM OF DOUBLE-WORDS  X01004 45000005
FREEPG2  EQU   *                                                 X01004 45200005
         SLL   RF,THREE                 CONVERT TO BYTE LENGTH   X01004 45400005
FREEPG   EQU   *                                                 X01004 45600005
         LR    RE,RJ                    SAVE START ADDRESS       Y02027 45800006
         LA    RJ,ZERO(RF,RJ)           BUMP TO END ADDR + 1     Y02027 46200006
         LR    RF,RE                    SET START ADDRESS        Y02027 46600006
         PGFREE R,A=(1),EA=(15)         ISSUE PAGE FREE          Y02027 47000006
         BR    RD                       RETURN TO CALLER         X01004 47400005
         EJECT                                                          48900020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     49000020
*                                                                 *     49100020
*        THIS SECTION OF CODE INCREMENTS THE CROSS REFERENCE      *     49200020
*        TABLE ENTRY POINTER AND CHECKS TO SEE IF WE HAVE         *     49300020
*              PASSED THE LAST POSSIBLE ENTRY                     *     49400020
*                                                                 *     49500020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *     49600020
*                                                                       49700020
CHKNEXT  EQU   *                                                        49800020
         LA    RC,CRSFSIZE(RC)          INCREMENT THE CROSS             49900020
*                                         REFERENCE POINTER             50000020
         C     RC,FOUR(RF)              HAVE WE PASSED THE LAST         50100020
*                                         ENTRY IN THE TABLE            50200020
         BH    NEXTENTY                 YES, BRANCH                     50300020
         B     COMPUCB                  CHECK THE NEXT ENTRY IN THE     50400020
*                                         TABLE                         50500020
         EJECT                                                          50600020
AVTLNG   EQU   X'500'                   AVT LENGTH TO FREE       X01004 50720005
AYZLNG   EQU   X'AF4'                   LENGTH OF IEDAYZ       @Z30X8TU 50725000
AD       EQU   7                        ICM/STCM MASK            X01004 50730005
HI       EQU   8                        ICM/STCM MASK            X01004 50735005
HIGHBYTE EQU   24                       SHIFT TO HIGH-ORDER BYTE X01004 50740005
SIXTEN   EQU   16                       OFFSET OF 16             X01004 50745005
INVSIZE  EQU   9                        CONTROL WORDS SIZE (8) +OY00530 50745654
*                                       DELIMITER SIZE (1)      OY00530 50746254
STATUS   EQU   3                        OFFSET OF STATUS BYTE INOY00530 50746854
*                                       INVITATION LIST CONTROL OY00530 50747454
*                                       WORD                    OY00530 50748054
INVEOT   EQU   X'80'                    EOT WAS SPECIFIED ON    OY00530 50748654
*                                       INVLIST MACRO           OY00530 50749254
ALL      EQU   15                       ICM/STCM MASK            X01004 50750005
ZERO     EQU   0                        OFFSET OF 0              X01004 50755005
TWOTWO   EQU   22                       OFFSET OF 22             X01004 50760005
NORLD    EQU   1                        NO RLD IN NEXT MOD.      X01004 50765005
TWOFIV   EQU   25                       OFFSET OF 25             X01004 50770005
TWOSEV   EQU   27                       OFFSET OF 27             X01004 50775005
PCI      EQU   X'0C'                    DCB PCI FLAGS            X01004 50780005
LCB3705  EQU   184                      PLCB SIZE                Y05330 50788005
ONE      EQU   1                        VALUE 1                  S22024 50800022
WAIT     EQU   1                        SVC WAIT                        50900020
TWO      EQU   2                        VALUE TWO                S22024 51000022
THREE    EQU   3                        VALUE THREE              S22024 51100022
FOUR     EQU   4                        VALUE FOUR               S22024 51200022
EIGHT    EQU   8                        VALUE EIGHT              S22024 51400022
FIVE     EQU   5                        VALUE 5                 OY03305 51410005
BUFKEY   EQU   X'1A'                    BUFF TERM SCHED CODE   @XA03965 51430009
TYPE3    EQU   X'70'                    IBM TERM ADAPTER 3       Y02027 51450006
CRSFSIZE EQU   16                       CROSS REFERENCE POINTER  S22024 51700022
PURGE    EQU   16                       SVC PURGE                       51800020
IOSUPAPP EQU   21                       IOS APPENDAGE            S22024 52400022
DSORG    EQU   27                       DCB DSORG OFFSET         S22024 52500022
IOBPTR   EQU   32                       OFFSET TO THE IOB               52600020
DEBPRFIX EQU   36                       LENGTH OF THE DEB PREFIX        52700020
OPTION   EQU   160                      OPTION                   S22024 52810022
GRAPHICS EQU   X'10'                    GRAPHICS DEVICE          S22024 52870022
LASTDCB  EQU   X'0F'                    LAST DCB                 S22024 52930022
DISKDCB  EQU   X'20'                    DISK DCB TYPE            S22024 52990022
LINEDCB  EQU   X'40'                    LINE DCB TYPE            S22024 53050022
POST     EQU   X'40'                    POST FLAG FOR LCB POST  SA60820 53150022
DCB3705  EQU   X'04'                    DSORG = TR               S22024 53150122
DIAL     EQU   X'90'                    DIAL DEVICE              S22024 53300022
XFB      EQU   X'FB'                    USED TO TURN OFF UCB BITSA64788 53410054
LIMIT    DC    H'500'                   5 SECOND DELAY         @SA70907 53700061
THRESHL  DC    H'12'                    LEN THRESH ERRMSG AREA @OZ24288 53750000
         DS    0F                                                       53800020
SP250    DC    X'FA'                    SUBPOOL 250              X01004 53900005
CCWIDA   EQU   4                        INDIRECT ADDRESSING FLAG X02004 53930005
PRELNG   EQU   12                       LENGTH OF COMMBUF PREFIX X02004 53960005
DISABLE  DC    X'2F00000020000001'      DISABLE CCW              S21903 54000022
CLOSEIDL DC    C'0B'                    ID OF LAST CLOSE MODULES S21903 54100022
CLOSEIDH DC    C'0G'                    ID OF LAST CLOSE MODULES S21903 54200022
AMIDCNST DC    C'36'                    ID FOR THIS EXECUTOR     Y02027 54220006
         EJECT                                                          54970006
UCB      DSECT                                                          54980006
         IEFUCBOB                                                       54990006
         EJECT                                                          55000020
         DCBD  DSORG=TX                                                 55100020
DCBEND   EQU   DCBINVLI-IHADCB          END OF DCB             @ZA06161 55130009
         TTNTD                                                   X01004 55160005
         EJECT                                                          55200020
         TDEBD                                                          55300020
         EJECT                                                          55400020
         TTCXD                                                   Y02027 55430006
         EJECT                                                          55460006
         TTCBD                                                          55500020
         EJECT                                                          55600020
FORCORE  DSECT                                                          55630006
         IECDSECT                                                       55660006
         TAVTD                                                          55700020
         EJECT                                                          55800020
         TLCBD                                                          55900020
         EJECT                                                          55920005
         TTSID                                                   X01004 55940005
         EJECT                                                   Y02027 55945006
CVTD     DSECT                          CVT DSECT                Y02027 55950006
         CVT                            CVT                      Y02027 55955006
         IEDCMB                                                  X02004 55960005
         END                                                            56000020
