         TITLE 'IGG0290D - ERROR EXITS AND DEQUE ROUTINE.'              00020000
IGG0290D CSECT                                                          00025021
*          RELEASE 16 DELETIONS                                         00030000
*1465                                                             5M51R 00031016
*1465                                                              AAAA 00032016
*          RELEASE 17 DELETIONS                                         00035000
*          RELEASE 18 DELETIONS                                       * 00041000
*          RELEASE 19 DELETIONS                                       * 00043000
*1184008000                                                      A25777 00043519
*1184002200,014400                                               S19028 00044019
* 018120-018126                                                  M4916  00044519
*1184013600-013800                                               M3097  00044719
*          RELEASE 20 DELETIONS                                       * 00045000
*1331                                                            S20201 00046020
*          RELEASE 21 DELETIONS                                       * 00047000
*1198000250,000778-000790,001600-001800,002100,006000-006200,    A43551 00047521
*1198018054-018060,018064-018066,018098,018104-018106,018176-    A43551 00048021
*1198018178,018186,019800,021000,031800                          A43551 00048521
*0000018210,018310,018600                                       SA49351 00048921
*          RELEASE 21.7 DELETIONS                                       00051702
*0000000490-000530,015600,019880-020860,028400                  SA56400 00053702
*          VS1 RELEASE 2 DELETIONS                                      00054102
*0000                                                           XM1038  00054502
*                                                                       00054602
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00057002
*0000000030-000150,000800-001000,002000-002240,002400,005650,    Y02080 00057102
*0000005900,006020-006040,006200-006300,006800-007060,009000,    Y02080 00057202
*0000012010-012100,012120,012600-012900,013100-013200,013840-    Y02080 00057302
*0000013920,014500-014600,015000-016200,018064,018070,018076,    Y02080 00057402
*0000018090-018102,018164,018170,018174,018176-018188,018194,    Y02080 00057502
*0000018235-018242,018244-018245,018270-018280,018294,018400-    Y02080 00057602
*0000019000,019820,020350,020980-030860,031000-031774            Y02080 00057702
*0000001900,001960,007120,017630,019200                          Y02078 00057802
*0000000754-431790                                               Y02082 00057902
*0000                                                            Y02134 00058002
*0000                                                            Y02144 00058102
*0000                                                            Y02132 00058202
*0000175000,179000-179100,210500,211500,212500,233500            YM1337 00058302
*0000063500,067000,248000-249000,259000                          YM3048 00060302
*0000018000,246000,250000-250100                                 YM3997 00060702
*0000179000,179100,260500,261500                                 YM2880 00060902
*0000178000                                                      YM2887 00061102
*          VS2 RELEASE 03 DELETIONS/CHANGES                    @ZM30032 00061503
*0000                                                          @Y30LSTG 00062003
*0000                                                          @ZA04736 00062137
*0000    EXTENDED MVS CVOL SUPPORT                             @Z40CSRC 00064137
*                                                                       00065137
*                                                              @G60ASBJ 00065660
*        SU60 DELETIONS/CHANGES                                @G60ASBJ 00066160
*A 253000,253600                                               @G60ASBJ 00066660
*D 253500,25A000                                               @G60ASBJ 00067160
*                                                              @G60ASBJ 00067660
* MODULE NAME - IGG0290D                                                00068137
*                                                                       00071137
* DESCRIPTIVE NAME - ERROR EXITS AND DEQUE ROUTINE                      00074137
*                                                                       00077137
* COPYRIGHT - NONE                                                      00080137
*                                                                       00083137
*                                                                       00085237
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD          00086137
*STATUS CHANGE LEVEL 004                                                00087737
*                                                                       00089137
*STATUS CHANGE LEVEL 004                                                00092137
*                                                                       00100002
*FUNCTION - IF NO ERROR HAS OCCURRED WHEN PROCESSING THE CURRENT ENTRY  00150002
*          IN THE VOLUME LIST, THIS MODULE UPDATES THE HOLE COUNT IN    00200002
*          THE FORMAT 4 DSCB AND WRITES IT BACK TO THE VTOC.  IF THE    00250002
*          VTOC WAS ENQ'ED, THIS MODULE ISSUES A DEQ WITH THE RELEASE-  00300002
*          MUST-COMPLETE OPTION.  IF AN I/O ERROR OCCURRED WHILE        00350002
*          PROCESSING THE CURRENT ENTRY, THIS MODULE ISSUES MESSAGE     00400002
*          IEC603I WITH THE CODE = 0.  IF OVERLAPPING EXTENTS WERE      00450002
*          FOUND IN THE FORMAT 5 DSCB AND THE DIRF BIT WAS NOT SET      00500002
*          PREVIOUSLY IN THE FORMAT 4 DSCB, THIS MODULE ISSUES MESSAGE  00550002
*          IEC603I WITH THE CODE = 4 AND REWRITES THE FORMAT 4 DSCB     00600002
*          WITH THE DIRF BIT SET.                                       00650002
*          IF THE UNIT WAS DYNAMICALLY ALLOCATED, DYNAMIC ALLOCATION    00700002
*          IS CALLED TO DEALLOCATE THE UNIT.  IF THERE ARE MORE         00750002
*          VOLUMES TO BE PROCESSED, CONTROL IS RETURNED TO IGG0290E.    00800002
*          AFTER ALL THE VOLUMES HAVE BEEN PROCESSED, THIS MODULE       00850002
*          TESTS IF A VOLUME WAS ENQ'ED AND MOUNTED BY IGG0290F.        00900002
*          IF YES, CONTROL IS GIVEN TO IGG0290F TO DEMOUNT AND DEQ      00950002
*          THE VOLUME.  IF SCRATCH ENQ'ED ON THE DATA SET NAME OR       01000002
*          THE TIOT, CORRESPONDING DEQ'S ARE ISSUED.  IF DATA SET       01050002
*          RECORDING FOR SMF IS REQUIRED, THIS MODULE BUILDS AN SMF     01100002
*          RECORD TYPE 17.  IF THE RPS SIO APPENDAGE IGG019EK WAS       01150002
*          LOADED, IT DELETES IT.  IT THEN FREES THE WORK AREA(S)       01200002
*          AND RETURNS TO THE CALLER.                                   01250002
*          IN ADDITION, IF THE DATA SET BEING SCRATCHED RESIDES@Y30LSTG 01260003
*          ON VIRTUAL MSS  DASD, THE PARAMETER LIST BUILT IN   @Y30LSTG 01270003
*          IGG0299A IS USED TO RELINQUISH REAL DASD SPACE THAT @Y30LSTG 01280003
*          WAS ACQUIRED FOR THE DATA SET.                      @Y30LSTG 01290003
*                                                                       01300002
*ATTRIBUTES - REENTRANT                                                 01350002
*                                                                       01400002
*ENTRIES - THE ONLY ENTRY TO THIS MODULE IS IGG0290D. ENTRY IS MADE     01450002
*          FROM ANY OF THE PRECEDING MODULES - IGC0002I, IGG0290E,      01500002
*          IGG0290A, IGG0299A, IGG0290B, OR IGG0290C.                   01550002
*                                                                       01600002
*SUPERVISOR CALLS AND EXTERNAL ROUTINES IN THIS MODULE -                01650002
*          EXCP(0)  - WRITES TO A DIRECT ACCESS DEVICE                  01700002
*          WAIT(1)  - WAITS ON AN EVENT CONTROL BLOCK                   01750002
*          TIME(11) - OBTAINS THE CURRENT TIME AND DATE                 01850002
*          WTO(35)  - WRITES A MESSAGE TO THE OPERATOR                  01900002
*          DEQ(48)  - DEQ'S FROM SYSVTOC, SYSZTIOT, AND/OR SYSDSN       01950002
*          SMFWTM   - WRITES AN SMF RECORD (SVC 83)                     02000002
*          DYNALLOC - DYNAMICALLY DEALLOCATES THE UNIT (SVC 99)         02050002
*          MODESET  - SWITCHES TO THE CALLER'S KEY                      02100002
*          IECRES   - BRANCHES TO ANOTHER MODULE                        02150002
*                   - OBTAINS/FREES WORK AREA(S)                        02200002
*          ICBACREL - RELINQUISHES DASD SPACE FOR MSS          @Y30LSTG 02210003
*                                                                       02250002
*OTHER MACROS ISSUED -                                                  02300002
*          IECDSECS - EXPANDS THE CVT, DSAB, JMR, JSCB, QDB, RB, SMF,   02350002
*                     SMFTCT, TCB, TIOT, AND UCB DSECTS                 02400002
*          IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCBS              02450002
*          IECSCRWA - SCRATCH WORK AREA EXPANSION                       02500002
*          IEFJFCBN - ENABLES SYMBOLIC ADDRESSING OF THE JFCB           02550002
*          IEFZB4D0 - EXPANDS THE DYNAMIC ALLOCATION REQUEST BLOCK      02600002
*          IEFZB4D2 - EXPANDS THE DYNAMIC ALLOCATION TEXT UNIT KEYS     02650002
*          IFASMFR  - BUILDS AN SMF RECORD TYPE 17                      02700002
*          XCTLTABL - BUILDS A LIST OF MODULE ID'S AND ADDRESSES        02750002
*                                                                       02800002
*INPUT -   AT ENTRY TO THIS MODULE REGISTER 13 POINTS TO THE WORK AREA. 02850002
*          REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.   02900002
*                                                                       02950002
*OUTPUT -  THE UPDATED FORMAT 4 DSCB IS WRITTEN OUT.  IF THE SCRATCH    03000002
*          FUNCTION IS COMPLETE FOR ALL VOLUMES IN THE VOLUME LIST,     03050002
*          CONTROL IS RETURNED TO THE CALLER WITH AN ERROR CODE IN      03100002
*          REGISTER 15.  IF THE DATA SET MUST STILL BE SCRATCHED        03150002
*          FROM ANOTHER VOLUME, CONTROL IS PASSED TO MODULE IGG0290E.   03200002
*          REGISTER 9 POINTS TO THE CVT, AND  REGISTER 10 POINTS TO     03250002
*          THE INPUT PARAMETER LIST.  REGISTER 13 STILL POINTS TO THE   03300002
*          SCRATCH WORK AREA, IN WHICH 'VOLNUM' CONTAINS THE NUMBER     03350002
*          OF VOLUMES REMAINING TO BE SCRATCHED AND 'VOLPTR' CONTAINS   03400002
*          THE ADDRESS OF THE NEXT ENTRY IN THE VOLUME LIST.            03450002
*          THE FOLLOWING INFORMATION IS PASSED TO IGG0290F:             03500002
*          REGISTER 2 POINTS TO THE DEB.                                03550002
*          REGISTER 3 POINTS TO THE VOLUME SERIAL NUMBER.               03600002
*          REGISTER 4 CONTAINS THE CHARACTERS '290D'.                   03650002
*          REGISTER 8 POINTS TO THE CURRENT VOLUME LIST ENTRY.          03700002
*          REGISTER 11 CONTAINS THE PRIMARY (DEMOUNTABLE) UCB ADDRESS.  03750002
*                                                                       03850002
*ERROR CONDITION - THE ONLY ERROR INDICATED IS PERMANENT I/O ERROR.     03900002
*                                                                       03950002
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    04000002
*          WORK AREA = 900 BYTES                               @Y30LSTG 04050003
*          RPS WORK AREA = 128 BYTES                                    04100002
*                                                                       04150002
*NOTES -   UNLIKE THE ALLOCATE, EXTEND, AND PARTIAL RELEASE FUNCTIONS   04200002
*          OF DADSM, IF THE DIRF BIT IS SET IN THE FORMAT 4 DSCB IN     04250002
*          THE SCRATCH WORK AREA, THIS INDICATES THAT THE DIRF BIT      04300002
*          WAS PREVIOUSLY SET IN THE FORMAT 4 DSCB.                     04350002
*                                                                       04400002
* REGISTER EQUATES                                                      04450002
*                                                                       04500002
R0       EQU   0                        REGISTER 0               Y02080 04550002
R1       EQU   1                                                        04600002
RPARM    EQU   2                        PARAMETER LIST POINTER   Y02082 04650002
R2       EQU   2                                                        04700002
RDSAB    EQU   2                        POINTER TO THE DSAB      Y02082 04750002
RWRK     EQU   3                        WORK REGISTER            Y02082 04800002
RTIOT    EQU   3                        POINTER TO THE TIOT      Y02082 04850002
R3       EQU   3                                                        04900002
RTEXT    EQU   4                        POINTER TO TEXT UNIT     Y02082 04950002
R4       EQU   4                                                        05000002
VOLCTR   EQU   5                        NUMBER OF VOLUMES        Y02082 05050002
R6       EQU   6                                                        05100002
R7       EQU   7                                                        05150002
R8       EQU   8                                                        05200002
VOLISTX  EQU   8                        PTR TO VOLIST ENTRY      Y02082 05250002
R9       EQU   9                                                        05300002
RCVT     EQU   9                                                 S19028 05350002
RA       EQU   10                                                       05400002
RUCB     EQU   11                       UCB POINTER              Y02078 05450002
RBASE    EQU   12                                                       05500002
RWKAREA  EQU   13                                                       05550002
RETURN   EQU   14                                                       05600002
R15      EQU   15                                                       05650002
WORKREG2 EQU   15                                                       05700002
*                                                                       05750002
* OTHER EQUATES                                                         05800002
*                                                                       05850002
K0       EQU   0                        CONSTANT OF ZERO         Y02082 05900002
K1       EQU   1                        CONSTANT OF 1            Y02082 05950002
K2       EQU   2                        CONSTANT OF 2            Y02080 06000002
K3       EQU   3                        CONSTANT OF 3            Y02082 06050002
K4       EQU   4                        CONSTANT OF 4            Y02082 06100002
K6       EQU   6                        CONSTANT OF 6          @Y30LSTG 06110003
K8       EQU   8                        CONSTANT OF 8            Y02082 06150002
K12      EQU   12                       CONSTANT OF 12           Y02080 06200002
K16      EQU   16                       CONSTANT OF 16           YM1337 06210002
D3       EQU   3                        DISPLACEMENT OF THREE  @Y30LSTG 06220003
X00      EQU   X'00'                    ONE BYTE OF BINARY ZEROS Y02082 06250002
FW       EQU   4                        LENGTH OF A FULLWORD     Y02082 06300002
APDIS    EQU   28                       DISP. TO APPGS IN W.A.   S20201 06400002
APSVA    EQU   120                      DISP.TO AVT PTR IN W.A.  S20201 06450002
SMFREC17 EQU   17                       SMF RECORD TYPE 17       Y02082 06500002
CHNPGADR EQU   16                       OFFSET TO CCW STARTING   Y02082 06550002
*                                       ADDRESS IN THE IOB       Y02082 06600002
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02080 06650002
UUU      EQU   37                       DISP. TO UUU IN MESSAGE  Y02078 06750002
VOLID    EQU   41                       DISP. TO VOLSER IN MSG   Y02078 06800002
CODE     EQU   48                       DISP. TO CODE IN MESSAGE Y02078 06850002
VOLSER   EQU   4                        OFFSET TO THE VOL SER IN Y02082 06900002
*                                       A VOLUME LIST ENTRY      Y02082 06950002
STATUS   EQU   11                       OFFSET TO VOLIST STATUS  Y02078 07000002
ENTRYL   EQU   12                       LENGTH OF VOLIST ENTRY   Y02078 07050002
RETCODE8 EQU   8                        RETURN CODE OF 8 TO USER Y02082 07100002
PSWDERR  EQU   X'02'                    PASSWORD ERROR           Y02082 07150002
IOERR    EQU   X'04'                    I/O ERROR IN VOLUME LIST Y02078 07200002
OPENDS   EQU   X'07'                    OPEN DATA SET ERROR      Y02082 07250002
CODE4    EQU   C'4'                     CODE 4 IN MESSAGE        Y02078 07300002
PERIOD   EQU   C'.'                     EBCDIC PERIOD            A43551 07350002
DIRFBIT  EQU   X'04'                    TURN DIRF BIT ON        SA56400 07400002
WRDATA   EQU   X'05'                    WRITE DATA COMMAND CODE  Y02082 07450002
GOODIO   EQU   X'20'                    TEST VALUE FOR GOOD I/O  Y02082 07500002
BLANK    EQU   C' '                     EBCDIC BLANK             YM2880 07501002
ACQPLN   EQU   96                       ACQUIRE LIST LENGHT    @Y30LSTG 07511003
RELINQ   EQU   X'04'                    RELINQUISH OP CODE     @Y30LSTG 07521003
INHIBDST EQU   X'20'                    INHIBIT DESTAGING      @Y30LSTG 07531003
OFF      EQU   X'FF'                    SWITCH RESETTING MASK  @Z40CSRC 07541037
*                                                                       07550002
         BALR  RBASE,0                                                  07600002
         USING BEGIN,RBASE                                              07650002
         USING SCRTHWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 07700002
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02078 07750002
         USING CVT,RCVT                                          S19028 07800002
*                                                                       07850002
* THIS SECTION UPDATES THE FORMAT 4 DSCB AND WRITES IT BACK.            07900002
*                                                                       07950002
BEGIN    EQU   *                                                        08000002
         TM    SISW2,DEMNTSW            TEST IF ENTERED FROM     Y02134 08050002
*                                       IGG0290F AFTER DEMOUNT   Y02134 08100002
         BO    RETURNPT                 BRANCH IF YES            Y02134 08150002
         TM    STYPEFLG,VIOBIT          TEST IF A VIO DATA SET   Y02132 08200002
         BO    DEQTEST1                 BRANCH IF YES            Y02132 08250002
         TM    STYPEFLG,VTOCENQ         TEST IF VTOC ENQ'ED      Y02082 08300002
         BNO   TSTALLOC                 BRANCH IF NOT            Y02082 08350002
         CLI   STATUS(VOLISTX),X00      TEST IF ERROR ON VOLUME  Y02082 08400002
         BNE   TESTEXIT                 BRANCH IF YES            Y02082 08450002
         NI    SISW1,X'FF'-NOSMFRCD     RESET NO SMF RCD SWITCH  Y02082 08500002
*                                       SINCE AT LEAST ONE       Y02082 08550002
*                                       SCRATCH WAS SUCCESSFUL   Y02082 08600002
         TM    STYPEFLG,ERXTENT         WERE OVERLAPPING         Y02078 08650002
*                                       EXTENTS FOUND           SA56400 08700002
         BZ    NOERROR                  BRANCH IF NO            SA56400 08750002
         OI    DS4VTOCI,DIRFBIT         TURN ON DIRF BIT        SA56400 09000002
NOERROR  EQU   *                                                SA56400 09050002
         LH    WORKREG2,DS4DSREC                                 Y02082 09100002
         AH    WORKREG2,HOLENUM                                  Y02082 09150002
         STH   WORKREG2,DS4DSREC        UPDATE VTOC HOLE COUNT   Y02082 09200002
         MVC   OUTDSCB(L'VTOCDSCB),VTOCDSCB                      Y02082 09250002
         LA    WORKREG2,L'VTOCDSCB      WRITE 96 BYTES OF DATA   Y02082 09300002
         ST    WORKREG2,CCW8+K4         SET COUNT FIELD          Y02082 09350002
         MVI   CCW8,WRDATA              WRITE DATA COMMAND CODE  Y02082 09400002
         MVC   OUTCCHHR,VTOCADR         SET UP SEARCH ID ADDRESS Y02082 09450002
         MVC   SEEK+K3(L'VTOCADR),VTOCADR                        Y02082 09500002
         LA    WORKREG2,CCW6            MODIFY CCW PTR IN IOB    Y02082 09550002
         ST    WORKREG2,IOB+CHNPGADR                             Y02082 09600002
         MVI   ECB,X00                  CLEAR THE ECB            Y02082 09650002
         EXCP  IOB                                                      09700002
         WAIT  ECB=ECB                  WAIT FOR COMPLETION             09750002
         TM    ECB,GOODIO               TEST FOR AN I/O ERROR    Y02082 09800002
         BO    TESTEXIT                 BRANCH IF NO I/O ERROR          09850002
         MVI   ERCODE+K1,RETCODE8       SET RETURN CODE          Y02082 09900002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 09950002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 10000002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 10050002
         MVI   STATUS(VOLISTX),IOERR    SET ERROR CODE IN VOLIST Y02078 10100002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 10150002
         DROP  R1                                                Y02078 10200002
*                                                                       10250002
* THIS SECTION DEQ'S THE VTOC.                                          10300002
*                                                                       10350002
TESTEXIT EQU   *                                                        10400002
         L     RUCB,WKADEB+UCBADDR      LOAD UCB ADDRESS         Y02078 10450002
         MVC   MINAME(L'SRTEVOLI),SRTEVOLI  MINOR RESOURCE NAME  Y02082 10500002
         MVC   MJNAME(L'VTOCNAME),VTOCNAME  MAJOR RESOURCE NAME  Y02082 10550002
         MVI   ENQAREA,X'FF'            SET LAST ENTRY INDICATOR Y02082 10600002
         SR    R1,R1                    ZERO REGISTER            Y02080 10650002
         STH   R1,ENQAREA+K2            CLEAR FOR DEQ MACRO      Y02080 10700002
         DEQ   (MJNAME,MINAME,6,SYSTEMS),RMC=STEP,MF=(E,ENQAREA)        10750002
*                                                                       10760002
         NI    DSMADTB2,X'FF'-DSMVTOCR-DSMSMCE  RESET VTOC       Y02144 10770002
*                                       ENQ'ED SMC SWITCHES      Y02144 10780002
         NI    STYPEFLG,X'FF'-VTOCENQ   RESET VTOC ENQ'ED SWITCH Y02082 10800002
*                                                                       10850002
         CLI   STATUS(VOLISTX),PSWDERR  TEST IF PASSWORD ERROR   Y02082 10900002
         BE    PASSERR                  IF YES, BRANCH           M3097  10950002
*                                                                       11300002
* THIS SECTION ISSUES MESSAGE IEC603I WITH CODE=0 OR CODE=4.            11350002
*                                                                       11400002
TSTIOERR EQU   *                        TEST IF I/O ERROR        Y02078 11450002
         CLI   STATUS(VOLISTX),IOERR    TEST IF I/O ERROR ON VOL Y02078 11500002
         BNE   TSTOVLAP                 BRANCH IF NO I/O ERROR   Y02078 11550002
         LA    RETURN,ISSUEMSG          SET UP RETURN REGISTER   Y02078 11600002
         B     BUILDMSG                 GO BUILD MESSAGE IEC603I Y02078 11650002
TSTOVLAP EQU   *                        TEST DIRF BIT            Y02078 11700002
         TM    STYPEFLG,ERXTENT         TEST IF DIRF BIT SET DUE Y02078 11750002
*                                       TO OVERLAPPING EXTENTS   Y02078 11800002
         BO    SETREC                   BRANCH IF NOT          @Y30LSTG 11850003
*                                                              @Y30LSTG 11853003
* IF NO ERRORS, THIS ROUTINE RELINQUISHES VIRTUAL DASD SPACE   @Y30LSTG 11856003
*                                                              @Y30LSTG 11859003
         L     R1,RELQADR               POINT TO PARM LIST     @Y30LSTG 11862003
         LTR   R1,R1                    IS THERE ONE           @Y30LSTG 11865003
         BZ    TSTALLOC                 NO, RELINQ. UNNEEDED   @ZM30032 11868003
         CLI   K4(R1),RELINQ            VALID PARM LIST        @Y30LSTG 11871003
         BNE   TSTALLOC                 NO, AGAIN NOTHING TO DO@Y30LSTG 11874003
         MVC   K8(K6,R1),SRTEVOLI       MOVE IN VOLID          @Y30LSTG 11877003
         OI    K6(R1),INHIBDST          SET NO DESTAGING       @Y30LSTG 11880003
         MVI   K0(R1),X00               1ST BYTE NEEDS ZEROING @Y30LSTG 11882003
         MVI   D3(R1),ACQPLN            PUT LENGTH IN MSS MSG  @Y30LSTG 11882403
         ICBACREL TYPE=REL,MF=(E,(1))   RELINQUISH THE SPACE   @Y30LSTG 11883003
         B     TSTALLOC                 CONTINUE               @Y30LSTG 11889003
*   ERROR RETURNS ARE IGNORED AS THE POSTING OF THE INHIBIT    @Y30LSTG 11892003
*   SWITCH IS THE VALID OPERATION REQUIRED                     @Y30LSTG 11895003
SETREC   EQU   *                                               @Y30LSTG 11898003
         LA    RETURN,SETCODE           SET UP RETURN REGISTER   Y02078 11900002
BUILDMSG EQU   *                        BUILD ERROR MSG          Y02078 11950002
         MVC   INDSCB(MSGEND-ERRMSG),ERRMSG  MOVE IN MESSAGE     Y02078 12000002
         MVC   INDSCB+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC UCB Y02078 12050002
*                                       CHANNEL/UNIT ADDRESS     Y02078 12100002
         MVC   INDSCB+VOLID(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID  Y02078 12150002
         BR    RETURN                   CONTINUE                 Y02078 12200002
SETCODE  EQU   *                        SET CODE                 Y02078 12250002
         MVI   INDSCB+CODE,CODE4        SET CODE=4 IN MESSAGE    Y02078 12300002
ISSUEMSG EQU   *                        ISSUE MESSAGE            Y02078 12350002
         WTO   MF=(E,INDSCB)            ISSUE MESSAGE IEC603I    Y02078 12400002
*                                                                       12450002
* IF THE UNIT WAS DYNAMICALLY ALLOCATED, THIS SECTION BUILDS THE        12500002
* REQUEST BLOCK TO INTERFACE WITH DYNAMIC ALLOCATION (SVC 99) TO        12550002
* UNALLOCATE THE UNIT.                                                  12600002
*                                                                       12650002
TSTALLOC EQU   *                        DYNAMIC ALLOCATN TEST    Y02082 12700002
         TM    SISW1,UCBALLOC           TEST IF UCB ALLOCATED    Y02082 12750002
*                                       BY DYNAMIC ALLOCATION    Y02082 12800002
         BNO   TESTLAST                 BRANCH IF NOT            Y02082 12850002
         LA    RPARM,VTOCDSCB           PARAMETER LIST BASE      Y02082 12900002
         USING S99RBP,RPARM                                      Y02082 12950002
         LA    RWRK,K4(,RPARM)          INCREMENT BY FOUR        Y02082 13000002
         ST    RWRK,S99RBPTR            SET UP REQUEST BLOCK PTR Y02082 13050002
         OI    S99RBPTR,S99RBPND        TURN ON HIGH ORDER BIT   Y02082 13100002
         LR    RPARM,RWRK               ADDRESS OF REQUEST BLOCK Y02082 13150002
         USING S99RB,RPARM              REQ BLOCK ADDRESSABILITY Y02082 13200002
         XC    S99RB(S99RBEND-S99RB),S99RB  ZERO REQ BLOCK CORE  Y02082 13250002
         MVI   S99RBLN,S99RBEND-S99RB   LENGTH OF REQUEST BLOCK  Y02082 13300002
         MVI   S99VERB,S99VRBUN         INDICATE UNALLOCATION    Y02082 13350002
         LA    RWRK,S99RBEND            ADDR OF TEXT POINTERS    Y02082 13400002
         ST    RWRK,S99TXTPP            PLACE IN REQUEST BLOCK   Y02082 13450002
         OI    S99FLG21,S99TIONQ        INDICATE TIOT ENQ'ED     Y02082 13500002
         LR    RPARM,RWRK               ADDRESS OF TEXT PTRS     Y02082 13550002
         USING S99TUPL,RPARM            TEXT PTRS ADDRESSABILITY Y02082 13600002
         LA    RTEXT,FW(,RPARM)         ADDRESS OF TEXT UNIT     Y02082 13650002
         ST    RTEXT,S99TUPTR           POINTER TO TEXT UNIT     Y02082 13700002
         OI    S99TUPTR,S99TUPLN        INDICATE LAST TEXT PTR   Y02082 13750002
         USING S99TUNIT,RTEXT           TEXT UNIT ADDRESSABILITY Y02082 13800002
         LH    RWRK,DDNAMEKY                                     Y02082 13850002
         STH   RWRK,S99TUKEY            DDNAME SPECIFIED         Y02082 13900002
         LA    RWRK,K1                                           Y02082 13950002
         STH   RWRK,S99TUNUM            INDICATE 1 DDNAME ENTRY  Y02082 14000002
         LA    RWRK,L'TIOEDDNM                                   Y02082 14050002
         STH   RWRK,S99TULNG            LENGTH OF TEXT PARM      Y02082 14100002
         L     RDSAB,DSABADDR           GET DSAB ADDRESS         Y02082 14150002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 14200002
         L     RTIOT,DSABTIOT           LOAD TIOT ADDRESS        Y02082 14250002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 14300002
         MVC   S99TUPAR(L'TIOEDDNM),TIOEDDNM  COPY TIOT'S DDNAME Y02082 14350002
         LA    R1,VTOCDSCB              POINT TO REQUEST BLK PTR Y02082 14400002
         DYNALLOC                                                Y02082 14450002
*                                                                       14460002
         NI    DSMADTB1,X'FF'-DSMUCBAL  RESET UCB ALLOCATED BIT  Y02144 14470002
         NI    SISW1,X'FF'-UCBALLOC     RESET ALLOCATED BIT      Y02082 14500002
*                                                                       14550002
* THIS SECTION BRANCHES BACK TO IGG0290E IF THE DATA SET MUST BE        14600002
* SCRATCHED FROM ANOTHER VOLUME.                                        14650002
*                                                                       14700002
TESTLAST EQU   *                        TEST EXIT BIT            Y02082 14750002
         TM    STYPEFLG,EXITBIT         IS EXIT BIT SET          Y02082 14800002
         BO    DEQTEST1                 BRANCH IF SET            Y02082 14850002
         NI    STYPEFLG,X'FF'-ERXTENT-DOSPACK  TURN OFF OVERLAP  Y02080 14900002
*                                       INDICATOR AND DOS PACK   XM1038 14950002
*                                       INDICATOR                XM1038 15000002
         LA    R7,LOAD2                 POINT TO ID OF IGG0290E  Y02134 15050002
         L     R1,RELQADR               POINT TO PARM LIST     @Y30LSTG 15060003
         LTR   R1,R1                    IS THERE ONE           @Y30LSTG 15070003
         BZ    LOADEXIT                 NO. GO TO EXIT         @ZM30032 15080003
         XC    K0(ACQPLN,R1),K0(R1)     ZERO IT OUT IF IT EXIST@Y30LSTG 15090003
*                                                                       15100002
* THIS SECTION BRANCHES TO ANOTHER LOAD OF SCRATCH.                     15150002
*                                                                       15200002
LOADEXIT EQU   *                        EXIT TO NEXT LOAD        Y02134 15250002
         L     RA,OLDPLPTR              GET PARAMETER LIST POINTER      15300002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 15350002
         IECRES LOAD,EXTPR=(RWKAREA),MODID=(R7),BRANCH=DIRECT    Y02134 15400002
*                                                                       15450002
* THIS SECTION STORES THE PASSWORD ERROR CODE IN THE REMAINING VOLUME   15500002
* LIST ENTRIES.                                                         15550002
*                                                                       15600002
PASSERR  EQU   *                                                        15650002
         LH    VOLCTR,VOLNUM            NUMBER OF REMAINING VOLS Y02082 15700002
         LA    VOLCTR,K1(VOLCTR)        INCREMENT BY ONE         Y02082 15750002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 15800002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 15850002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 15900002
ERRLOOP  EQU   *                                                        15950002
         MVI   STATUS(VOLISTX),PSWDERR  SET PASSWORD ERROR       Y02078 16000002
         LA    VOLISTX,ENTRYL(VOLISTX)  POINT TO NEXT ENTRY      Y02078 16050002
         BCT   VOLCTR,ERRLOOP           BRANCH IF MORE VOLUMES   Y02082 16100002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 16150002
         DROP  R1                                                Y02078 16200002
         MVI   ERCODE+K1,RETCODE8       SET RETURN CODE          Y02082 16250002
         B     TSTALLOC                 GO TEST IF ALLOCATED     Y02082 16300002
*                                                                       16350002
* IF A VOLUME WAS ENQ'ED AND MOUNTED BY IGG0290F, THIS SECTION          16400002
* BRANCHES TO IGG0290F TO DEMOUNT AND DEQ THE VOLUME.                   16450002
*                                                                       16500002
DEQTEST1 EQU   *                        DEQ VPL TEST             Y02082 16550002
         TM    SISW1,VOLDEQ             TEST IF VOL TO BE DEQ'ED Y02082 16600002
         BNO   DEQTEST2                 BRANCH IF NOT            Y02082 16650002
         OI    SISW2,DEMNTSW            SET DEMOUNT SWITCH       Y02134 16700002
         LA    R2,WKADEB                DEB ADDRESS IN REG 2     Y02134 16750002
         L     RUCB,PRUCBPTR            UCB ADDRESS IN REG 11    Y02134 16800002
         LA    R3,SRTEVOLI              VOLSER ADDR IN REG 3     Y02134 16850002
         L     R4,RETNAME               RETURN MODULE NAME       Y02134 16900002
         LA    R7,MNTLOAD               POINT TO ID OF IGG0290F  Y02134 16950002
         B     LOADEXIT                 GO BRANCH TO IGG0290F    Y02134 17000002
RETURNPT EQU   *                        RETURN HERE              Y02134 17050002
         NI    SISW2,X'FF'-DEMNTSW      RESET DEMOUNT SWITCH     Y02134 17100002
*                                                                       17150002
* IF SCRATCH ENQ'ED ON THE DSNAME, THIS SECTION ISSUES A DEQ            17200002
* DIRECTED TO THE INITIATOR'S TCB.                                      17250002
*                                                                       17300002
DEQTEST2 EQU   *                        DEQ SYSDSN TEST          Y02082 17350002
         TM    SISW2,DSNENQCV           IS CVOL SYSDSN ENQ'D   @Z40CSRC 17360037
         BO    STRIPBLK                 YES, GO STRIP BLANKS   @Z40CSRC 17370037
DSNQTST  EQU   *                        REGULAR SYSDSN ENQ TST @Z40CSRC 17380037
         TM    SISW1,DSNENQ             TEST IF ENQ'ED ON SYSDSN Y02082 17400002
         BNO   DEQTEST3                 BRANCH IF NOT            Y02082 17450002
STRIPBLK EQU   *                        STRIP TRAILING BLANKS  @Z40CSRC 17450237
         LA    R4,PDSNAME+L'PDSNAME-K1  LAST BYTE OF DSNAME      YM2880 17451002
TESTDSN  EQU   *                        SEARCH FOR NON-BLANK     YM2880 17452002
         CLI   K0(R4),BLANK             IS THIS ONE A BLANK      YM2880 17453002
         BNE   GETLNGTH                 BRANCH IF NO TO COMPUTE  YM2880X17454002
                                        LENGTH OF NAME FOR DEQ   YM2880 17455002
         BCT   R4,TESTDSN               TRY NEXT BYTE            YM2880 17456002
GETLNGTH EQU   *                        CALCULATE LENGTH         YM2880 17457002
*                                                                       17457237
* IF DSNENQCV IS ON INDICATING AN ENQ WAS DONE ON THE NAME              17457437
* SYSCTLG.VXXXXXX (WHERE XXXXXX IS THE VOLSER), ADD THE                 17457637
* SUFFIX QUALIFIER TO THE SIMPLE NAME SYSCTLG.                          17457837
*                                                                       17457937
         TM    SISW2,DSNENQCV           SYSCTLG.VXXXXXX ENQ'D? @Z40CSRC 17458137
         BNO   PASTCVOL                 NO, SKIP CVOL CODE     @Z40CSRC 17458237
         MVC   K1(L'CDOTV,R4),CDOTV     MOVE IN '.V'           @Z40CSRC 17458437
         MVC   K3(L'UCBVOLI,R4),VOLSER(VOLISTX) MV IN VOLSER   @Z40CSRC 17458637
         LA    R4,KDOTVVL(,R4)          ADJUST FOR LONGER NAME @Z40CSRC 17458837
PASTCVOL EQU   *                        BEYOND CVOL SUFFIXING  @Z40CSRC 17459037
         LA    R2,PDSNAME-K1            BYTE PRECEDING DSNAME    YM2880 17459237
         SR    R4,R2                    R4 HAS LENGTH FOR DEQ    YM2880 17459437
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 17550002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 17600002
         L     R2,TCBJSCB               LOAD JSCB ADDRESS        Y02082 17650002
         USING IEZJSCB,R2               JSCB ADDRESSABILITY      Y02082 17700002
         L     R2,JSCBACT               GET ACTIVE JSCB ADDRESS  YM2887 17701002
         L     R2,JSCBTCBP              ADDR OF INITIATOR'S TCB  Y02082 17750002
         MVC   ENQAREA(DEQLTH1),DEQLIST1 MOVE IN DEQ PARM LIST   Y02082 17800002
         MVC   MJNAME(L'DSNMJR),DSNMJR  MAJOR RESOURCE NAME      Y02082 17850002
         DEQ   (MJNAME,PDSNAME,(R4)),TCB=(R2),MF=(E,ENQAREA)     YM2880 17900002
*                                       ISSUE DEQ                YM2880 17910002
         TM    SISW2,DSNENQCV           IS DSNAME SUFFIXED     @Z40CSRC 17911037
         BNO   NOSUFFIX                 NO, SKIP BLANKING      @Z40CSRC 17911237
         NI    SISW2,OFF-DSNENQCV       RESET SUFFIX FLAG      @Z40CSRC 17912037
         LA    R4,PDSNAME-KDOTVVL(R4)   POINT AT '.VXXXXXX'    @Z40CSRC 17913037
         MVC   K0(KDOTVVL,R4),KDOTVVL(R4)  BLANK OUT SUFFIX    @Z40CSRC 17914037
         B     DSNQTST                  GO CHECK FOR REG. ENQ  @Z40CSRC 17915037
NOSUFFIX EQU   *                        NO SUFFIX TO BLANK     @Z40CSRC 17916037
         NI    DSMADTB2,X'FF'-DSMDSNE   RESET DSN ENQ'ED SWITCH  Y02144 17920002
*                                                                       17950002
* IF SCRATCH ENQ'ED ON THE TIOT, THIS SECTION ISSUES A DEQ.             18000002
*                                                                       18050002
DEQTEST3 EQU   *                        DEQ TIOT TEST            Y02082 18100002
         TM    SISW1,TIOTENQ            TEST IF ENQ'ED ON TIOT   Y02082 18150002
         BNO   TESTSMF                  BRANCH IF NOT            Y02082 18200002
         MVC   ENQAREA(DEQLTH2),DEQLIST2  MOVE IN DEQ PARM LIST  Y02082 18250002
         MVC   MJNAME(L'TIOTMJR),TIOTMJR  MAJOR RESOURCE NAME    Y02082 18300002
         DEQ   (MJNAME,TIOTMNR),MF=(E,ENQAREA)  DEQ FROM TIOT    Y02082 18350002
*                                                                       18360002
         NI    DSMADTB2,X'FF'-DSMTIOTE  RESET TIOT ENQ'ED SWITCH Y02144 18370002
*                                                                       18400002
* THIS SECTION DETERMINES IF AN SMF RECORD TYPE 17 MUST BE BUILT.       18450002
*                                                                       18500002
TESTSMF  EQU   *                                                 S19028 18550002
         TM    SISW1,NOSMFRCD           TEST IF SCRATCH TOTALLY  Y02082 18600002
*                                       OR PARTIALLY SUCCESSFUL  Y02082 18650002
         BO    EXIT                     BRANCH IF NOT            Y02082 18700002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02082 18750002
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 18800002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 18850002
         L     R2,TCBTCT                POINTER TO TCB           Y02082 18900002
         LA    R2,0(R2)                 CLEAR HI-ORDER         @ZA04736 18920037
         LTR   R2,R2                    TEST FOR TCT             M4916  18950002
         BZ    EXIT                     BRANCH IF NO TCT         M4916  19000002
         USING SMFTCT,R2                TCT ADDRESSABILITY       Y02082 19050002
         L     R2,TCTJMR                LOAD JMR ADDRESS         Y02082 19100002
         LTR   R2,R2                    IS THERE A JMR           Y02082 19150002
         BZ    EXIT                     BRANCH IF NOT            Y02082 19200002
         USING JMRJOB,R2                JMR ADDRESSABILITY       Y02082 19250002
         L     RA,CVTSMCA                                        S19028 19300002
         LTR   RA,RA                    IS THIS AN SMF SYSTEM    S19028 19350002
         BZ    EXIT                     BRANCH IF NO             S19028 19400002
         USING SMCABASE,RA                                       S19028 19450002
         TM    SMCAOPT,SMCADSA          IS DS RECORDING DESIRED  S19028 19500002
         BNO   EXIT                     BRANCH IF NO             S19028 19550002
         L     R6,OLDPLPTR              GET PARM LIST POINTER    S19028 19600002
         L     R7,4(R6)                 DSNAME PTR WITH IND BYTE S19028 19650002
         L     VOLISTX,K12(R6)          VOLUME LIST POINTER      Y02082 19700002
*                                                                       19750002
* THE FOLLOWING SECTION TESTS IF SMF TYPE 17 RECORDS MUST BE BUILT      19800002
* FOR TEMPORARY DATA SETS.  THE CALLER MUST BE IN SUPERVISOR STATE,     19850002
* IN KEY 0, OR AUTHORIZED TO TEST THE SYSIN/SYSOUT BIT IN THE JFCB.     19900002
*                                                                       19950002
         STM   RETURN,R3,IECREGSV+K12   SAVE TESTAUTH REGISTERS  Y02082 20000002
         TESTAUTH STATE=YES,KEY=YES,FCTN=1,BRANCH=YES  TEST IF   Y02082X20050002
                                        CALLER IS IN KEY 0 OR    Y02082X20100002
                                        IN SUPERVISOR STATE      Y02082 20150002
         LR    R4,R15                   SAVE RETURN CODE         Y02082 20200002
         LM    RETURN,R3,IECREGSV+K12   RESTORE REGISTERS        Y02082 20250002
         LTR   R4,R4                    TEST IF ANY CASE TRUE    Y02082 20300002
         BNZ   TESTNAME                 BRANCH IF NOT            Y02082 20350002
         TM    4(R6),X'40'              WAS ENTRY FROM A RDR OR  S19028 20400002
*                                       A WTR                    S19028 20450002
         BO    EXIT                     BRANCH IF YES            S19028 20500002
         TM    4(R6),X'80'              WAS ENTRY FROM STEP TERM S19028 20550002
*                                       OR JOB TERM? IF SO, THE  S19028 20600002
*                                       DSNAME PTR POINTS TO THE S19028 20650002
*                                       JFCBDSNM                 S19028 20700002
         BNO   TESTNAME                 BRANCH IF NO             Y02082 20750002
         USING INFMJFCB,R7                                       S19028 20800002
         TM    JFCBTSDM,JFCSDS          IS THIS A SYSIN/SYSOUT   S19028 20850002
*                                       DATA SET                 S19028 20900002
         BO    EXIT                     BRANCH IF YES            S19028 20950002
         DROP  R7                                                YM1337 20960002
TESTNAME EQU   *                        TEST NAME                Y02082 21000002
         CLC   SYSTEMDS,PDSNAME         SYSTEM GENERATED NAME?   YM1337 21050002
         BNE   BUILDSMF                 BRANCH IF NOT            A43551 21100002
         CLC   SYSTIME,PDSNAME+K8       TEST FOR CHARACTERS '.T' YM1337 21150002
         BNE   BUILDSMF                 BRANCH IF NOT            A43551 21200002
         CLI   PDSNAME+K16,PERIOD       TEST IF A TEMPORARY DS   YM1337 21250002
         BNE   BUILDSMF                 BRANCH IF NOT            A43551 21300002
         TM    SMCAOPT,SMCATDS          TEST IF RCD 17 DESIRED   A43551 21350002
*                                       FOR TEMPORARY DATA SETS  A43551 21400002
         BNO   EXIT                     BRANCH IF NO             S19028 21450002
*                                                                       21500002
* THIS SECTION CALCULATES IF ANOTHER WORK AREA MUST BE OBTAINED         21550002
* TO BUILD THE SMF RECORD TYPE 17.                                      21600002
*                                                                       21650002
BUILDSMF EQU   *                                                 A43551 21700002
         LH    VOLCTR,K0(VOLISTX)       GET THE NUMBER OF VOLS   Y02082 21750002
         LA    VOLISTX,K2(VOLISTX)      POINT TO FIRST ENTRY     Y02082 21800002
         LA    R4,WKADEB-SMF17RV2       DETERMINE HOW MANY VOLS  Y02082 21850002
         SRL   R4,3                     WILL FIT IN THE WKAREA   Y02082 21900002
         LA    R3,SMF17HDR              POINT TO SMF RECORD      Y02080 21950002
         CR    R4,VOLCTR                WILL ALL VOLS FIT IN     Y02082 22000002
*                                       THE SCRATCH WORK AREA    Y02082 22050002
         BNL   COREOK                   BRANCH IF YES            S19028 22100002
         LR    R4,VOLCTR                CALCULATE CORE NEEDED    Y02082 22150002
         SLL   R4,K3                    VOL COUNT TIMES 8        Y02082 22200002
         LA    R4,SMF17RV2-SMF17HDR(R4)  SET UP TO GET CORE      Y02082 22250002
         IECRES GET,EXTPR=(RWKAREA),ID=SCWA,LV=(R4),             Y02082X22300002
               STM=(R2,RETURN,IECREGSV+K12)                      Y02080 22350002
         LR    R3,R1                    GET WORK AREA ADDRESS    Y02082 22400002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO AFTER Y02082X22450002
                                        ISSUING THE IECRES GET   Y02082 22500002
         USING SMF17HDR,R3              ADDRESSABILITY           Y02082 22550002
*                                                                       22600002
* THIS SECTION BUILDS AN SMF RECORD TYPE 17.                            22650002
*                                                                       22700002
COREOK   EQU   *                                                 A43551 22750002
         XC    SMF17HDR(6),SMF17HDR     ZERO RECORD HEADER       A43551 22800002
         MVI   SMF17RTY,SMFREC17        SET RECORD TYPE          Y02082 22850002
         TIME  BIN                                               S19028 22900002
         STM   R0,R1,SMF17TME+2         TIME OF RECORD           S19028 22950002
         MVC   SMF17TME(8),SMF17TME+2                            S19028 23000002
         MVC   SMF17SID(4),SMCASID                               S19028 23050002
         DROP  RA                                                S19028 23100002
         MVC   SMF17JBN(SMF17UID-SMF17JBN),JMRJOB  JOB NAME      Y02082 23150002
         MVC   SMF17UID,JMRUSEID        USER ID FIELD            Y02082 23200002
         DROP  R2                                                Y02082 23250002
         XC    SMF17RIN,SMF17RIN        ZERO RECORD INDICATORS   Y02082 23300002
         MVC   SMF17DSN,PDSNAME         NAME OF SCRATCHED DS     YM1337 23350002
         XC    SMF17RV1,SMF17RV1        ZERO RESERVED AREA       Y02082 23400002
         XR    R7,R7                                             S19028 23450002
         LA    R2,SMF17RV2                                       Y02082 23500002
         USING SMF17RV2,R2                                       Y02082 23550002
TESTVOL  EQU   *                        WAS SCRATCH SUCCESSFUL   Y02082 23600002
         CLI   STATUS(VOLISTX),X00      WAS SCRATCH SUCCESSFUL   Y02082 23650002
         BNE   NEXTVOL                  BRANCH IF NOT            Y02082 23700002
         XC    SMF17RV2,SMF17RV2                                 Y02082 23750002
         MVC   SMF17FVL,VOLSER(VOLISTX)  MOVE VOL SER TO RECORD  Y02082 23800002
         LA    R7,1(R7)                 INCREMENT VOLUME COUNT   S19028 23850002
         LA    R2,SMF17LNV(R2)          INCREMENT RECORD PTR     Y02082 23900002
NEXTVOL  EQU   *                        NEXT VOLUME              Y02082 23950002
         LA    VOLISTX,ENTRYL(VOLISTX)  INCREMENT VOL LIST PTR   Y02082 24000002
         BCT   VOLCTR,TESTVOL           BRANCH IF MORE VOLUMES   Y02082 24050002
         LTR   R7,R7                    IS VOLUME COUNT ZERO     S19028 24100002
         BZ    EXIT                     BRANCH IF YES            S19028 24150002
         STC   R7,SMF17NVL              NUMBER OF SCRATCHED VOLS S19028 24200002
         DROP  R2                                                Y02082 24250002
         SR    R2,R3                    GET RECORD LENGTH AND    Y02082 24300002
         STH   R2,SMF17LEN              STORE IN RECORD          Y02082 24350002
         DROP  R3                                                Y02082 24400002
         LR    R1,R3                    POINT TO SMF RECORD      Y02082 24450002
         SMFWTM (1)                     WRITE SMF RECORD TYPE 17 A43551 24500002
*                                                                       24550002
* THIS SECTION RESTORES THE DEB AVT POINTER IF AN RPS WORK AREA EXISTS. 24600002
*                                                                       24650002
EXIT     EQU   *                                                        24700002
         TM    DSMADTB1,DSMRPSAP        TEST IF RPS APPENDAGE    YM3048X24710002
                                        IGG019EK WAS LOADED      YM3048 24720002
         BNO   CONTINUE                 BRANCH IF NOT            YM3048 24730002
         L     R1,WKADEB+APDIS          POINT TO APPENDAGE TABLE Y02082 24750002
         MVC   WKADEB+APDIS(K4),APSVA(R1)  RESTORE DEB AVT PTR   Y02082 24950002
         NI    DSMADTB1,X'FF'-DSMRPSAP  RESET RPS APP LOADED BIT Y02144 25020002
*                                                                       25050002
* THIS SECTION FREES ALL WORK AREAS AND RETURNS TO THE CALLER.          25100002
*                                                                       25150002
CONTINUE EQU   *                                                 S20201 25200002
         LH    R8,ERCODE                PICK UP ERROR CODE       Y02080 25250002
         L     RA,SCRSAVE               SAVE R14 IN R10        @G60ASBJ 25300060
         IECRES FREE,PREFIX=FIRST,A=(RWKAREA)                    Y02080 25330060
         LR    RETURN,RA                RESTORE R14            @G60ASBJ 25360060
         LR    R15,R8                   LOAD ERROR CODE          Y02080 25450002
         RETURN ,                                                Y02080 25500002
*                                                                       25550002
*** CONSTANTS                                                           25600002
*                                                                       25650002
ERRMSG   WTO   'IEC603I VTOC ERRORS MAY EXIST ON UUU,VOLSER,0',  Y02078X25700002
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 25750002
MSGEND   EQU   *                        END OF MSG               Y02078 25800002
VTOCNAME DC    CL8'SYSVTOC '                                            25850002
SYSTEMDS DC    C'SYS'                   EBCDIC CHARACTERS 'SYS'  A43551 25950002
SYSTIME  DC    C'.T'                    EBCDIC CHARACTERS '.T'   A43551 26000002
CDOTV    DC    C'.V'                    CVOL SUFFIX CONSTAN    @Z40CSRC 26010037
DEQLIST1 DEQ   (,,,SYSTEM),TCB=0,MF=L   SYSDSN DEQ LIST          YM2880 26050002
DEQLTH1  EQU   *-DEQLIST1               LENGTH OF DEQ LIST       Y02082 26100002
DEQLIST2 DEQ   (,,6,SYSTEM),MF=L        SYSZTIOT DEQ LIST        YM2880 26150002
DEQLTH2  EQU   *-DEQLIST2               LENGTH OF DEQ LIST       Y02082 26200002
         DS    0F                       FULLWORD BOUNDARY        Y02134 26250002
RETNAME  DC    CL4'290D'                RETURN NAME FOR IGG0290F Y02134 26300002
TIOTMJR  DC    CL8'SYSZTIOT'            TIOT MAJOR RESOURCE NAME Y02082 26350002
DSNMJR   DC    CL8'SYSDSN'              DSN MAJOR RESOURCE NAME  Y02082 26400002
DDNAMEKY DC    AL2(DUNDDNAM)            DDNAME UNALLOCATION KEY  Y02082 26450002
*                                                                       26500002
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       26550002
*                                                                       26600002
         XCTLTABL ID=(LOAD2,0E,MNTLOAD,0F),SVC=029,LENGTH=,      Y02134X26650002
               BRT=YES                                           Y02134 26700002
         SPACE 2                                                 Y02082 26750002
         IECDSECS CVT,DSAB,JMR,JSCB,QDB,RB,SMF,SMFTCT,TCB,TIOT,  Y02082X26800002
               UCB,EXPAND=YES                                    Y02082 26850002
JFCB     DSECT                                                 , S19028 26900002
         IEFJFCBN                                              , S19028 26950002
         EJECT                                                          27000002
WORKAREA IECSCRWA EP,F4,ADT=YES         SCRATCH WORK AREA        Y02144 27050002
         SPACE 2                                                 Y02080 27100002
         ORG   VTOCDSCB                                          Y02080 27150002
         IFASMFR   (17)                                          S19028 27200002
         EJECT                                                   Y02082 27250002
*                                                                       27300002
* DSECTS FOR INVOCATING DYNAMIC ALLOCATION (SVC 99)                     27350002
*                                                                       27400002
         IEFZB4D0                       DYNAMIC ALLOCATION DSECT Y02082 27450002
         EJECT                                                   Y02082 27500002
         IEFZB4D2                       DYNAMIC ALLOCATION KEYS  Y02082 27550002
KDOTVVL  EQU   L'CDOTV+L'UCBVOLI        CVOL SUFFIX LENGTH     @Z40CSRC 27560037
         END   IGG0290D                                          A43551 30000002
