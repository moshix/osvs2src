         TITLE 'IGG0290F - SCRATCH AND RENAME - VOLUME MOUNTING' Y02134 00200002
IGG0290F CSECT                                                          00400019
         ENTRY IGG0300F                                          Y02134 00420002
IGG0300F EQU   IGG0290F                 ALIAS                    Y02134 00440002
*          VS2 SU24  CHANGES/DELETIONS                         @G24LSFS 00460037
*789955                                                        @G24LSFS 00480037
*          VS2 RELEASE 01 DELETIONS                                     00500000
*0000                                                            YM2930 00550000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00560002
*0000004500,005600-005700,030000,070000-072000,082000-084000,    Y02080 00560102
*0000088000-092000,132000-140000,164000,168000-170000,174000,    Y02080 00560202
*0000198600-199200,222800,228000-230000,252000,272000-298000,    Y02080 00560302
*0000306000,306840,312000,316000,342500-354000,356600-357200,    Y02080 00560402
*0000378000-380000,398000-406000,412000,424000,442000-454000,    Y02080 00560502
*0000464000,468000,537200,537900-557800,558400-670000,676000-    Y02080 00560602
*0000687000,694000-700000,704000                                 Y02080 00560702
*0000000300-002000,026000-706000                                 Y02134 00560802
*0000058000,157000-158000,177000,406000,926000,929000,932000-    YM1238 00561002
*0000933000                                                      YM1238 00561202
*0000724000,914000                                               YM2887 00561302
*0000702000-705000,795000-796000,800000-801000                   Y02146 00561402
*0000798000                                                      YM5390 00561502
*0000955000                                                      YM6554 00561602
*0000226000,596000-624000,803000-804000,826000,831000-832000     YM7307 00562002
*0000                                                            YM7890 00564002
*0000                                                            YM8501 00570002
*          VS2 RELEASE 03 DELETIONS/CHANGES                    @ZM30032 00580003
*0000                                                          @Y301STG 00590003
*0000415450,653200                                             @ZA04505 00592037
*0000387000                                                    @ZA05596 00594037
*                                                                       00595037
*                                                                       00596037
*          VS2 RELEASE 037 CHANGES                                      00596237
*          VS2 RELEASE 03.818 DELETIONS/CHANGES                         00596437
*A544667-544668                                                @ZA20579 00596637
*0000                                                          @G18MSBS 00596837
*                                                                       00597037
*                                                                       00598037
*          RELEASE 20 DELETIONS                                         00600019
*0343308000                                                      S20016 00700020
*0343306980,307750,535200-535500                                 TS1611 00750020
*          RELEASE 21 DELETIONS                                         00800019
*1194034000-066000,102000-144000,168000,178000,236000,538000,    A41439 00860021
*1194558000,686000-688000                                        A41439 00920021
*0000344000                                                     SA52595 00970002
*          RELEASE 21.7 DELETIONS                                       00980002
*0000010000-024000,634000-646000                                SA56400 00990002
*0000052000,426000-428000,438000-440000,446000-450000,500000-   SA53147 00991002
*0000506000,522000-526000,538400-557200                         SA53147 00992002
*                                                                       02400019
*********************************************************************** 02500002
*                                                                       02600002
* MODULE NAME = IGG0290F (ALIAS IGG0300F)                               02700002
*                                                                       02800002
* DESCRIPTIVE MODULE NAME = SCRATCH AND RENAME VOLUME MOUNTING ROUTINE  02900002
*                                                                       03000002
* COPYRIGHT = NONE                                                      03100002
*                                                                       03200002
* STATUS CHANGE LEVEL = 004                                             03300002
*                                                                       03400002
* FUNCTION =                                                            03500002
*                                                                       03600002
*      THIS MODULE HAS THREE FUNCTIONS - DEMOUNTING, MOUNTING, AND      03700002
*      VERIFYING A VOLUME - AS INDICATED BY THE SETTING OF THREE        03800002
*      BITS (DEMNTSW, MOUNTSW, AND VERIFYSW) IN BYTE SISW2 IN THE       03900002
*      SCRATCH OR RENAME WORK AREA.  VALID COMBINATIONS OF THESE        04000002
*      BITS ARE:  DEMOUNTSW ALONE, DEMOUNTSW AND MOUNTSW BOTH SET,      04100002
*      AND VERIFYSW ALONE.                                              04200002
*                                                                       04300002
*      IF DEMOUNTSW IS SET, THIS MODULE FIRST TESTS THAT THE UNIT       04400002
*      IS ELIGIBLE FOR DEMOUNTING.  IF NOT, ERROR CODE X'04' IS         04500002
*      RETURNED TO THE MODULE WHICH PASSED CONTROL TO IGG0290F.         04600002
*                                                                       04700002
*      IF BOTH DEMOUNTSW AND MOUNTSW ARE SET, IT ISSUES AN EXCLUSIVE    04800002
*      ENQ ON SYSZVOLS.  IF THE RETURN CODE INDICATES THAT THE TASK     04900002
*      PREVIOUSLY HAD CONTROL OF THE RESOURCE, THE ENQ IS REISSUED      05000002
*      TO OBTAIN EXCLUSIVE CONTROL.  IF THE RETURN CODE FROM EITHER     05100002
*      ENQ INDICATES THAT THE RESOURCE IS UNAVAILABLE FOR EXCLUSIVE     05200002
*      CONTROL, ERROR CODE X'08' IS RETURNED TO THE MODULE WHICH        05300002
*      PASSED CONTROL TO IGG0290F (BEFORE ATTEMPTING TO DEMOUNT THE     05400002
*      CURRENT VOLUME.)                                                 05500002
*                                                                       05600002
*      IF DEMNTSW IS SET, THIS MODULE THEN ISSUES DEMOUNT MESSAGE       05700002
*      IEC502E FOR THE OPERATOR TO DEMOUNT THE CURRENT VOLUME.          05800002
*      IF THE CURRENT VOLUME IS A VIRTUAL MSS  VOLUME, THE              05810037
*      MESSAGE TO THE OPERATOR IS BYPASSED AND AN ICBMNTDE MACRO        05820037
*      (SVC 126) MESSAGE IS SENT TO THE MSS  SUB SYSTEM INSTEAD.        05830037
*      THE MSS  SUB SYSTEM WILL THEN DEMOUNT THE VIRTUAL PACK.          05840037
*      (SVC 126) MESSAGE IS SENT TO THE MSS  SUB SYSTEM INSTEAD.        05850037
*      THE MSS  SUB SYSTEM WILL THEN DEMOUNT THE VIRTUAL PACK.          05860037
*      IF THE MONITOR SPACE COMMAND IS ACTIVE AND/OR SMF VOLUME         05900002
*      ACCOUNTING INFORMATION IS REQUESTED, IT CALLS LSPACE (SVC 78)    06000002
*      TO ADD SPACE INFORMATION TO THE MESSAGE AND/OR TO WRITE AN       06100002
*      SMF RECORD TYPE 19.  IT ALSO CALLS VOLSTAT (SVC 91) TO WRITE     06200002
*      A VOLUME STATISTICS RECORD TO SYS1.LOGREC.  IF BIT VOLDEQ IS     06300002
*      SET IN BYTE SISW1, IT ALSO DEQ'S THE VOLUME FROM THE SYSZVOLS    06400002
*      RESOURCE.                                                        06500002
*                                                                       06600002
*      IF MOUNTSW IS SET, THIS MODULE THEN SETS BIT UCBMOUNT IN         06700002
*      THE UCB AND ISSUES MOUNT MESSAGE IEC601D.  IF THE CALLER OF      06800002
*      SCRATCH OR RENAME IS A TSO TASK, MESSAGE IEC108I IS ISSUED       06900002
*      TO HIS TERMINAL.  THE OPERATOR CAN REPLY EITHER 'U' (TO USE      07000002
*      THE VOLUME) OR 'M' (TO SKIP MOUNTING THIS VOLUME) TO MESSAGE     07100002
*      IEC601D.  IF THE OPERATOR CHOOSES TO SKIP THE VOLUME, THIS       07200002
*      MODULE RESETS BIT UCBMOUNT AND RETURNS ERROR CODE X'08' TO       07300002
*      THE MODULE WHICH PASSED CONTROL TO IGG0290F.                     07400002
*                                                                       07500002
*      IF THE MOUNTSW IS SET, BUT THE DEVICE IS FOUND TO BE             07510037
*      AN MSS  SUBSYSTEM PACK  THEN THE ACTION IN THE PRECEDING         07520037
*      PARAGRAPH IS BYPASSED.  INSTEAD A REQUEST IS ISSUED TO           07530037
*      JES3(IF THE UCB INDICATES A JES3 MANAGED UNIT) FOR VOLUME        07540037
*      AWARENESS.  THEN AN ICBMNTDE MACRO(SVC126) IS ISSUED TO          07550037
*      THE SYBSYSTEM AND THE VIRTUAL VOLUME REQUESTED WILL BE           07560037
*      MOUNTED BY THE SUBSYSTEM.                                        07570037
*                                                                       07580037
*      IF THE OPERATOR REPLIES 'U' OR IF JUST VERIFYSW IS SET,          07600002
*      SYSEVENT DONTSWAP IS INVOKED TO PREVENT MEMORY SWAPOUT           07650002
*      WHILE WAITING TO READ THE VOLUME LABEL (THIS PREVENTS            07660002
*      WAIT IF THE OPERATOR DECIDES TO CANCEL THE JOB), THIS            07680002
*      MODULE THEN RESETS BIT UCBMOUNT, AND                             07700002
*      VERIFIES THAT THE CORRECT VOLUME HAS BEEN MOUNTED.  IT THEN      07800002
*      CONVERTS THE CCHHR OF THE FORMAT 4 DSCB TO A TTR0 AND STORES     07900002
*      IT AND THE VOLSER IN THE UCB.  IT THEN RETURNS CONTROL TO THE    08000002
*      APPROPRIATE SCRATCH OR RENAME MODULE WITH A RETURN CODE OF 0.    08100002
*                                                                       08200002
* NOTES = (SEE BELOW)                                                   08300002
*                                                                       08400002
*      DEPENDENCIES =                                                   08500002
*                                                                       08600002
*           THE FIRST 364 BYTES OF THE SCRATCH AND RENAME WORK AREAS    08700002
*           (ADDRESSED RESPECTIVELY BY MAPPING MACROS IECSCRWA AND      08800002
*           IECRENWA) ARE MAPPED IDENTICALLY - 8 WORD PREFIX,20 WORD    08900002
*           EXTENDED PREFIX, 4 WORD DADSM WTG TABLE, 96 BYTE DSCB       09000002
*           AREA, AND 140 BYTE DSCB AREA.  THE 294 BYTES FROM LABELS    09100002
*           'WKADEB' THROUGH 'PDSNAME' ARE ALSO MAPPED IDENTICALLY.     09200002
*                                                                       09300002
*      RESTRICTIONS = NONE                                              09400002
*                                                                       09500002
*      REGISTER CONVENTIONS =                                           09600002
*                                                                       09700002
*           REGISTER 2 POINTS TO THE DEB.                               09800002
*           REGISTER 3 POINTS TO THE VOLUME SERIAL NUMBER.              09900002
*           REGISTER 4 CONTAINS THE LAST FOUR CHARACTERS OF THE         10000002
*           RETURN MODULE NAME.                                         10100002
*           REGISTER 5 CONTAINS THE NUMBER OF VOLUMES REMAINING         10200002
*           TO BE SCRATCHED OR RENAMED.                                 10300002
*           REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.  10400002
*           REGISTER 9 POINTS TO THE CVT.                               10500002
*           REGISTER 11 POINTS TO THE UCB.                              10600002
*           REGISTER 12 IS THE BASE REGISTER.                           10700002
*           REGISTER 13 POINTS TO THE EXTENDED PREFIX PORTION OF THE    10800002
*           SCRATCH OR RENAME WORK AREA.                                10900002
*                                                                       11000002
*      PATCH LABEL = IHB0028D                                           11100002
*                                                                       11200002
* MODULE TYPE = CONTROL                                                 11300002
*                                                                       11400002
*      PROCESSOR = ASSEMBLER                                            11500002
*                                                                       11600002
*      MODULE SIZE = LESS THAN 4096 BYTES                               11700002
*                                                                       11800002
*      ATTRIBUTES = REENTRANT, REFRESHABLE, ENABLED, PRIVILEGED         11900002
*                                                                       12000002
* ENTRY POINT =                                                         12100002
*                                                                       12200002
*      IGG0290F - ENTERED FROM A SCRATCH MODULE                         12300002
*      IGG0300F - ENTERED FROM A RENAME MODULE                          12400002
*                                                                       12500002
*      PURPOSE = SEE FUNCTION                                           12600002
*                                                                       12700002
*      LINKAGE =                                                        12800002
*                                                                       12900002
*           THIS MODULE IS BRANCHED TO BY USE OF THE IECRES MACRO       13000002
*           FROM MODULES IGG0290D, IGG0290E, IGG03001, AND IGG03002.    13100002
*                                                                       13200002
* INPUT =                                                               13300002
*                                                                       13400002
*      REGISTER 2 POINTS TO THE DEB IN THE SCRATCH OR RENAME WORK AREA. 13500002
*      REGISTER 3 POINTS TO THE VOLSER OF THE VOLUME TO BE MOUNTED (IF  13600002
*      A VOLUME IS TO BE MOUNTED AND/OR VERIFIED) OR TO THE VOLSER OF   13700002
*      THE VOLUME CURRENTLY MOUNTED (IF A VOLUME IS TO BE DEMOUNTED     13800002
*      AND DEQ'ED ONLY).                                                13900002
*      REGISTER 4 CONTAINS THE LAST FOUR CHARACTERS OF THE RETURN       14000002
*      MODULE NAME.                                                     14100002
*      REGISTER 5 CONTAINS THE NUMBER OF VOLUMES REMAINING TO BE        14200002
*      SCRATCHED OR RENAMED.                                            14300002
*      REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.       14400002
*      REGISTER 9 POINTS TO THE CVT.                                    14500002
*      REGISTER 10 POINTS TO THE SCRATCH OR RENAME PARAMETER LIST.      14600002
*      REGISTER 11 POINTS TO THE UCB.                                   14700002
*      REGISTER 13 POINTS TO THE EXTENDED PREFIX PORTION OF THE         14800002
*      SCRATCH OR RENAME WORK AREA.                                     14900002
*                                                                       15000002
* OUTPUT =                                                              15100002
*                                                                       15200002
*      THE FOLLOWING MESSAGES MAY BE ISSUED:                            15300002
*                                                                       15400002
*      TO DEMOUNT A VOLUME IF THE MONITOR SPACE COMMAND IS ACTIVE -     15500002
*                                                                       15600002
*           IEC502E XX UUU,VOLSER,SPACE=CCCC,TTTT,AAAA/YYYY,ZZZZ        15700002
*           IEC502E JOBNAME,STEPNAME                                    15800002
*                                                                       15900002
*      WHERE XX CAN BE EITHER K (KEEP) OR RK (RETAIN KEEP) FOR A        16000002
*           PRIVATE VOLUME OR EITHER D (DELETE) OR RD (RETAIN DELETE)   16100002
*           FOR A PUBLIC VOLUME.                                        16200002
*           UUU IS THE CHANNEL/UNIT ADDRESS.                            16300002
*           VOLSER IS THE VOLUME SERIAL NUMBER.                         16400002
*           CCCC IS THE TOTAL NUMBER OF FREE CYLINDERS ON THE VOLUME.   16500002
*           TTTT IS THE TOTAL NUMBER OF UNALLOCATED TRACKS IN ADDITION  16600002
*           TO THE FREE CYLINDERS.                                      16700002
*           AAAA IS THE NUMBER OF EXTENTS IN THE FORMAT 5 DSCB(S).      16800002
*           YYYY IS THE NUMBER OF CYLINDERS IN THE LARGEST EXTENT OF    16900002
*           UNALLOCATED SPACE ON THE VOLUME.                            17000002
*           ZZZZ IS THE NUMBER OF TRACKS IN ADDITION TO THE CYLINDERS   17100002
*           IN THE LARGEST EXTENT OF UNALLOCATED SPACE.                 17200002
*                                                                       17300002
*      TO DEMOUNT A VOLUME IF THE MONITOR SPACE COMMAND IS NOT ACTIVE   17400002
*      OR TO REJECT A VOLUME -                                          17500002
*                                                                       17600002
*           IEC502E XX UUU,VOLSER,JOBNAME,STEPNAME                      17700002
*                                                                       17800002
*      WHERE XX CAN BE K, RK, D, RD, OR R (REJECT).                     17900002
*                                                                       18000002
*      TO MOUNT A VOLUME -                                              18100002
*                                                                       18200002
*           IEC601D M UUU,VOLSER,JOBNAME,STEPNAME - REPLY U OR M.       18300002
*                                                                       18400002
*      THE OPERATOR CAN REPLY EITHER U (TO MOUNT AND USE THE VOLUME)    18500002
*      OR M (TO SKIP MOUNTING THIS VOLUME).                             18600002
*                                                                       18700002
*      TO TELL A TERMINAL THAT A VOLUME MUST BE MOUNTED -               18800002
*                                                                       18900002
*           IEC108I OPERATOR ACTION HAS BEEN REQUESTED FOR YOUR         19000002
*           DATA SET.                                                   19100002
*                                                                       19200002
* NOTE: NO MOUNT OR DEMOUNT MESSAGES ARE ISSUED TO THE OPERATOR         19210037
*      IF THE MOUNT OR DEMOUNT IS FOR AN MSS  SUBSYSTEM VIRTUAL         19218037
*      DEVICE.  IN THIS CASE, MESSAGES TO A TSO TEMINAL WILL            19226037
*      ALSO BE BYPASSED.                                                19234037
*                                                                       19242037
*        -IF AN ERROR REASON CODE IS RETURNED FROM THE MSS              19250037
*         (DIS) MOUNT THE REASON CODE IS PRINTED IN MSG                 19258037
*         IEC666I JJJJJJJJ,VOLSER,DDD MSS FAILURE IN (DIS)-             19266037
*         MOUNT. CODE=HHH -WHERE HHH EQUALS THE REASON CODE             19274037
*                                                                       19282037
*                                                                       19300002
*      THE FOLLOWING REGISTERS ARE RETURNED TO THE CALLING MODULE -     19400002
*                                                                       19500002
*      REGISTER 5 CONTAINS THE NUMBER OF VOLUMES REMAINING TO BE        19600002
*      SCRATCHED OR RENAMED.                                            19700002
*      REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.       19800002
*      REGISTER 9 POINTS TO THE CVT.                                    19900002
*      REGISTER 10 POINTS TO THE SCRATCH OR RENAME PARAMETER LIST.      20000002
*      REGISTER 11 POINTS TO THE UCB.                                   20100002
*      REGISTER 13 POINTS TO THE EXTENDED PREFIX PORTION OF THE         20200002
*      SCRATCH OR RENAME WORK AREA.                                     20300002
*      REGISTER 14 CONTAINS ONE OF THE FOLLOWING RETURN CODES:          20400002
*      00 - VOLUME SUCCESSFULLY DEMOUNTED, MOUNTED, AND/OR VERIFIED     20500002
*      04 - VOLUME COULD NOT BE DEMOUNTED                               20600002
*      08 - VOLUME COULD NOT BE MOUNTED                                 20700002
*      0C - I/O ERROR OCCURRED WHEN READING THE VOLUME LABEL            20800002
*                                                                       20900002
* EXITS - NORMAL = BRANCH VIA IFG019RA (THE OPEN/CLOSE/EOV/DADSM        21000002
*      RESIDENT ROUTINE) WITH A RETURN CODE OF ZERO TO THE MODULE       21100002
*      THAT PASSED CONTROL TO IGG0190F.                                 21200002
*                                                                       21300002
* EXITS - ERROR = BRANCH VIA IFG019RA WITH AN ERROR RETURN CODE (AS     21400002
*      DESCRIBED UNDER 'OUTPUT') TO THE MODULE THAT PASSED CONTROL TO   21500002
*      IGG0290F.                                                        21600002
*                                                                       21700002
* EXTERNAL REFERENCES = (SEE BELOW)                                     21800002
*                                                                       21900002
*      ROUTINES = EXCP    - EXECUTES A CHANNEL PROGRAM (SVC 0)          22000002
*                 WAIT    - WAITS ON AN EVENT CONTROL BLCOK (SVC 1)     22100002
*                 DEQ     - DEQ'S FROM SYSZVOLS (SVC 48)                22200002
*                 ENQ     - ENQ'S ON SYSZVOLS (SVC 56)                  22300002
*                 WTO     - WRITES A MESSAGE TO THE OPERATOR (SVC 35)   22400002
*                 WTOR    - WRITES A MESSAGE WITH REPLY (SVC 35)        22500002
*                 LSPACE  - BUILDS AN SMF RECORD 19 AND/OR ADDS SPACE   22700002
*                           INFORMATION TO A DEMOUNT MESSAGE (SVC 78)   22800002
*                 VOLSTAT - WRITES A VOLUME STATISTICS RECORD TO        22900002
*                           SYS1.LOGREC (SVC 91)                        23000002
*                 TPUT    - ISSUES A MESSAGE TO A TERMINAL (SVC 93)     23100002
*                 IECRES  - LOADS/BRANCHES TO ANOTHER MODULE            23200002
*                 IOSGEN  - SETS THE NOT READY BIT IN THE UCB           23300002
*                 IEFSSREQ- ISSUES A REQUEST TO JES3 FOR VOLUME         23310037
*                           AWARENESS FOR VIRTUAL VOLUMES.              23316037
*                 ICBMNTDE- TO MOUNT OR DEMOUNT A VIRTUAL VOLUME.       23322037
*                           AWARENESS FOR VIRTUAL VOLUMES.              23328037
*                 ICBMNTDE- TO MOUNT OR DEMOUNT A VIRTUAL VOLUME.       23334037
*                 SYSEVENT- PREVENTS/ENABLES MEMORY SWAPOUT             23350002
*                                                                       23400002
*      DATA AREAS = SCRATCH OR RENAME VOLUME LIST                       23500002
*                                                                       23600002
*      CONTROL BLOCKS = ASCB                                            23700002
*                       BASE                                            23800002
*                       CVT                                             23900002
*                       DSAB                                            24000002
*                       JSCB                                            24100002
*                       PSA                                             24200002
*                       PSCB                                            24300002
*                       SMCA                                            24400002
*                       TCB                                             24500002
*                       TIOT                                            24600002
*                       UPT                                             24700002
*                       UCB                                             24800002
*                       JCT                                             24810037
*                       JESCT                                           24820037
*                       SCT                                             24830037
*                       JCT                                             24840037
*                       JESCT                                           24850037
*                       SCT                                             24860037
*                                                                       24900002
* TABLES = SCRATCH OR RENAME WORK AREA                                  25000002
*                                                                       25100002
* MACROS = IECDSECS - EXPANDS THE ASCB, BASE, CVT, DSAB, JSCB, PSA,     25200002
*                     PSCB, SMF, TCB, TIOT, UPT, AND UCB DSECTS         25300002
*          IECDIOCM - EXPANDS THE IOS COMMUNICATIONS AREA               25400002
*          IECRENWA - EXPANDS THE RENAME WORK AREA                      25500002
*          IECPDSCT - EXPANDS PROBLEM DETERMINATION MSG DSECT           25500537
*          IECRES   - LOADS AND BRANCHES TO THE CALLING MODULE          25520537
*          IEFAJCTB - EXPANDS THE JOB CONTROL TABLE                     25540537
*          IEFASCTB - EXPANDS THE STEP CONTROL TABLE                    25560537
*          IEFJESCT - EXPANDS THE JES CONTROL TABLE                     25580537
*          IEFJESCT - EXPANDS THE JES CONTROL TABLE                     25600537
*          XCTLTABL - BUILDS A LIST OF MODULE NAMES AND ADDRESSES       25700002
*                                                                       25800002
* CHANGE ACTIVITY =                                                     25900002
*                                                                       25950002
*      SEE THE 'CHANGES/DELETIONS' SECTION FOLLOWING THE CSECT.         26000002
*                                                                       26100002
*********************************************************************** 26200002
         EJECT                                                   Y02134 26300002
*********************************************************************** 26400002
*                                                                       26500002
* REGISTER EQUATES -                                                    26600002
*                                                                       26700002
R0       EQU   0                        EQUATE FOR REGISTER 0    Y02134 26800002
R1       EQU   1                        EQUATE FOR REGISTER 1    Y02134 26900002
R2       EQU   2                        EQUATE FOR REGISTER 2    Y02134 27000002
RDEB     EQU   2                        POINTER TO WKADEB        Y02134 27100002
R3       EQU   3                        EQUATE FOR REGISTER 3    Y02134 27200002
RVOLSER  EQU   3                        POINTER TO VOL SER       Y02134 27300002
R4       EQU   4                        EQUATE FOR REGISTER 4    Y02134 27400002
RNAME    EQU   4                        CONTAINS RETURN MOD NAME Y02134 27500002
VOLCTR   EQU   5                        NUMBER OF REMAINING VOLS Y02134 27600002
R6       EQU   6                        EQUATE FOR REGISTER 6    Y02134 27700002
RDSAB    EQU   6                        POINTER TO THE DSAB      Y02134 27800002
RTCB     EQU   6                        POINTER TO THE TCB       Y02134 27900002
R7       EQU   7                        EQUATE FOR REGISTER 7    Y02134 28000002
RTIOT    EQU   7                        POINTER TO THE TIOT      Y02134 28100002
VOLISTX  EQU   8                        CURRENT VOLIST ENTRY PTR Y02134 28200002
R9       EQU   9                        EQUATE FOR REGISTER 9    Y02134 28300002
RCVT     EQU   9                        POINTER TO THE CVT       Y02134 28400002
RCODE    EQU   10                       RETURN CODE REGISTER     Y02134 28500002
PL       EQU   10                       PARAMETER LIST POINTER   Y02134 28600002
RSAVE    EQU   10                       POINTER TO SAVED REGS  @G18MSBS 28650037
RUCB     EQU   11                       UCB POINTER              Y02134 28700002
RBASE    EQU   12                       BASE REGISTER            Y02134 28800002
RWKAREA  EQU   13                       WORK AREA ADDRESS        Y02134 28900002
RETURN   EQU   14                       RETURN CODE REGISTER     Y02134 29000002
R14      EQU   14                       EQUATE FOR REGISTER 14   Y02134 29100002
RET      EQU   14                       EQUATE FOR REGISTER 14 @G18MSBS 29200037
R15      EQU   15                       EQUATE FOR REGISTER 15   Y02134 29220037
RF       EQU   15                       EQUATE FOR REGISTER 15 @G18MSBS 29240037
         SPACE 1                                                 Y02134 29300002
*                                                                       29400002
* OTHER EQUATES -                                                       29500002
*                                                                       29600002
K0       EQU   0                        CONSTANT OF ZERO         Y02134 29700002
K1       EQU   1                        CONSTANT OF 1            Y02134 29800002
K2       EQU   2                        CONSTANT OF 2            Y02134 29900002
K3       EQU   3                        CONSTANT OF 3            Y02134 30000002
K4       EQU   4                        CONSTANT OF 4            Y02134 30100002
K5       EQU   5                        CONSTANT OF 5            Y02134 30200002
K6       EQU   6                        CONSTANT OF 6            Y02134 30300002
K7       EQU   7                        CONSTANT OF 7            Y02134 30400002
K8       EQU   8                        CONSTANT OF 8            Y02134 30500002
K9       EQU   9                        CONSTANT OF 9            Y02134 30600002
K12      EQU   12                       CONSTANT OF 12           Y02134 30700002
K24      EQU   24                       CONSTANT OF 24           YM7890 30750002
RTNCODE4 EQU   4                        RETURN CODE OF 4         Y02134 30800002
RTNCODE8 EQU   8                        RETURN CODE OF 8         Y02134 30900002
RTNCODEC EQU   12                       RETURN CODE OF 12        Y02134 31000002
LSPACE   EQU   78                       LSPACE SVC               Y02134 31100002
VOLSTAT  EQU   91                       VOLSTAT SVC              Y02134 31200002
DEMNTUUU EQU   15                       OFFSET TO UUU IN DEMOUNT Y02134 31300002
*                                       MESSAGE                  Y02134 31400002
MOUNTUUU EQU   22                       OFFSET TO UUU IN MOUNT   Y02134 31500002
*                                       MESSAGE                  Y02134 31600002
SPACELN  EQU   29                       LENGTH-1 OF LSPACE INFO  Y02134 31700002
REJECTJN EQU   25                       OFFSET TO JOB NAME IN    Y02134 31800002
*                                       REJECT MESSAGE           Y02134 31900002
DEMNTJN1 EQU   26                       OFFSET TO JOB NAME IN    Y02134 32000002
*                                       ONE LINE DEMOUNT MESSAGE Y02134 32100002
DEMNTJN2 EQU   76                       OFFSET TO JOB NAME IN    Y02134 32200002
*                                       TWO LINE DEMOUNT MESSAGE Y02134 32300002
HIORDER  EQU   X'80'                    HI-ORDER BIT OF A BYTE @G18MSBS 32330037
SWAPREFX EQU   16                       PREFIX OF QUEUE ELEMENT@G18MSBS 32360037
MOUNTJN  EQU   33                       OFFSET TO JOB NAME IN    Y02134 32400002
*                                       MOUNT MESSAGE            Y02134 32500002
SMFFLAG  EQU   X'80'                    SMF FLAG FOR LSPACE      Y02134 32600002
LASTNTRY EQU   X'80'                    LAST ENTRY INDICATOR     Y02134 32700002
GOODIO   EQU   X'20'                    TEST FOR SUCCESSFUL I/O  Y02134 32800002
BLANK    EQU   X'40'                    EBCDIC BLANK             Y02134 32900002
CHARD    EQU   C'D'                     EBCDIC CHARACTER D       Y02134 33000002
CHARK    EQU   C'K'                     EBCDIC CHARACTER K       Y02134 33100002
CHARR    EQU   C'R'                     EBCDIC CHARACTER R       Y02134 33200002
REPLYM   EQU   C'M'                     REPLY OF M TO MOUNT MSG  Y02134 33300002
REPLYU   EQU   C'U'                     REPLY OF U TO MOUNT MSG  Y02134 33400002
*                                                                       33500002
D0       EQU   0                        DISPLACEMENT OF ZERO   @Y30LSTG 33506003
D2       EQU   2                        DISPLACEMENT OF ONE    @Y30LSTG 33507003
D3       EQU   3                        DISPLACEMENT OF THREE  @Y30LSTG 33508003
D4       EQU   4                        DISPLACEMENT OF FOUR   @Y30LSTG 33509003
D6       EQU   6                        DISPLACEMENT OF SIX    @Y30LSTG 33509203
D8       EQU   8                        DISPLACEMENT OF EIGHT  @Y30LSTG 33509403
D11      EQU   11                       DISPLACEMENT OF ELEVEN @Y30LSTG 33509603
D14      EQU   14                       DISPLACEMENT OF FOURTEN@Y30LSTG 33509803
D17      EQU   17                       DISPLA OF SEVENTEEN    @Y30LSTG 33509903
D24      EQU   24                       LENGTH OF TWENTY-FOUR  @Y30LSTG 33511603
D43      EQU   43                       DISP OF FORTY-THREE    @Y30LSTG 33512603
D46      EQU   46                       DISP OF FORTY-SIX      @Y30LSTG 33512803
D58      EQU   58                       DISP OF FIFTY-EIGHT    @Y30LSTG 33513003
D60      EQU   60                       DISP OF SIXTY          @Y30LSTG 33513203
D72      EQU   72                       SEVENTY-TWO            @Y30LSTG 33513803
L2       EQU   2                        LENGTH OF TWO          @Y30LSTG 33514003
L3       EQU   3                        LENGTH OF THREE        @Y30LSTG 33514203
L6       EQU   6                        LENGTH OF SIX          @Y30LSTG 33514303
L8       EQU   8                        LENGTH OF EIGHT        @Y30LSTG 33515703
L18      EQU   18                       LENGTH OF EIGHTEEN     @Y30LSTG 33516703
L19      EQU   19                       LENGTH OF NINETEEN     @Y30LSTG 33516903
L28      EQU   28                       LENGTH OF TWENTY-EIGHT @ZM33363 33517103
TWO40    EQU   240                      VALUE OF 2-HUNDRED 40  @Y30LSTG 33517603
DECZR0   EQU   X'F0'                    DECIMAL ZERO           @Y30LSTG 33517803
*********************************************************************** 33600002
         SPACE 1                                                 Y02134 33700002
         BALR  RBASE,K0                 ESTABLISH ADDRESSABILITY Y02134 33800002
         USING MNT00100,RBASE           CSECT ADDRESSABILITY     Y02134 33900002
         USING RENAMWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02134 34000002
         USING WKADEB,RDEB              IOB & CCW ADDRESSABILITY Y02134 34100002
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02134 34200002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02134 34300002
         EJECT                                                   Y02134 34600002
*                                                                       34700002
* THIS SECTION DETERMINES IF THE UCB IS ELIGIBLE FOR DEMOUNTING.        34800002
*                                                                       34900002
MNT00100 EQU   *                        TEST IF DEMOUNTABLE      Y02134 35000002
         TM    SISW2,VERIFYSW           TEST IF THE VOLUME IS TO Y02134 35100002
*                                       BE MERELY VERIFIED       Y02134 35200002
         BO    MNT04000                 BRANCH IF YES            Y02134 35300002
         TM    UCBDMCT,UCBDMC           CHECK FOR ANY USERS      Y02134 35400002
         BNZ   MNT01550                 BRANCH IF YES - VOLUME   Y02134 35500002
*                                       CANNOT BE DEMOUNTED      Y02134 35600002
         TM    UCBSTAT,UCBSYSR+UCBRESV+UCBPRES  TEST IF SYSRES,  Y02134 35700002
*                                       RESERVED, OR PERMANENT   Y02134 35800002
         BNZ   MNT01550                 BRANCH IF ANY OR ALL -   Y02134 35900002
*                                       VOL CANNOT BE DEMOUNTED  Y02134 36000002
         TM    UCBSTAB,UCBBSVL          TEST IF SHARED VOLUME    Y02134 36100002
         BZ    MNT01550                 BRANCH IF YES - VOLUME   Y02134 36200002
*                                       CANNOT BE DEMOUNTED      Y02134 36300002
         TM    UCBSTAT,UCBONLI          TEST IF ONLINE           Y02134 36400002
         BZ    MNT01550                 BRANCH IF NOT - VOLUME   Y02134 36500002
*                                       CANNOT BE DEMOUNTED      Y02134 36600002
*                                                                       36700002
* IF A VOLUME IS TO BE MOUNTED, THIS SECTION ISSUES AN EXCLUSIVE ENQ    36800002
* DIRECTED TO THE INITIATOR'S TCB WITH A MAJOR RESOURCE NAME OF         36900002
* SYSZVOLS AND THE VOLUME SERIAL NUMBER AS THE MINOR RESOURCE NAME.     37000002
* IF THE RETURN CODE INDICATES THAT THE TASK PREVIOUSLY HAD CONTROL     37100002
* OF THE RESOURCE, THE ENQ IS REISSUED TO OBTAIN EXCLUSIVE CONTROL.     37200002
*                                                                       37300002
MNT00200 EQU   *                        ISSUE ENQ RET=USE        Y02134 37400002
         TM    SISW2,MOUNTSW            SEE IF VOL TO BE MOUNTED Y02134 37500002
         BNO   MNT00400                 BRANCH IF NOT            Y02134 37600002
         MVC   ENQAREA(ENQLTH1),ENQLIST1  MOVE IN PARAMETER LIST Y02134 37700002
         MVC   MJNAME(L'SYSZVOLS),SYSZVOLS  MAJOR RESOURCE NAME  Y02134 37800002
         L     RTCB,TCBADDR             LOAD TCB ADDRESS         Y02134 37900002
         USING TCB,RTCB                 TCB ADDRESSABILITY       Y02134 37950002
         L     RTCB,TCBJSCB             LOAD JSCB ADDRESS        Y02134 38000002
         USING IEZJSCB,RTCB             JSCB ADDRESSABILITY      Y02134 38100002
         L     RTCB,JSCBACT             GET ACTIVE JSCB ADDRESS  YM2887 38101002
         L     RTCB,JSCBTCBP            INITIATOR TCB ADDRESS    Y02134 38200002
         ENQ   (MJNAME,(RVOLSER)),TCB=(RTCB),RET=USE,            Y02134X38300002
               MF=(E,ENQAREA)           ISSUE ENQ ON SYSZVOLS    Y02134 38400002
         LTR   R15,R15                  TEST RETURN CODE         Y02134 38500002
         BNZ   MNT00250                 BRANCH IF ENQ FAILED     Y02134 38600002
         OI    SISW1,VOLENQ             SET SYSZVOLS ENQ SWTCH @ZA05596 38700037
         B     MNT00300                 GO TEST IF MOUNT PENDING Y02134 38800002
*                                                                Y02134 38900002
MNT00250 EQU   *                        ISSUE ENQ RET=CHNG       Y02134 39000002
         CLI   ENQAREA+K3,RTNCODE8      TEST IF TASK ALREADY     Y02134 39100002
*                                       ENQ'ED ON THIS VOL SER   Y02134 39200002
         BNE   MNT01650                 BRANCH IF NOT            Y02134 39300002
         MVC   ENQAREA(ENQLTH2),ENQLIST2  MOVE IN PARAMETER LIST Y02134 39400002
         ENQ   (MJNAME,(RVOLSER)),TCB=(RTCB),RET=CHNG,           Y02134X39500002
               MF=(E,ENQAREA)           REISSUE THE ENQ          Y02134 39600002
         LTR   R15,R15                  TEST RETURN CODE         Y02134 39700002
         BNZ   MNT01650                 BRANCH IF NOT SUCCESSFUL Y02134 39800002
*                                                                Y02134 39900002
MNT00300 EQU   *                        TEST IF MOUNT PENDING    Y02134 40000002
         TM    UCBDMCT,UCBMOUNT         TEST IF MOUNT PENDING    Y02134 40100002
         BO    MNT04000                 BRANCH IF YES TO VERIFY  Y02134 40200002
*                                       THE VOLUME               Y02134 40300002
*                                                                       40400002
* IF A VOLUME IS CURRENTLY MOUNTED, THIS SECTION ISSUES DEMOUNT         40500002
* MESSAGE IEC502E.                                                      40600002
*                                                                       40700002
MNT00400 EQU   *                        TEST FOR NOTHING MOUNTED Y02134 40800002
         CLC   UCBVOLI,ZEROS            TEST FOR NO VOL SER      Y02134 40900002
         BE    MNT01000                 BRANCH, NOTHING MOUNTED  Y02134 41000002
         CLC   UCBVOLI,BLANKS           TEST FOR BLANK VOL SER   Y02134 41100002
         BE    MNT01000                 BRANCH, NOTHING MOUNTED  Y02134 41200002
         BAL   RETURN,MNT11000          LINK TO MOVE IN DEMOUNT  Y02134 41300002
*                                       MESSAGE AND ISSUE SVC 78 Y02134 41400002
*                                       (LSPACE) AND SVC 91      Y02134 41500002
* IF THE VOLUME IS ON A VIRTUAL MSS  SYSTEM, THE DEMOUNT       @Y30LSTG 41505003
* IS INTERCEPTED AND A MSG SENT TO MSS  INSTEAD.               @Y30LSTG 41510003
*                                                              @Y30LSTG 41515003
         TM    UCBTBYT2,UCBRVDEV        IS IT A VIRTUAL DEVICE @Y30LSTG 41520037
         BNO   MNT00420                 NO, DO ORDINARY DEMOUNT@Y30LSTG 41525003
         BAL   RETURN,MNT11230          GO SETUP DEMOUNT MSG   @Y30LSTG 41530003
         BAL   RETURN,MNT11260          GO ASK FOR A DEMOUNT   @Y30LSTG 41550003
         BAL   RETURN,MNT11300          GO CLEAR OUT UCB       @ZA04505 41552037
         B     MNT01000                 SKIP NORMAL MSG        @Y30LSTG 41555003
MNT00420 EQU   *                        BRANCH TO LABEL          Y02134 41600003
         MVC   MSGINDIC(K2),BLANKS      CLEAR XX FIELD           Y02134 41700002
         TM    UCBJBNR,UCBMONT          TEST FOR DISP=PASS       Y02134 41800002
         BNO   MNT00430                 BRANCH IF NOT            Y02134 41900002
         MVI   MSGINDIC,CHARR           MOVE IN PASS INDICATOR   Y02134 42000002
*                                                                Y02134 42100002
MNT00430 EQU   *                        TEST FOR PRIVATE         Y02134 42200002
         TM    UCBSTAB,UCBBPRV          TEST FOR PRIVATE         Y02134 42300002
         BNO   MNT00440                 BRANCH IF NOT            Y02134 42400002
         MVI   MSGINDIC+K1,CHARK        MOVE IN KEEP INDICATOR   Y02134 42500002
         B     MNT00470                 GO COMPLETE THE MESSAGE  Y02134 42600002
*                                                                Y02134 42700002
MNT00440 EQU   *                        TEST FOR PUBLIC          Y02134 42800002
         TM    UCBSTAB,UCBBPUB          TEST FOR PUBLIC          Y02134 42900002
         BNO   MNT00450                 BRANCH IF NOT            Y02134 43000002
         MVI   MSGINDIC+K1,CHARD        MOVE IN DELETE INDICATOR Y02134 43100002
         B     MNT00470                 GO COMPLETE THE MESSAGE  Y02134 43200002
*                                                                Y02134 43300002
MNT00450 EQU   *                        TEST IF DISP SPECIFIED   Y02134 43400002
         CLI   MSGINDIC+K1,BLANK        TEST IF DISP SPECIFIED   Y02134 43500002
         BNE   MNT00470                 BRANCH IF SPECIFIED      Y02134 43600002
         CLI   MSGINDIC,CHARR           CHECK FOR PASS           Y02134 43700002
         BNE   MNT00460                 BRANCH - MUST BE REJECT  Y02134 43800002
         MVI   MSGINDIC+K1,CHARD        SET INDICATOR TO RD      Y02134 43900002
         B     MNT00470                 BRANCH TO FINISH MESSAGE Y02134 44000002
*                                                                Y02134 44100002
MNT00460 EQU   *                        SET INDICATOR TO REJECT  Y02134 44200002
         MVI   MSGINDIC,CHARR           SET INDICATOR TO REJECT  Y02134 44300002
*                                                                Y02134 44400002
MNT00470 EQU   *                        MOVE IN UUU AND VOLSER   Y02134 44500002
         LA    R1,F1DSCB+DEMNTUUU       POINT TO UUU AND VOLSER  Y02134 44600002
         BAL   RETURN,MNT11200          LINK TO GET UUU & VOLSER Y02134 44700002
*                                                                Y02134 44800002
         BAL   RETURN,MNT11300          LINK TO CLEAR UCB        Y02134 44900002
*                                                                Y02134 45000002
         LA    R1,F1DSCB+DEMNTJN1       POINT TO JOB NAME FOR    Y02134 45100002
*                                       ONE LINE DEMOUNT MSG     Y02134 45200002
         CLC   F1DSCB(K4),DMNTMSG2      TEST IF TWO LINE MSG     Y02134 45300002
         BNE   MNT00480                 BRANCH IF NOT            Y02134 45400002
         LA    R1,F1DSCB+DEMNTJN2       POINT TO JOB NAME FOR    Y02134 45500002
*                                       TWO LINE DEMOUNT MSG     Y02134 45600002
*                                                                Y02134 45700002
MNT00480 EQU   *                        MOVE IN JOB & STEP NAMES Y02134 45800002
         BAL   RETURN,MNT11400          LINK TO GET JOB NAME AND Y02134 45900002
*                                       STEP NAME FOR MESSAGE    Y02134 46000002
*                                                                Y02134 46100002
         BAL   RETURN,MNT11500          LINK TO ISSUE WTO        Y02134 46200002
*                                                                Y02134 46300002
*                                                                       46400002
* THIS SECTION LINKS TO A SUBROUTINE THAT ISSUES A DEQ FROM SYSZVOLS    46500002
* IF THE VOLUME BEING DEMOUNTED MUST BE DEQ'ED.                         46600002
*                                                                       46700002
MNT01000 EQU   *                        LINK TO DEQ TEST         Y02134 46800002
         BAL   RETURN,MNT10000          LINK TO TEST IF VOLUME   Y02134 46900002
*                                       MUST BE DEQ'ED           Y02134 47000002
*                                                                       47100002
* IF THE RETURN CODE FROM THE ENQ ON SYSZVOLS INDICATED THAT THE        47200002
* TASK DID NOT PREVIOUSLY HAVE CONTROL OF THE RESOURCE, THIS SECTION    47300002
* INITIALIZES VARIOUS FIELDS FOR A SUBSEQUENT DEQ.                      47400002
*                                                                       47500002
MNT01400 EQU   *                        SEE IF VOL TO BE MOUNTED Y02134 47600002
         TM    SISW2,MOUNTSW            SEE IF VOL TO BE MOUNTED Y02134 47700002
         BNO   MNT01500                 BRANCH IF NOT            Y02134 47800002
         TM    SISW1,VOLENQ             TEST IF VOLUME ENQ'ED    Y02134 47900002
*                                       BY FIRST ENQ             Y02134 48000002
         BNO   MNT03000                 BRANCH IF NOT            Y02134 48100002
         OI    SISW1,VOLDEQ             SET VOL TO BE DEQ'ED SW  Y02134 48200002
         NI    SISW1,X'FF'-VOLENQ       RESET VOL ENQ'ED SWITCH  Y02134 48300002
         MVC   VOLMINOR,K0(RVOLSER)     SAVE VOL SER FOR DEQ     Y02134 48400002
         B     MNT03000                 GO MOUNT THE VOLUME      Y02134 48500002
*                                                                       48600002
* THIS SECTION LOADS THE APPROPRIATE RETURN CODE.  AFTER LINKING TO     48700002
* A SUBROUTINE THAT ISSUES A DEQ FROM SYSZVOLS IF NECESSARY, THIS       48800002
* SECTION RETURNS TO THE CALLING MODULE.                                48900002
*                                                                       49000002
MNT01500 EQU   *                        NO ERROR                 Y02134 49100002
         XR    RCODE,RCODE              RETURN CODE OF ZERO      Y02134 49200002
         B     MNT02000                 GO RETURN                Y02134 49300002
*                                                                Y02134 49400002
MNT01550 EQU   *                        UNABLE TO DEMOUNT VOLUME Y02134 49500002
         LA    RCODE,RTNCODE4           RETURN CODE OF FOUR      Y02134 49600002
         TM    SISW2,MOUNTSW+VERIFYSW   SEE IF VOL TO BE MOUNTED Y02134 49700002
*                                       AND/OR VERIFIED          Y02134 49800002
         BNZ   MNT02000                 YES, GO RETURN           Y02134 49900002
         B     MNT01800                 NO, DEMOUNT ONLY - GO    Y02134 50000002
*                                       TEST IF VOL TO BE DEQ'ED Y02134 50100002
*                                                                Y02134 50200002
MNT01600 EQU   *                        OPERATOR CAN'T MOUNT VOL Y02134 50300002
         BAL   RETURN,MNT10000          TEST IF VOL TO BE DEQ'ED Y02134 50400002
*                                                                Y02134 50500002
MNT01650 EQU   *                        UNABLE TO MOUNT VOLUME   Y02134 50600002
         LA    RCODE,RTNCODE8           RETURN CODE OF EIGHT     Y02134 50700002
         B     MNT02000                 GO RETURN                Y02134 50800002
*                                                                Y02134 50900002
MNT01700 EQU   *                        I/O ERROR                Y02134 51000002
         LA    RCODE,RTNCODEC           RETURN CODE OF TWELVE    Y02134 51100002
         TM    SISW2,VERIFYSW           TEST IF VERIFY ONLY      Y02134 51200002
         BO    MNT02000                 YES, GO RETURN           Y02134 51300002
*                                                                Y02134 51400002
MNT01800 EQU   *                        LINK TO DEQ TEST         Y02134 51500002
         BAL   RETURN,MNT10000          LINK TO DEQ TEST         Y02134 51600002
*                                                                Y02134 51700002
MNT02000 EQU   *                        SET UP RETURN NAME       Y02134 51800002
         LA    R7,SCRATCH1              POINT TO NAME IGG0290D   Y02134 51900002
         CL    RNAME,SCRATCH1+K4        TEST IF RETURN NAME      Y02134 52000002
         BE    MNT02100                 BRANCH IF YES            Y02134 52100002
*                                                                Y02134 52200002
         LA    R7,SCRATCH2              POINT TO NAME IGG0290E   Y02134 52300002
         CL    RNAME,SCRATCH2+K4        TEST IF RETURN NAME      Y02134 52400002
         BE    MNT02100                 BRANCH IF YES            Y02134 52500002
*                                                                Y02134 52600002
         LA    R7,RENAME1               POINT TO NAME IGG03001   Y02134 52700002
         CL    RNAME,RENAME1+K4         TEST IF RETURN NAME      Y02134 52800002
         BE    MNT02100                 BRANCH IF YES            Y02134 52900002
*                                                                Y02134 53000002
         LA    R7,RENAME2               POINT TO NAME IGG03002   Y02134 53100002
*                                                                Y02134 53200002
MNT02100 EQU   *                        RETURN TO SCRATCH/RENAME Y02134 53300002
         NI    SISW2,X'FF'-VIRTMNT      TURN OFF VIRT MNT BIT  @Y30LSTG 53305003
         LR    RETURN,RCODE             RETURN CODE IN REG 14    Y02134 53400002
         L     RCVT,CVTPTR              RELOAD CVT ADDRESS       Y02134 53500002
         L     PL,OLDPLPTR              RELOAD PARM LIST ADDRESS Y02134 53600002
         IECRES LOAD,EXTPR=(RWKAREA),MODNM=(R7),BRANCH=DIRECT    Y02134 53700002
         EJECT                                                          53800037
         SPACE 3                                                        53810037
*********************************************************************** 53820037
*                                                                       53830037
* THIS SECTION ISSUES MOUNT MESSAGE IEC601D UNLESS THE DEVICE  @Y30LSTG 53840037
* IS AN MSS  SUBSYSTEM PACK.  IF IT IS A VIRTUAL VOLUME, ISSUE @G18MSBS 53850037
* A REQUEST TO JES3( IF THE UCB INDICATES A JES3 MANAGED UNIT) @G18MSBS 53860037
* FOR VOLUME AWARENESS.  AND THEN ISSUE THE ICBMNTDE MACRO     @G18MSBS 53870037
* (SVC 126) WHICH WILL INTERFACE WITH THE SUBSYSTEM TO MOUNT   @G18MSBS 53880037
* THE VIRTUAL VOLUME.                                          @G18MSBS 53890037
*                                                                       53900037
*********************************************************************** 53910037
*                                                                       54000002
MNT03000 EQU   *                        ISSUE IEC601D            Y02134 54100002
         BAL   RETURN,MNT11600          LINK TO SET MOUNT BIT    Y02134 54200002
*                                       AND TO PUT VOLSER IN UCB Y02134 54300002
*                                                                Y02134 54400002
         TM    UCBTBYT2,UCBRVDEV        IS IT A VIRTUAL DEVICE @Y30LSTG 54405037
         BNO   MNT03010                 NO, ALL SHOULD WORK    @ZM30032 54405337
         SPACE 1                                               @G18MSBS 54405637
         TM    UCBJBNR,UCBJES3          DOES JES3 MANAGE UNIT? @G18MSBS 54405937
         BNO   MNT03005                 NO, BYPASS JES3 ROUTINE@G18MSBS 54406237
         EJECT                                                          54406537
*                                                              @G18MSBS 54406837
***************************************************************@G18MSBS 54407137
*                                                              @G18MSBS 54407437
*      **************************                              @G18MSBS 54407737
*      * JES3 INTERFACE ROUTINE *                              @G18MSBS 54408037
*      **************************                              @G18MSBS 54408337
*                                                              @G18MSBS 54408637
*        ON ENTRY -                                            @G18MSBS 54408937
*                                                              @G18MSBS 54409237
*        THIS ROUTINE WILL BUILD THE SSOB HEADER AND EXTENSION @G18MSBS 54409537
*        PARAMETER LIST AND PASS IT TO JES3 VIA THE MACRO:     @G18MSBS 54409837
*        'IEFSSREQ', OFFERING THE VOLUME CHOICE TO JES3 FOR    @G18MSBS 54410137
*        APPROVAL.  UPON RETURN FROM JES3 THE 'SSOBRETN' FIELD @G18MSBS 54410437
*        IS TESTED FOR ZERO.  ZERO ALLOWS SCRATCH/RENAME TO    @G18MSBS 54410737
*        CONTINUE AND A NON-ZERO INDICATES JES3 DETERMINED     @G18MSBS 54411037
*        THAT VOLUME COULD NOT BE USED BY THIS JOB NOW. THE    @G18MSBS 54411337
*        RETURN CODE WILL BE SET TO EIGHT AND RETURN BACK TO   @G18MSBS 54411637
*        THE CALLER OF SCRATCH/RENAME.                         @G18MSBS 54411937
***************************************************************@G18MSBS 54412237
*                                                              @G18MSBS 54412537
        SPACE                                                           54412837
         STM   R0,RET,RENAMWKA          SAVE REGISTERS         @G18MSBS 54413137
         LR    RSAVE,RWKAREA            SAVE SAVEAREA PTR      @G18MSBS 54413437
         LA    R1,VTOCDSCB              GET THE WORK AREA      @G18MSBS 54413737
         USING SSOB,R1                  ESTAB ADDRESSABILITY   @G18MSBS 54414037
         XC    SSOB(SSOBSIZE),SSOB      CLEAR OUT WORK AREA    @G18MSBS 54414337
         ST    R1,DASSOBAD              SAVE PARM POINTER      @G18MSBS 54414637
*                                       SET HI-ORDER BIT TO    @G18MSBS 54414937
         OI    DASSOBAD,HIORDER         REQUEST THE SSOB MACRO @G18MSBS 54415237
         MVC   SSOBID,DASSOBID          ID OF SSOB             @G18MSBS 54415537
         MVI   SSOBLEN+K1,SSOBHSIZ      LENGTH OF SSOBHEADER   @G18MSBS 54415837
         MVI   SSOBFUNC+K1,SSOBOEOV     SET FUNCTION ID        @G18MSBS 54416137
*                                       INDICATE FINAL REQUEST @G18MSBS 54416437
         OI    SSMOFLG1,SSMOFINL+SSMOSCR FROM DADSM SCRATCH    @G18MSBS 54416737
        SPACE                                                           54417037
         LA    RF,SSMOBGN               GET FUNCTION DEPENDENT @G18MSBS 54417337
         ST    RF,SSOBINDV              AREA PTR AND SAVE IT   @G18MSBS 54417637
         MVI   SSMOLEN+K1,SSMOSIZE      LENGTH OF EXTENSION    @G18MSBS 54417937
         L     RTCB,TCBADDR             LOAD TCB ADDRESS       @G18MSBS 54418237
         USING TCB,RTCB                 TCB ADDRESSABILITY     @G18MSBS 54418537
         L     RTCB,TCBJSCB             LOAD JSCB ADDRESS      @G18MSBS 54418837
         USING IEZJSCB,RTCB             JSCB ADDRESSABILITY    @G18MSBS 54419137
         L     RTCB,JSCBACT             GET ACTIVE JSCB ADDRESS@G18MSBS 54419437
         L     RF,JSCBJCT               GET JCT PTR FROM JSCB  @G18MSBS 54419737
         LA    RF,SWAPREFX+JCTJNAME-JCTABLE(,RF) GET PTR OF    @G18MSBS 54420037
*                                       JOB NAME               @G18MSBS 54420337
         ST    RF,SSMOPNAM              AND SAVE IT FOR SSOB   @G18MSBS 54420637
         L     RF,JSCSCT                GET SCT PTR FROM JSCB  @G18MSBS 54420937
         LA    RF,SWAPREFX+SCTSNUMB-SCTABLE(,RF) GET PTR OF    @G18MSBS 54421237
*                                       STEP NUMBER            @G18MSBS 54421537
         ST    RF,SSMOPSTN              AND SAVE IT FOR SSOB   @G18MSBS 54421837
         LA    RF,UCBNAME               GET PTR OF UNIT ADDRESS@G18MSBS 54422137
         ST    RF,SSMOPUAD              AND SAVE IT FOR SSOB   @G18MSBS 54422437
         LA    RF,UCBVOLI               GET PTR OF VOLSER      @G18MSBS 54422737
         ST    RF,SSMOPVOL              AND SAVE IT FOR SSOB   @G18MSBS 54423037
         LA    RWKAREA,SSOBSAVE         GET SAVE AREA FOR SSOB @G18MSBS 54423337
         LA    R1,DASSOBAD              GET ADDR OF PARM PTR   @G18MSBS 54423637
         DROP  R1,RTCB                                         @G18MSBS 54423937
        EJECT                                                           54424237
*                                                              @G18MSBS 54424537
***************************************************************@G18MSBS 54424837
*                                                              @G18MSBS 54425137
**       PREPARE TO ISSUE MACRO: 'IEFSSREQ'                    @G18MSBS 54425437
*                                                              @G18MSBS 54425737
**       ON ENTRY:                                             @G18MSBS 54426037
*                                                              @G18MSBS 54426337
**       REGISTER  1 = POINTER TO SSOB PARAMETER LIST POINTER  @G18MSBS 54426637
**       REGISTER 10 = POINTER TO MY SAVE AREA TO RESTORE REGS @G18MSBS 54426937
**       REGISTER 13 = SAVE AREA TO BE USED BY JES3            @G18MSBS 54427237
*                                                              @G18MSBS 54427537
**       ON RETURN:                                            @G18MSBS 54427837
*                                                              @G18MSBS 54428137
**       REGISTER  0 = VOLATILE                                @G18MSBS 54428437
**       REGISTER  1 = POINTER TO SSOB PARAMETER LIST          @G18MSBS 54428737
**       REGISTER 10 = POINTER TO MY SAVE AREA TO RESTORE REGS @G18MSBS 54429037
**       REGISTER 15 = JES SSOB RETURN CODE(IGNORED-SEE BELOW) @G18MSBS 54429337
**       'SSOBRETN' CONTAINS A RETURN CODE:                    @G18MSBS 54429637
**                  0 = THIS VOLUME IS AVAILABLE FOR MOUNTING. @G18MSBS 54429937
**                  4 = JES3 HAS SOME OTHER USE FOR THAT VOL.  @G18MSBS 54430237
*                                                              @G18MSBS 54430537
***************************************************************@G18MSBS 54430837
*                                                              @G18MSBS 54431137
         IEFSSREQ                       ISSUE MACRO            @G18MSBS 54431437
        SPACE                                                           54431737
         USING SSOB,R1                  ESTAB ADDRESSABILITY   @G18MSBS 54432037
         L     RF,SSOBRETN              GET JES3 FUNCT RET CODE@G18MSBS 54432337
         DROP  R1                                              @G18MSBS 54432637
         SPACE                                                          54432937
         LM    R0,RET,K0(RSAVE)         RESTORE REGISTERS      @G18MSBS 54433237
         LTR   RF,RF                    TEST RET FROM IEFSSREQ @G18MSBS 54433537
         BNZ   MNT01600                 JES3 WON'T ALLOW THIS  @G18MSBS 54433837
*                                       VOLUME TO BE MOUNTED   @G18MSBS 54434137
         EJECT                                                          54434437
MNT03005 EQU   *                        MSS MOUNT ROUTINE      @G18MSBS 54434737
         XC    VTOCDSCB(L28),VTOCDSCB   CLEAR OUT WORK AREA    @G18MSBS 54435037
         MVC   VTOCDSCB+D8(L6),UCBVOLI  MOVE IN VOLID          @G18MSBS 54435337
         MVC   VTOCDSCB+D14(L2),UCBCHA  MOVE IN CHAN AND UNIT  @G18MSBS 54435637
         LA    R1,VTOCDSCB              POINT TO THE AREA      @Y30LSTG 54440003
         ICBMNTDE TYPE=MNT,MF=(E,(1))   ISSUE THE MOUNT        @Y30LSTG 54445003
         LTR   R15,R15                  ANY ERRORS             @ZM30032 54450003
         BNZ   MSSERR                   YES, GO ISSUE MESSAGE  @ZM30032 54455003
         OI    SISW2,VIRTMNT            INDICATE VIRT.MNT      @Y30LSTG 54456003
         B     MNT04000                 BRANCH OUT             @ZM30032 54460003
MSSERR   LA    R7,VTOCDSCB+L28          BASE MSG REGISTER      @ZM33363 54460503
         USING PDDSECT,R7               BASE MESSAGE AREA      @Y30SLTG 54461003
         LR    R15,R4                   SAVE REG FOUR          @Y30LSTG 54461503
         LA    R1,VTOCDSCB              BASE REG ONE           @Y30LSTG 54462003
         L     RCVT,CVTPTR              INIT BASE              @Y30LSTG 54462503
         L     R4,CVTTCBP               LOCATE TCB PTRS        @Y30LSTG 54463003
         L     R4,D4(,R4)               GET CURRENT TCB        @Y30LSTG 54463503
         L     R4,TCBTIO-TCB(,R4)       GET TIOT START         @Y30LSTG 54464003
         MVC   PDMSGLNG(MSSMSGL),MSSMSG  PUT IN MSG            @Y30LSTG 54464503
         MVC   PDMSG+D8(L8),TIOCNJOB-TIOT(R4) ST JOBNAME       @Y30LSTG 54464603
         MVC   PDMSG+D24(L3),UCBNAME    SET DDD IN MSG         @Y30LSTG 54464703
         MVC   PDMSG+D17(L6),D8(R1)     SET VOLSER IN MSG      @Y30LSTG 54464803
         SLL   R0,D4                    SHIFT FOUR BITS        @Y30LSTG 54464903
         STH   R0,D8(R1)                RESET REASON CODE      @Y30LSTG 54465403
         UNPK  PDMSG+D58(L3),D8(L2,R1)  UNPACK REASON CODE     @Y30LSTG 54465503
         OI    PDMSG+D60,DECZR0         MAKE DIGIT VALID       @Y30LSTG 54465603
         TR    PDMSG+D58(L3),NUMTBLE    MAKE IT PRINTABLE      @Y30LSTG 54465703
         MVC   PDMSG+D43(L18),PDMSG+D46 OVERLAY DIS IN MSG     @Y30LSTG 54466403
         LR    R4,R15                   RESTORE REG FOUR       @Y30LSTG 54466503
         WTO   MF=(E,PDMSGLNG)          ISSUE WTO              @Y30LSTG 54466603
         XC    UCBVOLI,UCBVOLI          CLEAR UCB VOL SERIAL   @ZA20579 54466737
         BAL   RETURN,MNT11800          RESET MOUNT PENDING    @ZA20579 54466837
         B     MNT01600                 POST ERROR             @Y30LSTG 54467137
         DROP  R7                       DROP                   @Y30LSTG 54467203
MNT03010 EQU   *                                               @Y30LSTG 54467703
*                                                              @Y30LSTG 54470003
         BAL   RETURN,MNT11700          LINK TO TELL TERMINAL    Y02134 54500002
*                                                                Y02134 54600002
         MVC   VTOCDSCB(IEC601DL),IEC601D  MOVE IN MOUNT MESSAGE Y02134 54700002
         LA    R1,VTOCDSCB+MOUNTUUU     POINT TO UUU AND VOLSER  Y02134 54800002
         BAL   RETURN,MNT11200          LINK TO GET UUU & VOLSER Y02134 54900002
*                                                                Y02134 55000002
         LA    R1,VTOCDSCB+MOUNTJN      POINT TO JOB NAME FIELD  Y02134 55100002
         BAL   RETURN,MNT11400          LINK TO GET JOBNAME AND  Y02134 55200002
*                                       STEPNAME FOR MESSAGE     Y02134 55300002
*                                                                Y02134 55400002
MNT03020 EQU   *                        ISSUE WTOR               Y02134 55500002
         XC    ECB,ECB                  CLEAR THE ECB            Y02134 55600002
         MVI   FIELD1,K0                CLEAR THE REPLY AREA     Y02134 55700002
*                                                                Y02134 55800002
         WTOR  ,FIELD1,1,ECB,MF=(E,VTOCDSCB)  ISSUE WTOR         Y02134 55900002
*                                                                Y02134 56000002
         WAIT  ECB=ECB                  WAIT FOR COMPLETION      Y02134 56100002
*                                                                Y02134 56200002
         CLI   FIELD1,REPLYU            TEST IF MOUNTING VOLUME  Y02134 56300002
         BE    MNT04000                 BRANCH IF YES            Y02134 56400002
         CLI   FIELD1,REPLYM            TEST IF SKIPPING VOLUME  Y02134 56500002
         BNE   MNT03020                 BRANCH IF NOT            Y02134 56600002
*                                                                Y02134 56700002
MNT03040 EQU   *                        RESET MOUNT BIT          Y02134 56800002
         XC    UCBVOLI,UCBVOLI          CLEAR THE VOL SERIAL NBR Y02134 56900002
         BAL   RETURN,MNT11800          LINK TO RESET MOUNT BIT  Y02134 57000002
*                                                                Y02134 57100002
         B     MNT01600                 GO SET THE RETURN CODE   Y02134 57200002
*                                                                       57300002
* THIS SECTION BUILDS AND EXECUTES THE CHANNEL PROGRAM TO READ          57400002
* THE VOLUME LABEL FROM RECORD 3 OF TRACK 0.                            57500002
*                                                                       57600002
MNT04000 EQU   *                        BUILD CHANNEL PROGRAM    Y02134 57700002
         XC    SEEK,SEEK                CLEAR IOB SEEK ADDRESS   Y02134 57800002
         MVI   SEEK+K7,K3               RECORD 3                 Y02134 57900002
         XC    CCW1(CCW4-CCW1),CCW1     CLEAR CCW AREA           Y02134 58000002
         LA    R15,SEEK+K3              SEARCH ID ADDRESS        Y02134 58100002
         ST    R15,CCW1                                          Y02134 58200002
         LA    R15,CCW1                 TIC ADDRESS              Y02134 58300002
         ST    R15,CCW2                                          Y02134 58400002
         LA    R15,VOLLABEL             READ AREA ADDRESS        Y02134 58500002
         ST    R15,CCW3                                          Y02134 58600002
         OC    CCW1(CCW4-CCW1),CHANPRG  OR IN CODES AND FLAGS    Y02134 58700002
         XC    VOLLABEL,VOLLABEL        CLEAR READ AREA          Y02134 58800002
*                                                                YM7890 58803002
*****************************************************************YM7890 58806002
*                                                                YM7890 58809002
*        IF MOUNT PENDING AND UNIT NOT READY MEMORY MAY          YM7890 58812002
*        NOT BE SWAPPED OUT, BECAUSE IF OPERATOR CANCELS         YM7890 58815002
*        THE JOB, THE JOB WILL NOT TERMINATE UNTIL THE           YM7890 58818002
*        MOUNT IS SATISFIED.                                     YM7890 58821002
*                                                                YM7890 58824002
*****************************************************************YM7890 58827002
*                                                                YM7890 58830002
         TM    UCBFL1,UCBNOTRD          TEST IF READY            YM7890 58833002
         BZ    MNT04050                 BR READY- BYPASS NOSWAP  YM7890 58836002
*                                                                YM7890 58839002
         SYSEVENT DONTSWAP              IN CASE OPERATOR CANCEL  YM7890 58842002
*                                                                YM7890 58845002
         SLL   R1,K24                   CLEAR HI 3 BYTES         YM7890 58848002
         LTR   R1,R1                    CHECK FOR ERROR          YM7890 58851002
         BNZ   MNT04050                 BRANCH IF ERROR          YM7890 58854002
*                                                                YM7890 58857002
         L     R15,IECRRPRM             GET PTR TO RECOVERY      YM8511 58858002
         SH    R15,SIXWORDS             BACK UP BY SIX WORDS     YM8511 58858202
         USING DSMADTW1,R15             R15 PTS TO RECOVERY WDS  YM8511 58858402
         OI    DSMADTB1,DSMASWAP        SET RECOVERY INDICATOR   YM8511 58859002
         DROP  R15                                               YM8511 58860002
*                                                                YM8511 58861002
         EXCP  IOB                      READ VOLUME LABEL        YM7890 58863002
*                                                                YM7890 58866002
         WAIT  ECB=ECB                  WAIT FOR I/O TO FINISH   YM7890 58869002
*                                                                YM8511 58870002
         L     R15,IECRRPRM             GET PTR TO RECOVERY      YM8511 58870202
         SH    R15,SIXWORDS             BACK UP BY SIX WORDS     YM8511 58870402
         USING DSMADTW1,R15             R15 PTS TO RECOVERY WDS  YM8511 58870602
         NI    DSMADTB1,X'FF'-DSMASWAP  RESET RECOVERY INDICATOR YM8511 58871002
         DROP  R15                                               YM8511 58871402
*                                                                YM7890 58872002
         SYSEVENT OKSWAP                ALLOW SWAPOUT-UNIT READY YM7890 58875002
*                                                                YM7890 58878002
         B     MNT04100                 BRANCH TO RESET MOUNT    YM7890 58881002
*                                                                YM7890 58884002
MNT04050 EQU   *                        READ LABEL - UNIT READY  YM7890 58887002
*                                                                Y02134 58900002
         EXCP  IOB                      READ VOLUME LABEL        Y02134 59000002
*                                                                Y02134 59100002
         WAIT  ECB=ECB                  WAIT FOR COMPLETION      Y02134 59200002
*                                                                Y02134 59300002
MNT04100 EQU   *                        RESET MOUNT PENDING      YM7890 59330002
*                                                                YM7890 59360002
         BAL   RETURN,MNT11800          LINK TO RESET MOUNT BIT  Y02134 59400002
*                                                                       59500002
MNT04160 EQU   *                        CHECK FOR I/O ERROR      Y02134 62500002
         TM    ECB,GOODIO               CHECK FOR I/O ERROR      Y02134 62600002
         BZ    MNT01700                 BRANCH IF I/O ERROR      Y02134 62700002
*                                                                Y02134 62800002
MNT04180 EQU   *                        TEST IF VOLUME MOUNTED   Y02134 62900002
         CLC   VOLSERNO,K0(RVOLSER)     TEST IF THE CORRECT      Y02134 63000002
*                                       VOLUME IS MOUNTED        Y02134 63100002
         BE    MNT05000                 BRANCH IF CORRECT        Y02134 63200002
         TM    SISW2,VIRTMNT            IS IT VIRTUAL MOUNT    @Y30LSTG 63205003
         BO    MNT01600                 YES CANT REISSUE MOUNT @ZM30032 63210003
*                                                                       63300002
* IF THE WRONG VOLUME WAS MOUNTED, THIS SECTION ISSUES A DEMOUNT        63400002
* MESSAGE IF THE UNIT IS DEMOUNTABLE.  IF THE VOLUME IS AN MSS @Y30LSTG 63500003
* SUBSYSTEM PACK, AND ICBMNTDE (SVC 126) MACRO IS SENT TO THE  @Y30LSTG 63510003
* MSS  SYSTEM AND THE PACK WILL BE DEMOUNTED.                  @Y30LSTG 63520003
*                                                                       63600002
MNT04200 EQU   *                        TEST IF DEMOUNTABLE      Y02134 63700002
         TM    SISW2,VERIFYSW           TEST IF VOLUME WAS TO BE Y02134 63800002
*                                       VERIFIED ONLY            Y02134 63900002
         BNO   MNT04300                 BRANCH IF VOLUME WAS TO@Y30LSTG 64000003
*                                       BE MNTED AND VERIFIED  @Y30LSTG 64100003
         TM    UCBDMCT,UCBDMC           CHECK FOR ANY USERS      Y02134 64200002
         BNZ   MNT01550                 BRANCH IF YES - VOLUME   Y02134 64300002
*                                       CANNOT BE DEMOUNTED      Y02134 64400002
         TM    UCBSTAT,UCBSYSR+UCBRESV+UCBPRES  TEST IF SYSRES   Y02134 64500002
*                                       RESERVED, OR PERMANENT   Y02134 64600002
         BNZ   MNT01550                 BRANCH IF ANY OR ALL -   Y02134 64700002
*                                       VOL CANNOT BE DEMOUNTED  Y02134 64800002
         TM    UCBSTAB,UCBBSVL          TEST IF SHARED VOLUME    Y02134 64900002
         BZ    MNT01550                 BRANCH IF YES - VOLUME   Y02134 65000002
*                                       CANNOT BE DEMOUNTED      Y02134 65100002
*                                                                Y02134 65200002
MNT04300 EQU   *                        MOVE IN REJECT MESSAGE   Y02134 65300002
*                                                              @Y30LSTG 65301003
* THIS CODE IS FOR THE MSS  DEMOUNT.                           @Y30LSTG 65302003
*                                                              @Y30LSTG 65303003
         TM    UCBTBYT2,UCBRVDEV        VIRT DASD REJECT       @Y30LSTG 65305037
         BNO   MNT04600                 NO, GO ON AS USUAL     @ZM30032 65310003
         BAL   RETURN,MNT11230          GO MAKE PARM LIST      @Y30LSTG 65315003
         MVC   F1DSCB+D8(L6),VOLSERNO   DO IT RIGHT            @Y30LSTG 65316003
         BAL   RETURN,MNT11260          GO ISSUE DMNT TO MSS   @Y30LSTG 65325003
         BAL   RETURN,MNT11300          GO CLEAR OUT UCB       @ZA04505 65327037
         B     MNT03000                 NO GO ISSUE MOUNT      @Y30LSTG 65330003
MNT04600 EQU   *                                               @Y30LSTG 65335003
         MVC   F1DSCB(REJECTL),RJECTMSG  MOVE IN REJECT MESSAGE  Y02134 65400002
         MVC   MSGINDIC+K2(L'UCBNAME),UCBNAME  MOVE CHANNEL/UNIT Y02134 65500002
*                                       ADDRESS INTO MESSAGE     Y02134 65600002
         MVC   MSGINDIC+K6(L'UCBVOLI),VOLSERNO  MOVE IN VOL SER  Y02134 65700002
*                                       OF VOLUME BEING REJECTED Y02134 65800002
         OC    MSGINDIC+K6(L'UCBVOLI),BLANKS  ENSURE UPPERCASE   Y02134 65900002
*                                                                Y02134 66000002
         BAL   RETURN,MNT11300          LINK TO CLEAR UCB        Y02134 66100002
*                                                                Y02134 66200002
         LA    R1,F1DSCB+REJECTJN       POINT TO JOB NAME FIELD  Y02134 66300002
         BAL   RETURN,MNT11400          LINK TO GET JOB NAME AND Y02134 66400002
*                                       STEP NAME FOR MESSAGE    Y02134 66500002
*                                                                Y02134 66600002
         BAL   RETURN,MNT11500          LINK TO ISSUE WTO        Y02134 66700002
*                                                                Y02134 66800002
         B     MNT03000                 GO ISSUE MOUNT MESSAGE   Y02134 66900002
*                                                                       67000002
* THIS SECTION CONVERTS THE CCHHR OF THE VTOC TO A TTR0 AND STORES      67100002
* IT AND THE VOLUME SERIAL NUMBER IN THE UCB.                           67200002
*                                                                       67300002
MNT05000 EQU   *                        CONVERT VTOC CCHHR       Y02134 67400002
         NI    SISW2,X'FF'-VIRTMNT      TURN OFF MOUNT SW      @Y30LSTG 67405003
         MVC   SEEK+K3(K5),VOLVTOC      CCHHR OF THE VTOC        Y02134 67500002
         BAL   RETURN,MNT11900          LINK TO CONVERT ROUTINE  Y02134 67600002
*                                                                Y02134 67700002
         ST    R0,UCBVTOC               STORE VTOC TTR0 IN UCB   Y02134 67800002
         MVC   UCBVOLI,VOLSERNO         MOVE VOL SER INTO UCB    Y02134 67900002
*                                                                       68000002
* THIS SECTION UPDATES THE UCB VOLUME DISPOSITION.                      68100002
*                                                                       68200002
MNT05100 EQU   *                        TEST FOR PASSED DATA     Y02134 68300002
         NI    UCBJBNR,X'FF'-UCBMONT    SET PASS TO ZERO         Y02134 68400002
         NI    UCBSTAB,X'FF'-UCBBPRV-UCBBPUB  SET PRIVATE AND    Y02134 68500002
*                                       PUBLIC TO ZERO           Y02134 68600002
         OI    UCBSTAT,UCBDADI          INDICATE SL VOLUME       Y02134 68700002
*                                                                Y02134 68800002
         L     RDSAB,DSABADDR           LOAD DSAB ADDRESS        Y02134 68900002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02134 69000002
         TM    DSABFLG3,DSABPASS        TEST FOR PASSED DATA     Y02134 69100002
         BNO   MNT05120                 BRANCH IF NOT PASSED     Y02134 69200002
*                                                                Y02134 69300002
         OI    UCBJBNR,UCBMONT          SET PASS INDICATOR       Y02134 69400002
*                                                                Y02134 69500002
MNT05120 EQU   *                        TEST FOR PRIVATE DATA    Y02134 69600002
         L     RTIOT,DSABTIOT           LOAD TIOT ADDRESS        Y02134 69700002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02134 69750002
         TM    TIOESTTA,TIOSDSP1        TEST FOR PRIVATE DATA    Y02134 69800002
         BNO   MNT05140                 BRANCH IF NOT PRIVATE    Y02134 69900002
         OI    UCBSTAB,UCBBPRV          SET PRIVATE INDICATOR    Y02134 70000002
*                                                                Y02134 70100002
         L     R1,UCBEXTPT              LOAD UCB EXTENSION ADDR  Y02146 70200002
         OI    UCBFLP1-UCBCMEXT(R1),UCBNSRCH SET TO NON-SCRTH VOLY02146 70400002
*                                                                Y02134 70600002
MNT05140 EQU   *                        TEST FOR PUBLIC DATA     Y02134 70700002
         TM    TIOESTTA,TIOSDSP2        TEST FOR PUBLIC DATA     Y02134 70800002
         BNO   MNT01500                 BRANCH IF NOT PUBLIC     Y02134 70900002
         OI    UCBSTAB,UCBBPUB          SET PUBLIC INDICATOR     Y02134 71000002
         B     MNT01500                 GO RETURN                Y02134 71100002
         EJECT                                                   Y02134 71200002
*                                                                       71300002
* IF THIS MODULE ENQ'ED ON THE VOLUME SERIAL OF THE VOLUME BEING        71400002
* DEMOUNTED, THIS ROUTINE ISSUES A DEQ DIRECTED TO THE INITIATOR'S TCB. 71500002
*                                                                       71600002
MNT10000 EQU   *                        ISSUE DEQ                Y02134 71700002
         TM    SISW1,VOLDEQ             TEST IF VOL TO BE DEQ'ED Y02134 71800002
         BCR   14,RETURN                RETURN IF NOT            Y02134 71900002
         L     RTCB,TCBADDR             LOAD TCB ADDRESS         Y02134 72000002
         USING TCB,RTCB                 TCB ADDRESSABILITY       Y02134 72050002
         L     RTCB,TCBJSCB             LOAD JSCB ADDRESS        Y02134 72100002
         USING IEZJSCB,RTCB             JSCB ADDRESSABILITY      Y02134 72200002
         L     RTCB,JSCBACT             GET ACTIVE JSCB ADDRESS  YM2887 72201002
         L     RTCB,JSCBTCBP            INITIATOR TCB ADDRESS    Y02134 72300002
         MVC   ENQAREA(DEQLTH1),DEQLIST1  MOVE IN DEQ PARM LIST  Y02134 72400002
         MVC   MJNAME(L'SYSZVOLS),SYSZVOLS  MAJOR RESOURCE NAME  Y02134 72500002
         LR    R7,RETURN                SAVE RETURN ADDRESS      YM8501 72550002
*                                                                YM8501 72560002
         DEQ   (MJNAME,VOLMINOR),TCB=(RTCB),MF=(E,ENQAREA)  DEQ  Y02134 72600002
*                                                                YM8501 72650002
         LR    RETURN,R7                RESTORE RETURN ADDRESS   YM8501 72660002
         NI    SISW1,X'FF'-VOLDEQ       RESET VOL DEQ SWITCH     Y02134 72700002
         XC    VOLMINOR,VOLMINOR        ZERO MINOR RESOURCE NAME Y02134 72800002
         BR    RETURN                   RETURN                   Y02134 72900002
         EJECT                                                   Y02134 73000002
*                                                                       73100002
* THIS ROUTINE MOVES THE APPROPRIATE DEMOUNT MESSAGE INTO THE WORK      73200002
* AREA.  IF THE MONITOR SPACE COMMAND IS ACTIVE AND/OR IF AN SMF        73300002
* RECORD TYPE 19 MUST BE BUILT, IT ISSUES SVC 78 (LSPACE).  IT THEN     73400002
* ISSUES SVC 91 (VOLSTAT) TO RECORD THE VOLUME STATUS ON SYS1.LOGREC.   73500002
*                                                                       73600002
MNT11000 EQU   *                        MONITOR SPACE ACTIVE     Y02134 73700002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02134 73800002
         L     R15,CVTMSLT              MASTER SCHED LINK TABLE  Y02134 73900002
         TM    BAMONITR-BASE(R15),BASPACE  MONITOR SPACE ACTIVE  Y02134 74000002
         BNO   MNT11020                 BRANCH IF NOT            Y02134 74100002
         MVC   F1DSCB(DMNTLN2),DMNTMSG2  MOVE IN THE TWO LINE    Y02134 74200002
*                                       DEMOUNT MESSAGE          Y02134 74300002
         MVI   SPACEMSG,BLANK           SET UP TO BLANK SPACE    Y02134 74400002
*                                       INFORMATION FIELD        Y02134 74500002
         MVC   SPACEMSG+K1(SPACELN),SPACEMSG  PROPAGATE BLANKS   Y02134 74600002
         LA    R1,SPACEMSG              POINT TO SPACE INFO      Y02134 74700002
         B     MNT11040                 GO TEST FOR SMF          Y02134 74800002
*                                                                Y02134 74900002
MNT11020 EQU   *                        PREPARE FOR LSPACE       Y02134 75000002
         MVC   F1DSCB(DMNTLN1),DMNTMSG1  MOVE IN DEMOUNT MESSAGE Y02134 75100002
         XR    R1,R1                    CLEAR REG FOR LSPACE     Y02134 75200002
*                                                                Y02134 75300002
MNT11040 EQU   *                        TEST FOR SMF SYSTEM      Y02134 75400002
         L     R15,CVTSMCA              GET SMCA ADDRESS         Y02134 75500002
         LTR   R15,R15                  TEST FOR SMF SYSTEM      Y02134 75600002
         BZ    MNT11060                 BRANCH IF NOT            Y02134 75700002
         USING SMCABASE,R15             SMCA ADDRESSABILITY      Y02134 75800002
         TM    SMCAOPT,SMCAVOL          IS VOL INFO REQUESTED    Y02134 75900002
         BZ    MNT11060                 BRANCH IF NOT            Y02134 76000002
*                                                                Y02134 76100002
         LA    R15,SMFFLAG              SET UP LSPACE SMF FLAG   Y02134 76200002
         SLL   R15,24                   MOVE FLAG TO BIT 0       Y02134 76300002
         OR    R1,R15                   PUT FLAG IN PARM REG     Y02134 76400002
*                                                                Y02134 76500002
MNT11060 EQU   *                        ISSUE LSPACE SVC         Y02134 76600002
         LTR   R1,R1                    IS LSPACE SVC REQUIRED   Y02134 76700002
         BZ    MNT11080                 BRANCH IF NOT            Y02134 76800002
*                                                                Y02134 76900002
         LR    R0,RUCB                  UCB ADDRESS IN REG 0     Y02134 77000002
         SVC   LSPACE                   ISSUE LSPACE SVC         Y02134 77100002
*                                                                Y02134 77200002
MNT11080 EQU   *                        ISSUE VOLSTAT SVC        Y02134 77300002
         LNR   R0,RUCB                  INDICATE A DA UCB        Y02134 77400002
         SVC   VOLSTAT                  ISSUE VOLSTAT SVC        Y02134 77500002
*                                                                Y02134 77600002
         BR    RETURN                   RETURN                   Y02134 77700002
         EJECT                                                   Y02134 77800002
*                                                                       77900002
* THIS ROUTINE FILLS IN THE UUU AND VOLSER FIELDS OF THE DEMOUNT        78000002
* AND MOUNT MESSAGES.  REGISTER 1 POINTS TO THE FIRST BYTE OF THE       78100002
* UUU (CHANNEL/UNIT ADDRESS) FIELD.                                     78200002
*                                                                       78300002
MNT11200 EQU   *                        FILL IN UUU AND VOLSER   Y02134 78400002
         MVC   K0(L'UCBNAME,R1),UCBNAME  MOVE CHANNEL/UNIT       Y02134 78500002
*                                       ADDRESS INTO MESSAGE     Y02134 78600002
         MVC   K4(L'UCBVOLI,R1),UCBVOLI  MOVE IN VOLUME SERIAL   Y02134 78700002
         OC    K4(L'UCBVOLI,R1),BLANKS  ENSURE UPPER CASE        Y02134 78800002
         BR    RETURN                   RETURN                   Y02134 78900002
*                                                              @Y30LSTG 78905003
* THIS ROUTINE CREATES AND FILLS IN THE DEMOUNT PARAMETER LIST @Y30LSTG 78910003
* IF A DEMOUNT MESSAGE IS TO BE ISSUED TO MSS .                @Y30LSTG 78915003
*                                                              @Y30LSTG 78920003
MNT11230 EQU   *                                               @Y30LSTG 78925003
         XC    F1DSCB(L28),F1DSCB       ZERO DEMNT MSG AREA    @ZM33363 78930003
         MVC   F1DSCB+D8(L6),UCBVOLI    MOVE IN THE VOLID      @Y30LSTG 78935003
         BR    RETURN                   GO BACK TO CALLER      @Y30LSTG 78955003
         SPACE 1                                               @Y30LSTG 78960003
*                                                              @Y30LSTG 78965003
* THIS ROUTINE ISSUES A DEMOUNT MESSAGE TO REMOVE A VIRTUAL    @Y30LSTG 78970003
* PACK FROM A VIRTUAL DRIVE.                                   @ZM30032 78975003
*                                                              @Y30LSTG 78980003
MNT11260 EQU   *                                               @Y30LSTG 78985003
         LA    R1,F1DSCB                POINT TO PARM LIST     @Y30LSTG 78990003
         ICBMNTDE TYPE=DMNT,VUA=UCBCHA, DEMOUNT THE PACK       @G24LSFS*78995037
               MF=(E,(1))                                               78995337
         LTR   R15,R15                  ANY ERRORS             @Y30LSTG 78996003
         BNZ   MSSERR2                  YES, GO ISSSUE MESG    @Y30LSTG 78997003
         BR    RETURN                   RETURN NORMAL          @ZM30032 78998003
MSSERR2  LA    R7,F1DSCB+L28            BASE MSG REGISTER      @ZM33363 78998503
         USING PDDSECT,R7               BASE MESSAGE AREA      @Y30SLTG 78999003
         LR    R15,R4                   SAVE REG FOUR          @Y30LSTG 78999503
         LA    R1,F1DSCB                BASE REG ONE           @Y30LSTG 78999603
         L     RCVT,CVTPTR              INIT BASE              @Y30LSTG 78999703
         L     R4,CVTTCBP               LOCATE TCB PTRS        @Y30LSTG 78999803
         L     R4,D4(,R4)               GET CURRENT TCB        @Y30LSTG 78999903
         L     R4,TCBTIO-TCB(,R4)       GET TIOT START         @Y30LSTG 79000403
         MVC   PDMSGLNG(MSSMSGL),MSSMSG  PUT IN MSG            @Y30LSTG 79000503
         MVC   PDMSG+D8(L8),TIOCNJOB-TIOT(R4) ST JOBNAME       @Y30LSTG 79000603
         MVC   PDMSG+D24(L3),UCBNAME    SET DDD IN MSG         @Y30LSTG 79000703
         MVC   PDMSG+D17(L6),D8(R1)     SET VOLSER IN MSG      @Y30LSTG 79000803
         SLL   R0,D4                    SHIFT FOUR BITS        @Y30LSTG 79001303
         STH   R0,D8(R1)                RESET REASON CODE      @Y30LSTG 79001403
         UNPK  PDMSG+D58(L3),D8(L2,R1)  UNPACK REASON CODE     @Y30LSTG 79001503
         OI    PDMSG+D60,DECZR0         MAKE DIGIT VALID       @Y30LSTG 79001603
         TR    PDMSG+D58(L3),NUMTBLE    MAKE IT PRINTABLE      @Y30LSTG 79001703
         LR    R4,R15                   RESTORE REG FOUR       @Y30LSTG 79002503
         WTO   MF=(E,PDMSGLNG)          ISSUE WTO              @Y30LSTG 79002603
         B     MNT01550                 POST ERROR             @Y30LSTG 79003103
         DROP  R7                       DROP                   @Y30LSTG 79003203
         EJECT                                                   Y02134 79003603
*                                                                       79100002
* THIS ROUTINE SETS THE NOT READY BIT IN THE UCB AND THEN               79200002
* CLEARS THE UCB BEFORE DEMOUNTING A VOLUME.                            79250002
*                                                                       79300002
MNT11300 EQU   *                        SET NOT READY            Y02134 79400002
*                                                                Y02134 79700002
         IOSGEN UCBFLG,UCB=(RUCB),VAR=ON,TABLE=UCBNRY  NOT READY YM5390 79800002
*                                                                Y02134 79900002
         L     R1,UCBEXTPT              LOAD UCB EXTENSION ADDR  Y02146 80000002
         NI    UCBFLP1-UCBCMEXT(R1),X'FF'-UCBNSRCH NON-SCRTH OFF Y02146 80100002
         XC    UCBVOLI,UCBVOLI          CLEAR VOL SER NUMBER     Y02134 80200002
         XC    UCBFSCT,UCBFSCT          CLEAR FILE COUNTERS      Y02134 80500002
         XC    UCBFSEQ,UCBFSEQ          CLEAR FILE SEQ COUNTERS  Y02134 80600002
         NI    UCBJBNR,X'FF'-UCBMONT    SET PASS TO ZERO         Y02134 80700002
         NI    UCBSTAB,X'FF'-UCBBPRV-UCBBPUB  SET PRIVATE AND    Y02134 80800002
*                                       PUBLIC TO ZERO           Y02134 80900002
         NI    UCBSTAT,X'FF'-UCBDADI    SET SL VOLUME TO ZERO    Y02134 81000002
         BR    RETURN                   RETURN                   Y02134 81100002
         EJECT                                                   Y02134 81200002
*                                                                       81300002
* THIS ROUTINE FILLS IN THE JOB NAME AND STEP NAME FIELDS OF THE        81400002
* DEMOUNT AND MOUNT MESSAGES.  REGISTER 1 POINTS TO THE FIRST BYTE      81500002
* OF THE JOB NAME FIELD.                                                81600002
*                                                                       81700002
MNT11400 EQU   *                        JOB AND STEP NAMES       Y02134 81800002
         L     RTCB,TCBADDR             LOAD CURRENT TCB ADDRESS Y02134 81900002
         USING TCB,RTCB                 TCB ADDRESSABILITY       Y02134 81950002
         L     RTIOT,TCBTIO             LOAD TIOT ADDRESS        Y02134 82000002
         MVC   K0(L'TIOCNJOB,R1),TIOCNJOB-TIOT(RTIOT)  JOB NAME  Y02134 82100002
         MVC   K9(K8,R1),TIOCSTEP-TIOT(RTIOT)  STEP NAME         Y02134 82200002
         BR    RETURN                   RETURN                   Y02134 82300002
         SPACE 1                                                 Y02134 82400002
*                                                                       82500002
* THIS ROUTINE ISSUES A WTO.                                            82600002
*                                                                       82700002
MNT11500 EQU   *                        ISSUE WTO SVC            Y02134 82800002
         XR    R0,R0                    CLEAR FOR MULTI-LINE WTO Y02134 82850002
         WTO   MF=(E,F1DSCB)            ISSUE WTO SVC            Y02134 82900002
*                                                                Y02134 83000002
         BR    RETURN                   RETURN                   Y02134 83300002
         SPACE 1                                                 Y02134 83400002
*                                                                       83500002
* THIS ROUTINE SETS THE MOUNT BIT IN THE UCB AND PUTS THE VOLUME        83600002
* SERIAL NUMBER OF THE VOLUME BEING MOUNTED IN THE UCB.                 83700002
*                                                                       83800002
MNT11600 EQU   *                        SET THE MOUNT BIT        Y02134 83900002
         OI    UCBDMCT,UCBMOUNT         SET THE MOUNT BIT        Y02134 84000002
         MVC   UCBVOLI,K0(RVOLSER)      MOVE VOL SER INTO UCB    Y02134 84100002
         BR    RETURN                   RETURN                   Y02134 84200002
         EJECT                                                   Y02134 84300002
*                                                                       84400002
* THIS ROUTINE ISSUES A TPUT FOR MESSAGE IEC108I FOR A TSO TASK.        84500002
*                                                                       84600002
MNT11700 EQU   *                        SET UP MESSAGE IEC108I   Y02134 84700002
         L     R15,PSAAOLD-PSA          LOAD ASCB OLD POINTER    Y02134 84800002
         L     R15,ASCBTSB-ASCB(R15)    LOAD TSB ADDRESS         Y02134 84900002
         LTR   R15,R15                  TEST IF TSO TASK         Y02134 85000002
         BZ    MNT11740                 BRANCH IF NOT            Y02134 85100002
*                                                                Y02134 85200002
         MVC   VTOCDSCB(L'IEC108I),IEC108I  MOVE MSG TO BUFFER   Y02134 85300002
         LA    R0,L'IEC108I             LENGTH OF TSO MESSAGE    Y02134 85400002
         LA    R1,VTOCDSCB              POINT TO TSO MESSAGE     Y02134 85500002
         L     RTCB,TCBADDR             LOAD CURRENT TCB ADDRESS Y02134 85600002
         USING TCB,RTCB                 TCB ADDRESSABILITY       Y02134 85650002
         L     RTCB,TCBJSCB             LOAD JSCB ADDRESS        Y02134 85700002
         USING IEZJSCB,RTCB             JSCB ADDRESSABILITY      Y02134 85800002
         LH    R15,JSCBTJID             LOAD TJID                Y02134 85900002
         L     RTCB,JSCBPSCB            LOAD PSCB ADDRESS        Y02134 86000002
         USING PSCB,RTCB                PSCB ADDRESSABILITY      Y02134 86100002
         L     RTCB,PSCBUPT             LOAD UPT ADDRESS         Y02134 86200002
         USING UPT,RTCB                 UPT ADDRESSABILITY       Y02134 86300002
         TM    UPTSWS,UPTMID            TEST IF MSG ID REQUIRED  Y02134 86400002
         BO    MNT11720                 BRANCH IF YES            Y02134 86500002
         LA    R1,K8(R1)                ADJUST TSO MESSAGE PTR   Y02134 86600002
         SH    R0,IDLENGTH              ADJUST TSO MSG LENGTH    Y02134 86700002
*                                                                Y02134 86800002
MNT11720 EQU   *                        ISSUE TPUT SVC           Y02134 86900002
         SLL   R15,16                   SHIFT TJID TO HI ORDER   Y02134 87000002
         OR    R0,R15                   PUT TJID IN MSG LENGTH   Y02134 87100002
         TPUT  (1),(0),R                SEND MESSAGE TO TERMINAL Y02134 87200002
*                                                                Y02134 87300002
MNT11740 EQU   *                        RETURN LABEL             Y02134 87400002
         BR    RETURN                   RETURN                   Y02134 87500002
         EJECT                                                   Y02134 87600002
*                                                                       87700002
* THIS ROUTINE RESETS THE MOUNT BIT IN THE UCB.                         87800002
*                                                                       87900002
MNT11800 EQU   *                        RESET THE MOUNT BIT      Y02134 88000002
         NI    UCBDMCT,X'FF'-UCBMOUNT   RESET THE MOUNT BIT      Y02134 88100002
         BR    RETURN                   RETURN                   Y02134 88200002
         SPACE 1                                                 Y02134 88300002
*                                                                       88400002
* THIS ROUTINE LINKS TO THE RESIDENT CONVERT ROUTINE TO CONVERT         88500002
* AN MBBCCHHR TO A TTR0, WHICH IS RETURNED IN REGISTER 0.               88600002
*                                                                       88700002
MNT11900 EQU   *                        LINK TO CONVERT ROUTINE  Y02134 88800002
         LA    R1,WKADEB                WORK AREA DEB ADDRESS    Y02134 88900002
         DROP  RDEB                                              Y02134 89000002
         USING WKADEB,R1                WORK AREA ADDRESSABILITY Y02134 89100002
         LA    R2,SEEK                  POINTER TO MBBCCHHR      Y02134 89200002
         LR    R7,RWKAREA               SAVE EXTENDED PREFIX ADR Y02134 89300002
         STM   R9,RETURN,IECREGSV+K12   SAVE REGISTERS 9 - 14    Y02134 89400002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02134 89500002
         L     R15,CVTPRLTV             LOAD CONVERT ROUTINE ADR Y02134 89600002
         BALR  RETURN,R15               LINK TO CONVERT ROUTINE  Y02134 89700002
         LM    R9,RETURN,IECREGSV+K12-RENAMWKA(R7)  RESTORE REGS Y02134 89800002
         LA    RDEB,WKADEB              RESTORE WORK AREA ADDR   Y02134 89900002
         USING WKADEB,RDEB              WORK AREA ADDRESSABILITY Y02134 90000002
         BR    RETURN                   RETURN                   Y02134 90100002
         EJECT                                                   Y02134 90200002
*                                                                       90300002
*********************************************************************** 90400002
*                                                                       90500002
* PROGRAM CONSTANTS                                                     90600002
*                                                                       90700002
*********************************************************************** 90800002
*                                                                       90900002
ENQLIST1 ENQ   (,,E,6,SYSTEM),RET=USE,MF=L  SYSZVOLS ENQ LIST    Y02134 91000002
ENQLTH1  EQU   *-ENQLIST1               LENGTH OF ENQ PARM LIST  Y02134 91100002
ENQLIST2 ENQ   (,,E,6,SYSTEM),RET=CHNG,MF=L  SYSZVOLS ENQ LIST   Y02134 91200002
ENQLTH2  EQU   *-ENQLIST2               LENGTH OF ENQ PARM LIST  Y02134 91300002
DEQLIST1 DEQ   (,,6,SYSTEM),TCB=0,MF=L  SYSZVOLS DEQ LIST        YM2887 91400002
DEQLTH1  EQU   *-DEQLIST1               LENGTH OF DEQ PARM LIST  Y02134 91500002
SYSZVOLS DC    CL8'SYSZVOLS'            SYSZVOLS MAJOR NAME      Y02134 91600002
ZEROS    DC    XL6'00'                  SIX BYTES OF ZEROS       Y02134 91700002
BLANKS   DC    CL6' '                   SIX BYTES OF BLANKS      Y02134 91800002
SIXWORDS DC    AL2(6*4)                 SIX FULLWORDS            YM8511 91801002
DASSOBID DC    CL4'SSOB'                SSOB HEADER ID         @G18MSBS 91841037
         SPACE 1                                                 Y02134 91900002
*                                                                       92000002
* MESSAGES ISSUED BY THIS MODULE                                        92100002
*                                                                       92200002
IEC108I  DC    C'IEC108I OPERATOR ACTION HAS BEEN REQUESTED FOR YOUR DAX92300002
               TA SET'                                           Y02134 92400002
IDLENGTH DC    H'8'                     LENGTH OF MSG ID         Y02134 92500002
RJECTMSG WTO   'IEC502E R UUU,VOLSER,JOBNAME ,STEPNAME',         YM1238X92600002
               DESC=2,ROUTCDE=4,MF=L                             Y02134 92700002
REJECTL  EQU   *-RJECTMSG               LENGTH OF REJECT MESSAGE Y02134 92800002
DMNTMSG1 WTO   'IEC502E XX UUU,VOLSER,JOBNAME ,STEPNAME',        YM1238X92900002
               DESC=2,ROUTCDE=4,MF=L                             Y02134 93000002
DMNTLN1  EQU   *-DMNTMSG1               LENGTH OF DEMOUNT MSG    Y02134 93100002
DMNTMSG2 WTO   ('IEC502E XX UUU,VOLSER,SPACE=CCCC,TTTT,AAAA/YYYY,ZZZZ',X93200002
               D),('IEC502E JOBNAME ,STEPNAME',DE),              YM1238X93300002
               DESC=2,ROUTCDE=4,MF=L                             Y02134 93400002
DMNTLN2  EQU   *-DMNTMSG2               LENGTH OF DEMOUNT MSG    Y02134 93500002
IEC601D  WTOR  'IEC601D M UUU,VOLSER,JOBNAME ,STEPNAME - REPLY U OR M',X93600002
               ,1,,DESC=2,ROUTCDE=4,MF=L                         Y02134 93700002
IEC601DL EQU   *-IEC601D                LENGTH OF MOUNT MESSAGE  Y02134 93800002
NUMTBLE  EQU   *-TWO40                  TRANSLATE TABLE        @Y30LSTG 93800503
         DC    C'0123456789ABCDEF'      REA CODE FOR VIRT DASD @Y30LSTG 93801003
MSSMSG   WTO   'IEC666I JJJJJJJJ,VOLSER,DDD MSS FAILURE IN DISMOUNT. COX93801503
               DE=HHH   ',MF=L,DESC=4,ROUTCDE=(2,11)           @Y30LSTG 93802003
MSSMSGL  EQU   *-MSSMSG                 LENGTH OF MSG          @Y30LSTG 93802503
         SPACE 1                                                 Y02134 93900002
*                                                                       94000002
* CCW'S TO READ THE VOLUME LABEL                                        94100002
*                                                                       94200002
CHANPRG  DC    X'3100000040000005'      SEARCH ID EQUAL          Y02134 94300002
         DC    X'0800000000000000'      TIC *-8                  Y02134 94400002
         DC    X'0600000000000050'      READ 80 BYTES OF DATA    Y02134 94500002
         SPACE 1                                                 Y02134 94600002
*                                                                       94700002
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       94800002
*                                                                       94900002
         XCTLTABL ID=(SCRATCH1,IGG0290D,SCRATCH2,IGG0290E,       Y02134X95000002
               RENAME1,IGG03001,RENAME2,IGG03002),LENGTH=,       Y02134X95100002
               BRT=YES                                           Y02134 95200002
         SPACE 2                                                 Y02134 95300002
         IECPDSCT                                              @Y30LSTG 95300503
         SPACE 2                                                 Y02134 95301003
         IECDSECS ASCB,BASE,CVT,DSAB,JSCB,PSA,PSCB,SMF,TCB,      Y02134X95400002
               TIOT,UPT,UCB,EXPAND=YES                           YM6554 95500002
*                                                                       95600002
* THIS MACRO DESCRIBES THE COMMUNICATION AREA OF THE I/O SUPERVISOR.    95700002
*                                                                       95800002
         IECDIOCM                                                Y02134 95900002
         EJECT                                                   Y02134 96000002
*                                                                       96100002
* THIS MACRO EXPANDS THE RENAME WORK AREA, WHICH CAN ALSO BE USED       96200002
* TO ADDRESS PORTIONS OF THE SCRATCH WORK AREA.                         96300002
*                                                                       96400002
WORKAREA IECRENWA EP,ADT=YES            RENAME WORK AREA         YM8511 96500002
MSGINDIC EQU   F1DSCB+12                OFFSET TO MSG INDICATOR  Y02134 96600002
SPACEMSG EQU   F1DSCB+26                OFFSET TO LSPACE INFO    Y02134 96700002
         SPACE 1                                                 Y02134 96800002
         ORG   VTOCDSCB                                          Y02134 96900002
VOLLABEL DS    0CL80                    VOLUME LABEL             Y02134 97000002
VOLLABI  DS    CL3                      LABEL IDENTIFIER         Y02134 97100002
VOLNO    DS    CL1                      VOLUME LABEL NUMBER      Y02134 97200002
VOLSERNO DS    CL6                      VOLUME SERIAL NUMBER     Y02134 97300002
VOLSEC   DS    CL1                      VOLUME SECURITY FLAG     Y02134 97400002
VOLVTOC  DS    CL5                      CCHHR OF THE VTOC        Y02134 97500002
         DS    CL5                      RESERVED                 Y02134 97600002
         DS    CL20                     RESERVED                 Y02134 97700002
VOLOWNER DS    CL10                     OWNER NAME AND ADDR CODE Y02134 97800002
         DS    CL29                     RESERVED                 Y02134 97900002
         EJECT                                                          98000037
         IEFJSSOB MO,CONTIG=YES                                @G18MSBS 98050037
DASSOBAD DS    A                                               @G18MSBS 98100037
SSOBSAVE DS    10D                                             @G18MSBS 98150037
SSOBSIZE EQU   *-SSOB                                          @G18MSBS 98200037
         EJECT                                                          98250037
         IEFJESCT                                              @G18MSBS 98300037
         EJECT                                                          98350037
JCTABLE  DSECT                                                 @G18MSBS 98400037
         IEFAJCTB                                              @G18MSBS 98450037
         EJECT                                                          98500037
SCTABLE  DSECT                                                 @G18MSBS 98550037
         IEFASCTB                                              @G18MSBS 98600037
         EJECT                                                          98650037
         END   IGG0290F                                          Y02134 98700037
