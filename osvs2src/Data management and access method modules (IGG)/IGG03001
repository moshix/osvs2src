         TITLE 'IGG03001 - RENAME - LOAD 3 - RENAME DSCB'        A38860 00019021
IGG03001 CSECT                                                          00023021
*          VS2 RELEASE 01 DELETIONS                                     00025400
*0000                                                            YM2930 00025800
*          RELEASE 21 DELETIONS                                         00027021
*0000000200-000280,002600,007600,012600-012800,014780,025800,    A38860 00031002
*0000030862-030942,031800-032000,036400,036600-036800,037200,    A38860 00035002
*0000039200-039500,040160,074800,076400-077000                   A38860 00039002
*0980014992-014994,035640                                        A43188 00048021
*0000031200                                                     SA49351 00058021
*0000026600-027200                                               A52462 00060421
*          RELEASE 21.7 DELETIONS/CHANGES                               00061002
*0000019600-019800,023400                                       SA56390 00061402
*0000000310-000390,002060-002120,012250-012550,031010-031120,   SA53147 00061602
*0000040130                                                     SA53147 00061802
*0000019000,045800                                              SA48172 00062021
*          RELEASE 20 DELETIONS                                         00068000
*3451025000                                                      M0013  00072020
*3451000360-000640,000760-001000,030824-030952                   S20201 00074020
*          RELEASE 19 DELETIONS                                         00083020
*1056013800,035800,079800                                        S19028 00092020
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00101002
*0000000250,000266,001010,001200,003000-003200,004400-005000,    Y02080 00101102
*0000006500-006550,012650-012750,013400,014700-014800,014900,    Y02080 00101202
*0000014940,014990,014992,015044,015055,019200,019600,021850,    Y02080 00101302
*0000023200,024000,024400,024800,026000,026500,028200,030720,    Y02080 00101402
*0000030872,031000,031160,031195-031600,035416,035600-035680,    Y02080 00101502
*0000036200,036400,037000-037200,040000,040150,043200,048400-    Y02080 00101602
*0000048600,052200,054020-054060,054200-076800,078800            Y02080 00101702
*0000010900,020000,021000,076800-083800                          Y02078 00101802
*0000000030-000150,001600-006400,006500-006550,008600,009000,    Y02082 00101902
*0000009400,009800,010200,010640,013770-013840,014830-014840,    Y02082 00102002
*0000014870,014982-015171,015900-016000,021800-021950,023600-    Y02082 00102102
*0000024800,026000-026200,030660-037000,039100,039900,040100,    Y02082 00102202
*0000054010-054300                                               Y02082 00102302
*0000015140                                                      Y02144 00102402
*0000025000                                                      Y02134 00102502
*0000015020,015100,022200,025200,033460,033620,034420,035040     YM1337 00102602
*0000033620                                                      YM2880 00102702
*0000039050,039150                                               YM2887 00102802
*0000023530,023680,024370                                        YM4653 00104902
*                                                                       00107002
*            VS2 RELEASE 808 CHANGES                                    00108037
*C033550,033560                                                @ZA17061 00109037
*                                                              @G60ASBJ 00109160
*            SU60 CHANGES/DELETIONS                            @G60ASBJ 00109260
*                                                              @G60ASBJ 00109360
*A 012819-012822,024806-024824,035640-035650,035670-035680     @G60ASBJ 00109460
*C 024611,024621,024631,024805,024825,033540                   @G60ASBJ 00109560
*D 035660-035680                                               @G60ASBJ 00109660
*                                                              @G60ASBJ 00109760
* STATUS CHANGE LEVEL 008                                               00110021
*                                                                       00111002
*MODULE NAME - IGG03001                                                 00112002
*                                                                       00113002
*DESCRIPTIVE NAME - RENAME - LOAD 3 - RENAME DSCB                       00114002
*                                                                       00115002
*COPYRIGHT - NONE                                                       00116002
*                                                                       00117002
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00118002
*                                                                       00119002
*ATTRIBUTES - REENTRANT                                                 00120002
*                                                                       00140000
*FUNCTION - THIS MODULE READS THE DATA PORTION OF THE FORMAT 1          00145002
*          DSCB TO BE RENAMED.  IF THE ENQ ON THE DATA SET NAME         00150002
*          (ISSUED IN MODULE IGC00030) INDICATED THAT SOMEONE COULD     00155002
*          BE OPEN TO THE DATA SET, THIS MODULE THEN SEARCHES THE       00160002
*          JOB'S DEBS TO ENSURE THAT NO ONE IS CURRENTLY OPEN TO        00165002
*          THE DATA SET.  IF THE DATA SET IS PASSWORD PROTECTED,        00170002
*          CONTROL IS GIVEN TO MODULE SECLOADA.  IF NO ONE IS OPEN      00175002
*          TO THE DATA SET, THIS MODULE THEN WRITES THE DSCB BACK       00180002
*          TO THE VTOC WITH THE NEW NAME IN ITS KEY.                    00185002
*          AFTER THE DSCB HAS BEEN WRITTEN BACK, THE VTOC IS DEQ'ED.    00190002
*          IF THE UNIT WAS DYNAMICALLY ALLOCATED, DYNAMIC ALLOCATION    00195002
*          IS CALLED TO DEALLOCATE THE UNIT.  IF THERE ARE MORE         00200002
*          VOLUMES TO BE PROCESSED, CONTROL IS RETURNED TO IGG03002.    00205002
*          AFTER ALL THE VOLUMES HAVE BEEN PROCESSED, THIS MODULE       00210002
*          TESTS IF A VOLUME WAS ENQ'ED AND MOUNTED BY IGG0300F.        00215002
*          IF YES, CONTROL IS GIVEN TO IGG0300F TO DEMOUNT AND DEQ      00220002
*          THE VOLUME.  IF RENAME ENQ'ED ON THE DATA SET NAME OR        00225002
*          THE TIOT, CORRESPONDING DEQ'S ARE ISSUED.  IF DATA SET       00230002
*          RECORDING FOR SMF IS REQUIRED, THIS MODULE BUILDS AN         00235002
*          SMF RECORD TYPE 18.  IT THEN FREES THE WORK AREA AND         00240002
*          RETURNS TO THE CALLER.                                       00245002
*          RENAMES PROFILES OF RAC DEFINED DATASETS.           @Z40RSGD 00245437
*          RENAME OF MULTIVOLUME RAC DEFINED DATA SETS IS NOT  @Z40RSGD 00247037
*          ALLOWED.                                            @Z40RSGD 00247437
*                                                                       00250002
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG03001.  ENTRY      00255002
*          IS MADE FROM THE SECOND LOAD OF RENAME (IGG03002), FROM      00260002
*          SECLOADA, OR FROM IGG0300F.                                  00265002
*                                                                       00270002
*SUPERVISOR CALLS AND EXTERNAL ROUTINES IN THIS MODULE -                00275002
*          EXCP(0)  - READS FROM OR WRITES TO A DIRECT ACCESS DEVICE    00280002
*          WAIT(1)  - WAITS ON AN EVENT CONTROL BLOCK                   00285002
*          TIME(11) - OBTAINS THE CURRENT TIME AND DATE                 00290002
*          DEQ(48)  - DEQ'S FROM SYSVTOC, SYSZTIOT, AND/OR SYSDSN       00295002
*          RESERVE  - ENQ'S ON THE VTOC (SVC 56)                        00300002
*          SMFWTM   - WRITES AN SMF RECORD (SVC 83)                     00305002
*          DYNALLOC - DYNAMICALLY DEALLOCATES THE UNIT (SVC 99)         00310002
*          SETLOCK  - OBTAINS/RELEASES THE LOCAL MEMORY LOCK            00315002
*          MODESET  - SWITCHES TO THE CALLER'S KEY                      00320002
*          IECRES   - LOADS/BRANCHES TO ANOTHER MODULE                  00325002
*                   - OBTAINS/FREES WORK AREA(S)                        00330002
*                                                                       00335002
*OTHER MACROS ISSUED -                                                  00340002
*          IECDSECS - EXPANDS THE CVT, DSAB, IEZDEB, JMR, JSCB,         00345002
*                     PSA, QDB, RB, RRPL, SMF, SMFTCT, TCB, TIOT,       00348002
*                     AND UCB DSECTS                                    00350002
*          IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCB'S             00355002
*          IECRENWA - EXPANDS THE RENAME WORK AREA                      00360002
*          IEFZB4D0 - EXPANDS THE DYNAMIC ALLOCATION REQUEST BLOCK      00365002
*          IEFZB4D2 - EXPANDS THE DYNAMIC ALLOCATION TEST UNIT KEYS     00370002
*          IFASMFR  - BUILDS AN SMF RECORD TYPE 18                      00375002
*          XCTLTABL - BUILDS A LIST OF MODULE NAMES AND ADDRESSES       00380002
*                                                                       00385002
*INPUT -   AT ENTRY TO THIS MODULE REGISTER 13 POINTS TO THE WORK       00390002
*          AREA.  REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE         00395002
*          VOLUME LIST.  REGISTER 10 POINTS TO THE PARAMETER LIST.      00400002
*          IF REENTRY FROM SECLOADA, REGISTER 10 CONTAINS ONE OF        00405002
*          THE FOLLOWING RETURN CODES:                                  00410002
*          X'00000000' - SUCCESSFUL PASSWORD CHECKING                   00415002
*          X'01000000' - UNSUCCESSFUL PASSWORD CHECKING                 00420002
*          X'02000000' - I/O ERROR OR NO PASSWORD DATA SET ON SYSRES    00425002
*                                                                       00430002
*OUTPUT -  THE RENAMED FORMAT 1 DSCB IS WRITTEN TO THE VTOC.            00435002
*          THE FOLLOWING INFORMATION IS PASSED TO MODULE IGG03002:      00440002
*          REGISTER 10 POINTS TO THE PARAMETER LIST, AND REGISTER       00445002
*          13 POINTS TO THE WORK AREA, IN WHICH 'VOLNUM' CONTAINS       00450002
*          THE NUMBER OF VOLUME LIST ENTRIES REMAINING TO BE RENAMED,   00455002
*          AND 'VOLPTR' CONTAINS THE ADDRESS OF THE NEXT ENTRY.         00460002
*          THE FOLLOWING INFORMATION IS PASSED TO SECLOADA:             00465002
*          REGISTER 1 CONTAINS THE DSAB ADDRESS.                        00470002
*          REGISTER 4 POINTS TO THE DATA PORTION OF THE FORMAT 1 DSCB.  00475002
*          REGISTER 5 POINTS TO THE IOB.                                00480002
*          REGISTER 10 CONTAINS THE VALUE X'02000000'.                  00485002
*          REGISTER 11 POINTS TO THE DATA SET NAME.                     00490002
*          REGISTER 13 POINTS TO THE EXTENDED PREFIX OF THE WORK AREA.  00495002
*          THE FOLLOWING INFORMATION IS PASSED TO IGG0300F:             00500002
*          REGISTER 2 POINTS TO THE DEB.                                00505002
*          REGISTER 3 POINTS TO THE VOLUME SERIAL NUMBER.               00510002
*          REGISTER 4 CONTAINS THE CHARACTERS '3001'.                   00515002
*          REGISTER 8 POINTS TO THE CURRENT VOLUME LIST ENTRY.          00520002
*          REGISTER 11 CONTAINS THE PRIMARY (DEMOUNTABLE) UCB ADDRESS.  00525002
*                                                                       00645021
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    00650002
*          WORK AREA = 676 BYTES                                        00655002
*                                                                       00660000
*ERROR CONDITIONS - OLD NAME DSCB NOT FOUND IN VTOC                     00680000
*                   NEW NAME DSCB ALREADY EXISTS IN VTOC                00700000
*                   IMPROPER PASSWORD PRESENTED                         00720000
*                   PERMANENT I/O ERROR                                 00740000
*                   DATA SET IS OPEN                                    00760002
*                   RENAME OF RAC DEFINED MULTI-VOLUME DATA    @Z40RSGD 00770037
*                                                                       00780000
*REGISTER USAGE                                                         00800000
R0       EQU   0                                                        00820000
R1       EQU   1                                                        00840000
RPARM    EQU   2                        PARAMETER LIST POINTER   Y02082 00868002
R2       EQU   2                                                        00880000
RDSAB    EQU   2                        POINTER TO THE DSAB      Y02082 00890002
RWRK     EQU   3                        WORK REGISTER            Y02082 00900002
RTIOT    EQU   3                        POINTER TO THE TIOT      Y02082 00910002
R3       EQU   3                                                        00920000
VOLCTR   EQU   5                        NUMBER OF VOLUMES        Y02082 00930002
R4       EQU   4                                                        00960000
RTEXT    EQU   4                        POINTER TO TEXT UNIT     Y02082 00970002
R5       EQU   5                                                        01000000
R6       EQU   6                                                        01040000
R7       EQU   7                                                        01060000
VOLISTX  EQU   8                                                        01080000
RERRSAVE EQU   8                        ERROR CODE REGISTER      Y02080 01090002
RCVT     EQU   9                                                        01100000
R9       EQU   9                                                        01110013
PL       EQU   10                                                       01120000
RA       EQU   10                                                S19028 01130019
R11      EQU   11                                                       01140000
RUCB     EQU   11                                                       01150013
RBASE    EQU   12                                                       01160000
RWKAREA  EQU   13                                                       01180000
RETURN   EQU   14                                                       01200000
WORKREG  EQU   15                                                       01220000
*                                                                       01221021
* OTHER EQUATES                                                         01222021
*                                                                       01223021
K0       EQU   0                        CONSTANT OF ZERO         Y02082 01223202
K1       EQU   1                        CONSTANT OF 1            Y02078 01223402
K2       EQU   2                        CONSTANT OF 2            Y02082 01223602
K3       EQU   3                        CONSTANT OF 3            Y02082 01223802
K4       EQU   4                        CONSTANT OF 4            Y02078 01224002
K6       EQU   6                        CONSTANT OF 6            Y02078 01224202
K8       EQU   8                        CONSTANT OF 8            Y02082 01224402
K12      EQU   12                       CONSTANT OF 12           Y02080 01224602
FW       EQU   4                        LENGTH OF A FULLWORD     Y02082 01224802
X00      EQU   X'00'                    ONE BYTE OF BINARY ZEROS Y02080 01225002
DOSBIT   EQU   X'80'                    DOS BIT IN DS4VTOCI      Y02078 01225202
DIRFBIT  EQU   X'04'                    DIRF BIT IN DS4VTOCI     Y02078 01225402
RTNCODE8 EQU   8                        RETURN CODE OF 8         Y02082 01225802
F1       EQU   C'1'                     FORMAT 1 DSCB ID         Y02080 01226002
PSWDDS   EQU   X'10'                    PASSWORD-PROTECTED D/S   Y02080 01226202
SMFREC18 EQU   18                       SMF RECORD TYPE 18       Y02082 01226402
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02082 01226602
VOLSER   EQU   4                        OFFSET TO THE VOL SER IN Y02082 01226802
*                                       A VOLUME LIST ENTRY      Y02082 01227002
STATUS   EQU   11                       DISP. TO VOLIST STATUS   Y02078 01227202
ENTRYL   EQU   12                       VOL LIST ENTRY LENGTH    Y02082 01227402
NOF1     EQU   X'01'                    F1 DSCB NOT FOUND ERROR  Y02078 01227802
PSWDERR  EQU   X'02'                    PASSWORD ERROR           Y02082 01228002
DUPNAME  EQU   X'03'                    DUPLICATE NAME ERROR     Y02078 01228202
IOERR    EQU   X'04'                    I/O ERROR CODE           Y02078 01228402
OPENDS   EQU   X'07'                    OPEN DATA SET ERROR      Y02082 01228602
CSWAD    EQU   8                        CSW OFFSET IN IOB       SA56390 01229002
ALLBITS  EQU   X'FF'                    MASK OF ALL ONES         Y02082 01230002
BLANK    EQU   C' '                     EBCDIC BLANK             YM2880 01230202
DEBDADEV EQU   X'04'                    DEB EXTENT SCALE FOR DA  Y02082 01231002
DS1EXTUL EQU   X'40'                    USER LABEL BIT IN EXTENT Y02082 01232002
SKIP     EQU   X'10'                    CCW SKIP FLAG           SA48172 01279021
SLI      EQU   X'20'                    CCW SUPPRESS LENGTH     SA48172 01281021
*                                       INDICATOR               SA48172 01281660
RACPASS  EQU   X'40'                    BYPASS RACDEF CAMLST   @G60ASBJ 01281960
*                                       BIT                    @G60ASBJ 01282260
DS1RACDF EQU   X'40'                    DS1DSIND-DATA SET IS   @Z40RSGD 01283137
*                                       RAC DEFINED            @Z40RSGD 01283437
RACERROR EQU   X'08'                    ERROR CODE RENAME NOT  @Z40RSGD 01283837
*                                       ALLOWED                @Z40RSGD 01284237
*                                                                       01285021
         BALR  RBASE,R0                                                 01300000
         USING BEGIN,RBASE                                              01320000
         USING RENAMWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 01340002
         USING CVT,RCVT                                                 01360000
         USING UCB,RUCB                                                 01370013
*                                                                       01371002
BEGIN    EQU   *                        START HERE               Y02134 01373002
         TM    SISW2,DEMNTSW            TEST IF ENTERED FROM     Y02134 01375002
*                                       IGG0300F AFTER DEMOUNT   Y02134 01377002
         BO    RETURNPT                 BRANCH IF YES            Y02134 01379002
         CLI   STATUS(VOLISTX),X00      TEST IF ERROR ENTRY FROM Y02082 01381002
*                                       IGG03002                 Y02082 01383002
         BNE   TSTALLOC                 BRANCH IF YES            Y02082 01385002
         LTR   PL,PL                    TEST FOR PASSWORD        S19028 01391019
         BZ    PSWDOKAY                 BR IF RETURN WITH PROPER PSWD   01400000
         ST    PL,FIELD1                                                01420000
         TM    FIELD1,X'03'             WAS THIS AN ERROR RETURN PSWD   01440000
         BM    PSWDEXIT                 BR IF PSWD PROBLEM TO EXIT      01460000
*                                                                       01462013
* IF THIS SECTION IS ENTERED ENTRY WAS MADE FROM THE SECOND LOAD        01464013
*                                                                       01466013
         L     WORKREG,CVTPCNVT         LOAD CONVT ROUTINE ADDRESS      01468013
NOSUBUCB L     R0,SRTEFSCT              LOAD TTRO FROM UCB              01482013
         LA    R1,WKADEB                LOAD DEB ADDRESS         Y02082 01484002
         LA    R2,SEEK                  PUT MBBCCHHR IN SEEK FIELD      01486013
         LR    R3,RWKAREA               SAVE WORK AREA POINTER          01488013
         STM   R9,RWKAREA,IECREGSV+K12  SAVE VOLATILE REGS       Y02080 01490002
         BALR  RETURN,WORKREG           CONVERT TTRO TO MBBCCHHR        01492013
         LM    R9,RWKAREA,IECREGSV+K12-RENAMWKA(R3)  RESTORE     Y02080 01494002
         MVC   VTOCADR(5),SEEK+3        STORE VTOC ADDRESS              01496013
         MVC   INCCHHR(5),VTOCADR       SET UP SEARCH I.D. ADDRESS      01498013
         MVC   MJNAME(L'VTOCNAME),VTOCNAME  MAJOR RESOURCE NAME  Y02082 01500002
         MVI   ENQAREA,X'FF'            SET LAST ENTRY INDICATOR Y02082 01504002
         SR    R1,R1                    ZERO REGISTER            Y02082 01506002
         STH   R1,ENQAREA+K2            CLEAR FOR RESERVE MACRO  Y02082 01508002
         RESERVE (MJNAME,PVOLSER,E,6,SYSTEMS),                   YM3022X01510002
               MF=(E,ENQAREA),UCB=WKADEB+32  ISSUE ENQ ON VTOC   Y02082 01511002
*                                                                       01512002
         OI    DSMADTB2,DSMVTOCR        SET VTOC ENQ'ED BIT      Y02144 01512502
         L     R1,IECRRPRM              RECOVERY RTN LIST ADDR   Y02144 01513002
         USING RRPLIST,R1               PARM LIST ADDRESSABILITY Y02144 01513502
         ST    RUCB,RRUCBPTR            SAVE THE UCB ADDRESS     Y02144 01514002
         DROP  R1                                                Y02144 01514502
*                                                                       01515002
* THIS SECTION RELOCATES THE CHANNEL PROGRAM.                           01515502
*                                                                       01516002
         LM    R0,R7,CHANPROG           LOAD CCW1 TO CCW4 CONSTANTS     01518002
         AR    R0,RWKAREA              RESOLVE ADDR IN CCW1             01520000
         AR    R2,RWKAREA              RESOLVE ADDR IN CCW2             01540000
         AR    R4,RWKAREA              RESOLVE ADDR IN CCW3             01560000
         AR    R6,RWKAREA              RESOLVE ADDR IN CCW4             01580000
         STM   R0,R7,CCW1               STORE CCW1 - CCW4        Y02082 01588002
         LA    WORKREG,CCW9-CCW1                                        01620000
         AR    R2,WORKREG              RESOLVE ADDR IN CCW5             01640000
         STM   R2,R3,CCW5              STORE CCW5                       01660000
         LA    WORKREG,CCW11-CCW9                                       01680000
         AR    R2,WORKREG              RESOLVE ADDR IN CCW8             01700000
         STM   R2,R3,CCW8              STORE CCW8                       01720000
         LM    R0,R7,CHANPROG+32       LOAD CCW9 TO CCW12 CONSTANTS     01740000
         L     WORKREG,8(0,PL)         LOAD ADDR OF NEW DATA SET NAME   01760000
         AR    R0,WORKREG              RESOLVE ADDR IN CCW9             01780000
         AR    R2,RWKAREA              RESOLVE ADDR IN CCW10            01800000
         AR    R4,RWKAREA              RESOLVE ADDR IN CCW11            01820000
         AR    R6,RWKAREA              RESOLVE ADDR IN CCW12            01840000
         STM   R0,R7,CCW9              STORE CCW9 TO CCW12              01860000
         STM   R0,R1,CCW6              STORE CCW6                       01880000
         STM   R4,R5,CCW7              STORE CCW7               SA48172 01900021
         MVI   CCW7+4,SLI+SKIP         SET SLI, SKIP BITS       SA48172 01912021
         MVI   DS1FMTID,X00            ZERO FORMAT ID            Y02080 01920002
*                                                                       01925021
* THIS SECTION SEARCHES FOR A DUPLICATE NAME DSCB.                      01930021
*                                                                       01935021
EXECUTE1 BAL   RETURN,EXECIO           SEARCH FOR DUPLICATE NAME DSCB   01940000
         L     R2,IOB+CSWAD            GET CCW COMMAND ADDRESS  SA56390 01945002
         LA    R2,0(R2)                CLEAR HIGH BYTE          SA56390 01950002
         LA    R3,CCW8                 GET CCW8 ADDRESS         SA56390 01955002
         CLR   R2,R3                   DOES CSW POINT TO CCW8   SA56390 01960002
         BE    NODSNAME                BRANCH IF YES            SA56390 01965002
         CLI   DS1FMTID,F1             TEST FOR DUP NAME DSCB   SA56390 01970002
         BE    SAMENAME                YES, DUP NAME ERROR      SA56390 01975002
         B     PERMERR                 BAD VTOC - I/O ERR CODE  SA56390 01980002
NODSNAME EQU   *                                                SA56390 01985002
         TM    DS4VTOCI,DOSBIT+DIRFBIT  TEST IF DOS OR DIRF SET  Y02078 02000002
         BZ    NAMEOKAY                BR IF NOT                        02020000
         TM    ERCODE,X'80'            TEST FOR SECOND PASS             02040000
         BO    NAMEOKAY                BR IF YES                        02060000
         OI    ERCODE,X'80'            TURN ON FIRST PASS INDICATOR     02080000
         CLC   DS4HPCHR(K4),DS4VTOCE+K6  TEST IF CCHH OF 'HIGH   Y02078 02082002
*                                       WATER' MARK IS THE LAST  Y02078 02084002
*                                       TRACK IN THE VTOC        Y02078 02086002
         BNE   NEWHIGH                  BRANCH IF NOT            Y02078 02088002
         CLC   DS4HPCHR+K4(K1),DS4DEVDT  TEST IF R OF THE 'HIGH  Y02078 02090002
*                                       WATER' MARK IS THE LAST  Y02078 02092002
*                                       RECORD ON THE TRACK      Y02078 02094002
         BE    NAMEOKAY                 BRANCH IF YES            Y02078 02096002
NEWHIGH  EQU   *                       NEW CCHHR                 Y02078 02098002
         MVC   DS4HPCHR(K4),DS4VTOCE+K6  MOVE IN NEW CCHH        Y02078 02100002
         MVC   DS4HPCHR+4(1),DS4DEVDT  PICK UP NEW R                    02120000
         MVI   CCW3+4,X'50'            STORE NEW CCW3                   02140000
         B     EXECUTE1                                                 02160000
*                                                                       02170002
* THIS SECTION READS THE DATA PORTION OF THE OLD DSCB.                  02180002
*                                                                       02190002
NAMEOKAY L     R0,CHANPROG+32          LOAD CCW9                        02200000
         LA    WORKREG,PDSNAME         LOAD ADDR OF OLD DSNAME   YM1337 02220002
         AR    R0,WORKREG              RESOLVE ADDR IN CCW9             02240000
         ST    R0,CCW9                 STORE CCW9                       02260000
         ST    R0,CCW6                 STORE CCW6                       02280000
EXECUTE2 BAL   RETURN,EXECIO           SEARCH FOR AND READ OLD DSCB     02300000
         L     R2,IOB+CSWAD            GET CCW COMMAND ADDRESS  SA56390 02302002
         LA    R2,0(R2)                CLEAR HIGH BYTE          SA56390 02304002
         LA    R3,CCW8                 GET CCW8 ADDRESS         SA56390 02306002
         CLR   R2,R3                   DOES CSW POINT TO CCW8   SA56390 02308002
         BE    NODSCB                  YES, NO DSCB FOUND       SA56390 02310002
         CLI   DS1FMTID,F1             TEST FOR F1 DSCB IN CORE  Y02080 02320002
         BNE   PERMERR                 BAD VTOC - I/O ERR CODE  SA56390 02340002
         MVI   ERCODE,X00              RESET 1ST PASS INDICATOR  Y02082 02341002
*                                                                       02342002
* THIS SECTION SEARCHES THE JOB'S DEBS IF NECESSARY IN ORDER TO         02343002
* ENSURE THAT NO ONE IS OPEN TO THE DATA SET BEING RENAMED.             02344002
*                                                                       02345002
F1FOUND  EQU   *                        F1 DSCB FOUND            Y02082 02346002
         TM    SISW1,DEBSRCH            IS A DEB SEARCH NEEDED   Y02082 02347002
         BZ    PSWDCHK                  BRANCH IF NOT            Y02082 02348002
         L     R1,TCBADDR               CURRENT TCB ADDRESS      Y02082 02349002
         USING TCB,R1                                            Y02082 02350002
         L     R1,TCBJSCB               JSCB ADDRESS             Y02082 02351002
         USING IEZJSCB,R1                                        Y02082 02352002
         STM   R11,RETURN,IECREGSV+K12  SAVE SETLOCK REGISTERS   Y02082 02354002
         LR    R2,RWKAREA               SAVE WORKAREA BASE       Y02082 02355002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,  PREVENT DEBCHK  Y02082*02356002
               RELATED=(DEBTBL,IGG03001(FREELOCK))               Y02082 02357002
         LR    RWKAREA,R2               RESTORE WORKAREA BASE    Y02082 02358002
         LM    R11,RETURN,IECREGSV+K12  RESTORE SETLOCK REGS     Y02082 02359002
*                                                                       02359502
         L     R1,JSCBDBTB              ADDR OF DEB TABLE        Y02082 02360002
         LTR   R1,R1                    IS ADDR ZERO             Y02082 02361002
         BZ    NOPENDS                  BRANCH IF YES            Y02082 02362002
         LH    R2,K0(,R1)               LAST ENTRY OFFSET        Y02082 02363002
         AR    R2,R1                    ADDRESS OF LAST ENTRY    Y02082 02364002
NXTDEB   EQU   *                        NEXT DEB                 Y02082 02365002
         LA    R1,K4(,R1)               POINT TO NEXT ENTRY      Y02082 02366002
         CR    R1,R2                    END OF DEB TABLE         Y02082 02367002
         BE    NOPENDS                  BRANCH IF YES            YM4653 02368002
         OC    K0(K4,R1),K0(R1)         EMPTY ENTRY              Y02082 02369002
         BZ    NOPENDS                  BRANCH IF YES            Y02082 02370002
         TM    K3(R1),ALLBITS           DELETED ENTRY            Y02082 02371002
         BO    NXTDEB                   BRANCH IF YES            Y02082 02372002
*                                       R1 POINTS TO A FULLWORD  Y02082 02373002
*                                       CONTAINING A DEB POINTER Y02082 02374002
         L     R3,K0(,R1)               LOAD DEB ADDRESS         Y02082 02375002
         USING DEBBASIC,R3                                       Y02082 02376002
         LA    R4,DEBBASIC-DEBAMTYP     OFFSET BACK TO DEBAMTYP  Y02082 02377002
         LCR   R4,R4                    MAKE OFFSET NEGATIVE     Y02082 02378002
         AR    R4,R3                    R4 POINTS TO DEBAMTYP    Y02082 02379002
         USING DEBAMTYP,R4                                       Y02082 02380002
         CLI   DEBAMTYP,K0              AMTYP ABSENT             Y02082 02381002
         BE    AMVALID                  BRANCH IF YES--VALID     Y02082 02382002
         CLC   DEBAMTYP,AMBPAM          BPAM DEB                 Y02082 02383002
         BE    AMVALID                  BRANCH IF YES--VALID     Y02082 02384002
         CLC   DEBAMTYP,AMBDAM          BDAM DEB                 Y02082 02385002
         BE    AMVALID                  BRANCH IF YES            Y02082 02386002
         CLC   DEBAMTYP,AMSAM           SAM DEB                  Y02082 02387002
         BE    AMVALID                  BRANCH IF YES            Y02082 02388002
         CLC   DEBAMTYP,AMEXCP          EXCP DEB                 Y02082 02389002
         BE    AMVALID                  BRANCH IF YES            Y02082 02390002
         CLC   DEBAMTYP,AMISAM          ISAM DEB                 Y02082 02391002
         BNE   NXTDEB                   BRANCH IF NO-THIS DEB    Y02082 02392002
*                                       NEED NOT BE CHECKED      Y02082 02393002
         CLI   DEBNMEXT,K1              0 OR ONE EXTENT IN ISAM  Y02082 02394002
*                                       DEB                      Y02082 02395002
         BNH   NXTDEB                   INVALID ISAM DEB         Y02082 02396002
         DROP  R4                                                Y02082 02397002
         SR    R4,R4                    ZERO FOR IC              Y02082 02398002
         IC    R4,DEBNMEXT              INSERT NUMBER OF EXTENTS Y02082 02399002
         BCTR  R4,K0                    REDUCE BY ONE            Y02082 02400002
         LA    R3,DEBNMTRK-DEBUCBAD+L'DEBNMTRK(,R3)  SKIP FIRST  Y02082 02401002
*                                       EXTENT FOR ISAM          Y02082 02402002
         B     CHKEXTNT                 GO TO CHECK EACH EXTENT  Y02082 02403002
AMVALID  EQU   *                        VALID AM TYPE            Y02082 02404002
         CLI   DEBNMEXT,K0              ARE THERE ANY EXTENTS    Y02082 02405002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 02406002
         CLI   DEBEXSCL,DEBDADEV        IS EXTENT SCALE 4 FOR DA Y02082 02407002
         BNE   NXTDEB                   BRANCH IF NO             Y02082 02408002
         L     R4,DEBSUCBA              GET UCB ADDRESS          Y02082 02409002
         USING UCBOB,R4                                          Y02082 02410002
         LA    R4,K0(,R4)               CLEAR HIGH BYTE          Y02082 02411002
         LTR   R4,R4                    IS THERE A UCB           Y02082 02412002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 02413002
         TM    UCBTBYT3,UCB3DACC        IS IT DIRECT ACCESS      Y02082 02414002
         BZ    NXTDEB                   BRANCH IF NO             Y02082 02415002
         DROP  R4                                                Y02082 02416002
         SR    R4,R4                    ZERO FOR IC              Y02082 02417002
         IC    R4,DEBNMEXT              NUMBER OF EXTENTS        Y02082 02418002
CHKEXTNT EQU   *                        CHECK EXTENT             Y02082 02419002
         LA    R3,DEBBASND              INCREMENT PAST BASIC     Y02082 02420002
*                                       SECTION OF DEB           Y02082 02421002
         USING DEBDASD,R3                                        Y02082 02422002
CMPREXTS EQU   *                        CHECK CCHH               Y02082 02423002
         CLC   DEBUCBA,WKADEB+UCBADDR+K1  TEST IF SAME UCB       YM4653 02423402
         BNE   NEXTXTNT                 BRANCH IF NOT            YM4653 02423802
         TM    DS1EXT1,DS1EXTUL         IS FIRST EXTENT USER LBL Y02082 02424002
         BZ    NOTUL                    BRANCH IF NOT            Y02082 02425002
         CLC   DEBSTRCC(L'DEBSTRCC+L'DEBSTRHH),DS1EXT2+K2 IS THE Y02082 02426002
*                                       DEB'S STARTING CCHH      Y02082 02427002
*                                       EQUAL TO THE DSCBS       Y02082 02428002
         BE    NORENAME                 BRANCH IF YES            Y02082 02429002
         B     NEXTXTNT                 GET NEXT EXTENT          Y02082 02430002
NOTUL    EQU   *                        NOT USER LBL EXTENT      Y02082 02431002
         CLC   DEBSTRCC(L'DEBSTRCC+L'DEBSTRHH),DS1EXT1+K2  IS    Y02082 02432002
*                                       THE DEB'S STARTING CCHH  Y02082 02433002
*                                       EQUAL TO THE DSCB'S      Y02082 02434002
         BE    NORENAME                 BRANCH IF YES            Y02082 02435002
NEXTXTNT EQU   *                        NEXT EXTENT              Y02082 02436002
         LA    R3,DEBNMTRK+L'DEBNMTRK   INCREMENT TO NEXT EXTENT YM4653 02437002
         BCT   R4,CMPREXTS              TRY NEXT EXTENT          Y02082 02438002
         B     NXTDEB                   NO MORE EXTENTS          Y02082 02439002
NORENAME EQU   *                        OPEN DATA SET ERROR      Y02082 02440002
         LA    R3,OPENERR               SET UP BRANCH ADDRESS AS Y02082 02441002
*                                       THE DATA SET IS OPEN AND Y02082 02442002
*                                       CANNOT BE RENAMED        Y02082 02443002
         B     FREELOCK                 FREE THE LOCAL LOCK      Y02082 02444002
NOPENDS  EQU   *                        GET BRANCH ADDR          Y02082 02445002
         LA    R3,PSWDCHK               SET UP BRANCH ADDRESS    Y02082 02446002
*                                                                       02446502
FREELOCK EQU   *                        RELEASE LOCAL LOCK       Y02082 02447002
         LR    R1,RWKAREA               SAVE WORKAREA BASE       Y02082 02448002
         STM   R11,RETURN,IECREGSV+K12  SAVE SETLOCK REGISTERS   Y02082 02449002
         SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       Y02082*02450002
               RELATED=(DEBTBL,IGG03001(GETLOCK))                Y02082 02451002
         LR    RWKAREA,R1               RESTORE WORKAREA BASE    Y02082 02452002
         LM    R11,RETURN,IECREGSV+K12  RESTORE SETLOCK REGS     Y02082 02453002
         BR    R3                       RETURN                   Y02082 02454002
*                                                                       02455002
* SECLOADA IS GIVEN CONTROL IF THE DATA SET IS PASSWORD PROTECTED.      02456002
*                                                                       02457002
PSWDCHK  EQU   *                        PASSWORD CHECK           Y02082 02458002
         TM    DS1DSIND,DS1RACDF+PSWDDS IS DATA SET RAC        @Z40RSGD 02459037
*                                       DEFINED OR PASSWORD    @Z40RSGD 02459437
*                                       PROTECTED              @Z40RSGD 02459837
         BZ    SKIPPSWD                 BRANCH IF NOT            Y02082 02460002
         TM    DS1DSIND,DS1RACDF        RAC DEFINED            @Z40RSGD 02460437
         BZ    CHECKPSW                 NO- PASSWORD           @Z40RSGD 02460837
* BYPASS RACHECK IF JCSBPASS = SET                             @Z40RSGD 02460937
         L     WORKREG,TCBADDR         TCB ADDRESSABILITY      @Z40RSGD 02461037
         L     RWRK,TCBJSCB-TCB(WORKREG) JSCB ADDR             @G60ASBJ 02461160
         USING IEZJSCB,RWRK                                    @G60ASBJ 02462160
         L     RWRK,JSCBACT            JSCB ACTIVE             @G60ASBJ 02463160
         TM    JSCBSWT1,JSCBPASS       SKIP RACHECK            @Z40RSGD 02468760
         BO    NORACHK                 YES                     @Z40RSGD 02469760
*   CHECK AUTHORIZATION TO RENAME.                             @Z40RSGD 02470737
         MVC   RACHECK(LRACHECK),MRACHECK SET UP PARM LIST     @Z40RSGD 02471137
         RACHECK ENTITY=PDSNAME,        DATASET NAME           @Z40RSGDX02471237
               VOLSER=PVOLSER,          VOLUME SERIAL NUMBER   @Z40RSGDX02471637
               MF=(E,RACHECK)                                  @Z40RSGD 02472037
         LTR   WORKREG,WORKREG          IS HE AUTHORIZED       @Z40RSGD 02472437
         BNZ   RACERR                   NO - REJECT RENAME     @Z40RSGD 02472537
NORACHK  EQU   *                       RENAME PROFILE          @Z40RSGD 02472637
*   RENAME RAC PROFILE                                         @Z40RSGD 02472737
         MVC   RACDEF(LRACDEF),MRACDEF SET UP PARM LIST        @Z40RSGD 02478537
         L     PL,OLDPLPTR              POINTER TO NEWNAME     @G60ASBJ 02480560
************************************************************** @G60ASBJ 02480660
*                                                            * @G60ASBJ 02480760
*  THE RACDEF RENAME WILL BE BYPASSED IF THE FOLLOWING       * @G60ASBJ 02480860
*  CONDITIONS ARE MET:                                       * @G60ASBJ 02480960
*                      (1) THE CALLER IS AUTHORIZED.         * @G60ASBJ 02481060
*                      (2) THE JSCBPASS BIT IS SET TO 1.     * @G60ASBJ 02481160
*                      (3) THE SECOND BIT OF THE SECOND      * @G60ASBJ 02481260
*                          BYTE OF THE RENAME (CAMLST)       * @G60ASBJ 02481360
*                          PARAMETER LIST IS SET TO 1.       * @G60ASBJ 02481460
*                                                            * @G60ASBJ 02481560
************************************************************** @G60ASBJ 02481660
         TM    JSCBSWT1,JSCBPASS        SKIP RACDEF (JFCBPASS) @G60ASBJ 02481760
         BNO   RACDEF1                  NO - ISSUE RACDEF      @G60ASBJ 02481860
         TM    K1(PL),RACPASS           BYPASS RACDEF ?        @G60ASBJ 02481960
         BO    SKIPPSWD                 YES, BYPASS RACDEF     @G60ASBJ 02482060
RACDEF1  DS    0H                       ISSUE RACDEF           @G60ASBJ 02482460
         L     WORKREG,8(PL)            GET VOL SER ADDRESS    @G60ASBJ 02482560
         RACDEF ENTITY=PDSNAME,         DATASET NAME           @Z40RSGDX02482660
               VOLSER=PVOLSER,          VOLUME SERIAL NUMBER   @Z40RSGDX02484537
               NEWNAME=(WORKREG),       NEW DATASET NAME       @Z40RSGDX02486437
               MF=(E,RACDEF)                                   @Z40RSGD 02488437
         LTR   WORKREG,WORKREG          WAS DEFINITION OK      @Z40RSGD 02488837
         BNZ   RACERR                   NO - REJECT RENAME     @Z40RSGD 02489237
         B     SKIPPSWD                 AUTH-BYPASS PASSWORD   @Z40RSGD 02489637
CHECKPSW EQU   *                        CONTINUE PASSWORD      @Z40RSGD 02490337
*                                       CHECKING               @Z40RSGD 02492237
         TM    RTYPEFLG,PSWDCHKD        TEST IF ALREADY CHECKED  Y02082 02496437
         BO    SKIPPSWD                 BRANCH IF NOT 1ST VOLUME Y02082 02502337
         OI    RTYPEFLG,PSWDCHKD        SET PASSWORD CHECKED BIT Y02082 02508237
         LA    R4,DS1FMTID              ADDRESS OF THE F1 DSCB   Y02134 02514137
         LA    R11,PDSNAME              ADDRESS OF DATA SET NAME YM1337 02520002
         L     PL,SECCODE               SET RENAME CODE FOR SECURITY    02540000
         LA    R5,IOB                   IOB ADDRESS                     02560000
         L     R1,DSABADDR              DSAB ADDR IN REGISTER 1  Y02082 02580002
         LA    R7,SECLOAD               POINT TO SECLOADA        Y02082 02600002
         SR    RETURN,RETURN            SET ENTRY OFFSET         Y02134 02610002
         B     LOADEXIT                 GO BRANCH TO SECLOADA    Y02082 02620002
*                                                                       02625021
* THIS SECTION WRITES THE NEW DSCB OVER THE OLD ONE.                    02630021
*                                                                       02635021
PSWDOKAY L     PL,OLDPLPTR             RESTORE POINTER                  02640000
SKIPPSWD EQU   *                                                 A52462 02652021
         SR    WORKREG,WORKREG         ZERO OUT REGISTER         A52462 02654021
         IC    WORKREG,NEWCCHHR+4      PICK UP R OF NEXT RECORD  A52462 02660002
         BCT   WORKREG,NOTLAST         BRANCH IF NOT LAST ON     A52462 02720021
*                                      TRACK                     A52462 02730021
         IC    WORKREG,DS4DEVDT        SET R TO LAST DSCB ON THE TRACK  02740000
NOTLAST  STC   WORKREG,NEWCCHHR+4      STORE R OF DSCB READ INTO CORE   02760000
         MVC   SEEK+3(5),NEWCCHHR                                       02780000
         L     WORKREG,8(0,PL)         LOAD ADDR OF NEW DATA SET NAME   02800000
         MVC   DS1DSNAM,0(WORKREG)     MOVE IN NEW NAME          Y02080 02820002
         LA    WORKREG,F1DSCB           POINT TO OUTPUT AREA     Y02080 02825002
         ST    WORKREG,CCW3             WRITE FROM F1DSCB        Y02080 02830002
         MVI   CCW3+7,X'8C'            SET UP CCW3                      02840000
         MVI   CCW3,X'0D'              STORE CCW3                       02860000
         MVC   CCW4(8),CCW1            STORE CCW4                       02880000
         LA    WORKREG,CCW4             SET UP CCW5 FOR TIC             02900000
         ST    WORKREG,CCW5                                             02920000
         MVI   CCW5,X'08'                                               02940000
         XC    CCW5+4(4),CCW5                                           02960000
         MVC   CCW6(8),CHALPROG        STORE CCW6                       02980000
         LA    WORKREG,CCW1             SET STARTING ADDRESS IN IOB     03000000
         ST    WORKREG,IOB+16                                           03020000
         BAL   RETURN,EXECIO           WRITE NEW NAME DSCB OVER OLD     03040000
         NI    SISW1,X'FF'-NOSMFRCD     RESET NO SMF RCD SWITCH  Y02082 03045002
*                                       SINCE AT LEAST ONE       Y02082 03050002
*                                       RENAME IS SUCCESSFUL     Y02082 03055002
         B     FINISH                                                   03060000
*                                                                       03062002
* WHEN A DEB HAS BEEN FOUND OPEN TO THE DATA SET BEING RENAMED,         03064002
* THIS SECTION STORES AN ERROR CODE OF X'07' IN THE CURRENT AND         03066002
* ALL SUBSEQUENT VOLUME LIST ENTRIES. IF A PASSWORD ERROR OCCURS,       03068002
* X'02' IS STORED IN THE CURRENT AND ALL SUBSEQUENT ENTRIES.            03070002
*                                                                       03072002
* FOR OTHER ERROR CONDITIONS, THIS SECTION STORES THE APPROPRIATE       03074002
* ERROR CODE IN THE STATUS BYTE OF THE CURRENT VOLUME LIST ENTRY.       03076002
*                                                                       03078002
OPENERR  EQU   *                        OPEN DATA SET ERROR      Y02082 03080002
         LA    R3,OPENDS                OPEN DATA SET ERROR      Y02082 03082002
         B     SETEXIT                  GO STORE THE ERROR CODE  Y02082 03084002
PSWDEXIT EQU   *                        PASSWORD ERROR           Y02082 03086002
         LA    R3,PSWDERR               PASSWORD ERROR           Y02082 03088002
SETEXIT  EQU   *                        SET EXIT BIT             Y02082 03090002
         OI    RTYPEFLG,EXITBIT         SET EXIT BIT             Y02082 03092002
         LH    VOLCTR,VOLNUM            LOAD NBR OF VOLUMES LEFT Y02082 03094002
         LA    VOLCTR,K1(,VOLCTR)       INCREMENT BY ONE         Y02082 03096002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 03098002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 03100002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 03102002
ERRLOOP  EQU   *                        ERROR LOOP               Y02082 03104002
         STC   R3,STATUS(VOLISTX)       STORE CODE IN VOLIST     Y02082 03106002
         LA    VOLISTX,ENTRYL(VOLISTX)  POINT TO NEXT ENTRY      Y02082 03108002
         BCT   VOLCTR,ERRLOOP           BRANCH IF MORE VOLUMES   Y02082 03110002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 03112002
         LA    WORKREG,ENTRYL           VOL LIST ENTRY LENGTH    Y02082 03114002
         SR    VOLISTX,WORKREG          POINT TO LAST ENTRY      Y02082 03116002
         B     SETCODE                  GO SET CALLER'S ERR CODE Y02082 03118002
         SPACE 2                                               @Z40RSGD 03118137
RACERR   EQU   *                        UNABLE TO RENAME PROF  @Z40RSGD 03118237
         LA    R3,RACERROR              UNAUTHORIZED RENAME    @Z40RSGD 03118437
         B     SETERROR                 BRANCH TO SET ERROR    @Z40RSGD 03119237
*                                                                       03120002
SAMENAME EQU   *                        DUPLICATE NAME           Y02078 03122002
         LA    R3,DUPNAME               DUPLICATE NAME ERROR     Y02078 03124002
         B     SETERROR                 BRANCH TO SET ERROR CODE Y02078 03126002
*                                                                       03128002
NODSCB   EQU   *                        NO F1 DSCB               Y02078 03130002
         LA    R3,NOF1                  NO F1 DSCB ERROR         Y02078 03132002
         B     SETERROR                 BRANCH TO SET ERROR CODE Y02078 03134002
*                                                                       03136002
PERMERR  EQU   *                        I/O ERROR                Y02078 03138002
         LA    R3,IOERR                 I/O ERROR                Y02078 03140002
*                                                                       03142002
SETERROR EQU   *                        SET ERROR CODE           Y02078 03144002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 03146002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 03148002
         STC   R3,STATUS(VOLISTX)       STORE CODE IN VOL LIST   Y02078 03150002
         DROP  R1                                                Y02078 03152002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02078 03154002
SETCODE  EQU   *                        SET ERROR CODE           Y02082 03156002
         LA    WORKREG,RTNCODE8         SET ERROR CODE OF 8      Y02082 03158002
         STH   WORKREG,ERCODE           SAVE CALLER'S ERROR CODE Y02082 03160002
*                                                                       03162002
* THIS SECTION DEQ'S THE VTOC.                                          03164002
*                                                                       03166002
FINISH   EQU   *                        DEQ VTOC                 Y02082 03168002
         MVC   MJNAME(L'VTOCNAME),VTOCNAME  MAJOR RESOURCE NAME  Y02082 03170002
         L     RUCB,WKADEB+UCBADDR      LOAD UCB ADDR FROM DEB   Y02082 03172002
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y02082 03174002
         MVC   MINAME(L'SRTEVOLI),SRTEVOLI  MINOR RESOURCE NAME  Y02082 03176002
         MVI   ENQAREA,X'FF'            SET LAST ENTRY INDICATOR Y02082 03178002
         SR    R1,R1                    ZERO REGISTER                   03180002
         STH   R1,ENQAREA+K2            CLEAR FOR DEQ MACRO      Y02082 03182002
         DEQ   (MJNAME,MINAME,6,SYSTEMS),MF=(E,ENQAREA)          Y02082 03184002
*                                                                       03185002
         NI    DSMADTB2,X'FF'-DSMVTOCR  RESET VTOC ENQ'ED SWITCH Y02144 03186002
*                                                                Y02144 03187002
* IF THE UNIT WAS DYNAMICALLY ALLOCATED, THIS SECTION BUILDS THE        03188002
* REQUEST BLOCK TO INTERFACE WITH DYNAMIC ALLOCATION (SVC 99) TO        03190002
* UNALLOCATE THE UNIT.                                                  03192002
*                                                                       03194002
TSTALLOC EQU   *                        TEST ALLOCATION          Y02082 03196002
         TM    SISW1,UCBALLOC           TEST IF UCB ALLOCATED    Y02082 03198002
*                                       BY DYNAMIC ALLOCATION    Y02082 03200002
         BNO   TESTLAST                 BRANCH IF NOT            Y02082 03202002
         LA    RPARM,VTOCDSCB           PARAMETER LIST BASE      Y02082 03204002
         USING S99RBP,RPARM                                      Y02082 03206002
         LA    RWRK,K4(,RPARM)          INCREMENT BY FOUR        Y02082 03208002
         ST    RWRK,S99RBPTR            SET UP REQUEST BLOCK PTR Y02082 03210002
         OI    S99RBPTR,S99RBPND        TURN ON HIGH ORDER BIT   Y02082 03212002
         LR    RPARM,RWRK               ADDRESS OF REQUEST BLOCK Y02082 03214002
         USING S99RB,RPARM              REQ BLOCK ADDRESSABILITY Y02082 03216002
         XC    S99RB(S99RBEND-S99RB),S99RB  ZERO REQ BLOCK CORE  Y02082 03218002
         MVI   S99RBLN,S99RBEND-S99RB   LENGTH OF REQUEST BLOCK  Y02082 03220002
         MVI   S99VERB,S99VRBUN         INDICATE UNALLOCATION    Y02082 03222002
         LA    RWRK,S99RBEND            ADDR OF TEXT POINTERS    Y02082 03224002
         ST    RWRK,S99TXTPP            PLACE IN REQUEST BLOCK   Y02082 03226002
         OI    S99FLG21,S99TIONQ        INDICATE TIOT ENQ'ED     Y02082 03228002
         LR    RPARM,RWRK               ADDRESS OF TEXT PTRS     Y02082 03230002
         USING S99TUPL,RPARM            TEXT PTRS ADDRESSABILITY Y02082 03232002
         LA    RTEXT,FW(,RPARM)         ADDRESS OF TEXT UNIT     Y02082 03234002
         ST    RTEXT,S99TUPTR           POINTER TO TEXT UNIT     Y02082 03236002
         OI    S99TUPTR,S99TUPLN        INDICATE LAST TEXT PTR   Y02082 03238002
         USING S99TUNIT,RTEXT           TEXT UNIT ADDRESSABILITY Y02082 03240002
         LH    RWRK,DDNAMEKY                                     Y02082 03242002
         STH   RWRK,S99TUKEY            INDICATE DDNAME SPEC     Y02082 03244002
         LA    RWRK,K1                                           Y02082 03246002
         STH   RWRK,S99TUNUM            INDICATE 1 DDNAME ENTRY  Y02082 03248002
         LA    RWRK,L'TIOEDDNM                                   Y02082 03250002
         STH   RWRK,S99TULNG            LENGTH OF TEXT PARM      Y02082 03252002
         L     RDSAB,DSABADDR           GET DSAB ADDRESS         Y02082 03254002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 03256002
         L     RTIOT,DSABTIOT           LOAD TIOT ADDRESS        Y02082 03258002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 03260002
         MVC   S99TUPAR(L'TIOEDDNM),TIOEDDNM  COPY TIOT'S DDNAME Y02082 03262002
         LA    R1,VTOCDSCB              POINT TO REQUEST BLK PTR Y02082 03264002
         DYNALLOC                                                Y02082 03266002
*                                                                       03267002
         NI    SISW1,X'FF'-UCBALLOC     RESET ALLOCATED BIT      Y02082 03268002
         NI    DSMADTB1,X'FF'-DSMUCBAL  RESET UCB ALLOCATED BIT  Y02144 03269002
*                                                                       03270002
* THIS SECTION BRANCHES BACK TO IGG03002 IF THE DATA SET MUST BE        03272002
* RENAMED ON ANOTHER VOLUME.                                            03274002
*                                                                       03276002
TESTLAST EQU   *                        LAST VOL                 Y02082 03278002
         TM    RTYPEFLG,EXITBIT         IS EXIT BIT SET          Y02082 03280002
         BO    DEQTEST1                 BRANCH IF SET            Y02082 03282002
         L     PL,OLDPLPTR              RELOAD PARM LIST ADDR    Y02082 03286002
         LA    R7,LOAD2                 POINT TO IGG03002        Y02082 03288002
*                                                                       03290002
* THIS SECTION LOADS AND/OR BRANCHES TO ANOTHER MODULE.                 03292002
*                                                                       03294002
LOADEXIT EQU   *                        EXIT                     Y02082 03296002
         IECRES LOAD,EXTPR=(RWKAREA),MODNM=(R7),BRANCH=DIRECT    Y02082 03298002
*                                                                       03300002
* IF A VOLUME WAS ENQ'ED AND MOUNTED BY IGG0300F, THIS SECTION          03302002
* BRANCHES TO IGG0300F TO DEMOUNT AND DEQ THE VOLUME.                   03304002
*                                                                       03306002
DEQTEST1 EQU   *                        DEQ VOL TEST             Y02082 03308002
         TM    SISW1,VOLDEQ             TEST IF VOL TO BE DEQ'ED Y02082 03310002
         BNO   DEQTEST2                 BRANCH IF NOT            Y02082 03312002
         OI    SISW2,DEMNTSW            SET DEMOUNT SWITCH       Y02134 03314002
         LA    R2,WKADEB                DEB ADDRESS IN REG 2     Y02134 03316002
         L     RUCB,PRUCBPTR            UCB ADDRESS IN REG 11    Y02134 03318002
         LA    R3,SRTEVOLI              VOLSER ADDR IN REG 3     Y02134 03320002
         L     R4,RETNAME               RETURN MODULE NAME       Y02134 03322002
         LA    R7,MNTLOAD               POINT TO ID OF IGG0300F  Y02134 03324002
         B     LOADEXIT                 GO BRANCH TO IGG0300F    Y02134 03326002
RETURNPT EQU   *                        RETURN HERE              Y02134 03328002
         NI    SISW2,X'FF'-DEMNTSW      RESET DEMOUNT SWITCH     Y02134 03330002
*                                                                       03332002
* IF RENAME ENQ'ED ON THE DSNAME, THIS SECTION ISSUES A DEQ             03334002
* DIRECTED TO THE INITIATOR'S TCB.                                      03336002
*                                                                       03338002
DEQTEST2 EQU   *                        DEQ SYSDSN TEST          Y02082 03340002
         TM    SISW1,DSNENQ             TEST IF ENQ'ED ON SYSDSN Y02082 03342002
         BNO   DEQTEST3                 BRANCH IF NOT            Y02082 03344002
         LA    R4,PDSNAME+L'PDSNAME-K1  LAST BYTE OF DSNAME      YM2880 03344402
TESTDSN  EQU   *                        SEARCH FOR NON-BLANK     YM2880 03344802
         CLI   K0(R4),BLANK             IS THIS ONE A BLANK      YM2880 03345202
         BNE   GETLNGTH                 BRANCH IF NO TO COMPUTE  YM2880X03345602
                                        LENGTH OF NAME FOR DEQ   YM2880 03346002
         BCT   R4,TESTDSN               TRY NEXT BYTE            YM2880 03346402
GETLNGTH EQU   *                        CALCULATE LENGTH         YM2880 03346802
         LA    R2,PDSNAME-K1            BYTE PRECEDING DSNAME    YM2880 03347202
         SR    R4,R2                    R4 HAS LENGTH FOR DEQ    YM2880 03347602
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 03348002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 03350002
         L     R2,TCBJSCB               LOAD JSCB ADDRESS        Y02082 03352002
         DROP  RWRK                                            @G60ASBJ 03354060
         USING IEZJSCB,R2               JSCB ADDRESSABILITY      Y02082 03355037
         L     R2,JSCBACT              GET ACTIVE JSCB ADDRESS @ZA17061 03356037
         L     R2,JSCBTCBP             ADDR OF INITIATOR'S TCB @ZA17061 03357037
         MVC   ENQAREA(DEQLTH1),DEQLIST1  MOVE IN DEQ PARM LIST  Y02082 03358002
         MVC   MJNAME(L'DSNMJR),DSNMJR  MAJOR RESOURCE NAME      Y02082 03360002
         DEQ   (MJNAME,PDSNAME,(R4)),TCB=(R2),MF=(E,ENQAREA)     YM2880X03362002
                                        ISSUE DEQ                YM1337 03363002
         NI    DSMADTB2,X'FF'-DSMDSNE   RESET DSN ENQ'ED SWITCH  Y02144 03364002
*                                                                       03365002
* IF RENAME ENQ'ED ON THE TIOT, THIS SECTION ISSUES A DEQ.              03366002
*                                                                       03368002
DEQTEST3 EQU   *                        DEQ TIOT TEST            Y02082 03370002
         TM    SISW1,TIOTENQ            TEST IF ENQ'ED ON TIOT   Y02082 03372002
         BNO   TESTSMF                  BRANCH IF NOT            Y02082 03374002
         MVC   ENQAREA(DEQLTH2),DEQLIST2  MOVE IN DEQ PARM LIST  Y02082 03376002
         MVC   MJNAME(L'TIOTMJR),TIOTMJR  MAJOR RESOURCE NAME    Y02082 03378002
         DEQ   (MJNAME,TIOTMNR),MF=(E,ENQAREA)  DEQ FROM TIOT    Y02082 03380002
*                                                                       03381002
         NI    DSMADTB2,X'FF'-DSMTIOTE  RESET TIOT ENQ'ED SWITCH Y02144 03382002
*                                                                       03383002
* THIS SECTION DETERMINES IF AN SMF RECORD TYPE 18 MUST BE BUILT.       03384002
*                                                                       03386002
TESTSMF  EQU   *                        IS SMF RECORD NEEDED     Y02082 03388002
         TM    SISW1,NOSMFRCD           TEST IF RENAME TOTALLY   Y02082 03390002
*                                       OR PARTIALLY SUCCESSFUL  Y02082 03392002
         BO    EXIT                     BRANCH IF NOT            Y02082 03394002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02082 03396002
         L     R2,TCBADDR               LOAD TCB ADDRESS         Y02082 03398002
         USING TCB,R2                   TCB ADDRESSABILITY       Y02082 03400002
         L     R2,TCBTCT                LOAD TCT ADDRESS         Y02082 03402002
         LTR   R2,R2                    IS THERE A TCT           Y02082 03404002
         BZ    EXIT                     BRANCH IF NOT            Y02082 03406002
         USING SMFTCT,R2                TCT ADDRESSABILITY       Y02082 03408002
         L     R2,TCTJMR                LOAD JMR ADDRESS         Y02082 03410002
         LTR   R2,R2                    IS THERE A JMR           Y02082 03412002
         BZ    EXIT                     BRANCH IF NOT            Y02082 03414002
         USING JMRJOB,R2                JMR ADDRESSABILITY       Y02082 03416002
         L     RA,CVTSMCA               LOAD SMCA ADDRESS        Y02082 03418002
         LTR   RA,RA                    IS THIS AN SMF SYSTEM    Y02082 03420002
         BZ    EXIT                     BRANCH IF NOT            Y02082 03422002
         USING SMCABASE,RA                                       Y02082 03424002
         TM    SMCAOPT,SMCADSA          IS DS RECORDING REQUIRED Y02082 03426002
         BNO   EXIT                     BRANCH IF NOT            Y02082 03428002
*                                                                       03430002
* THIS SECTION CALCULATES IF ANOTHER WORK AREA MUST BE OBTAINED         03432002
* TO BUILD THE SMF RECORD TYPE 18.                                      03434002
*                                                                       03436002
BUILDSMF EQU   *                        WORK AREA TEST           Y02082 03438002
         L     R6,OLDPLPTR                                       S19028 03440002
         LM    R7,VOLISTX,K8(R6)        GET PARM POINTERS        YM1337 03442002
         LH    VOLCTR,K0(VOLISTX)       GET THE NBR OF VOLUMES   Y02082 03444002
         LA    VOLISTX,K2(VOLISTX)      POINT TO FIRST ENTRY     Y02082 03446002
         LA    R4,WKADEB-SMF18RV2       TEST IF ALL VOLUMES      Y02080 03448002
         SRL   R4,3                     WILL FIT IN WORK AREA    Y02080 03450002
         LA    R3,SMF18HDR              POINT TO SMF RECORD      Y02080 03452002
         CR    R4,VOLCTR                WILL ALL VOLS FIT IN THE Y02082 03454002
*                                       RENAME WORK AREA         Y02082 03456002
         BNL   COREOK                   BRANCH IF YES            S19028 03458002
         LR    R4,VOLCTR                CALCULATE CORE NEEDED    Y02082 03460002
         SLL   R4,3                     8 BYTES PER VOLIST ENTRY Y02082 03462002
         LA    R4,SMF18RV2-SMF18HDR(R4)  SET UP TO GET CORE      S19028 03464002
         IECRES GET,EXTPR=(RWKAREA),ID=REWA,LV=(R4),             Y02080X03466002
               STM=(R2,RETURN,IECREGSV+K12)                      Y02080 03468002
         LR    R3,R1                    GET SMF RECORD ADDRESS   Y02080 03470002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO AFTER Y02082X03471002
                                        ISSUING THE IECRES GET   Y02082 03472002
         USING SMF18HDR,R3              ADDRESSABILITY           Y02080 03473002
*                                                                       03474002
* THIS SECTION BUILDS THE TYPE 18 SMF RECORD.                           03476002
*                                                                       03478002
COREOK   EQU   *                                                 A38860 03480002
         XC    SMF18HDR(6),SMF18HDR     ZERO RECORD HEADER       A38860 03482002
         MVI   SMF18RTY,SMFREC18        SET RECORD TYPE          A38860 03484002
         TIME  BIN                                               S19028 03486002
         STM   R0,R1,SMF18TME+2         TIME OF RECORD           S19028 03488002
         MVC   SMF18TME(8),SMF18TME+2                            S19028 03490002
         MVC   SMF18SID(4),SMCASID                               S19028 03492002
         DROP  RA                                                S19028 03494002
         MVC   SMF18JBN(SMF18UID-SMF18JBN),JMRJOB  JOB NAME      Y02082 03496002
         MVC   SMF18UID,JMRUSEID        USER ID FIELD            Y02082 03498002
         DROP  R2                                                Y02082 03500002
         XC    SMF18RIN,SMF18RIN        ZERO RECORD INDICATORS   Y02082 03502002
         MVC   SMF18ODS,PDSNAME         OLD DS NAME              YM1337 03504002
         MVC   SMF18NDS,0(R7)           NEW DS NAME              Y02082 03506002
         XC    SMF18RV1,SMF18RV1        ZERO RESERVED AREA       Y02082 03508002
         XR    R7,R7                    ZERO VOL COUNTER         S19028 03510002
         LA    R2,SMF18RV2                                       S19028 03512002
         USING SMF18RV2,R2                                       S19028 03514002
TESTVOL  EQU   *                        WAS RENAME SUCCESSFUL    Y02082 03516002
         CLI   STATUS(VOLISTX),X00      WAS RENAME SUCCESSFUL    Y02082 03518002
         BNE   NEXTVOL                  BRANCH IF NOT            Y02082 03520002
         XC    SMF18RV2,SMF18RV2                                 Y02082 03522002
         MVC   SMF18FVL,VOLSER(VOLISTX)  MOVE VOL SER TO RECORD  Y02082 03524002
         LA    R7,1(R7)                 INCREMENT VOLUME COUNT   S19028 03526002
         LA    R2,SMF18LNV(R2)          INCREMENT RECORD PTR     S19028 03528002
NEXTVOL  EQU   *                        NEXT VOL                 Y02082 03530002
         LA    VOLISTX,ENTRYL(VOLISTX)  INCREMENT VOLIST PTR     Y02082 03532002
         BCT   VOLCTR,TESTVOL           BRANCH IF MORE VOLUMES   Y02082 03534002
         LTR   R7,R7                    IS VOLUME COUNT ZERO     S19028 03536002
         BZ    EXIT                     BRANCH IF YES            Y02082 03538002
         STC   R7,SMF18NVL              NUMBER OF RENAMED VOLS   S19028 03540002
         DROP  R2                                                S19028 03542002
         SR    R2,R3                    GET RECORD LENGTH        Y02080 03544002
         STH   R2,SMF18LEN                                       S19028 03546002
         DROP  R3                                                Y02080 03548002
         LR    R1,R3                    POINT TO SMF RECORD      Y02080 03550002
         SMFWTM (1)                     WRITE SMF RECORD TYPE 18 A38860 03552002
*                                                                       03554002
* THIS SECTION FREES ALL WORK AREAS AND RETURNS TO THE CALLER.          03556002
*                                                                       03558002
EXIT     EQU   *                        RETURN TO CALLER         Y02082 03560002
         LH    RERRSAVE,ERCODE          SAVE RETURN CODE         Y02082 03562002
         L     R9,RENSAVE               RESTORE ORIGINAL R14   @G60ASBJX03564060
                                        TO R9                  @G60ASBJ 03565060
         IECRES FREE,PREFIX=FIRST,A=(RWKAREA)  FREE WORK AREA    Y02082 03566060
         LR    RETURN,R9                RESTORE R14 WITH       @G60ASBJX03567060
                                        ORIGINAL R14           @G60ASBJ 03568060
         LR    WORKREG,RERRSAVE         RESTORE RETURN CODE      Y02082 03570002
         RETURN ,                       RETURN TO CALLER         Y02082 03572002
*                                                                       03740000
* THIS SECTION EXECUTES A CHANNEL PROGRAM.                              03746021
*                                                                       03752021
EXECIO   EXCP  IOB                                                      03760000
         WAIT  1,ECB=ECB                                                03780000
         TM    ECB,X'20'               TEST ECB FOR PERMANENT ERROR     03800000
         BZ    PERMERR                 BR IF ERROR                      03820000
         BR    RETURN                                                   03840000
*                                                                       03860000
*** PROGRAM CONSTANTS                                                   03880000
*                                                                       03900000
DEQLIST1 DEQ   (,,,SYSTEM),TCB=0,MF=L   SYSDSN DEQ LIST          YM2887 03905002
DEQLTH1  EQU   *-DEQLIST1               LENGTH OF DEQ LIST       Y02082 03910002
DEQLIST2 DEQ   (,,6,SYSTEM),MF=L        SYSZTIOT DEQ LIST        YM2887 03915002
DEQLTH2  EQU   *-DEQLIST2               LENGTH OF DEQ LIST       Y02082 03920002
TIOTMJR  DC    CL8'SYSZTIOT'            TIOT MAJOR RESOURCE NAME Y02082 03925002
DSNMJR   DC    CL8'SYSDSN'              DSN MINOR RESOURCE NAME  Y02082 03930002
VTOCNAME DC    CL8'SYSVTOC'             VTOC MAJOR RESOURCE NAME Y02082 03935002
         DS    0F                                                A38860 03940021
RETNAME  DC    CL4'3001'                RETURN NAME FOR IGG0300F Y02134 03960002
SECCODE  DC    X'02000000'              CODE FOR SECURITY LOAD          03980000
DDNAMEKY DC    AL2(DUNDDNAM)            DDNAME UNALLOCATION KEY  Y02082 03990002
*                                                                       03996002
*        DEB ACCESS METHOD TYPE VALUES                                  03998002
*                                                                       04000002
AMBPAM   DEBCHK AM=BPAM,MF=L            BPAM AMTYPE              Y02082 04002002
AMBDAM   DEBCHK AM=BDAM,MF=L            BDAM AMTYPE              Y02082 04004002
AMSAM    DEBCHK AM=SAM,MF=L             SAM AMTYPE               Y02082 04006002
AMEXCP   DEBCHK AM=EXCP,MF=L            EXCP AMTYPE              Y02082 04008002
AMISAM   DEBCHK AM=ISAM,MF=L            ISAM AMTYPE              Y02082 04010002
*                                                                       04017021
*** THE FOLLOWING CHANNEL PROGRAM SEARCHES THE VTOC FOR THE NAMED DSCB. 04020000
*** THE VTOC DSCB AND THE NAMED DSCB ARE READ INTO THE INPUT AREAS.     04040000
*                                                                       04060000
CHANPROG DS    0F                                                       04080000
*CCW1                                                                   04100000
         DC    X'31'                   SEARCH EQUAL ID (SEEK+3)         04120000
         DC    AL3(3+SEEK-FIRST)                                        04140000
         DC    X'4000'                                                  04160000
         DC    H'5'                                                     04180000
*CCW2                                                                   04200000
         DC    X'08'                   TIC TO CCW1                      04220000
         DC    AL3(0+CCW1-FIRST)                                        04240000
         DC    F'0'                                                     04260000
*CCW3                                                                   04280000
         DC    X'06'                   READ DATA (VTOC DSCB)            04300000
         DC    AL3(VTOCDSCB-FIRST)     DATA ADDR                 Y02080 04320002
         DC    X'4000'                                                  04340000
         DC    H'96'                                                    04360000
*CCW4                                                                   04380000
         DC    X'B1'                   SEARCH EQUAL ID (LAST FMT 1)     04400000
         DC    AL3(0+DS4HPCHR-FIRST)                                    04420002
         DC    X'4000'                                                  04440000
         DC    H'5'                                                     04460000
*CCW5                                   TO BE CONSTRUCTED               04480000
*                                       TIC TO CCW9                     04500000
*CCW6                                   TO BE CONSTRUCTED               04520000
*                                       SEARCH EQUAL KEY (DS NAME)      04540000
*CCW7                                   TO BE CONSTRUCTED               04560000
*                                       READ DATA OF THE LAST   SA48172 04570021
*                                       FORMAT 1 WITH THE SKIP  SA48172 04580021
*                                       BIT SET IN ORDER TO END SA48172 04590021
*                                       THE CHANNEL PROGRAM     SA48172 04590421
*CCW8                                   TO BE CONSTRUCTED               04600000
*                                       TIC TO CCW11                    04620000
*CCW9                                                                   04640000
         DC    X'29'                   SEARCH EQUAL KEY (DS NAME)       04660000
         DC    AL3(0)                                                   04680000
         DC    X'6000'                                                  04700000
         DC    H'44'                                                    04720000
*CCW10                                                                  04740000
         DC    X'08'                   TIC TO CCW4                      04760000
         DC    AL3(0+CCW4-FIRST)                                        04780000
         DC    F'0'                                                     04800000
*CCW11                                                                  04820000
         DC    X'06'                   READ DATA INTO F1DSCB+44  Y02080 04840002
         DC    AL3(DS1FMTID-FIRST)     DATA ADDR                 Y02080 04860002
         DC    X'4000'                                                  04880000
         DC    H'96'                                                    04900000
*CCW12                                                                  04920000
         DC    X'12'                   READ COUNT (NEWCCHHR)            04940000
         DC    AL3(0+NEWCCHHR-FIRST)                                    04960000
         DC    X'2000'                                                  04980000
         DC    H'5'                                                     05000000
*                                                                       05020000
*** THE FOLLOWING CHANNEL PROGRAM WRITES THE NEW NAME DSCB OVER THE     05040000
*** OLD NAME DSCB IN THE VTOC ON THE DIRECT ACCESS DEVICE.              05060000
*                                                                       05080000
CHALPROG DS    0F                                                       05100000
*CCW1                                   TO BE CONSTRUCTED               05120000
*                                       SEARCH EQUAL ID (SEEK+3)        05140000
*CCW2                                   TO BE CONSTRUCTED               05160000
*                                       TIC TO CCW1                     05180000
*CCW3                                   TO BE CONSTRUCTED               05200000
*                                       WRITE KEY AND DATA FROM F1DSCB  05220002
*CCW4                                   TO BE CONSTRUCTED               05240000
*                                       SEARCH EQUAL ID (SEEK+3)        05260000
*CCW5                                   TO BE CONSTRUCTED               05280000
*                                       TIC TO CCW4                     05300000
*CCW6                                                                   05320000
         DC    X'0E'                   READ KEY AND DATA (WRITE CHECK)  05340000
         DC    AL3(0)                                                   05360000
         DC    X'1000'                                                  05380000
         DC    H'140'                                                   05400000
*   RACHECK PARAMETER LIST MASTER                                       05410037
MRACHECK RACHECK ATTR=ALTER,            ALTER AUTHORIZATION    @Z40RSGDX05412037
               CLASS=CDATASET,          DATASET CLASS          @Z40RSGDX05414037
               DSTYPE=N,                NONVSAM DATASET        @Z40RSGDX05416037
               MF=L                                            @Z40RSGD 05418037
LRACHECK EQU   *-MRACHECK               LENGTH OF PARM LIST    @Z40RSGD 05418437
CDATASET DC    AL1(7),C'DATASET'        CLASS FOR RACHECK      @Z40RSGD 05418837
*   RACDEF PARAMETER LIST MASTER                                        05419237
MRACDEF  RACDEF DSTYPE=N,               DASD DATASET           @Z40RSGDX05419637
               TYPE=DEFINE,             DEFINE A NEWNAME       @Z40RSGDX05419737
               MF=L                                            @Z40RSGD 05419837
LRACDEF  EQU   *-MRACDEF                LENGTH OF PARM LIST    @Z40RSGD 05419937
*                                                                       05433337
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       05440002
*                                                                       05460002
         XCTLTABL ID=(LOAD2,IGG03002,MNTLOAD,IGG0300F,           Y02134*05480002
               SECLOAD,SECLOADA),SVC=030,LENGTH=,BRT=YES         Y02134 05500002
         SPACE 2                                                 Y02082 05520002
         IECDSECS CVT,DSAB,JMR,QDB,RB,SMF,SMFTCT,TCB,TIOT,UCB,   Y02082*05540002
               IEZDEB,JSCB,PSA,RRPL,EXPAND=YES                   Y02144 05560002
WORKAREA IECRENWA EP,F4,D1=(1),ADT=YES  RENAME WORK AREA         Y02082 05580002
         SPACE 2                                                 Y02082 05600002
RACHECK  EQU   IECREGSV                 RACHECK PARAMETER LIST @Z40RSGD 05610037
RACDEF   EQU   IECREGSV                 RACDEF PARAMETER LIST  @Z40RSGD 05612037
         SPACE 2                                                        05614037
         ORG   VTOCDSCB                                          Y02082 05620002
         IFASMFR (18)                                            Y02082 05640002
         EJECT                                                   Y02082 05660002
*                                                                       05680002
* DSECTS FOR INVOCATING DYNAMIC ALLOCATION (SVC 99)                     05700002
*                                                                       05720002
         IEFZB4D0                       DYNAMIC ALLOCATION DSECT Y02082 05740002
         EJECT                                                   Y02082 05760002
         IEFZB4D2                       DYNAMIC ALLOCATION KEYS  Y02082 05780002
*                   SETS FAILED                                @Z40RSGD 07000037
         END                                                            08580000
