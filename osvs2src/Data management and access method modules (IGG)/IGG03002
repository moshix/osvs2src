 TITLE 'IGG03002 - RENAME - LOAD 2 - LOCATE VOLUME TO BE PROCESSED'     00300002
IGG03002 CSECT                                                          00330021
*                                                                       00360021
*          RELEASE 17 DELETIONS                                       * 00390000
*1675006000,012000                                                19894 00480000
*        RELEASE 18 DELETIONS                                         * 00570018
*3476192000-198000,330000,342000,396000,402000,708000-711000       DM0Q 00630018
*3476005700,447000-450000,591000,603000                           20326 00660018
*3476                                                             21488 00700018
*          RELEASE 19 DELETIONS                                       * 00750000
*1291318000,447000,645000-663000,924000                          S19028 00790019
*          RELEASE 20 DELETIONS                                       * 00840000
*3450390000                                                      S20016 00880020
*3450388200,389300,770000-770500                                 TS1611 00900020
*3450234000,249000,325200-325300,660000                          S20201 00910020
*          RELEASE 21 DELETIONS                                       * 00930000
*1195006000,033000,090000-099000,111000,195000,540000-543000,    A38860 00933021
*1195549000-552000,681000-684000,769000-769500,902000            A38860 00936021
*1195267000-270000,276000,679000,768500                          A37199 00940021
*1195                                                            A44427 00950021
*1195                                                            A36775 00970021
*0000665400                                                     SA49351 00980021
*          RELEASE 21.7 DELETIONS                                       00993302
*0000192300-193800,658200-664800,688000                         SA53147 01006702
*          RELEASE 22 DELETIONS                                       * 01020000
*0000063000-066000,072000-081000,102000-105000,110000-112000,    Y02080 01110202
*0000117000,194100,207000,216000,259000,294000,315000-324000,    Y02080 01110302
*0000325200-325500,330000-340500,342500,348000,354000-357000,    Y02080 01110402
*0000375000,387000,396000,402000,468000,474000-489000,499400,    Y02080 01110502
*0000510000-516000,546000-548000,579000-606000,657900-669000,    Y02080 01110602
*0000682000,768300-768900,771000-897000,901000-903000,912000-    Y02080 01110702
*0000918000,923000                                               Y02080 01110802
*0000                                                            Y02078 01110902
*0000021000-108000,112000,117000,166000,169000,191200-192000,    Y02082 01111002
*0000229000-231000,285000-669000,687500-926600                   Y02082 01111102
*0000                                                            Y02134 01111202
*0000                                                            Y02144 01111302
*0000290000-291000,325000,361000,388000,501000                   YM1337 01111402
*0000324000,364000-366000                                        YM1063 01111602
*0000364500-365000                                               YM7377 01111702
*0000349400                                                      YM7515 01111802
*0000344000,573000                                               YM7036 01112002
*                                                                       01290002
*          VS2 RELEASE 03 DELETIONS/CHANGES                           * 01290203
*0000352000                                                    @ZA01347 01290403
*                                                                       01291002
*          VS2 RELEASE 04 DELETIONS/CHANGES                           * 01291203
*0000353000                                                    @ZA05225 01291403
*                                                                       01291603
*MODULE NAME - IGG03002                                                 01292002
*                                                                       01293002
*DESCRIPTIVE NAME - RENAME - LOAD 2 - LOCATE VOLUME TO BE PROCESSED     01294002
*                                                                       01295002
*COPYRIGHT - NONE                                                       01296002
*                                                                       01297002
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           01298002
*                                                                       01299002
* STATUS CHANGE LEVEL 004                                               01390021
*                                                                       01440002
*ATTRIBUTES - REENTRANT                                                 01500002
*                                                                       01800013
*FUNCTION - AFTER BUILDING THE DEB/DCB AND THE IOB, THIS MODULE         01900002
*          SEARCHES THE TIOT TO SEE IF THE CURRENT VOLUME IN THE        02000002
*          VOLUME LIST IS MOUNTED ON A UNIT ALLOCATED TO THE JOB.       02100002
*          IF THE VOLUME IS NOT MOUNTED ON AN ALLOCATED UNIT, IT        02200002
*          SEARCHES THE UCB LOOKUP TABLE TO DETERMINE IF THE VOLUME     02300002
*          IS MOUNTED ANYWHERE.  IF IT IS MOUNTED, DYNAMIC ALLOCATION   02400002
*          IS CALLED TO TRY TO ALLOCATE THE UNIT.  IF THE VOLUME IS     02500002
*          NOT MOUNTED ANYWHERE OR IF THE UNIT CANNOT BE DYNAMICALLY    02600002
*          ALLOCATED, AND THERE IS A PRIMARY UCB, CONTROL IS GIVEN TO   02700002
*          THE SCRATCH/RENAME DEMOUNT/MOUNT/VERIFY ROUTINE TO MOUNT     02800002
*          THE VOLUME.  IF THERE IS NO PRIMARY UCB OR IF THE VOLUME     02900002
*          CANNOT BE MOUNTED, THE NEXT VOLUME IN THE VOLUME LIST IS     03000002
*          PROCESSED.  IF THE VOLUME WAS FOUND TO BE MOUNTED ON AN      03100002
*          ALLOCATED UNIT, AFTER THE UNIT CONTAINING THE VOLUME IS      03200002
*          DYNAMICALLY ALLOCATED, AFTER THE VOLUME IS MOUNTED ON THE    03300002
*          PRIMARY UCB, OR AFTER ALL THE VOLUME LIST ENTRIES HAVE BEEN  03400002
*          PROCESSED, CONTROL IS GIVEN TO THE THIRD LOAD OF RENAME.     03500002
*                                                                       03600002
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG03002.  ENTRY IS   03700002
*          MADE FROM IGC00030, IGG03001, OR IGG0300F.                   03800002
*                                                                       03900002
*SUPERVISOR CALLS AND EXTERNAL ROUTINES -                               04000002
*          DYNALLOC - DYNAMICALLY ALLOCATES THE UNIT (SVC 99)           04100002
*          MODESET  - SWITCHES TO THE CALLER'S KEY                      04200002
*          IECRES   - BRANCHES TO OTHER RENAME MODULES                  04300002
*                                                                       04400002
*OTHER MACROS ISSUED -                                                  04500002
*          IECDSECS - EXPANDS THE CVT, DSAB, QDB, RB, TCB, TIOT,        04600002
*                     AND UCB DSECTS                                    04700002
*          IECRENQA - EXPANDS THE RENAME WORK AREA                      04800002
*          IEFZB4D0 - EXPANDS THE DYNAMIC ALLOCATION REQUEST BLOCK      04900002
*          IEFZB4D2 - EXPANDS THE DYNAMIC ALLOCATION TEST UNIT KEYS     05000002
*          XCTLTABL - BUILDS A LIST OF MODULE IDS AND ADDRESSES         05100002
*                                                                       05200002
*INPUT -   AT ENTRY TO THIS MODULE REGISTER 9 POINTS TO THE CVT.        05300002
*          REGISTER 10 POINTS TO THE PARAMETER LIST.  REGISTER 13       05400002
*          POINTS TO THE WORK AREA, IN WHICH 'VOLNUM' CONTAINS THE      05500002
*          NUMBER OF VOLUMES REMAINING TO BE RENAMED, AND 'VOLPTR'      05600002
*          CONTAINS THE ADDRESS OF THE CURRENT ENTRY IN THE VOLUME      05700002
*          LIST.                                                        05800002
*          IF REENTRY FROM IGG0300F, REGISTER 14 CONTAINS ONE OF        05900002
*          THE FOLLOWING RETURN CODES:                                  06000002
*          00 - VOLUME WAS SUCCESSFULLY MOUNTED AND/OR VERIFIED         06100002
*          04 - VOLUME COULD NOT BE DEMOUNTED                           06200002
*          08 - VOLUME COULD NOT BE MOUNTED                             06300002
*          0C - I/O ERROR OCCURRED WHEN READING THE VOLUME LABEL        06400002
*          ALSO, REGISTER 5 CONTAINS THE NUMBER OF VOLUMES REMAINING    06500002
*          TO BE RENAMED, AND REGISTER 8 POINTS TO THE CURRENT ENTRY    06600002
*          IN THE VOLUME LIST.                                          06700002
*                                                                       06800002
*OUTPUT -  REGISTER 8 POINTS TO THE CURRENT ENTRY IN THE VOLUME LIST.   06900002
*          REGISTER 9 POINTS TO THE CVT, AND REGISTER 10 POINTS TO      07000002
*          THE PARAMETER LIST.  REGISTER 13 POINTS TO THE WORK AREA,    07100002
*          IN WHICH THE DEB CONTAINS THE UCB ADDRESS OF THE VOLUME      07200002
*          WHOSE DATA SET IS TO BE RENAMED.                             07300002
*          THE FOLLOWING ADDITIONAL INFORMATION IS PASSED TO IGG0300F:  07400002
*          REGISTER 2 POINTS TO THE DEB.                                07500002
*          REGISTER 3 POINTS TO THE VOLUME SERIAL NUMBER.               07600002
*          REGISTER 4 CONTAINS THE CHARACTERS '3002'.                   07700002
*          REGISTER 11 CONTAINS THE PRIMARY (DEMOUNTABLE) UCB ADDRESS.  07800002
*                                                                       07900002
*STORAGE - PROGRAM CODE CSECT = LESS THAN 1024 BYTES                    11000002
*          WORK AREA = 676 BYTES                                        11200002
*                                                                       11400013
*ERROR CONDITIONS - NO DEVICE AVAILABLE FOR MOUNTING THE VOLUME         11700002
*                                                                       12000013
*RESTRICTIONS - NONE                                                    12300013
*                                                                       12600013
*REGISTER USAGE:                                                        12900013
R0       EQU   0                                                        13200013
R1       EQU   1                                                        13500013
R2       EQU   2                                                        13800013
RPARM    EQU   2                        PTR TO SVC 99 PARM LIST  Y02082 13900002
RDSAB    EQU   2                        POINTER TO THE DSAB      Y02082 14000002
R3       EQU   3                                                        14100013
P1       EQU   3                                                        14400013
RWRK     EQU   3                        WORK REGISTER            Y02082 14500002
RTIOT    EQU   3                        POINTER TO THE TIOT      Y02082 14600002
R4       EQU   4                                                        14700013
RTEXT    EQU   4                        POINTER TO TEXT UNIT     Y02082 14800002
REND     EQU   4                        POINTER TO END OF ENTRY  Y02082 14900002
P2       EQU   4                                                        15000013
R5       EQU   5                                                        15300013
R6       EQU   6                                                 S20016 15400020
VOLCTR   EQU   5                                                        15600013
P4       EQU   6                                                        15900013
R7       EQU   7                                                        16200013
VOLISTX  EQU   8                                                        16500013
R9       EQU   9                                                        16800013
RCVT     EQU   9                                                        17100013
PL       EQU   10                                                       17400013
RUCB     EQU   11                                                       17700013
RBASE    EQU   12                                                       18000013
RWKAREA  EQU   13                                                       18300013
RETURN   EQU   14                                                       18600013
WORKREG  EQU   15                                                       18900013
RTNCODE  EQU   15                       RETURN CODE REGISTER     Y02082 18920002
*                                                                       18970021
* OTHER EQUATES                                                         19040021
*                                                                       19110021
K0       EQU   0                        CONSTANT OF ZERO         Y02082 19112002
K1       EQU   1                        CONSTANT OF 1            Y02082 19114002
K2       EQU   2                        CONSTANT OF 2            Y02082 19116002
K3       EQU   3                        CONSTANT OF 3            Y02082 19118002
K4       EQU   4                        CONSTANT OF 4            Y02080 19120002
K6       EQU   6                        CONSTANT OF 6            Y02082 19122002
K7       EQU   7                        CONSTANT OF 7            Y02082 19124002
K8       EQU   8                        CONSTANT OF 8            Y02082 19126002
K12      EQU   12                       CONSTANT OF 12           Y02082 19128002
FW4      EQU   16                       LENGTH OF 4 FW'S         Y02082 19132002
STATEXTL EQU   8                        STATUS TEXT UNIT LENGTH  Y02082 19134002
UNITEXTL EQU   10                       UNIT TEXT UNIT LENGTH    Y02082 19136002
VOLTEXTL EQU   12                       VOLSER TEXT UNIT LENGTH  Y02082 19138002
RTNCODE4 EQU   4                        ERROR RETURN CODE OF 4   Y02082 19140002
RTNCODE8 EQU   8                        ERROR RETURN CODE OF 8   Y02082 19142002
VOLSER   EQU   4                        OFFSET TO VOLUME SERIAL  Y02082 19144002
*                                       IN A VOLUME LIST ENTRY   Y02082 19146002
STATUS   EQU   11                       OFFSET TO STATUS BYTE    Y02082 19148002
ENTRYL   EQU   12                       VOL LIST ENTRY LENGTH    Y02082 19150002
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02082 19152002
DEVMOD   EQU   X'C0'                    DEB DEVICE MODIFIER      Y02082 19154002
IOERR    EQU   X'04'                    I/O ERROR IN VOL LIST    Y02082 19156002
NODEVERR EQU   X'05'                    NO DEVICE ERROR          Y02082 19158002
NOMNTERR EQU   X'06'                    VOLUME NOT MOUNTED ERROR Y02082 19160002
STATOLD  EQU   X'01'                    DISP=OLD INDICATOR       Y02082 19162002
AVTDISP  EQU   29                       DISPLACEMENT TO THE AVT SA53147 19210002
*                                       ADDRESS IN THE DEB      SA53147 19220002
DEBSIZE  EQU   48                       SIZE OF THE DEB         SA53147 19230002
UNRELATD EQU   X'02'                    UNRELATED FLAG IN IOB    A37199 19450021
*                                                                       19750021
         BALR  RBASE,R0                                                 20100013
         USING BEGIN,RBASE                                              20400013
         USING RENAMWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 20700002
         USING UCB,RUCB                                                 21000013
         USING CVT,RCVT                                                 21300013
*                                                                       21700002
BEGIN    L     RCVT,CVTPTR                                              21900013
         TM    SISW2,DEMNTSW+MOUNTSW+VERIFYSW  TEST IF RETURN    Y02134 21950002
*                                       FROM DEMOUNT, MOUNT,     Y02134 22000002
*                                       AND/OR VERIFY FUNCTION   Y02134 22050002
         BNZ   RETURNPT                 BRANCH IF YES            Y02134 22100002
*                                                                       22200013
*** BUILD CONTROL BLOCKS                                                22500013
*                                                                       22800013
         XC    WKADEB(DEBSIZE),WKADEB   ZERO THE DEB             Y02082 22900002
         MVC   WKADEB+AVTDISP(K3),CVTXAPG+K1  INSERT IOS AVT ADR Y02082 23000002
         LA    R1,WKADEB                BUILD THE DEB            Y02082 23100002
         MVI   16(R1),X'01'                  NUM OF EXTS = 1            23700013
         LA    R2,DCB                                                   24000013
         ST    R2,24(R1)                     INSERT DCB ADDR            24300013
         MVI   24(R1),X'0F'                  INSERT DEB ID              24600013
         MVI   28(R1),X'04'                  INSERT EXT SCALE           25200013
         MVC   42(6,R1),EXTCONST             INSERT EXTS AND TK COUNT   25500013
         ST    R1,DEBPTR                BUILD DCB                       25800013
         OI    IOB,UNRELATD             SET UNRELATED BIT IN IOB A37199 26000021
         LA    WORKREG,ECB              BUILD IOB                       26100013
         ST    WORKREG,IOB+4                 INSERT ECB ADDR            26400013
         LA    RETURN,CCW1                                       A37199 26800021
         LA    WORKREG,DCB                                              27300013
         STM   RETURN,WORKREG,IOB+16    CCW AND DCB ADDRESSES    A37199 27600021
NEXTVOL  EQU   *                        NEXT VOLUME              Y02082 27700002
         LH    VOLCTR,VOLNUM            LOAD NUMBER OF VOLUMES LEFT     27900013
         L     VOLISTX,VOLPTR           LOAD VOLUME LIST INDEX          28200013
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 28300002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 28400002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 28500002
         MVI   STATUS(VOLISTX),K0       CLEAR STATUS BYTE IN     Y02082 28600002
*                                       THIS VOLUME LIST ENTRY   Y02082 28700002
         DROP  R1                                                Y02082 28800002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 28900002
         MVC   PVOLSER,VOLSER(VOLISTX)  SAVE VOLSER IN WRK AREA  YM1337 29000002
         OC    PVOLSER,PVOLSER          TEST FOR VALID VOLSER    YM1337 29100002
         BZ    NODEVICE                 NO UNIT IF ZERO          Y02082 29200002
*                                                                       29300002
* THE FOLLOWING SECTIONS TRY TO FIND THE UCB ADDRESS OF THE CURRENT     29400002
* VOLUME IN THE VOLUME LIST. FIRST, IT SEARCHES THE TIOT TO SEE IF      29500002
* THE VOLUME IS MOUNTED ON A UNIT ALLOCATED TO THE JOB. IF NOT, IT      29600002
* SEARCHES THE UCB LOOKUP TABLE TO DETERMINE IF THE VOLUME IS MOUNTED   29700002
* ANYWHERE. IF IT IS MOUNTED, DYNAMIC ALLOCATION IS CALLED TO TRY TO    29800002
* ALLOCATE THE UNIT. IF THE VOLUME IS NOT MOUNTED ANYWHERE OR IF IT     29900002
* CANNOT BE DYNAMICALLY ALLOCATED, THE VOLUME WILL BE MOUNTED ON THE    30000002
* PRIMARY UCB, IF ONE EXITS.                                            30100002
*                                                                       30200002
FINDUCB  EQU   *                        FIND UCB                 Y02082 30300002
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 30400002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 30500002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 30600002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 30700002
DSABTEST EQU   *                        DSAB TEST                Y02082 30800002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 30900002
         BZ    TABLSRCH                 BRANCH IF NOT            Y02082 31000002
         L     RTIOT,DSABTIOT           GET TIOT POINTER         Y02082 31100002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 31200002
         SR    REND,REND                ZERO REGISTER FOR IC     Y02082 31300002
         IC    REND,TIOELNGH            LENGTH OF TIOT ENTRY     Y02082 31400002
         AR    REND,RTIOT               ADDRESS OF FIRST BYTE    Y02082 31500002
*                                       PAST THE TIOT ENTRY      Y02082 31600002
         LA    RTIOT,TIOEFSRT-K1        ADDR OF FIRST UCB ADDR   Y02082 31700002
UCBTEST  EQU   *                        UCB TEST                 Y02082 31800002
         CR    RTIOT,REND               TEST IF AT END OF ENTRY  Y02082 31900002
         BNL   NEXTDSAB                 BRANCH IF YES            Y02082 32000002
         L     RUCB,K0(,RTIOT)          GET UCB ADDRESS          Y02082 32100002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02082 32200002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02082 32300002
         BZ    NXTENTRY                 BRANCH IF NOT            YM1063 32400002
         CLC   SRTEVOLI,PVOLSER         COMPARE VOL SER NUMBERS  YM1337 32500002
         BNE   NXTENTRY                 BRANCH IF NOT EQUAL      Y02082 32600002
         CLC   UCBTBYT3(K2),K2(VOLISTX)  COMPARE DEVICE TYPES    Y02082 32700002
         BNE   NXTENTRY                 BRANCH IF NOT EQUAL      Y02082 32800002
         TM    UCBTBYT3,UCB3DACC        TEST IF DIRECT ACCESS    Y02082 32900002
         BZ    NXTENTRY                 BRANCH IF NOT            Y02082 33000002
         TM    SRTESTAT,SRTEONLI        TEST IF ONLINE           Y02082 33100002
         BO    FOUNDUCB                 BRANCH IF ONLINE         Y02082 33200002
NXTENTRY EQU   *                        NEXT UCB                 Y02082 33300002
         LA    RTIOT,L'TIOESTTB+L'TIOEFSRT(,RTIOT)  INCREMENT TO Y02082 33400002
*                                       NEXT UCB ADDRESS IN TIOT Y02082 33500002
         B     UCBTEST                  GO TEST NEXT UCB ADDRESS Y02082 33600002
NEXTDSAB EQU   *                        NEXT DSAB                Y02082 33700002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 33800002
         B     DSABTEST                 GO TEST IT               Y02082 33900002
FOUNDUCB EQU   *                        FOUND IT                 Y02082 34000002
         ST    RDSAB,DSABADDR           SAVE DSAB ADDRESS        Y02082 34100002
         ST    RUCB,WKADEB+UCBADDR      SAVE UCB ADDRESS IN DEB  Y02082 34200002
         MVI   WKADEB+UCBADDR,DEVMOD    INSERT DEVICE MODIFIER   Y02082 34300002
         L     RETURN,DSABTIOT          LOAD TIOT ENTRY ADDRESS  YM7036 34310002
         LA    RETURN,TIOEJFCB-TIOENTRY(,RETURN)  POINT TO JFCB  YM7036X34320002
                                        PREFIX ADDRESS           YM7036 34340002
         IECRES LOCJFCB,(RETURN)        LOCATE THE JFCB          YM7036 34360002
         CLC   PDSNAME,JFCBDSNM-INFMJFCB(RETURN)  CHECK IF       YM7036X34380002
                                        THIS IS THE RIGHT TIOT   YM7036X34400002
                                        ENTRY FOR THIS DSNAME    YM7036 34420002
         BE    MOUNTED                  BRANCH IF CORRECT        YM7036 34440002
         OI    SISW2,UCBFNDSW           SET THE UCB FOUND SWITCH YM7036 34460002
         B     NXTENTRY                 GO TRY NEXT TIOT ENTRY   YM7036 34480002
*                                                                       34500002
* THIS SECTION SEARCHES THE UCB LOOKUP TABLE TO DETERMINE IF THE        34600002
* VOLUME IS MOUNTED ANYWHERE.                                           34700002
*                                                                       34800002
TABLSRCH EQU   *                        UCB LOOKUP TABLE SEARCH  Y02082 34900002
         TM    SISW2,UCBFNDSW           TEST IF A UNIT WAS FOUND YM7036 34920002
         BNO   LDLOOKUP                 BRANCH IF NOT            YM7515 34930002
         L     RUCB,WKADEB+UCBADDR      LOAD FOUND UCB ADDRESS   YM7515 34940002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          YM7515 34950002
         B     MOUNTED                  GO TEST IF VERIFIED      YM7515 34960002
LDLOOKUP EQU   *                        LOAD UCB LOOKUP TABL ADR YM7515 34970002
         L     R2,CVTILK2               GET LOOKUP TABLE ADDRESS Y02082 35000002
UCBLOOP  EQU   *                        NEXT                     Y02082 35100002
         SR    RUCB,RUCB                CLEAR REG              @ZA01347 35150003
         ICM   RUCB,K3,K0(R2)           GET UCB ADDR           @ZA01347 35200003
         CLM   RUCB,K3,EXTCONST         TEST IF AT END OF TBL  @ZA05225 35300003
         BE    ENDADDR                  BRANCH IF YES            Y02082 35400002
         LTR   RUCB,RUCB                UCB TABLE MAY HAVE HOLES Y02082 35500002
         BZ    NEXTADDR                 BRANCH IF NO ADDRESS     Y02082 35600002
         TM    UCBTBYT3,UCB3DACC        TEST IF DIRECT ACCESS    Y02082 35700002
         BZ    NEXTADDR                 BRANCH IF NOT            Y02082 35800002
         TM    SRTESTAT,SRTEONLI        TEST IF ONLINE           Y02082 35900002
         BZ    NEXTADDR                 BRANCH IF NOT ONLINE     Y02082 36000002
         CLC   SRTEVOLI,PVOLSER         COMPARE VOL SER NUMBERS  YM1337 36100002
         BNE   NEXTADDR                 BRANCH IF NOT EQUAL      Y02082 36200002
         CLC   UCBTBYT3(K2),K2(VOLISTX)  COMPARE DEVICE TYPES    Y02082 36300002
         BNE   NEXTADDR                 BRANCH IF NOT EQUAL      YM1063 36400002
         TM    UCBSTAB,UCBBSVL          TEST IF NONSHAREABLE     YM7377 36450002
         BZ    ALLOCVOL                 BRANCH IF SHAREABLE TO   YM7377X36500002
                                        TRY TO ALLOCATE THE UNIT YM1063 36550002
         B     ENDADDR                  DON'T TRY TO DYNAMICALLY YM1063 36600002
*                                       ALLOCATE IF NONSHAREABLE YM1063 36650002
NEXTADDR EQU   *                        GET NEXT ADDR            Y02082 36700002
         LA    R2,K2(R2)                PT TO NEXT ADDR IN TABLE Y02082 36800002
         B     UCBLOOP                  GO TRY NEXT UCB ADDRESS  Y02082 36900002
*                                                                       36950002
ENDADDR  EQU   *                        NO MORE                  Y02082 37000002
         L     RUCB,PRUCBPTR            LOAD PRIMARY UCB ADDRESS Y02082 37100002
         LTR   RUCB,RUCB                IS THERE A PRIMARY UCB   Y02082 37200002
         BZ    NODEVICE                 BRANCH IF NO PRIMARY UCB Y02082 37300002
         CLC   UCBTBYT3(K2),K2(VOLISTX)  COMPARE DEVICE TYPES    Y02082 37400002
         BNE   NODEVICE                 BRANCH IF NOT EQUAL      Y02082 37500002
*                                                                       37600002
* THIS SECTION PREPARES TO BRANCH TO IGG0300F TO DEMOUNT (IF REQUIRED)  37700002
* AND MOUNT AND/OR VERIFY THE NEXT VOLUME.                              37800002
*                                                                       37900002
MOUNTVOL EQU   *                        MOUNT A VOLUME           Y02134 38000002
         ST    RUCB,WKADEB+UCBADDR      MODIFY UCB ADDR IN DEB   Y02134 38100002
         MVI   WKADEB+UCBADDR,DEVMOD    INSERT DEVICE MODIFIER   Y02134 38200002
         OI    SISW2,DEMNTSW+MOUNTSW    SET DEMOUNT & MOUNT SW   Y02134 38300002
         MVC   DSABADDR,PRDSABAD        INITIALIZE DSAB ADDRESS  Y02134 38400002
VERIFY   EQU   *                        VERIFY A VOLUME          Y02134 38500002
         LA    R2,WKADEB                DEB ADDR IN REGISTER 2   Y02134 38700002
         LA    R3,PVOLSER               VOLSER ADDR IN REG 3     YM1337 38800002
         L     R4,RETNAME               RETURN NAME IN REG 4     Y02134 39000002
         LA    R7,MNTLOAD               POINT TO ID OF IGG0300F  Y02134 39100002
         B     LOADEXIT                 GO BRANCH TO IGG0300F    Y02134 39200002
*                                                                       39300002
* THIS SECTION TESTS THE RETURN CODE FROM THE DEMOUNT/MOUNT ROUTINE.    39400002
*                                                                       39500002
RETURNPT EQU   *                        RETURN HERE              Y02134 39600002
         NI    SISW2,X'FF'-DEMNTSW-MOUNTSW-VERIFYSW  RESET SW    Y02134 39700002
         B     TESTERR(RETURN)          RETURN CODE BRANCH TABLE Y02134 39800002
TESTERR  EQU   *                        TEST FOR ERROR           Y02134 39900002
         B     MOUNTED                  VOLUME MOUNTED/VERIFIED  Y02134 40000002
         B     NODEVICE                 UNSUCCESSFUL DEMOUNT     Y02134 40100002
         B     NOMOUNT                  MOUNT/VERIFY FAILED      Y02134 40200002
         B     PERMERR                  I/O ERROR OCCURRED       Y02134 40300002
*                                                                       40400002
* THIS SECTION PREPARES TO BRANCH TO THE NEXT LOAD OF RENAME.           40500002
*                                                                       40600002
MOUNTED  EQU   *                        VOLUME MOUNTED           Y02134 40700002
         NI    SISW2,X'FF'-UCBFNDSW     TURN OFF UCB FOUND SWTCH YM7036 40750002
         TM    UCBDMCT,UCBMOUNT         TEST MOUNT BIT           Y02134 40800002
         BNO   VERIFIED                 BRANCH IF VERIFIED       Y02134 40900002
         OI    SISW2,VERIFYSW           SET VERIFY SWITCH        Y02134 40920002
         B     VERIFY                   BRANCH TO VERIFY         Y02134 41000002
VERIFIED EQU   *                        VOLUME VERIFIED          Y02134 41020002
         NI    RTYPEFLG,X'FF'-NOMNTDEV  RESET THE 'NO DEVICE FOR Y02134 41100002
*                                       MOUNTING' SWITCH AS AT   Y02134 41200002
*                                       LEAST ONE VOL IS MOUNTED Y02134 41300002
         BCT   VOLCTR,MOREVOLS          TEST FOR LAST VOLUME     Y02082 41400002
         OI    RTYPEFLG,EXITBIT         SET EXIT BIT IF LAST VOL Y02082 41500002
MOREVOLS EQU   *                        MORE VOLUMES             Y02082 41600002
         LA    R1,ENTRYL(VOLISTX)       NEXT VOL LIST ENTRY ADDR Y02082 41700002
         ST    R1,VOLPTR                SAVE NEXT ENTRY ADDRESS  Y02082 41800002
         STH   VOLCTR,VOLNUM            SAVE UPDATED VOL COUNT   Y02082 41900002
NEXTLOAD EQU   *                        SET FOR NEXT LOAD        Y02082 42000002
         LA    R7,LOAD3                 POINT TO ID OF IGG03001  Y02082 42100002
*                                                                       42200002
* THIS SECTION BRANCHES TO ANOTHER LOAD OF RENAME.                      42300002
*                                                                       42400002
LOADEXIT EQU   *                        EXIT TO NEXT LOAD        Y02082 42500002
         IECRES LOAD,EXTPR=(RWKAREA),MODID=(R7),BRANCH=DIRECT    Y02082 42600002
*                                                                       42700002
* THIS SECTION SETS AN APPROPRIATE ERROR CODE IN THE STATUS BYTE        42800002
* OF THE CURRENT VOLUME LIST ENTRY. IF THE LAST VOLUME HAS BEEN         42900002
* PROCESSED, CONTROL IS PASSED TO THE NEXT LOAD OF RENAME. IF NOT,      43000002
* THE NEXT VOLUME LIST ENTRY IS PROCESSED.                              43100002
*                                                                       43200002
PERMERR  EQU   *                        I/O ERROR                Y02082 43300002
         LA    R3,IOERR                 I/O ERROR                Y02082 43400002
         B     SETCODE                  BRANCH TO SET ERROR CODE Y02082 43500002
NODEVICE EQU   *                        NO UNIT FOR MOUNTING     Y02082 43600002
         LA    R3,NODEVERR              NO UNIT FOR MOUNTING ERR Y02082 43700002
         B     SETCODE                  BRANCH TO SET ERROR CODE Y02082 43800002
NOMOUNT  EQU   *                        VOLUME NOT MOUNTED       Y02082 43900002
         LA    R3,NOMNTERR              VOLUME NOT MOUNTED ERROR Y02082 44000002
SETCODE  EQU   *                        SET ERROR CODE           Y02082 44100002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 44200002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 44300002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 44400002
         DROP  R1                                                Y02078 44500002
         STC   R3,STATUS(VOLISTX)       PUT ERROR CODE IN VOLIST Y02078 44600002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 44700002
         BCT   VOLCTR,NOTLAST           TEST IF LAST VOLUME      Y02082 44800002
         OI    RTYPEFLG,EXITBIT         SET EXIT BIT IF LAST VOL Y02082 44900002
NOTLAST  EQU   *                        NOT LAST                 Y02082 45000002
         LA    R1,ENTRYL(VOLISTX)       NEXT VOL LIST ENTRY ADDR Y02082 45100002
         ST    R1,VOLPTR                SAVE NEXT ENTRY ADDR     Y02082 45200002
         STH   VOLCTR,VOLNUM            SAVE UPDATED VOL COUNT   Y02082 45300002
         LA    RTNCODE,RTNCODE8         NORMAL ERROR RETURN CODE Y02082 45400002
         STH   RTNCODE,ERCODE           SAVE ERROR RETURN CODE   Y02082 45500002
         TM    RTYPEFLG,EXITBIT         TEST IF LAST VOLUME      Y02082 45600002
         BZ    NEXTVOL                  BRANCH IF NOT TO PROCESS Y02082 45700002
*                                       THE NEXT VOLUME          Y02082 45800002
         TM    RTYPEFLG,NOMNTDEV        TEST IF AN ERROR CODE OF Y02082 45900002
*                                       4 MUST BE RETURNED TO    Y02082 46000002
*                                       CALLER IN REGISTER 15    Y02082 46100002
         BZ    NEXTLOAD                 BRANCH IF NOT            Y02082 46200002
         MVI   ERCODE+K1,RTNCODE4       SET RETURN CODE TO 4     Y02082 46300002
         B     NEXTLOAD                 GO BRANCH TO IGG03001    Y02082 46400002
*                                                                       46500002
* THIS SECTION BUILDS THE REQUEST BLOCK TO INTERFACE WITH DYNAMIC       46600002
* ALLOCATION (SVC 99) TO TRY TO ALLOCATE THE UNIT ON WHICH THE          46700002
* CURRENT VOLUME IN THE VOLUME LIST IS MOUNTED.                         46800002
*                                                                       46900002
ALLOCVOL EQU   *                        TRY TO ALLOCATE THE UNIT Y02082 47000002
         LA    RPARM,VTOCDSCB           PARAMETER LIST BASE      Y02082 47100002
         USING S99RBP,RPARM                                      Y02082 47200002
         LA    RWRK,K4(,RPARM)          INCREMENT BY FOUR        Y02082 47300002
         ST    RWRK,S99RBPTR            SET UP REQUEST BLOCK PTR Y02082 47400002
         OI    S99RBPTR,S99RBPND        TURN ON HIGH ORDER BIT   Y02082 47500002
         LR    RPARM,RWRK               ADDRESS OF REQUEST BLOCK Y02082 47600002
         USING S99RB,RPARM              REQ BLOCK ADDRESSABILITY Y02082 47700002
         XC    S99RB(S99RBEND-S99RB),S99RB  ZERO REQ BLOCK CORE  Y02082 47800002
         MVI   S99RBLN,S99RBEND-S99RB   LENGTH OF REQUEST BLOCK  Y02082 47900002
         MVI   S99VERB,S99VRBAL         INDICATE ALLOCATION      Y02082 48000002
         LA    RWRK,S99RBEND            ADDR OF TEXT POINTERS    Y02082 48100002
         ST    RWRK,S99TXTPP            PLACE IN REQUEST BLOCK   Y02082 48200002
         OI    S99FLG11,S99NOMNT        INDICATE THAT VOL MUST   Y02082 48300002
*                                       BE MOUNTED IF ALLOCATED  Y02082 48400002
         OI    S99FLG21,S99TIONQ+S99NORES  INDICATE TIOT ENQ'ED  Y02082 48500002
*                                       AND NO D/S RESERVATION   Y02082 48600002
         LR    RPARM,RWRK               ADDRESS OF TEXT POINTERS Y02082 48700002
         USING S99TUPL,RPARM            TEXT PTR ADDRESSABILITY  Y02082 48800002
*                                                                       48900002
* THIS SECTION BUILDS THE VOLSER TEXT UNIT.                             49000002
*                                                                       49100002
         LA    RTEXT,FW4(,RPARM)        BASE FOR TEXT UNIT       Y02082 49200002
         ST    RTEXT,S99TUPTR           PTR TO VOLSER TEXT UNIT  Y02082 49300002
         USING S99TUNIT,RTEXT           TEXT UNIT ADDRESSABILITY Y02082 49400002
         LH    RWRK,VOLSERKY            INDICATE VOLSER TEXT     Y02082 49500002
         STH   RWRK,S99TUKEY                                     Y02082 49600002
         LA    RWRK,K1                  ONE TEXT PARM            Y02082 49700002
         STH   RWRK,S99TUNUM                                     Y02082 49800002
         LA    RWRK,L'SRTEVOLI          LENGTH OF VOLSER         Y02082 49900002
         STH   RWRK,S99TULNG                                     Y02082 50000002
         MVC   S99TUPAR(L'SRTEVOLI),PVOLSER  GET VOLSER          YM1337 50100002
*                                                                       50200002
* THIS SECTION BUILDS THE UNIT TEXT UNIT.                               50300002
*                                                                       50400002
         LA    RTEXT,VOLTEXTL(,RTEXT)   INCREMENT BASE           Y02082 50500002
         ST    RTEXT,S99TUPTR+K4        POINT TO UNIT TEXT UNIT  Y02082 50600002
         LH    RWRK,UNITKEY             INDICATE UNIT SPECIFIED  Y02082 50700002
         STH   RWRK,S99TUKEY                                     Y02082 50800002
         LA    RWRK,K1                  ONE TEXT PARM            Y02082 50900002
         STH   RWRK,S99TUNUM                                     Y02082 51000002
         LA    RWRK,L'UCBNAME           LENGTH OF UCBNAME        Y02082 51100002
         STH   RWRK,S99TULNG                                     Y02082 51200002
         MVC   S99TUPAR(L'UCBNAME),UCBNAME  GET UNIT NUMBER      Y02082 51300002
*                                                                       51400002
* THIS SECTION BUILDS THE STATUS TEXT UNIT.                             51500002
*                                                                       51600002
         LA    RTEXT,UNITEXTL(,RTEXT)   UPDATE TEXT UNIT BASE    Y02082 51700002
         ST    RTEXT,S99TUPTR+K8        PTR TO STATUS TEXT UNIT  Y02082 51800002
         LH    RWRK,STATUSKY                                     Y02082 51900002
         STH   RWRK,S99TUKEY            INDICATE STATUS TEXT     Y02082 52000002
         LA    RWRK,K1                                           Y02082 52100002
         STH   RWRK,S99TUNUM            ONE TEXT PARM            Y02082 52200002
         STH   RWRK,S99TULNG            LENGTH OF TEXT PARM      Y02082 52300002
         MVI   S99TUPAR,STATOLD         INDICATE DISP=OLD        Y02082 52400002
*                                                                       52500002
* THIS SECTION BUILDS THE RETURN DDNAME TEXT UNIT.                      52600002
*                                                                       52700002
         LA    RTEXT,STATEXTL(,RTEXT)   INCREMENT TEXT UNIT BASE Y02082 52800002
         ST    RTEXT,S99TUPTR+K12       PTR TO DDNAME TEXT UNIT  Y02082 52900002
         LH    RWRK,RTNDDKEY            INDICATE RETURN DDNAME   Y02082 53000002
         STH   RWRK,S99TUKEY            SPECIFICATION            Y02082 53100002
         LA    RWRK,K1                  ONE TEXT PARM            Y02082 53200002
         STH   RWRK,S99TUNUM                                     Y02082 53300002
         LA    RWRK,L'TIOEDDNM                                   Y02082 53400002
         STH   RWRK,S99TULNG            LENGTH OF DDNAME         Y02082 53500002
         XC    S99TUPAR(L'TIOEDDNM),S99TUPAR  CLEAR FOR DDNAME   Y02082 53600002
         OI    S99TUPTR+K12,S99TUPLN    INDICATE END OF LIST     Y02082 53700002
         LA    R1,VTOCDSCB              POINT TO REQ BLOCK PTR   Y02082 53800002
         DYNALLOC                       ISSUE DYNAMIC ALLOCATION Y02082 53900002
         LTR   RTNCODE,RTNCODE          TEST IF SUCCESSFUL       Y02082 54000002
         BNZ   ENDADDR                  BRANCH IF NOT            Y02082 54100002
*                                                                       55000002
* THIS SECTION SEARCHES THE DSAB CHAIN TO FIND THE ADDRESS OF THE DSAB  55100002
* WHICH POINTS TO THE TIOT ENTRY CONTAINING THE DYNAMICALLY ALLOCATED   55200002
* DDNAME. RTEXT STILL POINTS TO THE DDNAME TEXT UNIT.                   55300002
*                                                                       55400002
         L     RDSAB,DSABQDB            LOAD DSAB QDB ADDRESS    Y02082 55500002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02082 55600002
         L     RDSAB,QDBFELMP           GET FIRST DSAB ADDRESS   Y02082 55700002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02082 55800002
FINDDSAB EQU   *                        DSAB TEST                Y02082 55900002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02082 56000002
         BZ    ENDADDR                  BRANCH IF NOT            Y02082 56100002
         L     RTIOT,DSABTIOT           GET TIOT POINTER         Y02082 56200002
         USING TIOENTRY,RTIOT           TIOT ADDRESSABILITY      Y02082 56300002
         CLC   TIOEDDNM,S99TUPAR        TEST IF CORRECT DSAB     Y02082 56400002
         BE    FOUNDSAB                 BRANCH IF YES            Y02082 56500002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02082 56600002
         B     FINDDSAB                 CONTINUE SEARCH          Y02082 56700002
FOUNDSAB EQU   *                        GOT ONE                  Y02082 56800002
         OI    SISW1,UCBALLOC           SET UCB ALLOCATED BIT    Y02082 56900002
*                                                                       57000002
         OI    DSMADTB1,DSMUCBAL        SET UCB ALLOCATED BIT    Y02144 57100002
         ST    RDSAB,DSMADTW4           SAVE DSAB ADDRESS        Y02144 57200002
         ST    RDSAB,DSABADDR           SAVE DSAB ADDRESS        YM7036 57250002
         ST    RUCB,WKADEB+UCBADDR      SAVE UCB ADDRESS IN DEB  YM7036 57300002
         MVI   WKADEB+UCBADDR,DEVMOD    INSERT DEVICE MODIFIER   YM7036 57350002
         B     MOUNTED                  CONTINUE WITH RENAME     YM7036 57400002
*                                                                       67200013
*** PROGRAM CONSTANTS                                                   67500013
*                                                                       67800013
EXTCONST DC    X'FFFFFFFF7FFF'         LAST CCHH AND NUM OF TKS         68700013
         DS    0F                       FULLWORD BOUNDARY        Y02134 68800002
RETNAME  DC    CL4'3002'                RETURN NAME FOR IGG0300F Y02134 68900002
VOLSERKY DC    AL2(DALVLSER)            VOLSER TEXT UNIT KEY     Y02082 69000002
UNITKEY  DC    AL2(DALUNIT)             UNIT TEXT UNIT KEY       Y02082 69100002
STATUSKY DC    AL2(DALSTATS)            STATUS TEXT UNIT KEY     Y02082 69200002
RTNDDKEY DC    AL2(DALRTDDN)            RETURN DDNAME KEY        Y02082 69300002
*                                                                       69600002
*** TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       69900002
*                                                                       70200002
         XCTLTABL ID=(LOAD3,01,MNTLOAD,0F),SVC=030,LENGTH=,      Y02082*70500002
               BRT=YES                                           Y02082 70800002
         SPACE 2                                                 Y02082 71100002
         IECDSECS CVT,DSAB,QDB,RB,TCB,TIOT,UCB,EXPAND=YES        Y02082 71400002
WORKAREA IECRENWA EP,ADT=YES            RENAME WORK AREA         Y02144 71700002
         EJECT                                                   Y02082 72000002
*                                                                       72300002
* DSECTS FOR INVOCATING DYNAMIC ALLOCATION (SVC 99)                     72600002
*                                                                       72900002
         IEFZB4D0                       DYNAMIC ALLOCATION DSECT Y02082 73200002
         EJECT                                                   Y02082 73500002
         IEFZB4D2                       DYNAMIC ALLOCATION KEYS  Y02082 73800002
         EJECT                                                   YM7036 73850002
         IEFJFCBN                       JFCB DSECT               YM7036 73900002
         END                                                            92700013
