 TITLE 'IGG0325P - NON-SPLIT-CYLINDER DATA SET PROCESSING'              00100021
IGG0325P CSECT                                                          00150021
*                                                                     * 00200018
* MODULE NAME = IGG0325P                                                00202002
*                                                                       00204002
* DESCRIPTIVE NAME = NON-SPLIT-CYLINDER DATA SET PROCESSING             00206002
*                                                                       00206402
* COPYRIGHT = NONE                                                      00206802
*                                                                       00206902
* CHANGE ACTIVITY = SEE BELOW                                           00208702
*                                                                       00209102
*          RELEASE 19 DELETIONS                                       * 00210602
*2754154000-164000                                               A27358 00212402
*          RELEASE 20 DELETIONS                                       * 00214202
*3361064000,096000,404000-405000                                 A31534 00216002
*3361260000-267000                                               A29936 00217802
*3361114000,244000-246000,401000-403000,413000-416000            A30794 00219602
*3361007000-013000,036000,060000-061000,066000,171000-180000,    A31333 00221402
*3361195000-196000,247000,249000,285000,302000-304000,311000,    A31333 00223202
*3361331000-336000,341000-342000,351000,352000,372000,375000,    A31333 00225002
*3361381000                                                      A31333 00226802
*3361                                                            A36311 00228602
*          RELEASE 21 DELETIONS                                       * 00230402
*1191007000-013000,016000,022000,380000,389000,395000,421000,    M0124  00232202
*1191423000-432000,434000-444000,446000,447000,449000-472000,    M0124  00234002
*1191474000-476000,482000,485000,487000-489000,497000            M0124  00235802
*1191064000,136000,392000-393000,401800-402800                   S21040 00237602
*0000001000,310000                                               A53183 00239402
*          RELEASE 22 DELETIONS                                       * 00241202
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00243002
*0000000100-000500,002350-002630,036000-037000,058000,059600-    Y02080 00244802
*0000060200,062000,064000,066400,068000,075000,082000,112000,    Y02080 00246602
*0000119000-135000,139000,151000,159600-160200,162600,175600,    Y02080 00248402
*0000187000,188040-188080,188160,188400,189000,201000,204000-    Y02080 00250202
*0000205000,209000,211000,228000,236000,236600,258000,269000-    Y02080 00252002
*0000270000,275000,277000,294000-295000,313000,315000,337000-    Y02080 00253802
*0000340000,348000,352400-355000,364000,368000,372000-372500,    Y02080 00255602
*0000376000-380000,382000-383000,391000-394000,397000-400000,    Y02080 00257402
*0000400500,400600-416200,418000-433000,446000-486000,492000-    Y02080 00259202
*0000504000,506000,509000-510000,512000-574000                   Y02080 00261002
*0000011000,013000,021000-024000,026000-032000,035000-042000,    Y02078 00262802
*0000045000-047000,050000-052000,060800-061400,063000,065200-    Y02078 00264602
*0000066200,091000,118500,135500,168200-168600,168950,236300,    Y02078 00266402
*0000366000-371000                                               Y02078 00268202
*          VS2 RELEASE 03.0 DELETIONS/CHANGES                         * 00268602
*0000                                                           ZA00008 00269002
*0000168380,168410,168440,168470,168490-168500,168520-168530,   ZA00117 00269102
*0000168550                                                     ZA00117 00269202
*                                                                     * 00270018
*STATUS CHANGE LEVEL 004                                                00277021
*                                                                     * 00284018
*                                                                     * 00300018
*  NAME IGG0325P                                                      * 00400018
*                                                                     * 00500018
* FUNCTION OPERATION  THIS MODULE READS THE DSCB'S IN THE VTOC ONE    * 00600018
*   AT A TIME. IT CONVERTS NON-SPLIT CYLINDER ALLOCATED EXTENTS TO    * 00700021
*   RTA/RTA+1 FORMAT AND SUBTRACTS THESE EXTENTS FROM THE FREE SPACE  * 00800021
*   IN THE RE-INITIALIZED FORMAT 5. AT ANY POINT IN THE PROCESSING    * 00900021
*   WHEN THE FREE SPACE EXISTS IN MORE THAN 26 EXTENTS, THE MODULE    * 01000021
*   BRANCHES TO IGG0325R TO SUBTRACT FUTURE ALLOCATED EXTENTS. THE    * 01100002
*   MODULE ALSO TESTS FOR SPLIT CYLINDER DATA SETS TO DETERMINE IF    * 01200021
*   FORMAT 6 PROCESSING MUST BE DONE.  WHENEVER IGG0325P READS A      * 01210002
*   FORMAT 5 DSCB, IT STORES ITS CCHHR IN A VTOC CONVERSION WORK      * 01220002
*   AREA EXTENSION, WHICH IS CHAINED FROM THE ALLOCATE WORK AREA.     * 01230002
*   IF MORE THAN ONE FORMAT 5 DSCB IS CREATED DURING THE PROCESS      * 01240002
*   OF SUBTRACTING THE NON-SPLIT CYLINDER DATA SET EXTENTS FROM       * 01250002
*   THE FREE SPACE, THE RE-INITIALIZED FORMAT 5 DSCB'S ARE STORED     * 01260002
*   IN A VTOC CONVERSION WORK AREA EXTENSION OR EXTENSIONS.  IF       * 01270002
*   THERE WAS ORIGINALLY ONLY ONE FORMAT 5 DSCB ON THE VOLUME,        * 01280002
*   ONLY ONE FORMAT 5 WAS REBUILT, AND THERE ARE NO SPLIT CYLINDER    * 01290002
*   DATA SET EXTENTS, THEN THE REBUILT FORMAT 5 IS IN 'DSCBF5.'       * 01300002
*   OTHERWISE, THE REBUILT FORMAT 5 DSCB(S) ARE STORED IN THE VTOC    * 01310002
*   CONVERSION WORK AREA EXTENSION(S).                                * 01320002
*                                                                     * 01400018
* ENTRY POINTS                                                        * 01500018
*        IGG0325P- FROM IGG0325Z TO BEGIN BUILDING FORMAT 5 DSCB'S    * 01600021
*                  FROM IGG0325R TO PLACE MORE ALLOCATED EXTENTS      * 01700018
*                                IN THE DADSMTABLE                    * 01800018
*                                                                     * 01900018
* INPUT  FROM IGG0325Z                                                * 02000018
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH    * 02100002
*              CONTAINS THE FIRST RE-INITIALIZED FORMAT 5 DSCB AND    * 02200002
*              THE FORMAT 4 DSCB. 'COUNT' CONTAINS THE CCHHR OF THE   * 02300002
*              THIRD DSCB IN THE VTOC.                                * 02400002
*                                                                     * 02500018
*        FROM  IGG0325R                                               * 02600002
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH    * 02700002
*              CONTAINS THE FORMAT 4 DSCB, THE LAST FORMAT 1 OR 3     * 02800002
*              DSCB READ, AND THE FIRST FORMAT 5 DSCB IN THE CHAIN.   * 02900002
*              'COUNT' CONTAINS THE CCHHR OF THE NEXT DSCB TO BE READ.* 03000002
*              REGISTER 1 IS ZERO TO INDICATE REENTRY FROM IGG0325R.  * 03100002
*                                                                     * 03300018
* OUTPUT  TO IGG0325R                                                 * 03400018
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA, WHICH    * 03500002
*              CONTAINS THE FORMAT 4 DSCB, THE LAST FORMAT 1 OR 3     * 03600002
*              DSCB READ, AND THE FIRST FORMAT 5 DSCB.  THE SEEK      * 03700002
*              ADDRESS IN THE IOB CONTAINS THE CCHHR OF THE DSCB      * 03800002
*              BEING PROCESSED.  'CCW12' CONTAINS A TWO WORD          * 03900002
*              PARAMETER LIST CONSISTING OF THE NUMBER OF EXTENTS     * 04000002
*              IN THE DADSMTBL TO BE SUBTRACTED AND THE ADDRESS       * 04100002
*              OF THE FIRST EXTENT TO BE SUBTRACTED.                  * 04200002
*                                                                     * 04300018
* OUTPUT  TO IGG0325Q                                                 * 04400018
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA.  THE     * 04500002
*              HIGH WATER MARK IN THE FORMAT 4 IDSCB IS NOW VALID.    * 04600002
*              'FMTOUTAD' CONTAINS THE CCHHR OF THE FIRST FORMAT 5.   * 04700002
*              THE FIRST FORMAT 5 DSCB HAS BEEN MOVED TO THE VTOC     * 04720002
*              CONVERSION WORK AREA EXTENSION.                        * 04740002
*                                                                     * 04800018
* OUTPUT TO  IGG0325T                                                 * 04900018
*              REGISTER 13 POINTS TO THE ALLOCATE WORK AREA.  IF      * 05000002
*              THERE WAS ORIGINALLY ONLY ONE FORMAT 5 DSCB ON THE     * 05050002
*              VOLUME AND ONLY ONE FORMAT 5 WAS REBUILT, THEN THE     * 05100002
*              REBUILT FORMAT 5 IS IN 'DSCBF5.'  OTHERWISE, THE       * 05150002
*              REBUILT FORMAT 5 DSCB(S) ARE LOCATED IN THE VTOC       * 05200002
*              CONVERSION WORK AREA EXTENSION(S).                     * 05250002
*                                                                     * 05300018
* EXTERNAL ROUTINES                                                   * 05400018
*        CVTPRLTV                                                     * 05500018
*        EXCP(0)                                                      * 05600018
*        WAIT(1)                                                      * 05700018
*                                                                     * 05900018
* EXITS  NORMAL  BRANCH TO IGG0325R TO BUILD 2ND...NTH F5 DSCB'S      * 05960002
*                BRANCH TO IGG0325Q TO SUBTRACT SPLIT CYLINDER        * 06020002
*                     DATA SETS FROM THE FORMAT 5 DSCB'S AND TO       * 06080002
*                     BUILD THE FIRST F6 DSCB                         * 06140002
*                BRANCH TO IGG0325T TO CONVERT F5 DSCB'S TO CORRECT   * 06200002
*                     FORMAT AND WRITE THEM TO THE VTOC AND TO WRITE  * 06260002
*                     THE UPDATED F4 DSCB TO THE VTOC                 * 06320002
*                                                                     * 06380002
*        ERROR  BRANCH TO IGG0325T                                    * 06400002
*                                                                     * 06500018
*        ERROR CODES ISSUED BY THIS MODULE -                          * 06520002
*                                                                     * 06540002
*        0C - PERMANENT I/O ERROR                                     * 06560002
*                                                                     * 06580002
*        94 - OVERLAPPING EXTENTS IN THE VTOC                         * 06600002
*                                                                     * 06620002
* TABLE/WORK AREAS - DADSM ALLOCATE WORK AREA                         * 06640002
*                                                                     * 06700018
* ATTRIBUTES REENTRANT                                                * 06800002
*                                                                     * 06900018
*                                                                     * 07000018
*                                                                     * 07100018
REGZERO  EQU   0                       WORK REGISTER                    07200018
REENTRY  EQU   1                       INDICATES ENTRY FROM IGG0325R    07300018
REGONE   EQU   1                       WORK REGISTER                    07400018
REGTWO   EQU   2                       WORK REGISTER                    07600018
DADSMCTR EQU   3                       CTR EXTENTS IN DADSMTBL          07700018
REGTHREE EQU   3                       WORK REGISTER                    07800018
FORMATCT EQU   4                       MAX ON EXTENTS IN DSCB           07900018
REGFOUR  EQU   4                       WORK REGISTER             Y02078 07950002
EXTPTR   EQU   5                       PTR TO EXTENT BEING CONVERTED    08000018
REGFIVE  EQU   5                       WORK REGISTER             Y02078 08050002
REGSIX   EQU   6                       WORK REGISTER                    08100018
LSTF5CTR EQU   6                       NBR OF EXTENTS IN LAST F5 Y02080 08200002
REGSEVEN EQU 7                         WORKREGISTER                     08300018
F5EXTCTR EQU   7                       NO OF EXTENT BEING COMPARED      08400018
REGEIGHT EQU   8                       WORK REGISTER                    08500018
DADSMPTR EQU   8                       PTR TO EXTENT IN DADSMTBL        08600018
ALLOCADR EQU   8                       PTR TO EXTENT IN DADSMTBL        08700018
RERRPASS EQU   8                        ERROR CODE REGISTER      A31534 08750020
REGNINE  EQU   9                       WORK REGISTER                    08800018
F5ADDR   EQU   9                       PTR TO EXTENT IN F5              08900018
REGTEN   EQU   10                      WORK REGISTER                    09000018
RVTOCWKA EQU   11                      VTOC CONVERSION W/A PTR   Y02078 09100002
BASEREG  EQU   12                      BASE REGISTER                    09200018
REGTHIRT EQU   13                      WORK REGISTER                    09300018
RWKAREA  EQU   13                      BASE REGISTER TO WORK AREA       09400018
RETRNREG EQU   14                      RETURN REGISTER                  09500018
REG14    EQU   14                      WORK REGISTER             Y02078 09600002
RCVT     EQU   15                      BASE REGISTER TO CVT             09700018
*                                                                     * 09720021
* OTHER EQUATES                                                       * 09740021
*                                                                     * 09760021
ZERO     EQU   0                        VALUE ZERO                      09800018
ONE      EQU   1                        VALUE ONE                       09900018
TWO      EQU   2                        VALUE TWO                       10000018
THREE    EQU   3                        VALUE THREE                     10100018
K4       EQU   4                        CONSTANT OF 4            Y02080 10150002
FOUR     EQU   4                        VALUE FOUR                      10200018
FIVE     EQU   5                        VALUE FIVE                      10300018
SIX      EQU   6                        VALUE SIX                       10400018
SEVEN    EQU   7                        VALUE SEVEN                     10500018
EIGHT    EQU   8                        VALUE EIGHT                     10600018
THIRT    EQU   13                       VALUE THIRTEEN                  10700018
SIXTEEN  EQU   16                       VALUE SIXTEEN                   10800018
TWTYSIX  EQU   26                       VALUE TWENTY-SIX                10900018
F1ID     EQU   X'F1'                    F1 DSCB INDICATOR               11000018
F2ID     EQU   X'F2'                    F2 DSCB ID               Y02078 11050002
SPEXT    EQU   X'80'                    SPLIT CYL EXTENT INDICATOR      11100018
F3ID     EQU   X'F3'                    F3 DSCB INDICATOR               11300018
F5ID     EQU   X'F5'                    F5 DSCB ID               Y02078 11400002
F5INDIC  EQU   X'05'                    F5 DSCB INDICATOR               11500018
C32      EQU   32                       VALUE THIRTY-TWO                11600018
GOODIO   EQU   X'20'                    TEST VALUE FOR SUCCESSFUL I/O   11700018
ERRCD    EQU   X'0C'                    ERROR CODE FOR UNSUCCESSFUL I/O 11800018
VTOCERR  EQU   X'94'                    OVERLAPPING XTENTS ERROR Y02078 11850002
NOCC     EQU   X'00'                    NO COMMAND CHAINING      Y02080 11900002
CC       EQU   X'40'                    COMMAND CHAINING BIT     Y02080 12300002
TEN      EQU   10                       VALUE 10                 A31333 13570020
K12      EQU   12                       VALUE OF 12              Y02080 13620002
*                                                                     * 13630021
         BALR  BASEREG,ZERO             INT. BASE REGISTER              13700018
         USING *,BASEREG                                                13800018
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 13900002
         USING   CVT,RCVT                                               14000018
         USING IECPREFX,REGTEN          PREFIX ADDRESSABILITY    Y02078 14010002
         USING VTOCWKA,RVTOCWKA         WORK AREA ADDRESSABILITY Y02078 14020002
*                                                                       14050002
         LTR   REENTRY,REENTRY         IS THIS REENTRY                  14100018
         BZ    RETURNPT                 BRANCH IF YES                   14200018
*                                                                     * 14300018
* INITIALIZE CHANNEL PROGRAM TO READ F1 AND F3 DSCB'S                 * 14400018
*                                                                     * 14500018
         LA    DADSMCTR,FIVE            INT. CTR OF EXTENTS IN DADSMTBL 14600018
         LA    REGEIGHT,DADSMTBL                                        14700018
*                                                                     * 14800018
* TEST END OF VTOC SWITCH AND READ THE NEXT DSCB IN THE VTOC          * 14900018
*                                                                     * 15000018
TESTSW   EQU   *                        BRANCH LABEL             Y02080 15050002
         TM    ASWITCH,EOVSW            IS END OF VTOC SWITCH ON Y02080 15100002
         BO    FINISHF5                 BRANCH IF YES                   15200018
         MVC   SEEKCYL(FIVE),COUNT      MOVE CCHHR OF NEXT DSCB TO IOB  15300018
*                                                                     * 15360019
* TEST FOR END OF VTOC.  IF THE DSCB TO BE READ IS THE LAST DSCB IN   * 15420019
* THE VTOC, REMOVE THE READ COUNT CCW FROM THE CHANNEL PROGRAM TO     * 15480019
* PREVENT COMMAND REJECTS (SEEKING OFF THE VOLUME) IF THERE IS NO     * 15540019
* COUNT FIELD AFTER THE VTOC.  SET EOV SWITCH IF LAST DSCB.           * 15600019
*                                                                     * 15660019
         CLC   SEEKCYL(FOUR),DS4VTOC6   Q - LAST TRACK IN VTOC   A27358 15720019
         BNE   NOTLAST                  IF NOT, BR               A27358 15780019
         CLC   SEEKREC(ONE),DS4DEVDT    Q - LAST RCD ON TRACK    A27358 15840019
         BNE   NOTLAST                  IF NOT, BR               A27358 15900019
         OI    ASWITCH,EOVSW            SET END OF VTOC SWITCH   Y02080 15960002
         MVI   CCW6+K4,NOCC             BREAK RD COUNT FROM      Y02080 16020002
*                                       CHAIN                    A27358 16080019
NOTLAST  EQU   *                                                 A27358 16140019
         BAL   RETRNREG,EXCHANPG        READ NEXT DSCB           A27358 16200019
         MVI   CCW6+K4,CC               RESTORE READ COUNT TO    Y02080 16260002
*                                       CHAIN                    A27358 16320019
*                                                                     * 16500018
* TEST FOR FORMAT ONE OR FORMAT 3 DSCB. IF FORMAT ONE CHECK FOR SPLIT * 16600018
* CYLINDER DATA SET,UPDATE HIGH WATER MARK                            * 16700018
*                                                                     * 16800018
F1ORF3   CLI   DS1FMTID,ZERO           IS THIS A ZERO DSCB       8M3261 16810018
         BNE   NOTF0                    BRANCH IF NOT            Y02078 16811002
         CLC   DS1DSNAM(FOUR),ZEROS     TEST FOR KEY OF ZEROS    Y02078 16812002
         BE    TESTSW                   BRANCH IF TRUE F0 DSCB   Y02078 16813002
DECRMENT EQU   *                        BRANCH LABEL             Y02078 16814002
         LH    REGONE,DS4DSREC          GET HOLE COUNT           Y02078 16815002
         BCTR  REGONE,ZERO              DECREMENT HOLE COUNT     Y02078 16816002
         STH   REGONE,DS4DSREC          SAVE UPDATED COUNT       Y02078 16817002
         B     TESTSW                   GO READ NEXT DSCB        Y02078 16818002
NOTF0    EQU   *                        BRANCH LABEL             Y02078 16819002
         CLI   DS1FMTID,F2ID            TEST FOR FORMAT 2 DSCB   Y02078 16820002
         BE    DECRMENT                 BRANCH IF FORMAT 2 DSCB  Y02078 16821002
         CLI   DS1FMTID,F5ID            TEST IF FORMAT 5 DSCB    Y02078 16822002
         BH    DECRMENT                 BRANCH IF F6 OR HIGHER   Y02078 16823002
         BL    CHECK1                   BRANCH IF F1 OR F3 DSCB  Y02078 16824002
         BAL   RETRNREG,PREFXADR        GO GET PREFIX ADDRESS    Y02078 16825002
NEXTADR1 EQU   *                        PREFIX ADDRESS IN REG 10 Y02078 16827002
         CLC   IECCORPS,IECCORP2        TEST FOR ANOTHER WKAREA  Y02078 16828002
         BE    NEWKAREA                 BRANCH IF NO EXTENSION   Y02078 16829002
         L     REGTEN,IECCORP2          LOAD ADDR OF NEXT PREFIX Y02078 16830002
         CLC   IECCORID,VCWKAID         TEST IF VTOC WORK AREA   Y02078 16831002
         BNE   NEXTADR1                 BRANCH IF NOT            Y02078 16832002
         XR    REGFOUR,REGFOUR          CLEAR FOR DIVISION       Y02078 16833002
         LH    REGFIVE,F5FNDCT          GET NUMBER OF FOUND F5'S Y02078 16834002
         D     REGFOUR,FW3              3 F5'S PER WKA EXTENSION Y02078 16835002
         LTR   REGFOUR,REGFOUR          TEST FOR AN EMPTY SLOT   Y02078 16836002
*                                       IN A WORK AREA EXTENSION Y02078 16837002
         BZ    TOPSLOT                  BR IF F5 IN TOP SLOT OF ZA00117 16838002
*                                       A VCWA. CHECK IF        ZA00117 16838402
*                                       PRESENT                 ZA00117 16838602
         CL    REGFIVE,ZEROS            TEST IF ONLY 1 EXTENSION Y02078 16839002
*                                       WITH FOUND F5 IN IT     ZA00117 16839202
         BE    LOADADDR                 BRANCH IF ONLY 1         Y02078 16840002
NEXTADR2 EQU   *                        LOOP TILL LAST VCWA     ZA00117 16841002
*                                       WITH FOUND F5S IN IT    ZA00117 16841202
         L     REGTEN,IECCORP2          LOAD ADDR OF NEXT PREFIX Y02078 16842002
         BCT   REGFIVE,NEXTADR2         LOAD ADDR OF LAST PREFIX Y02078 16843002
*                                       WITH FOUND F5S IN IT    ZA00117 16843202
LOADADDR EQU   *                        GET SLOT 1, 2, OR 3     ZA00117 16844002
         L     RVTOCWKA,IECCORAD        LOAD ADDR OF LAST WKAREA Y02078 16845002
         LA    REG14,VTCCHHR1           ADDR OF 1ST CCHHR SLOT  ZA00117 16847002
         LTR   REGFOUR,REGFOUR          FIRST ENTRY IN VCWA     ZA00117 16847202
         BZ    NXTCCHHR                 BRANCH IF YES           ZA00117 16847402
         LA    REG14,VTCNXTF5(REG14)    POINT TO 2ND SLOT       ZA00117 16847602
         BCT   REGFOUR,INCRPTR          FIND ADDR OF EMPTY SLOT  Y02078 16848002
NXTCCHHR EQU   *                        PUT CCHHR IN PROPER     ZA00117 16849002
*                                       SLOT                    ZA00017 16849202
         MVC   ZERO(FIVE,REG14),SEEKCYL MOVE IN FOUND F5 CCHHR   Y02078 16850002
         B     UPF5CNT                  GO INCREMENT F5FNDCT     Y02078 16851002
INCRPTR  EQU   *                        THIRD SLOT NEEDED       ZA00117 16852002
         LA    REG14,VTCNXTF5(REG14)    POINT TO 3RD CCHHR SLOT ZA00117 16853002
         B     NXTCCHHR                 GO MOVE IN THE CCHHR     Y02078 16854002
TOPSLOT  EQU   *                        IS VCWA AVAILABLE FOR   ZA00117 16854402
*                                       NEW FORMAT 5            ZA00117 16854502
         CLC   F5FNDCT,F5BLDCT          FOUND LESS THAN BUILT   ZA00117 16854902
         BL    NEXTADR2                 BR YES-SLOT AVAILABLE   ZA00117 16856202
NEWKAREA EQU   *                        BRANCH LABEL             Y02078 16859202
         BAL   RETRNREG,GETWKA          GO GET WKAREA EXTENSION  Y02078 16860502
         CLC   F5FNDCT,ONEF5            TEST IF ONLY 1 FOUND F5  Y02078 16861802
         BNE   MOVEF5AD                 BRANCH IF MORE THAN 1    Y02078 16863102
         MVC   VTCCHHR1,FMTOUTAD        MOVE IN CCHHR OF 1ST F5  Y02078 16864402
         MVC   VTCCHHR2,SEEKCYL         MOVE IN CCHHR OF 2ND F5  Y02078 16865702
         B     UPF5CNT                  GO INCREMENT F5FNDCT     Y02078 16867002
MOVEF5AD EQU   *                        BRANCH LABEL             Y02078 16868302
         MVC   VTCCHHR1,SEEKCYL         MOVE IN CCHHR OF THIS F5 Y02078 16869602
UPF5CNT  EQU   *                        BRANCH LABEL             Y02078 16870902
         LH    REGONE,F5FNDCT           GET NBR OF FOUND F5'S    Y02078 16872202
         LA    REGONE,ONE(REGONE)       INCREMENT THIS NUMBER    Y02078 16873502
         STH   REGONE,F5FNDCT           SAVE UPDATED COUNT       Y02078 16874802
         B     TESTSW                   GO READ NEXT DSCB        Y02078 16876102
CHECK1   EQU   *                        BRANCH LABEL             Y02078 16877402
         LH    REGONE,DS4DSREC         GET HOLE COUNT            8M3261 16878702
         BCTR  REGONE,REGZERO          DECREMENT HOLE OCUNT      8M3261 16880018
         STH   REGONE,DS4DSREC         SAVE NOW HOLE COUNT       8M3261 16890018
         CLI   DS1FMTID,F1ID           IS THIS A F1 DSCB         8M3261 16900018
         BNE   CHECK3                   BRANCH IF NO                    17000018
         LA    REGONE,DS1EXT1           POINT TO FIRST EXTENT    A31333 17070020
         LA    REGTWO,DS1PTRDS          POINT TO END OF 3        A31333 17140020
*                                       EXTENTS                  A31333 17210020
TESTF1   EQU   *                                                 A31333 17280020
         CLI   ZERO(REGONE),SPEXT       TEST IF SPLIT CYL DATA   A31333 17350020
*                                       SET                      A31333 17420020
         BNE   MOVEPTR1                 BRANCH IF NOT SPLIT CYL  A31333 17490020
         OI    ASWITCH,SPCYLSW          SET SPLIT CYLINDER       Y02080 17560002
*                                       SWITCH                   A31333 17630020
MOVEPTR1 EQU   *                                                 A31333 17700020
         LA    REGONE,TEN(REGONE)       INCREMENT EXTENT POINTER A31333 17770020
         CR    REGONE,REGTWO            TEST IF 3 EXTENTS TESTED A31333 17840020
         BL    TESTF1                   BRANCH IF NOT            A31333 17910020
HIWATER  MVC   DS4HPCHR(FIVE),SEEKCYL   UPDATE HIGH WATER MARK          18100018
         LA    EXTPTR,DS1EXT1           INT PTR TO FIRST EXT            18200018
         CLI   ZERO(EXTPTR),ZERO        IS THIS A MODEL DSCB            18300018
         BE    TESTSW                   BRANCH IF YES                   18400018
         LA    FORMATCT,THREE           INT CTR OF NO EXTENTS IN F1     18500018
         B     CONVERT                  BRANCH TO CONVERT EXTENTS       18600018
CHECK3   EQU   *                        BRANCH LABEL             Y02080 18650002
         CLI   DS3FMTID,F3ID            IS THIS F3 DSCB          Y02080 18700002
         BNE   TESTSW                   BRANCH IF NO                    18800018
         LA    REGONE,DS3EXTNT          POINT TO FIRST F3 EXTENT Y02080 18804002
         LA    REGTWO,DS3FMTID          POINT TO END OF 4        Y02080 18808002
*                                       EXTENTS                  A31333 18812020
         LA    REGTEN,DS3PTRDS          POINT TO END OF 13       Y02080 18816002
*                                       EXTENTS                  A31333 18820020
TESTF3   EQU   *                                                 A31333 18824020
         CLI   ZERO(REGONE),SPEXT       TEST IF SPLIT CYL DATA   A31333 18828020
*                                       SET                      A31333 18832020
         BNE   MOVEPTR3                 BRANCH IF NOT            A31333 18836020
         OI    ASWITCH,SPCYLSW          SET SPLIT CYLINDER       Y02080 18840002
*                                       SWITCH                   A31333 18844020
MOVEPTR3 EQU   *                                                 A31333 18848020
         LA    REGONE,TEN(REGONE)       INCREMENT EXTENT POINTER A31333 18852020
         CR    REGONE,REGTWO            WAS 4TH F3 EXTENT JUST   A31333 18856020
*                                       TESTED                   A31333 18860020
         BNE   TESTALL                  BRANCH IF NOT            A31333 18864020
         LA    REGONE,ONE(REGONE)       INCREMENT PAST F3 ID     A31333 18868020
TESTALL  EQU   *                                                 A31333 18872020
         CR    REGONE,REGTEN            TEST IF 13 EXTENTS       A31333 18876020
*                                       TESTED                   A31333 18880020
         BL    TESTF3                   BRANCH IF NOT            A31333 18884020
         LA    EXTPTR,DS3EXTNT          POINT TO 1ST F3 EXTENT   Y02080 18900002
         LA    FORMATCT,THIRT           INT. CTR OF NO. EXTENTS IN F3   19000018
*                                                                     * 19100018
* CONVERT AN EXTENT FORM CCHH/CCHH TO RTA/RTA+1  USING THE RESIDENT   * 19200018
* CONVERSION ROUTINE                                                  * 19300018
*                                                                     * 19400018
CONVERT  EQU   *                                                 A31333 19430020
         CLI   ZERO(EXTPTR),SPEXT       TEST IF SPLIT CYL DATA   A31333 19460020
*                                       SET                      A31333 19490020
         BNE   BGINCONV                 BRANCH IF NOT            A31333 19520020
         LA    EXTPTR,TEN(EXTPTR)       POINT TO NEXT EXTENT     A31333 19550020
         B     CONVNEXT                 BRANCH TO CONVERT NEXT   A31333 19580020
*                                       EXTENT                   A31333 19610020
BGINCONV EQU   *                                                 A31333 19640020
         LA    REGSEVEN,TWO             SET LOOP CONTROL                19700018
         AR    EXTPTR,REGSEVEN          GET PTR TO BEGINNING CCHH       19800018
         LA    REGTWO,CCW12             GET PTR TO ADDR MBBCCHHR INPUT  19900018
         LA    REGONE,DEB               GET PTR TO DEB                  20000018
ROUTINE  EQU   *                        BRANCH LABEL             Y02080 20050002
         STM   REGEIGHT,REGTHIRT,IECREGSV+K12  SAVE REGISTERS    Y02080 20100002
         LR    REGEIGHT,REGTHIRT                                        20200018
         DROP  REGTHIRT                                                 20300018
         USING ALLOCWKA,REGEIGHT        WORK AREA ADDRESSABILITY Y02080 20400002
         MVC   CCW12+THREE(FOUR),ZERO(EXTPTR)  MOVE IN CCHH      Y02080 20500002
         L     RCVT,CVTPTR              LOAD CVT BASE                   20600018
         L     RCVT,CVTPRLTV            LOAD TTR CONVERT RTN BASE       20700018
         BALR  RETRNREG,RCVT            CONVERT EXTENT                  20800018
         LM    REGEIGHT,REGTHIRT,IECREGSV+K12  RESTORE REGISTERS Y02080 20900002
         DROP  REGEIGHT                                                 21000018
         USING ALLOCWKA,RWKAREA         WORK AREA ADDRESSABILITY Y02080 21100002
         SRA   REGSEVEN,ONE             DECREMENT LOOP CONTROL          21200018
         SRL   REGZERO,SIXTEEN          POSITION IT FOR STORING         21300018
         LTR   REGSEVEN,REGSEVEN        HAS UPPER CCHH BEEN CONVERTED   21400018
         BNE   CONT                     BRANCH IF NO                    21500018
         LA    REGSIX,ONE                                               21600018
         AR    REGZERO,REGSIX          ADD 1 TO UPPER CCHH TO MAKE IT   21700018
*                                       RTA+1                         * 21800018
CONT     STH   REGZERO,ZERO(DADSMPTR)   STORE RTA OR RTA+1              21900018
         LA    REGZERO,TWO                                              22000018
         AR    DADSMPTR,REGZERO         UPDATE PTR TO NEXT SPACE IN     22100018
*                                       DADSMTBL                      * 22200018
         LA    REGSIX,FOUR                                              22300018
         AR    EXTPTR,REGSIX            UPDATE PTR TO NEXT EXTENT TO    22400018
*                                       BE CONVERTED                  * 22500018
         LTR   REGSEVEN,REGSEVEN        HAS RTA+1 JUST BEEN STORED      22600018
         BNE   ROUTINE                  BRANCH IF NO                    22700018
         STM   FORMATCT,EXTPTR,CCW11    SAVE PTR TO NEXT EXTENT  Y02080 22800002
*                                                                     * 22900018
* TEST DADSMCTR TO DETERMINE IF  5 EXTENTS HAVE BEEN CONVERTED AS YET * 23000018
* IF 5 EXTENTS HAVE BEEN CONVERTED,GO TO SUBTRACT ROUTINE. IF NOT     * 23100018
* CALCULATE ADDR OF NEXT EXTENT TO BE CONVERTED                       * 23200018
*                                                                     * 23300018
         BCT   DADSMCTR,CONVNEXT        BRANCH IF DADSMTBL NOT FULL     23400018
         BAL   RETRNREG,ORDER           GO TO ORDER AND SUB EXTENTS     23500018
RETURNPT EQU   *                        BRANCH LABEL             Y02080 23550002
         LM    FORMATCT,EXTPTR,CCW11    LOAD PTR TO NEXT EXTENT  Y02080 23600002
         LA    DADSMCTR,FIVE                                            23700018
         LA    DADSMPTR,DADSMTBL                                        23800018
         XC    DADSMTBL,DADSMTBL        ZERO DADSMTBL                   23900018
CONVNEXT BCTR  FORMATCT,ZERO            DECREMENT CTR                   24000018
         LTR   FORMATCT,FORMATCT        ARE THERE MORE EXTENTS IN F1    24100018
*                                       OR F3                         * 24200018
         BZ    TESTSW                   BRANCH IF NO                    24300018
         CH    FORMATCT,EXTSIX          WAS PREVIOUS EXTENT NO.  A30794 24400020
*                                       6                        A30794 24500020
         BNE   TESTUSED                 BRANCH IF NO             A31333 24600020
         LA    EXTPTR,ONE(EXTPTR)                                       24800018
TESTUSED EQU   *                                                 A31333 24900020
         CLI   ZERO(EXTPTR),ZERO        IS NEW EXTENT UNUSED            25000018
         BE    TESTSW                   BRANCH IF YES                   25100018
         B     CONVERT                  BRANCH TO CONVERT NEXT EXTENT   25200018
*                                                                     * 25300018
* PUT THE CONVERTED EXTENTS IN THE DADSMTBL INTO ASCENDING ORDER      * 25400018
*                                                                     * 25500018
ORDER    LA    REGNINE,FIVE                                             25600018
         SR    REGNINE,DADSMCTR         FIND NO. EXTENTS IN TABLE       25700018
         ST    REGNINE,PDLIST5          SAVE NUMBER OF EXTENTS   Y02080 25800002
NEXTPASS LA    REGTEN,DADSMTBL          GET ADDR. BEGINNING OF TABLE    25900018
COMPARE  EQU   *                                                 A29936 25950020
         LM    REGZERO,REGTWO,ZERO(REGTEN) PICK UP FIRST 3       A29936 26000020
*                                       EXTENTS                  A29936 26050020
         LTR   REGONE,REGONE            IS THERE ONLY ONE EXTENT A29936 26100020
         BZ    LASTXTNT                 BRANCH IF YES            A29936 26150020
         CR    REGZERO,REGONE           COMPARE TWO ADJACENT     A29936 26200020
*                                       EXTENTS                  A29936 26250020
         BL    UPDATPTR                 IF 1ST LOW, DO NOT       A29936 26300020
*                                       SWITCH                   A29936 26350020
         ST    REGONE,ZERO(,REGTEN)     SWITCH CONTENTS OF THE   A29936 26400020
         ST    REGZERO,FOUR(,REGTEN)    TWO ADJACENT EXTENTS     A29936 26450020
UPDATPTR EQU   *                                                 A29936 26500020
         AR    REGTEN,REGSIX            POINT TO NEXT EXTENT     A29936 26550020
LASTXTNT EQU   *                                                 A29936 26600020
         LTR   REGTWO,REGTWO            IS THIS THE LAST EXTENT  A29936 26650020
         BNZ   COMPARE                  BRANCH IF NO             A29936 26700020
         BCT   REGNINE,NEXTPASS         DECREMENT CTR OF NO OF PASSES   26800018
         L     REGTEN,PDLIST5           GET NBR EXTENTS IN TABLE Y02080 26900002
*                                                                     * 27100018
* THIS ROUTINE BUILDS THE FIRST FORMAT 5 DSCB. WHEN THE FIRST FORMAT  * 27200018
* 5 DSCB IS FULL, THE MERGE FLAG IS SET AND XCTL IS MADE TO THE       * 27300018
* SECOND LOAD TO SUBTRACT THE EXTENTS IN THE DADSMTBL.                * 27400018
*                                                                     * 27450002
         TM    ASWITCH,MERGESW          TEST IF MORE THAN ONE F5 Y02080 27500002
         BO    GOTOTRIL                 BRANCH IF YES                   27600018
         LH    LSTF5CTR,LSTF5CT         GET NUMBER OF EXTENTS    Y02080 27700002
*                                       IN THE LAST F5 DSCB      Y02080 27750002
         LA    F5ADDR,DS5AVEXT          POINT TO BEGINNING F5           27800018
         LA    F5EXTCTR,ONE             CTR EXTS IN F5 BEING COMPARED   27900018
         LA    ALLOCADR,DADSMTBL        GET ADDR 1ST EXTENT TO BE SUBT  28000018
NEWCOMP  CLC   ZERO(TWO,ALLOCADR),ZERO(F5ADDR) COMPARE BEGIN EXTENTS    28100018
         BL    DSERROR                  BRANCH IF NEW EXTENT LOW        28200018
         BH    MORECK                   BRANCH IF NEW EXTENT HIGH       28300018
         CLC   TWO(TWO,ALLOCADR),TWO(F5ADDR) ARE ENDS EXTENTS EQUAL     28400018
         BH    DSERROR                  ERROR IF EXTENT TO BE    A31333 28440020
*                                       SUBTRACTED IS GREATER           28480020
*                                       THAN FREE EXTENT                28520020
         BL    REPLACE                  BRANCH IF LOWER          A31333 28560020
WIPEOUT  LA    REGONE,TWTYSIX                                           28600018
         SR    REGONE,F5EXTCTR          CALCULATE LOOP CONTROL          28700018
         BZ    ZERO26                   EQUAL TO LAST EXTENT    ZA00008 28750002
*                                       IN FORMAT 5             ZA00008 28760002
         LR    REGTHREE,F5ADDR                                          28800018
MOVEFLD  MVC   ZERO(FIVE,REGTHREE),FIVE(REGTHREE) WIPEOUT ALLOCATED EXT 28900018
         LA    REGTHREE,FIVE(REGTHREE)  GET ADDR NEXT E                 29000018
         BCT   REGONE,MOVEFLD           DECREMENT LOOP CONTROL          29100018
ZERO26   EQU   *                                                ZA00008 29110002
         XC    F5EXT16(FIVE),F5EXT16    CLEAR 26TH EXTENT        Y02080 29120002
         BCTR  LSTF5CTR,ZERO            DECREMENT COUNTER        Y02080 29140002
CHNGPTR  LA    ALLOCADR,FOUR(ALLOCADR)  POINT TO NEXT EXTENT TO BE SUBT 29200018
         BCT   REGTEN,NEWCOMP           DECREMENT CTR EXTENT TO BE SUBT 29300018
         STH   LSTF5CTR,LSTF5CT         SAVE COUNTER OF EXTENTS  Y02080 29400002
*                                       IN LAST F5 BEING BUILT   Y02080 29450002
         ST    REGTEN,PDLIST5           ZERO OUT                 Y02080 29500002
         BR    RETRNREG                 RETURN TO OBTAIN VORE EXTENTS   29600018
REPLACE  MVC   ZERO(TWO,F5ADDR),TWO(ALLOCADR) UPDATE EXTENT BOUNDRIES   29700018
         B     CHNGPTR                  BRANCH TO POINT TO NEW F5 EXT   29800018
MORECK   CLC   ZERO(TWO,ALLOCADR),TWO(F5ADDR) IS EXT TO BE SUBT IN THIS 29900018
*                                       FREE EXTENT                   * 30000018
         BNL   POINTNXT                 BRANCH IF NO                    30100018
         CLC   TWO(TWO,ALLOCADR),TWO(F5ADDR) COMPARE END EXTENT  A31333 30160020
*                                       TO BE SUBTRACTED TO END         30220020
*                                       OF FREE EXTENT                  30280020
         BH    DSERROR                  ERROR IF HIGHER          A31333 30340020
         BL    TWOEXTS                  BRANCH IF LOWER          A31333 30400020
         MVC   TWO(TWO,F5ADDR),ZERO(ALLOCADR) UPDATE EXTENT BOUNDRY     30500018
         B     CHNGPTR                 BRANCH TO POINT TO NEW F5 EXT    30600018
POINTNXT LA    F5ADDR,FIVE(F5ADDR)      POINT TO NEXT FREE EXTENT       30700018
         LA    F5EXTCTR,ONE(F5EXTCTR)   UPDATE CTR EXTENT BEING         30800018
*                                       COMPARED                      * 30900018
         CLC   ZERO(FOUR,F5ADDR),ZEROS  IS NEW EXTENT ZERO       A53183 31000021
         BE    DSERROR                  ERROR IF EXTENT TO BE    A31333 31050020
*                                       SUBTRACTED IS NOT WITHIN        31100020
*                                       ANY FREE EXTENT                 31150020
         B     NEWCOMP                   BRANCH TO START COMPARISON     31200018
TWOEXTS  EQU   *                        BRANCH LABEL             Y02080 31250002
         LA    LSTF5CTR,ONE(LSTF5CTR)   INCREMENT COUNT          Y02080 31300002
         LA    REGTWO,TWTYSIX                                           31400018
         CR    LSTF5CTR,REGTWO          IS LAST F5 FULL          Y02080 31500002
         BH    PREPPARM                 BRANCH IF YES                   31600018
         LA    REGTWO,FIVE              LOAD INCREMENT REGISTER         31700018
         LA    REGTHREE,F5EXT15                                         31800018
MOVE     MVC   FIVE(FIVE,REGTHREE),ZERO(REGTHREE)  MOVE A FIELD         31900018
         CR    F5ADDR,REGTHREE          HAVE NECESSARY FIELDS BEEN      32000018
*                                       MOVED                         * 32100018
         BE    CONTIN                   BRANCH IF YES                   32200018
         SR    REGTHREE,REGTWO          DECREMENT MOVE ADDR             32300018
         B     MOVE                     BRNACH TO MOVE NEXT FIELD       32400018
CONTIN   MVC   SEVEN(TWO,F5ADDR),TWO(F5ADDR) SET UP                     32500018
         MVC   TWO(TWO,F5ADDR),ZERO(ALLOCADR)   TWO NEW                 32600018
         MVC   FIVE(TWO,F5ADDR),TWO(ALLOCADR)        EXTENTS            32700018
         LA    F5EXTCTR,ONE(F5EXTCTR)                                   32800018
         LA    F5ADDR,FIVE(F5ADDR)      POINT TO NEXT FREE EXTENT       32900018
         B     CHNGPTR                  BRNACH TO POINT TO NEW F5 EXT   33000018
DSERROR  EQU   *                                                 A31333 33100020
         LA    RERRPASS,VTOCERR         SET ERROR CODE OF X'48'  A31333 33200020
         B     ERREXIT                  GO XCTL TO IGG0325H      A31333 33300020
*                                                                       33350002
* THIS SECTION SETS UP A PARAMETER LIST IN CCW12 FOR MODULE IGG0325R.   33400002
*                                                                       33450002
PREPPARM EQU   *                        BRANCH LABEL             Y02080 33500002
         ST    ALLOCADR,CCW12+K4        PUT ADDR NEXT EXTENT TO  Y02080 33700002
*                                       SUBTRACT IN PARM LIST    Y02080 33800002
         OI    ASWITCH,MERGESW          SET MULTIPLE F5 SWITCH   Y02080 33900002
         STH   LSTF5CTR,LSTF5CT         SAVE COUNTER OF EXTENTS  Y02080 34000002
*                                       IN LAST F5 DSCB          Y02080 34050002
         ST    REGTEN,CCW12             PUT NO. EXTENTS TO BE SUBTRACT  34300018
*                                       IN PARAMETER LIST             * 34400018
         BAL   RETRNREG,PREFXADR        GO GET PREFIX ADDRESS    Y02078 34405002
NEXTPTR  EQU   *                        PREFIX ADDRESS IN REG 10 Y02078 34410002
         CLC   IECCORPS,IECCORP2        TEST FOR ANOTHER WKAREA  Y02078 34415002
         BE    FIRSTWKA                 BRANCH IF NO EXTENSION   Y02078 34420002
         L     REGTEN,IECCORP2          LOAD ADDR OF NEXT PREFIX Y02078 34425002
         CLC   IECCORID,VCWKAID         TEST IF VTOC WORK AREA   Y02078 34430002
         BNE   NEXTPTR                  BRANCH IF NOT            Y02078 34435002
         L     RVTOCWKA,IECCORAD        LOAD ADDR OF EXTENSION   Y02078 34440002
INITWKA  EQU   *                        BRANCH LABEL             Y02078 34445002
         MVC   VTC1STF5,DSCBF5          MOVE IN FIRST REBUILT F5 Y02078 34450002
         ST    RVTOCWKA,LASTF5AD        INITIALIZE LAST F5 ADDR  Y02078 34455002
         B     BELOW                    BELOW                           34500018
FIRSTWKA EQU   *                        BRANCH LABEL             Y02078 34520002
         BAL   RETRNREG,GETWKA          GO GET WKAREA EXTENSION  Y02078 34540002
         MVC   VTCCHHR1,FMTOUTAD        MOVE IN CCHHR OF 1ST F5  Y02078 34560002
         B     INITWKA                  MOVE IN 1ST REBUILT F5   Y02078 34580002
GOTOTRIL LA    ALLOCADR,DADSMTBL        PUT ADDR NEXT EXTENT TO BE      34600018
*                                       SUBTRACTED IN PARAMETER LIST  * 34700018
         ST    ALLOCADR,CCW12+K4                                 Y02080 34800002
         ST    REGTEN,CCW12             PUT NO. EXTENTS TO BE SUBT.     34900018
*                                       IN PARAMETER LIST             * 35000018
BELOW    EQU   *                                                 A31333 35060020
         MVI   CCW12,ZERO               SET BYTE TO SHOW ENTRY   A31333 35120020
*                                       FROM IGG0325P                   35180020
         LA    REGTWO,NEXTLOAD          POINT TO ID OF IGG0325R  Y02080 35230002
         B     XCTLHERE                 BRNACH TO XCTL                  35600018
*                                                                       35602002
* THIS ROUTINE CALCULATES THE ADDRESS OF THE INITIAL PREFIX AND         35604002
* RETURNS THIS ADDRESS IN REGISTER 10.                                  35606002
*                                                                       35608002
PREFXADR EQU   *                        BRANCH LABEL             Y02078 35610002
         LA    REGTEN,ZERO(RWKAREA)     INITIAL WORK AREA ADDR   Y02078 35612002
         LA    REGONE,IECEXTPR-IECPREFX  LENGTH OF PREFIX        Y02078 35614002
         SR    REGTEN,REGONE            CALCULATE PREFIX ADDRESS Y02078 35616002
         BR    RETRNREG                 RETURN                   Y02078 35618002
*                                                                       35620002
* THIS ROUTINE OBTAINS A VTOC CONVERSION WORK AREA EXTENSION AND        35622002
* RETURNS ITS ADDRESS IN REGISTER RVTOCWKA.                             35624002
*                                                                       35626002
GETWKA   EQU   *                        BRANCH LABEL             Y02078 35628002
         IECRES GET,EXTPR=(RWKAREA),LV=VWALNGTH,ID=VCWA,         Y02078X35630002
               STM=(REGTWO,RETRNREG,IECREGSV+K12)                Y02078 35632002
         LR    RVTOCWKA,REGONE          LOAD WKA EXTENSION ADDR  Y02078 35634002
         BR    RETRNREG                 RETURN                   Y02078 35636002
*                                                                       35638002
* THIS ROUTINE CALCULATES THE ADDRESS OF THE FIRST VTOC CONVERSION      35640002
* WORK AREA EXTENSION AND MOVES THE FIRST REBUILT FORMAT 5 INTO IT.     35642002
*                                                                       35644002
MOVEF5IN EQU   *                        BRANCH LABEL             Y02078 35646002
         BAL   RETRNREG,PREFXADR        GO GET PREFIX ADDRESS    Y02078 35648002
NXTPREFX EQU   *                        PREFIX ADDRESS IN REG 10 Y02078 35650002
         L     REGTEN,IECCORP2          LOAD ADDR OF NEXT PREFIX Y02078 35652002
         CLC   IECCORID,VCWKAID         TEST IF VTOC WORK AREA   Y02078 35654002
         BNE   NXTPREFX                 BRANCH IF NOT            Y02078 35656002
         L     RVTOCWKA,IECCORAD        LOAD ADDR OF EXTENSION   Y02078 35658002
         MVC   VTC1STF5,DSCBF5          MOVE IN FIRST REBUILT F5 Y02078 35660002
         ST    RVTOCWKA,LASTF5AD        INITIALIZE LAST F5 ADDR  Y02078 35662002
         BR    REGTWO                   RETURN                   Y02078 35664002
*                                                                     * 35698002
* END OF VOLUME ROUTINE                                               * 35700018
*                                                                     * 35800018
FINISHF5 LA    REGNINE,FIVE                                             35900018
         SR    REGNINE,DADSMCTR                                         36000018
         LTR   REGNINE,REGNINE          ARE EXTENTS TO BE SUBTRACTED    36100018
         BE    TESTSPL                 BRANCH IF NO                     36200018
         BAL   RETRNREG,ORDER           BRNACH TO ORDER EXTENTS         36300018
*                                                                       36310002
* THIS SECTION DETERMINES THE NEXT MODULE TO RECEIVE CONTROL.           36320002
*                                                                       36330002
TESTSPL  EQU   *                        BRANCH LABEL             Y02080 36350002
         TM    ASWITCH,MERGESW          ARE NEW F5'S ON VOLUME   Y02080 36400002
         BO    SPTEST                   BRANCH IF YES                   36500018
         TM    ASWITCH,SPCYLSW          TEST FOR SPLIT CYL D/S   Y02078 36540002
         BNO   ONEF5TST                 BRANCH IF NONE FOUND     Y02078 36580002
         LA    REGTWO,LOAD4             PREPARE RETURN ADDRESS   Y02078 36620002
         CLC   F5FNDCT,ONEF5            TEST IF ONLY 1 FOUND F5  Y02078 36660002
         BNE   MOVEF5IN                 BRANCH IF MORE THAN 1    Y02078 36700002
         BAL   RETRNREG,GETWKA          GO GET WKAREA EXTENSION  Y02078 36740002
         MVC   VTCCHHR1,FMTOUTAD        MOVE IN CCHHR OF 1ST F5  Y02078 36780002
         MVC   VTC1STF5,DSCBF5          MOVE IN 1ST REBUILT F5   Y02078 36820002
         ST    RVTOCWKA,LASTF5AD        INITIALIZE LAST F5 ADDR  Y02078 36840002
         B     LOAD4                    GO BRANCH TO IGG0325Q    Y02078 36860002
ONEF5TST EQU   *                        BRANCH LABEL             Y02078 36900002
         CLC   F5FNDCT,ONEF5            TEST IF ONLY 1 FOUND F5  Y02078 36940002
         BE    LOAD5                    IF ONLY 1 FOUND F5 AND 1 Y02078 36980002
*                                       REBUILT F5, DO NOT USE   Y02078 37020002
*                                       A WORK AREA EXTENSION    Y02078 37060002
         LA    REGTWO,LOAD5             PREPARE RETURN ADDRESS   Y02078 37100002
         B     MOVEF5IN                 MOVE IN 1ST REBUILT F5   Y02078 37140002
SPTEST   EQU   *                                                 A31333 37150020
         TM    ASWITCH,SPCYLSW          DO SPLIT CYL DATA SETS   Y02080 37250002
*                                       EXIST ON THIS VOLUME          * 37300018
         BO    LOAD4                    BRANCH IF YES                   37400018
LOAD5    EQU   *                                                 A31333 37500020
         XR    RERRPASS,RERRPASS        CLEAR ERROR PASS REG     S21040 37550021
ERREXIT  EQU   *                        BRANCH LABEL             Y02080 37560002
         LA    REGTWO,LASTLOAD          POINT TO ID OF IGG0325T  Y02080 37600002
XCTLHERE EQU   *                        BRANCH LABEL             Y02080 37650002
        IECRES LOAD,EXTPR=(RWKAREA),MODID=(REGTWO),BRANCH=DIRECT Y02080 37750002
LOAD4    EQU   *                                                 A31333 38100020
         LA    REGONE,C32              MAKE REG 1 NOT ZERO SO    S21040 38120021
*                                      IGG0325Q WILL NOT THINK          38140021
*                                      THIS IS REENTRY FROM 325U        38160021
         LA    REGTWO,SPLITCYL          POINT TO ID OF IGG0325Q  Y02080 38210002
         B     XCTLHERE                 BRANCH TO XCTL                  38400018
*                                                                       38490002
* THIS ROUTINE EXECUTES A CHANNEL PROGRAM.                              38492002
*                                                                       38494002
EXCHANPG MVI   ECB,ZERO                                                 38500018
         EXCP IOB                                                       38600018
         WAIT   1,ECB=ECB                                               38700018
         TM    ECB,GOODIO                                               38800018
         BCR   1,RETRNREG               RETURN IF I/O SUCESSFUL  M0124  38900021
         LA    RERRPASS,ERRCD                                           39000018
         B     ERREXIT                  BRANCH TO IGG0325T       Y02080 39050002
*                                                                     * 39500021
*          CONSTANTS                                                  * 39600018
*                                                                     * 39650021
FW3      DC    F'3'                     3 F5'S PER WKA EXTENSION Y02078 39700002
ONEF5    DC    H'1'                     HALFWORD OF ONE          Y02078 39750002
VCWKAID  DC    C'VCWA'                  VTOC WORK AREA PREFIX ID Y02078 39800002
         DS    0H                       HALF-WORD BOUNDARY       A30794 40020020
EXTSIX   DC    X'0009'                  EXTENT SIX               A30794 40040020
*                                                                     * 40045021
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                       * 40050002
*                                                                     * 40055021
         XCTLTABL ID=(NEXTLOAD,5R,SPLITCYL,5Q,LASTLOAD,5T),      Y02080X40105002
               SVC=032,LENGTH=,BRT=YES                           Y02080 40205002
         EJECT                                                   Y02080 40255002
CVT      DSECT                                                          41700018
         CVT                                                     Y02080 41800002
         EJECT                                                   Y02080 41850002
DSCBWKAR IECALLWA EP,F4,D1=(1,3),D2=(5)  ALLOCATE WORK AREA      Y02080 41900002
DS4VTOC6 EQU   DS4VTOCE+6                                               44500018
F5EXT15  EQU   DSCBF5+124               EXTENT 15 IN F5 DSCB            49000018
F5EXT16  EQU   DSCBF5+129               EXTENT 16 IN F5 DSCB            49100002
CHNPGADR EQU   IOB+16                   ADDR. CHANNEL PROGRAM IN IOB    50500018
SEEKCYL  EQU   SEEK+3                                                   50700018
SEEKREC  EQU   SEEK+7                                                   50800018
ZEROS    EQU   CCW2+4                   FULL WORD OF ZERO               51100018
         EJECT                                                   Y02078 51200002
VWKAREA  IECVTCWA                       VTOC CONVERSION WORKAREA Y02078 51300002
         END                                                            57500018
