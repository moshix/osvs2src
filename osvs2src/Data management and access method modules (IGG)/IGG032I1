 TITLE 'IGG032I1 - ISAM ALLOCATE - VALIDITY CHECK'                      00020000
IGG032I1 CSECT                                                          00030021
*                                                                       00040002
*MODULE NAME = IGG032I1                                                 00042002
*                                                                       00044002
*DESCRIPTIVE NAME = ISAM ALLOCATE - VALIDITY CHECK                      00044402
*                                                                       00044802
*COPYRIGHT = NONE                                                       00045202
*                                                                       00045602
*CHANGE ACTIVITY = SEE BELOW                                            00045702
*                                                                       00045802
*          RELEASE 16 DELETIONS                                         00046000
*0000038600                                                       15708 00049016
*          RELEASE 17 DELETIONS                                         00052000
*1715001000,089680,089740                                         19342 00055000
*          RELEASE 18 DELETIONS                                         00058000
*3126038200,060600-060800,063400-063600,070200-070400,070800-     23312 00058118
*3126071000,077660,078400-078600,079200-079400,097600,103200,     23312 00058218
*3126104200-105200                                                23312 00058318
*3126                                                             23428 00058518
*3126093600                                                       23475 00059018
*3126033200                                                       22224 00061018
*          RELEASE 19 DELETIONS                                         00064000
*1776083800-090200                                               O19113 00067019
*1776069460                                                      A28380 00068019
*          RELEASE 20 DELETIONS                                         00070000
*          RELEASE 21 DELETIONS                                         00076000
*0000064400-064800                                               M1273  00076402
*1194012950,034730-034820                                        M0705  00076521
*1194003400-007000,007600-008800,011800-015000,024200,031800-    S21016 00077021
*1194032000,033400-035000,038000,038620,058600-058800,059200,    S21016 00078021
*1194064000-064200,066800-067000,068200,068800,071200-071400,    S21016 00079021
*1194072200-072400,073000-073400,080200-080400,081200-081400,    S21016 00080021
*1194083600,092200-092600                                        S21016 00081021
*1194003500,003800-004000,005300,005500-005700,009600,025200-    A38860 00081102
*1194025400,037400,038580,038680-039200,039800,041400,042800,    A38860 00081202
*1194043800-044200,050200-050400,051400,052000,052400-052600,    A38860 00081302
*1194053600-053800,054600-055400,056600,057000,059000,059800,    A38860 00081402
*1194061800,062800,066200,067600,068400,069200,069430,069600,    A38860 00081502
*1194070980,071040,071200,071320,071600,073800,074800,075600,    A38860 00081602
*1194079300,080600,081600,083400,090400,091000,093000,103300-    A38860 00081702
*1194104000,105000,115600,117800-118000                          A38860 00081802
*          RELEASE 22 DELETIONS                                         00082000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00088002
*0000000030-000150,000880-000940,007600,007900-008000,010600,    Y02080 00088102
*0000011200,011600-011690,015600,024800,025100-025200,025400-    Y02080 00088202
*0000025800,032600,035200,035320,038200,074600-075000,078020,    Y02080 00088302
*0000078100,099200-103000,103200-103400,104200,105000-105600,    Y02080 00088402
*0000106000,106400-117720                                        Y02080 00088502
*0000009400-009600,011200,033002,032016,032020,035230-035400,    Y02134 00088602
*0000038580,039400-039600,041600-041800,042600-043000,044600-    Y02134 00088702
*0000044800,051200-052200,069000-070000,077640-077650,106600,    Y02134 00088802
*0000107000-118120                                               Y02134 00088902
*0000077630-077660                                               Y02130 00089002
*0000                                                           YA03038 00090002
*0000                                                            YM4707 00091002
*0000                                                            YM7213 00091402
*0000068000,068800                                               YM7212 00092002
*          VS1 RELEASE 2 DELETIONS/CHANGES                              00096802
*0000065320-065340                                               XM1207 00096902
*          VS2 RELEASE 1 DELETIONS/CHANGES                              00097202
*0000                                                           OY00240 00098002
*          VS2 RELEASE 3 DELETIONS/CHANGES                              00098202
*0000                                                          @ZM30492 00098402
*                                                                       00100002
*STATUS CHANGE LEVEL 008                                                00103021
*                                                                       00112000
*FUNCTION - THIS MODULE CHECKS FOR A DUPLICATE NAME DSCB FORMAT 1       00120000
*           AND IF ONE EXISTS ITS LEGITIMACY IS EXAMINED. IF ILLEGITI-  00140000
*           MATE AN ERROR CODE IS SET AND A TRANSFER OF CONTROL IS      00160000
*           MADE TO MODULE IGG032I7 WHERE CODES ARE GOING TO BE         00180000
*           EXAMINED.   A CHECK IS MADE TO SEE IF THERE IS ENOUGH ROOM  00200000
*           IN THE VTOC.  ALSO THE ABSOLUTE TRACK AND QUANTITIES GIVEN  00220000
*           IN AN ABSOLUTE TRACK REQUEST ARE CHECKED FOR CYLINDER       00240000
*           BOUNDARIES.  CHECKS ARE MADE TO INSURE THAT THE TYPE OF     00260000
*           ALLOCATION IS THE SAME ACROSS DD CARDS AND THAT TWO         00280000
*           REQUESTS FOR THE SAME TYPE OF AREA ARE NOT MADE.            00300000
*                                                                       00320000
*           IF MORE THAN ONE DD STATEMENT IS USED IN REQUESTING         00330021
*           SPACE, THE SEVEN LOW-ORDER BYTES OF THE DDNAME FIELD        00340021
*           IN ALL BUT THE FIRST ISAM DD ENTRY ARE USED TO CREATE       00350021
*           THE FOLLOWING SPECIAL ISAM ALLOCATE INTERFACE:              00360021
*                                                                       00370021
*              BYTE 1                                                   00390021
*                   BITS 0 AND 1   00 - ABSOLUTE TRACK REQUEST          00410021
*                                  01 - BLANK SPACE REQUEST             00420021
*                                  11 - CONTIGUOUS SPACE REQUEST        00430021
*                                                                       00440021
*                   BIT 2          THIS IS THE SECOND DD CARD.          00450021
*                                                                       00460021
*                   BIT 5          OVFLOW HAS BEEN ALLOCATED.           00470021
*                                                                       00480021
*                   BIT 6          PRIME HAS BEEN ALLOCATED.            00490021
*                                                                       00500021
*                   BIT 7          INDEX HAS BEEN ALLOCATED.            00510021
*                                                                       00520021
*              BYTES 2 - 3         CURRENT VOLUME SEQUENCE NUMBER       00526021
*                                  FOR SECOND OR THIRD DD ENTRY         00532021
*                                                                       00540021
*              BYTES 4 - 7         POINTER TO THE FIRST TIOT ENTRY      00560021
*                                  FOR THIS REQUEST                     00580021
*                                                                       00720000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG032I1.  ENTRY IS   00740000
*          MADE FROM THE SECOND LOAD OF ALLOCATE (MODULE IGG0325A)      00750021
*          OR FROM THE LAST LOAD OF ISAM ALLOCATE VIA A BRANCH.         00760002
*                                                                       00770021
*INPUT -  AT ENTRY TO THIS MODULE, REGISTER 11 POINTS TO A JFCB AND     00780021
*         REGISTER 13 POINTS TO THE ALLOCATE WORK AREA. THIS WORK AREA  00790002
*         CONTAINS A POINTER TO THE VARIABLE LENGTH DSAB LIST FOR THIS  00800002
*         REQUEST, THE ADDRESS OF THE FORMAT 4 DSCB, THE ADDRESS OF THE 00810021
*         FIRST FORMAT 5 DSCB, AND THE ADDRESS OF THE FORMAT 1 DSCB, IF 00820021
*         ONE EXISTS. THE FIRST FORMAT 5 DSCB IS ALSO IN THE WORK AREA. 00830021
*         THE VARIABLE LENGTH DSAB LIST HAS THE FOLLOWING FORMAT:       00835002
*         THE FIRST FULLWORD POINTS TO THE DSAB BEING ALLOCATED.        00840002
*         THE SECOND FULLWORD POINTS TO THE DSAB REPRESENTING THE       00845002
*         FIRST DD CARD.  THE THIRD IS ZERO IF THERE IS ONLY ONE        00850002
*         DD CARD, OR A POINTER TO THE DSAB FOR THE SECOND DD CARD.     00855002
*         THE FOURTH WORD IS ZERO IF THERE IS NO THIRD DD CARD, OR      00860002
*         A POINTER TO THE DSAB FOR THE THIRD DD CARD, OR ABSENT IF     00865002
*         THERE IS NO SECOND DD CARD.  THE FIFTH WORD IS ZERO IF        00870002
*         THERE ARE THREE CONCATENATED DD CARDS, OR ABSENT OTHERWISE.   00875002
*                                                                       00900000
*OUTPUT - UPON TRANSFERRING TO THE NEXT MODULE, IGG032I2, THE WORK AREA 00920000
*         CONTAINS THE PRIMARY AND DIRECTORY QUANTITIES, THE ABSOLUTE   00940002
*         TRACK ADDRESS, AND THE AMOUNT REQUESTED IN A MULTI-VOLUME     00980000
*         ABSOLUTE TRACK REQUEST.                                       01000000
*                                                                       01020000
*EXTERNAL ROUTINES -                                                    01040000
*   SVCS ISSUED - NONE                                                  01060002
*   MACROS USED - IEFJFCBN - BUILDS JFCB                                01080000
*                 IECALLWA - ALLOCATE WORK AREA EXPANSION               01090002
*                 IECSDSL1 - BUILDS DSCBS                               01100000
*                 IECDSECS - EXPANDS THE CVT, UCB, AND DSAB DSECTS      01120002
*                                                                       01140000
*EXITS - NORMAL - BRANCH TO MODULE IGG032I2                             01160002
*        - ERROR - BRANCH TO MODULE IGG032I7 WITH A CODE IN REGISTER 5  01169002
*                                                                       01178021
*        THE FOLLOWING ERROR CODES CAN BE ISSUED BY IGG032I1:           01187021
*                                                                       01196021
*        04 - DUPLICATE NAME DSCB EXISTS                                01205021
*                                                                       01214021
*        1C - WRONG DSORG OR DISP                                       01223021
*                                                                       01232021
*        20 - NO PRIME AREA REQUESTED                                   01241021
*                                                                       01250021
*        24 - PRIME AREA MUST BE REQUESTED BEFORE OVFLOW                01259021
*                                                                       01268021
*        2C - DSNAME ELEMENT DUPLICATION                                01277021
*                                                                       01286021
*        4C - NO SPACE PARAMETER GIVEN FOR A NEW DATA SET OR            01292021
*             ZERO SPACE REQUESTED AT ABSOLUTE TRACK ZERO               01298021
*                                                                       01304021
*        50 - INVALID REQUEST FOR EMBEDDED INDEX                        01313021
*                                                                       01322021
*        54 - MULTIVOLUME INDEX NOT ALLOWED                             01331021
*                                                                       01340021
*        58 - DSNAME ELEMENT INVALID                                    01349021
*                                                                       01358021
*        5C - MULTIVOLUME OVFLOW NOT ALLOWED                            01367021
*                                                                       01376021
*        60 - ABSTR AND CYL REQUESTS CONFLICT                           01385021
*                                                                       01394021
*        64 - CYL AND CONTIG REQUESTS CONFLICT                          01403021
*                                                                       01412021
*        68 - INVALID SPACE SUBPARAMETER                                01421021
*                                                                       01430021
*        70 - INDEX REQUEST DUPLICATION                                 01439021
*                                                                       01448021
*        84 - SPACE REQUEST MUST BE ABSTR FOR A DOS VOLUME              01457021
*                                                                       01466021
*        8C - INDEX MUST BE REQUESTED BEFORE PRIME AREA                 01475021
*                                                                       01484021
*        90 - INVALID THIRD DD CARD FOR ISAM ALLOCATION                 01493021
*                                                                       01520000
*                                                                       01540000
*TABLES/WORK AREAS - DADSM WORK AREA DESCRIBED BY MACRO 'IECALLWA'      01560002
*                                                                       01580000
*              ***************************************                  01600000
*              *             DADSM TABLE             *                  01620000
*              ***************************************                  01640000
*                                                                       01660000
*              ***************************************                  01680000
*              *        *         *                  *                  01700000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  01720000
*              *  FLAG  * ENTRIES *      COUNTER     *                  01740000
*              *        *         *                  *                  01760000
*              ***************************************                  01780000
*              *                  *                  *                  01800000
*              *       RTA        *      RTA+1       *                  01820000
*              *                  *                  *                  01840000
*              ***************************************                  01860000
*              *                  *                  *                  01880000
*              *       RTA        *      RTA+1       *                  01900000
*              *                  *                  *                  01920000
*              ***************************************                  01940000
*              *                  *                  *                  01960000
*              *       RTA        *      RTA+1       *                  01980000
*              *                  *                  *                  02000000
*              ***************************************                  02020000
*              *                  *                  *                  02040000
*              *       RTA        *      RTA+1       *                  02060000
*              *                  *                  *                  02080000
*              ***************************************                  02100000
*              *                  *                  *                  02120000
*              *       RTA        *      RTA+1       *                  02140000
*              *                  *                  *                  02160000
*              ***************************************                  02180000
*                                                                       02200000
*                                                                       02220000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             02240000
*                                                                       02260000
*                        = 40 - USER LABELS REQUESTED                   02264021
*                                                                       02268021
*                        = 80 - SET MUST COMPLETE IS ACTIVE             02272021
*                                                                       02276021
*                                                                       02280000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    02300000
*                                                                       02320000
*                                                                       02340000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        02360000
*                                                                       02380000
*                                                                       02400000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 02420021
*                                                                       02440000
*                                                                       02460000
*ATTRIBUTES - REENTRANT                                                 02480002
*                                                                       02500000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    02510002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO                 02520002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO               02522002
*                                                                       02530021
*                                                                       02600000
*REGISTER USAGE                                                         02620000
*              REGISTERS 0-9 WORK REGISTERS                             02640000
*              REGISTER 10 - TIOT SET UP TABLE POINTER                  02660000
*              REGISTER 11 - JFCB POINTER                               02680000
*              REGISTER 12 - BASE REGISTER                              02700000
*              REGISTER 13 - WORK AREA POINTER                          02720000
*              REGISTER 14 SUBROUTINE LINKAGE AND WORK REGISTER         02740000
*              REGISTER 15 WORK REGISTER                                02760000
*                                                                       02780000
***** REGISTER NAMES *****                                              02800000
RZERO    EQU   0                                                        02820000
RONE     EQU   1                                                        02840000
RTWO     EQU   2                                                        02860000
RTHREE   EQU   3                                                        02880000
RFOUR    EQU   4                                                        02900000
RFIVE    EQU   5                                                        02920000
RSIX     EQU   6                                                        02940000
RSEVEN   EQU   7                                                        02960000
REIGHT   EQU   8                                                        02980000
RNINE    EQU   9                                                        03000000
RTEN     EQU   10                                                       03020000
RJFCB    EQU   11                                                       03040000
RBASE    EQU   12                                                       03060000
RWORK    EQU   13                                                       03080000
RETURN   EQU   14                                                       03100000
RFTEN    EQU   15                                                       03120000
*                                                                       03140000
*                                                                       03160000
* OTHER EQUATES                                                         03162021
*                                                                       03164021
*                                                                       03166021
ZERO     EQU   0                   CONSTANT OF ZERO              Y02134 03166202
K1       EQU   1                   CONSTANT OF ONE               Y02080 03166502
K2       EQU   2                   CONSTANT OF TWO               Y02080 03167002
K3       EQU   3                   CONSTANT OF THREE             Y02080 03167502
FOUR     EQU   4                   CONSTANT OF FOUR              Y02134 03167702
DUPLCATE EQU   X'04'               DUPLICATE NAME ERROR CODE     S21016 03168021
BADDSORG EQU   X'1C'               WRONG DSORG OR DISP ERROR     S21016 03170021
NOPRIME  EQU   X'20'               NO PRIME AREA REQUESTED       S21016 03172021
PRIME1ST EQU   X'24'               PRIME BEFORE OVFLOW ERROR     S21016 03174021
DUPELMNT EQU   X'2C'               DSNAME ELEMENT DUPLICATION    S21016 03176021
NOSPACE  EQU   X'4C'               NO SPACE PARAMETER ERROR      S21016 03178021
INVALIND EQU   X'50'               INVALID EMBEDDED INDEX ERROR  S21016 03180021
MVINDEX  EQU   X'54'               MULTIVOLUME INDEX ERROR CODE  S21016 03182021
INVALELM EQU   X'58'               INVALID DSNAME ELEMENT ERROR  S21016 03184021
MVOVFLOW EQU   X'5C'               MULTIVOLUME OVFLOW ERROR      S21016 03186021
NOTCYL   EQU   X'60'               ABSTR AND CYL CONFLICT        S21016 03188021
NOCONTIG EQU   X'64'               CYL AND CONTIG CONFLICT       S21016 03190021
SPACERR  EQU   X'68'               INVALID SPACE SUBPARAMETER    S21016 03192021
DUPINDEX EQU   X'70'               INDEX REQUEST DUPLICATION     S21016 03194021
ABSTRREQ EQU   X'84'               SPACE REQUEST NOT ABSTR       S21016 03196021
INVINDEX EQU   X'8C'               PRIME BEFORE INDEX ERROR      S21016 03198021
INVDDCRD EQU   X'90'               INVALID THIRD DD CARD         S21016 03200021
TIOEVOLS EQU   2                   OFFSET TO NUMBER OF DEVICES   A38860 03200421
TIOEDDNM EQU   4                   OFFSET TO DDNAME              A38860 03200621
ISAMSTAT EQU   5                   OFFSET TO ALLOCATION STATUS   A38860 03200821
VOLSQCTR EQU   6                   OFFSET TO DS1VOLSQ COUNTER    A38860 03201021
TIOTPTR  EQU   8                   PTR TO 1ST ISAM TIOT ENTRY    A38860 03201221
UCBENTRY EQU   16                  OFFSET TO FIRST UCB ENTRY     A38860 03201421
BLANK    EQU   X'40'               EBCDIC BLANK                  A38860 03201821
CURRDSAB EQU   0                   CURRENT DSAB OFFSET           Y02134 03202002
FRSTDSAB EQU   4                   FIRST DSAB OFFSET             Y02134 03202202
SCNDDSAB EQU   8                   SECOND DSAB OFFSET            Y02134 03202402
THRDDSAB EQU   12                  THIRD DSAB OFFSET             Y02134 03202602
ONE16    EQU   116                 116 CYLINDERS                 Y02130 03202802
DA3340   EQU   X'0A'               3340 DEVICE TYPE              Y02130 03203002
K12      EQU   12                  CONSTANT OF TWLEVE            Y02130 03203202
*                                                                       03210002
         BALR  RBASE,0                                                  03220000
         USING ALPHA,RBASE                                              03240000
         USING ALLOCWKA,RWORK           WORK AREA ADDRESSABILITY Y02080 03260002
         USING JFCBKEN,RJFCB                                            03280000
*                                                                       03290021
ALPHA    TM    DS4VTOCI,X'80'          CHECK FOR BOS PACK               03300000
         BC    8,NOTBOS                 IF NOT BOS, BRANCH        22224 03320018
         TM    JFCBCTRI,X'DF'      CHECK IF ABSTR WITH DOS PACK  S21016 03329021
         BZ    CHECK               BRANCH IF ABSOLUTE TRACK      S21016 03338021
         LA    RFIVE,ABSTRREQ      SPACE REQUEST MUST BE ABSTR   S21016 03347021
         B     ERRORXCT                                          S21016 03356021
NOTBOS   EQU   *                                                 S21016 03365021
         TM    JFCBCTRI,X'C0'      IS IT A CYL OR ABSTR REQUEST  S21016 03374021
         BC    9,CHECK             BRANCH IF CYL OR ABSTR        S21016 03383021
         LA    RFIVE,SPACERR       INVALID SPACE REQUEST ERROR   S21016 03392021
         B     ERRORXCT                                          S21016 03401021
CHECK    EQU   *                                                 S21016 03410021
         CLI   CTR,X'00'           CHECK IF ENTRY FROM SECOND    S21016 03419021
*                                  LOAD OF ALLOCATE OR LAST LOAD S21016 03428021
*                                  OF ISAM ALLOCATE              S21016 03437021
         BNE   REJOIN              BRANCH IF FROM LAST LOAD      S21016 03446021
         TM    JFCBCTRI,X'DF'      CHECK REQUEST TYPE FIELD      S21016 03455021
         BC    5,GETTIOT           BRANCH IF CYLINDERS           S21016 03464021
*                                                                       03466021
* THIS SECTION TESTS IF ANY SPACE WAS REQUESTED. IF NOT, THE ABSOLUTE   03468021
* TRACK ADDRESS IS TESTED FOR ZERO TO DETERMINE IF A SPACE PARAMETER    03470021
* WAS GIVEN FOR THIS DATA SET.                                          03472021
*                                                                       03474021
         OC    JFCBPQTY,JFCBPQTY        ANY SPACE REQUESTED      M0705  03476021
         BNZ   GETTIOT                  BRANCH IF YES            M0705  03478021
         OC    JFCBABST(2),JFCBABST     IS ABSOLUTE TRACK ZERO   M0705  03480021
         BNZ   GETTIOT                  BRANCH IF NOT ZERO       M0705  03482021
         LA    RFIVE,NOSPACE       NO SPACE PARAMETER ERROR      S21016 03491021
         B     ERRORXCT                                          S21016 03500021
GETTIOT  EQU   *                                                 S21016 03509021
         L     RTEN,ADSABLST            PICK UP PTR TO DSAB LIST Y02080 03520002
         L     RTEN,CURRDSAB(RTEN)      GET CURRENT DSAB ADDR    Y02134 03523002
         USING DSAB,RTEN                                         Y02134 03533002
         L     RTEN,DSABTIOT            GET CURRENT TIOT ADDR    Y02134 03543002
         DROP  RTEN                                              Y02134 03553002
* THIS SECTION CHECKS FOR LEGITIMACY OF DUPLICATE NAME F1 IF ONE EXISTS 03560000
         XC    SAVEADR(5),SAVEADR       CLEAR FORMAT 1 ADDRESS          03580000
         CLI   DS1FMTID,X'F1'           TEST FOR A DUPLICATE NAME DSCB  03600000
*                                          BY CHECKING THE FORMAT       03620000
*                                          IDENTIFIER TO SEE IF THE 1ST 03640000
*                                          LOAD OF ALLOCATE READ IN A   03660000
*                                          FORMAT 1 DSCB                03680000
         BNE   AROUND                   BRANCH IF NO DUPLICATE NAME     03700000
*                                          DSCB                         03720000
         CLI   TIOEDDNM(RTEN),BLANK     CHECK FOR DDNAME IN TIOT A38860 03740021
         BE    MORETHAN                 BRANCH IF THERE IS NO DDNAME-   03760000
*                                          NOT FIRST TIOT ENTRY         03780000
DUPNAME  EQU   *                                                 S21016 03790021
         LA    RFIVE,DUPLCATE      DUPLICATE NAME ERROR CODE     S21016 03800021
ERRORXCT EQU   *                                                  23312 03810018
         LA    RTHREE,LASTLOAD          SET 7TH LOAD ID          Y02080 03820002
         B     XCT                                                      03840000
*                                                                 15708 03842016
*              NO DDNAME IMPLIES CONCATENATION WITH A             15708 03844016
*              PREVIOUS DD CARD.  A BLANK TIOT POINTER ENTRY      15708 03846016
*              INDICATES THAT AN INVALID CONDITION EXISTS,        15708 03848016
*              DSORG=IS WAS NOT SPECIFIED FOR THE PRECEEDING      15708 03850016
*              DD CARD.                                           15708 03852016
*                                                                 15708 03854016
MORETHAN EQU   *                                                  15708 03856016
         CLC   TIOTPTR(FOUR,RTEN),BLANKS  CHECK TIOT POINTER     Y02134 03858002
         BC    7,CONTINUE         BRANCH IF NOT EQUAL TO BLANKS   15708 03860016
DSDISP   EQU   *                                                OY00240 03860402
         LA    RFIVE,BADDSORG      WRONG DSORG ERROR CODE        S21016 03862021
         B     ERRORXCT                                           15708 03864016
CONTINUE EQU   *                                                  15708 03866016
         L     RNINE,TIOTPTR(,RTEN)     PTR TO 1ST TIOT ENTRY    A38860 03886021
         L     RSIX,UCBENTRY(,RTEN)     SET PTR TO 1ST UCB ENTRY A38860 03906021
         LA    RSIX,ZERO(,RSIX)         TIOT ENTRY HAS UCB ADDR  Y02134 03940002
         TM    ISAMSTAT(RTEN),X'20'     CHECK STATUS BYTE IN THE A38860 03980021
*                                          NEXT TIOT ENTRY FOR THE FLAG 04000000
*                                          SET TO INDICATE THIS ENTRY   04020000
*                                          AS THE SECOND ENTRY          04040000
         BC    1,PICKUP                 BRANCH IF THIS ENTRY IS THE     04060000
*                                          SECOND ENTRY                 04080000
* THIS SECTION CHECKS TO SEE IF THE UCB IN THIS ENTRY IS THE SAME AS    04100000
* THE UCB IN THE FIRST TIOT ENTRY                                       04120000
*                                                                       04130021
         L     RSEVEN,UCBENTRY(,RNINE)  POINT TO ONLY UCB ENTRY  A38860 04140021
         LA    RSEVEN,ZERO(,RSEVEN)     CLEAR HIGH BYTE          Y02134 04160002
         CR    RSIX,RSEVEN              CHECK THE 12 BIT UCB POINTERS   04200000
         BE    LEGITIMT                 BRANCH IF THE UCB POINTERS ARE  04220000
*                                          EQUAL                        04240000
         L     RNINE,ADSABLST           GET ADDR OF DSAB LIST    Y02134 04250002
         L     RNINE,SCNDDSAB(,RNINE)   GET ADDR OF 2ND DSAB     Y02134 04260002
         USING DSAB,RNINE                                        Y02134 04270002
         L     RNINE,DSABTIOT           GET SECOND TIOT ENTRY    Y02134 04280002
         DROP  RNINE                                             Y02134 04290002
*                                                                       04300002
* THIS SECTION COMPARES THE FIRST UCB ENTRY IN THE SECOND OR THIRD      04320000
* TIOT ENTRY TO ALL OF THE UCB'S IN THE PRECEEDING TIOT ENTRY           04340000
*                                                                       04350002
PICKUP   SR    REIGHT,REIGHT                                            04360000
         IC    REIGHT,TIOEVOLS(,RNINE)  GET NUMBER OF UCB'S IN   A38860 04380021
*                                       THE PRECEDING TIOT ENTRY A38860 04400021
         LA    RNINE,UCBENTRY(,RNINE)   POINT TO 1ST UCB ENTRY   A38860 04420021
COMPARE  L     RSEVEN,0(RNINE)                                          04440000
         LA    RSEVEN,ZERO(,RSEVEN)     CLEAR HIGH BYTE          Y02134 04460002
         CR    RSIX,RSEVEN              CHECK UCB POINTERS              04500000
         BE    LEGITIMT                 BRANCH IF UCB POINTERS ARE      04520000
*                                          EQUAL                        04540000
         BCTR  REIGHT,0                 REDUCE NUMBER OF UCB'S IN       04560000
*                                          PREVIOUS TIOT ENTRY          04580000
         LTR   REIGHT,REIGHT            CHECK FOR LAST UCB ENTRY        04600000
         BZ    DUPNAME                  BRANCH IF LAST UCB ENTRY - THE  04620000
*                                          DUPLICATE NAME DSCB FORMAT 1 04640000
*                                          IS ILLEGAL                   04660000
         LA    RNINE,4(RNINE)           UPDATE POINTER                  04680000
         B     COMPARE                                                  04700000
* THIS SECTION TAKES THE CCHHR OF THE RECORD BEYOND THE DUPLICATE NAME  04720000
* DSCB FORMAT 1 AND CALCULATES THE ADDRESS OF THIS FORMAT 1.            04740000
LEGITIMT SR    RETURN,RETURN            REDUCE THE RECORD NUMBER BY ONE 04760000
         IC    RETURN,COUNT+4                                           04780000
         BCT   RETURN,ADJUST            CHECK FOR RECORD NUMBER ZERO -  04800000
*                                          BACKING OVER A TRACK BOUND-  04820000
*                                          ARY                          04840000
*                                       BRANCH IF RECORD NUMBER NOT     04860000
*                                          ZERO                         04880000
         IC    RETURN,DS4DEVDT          SET RECORD NUMBER TO MAXIMUM    04900000
*                                       NUMBER OF DCB'S PER TRACK       04920000
ADJUST   STC   RETURN,COUNT+4                                           04940000
         MVC   SAVEADR(5),COUNT         SAVE THE ADDRESS OF THE FORMAT1 04960000
* THIS SECTION CHECKS THE VALIDITY OF THE REQUEST AND SETS UP THE       04980000
* WORK AREA FOR THIS PASS THROUGH ISAM ALLOCATE                         05000000
AROUND   EQU   *                                                 A38860 05020021
         CLI   TIOEDDNM(RTEN),BLANK     DDNAME FOR THIS ENTRY?   A38860 05040021
         BE    NONAME                   BRANCH IF NO DDNAME             05060000
         MVI   F2,X'80'                 HAVE A DDNAME-NEED A DSCB F2 -  05080000
*                                          SET F2 FLAG                  05100000
*                                                                       05110002
* SINCE THE CURRENT TIOT ENTRY HAS A DDNAME, THIS SECTION OBTAINS       05120002
* THE SECOND DSAB POINTER TO GET THE SECOND TIOT ENTRY ADDRESS.         05130002
*                                                                       05140002
         L     REIGHT,ADSABLST          GET PTR TO DSAB LIST     Y02134 05150002
         L     REIGHT,SCNDDSAB(,REIGHT) GET SECOND DSAB PTR      Y02134 05160002
         LTR   REIGHT,REIGHT            TEST IF A SECOND EXISTS  Y02134 05170002
         BZ    THISIT                   BRANCH IF NOT            Y02134 05180002
         USING DSAB,REIGHT                                       Y02134 05190002
         L     REIGHT,DSABTIOT          GET 2ND TIOT ENTRY       Y02134 05200002
         DROP  REIGHT                                            Y02134 05210002
         CLI   TIOEDDNM(REIGHT),BLANK   CHECK FOR A DDNAME FOR   A38860 05240021
*                                       THE NEXT TIOT ENTRY      A38860 05260021
         BNE   THISIT                   BRANCH IF THERE IS NOT ANOTHER  05280000
*                                          TIOT ENTRY FOR THIS REQUEST  05300000
* THIS SECTION FILLS IN THE DDNAME FIELD OF THE NEXT TIOT ENTRY WITH    05320000
* INFORMATION ABOUT THIS TIOT ENTRY                                     05340000
         ST    RTEN,TIOTPTR(,REIGHT)    MOVE INTO NEXT ENTRY'S   A38860 05370021
*                                          DDNAME FIELD THE ADDRESS OF  05400000
*                                          THE FIRST TIOT ENTRY         05420000
         SR    RSIX,RSIX                                                05440000
         IC    RSIX,TIOEVOLS(,RTEN)     PICK UP NBR OF VOLUMES   A38860 05460021
         STC   RSIX,VOLSQCTR+1(,REIGHT) MOVE IN INITIAL VOL SEQ  A38860 05480021
         MVI   VOLSQCTR(REIGHT),X'00'                            A38860 05500021
         OI    ISAMSTAT(REIGHT),X'20'   TURN ON 2ND ENTRY BIT    A38860 05520021
         NI    ISAMSTAT(REIGHT),X'3F'   TURN OFF 2 BITS 0 AND 1  A38860 05540021
         TM    JFCBCTRI,X'DF'           CHECK REQUEST TYPE FIELD        05560000
         BC    8,AREADIAG               BRANCH IF AN ABSOLUTE TRACK     05580000
*                                          REQUEST                      05600000
CYLREQ   TM    JFCBCTRI,X'08'           CHECK FOR CYLINDER TYPE         05620000
         BC    1,CONTIGS                BRANCH IF CONTIGUOUS REQUESTED  05640000
         OI    ISAMSTAT(REIGHT),X'40'   SET BIT 1 - BLANK OPTION A38860 05660021
         B     AREADIAG                                                 05680000
CONTIGS  EQU   *                                                 A38860 05690021
         OI    ISAMSTAT(REIGHT),X'C0'   SET BITS 0 & 1 - CONTIG  A38860 05700021
*                                                                       05720000
AREADIAG CLC   JFCBELNM(8),INDEX        CHECK FOR THE ELEMENT NAME      05740000
*                                          ATTACHED TO THE DSNAME       05760000
INDEXTST EQU   AREADIAG                                          S21016 05770021
         BNE   NEXT1                    BRANCH IF NOT AN INDEX REQUEST  05780000
         OC    JFCBDQTY(3),JFCBDQTY     CHECK DIRECTORY QUANTITY FIELD  05800000
*                                          FOR EMBEDDED INDEX REQUEST   05820000
         BZ    CHEKMULT                 BRANCH IF NO EMBEDDING          05840000
ERROUT   EQU   *                                                 S21016 05850021
         LA    RFIVE,INVALIND      INVALID INDEX REQUEST ERROR   S21016 05860021
         B     ERRORXCT                                          S21016 05870021
CHEKMULT EQU   *                                                 A38860 05880021
         CLI   TIOEVOLS(RTEN),X'01'     TEST FOR MULTI-VOL INDEX A38860 05890021
         BE    SETTYPE             BRANCH IF NOT MULTI-VOLUME    S21016 05906021
MULTIVOL EQU   *                                                 S21016 05912021
         LA    RFIVE,MVINDEX       MULTI-VOLUME INDEX ERROR      S21016 05918021
         B     ERRORXCT                                          S21016 05924021
SETTYPE  EQU   *                                                 S21016 05930021
         MVI   TYPE,X'04'               SET TYPE FIELD TO INDICATE AN   05940000
*                                          INDEX REQUEST                05960000
         OI    ISAMSTAT(REIGHT),X'01'   SET BIT IN NEXT ENTRY    A38860 05980021
*                                          TO INDICATE AN  INDEX AREA   06000000
*                                          HAS BEEN REQUESTED           06020000
         B     MOVEFLDS                                                 06040000
* THIS SECTION JUST SETS UP A DUMMY POINTER FOR THE ONE DD ENTRY CASE   06050021
THISIT   LA    REIGHT,DADSMTBL          SET UP DUMMY POINTER     M1273  06052021
NEXT1    EQU   *                                                  23312 06060018
         EX    0,PRIMETST               CHECK DSN ELEMENT         23312 06080018
         BNE   NEXT2                    BRANCH IF PRIME NOT ELEMENT     06100000
*                                          NAME                         06120000
ALLGOOD  MVI   TYPE,X'01'               SET TYPE FIELD TO INDICATE A    06140000
*                                          PRIME REQUEST                06160000
         OI    ISAMSTAT(REIGHT),X'02'   SET BIT IN NEXT ENTRY    A38860 06180021
*                                          TO INDICATE A PRIME AREA     06200000
*                                          HAS BEEN REQUESTED           06220000
         OC    JFCBDQTY(3),JFCBDQTY     CHECK FOR EMBEDDED INDEX        06240000
         BZ    MOVEFLDS                 BRANCH IF NO EMBEDDED INDEX     06260000
         CLI   TIOEVOLS(RTEN),X'01'     TEST FOR MULTI-VOL PRIME A38860 06280021
         BE    MOVEFLDS                 BRANCH IF SINGLE VOLUME         06300000
         B     ERROUT                                                   06320000
NEXT2    EQU   *                                                  23312 06340018
         EX    0,BLANKTST               CHECK DSN ELEMENT         23312 06360018
         BE    ALLGOOD                  BRANCH IF BLANK ELEMENT NAME    06380000
         EX    0,OVFLWTST               CHECK DSN ELEMENT        M1273  06382021
         BE    INVOVFL                  BRANCH IF OVFLOW         M1273  06384021
*                                       ELEMENT NAME             M1273  06386021
         EX    0,INDEXTST               TEST IF INDEX REQUESTED  YM7213 06386402
         BE    INVNAME                  BRANCH IF YES - NO PRIME YM7213X06386602
                                        AREA WAS REQUESTED       YM7213 06386802
         CLI   TIOEDDNM(RTEN),BLANK     TEST IF 1ST DD CARD      YM4707 06387002
         BNE   INVELMNT                 IF YES, BR - INVALID     YM4707X06388002
                                        DATA SET ELEMENT NAME    YM4707 06389002
INVNAME  EQU   *                                                 S21016 06390021
         LA    RFIVE,NOPRIME       NO PRIME AREA REQUESTED       S21016 06400021
         B     ERRORXCT                                          S21016 06410021
* THIS SECTION CHECKS THE VALIDITY OF THIS DD CARD AS IT IS NOT THE     06500000
* FIRST FOR AN ISAM ALLOCATE                                            06520000
NONAME   EQU   *                                                OY00240 06530002
         CLC   TIOTPTR(4,RTEN),BLANKS   CHECK TIOT POINTER       XM1207 06532002
         BE    DSDISP                   BRANCH IF NOT PRESENT    XM1207 06534002
*                                       TO ISSUE X'1C' RETURN    XM1207 06536002
*                                       CODE WHICH WILL CAUSE    XM1207 06538402
*                                       MESSAGE IEF260I TO BE    XM1207 06538802
*                                       ISSUED                   XM1207 06539202
         MVI   F2,X'00'                 SET F2 FIELD TO         OY00240 06540002
*                               INDICATE THAT NO FORMAT 2 DSCB BE BUILT 06560002
         TM    JFCBCTRI,X'DF'           CHECK REQUEST TYPE FIELD        06580000
         BC    5,CYLREQTD               BRANCH IF REQUEST FOR CYLINDERS 06600000
         TM    ISAMSTAT(RTEN),X'C0'     CHECK PREVIOUS ISAM      A38860 06620021
*                                          DD ENTRY'S REQUEST TYPE      06640000
         BC    8,CHEKLAST               BRANCH IF TYPES AGREE           06660000
INVSPACE EQU   *                                                 S21016 06670021
         LA    RFIVE,NOTCYL        ABSTR AND CYL CONFLICT ERROR  S21016 06680021
         B     ERRORXCT                                          S21016 06690021
CYLREQTD TM    JFCBCTRI,X'08'           CHECK CYLINDER REQUEST FIELD    06720000
         BC    1,CONTIGUO               BRANCH IF CONTIGUOUS REQUESTED  06740000
         TM    ISAMSTAT(RTEN),X'C0'     CHECK PREVIOUS ISAM      A38860 06760021
*                                          DD ENTRY'S REQUEST TYPE      06780000
         BM    CHEKLAST                 BRANCH IF BOTH SPECIFY   YM7212X06790002
                                        CYL WITHOUT CONTIG       YM7212 06795002
         BZ    INVSPACE                 BRANCH IF PREVIOUS WAS   YM7212X06800002
                                        ABSTR BUT CURRENT IS CYL YM7212 06805002
CONTGERR EQU   *                                                 S21016 06810021
         LA    RFIVE,NOCONTIG      CYL AND CONTIG CONFLICT       S21016 06820021
         B     ERRORXCT                                          S21016 06830021
CONTIGUO EQU   *                                                 A38860 06840021
         TM    ISAMSTAT(RTEN),X'C0'     CHECK PREVIOUS ISAM      A38860 06850021
*                                          DD ENTRY'S REQUEST TYPE      06860000
         BZ    INVSPACE                 BRANCH IF PREVIOUS WAS   YM7212X06865002
                                        ABSTR BUT CURRENT IS     YM7212X06870002
                                        BOTH CYL AND CONTIG      YM7212 06875002
         BM    CONTGERR                 BRANCH IF PREVIOUS WAS   YM7212X06880002
                                        CYL BUT NOT CONTIG       YM7212 06881002
*                                                                       06885002
* THIS SECTION TESTS IF THERE ARE ANY MORE CONCATENATED DD CARDS.       06890002
* IF THE CURRENT DSAB IS THE THIRD DSAB ENTRY, THERE ARE NO MORE.       06895002
*                                                                       06900002
CHEKLAST EQU   *                        BRANCH LABEL             Y02134 06910002
         L     REIGHT,ADSABLST          GET DSAB LIST ADDR       Y02134 06920002
         CLC   THRDDSAB(FOUR,REIGHT),CURRDSAB(REIGHT) TEST IF    Y02134 06930002
*                                       CURRENT IS THE THIRD     Y02134 06940002
         BE    THISLAST                 BRANCH IF YES            Y02134 06950002
         L     REIGHT,THRDDSAB(,REIGHT) GET THIRD DSAB           Y02134 06960002
         LTR   REIGHT,REIGHT            TEST IF A THIRD EXISTS   Y02134 06970002
         BZ    THISLAST                 BRANCH IF NO             Y02134 06980002
         USING DSAB,REIGHT                                       Y02134 06990002
         L     REIGHT,DSABTIOT          GET TIOT ENTRY FOR 3RD   Y02134 07000002
         DROP  REIGHT                                            Y02134 07010002
         EX    0,PRIMETST               CHECK DSN ELEMENT         23312 07030018
         BE    CHEKSET                  BRANCH IF ELEMENT NAME IS PRIME 07060000
         EX    0,BLANKTST               CHECK DSN ELEMENT         23312 07090018
         BE    CHEKSET                  BRANCH IF BLANK          S21016 07092021
         EX    0,INDEXTST               CHECK DSN ELEMENT        S21016 07094021
         BNE   NOTINDEX                 BRANCH IF NOT INDEX      S21016 07096021
         TM    ISAMSTAT(RTEN),X'01'     TEST IF INDEX PREVIOUSLY A38860 07098021
*                                       REQUESTED BY 1ST DD CARD S21016 07100021
         BO    DUPLINDX                 BRANCH IF YES            S21016 07102021
         TM    ISAMSTAT(RTEN),X'02'     TEST IF PRIME PREVIOUSLY A38860 07104021
*                                       REQUESTED BY 1ST DD CARD S21016 07106021
         BNO   INVNAME                  NO PRIME REQUESTED ERROR S21016 07108021
INDEXPRE EQU   *                        INDEX BEFORE PRIME ERR  YA03038 07109002
         LA    RFIVE,INVINDEX           INDEX MUST PRECEDE PRIME S21016 07110021
         B     ERRORXCT                                          S21016 07112021
NOTINDEX EQU   *                                                 S21016 07114021
         EX    0,OVFLWTST               CHECK DSN ELEMENT        S21016 07116021
         BNE   INVELMNT                 BRANCH IF NOT OVFLOW     S21016 07118021
         TM    ISAMSTAT(RTEN),X'02'     TEST IF PRIME PREVIOUSLY A38860 07120021
*                                       REQUESTED BY 1ST DD CARD S21016 07122021
         BNO   LASTTEST                 BRANCH IF NOT            S21016 07124021
         LA    RFIVE,INVDDCRD           INVALID THIRD DD CARD    S21016 07126021
         B     ERRORXCT                                          S21016 07128021
LASTTEST EQU   *                                                 S21016 07130021
         TM    ISAMSTAT(RTEN),X'01'     TEST IF INDEX PREVIOUSLY A38860 07132021
*                                       REQUESTED BY 1ST DD CARD S21016 07134021
         BO    INVOVFL                  INVALID OVFLOW REQUEST   S21016 07136021
         B     INVNAME                  NO PRIME REQUESTED ERROR S21016 07138021
CHEKSET  EQU   *                                                 A38860 07148021
         TM    ISAMSTAT(RTEN),X'02'     CHECK TYPE PREVIOUSLY    A38860 07158021
*                                          REQUESTED IN THE DDNAME      07180000
         BC    8,CHEKAGN                BRANCH IF NOT REQUESTED TWICE   07200000
INVAREA  EQU   *                                                 S21016 07210021
         LA    RFIVE,DUPELMNT      DUPLICATE AREAS REQUESTED     S21016 07220021
         B     ERRORXCT                                          S21016 07230021
CHEKAGN OC     JFCBDQTY(3),JFCBDQTY     CHECK FOR EMBEDDED INDEX        07260000
*                                          REQUESTED                    07280000
         BZ    SETPRIME            BRANCH IF NO ERROR            S21016 07290021
DUPLINDX EQU   *                                                 S21016 07300021
         LA    RFIVE,DUPINDEX      DUPLICATE INDEX REQUEST ERROR S21016 07310021
         B     ERRORXCT                                          S21016 07320021
SETPRIME EQU   *                                                 S21016 07330021
* THIS SECTION UPDATES THE INFORMATION IN THE DD ENTRY IN THE TIOT      07360000
         OI    ISAMSTAT(REIGHT),X'02'   TURN ON PRIME BIT        A38860 07380021
         MVI   TYPE,X'01'               SET TYPE TO PRIME               07400000
* THIS SECTION SETS UP THE WORK AREA FOR THIS PASS THROUGH ISAM         07420000
* ALLOCATE                                                              07440000
MOVEFLDS EQU   *                        BRANCH LABEL             Y02080 07460002
         ST    RTEN,ATIOTPTR           SAVE THE DD ENTRY POINTER Y02080 07480002
         MVC   HOWMUCH+K1(K3),JFCBPQTY  SAVE PRIMARY QUANTITY    Y02080 07500002
         MVC   DIRQTY(2),JFCBDQTY+1    PICK UP EMBEDDED INDEX QUANTITY  07520000
         MVC   ABSTR(2),JFCBABST       PICK UP ABSOLUTE TRACK ADDRESS   07540000
         CLI   TIOEVOLS(RTEN),X'01'     MULTI-VOLUME REQUEST?    A38860 07560021
         BE    MOVEPRI                 BRANCH IF REQUEST FOR ONE        07580000
*                                         VOLUME                        07600000
         TM    JFCBCTRI,X'DF'          CHECK FOR A CYLINDER REQUEST     07620000
         BC    5,MOVEPRI                BRANCH IF CYLINDERS REQUESTED   07640000
         LH    RSIX,DS4DEVSZ                                            07660000
         MH    RSIX,DS4DEVSZ+2         MULTIPLY TIMES THE NUMBER OF     07740000
*                                         TRACKS PER CYLINDER           07760000
         SR    RTWO,RTWO                CLEAR REG                 23312 07761018
         L     RTHREE,DEB+32            FETCH UCB PNTR            23312 07762018
         USING UCB,RTHREE               UCB ADDRESSABILITY       Y02130 07762202
         CLI   UCBTBYT4,DA3340          TEST IF 3340             Y02130 07762402
         BNE   NOT3340                  BRANCH IF NOT            Y02130 07762602
         SR    RTWO,RTWO                CLEAR FOR DIVIDE         Y02130 07764002
         LH    RTHREE,DS4DEVSZ          NBR OF CYLS ON VOLUME    Y02130 07764202
         LA    RFOUR,ONE16              4 ALTERNATE TRACKS       Y02130 07764402
         DR    RTWO,RFOUR               FOR EVERY 116 CYLINDERS  Y02130 07764602
*                                       SO DIVIDE CYL BY 116,    Y02130 07764702
         SLL   RTHREE,K2                MULTIPLY QUOTIENT BY 4   Y02130 07764802
*                                       EQUALS TOTAL ALTERNATES  Y02130 07764902
SUBTALT  EQU   *                        BRANCH LABEL             Y02130 07765002
         SR    RSIX,RTHREE              REDUCE TOTAL BY NUMBER   Y02130 07765202
*                                       OF ALTERNATE TRACKS      Y02130 07765402
         B     CONT                     CONTINUE CALCULATION     Y02130 07765602
NOT3340  EQU   *                        BRANCH LABEL             Y02130 07765802
         IC    RTWO,UCBTBYT4            FETCH UNIT TYPE          Y02130 07766002
         DROP  RTHREE                                            Y02130 07766202
         L     RTHREE,CVTPTR            LOAD CVT ADDRESS         Y02134 07766402
         L     RTHREE,CVTZDTAB-CVT(RTHREE)  DEVICE TABLE POINTER Y02134 07766602
         IC    RTWO,0(RTWO,RTHREE)      FETCH DEVICE ENTRY OFFSET 23312 07766802
         SH    RSIX,12(RTWO,RTHREE)     REDUCE TOTAL TRKS BY NR   23312 07767018
*                                       OF ALTERNATE TRACKS             07772013
CONT     EQU   *                        BRANCH LABEL             Y02130 07774002
         SH    RSIX,ABSTR              CALCULATE QUANTITY TO BE         07780000
         STH   RSIX,PRIQTY                OBTAINED ON THIS VOLUME       07800000
         CLC   HOWMUCH+K2(K2),PRIQTY    COMPARE AMOUNT NEEDED    Y02080 07802002
*                                       WITH SPACE AVAILABLE            07804018
         BH    REJOIN                   ALL OF AVAILABLE SPACE    23475 07806018
*                                       IS NEEDED                       07808018
MOVEPRI  EQU   *                        BRANCH LABEL             Y02080 07808402
         MVC   PRIQTY,HOWMUCH+K2        AMOUNT WANTED IS LESS    Y02080 07810002
*                                       THEN WHATS AVAILABLE,           07812018
*                                       ONLY GET WHATS NEEDED           07814018
         B     REJOIN                                                   07820000
THISLAST EQU   *                                                  23312 07840018
PRIMETST CLC   JFCBELNM(8),PRIME        CHECK DSN ELEMENT         23312 07860018
         BE    ANOTHER                  BRANCH IF A PRIME AREA IS       07880000
*                                          REQUESTED                    07900000
BLANKTST EQU   *                                                 A38860 07920021
         CLC   JFCBELNM(8),BLANKS       CHECK DSN ELEMENT        A38860 07940021
         BE    ANOTHER                  BRANCH IF ELEMENT NAME IS BLANK 07960000
OVFLWTST EQU   *                                                 S21016 07970021
         CLC   JFCBELNM(8),OVFLOW       CHECK ELEMENT NAME ATTACHED TO  07980000
*                                          THE DS NAME                  08000000
         BE    CHEKPREV            BRANCH IF ELEMENT IS OVFLOW   S21016 08010021
         CLC   JFCBELNM,INDEX           CHECK DSN ELEMENT       YA03038 08012002
         BE    INDEXPRE                 BR IF INDEX             YA03038 08014002
INVELMNT EQU   *                                                 S21016 08020021
         LA    RFIVE,INVALELM      ELEMENT NAME IS NOT OVFLOW    S21016 08030021
         B     ERRORXCT                                          S21016 08040021
CHEKPREV EQU   *                                                 S21016 08050021
         TM    ISAMSTAT(RTEN),X'02'     CHECK TYPES PREVIOUSLY   A38860 08060021
*                                          ALLOCATED (IN DDNAME FIELD)  08080000
         BC    1,TEST                   BRANCH IF PRIME PROCEEDS        08100000
         B     INVNAME                  NO PRIME REQUEST       @ZM30492 08100202
INVOVFL  EQU   *                                                 S21016 08110021
         LA    RFIVE,PRIME1ST      INVALID OVFLOW REQUEST ERROR  S21016 08120021
         B     ERRORXCT                                          S21016 08130021
TEST     EQU   *                                                 A38860 08140021
         TM    ISAMSTAT(RTEN),X'04'     CHECK TYPES PREVIOUSLY   A38860 08150021
*                                          ALLOCATED (IN DDNAME FIELD)  08180000
         BC    1,INVAREA                BRANCH IF OVERFLOW HAS ALREADY  08200000
*                                          BEEN REQUESTED               08220000
         OC    JFCBDQTY(3),JFCBDQTY     CHECK FOR EMBEDDED INDEX BEING  08240000
*                                          REQUESTED                    08260000
         BC    7,ERROUT                 BRANCH IF EMBEDDED INDEX BEING  08280000
*                                          REQUESTED WITH REQUEST FOR   08300000
*                                          OVERFLOW                     08320000
         CLI   TIOEVOLS(RTEN),X'01'     MULTI-VOLUME OVFLOW?     A38860 08380021
         BE    SETOVFLW            BRANCH IF NOT MULTI-VOLUME    S21016 08440021
         LA    RFIVE,MVOVFLOW      MULTI-VOLUME OVFLOW ERROR     S21016 08540021
         B     ERRORXCT                                          S21016 08640021
SETOVFLW EQU   *                                                 S21016 08740021
         OI    ISAMSTAT(RTEN),X'04'     TURN ON OVERFLOW BIT     A38860 08840021
         MVI   TYPE,X'02'               SET TYPE FOR OVFLOW             09060000
         B     MOVEFLDS                                                 09080000
ANOTHER  EQU   *                                                 A38860 09090021
         TM    ISAMSTAT(RTEN),X'02'     CHECK AREA TYPES THAT    A38860 09100021
*                                          HAVE BEEN ALLOCATED          09120000
         BC    1,INVAREA                BRANCH IF PRIME AREA PREVIOUSLY 09140000
*                                          REQUESTED                    09160000
         OC    JFCBDQTY(3),JFCBDQTY     CHECK FOR AN EMBEDDED INDEX     09180000
*                                          REQUEST                      09200000
         BNZ   DUPLINDX            DUPLICATE INDEX REQUEST ERROR S21016 09240021
         MVI   TYPE,X'01'               TURN ON TYPE FOR PRIME          09280000
         OI    ISAMSTAT(RTEN),X'02'     TURN ON PRIME BIT        A38860 09300021
         B     MOVEFLDS                                                 09320000
REJOIN   EQU   *                                                  23312 09620018
         LA    RTHREE,NEXTLOAD          SET 2ND LOAD ID          Y02080 09920002
*                                                                       09970002
* BRANCH TO ANOTHER LOAD OF ISAM ALLOCATE                               10300002
*                                                                       10302002
XCT      EQU   *                                                  23312 10310018
         IECRES LOAD,EXTPR=(RWORK),MODID=(RTHREE),BRANCH=DIRECT  Y02080 10340002
*                                                                       10360021
* CONSTANTS                                                             10380021
*                                                                       10400021
INDEX    DC    C'INDEX   '                                        23312 10440018
OVFLOW   DC    C'OVFLOW  '                                        23312 10460018
PRIME    DC    C'PRIME'                                           23312 10480018
BLANKS   DC    CL8' '                                            A38860 10490021
*                                                                       10500002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         10510002
*                                                                       10520002
         XCTLTABL ID=(NEXTLOAD,I2,LASTLOAD,I7),SVC=032,BRT=YES,  Y02080X10530002
               LENGTH=                                           Y02080 10532002
         EJECT                                                   Y02080 10540002
JFCBKEN  DSECT                                                          10580000
         IEFJFCBN                                                       10620000
         SPACE 3                                                 Y02080 10640002
         IECDSECS CVT,UCB,DSAB,EXPAND=YES                        Y02134 10660002
DSCBWKAR IECALLWA EP,F4,D1=(1)          ALLOCATE WORK AREA       Y02080 10680002
         END                                                            11820000
