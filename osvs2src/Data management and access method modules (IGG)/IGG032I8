 TITLE 'IGG032I8 - ISAM - NEW VOL DUPL NAME SEARCH'                     00020000
IGG032I8 CSECT                                                          00028000
*                                                                       00030002
*MODULE NAME = IGG032I8                                                 00030402
*                                                                       00030802
*DESCRIPTIVE NAME = ISAM - NEW VOL DUPL NAME SEARCH                     00031202
*                                                                       00031602
*COPYRIGHT = NONE                                                       00031702
*                                                                       00031802
*CHANGE ACTIVITY = SEE BELOW                                            00031902
*                                                                       00033902
*          VS2 RELEASE 01 DELETIONS                                     00038002
*0000                                                            YM2930 00040002
*                                                                       00042002
*          RELEASE 16 DELETIONS                                         00044002
*1463                                                              AAAA 00046002
*          RELEASE 17 DELETIONS                                         00048002
*          RELEASE 18 DELETIONS                                         00052000
*          RELEASE 19 DELETIONS                                         00060000
*0793041000,045600                                               O19117 00064019
*          RELEASE 20 DELETIONS                                         00068000
*          RELEASE 21 DELETIONS                                         00076000
*1231003000-003400,006000-006200,015200,016000-016600,029600-    A38860 00077021
*1231029800,036000-036200,038800,040200-040400,041140,041400,    A38860 00078021
*1231047400,048000,048800,049600-049800,050000,069800-070000,    A38860 00079021
*1231081800                                                      A38860 00080021
*          RELEASE 21.7 DELETIONS/CHANGES                               00081002
*0000040860-040880                                              SA53153 00081202
*0000064400-065000                                              SA48172 00082021
*          RELEASE 22 DELETIONS                                         00084000
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00088002
*0000000030-000150,000300,000348,000920-001000,002840,004400-    Y02080 00088102
*0000004600,005200,005800-005870,006600,016100-016400,022377-    Y02080 00088202
*0000022384,023200,025800,027400,028400,032100,033430-033820,    Y02080 00088302
*0000034200,034800,035800,036400,037080,037320,040400,040840,    Y02080 00088402
*0000040960-040980,041040,041080,041160-041200,046000-046800,    Y02080 00088502
*0000047200-047600,048000-048100,059000-059200,060800,062800,    Y02080 00088602
*0000065600,067400,069840-070080,070600-085320                   Y02080 00090002
*0000022307,022363,031000-032800,050200-050600,052000-052400     Y02134 00092002
*0000002000,004600,005200-005400,040940,041060,057200            Y02078 00094002
*0000000100,037100,037160-037308                                 Y02082 00096002
*0000                                                            Y02144 00098002
*                                                                       00100002
*STATUS CHANGE LEVEL 003                                                00110019
*FUNCTION - MULTI-VOLUME DATA SETS - THIS MODULE READS IN THE DSCB      00120000
*           FORMAT 4 DATA FIELD, THE FIRST DSCB FORMAT 5, AND PERFORMS  00140000
*           A DUPLICATE NAME SEARCH OF THE VTOC ON SUBSEQUENT VOLUMES.  00160000
*           IT ALSO READS IN THE DATA FIELD OF ANY DUPLICATE NAME       00180000
*           DSCB FOUND.  IF THE DIRF BIT IS SET IN THE FORMAT 4         00200002
*           DSCB, THIS MODULE ISSUES MESSAGE IEC602I WITH CODE=12       00205002
*           AND TERMINATES THE SPACE ALLOCATION.                        00210002
*                                                                       00220000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGG032I8.  ENTRY IS   00240000
*          FROM MODULE IGG032I7 ONLY.                                   00260000
*                                                                       00280000
*INPUT - AT ENTRY TO THIS MODULE, REGISTER 10 POINTS TO THE TIOT        00282021
*        ENTRY AND REGISTER 13 POINTS TO THE ALLOCATE WORK AREA.        00284002
*                                                                       00286021
*        IF MORE THAN ONE DD STATEMENT IS USED IN REQUESTING SPACE,     00288021
*        THE SEVEN LOW-ORDER BYTES OF THE DDNAME FIELD IN ALL BUT THE   00290021
*        FIRST ISAM DD ENTRY ARE USED TO CREATE THE FOLLOWING SPECIAL   00292021
*        ISAM ALLOCATE INTERFACE:                                       00294021
*                                                                       00296021
*              BYTE 1                                                   00298021
*                   BITS 0 AND 1   00 - ABSOLUTE TRACK REQUEST          00300021
*                                  01 - BLANK SPACE REQUEST             00302021
*                                  11 - CONTIGUOUS SPACE REQUEST        00304021
*                                                                       00306021
*                   BIT 2          THIS IS THE SECOND DD CARD.          00308021
*                                                                       00310021
*                   BIT 5          OVFLOW HAS BEEN ALLOCATED.           00312021
*                                                                       00314021
*                   BIT 6          PRIME HAS BEEN ALLOCATED.            00316021
*                                                                       00318021
*                   BIT 7          INDEX HAS BEEN ALLOCATED.            00320021
*                                                                       00322021
*              BYTES 2 - 3         CURRENT VOLUME SEQUENCE NUMBER       00324021
*                                  FOR SECOND OR THIRD DD CARD          00326021
*                                                                       00328021
*              BYTES 4 - 7         POINTER TO THE FIRST TIOT ENTRY      00330021
*                                  FOR THIS REQUEST                     00332021
*                                                                       00334021
*OUTPUT - UPON TRANSFERRING TO THE FIRST LOAD, IGG032I1, THE WORK       00336021
*         AREA WILL CONTAIN THE FORMAT 4 AND FIRST FORMAT 5 DSCB'S,     00338021
*         THE VTOCADR AND DADSMADR, AND THE ADDRESS AND DATA            00340021
*         PORTION OF ANY DUPLICATE NAME FORMAT 1 DSCB.                  00342021
*                                                                       00360000
*EXTERNAL ROUTINES - SVC'S ISSUED IN MACRO EXPANSIONS                   00380000
*   EXCP(0) READ FROM OR WRITE TO DIRECT ACCESS DEVICE                  00400000
*   WAIT(1) WAIT ON EVENT CONTROL BLOCK                                 00420000
*   OTHER SVCS ISSUED - RESERVE(56) ENQ THE VTOC                        00440002
*                     - WTO(35) WRITE MESSAGE TO OPERATOR               00460002
*                                                                       00470002
*   OTHER MACROS ISSUED - IEFJFCBN - BUILD JFCB                         00480000
*                       - IECALLWA - ALLOCATE WORK AREA                 00490002
*                       - IECSDSL1 - BUILD DSCBS                        00500000
*                       - IECDSECS - EXPAND CVT, RRPL, AND UCB DSECTS   00520002
*                                                                       00560000
*EXITS - NORMAL - BRANCH TO IGG032I1 IF MULTI-VOLUME                    00580002
*      - ERROR  - BRANCH TO IGG032I7 WITH ERROR CODE IN REGISTER 5      00587002
*                                                                       00594021
*        ERROR CODES THAT CAN BE ISSUED BY IGG032I8:                    00601021
*                                                                       00608021
*        04 - DUPLICATE NAME DSCB ON VOLUME                             00615021
*                                                                       00622021
*        0C - PERMANENT I/O ERROR                                       00629021
*                                                                       00630002
*        A0 - ISAM ALLOCATION TERMINATED DUE TO POSSIBLE VTOC ERRORS    00635002
*                                                                       00640000
*TABLES/WORK AREA - DADSM WORK AREA DESCRIBED BY MACRO IECALLWA         00660002
*                                                                       00680000
*              ***************************************                  00700000
*              *             DADSM TABLE             *                  00720000
*              ***************************************                  00740000
*                                                                       00760000
*              ***************************************                  00780000
*              *        *         *                  *                  00800000
*              *  TYPE  *  NO OF  *     USED HOLE    *                  00820000
*              *  FLAG  * ENTRIES *      COUNTER     *                  00840000
*              *        *         *                  *                  00860000
*              ***************************************                  00880000
*              *                  *                  *                  00900000
*              *       RTA        *      RTA+1       *                  00920000
*              *                  *                  *                  00940000
*              ***************************************                  00960000
*              *                  *                  *                  00980000
*              *       RTA        *      RTA+1       *                  01000000
*              *                  *                  *                  01020000
*              ***************************************                  01040000
*              *                  *                  *                  01060000
*              *       RTA        *      RTA+1       *                  01080000
*              *                  *                  *                  01100000
*              ***************************************                  01120000
*              *                  *                  *                  01140000
*              *       RTA        *      RTA+1       *                  01160000
*              *                  *                  *                  01180000
*              ***************************************                  01200000
*              *                  *                  *                  01220000
*              *       RTA        *      RTA+1       *                  01240000
*              *                  *                  *                  01260000
*              ***************************************                  01280000
*                                                                       01300000
*                                                                       01320000
*              TYPE FLAG = 02 - BPAM DIRECTORIES REQUESTED.             01340000
*                                                                       01360000
*                        = 40 - USER LABELS REQUESTED                   01364021
*                                                                       01368021
*                        = 80 - SET MUST COMPLETE IS ACTIVE             01372021
*                                                                       01376021
*                                                                       01380000
*              NO OF ENTRIES = NUMBER OF ENTRIES WITHIN DADSM TABLE.    01400000
*                                                                       01420000
*                                                                       01440000
*              RTA = THE STARTING TRACK OF THE ALLOCATED EXTENT.        01460000
*                                                                       01480000
*                                                                       01500000
*              RTA+1 = THE STARTING TRACK OF THE NEXT AVAILABLE EXTENT. 01520021
*                                                                       01540000
*ATTRIBUTES - REENTRANT, TRANSIENT                                      01560000
*                                                                       01580000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 1024 BYTES                    01610002
*          WORK AREA = AS DEFINED IN THE IECALLWA MACRO                 01640002
*          RPS WORK AREA = AS DEFINED IN THE IECRPS MACRO               01650002
*                                                                       01680000
*REGISTER USAGE                                                         01700000
*              REGISTERS 0-9 WORK REGISTERS                             01720000
*              REGISTER 10 - TIOT SET UP TABLE POINTER                  01740000
*              REGISTER 11 - JFCB POINTER                               01760000
*              REGISTER 12 - BASE REGISTER                              01780000
*              REGISTER 13 - WORK AREA POINTER                          01800000
*              REGISTER 14 - SUBROUTINE LINKAGE AND WORK REGISTER       01820000
*              REGISTER 15 - WORK REGISTER AND ERROR CODE REGISTER      01840000
*                                                                       01860000
***** REGISTER NAMES *****                                              01880000
RZERO    EQU   0                                                        01900000
RONE     EQU   1                                                        01920000
RTWO     EQU   2                                                        01940000
RTHREE   EQU   3                                                        01960000
RFOUR    EQU   4                                                        01980000
RFIVE    EQU   5                                                        02000000
RSIX     EQU   6                                                        02020000
RSEVEN   EQU   7                                                        02040000
REIGHT   EQU   8                                                        02060000
RNINE    EQU   9                                                        02080000
DRBAK    EQU   9                                                        02100000
RTEN     EQU   10                                                       02120000
RJFCB    EQU   11                                                       02140000
RBASE    EQU   12                                                       02160000
RWORK    EQU   13                                                       02180000
RETURN   EQU   14                                                       02200000
RFTEN    EQU   15                                                       02220000
*                                                                       02222021
* OTHER EQUATES                                                         02224021
*                                                                       02226021
TWO      EQU   2                        CONSTANT OF TWO          Y02080 02226402
K4       EQU   4                        CONSTANT OF FOUR        SA53153 02226602
EIGHT    EQU   8                        CONSTANT OF EIGHT        Y02080 02226802
K12      EQU   12                       CONSTANT OF TWELVE       Y02080 02227002
UNCHAIN  EQU   X'00'                    NO COMMAND CHAINING      Y02080 02227502
WRDATA   EQU   X'05'                    WRITE DATA COMMAND       Y02080 02228002
RDDATA   EQU   X'06'                    READ DATA COMMAND        Y02080 02228502
SKIP     EQU   X'10'                    SUPPRESS DATA TRANSFER   Y02080 02229002
CHAIN    EQU   X'40'                    COMMAND CHAINING BIT     Y02080 02229502
DIRFBIT  EQU   X'04'                    VTOC INTERRUPT BIT       O19117 02230019
TIOEVOLS EQU   2                        OFFSET TO NBR OF DEVICES A38860 02231421
TIOEDDNM EQU   4                        OFFSET TO DDNAME         A38860 02232121
ISAMSTAT EQU   5                        OFFSET TO ALLOCATION     A38860 02232821
*                                       STATUS                   A38860 02233521
VOLSQCTR EQU   6                        OFFSET TO DS1VOLSQ CTR   A38860 02234221
TIOTPTR  EQU   8                        OFFSET TO 1ST ENTRY PTR  A38860 02234921
UCBENTRY EQU   16                       OFFSET TO 1ST UCB ENTRY  A38860 02235621
BLANK    EQU   X'40'                    EBCDIC BLANK             A38860 02237021
CSWAD    EQU   8                        CSW OFFSET IN IOB       SA53153 02237202
UCBADDR  EQU   32                       DISP. TO UCB ADDR IN DEB Y02078 02237502
UUU      EQU   34                       DISP. TO UUU IN MESSAGE  Y02078 02238002
VOLSER   EQU   38                       DISP. TO VOLSER IN MSG   Y02078 02238502
DIRFERR  EQU   X'A0'                    DIRF BIT SET ERROR CODE  Y02078 02239002
*                                                                       02240000
         BALR  RBASE,0                                                  02280000
         USING RELOCCP,RBASE                                            02300000
         USING ALLOCWKA,RWORK           WORK AREA ADDRESSABILITY Y02080 02320002
         USING JFCBKEN,RJFCB                                            02340000
*                                                                       02360000
* THIS SECTION RELOCATES THE CHANNEL PROGRAM FOR READING IN THE DSCB    02380000
* FORMAT 4, THE FIRST DSCB FORMAT 5, AND THE DUPLICATE NAME SEARCH OF   02400000
* THE VTOC ON THE NEXT VOLUME.                                          02420000
*                                                                       02440000
RELOCCP  LM    RZERO,RNINE,CHANPROG     LOAD THE FIRST FIVE CCWS        02460000
         ALR   RZERO,RWORK              ADD RELOCATION ADDRESS          02480000
         ALR   RTWO,RWORK                                               02500000
         ALR   RFOUR,RWORK                                              02520000
         ALR   RSIX,RWORK                                               02540000
         ALR   REIGHT,RWORK                                             02560000
         STM   RZERO,RNINE,CCW1         STORE THE 1ST FIVE CCWS  Y02080 02580002
         LM    RZERO,RNINE,CHANPROG+40  LOAD THE NEXT FIVE CCWS         02600000
         LA    RFTEN,0(RJFCB)                                           02620000
         ALR   RZERO,RWORK              ADD RELOCATION ADDRESS          02640000
         ALR   RTWO,RFTEN               ADD JFCB ADDRESS                02660000
         ALR   RFOUR,RWORK              ADD RELOCATION ADDRESS          02680000
         ALR   RSIX,RWORK                                               02700000
         ALR   REIGHT,RFTEN             ADD JFCB ADDRESS                02720000
         STM   RZERO,RNINE,CCW6         STORE SECOND FIVE CCWS   Y02080 02740002
         LM    RZERO,RFIVE,CHANPROG+80  LOAD LAST THREE CCWS            02760000
         ALR   RZERO,RWORK              ADD RELOCATION ADDRESS          02780000
         ALR   RTWO,RWORK                                               02800000
         ALR   RFOUR,RWORK                                              02820000
         STM   RZERO,RFIVE,CCW11        STORE LAST THREE CCWS    Y02080 02840002
*                                                                       02860000
* THIS SECTION UPDATES THE UCB POINTER IN THE DEB.                      02880000
*                                                                       02900000
         L     RSIX,CVTPTR              PICK UP THE CVT POINTER         02920000
         USING CVT,RSIX                                                 02940000
         LA    RTWO,UCBENTRY(,RTEN)     POINT TO 1ST UCB ENTRY   A38860 02970021
         SR    RFIVE,RFIVE                                              03000000
         IC    RFIVE,CTR                PICK UP UCB COUNTER AND         03020000
         SLL   RFIVE,2                     MULTIPLY TIMES FOUR TO       03040000
         AR    RTWO,RFIVE                  CALCULATE ADDRESS OF THIS    03060000
*                                          UCB ENTRY IN TIOT            03080000
         L     RTEN,0(,RTWO)            GET UCB ADDRESS          Y02134 03100002
         LA    RTEN,0(,RTEN)            CLEAR HIGH BYTE          Y02134 03150002
         USING UCB,RTEN                                                 03300000
         L     RFTEN,CVTPCNVT           CONVERT ROUTINE ADDRESS         03320000
         LA    RONE,DEB                 R1 = DEB ADDRESS                03340000
MAINUCB  ST    RTEN,DEB+32              STORE MAIN UCB PTR IN DEB       03385013
         L     RZERO,SRTEFSCT           PICK UP THE VTOC TTR0           03388013
         MVC   MIELNAME(6),SRTEVOLI     SAVE VOLUME SERIAL NUMBER  AAAA 03389016
ZEROCLR  IC    RZERO,ZEROS              CLEAR LOW ORDER BYTE            03391013
         MVI   DEB+32,X'C0'             RESTORE DEVICE MODE             03394013
         LA    RTWO,SEEK                R2 = ADDRESS OF RESULTS         03400000
         STM   RJFCB,RFTEN,IECREGSV+K12  SAVE REGISTERS          Y02080 03420002
         LR    RTHREE,RWORK             SAVE WORK AREA POINTER          03440000
         BALR  RETURN,RFTEN             GO TO THE CONVERT ROUTINE       03460000
         LM    RJFCB,RFTEN,IECREGSV+K12-FIRST(RTHREE)            Y02080 03480002
*                                       REESTABLISH WORK AREA ADDRESS   03500000
         DROP  RSIX                                                     03520000
         DROP  RTEN                                                     03540000
         MVC   VTOCADR(5),SEEK+3        PICK UP VTOC AND FIRST DADSM    03560000
         LA    RTWO,CCW1                PICK UP 1ST CCW ADDRESS  Y02080 03580002
         ST    RTWO,IOB+16              SET UP ADDR OF FIRST CCW A38860 03610021
         SR    RONE,RONE                ZERO REGISTER            Y02080 03620002
         STH   RONE,ENQAREA+TWO         CLEAR FOR RESERVE MACRO  Y02080 03630002
*                                                                       03660000
* LINK TO THE ENQ ROUTINE TO ENQ THE VTOC ON THE NEXT VOLUME.           03680000
*                                                                       03700000
       RESERVE (MJELNAME,MIELNAME,E,6,SYSTEMS),MF=(E,ENQAREA),   YM3022X03716002
               UCB=DEB+32                                               03724016
*                                                                       03726002
         OI    DSMADTB2,DSMVTOCR        SET VTOC ENQ'ED SWITCH   Y02144 03728002
         L     RONE,IECRRPRM            RECOVERY RTN LIST ADDR   Y02144 03730002
         USING RRPLIST,RONE             PARM LIST ADDRESSABILITY Y02144 03732002
         ST    RTEN,RRUCBPTR            SAVE UCB ADDRESS         Y02144 03734002
         DROP  RONE                                              Y02144 03736002
*                                                                       03740000
         XC    DSCBF1,DSCBF1            ZERO FORMAT 1 DSCB AREA  Y02080 03750002
         LA    RETURN,CHECK             SET UP RETURN ADDRESS           03760000
*                                                                       03780000
* EXECUTE THE CHANNEL PROGRAM TO READ IN THE DATA PORTION OF A FORMAT 4 03800000
* , THE FIRST FORMAT 5, TO PERFORM A DUPLICATE NAME SEARCH, AND TO      03820000
* READ IN THE DATA PORTION OF ANY DUPLICATE NAME DSCB FORMAT 1.         03840000
*                                                                       03860000
EXECUTET EQU   *                                                 A38860 03870021
         MVI   ECB,X'00'                CLEAR ECB                A38860 03880021
         EXCP  IOB                                                      03900000
         WAIT  1,ECB=ECB                                                03920000
         TM    ECB,X'20'                CHECK FOR SUCCESSFUL COMPLETION 03940000
         BCR   7,RETURN                 BRANCH IF COMPLETION SUCCESSFUL 03960000
PERMERR  EQU   *                                                SA53153 03970002
         LA    RFIVE,12                 SET ERROR CODE FOR PERMANENT    03980000
*                                          I/O ERROR                    04000000
ERRXCTL  EQU   *                                                 A38860 04020021
         LA    RTWO,ERRORLD             POINT TO ID OF IGG032I7  Y02080 04030002
         B     LEAVE                                                    04060000
*                                                                       04080000
CHECK    EQU   *                                                 O19117 04082019
         TM    CCW3+K4,CHAIN+SKIP       LAST I/O WAS FOR         Y02080 04084002
         BZ    WRDONE                   REWRITE OF F4 DSCB      SA53153 04085002
         MVC   CCW9+K4(K4),IOB+CSWAD    SAVE CSW COMMAND ADDR   SA53153 04086002
         BO    CHK2                     BRANCH IF LAST I/O WAS  SA53153 04087002
*                                       FOR DUP DUP NAME SEARCH SA53153 04088002
         XI    DS4VTOCI,DIRFBIT         SET/TEST DIRF BIT        O19117 04090019
         TM    DS4VTOCI,DIRFBIT         TEST RESULTS             O19117 04092019
         BZ    ISSUEMSG                 BRANCH IF DIRF BIT       Y02078 04094002
*                                       WAS PREVIOUSLY SET       Y02078 04095002
         MVI   CCW3,WRDATA              SET WRITE DATA CMMD      Y02080 04096002
         MVI   CCW3+K4,UNCHAIN          RESET CMMD CHAINING      Y02080 04098002
         B     EXECUTET                 GO WRITE BACK F4         O19117 04100019
WRDONE   EQU   *                                                 O19117 04102019
         MVI   CCW3,RDDATA              RESTORE READ DATA CMMD   Y02080 04104002
         MVI   CCW3+K4,CHAIN+SKIP       SET SKIP FLAG TO PREVENT Y02080 04108002
*                                       REREAD OF F4                    04110019
CHK2     EQU   *                                                 O19117 04112019
         L     RTEN,ATIOTPTR            LOAD PTR TO DD ENTRY     Y02080 04120002
         L     RTWO,CCW9+K4             GET CSW COMMAND ADDRESS SA53153 04125002
         LA    RTWO,0(RTWO)             CLEAR HIGH BYTE         SA53153 04130002
         LA    RTHREE,CCW9              GET CCW9 ADDRESS        SA53153 04135002
         XR    RONE,RONE                PREPARE TO RESTORE CCW9 SA53153 04140002
         ST    RONE,CCW9+K4             TO ITS ORIGINAL STATUS  SA53153 04145002
         CLR   RTWO,RTHREE              TEST IF DSNAME FOUND    SA53153 04150002
         BE    NODSNAME                 BRANCH IF NOT FOUND     SA53153 04155002
         CLI   F5OUT,X'F1'              CHECK FOR A FORMAT IDENTIFIER   04160000
*                                          FOR A FORMAT 1 DSCB          04180000
         BE    SAMENAME                 BRANCH IF A DUPLICATE NAME      04200000
*                                          DSCB FORMAT 1 HAS BEEN READ  04220000
         B     PERMERR                  BAD VTOC EXIT           SA53153 04230002
*                                                                       04240000
* THIS SECTION TESTS FOR BOS PACK AND SETS THE HIGH WATER MARK TO THE   04260000
* END OF THE CYLINDER FOR DUPLICATE NAME SEARCH.                        04280000
*                                                                       04300000
NODSNAME EQU   *                                                SA53153 04310002
         TM    DS4VTOCI,X'80'           CHECK FOR A SPECIAL TYPE OF     04320000
*                                          VOLUME                       04340000
         BC    8,NOTBOS                 BRANCH IF NOT A SPECIAL VOLUME  04360000
         CLC   DS4HPCHR(4),DS4VTOCE+6   CHECK HI WATER MARK BEING       04380000
*                                          UPDATED                      04400000
         BH    UPDATE                   BRANCH IF NOT UPDATED           04420000
         CLC   DS4HPCHR+4(1),DS4DEVDT   CHECK FOR HI WATER MARK BEING   04440000
*                                          COMPLETELY UPDATED           04460000
         BNH   NOTBOS                   BRANCH IF UPDATED               04480000
UPDATE   MVC   DS4HPCHR(4),DS4VTOCE+6   UPDATE HI WATER MARK TO POINT   04500000
         MVC   DS4HPCHR+4(1),DS4DEVDT      TO THE LAST RECORD,TRACK     04520000
*                                          AND CYLINDER OF THE VTOC     04540000
         B     EXECUTET                                                 04580000
NOTBOS   EQU   *                        BRANCH LABEL             Y02080 04590002
         MVC   DADSMADR,DSCBF5-EIGHT    SET UP F5 ADDRESS        Y02080 04600002
         MVC   CCW1(96),F5OUT           PICK UP F1 DATA IF SUCH AN F1   04700000
*                                       EXISTS AND REALIGN IT    Y02080 04710002
         MVC   DS1FMTID(DS1END-DS1FMTID),CCW1  REALIGN F1 DSCB   Y02080 04720002
         LA    RTWO,FIRSTLD             POINT TO ID OF IGG032I1  Y02080 04740002
*                                                                       04780000
LEAVE    EQU   *                                                 A38860 04790021
         IECRES LOAD,EXTPR=(RWORK),MODID=(RTWO),BRANCH=DIRECT    Y02080 04800002
*                                                                       04820000
* THIS SECTION EXAMINES THE LEGITMACY OF A DUPLICATE NAME FORMAT 1      04840000
*                                                                       04860000
SAMENAME EQU   *                                                 A38860 04870021
         CLI   TIOEDDNM(RTEN),BLANK     CHECK DDNAME IN TIOT     A38860 04880021
         BNE   DUPLNAME                 BRANCH IF THIS IS THE FIRST DD  04900000
*                                          ENTRY - ILLEGAL DUPLICATE    04920000
*                                          NAME DSCB FORMAT 1           04940000
         L     RNINE,TIOTPTR(,RTEN)     GET ADDR OF 1ST ENTRY    A38860 04970021
         L     RSIX,UCBENTRY(,RNINE)    PICK UP UCB ADDRESS      Y02134 05020002
         LA    RSIX,0(,RSIX)            CLEAR HIGH BYTE          Y02134 05070002
         SR    RFIVE,RFIVE                                              05080000
         IC    RFIVE,CTR                CALCULATE WHICH VOLUME DUPLI-   05100000
         SLL   RFIVE,2                     CATE NAME WAS FOUND ON       05120000
         AR    RFIVE,RTEN                                               05140000
         LA    RSEVEN,16                INCREMENT TO FIRST UCB          05160000
         AR    RFIVE,RSEVEN             PICK UP UCB ENTRY IN SECOND     05180000
         L     RSEVEN,0(,RFIVE)         GET UCB ADDRESS          Y02134 05200002
         LA    RSEVEN,0(,RSEVEN)        CLEAR HIGH BYTE          Y02134 05250002
         CR    RSIX,RSEVEN              COMPARE UCB POINTERS IN TIOT    05260000
         BNE   DUPLNAME                 BRANCH IF POINTERS AREN'T THE   05280000
*                                          SAME-ILLEGAL DUPLICATE NAME  05300000
*                                          FORMAT 1 DSCB                05320000
*                                                                       05340000
* THIS SECTION TAKES THE CCHHR OF THE RECORD BEYOND THE DUPLICATE NAME  05360000
* FORMAT 1 DSCB AND CALCULATES THE ADDRESS OF THIS FORMAT 1             05380000
*                                                                       05400000
         SR    RETURN,RETURN            REDUCE THE RECORD NUMBER BY ONE 05420000
         IC    RETURN,COUNT+4                                           05440000
         BCT   RETURN,ADJUST            CHECK FOR RECORD NUMBER ZERO -  05460000
*                                       BACKING OVER A TRACK BOUNDRY    05480000
*                                       BRANCH IF RECORD NUMBER NOT     05500000
*                                          ZERO                         05520000
         IC    RETURN,DS4DEVDT          SET RECORD NUMBER TO MAXIMUM    05540000
*                                          NUMBER OF DSCB'S PER TRACK   05560000
ADJUST   STC   RETURN,COUNT+4                                           05580000
         MVC   SAVEADR(5),COUNT         SAVE THE ADDR OF THE FORMAT 1   05600000
         B     NOTBOS                                                   05620000
DUPLNAME LA    RFIVE,4                  SET UP ERROR CODE FOR ILLEGAL   05640000
*                                          DUPLICATE NAME DSCB FORMAT 1 05660000
         B     ERRXCTL                                                  05680000
*                                                                       05681002
* IF THE DIRF BIT WAS PREVIOUSLY SET IN THE FORMAT 4 DSCB, THIS         05682002
* SECTION ISSUES MESSAGE IEC602I WITH CODE=12.                          05683002
*                                                                       05684002
ISSUEMSG EQU   *                        BRANCH LABEL             Y02078 05685002
         MVC   DSCBF1(MSGEND-ERRMSG),ERRMSG  MOVE IN MESSAGE     Y02078 05686002
         L     RTEN,DEB+UCBADDR         LOAD UCB ADDRESS         Y02078 05687002
         USING UCB,RTEN                 UCB ADDRESSABILITY       Y02078 05688002
         MVC   DSCBF1+UUU(L'UCBNAME),UCBNAME  MOVE IN EBCDIC UCB Y02078 05689002
*                                       CHANNEL/UNIT ADDRESS     Y02078 05690002
         MVC   DSCBF1+VOLSER(L'SRTEVOLI),SRTEVOLI  MOVE IN VOLID Y02078 05691002
         WTO   MF=(E,DSCBF1)            ISSUE ERROR MESSAGE      Y02078 05692002
         LA    RFIVE,DIRFERR            LOAD ERROR CODE          Y02078 05693002
         B     ERRXCTL                  GO BRANCH TO IGG032I7    Y02078 05694002
*                                                                       05700000
* CHANNEL PROGRAM                                                       05706021
*                                                                       05712021
         DS    0F                       FULLWORD BOUNDARY        Y02078 05720002
CHANPROG EQU   *                                                        05740000
*CCW1                                                                   05760000
         DC    X'31'                    SEARCH EQUAL ID FOR VTOC DSCB   05780000
         DC    AL3(0+VTOCADR-FIRST)                                     05800000
         DC    X'4000'                                                  05820000
         DC    H'5'                                                     05840000
*CCW2                                                                   05860000
         DC    X'08'                    TIC BACK TO SEARCH              05880000
         DC    AL3(0+CCW1-FIRST)        TIC TO CCW1              Y02080 05900002
ZEROS    DC    F'0'                     FULLWORD OF ZEROS        Y02080 05920002
*CCW3                                                                   05940000
         DC    X'06'                    READ DATA FOR VTOC DSCB         05960000
         DC    AL3(0+DS4IDFMT-FIRST)                                    05980000
         DC    X'4000'                                                  06000000
         DC    H'96'                                                    06020000
*CCW4                                                                   06040000
         DC    X'9E'                    READ KEY AND DATA FOR F5        06060000
         DC    AL3(DSCBF5-8-FIRST)      BUFFER ADDR              Y02080 06080002
         DC    X'4000'                                                  06100000
         DC    H'148'                                                   06120000
*CCW5                                                                   06140000
         DC    X'F1'                    SEARCH FOR LAST F1 DSCB         06160000
         DC    AL3(0+DS4HPCHR-FIRST)                                    06180000
         DC    X'4000'                                                  06200000
         DC    H'5'                                                     06220000
*CCW6                                                                   06240000
         DC    X'08'                    TIC TO SEARCH NAME EQUAL        06260000
         DC    AL3(0+CCW10-FIRST)       TIC TO CCW10             Y02080 06280002
         DC    F'0'                                                     06300000
*CCW7                                                                   06320000
         DC    X'A9'                    SEARCH NAME EQUAL ON LAST F1    06340000
         DC    AL3(000000)                 THIS ADDRESS MUST BE ALTERED 06360000
         DC    X'6000'                                                  06380000
         DC    H'44'                                                    06400000
*CCW8                                                                   06420000
         DC    X'06'                    READ DATA OF THE LAST   SA48172 06440021
         DC    AL3(0+F5OUT-FIRST)       FORMAT 1 WITH THE SKIP  SA48172 06460021
         DC    X'3000'                  BIT SET IN ORDER TO END SA48172 06480021
         DC    H'96'                    THE CHANNEL PROGRAM     SA48172 06500021
*CCW9                                                                   06520000
         DC    X'08'                    TIC TO READ DATA OF DUP NAME    06540000
         DC    AL3(0+CCW12-FIRST)       TIC TO CCW12             Y02080 06560002
         DC    F'0'                                                     06580000
*CCW10                                                                  06600000
         DC    X'A9'                    SEARCH NAME EQUAL NOT LAST F1   06620000
         DC    AL3(000000)                 THIS ADDRESS MUST BE ALTERED 06640000
         DC    X'6000'                                                  06660000
         DC    H'44'                                                    06680000
*CCW11                                                                  06700000
         DC    X'08'                    TIC BACK TO SEARCH LAST F1      06720000
         DC    AL3(0+CCW5-FIRST)        TIC TO CCW5              Y02080 06740002
         DC    F'0'                                                     06760000
*CCW12                                                                  06780000
         DC    X'06'                    READ DATA OF DUP NAME DSCB      06800000
         DC    AL3(0+F5OUT-FIRST)                                       06820000
         DC    X'4000'                                                  06840000
         DC    H'96'                                                    06860000
*CCW13                                                                  06880000
         DC    X'12'                    READ COUNT OF NEXT DSCB FOR ID  06900000
         DC    AL3(0+COUNT-FIRST)                                       06920000
         DC    X'2000'                                                  06940000
         DC    H'5'                                                     06960000
*                                                                       06966021
* CONSTANTS                                                             06972021
*                                                                       06978021
ERRMSG   WTO   'IEC602I VTOC NOT CONVERTED ON UUU,VOLSER,12',    Y02078X06978502
               ROUTCDE=(4,10),DESC=4,MF=L                        Y02078 06979002
MSGEND   EQU   *                        MSG DELIMITER            Y02078 06979502
*                                                                       06980002
* TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                         06982002
*                                                                       06984002
         XCTLTABL ID=(FIRSTLD,I1,ERRORLD,I7),SVC=032,LENGTH=,    Y02080X06986002
               BRT=YES                                           Y02080 06988002
         SPACE 2                                                 Y02080 06990002
         IECDSECS CVT,RRPL,UCB,EXPAND=YES                        Y02144 07000002
JFCBKEN  DSECT                                                          07020000
         IEFJFCBN                                                       07040000
         EJECT                                                   Y02080 07050002
DSCBWKAR IECALLWA EP,F4,D1=(1),ADT=YES  ALLOCATE WORK AREA       Y02144 07060002
ENQAREA  EQU   ADSCBF4                  ENQ (RESERVE) PARM LIST  Y02080 07070002
MJELNAME EQU   ENQAREA+16               MAJOR ELEMENT NAME       Y02080 07080002
         END                                                            08540000
