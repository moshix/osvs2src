         TITLE 'IGG0CLCF -  OPEN, EXTEND, AND FORMAT'                   00050008
*********************************************************************   00100008
*                                                                       00150000
*01*  MODULE-NAME = IGG0CLCF                                   @YL026UD 00200000
*01*  STATUS = 00                                                       00250000
*01*  CHANGE-ACTIVITY = NEW FOR RELEASE 21                              00300000
*                       (AS IGC0002H,IGG0CLF2)                          00350008
*                       RENAMED AND CHANGED FOR VS2 RELEASE 2  @YL026UD 00400000
*                      SPLIT FROM IGG0CLCE FOR APAR OZ00006             00410000
*        VS2 RELEASE 037 CHANGES                                        00416037
* EXTENDED MVS CVOL SUPPORT                                    @Z40CSRC 00420008
*ADD 'RENT' TO LINKEDIT PARMS                                  @OZ07695 00423008
*D195500-196500,D197500-199000,A197500,C501000,A729451         @OZ15077 00426008
*A162510,C183100,A190010-190040                                @OZ17531 00429008
*A191605,A708000                                               @OZ25613 00432008
*A191641,A191683                                               @OZ26358 00435008
*********************************************************************** 00438008
*01*  DESCRIPTIVE-NAME =  OPEN, EXTEND, AND FORMAT                      00450008
*01* FUNCTION=   IGC0002H -                                    @YL026UD 01100000
*                1.  OPEN SYSCTLG DATA SET.                    @YL026UD 01150000
*                2.  STEPS TO NEXT EXTENT OF CATALOG DATA SET. @YL026UD 01200000
*                3.  EXTEND SYSCTLG DATA SET.                  @Z40CSRC 01210008
*                IGG0CLF2 -                                    @YL026UD 01250000
*                1.  FORMATS ALL OR PART OF A SYSCTLG DATA SET @YL026UD 01300000
*                    (256 BYTE RECORDS WITH 8 BYTE BINARY ZERO @YL026UD 01350000
*                    KEYS ARE WRITTEN.  THE FIRST RECORD WILL  @YL026UD 01400000
*                    CONTAIN AN INITIALIZED VOLUME INDEX BLOCK)@YL026UD 01450000
*     FOR AN OVERVIEW OF THIS MODULE AND ITS RELATIONSHIP WITH THE      01500000
*     OTHER CATALOG MANAGEMENT MODULES, REFER TO THE CVOL PROCESSOR     01550008
*     PLM, SY35-0011.                                          @Z40CSRC 01600008
*01*  NOTES = LABELS REFERED TO IN COMMENTARY ARE ENCLOSED IN SINGLE    01650000
*     QUOTES. EQUATED CONSTANTS ARE PREFIXED WITH 'D' OR 'X' WHEN THEY  01700000
*     ARE DECIMAL OR HEXADECIMAL RESPECTIVELY; FOR EXAMPLE, D12 EQU 12, 01750000
*     AND X12 EQU X'12'. ERROR CODES ARE SET USING 'ERRORXX' AT         01800000
*     CORRESPONDING LABELS, 'ERRXX'. BRANCHES ORIGINATE FROM LABELS     01850000
*     'IGG0CLCX'. FLAGS ARE LABELED 'FLAGX'.  IO IS DONE FROM EITHER A  01900000
*     SUBROUTINE NAMED 'CALLBLDL' OR A SUBROUTINE NAMED 'IO'. ADDRESS   01950000
*     CONVERSION IS ACCOMPLISHED IN SUBROUTINES NAMED 'TOABSL' AND      02000000
*     'TORLTV'. THESE CONVENTIONS ARE FOLLOWED IN EVERY MODULE WHERE    02050000
*     THE EVENT EXISTS.                                                 02100000
*02*    DEPENDENCIES = OPERATION OF THIS MODULE DEPENDS ON THE          02150000
*       COLLATING SEQUENCE OF THE EXTERNAL CHARACTER SET. REDEFINITION  02200000
*       OF THE CHARACTER CONSTANTS BY REASSEMBLY WILL RESULT IN A       02250000
*       CORRECT MODULE. THE CONSTANTS IN QUESTION ARE PREFIXED WITH     02300000
*       'CCD', FOR 'CHARACTER CODE DEPENDENT'.                          02350000
*02*    RESTRICTIONS = ALL DIRECT ACCESS STORAGE DEVICES EXCEPT 2321    02600000
*       DATA CELL ARE SUPPORTED BY CATALOG MANAGEMENT.                  02650000
*02*    REGISTER-CONVENTIONS = REGISTERS ARE LABELED 'R0,R1,...,R15'.   02700000
*       REQUIRED ADDITIONAL LABELS ARE EQUATED TO THESE. REGISTERS      02750000
*       COMMON TO ALL MODULES OF CATALOG MANAGEMENT ARE                 02800000
*       R4  BASE REGISTER FOR THE MODULE.                               02850000
*       R6  BASE REGISTER FOR THE WORKAREA DSECT.                       02900000
*       R8  BASE REGISTER FOR THE CAMLSTD DSECT.                        02950000
*02*    PATCH-LABEL = 'FIXAREA'                                @YL026UD 03000000
*01*  MODULE-TYPE = MODULE                                              03050000
*02*    PROCESSOR = ASSEMBLER                                           03100000
*02*    MODULE-SIZE = SEE LENGTH OF IGG0CLCF IN                         03150008
*                     EXTERNAL SYMBOL DICTIONARY ABOVE.                 03160008
*02*    ATTRIBUTES = REENTERABLE, READ ONLY, ENABLED, SUPERVISORY MODE  03200000
*01*  ENTRY = IGC0002H                                                  03250008
*02*    PURPOSE = TO OPEN OR EXTEND AN OS CVOL                 @Z40CSRC 03600008
*02*    LINKAGE = BALR 14,15                                   @Z40CSRC 03750008
*02*  INPUT =                                                  @Z40CSRC 03800008
*       (REQUEST TO OPEN CATALOG)                              @YL026UD 05150000
*       .  R0 CONTAINS ZERO                                    @YL026UD 05200000
*       .  R1 CONTAINS UCB ADDRESS OF THE VOLUME WHOSE         @YL026UD 05250000
*          CATALOG IS TO BE OPENED                             @YL026UD 05300000
*       .  R8 CONTAINS CAMLST ADDRESS                          @Z40CSRC 05310008
*       .  R15 CONTAINS THE ADDRESS OF A WORKAREA IN WHICH THE @YL026UD 05350000
*          DCB/DEB CHAIN IS TO BE BUILT.  THIS WORKAREA ALSO   @YL026UD 05400000
*          CONTAINS ENOUGH SPACE TO READ IN A DSCB.  IF OPEN   @YL026UD 05450000
*          IS SUCCESSFUL, CORE BEYOND THE DEB IS FREED.        @YL026UD 05500000
*       (REQUEST TO LOCATE NEXT EXISTING EXTENT)               @YL026UD 05550000
*       .  R0 CONTAINS THE DCB ADDRESS                         @YL026UD 05600000
*       .  R8 CONTAINS ADDRESS OF CAMLST                       @Z40CSRC 05602008
*       (REQUEST TO EXTEND SYSCTLG).                           @Z40CSRC 05610008
*       .  R0 CONTAINS ADDRESS OF DCB AREA.                    @Z40CSRC 05620008
*       .  R8 CONTAINS ADDRESS OF CAMLST.                      @Z40CSRC 05622008
*       .  THE REQUEST IS FOR A NEW EXTENT IF THE 'M'+1        @Z40CSRC 05642008
*          OF THE MBBCCHHR IN THE IOB OF THE CATALOG           @Z40CSRC 05644008
*          WORK AREA IS EQUAL TO THE 'M' IN THE NUMBER         @Z40CSRC 05646008
*          OF EXTENTS IN THE DEB.                              @Z40CSRC 05648008
*       (IF CONTROL HAS RETURNED VIA XCTL FROM EXTEND RTNS)    @Z40CSRC 05648408
*       .  R4 - CONTAINS ADDRESS OF EXTEND WORK AREA.          @Z40CSRC 05649208
*       .  R6 - CONTAINS ADDRESS OF SVRB                       @Z40CSRC 05649308
*       .  R7 - CONTAINS ADDRESS OF DCB.                       @Z40CSRC 05649808
*       .  R8 - CONTAINS ZERO.                                 @Z40CSRC 05649908
*       .  R9 - CONTAINS THE DCB ADDRESS FOR CATALOG.          @Z40CSRC 05650008
*       .  R10 - CONTAINS UCB ADDR FOR CATLG VOLUME.           @Z40CSRC 05680008
*        (GENERAL)                                             @Z40CSRC 06110008
*       .  THE ADDRESS OF THE CATALOG WORK AREA IS             @Z40CSRC 06120008
*          LOCATED AT OFFSET 32 OF THE DCB AREA.               @Z40CSRC 06130008
*02*    OUTPUT =                                                        06150000
*          ADDRESS OF THE DCB IS RETURNED IN R1.                        06550008
*          R15 - CONTAINS RETURN CODE.                         @Z40CSRC 06620008
*02*    EXIT-NORMAL = BR 14 WITH R15 = 0                       @Z40CSRC 06650008
*02*    EXIT-ERROR = BR 14 WITH R15 SET TO ERROR CODE:         @Z40CSRC 06700008
*        04 - SYSCTLG NOT FOUND OR INVALID.                    @Z40CSRC 06710008
*        08 - NO SECONDARY SPACE ALLOCATED.                    @Z40CSRC 06720008
*        12 - PERMANENT I/O ERROR.                             @Z40CSRC 06730008
*01*  EXTERNAL-REFERENCES = AS FOLLOWS.                                 06750000
*02*    ROUTINES = IECPRLTV, IECPCNVT, IGG0553A (EXTEND)                06800008
*02*    DATA-SETS = SYSCTLG                                             06850000
*02*    DATA-AREA = ALL DATA AREAS ARE DESCRIBED BY DSECTS AT THE END   06900000
*       OF THE MODULE LISTING.                                          06950000
*01*  TABLES = NONE                                                     07000000
*01*  MACROS = EXCP, WAIT, CVT, GETMAIN, FREEMAIN, DEQ                  07050000
*                                                                       07100000
*********************************************************************   07150008
         TITLE 'IGG0CLCF - (IGC0002H) CATALOG OPEN/EXTEND MODULE'       07200008
IGG0CLCF CSECT                                                          07210000
          USING CAMLSTD,R8        ESTABL BASE FOR CAMLST                07220000
         USING ENTRY,R9           ESTABL BASE FOR ENTRY                 07230000
         USING WORKAREA,R6        ESTABL BASE FOR WORKAREA              07240000
         BALR  BASE,0             SET BASE FOR MODULE                   07242000
         USING *,BASE             ESTABL BASE FOR MODULE                07244000
         B    MODLABEL                                                  07245200
         DC    C'IGG0CLCF'        MODULE IDENTIFIER                     07246000
         DC    C'&SYSDATE'        DATE OF ASSEMBLY             @Z40CSRC 07246408
MODLABEL EQU   *                                                        07248000
*********************************************************************** 07250000
*                                                                     * 07300000
*     IGC0002H - CATALOG OPEN MODULE                                  * 07350000
*                                                                     * 07400000
*********************************************************************** 07450000
*                                                              @YL026UD 07500000
         ENTRY IGC0002H                                        @YL026UD 07550000
*                                                                       07600000
IGC0002H EQU   *                                               @YL026UD 07650000
*                                                                       07700000
         LR    R2,BASE            SAVE CALLER'S BASE REGISTER  @YL026UD 07750000
         BALR  BASE,0             SET BASE FOR MODULE          @YL026UD 07800000
         USING *,BASE             ESTABL BASE FOR MODULE       @YL026UD 07850000
*                                                              @YL026UD 07900000
         LTR   R8,R8              TEST RETURNING FROM EXTEND   @Z40CSRC 07950008
         BZ    EXTENDB            YES, GO CHK SUCCESS          @Z40CSRC 08000008
         LTR   RFKEY,RFKEY        TEST FOR EXTEND REQUEST      @YL026UD 08200000
         BP    EXTEND             BRANCH FOR EXTEND REQUEST    @YL026UD 08250000
*                                                              @YL026UD 08300000
*      OPEN REQUEST                                            @YL026UD 08350000
*                                                              @YL026UD 08400000
         USING AREADCB,R15        SET DCB/DEB ADDRESSIBILITY   @YL026UD 08450000
         LR    R0,R2              SAVE CALLER'S BASE REGISTER  @YL026UD 08500000
         L     R2,BLDLP           OBTAIN 'BLDLAREA' ADDRESS    @YL026UD 08550000
         DROP  R15                                             @YL026UD 08600000
         STM   R3,R14,0(R2)       SAVE REGISTERS               @YL026UD 08650000
         ST    R0,4(R2)           SAVE CALLER'S BASE REG       @YL026UD 08700000
*                                                                       08750000
         L     RCVT,CVTPTR        PICK UP THE CVT POINTER.              08800000
         LR    RGAREA,R15         LOAD AREA ADDRESS.                    08850000
         USING CVT,RCVT           SET CVT ADDRESSABILITY.               08900000
         USING AREADCB,RGAREA     SET DCB/DEB ADDRESSABILITY.  @YL026UD 08950000
         USING UCB,RUCB           SET UCB ADDRESSABILITY.               09000000
         LR    RUCB,RPARM         SET UP UCB BASE REGISTER.             09050000
         XC    FMTSW(SWL),FMTSW   CLEAR ALL SWITCHES.                   09100000
         EJECT                                                          09150000
*                                                                       09200000
*********************************************************************** 09250000
*                                                                       09300000
* THE FOLLOWING CODE FROM THE LABEL BLDEB TO YESFMT INITIALIZES A       09350000
* DCB AND DEB IN THE WORK AREA PROVIDED.                                09400000
*                                                                       09450000
*********************************************************************** 09500000
*                                                                       09550000
*                                                                       09600000
*      CLEAR DEB AND SET UCB ADDRESS                                    09650000
*                                                                       09700000
RVTTR    EQU   0                  REG 0 HOLDS VTOC TTR                  09750000
RDBSET   EQU   6                  REG 6 USED TO SET UP THE DEB.         09800000
BLDEB    EQU   *                                                        09850000
         XC    DEB(DEBL),DEB      CLEAR THE DEB AREA.                   09900000
         ST    RUCB,DEBUCBAD      STORE UCB ADDRESS IN THE DEB.         09950000
         L     RVTTR,SRTEFSCT     GET THE VTOC TTR.                     10000000
*                                                                       10050000
*      INITIALIZE APPENDAGE VECTOR TABLE                                10100000
*                                                                       10150000
         MVC   DEBAPPAD,CVTXAPG   MOVE APP VECTOR TABLE ADDRESS.        10200000
         MVI   DEBAPPAD,FOUR      SET EXTENT CLASS.                     10250000
*                                                                       10300000
*      SET DCBDEBAD                                                     10350000
*                                                                       10400000
         LA    RDBSET,DEBDEBAD    USE AS DCB.                           10450000
         S     RDBSET,FDEBAD      MINUS DEB ID COMPL & DISPL.           10500000
         ST    RDBSET,DEBDCBAD    ACTUAL DCB ADDRESS.                   10550000
         MVI   DEBDVMOD,X10       FILE MASK, PERMIT SEEK HH.            10600000
         MVC   DEBENDCC(L'HICCHHNT),HICCHHNT SET HI UPPER EXTENT.       10650000
         MVI   DEBNMEXT,X01       NUMBER OF EXTENTS.                    10700000
*                                                                       10750000
*      CONVERT RELATIVE TO ACTUAL ADDRESSES                             10800000
*                                                                       10850000
RDEBP    EQU   1                  DEB POINTER FOR INPUT TO CNVT.        10900000
RRES     EQU   2                  RESULT RETURN AREA POINTER.           10950000
         IC    RVTTR,ZEROA        SET CONCAT NO. TO ZERO.               11000000
         L     RBR,CVTPCNVT       ENTRY OF CNVT RTN.                    11050000
         LA    RDEBP,DEB          GET DEB ADDRESS.                      11100000
         ST    RDEBP,DEBDEBAD     DEB POINTER.                          11150000
         LA    RRES,M2B2C2HR      CONVERTED RESULT AREA.                11200000
         LR    RGAREA2,RGAREA     SAVE AREA ADDR.                       11250000
         STM   R9,R13,DSCBK       SAVE VOLITILE REGISTERS.              11300000
         BALR  RGRET,RBR          GO TO THE CONVERT ROUTINE.            11350000
         LM    R9,R13,DSCBK-AREADCB(R8) RESTORE VOLATILE REGS. @YL026UD 11400000
         DROP  RCVT                                                     11450000
         DROP  RUCB                                                     11500000
         MVI   DS1FMTID,X00       ZERO THE FORMAT ID FIELD.             11550000
*                                                                       11600000
*      CONSTRUCT AN IOB AND ECB                                         11650000
*                                                                       11700000
RECBA    EQU   0                  REGS USED TO SET UP ECB/IOB.          11750000
RECBB    EQU   2                  REGS USED TO SET UP ECB/IOB.          11800000
RECBC    EQU   3                  REGS USED TO SET UP ECB/IOB.          11850000
         SR    RECBA,RECBA        ECB.                                  11900000
         LA    RECBB,AECB         ECB POINTER.                          11950000
         STM   RECBA,RECBB,AECB   STORE ECB POINTER.           @YL026UD 12000000
         LA    RECBA,CHPG         CHANNEL PROGRAM POINTER.     @YL026UD 12050000
         SR    RECBC,RECBC        BLOCK INCR FLD.              @YL026UD 12100000
         LR    R1,RDBSET          DCB POINTER FOR IOB          @YL026UD 12150000
         STM   RECBA,RECBC,AIOB+16  STORE ECB AND IOB.         @YL026UD 12200000
         MVI   AIOB,X42           SET UNRELATED REQUEST.                12250000
*                                                                       12300000
*      RELOCATE CHANNEL PROGRAM FOR DSCB READ                           12350000
*                                                                       12400000
RCCWA    EQU   0                  REGS USED TO SET CCW ADDRESSES.       12450000
RCCWB    EQU   2                  REGS USED TO SET CCW ADDRESSES.       12500000
RCCWC    EQU   3                  REGS USED TO SET CCW ADDRESSES.       12550000
         LM    RCCWA,RCCWC,CCW1   GET THE CCW CONSTANTS.       @YL026UD 12600000
         AR    RCCWA,RGAREA       MODIFY THE ADDRESSES                  12650000
         AR    RCCWB,RGAREA       IN THE PATTERN CCWS.                  12700000
         STM   RCCWA,RCCWC,CHPG   STORE THE CHANNEL PROGRAM    @YL026UD 12750000
         LM    RCCWA,RCCWC,CCW3   GET MORE CCW CONSTANTS       @YL026UD 12800000
         AR    RCCWA,RGAREA       MODIFY THE ADDRESSES         @YL026UD 12850000
         AR    RCCWB,RGAREA       IN THE PATTERN CCWS.         @YL026UD 12900000
         STM   RCCWA,RCCWC,CHPGAA STORE THE CHANNEL PROGRAM    @YL026UD 12950000
         LM    RCCWA,RCCWC,CCW5   GET MORE CCW CONSTANTS       @YL026UD 13000000
         AR    RCCWA,RGAREA       MODIFY THE ADDRESSES         @YL026UD 13050000
*                                 IN THE PATTERN CCWS.         @YL026UD 13100000
         STM   RCCWA,RCCWC,CHPGBB STORE THE CHANNEL PROGRAM.   @YL026UD 13150000
         LM    RCCWA,RCCWC,CCW7   GET MORE CCW CONSTANTS.      @YL026UD 13200000
         AR    RCCWA,RGAREA       MODIFY THE ADDRESSES                  13250000
         AR    RCCWB,RGAREA       IN THE PATTERN CCWS.                  13300000
         STM   RCCWA,RCCWC,CHPGCC STORE THE CHANNEL PROGRAM    @YL026UD 13350000
         LM    RCCWA,RCCWC,CCW9   GET MORE CCW CONSTANTS       @YL026UD 13400000
         AR    RCCWA,RGAREA       MODIFY THE ADDRESSES         @YL026UD 13450000
         AR    RCCWB,RGAREA       IN THE PATTERN CCWS.         @YL026UD 13500000
         STM   RCCWA,RCCWC,CHPGDD STORE REMAINING CHAN PROGS.  @YL026UD 13550000
*                                                                       13600000
*      SET SEARCH ARGUMENT AND READ DSCB                                13650000
*                                                                       13700000
         MVC   DSCBK(L'SYSCTLG),SYSCTLG  SET DS NAME.                   13750000
         MVC   DSCBK+8(L'DSCBK-L'SYSCTLG),DSCBK+7  BLANK REMAINDER      13800000
*                                                                       13850000
*      IO:  EXCP, WAIT, AND CHECK                                       13900000
*                                                                       13950000
         BAL   RGRET,IO3          GO TO THE IO ROUTINE.                 14000000
         TM    DS1FMTID,XFF       CHECK FORMAT ID FIELD.                14050000
         BZ    ERROR4             SYSCTLG DATA SET NOT FOUND.           14100000
         MVC   DSCBTRK,COUNT      SAVE CCHH OF SYSCTLG DSCB.            14150000
*                                                                       14160008
*      CHECK FOR RACF-INDICATED SYSCTLG                        @Z40CSRC 14170008
*                                                                       14180008
         TM    DS1DSIND,DS1RACDF  IS CATLG RACF INDICATED      @Z40CSRC 14190008
         BNO   CHKEXTD            NO, SKIP RACF CODE           @Z40CSRC 14192008
         L     RCWA,CATWKAP       GET ADDR OF CATLG WORK AREA  @Z40CSRC 14194008
         USING WORKAREA,RCWA      WORK AREA ADDRESSABLE        @Z40CSRC 14196008
         OI    FLAG5,OCWRACAT     SET RACF INDICATOR           @Z40CSRC 14198008
         DROP  RCWA                                            @Z40CSRC 14198408
*                                                                       14198808
CHKEXTD  EQU   *                  CHECK FOR EXTEND             @Z40CSRC 14199208
         CLI   EXTDSW,1           TEST THE EXTEND SWITCH.               14200000
         BH    YESFMT             BRANCH IF 2ND PASS OF EXTEND.         14250000
         BE    EXTENDA            BR IF 1ST PASS OF EXTEND.    @Z40CSRC 14300008
         EJECT                                                          14650000
*                                                                       14700000
* NOTE THAT THIS CODE IS ENTERED ONLY IF THE REQUEST IS FOR AN OPEN.    14750000
* THIS CODE BUILDS THE ACTUAL DEB/DCB FOR THE SYSCTLG DATA SET.         14800000
*                                                                       14850000
         TM    DS1LSTAR+2,XFF     'R' OF TTRLL IN DSCB.                 14900000
         BO    NOFMT              DON'T FORMAT.                         14950000
*                                                                       15000000
*      SET THE FORMAT FLAG ON                                           15050000
*                                                                       15100000
YESFMT   EQU   *                                                        15150000
         MVC   FMTSW,DS4DEVDB     SAVE DIRECTORY BLOCKS/TRACK.          15200000
*                                                                       15250000
*      GET NUMBER OF EXTENTS ALLOWED                                    15300000
*                                                                       15350000
REXT     EQU   12                 NUMBER OF EXTENTS REGISTER.  @YL026UD 15400000
NOFMT    EQU   *                                                        15450000
         SR    REXT,REXT                                                15500000
         IC    REXT,DS1NOEPV      GET NUMBER OF EXTENTS.                15550000
         LTR   REXT,REXT          IS EXTENT ALLOCATION ZERO?            15600000
         BZ    ERROR4             BRANCH IF NO EXTENTS ALLOCATED.       15650000
*                                                              @Y30LSRA 15651003
* IF THE CVOL RESIDE ON VIRTUAL DASD, THIS ROUTINE GETS CORE   @Y30LSRA 15652003
* TO BUILD A PARM LIST TO ACQUIRE THE SPACE ON DASD.  THE ADDR @Y30LSRA 15653003
* OF THIS SPACE IS TEMPORARILY SAVED IN THE UNUSED PORTIONS OF @Y30LSRA 15654003
* THE DEB.                                                     @Y30LSRA 15655003
*                                                              @Y30LSRA 15656003
         USING UCB,RUCB           ADDRESS UCB                  @Y30LSRA 15657003
         TM    UCBTBYT2,VIRTDASD  IS CVOL ON VIRT DASD         @Y30LSRA 15658003
         BNO   RNVIRT             DONT ISSUE GETMAIN FOR LIST  @Y30LSRA 15659003
         GETMAIN R,LV=L96,SP=230  GET NEEDED CORE              @Y30LSRA 15660003
         XC    D0(L96,R1),D0(R1)  ZERO OUT THE CORE            @Y30LSRA 15661003
         ST    R1,DEBDEBAD+D4     SAVE ADDR OF AREA IN UNUSED  @Y30LSRA 15662003
         MVC   D8(L6,R1),UCBVOLI  GET THE VOLID OF VIRT PACK   @Y30LSRA 15663003
         LA    R1,D28(,R1)        POINT TO PARAM LIST AREA     @Y30LSRA 15664003
         ST    R1,DEBDEBAD+D8     SAVE IT IN UNUSED            @Y30LSRA 15665003
         DROP  RUCB               DONT NEED IT ANYMORE         @Y30LSRA 15666003
RNVIRT   EQU   *                                               @Y30LSRA 15667003
*                                                                       15700000
*      FORMAT 1 DSCB EXTENT LOOP                                        15750000
*                                                                       15800000
RTOB     EQU   3                  EXTENT TO BASE.              @YL026UD 15850000
RFRL     EQU   7                  FROM LIMIT REGISTER.                  15900000
RFRS     EQU   6                  SIZE FO FROM REGISTER.                15950000
RFRB     EQU   5                  EXTENT FROM BASE.                     16000000
         STC   REXT,DEBNMEXT      STORE NO. OF EXTENTS.                 16050000
         LA    RTOB,DAREA-EXTL    SET EXTENT AREA POINTER      @Z40CSRC 16100008
         LA    RFRL,DS1EXT3       LIMIT FOR BXLE.                       16150000
         LA    RFRS,DS1EXT2-DS1EXT1 SIZE OF 'FROM' EXTENT.              16200000
         LA    RFRB,DS1SCALO+1    'FROM' BASE.                          16250000
         MVI   COUNT,X'00'        INITIALIZE M BYTE = ZERO     @OZ17531 16270008
BLDXTLP  EQU   *                                                        16300000
         LA    RTOB,EXTL(RTOB)    GO TO NEXT EXTENT IN DEB.             16350000
         BXLE  RFRB,RFRS,BLDXTM   BR IF STILL IN FORMAT 1 DSCB.         16400000
*                                                                       16450000
*      IO:  READ FORMAT 3 DSCB                                          16500000
*                                                                       16550000
RCCWH    EQU   1                  REG USED IN RELOCATING CCWS.          16600000
         MVC   CCHHR(CCHHRL),DS1PTRDS  FORMAT 3 POINTER.                16650000
         LM    RCCWA,RCCWH,CCWRDKD  READ KEY DATA CCW.                  16700000
         AR    RCCWA,RGAREA       RELOCATE.                             16750000
         STM   RCCWA,RCCWH,CHPG+CCW3-CCW1    MODIFY EXISTING CHAN PROG. 16800000
         MVC   DSVEXTNT,DEBSTRCC  SAVE OFF 1ST EXTEND          @Z40CSRC 16810008
         XC    DEBSTRCC(FOUR),DEBSTRCC CLEAR START CCHH        @Z40CSRC 16820008
         MVC   DEBENDCC(L'HICCHHNT),HICCHHNT ALLOW FULL ACCESS @Z40CSRC 16830008
         BAL   RGRET,IO3          EXCP, WAIT CHECK.                     16850000
         MVC   DEBSTRCC(L'DSVEXTNT),DSVEXTNT RESTORE 1ST EXT   @Z40CSRC 16860008
         MVC   DS1FMTID(NINTY),DS1DSSN  SHIFT FLD LEFT 1 BYTE.          16900000
         LA    RFRB,DSCBK4        'FROM' EXTENT BASE.                   16950000
*                                                                       17000000
*      SET FORMAT 3 EXTENTS                                             17050000
*                                                                       17100000
BLDXTM   EQU   *                                                        17150000
         MVC   DEBUCBAD-DAREA((L'DEBUCBAD+L'DEBBINUM),RTOB),DEBUCBAD    17200000
*                                 MOVE DVMOD, UCBADR,BB TO DEB.         17250000
         MVC   DEBSTRCC-DAREA(EIGHT,RTOB),TWO(RFRB)                     17300000
*                                 MOVE CCHH TO DEB.                     17350000
* IF THE CVOL RESIDES ON VIRTUAL DASD, THIS ROUTINE FILLS IN   @Y30LSRA 17351003
* EXTENT INFORMATION INTO THE PARAMETER LIST TO ACQUIRE SPACE. @Y30LSRA 17352003
*                                                              @Y30LSRA 17353003
         L     RBR,DEBDEBAD+D8    GET POINTER TO ENTRIES       @Y30LSRA 17354003
         LTR   RBR,RBR            IS THERE ONE                 @Y30LSRA 17355003
         BZ    RNVIRT2            NO, NOTHING TO DO HERE       @Y30LSRA 17356003
         MVC   D0(L2,RBR),TWO(RFRB) MOVE IN LOW CC OF EXTENT   @Y30LSRA 17357003
         MVC   D2(L2,RBR),SIX(RFRB) MOVE IN HIGH CC OF EXTENT  @Y30LSRA 17358003
         LA    RBR,D4(RBR)        INCR POINTER TO EXT ENTRIES  @Y30LSRA 17359003
         ST    RBR,DEBDEBAD+D8    STORE IT BACK                @Y30LSRA 17360003
RNVIRT2  EQU   *                                               @Y30LSRA 17361003
         CLI   0(RFRB),X81        CHECK EXTENT TYPE.                    17400000
         BE    CALCNT             BRANCH ON CYLINDER BOUNDARY.          17450000
         MVI   DEBUCBAD-DAREA(RTOB),X18  FILE MASK TO INHIBIT HD SW.    17500000
*                                                                       17550000
*      CALCULATE NUMBER OF TRACKS IN EXTENT                             17600000
*                                                                       17650000
CALCNT   EQU   *                                                        17700000
RCVTA    EQU   8                  SECOND CVT BASE REGISTER.             17750000
RTTCT    EQU   10                 COUNT OF TT REGISTER.                 17800000
RTTCTA   EQU   0                  COUNT OF TT REG A.                    17850000
         L     RCVTA,CVTPTR                                             17900000
         USING CVT,RCVTA                                                17950000
         L     RBR,CVTPRLTV       CONVERT ROUTINE ADDRESS.              18000000
         LA    RDEBP,DEB          REGISTER 1 = DEB ADDRESS.             18050000
         LA    RRES,COUNT         RRES = ADDRESS OF RESULTS.            18100000
         STM   R11,R15,REGS2      SAVE REGS.                            18150000
         LR    RGAREA2,RGAREA     SAVE AREA ADDR.                       18200000
         DROP  RGAREA                                                   18250000
         USING AREADCB,RGAREA2                                 @YL026UD 18300000
         XC    COUNT+1(7),COUNT+1 CLEAR MBBCCHH0 FIELD FOR CNV @OZ17531 18310008
         MVC   COUNT+3(L'DEBSTRCC+L'DEBSTRHH),DEBSTRCC-DAREA(RTOB)      18350000
*                                 MOVE START CCHH TO DEB.               18400000
         BALR  RGRET,RBR          CONVERT TO START TT.                  18450000
         ST    RTTCTA,REGSAVE     SAVE START TT.                        18500000
         CL    RTTCTA,X10000      ARE WE ON TRACK 0            @Z40CSRC 18502008
         BL    ISFIRST            YES, LEAVE TTRN 0            @Z40CSRC 18504008
         ST    RTTCTA,EXTDTT      SAVE TTRN OF START OF LAST   @Z40CSRC 18510008
*                                 EXTENT                       @Z40CSRC 18520008
ISFIRST  EQU   *                  BEYOND TTR STORING           @Z40CSRC 18530008
         L     RBR,REGS6          RESTORE ROUTINE ADDR.                 18550000
         MVC   COUNT+3(L'DEBENDCC+L'DEBENDHH),DEBENDCC-DAREA(RTOB)      18600000
*                                 MOVE END CCHH TO DEB.                 18650000
         BALR  RGRET,RBR          CONVERT TO END TT.                    18700000
         LM    R10,R15,REGSAVE    LOAD START TT AND RESTORE REGS.       18750000
         SR    RTTCT,RTTCTA       START TT - END TT = -(NT-1)           18800000
         SRL   RTTCT,16           GET -(NT-1) AS HALF WORD.             18850000
         BCTR  RTTCT,RTTCTA       -(NT-1)-1=-NT                         18900000
         LCR   RTTCT,RTTCT        NT= NUMBER OF TKS IN EXTENT.          18950000
         STH   RTTCT,DEBNMTRK-DAREA(RTOB)      PUT IN EXTENT.           19000000
         SR    R10,R10            CLEAR WORK REG               @OZ17531 19010008
         IC    R10,COUNT          GET M BYTE                   @OZ17531 19020008
         LA    R10,ONE(R10)       BUMP IT FOR NEXT EXTENT      @OZ17531 19030008
         STC   R10,COUNT          STORE IT BACK                @OZ17531 19040008
         DROP  RCVTA                                                    19050000
         USING AREADCB,RGAREA                                  @YL026UD 19100000
         BCT   REXT,BLDXTLP       BRANCH IF ANOTHER EXTENT.             19150000
*                                                              @Y30LSRA 19151003
*  FOR VIRTUAL DASD BELONGING TO THE MSS  SUBSYSTEM, THIS      @Y30LSRA 19152003
* ROUTINE ACQUIRES SPACE FOR THE CVOL.                         @Y30LSRA 19153003
*                                                              @Y30LSRA 19154003
         L     RDEBP,DEBDEBAD+D4  WAS PARM LIST BUILT          @Y30LSRA 19155003
         LTR   RDEBP,RDEBP        IF SO PROCESS IT             @Y30LSRA 19156003
         BZ    RNVIRT6            IF NOT, CONTINUE AS NORMAL   @Y30LSRA 19157003
         XC    DEBDEBAD+D4(L8),DEBDEBAD+D4 ZERO TEMP SAVE AREA @Y30LSRA 19158003
         MVC   D7(L1,RDEBP),DEBNMEXT GET NUMBER OF EXTENTS     @Y30LSRA 19159003
         MVI   D3(RDEBP),L96      MOVE IN HEADER LENGTH        @Y30LSRA 19160003
         MVI   D4(RDEBP),ACQOP    INDICATE TYPE=ACQUIRE        @OZ25613 19160537
         ICBACREL TYPE=ACQ,MF=(E,(1))                          @Y30LSRA 19161003
         LTR   RBR,RBR            ANY ERRORS                   @Y30LSRA 19162003
         BZ    RNVIRT4            NO DARN IT.  IT GOES SO WELL.@Y30LSRA 19163003
RVIRT1   EQU   *                  PROBLEM DETERMINATION        @Y30LSRA 19163203
         USING  UCB,RUCB          ESTABLISH ADDRESSABILITY     @Y30LSRA 19163603
         STH   R0,D0(RDEBP)       SAVE RETURN CODE             @Y30LSRA 19164003
         L     R10,BLDLP          SAVE BLDL WORKAREA ADDRESS   @OZ26358 19164137
         MVC   MESSAGEA(MSSMLEN),MSSMSG SET UP MSG             @Y30LSRA 19164203
         L     R15,CVTPTR         GET CVT ADDR                 @Y30LSRA 19164403
         L     R15,D0(,R15)       GET ADDR OF TCB WORDS        @Y30LSRA 19164603
         L     R15,D4(,R15)       GET CURRENT TCB PTR          @Y30LSRA 19164803
         L     R15,D12(,R15)      GET TIOT PTR                 @Y30LSRA 19165003
         MVC   MESSAGEA+D12(L8),D0(R15) GET JOBNAME            @Y30LSRA 19165203
         MVC   MESSAGEA+D21(L6),D8(RDEBP) INSERT VOLSER        @Y30LSRA 19165403
RVIRT6   SR    R15,R15            ZERO REGISTER                @Y30LSRA 19165603
         LH    R15,D26(,RDEBP)    GET REASON CODE              @Y30LSRA 19165803
         LTR   R15,R15            TEST FOR NON ZERO            @Y30LSRA 19165903
         BNZ   RVIRT7             YES -USE IT IN NSG           @Y30LSRA 19166103
         L     RDEBP,D92(RDEBP)   GET NEXT LIST PTR            @Y30LSRA 19166203
         LTR   RDEBP,RDEBP        TEST FOR ZERO                @Y30LSRA 19166403
         BZ    RVIRT7             YES-- USE CODE IN LIST       @Y30LSRA 19166503
         LR    RDEBP,R0           SET NEWLIST PTR              @Y30LSRA 19166603
         B     RVIRT6             EXAMINE REASON CODE          @Y30LSRA 19166803
RVIRT7   EQU   *                                               @Y30LSRA 19167003
         STH   R15,D0(,RDEBP)     SAVE REASON CODE             @Y30LSRA 19167103
RVIRT8   EQU   *                                               @Y30LSRA 19167203
         SLL   R15,D4             SHIFT 4 BITS                 @Y30LSRA 19167403
         STH   R15,D0(RDEBP)      RESET REASON CODE            @Y30LSRA 19167503
         UNPK  MESSAGEA+D60(L3),D0(L2,RDEBP) UNPACK REASON CDE @Y30LSRA 19167603
         OI    MESSAGEA+D62,DECZERO INSURE VALID DIGIT         @Y30LSRA 19167803
         TR    MESSAGEA+D60(L3),ABTABLE MAKE PRINTABLE         @Y30LSRA 19168003
         LA    R1,MESSAGEA        GET ADDR OF LST IN R1        @Y30LSRA 19168103
         WTO   MF=(E,(1))         ISSUE WTO,WTP                @Y30LSRA 19168203
         ST    R10,BLDLP          RESTORE BLDL WORKAREA ADDR   @OZ26358 19168337
         B     ERROR4             EXIT                         @Y30LSRA 19168437
RNVIRT4  EQU   *                                               @Y30LSRA 19168703
         LA    R0,L96             GET SIZE OF AREA             @Y30LSRA 19168803
         FREEMAIN R,LV=L96,A=(1),SP=230 RELEASE                @Y30LSRA 19168903
RNVIRT6  EQU   *                                               @Y30LSRA 19169003
*                                                                       19200000
*      SETUP NUMBYTES FIELD IN OPEN WORKAREA FOR FUTURE FREEMAIN        19250008
*                                                                       19350008
RNMA     EQU   1                  WORK REGISTER                         19450008
RNMB     EQU   2                  NUMBER OF BYTES.                      19550008
RNMT     EQU   0                  NUMBER OF TRACKS                      19650008
         L     RNMB,SPBYTES       GET # OF BYTES IN WORKAREA   @OZ15077 19750008
         ST    RNMB,NUMBYTES      TO BE FREED LATER.                    19850008
RBT      EQU   2                  BLOCKS PER TRACK REGISTER.            19950000
         SR    RBT,RBT                                                  20000000
         IC    RBT,FMTSW          GET COUNT OF BLOCKS/TRACK.            20050000
         LH    RTTRP,EXTDTT       LOAD FORMATTING START TT.             20100000
         SLL   RTTRP,16           SET THE TTRN.                         20150000
         EJECT                                                          20400000
*                                                                       20450000
* THIS CODE HANDLES THE INTERFACE WITH THE FORMAT ROUTINE.              20500000
*                                                                       20550000
RFSW     EQU   2                  FORMAT SWITCH REGISTER.               20600000
RRP      EQU   1                  RETURN REGISTER POINTER.              20650000
         LTR   RFSW,RFSW          TEST FORMAT SW.                       20700000
         BC    7,FORMAT           BRANCH TO FORMAT.                     20750000
         L     RRP,DEBDCBAD       LOAD THE DCB ADDRESS.                 20800000
*                                                                       20850000
RRC      EQU   15                 RETURN CODE REGISTER.                 20900000
         SR    RRC,RRC            SET ZERO RETURN CODE.                 20950000
*                                                                       21000000
         L     R2,BLDLP           OBTAIN 'BLDLAREA' ADDRESS             21050000
         LM    R3,R14,0(R2)       RESTORE REGISTERS                     21100000
         BR    R14                RETURN TO CALLER                      21150000
*                                                                       21200000
*      SET UP FORMAT ROUTINE WORKAREA                          @YL026UD 21250000
*                                                                       21300000
FORMAT   EQU   *                                                        21350000
RTTRP    EQU   6                  TTRN PARM REGISTER.                   21400000
         LA    R0,FMWAL           SET SP=0, LEN=512.                    21450000
         LR    R3,R0              SAVE BYTE COUNT FOR CLF2.             21500000
         GETMAIN R,LV=(0)                                               21550000
         L     R7,BLDLP             OBTAIN BLDLAREA ADDRESS    @ZA06686 21600037
         USING BLDLAREA,R7                                     @ZA06686 21610037
         ST    R1,SVFMTWAP          SAVE WKA PTR FOR ESTAE     @ZA06686 21620037
         DROP  R7                                              @ZA06686 21630037
         LR    R7,R1              SAVE WORK AREA ADDR.         @YL026UD 21650000
         L     R1,DEBDCBAD        LOAD THE DCB ADDRESS.                 21700000
         SR    RFKEY,RFKEY        SET CATALOG CALL INDICATOR.           21750000
*                                                                       21800000
         B     IGG0CLF2           GO TO FORMAT MODULE          @YL026UD 21850000
         EJECT                                                          21900000
*                                                                       21950000
* THE FOLLOWING CODE HANDLES THE EXTENDING OF CATALOGS.                 22000000
*                                                                       22050000
* INITIAL ENTRY FOR THE EXTEND FUNCTION IS AT THE LABEL 'EXTEND'.       22100000
* CHECK FIRST TO SEE IF THE REQUEST IS FOR A NEW EXTENT OR STEP TO      22150000
* THE NEXT EXTENT.                                                      22200000
*                                                                       22250000
EXTEND   EQU   *                                                        22300000
         DROP  RGAREA                                                   22350000
*                                                              @YL026UD 22400000
         LR    R15,R0             OBTAIN DCB ADDRESS           @YL026UD 22450000
         USING AREADCB,R15        SET DCB/DEB ADDRESSIBILITY   @YL026UD 22500000
         L     R15,BLDLP          OBTAIN 'BLDLAREA' ADDRESS    @YL026UD 22550000
         DROP  R15                                             @YL026UD 22600000
         STM   R3,R14,0(R15)      SAVE REGISTERS               @YL026UD 22650000
         ST    R2,4(R15)          SAVE CALLER'S BASE REG       @YL026UD 22700000
*                                                              @YL026UD 22750000
         L     RCVT,CVTPTR        PICK UP THE CVT POINTER      @YL026UD 22800000
         LR    RGAREA3,RFKEY      OBTAIN THE INPUT DCB ADDR    @YL026UD 22850000
         USING AREADCB,RGAREA3                                          22900000
         L     RCWA,CATWKAP        GET CAT WORK AREA POINTER.           22950000
         USING WORKAREA,RCWA                                            23000000
         MVC   OPTNCCW,TIC2        SET TIC TO BYPASS WRITE VERIFY.      23050000
         LH    RTTCT,VCLSTBLK      LOAD THE TT OF EXTENT.               23100000
         LA    RTTCT,ONE(RTTCT)    STEP TO NEXT RELATIVE TRACK.         23150000
         SR    RIOBS,RIOBS         CLEAR AN ARITHMETIC REG.             23200000
         IC    RIOBS,IOBSKADD      PICK UP 'M' FROM THE IOB.            23250000
         LA    RIOBS,ONE(RIOBS)    STEP M TO M+1.                       23300000
         STC   RIOBS,IOBSKADD      STORE IT BACK IN THE IOB.            23350000
         CLC   DEBNMEXT,IOBSKADD   COMPARE 'M' TO NO. OF EXTENTS.       23400000
         BE    EXTENDC             BRANCH FOR NEW EXTENT.               23450000
*                                                                       23500000
* THE REQUEST IS FOR A STEP TO THE NEXT EXISTING EXTENT.                23550000
* SATISFY THAT REQUEST HERE.                                            23600000
*                                                                       23650000
RIOBS    EQU   15                 REGISTERS USED TO SET CAT IOB.        23700000
         SLL   RIOBS,FOUR         SHIFT M TO USE AS AN INDEX.           23750000
         LA    RIOBS,DEBSTRCC(RIOBS) POINT R3 TO CCHH OF                23800000
*                                        NEXT EXTENT.                   23850000
         MVC   IOBSKADD+3(FOUR),0(RIOBS)   MOVE THE CCHH TO THE IOB     23900000
         MVI   IOBSKADD+7,X00     SET R TO ZERO.                        23950000
         MVI   THETA,X00          SET RPS THETA TO ZERO.                24000000
         SR    RRC,RRC            ZERO THE RETURN CODE.                 24050000
*                                                                       24100000
         L     R2,BLDLP           OBTAIN 'BLDLAREA' ADDRESS    @YL026UD 24150000
         LM    R3,R14,0(R2)       RESTORE REGISTERS            @YL026UD 24200000
         BR    R14                RETURN TO CALLER             @YL026UD 24250000
         DROP  RCWA                                                     24300000
         EJECT                                                          24350000
*                                                                       24400000
* PREPARE TO GET A NEW EXTENT FOR THE USER.                             24450000
*                                                                       24500000
EXTENDC  EQU   *                                                        24550000
         L     RUCB,DEBUCBAD      GET THE UCB ADDRESS.                  24600000
         L     RNMT,XTBYTES       GET SUB-POOL AND LENGTH.              24650000
         MODESET EXTKEY=DATAMGT   GET INTO DATA MGT KEY        @Z40CSRC 24660008
         BAL   RGRET,GETMAINB     BRANCH TO GET MAIN ROUTINE.           24700000
         MODESET EXTKEY=ZERO      GET BACK TO KEY ZERO         @Z40CSRC 24710008
*                                                                       24750000
         L     R6,BLDLP           GET BLDL WORKAREA PTR        @YL026UD 24800000
         USING BLDLAREA,R6        ESTABLISH ADDRESSIBILITY     @YL026UD 24850000
         ST    R1,SVEXTWAP        SAVE WKA PTR (ESTAE)         @YL026UD 24900000
         DROP  R6                                              @YL026UD 24950000
         L     RCWA,CATWKAP       ADDR OF CATLG WORK AREA      @Z40CSRC 24960008
         DROP  RGAREA3                                           YM5169 25000000
         USING AREADCB,RGAREA                                    YM5169 25050000
         ST    RCWA,CATWKAP       SAVE ADDR OF CATLG WORK AREA @Z40CSRC 25060008
         MVI   EXTDSW,X01         INDICATE 1ST PASS OF EXTEND.          25100000
         STM   R9,R10,EXTDRGSV    SAVE THE INPUT PARAMETERS.            25150000
         B     BLDEB              GO TO GET DSCB FOR EXTEND.            25200000
         EJECT                                                          25250000
*                                                                       25300000
* THE FOLLOWING CODE COMPLETES THE BLOCKS FOR THE CALL TO EXTEND        25350000
* AND THEN DOES THE XCTL TO THE EXTEND ROUTINE.                         25400000
*                                                                       25450000
EXTENDA  EQU   *                                                        25500000
         LM    R9,R10,EXTDRGSV    RESTORE REGS 9 & 10.                  25550000
         OC    DS1SCALO+1(L'DS1SCALO-1),DS1SCALO+1  SEC ALLOC ZERO      25600000
         BC    8,EXTENDAA         BRANCH IF NO SEC ALLOCATION.          25650000
         MVC   NUMBYTES,DS1SCALO  SAVE SEC ALLOCATION REQUEST.          25700000
*                                                                       25750000
*      CONSTRUCT DUMMY JFCB                                             25800000
*                                                                       25850000
         MVC   JFCBDSNM,DSCBK     D.S. NAME OF SYSCTLG.                 25900000
         XC    JFCBELNM(B184),JFCBELNM   ZERO JFCB, ECB AND IOB.        25950000
         MVC   JFCBCTRI(L'NUMBYTES),NUMBYTES  SEC ALLOC REQUEST.        26000000
         MVI   JFCBDRLH,ONE       AVE REC LENGTH = 1.                   26050000
         STM   R9,R10,JFCBELNM    SAVE SOME REGISTERS.                  26100000
*                                                                       26150000
*      CONSTRUCT THE IOB                                                26200000
*                                                                       26250000
RIOBR    EQU   0                  REGISTERS USED TO SET THE IOB.        26300000
RIOBT    EQU   12                 REGISTERS USED TO SET IOB    @YL026UD 26350000
         LM    RIOBR,RCVT,JFCBTSDM    LOAD ZEROS.                       26400000
         LA    RIOBR,DXECB        ECB ADDRESS.                          26450000
         LA    RCVT,DXCCW         CHANNEL PROGRAM START ADDRESS.        26500000
         STM   RIOBR,RCVT,IOBECBPT    STORE THEM IN THE IOB.   @YL026UD 26550000
         LA    RIOBT,DXDCB        DCB ADDRESS.                          26600000
         ST    RIOBT,IOBECBPT+16  STORE DCB ADDRESS IN IOB.    @YL026UD 26650000
*                                                                       26700000
*      CONSTRUCT THE DEB                                                26750000
*                                                                       26800000
         MVC   DXDEB(DEBL),DEB    GET FROM ALL READY CONSTRUCTED DEB.   26850000
         MVC   DXDEBDCB+1(L'DXDEBDCB-1),IOBDCBPT  NEW DCB POINTER.      26900000
*                                                                       26950000
*      CONSTRUCT THE DCB                                                27000000
*                                                                       27050000
RXDEB    EQU   0                  DEB ADDRESS MANIPULATING REG.         27100000
         LA    RXDEB,DXDEB                                              27150000
         ST    RXDEB,DXDCBDEB     STORE THE DEB POINTER.                27200000
*                                                                       27250000
*      SET UP FOR EXTEND XCTL                                           27300000
*                                                                       27350000
RXP1     EQU   2                  XCTL PARM REG 1.                      27400000
RXP3     EQU   5                  XCTL PARM REG 3.                      27450000
RXP4     EQU   10                 XCTL PARM REG 4.                      27500000
         LR    RXP1,RGAREA3       SET THE DCB ADDRESS.                  27550000
         LR    R7,RGAREA          SET THE WORK AREA ADDRESS.   @YL026UD 27600000
         DROP  RGAREA                                                   27650000
         USING AREADCB,RGAREA3                                          27700000
         LA    RXP3,DEB           SET THE DEB ADDRESS.                  27750000
         L     RXP4,DEBUCBAD      SET THE UCB ADDRESS.                  27800000
         DROP  RGAREA3                                                  27850000
         LA    RGAREA,TWO         INDICATE SYSCTLG EXTEND.              27900000
         LA    RBR,XCTLCONX       EXTEND MODULE NAME ADDRESS.           27950000
         XC    FOUR(FOUR,R7),FOUR(R7)  ZERO XCTL DCB ADDRESS   @YL026UD 28000000
         MVC   EIGHT(EIGHT,R7),0(RBR)  MODULE NAME             @YL026UD 28050000
         LA    RBR,EIGHT(R7)      SET XCTL PTR TO MOD NAME     @YL026UD 28100000
         ST    RBR,0(R7)          STORE XCTL POINTER           @YL026UD 28150000
         LA    R4,EXTDAREA-AREADCB(,R7) ADDR OF EXTEND WK AREA @Z40CSRC 28160008
         SR    R8,R8              WILL SHOW RETURNING FROM     @Z40CSRC 28170008
*                                 EXTEND UPON RETURN FROM DADSM         28180008
         USING AREADCB,R7         WORK AREA ADDRESSABLE        @Z40CSRC 28182008
         L     R6,PSATOLD-PSA     GET ADDR OF TCB              @Z40CSRC 28185008
         L     R6,TCBRBP-TCB(,R6) GET ADDR OF SVRB             @Z40CSRC 28190008
         MVC   DSVSVRB,RBEXSAVE-RBBASIC(R6) SAVE RBEXSAVE      @Z40CSRC 28195008
         MODESET EXTKEY=DATAMGT   GO TO DADSM IN KEY 5         @Z40CSRC 28196008
         XCTL  MF=(E,(1)),SF=(E,(R7))                          @YL026UD 28200000
         DROP  R7                 ADDRESSABILITY ENDS          @Z40CSRC 28220008
         EJECT                                                 @YL026UD 28250000
*                                                                       28300000
* THIS CODE HANDLES THE CASE WHERE EXTEND WAS REQUESTED BUT NO          28350000
* SECONDARY SPACE HAS BEEN ALLOCATED.                                   28400000
*                                                                       28450000
* FREE THE EXTEND WORK AREA                                             28500000
*                                                                       28550000
EXTENDAA EQU   *                                                        28600000
         L     RNMT,XTBYTES       EXTEND WORK AREA LENGTH.              28650000
         LA    RNMA,0(RGAREA)     LOAD WORK AREA ADDRESS.               28700000
         USING AREADCB,RGAREA3    SET DCB/DEB ADDRESSIBILITY   @YL026UD 28750000
         L     R2,BLDLP           OBTAIN 'BLDLAREA' ADDRESS    @YL026UD 28800000
         USING BLDLAREA,R2        ESTABLISH ADDRESSIBILITY     @YL026UD 28850000
         XC    SVEXTWAP(4),SVEXTWAP    RESET WKA PTR (ESTAE)   @YL026UD 28900000
         MODESET EXTKEY=DATAMGT   GET INTO KEY 5               @Z40CSRC 28920008
         SVC   FREEMAIN           FREE THE EXTEND WORK AREA CORE.       28950000
         MODESET EXTKEY=ZERO      GET BACK TO KEY 0            @Z40CSRC 28970008
*                                                                       29000000
ERROR8   EQU   *                  TO EXIT WITH RETURN CODE 8   @Z40CSRC 29010008
         LR    RRP,RGAREA3        SET DCB AREA ADDRESS FOR RETURN.      29050000
         LA    RRC,EIGHT          SET NO EXTENT RETURN CODE.            29100000
*                                                                       29150000
         DROP  RGAREA3                                                  29200000
         DROP  R2                                              @YL026UD 29250000
         LM    R3,R14,0(R2)       RESTORE REGISTERS                     29300000
         BR    R14                RETURN TO CALLER                      29350000
         EJECT                                                          29400000
*                                                                       29450000
* THIS CODE HANDLES THE ENTRY FROM THE EXTEND MODULES AFTER THEY        29500000
* HAVE COMPLETED THEIR WORK.                                            29550000
*                                                                       29700000
* FREE EXTEND WORK AREA CORE                                            29750000
*                                                                       29800000
EXTENDB  EQU   *                                                        29850000
         MODESET EXTKEY=ZERO      GET INTO KEY ZERO            @Z40CSRC 29860008
         MVC   RBEXSAVE-RBBASIC(L'SVRBEXT,R6),DSVSVRB-AREADCB(R7)      -29870008
                                  REFRESH SVRB E.S.A           @Z40CSRC 29880008
         L     RCVT,CVTPTR        PICK UP THE CVT POINTER      @YL026UD 29900000
         LR    RUCB,R10           RESTORE UCB ADDRESS          @Z40CSRC 29950008
         L     RNMT,XTBYTES       EXTEND WORK AREA LENGTH.              30000000
         LA    RNMA,0(,R7)        EXTEND WORK AREA ADDRESS.    @Z40CSRC 30050008
         USING AREADCB,RGAREA3    SET DCB/DEB ADDRESSIBILITY   @YL026UD 30100000
         L     R2,BLDLP           GET BLDL WORKAREA ADDRESS    @YL026UD 30150000
         USING BLDLAREA,R2        ESTABLISH ADDRESSIBILITY     @YL026UD 30200000
         XC    SVEXTWAP(4),SVEXTWAP    RESET WKA PTR (ESTAE)   @YL026UD 30250000
         MODESET EXTKEY=DATAMGT   GET INTO KEY 5 FOR FREEMAIN  @Z40CSRC 30260008
         SVC   FREEMAIN           FREE THE EXTEND CORE.                 30300000
         MODESET EXTKEY=ZERO      GET BACK INTO KEY 0          @Z40CSRC 30305008
*                                                              @Z40CSRC 30310008
*      CHECK FOR ERRORS FROM DADSM                             @Z40CSRC 30320008
*                                                              @Z40CSRC 30330008
         LCR   R13,R13            TEST FOR DADSM ERR (R13 NEG) @Z40CSRC 30340008
         BNP   NOEXTERR           BRANCH IF NO ERROR           @Z40CSRC 30342008
         LA    R15,ERROR16        LOAD COMPARISON VALUE        @Z40CSRC 30344008
         CR    R15,R13            TEST FOR I/O ERR (R13=-16)   @Z40CSRC 30345008
         BNE   ERROR8             BRANCH IF NO I/O ERROR       @Z40CSRC 30346008
         LR    RGAREA,RGAREA3     GET ADDR OF DCB AREA         @Z40CSRC 30348008
         B     IOERR              GO TO I/O ERROR ROUTINE      @Z40CSRC 30348408
NOEXTERR EQU   *                  NO EXTEND ERROR              @Z40CSRC 30348808
*                                                                       30350000
*      FREE OLD SYSCTLG DEB/DCB                                         30400000
*                                                                       30450000
         USING AREADCB,RGAREA3                                          30500000
         L     RCWA,CATWKAP       SAVE CAT WORK AREA POINTER.           30550000
         L     RNMT,NUMBYTES      GET NUMBER OF BYTES.                  30600000
         LA    RNMA,X00(,RGAREA3) ADDRESS OF AREA TO FREE      @Z40CSRC 30650008
         XC    SVOPNWAP(4),SVOPNWAP    RESET WKA PTR (ESTAE)   @YL026UD 30700000
         SVC   FREEMAIN           FREE THE OLD DCB AREA.                30750000
         DROP  RGAREA3                                                  30800000
*                                                                       30850000
*      GET NEW SYSCTLG DEB/DCB CORE                                     30900000
*                                                                       30950000
         BAL   RGRET,GETMAIN      BRANCH TO GET MAIN ROUTINE.           31000000
         ST    R1,SVOPNWAP        SAVE WKA PTR (ESTAE)         @YL026UD 31050000
         USING AREADCB,RGAREA                                  @YL026UD 31100000
         ST    RCWA,CATWKAP       STORE THE CAT WORK AREA PTR.          31150000
         ST    R2,BLDLP           STORE THE BLDL WORK AREA PTR @YL026UD 31200000
         MVI   EXTDSW,TWO         INDICATE SECOND PASS.                 31300000
         B     BLDEB              GO TO BUILD NEW DEB.                  31350000
         DROP  R2                                              @YL026UD 31400000
         EJECT                                                          31450000
*                                                                       31500000
* THE FOLLOWING ARE SUB-ROUTINES USED BY THE OPEN MODULE.               31550000
*                                                                       31600000
GETMAIN  EQU   *                                                        31650000
         L     RNMT,SPBYTES       NO OF BYTES FOR SYSCTLG DEB/DCB.      31700000
GETMAINB EQU   *                                                        31750000
         GETMAIN R,LV=(0)                                               31800000
         LR    RGAREA,RPARM       SET GOTTEN AREA ADDRESS IN BASE.      31850000
         BR    RGRET              RETURN TO THE CALLER.                 31900000
         SPACE                                                          31950000
*                                                                       32000000
* EXCP, WAIT AND IO ERROR CHECKING ROUTINE.                             32050000
*                                                                       32100000
IO3      EQU   *                                                        32150000
         EXCP  AIOB                                                     32200000
         WAIT  1,ECB=AECB                                               32250000
         CLI   AECB,X7F           TEST ECB CONDITION.                   32300000
         BCR   8,RGRET            BRANCH NO ERROR.                      32350000
RRCA     EQU   7                  TEMP RETURN CODE REGISTER.   @YL026UD 32400000
*                                                              @Z40CSRC 32410008
IOERR    EQU   *                  I/O ERROR EXIT ROUTINE       @Z40CSRC 32420008
         LA    RRCA,TWELVE        SET IO ERROR CONDITION CODE.          32450000
         SPACE                                                          32500000
*                                                                       32550000
* RETURN TO THE CALLER IF AN ERROR HAS OCCURRED.                        32600000
*                                                                       32650000
RETURN   EQU   *                                                        32700000
         L     RCWA,CATWKAP       SAVE THE CATALOG WORK AREA ADDR.      32750000
         L     RNMT,SPBYTES       LOAD WORK AREA LENGTH.                32800000
         LA    RNMA,0(RGAREA)     GET DCB AREA ADDRESS.                 32850000
         L     R2,BLDLP           GET BLDL WORKAREA ADDRESS    @YL026UD 32900000
         USING BLDLAREA,R2        ESTABLISH ADDRESSIBILITY     @YL026UD 32950000
         XC    SVOPNWAP(4),SVOPNWAP     RESET WKA PTR (ESTAE)  @YL026UD 33000000
         SVC   FREEMAIN           FREE DCB AREA CORE.                   33050000
*                                                                       33100000
* THIS CODE IS TO SET DCB/DEB AREA CORE RELEASED FLAG.                  33150000
*                                                                       33200000
         SPACE                                                          33250000
         USING WORKAREA,RCWA                                            33300000
         OI    FLAG1,FREEDCB      TURN ON CORE FREED FLAG.              33350000
         DROP  RCWA                                                     33400000
*                                                                       33450000
         LR    RRC,RRCA           SET CONDITION CODE.                   33500000
         LM    R3,R14,0(R2)       RESTORE REGISTERS                     33550000
         BR    R14                RETURN TO CALLER                      33600000
         DROP  R2                                              @YL026UD 33650000
         SPACE                                                          33700000
ERROR4   EQU   *                                                        33750000
         LA    RRCA,FOUR          SET ERROR CODE IN R2.                 33800000
         B     RETURN             GO TO RETURN TO CALLER.               33850000
*                                                                       33900000
         TITLE 'IGG0CLCF - (IGG0CLF2) SYSCTLG FORMATTER'       @YL026UD 33950000
*********************************************************************** 34000000
*                                                                     * 34050000
*     IGG0CLF2 - SYSCTLG FORMATTER                                    * 34100000
*                                                              @Z40CSRC 34102008
*       INPUT =                                                @Z40CSRC 34104008
*       .  R0 CONTAINS ZERO                                    @YL026UD 34110008
*       .  R1 CONTAINS DCB OF DATA SET TO BE FORMATTED         @YL026UD 34120008
*       .  R2 CONTAINS NUMBER OF BLOCKS PER TRACK FOR DEVICE   @YL026UD 34130008
*          WHICH CONTAINS THE DATA SET                         @YL026UD 34140008
*       .  R3 CONTAINS COUNT OF BYTES IN WORKAREA PASSED TO    @YL026UD 34142008
*          THIS ROUTINE                                        @YL026UD 34144008
*       .  R5 CONTAINS DATA MANAGEMENT COUNT DECREMENT VALUE   @YL026UD 34146008
*       .  R6 CONTAINS STARTING RELATIVE (TTR) BEGIN ADDRESS   @YL026UD 34148008
*       .  R7 CONTAINS ADDRESS OF A WORKAREA                   @YL026UD 34148408
*                                                                     * 34150000
*********************************************************************** 34200000
*                                                                       34250000
IGG0CLF2 EQU   *                                               @YL026UD 34300000
*                                                                       34350000
IEINIT   EQU   *                                                        34400000
         LR    RGAREA,R7               AREA ADR FROM PREV PHASE         34450000
         USING WKAREA,RGAREA           SET WORK AREA ADDRESSABILITY.    34500000
         STM   R0,R6,FSVAREA           SAVE INPUT PARAS                 34550000
         ST    R7,SVADDR               SAVE WORKAREA ADDRESS   @YL026UD 34600000
         LR    RGTTR,R6                SAVE TTR0 START                  34650000
         LR    RGDQTY,R0               SAVE FUNCTION CODE               34700000
*                                                                       34750000
* BUILD AND RELOCATE ECB AND IOB                                        34800000
*                                                                       34850000
         SR    R0,R0                   ZERO ECB                         34900000
         LA    R2,FECB                 ECB PTR IN IOB                   34950000
         LA    R5,CHPGA                CHAN PROG PTR                    35000000
         L     R6,SVDCB                DCB PTR                          35050000
         SR    R8,R8                   ZERO BLOCK INCR FIELD            35100000
         STM   R0,R8,FECB              ECB AND IOB                      35150000
         MVI   FIOB,TWO                SET UNRELATED BIT                35200000
         LTR   RGDQTY,RGDQTY           CHECK FUNCTION                   35250000
         B     CTLGFMT                 BRANCH FOR CATALOG FORMAT        35300000
*                                                              @YL026UD 35350000
*      CODE TO FORMAT A BPAM DATA SET HAS BEEN REMOVED         @YL026UD 35400000
*      FROM THIS VS2 RELEASE 2 CODE                            @YL026UD 35450000
         EJECT                                                          35500000
*                                                                       35550000
* THIS SECTION OF CODE FORMATS FOR THE CATALOG DATA SET.                35600000
*                                                                       35650000
         SPACE                                                          35700000
CTLOOP1  L     RGA,SVBLPTK             NO. BLKS PER TRK                 35750000
CTLOOP2  BAL   RGRET,RELOC             SET UP CHAN PROG                 35800000
         BAL   RGRET,IO                WRITE COMPLETE OR PARTIAL TRK    35850000
         MVC   MBBCCHHR+7(ONE),HICOUNT+4 SET R INCASE TRK NOT COMPLETE  35900000
         LTR   RGA,RGA                 SEE IF TRK COMPLETE              35950000
         BP    CTLOOP2                 NO, WRITE REST OF TRK            36000000
         A     RGTTR,X10000            GO TO NEXT TRK                   36050000
CTLGFMT  BAL   RGRET,CNVT              CONVERT TTR                      36100000
         LTR   R15,R15                 TEST RETURN CODE                 36150000
         BZ    CTLOOP1                 BRANCH IF NOT AT END OF EXTENT   36200000
         S     RGTTR,X10000            GO BACK TO LAST TRACK            36250000
         ST    RGTTR,HICOUNT           LAST TTR IN CTLG                 36300000
         OC    SVTT(FOUR),SVTT         TEST TTR0 START                  36350000
         BC    7,EXTNDA                BR IF FORMATTED AN EXTENDED AREA 36400000
         LA    RGTTR,X100              SET TTR TO INDEX DIR             36450000
         BAL   RGRET,CNVT              GO TO CONVERT TTR.               36500000
         LA    RGA,ONE                 SET TO WR ONE BLK                36550000
         BAL   RGRET,RELOC             SET UP CHAN PRG                  36600000
*                                                                       36650000
* FILL IN DIRECTORY CONTROL BLOCK                                       36700000
*                                                                       36750000
         MVC   COUNT2(TEN),HIKEY       KEY AND BYTE COUNT               36800000
         XC    CTDIR(B22),CTDIR        ZERO DIR CTL BLK AREA            36850000
         MVI   CTLBK,ONE               LOWEST NAME G.T. ZERO            36900000
         LA    RGA,X105                TTRC                             36950000
         STH   RGA,CTTTRC              STORE TTRC.                      37000000
         MVC   CTHITT(TWO),HICOUNT     LAST TT IN CTLG                  37050000
         MVC   CTHIR(ONE),SVBLPTK+3    HIGH R ON LAST TRACK             37100000
         MVI   CTNABTR,TWO             TTR OF NXT AVAIL BLK             37150000
         MVC   CTHIENT(EIGHT),HIKEY    HIGH ENTRY                       37200000
*                                                                       37250000
* ALTER CHANNEL PROGRAM                                                 37300000
*                                                                       37350000
         MVI   CHPGA3,X0D              WRITE KD                         37400000
         MVI   CHPGA3+7,B40            COUNT                            37450000
         MVI   CHPGB3,X0E              READ KD                          37500000
         MVI   CHPGB3+7,EIGHT          CHANGE COUNT TO 264              37550000
*                                                                       37600000
* WRITE DIRECTORY CONTROL BLOCK                                         37650000
*                                                                       37700000
         BAL   RGRET,IO                GO EXECUTE EXCP AND WAIT.        37750000
*                                                                       37800000
* SET UP DEB AND CHANNEL PROGRAM TO READ SYSCTLG DSCB--                 37850000
*                                                                       37900000
         L     RGH,SVDCB               GET DCB ADDRESS                  37950000
         USING AREADCB,RGH                                              38000000
         MVC   D1SDSNAM(EIGHT),SYSCTLG  SET UP DSNAME FOR SEARCH KEY    38050000
         MVC   D1SDSNAM+8(B36),D1SDSNAM+7  PAD WITH BLANKS     @YL026UD 38100000
         MVC   EXTSAVE,DEBSTRCC        SAVE 1ST EXTENT OF DEB           38150000
         MVC   DEBSTRCC(FOUR),DSCBTRK  MODIFY DEB TO READ AND  @YL026UD 38200000
         MVC   DEBENDCC(FOUR),DSCBTRK  WRITE SYSCTLG DSCB      @YL026UD 38250000
         MVC   MBBCCHHR+3(FOUR),DSCBTRK   SET SEEK ADDRESS              38300000
         LM    R0,R3,READVTOC          RELOCATE CHANNEL PROG   @YL026UD 38350000
         AR    R0,RGAREA               MODIFY CCW ADDRESSES             38400000
         AR    R2,RGAREA               MODIFY CCW ADDRESSES.            38450000
         STM   R0,R3,CHPGA             STORE CHANNEL PROGRAM   @YL026UD 38500000
         LM    R0,R1,READVTOC+16       RELOCATE CHANNEL PROG   @YL026UD 38550000
         AR    R0,RGAREA               MODIFY CCW ADDRESSES.   @YL026UD 38600000
         STM   R0,R1,CHPGA3            STORE CHAN PROG         @YL026UD 38650000
         BAL   RGRET,IO                READ SYSCTLG DSCB                38700000
*                                                                       38750000
* TURN ON ALREADY FORMATTED INDICATOR AND REWRITE SYSCTLG DSCB--        38800000
*                                                                       38850000
         MVI   D1SLSTAR+2,XFF          SET 'FORMATTED' SW IN DSCB       38900000
         LM    R0,R3,WRVTOC            RELOCATE CHANNEL PROG   @YL026UD 38950000
         AR    R0,RGAREA               ADD BASE TO OFFSET               39000000
         AR    R2,RGAREA               ADD BASE TO OFFSET.              39050000
         STM   R0,R3,CHPGA3            STORE CCWS.             @YL026UD 39100000
         LM    R0,R3,WRVTOC+16         RELOCATE CHANNEL PROG   @YL026UD 39150000
         AR    R0,RGAREA               ADD BASE TO OFFSET.     @YL026UD 39200000
         STM   R0,R3,CHPGA5            STORE CCWS.             @YL026UD 39250000
         BAL   RGRET,IO                WRITE UPDATED DSCB               39300000
         MVC   DEBSTRCC(EIGHT),EXTSAVE  RESTORE 1ST EXTENT OF DEB       39350000
         EJECT                                                          39400000
OK       SR    R10,R10                 SET ZERO ERROR CODE       YM6411 39450000
*                                                                       39500000
* FREE RPS CORE AND UNLOAD IGG019EK.                                    39550000
*                                                                       39600000
RETURN2  EQU   *                                                        39650000
         L     RGH,SVDCB               GET DCB.                         39700000
         L     R1,DEBAD(RGH)           GET DEB PTR.                     39750000
         L     R3,DEBAPDS(R1)          GET APPENDAGE TABLE.    @YL026UD 39800000
         L     R12,FOUR(R3)            GET SIO APPENDAGE.      @YL026UD 39850000
         L     RGH,SVDCB          GET THE DCB ADDRESS          @YL026UD 39900000
         USING AREADCB,RGH        ESTABLISH ADDRESSIBILITY     @YL026UD 39950000
         L     R2,BLDLP           OBTAIN 'BLDLAREA' ADDRESS    @YL026UD 40000000
         USING BLDLAREA,R2        ESTABLISH ADDRESSIBILITY     @YL026UD 40050000
         CLC   RPSIDLOC(L'RPSID,R12),RPSID  IS THIS THE RPS APPENDAGE?  40100000
         BNE   CONTINUE                NO, NO RPSWA EXISTS              40150000
         MVC   DEBAPDS(FOUR,R1),AVTSV(R3)  RESTORE DEB AVT POINTER      40200000
         LA    R0,WASZ                 GET RPS WORK AREA SIZE           40250000
         XC    SVRPSWAP(4),SVRPSWAP     RESET WKA PTR (ESTAE)  @YL026UD 40300000
         FREEMAIN R,LV=(0),A=(3)       FREE RPS WORK AREA               40350000
         DELETE EP=IGG019EK                                             40400000
CONTINUE EQU   *                                                        40450000
*                                                                       40500000
* FREEMAIN AND EXIT                                                     40550000
*                                                                       40600000
         LM    R14,R1,SVDCB            DCB, NO. BYTES, AND AREA ADR     40650000
         XC    SVFMTWAP(4),SVFMTWAP     RESET WKA PTR (ESTAE)  @ZA06686 40700037
         FREEMAIN R,LV=(0),A=(1)                                        40750000
         LR    R15,R10                 SET ERROR CODE            YM6411 40800000
         LR    R0,RGTTR                HIGHEST TT                       40850000
         LR    R1,R14                  RETURN DCB ADR                   40900000
*                                                                       40950000
         DROP  R2                                              @YL026UD 41000000
         DROP  RGH                                                      41050000
         LM    R3,R14,0(R2)       RESTORE REGISTERS            @YL026UD 41100000
         BR    R14                RETURN TO CALLER             @YL026UD 41150000
         EJECT                                                          41200000
*                                                                       41250000
* SET UP EXTENT FOR THE CATALOG ROUTINES IF FORMATTING NEW EXTENT.      41300000
*                                                                       41350000
         SPACE                                                          41400000
EXTNDA   EQU   *                                                        41450000
RCWAA    EQU   8                       CAT WORK AREA BASE.              41500000
         L     RGH,SVDCB               GET THE DCB ADDRESS.             41550000
         USING AREADCB,RGH                                              41600000
         L     RCWAA,CATWKAP           LOAD CATALOG WORK AREA ADDRESS.  41650000
         USING WORKAREA,RCWAA                                           41700000
         MVC   VCLSTBLK(TWO),HICOUNT   SET LAST BLOCK TT IN VICE.       41750000
         ST    RGH,IOBDCB              STORE THE DCB PTR IN THE IOB.    41800000
         LA    RGA,DEB                 GET THE DEB ADDRESS.             41850000
         ST    RGA,DEBADDR             STORE IN CATALOG WORK AREA.      41900000
         MVI   THETA,X00               ZERO THE THETA VALUE FOR RPS.    41950000
         SR    RGA,RGA                                                  42000000
         IC    RGA,IOBSKADD            GET M FROM THE IOB.              42050000
         SLL   RGA,FOUR                SHIFT M TO USE AS EXT INDEX.     42100000
         LA    RGA,DEBSTRCC(RGA)       PT. RGA TO CCHH OF NEW EXTENT.   42150000
         MVC   IOBSKADD+3(FOUR),0(RGA)  MOVE CCHH TO THE IOB.           42200000
         MVI   IOBSKADD+7,X00          SET R TO ZERO.                   42250000
*                                                               SA50973 42300000
*      AT THIS POINT THE NEW EXTENT HAS BEEN OBTAINED AND       SA50973 42350000
*      FORMATTED WITH ALL THE NECESSARY INFORMATION BEING       SA50973 42400000
*      UPDATED IN THE CATALOG MANAGEMENT WORKAREA.  THE DATA    SA50973 42450000
*      SET, HOWEVER, HAS NOT BEEN UPDATED TO REFLECT THE NEW    SA50973 42500000
*      EXTENT.                                                  SA50973 42550000
*                                                               SA50973 42600000
*      TO INSURE THAT THE 'VICE' REMAINS CURRENT,               SA50973 42650000
*      1.  READ THE FIRST BLOCK OF THE SYSCTLG                  SA50973 42700000
*      2.  UPDATE 'VCLSTBLK' IN THE 'VICE'                      SA50973 42750000
*      3.  REWRITE THE BLOCK WITH THE UPDATED 'VICE'            SA50973 42800000
*                                                               SA50973 42850000
         LA    RGTTR,X100              TTR OF FIRST BLOCK       SA50973 42900000
         BAL   RGRET,CNVT              CONVERT TO MBBCCHHR      SA50973 42950000
*                                                               SA50973 43000000
*      SET UP THE CHANNEL PROGRAM AREA                          SA50973 43050000
*                                                               SA50973 43100000
         LM    RGE,RGF,CCWSID          GET SID CCW             @YL026UD 43150000
         AR    RGE,RGAREA              RELOCATE SID            @YL026UD 43200000
         STM   RGE,RGF,CHPGA           SID                     @YL026UD 43250000
         LM    RGE,RGF,CCWSID+8        GET TIC CCW             @YL026UD 43300000
         LA    RGG,CHPGA               DEVELOP TIC ADDR        @YL026UD 43350000
         AR    RGE,RGG                 RELOCATE TIC             SA50973 43400000
         STM   RGE,RGF,CHPGA2          TIC                     @YL026UD 43450000
*                                                               SA50973 43500000
         LM    RGE,RGF,CCWRD           GET RD CCW              @YL026UD 43550000
         AR    RGE,RGAREA              RELOCATE RD             @YL026UD 43600000
         STM   RGE,RGF,CHPGA3          RD                      @YL026UD 43650000
*                                                               SA50973 43700000
         STM   RGE,RGF,CHPGA4          RD                       SA50973 43750000
*                                                               SA50973 43800000
         BAL   RGRET,IO                ***READ VICE BLOCK***    SA50973 43850000
*                                                               SA50973 43900000
         MVC   UPLSTBLK(L'UPLSTBLK),HICOUNT UPDATE 'VCLSTBLK'   SA50973 43950000
*                                                               SA50973 44000000
         MVI   CHPGA3,CCWWDOP          CHANGE TO WD             SA50973 44050000
         MVI   CHPGA3+4,CCWOPTN2       COMMAND CHAIN            SA50973 44100000
         MVI   CHPGA4+4,CCWOPTN1       NO TRANSFER              SA50973 44150000
         BAL   RGRET,IO                ***WRITE VICE BLOCK***   SA50973 44200000
*                                                               SA50973 44250000
         B     OK                      GO TO SET RETURN         SA50973 44300000
         EJECT                                                  SA50973 44350000
*                                                                       44400000
* CONVERT TTR IN RGTTR TO MBBCCHHR                                      44450000
*                                                                       44500000
CNVT     LR    R0,RGTTR                                                 44550000
         L     R1,SVDCB                DCB ADR                          44600000
         L     R1,DEBAD(R1)            DEB ADR                          44650000
         LA    R2,MBBCCHHR                                              44700000
         LR    R3,RGAREA               SAVE AREA ADR                    44750000
         STM   R9,R14,COUNT2           SAVE VOLATILE REGS               44800000
         USING CVT,R15                                                  44850000
         L     R15,CVTPTR              GET ADR OF CVT                   44900000
         L     R15,CVTPCNVT            GET ADR OF CONVERT ROUTINE       44950000
         DROP  R15                                                      45000000
         BALR  R14,R15                 GO TO CONVERT ROUTINE.           45050000
         LM    R9,R14,COUNT2-WKAREA(R3)  RESTORE REGS                   45100000
         BR    RGRET                   RETURN TO CALLING CODE.          45150000
         EJECT                                                          45200000
*                                                                       45250000
* BUILD CHANNEL PROGRAM OF 1 THRU 15 WRITE CCW'S FOLLOWED BY AN EQUAL   45300000
*        NUMBER OF WRITE CHECK CCW'S.                                   45350000
* ENTER NUMBER OF CCW'S TO BE WRITTEN ON GIVEN TRACK IN RGA.            45400000
* MBBCCHHR INDICATES PROPER TRACK AND ONE LESS THAN R OF FIRST RECORD   45450000
* UPON RETURN, RGA CONTAINS EXCESS OF ORIGINAL VALUE OVER 15, AND       45500000
*        RGG POINTS TO LAST WRITE CCW                                   45550000
*                                                                       45600000
RELOC    LR    RGB,RGA                 NUMBER OF CCW'S                  45650000
         LA    RGE,B15                 MAXIMUM NO.  OF CCW'S   @YL026UD 45700000
         SR    RGA,RGE                                         @YL026UD 45750000
         BC    12,LTMAX                BRANCH IF LESS THAN MAX VALUE    45800000
         LA    RGB,B15                 SET TO MAX                       45850000
LTMAX    LM    RGE,RGF,CCWSID          RELOCATE SID CCW        @YL026UD 45900000
         AR    RGE,RGAREA                                      @YL026UD 45950000
         STM   RGE,RGF,CHPGA           STORE SID CCW           @YL026UD 46000000
         STM   RGE,RGF,CHPGB           STORE SID CCW           @YL026UD 46050000
         LM    RGE,RGF,CCWSID+8        RELOCATE TIC CCW        @YL026UD 46100000
         LA    RGG,CHPGA               DEVELOP TIC ADDR        @YL026UD 46150000
         AR    RGE,RGG                                                  46200000
         STM   RGE,RGF,CHPGA2          STORE TIC               @YL026UD 46250000
         LA    RGG,CHPGB-CHPGA         DEVELOP SECOND TIC ADDR @YL026UD 46300000
         AR    RGE,RGG                                                  46350000
         STM   RGE,RGF,CHPGB2          SECOND SID, TIC         @YL026UD 46400000
         LA    RGG,CHPGA2                                               46450000
         LM    RGE,RGF,MBBCCHHR        DEVELOP COUNT FIELD              46500000
         SLDL  RGE,B24                 DROP MBB                         46550000
         A     RGF,X080100             SET KL AND DL                    46600000
RELOOP1  L     RGD,CCWWR               WR CKD CCW              @YL026UD 46650000
         AR    RGD,RGG                 POINT TO COUNT FIELD    @YL026UD 46700000
         ST    RGD,EIGHT(RGG)                                  @YL026UD 46750000
         L     RGD,CCWWR+4             WR CKD CCW              @YL026UD 46800000
         ST    RGD,B12(RGG)                                    @YL026UD 46850000
         MVC   CHPGB-SVTT(EIGHT,RGG),CCWRCH  MOVE WR CHECK CCW          46900000
         A     RGF,X1000000            INCREMENT R                      46950000
         STM   RGE,RGF,COUNT2-CHPGA2(RGG) STORE COUNT FIELD             47000000
         LA    RGG,EIGHT(RGG)          GO TO NEXT CCW                   47050000
         BCT   RGB,RELOOP1             BRANCH IF ANOTHER CCW            47100000
         NI    CHPGB-CHPGA1+4(RGG),XBF  TURN OFF CMD CHAIN BIT          47150000
         LTR   RGA,RGA                 SEE IF ALL CCW'S FILLED          47200000
         BCR   10,RGRET                BR IF ALL FILLED                 47250000
         MVC   EIGHT(EIGHT,RGG),CHPGB2  MOVE TIC                        47300000
         BR    RGRET                   RETURN TO CALLING CODE.          47350000
         EJECT                                                          47400000
*                                                                       47450000
* EXCP, WAIT, AND I/O ERROR CHECK                                       47500000
*                                                                       47550000
IO       EXCP  FIOB                                                     47600000
         WAIT  1,ECB=FECB                                               47650000
         TM    FECB,X20                CHECK I/O ERROR BIT              47700000
         BCR   1,RGRET                 Q. NO ERROR                      47750000
         LA    R10,B12                 SET I/O ERROR CODE        YM6411 47800000
         B     RETURN2                 RETURN TO CALLER                 47850000
         TITLE 'IGG0CLCF - CONSTANT DEFINITIONS'               @YL026UD 47900000
*                                                                       47950000
* CONSTANTS                                                    @YL026UD 48000000
*                                                                       48050000
         USING EREC,R9                                         @YL026UD 48100000
         DS    0F                                                       48150000
ERCCWR   EQU   *                                                        48200000
         DC    X'0E'                   READ KEY AND DATA                48250000
         DC    AL3(ERKEY-EREC)         POINT TO BUFFER                  48300000
         DC    X'2000'                 SLI                              48350000
         DC    H'12'                   READ 12 BYTES                    48400000
         DS    0F                                                       48450000
ERCCWW   EQU   *                                                        48500000
         DC    X'05'                   WRITE DATA                       48550000
         DC    AL3(0)                  BUFFER PTR SET DURING EXECUTION  48600000
TTRVFST  DS    0XL3                    TTR OF THE FIRST BLOCK OF VI     48650000
         DC    X'0000'                 ALL FLAGS OFF                    48700000
         DC    H'256'                  BYTES WRITTEN                    48750000
*                                                                       48800000
ONEREC   DC    F'256'                  UP TTR0 BY ONE                   48850000
MOVE1    MVC   0(0,OUT),0(IN)                                           48900000
MSG      DC    AL2(81),X'8000'                                 @OZ00006 48950000
         DC    C'IEC302I SYSCTLG I/O ERROR,VVVVVV,'            @OZ00006 49000000
MSGLEN   EQU   *-MSG                   LENGTH OF MSG SKELETON  @OZ00006 49050000
DESCRTE  DC    X'10004040'             SYSTEM STATUS,SYSTEM    @OZ00006 49100000
*                                      ERROR/MAINTENANCE,      @OZ00006 49150000
*                                      MASTER CONSOLE INFOR-   @OZ00006 49200000
*                                      MATIONAL                @OZ00006 49250000
         DS    0H                                              @OZ00006 49300000
MOVENAM2 MVC   OUTPUT+MSGLEN(0),0(R14)   OBJECT OF EXECUTE     @OZ00006 49350000
MOVENAME MVC   ERNAME(0),0(R14)                                         49400000
         DROP  R9                                              #YL026UD 49450000
*                                                                       49500000
SYSCTLG  DC    C'SYSCTLG '             DATA SET NAME.                   49550000
HIKEY    DC    X'FFFFFFFFFFFFFFFF'     HIGHEST POSSIBLE KEY.            49600000
         DC    HL2'36'                 COUNT CONSTANT.                  49650000
         DS    0F                      FILLER.                          49700000
X10000   DC    X'00010000'             TTR STEP CONSTANT.               49750000
X080100  DC    X'00080100'             KEY AND DATA LENGTH CONSTANT.    49800000
X1000000 DC    X'01000000'             R INCREMENT VALUE.               49850000
RPSID    DC    C'RPSA'                 ID OF RPS SIO APPENDAGE.         49900000
*                                                                       49950000
SPBYTES  DS    0F                 GET SP 253 PARAMETER WORD.            50000000
         DC    AL1(253)           SUBPOOL NUMBER.                       50050000
         DC    AL3(AREAEND1-AREADCB) NUMBER OF BYTES.          @OZ15077 50100008
XTBYTES  DC    AL1(230)           SUBPOOL NUMBER               @Z40CSRC 50150008
         DC    AL3(DSEXTEND-AREADCB) LEN OF EXTEND WORK AREA   @Z40CSRC 50200008
FDEBAD   DS    0F                 ARITHMETIC CONSTANT EQUAL TO          50250000
         DC    X'F1'              2'S COMPL OF PROT TAG, DEB ID AND     50300000
         DC    AL3(DEBAD)         DEB ADDR DISPLACEMENT.                50350000
HICCHHNT DC    X'7FFF7FFF7FFF'    HIGH CCHH COUNT.                      50400000
FF       EQU   HICCHHNT+1         EQUATES TO A 1 BYTE FF CONSTANT.      50450000
ZEROA    DC    H'00'              A ONE BYTE ZERO CONSTANT.             50500000
XCTLCONX DC    C'IGG0553A'        EXTEND MODULE NAME.                   50550000
EXTMAXCC DC    F'2'               MAXIMUM EXTEND RETURN CODE   @YL026UD 50600000
ABTABLE  EQU   *-240              TR TABLE                     @Y30LSRA 50600203
         DC    C'0123456789ABCDEF'                             @Y30LSRA 50600403
MSSMSG   WTO   'IEC366I JOBNAMED,VOLSER MSS FAILURE DURING ACQUIRE CODE*50600603
               =NNN',DESC=4,ROUTCDE=(2,11),MF=L                @Y30LSRA 50600803
MSSMLEN   EQU   *-MSSMSG          END OF MESSAGE               @Y30LSRA 50601003
*                                                                       50650000
         TITLE 'IGG0CLCF - CHANNEL COMMAND WORD DEFINITIONS'            50700000
*                                                                       50750000
* PATTERN CHANNEL COMMAND WORDS.                                        50800000
*                                                                       50850000
CCW1     CCW   X'31',M2B2C2HR+3-AREADCB,X'40',5 SEARCH EQUAL ID@YL026UD 50900000
CCW2     CCW   X'08',CHPG-AREADCB,0,1          TIC TO CCW1     @YL026UD 50950000
CCW3     CCW   X'06',IECSDSF4-AREADCB,X'60',48 READ VTOC DSCB. @YL026UD 51000000
CCW4     CCW   X'D1',DS4HPCHR-AREADCB,X'40',5  SEARCH HI ID.   @YL026UD 51050000
CCW5     CCW   X'08',CHPG+48-AREADCB,0,1       TIC TO CCW7.    @YL026UD 51100000
CCW6     CCW   X'03',0,0,1                   CONTROL NOP.               51150000
CCW7     CCW   X'29',DS1DSNAM-AREADCB,X'60',44 SEARCH KEY EQUAL@YL026UD 51200000
CCW8     CCW   X'08',CHPG+24-AREADCB,0,1       TIC TO CCW4.    @YL026UD 51250000
CCW9     CCW   X'06',DS1FMTID-AREADCB,X'40',96 RD SYSCTLG DSCB @YL026UD 51300000
CCW10    CCW   X'12',COUNT-AREADCB,0,8         READ COUNT.     @YL026UD 51350000
CCWRDKD  CCW   X'0E',DSCBK-AREADCB,0,140       READ KEY & DATA @YL026UD 51400000
*                                                                       51450000
CCWSID   CCW   X'31',MBBCCHHR+3-WKAREA,X'40',5 SEARCH ID                51500000
         DC    X'0800000000000000'     TIC                              51550000
CCWWR    CCW   X'1D',COUNT2-CHPGA2,X'60',8 WRITE CKD, SLI               51600000
CCWRCH   CCW   X'1E',0,X'50',272       READ CKD, SKIP                   51650000
READVTOC CCW   X'29',D1SDSNAM-WKAREA,X'60',44 SEARCH KEY EQUAL          51700000
         CCW   X'08',CHPGA-WKAREA,0,1    TIC                            51750000
         CCW   X'06',D1SFMTID-WKAREA,0,96 READ DATA                     51800000
WRVTOC   CCW   X'05',D1SFMTID-WKAREA,X'40',96 WRITE DATA                51850000
         CCW   X'29',D1SDSNAM-WKAREA,X'60',44 SEARCH KEY EQUAL          51900000
         CCW   X'08',CHPGA4-WKAREA,0,1 TIC                              51950000
         CCW   X'06',0,X'10',96        CHECK DATA                       52000000
CCWRD    CCW   X'06',BLOCK-WKAREA,X'00',256 READ DATA           SA50973 52050000
CCWWDOP  EQU   X'05'                   WRITE DATA OP CODE       SA50973 52100000
CCWOPTN1 EQU   X'30'                   NO TRANSFER, SILI        SA50973 52150000
CCWOPTN2 EQU   X'40'                   COMMAND CHAIN            SA50973 52200000
*                                                              @YL026UD 52250000
*                                                              @YL026UD 52300000
*      MODULE PATCH AREA (MAINTENANCE AREA)                    @YL026UD 52350000
*                                                              @YL026UD 52400000
FIXAREA  DC    100X'00'                                        @YL026UD 52450000
*                                                              @YL026UD 52500000
         TITLE 'IGG0CLCF - CONSTANT EQUATE DEFINITIONS'                 52550000
*                                                                       52600000
*      CONSTANT EQUATES                                                 52650000
*                                                                       52700000
VICETYP  EQU   5                       VICE TYPE CODE                   52750000
ICETYP   EQU   3                       ICE TYPE CODE                    52800000
ILETYP   EQU   0                       ILE TYPE CODE                    52850000
IPETYP   EQU   0                       IPE TYPE CODE                    52900000
DSPETYP  EQU   7                       OR MORE, FOR DSPE TYPE CODE      52950000
VCBPETYP EQU   1                       VCBPE TYPE CODE                  53000000
OCVOLTYP EQU   3                       OLD CVOL TYPE CODE               53050000
NCVOLTYP EQU   5                       NEW CVOL TYPE CODE               53100000
ALIASTYP EQU   4                       ALIAS TYPE CODE                  53150000
GIPETYP  EQU   2                       GIPE TYPE CODE                   53200000
ERROR00  EQU   0                                                        53250000
ERROR04  EQU   4                                                        53300000
ERROR08  EQU   8                                                        53350000
ERROR12  EQU   12                                                       53400000
ERROR16  EQU   16                                                       53450000
ERROR20  EQU   20                                                       53500000
ERROR24  EQU   24                                                       53550000
ERROR28  EQU   28                                                       53600000
ERROR32  EQU   32                                                       53650000
ERROR72  EQU   72                                                       53700000
*********************************************************************** 53750000
*      CHARACTER CODE DEPENDENT CONSTANTS                               53800000
*********************************************************************** 53850000
CCDBLANK EQU   C' '                                                     53900000
CCDRPARN EQU   C')'                                                     53950000
CCDMINUS EQU   C'-'                                                     54000000
CCDPLUS  EQU   C'+'                                                     54050000
CCD0     EQU   C'0'                                                     54100000
CCDG     EQU   C'G'                                                     54150000
CCDV     EQU   C'V'                                                     54200000
CCDPERD  EQU   C'.'                                                     54250000
CCDLPARN EQU   C'('                                                     54300000
*********************************************************************** 54350000
*                                                                       54400000
* MISCELLANEOUS EQUATES USED .                                          54450000
*                                                                       54500000
ONE      EQU   1                       A ONE CONSTANT.                  54550000
TWO      EQU   2                       A TWO CONSTANT.                  54600000
THREE    EQU   3                       A THREE CONSTANT.                54650000
FOUR     EQU   4                       A FOUR CONSTANT.                 54700000
SIX      EQU   6                       A SIX CONSTANT          @Y30LSRA 54701003
EIGHT    EQU   8                       AN EIGHT CONSTANT.               54750000
TEN      EQU   10                      A TEN CONSTANT.                  54800000
TWELVE   EQU   12                      A TWELVE CONSTANT.               54850000
NINTY    EQU   90                      DSCB MOVE LENGTH.                54900000
B12      EQU   12                      BINARY 12                        54950000
B14      EQU   14                      BINARY 14                        55000000
B15      EQU   15                      BINARY 15.                       55050000
B22      EQU   22                      BINARY 22                        55100000
B24      EQU   24                      BINARY 24                        55150000
B26      EQU   26                      BINARY 26                        55200000
B36      EQU   36                      BINARY 36                        55250000
B40      EQU   40                      BINARY 40 EQUATE.                55300000
B100     EQU   100                     BINARY 100                       55350000
B105     EQU   105                     BINARY 105                       55400000
B184     EQU   184                     BINARY 184                       55450000
B253     EQU   253                     SUBPOOL 253 CONSTANT.            55500000
RPSIDLOC EQU   62                      OFFSET TO RPS ID          XM2100 55550000
X00      EQU   X'00'                   HEX 00                           55600000
X01      EQU   X'01'                   HEX 01                           55650000
X0D      EQU   X'0D'                   HEX 0D                           55700000
X0E      EQU   X'0E'                   HEX 0E                           55750000
X10      EQU   X'10'                   HEX 10                           55800000
X12      EQU   X'12'                   HEX 12                           55850000
X14      EQU   X'14'                   HEX 14                           55900000
X18      EQU   X'18'                   HEX 18                           55950000
X20      EQU   X'20'                   HEX 20                           56000000
X42      EQU   X'42'                   HEX 42                           56050000
X7F      EQU   X'7F'                   HEX 7F                           56100000
X81      EQU   X'81'                   HEX 81                           56150000
XBF      EQU   X'BF'                   HEX BF                           56200000
XFF      EQU   X'FF'                   HEX FF                           56250000
X100     EQU   X'100'                  HEX 100                          56300000
X105     EQU   X'105'                  HEX 105                          56350000
X0100    EQU   X'0100'                 HEX 0100                         56400000
DEBAD    EQU   44                      DEB POINTER IN DCB               56450000
WASZ     EQU   128                     SIZE OF RPS WORK AREA.           56500000
AVTSV    EQU   120                     DISP TO AVT PTR IN RPSWA.        56550000
DEBAPDS  EQU   28                      APPNDG. PTR DISP. IN DEB.        56600000
FMWAL    EQU   512                     FORMAT WORKAREA LENGTH.          56650000
*                                                                       56700000
CODPERD  EQU   4                                                        56750000
CODBLANK EQU   8                                                        56800000
CODPARN  EQU   12                                                       56850000
CLC1     EQU   C'1'                                                     56900000
CLC2     EQU   C'2'                                                     56950000
CLC3     EQU   C'3'                                                     57000000
CLC4     EQU   C'4'                                                     57050000
CLC5     EQU   C'5'                                                     57100000
CLC6     EQU   C'6'                                                     57150000
CLC7     EQU   C'7'                                                     57200000
FREEMAIN EQU   10                                                       57250000
*                                                                       57300000
CC       EQU   X'40'                   COMMAND CHAIN                    57350000
SLACK    EQU   32                      MAXIMUM NUMBER OF UNUSED BYTES   57400000
*                                      ALLOWED IN A CATALOG INDEX BLOCK 57450000
SILI     EQU   X'20'                   SUPPRESS INCORRECT LENGTH        57500000
*                                                                       57550000
D0       EQU   0                  DISPLACEMENT OF ZERO         @Y30LSRA 57551003
D01      EQU   1                                                        57600000
D2       EQU   2                  DISPLACEMENT OF TWO          @Y30LSRA 57601003
D3       EQU   3                  DISPLACEMENT OF THREE        @Y30LSRA 57602003
D4       EQU   4                  DISPLACEMENT OF FOUR         @Y30LSRA 57603003
D6       EQU   6                  DISPLACEMENT OF SIX          @Y30LSRA 57604003
D7       EQU   7                  DISPLACEMENT OF SEVEN        @Y30LSRA 57605003
D8       EQU   8                  DISPLACEMENT OF EIGHT        @Y30LSRA 57606003
D12      EQU   12                                                       57650000
D16      EQU   16                                                       57700000
D21      EQU   21                 DISPLACEMENT OF 21           @Y30LSRA 57700203
D23      EQU   23                 DISPLACEMENT OF 23           @Y30LSRA 57700403
D24      EQU   24                 DISPLACEMENT OF 24           @Y30LSRA 57700603
D26      EQU   26                 DISPLACEMENT OF 26           @Y30LSRA 57700803
D28      EQU   28                 DISPLACEMENT OF TWENTY-EIGHT @Y30LSRA 57701003
D51      EQU   51                 DISPLACEMENT OF 51           @Y30LSRA 57701203
D60      EQU   60                 DISPLACEMENT OF 60           @Y30LSRA 57701403
D62      EQU   62                 DISPLACEMENT OF 62           @Y30LSRA 57701603
D92      EQU   92                 DISPLACEMENT OF 92           @Y30LSRA 57701803
L1       EQU   1                  LENGTH OF ONE                @Y30LSRA 57702003
L2       EQU   2                  LENGTH OF TWO                @Y30LSRA 57703003
L3       EQU   3                  LENGTH OF THREE              @Y30LSRA 57703203
L6       EQU   6                  LENGTH OF SIX                @Y30LSRA 57704003
L8       EQU   8                  LENGTH OF EIGHT              @Y30LSRA 57705003
L11      EQU   11                 LENGTH OF ELEVEN             @Y30LSRA 57705203
L96      EQU   96                 LENGTH OF NINETY-SIX         @Y30LSRA 57706003
L100     EQU   100                LENGTH OF ONE HUNDRED        @Y30LSRA 57707003
BLANK    EQU   C' '               BLANK                        @Y30LSRA 57707203
DECZERO  EQU   X'F0'              DECIMAL ZERO                 @Y30LSRA 57707403
VIRTDASD EQU   X'08'              VIRTUAL DASD                 @Y30LSRA 57708003
ACQOP    EQU   X'02'              ICBACREL ACQUIRE OP CODE     @OZ25613 57728037
         TITLE 'IGG0CLCF - REGISTER EQUATE DEFINITIONS'                 57750000
*                                                                       57800000
* THE FOLLOWING ARE REGISTER EQUATES USED IN THIS PROGRAM.              57850000
*                                                                       57900000
R0       EQU   0                       REGISTER 0                       57950000
R1       EQU   1                       REGISTER 1                       58000000
R2       EQU   2                       REGISTER 2                       58050000
R3       EQU   3                       REGISTER 3                       58100000
R4       EQU   4                       REGISTER 4                       58150000
R5       EQU   5                       REGISTER 5                       58200000
R6       EQU   6                       REGISTER 6                       58250000
R7       EQU   7                       REGISTER 7                       58300000
R8       EQU   8                       REGISTER 8                       58350000
R9       EQU   9                       REGISTER 9                       58400000
R10      EQU   10                      REGISTER 10                      58450000
R11      EQU   11                      REGISTER 11                      58500000
R12      EQU   12                      REGISTER 12                      58550000
R13      EQU   13                      REGISTER 13                      58600000
R14      EQU   14                      REGISTER 14                      58650000
R15      EQU   15                      REGISTER 15                      58700000
RGA      EQU   2                       REGISTER 2                       58750000
RGB      EQU   3                       REGISTER 3                       58800000
RGC      EQU   4                       REGISTER 4                       58850000
RGD      EQU   5                       REGISTER 5                       58900000
RGE      EQU   6                       REGISTER 6                       58950000
RGF      EQU   7                       REGISTER 7                       59000000
RGG      EQU   8                       REGISTER 8                       59050000
RGH      EQU   9                       REGISTER 9                       59100000
RGBASE   EQU   4                       BASE REGISTER           @YL026UD 59150000
RGDQTY   EQU   10                      DIRECTORY QUANTITY               59200000
RGTTR    EQU   11                      RELATIVE TRACK COUNTER           59250000
RGAREA   EQU   13                      WORK AREA ADDRESS                59300000
RGRET    EQU   14                      RETURN REGISTER                  59350000
*                                                                       59400000
BALREG1  EQU   R14                                                      59450000
BALREG2  EQU   R12                                                      59500000
BASE     EQU   R4                                                       59550000
*                                                                       59600000
BALREG3  EQU   R11                                                      59650000
BALREG4  EQU   R3                                                       59700000
*                                                                       59750000
IN       EQU   R9                                                       59800000
OUT      EQU   R7                                                       59850000
LENGTH   EQU   R5                                                       59900000
NEXTTTR  EQU   R10                                                      59950000
*                                                                       60000000
RFKEY    EQU   0                  INPUT FUNCTION REQUEST KEY.           60050000
RPARM    EQU   1                  INPUT PARAMETER REGISTER.             60100000
RCVT     EQU   3                  CVT BASE REGISTER.                    60150000
RBASE    EQU   4                  BASE REGISTER.               @YL026UD 60200000
RCWA     EQU   6                  CATALOG WORK AREA BASE.               60250000
RGAREA2  EQU   8                  SECONDARY DCB BASE REGISTER.          60300000
RGAREA3  EQU   9                  TERTIARY DCB BASE REGISTER.           60350000
RFKEYA   EQU   10                 POSSIBLE TTR KEY FROM EXTEND.         60400000
RUCB     EQU   11                 UCB BASE REGISTER.                    60450000
RBR      EQU   15                 RETURN CODE REGISTER.                 60500000
*                                                                       60550000
         SPACE                                                          60600000
*                                                                       60650000
**********************************************************************  60700000
*                                                                       60750000
* END OF THE IGG0CLCF CSECT.                                            60800000
*                                                                       60850000
FMTSIZE  EQU   *                       EQUATE TO LAST BYTE OF CSECT.    60900000
MAXSIZE  EQU   IGG0CLCF+X'1000'        MAXIMUM ALLOWABLE LENGTH.        60950000
AVAILABL EQU   MAXSIZE-FMTSIZE         FREE SPACE REMAINING.            61000000
*                                                                       61050000
**********************************************************************  61100000
*                                                                       61150000
         TITLE 'IGG0CLCF - CATALOG WORKAREA DSECT'                      61200000
*                                                                       61250000
*      DSECTS                                                           61300000
*                                                                       61350000
         WORKAREA LIST=NO                                               61400000
         TITLE 'IGG0CLCF - ENVIRONMENT RECORD DSECT'                    61450000
EREC     DSECT                         ENVIRONMENT RECORD               61500000
ERCTR    DS    F                       RESERVED                         61550000
ERES1    DS    1F                      RESERVED                         61600000
ERTIME   DS    2F                      TIME AND DATE                    61650000
ERCAMLST DS    1F                      CAMLST OPTION BYTES              61700000
ERMODMAP DS    XL1                     MODULE MAP                       61750000
ERFLG12  DS    XL2                     FLAG1 AND FLAG2                  61800000
ERFLAG3  DS    XL1                     FLAG3                            61850000
ERERRCOD DS    XL2                     CATALOG AND LOCATE ERROR CODES   61900000
ERNAMTTR DS    XL14                    CURRENT LEVEL NAME               61950000
EREGSAV  DS    15F                     REGS 1 THROUGH 14                62000000
ERWA1    DS    XL28                    TTRS IN WORKAREA                 62050000
         ORG   ERWA1                   OVERLAY 12 BYTES 'ERWA1' SA52063 62100000
ERKEY    DS    CL8                     KEY FIELD                SA52063 62150000
EROCTR   DS    CL4                     OLD COUNT                SA52063 62200000
         ORG                                                            62250000
ERINPUT  DS    XL18                    FIRST 18 BYTES OF 'INPUT'        62300000
EROUTPUT DS    XL18                    FIRST 18 BYTES OF 'OUTPUT'       62350000
EROPTNCC DS    XL8                     'OPTNCCW'--INDICATES LAST I/O    62400000
ERIOB    DS    XL40                    IOB                              62450000
ERNAME   DS    CL44                    FULL GIVEN NAME                  62500000
ERBUFF   EQU   ERWA1                   READ BUFFER                      62550000
         TITLE 'IGG0CLCF - FORMAT WORKAREA DSECT'                       62600000
*                                                                       62650000
* THIS DSECT DEFINES THE WORK AREA PASSED TO THE FORMAT ROUTINE.        62700000
*                                                                       62750000
         SPACE                                                          62800000
WKAREA   DSECT                                                          62850000
FSVAREA  DS    0F                      REG SAVE AREA.                   62900000
SVBLKS   DS    F                       NUMBER OF BLOCKS FOR DIRECTORY   62950000
SVDCB    DS    F                       DCB ADDRESS                      63000000
SVBLPTK  DS    F                       NUMBER OF BLOCKS PER TRACK       63050000
SVBYTES  DS    F                       NUMBER OF BYTES IN WORK AREA     63100000
SVADDR   DS    F                       ADDRESS OF WORK AREA             63150000
SVCNT    DS    F                       DATA MANAGEMENT COUNT            63200000
SVTT     DS    F                       STARTING RELATIVE TRACK ADDRESS  63250000
CHPGA    DS    0D                      WRITE CHANNEL PROGRAM            63300000
CHPGA1   DS    D                       CCW 1.                           63350000
CHPGA2   DS    D                       CCW 2.                           63400000
CHPGA3   DS    D                       CCW 3.                           63450000
CHPGA4   DS    D                       CCW 4.                           63500000
CHPGA5   DS    D                       CCW 5.                           63550000
CHPGA6   DS    D                       CCW 6.                           63600000
CHPGA7   DS    D                       CCW 7.                           63650000
CHPGA8   DS    D                       CCW 8.                           63700000
CHPGA9   DS    D                       CCW 9.                           63750000
CHPGA10  DS    D                       CCW 10.                          63800000
CHPGA11  DS    D                       CCW 11.                          63850000
CHPGA12  DS    D                       CCW 12.                          63900000
CHPGA13  DS    D                       CCW 13.                          63950000
CHPGA14  DS    D                       CCW 14.                          64000000
CHPGA15  DS    D                       CCW 15.                          64050000
CHPGA16  DS    D                       CCW 16.                          64100000
CHPGA17  DS    D                       CCW 17.                          64150000
CHPGB    DS    0D                      READ CHANNEL PROGRAM             64200000
CHPGB1   DS    D                       CCW 1.                           64250000
CHPGB2   DS    D                       CCW 2.                           64300000
CHPGB3   DS    D                       CCW 3.                           64350000
CHPGB4   DS    D                       CCW 4.                           64400000
CHPGB5   DS    D                       CCW 5.                           64450000
CHPGB6   DS    D                       CCW 6.                           64500000
CHPGB7   DS    D                       CCW 7.                           64550000
CHPGB8   DS    D                       CCW 8.                           64600000
CHPGB9   DS    D                       CCW 9.                           64650000
CHPGB10  DS    D                       CCW 10.                          64700000
CHPGB11  DS    D                       CCW 11.                          64750000
CHPGB12  DS    D                       CCW 12.                          64800000
CHPGB13  DS    D                       CCW 13.                          64850000
CHPGB14  DS    D                       CCW 14.                          64900000
CHPGB15  DS    D                       CCW 15.                          64950000
CHPGB16  DS    D                       CCW 16.                          65000000
CHPGB17  DS    D                       CCW 17.                          65050000
         EJECT                                                          65100000
         ORG   CHPGA6                  OVERLAY CHPGA AND B      SA50973 65150000
BLOCK    DS    0CL256                  BUFFER                   SA50973 65200000
         DS    XL2                     FILLER, 'BYTES USED'     SA50973 65250000
         DS    XL12                    FILLER, FRST PART 'VICE' SA50973 65300000
UPLSTBLK DS    XL2                     FRST 2 BYTES 'VCLSTBLK'  SA50973 65350000
         ORG                                                            65400000
COUNT2   DS    0D                      DIRECTORY CONTROL BLOCK          65450000
CTKEY    DS    CL8                     KEY OF DIR BLOCK.                65500000
CTCOUNT  DS    CL2                     COUNT OF DIRECTORY BLOCK.        65550000
CTDIR    DS    CL7                     FILLER.                          65600000
CTLBK    DS    CL1                     LOW ORDER OF NAME.               65650000
         DS    CL2                     FILLER.                          65700000
CTTTRC   DS    CL2                     TTRC                             65750000
CTHITT   DS    CL2                     HI TT.                           65800000
CTHIR    DS    CL1                     HI R.                            65850000
         DS    CL3                     FILLER.                          65900000
CTNABTR  DS    CL1                     NEXT AVAILABLE BLOCK TTR.        65950000
         DS    CL2                     FILLER.                          66000000
CTNBLB   DS    CL1                     BYTES IN LAST BLOCK.             66050000
CTHIENT  DS    CL8                     HI ENTRY.                        66100000
         DS    CL72                    FILLER.                          66150000
HICOUNT  DS    D                       LAST RELATIVE TRACK              66200000
FECB     DS    F                       EVENT CONTROL BLOCK              66250000
FIOB     DS    8F                      INPUT OUTPUT BLOCK               66300000
MBBCCHHR DS    CL8                     SEEK ADDRESS                     66350000
BPAMDIR  DS    0X                      BDAM DIRECTORY                   66400000
BPDCNT   DS    CL8                     BPAM DIR COUNT.                  66450000
BPDHIK   DS    CL9                     BPAM DIR HI KEY.                 66500000
BPDBPB   DS    CL1                     BPAM DIR BYTES PER BLOCK.        66550000
BPDHIE   DS    CL8                     BPAM DIR HI ENTRY.               66600000
         ORG   COUNT2-148              ORG EXTEND SAVE AREA.            66650000
EXTSAVE  DS    CL8                     FIRST EXTENT OF DEB              66700000
*                                                                       66750000
*      FORMAT 1 DSCB                                                    66800000
*                                                                       66850000
D1SDSNAM DS    CL44                    DATA SET NAME                    66900000
D1SFMTID DS    CL1                     FORMAT IDENTIFIER                66950000
D1SDSSN  DS    CL6                     DATA SET SERIAL NUMBER           67000000
D1SVOLSQ DS    XL2                     VOLUME SEQUENCE NUMBER           67050000
D1SCREDT DS    XL3                     CREATION DATE                    67100000
D1SEXPDT DS    XL3                     EXPIRATION DATE                  67150000
D1SNOEPV DS    XL1                     NUMBER OF EXTENTS ON VOLUME      67200000
D1SNOBDB DS    XL1                     NUMBER OF BYTES USED IN LAST     67250000
*                                         DIRECTORY BLOCK               67300000
         DS    XL1                     RESERVED                         67350000
D1SSYSCD DS    CL13                    SYSTEM CODE                      67400000
         DS    XL7                     RESERVED                         67450000
D1SDSORG DS    XL2                     DATA SET ORGANIZATION            67500000
D1SRECFM DS    XL1                     RECORD FORMAT                    67550000
D1SOPTCD DS    XL1                     OPTION CODE                      67600000
D1SBLKL  DS    XL2                     BLOCK LENGTH                     67650000
D1SLRECL DS    XL2                     RECORD LENGTH                    67700000
D1SKEYL  DS    XL1                     KEY LENGTH                       67750000
D1SRKP   DS    XL2                     RELATIVE KEY POSITION            67800000
D1SDSIND DS    XL1                     DATA SET INDICATORS              67850000
D1SSCALO DS    XL4                     SECONDARY ALLOCATION             67900000
D1SLSTAR DS    XL3                     LAST USED TRACK AND BLOCK        67950000
D1STRBAL DS    XL2                     BYTES REMAINING ON LAST TRACK    68000000
         DS    XL2                     RESERVED                         68050000
D1SEXT1  DS    XL10                    FIRST EXTENT DESCRIPTION         68100000
*        FIRST BYTE                    EXTENT TYPE INDICATOR            68150000
*        SECOND BYTE                   EXTENT SEQUENCE NUMBER           68200000
*        THIRD - SIXTH BYTES           LOWER LIMIT                      68250000
*        SEVENTH - TENTH BYTES         UPPER LIMIT                      68300000
D1SEXT2  DS    XL10                    SECOND EXTENT DESCRIPTION        68350000
D1SEXT3  DS    XL10                    THIRD EXTENT DESCRIPTION         68400000
D1SPTRDS DS    XL5                     POSSIBLE POINTER TO A FORMAT     68450000
*                                         2 OR 3 DSCB                   68500000
D1SEND   EQU   *                                                        68550000
         TITLE 'IGG0CLCF - COMMUNICATION VECTOR TABLE DSECT'            68600000
*                                                                       68650000
*COMMUNICATION VECTOR TABLE DEFINITION                                  68700000
*                                                                       68750000
CVT      DSECT                                                          68800000
         CVT   SYS=MIN                                                  68850000
         TITLE 'IGG0CLCF - DCB/DEB AREA DSECT'                          68900000
*                                                                       68950000
* THIS DSECT DESCRIBES THE DCB/DEB AREA.                                69000000
*                                                                       69050000
AREADCB  DSECT                                                          69100000
         DS    6F                 DCB AREA FILLER.                      69150000
DAREA    DS    0F                 WORK AREA REFERENCE.                  69200000
NUMBYTES DS    F                  NUMBER OF BYTES.                      69250000
DSCBTRK  DS    F                  CC HH OF SYSCTLG DSCB.                69300000
CATWKAP  DS    1F                 CATALOG WORKAREA ADDRESS     @YL026UD 69350000
BLDLP    DS    1F                 BLDL    WORKAREA ADDRESS     @YL026UD 69400000
DEB      DS    0F                 START OF THE DEB.                     69450000
DEBTCBAD DS    F                  TCB ADDRESS.                          69500000
DEBAMIND DS    0X                 AM INDICATOR.                         69550000
DEBDEBAD DS    F                  NEXT DEB ADDRESS.                     69600000
         DS    2F                 IRB AND SYS PURGE CHAIN.              69650000
DEBNMEXT DS    0X                 NO OF EXTENTS.                        69700000
         DS    2F                 USER PURGE AND PURGE ECB ADDR.        69750000
DEBDCBAD DS    F                  DCB ADDRESS.                          69800000
DEBAPPAD DS    F                  APPENDAGE VECTOR TABLE ADDRESS.       69850000
DEBDVMOD DS    0X                 DEBICE MODIFIER MASK.                 69900000
DEBUCBAD DS    F                  UCB ADDRESS.                          69950000
DEBBINUM DS    H                  BIN NUMBER.                           70000000
DEBSTRCH DS    0CL8               START/END CCHH.                       70050000
DEBSTRCC DS    H                  START CYLINDER.                       70100000
DEBSTRHH DS    H                  START HEAD.                           70150000
DEBENDCC DS    H                  END CYLINDER.                         70200000
DEBENDHH DS    H                  END HEAD.                             70250000
DEBNMTRK DS    H                  NUMBER OF TRACKS.                     70300000
EXTL     EQU   16                 LENGTH OF AN EXTENT ENTRY.            70350000
MAXEL    EQU   256                MAXIMUM EXTENT AREA LENGTH.           70400000
DEBEND   EQU   *                                                        70450000
DEBL     EQU   DEBEND-DEB         DEB LENGTH.                           70500000
         EJECT                                                          70550000
*                                                                       70600000
* FORMAT 4 DSCB DEFINITION.                                             70650000
*                                                                       70700000
         SPACE                                                          70750000
         IECSDSL1 (4)                                                   70800000
DS1RACDF EQU   X'40'              DATA SET IS RACF DEFINED     @Z40CSRC 70810008
*                                 (IN BYTE DS1DSIND)           @Z40CSRC 70820008
         ORG   IECSDSF4+48        ORG TO CCW AREA.                      70850000
CHPG     DS    2D                 CHANNEL PROGRAM RELOCATE AREA.        70900000
CHPGAA   DS    2D                 CHANNEL PROGRAM RELOCATE AREA.        70950000
CHPGBB   DS    2D                 CHANNEL PROGRAM RELOCATE AREA         71000000
CHPGCC   DS    2D                 CHANNEL PROGRAM RELOCATE AREA         71050000
CHPGDD   DS    2D                 CHANNEL PROGRAM RELOCATE AREA         71100000
AECB     DS    F                  EVENT CONTROL BLOCK.                  71150000
AIOB     DS    8F                 I/O CONTROL BLOCK.                    71200000
M2B2C2HR DS    CL8                SEEK ADDRESS IN THE IOB.              71250000
CCHHR    EQU   M2B2C2HR+3         CHANNEL-HEAD ADDRESS.                 71300000
CCHHRL   EQU   5                  LENGTH OF CCHHR.                      71350000
DSCBK    DS    CL44               DATA SET NAME AREA.                   71400000
DSCBK4   EQU   DSCBK+4            FOUR BYTES OFF DSCBK                  71450000
DSCBD    EQU   DSCBK+44           FOURTY FOUR BYTES OFF DSCBK           71500000
*                                                                       71550000
* FORMAT 1 DSCB DEFINITION.                                             71600000
*                                                                       71650000
         SPACE                                                          71700000
         ORG   DSCBK              ORG COUNT AREA.                       71750000
         IECSDSL1 (1)                                                   71800000
COUNT    DS    CL8                SYSCTLG DSCB DISK ADDR/               71850000
COUNTA   EQU   COUNT+4                                                  71900000
*                                 WORKAREA FOR CONVERT ROUTINE.         71950000
REGSAVE  DS    1F                 REGISTER SAVE AREA                    72000000
REGS2    DS    1F                 REGISTER SAVE AREA.                   72050000
REGS3    DS    1F                 REGISTER SAVE AREA                    72100000
REGS4    DS    1F                 REGISTER SAVE AREA.                   72150000
REGS5    DS    1F                 REGISTER SAVE AREA.                   72200000
REGS6    DS    1F                 REGISTER SAVE AREA.                   72250000
NUMUCB   DS    H                  NUMBER OF UCB'S.                      72300000
SWL      EQU   6                  LENGTH OF SWITCH AREA.                72350000
FMTSW    DS    X                  COUNT OF BLOCK TRACK.                 72400000
EXTDSW   DS    X                  EXTEND COUNTER.                       72450000
EXTDTT   DS    F                  RELATIVE TRACK ADDRESS.               72500000
AREAEND2 DS    0D                 USED TO DETERMINE NUMBER BYTES.       72550000
EXTDRGSV DS    2F                 REGISTER SAVE AREA.                   72600000
*                                                                       72650000
* EXTEND WORK AREA DEFINITION.                                          72700000
*                                                                       72750000
         ORG   DAREA              ORG TO EXTEND AREA.                   72800000
EXTDAREA DS    0F                                                       72850000
         IECDSECT                                                       72900000
DSVSVRB  DS    CL(L'SVRBEXT)      TO SAVE RBEXSAVE             @Z40CSRC 72905008
DSVEXTNT DS    CL10               DEB EXTENT SAVE AREA         @Z40CSRC 72925008
DSEXTEND DS    0D                 END OF EXTEND WORK AREA      @Z40CSRC 72945008
AREAEND1 EQU   DSEXTEND           END OF OPEN WORKAREA         @OZ15077 72947008
         TITLE 'IGG0CLCF - UNIT CONTROL BLOCK DSECT'                    72950000
*                                                                       73000000
* THIS IS THE UCB DEFINITION DSECT.                                     73050000
*                                                                       73100000
         SPACE                                                          73150000
UCB      DSECT                                                          73200000
         IEFUCBOB                                                       73250000
         TITLE 'IGG0CLCF - SYSCTLG OPEN, EXTEND, FORMAT'       @Z40CSRC 73255008
         IHAPSA                                                @Z40CSRC 73260008
         IHARB                                                 @Z40CSRC 73265008
         IKJTCB                                                @Z40CSRC 73270008
         END   IGG0CLCF                                                 73300000
