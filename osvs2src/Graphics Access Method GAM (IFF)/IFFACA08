         TITLE 'REQUEST ATTENTION INFORMATION ROUTINE'      D11         00050003
* TITLE:RQATN-REQUEST ATTENTION INFORMATION                             00100021
* STATUS:CHANGE LEVEL 0                                                 00200021
* FUNCTION:TO DETERMINE IF ANY ATTENTION HAS OCCURRED ON ANY DESIGNATED 00300021
*          SOURCE WHICH HAD BEEN ENABLED WHILE A SPECIFIED ATTENTION    00400021
*          LEVEL WAS ACTIVE.TO DELAY EXECUTION OF THE USER PROGRAM      00500021
*          UNTIL AN EXPECTED ATTENTION OCCURS ON ANY ENABLED DESIGNATED 00600021
*          SOURCE AT THE CURRENTLY ACTIVE ATTENTION LEVEL.              00700021
* ENTRY:ENTERED AT IFFACA08 VIA A CALL TO RQATN.                        00800021
* INPUT:GR#1 CONTAINS THE ADDRESS OF A WORK/SAVE AREA.THE FIRST WORD    00900021
*       CONTAINS THE ADDRESS OF A PARAMETER LIST CONSTRUCTED AS FOLLOWS 01000021
*       1.ATTNLEVEL-ADDRESS OF A VARIABLE CONTAINING THE ADDRESS OF AN  01100021
*         ATTENTION LEVEL.                                              01200021
*       2.CODELOC-ADDRESS OF A LOCATION INTO WHICH A CODE IS PLACED     01300021
*         THAT SPECIFIES THE TYPE OF ATTENTION BEING RETURNED.          01400021
*       3.WAIT-ADDRESS OF A VALUE THAT INDICATES :                      01500021
*         A. 1-IMMEDIATE RETURN IF DATA NOT AVAILABLE                   01600021
*         B. 2-DO NOT RETURN(WAIT) UNTIL DATA IS AVAILABLE              01700021
*       4.ARRAYNAME-ADDRESS OF AN ARRAY WHERE ATTENTION INFORMATION     01800021
*         MAY BE RETURNED.                                              01900021
*       5.ATTNSOURCE-ADDRESS(ES) OF A VALUE(S) DESIGNATING ATTENTION    02000021
*         TYPES THE INFORMATION IS  DESIRED ABOUT.                      02100021
* OUTPUT:ATTENTION DATA TO USER AND A UNIQUE CODE SPECIFYING TYPE OF    02200021
*        DATA BEING RETURNED.                                           02300021
* EXIT:RETURN TO CALLING PROGRAM                                        02400021
* RETURN CODES: 4,0 INCORRECT NUMBER OF PARAMETERS OR UNABLE TO DETER-  02500021
*                   MINE THE SINGLE INDIVIDUAL PARAMETER AT FAULT.      02600021
*               4,1 ATTNLEVEL DID NOT REFER TO A VALID OR EXISTING      02700021
*                   ATTENTION LEVEL.                                    02800021
*               4,3 VALUE OF WAIT INVALID                               02900021
*               4,5-N VALUE OF ATTNSOURCE INVALID                       03000021
*               0,0 SUCCESSFULL EXECUTION                               03100021
* ATTRIBUTES:RE-ENTRANT,PROBLEM PROGRAM MODE                            03200021
* NOTES:THIS ROUTINE EXAMINES THE FOLLOWING CONTROL BLOCKS AND TABLES:  03300021
*       1.GSPCB                                                         03400021
*       2.GTMCB                                                         03500021
*       3.GDSCB                                                         03600021
*       4.KEY TABLE                                                     03700021
*       5.BUFFER CONTROL TABLE                                          03800021
* EXTERNAL ROUTINES:ATTNINQ                                             03900021
*                   GIOCR                                               04000021
*                   CNVRT                                               04100021
         EJECT                                              D11         04105003
IFFACA08 CSECT                                                          04110003
* A33055 FIXED IN COMPONENT IO523.  GSP BYPASS WITH PTF 40613           04112003
*0843,404000-415000,422000-435000                                  000A 04113003
*0843,104000                                                       0935 04114003
*D710000-711000,D713000,A712020-713920,A136100-137000            A37965 04115003
*A68200,69200,75500-75700,A736100-736900,C737000,A738000    D11 ZA15437 04116003
*A759500                                                    D11 ZA15437 04116103
*                                                                       04117003
REG0     EQU   0                       PARAM REG 0                      04200021
REG1     EQU   1                       PARAM REG 1                      04300021
RLIST    EQU   2                       INPUT PARAM LIST                 04400021
RSOURCE  EQU   2                       ATTNSOURCE ADR REG               04500021
RFIRST   EQU   3                       FIRST ARG REG                    04600021
RPARAM   EQU   3                       USER PARAM LIST                  04700021
RATL     EQU   4                       ATTENTION LEVEL ADR              04800021
RINFO    EQU   4                       ADD INFO REG                     04900021
RGTMCB   EQU   5                       GTMCB ADR                        05000021
RKEY     EQU   5                       KEY TABLE ADR REG                05100021
RPFA     EQU   5                       PF REG                           05200021
RANA     EQU   6                       A/N REG                          05300021
RGSPCB   EQU   6                       GSPCB ADR                        05400021
RKEYEN   EQU   6                       PRESENT KEY ENTRY ADR REG        05500021
RA       EQU   7                       WORK REG A                       05600021
RGDSCB   EQU   7                       GDSCB ADR                        05700021
RB       EQU   8                       WORK REG B                       05800021
RWORKE   EQU   8                       WORK REG E                       05900021
RBASE    EQU   9                       BASE REGISTER                    06000021
RC       EQU   10                      WORK REG C                       06100021
RWORKF   EQU   10                      WORK REG F                       06200021
RD       EQU   11                      WORK REG D                       06300021
RWORKC   EQU   11                      WORK REG                         06400021
RE       EQU   12                      WORK REG E                       06500021
RWORKD   EQU   12                      WORK REG                         06600021
RSAVE    EQU   13                      SAVE AREA REG                    06700021
RWORKA   EQU   14                      WORK REG                         06800021
R14      EQU   14                  RETURN REG               D11 ZA15437 06820003
RWORKB   EQU   15                      WORK REG                         06900021
R15      EQU   15                  EP REG                   D11 ZA15437 06920003
ADD0     EQU   0                       ADD INFO 0                       07000021
ADD1     EQU   1                       ADD INFO 1                       07100021
ADD2     EQU   2                       ADD INFO 2                       07200021
ADD3     EQU   3                       ADD INFO 3                       07300021
ADD4     EQU   4                       ADD INFO 4                       07400021
ADD5     EQU   5                       ADD INFO 5                       07500021
CNVRT    EQU   X'0264'             CONVERT STATAB DISPL     D11 ZA15437 07570003
AEC      EQU   X'06'                   AE                               07600021
AID      EQU   X'04'                   ATTN LEVEL ID                    07700021
ANTYPE   EQU   X'01'                   A/N END KEY                      07800021
ATN99    EQU   99                      SOURCE 99                        07900021
ATYPE    EQU   11                      ATTN TYPE                        08000021
BCTFLAG  EQU   4                       BCT FLAGS                        08100021
BFRLEN   EQU   0                       BFR LENGTH FLD                   08200021
BFRSUB   EQU   X'28'                   BFR SUBROUTINE FLAG              08300021
BPID     EQU   X'01'                   BP ID                            08400021
CANCELC  EQU   X'05'                   CANCEL                           08500021
CCTA     EQU   6                       CHARACTER COUNT IN KEY           08520021
CCTB     EQU   5                       CHARACTER COUNT IN KEY           08540021
CCTC     EQU   8                       COUNT SHIFT VALUE                08560021
CNT      EQU   2                       CNT FLD                          08600021
CNTA     EQU   X'FF'                   COUNT FLD VALUE                  08700021
CORVAL   EQU   8                       CORVAL FLD                       08800021
DE       EQU   X'02'                   DIRECT ENTRY FLAG                08900021
DEQUEUE  EQU   X'04'                   DEQUEUE DATA OPTION              09000021
DIV256   EQU   8                       DIVIDE BY 256                    09100021
ENDC     EQU   X'01'                   END                              09200021
ENDTABLE EQU   8                       END OF TABLE                     09300021
ENTRYLEN EQU   12                      ENTRY LENGTH                     09400021
EOSC     EQU   X'04'                   EOS                              09500021
EOSRST   EQU   X'40'                   RESTART OPT FOR EOS              09600021
EOSXY    EQU   X'80'                   XY OPT FOR EOS                   09700021
EQUIV    EQU   X'08'                   EQUIVALENT GDS FALS              09750021
FIRSENT  EQU   12                      ADR OF 1ST KEY TBL ENTRY         09800021
GACBAN   EQU   12                      OFFSET TO A/N                    09900021
GACBOFF  EQU   8                       OFFSET TO START OF GACB          10000021
GACBPF   EQU   8                       OFFSET TO PF                     10100021
GACBRST  EQU   45                      OFFSET TO RESTART BYTE           10200021
GDOA     EQU   6                       GDOA ADJUSTMENT                  10300021
HIBIT    EQU   X'20'                   HI ORDER BIT                     10350021
IDVAL    EQU   X'80'                   FULL SEGMENT ID+1           0935 10400021
INBFR    EQU   X'80'                   EQUIV GDS IS IN BUFFER FLAG      10450021
IOK      EQU   X'7F'                   I/O SUCCESSFULL                  10470021
KEYNUM   EQU   10                      KEY NUMBER                       10500021
LAST     EQU   X'80'                   LAST PARAMETER                   10600021
LOGSTRT  EQU   2                       LOGICAL START FLD                10700021
LPC      EQU   X'03'                   LP                               10800021
LPCHAR   EQU   X'10'                   LP CHARACTER BIT                 10900021
LPCHRMD  EQU   X'20'                   CHARACTER MODE                   11000021
LPSTART  EQU   X'08'                   LP RESTART BIT                   11100021
LPXY     EQU   X'20'                   LP XY POS BIT                    11200021
LVL2     EQU   X'10'                   LEVEL 2 GDSCB                    11300021
MUL256   EQU   8                       MULTIPLY BY 256                  11400021
NEG      EQU   X'80'                   NEGATIVE VALUE                   11500021
NEXT     EQU   4                       NEXT SOURCE                      11600021
NEXTENTY EQU   4                       ADR OF NEXT ENTRY                11700021
NEXTKEY  EQU   0                       ADR OF NEXT KET TBL              11800021
OFFSAVE  EQU   8                       SAVE AREA CHAIN                  11900021
ONE      EQU   1                       ONE                              12000021
ORGEN    EQU   X'38'                   ORGEN KEY CODE                   12050021
OVLY     EQU   9                       OVERLAY CODE                     12100021
PENDET   EQU   X'01'                   PEN DETECT BIT                   12200021
PFC      EQU   X'02'                   RF                               12300021
PFTYPE   EQU   X'02'                   PF TYPE                          12400021
PTR      EQU   1                       PTR FLD                          12500021
RCC4     EQU   X'08'                   RETURN CODE 4                    12600021
RCC5     EQU   X'04'                   I/O ERROR                        12650021
RC4      EQU   16                      OFFSET TO RC4                    12700021
REQSRCH  EQU   X'80'                   REQATN SEARCHING QUEUE           12800021
RSTON    EQU   X'01'                   RESTART YES VALUE                12900021
RSVDA    EQU   8                       START OF DATA AREA               13000021
SCAN1    EQU   1                       VALUE OF 1                       13100021
SCAN2    EQU   2                       VALUE OF 2                       13200021
SEQNCE   EQU   X'20'                   SEQUENCE FLAG                    13300021
SOURCE99 EQU   99                      ATTN SOURCE 99                   13400021
TOBIT    EQU   X'18'                   SUBROUTINE LINKAGE               13450021
TWO      EQU   2                       TWO                              13500021
ZERO     EQU   0                       ZERO                             13600021
BSCSPC   EQU   56                  BASIC CHAR SPACING            A37965 13610000
LRGSPC   EQU   84                  LARGE CHAR SPACING            A37965 13620000
BSCSZE   EQU   X'0A'               MASK FOR BASIC SIZE CHARS     A37965 13630000
LRGSZE   EQU   X'05'               MASK FOR LARGE SIZE CHARS     A37965 13640000
NOSCISS  EQU   X'10'               MASK FOR 'NO SCISSORING'      A37965 13650000
XSCREEN  EQU   4092                MAX X FOR CHAR CENTER         A37965 13660000
YSCREEN  EQU   4092                MAX Y FOR CHAR CENTER         A37965 13670000
BSCLINE  EQU   80                  BASIC LINE SPACING            A37965 13680000
LRGLINE  EQU   120                 LARGE LINE SPACING            A37965 13690000
YLOWER   EQU   0                   MIN Y FOR CHAR CENTER         A37965 13700000
         SAVE  (14,12)                 SAVE REGISTERS                   13800021
         BALR  RBASE,0                 SET UP BASE REGISTER             13900021
         USING *,RBASE                 DEFINE BASE REG                  14000021
         LR    RLIST,REG1              SAVE INPUT PARAMETER             14100021
         USING WORKAREA,RLIST          DEFINE DSECT                     14200021
         L     RPARAM,PARAM            LOAD ADR USER PARAM LIST         14300021
         USING PLIST,RPARAM            DEFINE DSECT                     14400021
         ST    RSAVE,SAVE+4            SAVE-SAVE AREA PTR               14500021
         LA    RD,SAVE                 LOAD ADR OF MY SAVE AREA         14600021
         ST    RD,OFFSAVE(RSAVE)       STORE IN USER SAVE AREA          14700021
         LA    RSAVE,SAVE              * AREAS                          14800021
         L     RWORKA,RCA              LOAD RETURN CODE ARRAY ADR       14900021
         XC    ZERO(20,RWORKA),ZERO(RWORKA) ZERO ARRAY                  15000021
         B     AROUND                  BRANCH                           15100021
ERROR    L     RWORKA,RCA              LOAD RTN CODE ARRAY ADR          15200021
         STC   RWORKB,ZERO(RWORKA)     STORE RETURN CODE                15300021
         ST    RWORKC,ZERO(RWORKD,RWORKA) STORE ADD INFO AT PROPER      15400021
*                                         OFFSET                        15500021
OUTRTN   L     RSAVE,SAVE+4            RESTORE OLD SAVE AREA PTR        15600021
         RETURN (14,12),T              RETURN TO CALLER                 15700021
AROUND   TM    ATNLVL,LAST             LAST PARAM                       15800021
         BC    14,REQ01                BRANCH IF NO                     15900021
REQ02    LA    RWORKC,ADD0             LOAD ADD INFO                    16000021
REQ03    LA    RWORKB,RCC4             LOAD RETURN CODE                 16100021
         LA    RWORKD,RC4              LOAD OFFSET                      16200021
         B     ERROR                   BRANCH                           16300021
REQ01    L     RATL,ATNLVL             LOAD INDIRECT PTR TO ATTN LEVEL  16400021
         L     RATL,ZERO(RATL)         LOAD ATTN LEVEL ADR              16500021
         USING ATTNLEVL,RATL           DEFINE DSECT                     16600021
         CLI   ATTNLVID+1,AID          IS THIS VALID ATTN LEVEL         16700021
         BNE   REQ40                   BRANCH IF NO                     16800021
         LR    RWORKD,RATL             SAVE REG                         16900021
REQ06    CLI   ATTNBPID,BPID           THIS LEVEL POINT TO GTMCB        17000021
         BNE   REQ04                   BRANCH IF NO                     17100021
         L     RGTMCB,ATTNBKPT         LOAD GTMCB ADR                   17200021
         USING GTMCB,RGTMCB            DEFINE DSECT                     17300021
         LR    RATL,RWORKD             RESTORE REG                      17400021
         B     REQ05                   BRANCH                           17500021
REQ04    L     RATL,ATTNBKPT           LOAD ADR NEXT HIGHER LEVEL       17600021
         B     REQ06                   BRANCH                           17700021
REQ05    L     RGSPCB,GTMGSPCB         LOAD GSPCB ADR                   17800021
         USING GSPCB,RGSPCB            DEFINE DESECT                    17900021
         TM    CODELOC,LAST            IS THIS LAST PARAM               18000021
         BC    1,REQ02                 BRANCH IF YES                    18100021
         B     REQ07                   BRANCH                           18200021
REQ08    LA    RWORKC,ADD2             LOAD ADD INFO                    18300021
         B     REQ03                   BRANCH                           18400021
REQ07    CLC   CODELOC(4),GSPNULLV     IS THIS ADR OF NULL              18500021
         BE    REQ08                   BRANCH IF YES                    18600021
         CLC   CODELOC(4),ZERO1        CODE LOC ADR = ZERO              18700021
         BE    REQ08                   BRNANCH IF YES                   18800021
         TM    SCANWAIT,LAST           IS THIS THE LAST PARAM           18900021
         BC    1,REQ02                 BRANCH IF YES                    19000021
         B     REQ09                   BRANCH                           19100021
REQ10    LA    RWORKC,ADD3             LOAD ADR INFO                    19200021
         B     REQ03                   BRANCH                           19300021
REQ09    CLC   SCANWAIT(4),GSPNULLV    IS THIS ADR OF NULL              19400021
         BE    REQ10                   BRANCH IF YES                    19500021
         L     RWORKC,SCANWAIT         LOAD ADR OF SCANWAIT             19600021
         L     RWORKC,ZERO(RWORKC)     LOAD SCAN WAIT VALUE             19700021
         LA    RWORKD,SCAN1            LOAD CONSTANT                    19800021
         CLR   RWORKC,RWORKD           SCANWAIT=1                       19900021
         BE    REQ11                   BRANCH IF YES                    20000021
         LA    RWORKD,SCAN2            LOAD CONSTANT                    20100021
         CLR   RWORKC,RWORKD           SCAN WAIT=2                      20200021
         BNE   REQ10                   BRANCH IF NOT=2                  20300021
REQ11    TM    ARRAY,LAST              LAST PARAMETER                   20400021
         BC    1,REQ02                 BRANCH IF YES                    20500021
         B     REQ41                   BRANCH                           20600021
REQ13    LA    RWORKC,ADD4             LOAD ADD INFO                    20700021
         B     REQ03                   BRANCH                           20800021
REQ41    CLC   ARRAY(4),ZERO1          ARRAY ADR ZERO                   20900021
         BE    REQ13                   BRANCH IF YES                    21000021
REQ12    L     RWORKC,ATNSRCE          LOAD 1ST ATTN SOURCE ARG ADR     21100021
         LA    RWORKC,ZERO(RWORKC)     ZERO HI ORDER BYTE               21200021
         L     RWORKC,ZERO(RWORKC)     LOAD 1ST ATTN SOURCE ARG         21300021
         LA    RWORKD,SOURCE99         LOAD CONSTANT                    21400021
         CLR   RWORKC,RWORKD           IS ATTN SOURCE = 99              21500021
         BNE   REQ14                   BRANCH IF NO                     21600021
         TM    ATNSRCE,LAST            ONLY ATTN SOURCE ARG             21700021
         BC    1,REQ15                 BRANCH IF YES                    21800021
REQ16    LA    RWORKC,ADD5             LOAD ADD INFO                    21900021
         B     REQ03                   BRANCH                           22000021
REQ15    TM    ATTNFLGA,DE             ARE WE IN DIRECT ENTRY           22100021
         BC    1,REQ16                 BRANCH IF YES                    22200021
         B     ATTN99                  BRANCH TO PROCESS SOURCE 99      22300021
REQ14    BAL   RWORKA,CONVERTA         BRANCH TO ATTNSOURCE CONVERSION  22400021
         LTR   RWORKB,RWORKB           RC=0                             22500021
         BC    8,REQ17A                BRANCH IF YES                    22600021
         LR    RWORKC,RWORKB           LOAD ADD INFO                    22700021
         B     REQ03                   BRANCH                           22800021
REQ17A   ST    REG0,ANMASK             SAVE AN MASK                     22900021
         ST    REG1,PFMASK             SAVE PF MASK                     23000021
         NC    ANMASK(4),ATTNANEN      DELETE ANY ATTN SOURCES-         23100021
         NC    PFMASK(4),ATTNPFEN      NOT PREVIOUSLY ENABLED           23200021
         CLC   ANMASK(4),ZERO1         ANY SOURCES ENABLED              23300021
         BNE   REQ800                  BRANCH-YES                       23400021
         CLC   PFMASK(4),ZERO1         ANY SOURCES ENABLED              23500021
         BE    REQ62                   BRANCH-NO                        23600021
REQ800   EQU   *                                                        23700021
         L     RGDSCB,GTMGDSCB         LOAD ADR OF 1ST GDSCB            23800021
         USING GDSCB,RGDSCB            DEFINE DSECT                     23900021
REQ17    TM    ATTNFLGA,DE             ARE WE IN DIRECT ENTRY           24000021
         BC    1,DIRECT                BRANCH IF YES                    24100021
         B     NTDIRECT                BRANCH TO NOT DIRECT ENTRY       24200021
ATTN99   XC    ATTNAECB(4),ATTNAECB    CLEAR SOURCE 99 ECB              24300021
         CLI   ATTNSETA,ATN99          DATA AVAILABLE                   24400021
         BNE   REQ34                   BRANCH IF NO                     24500021
REQ39    L     RWORKA,ARRAY            LOAD ARRAY ADR                   24600021
         L     RWORKB,GSPNULLV         LOAD NULL ADR                    24700021
         CLR   RWORKA,RWORKB           IS THERE AN ARRAY                24800021
         BE    REQ35                   BRANCH IF NO                     24900021
         MVC   ZERO(8,RWORKA),ATTNSETA+4 MOVE DATA TO ARRAY             25000021
REQ35    XC    ATTNSETA(12),ATTNSETA   CLEAR DATA AREA                  25100021
         LA    RWORKB,ATN99            LOAD VALUE                       25200021
REQ36    L     RWORKA,CODELOC          LOAD CODELOC ADR                 25300021
         ST    RWORKB,ZERO(RWORKA)     STORE CODE LOC                   25400021
         B     OUTRTN                  RETURN TO CALLER                 25500021
REQ34    L     RWORKA,SCANWAIT         LOAD PTR TO SCAN WAIT            25600021
         CLC   SCANTWO(4),ZERO(RWORKA) IS A WAIT REQUESTED              25700021
         BE    REQ37                   BRANCH IF YES                    25800021
         SR    RWORKB,RWORKB           CLEAR REG                        25900021
         B     REQ36                   BRANCH                           26000021
REQ37    CLC   ATTNFWPT(4),ZERO1       IS LEVEL ACTIVE                  26100021
         BE    REQ38                   BRANCH IF YES                    26200021
         SR    RWORKC,RWORKC           ADD INFO=0                       26300021
         B     REQ03                   BRANCH                           26400021
REQ38    LA    REG1,ATTNAECB           LOAD ADR OF ECB                  26500021
         WAIT  ECB=(1)                                                  26600021
         B     REQ39                   BRANCH                           26700021
REQ40    LA    RWORKC,ADD1             LOAD ADD INFO CODE               26800021
         B     REQ03                   BRANCH                           26900021
CONVERTA SAVE  (2,12)                  SAVE REGS                        27000021
         LA    RSOURCE,ATNSRCE         LOAD ADR OF 1ST ARG              27100021
         LA    RFIRST,NEXT             INDICATE 1ST ARG                 27200021
         SR    RPFA,RPFA               CLEAR PF REG                     27300021
         SR    RANA,RANA               CLEAR A/N REG                    27400021
         LA    RINFO,ADD5              LOAD 1ST ADD INFO CODE           27500021
         B     REQ18                   BRANCH                           27600021
REQOK    SR    RWORKB,RWORKB           ZERO RETURN CODE                 27700021
         LR    REG0,RANA               LOAD A/N MASK                    27800021
         LR    REG1,RPFA               LOAD P/F MASK                    27900021
         B     REQ19                   BRANCH                           28000021
REQERR   LR    RWORKB,RINFO            LOAD RETURN CODE                 28100021
REQ19    RETURN (2,12)                 RETURN                           28200021
REQ18    L     RC,ZERO(RSOURCE)        LOAD ADR OF ARG                  28300021
         TM    ZERO(RC),NEG            ARG NEGATIVE                     28400021
         BC    1,REQNEG                BRANCH IF NEG                    28500021
         L     RB,ZERO(RC)             LOAD VALUE OF ARG                28600021
REQ24    CL    RB,MAX                  VALUE GREATER THAN ALLOWABLE     28700021
         BC    2,REQERR                BRANCH IF YES                    28800021
REQ23    CL    RB,ANSIZE               VALUE GREATER THAN 31            28900021
         BC    2,REQ20                 BRANCH IF YES                    29000021
         L     RE,PRIME                PRIME REG                        29100021
         SRL   RE,ZERO(RB)             POSITION BIT                     29200021
         OR    RPFA,RE                 ADD TO PF MASK                   29300021
REQ26    TM    ZERO(RC),NEG            ARG NEG                          29400021
         BC    1,REQ21                 BRANCH IF YES                    29500021
REQ22    TM    ZERO(RSOURCE),LAST      MORE ARGS                        29600021
         BC    1,REQOK                 BRANCH IF NO                     29700021
         L     RA,ZERO(RC)             SAVE VALUE PRESENT ARG           29800021
         LA    RSOURCE,NEXT(RSOURCE)   STEP TO NEXT ARG                 29900021
         SR    RFIRST,RFIRST           INDICATE NOT 1ST ARG             30000021
         LA    RINFO,ONE(RINFO)        INCREMENT ADD INFO               30100021
         B     REQ18                   BRANCH TO MORE ARGS              30200021
REQ21    LA    RE,ONE                  LOAD CONSTANT                    30300021
         SR    RB,RE                   DECREMENT ARG BY 1               30400021
         CLR   RA,RB                   VALUE=PREVIOUS VALUE             30500021
         BE    REQ22                   BRANCH IF YES                    30600021
         B     REQ23                   BRANCH                           30700021
REQNEG   LTR   RFIRST,RFIRST           FIRST ARG                        30800021
         BC    7,REQERR                BRANCH IF YES                    30900021
         LTR   RA,RA                   PREV ARG NEG                     31000021
         BC    4,REQERR                BRANCH IF YES                    31100021
         L     RB,ZERO(RC)             LOAD VALUE OF ARG                31200021
         LPR   RB,RB                   MAKE ARG POS                     31300021
         CLR   RB,RA                   VALUE GREATER THAN PREV ARG      31400021
         BC    2,REQ24                 BRANCH IF YES                    31500021
         B     REQERR                  BRANCH                           31600021
REQ20    LA    RD,END                  LOAD ADR OF CONSTANT             31700021
         LA    RE,ONE                  LOAD CONSTANT                    31800021
REQ27    CL    RB,ZERO(RD)             COMPARE                          31900021
         BE    REQ25                   BRANCH IF YES                    32000021
         SLL   RE,ONE                  SHIFT BIT                        32100021
         LA    RD,NEXT(RD)             LOAD NEXT CONSTANT ADR           32200021
         B     REQ27                   BRANCH                           32300021
REQ25    OR    RANA,RE                 ADD BIT TO MASK                  32400021
         B     REQ26                   BRANCH                           32500021
NTDIRECT CLC   ATTNMLEN,ZERO1          ANY DATA                         32600021
         BNE   REQ50                   BRANCH IF YES                    32700021
REQ53    CLC   ATTNFWPT,ZERO1          IS LEVEL ACTIVE                  32800021
         BE    REQ51                   BRANCH IF YES                    32900021
         L     RWORKC,SCANWAIT         LOAD PTR TO SCANWAIT             33000021
         CLC   SCANTWO(4),ZERO(RWORKC) IMMEDIATE RETURN WANTED          33100021
         BNE   REQ52                   BRANCH IF YES                    33200021
REQ62    LA    RWORKC,ADD0             LOAD ADD INFO                    33300021
         B     REQ03                   BRANCH                           33400021
REQ52    L     RWORKC,CODELOC          LOAD ADR OF CODE LOC             33500021
         SR    RWORKD,RWORKD           CLEAR REG                        33600021
         ST    RWORKD,ZERO(RWORKC)     CODE LOC=0                       33700021
         B     OUTRTN                  BRANCH                           33800021
REQ50    L     RWORKA,ATTNMLEN         LOAD ADR OF 1ST ENTRY            33900021
         SR    RWORKF,RWORKF           ZERO REG                         34000021
REQ57    CLI   ATYPE(RWORKA),PFTYPE    PF ATTN                          34100021
         BE    REQ54                   BRANCH IF YES                    34200021
         LA    RWORKB,ONE              PRIME REG                        34300021
         CLI   ATYPE(RWORKA),ANTYPE    END KEY ATTN                     34400021
         BE    REQ55                   BRANCH IF YES                    34500021
         SR    RWORKC,RWORKC           CLEAR REG                        34600021
         IC    RWORKC,ATYPE(RWORKA)    INSERT ATTN TYPE                 34700021
         LA    RWORKD,TWO              LOAD CONSTANT                    34800021
         SR    RWORKC,RWORKD           DETERMINE SHIFT CONSTANT         34900021
         SLL   RWORKB,ZERO(RWORKC)     POSITION BIT                     35000021
REQ55    N     RWORKB,ANMASK           DETERMINE IF MATCH               35100021
         LTR   RWORKB,RWORKB           WAS THERE A MATCH                35200021
         BC    7,REQ56                 BRANCH IF YES                    35300021
REQ58    LR    RWORKF,RWORKA           SAVE ADR                         35400021
         L     RWORKA,ZERO(RWORKA)     LOAD PTR TO NEXT ENTRY           35500021
         LTR   RWORKA,RWORKA           ANY MORE ENTRIES                 35600021
         BC    7,REQ57                 BRANCH IF YES                    35700021
         B     REQ53                   BRANCH                           35800021
REQ54    L     RWORKB,PRIME            PRIME PF REG                     35900021
         SR    RWORKC,RWORKC           CLEAR REG                        36000021
         IC    RWORKC,KEYNUM(RWORKA)   INSERT KEY NUMBER                36100021
         SRL   RWORKB,ZERO(RWORKC)     POSITION BIT                     36200021
         N     RWORKB,PFMASK           DETERMINE IF A MATCH             36300021
         LTR   RWORKB,RWORKB           WAS THERE A MATCH                36400021
         BC    8,REQ58                 BRANCH IF NO                     36500021
REQ56    MVC   RSVD(12),RSVDA(RWORKA)  MOVE DATA TO WORK AREA           36600021
         CLC   ATTNFWPT(4),ZERO1       LEVEL ACTIVE                     36700021
         BE    REQ1A                   BRANCH IF LEVEL ACTIVE           36800021
         LR    REG0,RWORKF             SAVE REG                         36900021
         LR    REG1,RWORKA             SAVE REG                         37000021
         TM    ATTNFLGA,DEQUEUE        MAY WE DEQUEUE FROM AN INACTIVE  37100021
*                                      LEVEL                            37200021
         BO    REQ60                   BRANCH IF NO                     37300021
REQ1A    EQU   *                                                        37400021
         LTR   RWORKF,RWORKF           1ST ENTRY                        37500021
         BC    8,REQ59                 BRANCH IF YES                    37600021
         MVC   ZERO(4,RWORKF),ZERO(RWORKA) DEQUEUE ENTRY                37700021
         B     REQ61                   BRANCH                           37800021
REQ59    MVC   ATTNMLEN(4),ZERO(RWORKA) DEQUEUE ENTRY                   37900021
REQ61    MVC   ZERO(4,RWORKA),ATTNAVAL  * ADD ENTRY TO                  38000021
         ST    RWORKA,ATTNAVAL          * AVAILABLE LIST                38100021
         B     REQ60                   BRANCH                           38200021
REQ51    SR    RWORKC,RWORKC           CLEAR REG                        38300021
         O     RWORKC,ATTNPFEN         ADD ENABLED PF KEYS FOR LEVEL    38400021
         O     RWORKC,PFMASK           ADD REQUESTED SOURCES            38500021
         X     RWORKC,ATTNPFEN         TEST IF REQUEST VALID            38600021
         LTR   RWORKC,RWORKC           REQUEST VALID                    38700021
         BC    7,REQ62                 BRANCH IF NO                     38800021
         O     RWORKC,ATTNANEN         ADD ENABLED A/N SOURCES FOR LVL  38900021
         O     RWORKC,ANMASK           ADD REQUESTED SOURCES            39000021
         X     RWORKC,ATTNANEN         DETERMINE IF VALID REQUEST       39100021
         LTR   RWORKC,RWORKC           VALID REQUEST                    39200021
         BC    7,REQ62                 BRANCH IF NO                     39300021
         L     RWORKC,GTMGACBA         LOAD PTR TO GACB                 39400021
         LA    RWORKC,GACBOFF(RWORKC)  LOAD PTR TO TRUE START OF GACB   39500021
         MVC   SAVE1(4),GACBAN(RWORKC) SAVE A/N MASK                    39600021
         MVC   SAVE2(4),GACBPF(RWORKC) SAVE P/F MASK                    39700021
         MVC   GACBAN(4,RWORKC),ANMASK MOVE IN A/N REQUEST              39800021
         MVC   GACBPF(4,RWORKC),PFMASK MOVE IN PF REQUEST               39900021
         XC    GACB(12),GACB           CLEAR MACRO AREA                 40000021
         L     RWORKA,SCANWAIT         LOAD PTR TO SCAN WAIT            40100021
         CLC   SCANTWO(4),ZERO(RWORKA) IMMEDIATE RETURN WANTED          40200021
         BNE   REQ63                   BRANCH IF YES                    40300021
         XC    LFORM(64),LFORM          ZERO LIST                  000A 40700021
         ATTNINQ (11),MODE=W,TYP=ANY,MF=(E,LFORM)                  000A 41100021
REQ66    MVC   GACBAN(4,RWORKC),SAVE1  RESTORE MASK                     41600021
         MVC   GACBPF(4,RWORKC),SAVE2  RESTORE MASK                     41700021
         L     RWORKD,ZERO(RWORKC)     LOAD COMAREA ADR                 41800021
         MVC   RSVD(12),ZERO(RWORKD)   DATA TO WORK AREA                41900021
         B     REQ60                   BRANCH                           42000021
REQ63    EQU   *                                                        42100021
         XC    LFORM(64),LFORM          ZERO LIST                  000A 42600021
         ATTNINQ (11),MODE=(C,REQ65),TYP=ANY,MF=(E,LFORM)          000A 43100021
         MVC   GACBAN(4,RWORKC),SAVE1  RESTORE MASK                     43600021
         MVC   GACBPF(4,RWORKC),SAVE2  RESTORE MASK                     43700021
         B     REQ52                   BRANCH                           43800021
REQ65    B     REQ66                   BRANCH                           43900021
REQ60    CLI   TYPE,LPC                LIGHT PEN                        44000021
         BE    REQ70                   BRANCH IF YES                    44100021
         CLI   TYPE,EOSC               EOS ATTN                         44200021
         BNE   REQ100                  BRANCH IF NO                     44300021
         CLC   ATTNFWPT(4),ZERO1       LEVEL ACTIVE                     44400021
         BE    REQ71                   BRANCH IF YES                    44500021
         XC    XPOS(4),XPOS            ENSURE XY=0                      44600021
         B     REQ101                  BRANCH                           44700021
REQ71    TM    ATTNFLGA,EOSXY          XY READ OUT WANTED               44800021
         BC    1,REQ72                 BRANCH IF YES                    44900021
REQ73    TM    ATTNFLGA,EOSRST         RESTART WANTED                   45000021
         BC    1,REQ74                 BRANCH IF YES                    45100021
         B     REQ101                  BRANCH                           45200021
REQ72    XC    DECB(36),DECB           CLEAR I/O AREA                   45300021
         XC    XPOS(4),XPOS            CLEAR DATA AREA                  45400021
         L     RWORKC,GTMGRDCB         LOAD DCB ADR                     45500021
         LA    RWORKD,XPOS             LOAD DATA AREA ADR               45600021
         LA    REG1,DECB               LOAD ADR OF PARAM LIST           45700021
         GREADR (1),XYP,(11),(12),MF=E                                  45800021
         WAIT  ECB=(1)                                                  45900021
         BAL   REG1,IOTEST             TO TEST I/O                      45950021
         B     REQ73                   BRANCH                           46000021
REQ74    XC    DECB(36),DECB           CLEAR I/O AREA                   46100021
         LA    RWORKC,SENSE+2          LOAD RESTART ADR                 46200021
         L     RWORKD,GTMGRDCB         LOAD DCB ADR                     46300021
         LA    REG1,DECB               LOAD DECB ADR                    46400021
         GCNTRL (1),STR,(12),(11),MF=E                                  46500021
         WAIT  ECB=(1)                                                  46600021
         BAL   REG1,IOTEST             TO TEST I/O                      46650021
         B     REQ101                  BRANCH                           46700021
REQ70    SR    RWORKC,RWORKC           CLEAR REG                        46800021
         LH    RWORKC,SENSE+2          LOAD BFR ADR                     46900021
         SRL   RWORKC,DIV256           DIVIDE NUMBER BY 256             47000021
         SR    RWORKF,RWORKF           CLEAR REG                        47100021
         M     RWORKF,THREE            MULTIPLY #  BY 3  RESULT=RWORKC  47200021
         L     RWORKF,GTMBCTBL         LOAD ADR OF BCT                  47300021
         LTR   RWORKF,RWORKF           IS THERE A BFR CONTROL TBL       47400021
         BC    8,REQ79                 BRANCH IF NO                     47500021
         AR    RWORKC,RWORKF           DETERMINE ADR OF BCT ENTRY       47600021
         LR    RWORKA,RWORKC           LOAD REG                         47700021
         CLC   ZERO(1,RWORKA),ZERO1    IS AN ID ASSIGNED                47800021
         BE    REQ79                   BRANCH IF NO ID                  47900021
         CLI   ZERO(RWORKA),IDVAL      IS A FULL SEGMENT ASSIGNED       48000021
         BC    4,REQ75                 BRANCH IF A FULL SEGMENT         48100021
         SR    RWORKC,RWORKC           CLEAR REG                        48200021
         SR    RWORKF,RWORKF           CLEAR REG                        48300021
         LH    RWORKC,SENSE+2          LOAD DIVIDEND                    48400021
         D     RWORKF,DIV256A          DIVIDE BY 256 RWORKF=REMAINDER   48500021
         CL    RWORKF,SUBSEG           UPPER OR LOWER HALF              48600021
         BC    4,REQ76                 BRANCH LOWER SEGMENT             48700021
         CLI   ZERO+ONE(RWORKA),IDVAL  SUB SEG ASSIGNED                 48800021
         BE    REQ79                   BRANCH IF NO                     48900021
         MVC   IDBYTE(1),ONE(RWORKA)   SAVE ID                          49000021
         B     REG755                                              7172 49100021
REQ76    CLI   ZERO(RWORKA),IDVAL      SUB REG ASSIGNED                 49200021
         BE    REQ79                   BRANCH IF NO                     49300021
REQ75    MVC   IDBYTE(1),ZERO(RWORKA)  SAVE ID                          49400021
REG755   L     RGDSCB,GTMGDSCB     GET NEXT REQUEST BLOCK          7172 49450021
REQ77    CLC   GDSBCTID(1),IDBYTE      GDS=MY ID                        49500021
         BE    REQ78                   BRANCH IF YES                    49600021
REQ80    EQU   *                                                        49650021
         CLC   GDSNXGDS(4),ZERO1       ANY MORE GDS                     49700021
         BE    REQ79                   BRANCH IF NO                     49800021
         L     RGDSCB,GDSNXGDS         LOAD ADR OF NEXT GDS             49900021
         B     REQ77                   BRANCH                           50000021
REQ78    EQU   *                                                        50010021
         TM    GDSFLAGS,EQUIV          IS THIS AN EQUIVALENT GDS        50020021
         BC    14,REQ81                BRANCH-NO                        50030021
         TM    GDSFLAGS,INBFR          GDS IN BFR                       50040021
         BO    REQ81                   BRANCH-YES                       50050021
         B     REQ80                   BRANCH                           50060021
REQ81    EQU   *                                                        50070021
         TM    GDSFLAGS,PENDET         LIGHT PEN DETECT ENABLED         50130021
         BC    1,REQ700                BRANCH IF YES                    50200021
         CLC   ATTNFWPT(4),ZERO1       LEVEL ACTIVE                     50300021
         BE    REQ79                   BRANCH IF LEVEL ACTIVE           50400021
         TM    ATTNFLGA,DEQUEUE        MAY WE DEQUEUE FROM AN INACTIVE  50500021
*                                      LEVEL                            50600021
         BC    14,NTDIRECT             BRANCH IF YES                    50700021
         LR    RWORKF,REG0             RESTORE REG                      50800021
         LR    RWORKA,REG1             RESTORE REG                      50900021
         LTR   RWORKF,RWORKF           1ST ENTRY                        51000021
         BZ    REQ59A                  BRANCH IF YES                    51100021
         MVC   ZERO(4,RWORKF),ZERO(RWORKA) DEQUEUE ENTRY                51200021
         B     REQ61A                  BRANCH                           51300021
REQ59A   MVC   ATTNMLEN(4),ZERO(RWORKA) DEQUEUE ENTRY                   51400021
REQ61A   MVC   ZERO(4,RWORKA),ATTNAVAL * ADD ENTRY TO                   51500021
         ST    RWORKA,ATTNAVAL         * AVAILABLE LIST                 51600021
         B     NTDIRECT                BRANCH                           51700021
REQ79    L     RWORKD,GTMGACBA         LOAD PTR TO GSP GACB             51800021
         LA    RWORKD,GACBOFF(RWORKD)  LOAD TRUE START GACB ADR         51900021
         CLI   GACBRST(RWORKD),RSTON   LP RESTART FLAG ON               52000021
         BE    NTDIRECT                BRANCH IF YES                    52100021
         XC    DECB(32),DECB           CLEAR I/O AREA                   52200021
         LA    REG1,DECB               LOAD ADR OF DECB                 52300021
         L     RWORKC,GTMGRDCB         LOAD DCB ADR                     52400021
         LA    RWORKD,SENSE+2          LOAD RESTART ADR PTR             52500021
         GCNTRL (1),STR,(11),(12),MF=E                                  52600021
         WAIT  ECB=(1)                                                  52700021
         BAL   REG1,IOTEST             TO TEST I/O                      52750021
         B     NTDIRECT                BRANCH                           52800021
REQ700   TM    ATTNFLGA,LPCHAR         CHARACTER WANTED                 52900021
         BC    14,REQ102               BRANCH IF NO                     53000021
         CLC   ATTNFWPT(4),ZERO1       LEVEL ACTIVE                     53100021
         BNE   REQ701                  BRANCH IF NOT ACTIVE             53200021
         TM    SENSE+1,LPCHRMD         LP IN CHARACTER MODE             53300021
         BC    14,REQ701               BRANCH IF NOT CHARACTER MODE     53400021
         XC    DECB(32),DECB           CLEAR I/O AREA                   53500021
         LA    REG1,DECB               LOAD ADR OF I/O AREA             53600021
         L     RWORKF,GTMGRDCB         LOAD DCB ADR                     53700021
         LA    RWORKC,CHARACTR         LOAD ADR OF DATA AREA            53800021
         LA    RWORKD,SENSE+2          LOAD ADR OF CHARACTER            53900021
         LA    RWORKE,ONE              LOAD NUMBER OF BYTES TO READ     54000021
         GREAD (1),BUF,(10),(8),(11),(12),MF=E                          54100021
         WAIT  ECB=(1)                                                  54200021
         BAL   REG1,IOTEST             TO TEST I/O                      54250021
         TM    ATTNFLGA,LPSTART        RESTART WANTED                   54300021
         BC    14,REQ102               BRANCH IF NO                     54400021
         XC    DECB(32),DECB           CLEAR I/O AREA                   54500021
         LA    REG1,DECB               LOAD ADR OF I/O AREA             54600021
         GCNTRL (1),STR,(10),(12),MF=E                                  54700021
         WAIT  ECB=(1)                                                  54800021
         BAL   REG1,IOTEST             TO TEST I/O                      54850021
         B     REQ102                  BRANCH                           54900021
REQ701   XC    CHARACTR(1),CHARACTR    CLEAR CHARACTER BYTE             55000021
         B     REQ102                  BRANCH                           55100021
REQ102   CLC   ARRAY(4),GSPNULLV       WAS AN ARRAY SPECIFIED           55200021
         BE    REQ103                  BRANCH IF NO                     55300021
         BAL   RWORKA,LPEOS            BRANCH TO ARRAY FILL IN          55400021
REQ103   L     RWORKC,CODELOC          LOAD ADR OF CODE LOC             55500021
         MVC   ZERO(4,RWORKC),LPD      CODE 34 TO CODE LOC              55600021
         B     OUTRTN                  BRANCH                           55700021
REQ101   CLC   ARRAY(4),GSPNULLV       WAS AN ARRAY SPECIFIED           55800021
         BE    REQ104                  BRANCH IF NO                     55900021
         BAL   RWORKA,LPEOS            BRANCH TO ARRAY FILL IN          56000021
REQ104   L     RWORKC,CODELOC          LOAD ADR OF CODE LOC             56100021
         MVC   ZERO(4,RWORKC),EOSD     CODE 35 TO CODE LOC              56200021
         B     OUTRTN                  BRANCH                           56300021
REQ100   L     RWORKC,CODELOC          LOAD ADR OF CODELOC              56400021
         CLI   TYPE,PFC                PF ATTN                          56500021
         BE    REQ105                  BRANCH IF YES                    56600021
         CLI   TYPE,ENDC               END KEY ATTN                     56700021
         BE    REQ106                  BRANCH IF YES                    56800021
         CLI   TYPE,AEC                AE ATTN                          56900021
         BE    REQ107                  BRANCH IF YES                    57000021
         MVC   ZERO(4,RWORKC),CANCELD  CODE 33 TO CODELOC               57100021
         B     OUTRTN                  BRANCH                           57200021
REQ106   MVC   ZERO(4,RWORKC),END      CODE 32 TO CODELOC               57300021
         B     OUTRTN                  BRANCH                           57400021
REQ107   MVC   ZERO(4,RWORKC),AED      CODE 36 TO CODELOC               57500021
         B     OUTRTN                  BRANCH                           57600021
REQ105   CLC   ARRAY(4),GSPNULLV       ARRAY SPECIFIED                  57700021
         BE    REQ108                  BRANCH IF NO                     57800021
         L     RWORKD,ARRAY            LOAD ARRAY ADR                   57900021
         SR    RWORKF,RWORKF           CLEAR REG                        58000021
         IC    RWORKF,OVERLAY          LOAD OVERLAY VALUE               58100021
         ST    RWORKF,ZERO(RWORKD)     OVERLAY CODE TO ARRAY            58200021
REQ108   SR    RWORKF,RWORKF           CLEAR REG                        58300021
         IC    RWORKF,KEYNO            LOAD KEY #                       58400021
         LTR   RWORKF,RWORKF            IS ATTN SOURCE PFK0        RSTH 58440021
         BNE   REQ109                   NO                         RSTH 58480021
         L     RWORKF,MIN1              SET CODE TO -1 FOR PFK0    RSTH 58520021
REQ109   ST    RWORKF,ZERO(RWORKC)      KEY= TO CODELOC            RSTH 58560021
         B     OUTRTN                  BRANCH                           58600021
LPEOS    L     RWORKE,ARRAY            LOAD ARRAY ADR                   58700021
         USING ARRAYUSE,RWORKE                                          58800021
         XC    W1(40),W1               CLEAR ARRAY                      58900021
         SR    RWORKC,RWORKC           CLEAR REG                        59000021
         LH    RWORKC,SENSE+2          LOAD BFR ADR                     59100021
         SRL   RWORKC,DIV256           DIVIDE BY 256                    59200021
         SR    RWORKF,RWORKF           CLEAR REG                        59300021
         M     RWORKF,THREE            MULTIPY BY 3                     59400021
         L     RWORKF,GTMBCTBL         LOAD ADR OF BCT                  59500021
         LTR   RWORKF,RWORKF           IS THERE A BFR CONTROL TBL       59600021
         BC    8,REQ500                BRANCH IF NO                     59700021
         AR    RWORKC,RWORKF           DETERMINE ADR OF BCT ENTRY       59800021
         LR    REG1,RWORKC             SAVE ADR                         59900021
         CLC   ZERO(1,REG1),ZERO1      IS AN ID ASSIGNED                60000021
         BE    REQ500                  BRANCH-NO ID                     60100021
         CLI   ZERO(REG1),IDVAL        IS A FULL SEGMENT ASSIGNED       60200021
         BC    4,REQ200                BRANCH IF YES                    60300021
         SR    RWORKC,RWORKC           CLEAR REG                        60400021
         SR    RWORKF,RWORKF           CLEAR REG                        60500021
         LH    RWORKC,SENSE+2          LOAD DIVIDEND                    60600021
         D     RWORKF,DIV256A          DIVIDE BY 256                    60700021
         CL    RWORKF,SUBSEG           UPPER OR LOWER HALF              60800021
         BC    4,REQ201                BRANCH LOWER SEGMENT             60900021
         CLI   ZERO+ONE(REG1),IDVAL    SUB SEG ASSIGNED                 61000021
         BE    REQ500                  BRANCH IF NO                     61100021
         MVC   IDBYTE(1),ONE(REG1)     SAVE ID                          61200021
         B     REQ202                  BRANCH                           61300021
REQ201   CLI   ZERO(REG1),IDVAL        SUB SEG ASSIGNED                 61400021
         BE    REQ500                  BRANCH IF NO                     61500021
REQ200   MVC   IDBYTE(1),ZERO(REG1)    SAVE ID                          61600021
REQ202   L     RGDSCB,GTMGDSCB         LOAD ADR OF FIRST GDSCB          61700021
REQ204   CLC   GDSBCTID(1),IDBYTE      GDS=MY ID                        61800021
         BE    REQ203                  BRANCH IF YES                    61900021
REQ205   EQU   *                                                        61950021
         CLC   GDSNXGDS(4),ZERO1       ANY MORE GDS                     62000021
         BE    REQ500                  BRANCH IF NO                     62100021
         L     RGDSCB,GDSNXGDS         LOAD ADR OF NEXT GDS             62200021
         B     REQ204                  BRANCH                           62300021
REQ203   EQU   *                                                        62310021
         TM    GDSFLAGS,EQUIV          IS THIS AN EQUIVALENT GDS        62320021
         BC    14,REQ206               BRANCH-NO                        62330021
         TM    GDSFLAGS,INBFR          GDS IN BFR                       62340021
         BO    REQ206                  BRANCH-YES                       62350021
         B     REQ205                  BRANCH                           62360021
REQ206   EQU   *                                                        62370021
         ST    RGDSCB,W1               GDS ADR TO WORD 1 ARRAY          62430021
         CLI   CNT(REG1),CNTA          COUNT FLD IN BCT =FF             62500021
         BNE   REQ400                  BRANCH IF NO                     62600021
         SR    RWORKC,RWORKC           CLEAR REG                        62700021
         SR    RWORKF,RWORKF           CLEAR REG                        62800021
         IC    RWORKC,PTR(REG1)        LOAD DIVIDEND                    62900021
         SLL   RWORKC,MUL256           MULTIPLY BY 256                  63000021
         SR    RWORKF,RWORKF           CLEAR REG                        63100021
         LH    RWORKF,SENSE+2          LOAD BFR ADR                     63200021
         SR    RWORKF,RWORKC           SUBTRACT RESULT FROM BFR ADR     63300021
         LA    RWORKC,TWO              LOAD CONSTANT                    63400021
         SR    RWORKF,RWORKC           DETERMINE LOGICAL DIFFERENCE     63500021
         ST    RWORKF,LOGDIF           SAVE VALUE                       63600021
         SR    RWORKF,RWORKF           CLEAR REG                        63700021
         IC    RWORKF,PTR(REG1)        LOAD PTR FROM BCT ENTRY          63800021
         MH    RWORKF,THREE+2          MULTIPLY BY THREE                63900021
         L     REG1,GTMBCTBL           LOAD BCT ADR                     64000021
         LA    REG1,ZERO(RWORKF,REG1)  HAVE BCT START ADR FOR THIS SEG  64100021
REQ402   SR    RWORKB,RWORKB           CLEAR REG                        64200021
         LH    RWORKB,GDSGDOAL         LOAD GDOA LENGTH                 64300021
         LA    RWORKC,GDOA             LOAD CONSTANT                    64400021
         SR    RWORKB,RWORKC           ADJUST GDOA LENGTH               64500021
         SR    RWORKC,RWORKC           CLEAR REG                        64600021
         IC    RWORKC,CNT(REG1)        INSERT COUNT                     64700021
         SR    RWORKF,RWORKF           CLEAR REG                        64800021
         MR    RWORKF,RWORKB           MULTIPY VALUES                   64900021
         A     RWORKC,LOGDIF           ADD LOGICAL DIFFERENCE           65000021
         ST    RWORKC,W3               STORE RESULT IN WORD 3 OF ARRAY  65100021
         ST    RWORKC,W3A              SAVE VALUE IN WORK AREA          65150021
         B     REQ401                  BRANCH                           65200021
REQ400   LR    RWORKC,REG1             ENTRY ADR TO WORK REG            65300021
         L     RWORKD,GTMBCTBL         LOAD ADR START OF BCT            65400021
         SR    RWORKC,RWORKD           DETERMINE PTR                    65500021
         SR    RWORKF,RWORKF           CLEAR REG                        65600021
         D     RWORKF,THREE            DIVIDE # BY 3                    65700021
         SLL   RWORKC,MUL256           MULTIPY RESULT BY 256            65800021
         SR    RWORKF,RWORKF           CLEAR REG                        65900021
         LH    RWORKF,SENSE+2          LOAD  BFR ADR                    66000021
         SR    RWORKF,RWORKC           SUBTRACT RESULT FROM BFR ADR     66100021
         LA    RWORKC,TWO              LOAD CONSTANT                    66200021
         SR    RWORKF,RWORKC           DETERMINE LOGICAL DIFFERENCE     66300021
         ST    RWORKF,LOGDIF           SAVE VALUE                       66400021
         B     REQ402                  BRANCH                           66500021
REQ401   TM    GDSFLAGS,LVL2           IS THIS A LEVEL 2 GDS            66600021
         BC    1,REQ500                BRANCH IF YES                    66700021
         CLC   GDSKEYTB(4),ZERO1       IS THERE A KEY TABLE             66800021
         BE    REQ500                  BRANCH IF NO                     66900021
REQ300   L     RKEY,GDSKEYTB           LOAD ADR OF FIRST KEY TABLE      67000021
REQ302   LA    RKEYEN,FIRSENT(RKEY)    LOAD ADR OF FIRST ENTRY          67100021
REQ304   CL    RKEYEN,NEXTENTY(RKEY)   IS SLOT BEING USED               67200021
         BNE   REQ301                  BRANCH IF SLOT BEING USED        67300021
         CLC   ZERO1(4),NEXTKEY(RKEY)  ANY MORE KEY TABLES              67400021
         BE    REQ500                  BRANCH IF NO MORE KEY TABLES     67500021
         L     RKEY,NEXTKEY(RKEY)      LOAD ADR OF NEXT KEY TABLE       67600021
         B     REQ302                  BRANCH                           67700021
REQ301   SR    RWORKC,RWORKC           CLEAR REG                        67800021
         LH    RWORKC,BFRLEN(RKEYEN)   LOAD BFR LENGTH                  67900021
         AH    RWORKC,LOGSTRT(RKEYEN)  ADD LOGICAL START                68000021
         CL    RWORKC,W3A              COMPARE VALUE TO GDS OFFSET VALU 68100021
         BC    2,REQ303                BRANCH IF WORD 3 VALUE LESS      68200021
         BE    REQ308                  BRANCH IF VALUES EQUAL           68250021
REQ305   LA    RKEYEN,ENTRYLEN(RKEYEN) LOAD ADR OF NEXT KEY ENTRY       68300021
         B     REQ304                  BRANCH                           68400021
REQ303   CLC   W3A+2(2),LOGSTRT(RKEYEN) COMPARE GDS OFFSET TO LOG START 68500021
         BC    4,REQ500                BRANCH IF WORD 3 LESS            68600021
         TM    BCTFLAG(RKEYEN),ORGEN   IS THIS AN ORGEN KEY             68630021
         BO    REQ307                  BRANCH-YES                       68660021
         TM    BCTFLAG(RKEYEN),BFRSUB  IS THIS A BFR SUBRTN KEY         68700021
         BC    1,REQ305                BRANCH IF BFR SURRTN KEY         68800021
         TM    BCTFLAG(RKEYEN),SEQNCE  IS THIS A SEQUENCE KEY           68900021
         BC    1,REQ306                BRANCH IF YES                    69000021
REQ307   EQU   *                                                        69050021
         MVC   W2(4),BFRLEN(RKEYEN)    KEY TO WORD 2 OF ARRAY           69100021
         MVC   W4(4),CORVAL(RKEYEN)    CORVAL TO WORD 4 OF ARRAY        69200021
         TM    SENSE+1,LPCHRMD         LP IN CHARACTER MODE             69205021
         BC    14,REQ309               BRANCH-NOT CHARACTER MODE        69210021
         LH    RWORKC,BFRLEN(RKEYEN)   LOAD BUFFER LENGTH               69215021
         AH    RWORKC,LOGSTRT(RKEYEN)  ADD LOGICAL START                69220021
         S     RWORKC,W3A              SUBTRACT GDS OFFSET              69225021
         STH   RWORKC,CCT              SAVE VALUE                       69230021
         SR    RWORKC,RWORKC           CLEAR REG                        69235021
         IC    RWORKC,CCTB(RKEYEN)     INSERT CHARACTER COUNT           69240021
         SLL   RWORKC,CCTC             SHIFT 1ST HALF OF COUNT          69245021
         IC    RWORKC,CCTA(RKEYEN)     INSERT CHARACTER COUNT           69250021
         SH    RWORKC,CCT              SUBTRACT SAVED VALUE             69255021
         LA    RWORKC,ADD1(RWORKC)     CHANGE OFFSET TO COUNT FOR ARRAY 69260021
         ST    RWORKC,W3               STORE RESULT IN ARRAY WORD 3     69265021
         B     REQ305                  BRANCH                           69270021
REQ309   EQU   *                                                        69275021
         L     RWORKC,W3A              LOAD GDS OFFSET VALUE            69280021
         SH    RWORKC,LOGSTRT(RKEYEN)  SUBTRACT LOGICAL START           69285021
         ST    RWORKC,W3               STORE VALUE IN WORD 3 OF ARRAY   69290021
         B     REQ305                  BRANCH                           69300021
REQ308   TM    BCTFLAG(RKEYEN),HIBIT   HIGH ORDER BIT ON                69310021
         BO    REQ305                  BRANCH-YES                       69320021
         TM    BCTFLAG(RKEYEN),TOBIT   LINK TO SUBR                     69330021
         BO    REQ307                  BRANCH-YES                       69340021
         B     REQ305                  BRANCH                           69350021
REQ306   MVC   W5(4),BFRLEN(RKEYEN)    KEY TO WORD5 OF ARRAY            69400021
         MVC   W7(4),CORVAL(RKEYEN)    CORVAL TO WORD 7 OF ARRAY        69500021
         L     RWORKC,W3A              LOAD GDS OFFSET VALUE            69600021
         SH    RWORKC,LOGSTRT(RKEYEN)  SUBTRACT LOGICAL START           69700021
         ST    RWORKC,W6               STORE VALUE IN WORD 6  OF ARRAY  69800021
         B     REQ305                  BRANCH                           69900021
REQ500   CLI   TYPE,LPC                LITE PEN ATN                     70000021
         BE    REQ501                  BRANCH IF YES                    70100021
         TM    ATTNFLGA,EOSXY          XY WANTED ON EOS                 70200021
         BC    1,REQ502                BRANCH IF YES                    70300021
         BR    RWORKA                  RETURN                           70400021
REQ502   CLC   XPOS(4),ZERO1           XY VALUE ZERO                    70500021
         BNE   REQ503                  BRANCH IF NO                     70600021
         BR    RWORKA                  RETURN                           70700021
REQ503   SR    RWORKC,RWORKC           CLEAR REG                        70800021
         SR    RWORKD,RWORKD           CLEAR REG                        70900021
         XC    GDSNAME(24),GDSNAME     CLEAR PARAM LIST                 71200021
         TM    SENSE+1,X'20'       CHECK IF CHAR ATTN            A37965 71202000
         BO    ADJUST              IF YES,ADJUST X,Y COORDS      A37965 71204000
         LH    RWORKC,XPOS         IF NO, SKIP ADJUST FIX        A37965 71206000
         LH    RWORKD,YPOS                                       A37965 71208000
         ST    RWORKC,XINPUT       USE DIRECT INPUT              A37965 71210000
         B     OLDCODE                                           A37965 71212000
* THE FOLLOWING CODE ADJUSTS THE COORDINATE VALUES RETURNED BY   A37965 71214000
* HARDWARE FOLLOWING A DETECT ON A CHARACTER TO THE CENTER OF    A37965 71216000
* CHARACTER DETECTED. HARDWARE RETURNS THE CENTER POINT OF THE   A37965 71218000
* NEXT CHARACTER GRID.                                           A37965 71220000
ADJUST   LH    RWORKC,XPOS         LOAD X FOR CHAR DETECT        A37965 71222000
         LA    RWORKD,BSCSPC       BASIC CHAR SPACING            A37965 71224000
         LA    RWORKB,BSCLINE      BASIC LINE SPACING            A37965 71226000
         TM    GDSCHARS,LRGSZE     CHECK GDS FOR LARGE CHARS     A37965 71228000
         BZ    ADJUSTX             BRANCH IF NOT LARGE CHARS     A37965 71230000
         LA    RWORKD,LRGSPC       LARGE CHAR SPACING            A37965 71232000
         LA    RWORKB,LRGLINE      LARGE LINE SPACING            A37965 71234000
ADJUSTX  EQU   *                                                 A37965 71236000
         SR    RWORKC,RWORKD       X MINUS CHAR SPACE            A37965 71238000
         BNM   XVALID              BRANCH IF X NOW VALID         A37965 71240000
         LA    RWORKC,XSCREEN      X=RIGHT LIMIT OF SCREEN       A37965 71242000
         TM    GDSSCISS,NOSCISS    CHECK GDS FOR NO SCISSORING   A37965 71244000
         BO    ADJUSTY             BRANCH IF NO SCISSORING       A37965 71246000
         SR    RWORKC,RWORKD       X=(MAX CHAR CENTER X)-SPACE   A37965 71248000
ADJUSTY  EQU   *                                                 A37965 71250000
         ST    RWORKC,XINPUT       X POS TO PARM LIST            A37965 71252000
         LH    RWORKD,YPOS         LOAD Y FOR CHAR DETECT        A37965 71254000
         AR    RWORKD,RWORKB       Y = Y+LINE SPACING            A37965 71256000
         LA    RWORKC,YSCREEN      MAX Y VALUE FOR CHAR CENTER   A37965 71258000
         CR    RWORKD,RWORKC       COMPARE Y TO SCREEN LIMIT     A37965 71260000
         BNH   YVALID              BRANCH IF Y NOW VALID         A37965 71262000
         LA    RWORKD,YLOWER       Y = MIN Y  VALUE FOR CHAR     A37965 71264000
         B     YVALID              GO SET UP FOR CONVERT RTN     A37965 71266000
XVALID   EQU   *                                                 A37965 71268000
         ST    RWORKC,XINPUT       X POS TO PARM LIST            A37965 71270000
         LH    RWORKD,YPOS         LOAD Y POS                    A37965 71272000
YVALID   EQU   *                                                 A37965 71274000
OLDCODE  ST    RWORKD,YINPUT       Y POS TO PARM LIST            A37965 71374000
         ST    RGDSCB,GDSNAME          ADR OF GDSCB TO PARM LIST        71500021
         LA    RWORKC,ONE              LOAD CONSTANT                    71600021
         ST    RWORKC,CONVERT          STORE IN PARM LIST               71700021
         LA    RWORKC,GDSNAME          LOAD PARM ADR                    71800021
         ST    RWORKC,P1               STORE IN PARM LIST               71900021
         LA    RWORKC,CONVERT          LOAD ADR                         72000021
         ST    RWORKC,P2               STORE IN PARM LIST               72100021
         LA    RWORKC,XINPUT           LOAD ADR                         72200021
         ST    RWORKC,P3               STORE IN PARM LIST               72300021
         LA    RWORKC,YINPUT           LOAD ADR                         72400021
         ST    RWORKC,P4               STORE IN PARM LIST               72500021
         LA    RWORKC,XOUTPUT          LOAD ADR                         72600021
         ST    RWORKC,P5               STORE IN PARM LIST               72700021
         LA    RWORKC,YOUTPUT          LOAD ADR                         72800021
         ST    RWORKC,P6               STORE IN PARM LIST               72900021
         MVI   P6,LAST                 INDICATE LAST PARM               73000021
         L     RWORKC,RCA              LOAD RTN CODE ARRAY ADR          73100021
         ST    RWORKC,RCAB             STORE IN PARM LIST               73200021
         LA    RWORKC,P1               LOAD ADR                         73300021
         ST    RWORKC,PASS             STORE IN PARM LIST               73400021
         LA    REG1,PASS               LOAD PLIST ADR                   73500021
         LR    RGDSCB,RWORKA           SAVE RETN REG                    73600021
         L     R15,ATTNBKPT        POINT TO PREV ATL OR GTM D11 ZA15437 73600803
         DROP  RATL                TEMPORARILY DROP RATL    D11 ZA15437 73601603
         USING ATTNLEVL,R15        ADDRESS ATTNLEVEL        D11 ZA15437 73602403
ATLAGN   CLC   ATTNLVID(2),GTMID   IS IT A GTMCB?           D11 ZA15437 73603203
         BE    GOTGTM              YES,CONTINUE CNVRT LOGIC D11 ZA15437 73604003
         L     R15,ATTNBKPT        LOAD A(ATL) OR A(GTM)    D11 ZA15437 73604803
         B     ATLAGN              TEST AGAIN               D11 ZA15437 73605603
GOTGTM   EQU   *                   GTM FOUND                D11 ZA15437 73606403
         USING GTMCB,R15           ADDRESS GTM              D11 ZA15437 73607203
         L     R15,GTMGSPCB        POINT TO GSPCB           D11 ZA15437 73608003
         USING GSPCB,R15           ADDR GSPCB               D11 ZA15437 73608803
         L     R15,GSPASTAT        POINT TO STATUS TABLE    D11 ZA15437 73610003
         DROP  R15                                          D11 ZA15437 73614003
         USING ATTNLEVL,RATL       RE-ADDRESS ATLVLCB       D11 ZA15437 73618003
         L     R15,CNVRT(R15)      AND TO CONVERT           D11 ZA15437 73620003
         LTR   R15,R15             CNVRT LOADED?            D11 ZA15437 73640003
         BZ    REQLINK1            NO,MUST USE SYSTEM LINK  D11 ZA15437 73660003
         BALR  R14,R15             GOTO CONVERT             D11 ZA15437 73680003
         B     REQRTN1             RETURN FROM CONVERT      D11 ZA15437 73690003
REQLINK1 LINK  EP=IFFAGA08,MF=(E,(1)) LINK TO CONVERT       D11 ZA15437 73700003
REQRTN1  MVC   W8(4),XOUTPUT       X POS TO WD 8 OF ARRAY   D11 ZA15437 73800021
         MVC   W9(4),YOUTPUT           Y POS TO WORD 9 OF ARRAY         73900021
         L     RWORKC,RCA              LOAD RTN CODE ARRAY ADR          74000021
         XC    ZERO(20,RWORKC),ZERO(RWORKC) INITIALIZE ARRAY            74100021
         BR    RGDSCB                  RETURN                           74200021
REQ501   TM    ATTNFLGA,LPCHAR         CHARACTER CODE WANTED            74300021
         BC    14,REQ504               BRANCH IF NO                     74400021
         MVC   W10(1),CHARACTR         CHARACTER TO WORD 10 OF ARRAY    74500021
REQ504   TM    ATTNFLGA,LPXY           XY POS WANTED                    74600021
         BC    1,REQ503                BRANCH IF YES                    74700021
         BR    RWORKA                  RETURN                           74800021
*********************************************************************** 74900021
*                  DIRECT ENTRY GOES HERE                             * 75000021
*                                                                     * 75100021
DIRECT   B     OUTRTN                                                   75200021
*                                                                     * 75300021
*                                                                     * 75400021
*********************************************************************** 75500021
IOTEST   CLI   DECB,IOK                I/O SUCCESSFULL CODE             75510021
         BCR   8,REG1                  BRANCH IF OK                     75520021
         L     RWORKA,RCA              LOAD RTN CODE ARRAY ADR          75530021
         OI    ZERO(RWORKA),RCC5       INDICATE I/O ERROR               75540021
         B     OUTRTN                  RETURN TO CALLER                 75550021
         DS    0F                                                       75600021
ZERO1    DC    1F'0'                   ZERO                             75700021
MIN1     DC    F'-1'                                               RSTH 75750021
PRIME    DC    X'80'                   PF PRIME BIT                     75800021
         DC    AL3(0)                                                   75900021
GTMID    DC    X'F202'             IDENTIFIER FOR GTM       D11 ZA15437 75950003
ANSIZE   DC    A(31)                   MAX PF SIZE                      76000021
MAX      DC    A(36)                   MAX ALLOWABLE SOURCE VALUE       76100021
END      DC    A(32)                   END                              76200021
LPD      DC    A(34)                   LP                               76300021
EOSD     DC    A(35)                   EOS                              76400021
CANCELD  DC    A(33)                   CANCEL                           76500021
AED      DC    A(36)                   AE                               76600021
SCANTWO  DC    A(2)                    SCAN VALUE OF TWO                76700021
THREE    DC    A(3)                    3                                76800021
DIV256A  DC    A(256)                  256                              76900021
SUBSEG   DC    A(128)                  SUB SEGMENT SPLIT POINT          77000021
PATCH    DC    64X'FF'             PATCH AREA               D11         77050003
         CNOP  0,8                                                      77100021
         COPY  ATTNLEVL                                                 77200021
         COPY  GDSCB                                                    77300021
         COPY  GTMCB                                                    77400021
         COPY  GSPCB                                                    77500021
PLIST    DSECT                                                          77600021
ATNLVL   DS    1F                      ATTN LEVEL                       77700021
CODELOC  DS    1F                      CODE LOC                         77800021
SCANWAIT DS    1F                      SCAN WAIT                        77900021
ARRAY    DS    1F                      ARRAY                            78000021
ATNSRCE  DS    1F                      1ST ATTN SOURCE                  78100021
WORKAREA DSECT                                                          78200021
PARAM    DS    1F                      USER PARAM LIST ADR              78300021
RCA      DS    1F                      RETURN CODE ARRAY ADR            78400021
SAVE     DS    18F                     SAVE AREA                        78500021
DECB     DS    8F                      I/O AREA DECB                    78600021
DATA     DS    1F                      I/O DATA AREA                    78700021
GACB     DS    1F                      *                                78800021
TYPEA    DS    BL1                     *                                78900021
OPT      DS    BL1                     ATTNINQ  MACRO AREA              79000021
TYP      DS    1H                      *                                79100021
BRANCH   DS    1F                      *                                79200021
ANMASK   DS    1F                      SAVE AREA FOR ANMASK             79300021
PFMASK   DS    1F                      SAVE AREA FOR PFMASK             79400021
RSVD     DS    BL1                     RSVD                             79500021
OVERLAY  DS    BL1                     OVERLAY CODE                     79600021
KEYNO    DS    BL1                     KEY NUMBER                       79700021
TYPE     DS    BL1                     ATTN TYPE                        79800021
SENSE    DS    1F                      SENSE / MI DATA                  79900021
XPOS     DS    1H                      X POS VALUE                      80000021
YPOS     DS    1H                      Y POS VALUE                      80100021
SAVE1    DS    1F                      GACB A/N MASK SAVE AREA          80200021
SAVE2    DS    1F                      GACB P/F MASK SAVE AREA          80300021
IDBYTE   DS    BL1                     GDS ID BYTE                      80400021
CHARACTR DS    BL1                     CHARACTER BYTE                   80500021
         DS    BL1                                                      80600021
         DS    BL1                                                      80700021
LOGDIF   DS    1F                      LOGICAL DIFFERENCE               80800021
GDSNAME  DS    1F                                                       80900021
CONVERT  DS    1F                                                       81000021
XINPUT   DS    1F                                                       81100021
YINPUT   DS    1F                                                       81200021
XOUTPUT  DS    1F                                                       81300021
YOUTPUT  DS    1F                                                       81400021
P1       DS    1F                                                       81500021
P2       DS    1F                                                       81600021
P3       DS    1F                                                       81700021
P4       DS    1F                                                       81800021
P5       DS    1F                                                       81900021
P6       DS    1F                                                       82000021
         ORG   WORKAREA+216            ALIGN TO A DOUBLE WORD BOUNDRY   82100021
PASS     DS    1F                                                       82200021
RCAB     DS    1F                                                       82300021
W3A      DS    1F                                                       82330021
CCT      DS    1H                                                       82360021
         DS    0F                                                  000A 82370021
LFORM    DS    16F                                                 000A 82380021
ARRAYUSE DSECT                                                          82400021
W1       DS    1F                                                       82500021
W2       DS    1F                                                       82600021
W3       DS    1F                                                       82700021
W4       DS    1F                                                       82800021
W5       DS    1F                                                       82900021
W6       DS    1F                                                       83000021
W7       DS    1F                                                       83100021
W8       DS    1F                                                       83200021
W9       DS    1F                                                       83300021
W10      DS    1F                                                       83400021
         END                                                            83500021
