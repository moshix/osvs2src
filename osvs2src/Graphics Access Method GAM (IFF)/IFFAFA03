     TITLE   'PTEXT - IFFAFA03 '                                        00090000
*********************************************************************** 00180000
*                                                                     * 00270000
*TITLE         PTEXT                                                  * 00360000
*                                                                     * 00450000
*MODULE NAME   IFFAFA03                                               * 00540000
*                                                                     * 00630000
*STATUS        CHANGE LEVEL 000                                       * 00720000
*                                                                     * 00810000
*FUNCTION/OPERATION                                                   * 00900000
*  TO PRODUCE CHARACTER TEXT ON THE GRAPHIC OUTPUT MEDIUM USING THE   * 00990000
*  CHARACTER GENERATOR. TO UPDATE PREVIOUSLY GENERATED PTEXT GRAPHIC  * 01080000
*  DATA.                                                              * 01170000
*                                                                     * 01260000
*ENTRY POINT   IFFAFA03- CSECT NAME                                   * 01350000
*                                                                     * 01440000
*INPUT   REGISTER 1 CONTAINS THE ADDRESS OF A WORK SAVE AREA. THE     * 01530000
*  FIRST WORD CONTAINS THE ADDRESS OF A VARIABLE LENGTH PARAMETER     * 01620000
*  LIST ON A FULL WORD BOUNDARY. THE SECOND WORD CONTAINS THE         * 01710000
*  ADDRESS OF THE RETURN ARRAY. THE NULL VARIABLE IS AT AN OFFSET     * 01800000
*  OF 20 FROM THE RETURN ARRAY, AND THE ADDRESS OF THE STATUS TABLE   * 01890000
*  IS AT AN OFFSET OF 24 FROM THE RETURN ARRAY                        * 01980000
*FORMAT OF PARAMETER LIST                                             * 02070000
* REQUIRED PARAMETERS                                                 * 02160000
*                                                                     * 02250000
*  +0    A(VAR)     ADDRESS OF A VARIABLE WHICH CONTAINS THE GDSCB    * 02340000
*                   ADDRESS.                                          * 02430000
*  +4    A(TEXT)    ADDRESS OF THE TEXT ARRAY WHICH CONTAINS THE      * 02520000
*                   CHARACTERS TO BE DISPLAYED, LEFT ADJUSTED AND     * 02610000
*                   PACKED FOUR TO THE FULL WORD.                     * 02700000
*  +8    A(COUNT)   ADDRESS OF THE COUNT OF THE NUMBER OF ALPHAMERIC  * 02790000
*                   CHARACTERS TO BE PLACED ON THE SCREEN.            * 02880000
*                                                                     * 02970000
* OPTIONAL PARAMETERS                                                 * 03060000
*                                                                     * 03150000
*  +12   A(CORRVAL) ADDRESS OF A CORRELATION VALUE                    * 03240000
*                                                                     * 03330000
*  +16   A(KEY)     ADDRESS OF A LOCATION INTO WHICH THE KEY IS TO    * 03420000
*                   BE INSERTED ON ORIGINAL GENERATION OR THE         * 03510000
*                   ADDRESS OF THE KEY ON UPDATE GENERATION.          * 03600000
*  +20   A(GENCODE) ADDRESS OF A CODE                                 * 03690000
*                     1 = INCLUDE                                     * 03780000
*                     2 = OMIT                                        * 03870000
*                     3 = UPDATE                                      * 03960000
*  +24   A(UVAL)    THE X VALUE TO WHICH THE CHARACTER STRING IS TO   * 04050000
*                   BE POSITIONED                                     * 04140000
*  +28   A(VVAL)    THE Y VALUE TO WHICH THE CHARACTER STRING IS TO   * 04230000
*                   BE POSITIONED                                     * 04320000
*                                                                     * 04410000
*OUTPUT                                                               * 04500000
*  NONE TO CALLER. THE DATA WILL BE SCISSORED, AND IF IT APPEARS ON   * 04590000
*  THE SCREEN, ORDERS WILL BE GENERATED FOR IT IN THE GDOA            * 04680000
*                                                                     * 04770000
*EXTERNAL ROUTINES                                                    * 04860000
*  IFFAFA12 - RESET                                                     04950000
*  IFFAFA17 - MVPOS USED TO POSITION BEAM WHEN X AND Y PARAMETERS     * 05040000
*             PASSED.                                                 * 05130000
*  IFFAHA03   KEY TABLE MANAGEMENT                                    * 05220000
*  IFFAHA04   DATA GENERATION                                         * 05310000
*  IFFAHA05   DATA STORE                                              * 05400000
*  IFFAHA07   SCISSOR                                                 * 05490000
*  IFFAHA13   GET GDOA'S FOR UPDATE                                   * 05580000
*  IFFAHA14   WRITE OUT UPDATE                                        * 05670000
*                                                                     * 05760000
*EXITS - BACK TO CALLER VIA REGISTER 14                               * 05850000
*  APPROPRIATE CODES ARE SET IN THE RETURN ARRAY- SEE GSPARRAY        * 05940000
*                                                                     * 06030000
*TABLES/WORKAREAS - SEE WORKAREA DSECT                                * 06120000
*                                                                     * 06210000
*ATTRIBUTES       - REENTRANT, PROBLEM PROGRAM MODE.                  * 06300000
*                                                                     * 06390000
*                                                                     * 06480000
*                                                                     * 06570000
*                                                                     * 06660000
*                                                                     * 06750000
*********************************************************************** 06840000
         EJECT                                                          06930000
IFFAFA03 CSECT                          PTEXT                           07020000
*D482300-482600,584000                                           A32072 07110000
*                                                                A32087 07200000
* 790000                                                         A29414 07290000
*2277,320800-322400,589000-590000,852000-853000                    000B 07380000
*2277,400000-403000,591000-593000,774000-777000,786000-789000      000C 07470000
*2277,601000,855000                                                000D 07560000
*D692000-694000                                                  YM1963 07650000
*A692000-694400                                                  YM1963 07740000
*A163140-163160,399500-400000,C401000,A785300-785600,C786000D11 ZA15418 07830000
*A163180,851200-852200,C853000-856000                       D11 ZA15437 07920000
         SPACE 2                                                        08010000
*REGISTERS                                                              08100000
*                                                                       08190000
EVEN     EQU   0                                                        08280000
PARM     EQU   1                                                        08370000
REGA     EQU   2                                                        08460000
REGB     EQU   3                                                        08550000
REGC     EQU   4                                                        08640000
WORK     EQU   5                                                        08730000
ERRCD    EQU   6                                                        08820000
GTMREG   EQU   7                                                        08910000
GDSREG   EQU   8                                                        09000000
BASE     EQU   9                                                        09090000
REGD     EQU   10                                                       09180000
COUNT    EQU   11                                                       09270000
SAVE     EQU   13                                                       09360000
RETREG   EQU   14                                                       09450000
BRANCH   EQU   15                                                       09540000
         SPACE 2                                                        09630000
*PARAMETER LIST EQUATES                                                 09720000
GDS      EQU   0                        ADDRESS OF GDS VARIABLE         09810000
TXT      EQU   4                        ADDRESS OF TEXT ARRAY           09900000
CT       EQU   8                        ADDRESS OF NUMBER OF CHARACTERS 09990000
COR      EQU   12                       ADDRESS OF CORRVAL              10080000
KEY      EQU   16                       ADDRESS OF KEY                  10170000
GEN      EQU   20                       ADDRESS OF GENCODE              10260000
X        EQU   24                       ADDRESS OF X COORD FOR START    10350000
Y        EQU   28                       ADDRESS OF Y COORD FOR START    10440000
*                                                                       10530000
NL       EQU   21                                                       10620000
SCERR    EQU   4                                                        10710000
MVPOS    EQU   360                                                      10800000
DGEN     EQU   840                                                      10890000
DSTORE   EQU   852                                                      10980000
SCISS    EQU   876                                                      11070000
CURRLOG  EQU   52                                                       11160000
CVTLINK  EQU   8                                                        11250000
LNK      EQU   8                                                        11340000
NULL     EQU   20                                                       11430000
PARMERR  EQU   16                                                       11520000
STAT     EQU   24                                                       11610000
STOR     EQU   12                                                       11700000
FE       EQU   48                                                  000A 11790000
ETE      EQU   828                                                 000A 11880000
         SPACE 2                                                        11970000
GRBP     EQU   X'80'                    GRAPHIC MODE SWITCH SETTINGS    12060000
GRLP     EQU   X'40'                    *                               12150000
GRBU     EQU   X'20'                    *                               12240000
GRLU     EQU   X'10'                    *                               12330000
BP       EQU   X'08'                                                    12420000
LP       EQU   X'04'                                                    12510000
BU       EQU   X'02'                                                    12600000
LU       EQU   X'01'                                                    12690000
BASIC    EQU   X'0A'                                                    12780000
LARGE    EQU   X'05'                                                    12870000
         SPACE 2                                                        12960000
CORRE    EQU   X'10'                                                    13050000
KEYED    EQU   X'20'                                                    13140000
OPT      EQU   X'04'                                                    13230000
MULT     EQU   X'80'                                                    13320000
OMIT     EQU   X'FB'                                                    13410000
INCLUDE  EQU   X'04'                                                    13500000
UPDATE   EQU   X'FF'                                                    13590000
LASTON   EQU   X'1F'                                                    13680000
CONTROL  EQU   X'00'                                                    13770000
UNRES    EQU   X'01'                                                    13860000
MEMSUB   EQU   X'80'                                                    13950000
MEMSEQ   EQU   X'40'                                                    14040000
SEQ      EQU   X'04'                                                    14130000
OFF      EQU   X'00'                                                    14220000
STRG     EQU   X'10'                                                    14310000
PRM      EQU   X'08'                                                    14400000
NOSCISS  EQU   X'10'                                                    14490000
SCISSOR  EQU   X'40'                                                    14580000
POS      EQU   X'11'                                                    14670000
YCOR     EQU   X'01'                                                    14760000
XCOR     EQU   X'10'                                                    14850000
SUBR     EQU   X'02'                                                    14940000
LEVEL2   EQU   X'10'                                                    15030000
LAST     EQU   X'80'                                                    15120000
LINKSW   EQU   X'01'                                                    15210000
ODD      EQU   X'01'                                                    15300000
CHARGEN  EQU   X'08'                                                    15390000
RESOL    EQU   X'02'                                                    15480000
ALIGN    EQU   X'00'                                                    15570000
STOP     EQU   X'01'                                                    15660000
SCISSON  EQU   X'40'                                                    15750000
WORD1    EQU   0        USE ZERO DISPLACEMENT FOR GSPARRAY       A29414 15840000
IOERR    EQU   X'04'    I/O ERROR FLAG, WORD 1, GSPARRAY         A29414 15930000
UPDH13   EQU   936                 STATAB DISPL-IFFAHA13    D11 ZA15418 16020000
UPDH14   EQU   948                 STATAB DISPL-IFFAHA14    D11 ZA15418 16110000
RESET    EQU   468                 STATAB DISPL-IFFAFA12    D11 ZA15437 16200000
DSP04    EQU   X'15C'                                              000C 16290000
STABADR  EQU   24                      DISPLACEMENT TO GSPASTAT    000C 16380000
R14      EQU   14                                                  000C 16470000
R15      EQU   15                                                  000C 16560000
         EJECT                                                          16650000
         USING *,15                                                     16740000
         SAVE  (14,12)                                                  16830000
         DROP  15                                                       16920000
*                                                                       17010000
*INITIALIZATION                                                         17100000
*THIS CODE ESTABLISHED ADDRESSABILITY FOR IFFAFA03, FOR THE GDSCB, AND  17190000
*FOR THE WORKAREA. THE RETURN ARRAY IS SET TO ZERO, AND THE SAVE AREAS  17280000
*ARE CHAINED.                                                           17370000
*                                                                       17460000
*                                       ESTABLISH BASES FOR             17550000
         LR    BASE,15                  IFFAFA03                        17640000
         USING IFFAFA03,BASE                                            17730000
         LR    WORK,PARM                WORK AREA                       17820000
         USING WORKAREA,WORK                                            17910000
         L     PARM,WKPARM              LOAD PARAMETER LIST ADDRESS     18000000
         L     GDSREG,GDS(PARM)         PCIK UP GDSCB VARIABLE ADDRESS  18090000
         L     GDSREG,0(GDSREG)         ESTABLISH BASE FOR GDSCB        18180000
         USING GDSCB,GDSREG                                             18270000
         L     ERRCD,WKRTNCD                                            18360000
         XC    0(20,ERRCD),0(ERRCD)     ZERO RETURN ARRAY               18450000
         LA    REGA,WKSAVE              CHAIN SAVE AREAS                18540000
         ST    REGA,8(SAVE)                                             18630000
         ST    SAVE,4(REGA)                                             18720000
         LR    SAVE,REGA                                                18810000
         EJECT                                                          18900000
*PARAMETER LIST SCAN                                                    18990000
*                                                                       19080000
*TEST FOR VALID GDSCB AND CHARACTER GENERATOR PRESENT                   19170000
*IF THE CHARACTER GENERATOR IS NOT PRESENT, IT IS AN INVALID CALL.      19260000
*                                                                       19350000
         C     GDSREG,GDSGDSCB                                          19440000
         BNE   AFAERR10                 BRANCH IF INVALID GDSCB- ERROR  19530000
         L     GTMREG,GDSGTMCB          PICK UP GTMCB ADDRESS           19620000
         USING GTMCB,GTMREG                                             19710000
         TM    GTMFEATS+1,CHARGEN                                       19800000
         BZ    AFAERR00                 BRANCH IF NO CHARACTER GENER.   19890000
*                                        -INVALID CALL- ERROR           19980000
         DROP  GTMREG                                                   20070000
*                                                                       20160000
*PREPARE SKELETON KEY AND PARAMETER LIST                                20250000
*THE SWITCHES IN THE KEY ARE INITIALIZED AS CHARACTER MODE, AND INCLUDE 20340000
*STATUS. APPROPRIATE SWITCHES ARE SET IF THE ELEMENT IS A MEMBER OF A   20430000
*SEQUENCE OR SUBROUTINE.                                                20520000
*                                                                       20610000
         XC    WKSPVSR(12),WKSPVSR     ZERO PARM LIST FOR LINK MACRO    20700000
         XC    WKBITSA(8),WKBITSA       ZERO WORK AREA AND              20790000
         XC    WKADDR(68),WKADDR         PARAMETER LIST                 20880000
         MVC   WKBITS,BITS              MOVE SKELETON KEY IN            20970000
         TM    GDSFLAGS,SEQ                                             21060000
         BZ    AFAPAR05                 BRANCH IF NOT MEMBER OF SEQ     21150000
         OI    WKBITS+3,MEMSEQ          SET SWITCH IN KEY               21240000
AFAPAR05 TM    GDSFLAGS,SUBR                                            21330000
         BZ    AFAPAR10                 BRANCH IF NOT SUBROUTINE MEM    21420000
         OI    WKBITS+3,MEMSUB          SET SWITCH IN KEY               21510000
AFAPAR10 ST    GDSREG,WKGDS             GDSCB ADDRESS                   21600000
         MVC   WKRTN,WKRTNCD            ADDRESS-OF RETURN ARRAY         21690000
*                                                                       21780000
*                                                                     * 21870000
*TEST FOR TEXT AND COUNT PARAMETERS PRESENT. SET UP COUNT IN REGISTER   21960000
*FOR LATER USE, AND PLACE THE CHARACTER COUNT IN THE KEY                22050000
*                                                                     * 22140000
         TM    GDS(PARM),LAST                                           22230000
         BO    AFAERR00                 BRANCH IF REQ PARMS NOT PRESENT 22320000
         CLC   NL(3,ERRCD),TXT+1(PARM)                                  22410000
         BE    AFAERR20                 BRANCH IF TEXT NULL - ERROR     22500000
         TM    TXT(PARM),LAST                                           22590000
         BO    AFAERR00                 BRANCH IF REQ PARMS NOT PRESENT 22680000
         CLC   NL(3,ERRCD),CT+1(PARM)                                   22770000
         BE    AFAERR30                 BRANCH IF COUNT NULL-ERROR      22860000
         L     COUNT,CT(PARM)           ADDRESS OF COUNT                22950000
         L     COUNT,0(COUNT)           PICK UP COUNT                   23040000
         LTR   COUNT,COUNT                                              23130000
         BZ    AFARET10                 BRANCH IF COUNT ZERO- RETURN    23220000
         BM    AFAERR30                 BRANCH IF COUNT NEGATIVE-ERROR  23310000
         STC   COUNT,WKBITS+2           STORE CHARACTER COUNT IN KEY    23400000
         SRA   COUNT,8                                                  23490000
         STC   COUNT,WKBITS+1                                           23580000
         L     COUNT,CT(PARM)           RESET COUNT REGISTER            23670000
         L     COUNT,0(COUNT)                                           23760000
         TM    CT(PARM),LAST                                            23850000
         BO    AFADAT10                 BRANCH IF NO OPTIONAL PARMS     23940000
     EJECT                                                              24030000
*THIS SECTION EXAMINES THE OPTIONAL PARAMETERS CORRVAL, KEY AND GENCODE 24120000
*AND TESTS THEM FOR VALIDITY. IF NECESSARY, THE INCLUDE-OMIT STRUCTURE  24210000
*IS BUILT. IF THERE IS A VALID UPDATE, KEY MANAGEMENT IS CALLED. IF     24300000
*NECESSARY DATA STORE IS CALLED TO ENTER ORDERS IN THE GDOA.            24390000
*                                                                       24480000
         CLC   NL(3,ERRCD),COR+1(PARM)                                  24570000
         BE    AFAPAR20                 BRANCH IF CORRVAL NULL          24660000
         TM    GDSFLAGS,LEVEL2                                          24750000
         BO    AFAPAR20                 BRANCH IF PASSED, BUT LEVEL 2   24840000
         L     REGC,COR(PARM)           LOAD ADDRESS OF CORRVAL AND     24930000
         MVC   WKCORVL,0(REGC)          PLACE CORRVAL IN KEY AREA       25020000
         OI    WKSWITCH+2,CORRE         SET CORRVAL SWITCH              25110000
*                                                                       25200000
AFAPAR20 TM    COR(PARM),LAST                                           25290000
         BO    AFADAT10                 BRANCH IF NO MORE PARAMS        25380000
         CLC   NL(3,ERRCD),KEY+1(PARM)                                  25470000
         BE    AFAPAR25                 BRANCH IF KEY NULL              25560000
         MVC   WKKEY,KEY(PARM)          SAVE KEY ADDRESS                25650000
         TM    GDSFLAGS,LEVEL2                                          25740000
         BO    AFAPAR25                 BRANCH IF LEVEL 2 KEY           25830000
         OI    WKSWITCH+2,KEYED         SET KEY SWITCH                  25920000
AFAPAR25 TM    KEY(PARM),LAST                                           26010000
         BO    AFADAT10                 BRANCH IF NO MORE PARAMETERS    26100000
         CLC   NL(3,ERRCD),GEN+1(PARM)                                  26190000
         BE    AFAPAR30                 BRANCH IF GENCODE NULL          26280000
         L     REGC,GEN(PARM)           PICK UP ADDRESS OF CODE AND     26370000
         L     REGC,0(REGC)             ACTUAL CODE                     26460000
         C     REGC,ONE                                                 26550000
         BE    AFAPAR30                 BRANCH IF 'INCLUDE' - SWITCH    26640000
*                                       ALREADY SET                     26730000
         CLC   WKCORVL(8),ZERO                                          26820000
         BE    AFAERR60                 BRANCH IF NO KEY OR CORRVAL     26910000
         C     REGC,TWO                                                 27000000
         BNE   AFAPAR50                 BRANCH IF NOT 'OMIT'            27090000
         TM    GDSFLAGS,LEVEL2                                          27180000
         BO    AFAERR60                 BRANCH IF LEVEL 2 - ERROR       27270000
         NI    WKBITS,OMIT              TURN OFF INCLUDE SWITCH         27360000
AFAPAR30 TM    WKSWITCH+2,CORRE                                         27450000
         BZ    AFAPAR35                                                 27540000
         CLC   WKCORVL,ZERO                                             27630000
         BE    AFAERR40                 BRANCH IF CORRVAL ZERO - ERROR  27720000
         EJECT                                                          27810000
*THIS SECTION EXAMINES THE X AND Y COORDINATE PARAMETERS. IF THEY       27900000
*ARE PRESENT MVPOS WILL BE CALLED TO POSITION THE BEAM                  27990000
*                                                                       28080000
AFAPAR35 TM    GEN(PARM),LAST                                           28170000
         BO    AFADAT10                 BRANCH IF NO MORE PARAMETERS    28260000
         CLC   NL(3,ERRCD),X+1(PARM)                                    28350000
         BE    AFAPAR40                 BRANCH IF X NULL                28440000
         OI    WKSWITCH+1,XCOR          SET SW&TCH, X PRESENT           28530000
AFAPAR40 TM    X(PARM),LAST                                             28620000
         BO    AFAPAR45                 BRANCH IF LAST                  28710000
         CLC   NL(3,ERRCD),Y+1(PARM)                                    28800000
         BE    AFAPAR45                 BRANCH IF Y NULL                28890000
         OI    WKSWITCH+1,YCOR          SET SWITCH, Y PRESENT           28980000
AFAPAR45 TM    WKSWITCH+1,POS                                           29070000
         BM    AFAERR00                 ERROR IS ONE COORDINATE PASSED  29160000
         B     AFADAT10                                                 29250000
         EJECT                                                          29340000
*CHECK FOR VALID UPDATE                                                 29430000
*                                                                       29520000
AFAPAR50 C     REGC,THREE                                               29610000
         BNE   AFAERR60                 BRANCH IF INVALID GENCODE       29700000
         TM    GDSFLAGS,SUBR                                            29790000
         BO    AFAERR00                 BRANCH IF BUFF SUBR- ERROR      29880000
         TM    GDSFLAGS,LEVEL2                                          29970000
         BO    AFAPAR80                 BRANCH IF LEVEL 2 TO SET KEY    30060000
         TM    WKSWITCH+2,KEYED                                         30150000
         BZ    AFAPAR85                 BRANCH IF NOT KEYED             30240000
*                                                                       30330000
*PREPARE FOR SEARCH ON KEY              PARAMETERS--                    30420000
*                                                                       30510000
         L     REGB,KEY(PARM)           ADDRESS OF KEY IN PARM LIST     30600000
         ST    REGB,WKKADDR                                             30690000
         LA    REGB,TWO                 CODE FOR SEARCH ON KEY          30780000
AFAPAR55 ST    REGB,WKCODE                                              30870000
         ST    GDSREG,WKGDS1            ADDRESS OF GDSCB                30960000
         LA    PARM,WKGDS1                                              31050000
*                                                                       31140000
*LINK TO KEY TABLE MANAGEMENT FOR SEARCH ON KEY OR CORRVAL              31230000
*                                                                       31320000
         L     REGB,STABADR(ERRCD)      GET STATUS TABLE ADDR      000B 31410000
         L     BRANCH,ETE(REGB)    GET ADRS OF KEY TABLE MGMT      000A 31500000
         BALR  RETREG,BRANCH       BRANCH TO KEY TABLE MGMT        000A 31590000
AFAPAR60 LTR   BRANCH,BRANCH                                            31680000
         BNE   AFAERR00                 BRANCH IF INVALID KEY           31770000
         MVC   WKADDR,0(PARM)           MOVE IN KEY START               31860000
         OC    WKBITS+3(1),7(PARM)      MOVE IN FLAGS FORM OLD KEY      31950000
         TM    4(PARM),INCLUDE                                          32040000
         BO    AFAPAR62                                                 32130000
         NI    WKBITS,OMIT              TURN OFF INCLUDE SWITCH         32220000
AFAPAR62 TM    WKSWITCH+2,CORRE                                         32310000
         BZ    AFAPAR65                 BRANCH IF NO CORRVAL            32400000
         ST    PARM,WKSTORAD            SAVE KEY ADDRESS                32490000
AFAPAR65 MVI   WKSWITCH,UPDATE          SET UPDATE SWITCH               32580000
         L     PARM,WKPARM              RESET PARAMETER REGISTER        32670000
         B     AFAPAR35                                                 32760000
         SPACE 2                                                        32850000
*                                                                       32940000
AFAPAR80 L     REGC,KEY(PARM)           LOAD KEY ADDRESS AND            33030000
         MVC   WKADDR,0(REGC)            PUT FIRST WORD IN NEW KEY      33120000
         B     AFAPAR65                                                 33210000
*                                                                       33300000
*PREPARE FOR SEARCH ON CORRVAL                                          33390000
*                                                                       33480000
AFAPAR85 CLC   WKCORVL,ZERO                                             33570000
         BE    AFAERR00                 BAD PARAMETER COMBINATION       33660000
         LA    REGB,WKCORVL             PREPARE PARAMS FOR SEARCH ON    33750000
         ST    REGB,WKKADDR                CORRVAL                      33840000
         LA    REGB,FIVE                WORK CODE FOR SEARCH ON CORRVAL 33930000
         B     AFAPAR55                                                 34020000
         EJECT                                                          34110000
*                                                                       34200000
*THIS SECTION INITIALIZES FOR CHARACTER OUTPUT. IF IT IS AN UPDATE,     34290000
*GDOA'S ARE OBTAINED. IF THE ELEMENT IS KEYED OR CORRVALED, THE         34380000
*INCLUDE OMIT STRUCTURE IS BUILT                                        34470000
AFADAT10 CLI   WKSWITCH,UPDATE                                          34560000
         BE    AFADAT70                 BRANCH IF UPDATE                34650000
         L     REGD,GDSAOACB            OACB                            34740000
         L     REGD,CURRLOG(REGD)       LOGICAL START                   34830000
         STH   REGD,WKADDR+2            IN ELEMENT                      34920000
*                                                                       35010000
*CHECK FOR KEY AND CORRVAL                                              35100000
*                                                                       35190000
AFADAT25 TM    WKSWITCH+2,KEYED+CORRE                                   35280000
         BZ    AFAPOS10                 BRANCH IF NO KEY OR CORRVAL     35370000
*                                                                       35460000
*SET UP TO CALL DATA STORE                                              35550000
*                                                                       35640000
         ST    GDSREG,WKGDS1            ADDRESS OF GDSCB                35730000
         MVC   WKRTN1,WKRTNCD           ADDRESS OF RETURN ARRAY         35820000
         LA    REGC,WKOUTPT+4           ADDRESS OF ORDERS               35910000
         XC    WKOUTPT(4),WKOUTPT       ZERO FIRST WORD                 36000000
         TM    WKBITS,INCLUDE                                           36090000
         BO    AFADAT75                 BRANCH IF INCLUDE STATUS        36180000
         MVC   0(4,REGC),GTRUORD        MOVE IN GTRU                    36270000
AFADAT30 MVI   WKOUTPT,UNRES                                            36360000
         NI    GDSGRMOD,CONTROL         SET TO CONTROL MODE             36450000
         LA    REGD,4                                                   36540000
         STH   REGD,WKOUTPT+2           SET LENGTH TO 4                 36630000
         LA    PARM,WKGDS1                                              36720000
*/                                                                      36810000
*/CALL DATA STORE TO SET UP INCLUDE/OMIT STRUCTURE                      36900000
*/                                                                      36990000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         37080000
         L     BRANCH,DSTORE(BRANCH)    ADDRESS OF DATA STORE           37170000
         BALR  RETREG,BRANCH                                            37260000
*                                                                       37350000
         LTR   BRANCH,BRANCH                                            37440000
         BNE   AFARES11                                            0544 37530000
         L     REGD,GDSAOACB           OACB                             37620000
         L     REGD,CURRLOG(REGD)      LOGICAL ADDRESS IN BUFFER        37710000
         S     REGD,FOUR               POINT TO ELEMENT START           37800000
         STH   REGD,WKADDR+2           AND STORE IN KEY                 37890000
         B     AFAPOS10                                                 37980000
         EJECT                                                          38070000
*CALL TO GET GDOA'S FOR UPDATE                                          38160000
*                                                                       38250000
AFADAT70 LA    PARM,WKADDR              PARAMETER LIST ADDRESS          38340000
         L     BRANCH,STABADR(ERRCD) POINT TO STATUS TABLE  D11 ZA15418 38430000
         L     BRANCH,UPDH13(BRANCH) AND TO IFFAHA13        D11 ZA15418 38520000
         BALR  RETREG,BRANCH       GOTO UPDATE              D11 ZA15418 38610000
         LTR   BRANCH,BRANCH                                            38700000
         BE    AFADAT25                 BRANCH IS SUCCESSFUL            38790000
         B     AFAERR81                                            0544 38880000
*                                                                       38970000
*SET UP INCLUDE-OMIT STRUCTURE FOR INCLUDE                              39060000
*                                                                       39150000
AFADAT75 MVC   0(4,REGC),GNOPORD        MOVE IN GNOP                    39240000
         B     AFADAT30                                                 39330000
     EJECT                                                              39420000
*THIS SECTION CALLS MVPOS IF THE X AND Y COORDINATES WERE PASSED        39510000
*                                                                       39600000
AFAPOS10 MVC   WKXCURR(4),GDSXCURR      SAVE X-Y CURR                   39690000
         MVC   WKXLAST(8),GDSXLAST      SAVE X- Y LAST                  39780000
AFAPOS20 TM    WKSWITCH+1,POS                                           39870000
         BZ    AFASCS30                 BRANCH IF POSITION NOT REQ      39960000
*SET UP PARAMETERS FOR MOVE POSITION                                    40050000
*                                                                       40140000
         MVC   WKSWITCH+3(1),GDSFLAGS                                   40230000
         TM    WKBITS+3,MEMSUB          TEST FOR GENERATING OR UPDATING 40320000
         BZ    AFAPOS15                  SUBR- BRANCH IF NOT            40410000
         TM    GDSFLAGS,SUBR                                            40500000
         BO    AFAPOS15                 BRANCH IF GENERATING SUBR       40590000
*                                                                       40680000
*IF UPDATING SUBROUTINE, GDSFLAGS MUST BE CHANGED FOR MOVE POSITION     40770000
*                                                                       40860000
         OI    GDSFLAGS,SUBR            SET SWITCH FOR SUBROUTINE       40950000
AFAPOS15 L     PARM,WKPARM             RESTORE PARM REGISTER            41040000
         LA    REGC,WKGDSADR            ADDRESS OF PARAM LIST           41130000
         ST    REGC,WKPARM1                                             41220000
         ST    ERRCD,WKRTN2            ADDRESS OF RETURN ARRAY          41310000
         MVC   WKGDSADR(4),GDS(PARM)    ADDRESS OF GDSCB VARIABLE       41400000
         MVC   WKUVAL(8),X(PARM)        ADDRESS OF X AND Y PARAMS       41490000
         OI    WKVVAL,LAST              SET LAST PARAMETER SWITCH       41580000
*/                                                                      41670000
*/CALL MVPOS TO POSITION BEAM                                           41760000
*/                                                                      41850000
         LA    PARM,WKPARM1             ADDRESS OF PARAM LIST           41940000
         L     REGB,STAT(ERRCD)         ADDRESS OF STATUS TABLE         42030000
         L     BRANCH,MVPOS(REGB)       START ADDRESS OF ROUTINE        42120000
         LTR   BRANCH,BRANCH            IF ZERO, ROUTINE NOT IN,        42210000
         BZ    AFAPOS30                 GO TO LINK OR LOAD              42300000
*                                                                       42390000
*BRANCH AND LINK TO MOVE POSITION                                       42480000
*                                                                       42570000
AFAPOS16 BALR  RETREG,BRANCH                                            42660000
         SPACE 2                                                        42750000
*TEST RETURN ARRAY AFTER CALL TO MVPOS                                  42840000
*                                                                       42930000
AFAPOS17 MVC   GDSFLAGS(1),WKSWITCH+3   REPLACE GDSFLAGS                43020000
         CLI   0(ERRCD),OFF                                             43110000
         BE    AFASCS30                 BRANCH IF CALL TO MVPOS O.K.    43200000
         CLI   0(ERRCD),SCISSON                                         43290000
         BNE   AFAERR90                                                 43380000
         TM    GDSSCISS,STOP                                            43470000
         BO    AFAERR90                BRANCH IF STOP GENERATION        43560000
*                                        OPTION SET.                    43650000
     EJECT                                                              43740000
*WHEN THIS SECTION IS ENTERED, THE BEAM HAS BEEN POSITIONED TO THE      43830000
*START OF THE CHARACTER STRING. IF THE SCISSOR OPTION IS IN EFFECT      43920000
*A VECTOR THE LENGTH OF THE CHARACTER STRING MUST BE SCISSORED.         44010000
*                                                                       44100000
AFASCS30 TM    WKBITS+3,MEMSUB                                          44190000
         BO    AFASET20                 BRANCH IF SUBROUTINE-NO SCISS,  44280000
*                                        NO BEAM REPOSITIONING          44370000
         TM    GDSSCISS,NOSCISS                                         44460000
         BO    AFASET10                 BRANCH IF NO SCISSORING.        44550000
*                                                                       44640000
*SCISSORING OPTION IN EFFECT                                            44730000
*IF THE CURRENT BEAM POSITION IS OFF TO THE LEFT OF THE SCREEN, THE     44820000
*BEGINNING OF THE TEXT STRING MUST BE SCISSORED.                        44910000
*                                                                       45000000
         LH    REGA,GDSXCURR                                            45090000
         S     REGA,GDSXLAST            AMOUNT TO BE SCISSORED FROM     45180000
*                                       FRONT OF CHARACTER STRING       45270000
         C     REGA,THREE                                               45360000
         BH    AFASCS32                 IF SCISS LESS THAN 3  NO SCISS  45450000
         SR    REGA,REGA                IF OFF TO RIGHT, EVERYTHING OFF 45540000
*                                                                       45630000
*THE AMOUNT TO BE SCISSORED FROM LEFT (IN RASTER UNITS) IS SAVED.       45720000
*THE CHARACTER COUNT IS MULTIPLIED BY RASTER UNITS/CHARACTER (56 FOR    45810000
*BASIC, 84 FOR LARGE) TO DETERMINE THE INCREMENT IN THE X DIRECTION,    45900000
*WHICH IS PASSED TO SCISSOR. THE Y COORDINATE REMAINS UNCHANGED         45990000
*                                                                       46080000
AFASCS32 ST    REGA,WKSCI1                                              46170000
         LR    EVEN,COUNT                                               46260000
         TM    GDSCHARS,LARGE                                           46350000
         BM    AFASCS90                 BRANCH IF CHARACTERS LARGE      46440000
         MH    EVEN,SMALL+2             56 RASTER UNITS/CHARACTER       46530000
*                                        IF CHARACTERS BASIC            46620000
*REGISTER 0 CONTAINS LENGTH IN RASTER UNITS OF CHARACTER STRING         46710000
*                                                                       46800000
*SET UP PARAMETERS FOR SCISSOR                                          46890000
AFASCS35 ST    EVEN,WKXINCR                                             46980000
         A     EVEN,GDSXLAST            X ABSOLUTE                      47070000
         ST    EVEN,WKXABS                                              47160000
         MVC   WKYABS(4),GDSYLAST       X POSITION UNCHANGED            47250000
*CALL TO SCISSOR ROUTINE                                                47340000
*                                                                       47430000
         LA    PARM,WKGDS                                               47520000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         47610000
         L     BRANCH,SCISS(BRANCH)     ADDRESS OF SCISSOR              47700000
         BALR  RETREG,BRANCH            BRANCH TO SCISSOR               47790000
         LTR   BRANCH,BRANCH                                            47880000
         BNE   AFARES05                 BRANCH IF NO DATA GENERATION    47970000
*                                                                       48060000
*ON RETURN FROM THE SCISSOR ROUTINE,THE AMOUNT (IN RASTER UNITS) TO BE  48150000
*SCISSORED FROM THE END OF THE TEXT STRING (IF ANY) IS COMPUTED AND     48240000
*SAVED.                                                                 48330000
*                                                                       48420000
         L     REGA,GDSXLAST                                            48510000
         SH    REGA,GDSXCURR                                            48600000
         BNL   AFASCS37                 BRANCH IF ON SCREEN, OR TO RGHT 48690000
         SR    REGA,REGA                                                48780000
AFASCS37 C     REGA,THREE               IF SCISSORED THREE OR LESS      48870000
         BH    AFASCS38                  RUS, IT IS IGNORED             48960000
         B     AFASC394            GO TO ZERO SCISSOR LENGTH       5962 49050000
AFASCS38 TM    GDSCHARS,LARGE      LARGE CHARS                     5962 49140000
         BM    AFASCS39            YES                             5962 49230000
         S     REGA,HALFSM         SUBTRACT 1/2 CHAR FOR                49320000
         B     AFASC392            CHAR GEN OVERLAP OF SCREEN EDGE 5962 49410000
AFASCS39 S     REGA,HALFBIG        SUB. 1/2 CHAR FOR CHRGEN             49500000
AFASC392 C     REGA,THREE          IF LESS THAN 3 NO SCISS DONE    5962 49590000
         BH    AFASC396            NOT LESS                        5962 49680000
AFASC394 SR    REGA,REGA           ZERO SCISS REG                  5962 49770000
AFASC396 ST    REGA,WKSCI2         SAVE AMNT TO BE SCISSORED       5962 49860000
     EJECT                                                              49950000
*TEST FOR POSITIONING VECTOR NECESSARY                                  50040000
*IF  POSITIONING VECTOR IS NECESSARY, THE DATA GENERATION ROUTINE IS    50130000
*CALLED TO GENERATE THE BLANKED VECTOR.                                 50220000
*                                                                       50310000
         CLC   WKDATA1(8),ZERO                                          50400000
         BE    AFASCS40                BRANCH IF POSITIONING VECTOR     50490000
*                                        UNNECESSARY                    50580000
         MVC   WKXABS(16),WKDATA1       SET UP PARMS FOR DATA GEN       50670000
         MVC   WKBITSA(4),WKBITS        SAVE KEY STRUCTURE              50760000
         MVC   WKBITS,BITSA             MOVE IN PARM FOR DATA GEN       50850000
         XC    WKDATA1(16),WKDATA1      ZERO POSITIONING VECTOR AREA    50940000
*                                                                       51030000
*CALL TO DATA GENERATION ROUTINE                                        51120000
*                                                                       51210000
         LA    PARM,WKADDR              ADDRESS OF PARAMETER LIST       51300000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         51390000
         L     BRANCH,DGEN(BRANCH)      ADDRESS OF DATA GEN             51480000
         BALR  RETREG,BRANCH            BRANCH TO DATA GEN              51570000
         LTR   BRANCH,BRANCH                                            51660000
         BNE   AFARES10                                                 51750000
         MVC   WKBITS(4),WKBITSA        RESET KEY SWITCHES              51840000
         EJECT                                                          51930000
*THIS SECTION COMPUTES THE SCISSORING NECESSARY FOR CHARACTERS          52020000
*REGISTER 1 IS USED AS A WORK REGISTER                                  52110000
*THE TOTAL AMOUNT TO BE SCISSORED (INRASTER UNITS) IS DIVIDED BY        52200000
*RASTER UNITS/CHARACTER. IF THERE IS A REMAINDER, 1 IS ADDED TO THE     52290000
*NUMBER OF CHARACTERS TO BE SCISSORED. IF THE SCISSORING OCCURS ONLY    52380000
*ON THE END OF THE TEXT STRING, THE COUNT IS DECREMENTED BY THE NUMBER  52470000
*OF CHARACTERS TO BE SCISSORED. IF SCISSORING OCCURS ONLY AT THE        52560000
*START OF THE TEXT STRING, THE POINTER TO THE TEXT ARRAY IS INCREMENTED 52650000
*BY THE NUMBER OF CHARACTERS TO BE SCISSORED, AND THE COUNT IS          52740000
*DECREMENTED BY THE NUMBER OF CHARACTERS TO BE SCISSORED. IF THERE      52830000
*IS SCISSORING AT BOTH START AND END, THE NUMBER OF CHARACTERS          52920000
*SCISSORED FROM EACH IS COMPUTED, AND ACTION PROCEEDS AS ABOVE.         53010000
*                                                                       53100000
*INITIALIZE WITH ADDRESS OF TEXT ARRAY                                  53190000
AFASCS40 L     PARM,WKPARM                                              53280000
         L     REGD,TXT(PARM)           PICK UP TEXT ADDRESS            53370000
*                                                                       53460000
         L     PARM,WKSCI1                                              53550000
         A     PARM,WKSCI2              TOTAL AMOUNT TO BE SICSSORED    53640000
         BZ    AFAGEN10                 BRANCH IF NOTHING SCISSORED     53730000
         SR    EVEN,EVEN                SET UP FOR DIVISION             53820000
         TM    GDSCHARS,LARGE                                           53910000
         BM    AFASCS85                 BRANCH IF CHARACTERS LARGE      54000000
         D     EVEN,SMALL               NO. CHARS TO BE SCISSORED=      54090000
*                                       NO. RASTER UNITS/56             54180000
AFASCS45 LTR   EVEN,EVEN                                                54270000
         BZ    AFASCS50                 BRANCH IF NO REMAINDER          54360000
         A     PARM,ONE                 OTHERWISE ADD 1 TO QUOTIENT     54450000
AFASCS50 LR    REGA,PARM                SAVE NO OF CHARS TO BE SCISS    54540000
         CR    REGA,COUNT                                               54630000
         BNL   AFARES05                 BRANCH IF NO DATA WILL BE       54720000
*                                        GENERATED                      54810000
         CLC   WKSCI1(4),ZERO                                           54900000
         BE    AFASCS65                 BRANCH IF NO SCISS AT START     54990000
         CLC   WKSCI2(4),ZERO                                           55080000
         BE    AFASCS60                 BRANCH IF NO SCISS AT END       55170000
         MVC   SCERR(4,ERRCD),ONE       SET SCISS COUNT TO 1,IF SCISS   55260000
*                                       AT START                        55350000
         L     PARM,WKSCI1              PICK UP RU'S TO BE SICSS FROM   55440000
         SR    EVEN,EVEN                 BEGINNING                      55530000
         TM    GDSCHARS,LARGE                                           55620000
         BM    AFASCS80                                                 55710000
         D     EVEN,SMALL               NO. CHARS SCISSORED FROM LEFT   55800000
AFASCS55 LTR   PARM,PARM                                                55890000
         BZ    AFASCS65                 BRANCH IF NO FULL CHAR OFF LEFT 55980000
AFASCS60 AR    REGD,PARM                UPDATE POINTER TO TEXT ARRAY    56070000
*                                        BY NUMBER OF CHARACTERS TO     56160000
*                                        BE SCISSORED.                  56250000
AFASCS65 SR    COUNT,REGA               NUMBER OF CHARACTERS TO BE      56340000
*                                        GENERATED                      56430000
*IF SCISSORING OCCURS, NEW CHARACTER COUNT MUST GO IN KEY               56520000
*                                                                       56610000
         STC   COUNT,WKBITS+2                                           56700000
         SRA   COUNT,8                                                  56790000
         STC   COUNT,WKBITS+1                                           56880000
*                                                                       56970000
*RESTORE COUNT IN REGISTER                                              57060000
         SLA   COUNT,8                                                  57150000
         IC    COUNT,WKBITS+2                                           57240000
         CLC   WKSCI1(4),ZERO                                           57330000
         BNE   AFAGEN10                 BRANCH IF SCISS AT START        57420000
         LA    COUNT,1(COUNT)                                           57510000
         ST    COUNT,SCERR(ERRCD)       SET CHARACTER SCISSORED NUMBER  57600000
*                                        IN RETURN ARRAY                57690000
         BCTR  COUNT,0                  RESET COUNT REGISTER            57780000
         B     AFAGEN10                                                 57870000
*                                                                       57960000
*                                                                       58050000
AFASCS80 D     EVEN,BIG                 NO OF CHARACTERS TO BE          58140000
         B     AFASCS55                  SCISSORED FROM FRONT           58230000
*                                                                       58320000
*                                                                       58410000
AFASCS85 D     EVEN,BIG                 NO. CHARS TO BE SICSSORED=      58500000
         B     AFASCS45                  NO. RASTER UNITS/84            58590000
*                                                                       58680000
*                                                                       58770000
AFASCS90 MH    EVEN,BIG+2               LENGTH OF CHARACTER STRING=     58860000
*                                  COUNT * 84 RASTER UNITS         5962 58950000
         B     AFASCS35            GEN OVERLAP                     5962 59040000
*                                                                       59130000
*                                                                       59220000
*LINK OR LOAD MOVE POSITION                                             59310000
*                                                                       59400000
AFAPOS30 TM    MVPOS+LNK(REGB),LINKSW   TEST LINK/LOAD FLAG        000C 59490000
         BO    AFAPOS40                 BRANCH IF YES                   59580000
         LOAD  EP=IFFAFA17                                              59670000
         ST    EVEN,MVPOS(REGB)        STORE ENT PT IN STATAB      5962 59760000
         LR    BRANCH,EVEN              PUT ENTRY POINT ADD IN 15       59850000
         S     EVEN,TWO                 FIND ENTRY POINT OF FA04   000C 59940000
         ST    EVEN,DSP04(REGB)         SAVE ADDR IN STATUS TABLE  000C 60030000
         LA    PARM,WKPARM1             RELOAD PARAM REGISTER           60120000
         B     AFAPOS16                                                 60210000
*                                                                       60300000
AFAPOS40 LINK  EP=IFFAFA17                                              60390000
         B     AFAPOS17                                                 60480000
         EJECT                                                          60570000
*THIS SECTION WILL BE ENTERED IF NO SCISSORING OPTION IS SET            60660000
*                                                                       60750000
*RESET BEAM POSITION IN GDSCB                                           60840000
AFASET10 LR    EVEN,COUNT                                               60930000
         TM    GDSCHARS,LARGE                                           61020000
         BM    AFASET50                 BRANCH IF CHARACTERS LARGE      61110000
         MH    EVEN,SMALL+2              OTHERWISE 56RU'S/CHARACTER     61200000
AFASET15 A     EVEN,GDSXLAST                                            61290000
         ST    EVEN,GDSXLAST                                            61380000
         SRA   EVEN,2                   ROUND X CURRENT FIELD TO        61470000
         SLA   EVEN,2                   MULTIPLE OF 4                   61560000
         STH   EVEN,GDSXCURR            REPOSITION X IN GDSCB           61650000
         NI    GDSSCISS,LASTON                                          61740000
*                                                                       61830000
*                                                                       61920000
AFASET20 L     PARM,WKPARM                                              62010000
         L     REGD,TXT(PARM)           ADDRESS OF TEXT ARRAY           62100000
         B     AFAGEN10                                                 62190000
*                                                                       62280000
*                                                                       62370000
*                                                                       62460000
AFASET50 MH    EVEN,BIG+2               IF LARGE CHARS, 84RU'S/CHAR     62550000
         B     AFASET15                                                 62640000
*                                                                       62730000
         EJECT                                                          62820000
*                                                                       62910000
*CHARACTER GENERATION                                                   63000000
*REGD CONTAINS BEGIN ADDRESS OF TEXT ARRAY                              63090000
*COUNT CONTAINS NUMBER OF CHARACTERS TO BE GENERATED                    63180000
*                                                                       63270000
*SET UP PARAMETERS FOR DATA STORE                                       63360000
*                                                                       63450000
AFAGEN10 ST    GDSREG,WKGDS1            ADDRESS OF GDSCB                63540000
         ST    ERRCD,WKRTN1             ADDRESS OF RETURN ARRAY         63630000
         LA    REGC,WKOUTPT+4           ADDRESS OF DATA AREA            63720000
         LA    REGB,36                  NUMBER OF BYTES IN OUTPUT AREA  63810000
         SR    REGA,REGA               SET WORK COUNT TO 0              63900000
*REGC CONTAINS ADDRESS OF OUTPUT AREA                                   63990000
*REGB CONTAINS COUNT OF BYTES REMAINING IN OUTPUT AREA                  64080000
*REGA CONTAINS A WORK COUNT FIELD                                       64170000
*                                                                       64260000
         TM    WKBITS+3,MEMSUB                                          64350000
         BZ    AFAGEN15                 BRANCH IF NOT PART OF SUBR      64440000
         TM    WKSWITCH+1,POS                                           64530000
         BO    AFAGEN15                 BRANCH IF POSITIONING VECTOR    64620000
         MVC   0(2,REGC),GEVI2ORD       OTHERWISE,ENSURE NO WRAP AROUND 64710000
         LA    REGC,2(REGC)             UPDATE POINTER AND              64800000
         S     REGB,TWO                 DECREMENT COUNT                 64890000
         A     REGA,TWO                 SET LENGTH TO 2                 64980000
*SET CHARACTER MODE                                                     65070000
*                                                                       65160000
AFAGEN15 TM    GDSCHARS,LP                                              65250000
         BO    AFAGEN85                 BRANCH IF CHARS LARGE, PROTECT  65340000
         TM    GDSCHARS,LU                                              65430000
         BO    AFAGEN90                 BRANCH IF CHARS LARGE, UNPROTEC 65520000
         TM    GDSCHARS,BP                                              65610000
         BO    AFAGEN95                 BRANCH IF CHARS BASIC, PROTECT  65700000
         MVC   0(2,REGC),CHRBU          SETS MODE-CHARS BASIC, UNPROTEC 65790000
         MVI   GDSGRMOD,GRBU            SET CURRENT MODE SW IN GDSCB    65880000
*                                                                       65970000
AFAGEN20 LA    REGC,2(REGC)             UPDATE POINTER AND              66060000
         S     REGB,TWO                  DECREMENT COUNT                66150000
         A     REGA,TWO                                                 66240000
         CR    COUNT,REGB                                               66330000
         BH    AFAGEN70                 BRANCH IF MORE CHARS THAN ROOM  66420000
*                                        IN OUTPUT AREA                 66510000
         AR    REGA,COUNT               COMPUTE LENGTH FOR FIRST TIME   66600000
AFAGEN25 ST    REGA,WKOUTPT            LENGTH STORED IN OUTPUT AREA     66690000
         LR    REGA,COUNT                                               66780000
         SR    COUNT,REGA               SET COUNT FOR NEXT TIME         66870000
AFAGEN27 BCTR  REGA,0                   DECREMENT COUNT BY 1            66960000
         EX    REGA,MOVE                MOVE IN CHARACTERS              67050000
         LTR   COUNT,COUNT                                              67140000
         BNE   AFAGEN30                 BRANCH IF MORE CALLS NECESSARY  67230000
*                                                                       67320000
         TM    WKOUTPT+3,ODD                                            67410000
         BZ    AFAGEN30                 BRANCH IF LENGTH EVEN           67500000
         LA    REGA,1(REGA)             SET UP INDEX                    67590000
         AR    REGC,REGA                POINTER TO OUTPUT AREA          67680000
         MVI   0(REGC),ALIGN            MOVE IN NULL CHARACTER TO ALIGN 67770000
         SR    REGA,REGA                                                67860000
         IC    REGA,WKBITS+1           PICK UP CHARACTER COUNT FROM KEY 67950000
         SLA   REGA,8                                                   68040000
         IC    REGA,WKBITS+2                                            68130000
         LA    REGA,1(REGA)            ADD 1 TO CHAR COUNT FOR NULL CHR 68220000
         STC   REGA,WKBITS+2                                            68310000
         SRA   REGA,8                                                   68400000
         STC   REGA,WKBITS+1                                            68490000
         LA    REGA,1                                                   68580000
         AH    REGA,WKOUTPT+2                                           68670000
         STH   REGA,WKOUTPT+2           RESET LENGTH INDICATOR IN PARM  68760000
         EJECT                                                          68850000
*CALL DATA STORE                                                        68940000
*                                                                       69030000
AFAGEN30 LA    PARM,WKGDS1                                              69120000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         69210000
         L     BRANCH,DSTORE(BRANCH)    ADDRESS OF DATA STORE           69300000
         BALR  RETREG,BRANCH            BRANCH TO DATA STORE            69390000
         B     RC(BRANCH)               BRANCH ON RETURN CODE    YM1963 69480000
RC       B     CHRCNT                   DATA STORE SUCCESSFULLY  YM1963 69570000
         B     AFARES10                 DATA STORE FAILED        YM1963 69660000
         MVC   GDSXCURR(4),WKXCURR      IF UPDATE OVERFLOW....   YM1963 69750000
         MVC   GDSXLAST(8),WKXLAST      RESTORE BEAM POINTERS    YM1963 69840000
         B     AFARET20                 RETURN TO CALLER         YM1963 69930000
CHRCNT   C     COUNT,ZERO               ANY MORE CHARACTERS??    YM1963 70020000
         BE    AFATST10                 BRANCH IF NO MORE CHARACTERS    70110000
*                                       TO BE GENERATED.                70200000
*REINITIALIZE FOR NEXT PASS                                             70290000
*                                                                       70380000
*                                                                       70470000
*ADJUST POINTER TO TEXT ADDRESS                                         70560000
         LA    REGD,1(REGA,REGD)        NEW ADDR= OLD + COUNT OF CHARS  70650000
*                                                                       70740000
*RESET OUTPUT AREA POINTER + COUNT                                      70830000
         LA    REGC,WKOUTPT+4                                           70920000
         LA    REGB,36                  LENGTH OF OUTPUT AREA           71010000
         LR    REGA,COUNT                                               71100000
         CR    COUNT,REGB                                               71190000
         BNH   AFAGEN25                 BRANCH IF ALL CHARS WILL GO OUT 71280000
         LR    REGA,REGB                                                71370000
         ST    REGA,WKOUTPT             SET LENGTH                      71460000
         SR    COUNT,REGA               RESET CHARACTER COUNT           71550000
         B     AFAGEN27                                                 71640000
*                                                                       71730000
*                                                                       71820000
*                                                                       71910000
*                                                                       72000000
AFAGEN70 SR    COUNT,REGB               SET CHARACTER COUNT             72090000
         AR    REGA,REGB                                                72180000
         ST    REGA,WKOUTPT             SET LENGTH PARAMETER            72270000
         LR    REGA,REGB                # OF CHARS OUTPUT               72360000
         B     AFAGEN27                                                 72450000
*                                                                       72540000
AFAGEN85 MVC   0(2,REGC),CHRLP          CHARS LARGE, PROTECTED          72630000
         MVI   GDSGRMOD,GRLP            SET CURRENT MODE SW IN GDSCB    72720000
         B     AFAGEN20                                                 72810000
*                                                                       72900000
AFAGEN90 MVC   0(2,REGC),CHRLU          CHARS LARGE, UNPROTECTED        72990000
         MVI   GDSGRMOD,GRLU            SET CURRENT MODE SW IN GDSCB    73080000
         B     AFAGEN20                                                 73170000
*                                                                       73260000
AFAGEN95 MVC   0(2,REGC),CHRBP          CHARS BASIC, PROTECTED          73350000
         MVI   GDSGRMOD,GRBP            SET CURRENT MODE SW IN GDSCB    73440000
         B     AFAGEN20                                                 73530000
         EJECT                                                          73620000
*                                                                       73710000
*THIS SECTION IS ENTERED AFTER THE CHARACTERS HAVE BEEN GENERATED       73800000
*                                                                       73890000
AFATST10 TM    WKSWITCH+2,KEYED+CORRE                                   73980000
         BZ    AFATST12                BRANCH IF NO KEY OR CORRVAL      74070000
         XC    WKOUTPT(4),WKOUTPT       ZERO                            74160000
         MVI   WKOUTPT,RESOL                                            74250000
         LA    PARM,WKGDS1                                              74340000
         L     BRANCH,STAT(ERRCD)       ADDRESS OF STATUS TABLE         74430000
         L     BRANCH,DSTORE(BRANCH)   ADDRESS OF DATA STORE            74520000
         BALR  RETREG,BRANCH            BRANCH TO DATA STORE            74610000
         LTR   BRANCH,BRANCH                                            74700000
         BNE   AFARES10                                                 74790000
AFATST12 CLI   WKSWITCH,UPDATE                                          74880000
         BE    AFATST30                 BRANCH IF UPDATE                74970000
*                                                                       75060000
*PREPARE KEY                                                            75150000
*                                                                       75240000
         L     COUNT,GDSAOACB                                           75330000
         L     COUNT,CURRLOG(COUNT)     GET CURRENT LOGICAL ADDRESS     75420000
         SH    COUNT,WKADDR+2           COMPUTE ELEMENT LENGTH          75510000
         LTR   COUNT,COUNT                                              75600000
         BZ    AFAERR70                 ERROR IF NO DATA GENERATED      75690000
         STH   COUNT,WKADDR             PLACE LENGTH IN KEY             75780000
         L     COUNT,WKKEY                                              75870000
         LTR   COUNT,COUNT                                              75960000
         BE    AFATST15                 BRANCH IF NO USER VARIABLE      76050000
         MVC   0(4,COUNT),WKADDR        PLACE KEY IN USER VARIABLE      76140000
AFATST15 TM    WKSWITCH+2,KEYED+CORRE                                   76230000
         BZ    AFARET10                 BRANCH IF NO KEY OR CORRVAL     76320000
*                                                                       76410000
*CALL KEY TABLE MANAGEMENT TO ADD KEY                                   76500000
*                                                                       76590000
         LA    REGA,ONE                 CODE FOR ADDING KEY TO TABLE    76680000
         ST    REGA,WKCODE                                              76770000
         LA    REGA,WKADDR              ADDRESS OF KEY                  76860000
         ST    REGA,WKKADDR                                             76950000
         ST    GDSREG,WKGDS1            ADDRESS OF GDSCB                77040000
         LA    PARM,WKGDS1                                              77130000
         L     REGA,STABADR(ERRCD)      GET STATUS TABLE ADDR      000C 77220000
         L     BRANCH,ETE(REGA)         GET ADDR OF HA03           000C 77310000
         BALR  RETREG,BRANCH                                       000C 77400000
         LTR   BRANCH,BRANCH                                            77490000
         BNE   AFAERR80                 BRANCH IF NOT ENOUGH STORAGE    77580000
*                                                                       77670000
         B     AFARET10                                                 77760000
         EJECT                                                          77850000
*CALL UPDATE TO WRITE OUT UPDATE                                        77940000
*                                                                       78030000
AFATST30 LA    PARM,WKADDR                                              78120000
         L     BRANCH,STABADR(ERRCD) POINT TO STATUS TABLE  D11 ZA15418 78210000
         L     BRANCH,UPDH14(BRANCH) AND TO IFFAHA14        D11 ZA15418 78300000
         BALR  RETREG,BRANCH       GOTO UPDATE              D11 ZA15418 78390000
         LTR   BRANCH,BRANCH       UPDATED OK                    A29414 78480000
         BZ    AFARET10              IF YES, CONTINUE            A29414 78570000
         OI    WORD1(ERRCD),IOERR    IF NO,  INDICATE I/O ERROR  A29414 78660000
         B     AFARET20                                          A29414 78750000
       SPACE     4                                                      78840000
AFARET10 CLI   WKSWITCH,UPDATE                                          78930000
         BNE   AFARET20                 BRANCH IF NOT UPDATE            79020000
         TM    WKSWITCH+2,CORRE                                         79110000
         BZ    AFARET20                 BRANCH IF NOT CORRELATED        79200000
         L     PARM,WKSTORAD            PICK UP KEY ADDRESS             79290000
         MVC   8(4,PARM),WKCORVL        PUT NEW CORRVAL IN KEY TABLE    79380000
AFARET20 L     SAVE,4(SAVE)                                             79470000
         RETURN (14,12),T                                               79560000
         EJECT                                                          79650000
AFAERR00 OI    0(ERRCD),PRM             PARAMETER ERROR                 79740000
         B     AFARET20                                                 79830000
*                                                                       79920000
AFAERR10 MVC   PARMERR(4,ERRCD),ONE     INVALID GDSCB                   80010000
         B     AFAERR00                                                 80100000
*                                                                       80190000
AFAERR20 MVC   PARMERR(4,ERRCD),TWO     INVALID TEXT-NULL               80280000
         B     AFAERR00                                                 80370000
*                                                                       80460000
AFAERR30 MVC   PARMERR(4,ERRCD),THREE   COUNT ERROR-                    80550000
         B     AFAERR70                                                 80640000
*                                                                       80730000
AFAERR40 MVC   PARMERR(4,ERRCD),FOUR    CORRVAL ERROR                   80820000
         B     AFAERR00                                                 80910000
*                                                                       81000000
AFAERR60 MVC   PARMERR(4,ERRCD),SIX     GENCODE ERROR                   81090000
         B     AFAERR00                                                 81180000
*                                                                       81270000
AFAERR70 OI    0(ERRCD),SCISSOR         NO DATA GENERATION              81360000
         B     AFARET20                                                 81450000
AFAERR80 OI    0(ERRCD),STRG            MAIN STORAGE EXCEEDED           81540000
         MVC   STOR(4,ERRCD),FOUR                                       81630000
         B     AFARES11                                            0544 81720000
*                                                                       81810000
AFAERR81 OI    0(ERRCD),STRG            MAIN STORAGE EXCEEDED      0544 81900000
*                                       FOR UPDATE                 0544 81990000
         MVC   STOR(4,ERRCD),FOUR       SET ERROR CODE             0544 82080000
         B     AFARES12                                            0544 82170000
*                                                                  0544 82260000
AFAERR90 TM    WKSWITCH+2,KEYED+CORRE                                   82350000
         BZ    AFARET20                RETURN IF NOT KEYED+CORRE        82440000
         B     AFARES10                OTHERWISE GO TO RESET            82530000
         EJECT                                                          82620000
*                                                                       82710000
*CALL RESET IF ERROR RETURN FROM DATA STORE                             82800000
*                                                                       82890000
AFARES05 MVC   SCERR(4,ERRCD),ONE       SET SCISS COUNT TO ONE IF       82980000
*                                        NO CHARS GENERATED             83070000
AFARES10 MVC   GDSXCURR(4),WKXCURR      RESTORE BEAM POINTERS           83160000
         MVC   GDSXLAST(8),WKXLAST                                      83250000
AFARES11 EQU   *                                                   0544 83340000
         CLI   WKSWITCH,UPDATE                                          83430000
         BE    AFATST30            WRITE UPDATE WITH NO DATA       5962 83520000
         MVC   WKDATA2(20),0(ERRCD)     SAVE RETURN ARRAY               83610000
AFARES12 EQU   *                                                   0544 83700000
         LA    REGA,GDSGDSCB            VAR HOLDING ADDRESS OF GDSCB    83790000
         ST    REGA,WKGDS                                               83880000
         LA    REGA,WKGDS               ADDRESS OF PARAMETER LIST       83970000
         ST    REGA,WKGDS1               STORED IN WORK AREA            84060000
         L     REGA,NULL(ERRCD)         NULL FOR CORRVAL IN PARM LIST   84150000
         ST    REGA,WKRTN                                               84240000
         LA    REGA,WKADDR              ADDRESS OF KEY IN PARM LIST     84330000
         ST    REGA,WKDATA1                                             84420000
         OI    WKDATA1,LAST             LAST PARM INDICATION            84510000
         ST    ERRCD,WKCODE             ERROR CODE IN PARM LIST         84600000
         LA    PARM,WKGDS1              ADDRESS OF WORK AREA            84690000
         L     BRANCH,STABADR(ERRCD) POINT TO STATUS TABLE  D11 ZA15437 84780000
         L     BRANCH,RESET(BRANCH) AND TO IFFAFA12 (RESET) D11 ZA15437 84870000
         LTR   BRANCH,BRANCH       RESET SPEC'D BY CALLER?  D11 ZA15437 84960000
         BZ    AFALINK1            NO,MUST USE SYSTEM LINK  D11 ZA15437 85050000
         BALR  RETREG,BRANCH       GOTO RESET               D11 ZA15437 85140000
         B     AFARTN1             RETURN FROM RESET        D11 ZA15437 85230000
AFALINK1 LINK  EP=IFFAFA12         LINK TO RESET            D11 ZA15437 85320000
AFARTN1  MVC   0(20,ERRCD),WKDATA2 RESTORE RETURN ARRAY     D11 ZA15437 85410000
         B     AFARET20                                                 85500000
         EJECT                                                          85590000
MOVE     MVC   0(0,REGC),0(REGD)                                        85680000
         SPACE 2                                                        85770000
ZERO     DC    D'0'                                                     85860000
ONE      DC    F'1'                                                     85950000
TWO      DC    F'2'                                                     86040000
THREE    DC    F'3'                                                     86130000
FOUR     DC    F'4'                                                     86220000
FIVE     DC    F'5'                                                     86310000
SIX      DC    F'6'                                                     86400000
SEVEN    DC    F'7'                                                     86490000
EIGHT    DC    F'8'                                                     86580000
BIG      DC    F'84'                                                    86670000
SMALL    DC    F'56'                                                    86760000
HALFBIG  DC    F'42'                                                    86850000
HALFSM   DC    F'28'                                                    86940000
         SPACE 2                                                        87030000
BITS     DC    B'10001100'              MULTIPLE,CHARACTER, INCLUDE     87120000
         DC    X'00'                                                    87210000
         DC    X'00'                                                    87300000
         DC    X'00'                                                    87390000
*                                                                       87480000
*BITSA- PASSED TO DATA GENERATION IF POSITIONING VECTOR NECESSARY       87570000
*                                                                       87660000
BITSA    DC    B'10000100'              MULTIPLE, VECTOR, INCLUDE,      87750000
         DC    X'00'                    ABSOLUTE                        87840000
         DC    B'00000000'              FIRST PASS, NO KEY, NO CORRVAL, 87930000
         DC    X'00'                    BEAM OFF, NOT UPDATE            88020000
*ORDERS                                                                 88110000
*                                                                       88200000
         GINIT                                                          88290000
GTRUORD  GTRU  0                                                        88380000
GNOPORD  GNOP4 0                                                        88470000
GEVI2ORD GEVI2                                                          88560000
CHRBP    GECP  B                                                        88650000
CHRLP    GECP  L                                                        88740000
CHRBU    GECF  B                                                        88830000
CHRLU    GECF  L                                                        88920000
         DS    0F                                           D11         89010000
PATCH    DC    40X'FF'             PATCH AREA               D11         89100000
         EJECT                                                          89190000
WORKAREA DSECT                                                          89280000
WKPARM   DS    F                                                        89370000
WKRTNCD  DS    F                                                        89460000
WKSAVE   DS    18F                                                      89550000
WKXCURR  DS    H                                                        89640000
WKYCURR  DS    H                                                        89730000
WKXLAST  DS    F                                                        89820000
WKYLAST  DS    F                                                        89910000
WKBITSA  DS    F                                                        90000000
WKSWITCH DS    F                        FORMAT                          90090000
*                                       BYTE 0 -                        90180000
*                                         UPDATE = X'FF'                90270000
*                                       BYTE 1                          90360000
*                                         X COOR PASSED=X'10'           90450000
*                                         Y COOR PASSED=X'01'           90540000
*                                       BYTE2                           90630000
*                                         KEYED= X'20'                  90720000
*                                         CORRE= X'10'                  90810000
WKSCI1   DS    F                                                        90900000
WKSCI2   DS    F                                                        90990000
WKSPVSR  DS    3F                                                       91080000
WKTEMP   DS    F                                                        91170000
WKSTORAD DS    F                                                        91260000
*PARAMETERS PASSED TO DATA GENERATION ROUTINE                           91350000
WKADDR   DS    F                        *                               91440000
WKBITS   DS    F                        *KEY                            91530000
WKCORVL  DS    F                        *                               91620000
WKKEY    DS    F                        ADDRESS OF USER'S KEY VARIABLE  91710000
*PARAMETERS PASSED TO SCISSOR BEGIN HERE                                91800000
WKGDS    DS    F                        ADDRESS OF GDSCB                91890000
WKRTN    DS    F                        ADDRESS OF RETURN ARRAY         91980000
WKDATA1  DS    F                        *                               92070000
WKDATA2  DS    F                        *USED BY SCISSOR IF POSITIONING 92160000
WKDATA3  DS    F                        * VECTOR IS NECESSARY           92250000
WKDATA4  DS    F                        *                               92340000
WKXABS   DS    F                                                        92430000
WKYABS   DS    F                                                        92520000
WKXINCR  DS    F                                                        92610000
WKYINCR  DS    F                                                        92700000
WKTOTX   DS    F                                                        92790000
WKTOTY   DS    F                                                        92880000
WKENTCT  DS    F                                                        92970000
         EJECT                                                          93060000
*PARAMETERS PASSED TO KEY MANAGEMENT, DATA STORE, UPDATE, AND MVPOS     93150000
*FOR DATA STORE                                                         93240000
WKGDS1   DS    F                        ADDR OF GDSCB                   93330000
WKRTN1   DS    F                        ADDRESS OF RETURN ARRAY         93420000
WKOUTPT  DS    10F                                                      93510000
*FOR KEY MANAGEMENT                                                     93600000
*WKGDS1  EQU   WKGDS1                   ADDR OF GDSCB                   93690000
WKCODE   EQU   WKRTN1                   CODE                            93780000
WKKADDR  EQU   WKOUTPT                  KEY ADDRESS                     93870000
*                                                                       93960000
*                                                                       94050000
*FOR MOVPOS                                                             94140000
WKGDSADR EQU   WKGDS1                                                   94230000
WKUVAL   EQU   WKRTN1                                                   94320000
WKVVAL   EQU   WKOUTPT                                                  94410000
WKPARM1  EQU   WKOUTPT+4                                                94500000
WKRTN2   EQU   WKOUTPT+8                                                94590000
         COPY  GDSCB                                                    94680000
         COPY  GTMCB                                                    94770000
         END                                                            94860000
