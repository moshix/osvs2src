*                                                                       00100021
*                                                                       00200021
*                             RESET INPUT PARAMETER LIST                00300021
*                                                                       00400021
*                             +0   A(GDSVAR) VARIABLE CONTAINING        00500021
*                                            THE ADDRESS OF THE         00600021
*                                            GDSCB                      00700021
*                                                                       00800021
*                             OPTIONAL:                                 00900021
*                             +4   A(CORVAL) CORRELATION VALUE          01000021
*                             +8   A(KEY)    KEY                        01100021
*                                                                       01200021
*                                                                       01300021
*                                                                       01400021
*                                                                       01500021
*                                                                       01600021
*                                                                       01700021
*                                                                       01800021
*        RESET IS ENTERED FROM THE DIRECTOR PART 2 WHEN BEING CALLED    01900021
*        BY A PROGRAM EXTERNAL TO GSP.  INTERNALLY, RESET IS CALLED     02000021
*        FROM ANY DATA GENERATING ROUTINE (SUCH AS PLINE) WHICH         02100021
*        ENCOUNTERS AN ERROR WHILE GENERATING DATA AND MUST RESTORE     02200021
*        THE SYSTEM TO THE CONDITION BEFORE THE CALL.  THE WAY RESET    02300021
*        DETERMINES IF THE CALL IS FROM AN INTERNAL ROUTINE FOR A KEY   02400021
*        LEVEL 1 GDS IS THAT IS SEARCHES THE KEY TABLE FOR THE KEY.     02500021
*        IF THE KEY IS NOT FOUND, THE LENGTH FIELD OF THE KEY IS        02600021
*        CHECKED FOR ZERO.  IF THE LENGTH IS ZERO IT IS ASSUMED         02700021
*        THAT THE CALL IS FROM THE INTERNAL ROUTINE.                    02800021
*                                                                       02900021
*        EXTERNAL ROUTINES REFERENCES ARE:                              03000021
*        KEY TABLE MANAGEMENT-IFFAHA03                                  03100021
*        BUFFER MANAGEMENT-IFFAHA02                                     03200021
*        EXEC-IFFAFA11                                                  03300021
*                                                                       03400021
*        EXTERNAL MACROS USED ARE:                                      03500021
*        LINK                                                           03600021
*        GWRITE                                                         03700021
*        WAIT                                                           03800021
*                                                                       03900021
         EJECT                                                          04000021
IFFAFA12 CSECT                                                          04100021
*2101,111000,121000                                                000A 04150021
*                                                                       04200021
*        ON ENTRY RESET ESTABLISHES A BASE REGISTER, SET UP THE WORK    04300021
*        AREA DSECT, ZEROS THE RETURN ARRAY, AND CHAINS THE SAVE        04400021
*        AREAS.                                                         04500021
         SAVE  (14,12)                                                  04600021
         BALR  BASE,0                                                   04700021
         USING *,BASE                                                   04800021
         LR    WORK,PARM           SET UP WORK AREA DSECT               04900021
         USING WORKAREA,WORK                                            05000021
         L     PARM,WRKPARM        LOAD ADDR OF PARM LIST               05100021
         L     ERRCD,WRKRTNCD                                           05200021
         XC    WRKSPVSR(12),WRKSPVSR ZERO SUPERVISOR PARAMETER LIST     05300021
         XC    0(20,ERRCD),0(ERRCD) ZERO RETURN ARRAY                   05400021
         ST    SAVE,WRKSAVE+4      CHAIN SAVE AREAS                     05500021
         LA    REGA,WRKSAVE                                             05600021
         ST    REGA,8(SAVE)                                             05700021
         LR    SAVE,REGA                                                05800021
*                                                                       05900021
*        RESET PICKS UP THE FIRST PARAMETER, THE GDSCB ADDRESS, INIT-   06000021
*        IALIZES THE DSCET AND CHECKS ITS VALIDITY.  IF VALID IT        06100021
*        NEXT INITIALIZES THE GTMCB DSECT.  IT ZEROS THE CORVAL         06200021
*        AND KEY LOCATION.  THE KEY IS THE FULL THREE WORDS OF          06300021
*        THE ACTUAL KEY THAT WOULD BE EXPECTED BACK FROM KEY            06400021
*        TABLE MANAGEMENT.                                              06500021
         L     GDSREG,GDS(PARM)    PICK UP ADDRESS OF GDSCB             06600021
         L     GDSREG,0(GDSREG)                                         06700021
         USING GDSCB,GDSREG        SET UP DSECT                         06800021
         C     GDSREG,GDSGDSCB     IS GDSCB VALID                       06900021
         BNE   ERR1                NO                                   07000021
         L     GTMREG,GDSGTMCB                                          07100021
         USING GTMCB,GTMREG        SET UP GTMCB DSECT                   07200021
         XC    WRKCORVL,WRKCORVL   ZERO CORVAL                          07300021
         XC    WRKKEY(12),WRKKEY   ZERO KEY                             07400021
         EJECT                                                          07500021
*                                                                       07600021
*        A CHECK IS MADE TO SEE IF THE GDS IS THE LAST PARAMETER        07700021
*        PASSED IN WHICH CASE THE ENTIRE GDS MUST BE RESET.  IF         07800021
*        THIS IS THE CASE A DUMMY KEY IS SET UP WITH A LOGICAL          07900021
*        ADDRESS OF ZERO.                                               08000021
         TM    GDS(PARM),LAST      IS THERE ONLY ONE PARM               08100021
         BO    RST00800            YES, RESET ENTIRE GDS                08200021
*                                                                       08300021
*        THE ADDITIONAL PARAMETERS, KEY AND CORVAL ARE CHECKED.         08400021
*        IF THE KEY IS PASSED THAT IS WHAT IS USED TO SEARCH THE        08500021
*        KEY TABLE.  IF THE KEY IS NOT FOUND, AND IN FACT WAS           08600021
*        PASSED, AND THE LENGTH IF THE KEY IS ZERO IT IS ASSUMED        08700021
*        THAT THIS IS A GSP RESET AND THE KEY TABLE RESET IS            08800021
*        BYPASSED.  IF THE KEY IS FOUND IT IS PLACED IN THE WORK        08900021
*        AREA AND THEN THE KEY TABLE IS RESET.  NOTE THAT FOR           09000021
*        LEVEL TWO ALL KEY TABLE MANIPULATION IS BYPASSED.              09100021
*                                                                       09200021
         CLC   NULL+1(3,ERRCD),CORVL+1(PARM)                            09300021
         BE    RST00100            YES                                  09500021
         L     REGB,CORVL(PARM)                                         09600021
         MVC   WRKCORVL,0(REGB)    PLACE CORVAL IN WORK AREA            09700021
RST00100 TM    CORVL(PARM),LAST    IS KEY PASSED                        09800021
         BO    RST00850                                                 09850021
         CLC   NULL+1(3,ERRCD),KEY+1(PARM) NULL                         09900021
         BE    RST00850            YES                                  09950021
         L     REGB,KEY(PARM)                                           10000021
         MVC   WRKKEY,0(REGB)      YES, PLACE KEY IN WORK AREA          10100021
         TM    GDSFLAGS,LEVEL2     IS THIS LEVEL 2                      10200021
         BO    RST00400            YES                                  10300021
         LA    REGB,WRKKEY                                              10400021
         ST    REGB,WRKPRLST+8     ADDR OF KEY                          10500021
         LA    REGB,KEYSRCH        SEARCH ON KEY CODE                   10600021
         EJECT                                                          10700021
RST00200 ST    REGB,WRKPRLST+4                                          10800021
         ST    GDSREG,WRKPRLST     ADDRESS OF GDSCB                     10900021
         LA    PARM,WRKPRLST                                            11000021
         L     REGB,GTMGSPCB       GET POINTER TO GSPCB            000A 11040021
         L     REGB,FE(REGB)       GET POINTER TO STATUS TABLE     000A 11080021
         L     REG15,ETE(REGB)     GET A&RS OF KEY TABLE MGMT      000A 11120021
         BALR  REG14,REG15         BRANCH TO KEY TABLE MGMT        000A 11160021
         LTR   REG15,REG15         FOUND                                11200021
         BNE   RST01000            NO                                   11300021
         MVC   WRKKEY(12),0(PARM)  SAVE ENTIRE KEY                      11400021
RST00300 LA    REGB,WRKKEY         BUILD PARM LIST TO RESET KEY TABLE   11500021
         ST    REGB,WRKPRLST+8     A KEY OF ZERO WILL RESET THE         11600021
         LA    REGB,RESETCDE       ENTIRE TABLE. FROM NOW ON A KEY      11700021
         ST    REGB,WRKPRLST+4     CONTAINING ZERO WILL                 11800021
         ST    GDSREG,WRKPRLST     SIGNIFY RESET THE ENTIRE GDS         11900021
         LA    PARM,WRKPRLST                                            12000021
         L     REGB,GTMGSPCB       GET POINTER TO GSPCB            000A 12040021
         L     REGB,FE(REGB)       GET POINTER TO STATUS TABLE     000A 12080021
         L     REG15,ETE(REGB)     GET ADRS OF KEY TABLE MGMT      000A 12120021
         BALR  REG14,REG15         BRANCH TO KEY TABLE MGMT        000A 12160021
         EJECT                                                          12200021
*                                                                       12300021
*        AT THIS POINT ALL POSSIBLE CASES THAT HAVE NOT EXITED          12400021
*        BECAUSE OF ERRORS ARE TOGETHER FOR THE LAST TIME.              12500021
*        WE HAVE A GUY RESETING THE GDS.  FOR THAT WRKKEY CONTAINS      12600021
*        ZERO.  THERE IS THE GUY RESETING A KEY OR CORVAL LEVEL         12700021
*        ONE.  FOR HIM WE HAVE A TWELVE BYTE KEY FROM THE KEY TABLE     12800021
*        CONTAINING ASSORTED INFORMATION ABOUT THE ELEMENT WE ARE       12900021
*        RESETING TO.  LAST WE HAVE A LEVEL TWO KEY OR A GSP            13000021
*        RESET KEY CONTAINING A LOGICAL BUFFER ADDRESS BUT NO           13100021
*        INFORMATION ABOUT THE ELEMENT WE ARE RESETING TO.              13200021
*        WE WILL SET UP THE OACB DSECT AND THE PROCESSING WILL          13300021
*        SPLIT INTO TWO PATHS.  ONE IS FOR THE RESET WHICH WILL         13400021
*        TAKE PLACE IN THE GDOA AND THE OTHER IS WHERE RESET            13500021
*        IN THE BUFFER.  NOTE THAT FOR EQUIVALENCE GDSS THE RESET       13600021
*        WILL ALWAYS BE IN THE GDOA.  ALSO, IF THE RESET IS             13700021
*        IN THE GDOA NO BUFFER WILL HAVE TO BE RELEASED SO THE          13800021
*        CALL TO BUFFER MANAGEMENT IS AT THE RESET TO THE BUFFER        13900021
*        ONLY.  A CHECK IS MADE TO SEE IF ANY DATA WAS EVER             14000021
*        GENERATED BECAUSE A RESET TO THE GDS MIGHT BE CALLED           14100021
*        BEFORE THIS.                                                   14200021
*                                                                       14300021
RST00400 LH    REGA,WRKKEY+2       LOAD LOGICAL START ADDR              14400021
         L     OACB,GDSAOACB       INITIALIZE OACB DSECT                14500021
         USING OACBARA,OACB                                             14600021
         TM    STATUS,NO           WAS BUFFER EVER ASSIGNED             14700021
         BO    RST00500            EXIT                                 14800021
         C     REGA,LOGSTRT        IS DATA IN GDOA                      14900021
         BL    RST00600            NO                                   15000021
         EJECT                                                          15100021
*                                                                       15200021
*        IF THE RESET IS IN THE GDOA THE LOGICAL CURRENT ADDRESS        15300021
*        IS SET TO THE ADDRESS IN THE KEY.  FOR THE RESET OF A          15400021
*        GDS THIS IS ZERO.  THE OLP IS SET BACK THE LENGTH OF THE       15500021
*        RESET.  THE LENGTH LEFT IS INCREASED THE LENGTH OF THE         15600021
*        RESET.  THE UNRESOLVED ADDRESS POINTER WHICH WOULD ALWAYS      15700021
*        BE SET FOR AN ELEMENT (NOT SEQUENCE OR SUBROUTINE) IS          15800021
*        SET TO ZERO.                                                   15900021
         L     REGB,LOGCURR        PICK UP LOGICAL CURRENT              16000021
         SR    REGB,REGA           SUBTRACT RESET LOGICAL TO DETERMINE  16100021
         ST    REGA,LOGCURR        LENGTH-KEY ADDR=NEW LOGCURR          16200021
         L     REGA,OLP            OLP                                  16300021
         SR    REGA,REGB           MINUS LENGTH OF RESET                16400021
         ST    REGA,OLP            IS NEW OLP                           16500021
         A     REGB,LENLEFT        LENGTH LEFT INCREASED BY LENGTH      16600021
         ST    REGB,LENLEFT        OF RESET                             16700021
         XC    CPU2(8),CPU2        ZERO UNRES ADDR POINTER              16800021
         EJECT                                                          16900021
*                                                                       17000021
*        A CHECK IS MADE TO SEE IF THERE IS A SEQUENCE OR SUBROUTINE    17100021
*        OPEN BEFORE THE RESET.  IF SO A CHECK IS MADE TO SEE IF        17200021
*        WE ARE RESETING WITHIN THE SEQUENCE OR SUBROUTINE, TO IT,      17300021
*        OR BEYOND IT.  IF WE ARE STILL WITHIN IT ALL SEQUENCE,         17400021
*        SUBROUTINE UPDATING IS COMPLETE.  IF WE ARE RESETING TO        17500021
*        IT, THE SEQUENCE, SUBROUTINE SWITCH IS SET TO ZERO,            17600021
*        THE GDSKEYSV ADDRESS IS SET TO ZERO AND THE UNRESOLVED         17700021
*        ADDRESS IN THE OACB, CPU1 OR BUF1 IS SET TO ZERO.  IF          17800021
*        WE ARE RESETING BEYOND IT A CHECK IS MADE TO SEE IF THIS       17900021
*        IS A SEQUENCE OR SUBROUTINE MEMBER KEY.  FOR A GDS, OR         18000021
*        A LEVEL TWO KEY THIS WILL ALWAYS BE ZERO.  IF THE KEY          18100021
*        DOES NOT BELONG TO A SEQUENCE OR SUBROUTINE THE SAME           18200021
*        PROCESSING TAKES PLACE AS FOR A RESET TO A SEQUENCE OR         18300021
*        SUBROUTINE KEY.  OTHERWISE THE KEY TABLE IS SEARCHED           18400021
*        FOR THE LAST SEQUENCE OR SUBROUTINE KEY BEFORE THIS            18500021
*        KEY (NOTE IT HAS ALREADY BEEN RESET TO THIS KEY SO             18600021
*        THE LAST KEY FOR A SEQUENCE OR SUBROUTINE WILL BE THE          18700021
*        ONE TO WHICH OUR KEY BELONGS.  THE SEQUENCE OR                 18800021
*        SUBROUTINE IS REOPENED BY SETTING THE LENGTH OF THE            18900021
*        SEQUENCE OR SUBROUTINE KEY IN THE KEY TABLE TO ZERO.           19000021
*        THE GDSKEYSV LOCATION IN THE GDSCB WILL BE SET TO THE          19100021
*        LOGICAL ADDRESS OF THE KEY AND THE SEQUENCE OR SUBROUTINE      19200021
*        STARTED WHICH WILL BE SET.  THE FLOW CONTROL RETURN ADDRESS    19300021
*        IS PLACED AT THE TOP OF THE SEQUENCE OR SUBROUTINE IN THE      19400021
*        GDOA AND THE CPU ADDRESS OF THE UNRESOLVED ADDRESS IS          19500021
*        SAVED IN THE CPU1 LOCATION IN THE OACB.                        19600021
*                                                                       19700021
RST00410 TM    GDSFLAGS,SEQ+SUB    IS A SEQ,SUB ALREADY OPEN            19800021
         BZ    RST00413            NO                                   19900021
         CLC   GDSKEYSV,WRKKEY+2   IS THIS THE ONE ALREADY OPEN         20000021
         BL    RST00440            WITHIN STARTED SEQ A OK              20100021
         BE    RST03200            RESET TO SEQUENCE KEY                20200021
RST00413 TM    WRKKEY+7,SEQM+SUBM  IS THE KEY SEQ OR SUBR MEMBER        20300021
         BZ    RST03200            NO ZERO SEQ AND EXIT                 20400021
         BAL   REG15,RST01920      SEARCH FOR DEQ KEY& CONVRT TO PHYSBF 20500021
         CLC   GDSGDOAL,H128       SUB SEG                              20600021
         BNE   RST00415            NO                                   20700021
         BAL   REG14,RST01100      GO GET SUBSEG ADDR                   20800021
         L     REGB,WRK128TP       PICK UP 128 START ADDR               20900021
RST00415 L     REGA,BLP            BUFFER LOAD POINT                    21000021
         SR    REGB,REGA           MINUS PHYS BUFFER                    21100021
         A     REGB,CRSA           POS IN GDOA OF START OF SEQ OR SUBR  21200021
         NI    GDSFLAGS,NTSEQSUB   ZERO SEQ/SUBR SW                     21300021
         L     REGC,WRKSEQKY       LOAD SEQ/SUBR KEY                    21400021
         TM    5(REGC),X'08'       SEQ                                  21500021
         BO    RST00420                                                 21600021
         OI    GDSFLAGS,SEQ        SET SEQ SW                           21700021
         B     RST00430                                                 21800021
         EJECT                                                          21900021
RST00420 OI    GDSFLAGS,SUB        SET SUBR SW                          22000021
         LA    REGB,8(REGB)        UPDATE TO INCLUDE OMIT               22100021
RST00430 LA    REGB,2(REGB)        TO THE ADDR                          22200021
         MVC   0(2,REGB),GDSOVDAT+2 MOVE IN FLOW CTL RTN ADDR           22300021
         ST    REGB,CPU1           SAVE CPU ADDR OF UNRES               22400021
         XC    BUF1,BUF1           ZERO BUFFER ADDR LOC                 22500021
         CLC   8(4,REGC),ZERO      IS IT CORRELATED                     22600021
         BNE   RST00440            NO                                   22700021
         OI    GDSFLAGS,CRVLPRES   SET CORRELATED FLAG IN GDS           22800021
*                                                                       22900021
*        A CHECK IS MADE TO SEE IF THIS IS AN EQUIVALENCE GDS WHICH     23000021
*        IS CURRENTLY IN THE BUFFER.  IF SO A CALL TO EXEC-IFFAFA11     23100021
*        IS MADE TO PLACE THE NEW COPY OF THE GDS OUT INTO THE BUFFER.  23200021
RST00440 TM    GDSFLAGS,EQUIV      IS THIS AN EQUIV IN THE BUFFER       23300021
         BZ    RST00500            NO EXIT                              23400021
         LA    REGA,GDSGDSCB       GDSCB                                23500021
         ST    REGA,WRKPRLST       IN PARM LIST                         23600021
         OI    WRKPRLST,LAST       SET LAST PARM SW                     23700021
         LA    REGA,WRKPRLST                                            23800021
         ST    REGA,WRKPRM         PARM LIST IN WORK AREA               23900021
         ST    ERRCD,WRKERR        FOR EXEC                             24000021
         LA    PARM,WRKPRM                                              24100021
         EJECT                                                          24200021
*//                                                                     24300021
*//      GO EXECUTE THIS EQUIVALENCE GDS                                24400021
*//                                                                     24500021
         LINK  EP=IFFAFA11,MF=(E,(1)),SF=(E,WRKSPVSR)                   24600021
*                                                                       24700021
*        THE CURRENT MODE SWITCH IS SET TO ZERO SO THAT THE NEXT        24800021
*        CALL TO A DATA GENERATING SUBROUTINE WILL GENERATE A SET       24900021
*        MODE ORDER.  CONTROL IS THEN RETURNED TO THE CALLING PROGRAM.  25000021
*                                                                       25100021
RST00500 MVI   GDSGRMOD,0          SET TO CONTROL MODE                  25200021
RST00550 L     SAVE,4(SAVE)        RETURN                               25300021
         RETURN (14,12),T                                               25400021
         EJECT                                                          25500021
*                                                                       25600021
*        IT HAS BEEN DETERMINED THAT THE RESET MUST TAKE PLACE          25700021
*        IN THE BUFFER.  A CHECK IS MADE TO SEE IF THE GDOA LENGTH      25800021
*        IS 128.  IF NOT THE LOGICAL ADDRESS OF THIS KEY IS DIVIDED     25900021
*        BY THE GDOA LENGTH LESS SIX FOR THE CONTROL BYTES TO DETER-    26000021
*        MINE WHICH SEGMENT OF BUFFER THIS BELONGS IN.  THE             26100021
*        QUOTIENT OF THE DIVIDE IS THE COUNT FIELD INTO THE BUFFER      26200021
*        CONTROL TABLE AND THE REMAINDER IS THE DISTANCE FROM THE       26300021
*        TOP OF THE SEGMENT THAT THIS LOGICAL ADDRESS IS LOCATED        26400021
*        AT.                                                            26500021
*                                                                       26600021
RST00600 CLC   GDSGDOAL,H128       IS GDOA A SUB SEGMENT                26700021
         BE    RST01050            YES, MUST BE HANDLED SEPARATELY      26800021
         SRDA  REGA,32             LOAD LOG INTO ODD REGISTER           26900021
         LH    REGC,GDSGDOAL       GDOA LEN                             27000021
         S     REGC,SIX            MINUS SIX                            27100021
         DR    REGA,REGC           DIVIDED INTO LOG ADDR=CT             27200021
         SR    REGD,REGD           ZERO REG                             27300021
         LH    REGC,GDSBCTEL       PICK UP DISPLACEMENT                 27400021
         MH    REGC,F3+2                                                27500021
         L     REG14,GTMBCTBL      TABLE ADDR                           27600021
RST00700 IC    REGD,2(REGC,REG14)  PICK UP COUNT                        27700021
         CR    REGD,REGB           EQUAL TO COUNT I HAVE                27800021
         BE    RST01300            YES                                  27900021
         IC    REGD,1(REGC,REG14)  PICK UP PTR TO NEXT                  28000021
         MH    REGD,F3+2                                                28100021
         CR    REGD,REGC           IS THIS LAST                         28200021
         BE    ERR2                                                     28300021
         LR    REGC,REGD                                                28400021
         SR    REGD,REGD                                                28500021
         B     RST00700                                                 28600021
RST00800 TM    GDSFLAGS,LEVEL2     LEVEL2                               28700021
         BO    RST00400            YES, DO NOT RESET KEY TABLE          28800021
         CLC   GDSKEYTB,ZERO       IS THERE A KEY TABLE                 28900021
         BE    RST00400            NO BYPASS DELETION                   29000021
         B     RST00300            RESET ENTIRE KEY TABLE               29100021
         EJECT                                                          29200021
RST00850 CLC   WRKCORVL,ZERO       IS IT CORRELATED                     29230021
         BE    RST00800            RESET GDS                            29260021
RST00900 LA    REGB,WRKCORVL       ADDR OF CORVL                        29300021
         ST    REGB,WRKPRLST+8                                          29400021
         LA    REGB,CORVSRCH       SEARCH ON CORVAL CODE                29500021
         B     RST00200            GO SEARCH                            29600021
RST01000 CLC   WRKKEY(2),ZERO      IS LENGTH IN KEY ZERO                29700021
         BE    RST00400            YES THIS IS A SYSTEM ERROR RESET     29800021
         B     ERR2                BAD KEY/CORVAL                       29900021
*                                                                       30000021
*        IF THE GDOA IS A SUBSEGMENT THE PHYSICAL ADDRESS OF THE        30100021
*        SUBSEGMENT IS COMPUTED AND THE LOGICAL ADDRESS IS THE          30200021
*        DISPLACEMENT INTO THE SEGMENT WHERE THE ELEMENT IS LOCATED.    30300021
*                                                                       30400021
RST01050 LA    REG14,RST01400                                           30500021
RST01100 LH    REGD,GDSBCTEL       PICK UP ELEM                         30600021
         M     REGC,F256                                                30700021
         LH    REGB,GDSBCTEL       DISP IN TABLE                        30800021
         MH    REGB,F3+2                                                30900021
         A     REGB,GTMBCTBL       ADDR OF TABLE                        31000021
         CLC   GDSBCTID,0(REGB)    IS SUBSEGMENT FIRST HALF             31100021
         BE    RST01200            YES                                  31200021
         AH    REGD,H128           NO, ADD 128 TO ADDR                  31300021
RST01200 LH    REGA,WRKKEY+2       LOAD LOG ADDR                        31400021
         ST    REGD,WRK128TP       SAVE 128 START                       31500021
         AR    REGD,REGA           COMPUTE BUFFER LOC                   31600021
         LA    REGD,2(REGD)        +2 FOR SET MODE                      31700021
         BR    REG14               RETURN TO CALLER                     31800021
         EJECT                                                          31900021
RST01300 L     REGD,F256           256                                  32000021
         ST    REGC,WRKDSP         SAVE DISP                            32100021
         M     REGC,WRKDSP         256 X DISP                           32200021
         D     REGC,F3             DIV BY 3                             32300021
         AR    REGD,REGA           PLUS DIST FROM TOP                   32400021
         LA    REGD,2(REGD)        +2 FOR SET MODE                      32500021
*                                                                       32600021
*        THE BUFFER ADDRESS IS SAVED.  THE CRSA IS SET EQUAL TO         32700021
*        THE GDOA AND SO IS THE OLP.  THE UNRESOLVED ADDRESS FOR AN     32800021
*        ELEMENT IS SET TO ZERO.  THE LOGICAL ADDRESS IN THE KEY        32900021
*        BECOMES THE LOGICAL CURRENT AND LOGICAL START ADDRESS.         33000021
*        THE BUFFER ADDRESS COMPUTED IS THE BLP.  IT IS ALSO THE        33100021
*        BUFFER START.  THE DISPLACEMENT INTO THE SEGMENT PLUS THE      33200021
*        SIX CONTROL BYTES SUBTRACTED FROM THE GDOA LENGTH BECOMES      33300021
*        THE LENGTH LEFT IN THE GDOA.  IF IT IS A SUBSEGMENT THE        33400021
*        CALL TO BUFFER MANAGEMENT IS BYPASSED.                         33500021
*                                                                       33600021
RST01400 ST    REGD,WRKBUFR        SAVE BUFFER ADDRESS                  33700021
         MVC   CRSA,GDOA           SET CRSA=GDOA                        33800021
         MVC   OLP,GDOA            SET OLP=CRSA,GDOA                    33900021
         XC    CPU2(8),CPU2        ZERO SECOND UNRES ADDR               34000021
         MVC   LOGSTRT+2(2),WRKKEY+2  SET UP NEW                        34100021
         MVC   LOGCURR,LOGSTRT     LOG START AND LOG CURRENT            34200021
         ST    REGD,BLP            SET UP BUFFER LOAD POINT             34300021
         ST    REGD,BUFSTART       AND BUFFER START                     34400021
         LH    REGB,GDSGDOAL       COMPUTE                              34500021
         S     REGB,SIX            LENGTH                               34600021
         SR    REGB,REGA           LEFT                                 34700021
         ST    REGB,LENLEFT        AND STORE                            34800021
         A     REGB,FOUR           ADD FOUR FOR TRANS ORD               34900021
         ST    REGB,BUFLEN          IN BUFFER LENGTH                    35000021
         CLC   GDSGDOAL,H128       IS THIS A SUBSEGMENT                 35100021
         BE    RST01600            YES                                  35200021
         EJECT                                                          35300021
*                                                                       35400021
*        HERE BUFFER MANAGEMENT IS CALLED PASSING IT IN DISPLACE-       35500021
*        MENT INTO THE BUFFER CONTROL TABLE OF THIS SEGMENT.  ANY       35600021
*        SUCCEEDING SEGMENTS WILL BE RELEASED TO THE SYSTEM BY          35700021
*        BUFFER MANAGEMENT.  A CHECK IS MADE TO SEE IF THE              35800021
*        REPLACEMENT DATA IF ANY IN THE GDSCB IS PART OF THE            35900021
*        RESET.  IF NOT IT IS LEFT AS IS.  IF YES THE FIELDS ARE        36000021
*        ZEROED AND THE FLAG TO SAVE THE NEXT FOUR BYTES AS             36100021
*        REPLACEMENT DATA ARE SET IN THE OACB FOR THE NEXT OVERFLOW.    36200021
*                                                                       36300021
         MVC   WRKPRLST(4),SIX     NO GO TO UBFFER MANAGEMENT           36400021
         ST    GDSREG,WRKPRLST+4   TO RESET BUFFER                      36500021
         L     PARM,WRKDSP                                              36600021
         SR    REG0,REG0                                                36700021
         D     REG0,F3                                                  36800021
         ST    PARM,WRKPRLST+8     DISP OF THIS ENTRY                   36900021
         LA    PARM,WRKPRLST                                            37000021
         ST    PARM,WRKPRM                                              37100021
         LA    PARM,WRKPRM                                              37200021
         ST    ERRCD,WRKERR                                             37300021
         L     REG15,STAT(ERRCD)                                        37400021
         L     REG15,BMGT(REG15)                                        37500021
         BALR  REG14,REG15         CALL BUFFER MANAGEMENT               37600021
         LH    REGB,GDSREPPB       PICK UP REPLACEMENT DATA ADDR        37700021
         LTR   REGB,REGB           ANY REPL DATA                        37800021
         BE    RST01600            NO                                   37900021
         EJECT                                                          38000021
         M     REGA,F3                                                  38100021
         D     REGA,F256           REFERENCE BCT FOR ENTRY FOR          38200021
         A     REGB,GTMBCTBL       THIS BUFFER ADDRESS                  38300021
         CLI   0(REGB),0           HAS BEEN RESET                       38400021
         BNE   RST03000            NO                                   38500021
RST01500 XC    GDSREPPB,GDSREPPB   ZERO REPLACEMENT DATA                38600021
         XC    GDSREPDT,GDSREPDT                                        38700021
         OI    STATUS,SAVEFOUR     SET  STATUS TO SAVE FOUR             38800021
RST01600 L     REGA,GTMDECB1       GRAPHIC DECB                         38900021
         L     REGB,GTMGRDCB       DCB                                  39000021
         LR    PARM,REGA                                                39100021
         WAIT  ECB=(1)             WAIT ON OLD I/O                      39200021
*                                                                       39300021
*        WE WILL NOW WRITE OUT A GTRU TO FLOW CONTROL                   39400021
*        AT THE ADDRESS DETERMINED. IN ALL CASES IT MAY                 39500021
*        NOT BE NEEDED BUT I CAN'T FIGURE OUT EASILY IF                 39600021
*        IT IS OR NOT                                                   39700021
*                                                                       39800021
         LR    PARM,REGA                                                39900021
         CLI   0(PARM),X'7F'                                            39920021
         BNE   ERR3                                                     39940021
         NI    0(PARM),X'BF'                                            39960021
         GWRITE (PARM),STR,(REGB),4,GDSOVDAT,BUFSTART+2,GDSFCBUF,MF=E   40000021
         EJECT                                                          40100021
*                                                                       40200021
*        A CHECK IS MADE TO SEE IF A SEQUENCE OR SUBROUTINE HAS BEEN    40300021
*        BEGUN BUT NOT COMPLETED.  IF YES A TEST IS MADE TO SEE IF      40400021
*        WE ARE RESETING WITHIN THE SEQUENCE OR SUBROUTINE, TO IT       40500021
*        OR BEYOND IT.  IF WE RESET TO THE SUBROUTINE OR SEQUENCE       40600021
*        THE FLAGS, UNRESOLVED ADDRESS AND LOGICAL ADDRESS OF THE       40700021
*        KEY IN THE GDSCB MUST BE SET TO ZERO.  IF WE ARE               40800021
*        RESETING BEYOND IT BUT NOT INTO ANOTHER SEQUENCE OR            40900021
*        SUBROUTINE THE SAME THING TAKES PLACE.  AFTER THIS CONTROL     41000021
*        IS RETURNED TO THE CALLING PROGRAM.                            41100021
*                                                                       41200021
RST01700 TM    GDSFLAGS,SEQ+SUB    IS SEQ/SUB BEGUN                     41300021
         BZ    RST01900            NO                                   41400021
         CLC   GDSKEYSV,WRKKEY+2   IS ELEMENT WITHIN THIS SEQ/SUB       41500021
         BL    RST00500            YES EXIT                             41600021
         BH    RST01900            NO                                   41700021
RST01750 NI    GDSFLAGS,NTSEQSUB   SET GDS NOT SEQ OR SUBR              41800021
         XC    CPU1(8),CPU1        ZERO UNRES ADDR                      41900021
         XC    GDSKEYSV,GDSKEYSV   ZERO ANY KEY                         42000021
         B     RST00500                                                 42100021
         EJECT                                                          42200021
*                                                                       42300021
*        WE NOW MUST FIND THE KEY TO THIS SEQUENCE OR SUBROUTINE,       42400021
*        AND REOPEN IT.  WE MUST SET UP AN UNRESOLVED ADDRESS           42500021
*        FOR THIS SEQ-SUBR AND GO INTO THE BUFFER  AND CHANGE           42600021
*        THE BRANCH ADDRESS OF THE INCLUDE/OMIT STRUCTURE TO            42700021
*        THE FLOW CONTROL RETURN ADDRESS SO THAT IF HE OMITS AN         42800021
*        UNFINISHED SEQ-SUBR HE WILL NOT BRANCH INTO BUFFER THAT        42900021
*        MAY NO LONGER BELONG TO HIM OR THAT CONTAINS OVERFLOW DATA     43000021
*                                                                       43100021
RST01900 TM    WRKKEY+7,SEQM+SUBM  IS THIS A SEQ/SUB MEMBER             43200021
         BZ    RST01750            NO RESET SW AND EXIT                 43300021
         LA    REG15,RST02750      SET TO FALL THROUGH                  43400021
RST01920 LH    REGA,WRKKEY+2       LOGICAL START ADDR OF KEY            43500021
         L     REGB,GDSKEYTB       KEY TABLE ADDR                       43600021
RST01950 LA    REGC,12(REGB)       ADDR OF FIRST KEY                    43700021
         L     REGD,4(REGB)        ADDR OF NEXT FREE LOCATION           43800021
RST02000 TM    4(REGC),X'20'       IS THIS KEY SEQ,SUBR,EOS, OR STROKE  43900021
         BO    RST02200            YES                                  44000021
RST02100 LA    REGC,12(REGC)       NEXT KEY                             44100021
         CR    REGC,REGD           ALL KEYS IN THIS TABLE CHECKED       44200021
         BNE   RST02000            NO                                   44300021
         L     REGB,0(REGB)        ALL TABLES CHECKED                   44400021
         LTR   REGB,REGB                                                44500021
         BZ    RST02300            YES                                  44600021
         B     RST01950            GO AGAIN                             44700021
         EJECT                                                          44800021
*                                                                       44900021
*        BECAUSE THE SEQUENCE/SUBROUTINE KEY IS THE LAST ONE IN         45000021
*        THE KEY TABLE, THE ADDRESS OF ANY KEY IS SAVED. THE            45100021
*        SECOND KEY REPLACES THE FIRST,ETC UNTIL THE ENTIRE             45200021
*        TABLE(S) IS SEARCHED. WHEN THIS IS DONE THE ADDRESS            45300021
*        I HAVE IS THE ADDRESS OF THE KEY I WANT.                       45400021
*                                                                       45500021
RST02200 TM    4(REGC),X'10'       IS THIS SEQ OR SUBR                  45600021
         BO    RST02100            NO                                   45700021
         ST    REGC,WRKSEQKY       SAVE                                 45800021
         B     RST02100                                                 45900021
RST02300 L     REGA,WRKSEQKY       PICK UP KEY ADDR                     46000021
         MVC   0(2,REGA),ZERO      ZERO LENGTH IN KEY                   46100021
         MVC   GDSKEYSV,2(REGA)    SAVE LOG ADDR OF KEY IN GDSCB        46200021
         LH    REGC,2(REGA)        OBTAIN LOGICAL ADDR OF KEY           46300021
         CLC   GDSGDOAL,H128       SUB SEGMENT                          46400021
         BE    RST02500            YES-WE ALREADY HAVE THE ADDR         46500021
         SRDA  REGC,32             SHIFT INTO ODD REGISTER              46600021
         LH    REGB,GDSGDOAL       GDOA LEN                             46700021
         S     REGB,SIX            MINUS SIX                            46800021
         DR    REGC,REGB           DIVIDE                               46900021
         L     REGA,GTMBCTBL                                            47000021
         LH    REGB,GDSBCTEL       BCT DISP                             47100021
         MH    REGB,F3+2                                                47200021
         SR    REG14,REG14                                              47300021
RST02400 IC    REG14,2(REGA,REGB)  PICK UP CNT FROM ENTRY               47400021
         CR    REG14,REGD          IS THIS THE SUBSEGMENT               47500021
         BE    RST02600            YES                                  47600021
         IC    REG14,1(REGA,REGB)  GET PTR TO NEXT                      47700021
         MH    REG14,F3+2                                               47800021
         CR    REG14,REGB          WAS THIS THE LAST                    47900021
         BE    ERR2                YES                                  48000021
         LR    REGB,REG14          KEEP LOOKING                         48100021
         SR    REG14,REG14                                              48200021
         B     RST02400                                                 48300021
RST02500 L     REGB,WRK128TP       ADDR OF 128 SUBSEGMENT               48400021
         B     RST02700                                                 48500021
         EJECT                                                          48600021
*                                                                       48700021
*        THE PHYSICAL BUFFER ADDRESS OF THE SEQUENCE MUST BE            48800021
*        COMPUTED SO THAT THE FLOW CONTROL ADDRESS CAN REPLACE          48900021
*        THE PREVIOUS RESOLVING ADDRESS THAT BRANCHES TO THE            49000021
*        END OF THE SEQUENCE.                                           49100021
*                                                                       49200021
RST02600 M     REGA,F256                                                49300021
         D     REGA,F3             COMPUTE PHYSICAL BEFFER ADDRESS      49500021
RST02700 AR    REGB,REGC           DISPL INTO PHYS ADDR                 49600021
         LA    REGB,2(REGB)        PLUS 2 FOR SET MODE                  49700021
         L     REGA,WRKSEQKY       LOAD SEQ-SUB KEY                     49800021
         BR    REG15                                                    49900021
         EJECT                                                          50000021
RST02750 NI    GDSFLAGS,NTSEQSUB   TURN OFF BOTH SWITCHES               50100021
         CLC   8(4,REGA),ZERO      CORRELATED                           50200021
         BNE   RST02770            NO                                   50300021
         OI    GDSFLAGS,CRVLPRES   SET SW                               50400021
RST02770 TM    4(REGA),X'08'       IS THIS A SEQUENCE                   50500021
         BO    RST02800            NO                                   50600021
         OI    GDSFLAGS,SEQ        SET SEQ SW                           50700021
         B     RST02900                                                 50800021
RST02800 OI    GDSFLAGS,SUB        SET SUBR SW                          50900021
RST02900 LA    REGB,2(REGB)        UPDATE TO ADDR LOCATION              51100021
         ST    REGB,WRKBUFR                                             51200021
         L     PARM,GTMDECB1       DECB                                 51300021
         WAIT  ECB=(1)             WAIT                                 51400021
         L     PARM,GTMDECB1                                            51500021
         CLI   0(PARM),X'7F'                                            51520021
         BNE   ERR3                                                     51540021
         NI    0(PARM),X'BF'                                            51560021
         L     REGA,GTMGRDCB       DCB                                  51600021
*                                  WRITE OUT F/C ADDR                   51700021
         GWRITE (PARM),STR,(REGA),2,GDSOVDAT+2,WRKBUFR+2,GDSFCBUF,MF=E  51800021
         ST    REGB,BUF1           SAVE LOC OF UNRES ADDR               51900021
         XC    CPU1,CPU1                                                52000021
         B     RST00500                                                 52100021
RST03000 CLC   WRKBUFR+2(2),GDSREPPB IS ADDR GR THAN OURS               52200021
         BH    RST03300            NO                                   52300021
         L     REGC,WRKBUFR                                             52400021
         A     REGC,LENLEFT        COMPUTE ADDR OF                      52500021
         LA    REGC,4(REGC)        END    OF SEGMENT                    52600021
         EJECT                                                          52700021
*                                                                       52800021
*        A CHECK IS MADE TO SEE IF THE REPLACEMENT DATA IS TO BE        52900021
*        RESET ALSO.  IF NOT IT IS LEFT AS IS.  IF YES, THE FIELDS      53000021
*        ARE SET TO ZERO AND THE FLAG TO SAVE THE NEXT FOUR BYTES       53100021
*        AS REPLACEMENT DATA ARE SET IN THE OACB FOR THE NEXT           53200021
*        OVERFLOW.                                                      53300021
         CH    REGC,GDSREPPB       IS ADDR LESS THEN END                53400021
         BH    RST01500            YES IT IS WITHIN AREA RESET          53500021
         B     RST01600            NO DO NOT RESET                      53600021
RST03200 NI    GDSFLAGS,NTSEQSUB   ZERO SEQ SUB SW                      53700021
         XC    CPU1(8),CPU1        ZERO UNRES ADDR                      53800021
         XC    GDSKEYSV,GDSKEYSV    SET SEQ KEY TO ZERO                 53900021
         B     RST00440                                                 54000021
RST03300 LH    REGC,GDSREPPB       ADDR FOR REPL DATA                   54005021
         A     REGC,F2                                                  54010021
         C     REGC,WRKBUFR        RESET HALF OF REP DATA               54015021
         BNE   RST01600            NO-DO NOT ZERO REP DATA              54020021
*        HALF THE REPLACEMENT DATA IS TO BE RESET. IT WILL BE RETURNED  54025021
*        TO THE GDOA AND THE PTRS WILL BE SET UP. THEN THE REPLACEMENT  54030021
*        DATA FIELDS IN THE GDSCB WILL BE ZEROED.                       54035021
         L     REGC,BUFSTART                                            54040021
         S     REGC,F2                                                  54045021
         ST    REGC,BUFSTART       BACK UP BUFFER START                 54050021
         ST    REGC,BLP            AND BLP                              54055021
         L     REGC,BUFLEN                                              54060021
         A     REGC,F2                                                  54065021
         ST    REGC,BUFLEN         ADD TWO TO LENGTH                    54070021
         L     REGC,OLP                                                 54075021
         MVC   0(2,REGC),GDSREPDT  MOVE FIRST TWO BYTES IN GDOA         54080021
         A     REGC,F2                                                  54085021
         ST    REGC,OLP            UPDATE OLP                           54090021
         B     RST01500            RESET REP DATA                       54095021
         EJECT                                                          54100021
ERR1     LA    REGA,ONE            FIRST PARM IN ERROR                  54200021
ERR1A    ST    REGA,PARER(ERRCD)                                        54300021
         OI    0(ERRCD),PRMER                                           54400021
         B     RST00550            RETURN                               54500021
ERR2     LA    REGA,TWO            CODE-BAD CORVAL                      54600021
         L     REGB,WRKKEY         IS THERE A KEY                       54700021
         LTR   REGB,REGB                                                54800021
         BZ    ERR1A               NO                                   54900021
         LA    REGA,ONE(REGA)      YES CODE FOR BAD KEY                 55000021
         B     ERR1A                                                    55100021
ERR3     OI    0(ERRCD),IO                                              55130021
         B     RST00550                                                 55160021
         EJECT                                                          55200021
*                                                                       55300021
*REGISTERS                                                              55400021
*                                                                       55500021
REG0     EQU   0                                                        55600021
PARM     EQU   1                                                        55700021
REGA     EQU   2                                                        55800021
REGB     EQU   3                                                        55900021
OACB     EQU   4                                                        56000021
WORK     EQU   5                   RST35800                             56100021
ERRCD    EQU   6                                                        56200021
GTMREG   EQU   7                   RST36000                             56300021
GDSREG   EQU   8                                                        56400021
BASE     EQU   9                                                        56500021
REGC     EQU   10                                                       56600021
REGD     EQU   11                                                       56700021
SAVE     EQU   13                                                       56800021
REG14    EQU   14                                                       56900021
REG15    EQU   15                                                       57000021
         EJECT                                                          57100021
GDS      EQU   0                                                        57200021
CORVL    EQU   4                                                        57300021
KEY      EQU   8                                                        57400021
LAST     EQU   X'80'                                                    57500021
NULL     EQU   20                                                       57600021
LEVEL2   EQU   X'10'                                                    57700021
NO       EQU   X'80'                                                    57800021
SEQ      EQU   X'04'                                                    57900021
SUB      EQU   X'02'                                                    58000021
STAT     EQU   24                                                       58100021
BMGT     EQU   816                                                      58200021
SAVEFOUR EQU   X'40'                                                    58300021
SEQM     EQU   X'40'                                                    58400021
SUBM     EQU   X'80'                                                    58500021
NTSEQSUB EQU   X'B9'                                                    58600021
CRVLPRES EQU   X'40'                                                    58700021
EQUIV    EQU   X'80'                                                    58800021
ONE      EQU   1                                                        58900021
PARER    EQU   16                                                       59000021
PRMER    EQU   X'08'                                                    59100021
TWO      EQU   2                                                        59200021
IO       EQU   X'04'                                                    59250021
ETE      EQU   828                                                 000A 59260021
FE       EQU   48                                                  000A 59270021
         EJECT                                                          59300021
RESETCDE DC    F'3'                                                     59400021
KEYSRCH  DC    F'2'                                                     59500021
CORVSRCH DC    F'5'                                                     59600021
H128     DC    H'128'                                                   59700021
F256     DC    F'256'                                                   59800021
F3       DC    F'3'                                                     59900021
SIX      DC    F'6'                                                     60000021
ZERO     DC    F'0'                                                     60100021
FOUR     DC    F'4'                                                     60200021
F2       DC    F'2'                                                     60250021
         EJECT                                                          60300021
WORKAREA DSECT                                                          60400021
WRKPARM  DS    F                                                        60500021
WRKRTNCD DS    F                                                        60600021
WRKSAVE  DS    18F                                                      60700021
WRKSPVSR DS    3F                                                       60800021
WRKCORVL DS    F                                                        60900021
WRKKEY   DS    3F                                                       61000021
WRKPRLST DS    4F                                                       61100021
WRKBUFR  DS    F                                                        61200021
WRKDSP   DS    F                                                        61300021
WRKSEQKY DS    F                                                        61400021
WRK128TP DS    F                                                        61500021
WRKPRM   DS    F                                                        61600021
WRKERR   DS    F                                                        61700021
         EJECT                                                          61800021
OACBARA  DSECT                                                          61900021
OTHER    DS    F                                                        62000021
GDOA     DS    F                                                        62100021
STATUS   DS    F                                                        62200021
CRSA     DS    F                                                        62300021
OLP      DS    F                                                        62400021
BLP      DS    F                                                        62500021
BUFSTART DS    F                                                        62600021
BUFLEN   DS    F                                                        62700021
CPU1     DS    F                                                        62800021
BUF1     DS    F                                                        62900021
CPU2     DS    F                                                        63000021
BUF2     DS    F                                                        63100021
LOGSTRT  DS    F                                                        63200021
LOGCURR  DS    F                                                        63300021
LENLEFT  DS    F                                                        63400021
         COPY  GDSCB                                                    63500021
         COPY  GTMCB                                                    63600021
         END                                                            63700021
