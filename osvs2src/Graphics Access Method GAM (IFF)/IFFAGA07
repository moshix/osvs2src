         TITLE 'IFFAGA07-ORDER GENERATION MODULE'           D11         00090000
*        ORGEN IS ENTERED FROM DIRECTOR PART 2 WITH THE                 00180000
*        ADDRESS OF A WORK AREA IN REGISTER 1. THE FIRST                00270000
*        WORD OF THE WORK AREA CONTAINS THE FOLLOWING PARAMETER LIST:   00360000
*                                                                       00450000
*        +0    A(GDSCBVAR)    GDSCB VAR                                 00540000
*        +4    A(ARRAY)       ARRAY OF ORDERS                           00630000
*        +8    A(COUNT)       LENGTH OF ARRAY                           00720000
*        OPTIONAL:                                                      00810000
*        +12   A(KEYLIST)     KEYS FOR MISSING ADDRESSES                00900000
*        +16   A(CORVAL)      CORRELATION VALUE                         00990000
*        +20   A(KEY)         KEY                                       01080000
*        +24   A(GENCODE)     GENCODE                                   01170000
*                                                                       01260000
*                                                                       01350000
*        EXTERNAL ROUTINES CALLED:                                      01440000
*                                                                       01530000
*        DATA STORE-IFFAHA05                                            01620000
*        UPDATE-IFFAHA13                                                01710000
*        KEY TABLE MANAGEMENT-IFFAHA03                                  01800000
*                                                                       01890000
*        EXTERNAL MACROS USED:                                          01980000
*                                                                       02070000
*        LINK                                                           02160000
*        FREEMAIN                                                       02250000
*                                                                       02340000
*                                                                       02430000
*        ON ENTRY REGISTERS ARE SAVED, WORKAREA DSECT IS INITIALIZED,   02520000
*        SAVE AREAS CHAINED, RETURN ARRAY SET TO ZERO, GDSCB INITIAL-   02610000
*        IZED.                                                          02700000
*                                                                       02790000
*        NOTE: THE KEYLIST KEYS ARE NOT CHECKED FOR VALIDITY IN         02880000
*        THE KEY TABLE.  THIS WILL ALLOW THE PROGRAMMER THAT KNOWS      02970000
*        WHAT HE IS DOING TO REFERENCE AN ELEMENT WITH A GSXY FOR       03060000
*        EXAMPLE NOT EXACTLY AT THE TOP BY CHANGING THE LOGICAL         03150000
*        ADDRESS.                                                       03240000
*                                                                       03330000
         EJECT                                                          03420000
IFFAGA07 CSECT                                                          03510000
*C820700                                                         A34801 03600000
* 511000                                                         A27472 03690000
* 797000                                                         A29394 03780000
*A294500,A480200-480800,A486500,A863500,A800200-800600       LD YA00806 03870000
*A184500,A189500,C364000,A633200-633300,A800800              LD YA00808 03960000
*A306200-306600,A800900                                      LD YA00815 04050000
* C510200                                                     LD YM5164 04140000
*A264500                                                        XA02055 04230000
*A184100-184200,C184500                                     D11 ZA05402 04320000
*A577200-577600,C578000                                     D11 ZA06414 04410000
*C510150                                                    D11 ZA13186 04500000
*C184700-188000,C488000,A488010-488020,A803300-803500       D11 ZA15418 04590000
*                                                                       04680000
ORGEN    SAVE  (14,12)                                                  04770000
         BALR  BASE,0              ESTABLISH BASE                       04860000
         USING *,BASE                                                   04950000
         LR    WORK,PARM                                                05040000
         USING WORKAREA,WORK       SET UP WORKAREA DSECT                05130000
         LA    REGA,WRKSAVE                                             05220000
         ST    REGA,8(SAVE)        CHAIN SAVE AREAS                     05310000
         ST    SAVE,4(REGA)                                             05400000
         LR    SAVE,REGA                                                05490000
         L     PARM,WRKPARM        PICK UP PARAMETER LIST               05580000
         L     ERRCD,WRKRTNCD      PICK UP RETURN ARRAY ADDR            05670000
         XC    0(20,ERRCD),0(ERRCD) ZERO RETURN ARRAY                   05760000
         L     RSTABADR,STAT(ERRCD)    SAVE STATUS TABLE ADDR      000B 05850000
         L     GDSREG,GDS(PARM)    GDS VAR                              05940000
         L     GDSREG,0(GDSREG)    GDSCB ADDR                           06030000
         USING GDSCB,GDSREG        GDSCB DSECT                          06120000
         C     GDSREG,GDSGDSCB     GDS VALID                            06210000
         BNE   ERR1                                                     06300000
         L     GTMREG,GDSGTMCB     ADDR OF GTMCB                        06390000
         USING GTMCB,GTMREG                                             06480000
         TM    GDS(PARM),LAST      LAST ONE                             06570000
         BO    ERRPRM              YES                                  06660000
         TM    ARRAY(PARM),LAST    LAST ONE                             06750000
         BO    ERRPRM              YES                                  06840000
*        THE   FIRST THREE PARAMETERS ARE CHECKED FOR PRESENCE          06930000
*        AND   VALIDITY                                                 07020000
         L     OACB,GDSAOACB                                            07110000
         USING OACBAREA,OACB                                            07200000
         TM    STATUS,NOBUF        MUST BUFFER BE OBTAINED & FLOW CTL   07290000
*                                  INITIALIZED?                         07380000
         BZ    ORG00050            NO                                   07470000
         ST    GDSREG,WRKGDS1                                           07560000
         ST    ERRCD,WRKCODE       CALL DATA STORE                      07650000
         XC    WRKKADDR,WRKKADDR   WITH NO FLAGS AND A                  07740000
         LA    PARM,WRKGDS1        LENGTH OF ZERO TO GET                07830000
         L     R15,DSTOR(RSTABADR)                                 000B 07920000
         BALR  RET,R15                                                  08010000
         LTR   R15,R15                                                  08100000
         BNE   ORG04600                                                 08190000
         L     PARM,WRKPARM        RESET REG                            08280000
         EJECT                                                          08370000
*                                                                       08460000
*        THE FOLLOWING AREAS ARE SET TO ZERO:                           08550000
*        SWITCHES                                                       08640000
*        KEYLIST PARAMETER LOCATION                                     08730000
*        THREE WORD KEY                                                 08820000
*        SUBROUTINE PARAMETER LIST                                      08910000
*        THE INITIAL KEY BIT SETTINGS ARE MOVED INTO THE KEY.           09000000
*        SEQUENCE AND SUBROUTINE MEMBER SWITCHES ARE SET IN THE KEY.    09090000
*                                                                       09180000
ORG00050 XC    WRKSW,WRKSW         ZERO SWITCHES                        09270000
         XC    WRKKYLST,WRKKYLST   ZERO KEYLIST PARM                    09360000
         XC    WRKADDR(16),WRKADDR ZERO 3 WD KEY & KEY ADDR             09450000
         XC    WRKARA(12),WRKARA   ZERO SUB PARM LIST                   09540000
         MVC   WRKBITS,BITS        MOVE IN INITIAL SETTINGS             09630000
         TM    GDSFLAGS,SEQ        PART OF A SEQ                        09720000
         BZ    ORG00060            NO                                   09810000
         OI    WRKBITS+3,MEMSEQ    SET SW IN KEY                        09900000
ORG00060 TM    GDSFLAGS,SUB        MEM OF SUBR                          09990000
         BZ    ORG00070            NO                                   10080000
         OI    WRKBITS+3,MEMSUB    SET SW IN KEY                        10170000
ORG00070 L     REGC,COUNT(PARM)                                         10260000
         L     REGC,0(REGC)                                             10350000
         ST    REGC,WRKCNT                                              10440000
*                                                                       10530000
*        THE OPTIONAL PARAMETERS, KEYLIST, CORVAL, KEY, AND GENCODE     10620000
*        ARE CHECKED.                                                   10710000
         TM    COUNT(PARM),LAST    ANY OPTIONAL PARMS                   10800000
         BO    ORG00700            NO                                   10890000
         CLC   NULL+1(3,ERRCD),KEYLST+1(PARM) IS KEYLIST NULL           10980000
         BE    ORG00100            YES                                  11070000
         MVC   WRKKYLST,KEYLST(PARM) PLACE KEY LIST IN PARM LIST        11160000
ORG00100 TM    KEYLST(PARM),LAST   IS THIS LAST                         11250000
         BO    ORG00700                                                 11340000
         CLC   NULL+1(3,ERRCD),CORVAL+1(PARM) IS CORVAL      NULL       11430000
         BE    ORG00200            YES                                  11520000
         TM    GDSFLAGS,LEVEL2                                          11610000
         BO    ORG00200                                                 11700000
         L     REGA,CORVAL(PARM)   PICK UP CORVAL                       11790000
         MVC   WRKCORVL,0(REGA)    SAVE CORVAL                          11880000
         OI    WRKBITS+2,CORRE     SET CORRELATED SW                    11970000
ORG00200 TM    CORVAL(PARM),LAST   ANY MORE                             12060000
         BO    ORG00700                                                 12150000
         CLC   NULL+1(3,ERRCD),KEY+1(PARM) IS KEY NULL                  12240000
         BE    ORG00300                                                 12330000
         MVC   WRKKEY,KEY(PARM)    SAVE KEY PARM                        12420000
         TM    GDSFLAGS,LEVEL2                                          12510000
         BO    ORG00300                                                 12600000
         OI    WRKBITS+2,KEYED     SET KEY SW                           12690000
ORG00300 TM    KEY(PARM),LAST      IS KEY LAST                          12780000
         BO    ORG00700            YES                                  12870000
         CLC   NULL+1(3,ERRCD),GENCDE+1(PARM) IS GENCODE NULL           12960000
         BE    ORG00700            YES                                  13050000
         L     REGA,GENCDE(PARM)   LOAD GENCODE VAR                     13140000
         L     REGA,0(REGA)        LOAD GENCODE VALUE                   13230000
         C     REGA,ONE            INCL                                 13320000
         BE    ORG00700            YES                                  13410000
         CLC   WRKCORVL(8),ZERO       KEYED OR CORRELATED               13500000
         BE    ERR3                NO-BAD GENCODE                       13590000
         C     REGA,TWO            OMIT                                 13680000
         BNE   ORG00400            NO                                   13770000
         TM    GDSFLAGS,LEVEL2     LEVEL 2                              13860000
         BO    ERR3                YES-INVALID                          13950000
         NI    WRKBITS,OMIT        SET OMIT SW                          14040000
         B     ORG00700                                                 14130000
         EJECT                                                          14220000
*                                                                       14310000
*        FOR AN UPDATE THE KEY OR CORVAL IS SEARCHED FOR IF LEVEL 1.    14400000
*        NOTE THAT IF THE ELEMENT IS AN UPDATE THE UPDATE GDOAS ARE     14490000
*        OBTAINED AND THEN THE INCLUDE/OMIT STRUCTURE IS PLACED IN      14580000
*        THE GDOA.  IF THE ELEMENT IS NOT UPDATE, THE INCLUDE/OMIT      14670000
*        STRUCTURE IS PLACED IN THE GDOA FIRST AND THEN THE UPDATE      14760000
*        MODULE IS CALLED FOR WORK AREA.                                14850000
*                                                                       14940000
ORG00400 C     REGA,THREE          UPDATE                               15030000
         BNE   ERR3                NO-INVALID GENCODE                   15120000
         OI    WRKSW,UPDT          SET UPDATE SWITCH                    15210000
         CLC   WRKKEY,ZERO         IS IT KEYED                          15300000
         BE    ORG00600            NO                                   15390000
         L     REGA,WRKKEY         PICK UP KEY VAR                      15480000
         MVC   WRKADDR,0(REGA)     PLACE IN KEY VARIABLE                15570000
         TM    GDSFLAGS,LEVEL2     LEVEL2                               15660000
         BO    ORG00800            YES, DO NOT SEARCH KEY TABLE         15750000
         ST    REGA,WRKKADDR       ADDR OF KEY VAR                      15840000
         ST    GDSREG,WRKGDS1      GDSCB                                15930000
         LA    REGA,TWO                                                 16020000
         ST    REGA,WRKCODE        CODE TO SEARCH ON KEY                16110000
ORG00500 LA    PARM,WRKGDS1                                             16200000
         L     R15,ETE(RSTABADR)       GET HA03 ADDR               000B 16290000
         BALR  RET,R15             BRANCH                          000A 16380000
*//                                                                     16470000
*//      SEARCH FOR KEY/CORVAL                                          16560000
*//                                                                     16650000
         LTR   R15,R15                                                  16740000
         BNE   ERRPRM                                                   16830000
         MVC   WRKADDR,0(PARM)                                          16920000
         ST    PARM,WRKKEY         SAVE ADDR OF KEY IN TABLE            17010000
         TM    4(PARM),INCL        INCLUDE                              17100000
         BO    ORG00800            YES                                  17190000
         NI    WRKBITS,OMIT        SET TO OMIT                          17280000
         B     ORG00800                                                 17370000
ORG00600 CLC   WRKCORVL,ZERO       IS CORVAL ZERO                       17460000
         BE    ERR4                YES                                  17550000
         LA    REGA,WRKCORVL       SET                                  17640000
         ST    REGA,WRKKADDR       UP PARM LIST                         17730000
         LA    REGA,FIVE           TO SEARCH                            17820000
         ST    REGA,WRKCODE        KEY TABLE FOR                        17910000
         ST    GDSREG,WRKGDS1      CORVAL                               18000000
         B     ORG00500                                                 18090000
         EJECT                                                          18180000
*                                                                       18270000
*        IF THIS IS NOT AN UPDATE A LENGTH MUST BE CALCULATED FOR       18360000
*        THE DATA GENERATION.                                           18450000
*                                                                       18540000
ORG00700 L     REGA,WRKCNT         PICK UP LENGTH OF DATA               18630000
         SRDA  REGA,32             PLACE IN ODD REGISTER                18720000
         LH    REGC,GDSGDOAL                                            18810000
         S     REGC,SIX            GDOA LENGTH MINUS SIX                18900000
         DR    REGA,REGC           GET A COUNT OF GDOAS                 18990000
         LA    REGB,1(REGB)        ADD ONE FOR ANY REMAINDER            19080000
         A     REGC,SIX                                                 19170000
         MR    REGA,REGC           LENGTH REQUESTED WILL BE MORE THAN   19260000
         STH   REGB,WRKADDR        ADEQUATE IN ALL CASES.               19350000
         TM    WRKBITS+2,KEYED+CORRE KEYED OR CORRELATED                19440000
         BZ    ORG00750            NO                                   19530000
         BAL   RET,ORGGTRU1        GO GET INCL/OMIT                     19620000
         LTR   R15,R15             SUCCESS                              19710000
         BNE   ORG04600            NO REUTNR                            19800000
ORG00750 L     REGA,GDSAOACB                                            19890000
         L     REGA,CURLOG(REGA)   PICK UP CURRENT LOG.                 19980000
         STH   REGA,WRKADDR+2      AND PLACE IN KEY                     20070000
ORG00800 ST    GDSREG,WRKGDS       GDSCB ADDR                           20160000
         ST    ERRCD,WRKRTN        RETURN ADDR                          20250000
         LA    PARM,WRKADDR                                             20340000
         TM    GDSFLAGS,LEVEL2     LVL2?                    D11 ZA05402 20430000
         BO    LINK13              YES,DONT SET ORGEN FLAGS D11 ZA05402 20520000
         MVI   ORGFLGS,X'FC'       SET ORGEN CALL FLAGS      LD YA00808 20610000
LINK13   L     R15,UPDH13(RSTABADR)  POINT TO UPDATE ADDR   E12 ZA29658 20700000
*              ONE LINE DELETED BY APAR---------------->    E12 ZA29658 20750000
         BALR  RET,R15             GOTO IFFAHA13            D11 ZA15418 20880000
* IFFAHA13 ACCESSED VIA GSP-TYPE LOAD FOR PERFORMANCE' SAKE D11 ZA15418 20970000
*//                                                                     21060000
         MVI   ORGFLGS,X'00'       TURN OFF ORGEN CALL FLAG  LD YA00808 21150000
         LTR   R15,R15             SUCCESS                              21240000
         BNE   ORG04600            ERROR-NO STORE OR SOMETHING          21330000
         TM    WRKSW,UPDT          UPDATE                               21420000
         BO    ORG00820            YES                                  21510000
         TM    WRKBITS+2,KEYED+CORRE KEYED OR CORRELATED                21600000
         BZ    ORG00840                                                 21690000
         LH    REGA,WRKADDR+2      CORRECT LOGICAL START                21780000
         S     REGA,FOUR           ADDR IN KEY TO BEFORE THE GTRU/GNOP  21870000
         STH   REGA,WRKADDR+2                                           21960000
         B     ORG00840                                                 22050000
         EJECT                                                          22140000
ORG00820 TM    GDSFLAGS,LEVEL2     LEVEL 2                              22230000
         BO    ORG00840            YES                                  22320000
         BAL   RET,ORGGTRU1        GO GENERATE INCL/OMIT STRUCTURE      22410000
         LTR   R15,R15             SUCCESS                              22500000
         BNE   ORG04600            NO REUTRN                            22590000
*                                                                       22680000
*        WE WILL NOW BEGIN MOVING THE DATA IN THE OUTPUT AREA           22770000
*        WE WILL CHANGE THE LOGICAL ADDRESSES TO ZERO-ON AND THEY       22860000
*        WILL BE USED IN COMBINATION WITH THE PHYSICAL BUFFER           22950000
*        ADDRESSES FOR RELOCATION.                                      23040000
ORG00840 MVC   WRKSTMD,GNOP2       SET MODE TO CONTROL                  23130000
         L     R15,ZERO            LOGICAL ADDRESS IS ZERO              23220000
         L     OACB,GDSAOACB                                            23310000
         USING OACBAREA,OACB                                            23400000
         L     PARM,WRKPARM                                             23490000
         L     REGA,ARRAY(PARM)    START OF ARRAY                       23580000
         L     REGB,WRKCNT         LENGTH OF ARRAY                      23670000
         L     REGC,OLP            ORDER LOAD POINT                     23760000
         L     REGD,LENLEFT        LENGTH LEFT                          23850000
         C     REGD,FOUR           ARE THERE AT LEAST 4 BYTES           23940000
         BNL   ORG00900            IN THE FIRST GDOA-YES                24030000
ORG00860 L     OACB,OTHER          GET NEXT                             24120000
         LTR   OACB,OACB           IS THERE ANOTHER                     24210000
         BZ    ERR6                NO                                   24300000
         L     REGD,LENLEFT        LENGTH LEFT                          24390000
         L     REGC,OLP            OLP                                  24480000
         MVC   0(2,REGC),WRKSTMD   SET SET MODE                         24570000
         A     REGC,TWO                                                 24660000
         ST    REGC,OLP            UPDATE TO BEYOND SET MODE            24750000
ORG00900 CR    REGB,REGD           WILL IT FIT IN THIS ONE              24840000
         BH    ORG01000            NO                                   24930000
         LR    REGD,REGB           SET LENGTH TO MOVE IN=LENGTH         25020000
ORG01000 C     REGD,F256           GR THAN 256                          25110000
         BH    ORG01500                                                 25200000
         BCTR  REGD,0                                                   25290000
         EX    REGD,MOVE1          MOVE IN DATA                         25380000
         LA    REGD,1(REGD)        RESET COUNT                          25470000
         AR    REGC,REGD           ADD TO OLP                           25560000
         AR    REGA,REGD           ADD TO ARRAY ADDR                    25650000
         SR    REGB,REGD           SUBTRACT FROM LENGTH                 25740000
         EJECT                                                          25830000
*                                                                       25920000
*        WE HAVE MOVED IN AS MUCH AS WE COULD. NOW WE MUST DETERMINE,   26010000
*        IF THERE IS MORE DATA TO BE MOVED IN, IF WE HAVE BROKEN ON     26100000
*        A PROPER BOUNDARY OR IF WE MUST MODIFY THE BREAK.              26190000
*                                                                       26280000
         ST    R15,LOGCURR         LOGICAL ADDRESS IS SET               26370000
         C     REGB,ZERO           HAS ALL THE DATA BEEN MOVED IN       26460000
         BE    ORG01800            YES                                  26550000
*                                                                       26640000
*        WE WILL INDEX THE GDOA  FORWARDS UNTIL WE FIND THE LAST SET    26730000
*        MODE.                                                          26820000
*                                                                       26910000
         L     PARM,OLP            ORDER LOAD PT                        27000000
         L     RET,LENLEFT         LENGTH LEFT                          27090000
         L     REGZERO,TWO         INCREMENT BY TWO                     27180000
ORG01100 BAL   ERRCD,ORGSTMD1      GO SEARCH FOR SET MODE               27270000
ORG01200 B     ORG01600            1ST RETURN PT                        27360000
         CLI   1(PARM),SAVEMODE    2ND RTN PT-MUST MODE BE SAVED        27450000
         BNH   ORG01400                                                 27540000
         MVC   WRKSTMD,GNOP2       SET MODE=CONTROL                     27630000
         CR    REGZERO,RET         WILL THIS ONE FIR                    27720000
         BH    ORG01600            NO                                   27810000
         LA    ERRCD,ORG01200      CONTINUE SCAN                        27900000
         L     REGZERO,TWO         INCREMENT BY TWO             XA02055 27990000
         B     ORGSTMDX                                                 28080000
ORG01300 LA    ERRCD,ORG01200      SET RETURN                           28170000
         B     ORGSTMD2            CONTINUE LOOP                        28260000
ORG01400 MVC   WRKSTMD,0(PARM)     SAVE SET MODE                        28350000
         LA    PARM,2(PARM)        UPDATE TO BEYOND THE SET MODE        28440000
         S     RET,TWO             REDUCE LENGTH BY TWO                 28530000
         B     ORG01300                                                 28620000
ORG01500 L     PARM,F256           MOVE IN 256                          28710000
         BCTR  PARM,0                                                   28800000
         EX    PARM,MOVE1                                               28890000
         S     REGD,F256           REDUCE LENGTH OF GDOA                28980000
         S     REGB,F256           REDUCE LENGTH OF ARRAY               29070000
         A     REGA,F256           ADD TO ARRAY ADDR                    29160000
         A     REGC,F256           ADD TO OLP                           29250000
         B     ORG01000            CONTINUE                             29340000
         EJECT                                                          29430000
ORG01600 A     R15,LENLEFT         UPDATE LOGICAL ADDRESS               29520000
         LTR   RET,RET             EVEN FIT                             29610000
         BE    ORG01700            YES                                  29700000
         SR    REGC,RET            BACK UP OLP                          29790000
         SR    REGA,RET            BACK UP ARRAY ADDR                   29880000
         AR    REGB,RET            ADD BACK TO LENGTH                   29970000
         SR    R15,RET             SUBTRACT FROM LOGICAL                30060000
ORG01700 ST    RET,LENLEFT         SET LENGTH LEFT                      30150000
*                                                                       30240000
ORG01800 ST    REGC,OLP            SAVE OLP                             30330000
         L     ERRCD,WRKRTNCD      RESET ERROR REGISTER                 30420000
         LTR   REGB,REGB           ARE WE DONE                          30510000
         BNE   ORG00860            NO.PROCEED                           30600000
         OI    STATUS,LASTGDOA     SET SW THAT THIS IS LAST ONE         30690000
         ST    OACB,WRKLSTOA       SAVE LAST OACB ADDRESS    LD YA00806 30780000
         L     OACB,GDSAOACB       LOAD FIRST OACB                      30870000
ORG01900 TM    STATUS,LASTGDOA     IS THIS LAST                         30960000
         BO    ORG02100            YES                                  31050000
         CLC   LENLEFT,ZERO        DOES THIS NEED TO BE FILLED OUT      31140000
         BE    ORG02000            NO                                   31230000
         L     REGD,LENLEFT        PICK UP LENGTH                       31320000
         BCTR  REGD,0                                                   31410000
         L     REGC,OLP                                                 31500000
         EX    REGD,ZEROOUT        ZERO THE END OUT                     31590000
         MVC   0(2,REGC),GNOP2     MOVE IN A NO-OP                      31680000
         A     REGC,LENLEFT                                             31770000
         ST    REGC,OLP            SET OLP TO POINT TO GTRU TO NEXT     31860000
         LA    REGD,RESET(REGD)    RESET LEN-LEFT REGISTER   LD YA00815 31950000
         S     REGD,TWO            UPDATE LENGTH LEFT...     LD YA00815 32040000
         ST    REGD,LENLEFT        AND STORE INOACB          LD YA00815 32130000
ORG02000 L     REGC,OLP                                                 32220000
         MVC   0(2,REGC),GTRU      MOVE IN GTRU                         32310000
         L     OACB,OTHER          GET NEXT                             32400000
         B     ORG01900                                                 32490000
         EJECT                                                          32580000
*                                                                       32670000
*        HERE WE WILL OBTAIN THE BUFFER NEEDED FOR THE ORGEN CALL       32760000
*        FOR EACH GDOA USED.  THE FIRST OF COURSE WILL GO INTO THE      32850000
*        CURRENT GDOA AND NO BUFFER IS NEEDED.  FOR UPDATE THIS         32940000
*        PORTION WILL BE BYPASSED.                                      33030000
*                                                                       33120000
ORG02100 TM    WRKSW,UPDT          IS THIS UPDATE                       33210000
         BO    ORG02300            YES, BUFFER ALREADY EXISTS           33300000
         MVC   WRKARA,THREE        CODE FOR MORE BUFFER                 33390000
         ST    GDSREG,WRKARA+4     GDSCB ADDR                           33480000
         LA    REGA,WRKARA                                              33570000
         ST    REGA,WRKGDS1        PARM LIST SET UP FOR                 33660000
         ST    ERRCD,WRKCODE       BUFFER MGT                           33750000
         L     OACB,ORIG           PICK UP ORIGINAL OACB                33840000
         L     REGA,BLP                                                 33930000
         A     REGA,OLP            COMPUTE PHYSICAL BUFFER ADDR         34020000
         S     REGA,CRSA           OF FIRST ONE                         34110000
         L     OACB,GDSAOACB       GO TO MY FIRST                       34200000
ORG02200 ST    REGA,BUFSTART       STORE IN START                       34290000
         ST    REGA,BLP            AND BUFFER LOAD PT                   34380000
         TM    STATUS,LASTGDOA     ANOTHER GDOA                         34470000
         BO    ORG02500            NO                                   34560000
         LA    PARM,WRKGDS1        POINT TO PARM LIST,RTN ARRAY, WKAREA 34650000
         L     R15,BMGT(RSTABADR)                                  000B 34740000
         BALR  RET,R15             CALL BUFFER MFT                      34830000
         LTR   R15,R15             SUCCESS                              34920000
         BNE   ERR7                NO                                   35010000
         LR    REGA,PARM           BUFFER ADDRESS                       35100000
         L     REGB,OLP                                                 35190000
         STH   REGA,2(REGB)        PLACE ADDR IN TRANS ORDER            35280000
         L     OACB,OTHER                                               35370000
         B     ORG02200                                                 35460000
ORG02300 L     OACB,GDSAOACB       OACB                                 35550000
ORG02400 L     REGB,OLP            ADDR OF TRANS TO NEXT                35640000
         TM    STATUS,LASTGDOA     IS THIS LAST                         35730000
         BO    ORG02500            YES                                  35820000
         L     OACB,OTHER          GET NEXT                             35910000
         MVC   2(2,REGB),BLP+2     MOVE BUFFER ADDR INTO PREV GTRU      36000000
         B     ORG02400            CONTINUE                             36090000
         EJECT                                                          36180000
*                                                                       36270000
*        THE GDOAS ARE SET UP. NOW THE ADDRESS MANIPULATION             36360000
*        WILL TAKE PLACE.                                               36450000
*                                                                       36540000
*                                                                       36630000
*        PLACE HERE.  FIRST OF ALL IS THE SIMPLE RELOCATION.  THE       36720000
*        ADDRESS PASSED IS RELATIVE TO THE ASSEMBLY OF THESE            36810000
*        ORDERS AT ZERO AND THEY WILL BE RELOCATED TO THE ACTUAL        36900000
*        PHYSICAL BUFFER ADDRESS.  THE OTHER CASE IS WHERE THE          36990000
*        ADDRESS FIELD CONTAINS X'FFFF' A KEY WILL BE REMOVED FROM      37080000
*        THE KEY LIST, COMPUTED INTO A PHYSICAL BUFFER ADDRESS AND      37170000
*        THAT ADDRESS WILL BE PLACED IN THE ORDER.                      37260000
*                                                                       37350000
ORG02500 L     REGA,WRKKYLST                                            37440000
         L     REGB,OLP            THE LENGTH OF THE LAST GDOA          37530000
         S     REGB,CRSA           IS COMPUTED. IT WILL BE USED TO      37620000
         ST    REGB,WRKLEN         INSURE THAT NO RELOCATION WILL       37710000
*                                  TAKE PLACE OUTSIDE THIS ORDER SET    37800000
         L     OACB,GDSAOACB       PICK UP OACB                         37890000
         L     REGZERO,BLP         FIRST BUFFER LOAD PT MODIFIED FOR    37980000
         S     REGZERO,TWO         THE TWO BYTE SET MODE WHICH OCCURS   38070000
         ST    REGZERO,BLP         IN ALL OTHER CASES SO THAT           38160000
*        RELOCATION WILL BE CORRECT IN ALL CASES.                       38250000
         L     REGZERO,TWO         LENGTH OF ORDER=2                    38340000
ORG02600 L     PARM,CRSA           CRSA- START POINT                    38430000
         L     RET,OLP                                                  38520000
         SR    RET,PARM            LENGTH OF DATA IN GDOA               38610000
         BAL   ERRCD,ORGSTMD0      GET ORDERS WITH ADDRS     LD YA00808 38700000
ORG02700 B     ORG02900            RETURN IF GDOA IS FINISHED           38790000
         CLI   1(PARM),TWO1        IS THIS AN ORDER WITH AN ADDRESS     38880000
         BH    ORG03000            YES                                  38970000
ORG02800 LA    ERRCD,ORG02700      NO-                                  39060000
         LA    PARM,2(PARM)        UPDATE BEYOND SET MODE               39150000
         S     RET,TWO             REDUCE LENGTH BY TWO                 39240000
         B     ORGSTMD2            KEEP GOING                           39330000
ORG02900 TM    STATUS,LASTGDOA     IS THIS ONE LAST                     39420000
         BO    ORG04400            YES                                  39510000
         L     OACB,OTHER          GET NEXT                             39600000
         B     ORG02600            CONTINUE SCAN                        39690000
ORG03000 CLC   2(2,PARM),KEYPASS   IS THIS A KEY ADDRESS                39780000
         BE    ORG03800            YES                                  39870000
*                                                                       39960000
         EJECT                                                          40050000
*        WE HAVE A SIMPLE(?) RELOCATION HERE                            40140000
*                                                                       40230000
         LR    REGC,OACB           SAVE THE OACB                        40320000
         L     OACB,GDSAOACB                                            40410000
ORG03100 TM    STATUS,LASTGDOA     IS THIS THE LAST ONE                 40500000
         BO    ORG03400            YES                                  40590000
         LR    REGB,OACB           SAVE THIS ONE                        40680000
         L     OACB,OTHER          GET NEXT                             40770000
         CLC   2(2,PARM),LOGCURR+2 IS THE ADDR IN THE PREVIOUS ONE      40860000
         BNL   ORG03100            NO                                   40950000
         LR    OACB,REGB           RESET OACB REGISTER                  41040000
         LH    REGD,2(PARM)                                             41130000
         S     REGD,LOGCURR        DISPLACEMENT INTO BUFFER             41220000
ORG03200 A     REGD,BLP            ADD BUFFER LOAD PT                   41310000
         A     REGD,TWO            SET MODE--POSITION BEYOND            41400000
         STH   REGD,2(PARM)        PLACE INTO ORDERS                    41490000
         TM    WRKSW,SCNDPASS      IS THIS THE SECOND PASS              41580000
         BO    ORG03500            YES WERE DONE                        41670000
         CLI   1(PARM),GMVA        IS THIS THE ONE WITH TWO ADDRESSES   41760000
         BE    ORG03600            YES                                  41850000
ORG03300 LR    OACB,REGC           RESET REGISTER                       41940000
ORG03350 LA    ERRCD,ORG02700      RETURN POINT                         42030000
         B     ORGSTMDX            CONTINUE                             42120000
ORG03400 LH    REGD,2(PARM)                                             42210000
         S     REGD,LOGCURR                                             42300000
         C     REGD,WRKLEN         IS THIS ADDR OUTSIDE THE GDOA        42390000
         BH    ERR8                ERRCD NOT SET--                      42480000
         B     ORG03200                                                 42570000
ORG03500 S     PARM,TWO            RESET PARM                           42660000
         XI    WRKSW,SCNDPASS      TURN OFF SECOND PASS SW              42750000
         B     ORG03300                                                 42840000
ORG03600 LR    OACB,REGC                                                42930000
ORG03700 LA    PARM,2(PARM)        POINT UP 2 BYTES                     43020000
         OI    WRKSW,SCNDPASS      SET SECOND PASS SW                   43110000
         B     ORG03000            PROCESS SECOND                       43200000
         EJECT                                                          43290000
*                                                                       43380000
*        A KEY WILL BE REMOVED FROM THE KEY LIST, CONVERTED TO A        43470000
*        PHYS BUFFER ADDR AND THE ADDR WILL BE PLACED IN THE ORDERS     43560000
*                                                                       43650000
ORG03800 LTR   REGA,REGA           KEYLIST PARM PASSED                  43740000
         BZ    ERR9                NO                                   43830000
         LH    REGC,2(REGA)        GET LOGICAL ADDR FROM KEY            43920000
         LA    REGA,4(REGA)        UPDATE TO NEXT KEY                   44010000
         SRDA  REGC,32             PLACE IN ODD REG                     44100000
         LH    REGB,GDSGDOAL                                            44190000
         S     REGB,SIX            DIVIDE BY GDOA-SIX                   44280000
         DR    REGC,REGB                                                44370000
         A     REGC,TWO            ADD TWO TO REMAINDER FOR SET MODE    44460000
         L     R15,GTMBCTBL        BUFFER CONTROL                       44550000
         SR    REGB,REGB                                                44640000
         ST    REGC,WRKDSP         SAVE DISPL                           44730000
         LH    REGC,GDSBCTEL       BCT DISP                             44820000
         MH    REGC,THREE+2                                             44910000
         CLC   GDSGDOAL,SUBSEG     IS THIS A SUBSEG                     45000000
         BE    ORG04000            YES                                  45090000
ORG03900 IC    REGB,2(REGC,R15)    PICK UP COUNT                        45180000
         CR    REGB,REGD           IN THIS ONE                          45270000
         BE    ORG04100            YES                                  45360000
         IC    REGB,1(REGC,R15)    GET PTR                              45450000
         MH    REGB,THREE+2                                             45540000
         CR    REGB,REGC           ANOTHER ON CHAIN                     45630000
         BE    ERR9                ERRCD NOT SET                        45720000
         LR    REGC,REGB           YES                                  45810000
         SR    REGB,REGB                                                45900000
         B     ORG03900                                                 45990000
ORG04000 LTR   REGD,REGD           COUNT ZERO                           46080000
         BNE   ERR9                NO KEY INVALID                       46170000
*                                                                       46260000
         AR    R15,REGC            ADD DISP TO TBL                      46350000
         LR    REGD,REGC                                                46440000
         M     REGC,F256           COMPUTE PHYS ADDR                    46530000
         D     REGC,THREE                                               46620000
         CLC   0(1,R15),GDSBCTID   IN FIRST HALF                        46710000
         BE    ORG04200            YES                                  46800000
         AH    REGD,SUBSEG         UPDATE ADDR TO SECOND                46890000
         B     ORG04200                                                 46980000
         EJECT                                                          47070000
ORG04100 LR    REGD,REGC           COMPUTE                              47160000
         M     REGC,F256           PHYS ADDR                            47250000
         D     REGC,THREE                                               47340000
ORG04200 A     REGD,WRKDSP         ADD DISP TO PHYS                     47430000
         STH   REGD,2(PARM)        STORE IN DATA                        47520000
         TM    WRKSW,SCNDPASS      SECOND PASS                          47610000
         BO    ORG04300            YES                                  47700000
         CLI   1(PARM),GMVA        IS THIS ONE WITH TWO ADDR            47790000
         BE    ORG03700            YES                                  47880000
         B     ORG03350            CONTINUE SCAN                        47970000
ORG04300 S     PARM,TWO            RESET PARM                           48060000
         XI    WRKSW,SCNDPASS      TURN OFF SW                          48150000
         B     ORG03350            CONTINUE SCAN                        48240000
         EJECT                                                          48330000
*                                                                       48420000
*        NOW EVERYTHING IS RELOCATED.  I WILL NOW SET UP THE ORIGINAL   48510000
*                                                                       48600000
*        OACB AND OVERFLOW,ETC                                          48690000
*                                                                       48780000
*                                                                       48870000
*        NOW THAT ALL DATA HAS BEEN RELOCATED IT MUST BE PLACED IN      48960000
*        THE ACTUAL GDOA OR WRITTEN OUT.  IF UPDATE THE UPDATE          49050000
*        MODULE WILL DO THIS FOR ME SO I WILL COMPLETE THE INCLUDE      49140000
*        OMIT STRUCTURE AND CALL UPDATE TO WRITE OUT THE GDOAS.         49230000
*                                                                       49320000
ORG04400 TM    WRKSW,UPDT          UPDATE                               49410000
         BZ    ORG04700            NO                                   49500000
         TM    GDSFLAGS,LEVEL2                                          49590000
         BO    ORG04450                                                 49680000
         L     OACB,GDSAOACB       SAVE PTR TO FIRST OACB    LD YA00806 49770000
         L     REGA,WRKLSTOA       GET LAST FOR ADDR RES     LD YA00806 49860000
         MVC   LOACPBF2(CPBF2,REGA),CPU2 MOVE TO LAST OACB   LD YA00806 49950000
         ST    REGA,GDSAOACB       STORE POINTER TO LAST     LD YA00806 50040000
         ST    GDSREG,WRKGDS1      CALL DATA STORE                      50130000
         MVC   WRKCODE,WRKRTNCD    TO RESOLVE INCLUDE/OMIT              50220000
         XC    WRKKADDR,WRKKADDR   ADDRESS                              50310000
         OI    WRKKADDR,RESOL                                           50400000
         LA    PARM,WRKGDS1       LOAD THE PARAMETER REG           6852 50490000
         L     R15,DSTOR(RSTABADR)                                 000B 50580000
         BALR  RET,R15                                                  50670000
         ST    OACB,GDSAOACB       RESTORE PTR TO 1ST OACB   LD YA00806 50760000
ORG04450 LA    PARM,WRKADDR                                             50850000
         L     R15,UPDH14(RSTABADR)  POINT TO UPDATE RTN    E12 ZA29658 50940000
*              ONE LINE DELETED BY APAR----------------->   E12 ZA29658 50990000
         BALR  RET,R15             GOTO IFFAHA14            D11 ZA15418 51120000
         TM    GDSFLAGS,LEVEL2                                          51210000
         BO    ORG04500            LEVEL 2-YES                          51300000
         L     REGA,WRKKEY                                              51390000
         MVC   0(8,REGA),WRKADDR   REPLACE KEY                          51480000
         TM    WRKBITS+2,CORRE     CORRELATED                           51570000
         BZ    ORG04500            NO                                   51660000
         L     REGA,WRKKEY                                              51750000
         MVC   8(4,REGA),WRKCORVL  REPLACE CORVAL                       51840000
ORG04500 MVI   GDSGRMOD,CNTL       SET CURRENT MODE TO CONTROL          51930000
ORG04600 L     SAVE,4(SAVE)                                             52020000
         RETURN (14,12),T          RETURN                               52110000
         EJECT                                                          52200000
*                                                                       52290000
*                                                                       52380000
*        IF THE DATA FITS ENTIRELY IN THE CURRENT GDOA WITHOUT          52470000
*        OVERFLOW IT IS PLACED THERE, POINTERS ARE UPDATED, AND         52560000
*        THE STORAGE OBTAINED IS FREED.  IF KEYED THE ROUTINE           52650000
*        COMPLETES THE INCLUDE OMIT STRUCTURE, ADDS THE KEY             52740000
*        TO THE KEY TABLE AND RETURNS TO THE CALLING ROUTINE.           52830000
*        IF NOT KEYED IT RETURNS AT THIS TIME.                          52920000
*                                                                       53010000
ORG04700 L     OACB,GDSAOACB       LOAD FIRST OACB                      53100000
         TM    STATUS,LASTGDOA     IS THIS FITTING IN THE GDOA          53190000
         BZ    ORG05000            NO                                   53280000
         L     REGA,CRSA           START ADDR                           53370000
         L     REGB,OLP                                                 53460000
         S     REGB,CRSA           LENGTH                               53550000
         L     OACB,ORIG           ORIGINAL                             53640000
         L     REGD,LENLEFT                                             53730000
         SR    REGD,REGB           UPDATE LENGTH LEFT                   53820000
         LTR   REGD,REGD           IS ANY ROOM LEFT IN GDOA      A27472 53910000
         BNL   ORG04750            IF YES,CONT STORE        D11 ZA13186 54000000
         LA    PARM,WRKGDS1          IF NO, GET MORE BUFFER      A27472 54090000
         ST    GDSREG,WRKGDS1          SET UP HA05 PLIST         A27472 54180000
         XC    WRKKADDR,WRKKADDR                                 A27472 54270000
         OI    WRKKADDR,BFOVRFL        SET BUFFER OVERFLOW FLAG  A27472 54360000
         L     REGD,GDSAOACB           KEEP ORGEN OACB CHAIN     A27472 54450000
         ST    OACB,GDSAOACB           RESTORE ORIG OACB         A27472 54540000
         L     R15,DSTOR(RSTABADR)                               A27472 54630000
         BALR  RET,R15                                           A27472 54720000
         LTR   R15,R15             WAS PROCESSING SUCCESSFUL     A27472 54810000
         BNZ   ERR6A                 IF NO, FREE CORE            A27472 54900000
         L     OACB,GDSAOACB         IF YES, GET NEW OACB ADDR   A27472 54990000
         ST    REGD,GDSAOACB                RESET UPDATE OACB    A27472 55080000
         L     REGD,LENLEFT                 CONTINUE STORING     A27472 55170000
         SR    REGD,REGB                                         A27472 55260000
ORG04750 ST    REGD,LENLEFT                                      A27472 55350000
         L     REGC,OLP                                          A27472 55440000
         LR    REGD,REGC                                                55530000
         AR    REGD,REGB           UPDATE OLP                           55620000
         ST    REGD,OLP                                                 55710000
         L     REGD,LOGCURR                                             55800000
         AR    REGD,REGB           UPDATE LOGICAL  CURRENT              55890000
         ST    REGD,LOGCURR                                             55980000
ORG04800 C     REGB,F256                                                56070000
         BH    ORG04900                                                 56160000
         BCTR  REGB,0                                                   56250000
         EX    REGB,MOVE1          MOVE ORDERS IN GDOA                  56340000
         L     REGD,GDSAOACB                                            56430000
         ST    OACB,GDSAOACB       RESET GDOA/OACB ADDR                 56520000
ORG04850 LR    OACB,REGD                                                56610000
         L     REGZERO,LENGTH                                           56700000
         L     PARM,FIRST                                               56790000
         FREEMAIN R,LV=(0),A=(1)   FREE STORAGE                         56880000
         L     OACB,GDSAOACB       WEE WILL CONPLETE THE KEY            56970000
         L     REGA,LOGCURR                                             57060000
         SH    REGA,WRKADDR+2      LENGTH FOR KEY                       57150000
         STH   REGA,WRKADDR        IN KEY                               57240000
         L     REGA,WRKKEY         KEY PARM                             57330000
         LTR   REGA,REGA           IS THER A KEY PARM                   57420000
         BZ    ORG04870            NO                                   57510000
         MVC   0(4,REGA),WRKADDR   MOVE KEY IN USER VARIABLE            57600000
         EJECT                                                          57690000
ORG04870 TM    WRKBITS+2,KEYED+CORRE KEYED OR CORRELATED                57780000
         BZ    ORG04500               NO                                57870000
         ST    GDSREG,WRKGDS1                                           57960000
         MVC   WRKCODE,WRKRTNCD                                         58050000
         XC    WRKKADDR,WRKKADDR   COMPLETE INCL/OMIT                   58140000
         MVI   WRKKADDR,RESOL                                           58230000
         LA    PARM,WRKGDS1        ADDR OF PARAMETER LIST               58320000
         L     R15,DSTOR(RSTABADR)                                 000B 58410000
         BALR  RET,R15                                                  58500000
         LA    REGA,ONE                 CODE TO ADD A KEY               58590000
         ST    REGA,WRKCODE             IN PARM LIST                    58680000
         ST    GDSREG,WRKGDS1                                           58770000
         LA    REGA,WRKADDR             ADDR OF KEY TO BE ADDED         58860000
         ST    REGA,WRKKADDR            IN PARM LIST                    58950000
         LA    PARM,WRKGDS1        ADDR OF PARM LIST                    59040000
         L     R15,ETE(RSTABADR)       GET HA03 ADDR               000C 59130000
         BALR  RET,R15                                             000C 59220000
         B     ORG04500                                                 59310000
         EJECT                                                          59400000
*                                                                       59490000
*        IF THE ORGEN GENERATION OVERFLOWS THE CURRENT GDOA             59580000
*        AS MUSH AS FITS IN AND DATA STORE IS CALLED                    59670000
*        TO OVERFLOW ONLY.  THIS IS DONE CONTINUALLY UNTIL THE          59760000
*        LAST GDOA ON THE ORGEN WORK CHAIN IS ENCOUNTERED.  THAT        59850000
*        ONE IS JUST MOVED INTO THE GDOA AND THE POINTERS ARE           59940000
*        UPDATED.  THEN THE STORAGE IS RELEASED, ETC.  JUST             60030000
*        AS FOR THE CASE WHERE THE DATA FIT IN THE FIRST GDOA.          60120000
*                                                                       60210000
ORG04900 L     REGD,F256                                                60300000
         SR    REGB,REGD           REDUCE LENGTH                        60390000
         BCTR  REGD,0                                                   60480000
         EX    REGD,MOVE1                                               60570000
         A     REGA,F256           UPDATE                               60660000
         A     REGC,F256           MOVE ADDRESSES                       60750000
         B     ORG04800                                                 60840000
ORG05000 ST    GDSREG,WRKGDS1                                           60930000
         MVC   WRKCODE,WRKRTNCD    SET UP PARM LIST FOR                 61020000
         XC    WRKKADDR,WRKKADDR   DATA STORE TO OVERFLOW ONLY          61110000
         OI    WRKKADDR,OVERFLOW                                        61200000
         L     OACB,GDSAOACB       MY OACBS                             61290000
         L     REGA,CRSA           CRSA                                 61380000
         L     REGB,BUFLEN         LENGTH                               61470000
         LR    REGD,OACB           SAVE MY OACBS                        61560000
         L     OACB,ORIG           PICK UP ORIGINAL                     61650000
         ST    OACB,GDSAOACB       RESET PTR                            61740000
ORG05100 L     REGC,LOGCURR        UPDATE                               61830000
         A     REGC,LENLEFT        LOGICAL CURRENT                      61920000
         ST    REGC,LOGCURR                                             62010000
ORG05150 L     REGC,OLP                                                 62100000
ORG05200 C     REGB,F256           WILL IT REQUIRE MULTIPLE MOVES       62190000
         BH    ORG05300            YES                                  62280000
         BCTR  REGB,0                                                   62370000
         C     REGA,4(REGD)        CRSA=START OF GDOA?      D11 ZA06414 62460000
         BNE   ORG05225            NO,BR                    D11 ZA06414 62550000
         LA    REGB,6(REGB)        ADD SIX TO MOVED LEN     D11 ZA06414 62640000
ORG05225 EX    REGB,MOVE1          MOVE DATA IN             D11 ZA06414 62730000
         TM    WRKSW,LSTONE                                             62820000
         BO    ORG05500                                                 62910000
         LA    PARM,WRKGDS1                                             63000000
         L     R15,DSTOR(RSTABADR)                                 000B 63090000
         BALR  RET,R15             GO OVERFLOW                          63180000
         LR    OACB,REGD           GET NEXT ON MY CHAIN                 63270000
         L     OACB,OTHER                                               63360000
         LR    REGD,OACB                                                63450000
         TM    STATUS,LASTGDOA     LAST                                 63540000
         BO    ORG05400            YES                                  63630000
         EJECT                                                          63720000
ORG05250 L     REGC,BUFSTART       GET BUFFER ADDR                      63810000
         L     REGB,BUFLEN                                              63900000
         L     REGA,CRSA           AND START LOCATION                   63990000
         L     R15,OLP             ORDER LOAD PT IF THIS LAST           64080000
         L     OACB,GDSAOACB       REGULAR OACB                         64170000
         ST    REGC,BUFSTART       PUT BUFFER ADDR IN                   64260000
         ST    REGC,BLP                                                 64350000
         TM    WRKSW,LSTONE                                             64440000
         BO    ORG05500                                                 64530000
         B     ORG05100            KEEP GOING                           64620000
ORG05300 L     R15,F256                                                 64710000
         BCTR  R15,0               MOVE IN 256                          64800000
         EX    R15,MOVE1                                                64890000
         S     REGB,F256           AND UPDATE LENGTH                    64980000
         A     REGA,F256           AND                                  65070000
         A     REGC,F256           PTRS                                 65160000
         B     ORG05200                                                 65250000
ORG05400 OI    WRKSW,LSTONE        SET LAST ONE SW                      65340000
         B     ORG05250                                                 65430000
ORG05500 SR    R15,REGA            COMPUTE LENGTH                       65520000
         LR    REGB,R15            PLACE IN ANOTHER REGISTER            65610000
         L     REGC,OLP            OBTAIN OLP                           65700000
ORG05600 C     R15,F256            WILL ONE MOVE DO IT                  65790000
         BH    ORG05700            NO                                   65880000
         BCTR  R15,0               SHORTEN LENGTH                       65970000
         EX    R15,MOVE1           MOVE DATA IN                         66060000
         L     REGC,OLP            LOAD ORDER LOAD OLP                  66150000
         AR    REGC,REGB                                                66240000
         ST    REGC,OLP            UPDATE OLP                           66330000
         L     REGA,LOGCURR        LOAICAL CURRENT ADDRESS              66420000
         S     REGB,TWO                                                 66510000
         AR    REGA,REGB           UPDATE LOGICAL CURRENT               66600000
         ST    REGA,LOGCURR                                             66690000
         L     REGA,LENLEFT                                             66780000
         SR    REGA,REGB           UPDATE LENGTH LEFT                   66870000
         ST    REGA,LENLEFT                                             66960000
         B     ORG04850                                                 67050000
ORG05700 L     RET,F256            LENGTH OF MOVE                       67140000
         BCTR  RET,0               REDUCE BY ONE FOR EXECUTE            67230000
         EX    RET,MOVE1           MOVE PART OF IT IN                   67320000
         S     R15,F256            REDUCE LENGTH                        67410000
         A     REGA,F256           ADD TO CRSA IN MY GDOA/OACB          67500000
         A     REGC,F256           ADD TO OLP IN GDS OACB/GDOA          67590000
         B     ORG05600            KEEP GOING                           67680000
ORGSTMD0 LTR   RET,RET             CHECK FOR ZERO LGH        LD YA00808 67770000
         BCR   BZ,ERRCD            IF YES, RETURN SINCE...   LD YA00808 67860000
*                                  ...NO CHECK QS NEEDED     LD YA00808 67950000
         EJECT                                                          68040000
ORGSTMD1 CLI   0(PARM),STMD        IS THIS A SET MODE                   68130000
         BE    ORGSTMD3            YES                                  68220000
ORGSTMDX AR    PARM,REGZERO        ADD INCREMENT TO ORDER LOAD POINT    68310000
         SR    RET,REGZERO         SUBTRACT INCREMENT FROM LENGTH TO GO 68400000
ORGSTMD2 CR    REGZERO,RET         ROOM FOR ANOTHER                     68490000
         BNH   ORGSTMD1            YES                                  68580000
         BR    ERRCD               NO RETURN TO FIRST EXIT POINT        68670000
ORGSTMD3 L     REGZERO,FOUR        SET LENGTH TO FOUR                   68760000
         LA    ERRCD,4(ERRCD)      SET RETURN REGISTER TO SCND EXIT     68850000
*                                                                       68940000
*        THIS SEQUENCE WILL DETERMINE THE LENGTH OF THE ORDER AND       69030000
*        PLACE THAT LENGTH IN REGZERO. PARM WILL POINT TO THE ORDER     69120000
*        ON RETURN.                                                     69210000
*                                                                       69300000
         CLI   1(PARM),FOUR1       FOUR BYTE ABS MODE INSTR             69390000
         BCR   BNH,ERRCD           YES                                  69480000
         L     REGZERO,TWO         SET TO TWO BYTE                      69570000
         CLI   1(PARM),TWO1        TWO BYTE ORDER                       69660000
         BCR   BNH,ERRCD           YES                                  69750000
         L     REGZERO,FOUR        SET TO FOUR BYTE                     69840000
         CLI   1(PARM),FOUR2       GSXY OR GNOP4                        69930000
         BCR   BNH,ERRCD           YES                                  70020000
         L     REGZERO,SIX         SET TO SIX BYTE                      70110000
         CLI   1(PARM),SIX1        GMVD,GMVA                            70200000
         BCR   BNH,ERRCD           YES                                  70290000
         L     REGZERO,FOUR        SET TO FOUR BYTE                     70380000
         BR    ERRCD               GTDD,GTND,GTRU                       70470000
         EJECT                                                          70560000
ORGGTRU1 TM    WRKBITS,INCL        INCLUDE                              70650000
         BZ    ORGGTRU2            NO                                   70740000
         LA    REGA,GNOP4          ADDR OF GNOP                         70830000
         B     ORGGTRU3                                                 70920000
ORGGTRU2 LA    REGA,GTRU           ADDR OF GTRU                         71010000
ORGGTRU3 ST    GDSREG,WRKGDS1                                           71100000
         ST    ERRCD,WRKCODE                                            71190000
         MVC   WRKKADDR,FOUR       LENGTH OF FOUR                       71280000
         OI    WRKKADDR,CONTUNRE                                        71370000
         MVC   WRKOUTPT,0(REGA)                                         71460000
         LA    PARM,WRKGDS1                                             71550000
         L     R15,DSTOR(RSTABADR)                                 000B 71640000
         BR    R15                                                      71730000
*                                                                       71820000
*        THE INCLUDE OMIT STRUCTURE WILL BE PUT OUT BY DATA             71910000
*        STORE BEFORE THE STORAGE ALLOCATION IN THE CASE OF A           72000000
*        REGULAR CALL AND AFTER THE STORAGE ALLOCATION IN THE           72090000
*        CASE OF AN UPDATE CALL. THE SUBROUTINE USES REGA, AND          72180000
*        R15. IT IS CALLED WITH THE RETURN ADDRESS IN REG14             72270000
*        AND DATA STORE WILL RETURN CONTROL TO THAT POINT.              72360000
*                                                                       72450000
         EJECT                                                          72540000
ERR1     MVC   PRMER(4,ERRCD),ONE  GDSCB                                72630000
ERRPRM   OI    0(ERRCD),PRM                                             72720000
         B     ORG04600                                                 72810000
ERR3     MVC   PRMER(4,ERRCD),SEVEN GENCODE                             72900000
         B     ERRPRM                                                   72990000
ERR4     MVC   PRMER(4,ERRCD),FIVE CORVAL                               73080000
         B     ERRPRM                                                   73170000
ERR5     MVC   STRG(4,ERRCD),FOUR  MAIN STORAGE                         73260000
ERR5A    OI    0(ERRCD),ST                                              73350000
         B     ORG04600                                                 73440000
ERR6     TM    WRKSW,UPDT          UPDATE OVERFLOW                      73530000
         BO    ERR6A               YES                                  73620000
ERR6A    MVC   STRG(4,ERRCD),ONE   UPDATE OVERFLOW                      73710000
         OI    0(ERRCD),ST                                              73800000
ERR6B    L     OACB,GDSAOACB                                            73890000
         L     REGZERO,LENGTH                                           73980000
         L     PARM,FIRST                                               74070000
         L     OACB,ORIG                                                74160000
         ST    OACB,GDSAOACB       RESET OACB                           74250000
         FREEMAIN R,LV=(0),A=(1)   DO FREEMAIN                          74340000
         B     ORG04600                                                 74430000
         EJECT                                                          74520000
ERR7     MVC   STRG(4,ERRCD),THREE NO BUFFER                            74610000
         OI    0(ERRCD),ST                                              74700000
ERR7A    L     OACB,GDSAOACB                                            74790000
         L     OACB,ORIG                                                74880000
         L     REGD,BUFSTART       COMPUTE A DISPLACEMENT FOR BUFFER MG 74970000
         M     REGC,THREE                                               75060000
         D     REGC,F256                                                75150000
         ST    REGD,WRKARA+8       IN PARM LIST                         75240000
         MVC   WRKARA,SIX          CODE TO RESET                        75330000
         L     R15,BMGT(RSTABADR)                                  000B 75420000
         LA    PARM,WRKGDS1        RELEASE BUFFER                       75510000
         BALR  RET,R15                                                  75600000
         B     ERR6B               GO TO RELEASE STORAGE                75690000
ERR8     L     ERRCD,WRKRTNCD                                           75780000
         OI    0(ERRCD),PRM                                             75870000
         MVC   PRMER(4,ERRCD),TWO  BAD RELOC IN ARRAY                   75960000
ERR8A    TM    WRKSW,UPDT                                               76050000
         BO    ERR6B                                                    76140000
         B     ERR7A                                                    76230000
ERR9     L     ERRCD,WRKRTNCD                                           76320000
         OI    0(ERRCD),PRM                                             76410000
         MVC   PRMER(4,ERRCD),FOUR BAD KEY K IN KEYLIST                 76500000
         B     ERR8A                                                    76590000
         EJECT                                                          76680000
* REGISTERS                                                             76770000
*                                                                       76860000
REGZERO  EQU   0                                                        76950000
PARM     EQU   1                                                        77040000
REGA     EQU   2                                                        77130000
REGB     EQU   3                                                        77220000
ERRCD    EQU   4                                                        77310000
WORK     EQU   5                                                        77400000
OACB     EQU   6                                                        77490000
GTMREG   EQU   7                                                        77580000
GDSREG   EQU   8                                                        77670000
BASE     EQU   9                                                        77760000
REGC     EQU   10                                                       77850000
REGD     EQU   11                                                       77940000
RSTABADR EQU   12                      STATUS TABLE ADDR           000B 78030000
SAVE     EQU   13                                                       78120000
RET      EQU   14                                                       78210000
R15      EQU   15                                                       78300000
         EJECT                                                          78390000
         GINIT                                                          78480000
GTRU     GTRU  0                                                        78570000
GNOP4    GNOP4 0                                                        78660000
GNOP2    GNOP2                                                          78750000
         DC    C'40 BYTE PATCH AREA'                                    78840000
PATCH    DC    40X'FF'             PATCH AREA               D11         78930000
         EJECT                                                          79020000
ZERO     DC    2F'0'                                                    79110000
ONE      DC    F'1'                                                     79200000
TWO      DC    F'2'                                                     79290000
THREE    DC    F'3'                                                     79380000
FOUR     DC    F'4'                                                     79470000
FIVE     DC    F'5'                                                     79560000
SIX      DC    F'6'                                                     79650000
SEVEN    DC    F'7'                                                     79740000
TWTY     DC    F'20'                                                    79830000
F256     DC    F'256'                                                   79920000
BITS     DC    B'10111110'                                              80010000
         DC    X'00'                                                    80100000
         DC    B'00000000'                                              80190000
         DC    B'00000000'                                              80280000
KEYPASS  DC    X'FFFF'                                                  80370000
SUBSEG   DC    H'128'                                                   80460000
MOVE1    MVC   0(1,REGC),0(REGA)                                        80550000
ZEROOUT  XC    0(1,REGC),0(REGC)                                        80640000
         EJECT                                                          80730000
* PARAMETER LIST EQUATES                                                80820000
*                                                                       80910000
GDS      EQU   0                                                        81000000
ARRAY    EQU   4                                                        81090000
COUNT    EQU   8                                                        81180000
KEYLST   EQU   12                                                       81270000
CORVAL   EQU   16                                                       81360000
KEY      EQU   20                                                       81450000
GENCDE   EQU   24                                                       81540000
LAST     EQU   X'80'                                                    81630000
         EJECT                                                          81720000
* OTHER EQUATES                                                         81810000
NULL     EQU   20                                                       81900000
LEVEL2   EQU   X'10'                                                    81990000
OMIT     EQU   X'FB'                                                    82080000
UPDT     EQU   X'40'                                                    82170000
KEYED    EQU   X'20'                                                    82260000
INCL     EQU   X'04'                                                    82350000
CURLOG   EQU   52                                                       82440000
CONTUNRE EQU   X'01'                                                    82530000
STAT     EQU   24                                                       82620000
DSTOR    EQU   852                                                      82710000
STMD     EQU   X'2A'                                                    82800000
FOUR1    EQU   X'02'                                                    82890000
TWO1     EQU   X'BF'          MAXIMUM VALUE FOR 2 BYTE ORDER     A29394 82980000
SIX1     EQU   X'EC'                                                    83070000
FOUR2    EQU   X'EA'                                                    83160000
BNH      EQU   13                                                       83250000
LOACPBF2 EQU   40                  CPU2 AND BUF2 FIELDS      LD YA00806 83340000
*                                  ...OF LAST OACB           LD YA00806 83430000
CPBF2    EQU   8                   OACB CPU2 AND BUF2        LD YA00806 83520000
BZ       EQU   8                   MASK OF ZERO              LD YA00808 83610000
RESET    EQU   1                   VALUE USED TO RESET LEN   LD YA00815 83700000
SAVEMODE EQU   X'45'                                                    83790000
LASTGDOA EQU   X'10'                                                    83880000
BMGT     EQU   816                                                      83970000
UPDH13   EQU   936                 STATAB DISPL -IFFAHA13-  D11 ZA15418 84060000
UPDH14   EQU   948                 STATAB DISPL -IFFAHA14-  D11 ZA15418 84150000
NOBUF    EQU   X'80'                                                    84240000
SCNDPASS EQU   X'20'                                                    84330000
CNTL     EQU   0                                                        84420000
RESOL    EQU   X'02'                                                    84510000
GMVA     EQU   X'EB'                                                    84600000
OVERFLOW EQU   X'20'                                                    84690000
LSTONE   EQU   X'10'                                                    84780000
BUFLEN1  EQU   28                                                       84870000
PRM      EQU   X'08'                                                    84960000
PRMER    EQU   16                                                       85050000
STRG     EQU   12                                                       85140000
ST       EQU   X'10'                                                    85230000
CORRE    EQU   X'10'                                                    85320000
MEMSUB   EQU   X'80'                                                    85410000
MEMSEQ   EQU   X'40'                                                    85500000
SEQ      EQU   X'04'                                                    85590000
SUB      EQU   X'02'                                                    85680000
ETE      EQU   828                                                 000A 85770000
BFOVRFL  EQU   X'60'          BUFFER OVERFLOW REQUIRED           A34801 85860000
         EJECT                                                          85950000
OACBAREA DSECT                                                          86040000
OTHER    DS    F                                                        86130000
GDOA     DS    F                                                        86220000
STATUS   DS    F                                                        86310000
CRSA     DS    F                                                        86400000
OLP      DS    F                                                        86490000
BLP      DS    F                                                        86580000
BUFSTART DS    F                                                        86670000
BUFLEN   DS    F                                                        86760000
FIRST    DS    F                                                        86850000
LENGTH   DS    F                                                        86940000
CPU2     DS    F                                                        87030000
BUF2     DS    F                                                        87120000
LOGSTRT  DS    F                   LOGICAL IN RELATION TO GDS           87210000
LOGCURR  DS    F                   LOGICAL IN RELATION TO ORGEN         87300000
LENLEFT  DS    F                                                        87390000
ORIG     DS    F                                                        87480000
         EJECT                                                          87570000
WORKAREA DSECT                                                          87660000
WRKPARM  DS    F                                                        87750000
WRKRTNCD DS    F                                                        87840000
WRKSAVE  DS    18F                                                      87930000
WRKSW    DS    F                                                        88020000
WRKKYLST DS    F                                                        88110000
WRKARA   DS    3F                                                       88200000
WRKCNT   DS    F                                                        88290000
WRKDSP   DS    F                                                        88380000
WRKLEN   DS    F                                                        88470000
WRKGDOA  DS    F                                                        88560000
WRKDSTOR DS    F                                                        88650000
WRKSTMD  DS    F                                                        88740000
WRKBMGT  DS    F                                                        88830000
WRKADDR  DS    F                                                        88920000
WRKBITS  DS    F                                                        89010000
WRKCORVL DS    F                                                        89100000
WRKKEY   DS    F                                                        89190000
WRKGDS   DS    F                                                        89280000
WRKRTN   DS    F                                                        89370000
WRKGDS1  DS    F                                                        89460000
WRKCODE  DS    F                                                        89550000
WRKKADDR DS    F                                                        89640000
WRKOUTPT DS    F                                                        89730000
WRKLSTOA DS    F                   LAST OACB POINTER         LD YA00806 89820000
ORGFLGS  DS    F                   ORGEN FLAGS FOR UPDATE    LD YA00808 89910000
         COPY  GTMCB                                                    90000000
         COPY  GDSCB                                                    90090000
         END                                                            90180000
