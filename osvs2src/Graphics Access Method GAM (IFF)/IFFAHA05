*                                                                       00100002
*                                                                       00109002
*        THE DATA STORE ROUTINE IS ENTERED FROM:                        00118002
*        DATA GENERATOR                                                 00127002
*        BGSEQ/BGSUB                                                    00136002
*        ENSEQ                                                          00145002
*        ENSUB                                                          00154002
*        LKSUB                                                          00163002
*        PTEXT                                                          00172002
*        ORGEN                                                          00181002
*                                                                       00190002
*                                                                       00200002
*                        INPUT TO THE DATA STORE ROUTINE                00300002
*                        WILL BE POINTED TO BY REGISTER 1.              00400002
*                                                                       00500002
*                        +0   A(GDSCB)                                  00600002
*                        +4   A(GSPARRAY)                               00700002
*                        +8   FLAGS                                     00800002
*                        +10  LENGTH                                    00900002
*                        +12  9 WORDS OF OUTPUT                         01000002
*                        +48  WORK AREA                                 01100002
*                                                                       01107002
*                                                                       01114002
*        EXTERNAL MACROS:                                               01121002
*                                                                       01128002
*        GWRITE                                                         01135002
*        WAIT                                                           01142002
*                                                                       01149002
*        EXTERNAL ROUTINES:                                             01156002
*                                                                       01163002
*        BUFFER MANAGEMENT                                              01170002
*        FLOW CONTROL MANAGEMENT                                        01177002
*                                                                       01184002
*                                                                       01200002
         EJECT                                                          01210002
*                                                                       01220002
*        THERE IS ONE ENTRY POINT AND THE FLAGS PASSED ARE USED TO      01230002
*        DETERMINE THE FUNCTION DESIRED.                                01240002
*                                                                       01250002
*                                                                       01300002
*                        WHEN FLAGS+0 HAVE THE FOLLOWING                01400002
*                        SETTINGS THE INPUT WILL APPEAR                 01500002
*                        AS FOLLOWS:                                    01600002
*                                                                       01700002
*   FROM BEGSEQ,DATA GEN 01   GTRU UNRES ADDR                           01800002
*                                                                       01900002
*   FROM ENDSEQ,ENDSUB   02   NO DATA RESOLVE ADDR TO                   02000002
*        DATA GEN             CURRENT LOCATION                          02100002
*                                                                       02200002
*   FROM DATA GEN        03   GTRU UNRES ADDR                           02300002
*                             ALSO RESOLVE PREVIOUS                     02400002
*                             UNRESOLVED TO CURRENT+4                   02500002
*                                                                       02600002
*    FROM BEGSUB         04   GTRU UNRES ADDR                           02700002
*                             GTRU 0                                    02800002
*                             GDRD                                      02900002
*                                                                       03000002
*    FROM BEGSUB         14   GTRU UNRES ADDR                           03100002
*                             GTRU 0                                    03200002
*                             GTRU *-4                                  03300002
*                             GDRD                                      03400002
*                                                                       03500002
*    FROM BUFSUB         08   GMVA LOC,*+10                             03600002
*                             GTRU SUBR+4                               03700002
*                             GPDI                                      03800002
*                                                                       03900002
*    FROM BUFSUB         18   GTRU *+14                                 04000002
*                             GMVA LOC,*+14                             04100002
*                             GTRU SUBR+4                               04200002
*                             GPDI                                      04300002
*                                                                       04400002
*        FROM ORGEN     20   OVERFLOW ONLY                              04430002
*                                                                       04460002
*    ALL ADDRESSES NOTED AS *+ OR *- MUST BE RESOLVED BY DATA STORE     04500002
*                                                                       04600002
*                                                                       04700002
         EJECT                                                          04800002
*                                                                       04810002
*        ON ENTRY THE WORK AREA DSECT IS INITIALIZED, THE BASE IS       04820002
*        SET UP, THE GDSCB DSECT IS INITIALIZED, THE GTMCB DSECT IS     04830002
*        INITIALIZED, AND THE SAVE AREAS ARE CHAINED.                   04840002
*                                                                       04850002
IFFAHA05 CSECT                                                          04900002
*A394500,394600;D396060,396120                                   A35620 04902002
*C595500                                                         A34801 04910002
*C132000,495000                                                  A33271 04926002
*117000-118000                                                   A27472 04930002
*138000,144000                                                   A25112 04960002
*D090000-091000,A090000-091200,C497000-498000,A540300-540600     YM1963 04980002
*A517500-517600                                                 OY02461 04990002
         SAVE  (14,12)                                                  05000002
         BALR  BASE,0              ADDRESSABILITY                       05100002
         USING *,BASE                                                   05200002
         LR    WORK,PARM           WORKAREA                             05300002
         USING WORKAREA,WORK                                            05400002
         L     GDSREG,WRKGDS       GDSCB                                05500002
         USING GDSCB,GDSREG                                             05600002
         L     ERRCD,WRKRTNCD      ERROR LOCATION                       05700002
         XC    WRKSPVSR(12),WRKSPVSR ZERO SUPERVISOR PARAMETER LIST     05800002
         L     OACB,GDSAOACB       OACB                                 05900002
         USING OACBAREA,OACB                                            06000002
         LA    REGA,WRKSAVE        CHAIN SAVE AREAS                     06100002
         ST    SAVE,WRKSAVE+4                                           06200002
         ST    REGA,8(SAVE)                                             06300002
         LR    SAVE,REGA                                                06400002
         L     GTMREG,GDSGTMCB                                          06500002
         USING GTMCB,GTMREG        STMCB                                06600002
         MVC   WRKRTN,WRKRTNCD     MOVE RETURN CODE ARRAY ADDR IN CALL  06700002
*                                  AREA FOR FUTURE CALLS                06800002
*                                                                       06820002
*        A CHECK IS MADE TO SEE IF DATA HAS EVER BEEN GENERATED         06840002
*        AND IF NOT BUFFER AND A FLOW CONTROL ENTRY ARE OBTAINED.       06860002
*                                                                       06880002
         TM    STATUS,NOBUF        HAS ANY DATA BEEN GENERATED FOR      06900002
         BO    STR00800            THIS GDS--NO-GO GET BUFFER AND ADD   07000002
*                                  TO FLOW CTL                          07100002
         EJECT                                                          07110002
*                                                                       07120002
*        IF NO FLAGS ARE PASSED IT IS ASSUMED THAT DATA IS TO BE        07130002
*        PLACED IN THE GDOA.  A CHECK IS MADE TO SEE IF THE :ATA        07140002
*        WILL FIT.  IF SO IT IS MOVED INTO THE GDOA.  THE LENGTH        07150002
*        LEFT IS REDUCED BY THE LENGTH OF THE DATA AND THE LOGICAL      07160002
*        START ADDRESS IS UPDATED BY THE LENGTH OF THE DATA.  THE       07170002
*        OLP IS ALSO UPDATED BY THE LENGTH OF THE DATA.                 07180002
*                                                                       07190002
STR00100 CLC   WRKFLAGS,ZERO       ANY FLAGS SET                        07200002
         BNE   STR01100            YES GO HANDLE THEM                   07300002
STR00150 LH    REGA,WRKLEN         PICK UP LENGTH                       07400002
         LTR   REGA,REGA           ANY DATA TO BE GENERATED             07500002
         BZ    STR00200            NO,EXIT                              07600002
         C     REGA,LENLEFT        DOES IT FIT                          07700002
         BH    STR00300            NO                                   07800002
         L     REGB,OLP            ORDER LOAD PT                        07900002
         BCTR  REGA,0              REDUCE LEN BY 1                      08000002
         EX    REGA,MOVE           MOVE INTO OUTPUT AREA                08100002
         LH    REGA,WRKLEN                                              08200002
         AR    REGB,REGA                                                08300002
         ST    REGB,OLP            UPDATE OLP                           08400002
         L     REGB,LENLEFT        REDUCE LENGTH LEFT                   08500002
         SR    REGB,REGA           BY LENGH OF DATA GENERATED           08600002
         ST    REGB,LENLEFT                                             08700002
         A     REGA,LOGCURR                                             08800002
         ST    REGA,LOGCURR        UPDATE CURRENT LOGICAL ADDR          08900002
         SPACE 3                                                        08910002
*                                                                       08920002
*        HERE THE ROUTINE RETURNS TO THE CALLING PROGRAM.               08940002
*                                                                       08960002
STR00200 LA    REGFIFTN,CODE0      RETURN CODE FOR CALLER        YM1963 09000002
STR00205 L     SAVE,4(SAVE)        RESTORE PTR TO CALLER'S SAVE  YM1963 09060002
         RETURN (14,12),T,RC=(15)  RETURN TO CALLER              YM1963 09120002
         EJECT                                                          09200002
*                                                                       09209002
*        IF THE DATA DOES NOT FIT IN THE GDOA THE ROUTINE MUST          09218002
*        OVERFLOW.  IF THE GDOA LENGTH IS 128 NO MORE BUFFER CAN        09227002
*        BE OBTAINED AND THE ROUTINE EXITS.  A CHECK IS MADE TO         09236002
*        SEE IF THE DATA CAN BE SPLIT BY COMPARING THE LENGTH TO        09245002
*        SIX.  IF THE DATA IS ABSOLUTE ORDERS THE MAXIMUM LENGTH        09254002
*        TO DATA STORE IS SIX.  IF IT IS INCREMENTAL ORDERS OR          09263002
*        TEXT THE DATA CAN BE SPLIT ON ANY HALF WORD BOUNDARY SO        09272002
*        AS MUCH AS POSSIBLE IS MOVED IN.                               09281002
*                                                                       09290002
STR00300 CLC   GDSGDOAL,F128+2                                          09300002
         BE    ERR2                                                     09400002
         TM    GDSGRMOD,X'F0'      TEXT                                 09430002
         BM    STR00320                                                 09460002
         C     REGA,SIX            CAN THE DATA BE SPLIT                09500002
         BNH   STR01000            NO                                   09600002
STR00320 L     REGB,OLP            LOAD THE OLP                         09700002
         L     REGA,LENLEFT        LOAD THE LENGTH REMAINING            09800002
         LTR   REGA,REGA           ANY DATA SPACE LEFT                  09900002
         BZ    STR03600            NO                                   10000002
         BCTR  REGA,0                                                   10100002
         EX    REGA,MOVE           MOVE IN AS MUCH AS POSSIBLE          10200002
         LH    REGB,WRKLEN         LENGTH DESIRED                       10300002
         LA    REGA,1(REGA)        RESET COUNT                          10400002
         SR    REGB,REGA           LENGTH TO GO                         10500002
         L     REGD,OLP                                                 10600002
         AR    REGD,REGA                                                10700002
         ST    REGD,OLP            UPDATE OLP                           10800002
         LA    REGC,WRKOUTPT(REGA) ADDR OF NEXT DATA                    10900002
         A     REGA,LOGCURR                                             11000002
         ST    REGA,LOGCURR        UPDATE LOGICAL BUFFER ADDR           11100002
         EJECT                                                          11110002
*                                                                       11120002
*        THE MAIN PART OF THE OVERFLOW ROUTINE IS ENTERED BY            11130002
*        LOADING THE RETURN ADDRESS IN REGISTER 14 SO THAT THE          11140002
*        PROGRAM WILL FALL THROUGH WHEN THE MAIN PORTION OF OVERFLOW    11150002
*        IS COMPLETE.  THE ENTRY POINTS WHICH BUILD INCLUDE/OMIT        11160002
*        STRUCTURES OR SEQUENCE OR SUBROUTINE STRUCTURES OR SUBROUTINE  11170002
*        LINKAGE OR THE ENTRY FOR JUST OVERFLOW WILL USE THIS PORTION   11180002
*        OF THE PROGRAM TO PROVIDE THEIR OVERFLOW FUNCTIONS ALSO.       11190002
         SPACE                                                          11195002
STR00330 LA    RETURN,STR00550     SET TO FALL THROUGH                  11200002
         SPACE 3                                                        11205002
*                                                                       11210002
*        IF THIS IS A UPDATE OVERFLOW THE ROUTINE FREES THE STORAGE     11220002
*        FOR THE UPDATE AND RETURNS A RETURN CODE TO THE CALLING        11230002
*        PROGRAM AS WELL AS PLACING ONE IN THE RETURN ARRAY.  IF        11240002
*        THIS IS AN EQUIVALINCE GRAPHIC DATA SET THE RETURN CODE        11250002
*        IS PLACED IN THE RETURN ARRAY AND A RETURN CODE IS ALSO        11260002
*        RETURNED TO THE CALLING PROGRAM.                               11270002
         SPACE                                                          11280002
STR00350 TM    STATUS,UPDT         UPDATE OVERFLOW                      11300002
         BO    STR00520            YES                                  11400002
         TM    GDSFLAGS,EQUIV      IS THIS AN EQUIV                     11500002
         BO    ERR2                YES NO MORE BUFFER CAN BE OBTAINED   11600002
         EJECT                                                          11605002
*                                                                       11610002
*        IF THE CALL WAS TO OVERFLOW ONLY THE GTRU TO THE NEXT          11620002
*        BUFFER SEGMENT IS ALREADY IN THE GDOA AND ORGEN HAS ALREADY    11630002
*        OBTAINED THE NEXT BUFFER SEGMENT SO THIS PORTION OF THE        11640002
*        OVERFLOW ROUTINE IS BYPASSED.  OTHERWISE A GTRU IS MOVED       11650002
*        INTO THE GDOA AND BUFFER IS OBTAINED.  THE BUFFER ADDRESS      11660002
*        OBTAINED IS PLACED IN THE GTRU ORDER.                          11670002
         SPACE 2                                                        11680002
         TM    WRKFLAGS,BFROVFLW   IS BUFFER REQUIRED FOR OVERFL A27472 11750002
         BM    STR00370               IF YES, GET NEXT SEGMENT   A27472 11820002
         L     REGD,OLP            LOAD THE OLP                         11900002
         MVC   0(2,REGD),GTRU      MOVE IN GTRU TO NEXT SEGMENT         12000002
         MVC   WRKPRLST,THREE      CODE FOR ADDL BUFFER                 12100002
         ST    GDSREG,WRKPRLST+4   GDSCB IN AREA                        12200002
         LA    REGA,WRKPRLST                                            12300002
         ST    REGA,WRKPRM                                              12400002
         LA    PARM,WRKPRM                                              12500002
         ST    RETURN,WRKTEMP                                           12600002
*//      CALL  BUFFER MGT          GET BUFFER                           12700002
         L     REGA,STAT(ERRCD)    ADDRESS OF STATUS TABLE              12800002
         L     REGFIFTN,BMGT(REGA) ADDR OF BUFFER MTGT                  12900002
         BALR  RETURN,REGFIFTN     BRANCH TO BUFFER MANAGEMENT          13000002
         LTR   REGFIFTN,REGFIFTN   SUCCESSFUL                           13100002
         BNE   ERR01               NO, RETURN                    A33271 13250002
         L     RETURN,WRKTEMP                                           13300002
         ST    PARM,WRKBUFR        SAVE BUFFER ADDR                     13500002
         STH   PARM,2(REGD)        STORE BUFFER ADDR IN PREV GDOA       13600002
         EJECT                                                          13605002
*                                                                       13610002
*        HERE WE PICK UP THE OVERFLOW ONLY PATH AGAIN AS WELL AS        13620002
*        THE OTHERS AND WE DETERMINE IF THERE ARE ANY UNRESOLVED        13630002
*        ADDRESSES IN THE GDOA.  IF THERE ARE THE ASSOCIATED BUFFER     13640002
*        ADDRESS IS COMPUTED AND THE CPU ADDRESS IS ZEROED AND THE      13650002
*        BUFFER ADDRESS IS SET IN THE OACB.                             13660002
STR00370 CLC   CPU1,ZERO           ANY UNRES ADDR IN GDOA               13700002
         BE    STR00390           CK IF CPU2 STILL UNRESOLVED      9293 13800002
         L     REGA,CPU1           PICK UP CPU ADDR                     13900002
         S     REGA,CRSA           SUBTRACT TO FIND DISP FROM TOP       14000002
         A     REGA,BUFSTART       ADD BUFFER START                     14100002
         ST    REGA,BUF1           SAVE BUFFER ADDR FOR RESOLUTION      14200002
         MVC   CPU1,ZERO           SET CPU TO ZERO                      14300002
STR00390 CLC   CPU2,ZERO          ANOTHER UNRES                    9293 14400002
         BE    STR00400            NO                                   14500002
         L     REGA,CPU2           PICK UP CPU                          14600002
         S     REGA,CRSA           FIND DIS                             14700002
         A     REGA,BUFSTART       ADD BUFFER START                     14800002
         ST    REGA,BUF2           SAVE BUFFER ADDR                     14900002
         MVC   CPU2,ZERO           SET CPU TO ZERO                      15000002
         EJECT                                                          15100002
*                                                                       15110002
*        NOW WE ARE READY TO WRITE THE DATA OUT.  IF FOUR BYTES OF      15120002
*        DATA MUST BE SAVED IN THE GDSCB (THESE FOUR BYTES WILL         15130002
*        BE WRITTEN OUT AT EXEC TIME TO OVERLAY THE PREVIOUS GTRU       15140002
*        TO FLOW CONTROL AND THE DATA GENERATED SINCE THE LAST          15150002
*        EXEC WILL THEN APPEAR)  THEY ARE PLACED THERE AND THE          15160002
*        START OF THE GDOA AND THE BUFFER ADDRESS WILL BY UPDATED       15170002
*        BY FOUR.                                                       15180002
STR00400 L     REGA,GTMDECB1                                            15200002
         LR    PARM,REGA                                                15300002
         L     REGE,BUFLEN         LENGTH                               15400002
         TM    STATUS,SAVEFOUR     MUST FOUR BE SAVED IN GDS            15500002
         BO    STR00700                                                 15600002
         L     REGD,CRSA                                                15700002
         EJECT                                                          15800002
*        THE PREVIOUS I/O OPERATION IS WAITED ON THEN THE GDOA IS       15900002
*        WRITTEN OUT TO THE 2250 BUFFER.                                16000002
STR00500 WAIT  ECB=(1)                                                  16100002
         ST    REGE,LEN(REGA)       MACRO REQUIRES INTEGER              16200002
         L     REGE,GTMGRDCB                                            16300002
         ST    RETURN,WRKTEMP                                           16400002
         LR    PARM,REGA                                                16500002
         CLI   0(PARM),X'7F'                                            16520002
         BNE   ERR3                                                     16540002
         NI    0(PARM),X'BF'                                            16560002
         GWRITE (PARM),STR,(REGE),,(REGD),BUFSTART+2,GDSFCBUF,MF=E      16600002
         LTR   REGFIFTN,REGFIFTN   WAS I/O START SUCCESSFUL        000B 16630002
         BNZ   ERR3                  IF NO, USE I/O ERROR CODE     000B 16660002
         L     RETURN,WRKTEMP      RESET RETURN REGISTER                16800002
         EJECT                                                          16900002
*                                                                       16910002
*        THE NEXT OACB/GDOA WILL BE INITIALIZED BY DUPLICATING          16920002
*        THE STATUS, SETTING THE LOGICAL CURRENT AND LOGICAL            16930002
*        START ADDRESS TO THE LOGICAL CURRENT ADDRESS IN THIS           16940002
*        GDOA/OACB, SETTING THE BUFFER LENGTH TO THE GDOA LENGTH        16950002
*        AND SETTING THE OLP AND CRSA ADDRESSES TO THE GDOA             16960002
*        ADDRESS.  THE BUFFER OBTAINED WILL BE PLACED IN THE            16970002
*        BUFFER START FIELD.  IF THE ENTRY WAS FOR OVERFLOW ONLY        16980002
*        IT WILL EXIT THE OVERFLOW PORTION HERE.                        16990002
STR00505 L     REGA,OTHER          PICK UP OTHER OACB                   17000002
         L     ERRCD,WRKRTNCD      RESET ERROR REG                      17100002
         MVC   STAT1(4,REGA),STATUS     SAVE STATUS                     17200002
         MVC   LOGCURR1(4,REGA),LOGCURR LOG CURRENT                     17300002
         MVC   LOGSTRT1(4,REGA),LOGCURR LOG START                       17400002
         LH    REGD,GDSGDOAL            LENGTH                          17500002
         ST    REGD,BUFLN1(REGA)   IN OACB                              17600002
         S     REGD,SIX            FOR OVERHEAD BYTES                   17700002
         ST    REGD,LENLFT1(REGA)       IN LENGTH LEFT                  17800002
         MVC   CPU3(16,REGA),CPU1       UNRES ADDRS                     17900002
         LR    OACB,REGA                RESET DSECT                     18000002
         L     REGA,GDOA           SET UP                               18100002
         ST    REGA,OLP            OLP                                  18200002
         ST    REGA,CRSA           CRSA                                 18300002
         MVC   BUFSTART,WRKBUFR                                         18400002
         MVC   BLP,WRKBUFR                                              18450002
         TM    WRKFLAGS,OVERFLOW   OVERFLOW ONLY                        18500002
         BZ    STR00510            NO                                   18600002
         BR    RETURN              YES, RETURN                          18700002
         EJECT                                                          18720002
*                                                                       18740002
*        THE CURRENT MODE SETTING IS DETERMINED AND THAT ORDER IS       18760002
*        MOVED INTO THE FIRST TWO BYTES OF THE GDOA.                    18780002
STR00510 LA    REGD,CHRBP          ADDR OF LIST OF ORDERS PT TO CHAR BP 18800002
         TM    GDSGRMOD,CBP        IS IT CHAR BASIC PROT                18900002
         BO    STR00600            YES                                  19000002
         LA    REGD,2(REGD)        NO, POINT TO CLP                     19100002
         TM    GDSGRMOD,CLP        CHAR LGE PROT                        19200002
         BO    STR00600            YES                                  19300002
         LA    REGD,2(REGD)        NO, POINT TO CBU                     19400002
         TM    GDSGRMOD,CBU        CHAR BASIC UNPROT                    19500002
         BO    STR00600            YES                                  19600002
         LA    REGD,2(REGD)        NO, POINT TO CLU                     19700002
         TM    GDSGRMOD,CLU        CHAR LGE UNPROT                      19800002
         BO    STR00600            YES                                  19900002
         LA    REGD,2(REGD)        NO POINT TO VA                       20000002
         TM    GDSGRMOD,VA         VECT ABS                             20100002
         BO    STR00600            YES                                  20200002
         LA    REGD,2(REGD)        NO PT TO VI                          20300002
         TM    GDSGRMOD,VI         VECT INCR                            20400002
         BO    STR00600            YES                                  20500002
         LA    REGD,2(REGD)        NO POINT TO PA                       20600002
         TM    GDSGRMOD,PA         POINT ABS                            20700002
         BO    STR00600            YES                                  20800002
         LA    REGD,2(REGD)        NO, POINT TO PI                      20900002
         TM    GDSGRMOD,PI         POINT INCR                           21000002
         BO    STR00600            YES                                  21100002
         LA    REGD,2(REGD)        NO, POINT TO NO OP                   21200002
         B     STR00600            STORE GNOP                           21300002
STR00520 LR    REGD,OACB           SAVE OLD OACB                        21400002
         L     REGA,OLP            LOCATION OF GTRU TO NEXT SEG         21450002
         L     OACB,OTHER          GET NEXT ON CHAIN                    21500002
         LTR   OACB,OACB           ANY MORE                             21600002
         BZ    ERR2A               NO, UPDATE OVERFLOW                  21700002
         MVC   0(2,REGA),GTRU      MOVE IN GTRU                         21730002
         MVC   2(2,REGA),BUFSTART+2 MOVE IN ADDR                        21760002
         MVC   CPU2,40(REGD)       SAVE CPU ADDR OF UNRES LOC           21800002
         L     REGA,GDOA           GET NEXT                             21900002
         B     STR00510                                                 22000002
         EJECT                                                          22100002
*                                                                       22120002
*        HERER THE DATA IS MOVED INTO THE BUFFER AND THE FIELDS ARE     22140002
*        UPDATED AND THE ROUTINE RETURNS TO THE CALLING PROGRAM.        22160002
STR00550 BCTR  REGB,0              REDUCE LENGTH BY ONE                 22200002
         EX    REGB,MOVE1          MOVE DATA IN OUTPUT AREA             22300002
         LA    REGB,ONE(REGB)                                           22400002
         L     REGD,LOGCURR                                             22500002
         AR    REGD,REGB                                                22600002
         ST    REGD,LOGCURR        UPDATE LOGICAL CURRENT               22700002
         L     REGD,LENLEFT        LENGTH LEFT                          22800002
         SR    REGD,REGB           REDUCE BY DATA LENGTH                22900002
         ST    REGD,LENLEFT                                             23000002
         LA    REGB,2(REGB)        ADD LENGTH OF SET MODE               23100002
         AR    REGB,REGA           ADD GDOA START                       23200002
         ST    REGB,OLP            IN ORDER LOAD PT                     23300002
         B     STR00200            EXIT                                 23400002
*                                                                       23420002
*        HERE THE OVERFLOW ROUTINE PLACES THE ORDER IN THE GDOA.        23440002
*        AND RETURNS TO THE PORTION OF DATA STORE AS NEEDED BY          23460002
*        THE INPUT.                                                     23480002
STR00600 MVC   0(2,REGA),0(REGD)   MOVE IN ORDER TO RESET MODE          23500002
         ST    OACB,GDSAOACB       RESET OACB ADDR IN GDSCB             23600002
         BR    RETURN                                                   23700002
*                                                                       23710002
*        THIS PORTION MOVES THE DATA INTO THE GDSCB IF ON OVERFLOW      23720002
*        IT WAS REQUIRED.  IT CHECKS TO SEE IF ANY DATA NEEDS TO        23730002
*        BE WRITTEN AFTER THE FOUR BYTES HAVE BEEN SAVED.  IF NOT       23740002
*        IT BYPASSES THE WRITE ON THE RETURN.                           23750002
STR00700 S     REGE,FOUR           REDUCE LENGTH BY FOUR                23800002
         L     REGD,BUFSTART                                            23900002
         STH   REGD,GDSREPPB       SAVE IN GDS                          24000002
         A     REGD,FOUR                                                24100002
         ST    REGD,BUFSTART       NEW BUFFER START                     24200002
         L     REGD,CRSA                                                24300002
         MVC   GDSREPDT,0(REGD)    SAVE REPL DATA                       24400002
         XI    STATUS,SAVEFOUR     TURN OFF SW                          24500002
         A     REGD,FOUR           NEW WRITE ADDR                       24600002
         LTR   REGE,REGE           IS LENGTH ZERO                       24700002
         BZ    STR00505            IYES DO NOT WRITE                    24800002
         B     STR00500                                                 24900002
         EJECT                                                          25000002
*                                                                       25010002
*        THIS PORTION OF THE DATA STORE ROUTINE OBTAINS THE BUFFER      25020002
*        AND THE FLOW CONTROL ENTRY WHEN A DATA GENERATION ROUTINE HAS  25030002
*        BEEN CALLED FOR THE FIRST TIME.  IT DETERMINES THE LENGTH OF   25040002
*        BUFFER REQUIRED AND OBTAINS IT FROM BUFFER MANAGEMENT.  THEN   25050002
*        IT CALLS FLOW CONTROL MANAGEMENT FOR A FLOW CONTROL ENTRY.     25060002
STR00800 LA    REGA,ONE            CODE FOR 128 SEGMENT                 25100002
         LH    REGB,GDSGDOAL                                            25200002
         C     REGB,F128           IS 128 DESIRED                       25300002
         BNH   STR00900            YES                                  25400002
         LA    REGA,ONE(REGA)      CODE FOR 256 MULTIPLE                25500002
         ST    REGB,WRKPRLST+8     LENGTH IN LIST                       25600002
STR00900 ST    REGA,WRKPRLST       CODE IN LIST                         25700002
         ST    GDSREG,WRKPRLST+4   GDSCB IN LIST                        25800002
         LA    REGA,WRKPRLST                                            25900002
         ST    REGA,WRKPRM                                              26000002
         LA    PARM,WRKPRM                                              26100002
*//                                                                     26200002
*//      CALL BUFFER MGT                                                26300002
*//                                                                     26400002
         L     REGB,STAT(ERRCD)    ADDR OF STATUS TABLE                 26500002
         L     REGFIFTN,BMGT(REGB) ADDR OF BUFFER MGT                   26600002
         BALR  RETURN,REGFIFTN     BRANCH TO BUFFER MGT                 26700002
         LTR   REGFIFTN,REGFIFTN   AVAILABLE                            26800002
         BNE   ERR1                NO EXIT                              26900002
         LR    REGA,PARM           SAVE BUFFER ADDR                     27000002
         ST    PARM,WRKPRLST+8     ADDR FOR FLOW CTL                    27100002
         MVC   WRKPRLST,TWO        CODE TO ADD FLOW CTL ENTRY           27200002
         LA    PARM,WRKPRM                                              27300002
*//                                                                     27400002
*//      CALL FLOW CONTROL MANAGEMENT                                   27500002
         LINK  EP=IFFAHA01                                              27700002
         LTR   REGFIFTN,REGFIFTN                                        27900002
         BNE   ERR1A               FREE BUFFER AND EXIT                 28000002
         EJECT                                                          28010002
*                                                                       28020002
*        IF SLPAT HAS BEEN CALLED BEFORE A CALL TO A DATA GENERATION    28030002
*        ROUTINE AND HAS CHANGED THE PEN MODE TO PERMIT THE PERMIT      28040002
*        ORDER IS WRITTEN OUT TO THE FLOW CONTROL ENTRY AT THIS TIME.   28050002
*                                                                       28060002
         TM    GDSFLAGS,PERMIT     IS PEN MODE PERMIT                   28100002
         BZ    STR00920            NO, NO ORDER NEED BE WRITTEN         28200002
         LA    REGB,GESD           ADDR OF ORDER                        28300002
         L     REGC,GTMGRDCB       ADDR OF DCB                          28400002
         L     PARM,GTMDECB1       ADDR OF DECB                         28500002
         WAIT  ECB=(1)             WAIT ON I/O                          28550002
         L     PARM,GTMDECB1       ADDR OF DECB                         28600002
         CLI   0(PARM),X'7F'                                            28650002
         BNE   ERR3                                                     28700002
         NI    0(PARM),X'BF'                                            28760002
         GWRITE (PARM),STR,(REGC),2,(REGB),GDSFCBUF,GDSFCBUF,MF=E       28800002
         LTR   REGFIFTN,REGFIFTN   WAS I/O START SUCCESSFUL        000B 28803002
         BNZ   ERR3                  IF NO, USE I/O ERROR CODE     000B 28806002
         EJECT                                                          28810002
*                                                                       28820002
*        THIS INLINE SUBROUTINE TURNS OFF THE BUFFER REQUIRED FLAG      28830002
*        AND SETS THE SAVE FOUR FLAG.                                   28840002
*                                                                       28850002
STR00920 LA    RETURN,STR00950     SET TO FALL THROUGH                  28900002
STR00930 ST    REGA,BUFSTART       SAVE BUFFER ADDR                     29000002
         ST    REGA,BLP            SAVE BUFFER LOAD PT                  29100002
         NI    STATUS,BUFACQ       TURN OFF BUFFER REQ SW               29200002
         OI    STATUS,SAVEFOUR     SAY ON OVERFLOW TO SAVE FOUR BYTES   29300002
         BR    RETURN              RETURN                               29400002
*                                                                       29410002
*        IF THIS IS AN EQUIVALENCE GRAPHIC DATA SET ALL OTHER           29420002
*        EQUIVALENCE GRAPHIC DATA SETS MUST BE SET UP TO SHOW THAT      29430002
*        BUFFER HAD BEEN OBTAINED, WHERE THE BUFFER IS AND WHAT         29440002
*        THE FLOW CONTROL ENTRY IS.                                     29450002
STR00950 TM    GDSFLAGS,EQUIV      IS IT EQUIV                          29500002
         BZ    STR00100            NO                                   29600002
         LR    REGB,GDSREG         SAVE GDS ADDR                        29700002
         LR    REGC,OACB           SAVE OACB ADDR                       29800002
         L     REGD,GDSSHDFD       PICK UP SHARED FOREWARD FLAG         29900002
         L     REGZERO,GDSOVDAT    PICK UP FLOW CONTROL DATA            30000002
         LH    PARM,GDSFCBUF                                            30100002
         LH    REGFIFTN,GDSBCTEL   BUFFER CONTROL TABLE ELEMENT         30200002
         MVC   WRKTEMP(1),GDSBCTID                                      30250002
STR00960 L     GDSREG,GDSSHDBK     LOAC WITH SHARED BACK                30300002
         LTR   GDSREG,GDSREG       ALL BACK PTRS DONE                   30400002
         BZ    STR00970            YES                                  30500002
         L     OACB,GDSAOACB       PICK UP OACB                         30600002
         ST    REGZERO,GDSOVDAT    STORE IN EQUIV                       30700002
         STH   PARM,GDSFCBUF                                            30800002
         STH   REGFIFTN,GDSBCTEL   BUFFER CONTROL TABLE ELEMENT         30900002
         MVC   GDSBCTID(1),WRKTEMP                                      30950002
         BAL   RETURN,STR00930     GO DET FLAGS AND SAVE BUFFER ADDR    31000002
         B     STR00960            GO TO NEXT                           31100002
STR00970 LR    GDSREG,REGD         PICK UP FOREWARD FLAGS               31200002
STR00980 LTR   GDSREG,GDSREG       ALL FOREWARD DONE                    31300002
         BZ    STR00990            YES                                  31400002
         L     OACB,GDSAOACB       GET OACB                             31500002
         ST    REGZERO,GDSOVDAT    STORE IN EQUIV                       31600002
         STH   PARM,GDSFCBUF                                            31700002
         STH   REGFIFTN,GDSBCTEL                                        31730002
         MVC   GDSBCTID(1),WRKTEMP                                      31760002
         BAL   RETURN,STR00930     GO SET FLAGS AND SAVE BUFFER ADDR    31800002
         L     GDSREG,GDSSHDFD     GET NEXT                             31900002
         B     STR00980                                                 32000002
STR00990 LR    GDSREG,REGB         RESET GDSCB                          32100002
         LR    OACB,REGC           RESET OACB                           32200002
         B     STR00100                                                 32300002
         EJECT                                                          32500002
*                                                                       32510002
*        THIS SECTION OF DATA DETERMINES IF THERE IS ANY                32520002
*        ROOM LEFT IN THE GDOA WHEN OVERFLOW WAS REQUIRED AND THE       32530002
*        DATA IS NOT TO BE SPLIT UP.  A GNOP ORDER IS PLACED IN THE     32540002
*        GDOA AND ANY REMAINING AREA IS ZEROED OUT.                     32550002
STR01000 L     REGA,LENLEFT        LOAD THE LENGTH LEFT                 32600002
         LTR   REGA,REGA           ANY ROOM LEFT                        32700002
         BE    STR03600            NO                                   32800002
         BCTR  REGA,0              REDUCE LENGTH FOR EXECUTE            32900002
         L     REGB,OLP            ADDRESS OF OLP                       33000002
         EX    REGA,ZEROOU         ZERO IT OUT                          33100002
         MVC   0(2,REGB),GNOP2     MOVE IN NOP AT START                 33200002
         LA    REGA,1(REGA)        ADD LENGTH TO RESET                  33300002
         AR    REGB,REGA           ADD LENGTH TO OLP                    33400002
         ST    REGB,OLP            STORE BACK                           33500002
         A     REGA,LOGCURR        UPDATE LOGICAL CURRENT ADDR          33600002
         ST    REGA,LOGCURR        LOGICAL CURRENT                      33700002
         B     STR03600                                                 33800002
         EJECT                                                          33820002
*                                                                       33840002
*        AT THIS LOCATION THE INPUT FLAGS ARE CHECKED TO DETERMINE WHAT 33860002
*        SPECIAL SERVICE IS DESIRED.                                    33880002
STR01100 TM    WRKFLAGS,RESOLVE    RESOLVING ADDR                       33900002
         BO    STR01300            YES                                  34000002
STR01200 TM    WRKFLAGS,CONTUNRE   CONTAIN UNRES ADDR                   34100002
         BO    STR02200                                                 34200002
         TM    WRKFLAGS,BEGSUB     BEGIN SUBR LINKAGE                   34300002
         BO    STR02600                                                 34400002
         TM    WRKFLAGS,BUFSUB     BUFSUB LINKAGE                       34500002
         BO    STR03100                                                 34600002
         TM    WRKFLAGS,OVERFLOW   OVERFLOW ONLY                        34700002
         BZ    STR00200            NO                                   34800002
         BAL   RETURN,STR00350     OVERFLOW                             34900002
         ST    OACB,GDSAOACB       RESET GDSCB                          35000002
         B     STR00200            EXIT                                 35100002
         EJECT                                                          35200002
*                                                                       35206002
*        THIS ENTRY IS MADE TO RESOLVE AN UNRESOLVED ADDRESS.  IT       35212002
*        MAY BE MADE NO DATA TO BE PLACED IN THE GDOA IN WHICH          35218002
*        CASE THE ADDRESS IS RESOLVED TO THE CURRENT ADDRESS OR         35224002
*        IT MAY BE MADE WITH A GTRU THAT CONTAINS AN UNRESOLVED         35230002
*        ADDRESS AS WELL IN WHICH CASE THE ADDRESS IS RESOLVED          35236002
*        TO THE CURRENT LOCATION PLUS FOUR.  THE ADDRESSES ARE          35242002
*        RESOLVED IN A LAST IN FIRST OUT METHOD THEREFORE THE           35248002
*        LOCATIONS CPU2, BUF2 ARE CHECKED FOR AN ADDRESS FIRST.         35254002
*        NOTE THAT IF THE ADDRESS MUST BE RESOLVED TO THE CURRENT       35260002
*        LOCATION PLUS FOUR A CHECK IS MADE TO SEE IF THERE ARE         35266002
*        AT LEAST FOUR BYTES IN THE GDOA AND IF NOT THE ROUTINE         35272002
*        WILL OVERFLOW FIRST.                                           35278002
*                                                                       35284002
STR01300 L     REGB,OLP            PICK UP ORDER LOAD PT                35300002
         TM    WRKFLAGS,CONTUNRE   UNRES ALSO                           35400002
         BZ    STR01500            NO, RESOLVE TO CURRENT               35500002
         CLC   LENLEFT,FOUR                                             35600002
         BL    STR02100            ENOUGH SPACE TO FIT                  35700002
STR01400 LA    REGB,4(REGB)        POSITION TO END OF GTRU              35800002
*                                                                       35810002
*        THE RESOLVING ADDRESS IS COMPUTED.  IF IT IS TO BE PLACED      35820002
*        IN THE CPU IT IS MOVED IN AND THE ADDRESS IS ZEROED OUT.       35830002
*        IF IT IS TO BE PLACED IN THE BUFFER IT IS WRITTEN OUT          35840002
*        TO THE BUFFER AND THE ADDRESS IN THE OACB IS THEN ZEROED OUT.  35850002
STR01500 S     REGB,CRSA           DISP FROM TOP                        35900002
         A     REGB,BUFSTART       ADDR TO RESOLVE WITH                 36000002
         CLC   CPU2(8),ZERO        IS THERE A SECOND ADDR               36100002
         BZ    STR01600            NO                                   36200002
         CLC   CPU2,ZERO           IN CPU                               36300002
         BE    STR01700            NO                                   36400002
         L     REGA,CPU2           WHERE TO BE RESOLVED                 36500002
         STH   REGB,0(REGA)        RESOLVE IT                           36600002
         MVC   CPU2(8),ZERO        ZERO IT OUT                          36700002
         B     STR01200                                                 36800002
STR01600 CLC   CPU1,ZERO           IN CPU                               36900002
         BE    STR01800            NO                                   37000002
         L     REGA,CPU1           WHERE TO BE RESOLVED                 37100002
         STH   REGB,0(REGA)        RESOLVE IT                           37200002
         MVC   CPU1(8),ZERO        ZERO OUT                             37300002
         B     STR01200                                                 37400002
STR01700 LA    REGA,BUF2+2         ADDR WHERE                           37500002
         B     STR01900                                                 37600002
         EJECT                                                          37700002
STR01750 STH   REGB,0(REGD)        STORE RESOLVING ADDR IN REP DATA     37800002
         XC    0(2,REGA),0(REGA)   ZERO OUT ADDR                        37850002
         B     STR02000            CONTINUE                             37920002
STR01800 LA    REGA,BUF1+2         ADDR WHERE                           38000002
*                                                                       38010002
*        IF THE ADDRESS IS TO BE PLACED IN THE BUFFER A CHECK IS        38020002
*        MADE TO SEE IF IT HAPPENS TO BE IN THE GDSCB INSTEAD OF        38030002
*        IN THE BUFFER ALREADY.  IF YES IT IS PLACED IN THE GDSCB.      38040002
*        OTHERWISE IT IS WRITTEN OUT.                                   38050002
STR01900 LH    REGC,GDSREPPB       GET BUFFER ADDR OF REPLACEMENT DAT   38100002
         CLC   GDSREPDT,ZERO       IS IT ZERO                           38200002
         BE    STR01920            YES                                  38300002
         LA    REGD,GDSREPDT       ADDR OF REP DATA IN GDSCB            38400002
         CH    REGC,0(REGA)        IS IT IN THE FIRST HALF              38500002
         BE    STR01750            YES                                  38600002
         LA    REGD,2(REGD)        UPDATE TO SECOND HALF                38700002
         LA    REGC,2(REGC)        UPDATE ADDR BY TWO                   38800002
         CH    REGC,0(REGA)        IS IT IN THE SECDOND HALF            38900002
         BE    STR01750            YES                                  39000002
STR01920 L     REGC,OTHER                                               39100002
         L     REGC,GDOA1(REGC)    ADDR OF OTHER GDOA                   39400002
         L     PARM,GTMDECB1      GET GSP DECB FOR I/O           A35620 39450002
         WAIT ECB=(1)             WAIT ON OVERLAPPED I/O         A35620 39460002
         STH   REGB,0(REGC)        PLACE ADDR IN OTHER GDOA             39500002
         MVC   2(2,REGC),0(REGA)   MOVE BUFFER ADDR TO A SAFE PLACE     39520002
         XC    0(2,REGA),0(REGA)                                        39540002
         LA    REGA,2(REGC)                                             39560002
         L     PARM,GTMDECB1       DECB                                 39600002
         CLI   0(PARM),X'7F'                                            39618002
         BNE   ERR3                                                     39624002
         EJECT                                                          39630002
         NI    0(PARM),X'BF'                                            39660002
         L     REGD,GTMGRDCB                                            39700002
         GWRITE (PARM),STR,(REGD),2,(REGC),(REGA),GDSFCBUF,MF=E         39800002
         LTR   REGFIFTN,REGFIFTN   WAS I/O START SUCCESSFUL        000B 39860002
         BNZ   ERR3                  IF NO, USE I/O ERROR CODE     000B 39920002
STR02000 CLC   WRKLEN,ZERO         ANY DATA TO BE GENERATED             40000002
         BE    STR00200            NO EXIT                              40100002
         B     STR01200                                                 40200002
STR02100 L     REGD,OLP            PICK UP OLP                          40400002
         CLC   LENLEFT,ZERO                                             40430002
         BE    STR02150                                                 40460002
         MVC   0(2,REGD),GNOP2     MOVE IN A NO OP IN REMAIN 2 BYTES    40500002
         LA    REGD,2(REGD)        POSITION TO GTRU                     40600002
         ST    REGD,OLP            STORE OLP                       4743 40620002
         L     REGD,LOGCURR                                        4743 40640002
         A     REGD,TWO            UPDATE LOGICAL ADDR             4743 40660002
         ST    REGD,LOGCURR                                        4743 40680002
STR02150 BAL   RETURN,STR00350          GO OVERFLOW                     40700002
         L     REGB,OLP            RETURN TO ADDR SOLUTION              40800002
         MVC   0(2,REGB),GNOP2                                     4743 40820002
         LA    REGB,2(REGB)         RESET MODE IS A NOOP           4743 40840002
         ST    REGB,OLP                                            4743 40860002
         B     STR01400                                                 40900002
         EJECT                                                          40909002
*                                                                       40918002
*        IF THE DATA TO BE GENERATED CONATINS AN UNRESOLVED ADDRESS     40927002
*        ITS LENGTH IS FOUR BYTES.  A CHECK IS MADE TO SEE IF THERE     40936002
*        ARE FOUR BYTES LEFT IN THE BUFFER.  IF NOT, IT WILL OVERFLOW.  40945002
*        OTHERWISE AN UNRESOLVED ADDRESS NOTATION IS SET UP IN THE      40954002
*        OACB FOR THIS ADDRESS AND THEN THE ROUTINE BRANCHES TO         40963002
*        THAT PORTION OF DATA STORE THAT WILL PLACE THE ORDER IN        40972002
*        THE GDOA.                                                      40981002
*                                                                       40990002
STR02200 CLC   LENLEFT,FOUR        LENGTH LEFT GREATER THAN 2           41000002
         BL    STR02500            NO                                   41100002
STR02300 L     REGD,OLP            LOAD OLP                             41200002
         LA    REGD,2(REGD)        GET CPU ADDR OF ADDR TO BE RESOLVED  41300002
         CLC   CPU1(8),ZERO        CPU1 IN USE                          41400002
         BNE   STR02400            YES                                  41500002
         ST    REGD,CPU1           NO SAVE ADDR                         41600002
         B     STR00150            GO STORE DATA                        41700002
STR02400 ST    REGD,CPU2           PLACE IN CPU2                        41800002
         B     STR00150            GO STORE DATA                        41900002
         EJECT                                                          41910002
*                                                                       41920002
*        THIS SECTION WILL TAKE CARE OF OVERFLOW FOR THE SPECIAL        41930002
*        CASES.  A CHECK IS MADE TO SEE IF THERE IS ANY ROOM LEFT       41940002
*        IN THE GDOA.  IF SO IT WILL MOVE IN A GNOP AND POSITION        41950002
*        TO THE GTRU WHICH IS TO BE PLACED IN THE GDOA BY THE           41960002
*        OVERFLOW ROUTINE.                                              41970002
STR02500 CLC   LENLEFT,ZERO        ANY LENGTH LEFT                      42000002
         BE    STR02550            NO                                   42100002
         L     REGD,OLP            PI K UP OLP                          42200002
         MVC   0(2,REGD),GNOP2     PLACE NO OP IN REMAINING 2 BYTES     42300002
         LA    REGD,2(REGD)        POSITION TO GTRU                     42400002
         ST    REGD,OLP            RETURN TO OLP                        42500002
         L     REGD,LOGCURR        PICK UP LOGICAL CURRANT              42600002
         A     REGD,TWO            ADD TWO FOR NOP                      42700002
         ST    REGD,LOGCURR        RETURN TO LOGICAL CURRENT            42800002
STR02550 BAL   RETURN,STR00350     GO GET NEW BUFFER                    42900002
         L     REGD,OLP            ADDR OF OLP                          43000002
         MVC   0(2,REGD),GNOP2     MOVE IN NOP TO CONTROL               43100002
         LA    REGD,2(REGD)        ADDRESS OF OLP UPDATED               43200002
         ST    REGD,OLP            STORE IN OLP                         43300002
         B     STR02300            GO TO HANDLE UNRES ADDR              43400002
         EJECT                                                          43410002
*                                                                       43420002
*        THIS PART OF THE PROGRAM PUTS OUT THE BGSUB LINKAGE.           43430002
*        IF IT WILL NOT FIT IT WILL OVERFLOW FIRST, OTHERWISE THE       43440002
*        LOCATION OF THE UNRESOLVED ADDRESS IS NOTED.  THE BRANCHES     43450002
*        WITHIN THEMSELVES ARE COMPUTED AND STORED IN THE INPUT AREA    43460002
*        FROM THE CALLING ROUTINE AND THEN THE STORE PORTION OF         43470002
*        THIS PROGRAM WILL PLACE THE ORDERS IN THE GDOA.                43480002
*                                                                       43490002
STR02600 CLC   LENLEFT,FRTN        FIT IN OUT AREA                      43500002
         BL    STR02800            NO MAYBE NO                          43600002
STR02700 L     REGD,OLP                                                 43700002
         LA    REGD,2(REGD)                                             43800002
         ST    REGD,CPU1           UNRES CPU ADDR SAVED                 43900002
         TM    WRKFLAGS,INCL       IS INCLUDE OMIT STRUCTURE PRESENT    44000002
         BZ    STR00150            NO, GO STORE DATA                    44100002
         LA    REGD,2(REGD)        UPDATE TO RESOLVING ADDR OF          44200002
*                                  FUTURE GTRU                          44300002
         S     REGD,CRSA                                                44400002
         A     REGD,BUFSTART       ADDR USED TO RESOLVE                 44500002
         STH   REGD,WRKOUTPT+10    STORE IN OUTPUT                      44600002
         B     STR00150            GO STORE DATA                        44700002
STR02800 TM    WRKFLAGS,INCL       DO WE REALLY ONLY NEED 10            44900002
         BO    STR03000            NO, WE NEED 14                       45000002
         CLC   LENLEFT,TEN         DO WE HAVE TEN AT LEAST              45100002
         BNL   STR02700            YES                                  45200002
STR03000 LA    REGB,STR02700                                            45300002
*                                                                       45320002
*        HERE IF OVERFLOW IS NECESSARY THE GDOA IS ZEROED AND           45340002
*        A GNOP MOVED IN BEFORE GOING TO THE OVERFLOW ROUTINE.          45360002
STR02900 CLC   LENLEFT,ZERO        ANY LENGTH LEFT                      45400002
         BE    STR02950            NO                                   45500002
         L     REGC,LENLEFT        POCK UP LENGTH LEFT                  45600002
         BCTR  REGC,0              REDUCE BY 1                          45700002
         L     REGD,OLP            PICK UP OLP                          45800002
         EX    REGC,ZEROOUT        ZERO OUT TO NULL UP TO TRANS ORD     45900002
         MVC   0(2,REGD),GNOP2     MOVE IN A NO OP                      46000002
         A     REGD,LENLEFT        POSITION TO GTRU                     46100002
         ST    REGD,OLP            RESTORE LLP                          46200002
         L     REGD,LOGCURR        LOCICAL CURR                         46300002
         A     REGD,LENLEFT        ADD LENGTH LEFT                      46400002
         ST    REGD,LOGCURR        STORE                                46500002
STR02950 BAL   RETURN,STR00350     GO GET NEW BUFFER                    46600002
         L     REGD,OLP            ADDR OF OLP                          46700002
         MVC   0(2,REGD),GNOP2     MOVE IN NOP TO CONTROL               46800002
         LA    REGD,2(REGD)        ADDRESS OF OLP UPDATED               46900002
         ST    REGD,OLP            STORE IN OLP                         47000002
         BR    REGB                                                     47100002
         EJECT                                                          47110002
*                                                                       47120002
*        THIS ENTRY IS MADE TO GENERATE A SUBROUTINE LINKAGE.  IF       47130002
*        IT WILL NOT FIT IN THE GDOA THE ROUTINE WILL OVERFLOW          47140002
*        FIRST.  OTHERWISE THE TRANSFERS ARE RESOLVED AND THE           47150002
*        ROUTINE GOES TO THE STORE PORTION OF THE PROGRAM.              47160002
*                                                                       47170002
STR03100 CLC   LENLEFT,SXTN        SIXTEEN OR MORE LEFT                 47200002
         BL    STR03400            NO                                   47300002
STR03200 L     REGC,OLP                                                 47400002
         LA    REGC,10(REGC)       ADDR WHICH WILL RESOLVE IF NO INCLUD 47500002
         S     REGC,CRSA                                                47600002
         A     REGC,BUFSTART                                            47700002
         TM    WRKFLAGS,INCL       INCLUDE STRUCTURE                    47800002
         BO    STR03300            YES                                  47900002
         STH   REGC,WRKOUTPT+4     RESOLVE ADDR                         48000002
         B     STR00150            GO TO STORE DATA                     48100002
STR03300 LA    REGC,4(REGC)        LENGTH TO END 4 GR WITH INCL/OMIT    48200002
         STH   REGC,WRKOUTPT+2     RESOLVE ADDR IN INCL/OMIT            48300002
         STH   REGC,WRKOUTPT+8     RESOLVE ADDR IN OTHER                48400002
         B     STR00150            GO TO STORE DATA                     48500002
STR03400 TM    WRKFLAGS,INCL       INCLUDE                              48600002
         BO    STR03500            NO                                   48700002
         CLC   LENLEFT,TWLV        MORE THAN 12                         48800002
         BNL   STR03200            YES                                  48900002
STR03500 LA    REGB,STR03200       GO GET BUFFER                        49000002
         B     STR02900                                                 49100002
STR03600 LA    REGC,WRKOUTPT       OUTPUT ADDRESS                       49200002
         LH    REGB,WRKLEN         PICK UP ENTIRE LENGTH IN REGISTER    49300002
         B     STR00330                                                 49400002
         EJECT                                                          49450002
ERR01    SR    REGZERO,REGZERO     SET LENGTH TO ZERO            A33271 49650002
         ST    REGZERO,LENLEFT                                   A33271 49660002
ERR1     OI    0(ERRCD),STORAGE    SET STORAGE EXCEED FLAG       A33271 49670002
         MVC   STOR(4,ERRCD),THREE  BUFFER                              49692002
ERREXIT  LA    REGFIFTN,CODE8      RETURN CODE TO CALLER         YM1963 49700002
         B     STR00205            RETURN TO CALLER              YM1963 49800002
ERR1A    LA    REGA,4                                                   49900002
         CLC   GDSGDOAL,F128+2     128 SEGMENT, CODE OK                 50000002
         BE    ERR1B                                                    50100002
         LA    REGA,1(REGA)        CODE FOR IKL RELEASE                 50200002
ERR1B    ST    REGA,WRKPRLST                                            50300002
         LA    PARM,WRKPRM                                              50400002
*//      CALL BUFFER MGT                                                50500002
         L     REGFIFTN,STAT(ERRCD)                                     50600002
         L     REGFIFTN,BMGT(REGFIFTN)                                  50700002
         BALR  RETURN,REGFIFTN                                          50800002
         B     ERREXIT             EXIT                                 50900002
ERR2A    LR    OACB,REGD           RESET OACB ADDR                      51000002
         L     REGD,ORIG                                                51100002
         ST    REGD,GDSAOACB       RESET ORIG OACB                      51200002
         L     REGZERO,BUF1        LENGTH FOR FREEMAIN                  51300002
         L     PARM,CPU1           ADDR OF FREEMAIN                     51400002
         FREEMAIN R,LV=(0),A=(1)   FREEMAIN OF CORE FROM UPDATE         51500002
         OI    0(ERRCD),STORAGE                                         51520002
         OI    STOR+3(ERRCD),ONE   UPDATE OVERFLOW                      51540002
         B     ERREXIT                                                  51560002
ERR2     OI    0(ERRCD),STORAGE    SET STORAGE EXCEEDED FLAG            51600002
         MVC   STOR(4,ERRCD),TWO   SELF DEFINED LIMIT EXCEEDED          51700002
         SR    REGZERO,REGZERO      SET LENGTH TO ZERO          OY02461 51750002
         ST    REGZERO,LENLEFT      STORE IN LENLEFT FIELD      OY02461 51760002
         B     ERREXIT                                                  51800002
ERR3     L     ERRCD,WRKRTNCD                                           51820002
         OI    0(ERRCD),IO                                              51840002
         B     ERREXIT                                                  51860002
         EJECT                                                          51900002
* REGISTERS                                                             52000002
REGZERO  EQU   0                                                        52100002
PARM     EQU   1                                                        52200002
REGA     EQU   2                                                        52300002
REGB     EQU   3                                                        52400002
REGC     EQU   4                                                        52500002
WORK     EQU   5                                                        52600002
ERRCD    EQU   6                                                        52700002
*//*//*                                                                 52800002
*//*//*  CAUTION: REGE IS THE SAME REGISTER AS ERRCD                    52900002
*//*//*  ERRCD WILL BE RESET AT STR00505                                53000002
*//*//*                                                                 53100002
REGE     EQU   6         ///*** CAUTION--SAME REGISTER AS ERRCD         53200002
GTMREG   EQU   7                                                        53300002
GDSREG   EQU   8                                                        53400002
BASE     EQU   9                                                        53500002
OACB     EQU   10                                                       53600002
REGD     EQU   11                                                       53700002
SAVE     EQU   13                                                       53800002
RETURN   EQU   14                                                       53900002
REGFIFTN EQU   15                                                       54000002
CODE0    EQU   0                   RETURN CODE 0                 YM1963 54030002
CODE8    EQU   8                   RETURN CODE 8-GDOA FREED      YM1963 54060002
         EJECT                                                          54100002
         GINIT                                                          54200002
CHRBP    GECP  B                   D     R     T     P     R            54300002
CHRLP    GECP  L                    O     E     H     H     S           54400002
CHRBU    GECF  B                           O     E     I                54500002
CHRLU    GECF  L                      N     R     S     C               54600002
VABS     GEVM  A                       O     D     E                    54700002
VINC     GEVI2                          T     E           O             54800002
PABS     GEPM  A                               R    G      R            54900002
PINC     GEPI2                                       R      D           55000002
GNOP2    GNOP2                                        A      E          55100002
GESD     GESD                                                           55200002
         EJECT                                                          55300002
CBP      EQU   X'80'               SWITCH SETTINGS FOR GDSGRMOD         55400002
CLP      EQU   X'40'                                                    55500002
CBU      EQU   X'20'                                                    55600002
CLU      EQU   X'10'                                                    55700002
VA       EQU   X'08'                                                    55800002
VI       EQU   X'04'                                                    55900002
PA       EQU   X'02'                                                    56000002
PI       EQU   X'01'                                                    56100002
GDOA1    EQU   4                                                        56200002
STAT1    EQU   8                                                        56300002
CRSA1    EQU   12                                                       56400002
OLP1     EQU   16                                                       56500002
BLP1     EQU   20                                                       56600002
BUFSTRT1 EQU   24                                                       56700002
BUFLN1   EQU   28                                                       56800002
CPU3     EQU   32                                                       56900002
LOGSTRT1 EQU   48                                                       57000002
LOGCURR1 EQU   52                                                       57100002
LENLFT1  EQU   56                                                       57200002
STOR     EQU   12                                                       57300002
STORAGE  EQU   X'10'                                                    57400002
UPDT     EQU   X'20'                                                    57500002
         EJECT                                                          57600002
MOVE1    MVC   2(1,REGA),0(REGC)                                        57700002
ZEROOUT  XC    0(1,REGD),0(REGD)                                        57800002
MOVE     MVC   0(1,REGB),WRKOUTPT                                       57900002
CONTUNRE EQU   X'01'                                                    58000002
RESOLVE  EQU   X'02'                                                    58100002
BEGSUB   EQU   X'04'                                                    58200002
INCL     EQU   X'10'                                                    58300002
BUFSUB   EQU   X'08'                                                    58400002
NOBUF    EQU   X'80'                                                    58500002
ONE      EQU   1                                                        58600002
BUFACQ   EQU   X'7F'                                                    58700002
SAVEFOUR EQU   X'40'                                                    58800002
LEN      EQU   20                                                       58900002
EQUIV    EQU   X'08'                                                    59000002
CVTLINK  EQU   8                                                        59100002
BMGT     EQU   816                                                      59200002
STAT     EQU   24                                                       59300002
CURSOR   EQU   X'20'                                                    59400002
OVERFLOW EQU   X'20'                                                    59500002
BFROVFLW EQU   X'60'         ORGEN REQUIRES BUFFER FOR OVERFLOW  A34801 59550002
PERMIT   EQU   X'01'                                                    59600002
IO       EQU   X'04'                                                    59650002
FOUR     DC    F'4'                                                     59700002
ZERO     DC    2F'0'                                                    59800002
TWO      DC    F'2'                                                     59900002
F128     DC    F'128'                                                   60000002
THREE    DC    F'3'                                                     60100002
FRTN     DC    F'14'                                                    60200002
SXTN     DC    F'16'                                                    60300002
TEN      DC    F'10'                                                    60400002
TWLV     DC    F'12'                                                    60500002
GTRU     GTRU  0                                                        60600002
SIX      DC    F'6'                                                     60700002
ZEROOU   XC    0(1,REGB),0(REGB)   ZERO OUT AN AREA                     60800002
         EJECT                                                          60900002
WORKAREA DSECT                                                          61000002
WRKGDS   DS    F                                                        61100002
WRKRTNCD DS    F                                                        61200002
WRKFLAGS DS    H                                                        61300002
WRKLEN   DS    H                                                        61400002
WRKOUTPT DS    9F                                                       61500002
WRKSAVE  DS    18F                                                      61600002
WRKSPVSR DS    3F                                                       61700002
WRKTEMP  DS    F                                                        61800002
WRKPRLST DS    4F                                                       61900002
WRKBUFR  DS    F                                                        62000002
WRKPRM   DS    F                                                        62100002
WRKRTN   DS    F                                                        62200002
         EJECT                                                          62300002
OACBAREA DSECT                                                          62400002
OTHER    DS    F                                                        62500002
GDOA     DS    F                                                        62600002
STATUS   DS    F                                                        62700002
CRSA     DS    F                                                        62800002
OLP      DS    F                                                        62900002
BLP      DS    F                                                        63000002
BUFSTART DS    F                                                        63100002
BUFLEN   DS    F                                                        63200002
CPU1     DS    F                                                        63300002
BUF1     DS    F                                                        63400002
CPU2     DS    F                                                        63500002
BUF2     DS    F                                                        63600002
LOGSTRT  DS    F                                                        63700002
LOGCURR  DS    F                                                        63800002
LENLEFT  DS    F                                                        63900002
ORIG     DS    F                                                        64000002
         COPY  GDSCB                                                    64100002
         COPY  GTMCB                                                    64200002
         COPY  GSPCB                                                    64300002
         END                                                            64400002
