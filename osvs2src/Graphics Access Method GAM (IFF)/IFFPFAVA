         TITLE 'GVARC-CIRCULAR ARC GENERATION ROUTINE(WITH VECTORS)'  * 00020021
*STATUS. CHANGE LEVEL 0                                               * 00040021
*                                                                     * 00060021
*FUNCTION/OPERATION. GVARC GENERATES THE GRAPHIC ORDER AND DATA TO    * 00080021
*   DISPLAY A CIRCLE OR ARC, OR A POLYGON OR SEGMENT OF POLYGON ON    * 00100021
*   THE DISPLAY UNIT SCREEN AND STORES THEM IN THE GRAPHIC DATA OUTPUT* 00120021
*   AREA-(GDOA)                                                       * 00140021
*                                                                     * 00160021
*ENTRY POINTS.GVARC VIA CALL OR LINK MACRO  ALIAS NAME IFFPFAVA       * 00180021
*                                                                     * 00200021
*INPUT.OUTPUT CONTROL BLOCK POINTER(OCBP) AND A PARAMETER TABLE       * 00220021
*   WHICH CONTAINS PARAMETERS REQUIRED BY GVARC                       * 00240021
*                                                                     * 00260021
*OUTPUT.A GRAPHIC ORDER GEVM TO CAUSE DISPLAY UNIT ENTERING INTO      * 00280021
*   VECTOR MODE AND A SERIES OF DATA BYTES WHICH CONTAIN THE X,Y      * 00300021
*   COORDINATES OF THE END POINTS OF THE IMAGE. THE OUTPUT OF THIS    * 00320021
*   ROUTINE IS STORED IN GDOA                                         * 00340021
*                                                                     * 00360021
*EXTERNAL ROUTINES. GOFFSG ROUTINE WILL BE USED WHENEVER NEEDED       * 00380021
*                                                                     * 00400021
*EXITS-NORMAL.COMPLETION OF TASK EXIT VIA RETURN MACRO                * 00420021
*     -ERROR.HEXADECIMAL 4,12,16,20,24,28,AND 32(WHEN OFF-SCREEN ONLY)* 00440021
*   IN REG 15 RETURN IMMEDIATELY. EXIT VIA RETURN MACRO               * 00460021
*     -ERROR.HEXADECIMAL 32(WHEN NOT OFF-SCREEN),40,44,48 IN REG 15   * 00480021
*   DO NOT RETURN IMMEDIATELY. UPON COMPLETION OF TASK,RETURN VIA     * 00500021
*   RETURN MACRO                                                      * 00520021
*                                                                     * 00540021
*TABLES/WORK AREAS. USER SPECIFIED PARAMETER TABLE,XYLIM TABLE AND    * 00560021
*   WORK AREA                                                         * 00580021
*                                                                     * 00600021
*ATTRIBUTES.READ ONLY,REENTRANT                                       * 00620021
*                                                                     * 00640021
IFFPFAVA CSECT                          GVARC                           00660021
*0669                                                              7468 00670021
         ENTRY GVARC                                                    00680021
GVARC    SAVE  (14,12),T,*              SAVE REGISTERS                  00700021
         BALR  9,0                                                      00720021
         USING *,9                                                      00740021
         SR    NPAREG,NPAREG            INIT  NO.OF POINTS ATTEMPTED    00760021
*                                                                       00780021
*   INITIALIZATION                                                      00800021
*                                                                       00820021
MAINRT   L     WRKREG,0(0,1)            GET OCBP ADDRESS                00840021
         L     PATREG,4(0,1)            GET PARTAB ADDRESS              00860021
         USING PARTAB,PATREG                                            00880021
         L     WKAREG,4(0,WRKREG)       GET WORKAREA ADDRESS            00900021
         USING WKAREA,WKAREG                                            00920021
         L     OABREG,0(WRKREG)         GET OACB ADDRESS                00940021
         ST    OABREG,WOACB                                             00960021
         L     XYLREG,XYLIM             LOAD XYLIM ADDR INTO XYLREG     00980021
         USING XYLIMTB,XYLREG                                           01000021
*  SAVE MASK BITS AS SET BY USER                                        01020021
         ST    9,MASKSV                                                 01040021
         SR    WRKREG,WRKREG                                            01060021
         SPM   WRKREG                                                   01080021
         MVC   WUC,UC                   SAVE UC VC FOR WORKING          01100021
         MVC   WVC,VC                                                   01120021
         MVC   WR,RU                    SAVE RADIUS FOR WORKING         01140021
         MVC   WALPHA,ALPHA             SAVE ALPHA FOR WORKING          01160021
         MVC   GOFFSGAD,ZERO            ZERO OUT GOFFSG ADDR AREA       01180021
         SR    15,15                    CLEAR ERROR CODE REGISTER       01200021
         ST    15,ERRCOUNT              CLEAR ERROR COUNT               01220021
         BAL   LINREG,XYLCHK                                            01240021
*                                                                       01260021
*   TEST OFF S/G OPTION SPECIFIED AND DECIDE BOUNDARY TO BE OBSERVED    01280021
*                                                                       01300021
TESTSG   CLI   SG,C'A'                  IS OPTION A SPECIFIED           01320021
         BE    MVGRDLIM                 IF YES USE GRID LIMITS          01340021
         CLI   SG,C'B'                  IS OPTION B SPECIFIED           01360021
         BE    MVSCRLIM                 IF YES USE SCREEN LIMITS        01380021
         CLI   SG,C'C'                  IS C OPTION SPECIFIED           01400021
         BE    MVGRDLIM                 IF YES USE GRID LIMITS          01420021
         CLI   SG,C'D'                  IS D OPTION SPECIFIED           01440021
         BE    MVGRDLIM                 IF YES USE GRID LIMITS          01460021
         CLI   SG,C'E'                  IS E OPTION SPECIFIED           01480021
         BE    MVSCRLIM                 IF YES USE SCREEN LIMITS        01500021
         BAL   LINREG,ERR40             OTHERWISE INPUT ERROR ASSUME E  01520021
MVSCRLIM LA    WRKREG,SCRCHK            GET SCREEN CHECK RT ADDR        01540021
         ST    WRKREG,WRTADDR           STORE THE ROUTINE ADDR USED     01560021
         LA    WRKREG,ZERO              GET SCREEN LIMITS START ADDR    01580021
         ST    WRKREG,SABL              STORE THE ADDRESS AT SABL       01600021
         B     TESTF                                                    01620021
MVGRDLIM LA    WRKREG,GRDCK             LOAD GRID CHECK RT ADDR         01640021
         ST    WRKREG,WRTADDR           STORE THE ROUTINE ADDR USED     01660021
         ST    XYLREG,SABL              STORE GRID LIMITS ADDR          01680021
TESTF    CLI   F,C'F'                   TEST FOR FLOAT                  01700021
         BE    FLTRT                                                    01720021
         CLI   F,C'B'                   TEST FOR FIX                    01740021
         BE    TESTSC                                                   01760021
         BAL   LINREG,ERR40                                             01780021
TESTSC   CLI   S,C'S'                   TEST FOR SCALING                01800021
         BE    SCALFIX                                                  01820021
         CLI   S,C'N'                   TEST FOR NO SCALING             01840021
         BE    TESTIN                                                   01860021
         BAL   LINREG,ERR40                                             01880021
         B     TESTIN                                                   01900021
FLTRT    CLI   S,C'S'                   TEST FOR SCALING                01920021
         BE    SCALFLT                                                  01940021
         CLI   S,C'N'                   TEST FOR NO SCALING             01960021
         BE    FCONVERT                                                 01980021
         BAL   LINREG,ERR40                                             02000021
         B     FCONVERT                                                 02020021
*                                                                       02040021
*   TEST OTHER INPUT PARAMETERS                                         02060021
*                                                                       02080021
TESTIN   SR    NPAREG,NPAREG            INITIATE PT COUNT               02100021
         C     NPAREG,WR                COMPARE RADIUS TO ZERO          02120021
         BNL   ERR20RET       IF NEGATIVE OR ZERO SET ERROR CODE        02140021
         CH    NPAREG,THETA             COMPARE ZERO TO THETA           02160021
         BH    ERR20RET                                                 02180021
         CH    NPAREG,GAMMA                                             02200021
         BH    ERR20RET                                                 02220021
         CLI   INC,C'D'                 TEST IF INC=D                   02240021
         BE    TESTD                     IF SO TEST DENSITY FIELD       02260021
         CLI   INC,C'A'                 TEST IF INC=A                   02280021
         BE    TESTA                     IF SO TEST ALPHA FIELD         02300021
         B     ERR20RET                                                 02320021
*                                                                       02340021
*   MAIN ROUTINE                                                        02360021
*                                                                       02380021
TESTD    CH    NPAREG,DENSITY           COMPARE ZERO TO DENSITY         02400021
         BH    ERR20RET                 IF NEGTIVE GO TO SET ERRORCODE  02420021
         L     WRKREG,FOUR                                              02440021
         CH    WRKREG,DENSITY           COMPARE FOUR TO DENSITY         02460021
         BH    COMALP                   GO TO COMPUTE ALPHA AS D IS 0-3 02480021
CONVRD   L     MPCREG,C360              CONVERT DENSITY TO ALPHA        02500021
         MH    MPCREG,DENSITY           DENSITY*360                     02520021
         SRDA  MPCREG,32                                                02540021
         SLDA  MPCREG,28                                                02560021
         D     MPCREG,TWOPI                                             02580021
         SR    MPCREG,MPCREG                                            02600021
         D     MPCREG,WR                DIVIDED BY RADIUS               02620021
         SLA   MPCREG,1                 SHIFT TO DOUBLE THE REMAINDER   02640021
         C     MPCREG,WR                                                02660021
         BL    CHECK                    NO ROUNDING IF 2*REMAINDER LT R 02680021
        A     PRDREG,ONE                ROUND BY ADD ONE TO QUOTIENT    02700021
CHECK    C     PRDREG,ZERO              CHECK VALIDITY OF RESULT        02720021
         BL    ERR20RET                                                 02740021
         BE    SETALP                                                   02760021
         STH   PRDREG,WALPHA            SAVE COMPUTED ALPHA             02780021
         B     ALPRECK                                                  02800021
TESTA    CH    NPAREG,ALPHA             COMPARE ALPHA TO ZERO           02820021
         BH    ERR20RET                 IF NEGTIVE GO TO SET ERRORCODE  02840021
         BNE   ALPRECK                                                  02860021
COMALP   LA    DVDREG,345                IF YES COMPUTE ALPHA           02880021
         C     DVDREG,WR                                                02900021
         BL    SETALP                    OTHERWISE                      02920021
         SRDA  DVDREG,32(0)                                             02940021
         D     DVDREG,WR                                                02960021
         STH   QUOREG,WALPHA            SAVE COMPUTED ALPHA             02980021
ALPRECK  LH    WRKREG,WALPHA            GET ALPHA                       03000021
         C     WRKREG,C360              COMPARE ALPHA TO 360            03020021
         BH    ERR20RET                 IF OVER 360 GO TO SET ERRCODE   03040021
         B     STOEVM                                                   03060021
SETALP   L     WRKREG,ONE               SET ALPHA TO ONE                03080021
         STH   WRKREG,WALPHA            STORE ALPHA                     03100021
STOEVM   STM   2,12,PORSAVE             STORE REGISTERS                 03120021
         MVC   GOMODE,EVM                                               03140021
         LA    CNTREG,2                 PASSING BYTE NUMBER             03160021
         LA    ADDREG,EVM                       GEVM ADDRESS            03180021
         L     OABREG,WOACB             GET OACB ADDR SAVED             03200021
         BAL   LINREG,STORE                                             03220021
         LM    2,12,PORSAVE             RESTORE REGISTERS               03240021
         MVI   BMSWITCH,X'11'           SET BEAM SWITCH OFF             03260021
TESTGM   LH    DVDREG,GAMMA             SEE IF GAMMA ZERO               03280021
         CH    DVDREG,ZERO               IF YES                         03300021
         BE    ONEPT                      THIS IS ONE POINT PLOTTING    03320021
         SRDA  DVDREG,32(0)                                             03340021
         D     DVDREG,C360                COMPUTE GAMMA(MOD 360)        03360021
         C     DVDREG,ZERO              CHECK IF GAMMA(MOD 360) ZERO    03380021
         BNE   ARCRT                     IF NOT IT IS AN ARC            03400021
         L     GMREG,C360                IF YES SET GAMMI=360 (CIRCLE)  03420021
         B     PROCEED                                                  03440021
ONEPT    SR    GMREG,GMREG              GAMMI=0 IF ONE POINT            03460021
         B     PROCEED                                                  03480021
ARCRT    LR    GMREG,DVDREG             GAMMI=GAMMA(MOD 360)            03500021
PROCEED  LH    DVDREG,THETA             GET THETA                       03520021
         SRDA  DVDREG,32(0)                                             03540021
         D     DVDREG,C360              COMPUTE THET=THETA(MOD 360)     03560021
         AR    GMREG,DVDREG              GAMM=GAMMI+THET                03580021
         STH   GMREG,WGAMMA                                             03600021
         STH   DVDREG,WTHETA            SAVE INITIAL THETA              03620021
         STH   DVDREG,WDELTA            SAVE INITIAL THETA AS DELTA     03640021
DTENTRY  SRDA  DVDREG,32                                                03660021
         D     DVDREG,C90               COMPUTE THET(MOD 90)            03680021
         SLA   QUOREG,1                                                 03700021
         C     DVDREG,ZERO               IS THET=K TIMES 90             03720021
         BNE   COMPXYI                   IF NOT GO TO COMPUTE XYI       03740021
         C     QUOREG,ZERO               IF YES ASSIGN XI YI VALUES     03760021
         BNE   TESTG2                     DEPENDING ON QUADRANT         03780021
         MVC   WXI,WR                   FOR ZERO DEGREE                 03800021
         MVC   WYI,ZERO                 XI=R,YI=0                       03820021
         B     FDENTRY                  GO TO FORM DATA                 03840021
TESTG2   C     QUOREG,TWO                                               03860021
         BNE   TESTH2                                                   03880021
         MVC   WXI,ZERO                 FOR 90 DEGREE                   03900021
         MVC   WYI,WR                    XI= 0,YI=R                     03920021
         B     FDENTRY                                                  03940021
TESTH2   C     QUOREG,FOUR                                              03960021
         BNE   SETXYI                                                   03980021
         L     WRKREG,WR                FOR 180 DEGREE                  04000021
         LNR   XREG,WRKREG               XI=-R  YI=0                    04020021
         ST    XREG,WXI                 SAVE COMPUTED XI                04040021
         MVC   WYI,ZERO                  SET YI=0                       04060021
         B     FDENTRY                                                  04080021
SETXYI   MVC   WXI,ZERO                 FOR 270 DEGREE                  04100021
         L     WRKREG,WR                 XI=0 YI=-R                     04120021
         LNR   YREG,WRKREG                                              04140021
         ST    YREG,WYI                                                 04160021
         B     FDENTRY                                                  04180021
COMPXYI  C     QUOREG,ZERO              CHECK IF THET IN 1ST OR 3RD Q   04200021
         BC    8,NORMAL                  IF YES GO TO NORMAL ROUTINE    04220021
         C     QUOREG,FOUR                                              04240021
         BC    8,NORMAL                                                 04260021
         L     WRKREG,C90                                               04280021
         SR    WRKREG,DVDREG                                            04300021
         LR    DVDREG,WRKREG                                            04320021
         STH   DVDREG,WTHETA                                            04340021
NORMAL   C     DVDREG,C45               COMPARE THET TO 45              04360021
         BH    OVER45                                                   04380021
         LR    WRKREG,DVDREG            LOAD THET TO WK REG             04400021
         MH    WRKREG,PLUS4                                             04420021
         LH    XREG,TABLE+2(WRKREG)    GET  COS(THET)                   04440021
         SRDA  XREG,32                                                  04460021
         M     XREG,WR                  XI=R*COS(THET)                  04480021
         A     PRDREG,C8192            ROUND TO THE NEAREST INTEGER     04500021
         SRA   PRDREG,14                                                04520021
         MH    PRDREG,CSIGN(QUOREG)                                     04540021
         ST    PRDREG,WXI               SAVE XI                         04560021
         L     YREG,TABLE(WRKREG)                                       04580021
         SRDA  YREG,48                                                  04600021
         M     YREG,WR                  YI=R*SIN(THET)                  04620021
         A     PRDREG,C8192            ROUND TO THE NEAREST INTEGER     04640021
         SRA   PRDREG,14                                                04660021
         MH    PRDREG,SSIGN(QUOREG)                                     04680021
         ST    PRDREG,WYI               SAVE YI                         04700021
         B     FDENTRY                  GO TO FORM XY DATA              04720021
OVER45   LR    WRKREG,DVDREG            ROUTINE FOR THET OVER 45        04740021
         MH    WRKREG,MINUS4                                            04760021
         L     XREG,TABLE+360(WRKREG)                                   04780021
         SRDA  XREG,48                                                  04800021
         M     XREG,WR                  XI=R*COS(THET)                  04820021
         A     PRDREG,C8192            ROUND TO THE NEAREST INTEGER     04840021
         SRA   PRDREG,14                                                04860021
         MH    PRDREG,CSIGN(QUOREG)                                     04880021
         ST    PRDREG,WXI               SAVE XI                         04900021
         LH    YREG,TABLE+362(WRKREG)                                   04920021
         SRDA  YREG,32                                                  04940021
         M     YREG,WR                                                  04960021
         A     PRDREG,C8192            ROUND TO THE NEAREST INTEGER     04980021
         SRA   PRDREG,14                                                05000021
         MH    PRDREG,SSIGN(QUOREG)                                     05020021
         ST    PRDREG,WYI               SAVE YI                         05040021
FDENTRY  A     NPAREG,ONE                                               05060021
         L     WRKREG,WXI               COMPUTE X=XI&XC                 05080021
         A     WRKREG,WUC                                               05100021
SAVEX    ST    WRKREG,COMPUX            SAVE COMPUTED X                 05120021
         STH   WRKREG,BUILDXY           SAVE SIGNIFICANT PORTION OF X   05140021
         L     WRKREG,WYI               COMPUTE Y=YI&YC                 05160021
         A     WRKREG,WVC                                               05180021
         ST    WRKREG,COMPUY            SAVE COMPUTED Y                 05200021
         STH   WRKREG,BUILDXY+2         SAVE SIGNIFICANT PART OF Y      05220021
         CLI   BMSWITCH,X'11'           SEE IF THIS IS FIRST PT         05240021
         BE    FIRSTPT                  IF YES GO TO FIRST PT SUBRT     05260021
         MVC   PT1SW(1),OFFSW           SAVE PREVIOUS SW STATUS         05280021
         MVC   PREVPT(8),CURPT                                          05300021
         MVC   CURPT(8),COMPUX          UPDATE PT2                      05320021
         L     WRKREG,WRTADDR           GET BOUNDARY CHECK RT ADDRESS   05340021
         BALR  LINREG,WRKREG             AND BRANCH TO CHECK            05360021
         CLC   SWSTATUS,STATUS1         CHECK THE SWS STATUS IF STATUS1 05380021
         BE    FILGDOA                  BOTH PTS OK GO TO FILL GDOA     05400021
OPTIONA  CLI   SG,C'A'                  OTHERWISE OFFSG CONDITION EXIST 05420021
         BNE   OPTIONB                   CHECK USER-SPECIFIED OPTION    05440021
         BAL   LINREG,ERR44             IF A OPTION SET ERR CODE AND    05460021
         B     ANALOFF                   ANALIZE OFF STATUS TO HANDLE   05480021
OPTIONB  CLI   SG,C'B'                  IS B OPTION SPECIFIED           05500021
         BNE   OPTIONC                  IF NOT TEST FOR C               05520021
         BAL   LINREG,ERR48             IF YES SET ERR CODE AND         05540021
         B     ANALOFF                   ANALIZE OFF STATUS TO HANDLE   05560021
OPTIONC  CLI   SG,C'C'                  IS C OPTION SPECIFIED           05580021
         BNE   OPTIOND                  IF NOT TEST FOR D               05600021
         BAL   LINREG,SCRCHK            IF YES FURTHER CHECK IF THE PT  05620021
         CLI   OFFSW,X'11'               OFF SCREEN                     05640021
         BE    ERR32RET                 IFF OFF SCREEN IMMEDIATE RET    05660021
         LA    15,32                    OTHERWISE SET ERROR CODE AND    05680021
         BAL   LINREG,ERRCNT             CONTINUE THE JOB               05700021
         BAL   LINREG,GRDCK             RESTORE THE PT STATUS           05720021
         B     ANALOFF                  GO TO ANALIZE OFF STATUS        05740021
OPTIOND  CLI   SG,C'D'                  IS OPTION D SPECIFIED           05760021
         BNE   ASSUMEE                  IF NOT ASSUME OPTION E          05780021
         B     ERR28RET                 IMMEDIATE ERROR RETURN          05800021
ASSUMEE  B     ERR32RET                 IMMEDIATE ERROR RETURN          05820021
FIRSTPT  MVC   CURPT(8),COMPUX          PLACE FIRST PT AS CURRENT PT    05840021
         MVI   BMSWITCH,X'00'           RESTORE THE BEAM SW             05860021
         L     WRKREG,WRTADDR           GET BOUNDARY CHECK RT ADDR      05880021
         BALR  LINREG,WRKREG            GO TO CHECK PT VALIDITY         05900021
         CLI   OFFSW,X'11'              IS THE PT OFF BOUNDARY          05920021
         BE    FIRSTOUT                 IF SO GO TO FIRSTOUT HANDLING   05940021
         L     WRKREG,COMPUX            IF WITHIN LIMITS BLANK BEAM     05960021
         A     WRKREG,C16384                                            05980021
         STH   WRKREG,BUILDXY           PUT BLANKED X TO XY BUILDAREA   06000021
         B     FILGDOA                  BRANCH TO FILL GDOA             06020021
FIRSTOUT CLI   SG,C'A'                  IS OPTION A SPECIFIED           06040021
         BNE   CKFORB                   IF NOT GO TO CHECK FOR B        06060021
         BAL   LINREG,ERR44             IF A OPTION GO TO SET ERRORCODE 06080021
         B     CKENTRY                   AND CONTINUE THE JOB           06100021
CKFORB   CLI   SG,C'B'                  IS OPTION B SPECIFIED           06120021
         BNE   CKFORC                   IF NOT GO TO CHECK FOR C        06140021
         BAL   LINREG,ERR48             IF B SPECIFIED SET ERROR CODE   06160021
         B     CKENTRY                   AND CONTINUE THE JOB           06180021
CKFORC   CLI   SG,C'C'                  IS C OPTION SPECIFIED           06200021
         BNE   OPTIOND                  IF NOT GO TO OPTION D TEST      06220021
         BAL   LINREG,SCRCHK            IF C OPTION TEST IF OFF SCREEN  06240021
         BE    ERR32RET                 IF OFF SCREEN IMMEDIATE RETURN  06260021
         LA    15,32                    OTHERWISE SET ERROR CODE        06280021
         BAL   LINREG,ERRCNT            UPDATE ERROR COUNT              06300021
         MVI   OFFSW,X'11'              RESTORE OFF BOUNDARY STATUS     06320021
         B     CKENTRY                  CONTINUE THE JOB                06340021
ANALOFF  STM   13,0,PORSAVE             SAVE REGISTERS                  06360021
         ST    13,OVFSAVE+4             SAVE POR SAVEAREA CHAINING ADDR 06380021
         ST    15,SVR15                 SAVE ERROR REGISTER             06400021
         LA    13,OVFSAVE               LOAD GOFFSG RT SAVEAREA ADDR    06420021
         LR    WRKREG,1                 SAVE REG1-WKAREA POINTER        06440021
         CLC   GOFFSGAD,ZERO            CHECK IF GOFFSG RT ADDR AREA 0  06460021
         BNE   OFFHDLG                  IF NOT RT BROUGHT IN GO TO HDL  06480021
         LA    1,SABL                   LOAD 24-WORD PARTAB START ADDR  06500021
         LOAD  EP=GOFFSG                RETAIN THE MODULE               06520021
         LR    1,WRKREG                 RESTORE REGISTER 1              06540021
         ST    0,GOFFSGAD               SAVE GOFFSG RT ADDRESS          06560021
OFFHDLG  L     15,GOFFSGAD              LOAD GOFFSG RT ADDRESS          06580021
         LA    1,SABL                   LOAD 24-WORD PARTAB ADDR        06600021
         BALR  14,15                    BRANCH TO GOFFSG RT             06620021
         LR    1,WRKREG                 RESTORE REG 1                   06640021
LINKOUT  LM    13,0,PORSAVE             RESTORE REG 13 TO 0             06660021
         L     15,SVR15                 RESTORE ERROR REGISTER          06680021
*   ANALIZE THE RESPONSE OF GOFFSG ROUTINE AND GENERATE PROPER DATA     06700021
ANALRES  CLC   NI,ZERO                  IS NI=0                         06720021
         BE    NOINTS                   IF SO GO TO NO INTERSECT RT     06740021
         CLC   NI,ONE                   IS NI=1                         06760021
         BE    ONEINTS                  IF SO GO TO ONE INTERSECT RT    06780021
BOTHOUT  LH    WRKREG,INTS1             OTHERWISE GDV I1X,I1Y,B         06800021
         A     WRKREG,C16384             AND GDV I2X,I2Y,U              06820021
         STH   WRKREG,INTS1             STORE THE BEAM BLANKED I1X      06840021
         STM   2,12,PORSAVE             THEN SAVE REGISTERS             06860021
         LA    CNTREG,8                 LOAD BYTE NUMBER                06880021
         LA    ADDREG,INTS1             LOAD I1 I2 STARTING ADDR        06900021
         B     STOREP                   BRANCH TO STORING POINT         06920021
NOINTS   CLC   SWSTATUS,STATUS2         SEE IF PT1 OFF PT2 ON           06940021
         BE    NOINTSA                  IF SO IT'S NO INTS CONDITION A  06960021
         B     CKENTRY                  CONTINUE THE JOB                06980021
NOINTSA  LH    WRKREG,BUILDXY           GET BUILT X                     07000021
         A     WRKREG,C16384            BLANK THE BEAM BIT              07020021
         STH   WRKREG,PRIORXY           STORE TO WKAREA PRIOR TO BLDXY  07040021
         MVC   PRIORXY+2(2),BUILDXY+2   PUT Y2 IN                       07060021
LOADATA  STM   2,12,PORSAVE             SAVE REGISTERS                  07080021
         LA    CNTREG,8                 LOAD BYTE NUMBER                07100021
         LA    ADDREG,PRIORXY           GDV X2,Y2,B AND X2,Y2,U ADDR    07120021
         B     STOREP                                                   07140021
ONEINTS  CLC   SWSTATUS,STATUS2         SEE IF PT1 OFF PT2 ON           07160021
         BE    ONEINTSA                 IF SO GO TO ONE INTS CONDITIONA 07180021
         CLC   SWSTATUS,STATUS3         SEE IF PT1 ON PT2 OFF           07200021
         BE    ONEINTSB                 IF SO GO TO ONE INTS CONDITIONB 07220021
         B     BOTHOUT                                                  07240021
ONEINTSA LH    WRKREG,INTS1             GENERATE GDV I1X,I1Y,B          07260021
         A     WRKREG,C16384                                            07280021
         STH   WRKREG,PRIORXY                                           07300021
         MVC   PRIORXY+2(2),INTS1+2     IS IMMEDIATELY BEFORE BUILDXY   07320021
         B     LOADATA                  BRANCH TO LOAD DATA             07340021
ONEINTSB MVC   BUILDXY(4),INTS1         GENERATE GDV I1X,I1Y,U          07360021
FILGDOA  STM   2,12,PORSAVE                                             07380021
         LA    CNTREG,4                 LOAD BYTE NUMBER                07400021
         LA    ADDREG,BUILDXY                                           07420021
STOREP   L     OABREG,WOACB                                             07440021
         BAL   LINREG,STORE             BRANCH AND LINK TO STORE RT     07460021
         LM    2,12,PORSAVE                                             07480021
CKENTRY  LH    DELREG,WDELTA            GET DELTA                       07500021
         CH    DELREG,WGAMMA            COMPARE DELTA TO GAMMA          07520021
         BE    RET                      IF EQUAL JOB IS COMPLLETED      07540021
         AH    DELREG,WALPHA            ADD ALPHA                       07560021
         STH   DELREG,WDELTA            STORE DELTA                     07580021
         CH    DELREG,WGAMMA            COMPARE DELTA TO GAMM           07600021
         BC    12,NEWTHET                IF LE COMPUTE NEW THET         07620021
         MVC   WDELTA,WGAMMA            SET DELTA=GAMM                  07640021
         LH    DELREG,WDELTA                                            07660021
NEWTHET  LR    DVDREG,DELREG            LOAD DELT TO DIVIDEND REG       07680021
         SRDA  DVDREG,32                                                07700021
         D     DVDREG,C360              THET NOT OVER 360               07720021
         STH   DVDREG,WTHETA                                            07740021
         B     DTENTRY                                                  07760021
RET      CLC   GOFFSGAD,ZERO            WAS GOFFSG ROUTINE BROUGHT IN   07780021
         BE    RET1                                                     07800021
         ST    15,SVR15                 SAVE ERROR REGISTER             07820021
         LR    WRKREG,1                 SAVE REGISTER 1                 07840021
         DELETE EP=GOFFSG                                               07860021
         LR    1,WRKREG                 RESTORE REGISTER 1              07880021
         L     15,SVR15                 RESTORE ERROR REGISTER          07900021
RET1     LA    WRKREG,1                                                 07920021
         C     WRKREG,ERRCOUNT                                          07940021
         BL    SETBIT                                                   07960021
* RESTORE PROGRAM MASK TO SETTING UPON ENTRY                            07980021
RETMACRO L     WRKREG,MASKSV                                            08000021
         SPM   WRKREG                                                   08020021
         RETURN (14,12),T,RC=(15)                                       08040021
SETBIT   O     15,MZERO                                                 08060021
         B     RETMACRO                                                 08080021
*                                                                       08100021
* STORE GRAPHIC DATA IN GDOA FOR POR                                    08120021
* INPUT TO SUBROUTINE                                                   08140021
*   CNTREG = NUMBER OF BYTES OF GRAPHIC DATA TO STORE                   08160021
*   ADDREG = ADDRESS OF THE GRAPHIC DATA                                08180021
*   WKAREG = REGISTER 1 MUST CONTAIN THE WORKAREA ADDRESS               08200021
*   OABREG = ADDRESS OF OACB                                            08220021
STORE    SR    PASREG,PASREG            CLEAR OVERFLOW PASS INDICATOR   08240021
STORE1   L     OLPREG,16(0,OABREG)      ADDRESS OF OLP FROM OACB        08260021
         LR    WRKREG,CNTREG            LOAD BYTES TO MOVE              08280021
*                                                                       08300021
* CALCULATE ADDRESSES BASED ON N VALUE AND SIZE OF GDOA                 08320021
*                                                                       08340021
STORE2   AR    OLPREG,WRKREG            OLP ADDRESS PLUS N VALUE        08360021
         LA    TEMREG,4                                                 08380021
         AR    TEMREG,OLPREG            OLP PLUS N PLUS 4               08400021
         L     SLOREG,0(OABREG)         SLOA ADDRESS                    08420021
         A     SLOREG,4(OABREG)         ADD LOA EQUALS TOTAL GDOA       08440021
         CR    TEMREG,SLOREG                                            08460021
         L     OLPREG,16(0,OABREG)      RESET INITIAL OLP ADDRESS       08480021
         BC    12,OK                    ROOM FOR DATA                   08500021
*                                                                       08520021
* NOT ENOUGH ROOM TO STORE ALL OF THE DATA-DETERMINE AMOUNT TO STORE    08540021
*                                                                       08560021
         SR    TEMREG,SLOREG            EQUAL BYTES-CAN'T STORE         08580021
         SR    WRKREG,TEMREG            NUMBER OF BYTES CAN STORE       08600021
*                                                                       08620021
* ANY BYTES TO STORE                                                    08640021
*                                                                       08660021
         C     WRKREG,ZERO                                              08680021
         BC    12,STORE4                LESS OF EQUAL TO ZERO           08700021
         LH    TEMREG,H2A02                                             08720021
         CH    TEMREG,GOMODE                                            08740021
         BH    STORE3A                                                  08760021
         LH    TEMREG,H0003                                             08780021
         NR    TEMREG,WRKREG                                            08800021
         BM    STORE4      GO TO USER OVERFLOW ROUTINE (FAVA)      7468 08820021
STORE3A  SR    CNTREG,WRKREG       BYTES REMAINING                      08840021
         BAL   INTLNK,STORE6            LINK INTERNALLY                 08860021
STORE3   LA    PASREG,1                 SET PASS INDICATOR              08880021
*                                                                       08900021
* STORE REGISTERS IN WORKAREA                                           08920021
*                                                                       08940021
         STM   0,15,OVFSAVE             SAVE REGISTERS                  08960021
         CLC   GOFFSGAD,ZERO            WAS GOFFSG BROUGHT IN           08980021
         BE    LAOVFLO                  IF SO GO TO OVERFLOW HDLG       09000021
         SR    WRKREG,WRKREG                                            09020021
         ST    WRKREG,GOFFSGAD          CLEAR GOFFSG ROUTINE ADDR       09040021
         LR    3,1                      SAVE REG 1.                     09060021
         DELETE EP=GOFFSG                                               09080021
         LR    1,3                      RESTORE REG 1.                  09100021
LAOVFLO  L     15,8(0,OABREG)           LOAD OVERFLOW ADDRESS           09120021
         LM    2,12,28(13)              RESET USERS REGISTERS           09140021
         BALR  14,15                    LINK TO ROUTINE-SET RETURN      09160021
         LM    0,15,OVFSAVE             RELOAD AND CONTINUE TO STORE    09180021
         B     STORE1                   GET NEW OLP ADDRESS-CONTINUE    09200021
*                                                                       09220021
* NO SPACE AVAILABLE                                                    09240021
*                                                                       09260021
*                                                                       09280021
STORE4   C     PASREG,ONE               WAS A TRANSFER TO OVERFLOW MADE 09300021
         BC    4,STORE3                 NO                              09320021
*                                                                       09340021
* SET ERROR CODE AND RETURN TO POR-LEAVE POR WITH RETURN MACRO          09360021
*                                                                       09380021
         LA    15,24                    SET ERROR CODE                  09400021
         B     RET                      SYMBOLIC IN POR                 09420021
*                                                                       09440021
*                                                                       09460021
OK       BAL   INTLNK,STORE6            LINK INTERNALLY                 09480021
         BR    LINREG                                                   09500021
STORE6   LA    TEMREG,255               SET REG. EQUAL TO 255           09520021
STORE6A  CR    WRKREG,TEMREG            IS AMOUNT TO MOVE OVER 255      09540021
         BC    2,STORE7                 YES                             09560021
         LR    TEMREG,WRKREG                                            09580021
         S     TEMREG,ONE               COMPENSATE FOR EXTRA BYTE       09600021
         EX    TEMREG,MOVE              MOVE GRAPHIC DATA               09620021
         AR    OLPREG,WRKREG            UPDATE OLP ADDRESS              09640021
         AR    ADDREG,WRKREG            UPDATE DATA ADDR                09660021
         ST    OLPREG,16(0,OABREG)      STORE NEW OLP ADDRESS           09680021
         BR    INTLNK                   RETURN INTERNALLY               09700021
STORE7   LR    SLOREG,TEMREG                                            09720021
         S     SLOREG,ONE               COMPENSATE FOR EXTRA BYTE       09740021
         EX    SLOREG,MOVE              MOVE GRAPHIC DATA               09760021
         AR    OLPREG,TEMREG            UPDATE OLP ADDRESS              09780021
         AR    ADDREG,TEMREG            UPDATE INPUT ADDRESS            09800021
         SR    WRKREG,TEMREG           REDUCE BY 255                    09820021
         B     STORE6A                  MAKE NEXT COMPARISON            09840021
MOVE     MVC   0(0,OLPREG),0(ADDREG)    MOVE DATA TO GDOA               09860021
*                                                                       09880021
*   SUBROUTINE TO CHECK IF INPUT COORDINATES WITHIN GRID                09900021
*                                                                       09920021
GRDCK    LH    WRKREG,X1                GET X1                          09940021
         C     WRKREG,COMPUX            SEE IF COMPUTED X OUTSIDE GRID  09960021
         BH    SIGNAL                                                   09980021
         LH    WRKREG,X2                GET X2                          10000021
         C     WRKREG,COMPUX            SEE IF COMPUTED X OUTSIDE GRID  10020021
         BL    SIGNAL                                                   10040021
         LH    WRKREG,Y1                GET Y1                          10060021
         C     WRKREG,COMPUY            SEE IF COMPUTED Y OUTSIDE GRID  10080021
         BH    SIGNAL                                                   10100021
         LH    WRKREG,Y2                GET Y2                          10120021
         C     WRKREG,COMPUY            SEE IF COMPUTED Y OUTSIDE GRID  10140021
         BL    SIGNAL                                                   10160021
         MVI   OFFSW,X'00'              WITHIN LIMIT SET SW OFF         10180021
         BR    LINREG                                                   10200021
*                                                                       10220021
*   SUBROUTINE TO CHECK IF INPUT COORDINATES WITHIN SCREEN              10240021
*                                                                       10260021
SCRCHK   L     WRKREG,COMPUX            GET COMPUTED X                  10280021
         C     WRKREG,ZERO              COMPARE TO ZERO                 10300021
         BL    SIGNAL                   IF NEGATIVE SIGNAL OFFSG        10320021
         C     WRKREG,C4095             COMPARE TO 4095                 10340021
         BH    SIGNAL                   IF HIGHER SIGNAL OFFSG          10360021
         L     WRKREG,COMPUY            GET COMPUTED Y AND              10380021
         C     WRKREG,ZERO               TEST IN THE SAME WAY           10400021
         BL    SIGNAL                                                   10420021
         C     WRKREG,C4095                                             10440021
         BH    SIGNAL                                                   10460021
         MVI   OFFSW,X'00'              WITHIN LIMIT SET SW OFF         10480021
         BR    LINREG                                                   10500021
SIGNAL   MVI   OFFSW,X'11'              SET OFFGRID SWITCH ON           10520021
         BR    LINREG                                                   10540021
* SCALE UC VC IN FIXED POINT WITH THE FOLLOWING FORMULAS                10560021
*                                                                       10580021
*   UC=(U-U1)(X2-X1)/(U2-U1)+X1                                         10600021
*   VC=(V-V1)(Y2-Y1)/(V2-V1)+Y1                                         10620021
*                                                                       10640021
SCALFIX  STM   2,12,PORSAVE                                             10660021
FIXSCAL  LA    CNTREG,2                                                 10680021
         SR    HALREG,HALREG            INDEX REG FOR X1 THEN Y1        10700021
         SR    SCLREG,SCLREG            INDEX REG FOR UC THEN VC        10720021
         SR    INXREG,INXREG            INDEX REG FOR UI THEN VI        10740021
SCALFXV  L     DVSREG,U2(INXREG)        LOAD U2 THEN V2                 10760021
         S     DVSREG,U1(INXREG)        U2-U1 THEN V2-V1                10780021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    10800021
         L     DVDREG,UC(SCLREG)        LOAD UC THEN VC                 10820021
         S     DVDREG,U1(INXREG)        UC-U1 OR VC-V1                  10840021
         LH    WRKREG,X2(HALREG)        LOAD X2 THEN Y2                 10860021
         SH    WRKREG,X1(HALREG)        X2-X1 OR Y2-Y1                  10880021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    10900021
         SRDA  DVDREG,32                                                10920021
         MR    DVDREG,WRKREG            (UC-U1)(X2-X1)OR(VC-V1)(Y2-Y1)  10940021
         DR    DVDREG,DVSREG            DEVIDED BY U2-U1 ORV2-V1        10960021
         AH    QUOREG,X1(HALREG)        ADD X1 OR Y1                    10980021
         ST    QUOREG,WUC(SCLREG)       STORE SCALED UC VC FOR WORKING  11000021
         A     INXREG,EIGHT                                             11020021
         A     SCLREG,FOUR              INDEXING REGISTER               11040021
         A     HALREG,TWO               INDEXING REGISTER               11060021
         BCT   CNTREG,SCALFXV           LOOP TO SCALE VC                11080021
* SCALE RU USING FORMULA                                                11100021
*                                                                       11120021
*   R=RU*(X2-X1)/(U2-U1)                                                11140021
*                                                                       11160021
         L     DVSREG,U2                GET U2                          11180021
         S     DVSREG,U1                U2-U1                           11200021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    11220021
         LH    DVDREG,X2                LOAD X2                         11240021
         SH    DVDREG,X1                X2-X1                           11260021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    11280021
         SRDA  DVDREG,32                                                11300021
         M    DVDREG,RU                 RU*(X2-X1) AND                  11320021
         DR    DVDREG,DVSREG            DIVIDED BY (U2-U1)              11340021
         ST    QUOREG,WR                                                11360021
         LM    2,12,PORSAVE                                             11380021
         B     TESTIN                                                   11400021
*    CONVERT XYLIM TABLE TO FLOATING VALUES                             11420021
SCALFLT  STM   2,12,PORSAVE                                             11440021
*    FLOATING POINT SPECIFIED - TEST FOR CHARACTERISTIC ZERO AND        11460021
*    FRACTION NON ZERO. OF ALL U,V VALUES                               11480021
         L     VALREG,UC                                                11500021
         BAL   LINREG,FIXCONV                                           11520021
         L     VALREG,VC                                                11540021
         BAL   LINREG,FIXCONV                                           11560021
         L     VALREG,RU                                                11580021
         BAL   LINREG,FIXCONV                                           11600021
         L     VALREG,U1                                                11620021
         BAL   LINREG,FIXCONV                                           11640021
         L     VALREG,U2                                                11660021
         BAL   LINREG,FIXCONV                                           11680021
         L     VALREG,V1                                                11700021
         BAL   LINREG,FIXCONV                                           11720021
         L     VALREG,V2                                                11740021
         BAL   LINREG,FIXCONV                                           11760021
         LA    CNTREG,4                 SET LOOP COUNT                  11780021
         SR    HALREG,HALREG            SET HALF WORK INDEX REG         11800021
         SR    SCLREG,SCLREG            CLEAR FULL WORD INDEX REG       11820021
NEXTXY   LH    VALREG,X1(HALREG)        GET X1,Y1,X2,Y2                 11840021
         BAL   LINREG,FLTCONV           BRANCH TO CONVERT               11860021
         ST    VALREG,FX1(SCLREG)       STORE CONVERTED VALUES          11880021
         A     HALREG,TWO               INDEXING HALF WORD              11900021
         A     SCLREG,FOUR              INDEXING FULL WORD              11920021
         BCT   CNTREG,NEXTXY                                            11940021
*                                                                       11960021
*                                                                       11980021
* SCALE UC VC IN FLOATING POINT WITH THE FOLLOWING FORMULAS             12000021
*                                                                       12020021
*  UC=(UC-U1)(X2-X1)/(U2-U1)+X1                                         12040021
*  VC=(VC-V1)(Y2-Y1)/(V2-V1)+Y1                                         12060021
*                                                                       12080021
FLTSCAL  LA    CNTREG,2                                                 12100021
         SR    INXREG,INXREG                                            12120021
         SR    SCLREG,SCLREG                                            12140021
SCALFLV  LE    REG6,U1(INXREG)          LOAD U1 THEN V1                 12160021
         LE    REG4,U2(INXREG)          LOAD U2 THEN V2                 12180021
         SER   REG4,REG6                     U2-U1                      12200021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    12220021
         LE    REG0,UC(SCLREG)          LOAD UC THEN VC                 12240021
         SER   REG0,REG6                U-U1  OR V-V1                   12260021
         LE    REG6,FX1(SCLREG)         LOAD X1 OR Y1 FLT VALUE         12280021
         LE    REG2,FX2(SCLREG)         X2 OR Y2 FLOAT VALUE            12300021
         SER   REG2,REG6                (X2-X1)                         12320021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    12340021
         MER   REG0,REG2                (U-U1)(X2-X1)                   12360021
         DER   REG0,REG4                (U-U1)(X2-X1)                   12380021
         AER   REG0,REG6                                                12400021
         STE   REG0,WUC(SCLREG)         STORE UC VC SCALED VALUES       12420021
         A     INXREG,EIGHT                                             12440021
         A     SCLREG,FOUR                                              12460021
         BCT   CNTREG,SCALFLV                                           12480021
*                                                                       12500021
* SCALE RU IN FLOATING POINT WITH THE FOLLOWING FORMULAS                12520021
*                                                                       12540021
*   R=RU*(X2-X1)/(U2-U1)                                                12560021
*                                                                       12580021
         LE    REG6,U1                  LOAD U1                         12600021
         LE    REG4,U2                  LOAD U2                         12620021
         SER   REG4,REG6                U2-U1                           12640021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    12660021
         LE    REG0,RU                  GET RADIUS IN PARTAB            12680021
         LE    REG6,FX1                 LOAD X1 FLOAT VALUE             12700021
         LE    REG2,FX2                 LOAD X2 FLOAT VALUE             12720021
         SER   REG2,REG6                FX2-FX1                         12740021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    12760021
         MER   REG0,REG2                RU*(X2-X1)                      12780021
         DER   REG0,REG4                DIVIDED BY U2-U1                12800021
         STE   REG0,WR                  STORE SCALED RADIUS             12820021
         LM    2,12,PORSAVE                                             12840021
*                                                                       12860021
*    CONVERT FLOATING UC VC RU TO FIXED POINT VALUES                    12880021
FCONVERT L     VALREG,WR                LOAD RADIUS                     12900021
         BAL   LINREG,FIXCONV           FIXCONV=CONVERT FLT TO FIX      12920021
         ST    VALREG,WR                STORE THE CONVERTED RADIUS      12940021
         L     VALREG,WUC               GET UC                          12960021
         BAL   LINREG,FIXCONV                                           12980021
         ST    VALREG,WUC               STORE CONVERTED UC              13000021
         L     VALREG,WVC               GET VC                          13020021
         BAL   LINREG,FIXCONV                                           13040021
         ST    VALREG,WVC               STORE CONVERTED VC              13060021
         B     TESTIN                                                   13080021
FIXCONV  ST    1,OVFSAVE                STORE IN FIRST WORD REG. 1      13100021
         TM    OVFSAVE+3,X'07'          TEST LAST THREE BITS            13120021
         BZ    SETMODI                  NO BITS ON SET INDEX TO ZERO    13140021
         LA    TEMREG,4                 SET MODIFIER                    13160021
         B     SAVFLT                   START CONVERSION                13180021
SETMODI  LA    TEMREG,0                 SET MODIFIER TO ZERO            13200021
SAVFLT   ST    VALREG,TEMFLT(TEMREG)    SAVE FLOAT VALUE                13220021
         SR    WRKREG,WRKREG                                            13240021
         ST    WRKREG,TEMFLT+4(TEMREG)  CLEAR SECOND WORD               13260021
         LD    6,TEMFLT(TEMREG)         VALUE TO FLOAT REGISTERS        13280021
         N     VALREG,FCHAR                                             13300021
         BE    FLERR1                   CHARACTERISTIC IS ZERO          13320021
         AE    6,FLPT5                  ADD .5 TO ROUND                 13340021
         AW    6,X4E                    ADD UNNORMALIZED-RIGHT JUSTIFY  13360021
         STD   6,TEMFLT(TEMREG)         SAVE VALUES                     13380021
         L     WRKREG,TEMFLT+4(TEMREG)  CHECK SECOND WORD               13400021
         N     WRKREG,MZERO             CHECK BIT 32                    13420021
         BM    ERR12RET                 INCICATE ERROR                  13440021
         L     WRKREG,TEMFLT(TEMREG)                                    13460021
         N     WRKREG,BYTE123                                           13480021
         BM    ERR12RET                                                 13500021
         L     WRKREG,TEMFLT(TEMREG)                                    13520021
         N     WRKREG,MZERO             DROP CHARACTERISTIC             13540021
         L     VALREG,TEMFLT+4(TEMREG)  NEW FIXED VALUE                 13560021
         LTR   WRKREG,WRKREG                                            13580021
         BNL   NOTNEG                                                   13600021
         LNR   VALREG,VALREG            TWO'S COMPLEMENT                13620021
NOTNEG   BR    LINREG                                                   13640021
FLERR1   CE    6,ZERO                   IS TOTAL VALUE ZERO             13660021
         BE    NOTNEG                   RETURN                          13680021
         B     ERR12RET                 SET ERROR CODE AND RETURN       13700021
         DS    0D                                                       13720021
X4E      DC    X'4E00000000000000'                                      13740021
FLPT5    DC    E'.5'                                                    13760021
BYTE123  DC    X'00FFFFFF'                                              13780021
MZERO    DC    X'80000000'                                              13800021
FCHAR    DC    X'7F000000'                                              13820021
XZERO    DC    X'80FFFFFF'              SIGN AND VALUE -DROP EXPONENT   13840021
X6       DC    X'46000000'              EXPONENT OF SIX                 13860021
NSIGN    DC    X'7FFFFFFF'                                              13880021
*                                                                       13900021
*   CONVERT FIXED POINT TO FLOATING POINT VALUES                        13920021
*                                                                       13940021
FLTCONV  O     VALREG,X6                EXPONENT OF 6                   13960021
         ST    VALREG,OVFSAVE                                           13980021
         LE    0,OVFSAVE                LOAD TO FLOAT REG.              14000021
         AE    0,X6                     NORMALIZE                       14020021
         STE   0,OVFSAVE                                                14040021
         L     VALREG,OVFSAVE           FLOAT PT VALUE IN REG.          14060021
         BR    LINREG                                                   14080021
*    CHECK XYLIM TABLE                                                  14100021
XYLCHK   LH    XYREG1,X1                LOAD X1                         14120021
         LH    XYREG2,X2                LOAD X2                         14140021
         LA    CONREG,2                 SET LOOP CONTROL                14160021
XYLOOP   CR    XYREG1,XYREG2            COMPARE X1 TO X2                14180021
         BNL   XYLERR                                                   14200021
         C     XYREG1,ZERO              COMPARE X1 TO ZERO              14220021
         BL    XYLERR                                                   14240021
         C     XYREG1,C4095             COMPARE X1 TO 4095              14260021
         BH    XYLERR                                                   14280021
         C     XYREG2,ZERO              CHECK X2                        14300021
         BL    XYLERR                                                   14320021
         C     XYREG2,C4095                                             14340021
         BH    XYLERR                                                   14360021
         LH    XYREG1,Y1                LOAD Y1                         14380021
         LH    XYREG2,Y2                LOAD Y2                         14400021
         BCT   CONREG,XYLOOP                                            14420021
         BR    LINREG                                                   14440021
XYLERR   B     ERR4RET                                                  14460021
*INPUT INVALID- ERROR HANDLING                                          14480021
ERR4RET  LA    15,4                     XYLIM X1,Y1,X2,Y2 ERROR         14500021
         B     ERRCNTR                                                  14520021
ERR12RET LA    15,12                                                    14540021
         B     ERRCNTR                                                  14560021
ERR16RET LA    15,16                    U1 V1 GREATER THAN U2 V2        14580021
         B     ERRCNTR                                                  14600021
ERR20RET LA    15,20                    IMMEDIATE INPUT RETURN          14620021
         B     ERRCNTR                                                  14640021
ERR24RET LA    15,24                    USERS OVERFLOW                  14660021
         B     ERRCNTR                                                  14680021
ERR28RET LA    15,28                    SET ERROR CODE                  14700021
         B     ERRCNTR                                                  14720021
ERR32RET LA    15,32                                                    14740021
         B     ERRCNTR                                                  14760021
ERR40    LA    15,40                    INPUT ERROR - NOT SERIOUS       14780021
         B     ERRCNT                                                   14800021
ERR44    LA    15,44                                                    14820021
         B     ERRCNT                                                   14840021
ERR48    LA    15,48                                                    14860021
         B     ERRCNT                                                   14880021
ERRCNTR  LA    LINREG,RET                                               14900021
ERRCNT   L     TEMREG,ERRCOUNT          UPDATE ERROR COUNT              14920021
         A     TEMREG,ONE                                               14940021
         ST    TEMREG,ERRCOUNT                                          14960021
         BR    LINREG                                                   14980021
ZERO     DC    F'0'                                                     15000021
         DC    H'4095,4095'             HIGH LIMITS OF SCREEN           15020021
ONE      DC    F'1'                                                     15040021
TWO      DC    F'2'                                                     15060021
FOUR     DC    F'4'                                                     15080021
EIGHT    DC    F'8'                                                     15100021
TWOPI    DC    FS28'6.2832'             DEFINE TWOPI VALUE              15120021
EVM      DC    X'2A02'                  GEVM ORDER                      15140021
C16384   DC    F'16384'                                                 15160021
C8192    DC    F'8192'                                                  15180021
C4095    DC    F'4095'                                                  15200021
C360     DC    F'360'                                                   15220021
C90      DC    F'90'                                                    15240021
C45      DC    F'45'                                                    15260021
H2A02    DC    X'2A02'                                                  15280021
H0003    DC    H'0003'                                                  15300021
PLUS4    DC    X'0004'                                                  15320021
MINUS4   DC    X'FFFC'                                                  15340021
CSIGN    DC    X'0001FFFFFFFF0001'                                      15360021
SSIGN    DC    X'00010001FFFFFFFF'                                      15380021
TABLE    DC    HS14'0.0000,1.0000,0.0175,0.9999'                        15400021
         DC    HS14'0.0349,0.9994,0.0523,0.9986'                        15420021
         DC    HS14'0.0698,0.9976,0.0872,0.9962'                        15440021
         DC    HS14'0.1045,0.9945,0.1219,0.9925'                        15460021
         DC    HS14'0.1392,0.9903,0.1564,0.9877'                        15480021
         DC    HS14'0.1737,0.9848,0.1908,0.9816'                        15500021
         DC    HS14'0.2079,0.9782,0.2250,0.9744'                        15520021
         DC    HS14'0.2419,0.9703,0.2588,0.9659'                        15540021
         DC    HS14'0.2756,0.9613,0.2924,0.9563'                        15560021
         DC    HS14'0.3090,0.9511,0.3256,0.9455'                        15580021
         DC    HS14'0.3420,0.9397,0.3584,0.9336'                        15600021
         DC    HS14'0.3746,0.9272,0.3907,0.9205'                        15620021
         DC    HS14'0.4067,0.9136,0.4226,0.9063'                        15640021
         DC    HS14'0.4384,0.8988,0.4540,0.8910'                        15660021
         DC    HS14'0.4695,0.8830,0.4848,0.8746'                        15680021
         DC    HS14'0.5000,0.8660,0.5150,0.8572'                        15700021
         DC    HS14'0.5299,0.8481,0.5446,0.8387'                        15720021
         DC    HS14'0.5592,0.8290,0.5736,0.8192'                        15740021
         DC    HS14'0.5878,0.8090,0.6018,0.7986'                        15760021
         DC    HS14'0.6157,0.7880,0.6293,0.7772'                        15780021
         DC    HS14'0.6428,0.7660,0.6561,0.7547'                        15800021
         DC    HS14'0.6691,0.7431,0.6820,0.7314'                        15820021
         DC    HS14'0.6947,0.7193,0.7071,0.7071'                        15840021
STATUS1  DC    H'0'                     BOTH PT1 AND PT2 WITHIN LIMITS  15860021
STATUS2  DC    X'1100'                  PT1 OFF PT2 ON                  15880021
STATUS3  DC    X'0011'                  PT1 ON PT2 OFF                  15900021
REG0     EQU   0                                                        15920021
REG2     EQU   2                                                        15940021
REG4     EQU   4                                                        15960021
REG6     EQU   6                                                        15980021
HALREG   EQU   5                                                        16000021
SCLREG   EQU   6                                                        16020021
INXREG   EQU   7                                                        16040021
DVSREG   EQU   8                                                        16060021
XYREG1   EQU   7                                                        16080021
XYREG2   EQU   8                                                        16100021
VALREG   EQU   8                                                        16120021
XYLREG   EQU   14                                                       16140021
WKAREG   EQU   1                                                        16160021
DVDREG   EQU   2                                                        16180021
QUOREG   EQU   3                                                        16200021
GMREG    EQU   4                                                        16220021
DELREG   EQU   4                                                        16240021
WRKREG   EQU   4                                                        16260021
CONREG   EQU   5                                                        16280021
XREG     EQU   6                                                        16300021
YREG     EQU   6                                                        16320021
MPCREG   EQU   6                                                        16340021
PRDREG   EQU   7                                                        16360021
NPAREG   EQU   10                                                       16380021
PATREG   EQU   12                                                       16400021
PASREG   EQU   2                                                        16420021
SLOREG   EQU   3                                                        16440021
OLPREG   EQU   5                                                        16460021
TEMREG   EQU   6                                                        16480021
ADDREG   EQU   7                                                        16500021
OABREG   EQU   8                                                        16520021
CNTREG   EQU   10                                                       16540021
LINREG   EQU   11                                                       16560021
INTLNK   EQU   12                                                       16580021
WKAREA   DSECT                                                          16600021
OVFSAVE  DS    CL72                     18-WORD SAVEAREA FOR REGISTERS  16620021
         ORG   OVFSAVE                                                  16640021
TEMFLT   DS    CL8                      A  TEMPORARY SAVE AREA          16660021
         DS    CL64                                                     16680021
PORSAVE  DS    CL44                     A  REGISTER SAVE AREA           16700021
ERRCOUNT DS    CL4                      COUNT OF ERRORS                 16720021
FX1      DS    CL4                      FLOATING X1                     16740021
FY1      DS    CL4                      FLOATING Y1                     16760021
FX2      DS    CL4                      FLOATING X2                     16780021
FY2      DS    CL4                      FLOATING Y2                     16800021
WOACB    DS    CL4                      AN AREA TO SAVE OACB ADDRESS    16820021
WUC      DS    CL4                                                      16840021
WVC      DS    CL4                                                      16860021
WR       DS    CL4                                                      16880021
WTHETA   DS    CL2                                                      16900021
WALPHA   DS    CL2                                                      16920021
WGAMMA   DS    CL2                                                      16940021
WDELTA   DS    CL2                                                      16960021
WXI      DS    CL4                                                      16980021
WYI      DS    CL4                                                      17000021
PRIORXY  DS    CL4                      A 4-BYTE AREA BEFORE BUILT XY   17020021
BUILDXY  DS    CL4                      XY BUILDUP AREA                 17040021
COMPUX   DS    CL4                      COMPUTED X VALUE                17060021
COMPUY   DS    CL4                      COMPUTED Y VALUE                17080021
WRTADDR  DS    CL4                      ADDR OF GRID OR SCREEN CHECK RT 17100021
GOFFSGAD DS    CL4                      GOFFSG RT ADDR AREA             17120021
SABL     DS    CL4                      ADDR OF BOUNDARY LIMITS         17140021
PREVPT   DS    CL8                      PREVIOUS POINT                  17160021
CURPT    DS    CL8                      CURRENT POINT                   17180021
NI       DS    CL4                      NUMBER OF INTERSECTIONS         17200021
INTS1    DS    CL4                      INTERSECTION 1                  17220021
INTS2    DS    CL4                      INTERSECTION 2                  17240021
SCRATCH  DS    CL64                                                     17260021
SVR15    DS    CL4                      PLACE TO SAVE ERROR REGISTER    17280021
SWSTATUS DS    CL2                      SWITCH STATUS OF PT1 AND PT2    17300021
         ORG   SWSTATUS                                                 17320021
PT1SW    DS    CL1                      PREVIOUS STATUS                 17340021
OFFSW    DS    CL1                      CURRENT STATUS                  17360021
BMSWITCH DS    CL1                      BEAM SWITCH STATUS              17380021
MASKSV   DS    F                   SAVE SETTING OF USER PROGRAM MASK    17400021
         ORG   OVFSAVE+396                                              17420021
GOMODE   DS    CL2                                                      17440021
PARTAB   DSECT                                                          17460021
XYLIM    DS    CL4                                                      17480021
UC       DS    CL4                                                      17500021
VC       DS    CL4                                                      17520021
F        DS    CL1                                                      17540021
S        DS    CL1                                                      17560021
INC      DS    CL1                                                      17580021
SG       DS    CL1                                                      17600021
RU       DS    CL4                                                      17620021
THETA    DS    CL2                                                      17640021
DENSITY  DS    CL2                                                      17660021
         ORG   DENSITY                                                  17680021
ALPHA    DS    CL2                                                      17700021
GAMMA    DS    CL2                                                      17720021
XYLIMTB  DSECT                                                          17740021
X1       DS    CL2                                                      17760021
Y1       DS    CL2                                                      17780021
X2       DS    CL2                                                      17800021
Y2       DS    CL2                                                      17820021
U1       DS    CL4                                                      17840021
U2       DS    CL4                                                      17860021
V1       DS    CL4                                                      17880021
V2       DS    CL4                                                      17900021
         END                                                            17920021
