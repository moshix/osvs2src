         TITLE 'GSVPLT SCALE AND PLOT'                                  00020021
*STATUS. CHANGE LEVEL 0                                                 00040021
*                                                                       00060021
*FUNCTION/OPERATION. GSVPLT GENERATES THE GRAPHIC ORDERS TO DISPLAY A   00080021
*   POINT,CHARACTER,OR VECTOR PLOT.  A COMBINATION OF THE VARIOUS PLOT  00100021
*   TYPES MAY BE DISPLAYED.                                             00120021
*   THE GRAPHIC ORDERS ARE STORED IN THE GRAPHIC DATA OUTPUT AREA(GDOA) 00140021
*                                                                       00160021
*ENTRY POINTS. GSVPLT VIA CALL OR LINK MACRO   ALIAS NAME IFFPGA        00180021
*INPUT.OUTPUT CONTROL BLOCK POINTER (OCBP) AND A PARAMETER ADDRESS      00200021
*   WHICH POINTS TO A SEQUENCE OF ADDRESSES AND EBCDIC CHARACTERS IN A  00220021
*   USER PROVIDED PARAMETER TABLE                                       00240021
*                                                                       00260021
*OUTPUT. A STRING OF GRAPHIC ORDERS SUITABLE FOR PLOTTING               00280021
*EXTERNAL ROUTINES. GOFFSG-OFF SCREEN/GRID INTERSECTION ROUTINE         00300021
*                                                                       00320021
*EXITS-NORMAL. COMPLETION OF TASK EXIT VIA RETURN MACRO                 00340021
*     -ERROR. HEXADECIMAL 4,C,10,18,1C, OR 20 IN REG. 15                00360021
*  IMMEDIATE RETURN. EXIT VIA RETURN MACRO                              00380021
*     -ERROR. HEXADECIMAL 28,2C OR 30 IN REG. 15 DOES NOT RETURN        00400021
*      IMMEDIATELY-COMPLETION OF TASK AND RETURN VIA RETURN MACRO       00420021
*                                                                       00440021
*TABLES/WORK AREAS. USER SPECIFIED PARAMETER TABLE, XYLIM TABLE, UTAB,  00460021
*   VTAB VALUE TABLES AND A USER SUPPLIED WORK AREA                     00480021
*                                                                       00500021
*ATTRIBUTES. READ ONLY, REENTRANT                                       00520021
*                                                                       00540021
IFFPGAVP CSECT                          GSVPLT                          00560021
* 102700,107040-107160,172700                                    A29402 00561021
* 138060,138120,174100                                           A28795 00562021
*0669                                                              7468 00565021
* GSVPLT ROUTINE-SAVE REGISTERS-SET RETURN REGISTER AND INITIALIZE      00580021
*                                                                       00600021
         ENTRY GSVPLT                                                   00620021
GSVPLT   SAVE  (14,12),T,*              SYSTEM SAVE MACRO               00640021
         BALR  9,0                                                      00660021
         USING *,9                      BASE REGISTER                   00680021
         USING XYLIM,PATREG                                             00700021
         USING X1,XYLREG                                                00720021
         USING OVFSAVE,WKAREG                                           00740021
         SR    15,15                    CLEAR RETURN CODE               00760021
         LM    OBPREG,PATREG,0(1)       LOAD CONTROL BLOCK AND PARTAB   00780021
         L     OABREG,0(0,OBPREG)       CONTROL BLOCK ADDRESS           00800021
         L     WKAREG,4(0,OBPREG)       WORK AREA ADDRESS               00820021
*  SAVE MASK BITS AS SET BY USER                                        00840021
         ST    9,MASKSV                                                 00860021
         SR    WRKREG,WRKREG                                            00880021
         SPM   WRKREG                                                   00900021
*   CLEAR WORKAREA-TOTAL TEMPORARY STORAGE                              00920021
*                                                                       00940021
         LA    CNTREG,72                COUNT FOR WORK AREA             00960021
         SR    CONREG,CONREG            SET INDEX CONTROL               00980021
CLEARWK  ST    15,OVFSAVE(CONREG)       CLEAR WORK AREA                 01000021
         A     CONREG,FOUR              MODIFY                          01020021
         BCT   CNTREG,CLEARWK           CONTINUE                        01040021
         MVI   COUNT+1,X'01'            SET COUNT TO 1                  01060021
* CHECK INPUT PARAMETERS                                                01080021
*                                                                       01100021
         L     XYLREG,XYLIM             XYLIM ADDRESS                   01120021
         BAL   INTREG,XYLCHK            CHK X1,X2,Y1,Y2 FOR LIMITS      01140021
*                                                                       01160021
* TEST IF FLOATING PT.OR FIXED IS SPECIFIED                             01180021
*                                                                       01200021
         CLI   F,C'B'                   FIXED PARAMETER                 01220021
         BE    OV1                      YES                             01240021
         CLI   F,C'F'                   FLOAT PRAAMETER                 01260021
         BE    OV1                      YES                             01280021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     01300021
OV1      CLI   S,C'S'                   SCALE                           01320021
         BE    OV2                      YES                             01340021
         CLI   S,C'N'                   NO SCALE                        01360021
         BE    OV2                      YES                             01380021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     01400021
*                                                                       01420021
* TEST FOR ABSOLUTE OR RELATIVE MODE                                    01440021
*                                                                       01460021
OV2      CLI   A,C'A'                   ABSOLUTE MODE                   01480021
         BE    OV3                      YES                             01500021
         CLI   A,C'R'                   RELATIVE MODE                   01520021
         BE    OV3                      YES                             01540021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     01560021
*                                                                       01580021
* TEST INCREMENT CODE                                                   01600021
*                                                                       01620021
OV3      CLI   I,C'W'                   NO-INCREMENT                    01640021
         BE    OV4                      YES                             01660021
         CLI   I,C'X'                   INCREMENT U-ONLY                01680021
         BE    OV4                      YES                             01700021
         CLI   I,C'Y'                   INCREMENT V-ONLY                01720021
         BE    OV4                      YES                             01740021
         CLI   I,C'Z'                   INCREMENT U AND V               01760021
         BE    OV4                      YES                             01780021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     01800021
*                                                                       01820021
* TEST PLOT TYPE CODE                                                   01840021
*                                                                       01860021
*                                                                       01880021
OV4      CLI   PTYPE,C'A'               POINT PLOT                      01900021
         BE    OV5                      YES                             01920021
         CLI   PTYPE,C'B'               CHARACTER PLOT                  01940021
         BE    OV5                      YES                             01960021
         CLI   PTYPE,C'C'               VECTOR PLOT                     01980021
         BE    OV5                      YES                             02000021
         CLI   PTYPE,C'D'               VECTOR AND POINT                02020021
         BE    OV5                      YES                             02040021
         CLI   PTYPE,C'E'               VECTOR AND CHARACTER            02060021
         BE    OV5                      YES                             02080021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     02100021
*                                                                       02120021
* CHECK S/G OPTIONS                                                     02140021
*                                                                       02160021
*                                                                       02180021
*   TEST OFF S/G OPTION SPECIFIED AND DECIDE BOUNDARY TO BE OBSERVED    02200021
*                                                                       02220021
OV5      CLI   SG,C'A'                  IS OPTION A SPECIFIED           02240021
         BE    MVGRDLIM                 IF YES USE GRID LIMITS          02260021
         CLI   SG,C'B'                  IS OPTION B SPECIFIED           02280021
         BE    MVSCRLIM                 IF YES USE SCREEN LIMITS        02300021
         CLI   SG,C'C'                  IS C OPTION SPECIFIED           02320021
         BE    MVGRDLIM                 IF YES USE GRID LIMITS          02340021
         CLI   SG,C'D'                  IS D OPTION SPECIFIED           02360021
         BE    MVGRDLIM                 IF YES USE GRID LIMITS          02380021
         CLI   SG,C'E'                  IS E OPTION SPECIFIED           02400021
         BE    MVSCRLIM                 IF YES USE SCREEN LIMITS        02420021
         BAL   LINREG,ERR40             OTHERWISE INPUT ERROR ASSUME E  02440021
MVSCRLIM LA    WRKREG,SCLCHK           GET SCREEN CHECK RT ADDRESS      02460021
         ST    WRKREG,WRTADDR           STORE THE ROUTINE ADDR USED     02480021
         LA    WRKREG,LOHI              SCREEN LIMITS START ADDRESS     02500021
         ST    WRKREG,SABL              STORE THE ADDRESS AT SABL       02520021
         B     OV6                                                      02540021
MVGRDLIM LA    WRKREG,GRLCHK           LOAD GRID ROUTINE CHECK ADDRESS  02560021
         ST    WRKREG,WRTADDR           STORE THE ROUTINE ADDR USED     02580021
         ST    XYLREG,SABL              STORE GRID LIMITS ADDR          02600021
OV6      CLC   N,ZERO                   N COMPARED TO ZERO              02620021
         BH    OV7                      N GREATER THAN ZERO             02640021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     02660021
* IS SYMBOL IN PARAMETER TABLE                                          02680021
*                                                                       02700021
OV7      CLI   PTYPE,C'B'               CHARACTER PLOT SPECIFIED        02720021
         BE    OV8                      YES                             02740021
         CLI   PTYPE,C'E'               VECTOR AND CHARACTER SPECIFIED  02760021
         BNE   STADD                    SKIP OVER-LAP CHECK             02780021
*                                                                       02800021
* IS CHARACTER GIVEN IN TABLE                                           02820021
*                                                                       02840021
OV8      LH    VALREG,SYMBOL            LETTER TO PLOT                  02860021
         N     VALREG,BYTE3             MASK FOR THIRD BYTE             02880021
         BC    4,CHSMOD                 LETTER PRESENT                  02900021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     02920021
*                                                                       02940021
*   SUBROUTINE TO TEST AND DEVELOPE GRAPHIC ORDER  FOR                  02960021
*   CHARACTER MODE AND SIZE                                             02980021
*   PATREG CONTAINS THE ADDRESS OF THE PARAMETER TABLE ON ENTRY         03000021
*   ORDREG CONTAINS THE GRAPHIC ORDER DEVELOPED ON RETURN               03020021
*   IF MODE OR SIZE ARE INCORRECTLY SPECIFIED, UNPROTECTED AND BASIC    03040021
*   ARE ASSUMED                                                         03060021
CHSMOD   CLI   CMOD,C'P'                PROTECTED                       03080021
         BE    PLEG                                                     03100021
         CLI   CMOD,C'F'                UNPROTECTED                     03120021
         BE    FLEG                                                     03140021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     03160021
FLEG     LH    VALREG,GFSC                                              03180021
SIZE     CLI   CSIZE,C'L'               LARGE                           03200021
         BE    SIZEL                                                    03220021
         CLI   CSIZE,C'B'               BASIC                           03240021
         BE    ORDSTO                                                   03260021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     03280021
ORDSTO   STH   VALREG,CHARMOD           ORDER-MODE-SIZE                 03300021
         B     NOCHK                    CHECK OVERLAP LETTER            03320021
SIZEL    A     VALREG,ONE               MODIFY ORDER TO LARGE           03340021
         B     ORDSTO                                                   03360021
PLEG     LH    VALREG,GFPC                                              03380021
         B     SIZE                                                     03400021
GFSC     DC    X'2A40'                                                  03420021
GFPC     DC    X'2A44'                                                  03440021
*                                                                       03460021
* CHECK OVERLAP LETTERS                                                 03480021
NOCHK    CLI   E,C'O'                   OVERLAP LETTER PRESENT          03500021
         BE    STADD                    YES                             03520021
         CLI   E,C'N'                   NO-OVERLAP-WANTED               03540021
         BE    STADD                    YES                             03560021
         BAL   LINREG,ERR40             SET ERROR CODE-COUNT ERRORS     03580021
*                                                                       03600021
* STORE VALUES FROM UTAB AND VTAB IN WORKAREA-SCALED VALUES AFTER SCALE 03620021
*                                                                       03640021
STADD    L     WRKREG,UTAB              UTAB ADDRESS                    03660021
         L     VALREG,0(0,WRKREG)       FIRST VALUE                     03680021
         ST    VALREG,UA                ABSOLUTE UA                     03700021
         ST    VALREG,UASCALE           ABSOLUTE-MAY BE SCALED          03720021
         STH   VALREG,X2FIN             MAY BE FINAL FIXED VALUE        03740021
         L     WRKREG,VTAB              VTAB ADDRESS                    03760021
         L     VALREG,0(0,WRKREG)       FIRST VALUE                     03780021
         ST    VALREG,VA                ABSOLUTE VA                     03800021
         ST    VALREG,VASCALE           ABSOLUTE-MAY BE SCALED          03820021
         STH   VALREG,Y2FIN             MAY BE FINAL FIXED VALUE        03840021
*                                                                       03860021
* IS FLOATING SPECIFIED                                                 03880021
*                                                                       03900021
         CLI   F,C'F'                   FLOATING PT. SPECIFIED          03920021
         BNE   NOFLOAT                  INDICATES FIXED OR NO PARAMETER 03940021
*                                                                       03960021
* IS SCALING SPECIFIED                                                  03980021
*                                                                       04000021
         CLI   S,C'S'                   SCALING SPECIFIED               04020021
         BNE   NOSCALE1                 INDICATES NO SCALE-CONVERT TO   04040021
*                                       FIXED PT. UA VALUES             04060021
*                                                                       04080021
* SET UP VALUES TO CONVERT XYLIM TABLE TO FLOATING POINT VALUES         04100021
*                                                                       04120021
         LA    CONREG,4                 DO FOUR VALUES                  04140021
         SR    INXREG,INXREG            CLEAR CONTROL MODIFICATION      04160021
         SR    CNTREG,CNTREG            CLEAR CONTROL MODIFICATION      04180021
NEXTXY   LH    VALREG,X1(INXREG)        GET X1,Y1,X2,Y2 VALUES          04200021
         BAL   LINREG,FLTCONV           CONVERT FIXED VALUE TO FLOAT PT 04220021
         ST    VALREG,FX1(CNTREG)       STORE IN WORKAREA               04240021
         A     INXREG,TWO               MODIFY BY TWO BYTES             04260021
         A     CNTREG,FOUR              MODIFY BY FOUR BYTES            04280021
         BCT   CONREG,NEXTXY                                            04300021
*                                                                       04320021
* FLOATING POINT SCALE-SUBROUTINE                                       04340021
* EQUATION XS=(UA-U1)*(X2-X1)/(U2-U1)+X1                                04360021
* EQUATION YS=(VA-V1)*(Y2-Y1)/(V2-V1)+Y1                                04380021
*                                                                       04400021
FLTSCAL  LA    CNTREG,2                 SET CONTROL                     04420021
         SR    CONREG,CONREG            CLEAR MODIFIER                  04440021
         SR    INXREG,INXREG            CLEAR MODIFIER                  04460021
FLTSCAL1 LE    6,U1(CONREG)             U1 THEN V1                      04480021
         LE    4,U2(CONREG)             U2 THEN V2                      04500021
         SER   4,6                      U2-U1 THEN V2-V1                04520021
         BC    13,ERR16RET         MINUS OR ZERO                        04540021
* LOAD FLOATING PT VALUE FROM WORKAREA                                  04560021
         LE    0,UA(INXREG)             UA-STORED THRU UN               04580021
         SER   0,6                      UA-U1 VARIABLE RESULT           04600021
         LE    6,FX1(INXREG)            X1 OR Y1 CONVERTED VALUE        04620021
         LE    2,FX2(INXREG)            X2 OR Y2 CONVERTED VALUE        04640021
         SER   2,6                                                      04660021
         MER   0,2                      UA-U1*X2-X1 OR VA-V1*Y2-Y1      04680021
         DER   0,4                      /U2-U1 OR V2-V1                 04700021
         AER   0,6                      +X1 OR Y1                       04720021
         STE   0,UASCALE(INXREG)        X OR Y SCALED VALUE             04740021
         A     CONREG,EIGHT             MODIFY FOR V1-V2                04760021
         A     INXREG,FOUR                                              04780021
         BCT   CNTREG,FLTSCAL1                                          04800021
*                                                                       04820021
* SCALE WAS SPECIFIED OR NO SCALE IS REQUIRED-CONVERT DATA TO FIXED PT. 04840021
*                                                                       04860021
*                                                                       04880021
NOSCALE1 LA    CONREG,2                 SET CONTROL                     04900021
         SR    CNTREG,CNTREG            CLEAR INDEX VALUE               04920021
         SR    INXREG,INXREG                                            04940021
NEXTSCAL L     VALREG,UASCALE(INXREG)   LOAD SCALED OR UNSCALED VALUE   04960021
         BAL   INTREG,FIXCONV           CONVERT TO FIXED PT.            04980021
         ST    VALREG,UASCALE(INXREG)   CONVERTED FIXED VALUE           05000021
         STH   VALREG,X2FIN(CNTREG)     FINAL VALUE                     05020021
         A     CNTREG,TWO               MODIFY                          05040021
         A     INXREG,FOUR                                              05060021
         BCT   CONREG,NEXTSCAL                                          05080021
         B     CHKCNT                                                   05100021
*                                                                       05120021
* FLOATING PT IS NOT SPECIFIED                                          05140021
* IS SCALING SPECIFIED                                                  05160021
*                                                                       05180021
*                                                                       05200021
*                                                                       05220021
* STORE  X1,Y1,X2,Y2 IN WORK AREA                                       05240021
NOFLOAT  LA    CONREG,4                                                 05260021
         SR    INXREG,INXREG                                            05280021
         SR    CNTREG,CNTREG                                            05300021
NEXXY    LH    VALREG,X1(INXREG)        X1,Y1,X2,Y2                     05320021
         ST    VALREG,FX1(CNTREG)       X1,Y1,X2,Y2 IN WORKAREA         05340021
         A     INXREG,TWO                                               05360021
         A     CNTREG,FOUR                                              05380021
         BCT   CONREG,NEXXY                                             05400021
*                                                                       05420021
         CLI   S,C'S'                   IS SCALE INDICATED              05440021
         BNE   CHKCNT                   INDICATES NO SCALE              05460021
* DATA MUST BE SCALED IN FIXED PT.                                      05480021
*                                                                       05500021
FIXSCAL  LA    INTREG,2                 SET INTERNAL CONTROL            05520021
         SR    CONREG,CONREG            CLEAR MODIFIER                  05540021
         SR    INXREG,INXREG            CLEAR MODIFIER                  05560021
FIXSCAL1 L     VALREG,U1(CONREG)        U1 THEN V1                      05580021
         L     TEMREG,U2(CONREG)        U2 THEN V2                      05600021
         SR    TEMREG,VALREG            U2-U1                           05620021
         BC    13,ERR16RET         MINUS OR ZERO                        05640021
         L     XREG,UA(INXREG)          UA                              05660021
         SR    XREG,VALREG              UA-U1  VARIABLE RESULT          05680021
         L     YREG,FX1(INXREG)         X1 OR Y1                        05700021
         L     VALREG,FX2(INXREG)       X2 OR Y2                        05720021
         SR    VALREG,YREG              X2-X1                           05740021
         SR    EREG,EREG                CLEAR MULTIPLICAND              05760021
         MR    EREG,VALREG              UA-U1*X2-X1                     05780021
         DR    EREG,TEMREG                                              05800021
         AR    XREG,YREG                                                05820021
         ST    XREG,UASCALE(INXREG)     X OR Y SCALED                   05840021
         A     CONREG,EIGHT                                             05860021
         A     INXREG,FOUR                                              05880021
         BCT   INTREG,FIXSCAL1                                          05900021
         LH    VALREG,UAS2              X                               05920021
         STH   VALREG,X2FIN             SCALED VALUE OF X               05940021
         LH    VALREG,VAS2              Y                               05960021
         STH   VALREG,Y2FIN             SCALED VALUE OF Y               05980021
*                                                                       06000021
*CHECK COUNT-IS IT EQUAL TO TWO OR MORE                                 06020021
*                                                                       06040021
CHKCNT   CLC   COUNT,TWO+2              COMPARE COUNT TO TWO            06060021
         BNL   SECOND                   YES                             06080021
         L     WRKREG,WRTADDR           CHECK FOR GRID IF APPLIES       06100021
         BALR  LINREG,WRKREG                                            06120021
         CLC   N,ONE+2                 FOR ONLY ONE POINT               06140021
         BE    ONEPT                   HANDLE IT IN POINT MODE          06160021
         LA    CNTREG,2                                                 06180021
         LA    ADDREG,ORDER1                                            06200021
         CLI   PTYPE,C'B'                                               06220021
         BNH   PTMODE                   MODE INITIALIZE GDOA FOR PTONLY 06240021
*                                       GENERATE                        06260021
         MVI   ORDER1,X'2A'             ORDER FOR VECTOR PLOTTING       06280021
         MVI   ORDER2,X'02'                                             06300021
         MVC   GOMODE,ORDER1                                            06320021
         BAL   LINREG,STORE             GIVE TO STORE ROUTINE           06340021
         B     SECOND                                                   06360021
PTMODE   MVI   ORDER1,X'2A'             ORDER FOR POINT PLOTTING        06380021
         MVI   ORDER2,X'00'             GENERATED GIVE                  06400021
         MVC   GOMODE,ORDER1                                            06420021
         BAL   LINREG,STORE             TO STORE ROUTINE                06440021
         B     SECOND                                                   06460021
*                                                                       06480021
* IS N VALUE EQUAL TO OR LESS THAN 1                                    06500021
*                                                                       06520021
*                                                                       06540021
*                                                                       06560021
* WAS PT. OFF SCREEN-ONLY 1 POINT ESTABLISHED                           06580021
*                                                                       06600021
ONEPT    BAL   LINREG,SCLCHK            DISCONTINUE IF ONLY ONE         06620021
         CLC   SWSTATUS,STATUS1         POINT AND IT IS OFF SCREEN      06640021
         BNE   ERR32RET                                                 06660021
*                                                                       06680021
* PT ON SCREEN- SET UP ORDER FOR A PT.                                  06700021
*                                                                       06720021
         MVI   ORDER1,X'2A'             PT PLOT MODE                    06740021
         MVI   ORDER2,X'00'                                             06760021
         MVC   GOMODE,ORDER1                                            06780021
         MVC   ORDER3,X2FINAL           X AND Y FOR A POINT             06800021
         LA    CNTREG,6                 MOVE SIX BYTES                  06820021
         LA    ADDREG,ORDER1            ADDRESS OF DATA                 06840021
         BAL   LINREG,STORE             STORE GRAPHIC DATA IN GDOA      06860021
         B     RET                      RETURN TO USER                  06880021
*                                                                       06900021
* IS COUNT EQUAL TO N                                                   06920021
*                                                                       06940021
NOT1     CLC   N,COUNT                  COMPARE N TO COUNT              06960021
         BE    RET                      END OF PROGRAM                  06980021
* UPDATE COUNT FOR NEXT POINT                                           07000021
         LH    CNTREG,COUNT             COUNT                           07020021
         A     CNTREG,ONE               UPDATE COUNT                    07040021
         STH   CNTREG,COUNT             SAVE COUNT                      07060021
*                                                                       07080021
         L     VALREG,ZERO              CLEAR SKIPSW                    07100021
         STH   VALREG,SKIPSW                                            07120021
         MVC   PT1SW,OFFSW              UPDATE SCREEN GRID SWITCH       07140021
* SAVE THE PREVIOUS CALCULATED VALUE                                    07160021
         L     VALREG,UASCALE           X VALUE MAXIMUM SIZE            07180021
         ST    VALREG,UASCALE2          PT1-X-VALUE                     07200021
         L     VALREG,VASCALE           Y VALUE MAXIMUM SIZE            07220021
         ST    VALREG,VASCALE2          PT1-Y-VALUE                     07240021
         L     VALREG,X2FINAL                                           07260021
         ST    VALREG,X1FINAL                                           07280021
*                                                                       07300021
         SR    CONREG,CONREG            CLEAR MODIFIER                  07320021
         LA    CNTREG,2                 SET LOOP CONTROL                07340021
* THIS ROUTINE GET U-AND V TABLE VALUES                                 07360021
*                                                                       07380021
* GET NEXT VALUE FROM TABLE-UTAB                                        07400021
*                                                                       07420021
INCU     LH    INXREG,INDEX             TABLE INDEX VALUE               07440021
         L     WRKREG,UTAB              UTAB ADDRESS                    07460021
         CLI   I,C'X'                   U ARRAY INCREMENTAL             07480021
         BE    UINCR                    YES                             07500021
         CLI   I,C'Z'                   U AND V ARRAY INCREMENTAL       07520021
         BE    UINCR                    YES-BOTH U AND V ARE INCREMENT  07540021
FLCHK    CLI   F,C'F'                   FLOATING PT.                    07560021
         BE    FLRCHK                   YES-IS IT RELATIVE              07580021
FIXVAL   L     VALREG,4(INXREG,WRKREG)  NO -BINARY OR ASSUMED BINARY    07600021
         CLI   A,C'R'                   RELATIVE                        07620021
         BNE   USTORE                   NOT RELATIVE-STORE INDEXED VAL. 07640021
         B     USTORA                   RELATIVE-ADD PREVIOUS VALUE     07660021
UINCR    CLI   F,C'F'                   FLOATING PT.                    07680021
         BE    FLOATAD                  FLOAT SPECIFIED                 07700021
         L     VALREG,4(0,WRKREG)       FIXED INCREMENT VALUE-NOT INDEX 07720021
USTORA   A     VALREG,UA(CONREG)        ADD PREVIOUS ABS. VALUE         07740021
USTORE   ST    VALREG,UA(CONREG)        NEXT ABS. VALUE                 07760021
         ST    VALREG,UASCALE(CONREG)   NEW X OR Y VALUE                07780021
         B     INCV                     GET THE V VALUE                 07800021
*                                                                       07820021
* FLOATING PT NUMBERS SPECIFIED                                         07840021
*                                                                       07860021
FLRCHK   LE    0,4(INXREG,WRKREG)       NEXT FLOATING VALUE-INDEXED     07880021
         CLI   A,C'R'                   IS FLOAT RELATIVE               07900021
         BNE   STORFL                   NO REPLACE VALUE                07920021
         B     STORAF                   YES                             07940021
FLOATAD  LE    0,4(0,WRKREG)            FLOAT INCREMENT-NOT INDEXED     07960021
STORAF   AE    0,UA(CONREG)             FLOAT ADD ABS. VALUE            07980021
STORFL   STE   0,UA(CONREG)             NEW VALUE X OR Y                08000021
         STE   0,UASCALE(CONREG)        NEW X OR Y VALUE                08020021
*                                                                       08040021
* SET UP V TABLE AND MAKE CHECKS                                        08060021
*                                                                       08080021
INCV     BCT   CNTREG,DOV               DO V TABLE                      08100021
         B     OUT                                                      08120021
DOV      LA    CONREG,4                 SET MODIFIER                    08140021
         L     WRKREG,VTAB              VTAB ADDRESS                    08160021
         CLI   I,C'Y'                   V INCREMENTAL                   08180021
         BE    UINCR                    YES                             08200021
         CLI   I,C'Z'                   V AND U INCREMENTAL             08220021
         BE    UINCR                    YES                             08240021
         B     FLCHK                    NO                              08260021
*                                                                       08280021
* BOTH TABLE VALUES STORED-UPDATE INDEX                                 08300021
*                                                                       08320021
OUT      A     INXREG,FOUR              UPDATE INDEX VALUE              08340021
         STH   INXREG,INDEX             SAVE TABLE INDEX VALUE          08360021
         CLI   F,C'F'                                                   08380021
         BE    CHKSCA                   YES                             08400021
         CLI   S,C'S'                                                   08420021
         BE    FIXSCAL                  YES-SCALE NEW VALUES            08440021
* STORE FIXED UNSCALED VALUES FOR NEXT PT VALUE                         08460021
STOXY    L     VALREG,UA                                                08480021
         STH   VALREG,X2FIN             X2 UNSCALED FIXED VALUE         08500021
         L     VALREG,VA                                                08520021
         STH   VALREG,Y2FIN             Y2 UNSCALED FIXED VALUE         08540021
         B     CHKCNT                   NO                              08560021
CHKSCA   CLI   S,C'S'                   SCALING SPECIFIED               08580021
         BE    FLTSCAL                  YES                             08600021
         B     NOSCALE1                 NO                              08620021
SECOND   BAL   LINREG,SCRNGRD                                           08640021
         CLC   SKIPSW,ONE+2             SKIP PLOTTING IF REQUIRED       08660021
         BE    NOT1                                                     08680021
         CLI   PTYPE,C'B'               FOR CHARACTER MODE              08700021
         BE    BEAMOFF                  POSITION BEAM OFF               08720021
         CLI   PTYPE,C'A'               FOR POINT MODE                  08740021
         BE    BEAMON                   POSITION BEAM ON                08760021
         CLC   COUNT,ONE+2              FOR OTHER THAN                  08780021
         BH    BEAMON                   FIRST POINT,POSITION BEAM ON    08800021
BEAMOFF  MVC   ORDER3,X2FINAL           OTHERWISE INSERT                08820021
         OI    ORDER3,X'40'             BLANK BEAM BIT IN               08840021
         LA    CNTREG,4                 ORDER AND                       08860021
         LA    ADDREG,ORDER3                                            08880021
         BAL   LINREG,STORE             STORE                           08900021
         B     FLOW2                    BACK TO NORMAL FLOW             08920021
BEAMON   MVC   ORDER3,X2FINAL           POSITION AT                     08940021
         LA    ADDREG,ORDER3                                            08960021
         LA    CNTREG,4                 PT2,BEAM ON                     08980021
         BAL   LINREG,STORE             STORE                           09000021
FLOW2    CLI   PTYPE,C'B'               IF CHARACTER                    09020021
         BE    CHAR                     MODE OR                         09040021
         CLI   PTYPE,C'E'               VECTOR AND CHARACTER            09060021
         BE    CHAR                     PLOT CHARACTER                  09080021
         CLI   PTYPE,C'D'               IF NOT POINT-VECTOR MODE        09100021
         BNE   NOT1                     GO TO UPDATE THE COUNTER        09120021
         LA    CNTREG,4                 OTHERWISE REPEAT ORDER TO       09140021
         LA    ADDREG,ORDER3                                            09160021
         BAL   LINREG,STORE             STORE TO INTENSIFY END POINT    09180021
         B     NOT1                     GO TO UPDATE THE COUNTER        09200021
CHAR     BAL   LINREG,PLTCH             GO PLOT A CHARACTER             09220021
         BAL   LINREG,STORE             STORE GRAPHIC ORDERS IN GDOA    09240021
         CLI   PTYPE,C'E'               IF NOT VECTOR CHARACTER MODE    09260021
         BNE   REPTM                    REPEAT ENTER POINT MODE         09280021
         MVI   ORDER1,X'2A'             OTHERWISE REENTER VECTOR MODE   09300021
         MVI   ORDER2,X'02'                                             09320021
         MVC   GOMODE,ORDER1                                            09340021
         OI    ORDER3,X'40'             TURN BEAM OFF                   09360021
         LA    CNTREG,6                 AND REPEAT ORDER                09380021
         LA    ADDREG,ORDER1                                            09400021
         BAL   LINREG,STORE             TO STORE OF CURRENT POSITION    09420021
         B     NOT1                     GET NEXT VALUES                 09440021
REPTM    LA    CNTREG,2                                                 09460021
         LA    ADDREG,ORDER1                                            09480021
         MVI   ORDER1,X'2A'             ORDER FOR POINT PLOTTING        09500021
         MVI   ORDER2,X'00'                                             09520021
         MVC   GOMODE,ORDER1                                            09540021
         BAL   LINREG,STORE             TO STORE ROUTINE                09560021
         B     NOT1                     UPDATE THE COUNTER              09580021
* STORE GRAPHIC DATA IN GDOA FOR POR                                    09600021
* INPUT TO SUBROUTINE                                                   09620021
*   CNTREG = NUMBER OF BYTES OF GRAPHIC DATA TO STORE                   09640021
*   ADDREG = ADDRESS OF THE GRAPHIC DATA                                09660021
*   WKAREG = REGISTER 1 MUST CONTAIN THE WORKAREA ADDRESS               09680021
*   OABREG = ADDRESS OF OACB                                            09700021
STORE    STM   8,12,PORSAVE             SAVE REGISTERS                  09720021
         SR    PASREG,PASREG            CLEAR OVERFLOW INDICATOR        09740021
STORE1   L     OLPREG,16(0,OABREG)      ADDRESS OF OLP FROM OACB        09760021
         LR    WRKREG,CNTREG            LOAD BYTES TO MOVE              09780021
*                                                                       09800021
* CALCULATE ADDRESSES BASED ON N VALUE AND SIZE OF GDOA                 09820021
*                                                                       09840021
STORE2   AR    OLPREG,WRKREG            OLP ADDRESS PLUS N VALUE        09860021
         LA    TEMREG,4                                                 09880021
         AR    TEMREG,OLPREG            OLP PLUS N PLUS 4               09900021
         L     SLOREG,0(OABREG)         SLOA ADDRESS                    09920021
         A     SLOREG,4(OABREG)         ADD LOA EQUALS TOTAL GDOA       09940021
         L     OLPREG,16(0,OABREG)      RESET INITIAL OLP ADDRESS       09960021
         CR    TEMREG,SLOREG                                            09980021
         BNH   OK                                                       10000021
*                                                                       10020021
* NOT ENOUGH ROOM TO STORE ALL OF THE DATA-DETERMINE AMOUNT TO STORE    10040021
*                                                                       10060021
         SR    TEMREG,SLOREG            EQUAL BYTES-CAN'T STORE         10080021
         SR    WRKREG,TEMREG            NUMBER OF BYTES CAN STORE       10100021
*                                                                       10120021
* ANY BYTES TO STORE                                                    10140021
*                                                                       10160021
         C     WRKREG,ZERO                                              10180021
         BNH   STORE4                   LESS OF EQUAL TO ZERO           10200021
         LH    TEMREG,H2A02                                             10220021
         CH    TEMREG,GOMODE                                            10240021
         BH    STORE3B                                           A29402 10270021
         LH    TEMREG,H0003                                             10280021
         NR    TEMREG,WRKREG                                            10300021
         BM    STORE4      GO TO USER OVERFLOW ROUTINE (GAVP)      7468 10320021
STORE3A  SR    CNTREG,WRKREG       BYTES REMAINING                      10340021
         BAL   INTREG,STORE6            LINK INTERNALLY                 10360021
STORE3   LA    PASREG,1                 SET PASS INDICATOR              10380021
*                                                                       10400021
* STORE REGISTERS IN WORKAREA                                           10420021
*                                                                       10440021
         STM   0,15,OVFSAVE             OVERFLOW SAVE IN WORKAREA       10460021
         CLC   GOFFSGAD,ZERO           WAS OFF SCREEN/GRID LOADED  5800 10480021
         BE    LAOVFLO                  NO                              10500021
         SR    WRKREG,WRKREG                                            10520021
         ST    WRKREG,GOFFSGAD         CLEAR ADDRESS               5800 10540021
         LR    3,1                      SAVE REG 1.                     10560021
         DELETE EP=GOFFSG                                               10580021
         LR    1,3                      RESTORE REG 1.                  10600021
LAOVFLO  L     15,8(0,OABREG)           LOAD OVERFLOW ADDRESS           10620021
         LM    2,12,28(13)              RELOAD USER'S REGISTERS         10640021
         BALR  14,15                    LINK TO ROUTINE-SET RETURN      10660021
         LM    0,15,OVFSAVE             RELOAD AND CONTINUE TO STORE    10680021
         B     STORE1                   GET NEW OLP ADDRESS-CONTINUE    10700021
STORE3B  C     WRKREG,FOUR             ROOM FOR FOUR BYTES ?     A29402 10704021
         BNL   STORE3A                 YES-STORE X,Y PAIR        A29402 10708021
         MVC   0(2,OLPREG),H2A80       NO-NOP TWO BYTES          A29402 10712021
         B     STORE3                  GO TO USER OVRFLOW        A29402 10716021
*                                                                       10720021
* NO SPACE AVAILABLE                                                    10740021
*                                                                       10760021
*                                                                       10780021
STORE4   C     PASREG,ONE               WAS A TRANSFER TO OVERFLOW MADE 10800021
         BL    STORE3                                                   10820021
*                                                                       10840021
* SET ERROR CODE AND RETURN TO POR-LEAVE POR WITH RETURN MACRO          10860021
*                                                                       10880021
         B     ERR24RET                                                 10900021
*                                                                       10920021
*                                                                       10940021
OK       BAL   INTREG,STORE6            LINK INTERNALLY                 10960021
         LM    8,12,PORSAVE            RELOAD REGISTERS                 10980021
         BR    LINREG                                                   11000021
STORE6   LA    TEMREG,255               SET REG. EQUAL TO 255           11020021
STORE6A  CR    WRKREG,TEMREG            IS AMOUNT TO MOVE OVER 255      11040021
         BH    STORE7                                                   11060021
         LR    TEMREG,WRKREG                                            11080021
         S     TEMREG,ONE               COMPENSATE FOR EXTRA BYTE       11100021
         EX    TEMREG,MOVE              MOVE GRAPHIC DATA               11120021
         AR    OLPREG,WRKREG            UPDATE OLP ADDRESS              11140021
         AR    ADDREG,WRKREG            UPDATE DATA ADDR                11160021
         ST    OLPREG,16(0,OABREG)      STORE NEW OLP ADDRESS           11180021
         BR    INTREG                   RETURN INTERNALLY               11200021
STORE7   LR    SLOREG,TEMREG                                            11220021
         S     SLOREG,ONE               COMPENSATE FOR EXTRA BYTE       11240021
         EX    SLOREG,MOVE              MOVE GRAPHIC DATA               11260021
         AR    OLPREG,TEMREG            UPDATE OLP ADDRESS              11280021
         AR    ADDREG,TEMREG            UPDATE INPUT ADDRESS            11300021
         SR    WRKREG,TEMREG           REDUCE BY 255                    11320021
         B     STORE6A                  MAKE NEXT COMPARISON            11340021
MOVE     MVC   0(0,OLPREG),0(ADDREG)    MOVE DATA TO GDOA               11360021
*                                                                       11380021
*    CONVERT  FLOATING  POINT  TO  FIXED  POINT  VALUES                 11400021
*    VALREG CONTAINS THE VALUE TO BE CONVERTED                          11420021
*                                                                       11440021
FIXCONV  ST    1,OVFSAVE                STORE IN FIRST WORD REG. 1      11460021
         TM    OVFSAVE+3,X'07'          TEST LAST THREE BITS            11480021
         BZ    SETMODI                  NO BITS ON SET INDEX TO ZERO    11500021
         LA    TEMREG,4                 SET MODIFIER                    11520021
         B     SAVFLT                   START CONVERSION                11540021
SETMODI  LA    TEMREG,0                 SET MODIFIER TO ZERO            11560021
SAVFLT   ST    VALREG,TEMFLT(TEMREG)    SAVE FLOAT VALUE                11580021
         SR    WRKREG,WRKREG                                            11600021
         ST    WRKREG,TEMFLT+4(TEMREG)  CLEAR SECOND WORD               11620021
         LD    6,TEMFLT(TEMREG)         VALUE TO FLOAT REGISTERS        11640021
         N     VALREG,FCHAR                                             11660021
         BE    FLERR1                   CHARACTERISTIC IS ZERO          11680021
         AE    6,FLPT5                  ADD .5 TO ROUND                 11700021
         AW    6,X4E                    ADD UNNORMALIZED-RIGHT JUSTIFY  11720021
         STD   6,TEMFLT(TEMREG)         SAVE VALUES                     11740021
         L     WRKREG,TEMFLT+4(TEMREG)  CHECK SECOND WORD               11760021
         N     WRKREG,MZERO             CHECK BIT 32                    11780021
         BM    ERR12RET                 INDICATE ERROR                  11800021
         L     WRKREG,TEMFLT(TEMREG)                                    11820021
         N     WRKREG,BYTE123                                           11840021
         BM    ERR12RET                                                 11860021
         L     WRKREG,TEMFLT(TEMREG)                                    11880021
         N     WRKREG,MZERO             DROP CHARACTERISTIC             11900021
         L     VALREG,TEMFLT+4(TEMREG)  NEW FIXED VALUE                 11920021
         LTR   WRKREG,WRKREG                                            11940021
         BNL   NOTNEG                   NOT NEGATIVE                    11960021
         LNR   VALREG,VALREG            TAKE TWO'S COMPLIMENT           11980021
NOTNEG   BR    INTREG                   RETURN TO N S I                 12000021
FLERR1   CE    6,ZERO                   IS TOTAL VALUE ZERO             12020021
         BE    NOTNEG                   RETURN                          12040021
         B     ERR12RET                 SET ERROR CODE AND RETURN       12060021
*                                                                       12080021
*    CONVERT  FIXED  POINT  TO  FLOATING  POINT  VALUES                 12100021
*    VALREG CONTAINS THE VALUE TO BE CONVERTED                          12120021
*                                                                       12140021
FLTCONV  O     VALREG,X6                EXPONENT OF 6                   12160021
         ST    VALREG,OVFSAVE                                           12180021
         LE    0,OVFSAVE                LOAD TO FLOAT REG.              12200021
         AE    0,X6                     NORMALIZE                       12220021
         STE   0,OVFSAVE                                                12240021
         L     VALREG,OVFSAVE           FLOAT PT. VALUE IN REG.         12260021
         BR    LINREG                                                   12280021
*   ROUTINE TO CHECK IF PT. IS OUTSIDE OF GRID BOUNDARY                 12300021
*                                                                       12320021
GRLCHK   LH    VALREG,X1                X1                              12340021
         C     VALREG,UASCALE           X VALUE COMPARED TO X1          12360021
         BH    SETIND                   OFF GRID LIMIT                  12380021
         LH    VALREG,X2                X2                              12400021
         C     VALREG,UASCALE           X VALUE COMPARED TO X2          12420021
         BL    SETIND                   OFF GRID LIMIT                  12440021
         LH    VALREG,Y1                Y1                              12460021
         C     VALREG,VASCALE           Y VALUE COMPARED TO Y1          12480021
         BH    SETIND                   OFF GRID                        12500021
         LH    VALREG,Y2                Y2                              12520021
         C     VALREG,VASCALE           Y VALUE COMPARED TO Y2          12540021
         BL    SETIND                   OFF GRID                        12560021
         MVI   OFFSW,X'00'              WITHIN LIMIT SET OFF            12580021
         B     OV10                                                     12600021
SETIND   MVI   OFFSW,X'11'              SET INDICATOR                   12620021
OV10     BR    LINREG                   RETURN                          12640021
*                                                                       12660021
*    ROUTINE TO CHECK IF POINT IS OFF THE SCREEN                        12680021
*                                                                       12700021
SCLCHK   L     VALREG,UASCALE           GET X VALUE                     12720021
         C     VALREG,ZERO              X VALUE COMPARED TO ZERO        12740021
         BL    SETBITS                  OFF SCREEN                      12760021
         C     VALREG,HIGH              X VALUE COMPARED TO 4095        12780021
         BH    SETBITS                  OFF SCREEN                      12800021
         L     VALREG,VASCALE           GET Y VALUE                     12820021
         C     VALREG,ZERO              Y VALUE COMPARED TO ZERO        12840021
         BL    SETBITS                  OFF SCREEN                      12860021
         C     VALREG,HIGH              Y VALUE COMPARED TO 4095        12880021
         BH    SETBITS                  OFF SCREEN                      12900021
         MVI   OFFSW,X'00'              WITHIN LIMIT SET OFF            12920021
         BR    LINREG                   RETURN                          12940021
SETBITS  MVI   OFFSW,X'11'              SET INDICATOR                   12960021
         BR    LINREG                   RETURN                          12980021
*                                                                       13000021
*                                                                       13020021
SCRNGRD  ST    LINREG,RSAVE             SAVE THE BRANCH REGISTER        13040021
         L     WRKREG,WRTADDR           GET BOUNDARY CHECK RT ADDRESS   13060021
         BALR  LINREG,WRKREG             AND BRANCH TO CHECK            13080021
         CLC   SWSTATUS,STATUS1         CHECK THE SWS STATUS IF STATUS1 13100021
         BE    RESREG                   ARE ALL POINTS ON ANSWER  YES   13120021
OPTIONA  CLI   SG,C'A'                  OTHERWISE OFFSG CONDITION EXIST 13140021
         BNE   OPTIONB                   CHECK USER-SPECIFIED OPTION    13160021
         BAL   LINREG,ERR44             IF A OPTION SET ERR CODE AND    13180021
         B     ANALOFF                   ANALIZE OFF STATUS TO HANDLE   13200021
OPTIONB  CLI   SG,C'B'                  IS B OPTION SPECIFIED           13220021
         BNE   OPTIONC                  IF NOT TEST FOR C               13240021
         BAL   LINREG,ERR48             IF YES SET ERR CODE AND         13260021
         B     ANALOFF                   ANALIZE OFF STATUS TO HANDLE   13280021
OPTIONC  CLI   SG,C'C'                  IS C OPTION SPECIFIED           13300021
         BNE   OPTIOND                  IF NOT TEST FOR D               13320021
         BAL LINREG,SCLCHK              CHECK FURTHER IF POINT          13340021
         CLI   OFFSW,X'11'               OFF SCREEN                     13360021
         BE    ERR32RET                 IFF OFF SCREEN IMMEDIATE RET    13380021
         LA    15,32                    OTHERWISE SET ERROR CODE AND    13400021
         BAL   LINREG,ERRCNT             CONTINUE THE JOB               13420021
         BAL   LINREG,GRLCHK            CHECK FURTHER FOR GRID          13440021
         B     ANALOFF                  GO TO ANALIZE OFF STATUS        13460021
OPTIOND  CLI   SG,C'D'                  IS OPTION D SPECIFIED           13480021
         BNE   ASSUMEE                  IF NOT ASSUME OPTION E          13500021
         B     ERR28RET                 IMMEDIATE ERROR RETURN          13520021
ASSUMEE  B     ERR32RET                 IMMEDIATE ERROR RETURN          13540021
         BE    ERR32RET                 IF OFF SCREEN IMMEDIATE RETURN  13560021
         BAL   LINREG,SCLCHK            IF OPTION C TEST FOR OFF SCRN   13580021
         LA    15,32                    OTHERWISE SET ERROR CODE        13600021
         BAL   LINREG,ERRCNT            UPDATE ERROR COUNT              13620021
         MVI   OFFSW,X'11'              RESTORE OFF BOUNDARY STATUS     13640021
         B     RESREG                   CONTINUE JOB                    13660021
SETSKIP  L     VALREG,ONE               SET SWITCH TO SKIP TO NEXT      13680021
         STH   VALREG,SKIPSW            POINT                           13700021
         B     RESREG                   AND RETURN VIA RESTORE REG      13720021
ANALOFF  CLI   PTYPE,C'B'               IF NOT VECTOR                   13740021
         BH    ANALVEC                  TYPE SKIP IT IF                 13760021
         CLC   SWSTATUS,STATUS3         IT IS POINT 2 OFF               13780021
         BE    SETSKIP                                                  13800021
         CLC   SWSTATUS,STATUS4        ANOTHER PT OFF?           A28795 13806021
         BE    SETSKIP                 YES GET NEXT PT           A28795 13812021
         B     RESREG                   OTHERWISE CONTINUE              13820021
ANALVEC  CLC   COUNT,ONE+2              IF FIRST POINT OFF, GET         13840021
         BNH   SETSKIP                  GET ANOTHER                     13860021
         STM   13,0,PORSAVE             SAVE REGISTERS                  13880021
         ST    13,OVFSAVE+4             SAVE POR SAVEAREA CHAINING ADDR 13900021
         ST    15,SVR15                 SAVE ERROR REGISTER             13920021
         LA    13,OVFSAVE               LOAD GOFFSG RT SAVEAREA ADDR    13940021
         LR    WRKREG,1                 SAVE REG1-WKAREA POINTER        13960021
         CLC   GOFFSGAD,ZERO            CHECK IF GOFFSG RT ADDR AREA 0  13980021
         BNE   OFFHDLG                  IF NOT RT BROUGHT IN GO TO HDL  14000021
         LA    1,SABL                   LOAD 24-WORD PARTAB START ADDR  14020021
         LOAD  EP=GOFFSG                RETAIN THE MODULE               14040021
         LR    1,WRKREG                 RESTORE REGISTER 1              14060021
         ST    0,GOFFSGAD               SAVE GOFFSG RT ADDRESS          14080021
OFFHDLG  L     15,GOFFSGAD              LOAD GOFFSG RT ADDRESS          14100021
         LA    1,SABL                   LOAD 24-WORD PARTAB ADDR        14120021
         BALR  14,15                    BRANCH TO GOFFSG RT             14140021
         LR    1,WRKREG                 RESTORE REG 1                   14160021
LINKOUT  LM    13,0,PORSAVE             RESTORE REG 13 TO 0             14180021
         L     15,SVR15                 RESTORE ERROR REGISTER          14200021
*   ANALIZE THE RESPONSE OF GOFFSG ROUTINE AND GENERATE PROPER DATA     14220021
ANALRES  CLC   NI,ZERO                  IS NI=0                         14240021
         BE    NOINTS                   IF SO GO TO NO INTERSECT RT     14260021
         CLC   NI,ONE                   IS NI=1                         14280021
         BE    ONEINTS                  IF SO GO TO ONE INTERSECT RT    14300021
BOTHOUT  MVC   X1FINAL,XYINT1           OTHERWISE GDV I1X,I1Y,B         14320021
         MVC   X2FINAL,XYINT2                                           14340021
         MVC   ORDER3,X1FINAL           AND GDV I2X,I2Y,U               14360021
         MVC   ORDER4,X2FINAL                                           14380021
         OI    ORDER3,X'40'                                             14400021
         LA    CNTREG,8                 LOAD BYTE NUMBER                14420021
         LA    ADDREG,ORDER3                                            14440021
         BAL   LINREG,STORE             GIVE TO STORE ROUTINE           14460021
         B     SETSKIP                  SKIP THE NEXT POINT             14480021
NOINTS   CLC   SWSTATUS,STATUS2         SEE IF PT1 OFF PT2 ON           14500021
         BE    NOINTSA                  IF SO IT'S NO INTS CONDITION A  14520021
         B     SETSKIP                  GO ON TO NEXT POINT             14540021
NOINTSA  MVC   X1FINAL,X2FINAL          GDV X2,Y2,B                     14560021
         MVC   ORDER3,X1FINAL           AND GDV X2,Y2,U                 14580021
         MVC   ORDER4,X2FINAL                                           14600021
         OI    ORDER3,X'40'                                             14620021
         LA    CNTREG,8                 AND GIVE TO STORE ROUTINE       14640021
         LA    ADDREG,ORDER3                                            14660021
         B     STOREP                                                   14680021
ONEINTS  CLC   SWSTATUS,STATUS2         SEE IF PT1 OFF PT2 ON           14700021
         BE    ONEINTSA                 IF SO GO TO ONE INTS CONDITIONA 14720021
         CLC   SWSTATUS,STATUS3         SEE IF PT1 ON PT2 OFF           14740021
         BE    ONEINTSB                 IF SO GO TO ONE INTS CONDITIONB 14760021
         B     BOTHOUT                                                  14780021
ONEINTSA MVC   X1FINAL,XYINT1           GENERATE I1X,I1Y,B              14800021
         MVC   ORDER3,X1FINAL                                           14820021
         OI    ORDER3,X'40'             BLAND BEAM BIT                  14840021
         LA CNTREG,4                    AND GIVE TO STORE ROUTINE       14860021
         LA    ADDREG,ORDER3                                            14880021
         B     STOREP                                                   14900021
ONEINTSB MVC   X2FINAL,XYINT1                                           14920021
         MVC   ORDER3,X2FINAL                                           14940021
         LA CNTREG,4                    GDVI1X,I1Y,U AND THEN STORE     14960021
         LA    ADDREG,ORDER3                                            14980021
         BAL   LINREG,STORE             STORE THE POINT AND             15000021
         B     SETSKIP                  AND SKIP ANYTHING ELSE          15020021
STOREP   BAL   LINREG,STORE                                             15040021
RESREG   L     LINREG,RSAVE             RESTORE THE L INE REGISTER      15060021
         BR    LINREG                   AND RETURN                      15080021
* SUBROUTINE TO PLOT A CHARACTER                                        15100021
PLTCH    CLI   E,C'O'                   NO OVERLAP                      15120021
         BE    OV9                      YES-NO OVER LAP PERMITTER       15140021
         B     PLTCH1                   VECTOR AND CHAR OR VECTOR ONLY  15160021
OV9      LH    VALREG,X2FIN             X2                              15180021
         SH    VALREG,X1FIN             X2-X1                           15200021
         LPR   XREG,VALREG              ABSOLUTE OF DELTA X             15220021
         C     XREG,EIGHT                                               15240021
         BH    PLTCH1                   MORE THAN EIGHT                 15260021
         LH    VALREG,Y2FIN             Y2                              15280021
         SH    VALREG,Y1FIN             Y2-Y1                           15300021
         LPR   YREG,VALREG              ABSOLUTE OF DELTA Y             15320021
         C     YREG,EIGHT                                               15340021
         BH    PLTCH1                   MOVE THAN EIGHT                 15360021
*                                                                       15380021
* DIFFERENCE IS LESS THAN EIGHT BETWEEN POINTS                          15400021
*                                                                       15420021
         L     VALREG,X1FINAL           X1,Y1                           15440021
         ST    VALREG,X2FINAL           STORE X1,Y1 OVER X2,Y2          15460021
         B     NOT1                     CHECK COUNT                     15480021
PLTCH1   MVC   ORDER5,CHARMOD           MODE AND CHARACTER SIZE         15500021
         MVC   GOMODE,CHARMOD                                           15520021
         MVC   ORDER6,SYMBOL            LETTER                          15540021
         MVI   ORDER7,X'00'             NULL CHARACTER                  15560021
         LA    CNTREG,4                 COUNT TO MOVE                   15580021
         LA    ADDREG,ORDER5                                            15600021
         BR    LINREG                                                   15620021
*                                                                       15640021
*        XYLCHK     SUBROUTINE                                          15660021
*        ADDRESS OF XYLIM TABLE IN  XYLREG BEFORE  BAL                  15680021
XYLCHK   LA    CONREG,4                SET LOOP CONTROL                 15700021
         LA    INXREG,0                 SET  INDEX                      15720021
XYLLOOP  LH    TEMREG,X1(INXREG)        X1,Y1,X2,Y2                     15740021
         C     TEMREG,ZERO                                              15760021
         BL    ERR4RET                                                  15780021
         C     TEMREG,HIGH                                              15800021
         BH    ERR4RET                                                  15820021
         A     INXREG,TWO                                               15840021
         BCT   CONREG,XYLLOOP                                           15860021
         CLC   X1,X2                    X1 COMPARED TO X2               15880021
         BNL   ERR4RET                                                  15900021
         CLC   Y1,Y2                    Y1 COMPARED TO Y2               15920021
         BNL   ERR4RET                                                  15940021
         BR    INTREG                   RETURN TO MAIN LINE             15960021
ERR4RET  LA    15,4                     XYLIM X1,Y2,X2,Y2 LIMIT ERROR   15980021
         B     ERRCNTR                                                  16000021
ERR8RET  LA    15,8                                                     16020021
         B     ERRCNTR                                                  16040021
ERR12RET LA    15,12                    FLOATING POINT ERROR DETECTED   16060021
         B     ERRCNTR                                                  16080021
ERR16RET LA    15,16                    U1,V1 GREATER THAN U2,V2        16100021
         B     ERRCNTR                                                  16120021
ERR20RET LA    15,20                                                    16140021
         B     ERRCNTR                                                  16160021
ERR24RET LA    15,24                    USERS OVERFLOW-OLP NOT RESET    16180021
         B     ERRCNTR                                                  16200021
ERR28RET LA    15,28                                                    16220021
         B     ERRCNTR                                                  16240021
ERR32RET LA    15,32                    OPTION C                        16260021
         B     ERRCNTR                                                  16280021
ERR40    LA    15,40                    PARAMETERS ERROR-NOT SERIOUS    16300021
         B     ERRCNT                   ADD TO COUNT                    16320021
ERR44    LA    15,44                                                    16340021
         B     ERRCNT                                                   16360021
ERR48    LA    15,48                                                    16380021
         B     ERRCNT                   ADD TO COUNT                    16400021
ERRCNTR  LA    LINREG,RET                                               16420021
ERRCNT   L     TEMREG,ERRCOUNT                                          16440021
         A     TEMREG,ONE                                               16460021
         ST    TEMREG,ERRCOUNT                                          16480021
         BR    LINREG                                                   16500021
*                                                                       16520021
*   RET SUBROUTINE TESTS COUNT IN WORK AREA,(ERRCOUNT) AND              16540021
*   SETS BIT IN SIGN POSITION OF REG. 15 IF MULTIBLE ERRORS             16560021
*   (MORE THAN ONE)                                                     16580021
RET      CLC   GOFFSGAD,ZERO           HAS OFF SCREEN/GRID ROUTINE 5800 16600021
         BE    RET1                                                     16620021
         ST    15,SVR15                 SAVE ERROR REGISTER             16640021
         LR    WRKREG,1                 SAVE REGISTER 1                 16660021
         DELETE EP=GOFFSG                                               16680021
         LR    1,WRKREG                 RESTORE REGISTER 1              16700021
         L     15,SVR15                 RESTORE ERROR REGISTER          16720021
RET1     LA    TEMREG,1                                                 16740021
         C     TEMREG,ERRCOUNT                                          16760021
         BL    SETBIT                                                   16780021
* RESTORE PROGRAM MASK TO SETTING UPON ENTRY                            16800021
RETMACRO L     WRKREG,MASKSV                                            16820021
         SPM   WRKREG                                                   16840021
         RETURN (14,12),T,RC=(15)                                       16860021
SETBIT   O     15,MZERO                                                 16880021
         B     RETMACRO                                                 16900021
BYCT     DC    F'120'                                                   16920021
ZERO     DC    F'0'                     ZERO                            16940021
MZERO    DC    X'80000000'              MINUS ZERO                      16960021
ONE      DC    F'1'                                                     16980021
TWO      DC    F'2'                                                     17000021
MTWO     DC    X'FFFFFFFE'              MINUS TWO                       17020021
FOUR     DC    F'4'                                                     17040021
EIGHT    DC    F'8'                                                     17060021
HIGH     DC    F'4095'                  HIGH LIMIT                      17080021
BYTE3    DC    X'0000FF00'              MASK SYMBOL-EBCDIC CODE         17100021
BYTE123  DC    X'00FFFFFF'                                              17120021
ALLFF    DC    X'FFFFFFFF'              ALL BITS                        17140021
X6       DC    X'46000000'              EXPONENT OF SIX                 17160021
         DS    0D                       ALIGN BOUNDARY                  17180021
X4E      DC    X'4E00000000000000'                                      17200021
FLPT5    DC    E'.5'                                                    17220021
FCHAR    DC    X'7F000000'              MASK FOR CHARACTERISTIC         17240021
LOHI     DC    F'0'                     X1,Y1                           17260021
H2A80    DC    X'2A80'                 NOP                       A29402 17270021
H2A02    DC    X'2A02'                                                  17280021
H0003    DC    H'0003'                                                  17300021
         DC    H'4095'                  UPPER LIMIT                     17320021
         DC    H'4095'                  UPPER LIMIT                     17340021
STATUS1  DC    H'0'                     BOTH PT1 AND PT2 WITHIN LIMITS  17360021
STATUS2  DC    X'1100'                  PT1 OFF PT2 ON                  17380021
STATUS3  DC    X'0011'                  PT1 ON PT2 OFF                  17400021
STATUS4  DC    X'1111'                 TWO SUCCESSIVE PTS OFF    A28795 17410021
* REGISTER ASSIGN MENT                                                  17420021
VALREG   EQU   0                                                        17440021
PASREG   EQU   0                                                        17460021
WKAREG   EQU   1                                                        17480021
XYLREG   EQU   2                                                        17500021
OBPREG   EQU   2                        MUST BE IN THIS ORDER           17520021
PATREG   EQU   3                        MUST BE IN THIS ORDER           17540021
WRKREG   EQU   4                                                        17560021
EREG     EQU   4                        EVEN REGISTER                   17580021
XREG     EQU   5                        ODD  REGISTER                   17600021
CNTREG   EQU   5                                                        17620021
TEMREG   EQU   6                                                        17640021
OREG     EQU   6                        EVEN REGISTER                   17660021
YREG     EQU   7                        ODD REGISTER                    17680021
ADDREG   EQU   7                                                        17700021
INXREG   EQU   8                                                        17720021
SLOREG   EQU   8                                                        17740021
OABREG   EQU   10                                                       17760021
INTREG   EQU   11                                                       17780021
OLPREG   EQU   12                                                       17800021
CONREG   EQU   12                                                       17820021
LINREG   EQU   14                                                       17840021
* PARTAB DEFINED STORAGE MAP                                            17860021
* PATREG EQUALS A GENERAL REGISTER                                      17880021
PARTAB   DSECT                                                          17900021
XYLIM    DS    CL4                      XYLIM ADDRESS                   17920021
UTAB     DS    CL4                      UTAB  ADDRESS                   17940021
VTAB     DS    CL4                      VTAB  ADDRESS                   17960021
F        DS    CL1                      MODE OF INPUT                   17980021
S        DS    CL1                      SCALE OR NO SCALE               18000021
CSIZE    DS    CL1                      CHARACTER SIZE                  18020021
CMOD     DS    CL1                      PROTECTED OR UNPROTECTED MODE   18040021
A        DS    CL1                      RELATIVE OR ABSOLUTE            18060021
I        DS    CL1                      INCREMENT OR NO INCREMENT       18080021
PTYPE    DS    CL1                      PLOT TYPE                       18100021
SG       DS    CL1                                                      18120021
N        DS    CL2                      NUMBER OF POINTS TO PLOT        18140021
SYMBOL   DS    CL1                      LETTER TO PLOT                  18160021
E        DS    CL1                      OVERLAP OR NO OVERLAP           18180021
* XYLIM TABLE DEFINED.STORAGE MAP                                       18200021
* XYLREG EQUALS A GENERAL REGISTER                                      18220021
XYLIMTB  DSECT                                                          18240021
X1       DS    CL2                      LOWER LEFT COORDINATE VALUE     18260021
Y1       DS    CL2                      LOWER LEFT COORDINATE VALUE     18280021
X2       DS    CL2                      UPPER RIGHT COORDINATE VALUE    18300021
Y2       DS    CL2                      UPPER RIGHT COORDINATE VALUE    18320021
U1       DS    CL4                      LOWER LEFT SCALING COORDINATE   18340021
U2       DS    CL4                      LOWER LEFT SCALING COORDINATE   18360021
V1       DS    CL4                      UPPER RIGHT SCALING COORDINATE  18380021
V2       DS    CL4                      UPPER RIGHT SCALING COORDINATE  18400021
* WORK AREA DEFINED STORAGE MAP                                         18420021
* WKAREG EQUALS A GENERAL REGISTER                                      18440021
WKAREA   DSECT                                                          18460021
         DS    0D                                                       18480021
OVFSAVE  DS    0CL72                                                    18500021
TEMFLT   DS    0CL8                                                     18520021
         DS    CL72                                                     18540021
ERRCOUNT DS    CL4                      COUNT OF PARAMETER ERRORS       18560021
INCOUNT  DS    CL4                                                      18580021
         ORG   INCOUNT                                                  18600021
INDEX    DS    CL2                      TABLE INDEX OF UTAB OR VTAB     18620021
COUNT    DS    CL2                      NUMBER OF POINTS PROCESSED      18640021
MASKSV   DS    F                   SAVE SETTING OF USER PROGRAM MASK    18660021
FX1      DS    CL4                      FLOAT X1                        18680021
FY1      DS    CL4                      FLOAT Y1                        18700021
FX2      DS    CL4                      FLOAT X2                        18720021
FY2      DS    CL4                      FLOAT Y2                        18740021
UA       DS    CL4                      ABSOLUTE FLOAT OR FIXED UA      18760021
VA       DS    CL4                      ABSOLUTE FLOAT OR FIXED VA      18780021
X1FINAL  DS    CL4                      X1,Y1                           18800021
         ORG   X1FINAL                                                  18820021
X1FIN    DS    CL2                      X1                              18840021
Y1FIN    DS    CL2                      Y1                              18860021
X2FINAL  DS    CL4                      X2,Y2                           18880021
         ORG   X2FINAL                                                  18900021
X2FIN    DS    CL2                      X2                              18920021
Y2FIN    DS    CL2                      Y2                              18940021
WRTADDR  DS    CL4                      ADDR OF GRID OR SCREEN CHECK RT 18960021
GOFFSGAD DS    CL4                      GOFFSG RT ADDR AREA             18980021
SWSTATUS DS    CL2                      SWITCH STATUS OF PT1 AND PT2    19000021
         ORG   SWSTATUS                                                 19020021
PT1SW    DS    CL1                      PREVIOUS STATUS                 19040021
OFFSW    DS    CL1                      CURRENT STATUS                  19060021
SKIPSW   DS    CL2                      SET TO ONE TO SKIP POINT        19080021
RSAVE    DS    CL4                      PLACE TO SAVE LINE REGISTER     19100021
SVR15    DS    CL4                      PLACE TO SAVE ERROR REGISTER    19120021
ORDER1   DS    CL1                      GRAPHICORDERS-MODE              19140021
ORDER2   DS    CL1                                                      19160021
ORDER3   DS    CL4                      PT. TO PLOT                     19180021
ORDER4   DS    CL4                                                      19200021
         ORG   ORDER4                                                   19220021
ORDER5   DS    CL2                                                      19240021
ORDER6   DS    CL1                                                      19260021
ORDER7   DS    CL1                                                      19280021
ORDER8   DS    CL2                                                      19300021
EPRGMOD  DS    CL4                                                      19320021
         ORG   EPRGMOD                                                  19340021
EOPRG    DS    CL2                      LAST PT. INDICATOR              19360021
CHARMOD  DS    CL2                      ORDER FOR CHARACTER AND MODE    19380021
PT1VEC   DS    CL4                      SIMULATED VECTOR X1,Y1          19400021
         ORG   PT1VEC                                                   19420021
PT1VE    DS    CL2                                                      19440021
PT2VE    DS    CL2                                                      19460021
PT2VEC   DS    CL4                      SIMULATED VECTOR X2,Y2          19480021
         ORG   PT2VEC                                                   19500021
PT2VECT  DS    CL2                                                      19520021
PT2VECS  DS    CL2                                                      19540021
DELTAX   DS    CL2                      DELTA X                         19560021
DELTAY   DS    CL2                      DELTA Y                         19580021
TOTAL    DS    CL4                                                      19600021
         ORG   TOTAL                                                    19620021
INTEGER  DS    CL2                      INTEGER-SIMULATED VECTOR        19640021
FRACTION DS    CL2                      FRACTION-SIMULATED VECTOR       19660021
ABVTEMP  DS    CL4                      VECTOR MODE-TEMP STORAGE        19680021
         ORG   ABVTEMP                                                  19700021
ABVMODE  DS    CL2                      VECTOR MODE INDICATOR           19720021
TEMP     DS    CL2                      TEMP STORAGE                    19740021
XYINCR   DS    CL4                      CHANGING X OR Y VALUE           19760021
PORSAVE  DS    CL28                                                     19780021
ADGOFFSG DS    CL4                      ADDRESS OF GOFFSG               19800021
SABL     DS    CL4                      ADDRESS OF BOUNDARY             19820021
UASCALE2 DS    CL4                                                      19840021
VASCALE2 DS    CL4                                                      19860021
UASCALE  DS    CL4                      ABSOLUTE FLOAT-FIX-THEN SCALE   19880021
         ORG   UASCALE                                                  19900021
UAS1     DS    CL2                                                      19920021
UAS2     DS    CL2                      FIXED HALF WORD-MAY BE SCALED   19940021
VASCALE  DS    CL4                                                      19960021
         ORG   VASCALE                                                  19980021
VAS1     DS    CL2                                                      20000021
VAS2     DS    CL2                      FIXED HALF WORD-MAY BE SCALED   20020021
NI       DS    CL4                      NUMBER OF INTERATIONS           20040021
XYINT1   DS    CL4                      FIRST INTERSECTION              20060021
XYINT2   DS    CL4                      SECOND INTERSECTION             20080021
INTWKA   DS    CL64                     INTERNAL WORKAREA               20100021
         DS    0D                                                       20120021
         ORG   OVFSAVE+396                                              20140021
GOMODE   DS    CL2                                                      20160021
         END                                                            20180021
