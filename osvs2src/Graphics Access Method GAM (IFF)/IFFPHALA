         TITLE 'GLABEL - GRID LABEL ROUTINE'                          * 00020021
*STATUS. CHANGE LEVEL 0                                               * 00040021
*                                                                     * 00060021
*FUNCTION/OPERATION. GLABEL  GENERATES GRAPHIC ORDERS THAT WILL LABEL * 00080021
*   EACH DIVISION OR LOG CYCLE OF AN X OR Y AXIS OF A RECTANGULAR     * 00100021
*   GRID WITH ALPHAMERIC CHARACTERS AND IF SPECIFIED PLACE A TICK     * 00120021
*   MARK BETWEEN THE AXIS LABELED AND THE LABEL ITSELF.               * 00140021
*                                                                     * 00160021
*ENTRY POINTS. GLABEL VIA CALL OR LINK MACRO    ALIAS NAME IFFPHALA   * 00180021
*                                                                     * 00200021
*INPUT. OUTPUT CONTROL BLOCK POINTER AND A PARAMETER TABLE            * 00220021
*                                                                     * 00240021
*OUTPUT. A STRING OF GRAPHIC ORDERS STORED IN THE GDOA                * 00260021
*                                                                     * 00280021
*EXTERNAL ROUTINES. N/A                                               * 00300021
*                                                                     * 00320021
*EXITS-NORMAL. COMPLETION OF TASK. EXIT VIA RETURN MACRO              * 00340021
*     -ERROR. HEXADECIMAL 4,8,C,10,14,18, OR 20 IN REG 15             * 00360021
*   IMMEDIATE RETURN. EXIT VIA RETURN MACRO                           * 00380021
*     -ERROR. HEXADECIMAL 28 IN REG 15   DOES NOT RETURN IMMEDIATELY  * 00400021
*   COMPLETION OF TASK. EXIT VIA RETURN MACRO                         * 00420021
*                                                                     * 00440021
*TABLES/WORK AREAS. USER SPECIFIED PARAMETER TABLE, XYLIM TABLE AND   * 00460021
*   WORK AREA                                                         * 00480021
*                                                                     * 00500021
* ATTRIBUTES. READ ONLY, REENTRANT                                    * 00520021
         EJECT                                                          00540021
IFFPHALA CSECT                          GLABEL                          00560021
*0669                                                              7468 00570021
         ENTRY GLABEL                                                   00580021
GLABEL   SAVE  (14,12),T,*                                              00600021
         BALR  9,0                                                      00620021
         USING *,9                                                      00640021
         USING PARTAB,PATREG                                            00660021
         USING XYLIMT,XYLREG                                            00680021
         USING WRKAREA,WKAREG                                           00700021
         LM    OBPREG,PATREG,0(1)       GET ADDR OF OCBP,PARTAB         00720021
         L     WKAREG,4(OBPREG)                     WRKAREA             00740021
         L     OABREG,0(OBPREG)                     OACB                00760021
         L     XYLREG,0(PATREG)                     XYLIM TABLE         00780021
*  SAVE MASK BITS AS SET BY USER                                        00800021
         ST    9,MASKSV                                                 00820021
         SR    WRKREG,WRKREG                                            00840021
         SPM   WRKREG                                                   00860021
         LM    XREG,YREG,UI             LOAD UI,VC OR VI,UC             00880021
         SR    15,15                    RESET ERR CODE REG              00900021
         ST    15,ERRCOUNT              RESET ERR COUNT                 00920021
         BAL   LINREG,XYLCHK                                            00940021
         CLI   F,C'F'                   TEST FOR FLOAT                  00960021
         BE    FLTLEG                                                   00980021
         CLI   F,C'B'                  TEST FOR FIX                     01000021
         BE    TESTS                                                    01020021
         BAL   LINREG,ERR40                                             01040021
TESTS    CLI   S,C'S'                   TEST FOR SCALE                  01060021
         BE    FIXSCAL                                                  01080021
         CLI   S,C'N'                   TEST FOR NO SCALE               01100021
         BE    TESTUV                                                   01120021
         BAL   LINREG,ERR40                                             01140021
*   TEST  UC,VC FOR LESS THAN ZERO AND GREATER THAN 4095                01160021
TESTUV   C     YREG,HIGH                                                01180021
         BH    ERR8RET                                                  01200021
         C     YREG,ZERO                                                01220021
         BL    ERR8RET                                                  01240021
*   TEST  UI,VI   FOR  0-4095 LIMITS                                    01260021
         C     XREG,ZERO                                                01280021
         BNH   ERR8RET                                                  01300021
         C     XREG,HIGH                                                01320021
         BH    ERR8RET                                                  01340021
         LH    WRKREG,LGAP                                              01360021
         C     WRKREG,ZERO              TEST LGAP FOR LESS THAN ZERO    01380021
         BL    ERR20RET                                                 01400021
         LH    WRKREG,FLENGTH                                           01420021
         C     WRKREG,ZERO              TEST FLENGTH LESS THAN ZERO     01440021
         BL    ERR20RET                                                 01460021
         EJECT                                                          01480021
*   TEST  AXIS  TO  BE  LABELED                                         01500021
         CLI   TYPE,C'Y'                                                01520021
         BE    TICKGAP                                                  01540021
         CLI   TYPE,C'X'                                                01560021
         BE    SIZETEST                                                 01580021
         B     ERR20RET                                                 01600021
SIZETEST CLI   SIZE,C'B'                                                01620021
         BE    BASIC                                                    01640021
         CLI   SIZE,C'L'                                                01660021
         BE    LARGE                                                    01680021
BASIC    LA    ODDREG,56                                                01700021
         B     LENGTH                                                   01720021
LARGE    LA    ODDREG,84                                                01740021
LENGTH   MH    ODDREG,FLENGTH                                           01760021
         CR    ODDREG,XREG              COMPARE TO INC X OR Y           01780021
         BL    TICKGAP                                                  01800021
         B     ERR20RET                                                 01820021
TICKGAP  LH    WRKREG,LTICK                                             01840021
         CH    WRKREG,LGAP                                              01860021
         BH    LTICKERR                                                 01880021
         C     WRKREG,ZERO                                              01900021
         BE    TESTFL                   NO TICK IF LTICK = 0            01920021
         BH    STORGEVM                                                 01940021
LTICKERR BAL   LINREG,ERR40                                             01960021
TESTFL   LH    WRKREG,FLENGTH                                           01980021
         C     WRKREG,ZERO                                              02000021
         BE    RET                                                      02020021
*   TEST CHARACTER SIZE B OR L                                          02040021
         CLI   SIZE,C'B'                                                02060021
         BE    CHBASIC                                                  02080021
         CLI   SIZE,C'L'                                                02100021
         BE    CHLARGE                                                  02120021
         BAL   LINREG,ERR40                                             02140021
CHBASIC  LA    ODDREG,56                CWTH  BASIC                     02160021
         LA    EVEREG,80                CHGTH                           02180021
         MVC   YE,GFSCB                                                 02200021
         B     TESTTYPE                                                 02220021
CHLARGE  LA    ODDREG,84                CWTH LARGE                      02240021
         LA    EVEREG,120               CHGTH                           02260021
         MVC   YE,GFSCL                                                 02280021
TESTTYPE CLI   TYPE,C'X'                                                02300021
         BE    COMPUTEX                                                 02320021
         B     COMPUTEY                                                 02340021
         EJECT                                                          02360021
*   XI=X1-((FLENGTH-1)*CWTH)/2)     YI=VC-LGAP-(CHGT/2)                 02380021
COMPUTEX LH    WRKREG,FLENGTH                                           02400021
         S     WRKREG,ONE                                               02420021
         STH   WRKREG,WRKAREA                                           02440021
         MH    ODDREG,WRKAREA                                           02460021
         SRA   ODDREG,1                 /2                              02480021
         LH    WRKREG,X1                                                02500021
         SR    WRKREG,ODDREG            =XI                             02520021
         BM    ERR20RET                                                 02540021
         STH   WRKREG,XI                                                02560021
         SH    YREG,LGAP                VC-LGAP                         02580021
         SRA   EVEREG,1                 CWTH/2                          02600021
         SR    YREG,EVEREG              =YI                             02620021
         BM    ERR20RET                                                 02640021
         STH   YREG,YI                                                  02660021
         B     LOADADDR                                                 02680021
*    XI =UC-LGAP-(FLENGTH*CWTH)   YI=Y1                                 02700021
COMPUTEY MH    ODDREG,FLENGTH                                           02720021
         SH    YREG,LGAP                                                02740021
         SR    YREG,ODDREG                                              02760021
         BM    ERR20RET                                                 02780021
         STH   YREG,XI                                                  02800021
         MVC   YI,Y1                                                    02820021
LOADADDR MVC   ADDRESS,DATA                                             02840021
         MVC   XS,GEVM                                                  02860021
         MVC   GOMODE,GEVM                                              02880021
STORLABL MVC   YS,XI                                                    02900021
         MVC   XE,YI                                                    02920021
         OI    YS,X'40'                 SET BLANK BIT                   02940021
         LA    ADDREG,XS                                                02960021
         LA    CNTREG,8                                                 02980021
         BAL   LINREG,STORSAVE                                          03000021
         L     ADDREG,ADDRESS                                           03020021
         L     WRKREG,ADDRESS                                           03040021
         AH    WRKREG,FLENGTH           ADDRESS+FLENGTH                 03060021
         ST    WRKREG,ADDRESS           =NEW ADDRESS                    03080021
         LH    CNTREG,FLENGTH                                           03100021
         BAL   LINREG,STORSAVE                                          03120021
         MVC   GOMODE,YE                                                03140021
         TM    FLENGTH+1,X'01'          TEST FOR  FL=EVEN NUMBER        03160021
         BZ    NEXTINC                                                  03180021
         LA    ADDREG,ZERO                                              03200021
         LA    CNTREG,1                                                 03220021
         BAL   LINREG,STORSAVE                                          03240021
NEXTINC  CLI   TYPE,C'X'                                                03260021
         BE    XINC                                                     03280021
         LH    WRKREG,YI                YI                              03300021
         AR    WRKREG,XREG                +YINC                         03320021
         STH   WRKREG,YI                =NEW YI                         03340021
         CH    WRKREG,Y2                                                03360021
         BH    RET                                                      03380021
         B     STORLABL                                                 03400021
XINC     LH    WRKREG,XI                                                03420021
         AR    WRKREG,XREG                                              03440021
         STH   WRKREG,XI                                                03460021
         CH    WRKREG,X2                                                03480021
         BH    RET                                                      03500021
         B     STORLABL                                                 03520021
         EJECT                                                          03540021
*   STORE GEVM ORDER IN GDOA                                            03560021
STORGEVM LA    CNTREG,2                                                 03580021
         LA    ADDREG,GEVM                                              03600021
         MVC   GOMODE,GEVM                                              03620021
         BAL   LINREG,STORSAVE                                          03640021
         LR    WRKREG,YREG              UC OR VC                        03660021
         SH    WRKREG,LTICK             -LTICK=XE OR YE                 03680021
         BM    ERR20RET                XE OR YE OFF SCREEN              03700021
         CLI   TYPE,C'X'                                                03720021
         BE    XAXIS                                                    03740021
         STH   YREG,XS                  XS=UC                           03760021
         MVC   YS,Y1                    YS=Y1                           03780021
         STH   WRKREG,XE                XE=XS-LTICK                     03800021
         MVC   YE,Y1                    YE=YS                           03820021
         B     BLANKBIT                                                 03840021
XAXIS    MVC   XS,X1                    XS=X1                           03860021
         STH   YREG,YS                  YS=VC                           03880021
         MVC   XE,X1                    XE=XS                           03900021
         STH   WRKREG,YE                YE=YS-LTICK                     03920021
BLANKBIT OI    XS,X'40'                                                 03940021
         LA    CNTREG,8                                                 03960021
         LA    ADDREG,XS                                                03980021
STORTICK BAL   LINREG,STORSAVE                                          04000021
         CLI   TYPE,C'X'                                                04020021
         BE    XAXIS2                                                   04040021
         LH    WRKREG,YS                GET  YS                         04060021
         AR    WRKREG,XREG              +INC                            04080021
         STH   WRKREG,YS                NEW YS                          04100021
         STH   WRKREG,YE                NEW YE                          04120021
         CH    WRKREG,Y2                                                04140021
         BH    TESTFL                                                   04160021
         B     STORTICK                                                 04180021
XAXIS2   LH    WRKREG,XE                GET  XS (XE)                    04200021
         AR    WRKREG,XREG              +INC                            04220021
         STH   WRKREG,XS                NEW XS                          04240021
         STH   WRKREG,XE                NEW XE                          04260021
         CH    WRKREG,X2                                                04280021
         BH    TESTFL                                                   04300021
         B     BLANKBIT                                                 04320021
         EJECT                                                          04340021
*   LOAD ERROR CODE IN REG 15                                           04360021
ERR40    LA    15,40                    PARAMETER ERROR - DOES NOT RET  04380021
         B     ERRCNT                                                   04400021
ERR24RET LA    15,24                    USERS OVF HAS NOT RESET OLP     04420021
         B     ERRCNTR                                                  04440021
ERR20RET LA    15,20                    PARAMETER ERROR - RET           04460021
         B     ERRCNTR                                                  04480021
ERR16RET LA    15,16                    U1,V1 GREATER THAN U1,U2        04500021
         B     ERRCNTR                                                  04520021
ERR12RET LA    15,12                    FLT PT ERROR DETECTED           04540021
         B     ERRCNTR                                                  04560021
ERR8RET  LA    15,8                     U,V LIMIT ERROR AFTER SCALE     04580021
         B     ERRCNTR                                                  04600021
ERR4RET  LA    15,4                     XYLIM X1,Y1  X2,Y2 LIMIT ERROR  04620021
ERRCNTR  LA    LINREG,RET                                               04640021
ERRCNT   L     TEMREG,ERRCOUNT                                          04660021
         A     TEMREG,ONE                                               04680021
         ST    TEMREG,ERRCOUNT                                          04700021
         BR    LINREG                                                   04720021
*   TEST ERROR COUNT IN WORK AREA AND SET BIT                           04740021
*   IN SIGN POSITION OF REG 15 IF MULTIPLE ERRORS                       04760021
RET      LA    TEMREG,1                                                 04780021
         C     TEMREG,ERRCOUNT                                          04800021
         BL    SETBIT                                                   04820021
* RESTORE PROGRAM MASK TO SETTING UPON ENTRY                            04840021
RETMACRO L     WRKREG,MASKSV                                            04860021
         SPM   WRKREG                                                   04880021
         RETURN (14,12),T,RC=(15)                                       04900021
SETBIT   O     15,MZERO                                                 04920021
         B     RETMACRO                                                 04940021
         EJECT                                                          04960021
*   XYLCHK  SUBROUTINE                                                  04980021
*   CHECK X1,X2,Y1,Y2 LIMITS GREATER THAN 0 AND LESS THAN 4095          05000021
*   CHECK X1 LESS THAN X2 , Y1 LESS THAN Y2                             05020021
*   ADDRESSOF XYLIM TABLE IN XYLREG BEFORE BAL                          05040021
XYLCHK   LA    CNTREG,4                 SET  LOOP  COUNT                05060021
         LA    INXREG,0                 SET  INDEX                      05080021
XYLLOOP  LH    WRKREG,X1(INXREG)        LOAD X1,Y1,X2,Y2                05100021
         C     WRKREG,ZERO                                              05120021
         BL    ERR4RET                                                  05140021
         C     WRKREG,HIGH                                              05160021
         BH    ERR4RET                                                  05180021
         A     INXREG,TWO                                               05200021
         BCT   CNTREG,XYLLOOP                                           05220021
         CLC   X1,X2                                                    05240021
         BNL   ERR4RET                                                  05260021
         CLC   Y1,Y2                                                    05280021
         BNL   ERR4RET                                                  05300021
         BR    LINREG                                                   05320021
*   SAVE REG IN WORK AREA BEFORE BAL TO STORE                           05340021
STORSAVE STM   1,15,PORSAVE                                             05360021
         BAL   LINREG,STORE                                             05380021
         LM    1,15,PORSAVE                                             05400021
         BR    LINREG                                                   05420021
FLTLEG   CLI   S,C'S'                   TEST FOR SCALE                  05440021
         BE    SCALFLT                                                  05460021
         CLI   S,C'N'                   TEST FOR NO SCALE               05480021
         BE    FCONVERT                                                 05500021
         BAL   LINREG,ERR40                                             05520021
FCONVERT LR    VALREG,XREG              FIXCONVERT -(CONVERT FLOAT      05540021
         BAL   LINREG,FIXCONV           TO FIX)                         05560021
         LR    XREG,VALREG                                              05580021
         LR    VALREG,YREG                                              05600021
         BAL   LINREG,FIXCONV                                           05620021
         LR    YREG,VALREG                                              05640021
         B     TESTUV                                                   05660021
         EJECT                                                          05680021
*   CONVERT FLOATING POINT TO FIXED POINT VALUES                        05700021
*   TEST FLOATING POINT INPUT VALIDITY                                  05720021
*   VALREG CONTAINS THE VALUE TO BE CONVERTED                           05740021
FIXCONV  ST    VALREG,0(WKAREG)         STORE FLT VAL IN WORKAREA       05760021
         LE    6,0(WKAREG)              LOAD VALUE TO FLOAT REG         05780021
         N     VALREG,FCHAR             CHECK  CHARACTERISTIC           05800021
         BE    FLERR1                   POSSIBLE ERROR                  05820021
FCHECOK  AU    6,X6                     ADD EXPONENT TO FLOAT REG       05840021
         STE   6,0(WKAREG)              STORE CONV IN WORKAREA          05860021
         L     VALREG,0(WKAREG)         LOAD TO GR                      05880021
         N     VALREG,XZERO             DROP CHARACTERISTIC             05900021
         LTR   VALREG,VALREG            IS VAL NEGATIVE                 05920021
         BNL   NOTNEG                                                   05940021
         N     VALREG,NSIGN             DROP SIGN                       05960021
         LNR   VALREG,VALREG            TAKE TWO'S COMPLIMENT           05980021
NOTNEG   BR    LINREG                   RETURN TO NSI AFTER BAL         06000021
FLERR1   CE    6,ZERO                   IS VAL ZERO                     06020021
         BE    FCHECOK                                                  06040021
         B     ERR12RET                                                 06060021
SCALFLT  LA    CONREG,4                 LOOP  COUNT                     06080021
         LA    INXREG,0                 SET INDEX                       06100021
         LA    WRKREG,0                                                 06120021
FLTLOOP  LH    VALREG,X1(INXREG)        GET X1,Y1,X2,Y2 VALUES          06140021
         BAL   LINREG,FLTCONV                                           06160021
         ST    VALREG,4(WKAREG,WRKREG)                                  06180021
         A     INXREG,TWO                                               06200021
         A     WRKREG,FOUR                                              06220021
         BCT   CONREG,FLTLOOP                                           06240021
*    FLOATING POINT SPECIFIED - TEST FOR CHARACTERISTIC ZERO AND        06260021
*    FRACTION NON ZERO. OF ALL U,V VALUES                               06280021
         L     VALREG,U1                                                06300021
         BAL   LINREG,FIXCONV                                           06320021
         L     VALREG,U2                                                06340021
         BAL   LINREG,FIXCONV                                           06360021
         L     VALREG,V1                                                06380021
         BAL   LINREG,FIXCONV                                           06400021
         L     VALREG,V2                                                06420021
         BAL   LINREG,FIXCONV                                           06440021
         L     VALREG,UI                                                06460021
         BAL   LINREG,FIXCONV                                           06480021
         L     VALREG,VC                                                06500021
         BAL   LINREG,FIXCONV                                           06520021
         EJECT                                                          06540021
*   SUBROUTINE TO SCALE FLOATING POINT VALUES                           06560021
*   SCALED  U,V VALUES LOADED IN XREG AND YREG                          06580021
FLTSCAL  CLI   TYPE,C'X'                                                06600021
         BE    FLTSCALX                                                 06620021
*   (Y2-Y1)*VI/V2-V1)= SCALED INCREMENT (YINC)                          06640021
*   (UC-U1)*(X2-X1)/(U2-U1)+X1=XC                                       06660021
         LE    0,16(WKAREG)             Y2                              06680021
         SE    0,8(WKAREG)              -Y1                             06700021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    06720021
         ME    0,VI                     *VI                             06740021
         LE    2,V2                     V2                              06760021
         SE    2,V1                     -V1                             06780021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    06800021
         DER   0,2                                                      06820021
         STE   0,0(WKAREG)                                              06840021
         L     XREG,0(WKAREG)           XREG CONTAINS SCALED FP WI      06860021
         LE    0,UC                     UC                              06880021
         SE    0,U1                       -U1                           06900021
         LE    2,12(WKAREG)             X2                              06920021
         SE    2,4(WKAREG)                -X1                           06940021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    06960021
         MER   0,2                                                      06980021
         LE    2,U2                     U2                              07000021
         SE    2,U1                       -U1                           07020021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    07040021
         DER   0,2                                                      07060021
         AE    0,4(WKAREG)              +X1                             07080021
         STE   0,0(WKAREG)                                              07100021
         L     YREG,0(WKAREG)           SCALED FLOATING UC IN YREG      07120021
         B     FCONVERT                                                 07140021
*   (X2-X1)*UI/U2-U1)= SCALED INCREMENT (XINC)                          07160021
*   (VC-V1)*(Y2-Y1)/(V2-V1)+Y1=YC                                       07180021
FLTSCALX LE    0,12(WKAREG)             X2                              07200021
         SE    0,4(WKAREG)              -X1                             07220021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    07240021
         ME    0,UI                     *UI                             07260021
         LE    2,U2                     U2                              07280021
         SE    2,U1                     -U1                             07300021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    07320021
         DER   0,2                                                      07340021
         STE   0,0(WKAREG)                                              07360021
         L     XREG,0(WKAREG)           XREG CONTAINS SCALED FP UI      07380021
         LE    0,VC                     VC                              07400021
         SE    0,V1                       -V1                           07420021
         LE    2,16(WKAREG)             Y2                              07440021
         SE    2,8(WKAREG)                -Y1                           07460021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    07480021
         MER   0,2                                                      07500021
         LE    2,V2                     V2                              07520021
         SE    2,V1                       -V1                           07540021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    07560021
         DER   0,2                                                      07580021
         AE    0,8(WKAREG)              +Y1                             07600021
         STE   0,0(WKAREG)                                              07620021
         L     YREG,0(WKAREG)           SCALED FLOATING VAL VC IN YREG  07640021
         B     FCONVERT                                                 07660021
         EJECT                                                          07680021
*    CONVERT  FIXED  POINT  TO  FLOATING  POINT  VALUES                 07700021
*    TEST FLOATING POINT INPUT VALIDITY                                 07720021
*    VALREG CONTAINS THE VALUE TO BE CONVERTED                          07740021
FLTCONV  O     VALREG,X6                EXPONENT OF 6                   07760021
         ST    VALREG,0(WKAREG)                                         07780021
         LE    0,0(WKAREG)              LOAD FLOATING PT REG            07800021
         AE    0,X6                     NORMALIZE                       07820021
         STE   0,0(WKAREG)                                              07840021
         L     VALREG,0(WKAREG)         FLOAT PT VAL IN VALREG          07860021
         BR    LINREG                                                   07880021
         EJECT                                                          07900021
*   SUBROUTINE TO SCALE   FIXED  POINT  VALUES                          07920021
*   SCALED  U,V VALUES LOADED IN  XREG AND YREG  (FIXED POINT)          07940021
FIXSCAL  CLI   TYPE,C'X'                                                07960021
         BE    FIXSCALX                                                 07980021
*   (Y2-Y1)*VI/V2-V1)= SCALED INCREMENT (YINC)                          08000021
*   (UC-U1)*(X2-X1)/(U2-U1)+X1=XC                                       08020021
         LH    ODDREG,Y2                Y2                              08040021
         SH    ODDREG,Y1                -Y1                             08060021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    08080021
         SR    EVEREG,EVEREG            ZERO EVEN REG                   08100021
         MR    EVEREG,XREG              *VI                             08120021
         L     XREG,V2                  V2                              08140021
         S     XREG,V1                    -V1                           08160021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    08180021
         SR    EVEREG,EVEREG                                            08200021
         DR    EVEREG,XREG                                              08220021
         LR    XREG,ODDREG              YINC IN XREG                    08240021
         S     YREG,U1                  UC-U1                           08260021
         LR    ODDREG,YREG                                              08280021
         LH    YREG,X2                  X2                              08300021
         SH    YREG,X1                    -X1                           08320021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    08340021
         SR    EVEREG,EVEREG                                            08360021
         MR    EVEREG,YREG                                              08380021
         L     YREG,U2                  U2                              08400021
         S     YREG,U1                    -U1                           08420021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    08440021
         SR    EVEREG,EVEREG                                            08460021
         DR    EVEREG,YREG                                              08480021
         AH    ODDREG,X1                +X1                             08500021
         LR    YREG,ODDREG              SCALED VC IN YREG               08520021
         B     TESTUV                                                   08540021
*   (X2-X1)*UI/U2-U1)= SCALED INCREMENT (XINC)                          08560021
*   (VC-V1)*(Y2-Y1)/(V2-V1)+Y1=YC                                       08580021
FIXSCALX LH    ODDREG,X2                                                08600021
         SH    ODDREG,X1                -X1                             08620021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    08640021
         SR    EVEREG,EVEREG            ZERO EVEN REG                   08660021
         MR    EVEREG,XREG              * UI                            08680021
         L     XREG,U2                  U2                              08700021
         S     XREG,U1                                                  08720021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    08740021
         SR    EVEREG,EVEREG            ZERO EVEN REG                   08760021
         DR    EVEREG,XREG                                              08780021
         LR    XREG,ODDREG              SCALED U VALUE IN XREG          08800021
         S     YREG,V1                  VC                              08820021
         LR    ODDREG,YREG                                              08840021
         LH    YREG,Y2                  Y2                              08860021
         SH    YREG,Y1                    -Y1                           08880021
         BC    13,ERR4RET               BRANCH ON OVF, MINUS OR ZERO    08900021
         SR    EVEREG,EVEREG                                            08920021
         MR    EVEREG,YREG                                              08940021
         L     YREG,V2                  V2                              08960021
         S     YREG,V1                    -V1                           08980021
         BC    13,ERR16RET              BRANCH ON OVF, MINUS OR ZERO    09000021
         SR    EVEREG,EVEREG                                            09020021
         DR    EVEREG,YREG                                              09040021
         AH    ODDREG,Y1                                                09060021
         LR    YREG,ODDREG                                              09080021
         B     TESTUV                                                   09100021
         EJECT                                                          09120021
* STORE GRAPHIC DATA IN GDOA FOR POR                                    09140021
* INPUT TO SUBROUTINE                                                   09160021
*   CNTREG = NUMBER OF BYTES OF GRAPHIC DATA TO STORE                   09180021
*   ADDREG = ADDRESS OF THE GRAPHIC DATA                                09200021
*   WKAREG = REGISTER 1 MUST CONTAIN THE WORKAREA ADDRESS               09220021
*   OABREG = ADDRESS OF OACB                                            09240021
STORE    SR    PASREG,PASREG            CLEAR OVERFLOW PASS INDICATOR   09260021
STORE1   L     OLPREG,16(0,OABREG)      ADDRESS OF OLP FROM OACB        09280021
         LR    WRKREG,CNTREG            LOAD BYTES TO MOVE              09300021
* CALCULATE ADDRESSES BASED ON N VALUE AND SIZE OF GDOA                 09320021
STORE2   AR    OLPREG,WRKREG            OLP ADDRESS PLUS N VALUE        09340021
         LA    TEMREG,4                                                 09360021
         AR    TEMREG,OLPREG            OLP PLUS N PLUS 4               09380021
         L     SLOREG,0(OABREG)         SLOA ADDRESS                    09400021
         A     SLOREG,4(OABREG)         ADD LOA EQUALS TOTAL GDOA       09420021
         L     OLPREG,16(0,OABREG)      RESET INITIAL OLP ADDRESS       09440021
         CR    TEMREG,SLOREG                                            09460021
         BNH   OK                       ROOM FOR DATA                   09480021
* NOT ENOUGH ROOM TO STORE ALL OF THE DATA-DETERMINE AMOUNT TO STORE    09500021
         SR    TEMREG,SLOREG            EQUAL BYTES-CAN'T STORE         09520021
         SR    WRKREG,TEMREG            NUMBER OF BYTES CAN STORE       09540021
* ANY BYTES TO STORE                                                    09560021
         C     WRKREG,ZERO                                              09580021
         BNH   STORE4                   LESS OF EQUAL TO ZERO           09600021
         LH    TEMREG,H2A02                                             09620021
         CH    TEMREG,GOMODE                                            09640021
         BH    STORE3A                                                  09660021
         LH    TEMREG,H0003                                             09680021
         NR    TEMREG,WRKREG                                            09700021
         BM    STORE4      GO TO USER OVERFLOW ROUTINE (HALA)      7468 09720021
STORE3A  SR    CNTREG,WRKREG       BYTES REMAINING                      09740021
         BAL   INTLNK,STORE6            LINK INTERNALLY                 09760021
STORE3   LA    PASREG,1                 SET PASS INDICATOR              09780021
* STORE REGISTERS IN WORKAREA                                           09800021
         STM   0,15,0(WKAREG)           SAVE REGISTERS IN WORKAREA      09820021
         L     15,8(0,OABREG)           OVER FLOW ADDRESS               09840021
         LM    2,12,28(13)              RELOAD USER'S REGISTERS         09860021
         BALR  14,15                    LINK TO ROUTINE-SET RETURN      09880021
         LM    0,15,0(WKAREG)           RELOAD FROM WORKAREA            09900021
         B     STORE1                   GET NEW OLP ADDRESS-CONTINUE    09920021
* NO SPACE AVAILABLE                                                    09940021
STORE4   C     PASREG,ONE               WAS A TRANSFER TO OVERFLOW MADE 09960021
         BL    STORE3                   NO                              09980021
* SET ERROR CODE AND RETURN TO POR-LEAVE POR WITH RETURN MACRO          10000021
         B     ERR24RET                                                 10020021
OK       BAL   INTLNK,STORE6            LINK INTERNALLY                 10040021
         BR    LINREG                                                   10060021
STORE6   LA    TEMREG,255               SET REG. EQUAL TO 255           10080021
STORE6A  CR    WRKREG,TEMREG            IS AMOUNT TO MOVE OVER 255      10100021
         BH    STORE7                   YES                             10120021
         LR    TEMREG,WRKREG                                            10140021
         S     TEMREG,ONE               COMPENSATE FOR EXTRA BYTE       10160021
         EX    TEMREG,MOVE              MOVE GRAPHIC DATA               10180021
         AR    OLPREG,WRKREG            UPDATE OLP ADDRESS              10200021
         AR    ADDREG,WRKREG            UPDATE DATA ADDR                10220021
         ST    OLPREG,16(0,OABREG)      STORE NEW OLP ADDRESS           10240021
         BR    INTLNK                   RETURN INTERNALLY               10260021
STORE7   LR    SLOREG,TEMREG                                            10280021
         S     SLOREG,ONE               COMPENSATE FOR EXTRA BYTE       10300021
         EX    SLOREG,MOVE              MOVE GRAPHIC DATA               10320021
         AR    OLPREG,TEMREG            UPDATE OLP ADDRESS              10340021
         AR    ADDREG,TEMREG            UPDATE INPUT ADDRESS            10360021
         SR    WRKREG,TEMREG           REDUCE BY 255                    10380021
         B     STORE6A                  MAKE NEXT COMPARISON            10400021
MOVE     MVC   0(0,OLPREG),0(ADDREG)    MOVE DATA TO GDOA               10420021
         EJECT                                                          10440021
ZERO     DC    F'0'                                                     10460021
ONE      DC    F'1'                                                     10480021
TWO      DC    F'2'                                                     10500021
HIGH     DC    F'4095'                                                  10520021
FOUR     DC    F'4'                                                     10540021
H2A02    DC    X'2A02'                                                  10560021
H0003    DC    H'0003'                                                  10580021
FCHAR    DC    X'7F000000'                                              10600021
XZERO    DC    X'80FFFFFF'                   SIGN AND VALUE -DROP E     10620021
X6       DC    X'46000000'                   EXPONENT OF SIX            10640021
NSIGN    DC    X'7FFFFFFF'                   DROP SIGN -RETAIN VALUE    10660021
MZERO    DC    X'80000000'                                              10680021
GEVM     DC    X'2A02'                                                  10700021
GFSCB    DC    X'2A40'                                                  10720021
GFSCL    DC    X'2A41'                                                  10740021
PASREG   EQU   0                                                        10760021
WKAREG   EQU   1                                                        10780021
OBPREG   EQU   2                                                        10800021
OABREG   EQU   2                                                        10820021
PATREG   EQU   3                                                        10840021
XYLREG   EQU   4                                                        10860021
XREG     EQU   5                                                        10880021
SLOREG   EQU   5                                                        10900021
YREG     EQU   6                                                        10920021
INTLNK   EQU   6                                                        10940021
WRKREG   EQU   7                                                        10960021
CNTREG   EQU   8                                                        10980021
INXREG   EQU   10                                                       11000021
OLPREG   EQU   10                                                       11020021
EVEREG   EQU   10                                                       11040021
ODDREG   EQU   11                                                       11060021
VALREG   EQU   11                                                       11080021
TEMREG   EQU   11                                                       11100021
LINREG   EQU   12                                                       11120021
CONREG   EQU   14                                                       11140021
ADDREG   EQU   14                                                       11160021
         EJECT                                                          11180021
PARTAB   DSECT                                                          11200021
XYLIM    DS    CL4                                                      11220021
UI       DS    CL4                                                      11240021
         ORG   UI                                                       11260021
VI       DS    CL4                                                      11280021
UC       DS    CL4                                                      11300021
         ORG   UC                                                       11320021
VC       DS    CL4                                                      11340021
F        DS    CL1                                                      11360021
S        DS    CL1                                                      11380021
SIZE     DS    CL1                                                      11400021
TYPE     DS    CL1                                                      11420021
DATA     DS    CL4                                                      11440021
FLENGTH  DS    CL2                                                      11460021
LGAP     DS    CL2                                                      11480021
LTICK    DS    CL2                                                      11500021
*                                                                       11520021
XYLIMT   DSECT                                                          11540021
X1       DS    CL2                                                      11560021
Y1       DS    CL2                                                      11580021
X2       DS    CL2                                                      11600021
Y2       DS    CL2                                                      11620021
U1       DS    CL4                                                      11640021
U2       DS    CL4                                                      11660021
V1       DS    CL4                                                      11680021
V2       DS    CL4                                                      11700021
*                                                                       11720021
WRKAREA  DSECT                                                          11740021
OVFSAVE  DS    CL64                                                     11760021
PORSAVE  DS    CL64                                                     11780021
ADDRESS  DS    CL4                                                      11800021
ERRCOUNT DS    CL4                                                      11820021
XI       DS    CL2                                                      11840021
YI       DS    CL2                                                      11860021
XS       DS    CL2                                                      11880021
YS       DS    CL2                                                      11900021
XE       DS    CL2                                                      11920021
YE       DS    CL2                                                      11940021
MASKSV   DS    F                   SAVE SETTING OF USER PROGRAM MASK    11960021
         ORG   OVFSAVE+396                                              11980021
GOMODE   DS    CL2                                                      12000021
         END                                                            12020021
