         TITLE 'GPVGRD - VECTOR POLAR GRID GENEREATION ROUTINE'         00020021
*                                                                       00040021
*                                                                       00060021
*   STATUS.              CHANGE LEVEL 0.                                00080021
*                                                                       00100021
*   FUNCTION/OPERATION.  GPVGRD GENERATES THE GRAPHIC ORDERS TO DISPLAY 00120021
*                        A SET OF CONCENTRIC CIRCLES, DIVIDED INTO      00140021
*                        EQUAL SECTORS BY A NUMBER OF RADIAL VECTORS.   00160021
*                        THE SPACING BETWEEN THE CIRCLES MAY BE LINEAR  00180021
*                        OR LOGARITHMIC.  THIS ROUTINE PROVIDES THE     00200021
*                        GRAPHIC ORDERS TO  DISPLAY POLYGONS  WHICH     00220021
*                        APPROXIMATE THE CIRCLES, AND IS PROVIDED FOR   00240021
*                        USE WITH GRAPHIC  DEVICES  HAVING ABSOLUTE     00260021
*                        VECTORS CAPABILITIES.                          00280021
*                                                                       00300021
*   ENTRY POINTS.        GPVGRD VIA CALL OR LINK MACRO.                 00320021
*                        ALIAS NAME - IFFPJAPV                          00340021
*                                                                       00360021
*   INPUT.               OUTPUT CONTROL BLOCK POINTER (OACB).           00380021
*                        PARAMETER TABLE WHICH DEFINES THE POSITION,    00400021
*                        SIZE, AND TYPE OF POLAR GRID.                  00420021
*                                                                       00440021
*   OUTPUT.              GRAPHIC ORDERS STORED IN THE GDOA.             00460021
*                                                                       00480021
*   EXTERNAL ROUTINES.   GOFFSG - OFF SCREEN OFF GRID ROUTINE.          00500021
*                                                                       00520021
*   EXITS-NORMAL.        COMPLETION OF TASK. EXIT VIA RETURN MACRO.     00540021
*        -ERROR.         IMMEDIATE RETURN. EXIT VIA RETURN MACRO.       00560021
*                        HEXADECIMAL 4,8,C,10,14, OR 18 IN RET CODE REG 00580021
*        -ERROR.         DOES NOT RETURN IMMEDIATELY. COMPLETION OF     00600021
*                        TASK AND RETURN VIA RETURN MACRO.              00620021
*                        HEXADECIMAL 28 IN RETURN CODE REGISTER.        00640021
*                                                                       00660021
*   TABLES/WORK AREAS.   USER SPECIFIED PARAMETER TABLE, XYLIM TABLE    00680021
*                        AND WORK AREA.                                 00700021
*                                                                       00720021
*   ATTRIBUTES.          READ ONLY. REENTRANT.                          00740021
         EJECT                                                          00760021
IFFPJAPV CSECT                          GPVGRD                          00780021
*0669                                                              7468 00790021
         ENTRY GPVGRD                                                   00800021
PASREG   EQU   0                                                        00820021
WKAREG   EQU   1                        WORK AREA ADDRESS REGISTER      00840021
PARREG   EQU   1                                                        00860021
OBPREG   EQU   2                        CONTROL BLOCK POINTER ADDR REG  00880021
OABREG   EQU   2                        CONTROL BLOCK ADDRESS REGISTER  00900021
PATREG   EQU   3                        ADDRESS OF PARAMETER TABLE      00920021
XYLREG   EQU   4                        ADDRESS OF XYLIM TABLE          00940021
XREG     EQU   5                        X-COMPUTING REGISTER            00960021
SLOREG   EQU   5                        SLOA ADDRESS REGISTER           00980021
COSREG   EQU   5                        COSINE REGISTER                 01000021
SINREG   EQU   6                        SINE REGISTER                   01020021
YREG     EQU   6                        Y-COMPUTING REGISTER            01040021
INTLNK   EQU   6                        INTERNAL POR LINK REGISTER      01060021
INDEXREG EQU   7                        INDEX REGISTER                  01080021
WRKREG   EQU   7                        WORK REGISTER                   01100021
CNTREG   EQU   8                        COUNT REGISTER                  01120021
LINKREG  EQU   8                        INTERNAL POR LINK REGISTER.     01140021
BASE9    EQU   9                        BASE REGISTER FOR GPGRID        01160021
INXREG   EQU   10                       INDEX AND POR LINK REGISTER     01180021
OLPREG   EQU   10                       ORDER LOAD POINT ADDRESS        01200021
EVEREG   EQU   10                       ARITHMETIC WORK REGISTER        01220021
ODDREG   EQU   11                       ARITHMETIC WORK REGISTER        01240021
VALREG   EQU   11                       WORK REGISTER                   01260021
TEMREG   EQU   11                       WORK REGISTER                   01280021
LINREG   EQU   12                       INTERNAL POR LINK REGISTER      01300021
ADDREG   EQU   14                       GENERAL USE ADDRESS REGISTER    01320021
CONREG   EQU   14                       CONTROL COUNT REGISTER          01340021
ERREG    EQU   15                       ERROR CODE REGISTER             01360021
         EJECT                                                          01380021
*************************                                               01400021
*   INITIALIZATION      *                                               01420021
*************************                                               01440021
GPVGRD   STM   14,12,12(13)                                             01460021
         BALR  BASE9,0                                                  01480021
         USING *,BASE9                                                  01500021
         USING PARTAB,PATREG                                            01520021
         USING WKAREA,WKAREG                                            01540021
         USING XYLIMT,XYLREG                                            01560021
         SR    ERREG,ERREG                                              01580021
         LM    OBPREG,PATREG,0(PARREG)  LOAD OCBP AND PARTAB ADDRESSES. 01600021
         L     XYLREG,XYLIM             LOAD ADDR OF XYLIM TABLE.       01620021
         L     WKAREG,4(0,OBPREG)       LOAD ADDR OF USER WORK AREA.    01640021
         L     OABREG,0(0,OBPREG)       LOAD ADDR OF CONTROL BLOCK.     01660021
*  SAVE MASK BITS AS SET BY USER                                        01680021
         ST    9,MASKSV                                                 01700021
         SR    WRKREG,WRKREG                                            01720021
         SPM   WRKREG                                                   01740021
         BAL   LINREG,XYLCHK            LINK TO XYLIM CHECK             01760021
         MVC   ERCOUNT,ZERO         CLEAR ERROR COUNTER                 01780021
         MVI   SGSW,X'00'                                               01800021
         MVI   LOADSW,X'00'                                             01820021
         CLI   F,C'F'                   CHECK FOR FLOATING POINT VALUES 01840021
         BE    FLOAT                    BRANCH IF FIX FL OPTION = F     01860021
         CLI   F,C'B'                                                   01880021
         BE    CHKS                     IF F PARA NOT = F OR B,         01900021
         BAL   LINKREG,ER40             LINK TO SET ERROR CODE.         01920021
CHKS     CLI   S,C'S'                   CHECK IF SCALING REQUIRED.      01940021
         BE    LINK1                    SCALE FIXED POINT VALUES.       01960021
         MVC   RINK(4),RINC             STORE RINC AND MAX-RADIUS       01980021
         MVC   MAXR(4),MAXRAD           IN THE USER WORK AREA.          02000021
         MVC   XC(8),UC                 UC,VC TO USER WORK AREA.        02020021
TSTS     CLI   S,C'N'                                                   02040021
         BE    CHKPARA                  IF SCALE PARA NOT S OR N,       02060021
         BAL   LINKREG,ER40             LINK TO SET ERROR CODE.         02080021
         B     CHKPARA                                                  02100021
FLOAT    CLI   S,C'S'                                                   02120021
         BE    LINK2                                                    02140021
         CLI   S,C'N'                   IF SCALE PARA NOT S OR N,       02160021
         BE    LINK0                    LINK TO SET ERROR CODE.         02180021
         BAL   LINKREG,ER40                                             02200021
LINK0    L     VALREG,UC                CONVERT UC,VC,RINC AND          02220021
         BAL   LINREG,FIXCONV           MAX-RADIUS TO FIXED POINT.      02240021
         ST    VALREG,XC                                                02260021
         L     VALREG,VC                                                02280021
         BAL   LINREG,FIXCONV                                           02300021
         ST    VALREG,YC                                                02320021
         L     VALREG,RINC                                              02340021
         BAL   LINREG,FIXCONV                                           02360021
         ST    VALREG,RINK                                              02380021
         L     VALREG,MAXRAD                                            02400021
         BAL   LINREG,FIXCONV                                           02420021
         ST    VALREG,MAXR                                              02440021
         B     CHKPARA                                                  02460021
LINK1    L     XREG,UC                  SCALE FIXED-POINT VALUES        02480021
         L     YREG,VC                  UC,VC,RINC,AND MAX-RADIUS.      02500021
         BAL   LINREG,SCALFIX                                           02520021
         ST    XREG,XC                                                  02540021
         ST    YREG,YC                                                  02560021
         L     XREG,RINC                                                02580021
         BAL   LINREG,FIXSCAL                                           02600021
         ST    XREG,RINK                                                02620021
         L     XREG,MAXRAD                                              02640021
         BAL   LINREG,FIXSCAL           BR TO SCALE MAXIMUM RADIUS.     02660021
         ST    XREG,MAXR                                                02680021
         B     CHKPARA                                                  02700021
LINK2    BAL   LINKREG,SCALFLT          SCALE FLOATING POINT VALUES     02720021
         MVC   VALUE1(4),RINC           UC,VC,RINC, AND MAXRAD.         02740021
         BAL   LINKREG,FLTSCAL                                          02760021
         ST    VALREG,RINK              STORE SCALED VALUES IN          02780021
         MVC   VALUE1(4),MAXRAD         XC,YC,RINK, AND MAXR.           02800021
         BAL   LINKREG,FLTSCAL                                          02820021
         ST    VALREG,MAXR                                              02840021
******************************                                          02860021
*   CHECK PARAMETER TABLE    *                                          02880021
******************************                                          02900021
CHKPARA  LM    XREG,YREG,XC             CHECK INPUT PARAMETERS.         02920021
         C     XREG,ZERO                IF XC IS LESS THAN ZERO,        02940021
         BL    ER8                      BR TO SET ERROR CODE & RETURN.  02960021
         C     XREG,C4095               IF XC IS GREATER THAN 4095,     02980021
         BH    ER8                      BR TO SET ERROR CODE & RETURN.  03000021
         C     YREG,ZERO                IF YC IS LESS THAN ZERO,        03020021
         BL    ER8                      BR TO SET ERROR CODE & RETURN.  03040021
         C     YREG,C4095                                               03060021
         BH    ER8                                                      03080021
         L     WRKREG,MAXR              CHECK MAXR AND RINK             03100021
         C     WRKREG,FOUR              TO SEE IF GT FOUR.              03120021
         BL    ER20                     SET ERROR CODE AND RET IF NOT.  03140021
         L     WRKREG,RINK                                              03160021
         C     WRKREG,FOUR                                              03180021
         BL    ER20                                                     03200021
         MVC   R(4),RINK                                                03220021
         CLI   TYPE,C'A'                                                03240021
         BE    TSTINC                                                   03260021
         CLI   TYPE,C'B'                IF TYPE NOT A OR B,             03280021
         BNE   ER20                     SET ERROR CODE AND RETURN.      03300021
RLOG     MVI   J,X'01'                  LOG GRID REQUESTED. SET J=1.    03320021
         MVC   LOGSAV(2),MINUS2                                         03340021
TSTINC   CLI   INC,C'A'                 CHECK PARAMETER INC TO SEE      03360021
         BE    SETA                     IF ALPHA OR DENSITY IS SPEC.    03380021
         CLI   INC,C'D'                                                 03400021
         BE    SETD                                                     03420021
SETC     BAL   LINKREG,ER40             IF INC NOT A OR D, SET INTERNAL 03440021
         MVI   INK,C'C'                 INDICATOR TO C, ERROR CODE TO   03460021
         B     AOK                      40 AND CONTINUE PROCESSING.     03480021
SETA     LH    WRKREG,ALPHA             ALPHA SPECIFIED.                03500021
         CH    WRKREG,ZERO                                              03520021
         BL    SETC                                                     03540021
         BE    SETCC                                                    03560021
         CH    WRKREG,H360                                              03580021
         BNL   SETC                                                     03600021
         MVI   INK,C'A'                 ALPHA OK.                       03620021
         MVC   ALPH(2),ALPHA            MOVE ALPHA TO USER WORK AREA.   03640021
         B     AOK                                                      03660021
SETCC    MVI   INK,C'C'                                                 03680021
         B     AOK                                                      03700021
SETD     LH    WRKREG,DENSITY           DENSITY SPECIFIED.              03720021
         CH    WRKREG,FOUR                                              03740021
         BL    SETC                                                     03760021
         MVI   INK,C'D'                                                 03780021
AOK      LA    CNTREG,2                 LENGTH OF GEPM ORDER TO CNTREG. 03800021
         LA    ADDREG,GEVM              LOAD ADDR OF GEVM ORDER.        03820021
         MVC   GOMODE,GEVM                                              03840021
         BAL   LINREG,STORE             LINK TO STORE GEPM ORDER.       03860021
         MVC   I(4),ONE                 SET I=1.                        03880021
         EJECT                                                          03900021
TESTINC  CLI   INK,C'C'                 IF INK=C, COMPUTE ALPHA=2048/R  03920021
         BE    COMPA                                                    03940021
         CLI   INK,C'D'                 IF INK NOT D, INK=A.            03960021
         BNE   SETNPT                                                   03980021
**************************************************                      04000021
* COMPUTE  TEMP=360*DENSITY/(2PI*R)              *                      04020021
*          ALPHA=INTEGRAL PART OF (TEMP+0.5)     *                      04040021
**************************************************                      04060021
ALPHAGET L     EVEREG,C360                                              04080021
         MH    EVEREG,DENSITY           COMPUTE 360*DENSITY             04100021
         SRDA  EVEREG,32                                                04120021
         SLDA  EVEREG,29                                                04140021
         D     EVEREG,TWOPI             COMPUTE 360*DENSITY/2PI         04160021
         SR    EVEREG,EVEREG                                            04180021
         L     WRKREG,R                                                 04200021
         DR    EVEREG,WRKREG            COMPUTE ALPHA=360*DENSITY/2PI/R 04220021
         A     ODDREG,ONE                                               04240021
         SRA   ODDREG,1                                                 04260021
         STH   ODDREG,ALPH              STORE ALPHA IN USER WORK AREA.  04280021
CHKA1    CLC   ALPH(2),ZERO                                             04300021
         BH    CHKA2                                                    04320021
SETALP   MVC   ALPH(2),ONE+2            SET ALPHA = 1.                  04340021
         B     SETNPT                                                   04360021
CHKA2    CLC   ALPH(2),H360                                             04380021
         BL    SETNPT                                                   04400021
         BAL   LINKREG,ER40                                             04420021
******************************                                          04440021
*   COMPUTE ALPHA=2048/R     *                                          04460021
******************************                                          04480021
COMPA    CLC   R(4),C1365               IF R IS GT 1365,                04500021
         BH    SETALP                   BR TO SET ALPHA TO ONE.         04520021
         CLC   R+2(2),C46               IF R IS LESS THAN 46,           04540021
         BL    SETA45                   SET ALPHA = 45.                 04560021
         LA    EVEREG,2048              IF NOT, COMPUTE ALPHA.          04580021
         SRDA  EVEREG,32                                                04600021
         SLDA  EVEREG,1                                                 04620021
         D     EVEREG,R                                                 04640021
         A     ODDREG,ONE                                               04660021
         SRA   ODDREG,1                                                 04680021
         STH   ODDREG,ALPH              STORE ALPHA IN USER WORK AREA.  04700021
         B     SETNPT                                                   04720021
SETA45   MVC   ALPH(2),C45                                              04740021
         B     SETNPT                                                   04760021
GETR     STH   INDEXREG,LOGSAV                                          04780021
         SR    EVEREG,EVEREG            COMPUTE  R=RINC*(I-1+LOG(J))    04800021
         L     EVEREG,I                 EVEREG=I                        04820021
         SH    EVEREG,ONE+2             EVEREG=I-1                      04840021
         SLA   EVEREG,14                                                04860021
         AH    EVEREG,LOGJ(INDEXREG)    EVEREG=I-1+LOG(J)               04880021
         SRDA  EVEREG,32                                                04900021
         M     EVEREG,RINK              EVEREG=R=RINC*(I-1+LOG(J))      04920021
         AH    ODDREG,POINT5                                            04940021
         SRA   ODDREG,14                REMOVE DECIMAL PORTION OF R     04960021
         ST    ODDREG,R                 AND STORE IN USER WORK AREA.    04980021
         BR    LINKREG                                                  05000021
SETNPT   MVC   K(2),ZERO                                                05020021
         CLC  R(4),C5793                SEE IF ALL POINTS WITH CURRENT  05040021
         BNH   SETPHI                   RADIUS WILL BE OUTSIDE SCREEN.  05060021
         MVC   PHI(2),H360                                              05080021
         MVC   PT1X(4),C5793                                            05100021
         L     XREG,C5793                                               05120021
         L     YREG,C5793                                               05140021
         OI    SGSW,X'FF'                                               05160021
         B     OFFSCR                   BR TO CHECK OFF SCREEN OPTION.  05180021
SETPHI   LH    ODDREG,K                 SET PHI=K*ALPHA                 05200021
         MH    ODDREG,ALPH                                              05220021
         STH   ODDREG,PHI               STORE VALUE IN USER WRK AREA.   05240021
         LA    LINREG,OFFCHECK                                          05260021
         EJECT                                                          05280021
***********************************                                     05300021
*   DETERMINE QUADRANT OF PHI.    *                                     05320021
*   GET SIN%PHI< AND COS%PHI<     *                                     05340021
*   FROM SINE/COSINE TABLE.       *                                     05360021
***********************************                                     05380021
GETQUAD  CLC   PHI(2),C90               CHECK IF PHI IN 1'ST QUADRANT.  05400021
         BH    CK180                    IF NOT, CHECK QUADRANT 2.       05420021
         CLC   PHI(2),C46                                               05440021
         BL    TBLOK                                                    05460021
         MVI   FUNCSW,X'0F'             PHI IN RANGE OF 46-90 DEG.      05480021
         LA    WRKREG,90                                                05500021
         B     LOOKUP1                  GO TO EXTRACT SIN(PHI),COS(PHI) 05520021
TBLOK    MVI   FUNCSW,X'00'             PHI IN RANGE OF 0-45 DEG.       05540021
         LA    WRKREG,0                                                 05560021
         B     LOOKUP2                  GO TO EXTRACT SIN(PHI),COS(PHI) 05580021
CK180    CLC   PHI(2),C180              CHECK IF PHI IN 2'ND QUADRANT   05600021
         BH    CK270                    IF NOT, CHECK QUADRANT 3.       05620021
         CLC   PHI(2),C136                                              05640021
         BL    PHI180                                                   05660021
         MVI   FUNCSW,X'30'             PHI IN RANGE OF 136-180 DEG.    05680021
         LA    WRKREG,180                                               05700021
         B     LOOKUP1                  GO TO EXTRACT SIN(PHI),COS(PHI) 05720021
PHI180   MVI   FUNCSW,X'3F'             PHI IN RANGE OF 91-135 DEG.     05740021
         LA    WRKREG,90                                                05760021
         B     LOOKUP2                  GO TO EXTRACT SIN(PHI),COS(PHI) 05780021
CK270    CLC   PHI(2),C270              CHECK IF PHI IN 3'RD QUAD.      05800021
         BH    CK315                    IF NOT, PHI IN QUADRANT 4.      05820021
         CLC   PHI(2),C226                                              05840021
         BL    PHI270                                                   05860021
         MVI   FUNCSW,X'FF'             PHI IN RANGE OF 226-270 DEG.    05880021
         LA    WRKREG,270                                               05900021
         B     LOOKUP1                  GO TO EXTRACT SIN(PHI),COS(PHI) 05920021
PHI270   MVI   FUNCSW,X'F0'             PHI IN RANGE OF 181-225 DEG.    05940021
         LA    WRKREG,180                                               05960021
         B     LOOKUP2                  GO TO EXTRACT SIN(PHI),COS(PHI) 05980021
CK315    CLC   PHI(2),C315                                              06000021
         BH    PHI360                                                   06020021
         MVI   FUNCSW,X'CF'             PHI IN RANGE OF 271-315 DEG.    06040021
         LA    WRKREG,270                                               06060021
         B     LOOKUP2                  GO TO EXTRACT SIN(PHI),COS(PHI) 06080021
PHI360   CLC   PHI(2),H360                                              06100021
         BNL   SET360                                                   06120021
         MVI   FUNCSW,X'C0'             PHI IN RANGE OF 316-360 DEG.    06140021
         LA    WRKREG,360                                               06160021
         B     LOOKUP1                                                  06180021
SET360   L     INXREG,ZERO                                              06200021
         MVI   FUNCSW,X'00'                                             06220021
         B     EXTRACT                                                  06240021
LOOKUP1  SH    WRKREG,PHI                                               06260021
         LR    INXREG,WRKREG                                            06280021
         B     EXTRACT                                                  06300021
LOOKUP2  LH    INXREG,PHI                                               06320021
         SR    INXREG,WRKREG                                            06340021
EXTRACT  MH    INXREG,FOUR+2                                            06360021
         TM    FUNCSW,X'0F'             IF FUNCSW=0F, GO TO PUT COS     06380021
         BO    SWITCH                   IN SINREG AND SIN IN COSREG.    06400021
         LH    SINREG,SINE(INXREG)      LOAD SINE TO SINREG.            06420021
         LH    COSREG,COSINE(INXREG)    LOAD COSINE TO COSREG.          06440021
         B     TSIGNS                   GO TO TEST SIGN OF FUNCTIONS.   06460021
SWITCH   LH    SINREG,COSINE(INXREG)    LOAD COSINE TO SINREG.          06480021
         LH    COSREG,SINE(INXREG)      LOAD SINE TO COSREG.            06500021
TSIGNS   TM    FUNCSW,X'C0'             SEE IF SIGN OF SINE IS MINUS.   06520021
         BZ    TSIGNC                                                   06540021
         MH    SINREG,MINUS1                                            06560021
TSIGNC   TM    FUNCSW,X'30'             SEE IF SIGN OF COSINE IS MINUS. 06580021
         BZ    MULTR                                                    06600021
         MH    COSREG,MINUS1                                            06620021
         EJECT                                                          06640021
**************************************************                      06660021
*   COMPUTE  X=XC+R*COS(PHI) AND Y=YC+R*SIN(PHI) *                      06680021
**************************************************                      06700021
MULTR    LR    EVEREG,COSREG            LOAD COS(PHI)                   06720021
         SRDA  EVEREG,32                                                06740021
         M     EVEREG,R                 R*COS(PHI)                      06760021
         L     COSREG,XC                                                06780021
         SLA   COSREG,14                                                06800021
         AR    COSREG,ODDREG            XC+R*COS(PHI)                   06820021
         AH    COSREG,POINT5                                            06840021
         SRA   COSREG,14                SHIFT OFF DECIMAL PORTION OF X. 06860021
         LR    EVEREG,SINREG            LOAD SIN(PHI)                   06880021
         SRDA  EVEREG,32                                                06900021
         M     EVEREG,R                 R*SIN(PHI)                      06920021
         L     SINREG,YC                                                06940021
         SLA   SINREG,14                                                06960021
         AR    SINREG,ODDREG            YC+R*SIN(PHI)                   06980021
         AH    SINREG,POINT5                                            07000021
         SRA   SINREG,14                SHIFT OFF DECIMAL PORTION OF Y. 07020021
         BR    LINREG                                                   07040021
****************************************                                07060021
*   XREG=COSREG=X   YREG=SINREG=Y      *                                07080021
****************************************                                07100021
OFFCHECK BAL   LINKREG,CHKOFF           LINK TO OFF GRID/SCREEN CHECK.  07120021
         B     OFFGRD                   IF POINT OFF GRID.              07140021
         B     OFFSCR                   IF POINT OFF SCREEN.            07160021
         B     CONT                     IF POINT OK.                    07180021
CHKOFF   C     XREG,C4095               TEST X- AND Y-COORDINATES       07200021
         BH    4(0,LINKREG)             TO SEE IF OFF-SCREEN/GRID.      07220021
         C     XREG,ZERO                                                07240021
         BL    4(0,LINKREG)                                             07260021
         C     YREG,C4095                                               07280021
         BH    4(0,LINKREG)                                             07300021
         C     YREG,ZERO                                                07320021
         BL    4(0,LINKREG)                                             07340021
         CH    XREG,X1                                                  07360021
         BL    0(0,LINKREG)                                             07380021
         CH    XREG,X2                                                  07400021
         BH    0(0,LINKREG)                                             07420021
         CH    YREG,Y1                                                  07440021
         BL    0(0,LINKREG)                                             07460021
         CH    YREG,Y2                                                  07480021
         BH    0(0,LINKREG)                                             07500021
         CLI   SGSW,X'F0'               SEE IF PREVIOUS POINT WAS OFF.  07520021
         BE    PT2ON                                                    07540021
         B     8(0,LINKREG)                                             07560021
OFFGRD   BAL   LINKREG,TSTGR            LINK TO TEST USER OPTION.       07580021
         B     LINKG                      IF OPTION = A OR C.           07600021
         TM    SGSW,X'F0'                                               07620021
         BO    PT2ON                                                    07640021
         B     CONT                       IF OPTION = B,E, OR INVALID.  07660021
TSTGR    CLI   OFFSG,C'A'               SET ERROR CODE AND LINK TO      07680021
         BNE   GRDC                     GOFFSG ROUTINE IF S/G OPTION    07700021
         BAL   LINREG,ER44              IS EQUAL TO A. SHOW ALL POINTS  07720021
         BR    LINKREG                  ON GRID AND CONTINUE PROCESSING 07740021
GRDC     CLI   OFFSG,C'C'               IF S/G OPTION IS EQ TO A OR C.  07760021
         BNE   GRDB                                                     07780021
         BR    LINKREG                                                  07800021
GRDB     CLI   OFFSG,C'B'               SHOW POINT IF S/G-OPTION=B      07820021
         BE    4(0,LINKREG)                                             07840021
GRDD     CLI   OFFSG,C'D'                                               07860021
         BNE   GRDE                                                     07880021
         LA    LINREG,RET               SET ERROR CODE AND RETURN TO    07900021
         B     ER28                     CALLING PROG IF S/G OPTION=D    07920021
GRDE     CLI   OFFSG,C'E'                                               07940021
         BE    4(0,LINKREG)                                             07960021
         LR    TEMREG,LINREG                                            07980021
         BAL   LINKREG,ER40             S/G OPTION INVALID.             08000021
         B     4(0,TEMREG)                                              08020021
OFFSCR   BAL   LINKREG,TSTSR            LINK TO TEST USER OPTION.       08040021
         B     LINKS                      IF OPTION = A OR B.           08060021
         B     LINKG                                                    08080021
TSTSR    CLI   OFFSG,C'A'                                               08100021
         BNE   SCRB                                                     08120021
         BAL   LINREG,ER44                                              08140021
         B     4(0,LINKREG)                                             08160021
SCRB     CLI   OFFSG,C'B'                                               08180021
         BNE   SCRC                                                     08200021
         BAL   LINREG,ER48                                              08220021
         BR    LINKREG                                                  08240021
SCRC     CLI   OFFSG,C'C'               SEE IF OPTION C                 08260021
         BNE   SCRD                                                     08280021
         LA    LINREG,RET                                               08300021
         B     ER32                                                     08320021
SCRD     CLI   OFFSG,C'D'                                               08340021
         BNE   SCRE                                                     08360021
         LA    LINREG,RET               SET ERROR CODE AND RETURN TO    08380021
         B     ER28                     CLLING PROG IF S/G OPTION=D     08400021
SCRE     LA    LINREG,RET                                               08420021
         B     ER32                     ERROR 32 ASSUMED.               08440021
LINKG    ST    XYLREG,SABL                                              08460021
         B     CHK1ST                                                   08480021
LINKS    LA    WRKREG,ZERO                                              08500021
         ST    WRKREG,SABL                                              08520021
         B     CHK1ST                                                   08540021
CONT     STH   XREG,GDV1                STORE X-COORDINATE IN GDV.      08560021
         STH   YREG,GDV1+2              STORE Y-COORDINATE IN GDV.      08580021
         CLC   PHI(2),ZERO                                              08600021
         BNE   PUTGDV                                                   08620021
         OI    GDV1,X'40'                                               08640021
PUTGDV   LA    CNTREG,4                 LENGTH OF GDV TO COUNT REG.     08660021
         LA    ADDREG,GDV1                                              08680021
SAVEXY   STM   XREG,YREG,VALUE1                                         08700021
         BAL   LINREG,STORE             LINK TO STORE GDV X,Y,U.        08720021
         LM    XREG,YREG,VALUE1                                         08740021
OMIT     CLC   PHI(2),H360              CHECK FOR END OF GENERATION     08760021
         BNL   TSTGRD                   FOR CURRENT CYCLE.              08780021
         LH    EVEREG,K                 IF MORE POINTS TO COMPUTE, SET  08800021
         A     EVEREG,ONE               K=K+1 AND RETURN TO COMPUTE     08820021
         STH   EVEREG,K                 THE NEXT X,Y VALUES.            08840021
         STM   XREG,YREG,PT1X                                           08860021
         B     SETPHI                                                   08880021
TSTGRD   MVI   SGSW,X'00'               RESET SCREEN GRID SWITCH        08900021
         CLI   TYPE,C'B'                                                08920021
         BNE   TESTI                    BRANCH IF LINEAR GRID.          08940021
         CLI   J,X'08'                                                  08960021
         BH    TESTI                                                    08980021
         SR    EVEREG,EVEREG                                            09000021
         IC    EVEREG,J                                                 09020021
         A     EVEREG,ONE               SET J=J+1                       09040021
         STC   EVEREG,J                                                 09060021
         LH    INDEXREG,LOGSAV          GET ADDRESS OF                  09080021
         A     INDEXREG,TWO             CURRENT LOG(J).                 09100021
         BAL   LINKREG,GETR                                             09120021
         B     TESTINC                                                  09140021
TESTI    SR    EVEREG,EVEREG                                            09160021
         L     EVEREG,I                 LOAD THE NO OF CIRCLES.         09180021
         A     EVEREG,ONE               SET I=I+1      I=# OF CIRCLES,  09200021
         ST    EVEREG,I                                OR LOG CYCLES.   09220021
         SRDA  EVEREG,32                                                09240021
         M     EVEREG,RINK              MULTIPLY I BY RINC.             09260021
         CL    ODDREG,MAXR              IF MAX-RADIUS IS LT I*RINC      09280021
         BH    TESTNR                   BR TO TEST THE NO OF RADII.     09300021
         ST    ODDREG,R                 NEW LOG CYCLE.                  09320021
         CLI   TYPE,C'B'                                                09340021
         BE    SETJ                                                     09360021
         B     TESTINC                                                  09380021
SETJ     MVI   J,X'01'                  SET J=1 AND                     09400021
         MVC   LOGSAV(2),MINUS2         RETURN TO GEN                   09420021
         B     TESTINC                  NEXT LOG CYCLE.                 09440021
CHK1ST   CLC   PHI(2),ZERO              IF FIRST POINT FOR CURRENT      09460021
         BNE   SETUP                    CIRCLE EXCEEDS BOUNDRY, SET ON  09480021
         MVI   SGSW,X'F0'               PT1 PART OF SGSW,               09500021
         B     OMIT                     AND BRANCH TO OMIT POINT.       09520021
SETUP    OI    SGSW,X'0F'                   SET ON PT2 PART OF SGSW,    09540021
PT2ON    STM   XREG,YREG,PT2X           STORE COORDINATES IN PT2X,PT2Y. 09560021
         STM   14,1,SAVE                STORE VITAL REGISTERS.          09580021
         ST    13,OVFSAVE+4                                             09600021
         ST    15,SVR15                 SAVE ERROR REGISTER             09620021
         LA    13,OVFSAVE               SET UP SAVE AREA FOR GOFFSG.    09640021
         LR    WRKREG,WKAREG            SAVE WORK AREA ADDRESS,         09660021
         CLI   LOADSW,X'FF'             IF LOADSW IS ON, BR TO GET ADDR 09680021
         BE    GETIT                    OF GOFFSG. IF LOADSW IS OFF,    09700021
         LA    1,SABL                   POINT TO PARAMETER TABLE AND,   09720021
         LOAD EP=GOFFSG                 GET ADDR OF OFF SCREEN/GR1D RTN 09740021
         LR    WKAREG,WRKREG                                            09760021
         ST    0,LOADSW                 STORE ADDR OF GOFFSG ROUTINE.   09780021
         OI    LOADSW,X'FF'             SET LOAD SWITCH ON.             09800021
GETIT    L     15,LOADSW                LOAD ADDR OF GOFFSG ROUTINE.    09820021
         LA    1,SABL                                                   09840021
         BALR  14,15                    BRANCH & LINK TO GOFFSG.        09860021
RESET    LR    WKAREG,WRKREG                                            09880021
         LM    14,0,SAVE                                                09900021
         L     13,OVFSAVE+4             RESTORE SAVE AREA ADDRESS.      09920021
         L     15,SVR15                 RESTORE ERROR REGISTER          09940021
CHKNI    CLI   SGSW,B'10101010'         IF SIGN SET TO 10101010, GO TO  09960021
         BE    8(0,LINKREG)             PROCESS RADIAL VECTORS.         09980021
         CLI   NI+3,X'02'               IF NI=2, BR TO GENERATE ORDERS  10000021
         BE    PUT2I                    FOR LINE FROM INTS1 TO INTS2.   10020021
         TM    SGSW,X'F0'               SEE IF PREVIOUS POINT WAS OUT   10040021
         BO    SGSWFF                   OF BOUNDRY LIMITS.              10060021
         CLI   NI+3,X'00'               IF NOT, CHECK # OF INTERSECT    10080021
         BE    GOBACK                   POINTS. IF NONE, BR TO GOBACK.  10100021
         MVC   GDV1(4),INTS1X           GDV1 = GDV INTS1X,INTS1Y,U      10120021
         LA    CNTREG,4                                                 10140021
SGSTORE  LA    ADDREG,GDV1                                              10160021
         MVI   SGSW,X'F0'               SET SGSW TO INDICATE PREVIOUS   10180021
         B     SAVEXY                   POINT EXCEEDED BOUNTRY.         10200021
PUT2I    MVC   GDV1(8),INTS1X           GDV1 = GDV INTS1X,INTS1Y,B      10220021
         OI    GDV1,X'40'               GDV2 = GDV INTS2X,INTS2Y,U      10240021
         LA    CNTREG,8                                                 10260021
         B     SGSTORE                                                  10280021
SGSWFF   TM    SGSW,X'FF'               SEE IF BOTH POINTS OFF          10300021
         BM    SGSWF0                                                   10320021
         CLI   NI+3,X'00'               IF NO INTERSECT                 10340021
         BE    GOBACK                                                   10360021
         MVC   GDV1(4),INTS1X           GDV1 = INTS1X,UNTS1Y,B          10380021
         MVC   GDV2(4),INTS1X           GDV2 = INTS1X,UNTS1Y,U          10400021
         LA    CNTREG,8                                                 10420021
         B     SGSTORE                                                  10440021
GOBACK   MVI   SGSW,X'F0'                                               10460021
         B     OMIT                                                     10480021
SGSWF0   CLI   NI+3,X'00'               IF NO INTERSECT POINTS,         10500021
         BE    PUTPOINT                 GO TO PUT POINT AT PT2.         10520021
         MVC   GDV1(4),INTS1X           GDV1 = INTS1X,INTS1Y,B          10540021
         STH   XREG,GDV2                GDV2 = X,Y,U                    10560021
         STH   YREG,GDV2+2                                              10580021
         B     PUT1I                                                    10600021
PUTPOINT STH   XREG,GDV1                GDV1 = X,Y,B                    10620021
         STH   YREG,GDV1+2                                              10640021
         MVC   GDV2(4),GDV1             GDV2 = X,Y,U                    10660021
PUT1I    OI    GDV1,X'40'                                               10680021
         LA    CNTREG,8                                                 10700021
         LA    ADDREG,GDV1                                              10720021
SETSWSG  MVI   SGSW,X'00'                                               10740021
         B     SAVEXY                                                   10760021
         EJECT                                                          10780021
TESTNR   CLC   NR(2),ZERO               IF NO RADII REQUESTED,          10800021
         BE    RET                      RETURN TO USER ROUTINE.         10820021
         MVI   SGSW,B'10101010'         SET SGSW TO INDICATE RADII.     10840021
***********************************                                     10860021
*   COMPUTE END POINTS OF RADII   *                                     10880021
***********************************                                     10900021
         SR    WRKREG,WRKREG                                            10920021
         LH    WRKREG,NR                                                10940021
         LA    EVEREG,360                                               10960021
         SRDA  EVEREG,32                                                10980021
         DR    EVEREG,WRKREG            COMPUTE PHI = 360/NR            11000021
         C     EVEREG,ZERO              IF 360/NR = INTEGER,            11020021
         BE    GETANGLE                 BR TO GET SINE/COSINE.          11040021
         LA    ERREG,40                 IF NOT, ERROR.                  11060021
         BAL   LINREG,ERRCNT            NO RADII GENERATED.             11080021
         B     RET                                                      11100021
GETANGLE STH   ODDREG,PHI                                               11120021
         MVC   NPT(2),PHI                                               11140021
         MVC   R(4),MAXR                                                11160021
         MVC   PT1X(8),XC                                               11180021
         LM    XREG,YREG,XC                                             11200021
         BAL   LINKREG,CHKOFF                                           11220021
         B     XCOFFG                                                   11240021
         B     XCOFFG                                                   11260021
         MVI   BNDRSW,X'00'                                             11280021
         B     LINKR                                                    11300021
XCOFFG   MVI   BNDRSW,X'F0'                                             11320021
LINKR    BAL   LINREG,GETQUAD                                           11340021
         BAL   LINKREG,CHKOFF                                           11360021
         B     GRDOFF                                                   11380021
         B     SCROFF                                                   11400021
         OI    BNDRSW,X'0F'                                             11420021
         TM    BNDRSW,X'F0'                                             11440021
         BO    GRDOFF                                                   11460021
ONSCR    MVC   GDV1(2),XC+2                                             11480021
         MVC   GDV1+2(2),YC+2                                           11500021
         STH   XREG,GDV2                                                11520021
         STH   YREG,GDV2+2                                              11540021
         B     PUTRADII                                                 11560021
GRDOFF   BAL   LINKREG,TSTGR                                            11580021
         B     LINKGR                                                   11600021
         B     ONSCR                                                    11620021
         B     TESTNI                                                   11640021
SCROFF   BAL   LINKREG,TSTSR                                            11660021
         B     LINKSR                                                   11680021
         B     LINKGR                                                   11700021
         B     TESTNI                                                   11720021
TESTNI   CLI   NI+3,X'02'                                               11740021
         BE    GEN2                                                     11760021
         CLI   NI+3,X'01'                                               11780021
         BE    GEN1A                                                    11800021
         B     NOGEN                                                    11820021
GEN1A    TM    BNDRSW,X'F0'                                             11840021
         BO    GEN1B                                                    11860021
         MVC   GDV2(4),INTS1X                                           11880021
         MVC   GDV1(2),XC+2                                             11900021
         MVC   GDV1+2(2),YC+2                                           11920021
         B     PUTRADII                                                 11940021
GEN1B    MVC   GDV1(4),INTS1X                                           11960021
         TM    BNDRSW,X'0F'                                             11980021
         BO    PUTP2                                                    12000021
         TM    BNDRSW,X'03'                                             12020021
         BO    PUTXCYC                                                  12040021
         MVC   GDV2(4),INTS1X                                           12060021
         B     PUTRADII                                                 12080021
PUTP2    STH   XREG,GDV2                                                12100021
         STH   YREG,GDV2+2                                              12120021
         B     PUTRADII                                                 12140021
PUTXCYC  MVC   GDV2(2),XC+2                                             12160021
         MVC   GDV2+2(2),YC+2                                           12180021
         B     PUTRADII                                                 12200021
GEN2     MVC   GDV1(4),INTS1X                                           12220021
         MVC   GDV2(4),INTS2X                                           12240021
         B     PUTRADII                                                 12260021
LINKGR   ST    XYLREG,SABL                                              12280021
         B     PT2ON                                                    12300021
LINKSR   OI    BNDRSW,X'03'                                             12320021
         LA    WRKREG,ZERO                                              12340021
         ST    WRKREG,SABL                                              12360021
         B     PT2ON                                                    12380021
PUTRADII OI    GDV1,X'40'                                               12400021
         LA    CNTREG,8                 STORE GDV ORDERS IN GDOA.       12420021
         LA    ADDREG,GDV1                                              12440021
         BAL   LINREG,STORE                                             12460021
NOGEN    CLC   PHI(2),H360                                              12480021
         BE    RET                                                      12500021
         NI    BNDRSW,X'F0'                                             12520021
         LH    ODDREG,NPT                                               12540021
         AH    ODDREG,PHI                                               12560021
         STH   ODDREG,PHI                                               12580021
         B     LINKR                                                    12600021
         EJECT                                                          12620021
*********************************************                           12640021
*        XYLCHK     SUBROUTINE              *                           12660021
*        ADDRESS OF XYLIM TABLE IN XYLREG   *                           12680021
*********************************************                           12700021
XYLCHK   LA    CNTREG,4                 SET  LOOP  COUNT                12720021
         LA    INXREG,0                 SET  INDEX                      12740021
XYLLOOP  LH    WRKREG,0(XYLREG,INXREG)  LOAD  X1,Y1,X2,Y2               12760021
         C     WRKREG,ZERO                                              12780021
         BL    XYLERR                                                   12800021
         C     WRKREG,HIGH                                              12820021
         BH    XYLERR                                                   12840021
         A     INXREG,TWO                                               12860021
         BCT   CNTREG,XYLLOOP                                           12880021
         CLC   0(2,XYLREG),4(XYLREG)    X1 COMP  X2                     12900021
         BNL   XYLERR                                                   12920021
         CLC   2(2,XYLREG),6(XYLREG)    Y1 COMP  Y2                     12940021
         BNL   XYLERR                                                   12960021
         BR    LINREG                                                   12980021
XYLERR   LA    15,4                     SET ERROR CODE = 4              13000021
         BAL   LINREG,ERRCNT                                            13020021
         B     RET                                                      13040021
ER8      LA    ERREG,8                  UC,VC PARAMETER ERROR,          13060021
         BAL   LINREG,ERRCNT            IMMEDIATE RETURN.               13080021
         B     RET                                                      13100021
ER12   LA    ERREG,12                                                   13120021
       BAL   LINKREG,ERRCNT                                             13140021
       B     RET                                                        13160021
ER16     BAL   LINREG,ERRCNT                                            13180021
         LA    ERREG,16                                                 13200021
         B     RET                                                      13220021
ER20     LA    ERREG,20                 INPUT PARAMETER ERROR,          13240021
         BAL   LINREG,ERRCNT            IMMEDIATE RETURN.               13260021
         B     RET                                                      13280021
ER28     LA    ERREG,28                 S/G OPTION = D.                 13300021
         B     ERRCNT                                                   13320021
ER32     LA    ERREG,32                 S/G OPTION = C OR E.            13340021
         B     ERRCNT                                                   13360021
ER40     LA    ERREG,40                 INPUT PARAMETER ERROR,          13380021
         BAL   LINREG,ERRCNT            COUNT ERRORS AND CONTINUE.      13400021
         BR    LINKREG                                                  13420021
ER44     LA    ERREG,44                 S/G OPTION = A.                 13440021
         B     ERRCNT                                                   13460021
ER48     LA    ERREG,48                 S/G OPTION = B.                 13480021
ERRCNT   L     TEMREG,ERCOUNT                                           13500021
         A     TEMREG,ONE                                               13520021
         ST    TEMREG,ERCOUNT                                           13540021
         BR    LINREG                                                   13560021
RET      LA    TEMREG,1                                                 13580021
         C     TEMREG,ERCOUNT                                           13600021
         BL    SETBIT                                                   13620021
RETURN   CLI   LOADSW,X'00'                                             13640021
         BE    RETMACRO                                                 13660021
         ST    15,SVR15                 SAVE ERROR REGISTER             13680021
         LR    WRKREG,1                 SAVE REGISTER 1                 13700021
         DELETE EP=GOFFSG                                               13720021
         LR    1,WRKREG                 RESTORE REGISTER 1              13740021
         L     15,SVR15                 RESTORE ERROR REGISTER          13760021
* RESTORE PROGRAM MASK TO SETTING UPON ENTRY                            13780021
RETMACRO L     WRKREG,MASKSV                                            13800021
         SPM   WRKREG                                                   13820021
         RETURN (14,12),T,RC=(15)                                       13840021
SETBIT   O     15,MZERO                                                 13860021
         B     RETURN                                                   13880021
         EJECT                                                          13900021
SCALFLT  LA    CONREG,4                 LOOP  COUNT                     13920021
         LA    INXREG,0                 SET INDEX                       13940021
         LA    WRKREG,0                                                 13960021
FLTLOOP  LH    VALREG,0(XYLREG,INXREG)  GET X1Y1,X2Y2 VALUES            13980021
         BAL   LINREG,FLTCONV                                           14000021
         ST    VALREG,4(WKAREG,WRKREG)                                  14020021
         A     INXREG,TWO                                               14040021
         A     WRKREG,FOUR                                              14060021
         BCT   CONREG,FLTLOOP                                           14080021
***********************************                                     14100021
*   SUBROUTINE TO SCALE FLOATING  *                                     14120021
*   POINT COORDINATES UC,VC.      *                                     14140021
***********************************                                     14160021
         LE    0,UC                                                     14180021
         SE    0,U1                     UC-U1                           14200021
         LE    2,12(WKAREG)             LOAD CONVERTED X2.              14220021
         SE    2,4(WKAREG)              X2-X1                           14240021
         MER   0,2                      (UC-U1)*(X2-X1)                 14260021
         LE    2,U2                                                     14280021
         SE    2,U1                     U2-U1                           14300021
         BC    13,ER16                  BRANCH ON OVF, MINUS OR ZERO    14320021
         DER   0,2                      ((UC-U1)*(X2-X1))/(U2-U1)       14340021
         AE    0,4(WKAREG)              ADD X1 TO COMPLETE FUNCTION.    14360021
         STE   0,0(WKAREG)                                              14380021
         L     VALREG,0(WKAREG)                                         14400021
         BAL   LINREG,FIXCONV                                           14420021
         ST    VALREG,XC                                                14440021
         LE    0,VC                                                     14460021
         SE    0,V1                                                     14480021
         LE    2,16(WKAREG)                                             14500021
         SE    2,8(WKAREG)                                              14520021
         MER   0,2                                                      14540021
         LE    2,V2                                                     14560021
         SE    2,V1                     V2-V1                           14580021
         BC    13,ER16                  BRANCH ON OVF, MINUS OR ZERO    14600021
         DER   0,2                      ((VC-V1)*(Y2-Y1)/(V2-V1)        14620021
         AE    0,8(WKAREG)              ADD Y1 TO COMPLETE FUNCTION     14640021
         STE   0,0(WKAREG)                                              14660021
         L     VALREG,0(WKAREG)                                         14680021
         BAL   LINREG,FIXCONV                                           14700021
         ST    VALREG,YC                                                14720021
         BR    LINKREG                                                  14740021
**************************************************                      14760021
*   SUBROUTINE TO SCALE FLOATING POINT VALUES    *                      14780021
*   SVAL=XINC*((X2-X1)/(U2-U1))  XINC=RINC OR MRU*                      14800021
*   SVAL REPRESENTS RINC OR MRU SCALED           *                      14820021
**************************************************                      14840021
FLTSCAL  LE    0,12(WKAREG)             X2                              14860021
         SE    0,4(WKAREG)              -X1                             14880021
         ME    0,VALUE1                 *UI                             14900021
         LE    2,12(XYLREG)             U2                              14920021
         SE    2,8(XYLREG)              -U1                             14940021
         DER   0,2                                                      14960021
         STE   0,0(WKAREG)                                              14980021
         L     XREG,0(WKAREG)           XREG CONTAINS SCALED FP UI      15000021
         L     VALREG,0(WKAREG)                                         15020021
         BAL   LINREG,FIXCONV           BR AND LINK TO CONVERT RTN.     15040021
         LR    XREG,VALREG              LOAD XREG WITH SCALED INC       15060021
         BR    LINKREG                  AND RETURN TO MAINLINE.         15080021
         EJECT                                                          15100021
*********************************************                           15120021
*   CONVERT FLOATING POINT TO FIXED POINT   *                           15140021
*   VALREG = VALUE TO BE CONVERTED          *                           15160021
*********************************************                           15180021
FIXCONV  ST    1,OVFSAVE                STORE REG 1 IN WORK AREA        15200021
         TM    OVFSAVE+3,X'07'          TEST LAST THREE BITS            15220021
         BZ    *+12                     NO BITS ON, SET INDEX TO ZERO   15240021
         LA    TEMREG,4                 SET MODIFIER                    15260021
         B     *+8                      START CONVERSION                15280021
         LA    TEMREG,0                 SET MODIFIER TO ZERO            15300021
         ST    VALREG,TEMFLT(TEMREG)    SAVE FLOAT VALUE                15320021
         SR    WRKREG,WRKREG                                            15340021
         ST    WRKREG,TEMFLT+4(TEMREG)  CLEAR SECOND WORD               15360021
         LD    6,TEMFLT(TEMREG)         VALUE TO FLOAT REGISTERS        15380021
         N     VALREG,FCHAR                                             15400021
         BE    FLERR1                   CHARACTERISTIC IS ZERO          15420021
         AE    6,FLPT5                  ADD .5 TO ROUND                 15440021
         AW    6,X4E                    ADD UNNORMALIZED-RIGHT JUSTIFY  15460021
         STD   6,TEMFLT(TEMREG)         SAVE VALUES                     15480021
         L     WRKREG,TEMFLT+4(TEMREG)  CHECK SECOND WORD               15500021
         N     WRKREG,MZERO             CHECK BIT 32                    15520021
         BM    ER12                     BRANCH ON MINUS                 15540021
         L     WRKREG,TEMFLT(TEMREG)                                    15560021
         N     WRKREG,BYTE123                                           15580021
         BM    ER12                     BRANCH ON MINUS                 15600021
         L     WRKREG,TEMFLT(TEMREG)                                    15620021
         N     WRKREG,MZERO             DROP CHARACTERISTIC             15640021
         L     VALREG,TEMFLT+4(TEMREG)  NEW FIXED VALUE                 15660021
         LTR   WRKREG,WRKREG                                            15680021
         BNL   NOTNEG                   NOT NEGATIVE                    15700021
         LNR   VALREG,VALREG            TAKE TWO'S COMPLEMENT           15720021
NOTNEG   BR    LINREG                   RETURN TO MAINLINE.             15740021
FLERR1   CE    6,ZERO                   IS TOTAL VALUE ZERO             15760021
         BE    NOTNEG                   RETURN                          15780021
         B     ER12                     ERROR 12                        15800021
**************************************************                      15820021
*    CONVERT  FIXED  POINT  TO  FLOATING  POINT  *                      15840021
*    VALREG CONTAINS THE VALUE TO BE CONVERTED   *                      15860021
**************************************************                      15880021
FLTCONV  O     VALREG,X6                EXPONENT OF 6                   15900021
         ST    VALREG,0(WKAREG)                                         15920021
         LE    0,0(WKAREG)              LOAD FLOATING PT REG            15940021
         AE    0,X6                     NORMALIZE                       15960021
         STE   0,0(WKAREG)                                              15980021
         L     VALREG,0(WKAREG)         FLOAT PT VAL IN VALREG          16000021
         BR    LINREG                                                   16020021
         EJECT                                                          16040021
**********************************                                      16060021
*   SUBROUTINE TO SCALE FIXED     *                                     16080021
*   FIXED POINT COORDINATES UC,VC *                                     16100021
***********************************                                     16120021
SCALFIX  S     XREG,U1                  COMPUTE UC-U1                   16140021
         LR    ODDREG,XREG              LOAD MULTIPLICAND               16160021
         LH    XREG,X2                                                  16180021
         SH    XREG,X1                  COMPUTE X2-X1                   16200021
         SR    EVEREG,EVEREG                 AND                        16220021
         MR    EVEREG,XREG              (UC-U1)*(X2-X1)                 16240021
         L     XREG,U2                                                  16260021
         S     XREG,U1                  COMPUTE U2-U1                   16280021
         BC    13,ER16                  BRANCH ON OVF, MINUS OR ZERO    16300021
         DR    EVEREG,XREG              COMPUTE ((UC-U1)<(X2-X1))/U2-U1 16320021
         AH    ODDREG,X1                COMPLETE FUNCTION BY ADDING X1. 16340021
         LR    XREG,ODDREG              RETURN SCALED VALUE IN XREG.    16360021
         S     YREG,V1                  COMPUTE VC-V1                   16380021
         LR    ODDREG,YREG                                              16400021
         LH    YREG,Y2                                                  16420021
         SH    YREG,Y1                  COMPUTE Y2-Y1                   16440021
         MR    EVEREG,YREG              (VC-V1)*(Y2-Y1)                 16460021
         L     YREG,V2                                                  16480021
         S     YREG,V1                  COMPUTE V2-V1                   16500021
         BC    13,ER16                  BRANCH ON OVF, MINUS OR ZERO    16520021
         SR    EVEREG,EVEREG                                            16540021
         DR    EVEREG,YREG              COMPUTE ((VC-V1)*(Y2-Y1))/U2-V1 16560021
         AH    ODDREG,Y1                COMPLETE FUNCTION BY ADDING Y1. 16580021
         LR    YREG,ODDREG              RETURN SCALED VALUE IN YREG.    16600021
         BR    LINREG                   RETURN TO MAINLINE              16620021
**************************************************                      16640021
*   SUBROUTINE TO SCALE   FIXED  POINT  VALUES   *                      16660021
*   SVAL=XINC*((X2-X1)/(U2-U1))  XINC=RINC OR MRU*                      16680021
*   SVAL REPRESENTS RINC OR MRU SCALED           *                      16700021
**************************************************                      16720021
FIXSCAL  LH    ODDREG,4(XYLREG)         X2                              16740021
         SH    ODDREG,0(XYLREG)         -X1                             16760021
         SR    EVEREG,EVEREG            ZERO EVEN REG                   16780021
         MR    EVEREG,XREG              * UI                            16800021
         L     XREG,12(XYLREG)          U2                              16820021
         S     XREG,8(XYLREG)           -U1                             16840021
         BC    13,ER16                  BRANCH ON OVF, MINUS OR ZERO    16860021
         SR    EVEREG,EVEREG            ZERO EVEN REG                   16880021
         DR    EVEREG,XREG                                              16900021
         LR    XREG,ODDREG              SCALED U VALUE IN XREG          16920021
         BR    LINREG                                                   16940021
         EJECT                                                          16960021
*********************************************                           16980021
* STORE GRAPHIC DATA IN GDOA FOR POR        *                           17000021
* INPUT TO SUBROUTINE                       *                           17020021
*   CNTREG = NUMBER OF BYTES TO BE STORED   *                           17040021
*   ADDREG = ADDRESS OF THE GRAPHIC DATA    *                           17060021
*   WKAREG = WORK AREA ADDRESS              *                           17080021
*   OABREG = ADDRESS OF OACB                *                           17100021
*********************************************                           17120021
STORE    SR    PASREG,PASREG            CLEAR OVERFLOW PASS INDICATOR   17140021
STORE1   L     OLPREG,16(0,OABREG)      ADDRESS OF OLP FROM OACB        17160021
         LR    WRKREG,CNTREG            LOAD BYTES TO MOVE              17180021
* CALCULATE ADDRESSES BASED ON N VALUE AND SIZE OF GDOA                 17200021
STORE2   AR    OLPREG,WRKREG            OLP ADDRESS PLUS N VALUE        17220021
         LA    TEMREG,4                                                 17240021
         AR    TEMREG,OLPREG            OLP PLUS N PLUS 4               17260021
         L     SLOREG,0(OABREG)         SLOA ADDRESS                    17280021
         A     SLOREG,4(OABREG)         ADD LOA EQUALS TOTAL GDOA       17300021
         CR    TEMREG,SLOREG                                            17320021
         L     OLPREG,16(0,OABREG)      RESET INITIAL OLP ADDRESS       17340021
         BNH   OK                                                       17360021
* NOT ENOUGH ROOM TO STORE ALL OF THE DATA-DETERMINE AMOUNT TO STORE    17380021
         SR    TEMREG,SLOREG            EQUAL BYTES-CAN'T STORE         17400021
         SR    WRKREG,TEMREG            NUMBER OF BYTES CAN STORE       17420021
* ANY BYTES TO STORE                                                    17440021
         C     WRKREG,ZERO                                              17460021
         BNH   STORE4                   LESS OF EQUAL TO ZERO           17480021
         LH    TEMREG,H2A02                                             17500021
         CH    TEMREG,GOMODE                                            17520021
         BH    STORE3A                                                  17540021
         LH    TEMREG,H0003                                             17560021
         NR    TEMREG,WRKREG                                            17580021
         BM    STORE4      GO TO USER OVERFLOW ROUTINE (JAPV)      7468 17600021
STORE3A  SR    CNTREG,WRKREG       BYTES REMAINING                      17620021
         BAL   INTLNK,STORE6            LINK INTERNALLY                 17640021
STORE3   LA    PASREG,1                 SET PASS INDICATOR              17660021
* STORE REGISTERS IN WORKAREA                                           17680021
         STM   0,15,0(WKAREG)           SAVE REGISTERS IN WORKAREA      17700021
         CLI   LOADSW,X'FF'                                             17720021
         BNE   LOADREG                                                  17740021
         LR    3,1                      SAVE REG 1.                     17760021
         DELETE EP=GOFFSG                                               17780021
         LR    1,3                      RESTORE REG 1.                  17800021
LOADREG  L     15,8(0,OABREG)       OVERFLOW ADDRESS                    17820021
         LM    2,12,28(13)           RELOAD USERS REG                   17840021
         BALR  14,15                    LINK TO ROUTINE-SET RETURN      17860021
         MVI   LOADSW,X'00'                                             17880021
         LM    0,15,0(WKAREG)           RELOAD FROM WORKAREA            17900021
         B     STORE1                   GET NEW OLP ADDRESS-CONTINUE    17920021
* NO SPACE AVAILABLE                                                    17940021
STORE4   C     PASREG,ONE               WAS A TRANSFER TO OVERFLOW MADE 17960021
         BL    STORE3                                                   17980021
*                                                                       18000021
* SET ERROR CODE AND RETURN TO POR-LEAVE POR WITH RETURN MACRO          18020021
         LA    15,28                    SET ERROR CODE REG.             18040021
         B     RET                      SYMBOLIC IN POR                 18060021
OK       BAL   INTLNK,STORE6            LINK INTERNALLY                 18080021
         BR    LINREG                                                   18100021
STORE6   LA    TEMREG,255               SET REG. EQUAL TO 255           18120021
STORE6A  CR    WRKREG,TEMREG            IS AMOUNT TO MOVE OVER 255      18140021
         BH    STORE7                                                   18160021
         LR    TEMREG,WRKREG                                            18180021
         S     TEMREG,ONE               COMPENSATE FOR EXTRA BYTE       18200021
         EX    TEMREG,MOVE              MOVE GRAPHIC DATA               18220021
         AR    OLPREG,WRKREG            UPDATE OLP ADDRESS              18240021
         AR    ADDREG,WRKREG            UPDATE DATA ADDR                18260021
         ST    OLPREG,16(0,OABREG)      STORE NEW OLP ADDRESS           18280021
         BR    INTLNK                   RETURN INTERNALLY               18300021
STORE7   LR    SLOREG,TEMREG                                            18320021
         S     SLOREG,ONE               COMPENSATE FOR EXTRA BYTE       18340021
         EX    SLOREG,MOVE              MOVE GRAPHIC DATA               18360021
         AR    OLPREG,TEMREG            UPDATE OLP ADDRESS              18380021
         AR    ADDREG,TEMREG            UPDATE INPUT ADDRESS            18400021
         SR    WRKREG,TEMREG           REDUCE BY 255                    18420021
         B     STORE6A                  MAKE NEXT COMPARISON            18440021
MOVE     MVC   0(0,OLPREG),0(ADDREG)    MOVE DATA TO GDOA               18460021
         CNOP  0,4                                                      18480021
         EJECT                                                          18500021
******************************                                          18520021
*   CONSTANTS USED BY GPGRID *                                          18540021
******************************                                          18560021
         DS    0D                                                       18580021
X4E      DC    X'4E00000000000000'                                      18600021
ZERO     DC    F'0'                                                     18620021
H4095    DC    H'4095,4095'                                             18640021
ONE      DC    F'1'                                                     18660021
TWO      DC    F'2'                                                     18680021
FOUR     DC    F'4'                                                     18700021
FLPT5    DC    E'.5'                                                    18720021
C360     DC    F'360'                                                   18740021
C1365    DC    F'1365'                                                  18760021
C4095    DC    F'4095'                                                  18780021
C5793    DC    F'5793'                                                  18800021
TWOPI    DC    FS28'6.2832'                                             18820021
HIGH     DC    F'4095'                                                  18840021
BYTE123  DC    X'00FFFFFF'                                              18860021
FCHAR    DC    X'7F000000'                                              18880021
X6       DC    X'46000000'                   EXPONENT OF SIX            18900021
MZERO    DC    X'80000000'                                              18920021
POINT5   DC    HS14'.5'                                                 18940021
H2A02    DC    X'2A02'                                                  18960021
H0003    DC    H'0003'                                                  18980021
MINUS1   DC    H'-1'                                                    19000021
MINUS2   DC    H'-2'                                                    19020021
C45      DC    H'45'                                                    19040021
C46      DC    H'46'                                                    19060021
C90      DC    H'90'                                                    19080021
C136     DC    H'136'                                                   19100021
C180     DC    H'180'                                                   19120021
C226     DC    H'226'                                                   19140021
C270     DC    H'270'                                                   19160021
C315     DC    H'315'                                                   19180021
H360     DC    H'360'                                                   19200021
GEVM     DC    X'2A02'                                                  19220021
LOGJ     DC    HS14'.3010,.4771,.6021,.6990,.7782,.8451,.9031,.9542'    19240021
*   LOGJ TABLE=LOG VALUES FOR THE CYCLES OF LOG GRID. WHEN J=2,3,4,...9 19260021
LOGTBL   EQU   LOGJ                                                     19280021
         EJECT                                                          19300021
******************************                                          19320021
*    SINE/COSINE TABLE       *                                          19340021
******************************                                          19360021
SCTBL    DC    HS14'0.0000,1.0000,0.0175,0.9999'             0- 1       19380021
         DC    HS14'0.0349,0.9994,0.0523,0.9986'             2- 3       19400021
         DC    HS14'0.0698,0.9976,0.0872,0.9962'             4- 5       19420021
         DC    HS14'0.1045,0.9945,0.1219,0.9926'             6- 7       19440021
         DC    HS14'0.1392,0.9903,0.1564,0.9877'             8- 9       19460021
         DC    HS14'0.1737,0.9848,0.1908,0.9816'            10-11       19480021
         DC    HS14'0.2079,0.9782,0.2250,0.9744'            12-13       19500021
         DC    HS14'0.2419,0.9703,0.2588,0.9659'            14-15       19520021
         DC    HS14'0.2756,0.9613,0.2924,0.9563'            16-17       19540021
         DC    HS14'0.3090,0.9511,0.3256,0.9455'            18-19       19560021
         DC    HS14'0.3420,0.9397,0.3584,0.9336'            20-21       19580021
         DC    HS14'0.3746,0.9272,0.3907,0.9205'            22-23       19600021
         DC    HS14'0.4067,0.9136,0.4226,0.9063'            24-25       19620021
         DC    HS14'0.4384,0.8988,0.4540,0.8910'            26-27       19640021
         DC    HS14'0.4695,0.8830,0.4848,0.8746'            28-29       19660021
         DC    HS14'0.5000,0.8660,0.5150,0.8572'            30-31       19680021
         DC    HS14'0.5299,0.8481,0.5446,0.8387'            32-33       19700021
         DC    HS14'0.5592,0.8290,0.5736,0.8192'            34-35       19720021
         DC    HS14'0.5878,0.8090,0.6018,0.7986'            36-37       19740021
         DC    HS14'0.6157,0.7880,0.6293,0.7772'            38-39       19760021
         DC    HS14'0.6428,0.7660,0.6561,0.7547'            40-41       19780021
         DC    HS14'0.6691,0.7431,0.6820,0.7314'            42-43       19800021
         DC    HS14'0.6947,0.7193,0.7071,0.7071'            44-45       19820021
SINE     EQU   SCTBL                                                    19840021
COSINE   EQU   SCTBL+2                                                  19860021
         EJECT                                                          19880021
******************************                                          19900021
*   PARAMETER TABLE FORMAT   *                                          19920021
******************************                                          19940021
PARTAB   DSECT                                                          19960021
XYLIM    DS    CL4                      ADDR OF XY LIMIT TABLE.         19980021
UC       DS    CL4                      X-COORDINATE OF ARC CENTER.     20000021
VC       DS    CL4                      Y-COORDINATE OF ARC CENTER.     20020021
F        DS    CL1                      FIXED/FLOATING POINT INDICATOR. 20040021
S        DS    CL1                      SCALING INDICATOR.              20060021
INC      DS    CL1                      ALPHA/DENSITY INDICATOR.        20080021
OFFSG    DS    CL1                      OFF SCREEN/GRID OPTION IND.     20100021
RINC     DS    CL4                      INCREMENT IN RADIAL DIRECTION.  20120021
NR       DS    CL2                      # OF RADII                      20140021
DENSITY  DS    CL2                   ** DENSITY OF CONSECUTIVE POINTS.  20160021
ALPHA    EQU   DENSITY               ** DEGREE OF SUCCESIVE POINTS.     20180021
MAXRAD   DS    CL4                      MAXIMUM LENGTH OF RADIUS.       20200021
TYPE     DS    CL1                      GRID TYPE.                      20220021
         EJECT                                                          20240021
******************************                                          20260021
*   GPVGRD USE OF WORK AREA  *                                          20280021
******************************                                          20300021
WKAREA   DSECT                                                          20320021
OVFSAVE  DS    0CL72                                                    20340021
TEMFLT   DS    0CL8                                                     20360021
         DS    CL128                                                    20380021
SABL     DS    CL4                                                      20400021
PT1X     DS    CL4                                                      20420021
PT1Y     DS    CL4                                                      20440021
PT2X     DS    CL4                                                      20460021
PT2Y     DS    CL4                                                      20480021
NI       DS    CL4                                                      20500021
INTS1X   DS    CL2                                                      20520021
INTS1Y   DS    CL2                                                      20540021
INTS2X   DS    CL2                                                      20560021
INTS2Y   DS    CL2                                                      20580021
         DS    CL64                                                     20600021
SAVE     DS    CL16                                                     20620021
LOADSW   DS    CL4                                                      20640021
GDV1     DS    CL4                                                      20660021
GDV2     DS    CL4                                                      20680021
XC       DS    CL4                                                      20700021
YC       DS    CL4                                                      20720021
MAXR     DS    CL4                                                      20740021
R        DS    CL4                                                      20760021
RINK     DS    CL4                                                      20780021
VALUE1   DS    CL4                                                      20800021
VALUE2   DS    CL4                                                      20820021
I        DS    CL4                                                      20840021
SVR15    DS    CL4                      PLACE TO SAVE ERROR REGISTER    20860021
ERCOUNT  DS    CL4                                                      20880021
ALPH     DS    CL2                                                      20900021
NPT      DS    CL2                                                      20920021
PHI      DS    CL2                                                      20940021
K        DS    CL2                                                      20960021
LOGSAV   DS    CL2                                                      20980021
SGSW     DS    CL1                                                      21000021
FUNCSW   DS    CL1                                                      21020021
BNDRSW   DS    CL1                                                      21040021
INK      DS    CL1                                                      21060021
J        DS    CL1                                                      21080021
MASKSV   DS    F                   SAVE SETTING OF USER PROGRAM MASK    21100021
         ORG   OVFSAVE+396                                              21120021
GOMODE   DS    CL2                                                      21140021
XYLIMT   DSECT                                                          21160021
X1       DS    CL2                                                      21180021
Y1       DS    CL2                                                      21200021
X2       DS    CL2                                                      21220021
Y2       DS    CL2                                                      21240021
U1       DS    CL4                                                      21260021
U2       DS    CL4                                                      21280021
V1       DS    CL4                                                      21300021
V2       DS    CL4                                                      21320021
         END                                                            21340021
