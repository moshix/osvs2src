         START                                                          00060021
*TITLE IFFPKADG                                                       * 00120021
*                                                                     * 00180021
*STATUS: CHANGE LEVEL 000                                             * 00240021
*                                                                     * 00300021
*FUNCTION/OPERATION: GENERATES A SERIES OF GRAPHIC ORDERS FROM DATA   * 00360021
*   SUPPLIED BY THE USER. THE ORDERS MAY CONSIST OF ABSOLUTE OR       * 00420021
*   INCREMENTAL ORDERS OR AN OPTIMIZED MIXTURE OF THE TWO. THE DATA   * 00480021
*   FORMAT AND MODE IS SPECIFIED BY THE USER IN HIS PARAMETER TABLE.  * 00540021
*   THE DATA IS SCALED IF DESIRED USING THE ENTRIES IN THE XYSCALE    * 00600021
*   TABLE TO DERIVE APPROPRIATE SCALING FACTORS.                      * 00660021
*                                                                     * 00720021
*INPUT: A PARAMETER TABLE (PARTAB) AND AN OUTPUT CONTROL BLOCK POINTER* 00780021
*   (OCBP). THESE POINT TO AN XYSCALE TABLE AND TO THE OUTPUT AREA    * 00840021
*   CONTROL BLOCK (OCBP) AND AN HUNDRED-WORD WORKAREA RESPECTIVELY.   * 00900021
*                                                                     * 00960021
*OUTPUT: THE GRAPHIC ORDERS TO PLOT THE DATA AS SPECIFIED ARE PLACED  * 01020021
*   IN THE USER'S GDOA.                                               * 01080021
*                                                                     * 01140021
*EXTERNAL ROUTINES: GOFFSG                                            * 01200021
*                                                                     * 01260021
*EXITS-NORMAL: VIA RETURN MACRO WITH A ZERO RETURN CODE ON SUCESSFUL  * 01320021
*   COMPLETION.                                                       * 01380021
*              VIA A BALR 14,15 TO THE USER'S OVERFLOW ROUTINE        * 01440021
*                                                                     * 01500021
*EXITS-ERROR: VIA RETURN MACRO WITH A NON-ZERO RETURN CODE IN REGISTER* 01560021
*   15                                                                * 01620021
*                                                                     * 01680021
*TABLES/WORKAREA: AN HUNDRED-WORD USER SUPPLIED WORKAREA. TABLES OF   * 01740021
*   POSSIBLE PARAMETER VALUES AND THE CORRESPONDING SWITCH SETTINGS   * 01800021
*                                                                     * 01860021
*ATTRIBUTES: PROBLEM STATE, REENTRANT, CHARACTER DEPENDENT.           * 01920021
*                                                                       01980021
WORKAREA DSECT                                                          02040021
         DS    0F                      FORCE FULL WORD ALIGNMENT        02100021
*                                                                       02160021
X1       DS    H                       GRID LIMITS-LOWER LEFT CORNER    02220021
Y1       DS    H                       IN 4096 RASTER UNITS             02280021
X2       DS    H                       GRID LIMITS-UPPER RIGHT CORNER   02340021
Y2       DS    H                       IN 4096 RASTER UNITS             02400021
*                                                                       02460021
OVERFLAG DS    C                                                        02520021
PTSGSW   DS    C                       PLOT TYPE-SCISSORING OPTIONS     02580021
*              X'80'         1=OPTIMIZED PLOT/0=NOT OPTIMIZED           02640021
*              X'40'         1=FIRST POINT FOR CALL                     02700021
*              X'20'         1=INCREMENTAL PLOT/0=ABSOLUTE PLOT         02760021
*              X'10'         1=VECTOR PLOT/0=POINT PLOT                 02820021
*              X'08'         1=DISCONTINUE WHEN SCREEN EXCEEDED         02880021
*                            0=CONTINUE                                 02940021
*              X'04'         1=DISCONTINUE WHEN GRID EXCEEDED           03000021
*                            0=CONTINUE                                 03060021
*              X'02'         1=SHOW ALL POINTS WITHIN SCREEN LIMITS     03120021
*                            0=SHOW ALL POINTS WITHIN GRID LIMITS       03180021
UMODE    DS    C                       CHARACTERISTICS OF U'S           03240021
VMODE    DS    C                       CHARACTERISTICS OF V'S           03300021
*              X'10'         1=FLOATING-POINT/0=INTEGER                 03360021
*              X'20'         INPUT VALUES ABSOLUTE                      03420021
*              X'40'         INPUT VALUES A TABLE OF INCREMENTS         03480021
*              X'80'         INPUT VALUES BY ADDING A FIXED INCREMENT   03540021
XP       DS    H                       LAST PHYSICAL LOCATION           03600021
YP       DS    H                       OF BEAM                          03660021
X        DS    F                       LAST LOGICAL LOCATION            03720021
Y        DS    F                       OF BEAM                          03780021
U        DS    F                       LAST U-VALUE                     03840021
V        DS    F                       LAST V-VALUE                     03900021
UTAB     DS    F                       LAST ENTRY IN U-ARRAY USED       03960021
VTAB     DS    F                       LAST ENTRY IN V-ARRAY USED       04020021
*                                                                       04080021
GIX1     DS    H                       COORDINATES OF FIRST INTERSEC-   04140021
GIY1     DS    H                       TION WITH GRID LIMITS            04200021
GIX2     DS    H                       COORDINATES OF SECOND  INTER-    04260021
GIY2     DS    H                       SECTION WITH GRID LIMITS         04320021
PTPOS    DS    C                       RELATIVE POSITIONS OF END-POINTS 04380021
*                                                                       04440021
DEFLG    DS    C                       DEFAULT FLAG                     04500021
RETCD    DS    H                       RETURN CODE WORK AREA            04560021
PARTABAD DS    F                       ADDRESS OF PARTAB                04620021
OACBAD   DS    F                       ADDRESS OF OACB                  04680021
*                                                                       04740021
NXTX1    DS    F                       X AND Y COORDINATES              04800021
NXTY1    DS    F                       OF FIRST POINT-VECTOR            04860021
SUPLT1   DS    C                       SUPRESS PLOT SWITCH              04920021
PTCNT1   DS    C                       NO. OF POINTS TO PLOT            04980021
BV11     DS    C                       BLANKED BEAM SWITCHES            05040021
BV21     DS    C                                                        05100021
ADJX11   DS    H                       ADJUSED X                        05160021
ADJY11   DS    H                                 AND Y                  05220021
ADJX21   DS    H                                      COORDINATES       05280021
ADJY21   DS    H                       TO PLOT VECTOR                   05340021
NXTX2    DS    F                       X AND Y COORDINATES              05400021
NXTY2    DS    F                       OF SECOND POINT-VECTOR           05460021
SUPLT2   DS    C                       SUPRESS PLOT SWITCH              05520021
PTCNT2   DS    C                       NO. OF POINTS TO PLOT            05580021
BV12     DS    C                       BLANKED BEAM SWITCHES            05640021
BV22     DS    C                                                        05700021
ADJX12   DS    H                       ADJUSTED X                       05760021
ADJY12   DS    H                                  AND Y                 05820021
ADJX22   DS    H                                        COORDINATES     05880021
ADJY22   DS    H                       TO PLOT VECTOR                   05940021
*                                                                       06000021
NXTX3    DS    F                       X AND Y COORDINATES FOR          06060021
NXTY3    DS    F                       OPTIMIZATION CHECK VECTOR        06120021
SUPLT3   DS    C                       SUPRESS PLOT                     06180021
PTCNT3   DS    C                       NO. OF POINTS TO PLOT            06240021
BV13     DS    C                       BLANKED VECTOR SWITCHES          06300021
BV23     DS    C                                                        06360021
ADJX13   DS    H                       ADJUSTED X                       06420021
ADJY13   DS    H                                  AND Y                 06480021
ADJX23   DS    H                                        COORDINATES     06540021
ADJY23   DS    H                       OF VECTOR                        06600021
SVAR1    DS    18F                     SAVE AREA-SUB-LEVEL 1            06660021
SVAR2    DS    18F                     SAVE AREA-SUB-LEVEL 2            06720021
*                                                                       06780021
SMSW     DS    C                       SET MODE SWITCH                  06840021
INTS     DS    C                       NUMBER OF INTERSECTIONS          06900021
*                                      BETWEEN GRID/SCREEN AND VECTOR   06960021
ABSPTS   DS    H                       NO. OF ABSOLUTE PTS. IN WORKAREA 07020021
INCPTS   DS    H                       NO. OF INCREMENTAL PTS.          07080021
BTCNT    DS    H                       NO. OF BYTES REMAINING           07140021
*                                                                       07200021
OPTIMSV  DS    6F                                                       07260021
*                                      LOOK-AHEAD                       07320021
WRKAR    DS    12F                                                      07380021
OPT14    DS    F                       SAVE AREA FOR REGISTER 14        07440021
DELTAX   DS    F                       TEMPORARY STORAGE-X AND Y        07500021
DELTAY   DS    F                       DISPLACEMENTS FROM LAST POINT    07560021
SIX1     DS    H                       COORDINATES OF FIRST INTER-      07620021
SIY1     DS    H                       SECTION WITH SCREEN LIMITS       07680021
SIX2     DS    H                       COORDINATES OF SECOND INTER-     07740021
SIY2     DS    H                       SECTION WITH SCREEN LIMITS       07800021
         ORG   WRKAR+8                                                  07860021
SABL     DS    F                       POINTER TO GRID/SCREEN LIMITS    07920021
PT1X     DS    F                       COORDINATES OF FROM POINT        07980021
PT1Y     DS    F                       OF VECTOR                        08040021
PT2X     DS    F                       COORDINATES OF TO POINT          08100021
PT2Y     DS    F                       OF VECTOR                        08160021
NI       DS    F                       NUMBER OF INTERSECTIONS          08220021
INTS1X   DS    H                       COORDINATES OF FIRST INTERSEC-   08280021
INTS1Y   DS    H                       TION POINT                       08340021
INTS2X   DS    H                       COORDINATES OF SECOND            08400021
INTS2Y   DS    H                       INTERSECTION POINT               08460021
         ORG   X1+396                                                   08520021
CURMOD   DS    H                       LAST SET MODE ORDER GENERATED    08580021
MODE     DS    C                       TEMPORARY STORAGE FOR UMODE &    08640021
*                                      VMODE                            08700021
         DS    C                       RESERVED                         08760021
PARTAB   DSECT                                                          08820021
XYSCALE  DS    F                  ADDRESS OF SCALING TABLES             08880021
UADDR    DS    F                  ADDRESSES OF FIRST U AND              08940021
VADDR    DS    F                  V VALUES                              09000021
F        DS    C                  MODE                                  09060021
IPU      DS    C                  FORMAT OF U VALUES                    09120021
IPV      DS    C                  FORMAT OF V VALUES                    09180021
PTYPE    DS    C                  TYPE OF PLOT                          09240021
POSOPT   DS    C                  POSITIONING OPTION                    09300021
SGOPT    DS    C                  SCREEN/GRID SCISSORING OPTION         09360021
S        DS    C                  SCALING                               09420021
SMOPT    DS    C                  INITIAL SET MODE OPTION               09480021
SEGOPT   DS    C                  SEGMENT OPTION                        09540021
         DS    C                  RESERVED                              09600021
N        DS    H                  NUMBER OF U,V PAIRS                   09660021
UINDEX   DS    F                  INDICES TO                            09720021
VINDEX   DS    F                             TABLE ENTRIES              09780021
UINCR    DS    F                  FIXED U AND                           09840021
VINCR    DS    F                              V INCREMENTS              09900021
SCALETAB DSECT                                                          09960021
GX1      DS    F                  GRID LIMITS-LOWER LEFT CORNER         10020021
GY1      DS    F                                                        10080021
GX2      DS    F                             -UPPER RIGHT CORNER        10140021
GY2      DS    F                                                        10200021
SX1      DS    F                  SCREEN LIMITS-LOWER LEFT CORNER       10260021
SY1      DS    F                                                        10320021
SX2      DS    F                               -UPPER RIGHT CORNER      10380021
SY2      DS    F                                                        10440021
DX1      DS    F                  DATA LIMITS-LOWER LEFT CORNER         10500021
DY1      DS    F                                                        10560021
DX2      DS    F                             -UPPER RIGHT CORNER        10620021
DY2      DS    F                                                        10680021
XALTER   DS    F                  X-ALTER SWITCH- ALSO, MULTIPLICA-     10740021
*                                 TIVE SCALING CONSTANT                 10800021
YALTER   DS    F                  Y-ALTER SWITCH- ALSO, MULTIPLICA-     10860021
*                                 TIVE Y SCALING CONSTANT               10920021
XCON     DS    F                  ADDITIVE X SCALING CONSTANT           10980021
YCON     DS    F                  ADDITIVE Y SCALING CONSTANT           11040021
SGPAR    DSECT                                                          11100021
NXTX     DS    F                                                        11160021
NXTY     DS    F                                                        11220021
SUPLT    DS    C                                                        11280021
PTCNT    DS    C                                                        11340021
BV1      DS    C                                                        11400021
BV2      DS    C                                                        11460021
ADJX1    DS    H                                                        11520021
ADJY1    DS    H                                                        11580021
ADJX2    DS    H                                                        11640021
ADJY2    DS    H                                                        11700021
IFFPKADG CSECT                                                          11760021
* 514200                                                         A29393 11790021
PARBASE  EQU   10                      BASE REGISTER FOR PARAMETERS     11820021
SCALBASE EQU   9                       BASE REGISTER FOR SCALING        11880021
*                                      CONSTANTS                        11940021
FPACC    EQU   0                                                        12000021
FPACC1   EQU   2                                                        12060021
FPACC2   EQU   4                                                        12120021
FPACC3   EQU   6                                                        12180021
ACC      EQU   0                       GENERAL ACCUMULATOR              12240021
PARLIST  EQU   1                       PARAMETER LIST REGISTER          12300021
NINC     EQU   1                       NUMBER OF VECTORS IN ABS. VECTOR 12360021
EVNACC   EQU   2                       ACCUMULATOR FOR MULTIPLICATION   12420021
*                                      AND DIVISION                     12480021
ERRX     EQU   2                       CUMULATIVE X-ERROR               12540021
ODDACC   EQU   3                       ACCUMULATOR FOR MULTIPLICATION   12600021
*                                      AND DIVISION                     12660021
ERRY     EQU   3                       CUMULATIVE Y-ERROR               12720021
ABIND    EQU   4                       POINTER TO ABSOLUTE VECTOR       12780021
*                                      BEING CONVERTED TO INCREMENTAL   12840021
ACC1     EQU   4                                                        12900021
INCIND   EQU   5                       POINTER TO STORAGE AREA FOR      12960021
*                                      INCREMENTAL VECTORS              13020021
ACC2     EQU   5                                                        13080021
ACC3     EQU   6                                                        13140021
COUNT    EQU   6                       NUMBER ABSOLUTE VECTORS          13200021
POINTS   EQU   6                                                        13260021
DELX     EQU   7                       CONSTANT X-DISPLACEMENT          13320021
MAGDELX  EQU   7                       MAGNITUDE OF DELTAX              13380021
OLPREG   EQU   7                       CURRENT VALUE OF OLP             13440021
RX       EQU   8                       FINAL X-REMAINDER                13500021
GDOACNT  EQU   8                       USABLE BYTES IN GDOA             13560021
DELY     EQU   9                       CONSTANT Y-DISPLACEMENT          13620021
MAGDELY  EQU   9                       MAGNITUDE OF DELTAY              13680021
RY       EQU   10                      Y-REMAINDER FOR LAST VECTOR      13740021
WORKBASE EQU   11                      BASE FOR SYMBOLIC REFERENCES     13800021
*                                      TO WORKAREA                      13860021
BASE     EQU   12                      BASE REGISTER FOR ROUTINE        13920021
SAVEREG  EQU   13                      POINTER TO SAVE AREA             13980021
RETREG   EQU   14                      RETURN REGISTER                  14040021
ENTREG   EQU   15                                                       14100021
         ENTRY GSDPLT                                                   14160021
GSDPLT   SAVE  (14,12)                                                  14220021
         BALR  BASE,0                  ADDRESSABILITY                   14280021
         USING *,BASE                  FOR ROUTINE                      14340021
*                                                                       14400021
         L     PARBASE,4(PARLIST)      ADDRESSABILITY                   14460021
         USING PARTAB,PARBASE          FOR PARAMETER TABLE              14520021
*                                                                       14580021
         L     EVNACC,0(PARLIST)       GET ADDRESS                      14640021
         L     WORKBASE,4(EVNACC)      OF WORKAREA                      14700021
         USING WORKAREA,WORKBASE       ADDRESSABILITY FOR WORKAREA      14760021
         XC    PTPOS(4),PTPOS          XET PT. POSITION & DEFAULT       14820021
*                                      FLAGS AND RETURN CODE WORKAREA   14880021
*                                      TO 0                             14940021
*                                                                       15000021
         ST    PARBASE,PARTABAD        S1VE ADDRESSES OF PARAMETER      15060021
         MVC   OACBAD(4),0(EVNACC)     TABLE AND OACB IN WORKBASE       15120021
*                                                                       15180021
         LA    EVNACC,SVAR1            SET UP SAVE AREA                 15240021
         ST    SAVEREG,4(EVNACC)       & CHAIN IT TO                    15300021
         ST    EVNACC,8(SAVEREG)       PREVIOUS SAVE AREA               15360021
         LR    SAVEREG,EVNACC                                           15420021
*                                                                       15480021
         CLC   N(2),H1                 SEE IF N POSITIVE                15540021
         BNL   PARMCHK                                                  15600021
         L     SAVEREG,4(SAVEREG)      N ZERO OR NEGATIVE-              15660021
         RETURN (14,12),RC=0           IMMEDIATE RETURN                 15720021
*                                                                       15780021
PARMCHK  LA    ACC,3                                                    15840021
         SPM   ACC                     UNMASK ALL PROGRAM INTERRUPTS    15900021
         LA    PARLIST,MODES           GET DATA/                        15960021
         LA    EVNACC,F                COMPUTATION                      16020021
         LA    ODDACC,4                MODE OF                          16080021
         BAL   RETREG,PRMCHKLP         INPUT                            16140021
         MVC   UMODE(1),1(PARLIST)     AND SET CONTROL SWITCHES         16200021
         MVC   VMODE(1),2(PARLIST)                                      16260021
*                                                                       16320021
         LA    ACC,2                                                    16380021
         LA    PARLIST,INPFORMS        GET FORMAT                       16440021
         LA    EVNACC,IPU              OF U-VALUE                       16500021
         LA    ODDACC,3                INPUT                            16560021
         BAL   RETREG,PRMCHKLP                                          16620021
         OC    UMODE(1),1(PARLIST)     AND SET SWITCH                   16680021
*                                                                       16740021
         LA    PARLIST,INPFORMS        GET FORMAT                       16800021
         LA    EVNACC,IPV              OF V-VALUE                       16860021
         LA    ODDACC,3                INPUT                            16920021
         BAL   RETREG,PRMCHKLP                                          16980021
         OC    VMODE(1),1(PARLIST)     AND SET SWITCH                   17040021
*                                                                       17100021
         LA    PARLIST,SMOPTS          DETERMINE                        17160021
         LA    EVNACC,SMOPT            SET MODE                         17220021
         LA    ODDACC,2                OPTIIN                           17280021
         BAL   RETREG,PRMCHKLP                                          17340021
         MVC   SMSW(1),1(PARLIST)      AND SET CONTROL SWITCH           17400021
*                                                                       17460021
         LA    PARLIST,SGOPTS          DETERMINE                        17520021
         LA    EVNACC,SGOPT            SCISSORING OPTION                17580021
         LA    ODDACC,5                REQUESTED                        17640021
         BAL   RETREG,PRMCHKLP         AND                              17700021
         MVC   PTSGSW(1),1(PARLIST)    SET CONTROL SWITCH               17760021
*                                                                       17820021
         LA    PARLIST,PTYPES          DETERMINE                        17880021
         LA    EVNACC,PTYPE            TYPE OF                          17940021
         LA    ODDACC,6                PLOT REQUESTED                   18000021
         BAL   RETREG,PRMCHKLP         AND                              18060021
         OC    PTSGSW(1),1(PARLIST)    SET CONTROL SWITCH               18120021
         TM    PTSGSW,X'80'            IF OPTIMIZED PLOT                18180021
         BZ    SCALPARM                IS REQUESTED,                    18240021
SCALPARM LA    ACC,4                                                    18300021
         LA    PARLIST,SOPTS           SEE IF SCALING REQUESTED         18360021
         LA    EVNACC,S                                                 18420021
         LA    ODDACC,2                                                 18480021
         BAL   RETREG,PRMCHKLP                                          18540021
         L     PARLIST,0(PARLIST)      BRANCH TO ROUTINE TO INITIALIZE  18600021
         L     SCALBASE,XYSCALE        SCALING REQUESTED, LOCATE        18660021
         USING SCALETAB,SCALBASE       SCALING CONTANTS                 18720021
         BR    PARLIST                                                  18780021
*                                                                       18840021
GRIDSF   LE    FPACC,SX2(EVNACC)       GET S2-S1                        18900021
         SE    FPACC,SX1(EVNACC)                                        18960021
         BC    12,RC4                  CHECK FOR LEGALITY               19020021
         LE    FPACC1,0(PARLIST)       GET COORDINATE TO BE SCALED      19080021
         SE    FPACC1,SX1(EVNACC)      SUBTRACT S1                      19140021
         ME    FPACC1,FOURKE           MULTIPLY BY 4K                   19200021
         DER   FPACC1,FPACC            DIVIDE BY S2-S1                  19260021
         STE   FPACC1,WRKAR            STORE                            19320021
         LA    PARLIST,WRKAR                                            19380021
         ST    RETREG,OPT14            SAVE RETURN REGISTER             19440021
         BAL   RETREG,FIX              FIX VALUE                        19500021
         LTR   ENTREG,ENTREG           CHECK FOR LEGALITY               19560021
         BC    7,BADTERM                                                19620021
         L     RETREG,OPT14            RETURN                           19680021
         BR    RETREG                                                   19740021
*                                                                       19800021
GRIDS    L     ACC,SX2(EVNACC)         GET S2-S1                        19860021
         S     ACC,SX1(EVNACC)         CHECK FOR LEGALITY               19920021
         BC    12,RC4                                                   19980021
         L     ODDACC,0(PARLIST)       GET COORDINATE TO BE SCALED      20040021
         S     ODDACC,SX1(EVNACC)      SUBSTRACT S1                     20100021
         ST    EVNACC,DELTAX           SAVE LOOP CONTROL                20160021
         M     EVNACC,FOURK            MULTIPLY BY 4K                   20220021
         DR    EVNACC,ACC              DIVIDE BY S2-S1                  20280021
         ST    ODDACC,WRKAR            STORE                            20340021
         L     EVNACC,DELTAX           RESTORE LOOP CONTROL             20400021
         BR    RETREG                  AND RETURN                       20460021
*                                                                       20520021
ABSGRID  MVC   WRKAR(16),GX1           MOVE GRID LIMITS TO WORKAREA     20580021
         SR    EVNACC,EVNACC           SET POINTER                      20640021
         TM    UMODE,X'10'             NEED TO FIX                      20700021
         BZ    FXABGRDV                NO, CHECK V                      20760021
FXABGRD  LA    PARLIST,WRKAR(EVNACC)   GET ADDRESS OF VALUE             20820021
         BAL   RETREG,FIX              FIX IT                           20880021
         LA    PARLIST,WRKAR+8(EVNACC) GET SECOND VALUE                 20940021
         BAL   RETREG,FIX              FIX IT                           21000021
         LTR   EVNACC,EVNACC           BOTH U AND V CHECKED             21060021
         BC    7,ABGRDXFR              YES, MOVE TO WORKAREA            21120021
FXABGRDV LA    EVNACC,4                GET POINTER TO Y VALUES          21180021
         TM    VMODE,X'10'             CHECK MODE                       21240021
         BO    FXABGRD                 FIX V VALUES                     21300021
ABGRDXFR MVC   X1(2),WRKAR+2           SAVE GRID LIMITS                 21360021
         MVC   Y1(2),WRKAR+6           IN PROPER                        21420021
         MVC   X2(2),WRKAR+10          LOCATIONS                        21480021
         MVC   Y2(2),WRKAR+14          IN THE WORKAREA                  21540021
         B     CHKGRD                  CHECK FOR VALIDITY               21600021
*                                                                       21660021
SCALGRID SR    EVNACC,EVNACC           SET UP POINTERS                  21720021
         LA    ACC2,X1                 TO U-X VALUES                    21780021
         TM    UMODE,X'10'             CHECK MODE                       21840021
         BZ    FIXGRD                  INTEGER                          21900021
FLTGRD   LA    PARLIST,GX1(EVNACC)     FLOATING- CONVERT COORDINATE OF  21960021
         BAL   RETREG,GRIDSF           LOWER-LEFT CORNER OF GRID TO     22020021
         MVC   0(2,ACC2),WRKAR+2       RASTER UNITS AND STORE           22080021
         LA    PARLIST,GX2(EVNACC)     LIKEWISE FOR                     22140021
         BAL   RETREG,GRIDSF           UPPER-RIGHT CORNER               22200021
         MVC   4(2,ACC2),WRKAR+2                                        22260021
GRDLP1   LTR   EVNACC,EVNACC           FINISHED PROCESSING Y-VALUES     22320021
         BC    7,CHKGRD                YES- CHECK                       22380021
         LA    EVNACC,4                NO- GET POINTERS TO              22440021
         LA    ACC2,Y1                 V-Y VALUES                       22500021
         TM    VMODE,X'10'             CHECK MODE                       22560021
         BO    FLTGRD                  FLOATING                         22620021
*                                                                       22680021
FIXGRD   LA    PARLIST,GX1(EVNACC)     INTEGER- EVALUATE                22740021
         BAL   RETREG,GRIDS            COORDINATES OF                   22800021
         MVC   0(2,ACC2),WRKAR+2       GRID CORNERS                     22860021
         LA    PARLIST,GX2(EVNACC)     USING                            22920021
         BAL   RETREG,GRIDS            INTEGER ARITHMETIC               22980021
         MVC   4(2,ACC2),WRKAR+2       AND STORE                        23040021
         B     GRDLP1                                                   23100021
*                                                                       23160021
CHKGRD   LH    PARLIST,ZERO            CHECK GRID                       23220021
         CH    PARLIST,X1              LIMITS TO                        23280021
         BH    RC4                     MAKE SURE                        23340021
         CH    PARLIST,Y1              THEY ARE                         23400021
         BH    RC4                     VALID                            23460021
         LH    PARLIST,ZERO+4          IF NOT,                          23520021
         CH    PARLIST,X2              SET RETURN                       23580021
         BL    RC4                     CODE FOR                         23640021
         CH    PARLIST,Y2              IMMEDIATE RETURN                 23700021
         BL    RC4                                                      23760021
         CLC   X1(2),X2                MAKE SURE LOWER GRID LIMITS      23820021
         BNL   RC4                                                      23880021
         CLC   Y1(2),Y2                ARE LESS THAN UPPER LIMITS       23940021
         BNL   RC4                                                      24000021
POSITION OI    PTSGSW,X'40'                                             24060021
         XC    ABSPTS(2),ABSPTS        SET POINT COUNT =0               24120021
         XC    INCPTS(2),INCPTS        SET NO. OF INCREMENTAL PTS.=0    24180021
         BAL   RETREG,GETNEXT          GET FIRST POINT                  24240021
         LTR   ENTREG,ENTREG           BAD DATA LIMITS                  24300021
         BP    ENDTERM                 YES, TERMINATE PROGRAM           24360021
         MVC   X(8),DELTAX             STORE                            24420021
         MVC   XP(2),DELTAX+2          IN HISTORICAL                    24480021
         MVC   YP(2),DELTAY+2          AREAS                            24540021
         LA    ACC,NXTX1               SET INITIAL                      24600021
         MVC   NXTX1(8),X              POSITION SWITCHES                24660021
         BAL   RETREG,SGCHECK          FOR FUTURE REFERENCE             24720021
         LA    POINTS,1                INITIALIZE COUNTER               24780021
         LA    ACC,4                   CHECK                            24840021
         LA    PARLIST,POSOPTS         POSITIONING                      24900021
         LA    EVNACC,POSOPT           OPTIONS                          24960021
         LA    ODDACC,3                                                 25020021
         BAL   RETREG,PRMCHKLP                                          25080021
         L     PARLIST,0(PARLIST)      GET ADDRESS OF ROUTINE           25140021
*                                                                       25200021
         L     EVNACC,OACBAD           GET NUMBER                       25260021
         L     GDOACNT,0(EVNACC)       OF FREE BYTES                    25320021
         A     GDOACNT,4(EVNACC)       IN THE GDOA                      25380021
         L     OLPREG,16(EVNACC)       AND THE VALUE                    25440021
         SR    GDOACNT,OLPREG          OF THE                           25500021
         SH    GDOACNT,H4              OLP                              25560021
         NI    PTSGSW,X'BF'                                             25620021
         MVI   BV21,X'00'              SET INCREMENTAL POSITIONING      25680021
*                                      SWITCH OFF                       25740021
         BR    PARLIST                 TO PROCESSING ROUTINE            25800021
*                                                                       25860021
ABSPOS   MVC   NXTX1(8),X              ABSOLUTE POSITIONING             25920021
         LA    ACC,NXTX1               CALL SCISSORING ROUTINE TO       25980021
         BAL   RETREG,SGCHECK          CHECK POSITIONING VECTOR         26040021
         LTR   ENTREG,ENTREG           TERMINATION CONDITION            26100021
         BP    ENDTERM                 YES, EXIT                        26160021
         TM    SUPLT1,X'FF'            NO.  PLOT SUPPRESSED             26220021
         BZ    ABSPOS1                 NO.  POSITION TO INPUT VALUE     26280021
         XC    XP(4),XP                YES, POSITION TO 0,0             26340021
ABSPOS1  MVC   WRKAR(4),XP                                              26400021
         MVC   ABSPTS(2),H1            STORE POSITION IN WORKAREA       26460021
         OI    WRKAR,X'40'             BLANK VECTOR                     26520021
         TM    PTSGSW,X'80'            OPTIMIZED PLOT                   26580021
         BZ    INCABPOS                                                 26640021
         NI    PTSGSW,X'1F'            YES,SET FOR ABSOLUTE PLOT        26700021
         OI    PTPOS,X'C0'             SIGNAL PLOT TYPE OVERIDE         26760021
         B     STRABS                  STORE DATA                       26820021
*                                                                       26880021
INCABPOS TM    PTSGSW,X'20'            INCREMENTAL PLOT                 26940021
         BZ    STRABS                  NO, STORE ABSOLUTE DATA          27000021
         OI    PTPOS,X'40'             YES, SIGNAL PTYPE OVERIDE        27060021
         NI    PTSGSW,X'DF'            OVERIDE TO ABSOLUTE PLOT         27120021
         B     STRABS                                                   27180021
*                                                                       27240021
INCPOS   CLI   SEGOPT,C'B'             IF SEG OPT B AND POS OPT C       27300021
         BE    ABSPOS                  ARE SPECIFIED, ASSUME POS OPT A  27360021
         MVI   BV21,X'FF'              BLANK OUT VECTOR                 27420021
*                                      INCREMENTAL POSITIONING          27480021
         TM    PTSGSW,X'80'            OPTIMIZED PLOT                   27540021
         BZ    ABINCPOS                                                 27600021
         OI    PTPOS,X'C0'             YES, SIGNAL PTYPE OVERIDE        27660021
         NI    PTSGSW,X'7F'            FORCE NON-OPTIMIZED PLOT         27720021
         B     MAINLOOP                                                 27780021
ABINCPOS TM    PTSGSW,X'20'            NON-OPTIMIZED INCREMENTAL        27840021
         BO    MAINLOOP                YES, PLOT POINT                  27900021
         OI    PTPOS,X'40'             NO, SIGNAL PTYPE OVERIDE         27960021
         OI    PTSGSW,X'20'            FORCE INCREMENTAL PLOT           28020021
         MVI   SMSW,X'FF'              AND SET MODE                     28080021
         B     MAINLOOP                                                 28140021
PRMCHKLP CLC   0(1,PARLIST),0(EVNACC)  COMPARE PARAMETER WITH TABLE     28200021
         BCR   8,RETREG                ENTRY. IF EQUAL, RETURN          28260021
         AR    PARLIST,ACC             NOT EQUAL, GET ADDRESS OF NEXT   28320021
         BCT   ODDACC,PRMCHKLP         ENTRY AND CHECK IT               28380021
         MVI   DEFLG,X'FF'             NO LEGAL OPTIONS TAKEN-SET       28440021
         BR    RETREG                  DEFAULT FLAG AND RETURN          28500021
MODES    DC    C'A'                    DATA COMPUTATION MODE            28560021
         DC    X'10'                   U FLOATING-POINT                 28620021
         DC    X'10'                   V FLOATING-POINT                 28680021
         DC    C'B'                                                     28740021
         DC    X'00'                   U INTEGER                        28800021
         DC    X'00'                   V INTEGER                        28860021
         DC    C'C'                                                     28920021
         DC    X'00'                   U INTEGER                        28980021
         DC    X'10'                   V FLOATING-POINT                 29040021
         DC    C'D'                                                     29100021
         DC    X'10'                   U FLOATING-POINT                 29160021
         DC    X'00'                   V INTEGER                        29220021
         DS    C                       DEFAULT                          29280021
         DC    X'10'                   U FLOATING-POINT                 29340021
         DC    X'10'                   V FLOATING-POINT                 29400021
*                                                                       29460021
*                                                                       29520021
*                                                                       29580021
INPFORMS DC    C'A'                    INPUT FORMATS                    29640021
         DC    X'20'                   ALL VALUES IN ABSOLUTE TABLE     29700021
         DC    C'B'                    FIRST VALUE IN TABLE,            29760021
         DC    X'40'                   OTHERS INCREMENTAL               29820021
         DC    C'C'                    FIRST VALUE IN TABLE,            29880021
         DC    X'80'                   OTHERS BY ADDING FIXED INCREMENT 29940021
         DS    C                       DEFAULT                          30000021
         DC    X'20'                   ALL VALUES ABSOLUTE              30060021
*                                                                       30120021
PTYPES   DC    C'A'                    PLOT TYPES                       30180021
         DC    X'10'                   ABSOLUTE VECTOR                  30240021
         DC    C'B'                                                     30300021
         DC    X'00'                   ABSOLUTE POINT                   30360021
         DC    C'C'                                                     30420021
         DC    X'30'                   INCREMENTAL VECTOR               30480021
         DC    C'D'                                                     30540021
         DC    X'20'                   INCREMENTAL POINT                30600021
         DC    C'E'                                                     30660021
         DC    X'B0'                   OPTIMIZED VECTOR                 30720021
         DC    C'F'                                                     30780021
         DC    X'A0'                   OPTIMIZED POINT                  30840021
         DS    C                       DEFAULT                          30900021
         DC    X'10'                   ABSOLUTE VECTOR                  30960021
*                                                                       31020021
SGOPTS   DC    C'A'                    OFF SCREEN/OFF GRID OPTIONS      31080021
         DC    X'00'                   SHOW ALL POINTS IN GRID          31140021
         DC    C'B'                                                     31200021
         DC    X'02'                   SHOW ALL POINTS IN SCREEN        31260021
         DC    C'C'                    SHOW ALL POINTS IN GRID          31320021
         DC    X'08'                   TERMINATE WHEN SCREEN EXCEEDED   31380021
         DC    C'D'                                                     31440021
         DC    X'04'                   TERMINATE WHEN GRID EXCEEDED     31500021
         DC    C'E'                    SHOW ALL POINTS IN SCREEN        31560021
         DC    X'0A'                   TERMINATE WHEN SCREEN EXCEEDED   31620021
         DS    C                       DEFAULT- SG OPT = E              31680021
         DC    X'0A'                                                    31740021
*                                                                       31800021
SMOPTS   DC    C'A'                                                     31860021
         DC    X'FF'                   SET MODE REQUESTED               31920021
         DC    C'B'                                                     31980021
         DC    X'00'                   PROPER MODE SET                  32040021
         DS    C                                                        32100021
         DC    X'FF'                   DEFAULT- SET MODE                32160021
*                                                                       32220021
         DS    0F                                                       32280021
POSOPTS  DC    C'A'                    POSITIONING OPTIONS              32340021
         DC    AL3(ABSPOS)             ABSOLUTE POSITIONING             32400021
         DC    C'B'                                                     32460021
         DC    AL3(FINOPT)             POSITION FOR INFORMATION ONLY    32520021
         DC    C'C'                                                     32580021
         DC    AL3(INCPOS)             INCREMENTAL POSITIONING          32640021
         DS    C                       DEFAULT                          32700021
         DC    AL3(ABSPOS)             ABSOLUTE POSITIONING             32760021
*                                                                       32820021
*                                                                       32880021
SOPTS    DC    C'A'                                                     32940021
         DC    AL3(ABSGRID)            NO SCALING                       33000021
         DC    C'B'                                                     33060021
         DC    AL3(SCALGRID)           SCALING REQUESTED                33120021
         DS    C                                                        33180021
         DC    AL3(ABSGRID)            DEFAULT - NO SCALING             33240021
*                                                                       33300021
MAINLOOP LA    POINTS,1(POINTS)        INCREMENT COUNTER BY ONE         33360021
         CH    POINTS,N                ALL POINTS PROCESSED             33420021
         BH    NORMTERM                YES, TERMINATE ROUTINE           33480021
         BAL   RETREG,GETNEXT                                           33540021
         MVC   NXTX1(8),DELTAX                                          33600021
*                                                                       33660021
         LA    ACC,NXTX1                                                33720021
         BAL   RETREG,SGCHECK                                           33780021
         LTR   ENTREG,ENTREG                                            33840021
         BC    7,STOLP                                                  33900021
         MVC   X(8),NXTX1              SAVE LOGICAL POSITION OF BEAM    33960021
         TM    SUPLT1,X'FF'                                             34020021
         BO    MAINLOOP                                                 34080021
         MVC   WRKAR(8),ADJX11                                          34140021
         TM    PTCNT1,X'F0'                                             34200021
         BZ    ONEABS                                                   34260021
         MVC   ABSPTS(2),H2                                             34320021
         B     BLANK                                                    34380021
ONEABS   MVC   ABSPTS(2),H1                                             34440021
BLANK    TM    BV11,X'FF'                                               34500021
         BZ    PTYPETST                                                 34560021
         OI    WRKAR,X'40'                                              34620021
PTYPETST TM    PTSGSW,X'A0'                                             34680021
         BZ    STRABS                                                   34740021
         TM    BV21,X'FF'              INCREMENTAL POSITIONING          34800021
         BZ    DISP                    NO                               34860021
         OI    WRKAR,X'40'             YES, BLANK ALL POSSSIBLE         34920021
         OI    WRKAR+4,X'40'           ABSOLUTE VECTORS                 34980021
         MVI   BV21,X'00'              SET SWITCH TO ZERO               35040021
*                                                                       35100021
DISP     BAL   RETREG,DISPLACE                                          35160021
         LTR   ENTREG,ENTREG           RETURN CODE NON-ZERO             35220021
         BP    STOLP                   YES, IMMEDIATE TERMINATION       35280021
         TM    PTSGSW,X'80'                                             35340021
         BZ    STRINC                                                   35400021
*                                                                       35460021
         TM    PTSGSW,X'20'            CURRENT MODE = ABSOLUTE          35520021
         BO    CURINC                  NO,                              35580021
         CLC   ABSPTS(2),H1            NUMBER OF ABSOLUTE VECTORS       35640021
         BL    KEEPMODE                   NONE                          35700021
         BH    TWOABS                     TWO                           35760021
         CLC   INCPTS(2),H1               ONE- ONLY ONE INCREMENTAL     35820021
         BE    LKAHEAD                 VECTOR REQUIRED, LOOK AHEAD      35880021
*                                      MORE THAN ONE REQUIRED           35940021
KEEPMODE MVI   SMSW,X'00'              SET SET MODE SWITCH OFF          36000021
         B     FINOPT                                                   36060021
*                                                                       36120021
TWOABS   CLC   INCPTS(2),H3            NUMBER OF INCREMENTAL VECTORS    36180021
         BE    LKAHEAD                 REQUIRED-- THREE, LOOK AHEAD     36240021
         BH    KEEPMODE                  FOUR OR MORE- STAY IN ABSOLUTE 36300021
*                                        LESS THAN THREE,               36360021
FLIPMODE XI    PTSGSW,X'20'            CHANGE MODE                      36420021
         MVI   SMSW,X'FF'              SET SET MODE SWITCH              36480021
         B     FINOPT                                                   36540021
*                                                                       36600021
LKAHEAD  MVC   OPTIMSV+8(16),U         SAVE CURRENT POSITION PARAMETERS 36660021
         BAL   RETREG,GETNEXT          GET NEXT POINT TO PLOT           36720021
         LTR   ENTREG,ENTREG           CHECK RETURN CODE                36780021
         BC    7,SKPNXT                NON-ZERO                         36840021
*                                                                       36900021
         MVC   NXTX3(8),DELTAX         SET UP SCISSORING PARAMETER LIST 36960021
         LA    ACC,NXTX3               SET UP CALL FOR SCISSORING       37020021
         BAL   RETREG,SGCHECK          SCISSOR                          37080021
         LTR   ENTREG,ENTREG           TEST RETURN CODE                 37140021
         BC    7,SKPNXT                NON-ZERO                         37200021
*                                                                       37260021
         TM    SUPLT3,X'FF'            PLOT SUPPRESSED,                 37320021
         BO    SKPNXT                  STAY IN CURRENT MODE             37380021
*                                                                       37440021
         LH    EVNACC,ADJX13           GET DELTAX                       37500021
         SH    EVNACC,XP                                                37560021
         CH    EVNACC,HILIM            IF GREATER THAN 255,             37620021
         BH    SKPNXT                  STAY IN ABSOLUTE                 37680021
         CH    EVNACC,LOWLIM           IF LESS THAN -256,               37740021
         BL    SKPNXT                  STAY IN ABSOLUTE                 37800021
*                                                                       37860021
         LH    EVNACC,ADJY13           GET DELTA Y                      37920021
         SH    EVNACC,YP                                                37980021
         CH    EVNACC,HILIM            IF GREATER THEN 255,             38040021
         BH    SKPNXT                  STAY IN CURRENT MODE             38100021
         CH    EVNACC,LOWLIM           IF LESS THAN -256                38160021
         BL    SKPNXT                  STAY IN CURRENT MODE             38220021
*                                                                       38280021
         MVC   U(16),OPTIMSV+8         RESTORE ORIGINAL BEAM POSITION   38340021
*                                      VALUES                           38400021
         B     FLIPMODE                CHANGE MODE AND EXIT             38460021
*                                                                       38520021
SKPNXT   MVC   U(16),OPTIMSV+8         RESTORE ORIGINAL BEAM POSITION   38580021
*                                      VALUES                           38640021
         B     KEEPMODE                STAY IN ABSOLUTE MODE            38700021
*                                                                       38760021
CURINC   CLC   ABSPTS(2),H2            IF ONE ABSOLUTE VECTOR           38820021
         BE    TWOABSI                 NEEDED,                          38880021
         CLC   INCPTS(2),H3            SEE HOW MANY INCREMENTALS        38940021
         BH    FLIPMODE                  MORE THAN 3- GO TO ABSOLUTE    39000021
         BNH   KEEPMODE                  3 OR LESS- STAY IN INCREMENTAL 39060021
*                                                                       39120021
TWOABSI  CLC   INCPTS(2),H5            IF TWO ABSOLUTE VECTORS,         39180021
         BH    FLIPMODE                  MORE THAN 5 INCREMENTALS       39240021
         BNH   KEEPMODE                  5 OR LESS                      39300021
FINOPT   TM    PTSGSW,X'20'                                             39360021
         BO    STRINC                                                   39420021
*                                                                       39480021
STRABS   LH    EVNACC,ABSPTS                                            39540021
         MH    EVNACC,H4                                                39600021
         TM    SMSW,X'FF'                                               39660021
         BZ    ABSPACE                                                  39720021
         LA    EVNACC,2(EVNACC)                                         39780021
ABSPACE  CR    EVNACC,GDOACNT                                           39840021
         BH    GDOAOVER                                                 39900021
         LA    ODDACC,WRKAR            GET ADDRESS OF DATA              39960021
         TM    SMSW,X'FF'                                               40020021
         BZ    STRDATAA                                                 40080021
         TM    PTSGSW,X'10'                                             40140021
         BO    ABSVECSM                                                 40200021
         MVC   0(2,OLPREG),GEPM                                         40260021
         MVC   CURMOD(2),GEPM                                           40320021
         B     SMUPDA                                                   40380021
ABSVECSM MVC   0(2,OLPREG),GEVM                                         40440021
         MVC   CURMOD(2),GEVM                                           40500021
SMUPDA   LA    OLPREG,2(OLPREG)                                         40560021
         SH    GDOACNT,H2              AVAILABLE SPACE BY 2 BYTES       40620021
         SH    EVNACC,H2               DECREMENT SPACE REQUIRED &       40680021
STRDATAA LTR   EVNACC,EVNACC           IF NO DATA IS PRESENT,           40740021
         BZ    CHKMODE                 BYPASS DATA STORAGE              40800021
         SR    GDOACNT,EVNACC          UPDATE AVAILABLE SPACE           40860021
         BCTR  EVNACC,0                                                 40920021
         EX    EVNACC,MVDATAI          MOVE DATA INTO GDOA              40980021
         LA    OLPREG,1(OLPREG,EVNACC) UPDATE OLP                       41040021
*                                      OFF                              41100021
         LH    EVNACC,ABSPTS           GET POINTER                      41160021
         MH    EVNACC,H4               TO LAST                          41220021
         SH    EVNACC,H4               ABSOLUTE                         41280021
         LA    EVNACC,WRKAR(EVNACC)    VECTOR IN WORK AREA              41340021
         MVC   XP(4),0(EVNACC)         SAVE AS LAST PHYSICAL LOCATION   41400021
*                                      OF THE BEAM                      41460021
         NI    XP,X'0F'                ELIMINATE BEAM BIT               41520021
CHKMODE  MVI   SMSW,X'00'                                               41580021
         MVI   OVERFLAG,X'00'                                           41640021
         XC    ABSPTS(2),ABSPTS        SET NUMBER OF ABSOLUTE POINTS    41700021
*                                      EQUAL TO ZERO                    41760021
         TM    PTPOS,X'40'             MODE OVERIDEN                    41820021
         BZ    SEGTEST                 NO- CONTINUE                     41880021
         TM    PTPOS,X'80'             YES- OPTIMIZATION OVERRIDEN      41940021
         BZ    RONGMODE                NO                               42000021
         OI    PTSGSW,X'80'            YES- SET OPTIMIZED MODE          42060021
         B     SEGTEST                 AND CONTINUE                     42120021
RONGMODE MVI   SMSW,X'FF'              SET MODE TO BE GENERATED         42180021
         XI    PTSGSW,X'20'            SET PROPER MODE                  42240021
SEGTEST  NI    PTPOS,X'3F'             TURN OFF OVERIDE SIGNAL          42300021
         CLI   SEGOPT,C'B'             SEE IF SEGMENT PLOT              42360021
         BE    SEGLOOP                                                  42420021
         B     MAINLOOP                                                 42480021
*                                                                       42540021
MVDATAI  MVC   0(0,OLPREG),0(ODDACC)                                    42600021
*                                                                       42660021
STRINC   LH    ODDACC,ABSPTS           GET LOCATION OF INCREMENTAL      42720021
         MH    ODDACC,H4               DATA                             42780021
         LH    EVNACC,INCPTS           GET NUMBER OF INCREMENTAL        42840021
         MH    EVNACC,H2               DATA BYTES                       42900021
         TM    SMSW,X'FF'              IF SET MODE REQUESTED,           42960021
         BZ    INCSPACE                                                 43020021
         LA    EVNACC,2(EVNACC)        INCREASE NUMBER OF BYTES         43080021
*                                      REQUIRED BY 2                    43140021
INCSPACE CR    EVNACC,GDOACNT          SEE IF ENOUGH SPACE IN GDOA      43200021
         BH    GDOAOVER                                                 43260021
         LA    ODDACC,WRKAR(ODDACC)    GET ADDRESS OF DATA              43320021
         TM    SMSW,X'FF'                                               43380021
         BZ    STRDATAA                                                 43440021
*                                                                       43500021
         TM    PTSGSW,X'10'            INSERT SET MODE INTO GDOA        43560021
         BO    INCVECSM                IF REQUESTED                     43620021
         MVC   0(2,OLPREG),GEPI2       INCREMENTAL POINT MODE           43680021
         MVC   CURMOD(2),GEPI2                                          43740021
         B     SMUPDA                  UPDATE OLP AND STORE DATA        43800021
INCVECSM MVC   0(2,OLPREG),GEVI2       INCREMENTAL VECTOR MODE          43860021
         MVC   CURMOD(2),GEVI2                                          43920021
         B     SMUPDA                  UPDATE OLP AND STORE DATA        43980021
SEGLOOP  LA    POINTS,2(POINTS)        INCREMENT COUNTER BY 2           44040021
         CH    POINTS,N                FINISHED WITH CALL               44100021
         BH    NORMTERM                YES, TERMINATE ROUTINE           44160021
         BAL   RETREG,GETNEXT                                           44220021
         MVC   NXTX1(8),DELTAX                                          44280021
*                                                                       44340021
         LM    EVNACC,ODDACC,X                                          44400021
         C     EVNACC,NXTX1                                             44460021
         BNE   NORMPROC                                                 44520021
         C     ODDACC,NXTY1                                             44580021
         BE    PROCSEC                                                  44640021
NORMPROC LA    ACC,NXTX1                                                44700021
         BAL   RETREG,SGCHECK                                           44760021
         LTR   ENTREG,ENTREG                                            44820021
         BC    7,STOLP                                                  44880021
         MVC   X(8),NXTX1              MODIFY LOGICAL POSITION          44940021
*                                      OF BEAM                          45000021
         TM    SUPLT1,X'FF'            PLOT OF 1ST POINT SUPPRESSED     45060021
         BO    PROCSEC                 YES, PROCESS 2ND POINT           45120021
         TM    PTCNT1,X'F0'            TWO VECTORS GENERATED            45180021
         BZ    ONEFRST                                                  45240021
         CLC   ADJX21(2),NXTX1+2       2ND ONE = INPUT VALUE            45300021
         BNE   PROCSEC                 NO, PROCESS 2ND POINT            45360021
         CLC   ADJY21(2),NXTY1+2                                        45420021
         BNE   PROCSEC                                                  45480021
         MVC   WRKAR(4),ADJX21         YES, GENERATE BLANKED VECTOR     45540021
         B     EPONE                   TO FIRST POINT                   45600021
*                                                                       45660021
ONEFRST  CLC   ADJX11(2),NXTX1+2       ONLY VECTOR RETURNED             45720021
         BNE   PROCSEC                 FROM SCISSORING=INPUT VALUE      45780021
         CLC   ADJY11(2),NXTY1+2       NO, PROCESS 2ND POINT            45840021
         BNE   PROCSEC                                                  45900021
         MVC   WRKAR(4),ADJX11         GENERATE BLANKED VECTOR TO       45960021
EPONE    OI    WRKAR,X'40'             TO 1ST POINT                     46020021
         OI    PTPOS,X'80'             SET SWITCH                       46080021
*                                                                       46140021
PROCSEC  BAL   RETREG,GETNEXT                                           46200021
         LA    ACC,NXTX2                                                46260021
         MVC   NXTX2(8),DELTAX                                          46320021
*                                                                       46380021
         BAL   RETREG,SGCHECK                                           46440021
         LTR   ENTREG,ENTREG                                            46500021
         BC    7,STOLP                                                  46560021
         MVC   X(8),NXTX2              MODIFY LOGICAL POSITION          46620021
*                                      OF BEAM                          46680021
         TM    SUPLT2,X'FF'            2ND POINT SUPPRESSED             46740021
         BZ    TWOTST                  NO, CHECK FURTHER                46800021
NODATA   NI    PTPOS,X'3F'             YES, GENERATE NO DATA            46860021
         B     SEGLOOP                                                  46920021
*                                                                       46980021
TWOTST   TM    PTCNT2,X'F0'            2 PTS RETURNED FROM SCISSORING   47040021
         BZ    ONETEST                 NO                               47100021
         MVC   WRKAR(8),ADJX12         YES, PLOT THEM WITH              47160021
         OI    WRKAR,X'40'             1ST BLANKED                      47220021
TWOSEG   MVC   ABSPTS(2),H2            SET POINT COUNT =2               47280021
PLTSEG   NI    PTPOS,X'3F'             SET SWITCH OFF                   47340021
         B     PTYPETST                                                 47400021
*                                                                       47460021
ONETEST  TM    BV12,X'FF'              BEAM BLANKED                     47520021
         BO    NODATA                  YES, GENERATE NO DATA            47580021
         TM    PTPOS,X'80'             POSITIONING VECTOR STORED        47640021
         BZ    ONESEG                  NO                               47700021
         MVC   WRKAR+4(4),ADJX12       YES, STORE SECOND PT             47760021
         B     TWOSEG                                                   47820021
*                                                                       47880021
ONESEG   MVC   WRKAR(4),ADJX12         ONLY ONE POINT, PLOT IT          47940021
         MVC   ABSPTS(2),H1            SET POINT COUNT =1               48000021
         B     PLTSEG                                                   48060021
*                                                                       48120021
NORMTERM L     EVNACC,OACBAD           GET ADDRESS OF THE OACB          48180021
         ST    OLPREG,16(EVNACC)       UPDATE THE VALUE OF THE OLP      48240021
*                                      IN THE OACB                      48300021
         CLC   RETCD(2),ZERO           RETURN CODE WORKAREA NON-ZERO    48360021
         BNE   BADTERM                 YES                              48420021
         TM    DEFLG,X'FF'             NO. ANY DEFAULTS TAKEN           48480021
         BO    BADTERM                 YES                              48540021
         L     SAVEREG,4(SAVEREG)      GET POINTER TO SAVE AREA         48600021
         L     RETREG,12(SAVEREG)      RESTORE REGISTER 14              48660021
         SPM   RETREG                  RESTORE USER'S PROGRAM MASK      48720021
         RETURN (15,12),RC=0           RESTORE OTHER REGISTERS          48780021
*                                                                       48840021
BADTERM  LH    ENTREG,RETCD            GET RETURN CODE                  48900021
         N     ENTREG,RRC                                               48960021
         TM    DEFLG,X'FF'             ANY DEFAULTS TAKEN               49020021
         BZ    BADOUT                  NO                               49080021
         LTR   ENTREG,ENTREG           YES. RETURN CODE                 49140021
         BM    BADOUT                  NEGATIVE-MULTIPLE ERROR FLAG SET 49200021
         BP    ORIN                    POSITIVE-OR IN MULTIPLE ERROR    49260021
         LA    ENTREG,X'28'            ZERO,SET RETURN CODE             49320021
BADOUT   L     SAVEREG,4(SAVEREG)      GET POINTER TO SAVE AREA         49380021
         L     RETREG,12(SAVEREG)      RESTORE REGISTER 14              49440021
         SPM   RETREG                  RESTORE USER'S PROGRAM MASK      49500021
         RETURN (0,12),RC=(15)                                          49560021
*                                                                       49620021
ORIN     O     ENTREG,HIGHBIT          SET MULTIPLE ERROR FLAG          49680021
         B     BADOUT                  AND EXIT                         49740021
*                                                                       49800021
STOLP    L     EVNACC,OACBAD           SAVE UPDATED OLP                 49860021
         ST    OLPREG,16(EVNACC)                                        49920021
ENDTERM  CLC   RETCD(2),ZERO           IMMEDIATE TERMINATION-           49980021
         BNE   ORIN                    SET MULTIPLE ERROR               50040021
         TM    DEFLG,X'FF'             FLAG IF ANY OTHER                50100021
         BO    ORIN                    ERROR CONDITIONS DETECTED        50160021
         B     BADOUT                  AND EXIT                         50220021
*                                                                       50280021
GDOAOVER TM    OVERFLAG,X'FF'          IS OVERFLOW FLAG SET             50340021
         BO    RC24                    YES, IMMEDIATE ERROR EXIT        50400021
         SAVE  (14,12)                 NO, SAVE REGISTERS               50460021
         LR    PARLIST,SAVEREG         SET UP CALL TO                   50520021
         L     SAVEREG,4(SAVEREG)      USER'S OVERFLOW                  50580021
         L     ENTREG,OACBAD           ROUTINE                          50640021
         ST    OLPREG,16(ENTREG)       UPDATE OLP                       50700021
         L     ENTREG,8(ENTREG)                                         50760021
         BALR  RETREG,ENTREG           CALL OVERFLOW ROUTINE            50820021
         LR    SAVEREG,PARLIST         RESTORE REGISTERS                50880021
         LM    14,12,12(SAVEREG)                                        50940021
         MVI   OVERFLAG,X'FF'                                           51000021
         L     EVNACC,OACBAD           GET NEW VALUES                   51060021
         L     OLPREG,16(EVNACC)       OF OLP                           51120021
         L     GDOACNT,0(EVNACC)       AND NUMBER OF                    51180021
         A     GDOACNT,4(EVNACC)       AVAILABLE BYTES                  51240021
         SR    GDOACNT,OLPREG          IN GDOA                          51300021
         SH    GDOACNT,H4              ALLOW SPACE FOR GTRU             51360021
         B     FINOPT                                            A29393 51420021
*                                                                       51480021
RC24     LA    ENTREG,24               OLP NOT SET TO PERMIT            51540021
         B     ENDTERM                 STORAGE OF DATA AFTER OVERFLOW   51600021
*                                                                       51660021
RC4      LA    ENTREG,4                ILLEGAL GRID LIMITS              51720021
         B     ENDTERM                                                  51780021
*                                                                       51840021
         DS    0F                                                       51900021
RRC      DC    X'800000FF'                                              51960021
HIGHBIT  DC    X'80000000'                                              52020021
*                                                                       52080021
GETNEXT  SAVE  (14,12)                 SAVE REGISTERS                   52140021
*                                                                       52200021
         LA    PARLIST,SVAR2           GET NEW SAVE AREA                52260021
         ST    SAVEREG,4(PARLIST)                                       52320021
         ST    PARLIST,8(SAVEREG)      CHAIN SAVE AREAS                 52380021
         LR    SAVEREG,PARLIST                                          52440021
*                                                                       52500021
*                                                                       52560021
*                                                                       52620021
*                                                                       52680021
UTEST    MVC   MODE(1),UMODE           MOVE MODE INTO TEMPORARY         52740021
*                                      LOCATION                         52800021
         SR    PARLIST,PARLIST         SET POINTER TO X-U VALUES        52860021
GETLOOP  TM    PTSGSW,X'40'            FIRST POINT THIS CALL            52920021
         BO    INITIAL                 YES, INITIALIZE                  52980021
*                                                                       53040021
         TM    MODE,X'80'              IF VALUES DERIVED FROM           53100021
         BO    INC                     TABLE,                           53160021
         L     EVNACC,UINDEX(PARLIST)  GET INDEX FACTOR TO TABLE        53220021
         MH    EVNACC,H4                                                53280021
         A     EVNACC,UTAB(PARLIST)    ADD ADDRESS OF LAST ENTRY USED   53340021
         ST    EVNACC,UTAB(PARLIST)    STORE ADDRESS OF CURRENT ENTRY   53400021
*                                                                       53460021
         TM    MODE,X'40'              IF VALUES INCREMENTAL            53520021
         BZ    ABS                                                      53580021
INCRMNT  TM    MODE,X'10'              CHECK MODE                       53640021
         BZ    FXINC                                                    53700021
         LE    FPACC,U(PARLIST)        EVALUATE NEW VALUE               53760021
         AE    FPACC,0(EVNACC)         IN FLOATING-POINT                53820021
         STE   FPACC,U(PARLIST)        AND STORE                        53880021
         B     SCALE                                                    53940021
*                                                                       54000021
FXINC    L     ODDACC,U(PARLIST)       EVALUATE NEW VALUE               54060021
         A     ODDACC,0(EVNACC)        IN INTEGER                       54120021
         ST    ODDACC,U(PARLIST)       AND STORE                        54180021
         B     SCALE                                                    54240021
*                                                                       54300021
INC      LA    EVNACC,UINCR(PARLIST)   GET ADDRESS OF FIXED INCREMENT   54360021
         B     INCRMNT                                                  54420021
*                                                                       54480021
INITIAL  L     EVNACC,UADDR(PARLIST)   GET ADDRESS OF FIRST ENTRY       54540021
         ST    EVNACC,UTAB(PARLIST)    INITIALIZE BOOKEEPING            54600021
*                                                                       54660021
ABS      L     ACC,0(EVNACC)           GET ABSOLUTE VALUE               54720021
         ST    ACC,U(PARLIST)          OF COORDINATE                    54780021
*                                                                       54840021
SCALE    CLI   S,C'B'                  IF SCALING NOT REQUESTED         54900021
         BNE   SKPSC                   SKIP IT                          54960021
         L     ODDACC,XALTER(PARLIST)  GET MULTIPLICATIVE CONSTANT      55020021
         LTR   ODDACC,ODDACC           IF SCALING CONSTANTS HAVE        55080021
         BZ    SCINT                   CHANGED, REEVALUATE              55140021
SCALE1   TM    MODE,X'10'              CHECK MODE                       55200021
         BZ    FXSCL                   INTEGER                          55260021
*                                                                       55320021
         LE    FPACC,XALTER(PARLIST)   MULTIPLY COORDINATE AND          55380021
         ME    FPACC,U(PARLIST)        MULTIPLICATIVE CONSTANT          55440021
         AE    FPACC,XCON(PARLIST)     ADD ADDITIVE CONSTANT            55500021
         STE   FPACC,OPTIMSV(PARLIST)  STORE SCALED VALUE               55560021
FIXVAL   ST    PARLIST,0(SAVEREG)      PRESERVE POINTER                 55620021
         LA    PARLIST,OPTIMSV(PARLIST)                                 55680021
         BAL   RETREG,FIX              CONVERT COORDINATE TO INTEGER    55740021
         L     PARLIST,0(SAVEREG)      GET POINTER                      55800021
         LTR   ENTREG,ENTREG                                            55860021
         BZ    VTEST                                                    55920021
         L     SAVEREG,4(SAVEREG)      ERROR(S) IN CONVERSION           55980021
         RETURN (14,12),RC=(15)        IMMEDIATE RETURN                 56040021
*                                                                       56100021
FXSCL    L     ODDACC,XALTER(PARLIST)  SCALE POINT                      56160021
         M     EVNACC,U(PARLIST)       USING                            56220021
         SRDA  EVNACC,12               INTEGER                          56280021
         A     ODDACC,XCON(PARLIST)    ARITMETIC                        56340021
         ST    ODDACC,OPTIMSV(PARLIST) AND STORE                        56400021
VTEST    LTR   PARLIST,PARLIST         IF NON-ZERO,                     56460021
         BC    7,GETERM                EXIT                             56520021
*                                                                       56580021
         MVC   MODE(1),VMODE           SET UP VALUES FOR                56640021
         LA    PARLIST,4               V-Y VALUES                       56700021
         B     GETLOOP                                                  56760021
SKPSC    L     ODDACC,U(PARLIST)       SET COORDINATE = UNSCALED        56820021
         ST    ODDACC,OPTIMSV(PARLIST) VALUE                            56880021
         TM    MODE,X'10'              CONVERT TO INTEGER               56940021
         BO    FIXVAL                  IF NECESSARY                     57000021
         B     VTEST                                                    57060021
SCINT    TM    MODE,X'10'              CHECK MODE                       57120021
         BO    FLTSCALE                CALL                             57180021
FIXSCALE L     ACC,GX2(PARLIST)        COMPUTE FIFFERENCE OF            57240021
         S     ACC,GX1(PARLIST)        GRID LIMITS                      57300021
         L     ACC1,SX2(PARLIST)       COMPUTE DIFFERENCE OF            57360021
         S     ACC1,SX1(PARLIST)       SCREEN LIMITS                    57420021
         L     ACC2,DX2(PARLIST)       COMPUTE DIFFERENCE OF            57480021
         S     ACC2,DX1(PARLIST)       DATA LIMITS                      57540021
         BC    12,RC16                 ILLEGAL DATA LIMITS              57600021
*                                                                       57660021
         L     ODDACC,FOURK            GET CONSTANT                     57720021
         MR    EVNACC,ACC              MULTIPLY BY GRID DIFFERENCE      57780021
         SLDA  EVNACC,12               SCALE TO PERMIT CONSTANTS        57840021
*                                      LESS THAN 1                      57900021
         DR    EVNACC,ACC1             DIVIDE BY DIFFERENCE IN SCREEN   57960021
         LR    EVNACC,ODDACC           AND DATA LIMITS                  58020021
         SRDA  EVNACC,32                                                58080021
         DR    EVNACC,ACC2                                              58140021
         ST    ODDACC,XALTER(PARLIST)  STORE MULTIPLICATIVE CONSTANT    58200021
*                                                                       58260021
         LR    ODDACC,ACC              COMPUTE 4095(GX2-GX1)            58320021
         M     EVNACC,FOURK                                             58380021
         SLDA  EVNACC,16               SCALE TO IMPROVE ACCURACY        58440021
         DR    EVNACC,ACC1             DIVIDE BY SX2-SX1                58500021
         M     EVNACC,DX1(PARLIST)     GET REST OF NUMERATOR            58560021
         SRDA  EVNACC,16               REMOVE SCALING FACTOR            58620021
         DR    EVNACC,ACC2             DIVIDE BY DX2-DX1                58680021
         ST    ODDACC,DELTAX           STORE COMPLETED TERM             58740021
*                                                                       58800021
         L     ODDACC,GX1(PARLIST)     COMPUTE GX1-SX1                  58860021
         S     ODDACC,SX1(PARLIST)                                      58920021
         M     EVNACC,FOURK            COMPUTE 4095(GX1-SX1)            58980021
         DR    EVNACC,ACC1             FINISH COMPUTATION OF TERM       59040021
         S     ODDACC,DELTAX           COMPUTE FULL ADDITIVE SONSTANT   59100021
         ST    ODDACC,XCON(PARLIST)    AND STORE IT                     59160021
         B     SCALE1                              ROUTINE              59220021
FLTSCALE LE    FPACC,GX2(PARLIST)      COMPUTE  G2-G1                   59280021
         SE    FPACC,GX1(PARLIST)                                       59340021
         LE    FPACC1,SX2(PARLIST)     COMPUTE  S2-S1                   59400021
         SE    FPACC1,SX1(PARLIST)                                      59460021
         LE    FPACC2,DX2(PARLIST)     COMPUTE  D2-D1                   59520021
         SE    FPACC2,DX1(PARLIST)                                      59580021
         BC    12,RC16                 ILLEGAL DATA LIMITS              59640021
*                                                                       59700021
         LE    FPACC3,FOURKE           GET CONSTANT (4096)              59760021
         MER   FPACC3,FPACC            MULTIPLY BY DIFFERENCE IN        59820021
*                                      GRID LIMITS                      59880021
         DER   FPACC3,FPACC1           DIVIDE BY DIFFERENCE IN SCREEN   59940021
*                                      LIMITS                           60000021
         DER   FPACC3,FPACC2           DIVIDE BY DIFFERENCE IN DATA     60060021
*                                      LIMITS                           60120021
         STE   FPACC3,XALTER(PARLIST)  STORE MULTIPLICATIVE CONSTANT    60180021
*                                                                       60240021
         LE    FPACC3,GX1(PARLIST)     COMPUTE G1-S1                    60300021
         SE    FPACC3,SX1(PARLIST)                                      60360021
         MER   FPACC3,FPACC2           COMPUTE (G1-S1)(D2-D1)           60420021
         ME    FPACC,DX1(PARLIST)      COMPUTE (D1)(G2-G1)              60480021
         SER   FPACC3,FPACC            COMPUTE VARIABLE PART OF         60540021
*                                      NUMERATOR                        60600021
         ME    FPACC3,FOURKE           COMPUTE COMPLETE NUMERATOR       60660021
         DER   FPACC3,FPACC1           DIVIDE BY DIFFERENCES IN SCREEN  60720021
         DER   FPACC3,FPACC2           AND DATA DIFFERENCES             60780021
         STE   FPACC3,XCON(PARLIST)    STORE ADDITIVE CONSTANT          60840021
*                                                                       60900021
         B     SCALE1                              SCALING CONSTANTS    60960021
*                                                                       61020021
GETERM   MVC   DELTAX(8),OPTIMSV       GET NEW COORDINATES              61080021
         L     SAVEREG,4(SAVEREG)      GET POINTER TO SAVE AREA         61140021
         RETURN (14,12),RC=0                                            61200021
*                                                                       61260021
*        ILLEGAL DATA LIMITS                                            61320021
RC16     L     SAVEREG,4(SAVEREG)      GET POINTER TO SAVE AREA         61380021
         RETURN (14,12),RC=16                                           61440021
*                                                                       61500021
FOURK    DC    F'4095'                                                  61560021
FOURKE   DC    E'4095'                                                  61620021
BEAM     DC    X'0FFFFFFF'                                              61680021
*                                                                       61740021
FIX      SAVE  (14,12)                                                  61800021
         SR    ENTREG,ENTREG                                            61860021
         L     ODDACC,0(PARLIST)       GET MANTISSA OF NUMBER           61920021
         N     ODDACC,MANTISSA         TO BE CONVERTED                  61980021
         LH    EVNACC,0(PARLIST)       GET CHARACTERISTIC OF            62040021
         N     EVNACC,CHAR             NUMBER TO BE CONVERTED           62100021
         BZ    RC12                    IF ZERO, CHECK FOR ZERO MANTISSA 62160021
         SRA   EVNACC,6                                                 62220021
         SH    EVNACC,H256             SEE IF NUMBER CAN BE CONVERTED   62280021
         BC    12,UNDERFLO             NO, EXPONENT LESS THAN 0         62340021
         CH    EVNACC,H32                                               62400021
         BH    OVERFLOW                NO, EXPONENT GREATER THAN 8      62460021
         BE    POSOVER                 OVERFLOW POSSIBLE ON CONVERSION  62520021
         SH    EVNACC,H24              GET SHIFT COUNT FOR MANTISSA     62580021
         BP    LFTSHIFT                POSITIVE, SHIFT LEFT             62640021
         LPR   EVNACC,EVNACC           NEGATIVE, CONVERT TO PROPER      62700021
         SRA   ODDACC,0(EVNACC)        SHIFT COUNT AND SHIFT RIGHT      62760021
SIGN     TM    0(PARLIST),X'80'        NUMBER TO BE CONVERTED NEGATIVE  62820021
         BZ    STFIXED                 NO, JUST STORE IT                62880021
         LNR   ODDACC,ODDACC           YES, COMPLEMENT IT               62940021
STFIXED  ST    ODDACC,0(PARLIST)                                        63000021
         RETURN (14,12),RC=(15)                                         63060021
*                                                                       63120021
LFTSHIFT SLA   ODDACC,0(EVNACC)        SHIFT MANTISSA LEFT              63180021
         B     SIGN                    CHECK SIGN                       63240021
*                                                                       63300021
UNDERFLO SR    ODDACC,ODDACC           SET NUMBER TO 0                  63360021
         B     STFIXED                                                  63420021
*                                                                       63480021
POSOVER  TM    1(PARLIST),X'80'        HIGH-ORDER BIT OF MANTISSA=1     63540021
         BZ    LFTSHIFT                NO, OVERFLOW WILL NOT OCCUR ON   63600021
*                                      CONVERSION                       63660021
OVERFLOW SR    ODDACC,ODDACC           SET NUMBER =0                    63720021
         LA    ENTREG,16               SET RETURN CODE                  63780021
         B     STFIXED                                                  63840021
*                                                                       63900021
RC12     LTR   ODDACC,ODDACC           IF MANTISSA                      63960021
         BZ    UNDERFLO                IS NON-ZERO                      64020021
         LA    ENTREG,12               SET RETURN CODE                  64080021
         B     UNDERFLO                                                 64140021
H24      DC    H'24'                                                    64200021
H32      DC    H'32'                                                    64260021
H256     DC    H'256'                                                   64320021
         DS    0F                                                       64380021
CHAR     DC    X'00007F00'             MASK FOR CHARACTERISTIC          64440021
MANTISSA DC    X'00FFFFFF'             MASK FOR MANTISSA                64500021
DISPLACE SAVE  (14,12)                 SAVE GENERAL REGISTERS           64560021
*                                                                       64620021
*   DO NOT SET UP SAVE AREA SINCE LOWESR LEVEL SUBROUTINE               64680021
*                                                                       64740021
         LA    ABIND,WRKAR             GET ADDRESS OF TEMPORARY         64800021
         LH    INCIND,ABSPTS           ORDER STORAGE AREAS              64860021
         MH    INCIND,H4                                                64920021
         AR    INCIND,ABIND                                             64980021
         LH    COUNT,ABSPTS            GET NO. OF ABSOLUTE VECTORS      65040021
         XC    INCPTS(2),INCPTS        SET NO. OF INCREMENTAL PTS.=0    65100021
         LTR   COUNT,COUNT             NO ABSOLUTE VECTORS,             65160021
         BZ    DISPRET                 GENERATE NO INCREMENTAL          65220021
         LA    EVNACC,CURMOD           GET NUMBER OF AVAILABLE BYTES    65280021
         SR    EVNACC,INCIND           IN THE WORK AREA                 65340021
         SRA   EVNACC,1                AND NUMBER OF INCREMENTAL        65400021
*                                      VECTORS THAT WILL FIT            65460021
         STH   EVNACC,BTCNT            AND STORE                        65520021
*                                                                       65580021
*   COMPUTE DISPLACEMENT TO NEXT POINT                                  65640021
*                                                                       65700021
NEXT     LH    EVNACC,XP               CURRENT X                        65760021
         N     EVNACC,REDUCE           ELIMINATE LOW-ORDE 2 BITS        65820021
         LH    ODDACC,0(ABIND)         NEXT X                           65880021
         N     ODDACC,HALFBEAM         ELIMINATE BEAM BIT               65940021
         SR    ODDACC,EVNACC           GET X-DISPLACEMENT               66000021
         ST    ODDACC,DELTAX           AND STORE                        66060021
*                                                                       66120021
         LH    EVNACC,YP               CURRENT Y                        66180021
         N     EVNACC,REDUCE           ELININATE LOW-ORDER 2 BITS       66240021
         LH    ODDACC,2(ABIND)         NEXT Y                           66300021
         SR    ODDACC,EVNACC           GET Y-DISPLACEMENT               66360021
         ST    ODDACC,DELTAY           AND STORE                        66420021
*                                                                       66480021
*                                                                       66540021
SPLITU   L     EVNACC,DELTAX           GET MAGNITUDE OF                 66600021
         LPR   MAGDELX,EVNACC          X-DISPLACEMENT                   66660021
         L     ODDACC,DELTAY           GET MAGNITUDE OF                 66720021
         LPR   MAGDELY,ODDACC          Y-DISPLACEMENT                   66780021
         CR    MAGDELX,MAGDELY                                          66840021
         BL    YHIU                    Y GREATER                        66900021
         BE    XEQYU                   EQUAL                            66960021
*                                      X GREATER                        67020021
         TM    DELTAX,X'80'            SEE IF DELTAX NEGATIVE           67080021
         BO    XHIN                                                     67140021
         LA    DELX,252                NO, ASSUME = 252 FOR STEP        67200021
         LA    ODDACC,252                                               67260021
         B     XHIUC                                                    67320021
XHIN     LH    DELX,LOWLIM             DELTAX NEGATIVE, ASSUME = -256   67380021
         LH    ODDACC,LOWLIM                                            67440021
XHIUC    M     EVNACC,DELTAY           GET Y DISPLACEMENT FOR STEP      67500021
         D     EVNACC,DELTAX                                            67560021
         LR    DELY,ODDACC             SAVE Y DISPLACEMENT              67620021
*                                                                       67680021
NOXS     L     EVNACC,DELTAX           GET NUMBER OF VECTORS            67740021
         SRDA  EVNACC,32               WITH LENGTH DELX                 67800021
         DR    EVNACC,DELX             TO DISPLAY ONE WITH              67860021
         LR    NINC,ODDACC             LENGTH DELTAX                    67920021
*                                                                       67980021
REMU     L     RX,DELTAX               COMPUTE X-DISPLACEMENT           68040021
         LR    ODDACC,DELX             REMAINING AFTER FIXED            68100021
         MR    EVNACC,NINC             LENGTH VECTORS USED              68160021
         SR    RX,ODDACC                                                68220021
*                                                                       68280021
         L     RY,DELTAY               COMPUTE Y-DISPLACEMENT           68340021
         LR    ODDACC,DELY             REMAINING AFTER                  68400021
         MR    EVNACC,NINC             OTHER VECTORS USED               68460021
         SR    RY,ODDACC                                                68520021
*                                                                       68580021
         SR    ERRX,ERRX               SET BOTH ERRORS                  68640021
         SR    ERRY,ERRY               TO ZERO                          68700021
*                                                                       68760021
CONVRTU  CH    NINC,BTCNT              MORE VECTORS NECESSARY THAN      68820021
*                                      WILL FIT INTO THE WORKAREA       68880021
         BNL   WRKOVER                 PREPARE FOR WORKAREA OVERFLOW    68940021
         LA    ACC,1                   ADD N+1                          69000021
         AH    ACC,INCPTS              TO NUMBER                        69060021
         AR    ACC,NINC                OF INCREMENTAL                   69120021
         STH   ACC,INCPTS              DATA POINTS                      69180021
         LTR   NINC,NINC               ONLY ONE INCREMENTAL VECTOR      69240021
         BZ    LASTSEG                 YES                              69300021
*                                                                       69360021
CNVRTLPU AR    ERRX,DELX               ADD CUMULATIVE ERROR TO          69420021
         L     ACC,REDUCE              X-DISPLACEMENT.                  69480021
         NR    ACC,ERRX                ELIMINATE LOW-ORDER 2 BITS       69540021
         SR    ERRX,ACC                GET ERROR FROM THIS STEP         69600021
         SRA   ACC,1                   CONVERT X-DISPLACEMENT           69660021
         STC   ACC,0(INCIND)           TO INCREMENTAL DATA FROM         69720021
         OI    0(INCIND),X'01'         AND STORE                        69780021
*                                                                       69840021
         AR    ERRY,DELY               ADD CUMULATIVE ERROR TO          69900021
         L     ACC,REDUCE              Y-DISPLACEMENT                   69960021
         NR    ACC,ERRY                ELIMINATE LOW-ORDER 2 BITS       70020021
         SR    ERRY,ACC                GET ERROR FROM THIS STEP         70080021
         SRA   ACC,1                   CONVERT Y-DISPLACEMENT TO        70140021
         STC   ACC,1(INCIND)           INCREMENTAL DATA FORM & STORE    70200021
         TM    0(ABIND),X'40'          IF ABSOLUTE VECTOR               70260021
         BO    BLNKPT                  BLANKED, BLANK                   70320021
         TM    PTSGSW,X'10'            BLANK BEAM                       70380021
         BO    UPDTU                   IF POINT PLOT                    70440021
BLNKPT   OI    1(INCIND),X'01'         REQUESTED                        70500021
*                                                                       70560021
UPDTU    LA    INCIND,2(INCIND)        INCREMENT POINTER TO WORKAREA    70620021
         BCT   NINC,CNVRTLPU           PROCESS NEXT SEGMENT             70680021
*                                                                       70740021
LASTSEG  AR    ERRX,RX                 LAST SEGMENT-ADD CUMULATIVE      70800021
         L     ACC,REDUCE              ERROR TO X-REMAINDER             70860021
         NR    ACC,ERRX                ELIMINATE LOW-ORDER 2 BITS       70920021
         SRA   ACC,1                   CONVERT TO INCREMENTAL DATA      70980021
         STC   ACC,0(INCIND)           FORM AND STORE                   71040021
         OI    0(INCIND),X'01'                                          71100021
*                                                                       71160021
         AR    ERRY,RY                 ADD CUMULATIVE ERROR TO          71220021
         L     ACC,REDUCE              Y-REMAINDER                      71280021
         NR    ACC,ERRY                ELIMINATE LOW-ORDER 2 BITS       71340021
         SRA   ACC,1                   CONVERT TO INCREMENTAL DATA FORM 71400021
         STC   ACC,1(INCIND)           & STORE WITH BEAM INTENSIFIED    71460021
         TM    0(ABIND),X'40'          IF ABSOLUTE VECTOR               71520021
         BZ    ENDTEST                 BLANKED, BLANK                   71580021
         OI    1(INCIND),X'01'         INCREMENTAL                      71640021
*                                                                       71700021
ENDTEST  MVC   XP(4),0(ABIND)          UPDATE PHYSICAL BEAM POSITION    71760021
         NI    XP,X'0F'                TURN OFF BEAM BIT                71820021
         LA    INCIND,2(INCIND)        INCREMENT                        71880021
         LA    ABIND,4(ABIND)                    POINTERS               71940021
         BCT   COUNT,NEXT              BRANCH BACK IF NOT FINISHED      72000021
*                                      AND GO THROUGH THE LOOP AGAIN    72060021
DISPRET  RETURN (14,12),RC=0           IF FINISHED, RETURN TO CALLING   72120021
*                                      PROGRAM                          72180021
*                                                                       72240021
*   ROUTINE TO SPLIT VECTOR INTO SMALLER ONES-UNBLANKED                 72300021
*                                                                       72360021
YHIU     TM    DELTAY,X'80'            SEE IF DELTAY NEGATIVE           72420021
         BO    YHIN                                                     72480021
         LA    DELY,252                NO, ASSUME = 252 FOR STEP        72540021
         LA    ODDACC,252                                               72600021
         B     YHIUC                                                    72660021
YHIN     LH    DELY,LOWLIM             DELTAY NEGATIVE, ASSUME = -256   72720021
         LH    ODDACC,LOWLIM           FOR STEP                         72780021
*                                                                       72840021
YHIUC    M     EVNACC,DELTAX           GET X-DISPLACEMENT FOR STEP      72900021
         D     EVNACC,DELTAY                                            72960021
         LR    DELX,ODDACC             AND SAVE IT                      73020021
         L     EVNACC,DELTAY           GET NUMBER OF                    73080021
         SRDA  EVNACC,32               FIXED-LENGTH                     73140021
         DR    EVNACC,DELY             VECTORS TO BE                    73200021
         LR    NINC,ODDACC             DISPLAYED                        73260021
*                                                                       73320021
         B     REMU                                                     73380021
*                                                                       73440021
XEQYU    LA    DELX,252                ASSUME DISPLACEMENTS OF          73500021
         LA    DELY,252                252 MAGNITUDE                    73560021
         TM    DELTAX,X'80'            IF DELTAX IS NAGATIVE,           73620021
         BZ    XEQU                                                     73680021
         LNR   DELX,DELX               MAKE DELX NEGATIVE               73740021
*                                                                       73800021
XEQU     TM    DELTAY,X'80'            GET SIGN OF DELTAY               73860021
         BZ    YEQU                    AND ADJUST SIGN OF DISPLACEMENT  73920021
         LNR   DELY,DELY               TO AGREE                         73980021
*                                                                       74040021
YEQU     B     NOXS                                                     74100021
*                                                                       74160021
WRKOVER  RETURN (14,12),RC=36                                           74220021
*                                                                       74280021
         DS    0F                                                       74340021
REDUCE   DC    X'FFFFFFFC'                                              74400021
HALFBEAM DC    X'00000FFF'                                              74460021
SGCHECK  SAVE  (14,12)                                                  74520021
         LR    PARBASE,ACC             ADDRESSABILITY FOR PARAMETERS    74580021
         USING SGPAR,PARBASE                                            74640021
*                                                                       74700021
         LA    PARLIST,SVAR2           CHAIN SAVE                       74760021
         ST    SAVEREG,4(PARLIST)                 AREAS                 74820021
         ST    PARLIST,8(SAVEREG)                                       74880021
         LR    SAVEREG,PARLIST                                          74940021
*                                                                       75000021
         MVI   MODE,X'C0'              SAVE FLAGS,                      75060021
         NC    MODE(1),PTPOS           IF ANY                           75120021
         IC    PARLIST,PTPOS           SET POSITION OF                  75180021
         SRL   PARLIST,3               INITIAL POINT OF VECTOR          75240021
         STC   PARLIST,PTPOS           EQUAL TO POSITION OF             75300021
         NI    PTPOS,X'07'             TERMINAL POINT OF LAST VECTOR    75360021
         OC    PTPOS(1),MODE           RESTORE FLAG                     75420021
*                                                                       75480021
         LM    EVNACC,ODDACC,NXTX      GET NEXT POINT                   75540021
         STM   EVNACC,ODDACC,PT2X      STORE IN DATA AREA FOR           75600021
*                                      SCISSORING ROUTINE               75660021
*                                                                       75720021
         CH    EVNACC,X1               X VALUE WITHIN GRID              75780021
         BL    XSCR                    NO                               75840021
         CH    EVNACC,X2               MAYBE                            75900021
         BH    XSCR                    NO                               75960021
         CH    ODDACC,Y1               Y VALUE WITHIN GRID              76020021
         BL    YSCR                    NO                               76080021
         CH    ODDACC,Y2               MAYBE                            76140021
         BH    YSCR                    NO                               76200021
         OI    PTPOS,X'08'             POINT WITHIN GRID                76260021
         B     TEST                                                     76320021
*                                                                       76380021
XSCR     CH    EVNACC,ZERO             X VALUE WITHIN SCREEN            76440021
         BL    OFFSCR                  NO                               76500021
         CH    EVNACC,ZERO+4           MAYBE                            76560021
         BH    OFFSCR                  NO                               76620021
YSCR     CH    ODDACC,ZERO             Y VALUE WITHIN SCREEN            76680021
         BL    OFFSCR                  NO                               76740021
         CH    ODDACC,ZERO+4           MAYBE                            76800021
         BH    OFFSCR                  NO                               76860021
         OI    PTPOS,X'10'             POINT BETWEEN SCREEN & GRID      76920021
         B     TEST                                                     76980021
*                                                                       77040021
OFFSCR   OI    PTPOS,X'20'             POINT OFF- SCREEN                77100021
*                                                                       77160021
TEST     TM    PTPOS,X'07'             CALL JUST TO SET SWITCHES        77220021
         BZ    GETOUT                  FOR INITIAL POINT-- EXIT         77280021
*                                                                       77340021
         TM    PTSGSW,X'10'            POINT PLOT                       77400021
         BZ    PTPLTCHK                YES - CHECK IT                   77460021
         TM    PTPOS,X'09'             VECTOR PLOT- BOTH POINTS         77520021
         BO    ONEPLOT                 WITHIN GRID, ADJUSTED X,Y VALUES 77580021
*                                      = INPUT VALUES                   77640021
         TM    PTSGSW,X'02'            SHOW ALL POINTS IN SCREEN        77700021
         BZ    GRDSCIS                 NO                               77760021
         TM    PTPOS,X'24'             YES. BOTH POINTS ON SCREEN       77820021
         BZ    ONEPLOT                 YES, PLOT VECTOR                 77880021
         MVI   MODE,X'04'              MASKS FOR PT1                    77940021
         MVI   MODE+1,X'20'            AND PT2 OUTSIDE BOUNDARY         78000021
         LA    PARLIST,ZERO            BOUNDARY                         78060021
         B     SCRTSTA                                                  78120021
*                                                                       78180021
GRDSCIS  MVI   MODE,X'06'              MASKS FOR PT1                    78240021
         MVI   MODE+1,X'30'            AND PT2 OUTSIDE BOUNDARY         78300021
         LA    PARLIST,X1              BOUNDARY                         78360021
SCRTSTA  TM    BV21,X'FF'              INCREMENTAL POSITIONING          78420021
         BO    SPTST                   CONFINE TERMINATION TESTS        78480021
*                                      TO SECOND VECTOR ONLY            78540021
         TM    PTPOS,X'24'             EITHER POINT OFF SCREEN          78600021
         BZ    GRDTSTA                 NO, TEST FOR GRID TERMINATION    78660021
SCRTST   TM    PTSGSW,X'08'            TERMINATE IF SCREEN EXCEEDED     78720021
         BO    SCRNTERM                YES                              78780021
*                                                                       78840021
*                                      TO SECOND POINT ONLY             78900021
GRDTSTA  TM    BV21,X'FF'              INCREMENTAL POSITIONING          78960021
         BO    SPTST2                  YES, CONFINE TERMINATION TESTS   79020021
GRDTST   TM    PTSGSW,X'04'            TERMINATE IF GRID EXCEEDED       79080021
         BO    GRIDTERM                YES                              79140021
GRDTSTB  ST    PARLIST,SABL            STORE POINTER TO BOUNDARY        79200021
*                                                                       79260021
         MVC   PT1X(8),X               PREVIOUS POINT                   79320021
*                                                                       79380021
         LOAD  EP=GOFFSG               LOAD OFF SCREEN/OFF GRID ROUTINE 79440021
         LR    ENTREG,ACC              GET ADDRESS OF ENTRY POINT       79500021
         LA    PARLIST,SABL            POINTER TO PARAMETER LIST        79560021
         CALL  (15)                    CALL IT                          79620021
         DELETE EP=GOFFSG                                               79680021
*                                                                       79740021
         L     EVNACC,NI               GET NUMBER OF INTERSECTIONS      79800021
         CH    EVNACC,H1                                                79860021
         BE    ONEINTS                 ONE                              79920021
         BH    TWOINTS                 TWO                              79980021
         IC    EVNACC,MODE+1           ZERO- IS END POINT ON BOUNDARY   80040021
         EX    EVNACC,TSTPOS                                            80100021
         BC    7,SUPRESS               NO, SUPRESS PLOT                 80160021
ONEPLOTB MVC   ADJX1(2),PT2X+2         YES, POSITION BEAM               80220021
         MVC   ADJY1(2),PT2Y+2                                          80280021
         MVI   BV1,X'FF'               BLANK BEAM                       80340021
         B     ONEPLT                                                   80400021
*                                                                       80460021
ONEINTS  IC    EVNACC,MODE             FIRST POINT IN BOUNDARY          80520021
         EX    EVNACC,TSTPOS                                            80580021
         BZ    ONEPLOTS                YES                              80640021
         IC    EVNACC,MODE+1           NO. SECOND POINT IN BOUNDARY     80700021
         EX    EVNACC,TSTPOS                                            80760021
         BC    7,SUPRESS               NO, SUPPRESS PLOT                80820021
         MVC   ADJX1(4),INTS1X         POSITION TO INTERSECTION         80880021
         MVC   ADJX2(2),PT2X+2         DRAW TO SECOND POINT             80940021
         MVC   ADJY2(2),PT2Y+2                                          81000021
TWOPLT   MVI   PTCNT,X'FF'             TWO VECTORS                      81060021
         MVI   BV1,X'FF'               FIRST ONE BLANKED                81120021
         MVI   SUPLT,X'00'             ALLOW PLOT                       81180021
         B     GETOUT                                                   81240021
*                                                                       81300021
ONEPLOTS MVC   ADJX1(4),INTS1X         PLOT TO POINT OF INTERSECTION    81360021
         MVI   BV1,X'00'               UNBLANKED                        81420021
         TM    PTSGSW,X'02'            SCISSORING AT GRID               81480021
         BZ    RC44                    YES                              81540021
         B     RC48                    NO                               81600021
*                                                                       81660021
TWOINTS  MVC   ADJX1(8),INTS1X         PLOT FROM FIRST TO SECOND        81720021
         B     TWOPLT                  INTERSECTION POINTS              81780021
*                                                                       81840021
ONEPLOT  MVC   ADJX1(2),PT2X+2         MOVE INPUT DATA INTO             81900021
         MVC   ADJY1(2),PT2Y+2         OUTPUT LOCATION                  81960021
         MVI   BV1,X'00'               UNBLANKED                        82020021
ONEPLT   MVI   SUPLT,X'00'             PERMIT PLOT                      82080021
         MVI   PTCNT,X'0F'             OF ONE POINT                     82140021
GETOUT   L     SAVEREG,4(SAVEREG)      RETURN TO CALLING                82200021
         RETURN (14,12),RC=0           ROUTINE                          82260021
*                                                                       82320021
SPTST    TM    PTPOS,X'20'             SECOND POINT OFF SCREEN          82380021
         BO    SCRTST                  TEST FOR OFF SCREEN TERMINATION  82440021
SPTST2   TM    PTPOS,X'30'             SECOND POINT OFF GRID            82500021
         BO    GRDTST                  TEST FOR OFF GRID TERMINATION    82560021
         B     GRDTSTB                 NO, SCISSOR BUT DO NOT END       82620021
TSTPOS   TM    PTPOS,X'00'             TEST POINT POSITION SWITCH       82680021
*                                                                       82740021
GRIDTERM L     SAVEREG,4(SAVEREG)      IMMEDIATE TERMINATION IF GRID    82800021
         RETURN (14,12),RC=28          LIMITS EXCEEDED                  82860021
*                                                                       82920021
SCRNTERM L     SAVEREG,4(SAVEREG)      IMMEDIATE TERMINATION IF SCREEN  82980021
         RETURN (14,12),RC=32          LIMITS EXCEEDED                  83040021
*                                                                       83100021
RC44     CLC   RETCD(2),ZERO           IF NOT FIRST ERROR DETECTED,     83160021
         BE    RC44A                                                    83220021
         MVI   RETCD,X'80'             SET HIGH ORDER BIT OF RC         83280021
RC44A    MVI   RETCD+1,44              SET RETURN CODE IN WORKAREA=44   83340021
         B     ONEPLT                                                   83400021
*                                                                       83460021
RC48     CLC   RETCD(2),ZERO           IF NOT FIRST ERROR DETECTED      83520021
         BE    RC48A                                                    83580021
         MVI   RETCD,X'80'             SET HIGH-ORDER BIT OF RC         83640021
RC48A    MVI   RETCD+1,48              SET RETURN CODE IN WORKAREA=48   83700021
         B     ONEPLT                                                   83760021
PTPLTCHK MVC   ADJX1(2),NXTX+2         SET UP COORDINATES OF POINT      83820021
         MVC   ADJY1(2),NXTY+2                                          83880021
         TM    PTPOS,X'08'             POINT WITHIN GRID                83940021
         BO    ONEPLOT                 PLOT IT AS IS                    84000021
         TM    PTSGSW,X'04'            TERMINATE IF                     84060021
         BO    GRIDTERM                GRID LIMITS EXCEEDED             84120021
         TM    PTPOS,X'10'             POINT BETWEEN SCREEN AND GRID    84180021
         BZ    PTOFFSCR                NO- OFF SCREEN                   84240021
         TM    PTSGSW,X'02'            YES. PLOT ALL POINTS ON SCREEN   84300021
         BO    ONEPLOT                 YES.                             84360021
         B     SUPRESS                 NO. SUPPRESS PLOT                84420021
*                                                                       84480021
PTOFFSCR TM    PTSGSW,X'08'            TERMINATE IF SCREEN LIMITS       84540021
         BO    SCRNTERM                EXCEEDED                         84600021
SUPRESS  MVI   SUPLT,X'FF'             SUPRESS PLOT OF POINT            84660021
         MVI   PTCNT,X'00'             SET POINT COUNT =0               84720021
         MVI   ABSPTS,X'00'            SET ABSOLUTE POINT COUNT =0      84780021
         B     GETOUT                                                   84840021
*                                                                       84900021
*                                                                       84960021
*                                                                       85020021
ZERO     DC    H'0,0'                  SCREEN LIMITS- LOWER LEFT CORNER 85080021
         DC    H'4095,4095'              -UPPER RIGHT CORNER            85140021
H1       DC    H'1'                                                     85200021
H2       DC    H'2'                                                     85260021
H3       DC    H'3'                                                     85320021
H4       DC    H'4'                                                     85380021
H5       DC    H'5'                                                     85440021
HILIM    DC    H'255'                  MAXIMUM POSITIVE INCREMENT       85500021
LOWLIM   DC    H'-256'                 MAXIMUM NEGATIVE INCREMENT       85560021
GEPM     DC    X'2A00'                 SET MODE ABSOLUTE POINT          85620021
GEVM     DC    X'2A02'                 SET MODE ABSOLUTE VECTOR         85680021
GEPI2    DC    X'2A04'                 SET MODE INCREMENTAL POINT       85740021
GEVI2    DC    X'2A05'                 SET MODE INCREMENTAL VECTOR      85800021
         END                                                            85860021
