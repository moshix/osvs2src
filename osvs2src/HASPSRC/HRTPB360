HRTP     TITLE 'SYSTEM/360 WORK STATION PROGRAM - PROLOGUE'             V0001000
*********************************************************************** V0002000
*                                                                     * V0003000
* MODULE NAME = HRTPB360                                              * V0004000
*                                                                     * V0005000
* DESCRIPTIVE NAME = SYSTEM/360 WORK STATION PROGRAM                  * V0006000
*                                                                     * V0007000
* COPYRIGHT = NONE                                                    * V0008000
*                                                                     * V0009000
* STATUS = OS/VS2 RELEASE 2, LEVEL 0                                  * V0010000
*                                                                     * V0011000
* FUNCTION = TO PROVIDE THE SYSTEM/360 WORK STATION COMPONENT FOR RJE * V0012000
*            IMPLEMENTATION USING THE MULTI-LEAVING DISCIPLINE OF     * V0013000
*            RTAM.  THIS PROGRAM EXTENDS TO THE REMOTE LOCATION THE   * V0014000
*            FACILITIES OF LOCAL DEVICES SUCH AS OPERATOR CONSOLE     * V0015000
*            TYPEWRITER, CARD READER(S), CARD PUNCH(ES), HIGH SPEED   * V0016000
*            LINE PRINTER(S).  THE MODULE OPERATES IN A STAND-ALONE   * V0017000
*            ENVIRONMENT AND REQUIRES NO EXTERNAL SUPPORT PROGRAM.    * V0018000
*            THE SOURCE CODE IS ASSEMBLED USING THE OS/VS2 ASSEMBLER  * V0019000
*            F PROGRAM IN ORDER TO SHARE THE GENERATION PARAMETERS    * V0020000
*            USED TO QUALIFY THE HOST SYSTEM.  FOR AN EXPLANATION OF  * V0021000
*            THE INTERNAL PROGRAM OPERATION SEE OS/VS2 JES2 LOGIC.    * V0022000
*                                                                     * V0023000
* NOTES = SEE BELOW                                                   * V0024000
*                                                                     * V0025000
*    DEPENDENCIES = RTAM MULTI-LEAVING PROTOCOL                       * V0026000
*                                                                     * V0027000
*    RESTRICTIONS = NONE                                              * V0028000
*                                                                     * V0029000
*    REGISTER CONVENTIONS = SEE *SYMBOLIC REGISTER DEFINITIONS*       * V0030000
*                                                                     * V0031000
*    PATCH LABEL = NONE                                               * V0032000
*                                                                     * V0033000
* MODULE TYPE = STAND-ALONE PROGRAM                                   * V0034000
*                                                                     * V0035000
*    PROCESSOR = ASSEMBLER F                                          * V0036000
*                                                                     * V0037000
*    MODULE SIZE = AS SPECIFIED BY RMTGEN PARAMETER &CORESIZ          * V0038000
*                                                                     * V0039000
*    ATTRIBUTES = STAND-ALONE                                         * V0040000
*                                                                     * V0041000
* ENTRY POINT = REPLOAD                                               * V0042000
*                                                                     * V0043000
*    PURPOSE = SEE FUNCTION                                           * V0044000
*                                                                     * V0045000
*    LINKAGE = ENTERED FROM SYSTEM/360 LOAD PROGRAM VIA END CARD LABEL* V0046000
*                                                                     * V0047000
* INPUT = (1) OS/VS2 JOBSTREAM VIA 80 COLUMN CARD READER              * V0048000
*         (2) OPERATOR COMMANDS VIA TYPEWRITER KEYBOARD OR CARD READE * V0049000
*         (3) MULTI-LEAVING BLOCKS VIA T/P LINE FROM HOST PROCESSOR   * V0050000
*                                                                     * V0051000
* OUTPUT = (1) SYSTEM DIRECTED OUTPUT FROM HOST PROCESSOR VIA HIGH    * V0052000
*              SPEED LINE PRINTER OR 80 COLUMN CARD PUNCH             * V0053000
*          (2) RESPONSES TO OPERATOR COMMANDS VIA TYPEWRITER PRINTER  * V0054000
*          (3) MULTI-LEAVING BLOCKS VIA T/P LINE TO HOST PROCESSOR    * V0055000
*          (4) LOCALLY GENERATED OPERATOR MESSAGES                    * V0056000
*                                                                     * V0057000
* EXIT-NORMAL = NONE                                                  * V0058000
*                                                                     * V0059000
* EXIT-ERROR = NONE                                                   * V0060000
*                                                                     * V0061000
* EXTERNAL REFERENCES = NONE                                          * V0062000
*                                                                     * V0063000
*    ROUTINES = NONE                                                  * V0064000
*                                                                     * V0065000
*    DATA AREAS = NONE                                                * V0066000
*                                                                     * V0067000
*    CONTROL AREAS = NONE                                             * V0068000
*                                                                     * V0069000
* TABLES = (1) ERROR MESSAGE TABLE - SEE LABEL $LOGTAB                * V0070000
*          (2) TOTAL CONTROL TABLES                                   * V0071000
*                  CONTROL PROCESSOR - SEE LABEL $CTLTCT              * V0072000
*                  CONSOLE - SEE LABEL $CONTCT                        * V0073000
*                  PRINTER - SEE LABEL $PCOM1                         * V0074000
*                  READER - SEE LABEL $RCOM1                          * V0075000
*                  PUNCH - SEE LABEL $UCOM1                           * V0076000
*                                                                     * V0077000
* MACROS = ALL MACROS ARE LOCAL TO THE ASSEMBLY                       * V0078000
*                                                                     * V0079000
* CHANGE ACTIVITY                                                     * V0080000
*                                                                     * V0080100
*     RELEASE 4.0 = OZ04986,OZ07448,OZ07454,OZ09048,OZ09109           * V0080200
*                                                                     * V0080300
*     RELEASE 4.1 = OZ12280,OZ13217,OZ13240,OZ15819                   * V0080400
*                                                                     * V0081000
*********************************************************************** V0082000
         TITLE 'H A S P / R T P  *MACRO DEFINITIONS*(MODEL 20 INSTS.)'  V0083000
*                                                                       V0084000
*****   BAS    *****          BRANCH AND STORE                          V0085000
*                                                                       V0086000
         MACRO                                                          V0087000
&NAME    BAS   &R,&LOC                                                  V0088000
         GBLA  &MACHINE                                                 V0089000
&NAME    NULL                                                           V0090000
         AIF   (&MACHINE NE 20).ANOT20                                  V0091000
         DC    X'4D'                                                    V0092000
         DC    AL1(&R*16)                                               V0093000
         DC    S(&LOC)                                                  V0094000
         AGO   .END                                                     V0095000
.ANOT20  ANOP                                                           V0096000
         BAL   &R,&LOC                                                  V0097000
.END     MEND                                                           V0098000
         SPACE 4                                                        V0099000
*                                                                       V0100000
*****   BASR   *****          BRANCH AND STORE (R)                      V0101000
*                                                                       V0102000
         MACRO                                                          V0103000
&NAME    BASR  &R1,&R2                                                  V0104000
         GBLA  &MACHINE                                                 V0105000
&NAME    NULL                                                           V0106000
         AIF   (&MACHINE NE 20).ANOT20                                  V0107000
         DC    X'0D'                                                    V0108000
         DC    AL1(&R1*16+&R2)                                          V0109000
         AGO   .END                                                     V0110000
.ANOT20  ANOP                                                           V0111000
         BALR  &R1,&R2                                                  V0112000
.END     MEND                                                           V0113000
         SPACE 4                                                        V0114000
*                                                                       V0115000
*****   CIO    *****          CONTROL I/O                               V0116000
*                                                                       V0117000
         MACRO                                                          V0118000
&NAME    CIO   &A,&B                                                    V0119000
         GBLA  &MACHINE                                                 V0120000
&NAME    NULL                                                           V0121000
         AIF   (&MACHINE NE 20).ANOT20                                  V0122000
         DC    X'9B'                                                    V0123000
         DC    AL1(&B)                                                  V0124000
         DC    S(&A)                                                    V0125000
         AGO   .END                                                     V0126000
.ANOT20  ANOP                                                           V0127000
         BAL   R7,$IOSIM                                                V0128000
         DC    X'9B'                                                    V0129000
         DC    AL1(&B)                                                  V0130000
         DC    S(&A)                                                    V0131000
.END     MEND                                                           V0132000
         EJECT                                                          V0133000
*                                                                       V0134000
*        DIALS                     READ MOD 20 DIALS                    V0135000
*                                  DATA 1,2 IN LOC 252                  V0136000
*                                  ADDRESS 1,2,3,4 IN 253-254 DEC       V0137000
         MACRO                                                          V0138000
&NAME    DIALS &NULL                                                    V0139000
&NAME    DS    0H                                                       V0140000
         DC    X'83000300'         READ DIALS INTO CORE                 V0141000
         MEND                                                           V0142000
         SPACE 4                                                        V0143000
*                                                                       V0144000
*****   HPR    *****          HALT AND PROCEED                          V0145000
*                                                                       V0146000
*                                                                       V0147000
         MACRO                                                          V0148000
&NAME    HPR   &NUM                                                     V0149000
         GBLA  &MACHINE                                                 V0150000
&NAME    NULL                                                           V0151000
         AIF   (&MACHINE NE 20).ANOT20                                  V0152000
         DC    X'9900',S(&NUM)                                          V0153000
         AGO   .END                                                     V0154000
.ANOT20  ANOP                                                           V0155000
.END     MEND                                                           V0156000
         SPACE 4                                                        V0157000
*                                                                       V0158000
*****   TIOB   *****          TEST I/O AND BRANCH                       V0159000
*                                                                       V0160000
*                                                                       V0161000
         MACRO                                                          V0162000
&NAME    TIOB  &A,&B                                                    V0163000
         GBLA  &MACHINE                                                 V0164000
&NAME    NULL                                                           V0165000
         AIF   (&MACHINE NE 20).ANOT20                                  V0166000
         DC    X'9A'                                                    V0167000
         DC    AL1(&B)                                                  V0168000
         AIF   ('&A' EQ '*').A2                                         V0169000
         DC    S(&A)                                                    V0170000
         AGO   .END                                                     V0171000
.A2      ANOP                                                           V0172000
         DC    S(*-2)                                                   V0173000
         AGO   .END                                                     V0174000
.ANOT20  ANOP                                                           V0175000
         MNOTE 12,'***ERROR*** INVALID 360 INSTRUCTION'                 V0176000
.END     MEND                                                           V0177000
         EJECT                                                          V0178000
         SPACE 16                                                       V0179000
*                                                                       V0180000
*****   XIO    *****          TRANSFER I/O                              V0181000
*                                                                       V0182000
*                                                                       V0183000
         MACRO                                                          V0184000
&NAME    XIO   &A,&B                                                    V0185000
         GBLA  &MACHINE                                                 V0186000
&NAME    NULL                                                           V0187000
         AIF   (&MACHINE EQ 20).A20                                     V0188000
         MNOTE 12,'***ERROR*** INVALID 360 INSTRUCTION'                 V0189000
.A20     ANOP                                                           V0190000
         MVC   &A,&B     XIOXIOXIOXIOXIOXIO                             V0191000
         ORG   *-6       XIOXIOXIOXIOXIOXIO                             V0192000
         DC    X'D0'     XIOXIOXIOXIOXIOXIO                             V0193000
         ORG   *+5       XIOXIOXIOXIOXIOXIO                             V0194000
.END     MEND                                                           V0195000
 TITLE 'H A S P / R T P  *MACRO DEFINITIONS*(SYSTEM DEPENDENT AIDS)'    V0196000
*                                                                       V0197000
*        $AA                       ADD ADDRESS TO REGISTER(CONSTANT)    V0198000
*                                                                       V0199000
         MACRO                                                          V0200000
&NAME    $AA   &REG,&AMT                                                V0201000
         GBLA  &MACHINE                                                 V0202000
         AIF   (&MACHINE EQ 20).A1                                      V0203000
&NAME    LA    &REG,&AMT.(&REG)                                         V0204000
         MEXIT                                                          V0205000
.A1      ANOP                                                           V0206000
&NAME    AH    &REG,=Y(&AMT)                                            V0207000
         MEND                                                           V0208000
         SPACE 1                                                        V0209000
*                                                                       V0210000
*****    $ACON  *****              DEFINE AN ADDRESS CONST              V0211000
*                                                                       V0212000
         MACRO                                                          V0213000
&NAME    $ACON &ADDR                                                    V0214000
         GBLA  &HICORE                                                  V0215000
         AIF   (T'&ADDR EQ 'O').ZERO BR IF OPERAND OMITTED              V0216000
         AIF   (&HICORE GT 32).FULL  BR IF ADDR WILL EXCEED 32K         V0217000
         AIF   ('&ADDR'(1,1) NE '(').RA                                 V0218000
&NAME    DC    Y&ADDR                                                   V0219000
         MEXIT                                                          V0220000
.RA      ANOP                                                           V0221000
&NAME    DC    Y(&ADDR)                                                 V0222000
         MEXIT                                                          V0223000
.FULL    ANOP                                                           V0224000
         AIF   ('&ADDR'(1,1) NE '(').RB                                 V0225000
&NAME    DC    A&ADDR                                                   V0226000
         MEXIT                                                          V0227000
.RB      ANOP                                                           V0228000
&NAME    DC    A(&ADDR)                                                 V0229000
         MEXIT                                                          V0230000
.ZERO    ANOP                                                           V0231000
         AIF   (&HICORE GT 32).FULLZ BR IF ADDR WILL EXCEED 32K         V0232000
&NAME    DC    Y(0)                                                     V0233000
         MEXIT                                                          V0234000
.FULLZ   ANOP                                                           V0235000
&NAME    DC    A(0)                                                     V0236000
         MEND                                                           V0237000
         SPACE 1                                                        V0238000
*                                                                       V0239000
*        $ACONS                    DEFINE STORAGE FOR ADDRESS CONSTANT  V0240000
*                                                                       V0241000
         MACRO                                                          V0242000
&NAME    $ACONS &NULL                                                   V0243000
         GBLA  &HICORE                                                  V0244000
         AIF   (&HICORE GT 32).FULL                                     V0245000
&NAME    DS    H                                                        V0246000
         MEXIT                                                          V0247000
.FULL    ANOP                                                           V0248000
&NAME    DS    F                                                        V0249000
         MEND                                                           V0250000
         EJECT                                                          V0251000
*                                                                       V0252000
*****    $BCTR *****               BRANCH ON COUNT (RR)                 V0253000
*                                                                       V0254000
*                                                                       V0255000
         MACRO                                                          V0256000
&NAME    $BCTR &RA,&RB                                                  V0257000
         GBLA  &MACHINE                                                 V0258000
         AIF   (&MACHINE NE 20).S360                                    V0259000
         AH    &RA,=H'-1'                                               V0260000
         AIF   ('&RB' EQ '0' OR '&RB' EQ 'R0').END                      V0261000
         BCR   7,&RB                                                    V0262000
.END     MEXIT                                                          V0263000
.S360    ANOP                                                           V0264000
         BCTR  &RA,&RB                                                  V0265000
         MEND                                                           V0266000
         SPACE 4                                                        V0267000
*                                                                       V0268000
*        $BITOFF                   TURN CORRESPONDING BIT OFF           V0269000
*                                                                       V0270000
         MACRO                                                          V0271000
&NAME    $BITOFF &A,&B,&R                                               V0272000
         GBLA  &MACHINE                                                 V0273000
         AIF   (&MACHINE EQ 20).A1                                      V0274000
&NAME    OC    &A,&B                                                    V0275000
         XC    &A,&B                                                    V0276000
         MEXIT                                                          V0277000
.A1      ANOP                                                           V0278000
&NAME    $OC   &A,&B                                                    V0279000
         LH    &R,&A                                                    V0280000
         SH    &R,&B                                                    V0281000
         STH   &R,&A                                                    V0282000
         MEND                                                           V0283000
         SPACE 4                                                        V0284000
*                                                                       V0285000
*        $CA                       COMPARE REG TO STORAGE               V0286000
*                                                                       V0287000
         MACRO                                                          V0288000
&NAME    $CA   &REG,&ADDR                                               V0289000
         GBLA  &HICORE                                                  V0290000
         AIF   (&HICORE LE 32).C1                                       V0291000
&NAME    C     &REG,&ADDR                                               V0292000
         MEXIT                                                          V0293000
.C1      ANOP                                                           V0294000
&NAME    CH    &REG,&ADDR                                               V0295000
         MEND                                                           V0296000
         EJECT                                                          V0297000
*                                                                       V0298000
*****   $CCW   *****          DEFINE A CHANNEL COMMAND WORD             V0299000
*                                                                       V0300000
         MACRO                                                          V0301000
&NAME    $CCW  &OP,&AD,&BITS,&CT                                        V0302000
&NAME    DC    0D'0',AL1(&OP),AL3(&AD),AL1(X'&BITS'),AL3(&CT) CCW       V0303000
         MEND                                                           V0304000
         SPACE 1                                                        V0305000
*                                                                       V0306000
******   COUNT *****          A DEBUG MACRO TO COUNT EVENTS             V0307000
*                                                                       V0308000
*                                                                       V0309000
         MACRO                                                          V0310000
&NAME    COUNT &COM                                                     V0311000
         GBLA  &DEBUG                                                   V0312000
         AIF   (&DEBUG EQ 0).END                                        V0313000
&NAME    AP    *+10(6),=X'1C'                                           V0314000
         B     *+10                                                     V0315000
         DC    XL6'0C'                                                  V0316000
         MNOTE *,'COUNT OF &COM ***************'                        V0317000
.END     MEND                                                           V0318000
         SPACE 1                                                        V0319000
*                                                                       V0320000
****     $LA                       LOAD ADDRESS MACRO FOR 20'S          V0321000
*                                                                       V0322000
*                                                                       V0323000
         MACRO                                                          V0324000
&NAME    $LA   &REG,&LOC                                                V0325000
         GBLA  &MACHINE                                                 V0326000
         AIF   (&MACHINE NE 20).NOT20                                   V0327000
&NAME    LH    &REG,=Y(&LOC)                                            V0328000
         MEXIT                                                          V0329000
.NOT20   ANOP                                                           V0330000
&NAME    LA    &REG,&LOC                                                V0331000
         MEND                                                           V0332000
         SPACE 1                                                        V0333000
*                                                                       V0334000
*        $LMHA                     LOAD AND MULTIPLY HALF WORD ADDRESS  V0335000
*                                  ASSUMES SMALL NUMBERS AND NOT ZERO   V0336000
         MACRO                                                          V0337000
&NAME    $LMHA &REG1,&REG2,&ADDR1,&ADDR2                                V0338000
         GBLA  &MACHINE                                                 V0339000
         AIF   (&MACHINE EQ 20).S1                                      V0340000
&NAME    LH    &REG1,&ADDR1                                             V0341000
         MH    &REG1,&ADDR2                                             V0342000
         MEXIT                                                          V0343000
.S1      ANOP                                                           V0344000
&NAME    SR    &REG1,&REG1                                              V0345000
         LH    &REG2,&ADDR2                                             V0346000
         AH    &REG1,&ADDR1                                             V0347000
         AH    &REG2,=H'-1'                                             V0348000
         BH    *-8                                                      V0349000
         MEND                                                           V0350000
         EJECT                                                          V0351000
*                                                                       V0352000
******  $LOAD  *****               LOAD MACRO                           V0353000
*                                                                       V0354000
*                                                                       V0355000
         MACRO                                                          V0356000
&NAME   $LOAD  &REG,&ADDR                                               V0357000
&NAME    LH    &REG,&ADDR                                               V0358000
         MEND                                                           V0359000
         SPACE 4                                                        V0360000
*                                                                       V0361000
*****    $LTR  *****               LOAD REGISTER AND SET CC             V0362000
*                                                                       V0363000
*                                                                       V0364000
         MACRO                                                          V0365000
&NAME    $LTR  &RA,&RB                                                  V0366000
         GBLA  &MACHINE                                                 V0367000
         AIF   (&MACHINE NE 20).S360                                    V0368000
         AIF   ('&RA' EQ '&RB').RSAME                                   V0369000
         SR    &RA,&RA                                                  V0370000
         AR    &RA,&RB                                                  V0371000
         MEXIT                                                          V0372000
.RSAME   ANOP                                                           V0373000
&NAME    AH    &RA,=H'0'                                                V0374000
         MEXIT                                                          V0375000
.S360    ANOP                                                           V0376000
&NAME    LTR   &RA,&RB                                                  V0377000
         MEND                                                           V0378000
         SPACE 4                                                        V0379000
*                                                                       V0380000
*****    $OC   *****               STORAGE-TO-STORAGE OR                V0381000
*                                                                       V0382000
*                                                                       V0383000
         MACRO                                                          V0384000
&NAME    $OC   &A,&B                                                    V0385000
         GBLA  &MACHINE                                                 V0386000
&NAME    NULL  *                                                        V0387000
         AIF   (&MACHINE NE 20).S360                                    V0388000
*        NOTE THAT THIS IS A VERY RESTRICTIVE                           V0389000
*        SIMULATION OF THE 'OC' INSTRUCTION FOR THE MODEL 20            V0390000
         MVC   *+7(1),&B                                                V0391000
         OI    &A,*-*                                                   V0392000
         MVC   *+7(1),&B+1                                              V0393000
         OI    &A+1,*-*                                                 V0394000
         MEXIT                                                          V0395000
.S360    ANOP                                                           V0396000
         OC    &A,&B                                                    V0397000
         MEND                                                           V0398000
         EJECT                                                          V0399000
*                                                                       V0400000
*****   NULL   *****          DEFINE A SYMBOLIC LOCATION                V0401000
*                                                                       V0402000
*                                                                       V0403000
         MACRO                                                          V0404000
&NAME    NULL                                                           V0405000
         AIF   ('&NAME' NE '').X                                        V0406000
         MEXIT                                                          V0407000
.X       ANOP                                                           V0408000
&NAME    DS    0H                                                       V0409000
         MEND                                                           V0410000
         SPACE 4                                                        V0411000
*                                                                       V0412000
***** $RESTORE *****     RESTORE SAVED REGISTERS                        V0413000
*                                                                       V0414000
*                                                                       V0415000
         MACRO                                                          V0416000
&NAME    $RESTORE &R1,&RN,&LOC                                          V0417000
         GBLA  &MACHINE                                                 V0418000
         LCLA  &A,&B,&C                                                 V0419000
         LCLC  &D,&E                                                    V0420000
         AIF   (&MACHINE NE 20).M30                                     V0421000
&NAME    NULL                                                           V0422000
&D       SETC  '&R1'(2,K'&R1-1)                                         V0423000
&A       SETA  &D                                                       V0424000
&D       SETC  '&RN'(2,K'&RN-1)                                         V0425000
&B       SETA  &D                                                       V0426000
&C       SETA  0                                                        V0427000
.N       LH    R&A,&LOC+&C                                              V0428000
&C       SETA  &C+2                                                     V0429000
&A       SETA  &A+1                                                     V0430000
         AIF   ('R&A' LE '&RN').N                                       V0431000
         MEXIT                                                          V0432000
.M30     ANOP                                                           V0433000
&NAME    LM    &R1,&RN,&LOC                                             V0434000
         MEND                                                           V0435000
         SPACE 4                                                        V0436000
*                                                                       V0437000
*        $SA                       SUBTRACT ADDRESS                     V0438000
*                                                                       V0439000
         MACRO                                                          V0440000
&NAME    $SA   &REG,&ADDR                                               V0441000
         GBLA  &HICORE                                                  V0442000
         AIF   (&HICORE GT 32).S1                                       V0443000
&NAME    SH    &REG,=Y(&ADDR)                                           V0444000
         MEXIT                                                          V0445000
.S1      ANOP                                                           V0446000
&NAME    S     &REG,=A(&ADDR)                                           V0447000
         MEND                                                           V0448000
         EJECT                                                          V0449000
         SPACE 6                                                        V0450000
*                                                                       V0451000
*****   $SAVE  *****          SAVE REGISTERS                            V0452000
*                                                                       V0453000
*                                                                       V0454000
         MACRO                                                          V0455000
&NAME    $SAVE &R1,&RN,&LOC                                             V0456000
         GBLA  &MACHINE                                                 V0457000
         LCLA  &A,&B,&C                                                 V0458000
         LCLC  &D,&E                                                    V0459000
&NAME    NULL                                                           V0460000
         AIF   (&MACHINE NE 20).N20                                     V0461000
&D       SETC  '&R1'(2,K'&R1-1)                                         V0462000
&A       SETA  &D                                                       V0463000
&D       SETC  '&RN'(2,K'&RN-1)                                         V0464000
&B       SETA  &D                                                       V0465000
&C       SETA  0                                                        V0466000
.N       STH   R&A,&LOC+&C                                              V0467000
&C       SETA  &C+2                                                     V0468000
&A       SETA  &A+1                                                     V0469000
         AIF   ('R&A' LE '&RN').N                                       V0470000
         AGO   .END                                                     V0471000
.N20     STM   &R1,&RN,&LOC                                             V0472000
.END     MEND                                                           V0473000
         SPACE 6                                                        V0474000
*                                                                       V0475000
*****   SPSW   *****          SET PSW                                   V0476000
*                                                                       V0477000
*                                                                       V0478000
         MACRO                                                          V0479000
&NAME    SPSW  &LOC                                                     V0480000
         GBLA  &MACHINE                                                 V0481000
&NAME    NULL                                                           V0482000
         AIF   (&MACHINE NE 20).ANOT20                                  V0483000
         DC    AL4(&LOC) SPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSW       V0484000
         ORG   *-4       SPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSW       V0485000
         DC    X'8100'   SPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSW       V0486000
         ORG   *+2       SPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSWSPSW       V0487000
         AGO   .END                                                     V0488000
.ANOT20  ANOP                                                           V0489000
         LH    R7,&LOC+2                                                V0490000
         LPR   R7,R7                                                    V0491000
         BR    R7                                                       V0492000
.END     MEND                                                           V0493000
         EJECT                                                          V0494000
*                                                                       V0495000
*****   $SSM   *****          CONTROL MACHINE INTERRUPT STATUS          V0496000
*                                                                       V0497000
*                                                                       V0498000
         MACRO                                                          V0499000
&NAME   $SSM   &MASK                                                    V0500000
         GBLA  &MACHINE                                                 V0501000
         AIF   (&MACHINE NE 20).X                                       V0502000
&NAME    SPSW  *+4                                                      V0503000
         AIF   ('&MASK' EQ '0').OFF                                     V0504000
         DC    AL2(X'0100')                                             V0505000
         DC    Y(*+2)                                                   V0506000
         AGO   .END                                                     V0507000
.OFF     ANOP                                                           V0508000
         DC    AL4(*+4)                                                 V0509000
         AGO   .END                                                     V0510000
.X       ANOP                                                           V0511000
&NAME    SSM   =X'&MASK'                                                V0512000
.END     MEND                                                           V0513000
         SPACE 4                                                        V0514000
*                                                                       V0515000
*        $STO                      STORE REG INTO ADDRESS CONSTANT      V0516000
*                                                                       V0517000
         MACRO                                                          V0518000
&NAME   $STO  &REG,&ADDR                                                V0519000
&NAME    STH   &REG,&ADDR                                               V0520000
         MEND                                                           V0521000
         SPACE 4                                                        V0522000
*                                                                       V0523000
*****    $SUB  *****               SUBTRACT MACRO                       V0524000
*                                                                       V0525000
*                                                                       V0526000
         MACRO                                                          V0527000
&NAME    $SUB  &REG,&ADDR                                               V0528000
         GBLA  &HICORE                                                  V0529000
         AIF   (&HICORE GT 32).FULL  BR IF ADDR WILL EXCEED 32K         V0530000
&NAME    SH    &REG,&ADDR                                               V0531000
         MEXIT                                                          V0532000
.FULL    ANOP                                                           V0533000
&NAME    S     &REG,&ADDR                                               V0534000
         MEND                                                           V0535000
         EJECT                                                          V0536000
         SPACE 6                                                        V0537000
*                                                                       V0538000
*****    $TRACE  *****      TRACE PROGRAM FLOW                          V0539000
*                                                                       V0540000
*                                                                       V0541000
         MACRO                                                          V0542000
&NAME    $TRACE &TYPE=,&SSM=YES                                         V0543000
         GBLA  &MACHINE                                                 V0544000
         GBLA  &TRACE                                                   V0545000
&NAME    NULL                                                           V0546000
         AIF   (&TRACE EQ 0).NONE                                       V0547000
         AIF   (&MACHINE NE 20).TRACE                                   V0548000
         BASR  12,12 *****************S U P E R T R A C E ************* V0549000
         AGO   .TRACE1                                                  V0550000
.TRACE   ANOP                                                           V0551000
         SVC   X'CC' *****************S U P E R T R A C E ************* V0552000
.TRACE1  ANOP                                                           V0553000
         DC    H'0'  *****************S U P E R T R A C E ************* V0554000
         AIF   ('&SSM' NE 'YES').NOSSM                                  V0555000
         $SSM  FF                                                       V0556000
.NOSSM   ANOP                                                           V0557000
.NONE    MEND                                                           V0558000
         SPACE 6                                                        V0559000
*                                                                       V0560000
*****    $WCON  *****   DEFINE CONSTANT FOR MACHINE WORD SIZE           V0561000
*                                                                       V0562000
*                                                                       V0563000
         MACRO                                                          V0564000
&NAME    $WCON &ADDR                                                    V0565000
         GBLA  &HICORE                                                  V0566000
         LCLA  &T                                                       V0567000
&T       SETA  &HICORE                                                  V0568000
&HICORE  SETA  64                                                       V0569000
&NAME    $ACON &ADDR                                                    V0570000
&HICORE  SETA  &T                                                       V0571000
         MEND                                                           V0572000
 TITLE 'H A S P / R T P  *MACRO DEFINITIONS*(DATA MANAGEMENT)'          V0573000
         SPACE 10                                                       V0574000
*                                                                       V0575000
*  $CHAIN  -  ADD AN ITEM TO THE END OF A CHAIN                         V0576000
*                                                                       V0577000
*                                                                       V0578000
         MACRO                                                          V0579000
&NAME    $CHAIN &SOC,&R,&SSM                                            V0580000
         LCLC  &WR                                                      V0581000
&NAME    NULL                                                           V0582000
&WR      SETC  'R8'                                                     V0583000
         AIF   ('&R' NE 'R8').ROK                                       V0584000
&WR      SETC  'R9'                                                     V0585000
.ROK     ANOP                                                           V0586000
         AIF   ('&SSM' NE '').NOSSM                                     V0587000
         $SSM  0                                                        V0588000
.NOSSM   ANOP                                                           V0589000
         $TRACE SSM=NO                                                  V0590000
         AIF   ('&SOC'(1,1) NE '(').NORM                                V0591000
&WR      SETC  '&SOC(1)'                                                V0592000
         AGO   .REG                                                     V0593000
.NORM    ANOP                                                           V0594000
         $STO  &WR,$CHNTEMP                                             V0595000
         LH    &WR,=Y(&SOC)                                             V0596000
.REG     ANOP                                                           V0597000
         CLI   0(&WR),0                                                 V0598000
         BE    *+12                                                     V0599000
         LH    &WR,0(0,&WR)                                             V0600000
         B     *-12                                                     V0601000
         STH   &R,0(0,&WR)                                              V0602000
         MVC   0(2,&R),=H'0'                                            V0603000
         AIF   ('&SOC'(1,1) EQ '(').REGA                                V0604000
         $LOAD &WR,$CHNTEMP                                             V0605000
.REGA    ANOP                                                           V0606000
         AIF   ('&SSM' NE '').END                                       V0607000
         $SSM  FF                                                       V0608000
.END     MEND                                                           V0609000
         EJECT                                                          V0610000
         SPACE 8                                                        V0611000
*                                                                       V0612000
*        $CHECK                    CHECKS FOR I/O COMPLETION            V0613000
*                                                                       V0614000
         MACRO                                                          V0615000
&NAME    $CHECK &PRE,&ERR,&EOF,&T=                                      V0616000
         GBLA  &MACHINE,&A                                              V0617000
         LCLC  &R                                                       V0618000
&R       SETC  '&PRE'                                                   V0619000
         AIF   ('&T' EQ '').R4                                          V0620000
&R       SETC  '&T'                                                     V0621000
.R4      ANOP                                                           V0622000
         AIF   (&MACHINE NE 20).R1                                      V0623000
&A       SETA  &A+1                                                     V0624000
&NAME    MVC   $&PRE.COMM1+2(2),&PRE.ACN&A                              V0625000
&PRE.LOC&A TIOB $&PRE.COMM1+4,&R.BUSY                                   V0626000
         AIF   ('&ERR' EQ '').R2                                        V0627000
         TIOB  &ERR,&R.ERROR                                            V0628000
         AIF   ('&EOF' EQ '').R2                                        V0629000
         TIOB  &EOF,&R.EOF                                              V0630000
.R2      ANOP                                                           V0631000
         MEXIT                                                          V0632000
.R1      ANOP                                                           V0633000
&NAME    BAL   R14,$IOCK                                                V0634000
         AIF   ('&ERR' EQ '').R3                                        V0635000
         BC    3,&ERR                                                   V0636000
         AIF   ('&EOF' EQ '').R3                                        V0637000
         BC    4,&EOF                                                   V0638000
.R3      ANOP                                                           V0639000
         MEND                                                           V0640000
         EJECT                                                          V0641000
         SPACE 6                                                        V0642000
*                                                                       V0643000
*  $DCHAIN  -  REMOVE THE FIRST ITEM FROM A CHAIN                       V0644000
*                                                                       V0645000
*                                                                       V0646000
         MACRO                                                          V0647000
&NAME    $DCHAIN &SOC,&R,&SSM,&EMPTY=                                   V0648000
         GBLA  &MACHINE                                                 V0649000
         GBLA  &HICORE                                                  V0650000
         LCLA  &L                                                       V0651000
&NAME    NULL                                                           V0652000
         AIF   ('&SSM' NE '').NOSSM                                     V0653000
         $SSM  0                                                        V0654000
.NOSSM   ANOP                                                           V0655000
         AIF   (&HICORE GT 32).CLC                                      V0656000
&L       SETA  2                                                        V0657000
         CLI   &SOC,0                                                   V0658000
         AGO   .CLCEND                                                  V0659000
.CLC     CLC   &SOC,=F'0'                                               V0660000
&L       SETA  4                                                        V0661000
.CLCEND  ANOP                                                           V0662000
         AIF   ('&SSM' EQ '').BREL                                      V0663000
         AIF   ('&EMPTY' EQ '').BREL                                    V0664000
         BE    &EMPTY                                                   V0665000
         AGO   .BREL1                                                   V0666000
.BREL    BE    *+14                                                     V0667000
.BREL1   ANOP                                                           V0668000
         $LOAD &R,&SOC                                                  V0669000
         MVC   &SOC.(&L),0(&R)                                          V0670000
         AIF   ('&SSM' NE '').END                                       V0671000
         AIF   (&MACHINE NE 20).NOCC                                    V0672000
         MVI   *+16,X'31'                                               V0673000
         BNZ   *+8                                                      V0674000
         MVI   *+8,X'01'                                                V0675000
.NOCC    ANOP                                                           V0676000
         $SSM  FF                                                       V0677000
         MEXIT                                                          V0678000
         AIF   ('&EMPTY' EQ '').END                                     V0679000
         BE    &EMPTY                                                   V0680000
.END     MEND                                                           V0681000
         EJECT                                                          V0682000
         SPACE 6                                                        V0683000
*                                                                       V0684000
*  $FREE  -  ADD AN ITEM TO THE BEGINING OF A CHAIN                     V0685000
*                                                                       V0686000
*                                                                       V0687000
         MACRO                                                          V0688000
&NAME    $FREE &SOC,&R,&SSM                                             V0689000
&NAME    NULL                                                           V0690000
         AIF   ('&SSM' NE '').NOSSM                                     V0691000
         $SSM  0                                                        V0692000
.NOSSM   ANOP                                                           V0693000
        $TRACE SSM=NO                                                   V0694000
         MVC   0(2,&R),&SOC                                             V0695000
         STH   &R,&SOC                                                  V0696000
         AIF   ('&SOC' NE '$TANKPOL').NONTANK                           V0697000
         MVI   $TPGETCM+1,X'F0'    OPEN TPGET GATE                      V0698000
.NONTANK ANOP                                                           V0699000
         AIF   ('&SSM' NE '').END                                       V0700000
         $SSM  FF                                                       V0701000
.END     MEND                                                           V0702000
         SPACE 6                                                        V0703000
*                                                                       V0704000
*        $GETTNK                   GET A TANK AND POST COMPLETION       V0705000
*                                                                       V0706000
         MACRO                                                          V0707000
&NAME    $GETTNK &PRE,&REG,&REGA,&EMPTY=WAIT                            V0708000
         GBLA  &MACHINE                                                 V0709000
         AIF   ('&EMPTY' EQ 'WAIT').A1                                  V0710000
&NAME    $DCHAIN &PRE.CTTANK,&REG,ENBL,EMPTY=&EMPTY                     V0711000
         AGO   .A2                                                      V0712000
.A1      AIF   (&MACHINE EQ 20).A3                                      V0713000
&NAME    BAL   R14,$GETTNK         REG R8 WILL HAVE TANK ADDR ON RETURN V0714000
         MEXIT                                                          V0715000
.A3      ANOP                                                           V0716000
&NAME    $DELAY &PRE,TYPE=SETUP,TIME=LONG                               V0717000
         $DCHAIN &PRE.CTTANK,&REG,ENBL,EMPTY=&PRE.CTRTN                 V0718000
         $OPEN &PRE,&REGA                                               V0719000
.A2      $TCTPOST &PRE,&REGA                                            V0720000
         MEND                                                           V0721000
         EJECT                                                          V0722000
         SPACE 4                                                        V0723000
*                                                                       V0724000
*          $INTREQ                 INTERVENTION REQUIRED                V0725000
*                                                                       V0726000
         MACRO                                                          V0727000
&NAME    $INTREQ &PRE,&COM,&PREVLOC=                                    V0728000
         GBLA  &MACHINE,&CONSOLE                                        V0729000
         AIF   (&MACHINE EQ 20).R1                                      V0730000
&NAME    MVI   &PRE.CTECB,TCTBUSY      SET UP TO WAIT ON DEV END        V0731000
         AIF   ('&PREVLOC' EQ '').R3                                    V0732000
         B     &PREVLOC                                                 V0733000
         MEXIT                                                          V0734000
.R1      ANOP                                                           V0735000
         AIF   (&CONSOLE EQ 0).R2                                       V0736000
&NAME    OI    &PRE.CTSTAT,TCTSTOP     SET STOP STATUS                  V0737000
         $SSM  0                                                        V0738000
         MVI   $LOGINFO+2,&PRE.ADR     LOG UNIT CHECK                   V0739000
         $LOG  XUNITCHK                                                 V0740000
         $SSM  FF                                                       V0741000
         $DELAY &PRE,TIME=SHORT,TYPE=SETUP                              V0742000
         TM    &PRE.CTSTAT,TCTSTOP     TEST FOR OPERATOR RESPONSE       V0743000
         BO    $&PRE.COMM1+4           WAIT IF NO ACTION                V0744000
         AGO   .R5                                                      V0745000
         MEXIT                                                          V0746000
.R2      ANOP                                                           V0747000
&NAME    HPR   &PRE.ADR                WAIT FOR OPERATOR TO STOP UNIT   V0748000
.R5      AIF   ('&PREVLOC' EQ '').R3                                    V0749000
         B     &PREVLOC                                                 V0750000
.R3      MEND                                                           V0751000
         SPACE 4                                                        V0752000
*                                                                       V0753000
*****   $LOG   *****          LOG A COMMUNICATIONS ERROR                V0754000
*                                                                       V0755000
*                                                                       V0756000
         MACRO                                                          V0757000
&NAME    $LOG  &TYPE,&SAVE                                              V0758000
&NAME    NULL                                                           V0759000
         AIF   ('&SAVE' NE 'SAVE').DOIT                                 V0760000
        $STO   R15,$LOGSAVE                                             V0761000
.DOIT    BAS   R15,$LOG                                                 V0762000
         DC    AL2(&TYPE*(LOGEND-LOGDSECT))                             V0763000
         AIF   ('&SAVE' NE 'SAVE').END                                  V0764000
        $LOAD  R15,$LOGSAVE                                             V0765000
.END     MEND                                                           V0766000
         EJECT                                                          V0767000
         SPACE 6                                                        V0768000
*                                                                       V0769000
*        $PUT                      GIVES TANK TO COMPRESSION ROUTINES   V0770000
*                                                                       V0771000
         MACRO                                                          V0772000
&NAME    $PUT  &PRE,&ADDR                                               V0773000
         GBLA  &A                                                       V0774000
         GBLA  &MACHINE                                                 V0775000
         AIF   (&MACHINE EQ 20).M20                                     V0776000
&NAME    LA    R8,&ADDR         ****DESTROYS R8,R15                     V0777000
         BAL   R14,$PUT                                                 V0778000
         MEXIT                                                          V0779000
.M20     ANOP                                                           V0780000
&A       SETA  &A+1                                                     V0781000
&NAME    MVC   $&PRE.COMM1+2(2),&PRE.ACN&A                              V0782000
         BAS   R14,$PUT            *** DESTROYS R8,R15                  V0783000
&PRE.LOC&A BAS   R14,$PUTA                                              V0784000
         $ACON (&ADDR)                                                  V0785000
         $ACON (&PRE.TCT)              ADDRESS OF TCT                   V0786000
         B     $&PRE.COMM1+4       RETURN TO COMMUTATOR                 V0787000
         MEND                                                           V0788000
         SPACE 6                                                        V0789000
*                                                                       V0790000
*****    $SIO  *****          START FOR /360 MACHINES                   V0791000
*                                                                       V0792000
         MACRO                                                          V0793000
&NAME    $SIO  &CCW                                                     V0794000
&NAME    BAL   R15,$SIO                                                 V0795000
         DC    AL4(&CCW)                                                V0796000
         MEND                                                           V0797000
         EJECT                                                          V0798000
*                                                                       V0799000
*        $READ                     INITIATES I/O ON UNIT REC DEV        V0800000
*                                                                       V0801000
         MACRO                                                          V0802000
&NAME    $READ &PRE,&AREA,&BASE,&CTADDR=,&OP=,&T=R,&S=                  V0803000
         GBLA  &RDEV(7)                                                 V0804000
         GBLA  &UDEV(7)                                                 V0805000
         GBLA  &MACHINE,&A                                              V0806000
         GBLB  &R(10)              CONFIGURATION SCOREBOARD             V0807000
         LCLC  &LOP,&ADDR                                               V0808000
         AIF   (&MACHINE NE 20).R1                                      V0809000
&A       SETA  &A+1                                                     V0810000
         AIF   ('&CTADDR' EQ '').R2                                     V0811000
         MVC   &PRE.LOC&A+5(1),1+&CTADDR                                V0812000
.R2      ANOP                                                           V0813000
&ADDR    SETC  '0'                                                      V0814000
         AIF   ('&AREA' EQ '').R10                                      V0815000
&ADDR    SETC  '&AREA'                                                  V0816000
         AIF   ('&AREA' NE '(R8)').R3                                   V0817000
         STH   R8,&PRE.LOC&A+2                                          V0818000
         AGO   .R10                                                     V0819000
.R3      AIF   ('&BASE' EQ '').R10                                      V0820000
         AH    R8,=Y(&AREA-&BASE)                                       V0821000
         STH   R8,&PRE.LOC&A+2                                          V0822000
.R10     ANOP                                                           V0823000
&LOP     SETC  '&PRE'.'OPCODE'                                          V0824000
         AIF   ('&OP(1)' EQ '' OR '&OP(2)' NE '').R4                    V0825000
&LOP     SETC  '&OP(1)'                                                 V0826000
.R4      ANOP                                                           V0827000
&NAME    MVC   $&PRE.COMM1+2(2),&PRE.ACN&A                              V0828000
         AIF   ('&T' EQ 'R').R12                                        V0829000
         AIF   ('&PRE' NE 'U' AND '&PRE' NE 'R').R12                    V0830000
         AIF   (&UDEV(1) NE 2560 AND &R(7)).R12                         V0831000
         CIO   UPOC,USTACK         SELECT POCKET FOR CARD TO BE PUNCHED V0832000
.R12     ANOP                                                           V0833000
         AIF   ('&S' EQ '').R14                                         V0834000
&S       DS    0H                                                       V0835000
.R14     ANOP                                                           V0836000
&PRE.LOC&A XIO &ADDR.(&LOP+1),&PRE.CT                                   V0837000
         BC    7,$&PRE.COMM1+4                                          V0838000
         AIF   ('&T' NE 'R' OR '&PRE' NE 'R').R13                       V0839000
         AIF   (&RDEV(1) NE 2560 AND &R(7)).R13                         V0840000
         CIO   RPOC,RSTACK         SELECT POCKET FOR CARD READ          V0841000
.R13     MEXIT                                                          V0842000
.R1      ANOP                                                           V0843000
         AIF   ('&CTADDR' EQ '').R6                                     V0844000
         MVC   &PRE.CTCCWCT+1(1),1+&CTADDR                              V0845000
.R6      ANOP                                                           V0846000
         AIF   ('&AREA' EQ '').R7                                       V0847000
         AIF   ('&AREA' EQ '(R8)').R8                                   V0848000
         LA    R8,&AREA            *** DESTROYS R8                      V0849000
.R8      ANOP                                                           V0850000
         ST    R8,&PRE.CTCCW                                            V0851000
.R7      ANOP                                                           V0852000
         AIF   ('&OP(1)' EQ '' OR '&OP(2)' NE '' AND &R(2) AND         CV0853000
               &R(3)).R9                                                V0854000
         AIF   ('&OP(2)' EQ '').R11                                     V0855000
         MVC   &PRE.CTCCW,&OP(1)                                        V0856000
&NAME    BAL   R14,$XIOA                                                V0857000
         MEXIT                                                          V0858000
.R11     MVI   &PRE.CTCCW,&OP(1)                                        V0859000
&NAME    BAL   R14,$XIOA                                                V0860000
         MEXIT                                                          V0861000
.R9      ANOP                                                           V0862000
&NAME    BAL   R14,$XIO                                                 V0863000
         MEND                                                           V0864000
         SPACE 6                                                        V0865000
*                                                                       V0866000
*        $WRITE                    INITIATES I/O ON UNIT REC DEV        V0867000
*                                                                       V0868000
         MACRO                                                          V0869000
&NAME    $WRITE &PRE,&AREA,&BASE,&CTADDR=,&OP=,&S=                      V0870000
&NAME    $READ &PRE,&AREA,&BASE,CTADDR=&CTADDR,OP=&OP,T=W,S=&S          V0871000
         MEND                                                           V0872000
 TITLE 'H A S P / R T P  *MACRO DEFINITIONS*(TASK MANAGEMENT)'          V0873000
         SPACE 20                                                       V0874000
*                                                                       V0875000
*        $CLOSE                    CLOSE COMMUTATOR GATE AND EXIT       V0876000
*                                                                       V0877000
         MACRO                                                          V0878000
&NAME    $CLOSE &PRE                                                    V0879000
         GBLA  &MACHINE                                                 V0880000
         AIF   (&MACHINE EQ 20).A1                                      V0881000
&NAME    B     $CLOSTCT            CLOSE GATE AND RETURN TO COMMUTATOR  V0882000
         MEXIT                                                          V0883000
.A1      ANOP                                                           V0884000
&NAME    NI    $&PRE.COMM1+1,X'0F'      CLOSE GATE                      V0885000
         B     $&PRE.COMM1+4           RETURN TO COMMUTATOR             V0886000
         MEND                                                           V0887000
         EJECT                                                          V0888000
*                                                                       V0889000
*        $DELAY                    WAIT ONE TIME AROUND COMMUTATOR      V0890000
*                                  ESTABLISH REENTRY POINT              V0891000
         MACRO                                                          V0892000
&NAME    $DELAY &PRE,&ADR,&TYPE=BRANCH,&TIME=SHORT,&PREVLOC=*           V0893000
         GBLA  &MACHINE,&A                                              V0894000
         LCLC  &COM                                                     V0895000
&COM     SETC  '&ADR'                                                   V0896000
         AIF   ('&ADR' NE '').R3                                        V0897000
&COM     SETC  '&PRE'                                                   V0898000
.R3      ANOP                                                           V0899000
&A       SETA  &A+1                                                     V0900000
         AIF   (&MACHINE NE 20).R1                                      V0901000
&NAME    MVC   $&COM.COMM1+2(2),&PRE.ACN&A                              V0902000
         AIF   ('&TYPE' EQ 'BRANCH').R10                                V0903000
         AIF   ('&TIME' EQ 'SHORT').R5                                  V0904000
&PRE.LOC&A NI  $&COM.COMM1+1,X'0F'     CLOSE GATE INTERCEPT REENTRY     V0905000
         AGO   .R7                                                      V0906000
.R10     AIF   ('&TIME' EQ 'SHORT').R5                                  V0907000
         NI    $&COM.COMM1+1,X'0F'     CLOSE GATE REENTER ELSEWARE      V0908000
.R5      ANOP                                                           V0909000
         AIF   ('&TYPE' NE 'BRANCH').R2                                 V0910000
         B     $&COM.COMM1+4                                            V0911000
         AGO   .R2                                                      V0912000
.R1      ANOP                                                           V0913000
&NAME    MVC   &COM.CTENTY(2),&PRE.ACN&A                                V0914000
         AIF   ('&TYPE' EQ 'BRANCH').R9                                 V0915000
         AIF   ('&TIME' EQ 'SHORT').R6                                  V0916000
&PRE.LOC&A $LOAD R8,&COM.CTCOM       CLOSE GATE INTERCEPT REENTRY       V0917000
         NI    1(R8),X'0F'                                              V0918000
         AGO   .R8                                                      V0919000
.R9      AIF   ('&TIME' EQ 'SHORT').R6                                  V0920000
         $LOAD R8,&COM.CTCOM           CLOSE GATE REENTER ELSEWARE      V0921000
         NI    1(R8),X'0F'                                              V0922000
.R6      ANOP                                                           V0923000
         AIF   ('&TYPE' NE 'BRANCH').R2                                 V0924000
         B     &COM.CTRTN                                               V0925000
.R2      ANOP                                                           V0926000
&PRE.LOC&A EQU &PREVLOC                                                 V0927000
.R8      ANOP                                                           V0928000
.R7      ANOP                                                           V0929000
         MEND                                                           V0930000
         EJECT                                                          V0931000
*                                                                       V0932000
*        ENDPROC                   USED TO BUILD REENTRY PTS TO         V0933000
*                                  PROCESSORS                           V0934000
         MACRO                                                          V0935000
         $ENDPROC &PRE                                                  V0936000
         GBLA  &A                                                       V0937000
         LCLA  &B                                                       V0938000
&B       SETA  1                                                        V0939000
.E2      AIF   (&B GT &A).E1                                            V0940000
&PRE.ACN&B DC  S(&PRE.LOC&B)                                            V0941000
&B       SETA  &B+1                                                     V0942000
         AGO   .E2                                                      V0943000
.E1      ANOP                                                           V0944000
         MEND                                                           V0945000
         SPACE 6                                                        V0946000
*                                                                       V0947000
*        $OPEN                     OPENS THE DESIGNATED COMMUTATOR      V0948000
*                                                                       V0949000
         MACRO                                                          V0950000
&NAME    $OPEN &PRE                                                     V0951000
         GBLA  &MACHINE                                                 V0952000
         AIF   (&MACHINE EQ 20).R1                                      V0953000
&NAME    $LOAD R9,&PRE.CTCOM           FIND COMMUTATOR FROM TCT         V0954000
         OI    1(R9),X'F0'                                              V0955000
         MEXIT                                                          V0956000
.R1      ANOP                                                           V0957000
&NAME    OI    $&PRE.COMM1+1,X'F0'                                      V0958000
         MEND                                                           V0959000
         SPACE 6                                                        V0960000
*                                                                       V0961000
*        $TCTPOST                  POST $TPGET TO QUE MORE TANKS        V0962000
*                                                                       V0963000
         MACRO                                                          V0964000
&NAME    $TCTPOST &PRE,&REG                                             V0965000
&NAME    LH    &REG,&PRE.CTTNKLM         REDUCES COUNT IN TNKCT         V0966000
         $BCTR &REG,0                                                   V0967000
         STH   &REG,&PRE.CTTNKLM                                        V0968000
         OI    &PRE.CTSTAT,TCTACT      SIGNAL WE HAVE RECEIVED TANK     V0969000
         OI    $TPGETCM+1,X'F0'    OPEN THE GATE TO TPGET ROUTINE       V0970000
         MEND                                                           V0971000
 TITLE 'H A S P / R T P  *GLOBAL SYMBOL AND STORAGE MACROS* $CONFIG'    V0972000
*                                                                       V0973000
*        $CONFIG                   SETS GLOBALS AND CREATES EQUATES     V0974000
*                                                                       V0975000
         MACRO                                                          V0976000
&NAME    $CONFIG                                                        V0977000
         GBLA  &MACHINE,&PDEV(7),&RDEV(7),&UDEV(7),&WDEV(1),&A,&B,&S(7) V0978000
         GBLA  &D,&T,&NUMPRT,&NUMRDR,&NUMPUN,&CONSOLE,&WTOSIZE          V0979000
         GBLA  &LOCCOM                                                  V0980000
         GBLB  &R(10)              CONFIGURATION SCOREBOARD             V0981000
         GBLC  &PADR(7),&RADR(7),&UADR(7),&WADR(1)                      V0982000
         AIF   (&MACHINE NE 20).SS1                                     V0983000
*        &R(6) SET TO 0 THIS IS A MOD 20                                V0984000
PADR     EQU   &PADR(1)                   DESIGNATOR FOR PRINTER        V0985000
RADR     EQU   &RADR(1)                   DESIGNATOR FOR READER         V0986000
UADR     EQU   &UADR(1)                   DESIGNATOR FOR PUNCH          V0987000
&R(6)    SETB  0                   SYSTEM IS A MOD 20                   V0988000
.SS1     ANOP                                                           V0989000
&A       SETA  1                                                        V0990000
         AIF   (&PDEV(1) EQ 0).SETPRT                                   V0991000
.PLOOP   AIF   (&PDEV(&A) NE 1443).SKPP4                                V0992000
*        EQUATES FOR 1443 PRINTER SUPPORT                               V0993000
P1443    EQU   X'01'               BASIC PRINT OPCODE FOR 1443          V0994000
P14431   EQU   X'01'               BASIC PRINT OPCODE FOR 1443          V0995000
PF1443   EQU   X'20'               FLAGS FOR CCW SUPPRESS WRONG LENGTH  V0996000
         AGO   .SKPP3                                                   V0997000
.SKPP4   AIF   (&PDEV(&A) NE 1403).SKPP5                                V0998000
*        EQUATES FOR 1403 PRINTER SUPPORT                               V0999000
         AIF   (&MACHINE EQ 20).SKPP6                                   V1000000
P1403    EQU   X'01'               BASIC PRINT OPCODE FOR 1403          V1001000
P14031   EQU   X'01'               BASIC PRINT OPCODE FOR 1403          V1002000
PF1403   EQU   X'20'               FLAGS FOR CCW SUPPRESS WRONG LENGTH  V1003000
         AGO   .SKPP3                                                   V1004000
.SKPP6   ANOP                                                           V1005000
POPCODE  EQU   X'40'               PRINT OPCODE FOR 1403                V1006000
PBUSY    EQU   X'40'               TEST FOR BUSY ON 1403                V1007000
PERROR   EQU   X'41'               TEST FOR ERROR ON 1403               V1008000
         AGO   .SKPP3                                                   V1009000
.SKPP5   AIF   (&PDEV(&A) NE 2203).SKPP3X                               V1010000
*        EQUATES FOR 2203 PRINTER SUPPORT                               V1011000
POPCODE  EQU   X'40'               PRINT OPCODE FOR 2203                V1012000
PBUSY    EQU   X'40'               TEST FOR BUSY ON 2203                V1013000
PERROR   EQU   X'41'               TEST FOR ERROR ON 2203               V1014000
         AGO   .SKPP3                                                   V1015000
.SKPP3X  AIF   (&MACHINE EQ 20).SKPP3                                   V1016000
         AIF   (&PDEV(&A) NE 3211).SKPP3A                               V1017000
*        EQUATES FOR 3211 PRINTER SUPPORT                               V1018000
P3211    EQU   X'01'               BASIC PRINT OPCODE FOR 3211          V1019000
P32111   EQU   X'01'               BASIC PRINT OPCODE FOR 3211          V1020000
PF3211   EQU   X'20'               FLAGS FOR SUPPRESS WRONG LENGTH      V1021000
         AGO   .SKPP3                                                   V1022000
.SKPP3A  AIF   (&PDEV(&A) NE 3203).SKPP3B                               V1023000
*        EQUATES FOR 3203 PRINTER SUPPORT                               V1024000
P3203    EQU   X'01'               BASIC PRINT OPCODE FOR 3203          V1025000
P32031   EQU   X'01'               BASIC PRINT OPCODE FOR 3203          V1026000
PF3203   EQU   X'20'               FLAGS FOR SUPPRESS WRONG LENGTH      V1027000
&R(9)    SETB  1                   NOTE 3203 PRINTER PRESENT            V1028000
         AGO   .SKPP3                                                   V1029000
.SKPP3B  AIF   (&PDEV(&A) NE 5203).SKPP3                                V1030000
*        EQUATES FOR 5203 PRINTER SUPPORT                               V1031000
P5203    EQU   X'01'               BASIC PRINT OPCODE FOR 5203          V1032000
P52031   EQU   X'01'               BASIC PRINT OPCODE FOR 5203          V1033000
PF5203   EQU   X'20'               FLAGS FOR SUPPRESS WRONG LENGTH      V1034000
&R(10)   SETB  1                   NOTE 5203 PRINTER PRESENT            V1035000
.SKPP3   ANOP                                                           V1036000
&A       SETA  &A+1                                                     V1037000
         AIF   (&A GT 7).SETPRT                                         V1038000
         AIF   (&PDEV(&A) EQ 0).SETPRT                                  V1039000
&T       SETA  0                                                        V1040000
&B       SETA  1                                                        V1041000
.SKPP2   AIF   (&PDEV(&A) NE &PDEV(&B)).SKPP1                           V1042000
&T       SETA  1                                                        V1043000
.SKPP1   ANOP                                                           V1044000
&B       SETA  &B+1                                                     V1045000
         AIF   (&B LT &A).SKPP2                                         V1046000
         AIF   (&T EQ 0).PLOOP                                          V1047000
         AGO   .SKPP3                                                   V1048000
.SETPRT  ANOP                                                           V1049000
&NUMPRT  SETA  &A-1                                                     V1050000
RSIZE    EQU   80                  LENGTH OF CARD                       V1051000
&A       SETA  1                                                        V1052000
&D       SETA  0                                                        V1053000
         AIF   (&RDEV(1) EQ 0).SETRDR                                   V1054000
         AGO   .SKPR20                                                  V1055000
.RLOOP   AIF   (&RDEV(&A) NE 1442).SKPR6                                V1056000
*        EQUATES FOR 1442 READ SUPPORT &R(1) SET TO 0                   V1057000
&R(1)    SETB  0                   NON DUAL READER ON SYSTEM            V1058000
R1442    EQU   X'42'               NORMAL READ OPCODE FOR 1442          V1059000
R14421   EQU   X'42'               READ OPCODE FOR 1442 NON DUAL        V1060000
RF1442   EQU   X'00'               FLAGS FOR CCW WRONG LENGTH CHECK     V1061000
         AGO   .SKPR5                                                   V1062000
.SKPR6   AIF   (&RDEV(&A) NE 2501).SKPR7                                V1063000
*        EQUATES FOR 2501 READ SUPPORT &R(1) SET TO 0                   V1064000
&R(1)    SETB  0                   NON DUAL READER ON SYSTEM            V1065000
         AIF   (&MACHINE EQ 20).SKPRA1                                  V1066000
R2501    EQU   X'02'               NORMAL READ OPCODE FOR 2501          V1067000
R25011   EQU   X'02'               READ OPCODE FOR 2501                 V1068000
RF2501   EQU   X'00'               FLAGS FOR CCW WRONG LENGTH CHECK     V1069000
         AGO   .SKPR5                                                   V1070000
.SKPRA1  ANOP                                                           V1071000
ROPCODE  EQU   X'12'               READ OPCODE FOR 2501                 V1072000
RBUSY    EQU   X'10'               TEST FOR BUSY ON 2501                V1073000
RERROR   EQU   X'11'               TEST FOR ERROR ON 2501               V1074000
REOF     EQU   X'14'               END OF FILE TEST ON 2501             V1075000
         AGO   .SKPR5                                                   V1076000
.SKPR7   AIF   (&RDEV(&A) NE 2520).SKPR8                                V1077000
*        EQUATES FOR 2520 READ SUPPORT &R(1) SET TO 0                   V1078000
&R(1)    SETB  0                   NON DUAL READER ON SYSTEM            V1079000
         AIF   (&MACHINE EQ 20).SKPRA5                                  V1080000
R2520    EQU   X'42'               NORMAL READ OPCODE FOR 2520          V1081000
R25201   EQU   X'42'               READ OPCODE FOR 2520 NON DUAL        V1082000
RF2520   EQU   X'00'               FLAGS FOR CCW WRONG LENGTH CHECK     V1083000
         AGO   .SKPR5                                                   V1084000
.SKPRA5  ANOP                                                           V1085000
ROPCODE  EQU   X'22'               READ OPCODE FOR 2520                 V1086000
RSTACK   EQU   X'20'               STACKER SELECT FOR 2520 READ         V1087000
RBUSY    EQU   X'20'               TEST FOR READER BUSY ON 2520         V1088000
RERROR   EQU   X'21'               TEST FOR READER ERROR ON 2520        V1089000
REOF     EQU   X'24'               END OF FILE TEST ON 2520             V1090000
RPOC     EQU   X'02'               POCKET FOR 2520 READ                 V1091000
         AGO   .SKPR5                                                   V1092000
.SKPR8   AIF   (&RDEV(&A) NE 2540).SKPR9                                V1093000
*        EQUATES FOR 2540 READ SUPPORT &R(1) SET TO 0                   V1094000
&R(1)    SETB  0                   NON DUAL READER ON SYSTEM            V1095000
R2540    EQU   X'42'               NORMAL READ OPCODE FOR 2540          V1096000
R25401   EQU   X'42'               READ OPCODE FOR 2540                 V1097000
RF2540   EQU   X'00'               FLAGS FOR CCW WRONG LENGTH CHECK     V1098000
         AGO   .SKPR5                                                   V1099000
.SKPR9   AIF   (&RDEV(&A) NE 2560).SKPR10                               V1100000
*        EQUATES FOR 2560 READ SUPPORT &R(1) SET TO 0                   V1101000
&R(1)    SETB  0                   NON DUAL READER ON SYSTEM            V1102000
ROPCODE  EQU   X'22'               READ OPCODE FOR 2560                 V1103000
RBUSY    EQU   X'20'               TEST FOR BUSY ON 2560                V1104000
RERROR   EQU   X'21'               TEST FOR ERROR ON 2560               V1105000
REOF     EQU   X'24'               TEST FOR END OF FILE ON 2560         V1106000
RPOC     EQU   X'02'               POCKET FOR 2560 READ                 V1107000
RSTACK   EQU   X'20'               STACK OPCODE FOR 2560                V1108000
         AGO   .SKPR5                                                   V1109000
.SKPR10  AIF   (&RDEV(&A) NE 25200).SKPR11                              V1110000
*        EQUATES FOR 2520 DUAL READ/PUNCH SUPPORT &R(2) SET TO 0        V1111000
&R(2)    SETB  0                   2520 DUAL READ/PUNCH ON SYSTEM       V1112000
         AIF   (&MACHINE EQ 20).SKPRA2                                  V1113000
R25200   EQU   X'C2'               INITIAL READ OPCODE FOR 2520 DUAL    V1114000
R252001  EQU   X'49'               NORMAL PUNCH OPCODE FOR 2520 DUAL    V1115000
R252002  EQU   X'02'               NORMAL READ OPCODE FOR 2520 DUAL     V1116000
R252003  EQU   X'23'               STACKER SEL OPCODE FOR 2520 DUAL     V1117000
RF25200  EQU   X'20'               FLAGS FOR CCW SUPPRESS WRONG LENGTH  V1118000
         AGO   .SKPR5                                                   V1119000
.SKPRA2  ANOP                                                           V1120000
ROPCODE  EQU   X'22'               READ OPCODE FOR 2520 DUAL READ/PUNCH V1121000
RBUSY    EQU   X'20'               TEST FOR BUSY ON 2520 DUAL           V1122000
RERROR   EQU   X'21'               TEST FOR ERROR ON 2520 DUAL          V1123000
REOF     EQU   X'24'               TEST FOR END OF FILE ON 2520 DUAL    V1124000
UEOF     EQU   X'24'               TEST FOR END OF FILE WHILE PUNCHING  V1125000
UOPCODE  EQU   X'24'               PUNCH OPCODE FOR DUAL 2520           V1126000
UBUSY    EQU   X'22'               TEST FOR BUSY ON 2520 DUAL           V1127000
UERROR   EQU   X'23'               TEST FOR ERROR ON 2520 DUAL          V1128000
UFEED    EQU   X'25'               TEST FOR FEED ERROR                  V1129000
         AGO   .SKPR5                                                   V1130000
.SKPR11  AIF   (&RDEV(&A) NE 14420).SKPR12                              V1131000
*        EQUATES FOR 1442 DUAL READ/PUNCH SUPPORT &R(3) SET TO 0        V1132000
&R(3)    SETB  0                   1442 DUAL READ/PUNCH ON SYSTEM       V1133000
R14420   EQU   X'02'              NORMAL READ OPCODE FOR 1442 DUAL      V1134000
R144201  EQU   X'41'               NORMAL PUNCH OPCODE FOR 1442 DUAL    V1135000
RF14420  EQU   X'20'               FLAGS FOR CCW SUPPRESS WRONG LENGTH  V1136000
         AGO   .SKPR5                                                   V1137000
.SKPR12  AIF   (&RDEV(&A) NE 25600).SKPR5                               V1138000
*        EQUATES FOR 2560 DUAL READ/PUNCH SUPPORT &R(7) SET TO 0        V1139000
&R(7)    SETB  0                   2560 DUAL READ/PUNCH ON SYSTEM       V1140000
ROPCODE  EQU   X'22'               READ CARD ON 2560 (PRMARY FEED)      V1141000
RBUSY    EQU   X'20'               TEST FOR BUSY ON 2560                V1142000
RERROR   EQU   X'21'               TEST FOR ERROR ON 2560               V1143000
REOF     EQU   X'24'               END OF FILE TEST ON 2560             V1144000
RFEED    EQU   X'25'               TEST FOR FEED ERROR                  V1145000
RPOC     EQU   X'02'               POCKET FOR 2560 READ DUAL            V1146000
RSTACK   EQU   X'20'               STACKER SELECT FOR 2560 INPUT        V1147000
UOPCODE  EQU   X'27'               PUNCH OPCODE FOR 2560 DUAL           V1148000
UPOC     EQU   X'03'               POCKET FOR 2560 DUAL PUNCH           V1149000
USTACK   EQU   X'21'               STACKER SELECT FOR 2560 PUNCH        V1150000
UBADPOC  EQU   X'04'               BAD CARD POCKET FOR 2560 PUNCH       V1151000
UNSTACK  EQU   X'22'               PUNCH CARD STACKER SELECT FOR 2560   V1152000
&NUMRDR  SETA  1                                                        V1153000
&NUMPUN  SETA  0                                                        V1154000
&D       SETA  0                                                        V1155000
         AGO   .LOOKWTO                                                 V1156000
.SKPR5   ANOP                                                           V1157000
&A       SETA  &A+1                                                     V1158000
         AIF   (&A GT 7).SETRDR                                         V1159000
         AIF   (&RDEV(&A) EQ 0).SETRDR                                  V1160000
.SKPR20  ANOP                                                           V1161000
&B       SETA  1                                                        V1162000
&S(&A)   SETA  0                                                        V1163000
.SKPR2   AIF   ('&RADR(&A)' EQ '&UADR(&B)').SKPR1                       V1164000
&B       SETA  &B+1                                                     V1165000
         AIF   (&B LE 7).SKPR2                                          V1166000
.SKPR13  AIF   (&A EQ 1).RLOOP                                          V1167000
&T       SETA  0                                                        V1168000
&B       SETA  1                                                        V1169000
.SKPR4   AIF   (&RDEV(&A) NE &RDEV(&B)).SKPR3                           V1170000
&T       SETA  1                                                        V1171000
.SKPR3   ANOP                                                           V1172000
&B       SETA  &B+1                                                     V1173000
         AIF   (&B LT &A).SKPR4                                         V1174000
         AIF   (&T EQ 0).RLOOP                                          V1175000
         AGO   .SKPR5                                                   V1176000
.SKPR1   ANOP                                                           V1177000
&RDEV(&A) SETA &RDEV(&A)*10                                             V1178000
&UDEV(&B) SETA &UDEV(&B)*10                                             V1179000
&D       SETA  &D+1                                                     V1180000
&S(&A)   SETA  &B                                                       V1181000
         AGO   .SKPR13                                                  V1182000
.SETRDR  ANOP                                                           V1183000
&NUMRDR  SETA  &A-1                                                     V1184000
&A       SETA  1                                                        V1185000
         AIF   (&UDEV(1) EQ 0).SETPUN                                   V1186000
.ULOOP   AIF   (&UDEV(&A) NE 1442).SKPU4                                V1187000
*        EQUATES FOR 1442 PUNCH SUPPORT &R(8) SET TO 0                  V1188000
&R(8)    SETB  0                   SINGLE POCKET 1442 ON SYSTEM         V1189000
         AIF   (&MACHINE EQ 20).SKPU5                                   V1190000
U14421   EQU   X'81'               PUNCH OPCODE FOR 1442 NON DUAL       V1191000
U1442    EQU   X'81'               PUNCH OPCODE FOR 1442 NON DUAL       V1192000
UF1442   EQU   X'20'               FLAGS FOR CCW SUPPRESS WRONG LENGTH  V1193000
         AGO   .SKPU3                                                   V1194000
.SKPU5   ANOP                                                           V1195000
UOPCODE  EQU   X'36'               PUNCH OPCODE ON 1442                 V1196000
UBUSY    EQU   X'32'               TEST PUNCH BUSY ON 1442              V1197000
UERROR   EQU   X'33'               TEST FOR ERROR ON 1442               V1198000
         AGO   .SKPU3                                                   V1199000
.SKPU4   AIF   (&UDEV(&A) NE 2520).SKPU6                                V1200000
*        EQUATES FOR 2520 PUNCH SUPPORT &R(5) SET TO 0                  V1201000
&R(5)    SETB  0                   NON DUAL PUNCH DEVICE ON SYSTEM      V1202000
         AIF   (&MACHINE EQ 20).SKPU7                                   V1203000
U2520    EQU   X'41'               PUNCH OPCODE FOR 2520 NON DUAL       V1204000
U25201   EQU   X'41'               PUNCH OPCODE FOR 2520 NON DUAL       V1205000
UF2520   EQU   X'20'               FLAGS FOR CCW SUPPRESS WRONG LENGTH  V1206000
         AGO   .SKPU3                                                   V1207000
.SKPU7   ANOP                                                           V1208000
UOPCODE  EQU   X'26'               PUNCH OPCODE FOR 2520                V1209000
UBUSY    EQU   X'22'               TEST PUNCH BUSY ON 2520              V1210000
UERROR   EQU   X'23'               TEST PUNCH ERROR ON 2520             V1211000
UFEED    EQU   X'25'               TEST FOR FEED ERROR                  V1212000
         AGO   .SKPU3                                                   V1213000
.SKPU6   AIF   (&UDEV(&A) NE 2540).SKPU8                                V1214000
*        EQUATES FOR 2540 PUNCH SUPPORT &R(4) SET TO 0                  V1215000
&R(4)    SETB  0                   2540 PUNCH ON SYSTEM                 V1216000
U2540    EQU   X'41'               PUNCH OPCODE FOR 2540                V1217000
U25401   EQU   X'41'               PUNCH OPCODE FOR 2540                V1218000
UF2540   EQU   X'20'               FLAGS FOR CCW SUPPRESS WRONG LENGTH  V1219000
         AGO   .SKPU3                                                   V1220000
.SKPU8   AIF   (&UDEV(&A) NE 2560).SKPU3                                V1221000
*        EQUATES FOR 2560 PUNCH SUPPORT &R(5) SET TO 0                  V1222000
&R(5)    SETB  0                   NON DUAL PUNCH DEVICE ON SYSTEM      V1223000
UOPCODE  EQU   X'27'               PUNCH OPCODE FOR 2560 (SECONDARY)    V1224000
UBUSY    EQU   X'20'               TEST FOR BUSY ON 2560                V1225000
UERROR   EQU   X'21'               TEST FOR ERROR ON 2560               V1226000
UFEED    EQU   X'25'               TEST FOR FEED ERROR                  V1227000
UPOC     EQU   X'03'               POCKET FOR 2560 PUNCH                V1228000
USTACK   EQU   X'21'               STACK OPCODE FOR 2560                V1229000
UBADPOC  EQU   X'04'               BAD CARD POCKET FOR 2560 PUNCH       V1230000
UNSTACK  EQU   X'22'               PUNCH CARD STACKER SELECT FOR 2560   V1231000
.SKPU3   ANOP                                                           V1232000
&A       SETA  &A+1                                                     V1233000
         AIF   (&A GT 7).SETPUN                                         V1234000
         AIF   (&UDEV(&A) EQ 0).SETPUN                                  V1235000
&T       SETA  0                                                        V1236000
&B       SETA  1                                                        V1237000
.SKPU2   AIF   (&UDEV(&A) NE &UDEV(&B)).SKPU1                           V1238000
&T       SETA  1                                                        V1239000
.SKPU1   ANOP                                                           V1240000
&B       SETA  &B+1                                                     V1241000
         AIF   (&B LT &A).SKPU2                                         V1242000
         AIF   (&T EQ 0).ULOOP                                          V1243000
         AGO   .SKPU3                                                   V1244000
.SETPUN  ANOP                                                           V1245000
&NUMPUN  SETA  &A-1                                                     V1246000
.LOOKWTO ANOP                                                           V1247000
         AIF   (&WDEV(1) EQ 0).SKPSETW                                  V1248000
*        EQUATES FOR OPERATOR CONSOLE SUPPORT                           V1249000
WSIZE    EQU   &WTOSIZE            LENGTH OF CONSOLE PRINT LINE         V1250000
         AIF   (&MACHINE EQ 20).SKP1                                    V1251000
W1052    EQU   X'09'               WRITE OPCODE FOR CONSOLE             V1252000
W10521   EQU   X'09'               WRITE OPCODE FOR CONSOLE             V1253000
W10522   EQU   X'0A'               READ OPCODE FOR CONSOLE              V1254000
WF1052   EQU   X'20'               FLAGS FOR CCW SUPPRESS WRONG LENGTH  V1255000
WREAD    EQU   X'0A'               READ FROM KEYBOARD                   V1256000
         AGO   .SETWTO                                                  V1257000
.SKP1    ANOP                                                           V1258000
*        &LOCCOM SET TO 1 *LOCAL COMMAND SUPPORT IS REQUIRED*           V1259000
&LOCCOM  SETA  1                                                        V1260000
WREAD    EQU   X'E1'               READ OPCODE FOR CONSOLE              V1261000
WREQ     EQU   X'E3'               TEST FOR INQUIRY REQUEST             V1262000
WENABLE  EQU   X'E2'               ENABLE OPCODE FOR INQUIRY REQUESTS   V1263000
WOPCODE  EQU   X'E3'               WRITE OPCODE FOR CONSOLE             V1264000
WBUSY    EQU   X'E0'               TEST FOR BUSY ON CONSOLE             V1265000
WERROR   EQU   X'E2'               TEST ANY CHECK ON CONSOLE            V1266000
.SETWTO  ANOP                                                           V1267000
&CONSOLE SETA  1                                                        V1268000
.SKPSETW MEND                                                           V1269000
 TITLE 'H A S P / R T P  *GLOBAL SYMBOL AND STORAGE MACROS*  DEFTCT'    V1270000
*                                                                       V1271000
*        DEFTCT                    DEFINE TCT SYMBOLS FOR               V1272000
*                                  DSECT AND ABS ADDRS                  V1273000
         MACRO                                                          V1274000
         DEFTCT &PRE                                                    V1275000
         GBLA  &LOCCOM,&CONSOLE                                         V1276000
         GBLA  &MACHINE,&CCT,&A,&UDEV(7)                                V1277000
         GBLB  &R(10)              CONFIGURATION SCOREBOARD             V1278000
         LCLC  &SIZ                                                     V1279000
&SIZ     SETC  '&PRE'                                                   V1280000
         AIF   ('&PRE' NE 'U').TCTUDF                                   V1281000
&SIZ     SETC  'R'                                                      V1282000
.TCTUDF  ANOP                                                           V1283000
&PRE.TCT DS    0H                                                       V1284000
         AIF   (&MACHINE EQ 20).TCTSKP1                                 V1285000
&PRE.CTSTRT DS CL2                 B TO PROPER PROCESSOR ENTRY          V1286000
&PRE.CTENTY DS CL2                 ADR PORTION ***MODIFIED BY PROCESSOR V1287000
&PRE.CTRTN DS  CL4                 B TO NEXT PROCESSOR VIA COMMUTATOR   V1288000
&PRE.CTCCW DS  CL1                 CCW FOR DEVICE OP-CODE               V1289000
&PRE.CTDATA DS AL3                 ADDRESS OF DATA TRANSFERRED          V1290000
&PRE.CTFLAG DS CL1                 FLAGS ON CCW                         V1291000
&PRE.CTOPCOD DS CL1                 SAVE AREA FOR CCW OP-CODE           V1292000
&PRE.CTCCWCT DS AL2                 CCW COUNT OF DATA TRANSFERRED       V1293000
         AIF   ('&PRE' NE 'P').TCT01                                    V1294000
&PRE.CTSENSE DS AL1                 SENSE INFO FOR ERROR RECOVERY       V1295000
&PRE.CTINDEX DS AL1                 FCB INDEX INFORMATION BYTE          V1296000
         AGO   .TCT02                                                   V1297000
.TCT01   ANOP                                                           V1298000
&PRE.CTSENSE DS AL2                 SENSE INFO FOR ERROR RECOVERY       V1299000
.TCT02   ANOP                                                           V1300000
&PRE.CTUCB DS  AL2                 DEVICE ADDRESS                       V1301000
&PRE.CTECB DS  CL1                 EVENT CONTROL                        V1302000
&PRE.CTALTOP DS CL1                 PUNCH OP-CODE FOR READER/PUNCH      V1303000
&PRE.CTSAV1 $ACONS ,                   SAVE AREA FOR PROCESSOR ROUTINES V1304000
.TCTSKP1 ANOP                                                           V1305000
&PRE.CTNEXT $ACONS ,                   NEXT TCT IN CHAIN                V1306000
&PRE.CTFCS DS  AL2                 FUNCTION CONTROL SEQUENCE MASK       V1307000
&PRE.CTRCB DS  CL1                 RECORD CONTROL BLOCK MASK            V1308000
&PRE.CTSTAT DS CL1                 STATUS FLAGS                         V1309000
&PRE.CTCOM $ACONS ,                   POINTER BACK TO COMMUTATOR        V1310000
         AIF   (&LOCCOM EQ 0).TCT4                                      V1311000
&PRE.CTID DS   CL2                 ID OF DEVICE                         V1312000
.TCT4    ANOP                                                           V1313000
         AIF   (NOT(&R(2) AND &R(3) AND &R(7))).TCT1                    V1314000
&PRE.CTINRCB EQU &PRE.CTRCB              READER RCB IDENTIFICATION      V1315000
.TCT1    AIF   (&R(2) AND &R(3) AND &R(7)).TCT2                         V1316000
&PRE.CTINRCB DS CL1                 READER RCB IDENTIFICATION           V1317000
.TCT2    ANOP                                                           V1318000
         AIF   ('&PRE' EQ 'R' AND &R(2) AND &R(3) AND &R(7)).TCTSKP3    V1319000
*                                                                       V1320000
*        NORMAL DEVICE EXTENTION                                        V1321000
*                                                                       V1322000
&PRE.CTTANK $ACONS ,                    NEXT TANK TO OUTPUT             V1323000
&PRE.CTBUFER $ACONS ,                   ADDR OF CURRENT BUFFER          V1324000
*                                                                       V1325000
*              TNKLM,TNKCT AND BUFLM,BUFCT MUST APPEAR IN SEQ AND STRT  V1326000
*                                  ON HALF WORD BOUNDARIES              V1327000
&PRE.CTTNKLM DS CL1                 MAX NUM OF TANKS ASSIGNABLE TO DEV  V1328000
&PRE.CTTNKCT DS CL1                 CURRENT NUM ASSIGNED                V1329000
&PRE.CTBUFLM DS CL1                 MAX NUM OF BUFFERS ASSIGNABLE TO DV V1330000
&PRE.CTBUFCT DS CL1                 CURRENT NUM ASSIGNED                V1331000
.TCTSKP3 AIF   ('&PRE' NE 'W' AND '&PRE' NE 'R' AND ('&PRE' NE 'U'     CV1332000
               OR &R(2) AND &R(3))).TCTSKP2                             V1333000
         AIF   ('&PRE' EQ 'W' AND &CONSOLE EQ 0).TCTSKP2                V1334000
*                                                                       V1335000
*        TANK EXTENTIONS FOR READER AND CONSOLE PROCESSORS              V1336000
*                                                                       V1337000
&PRE.CTTANK1 $ACONS ,                   TANKCHN AND WORK AREA ONE       V1338000
&PRE.CTTRCB1 DS CL1                 RCB IDENTIFICATION                  V1339000
&PRE.CTTSRC1 DS CL1                 SRCB IDENTIFICATION                 V1340000
&PRE.CTTCT1 DS H                   NUMBER OF DATA CHARACTERS            V1341000
&PRE.CTTDTA1 DS CL(&SIZ.SIZE+&CCT)                                      V1342000
         AIF   ('&PRE' EQ 'W').TCTSKP2                                  V1343000
&PRE.CTTANK2 $ACONS ,                   TANKCHN AND WORK AREA TWO       V1344000
&PRE.CTTRCB2 DS CL1                 RCB IDENTIFICATION                  V1345000
&PRE.CTTSRC2 DS CL1                 SRCB IDENTIFICATION                 V1346000
&PRE.CTTCT2 DS H                   NUMBER OF DATA CHARACTERS            V1347000
&PRE.CTTDTA2 DS CL(&SIZ.SIZE+&CCT)                                      V1348000
.TCTSKP2 AIF   ('&PRE'  NE  'U'  OR &R(4)  AND ( NOT &R(6) OR &R(2)    CV1349000
               AND &R(3))).TCTSKP4                                      V1350000
&PRE.CTHOLD $ACONS ,                 PTR TO TANK HELD FOR PUNCH ERRORS  V1351000
.TCTSKP4 ANOP                                                           V1352000
         MEND                                                           V1353000
 TITLE 'H A S P / R T P  *GLOBAL SYMBOL AND STORAGE MACROS* $GENCOM'    V1371000
*                                                                       V1372000
*        $GENCOM                   GENERATES ALL COMMUTATOR ENTRIES     V1373000
*                                                                       V1374000
         MACRO                                                          V1375000
&NAME    $GENCOM                                                        V1376000
         GBLA  &NUMRDR,&NUMPUN,&CONSOLE,&MACHINE,&NUMPRT,&PRTCONS       V1377000
         GBLA  &UDEV(7)                                                 V1378000
         LCLA  &A                                                       V1379000
         LCLC  &ENT                                                     V1380000
&ENT     SETC  'COM'                                                    V1381000
         AIF   (&MACHINE NE 20).COMA                                    V1382000
&ENT     SETC  'RTN'                                                    V1383000
.COMA    ANOP                                                           V1384000
&NAME    NULL                                                           V1385000
$CONTCOM NOP   $CONTROL            CONTROL RECORD PROCESSOR             V1386000
$TPGETCM NOP   $TPGET              INPUT BUFFER MANAGER                 V1387000
&A       SETA  1                                                        V1388000
.C1      AIF   (&A GT &NUMPRT).C2                                       V1389000
$PCOMM&A NOP   $P&ENT&A              ENTRY POINT TO PRINT               V1390000
&A       SETA  &A+1                                                     V1391000
         AGO   .C1                                                      V1392000
.C2      ANOP                                                           V1393000
&A       SETA  1                                                        V1394000
.C3      AIF   (&A GT &NUMRDR).C4                                       V1395000
$RCOMM&A B     $R&ENT&A              ENTRY POINT TO READ CARD           V1396000
&A       SETA  &A+1                                                     V1397000
         AGO   .C3                                                      V1398000
.C4      ANOP                                                           V1399000
&A       SETA  1                                                        V1400000
.C5      AIF   (&A GT &NUMPUN).C6                                       V1401000
         AIF   (&UDEV(&A) GT 9999).C8                                   V1402000
$UCOMM&A NOP   $U&ENT&A              ENTRY TO PUNCH CARD                V1403000
         AGO   .C9                                                      V1404000
.C8      AIF   (&MACHINE NE 20).C9                                      V1405000
$UCOMM1  EQU   $RCOMM1                                                  V1406000
.C9      ANOP                                                           V1407000
&A       SETA  &A+1                                                     V1408000
         AGO   .C5                                                      V1409000
.C6      ANOP                                                           V1410000
         AIF   (&CONSOLE NE 1 AND &PRTCONS EQ 0).C7                     V1411000
$WCOMM1  NOP   $W&ENT.1              TYPE ON CONSOLE                    V1412000
.C7      ANOP                                                           V1413000
$COMCOM  NOP   $COMSUP             COMMUNICATIONS SUPERVISOR            V1414000
         AIF   (&MACHINE NE 20).C10                                     V1414200
         B     &NAME               LOOK FOR ADDITIONAL WORK             V1414400
         MEXIT                                                          V1414600
.C10     ANOP                                                           V1414800
         SSM   *+1                 DISABLE                              V1415000
         MVC   COMWORK,COMTEST     GET GATE TEST MASK                   V1416000
         NC    COMWORK,&NAME       ARE ANY GATES OPEN                   V1417000
         BNZ   $START-4                                        @OZ40561 V1418000
         LPSW  COMWAIT             OTHERWISE ENABLE AND WAIT            V1419000
         SSM   COMWAIT             ENABLE                            R4 V1419100
         B     &NAME               LOOP AGAIN                        R4 V1419200
COMWORK  DS    XL($COMCOM-$START+4)                            @OZ40561 V1420000
COMTEST  DC    (L'COMWORK/4)X'00F00000'  GATE TEST MASK                 V1421000
COMWAIT  DC    0D'0',X'FF020000',A(&NAME)  WAIT STATE PSW               V1422000
         MEND                                                           V1423000
 TITLE 'H A S P / R T P  *GLOBAL SYMBOL AND STORAGE MACROS* $GENTANK'   V1424000
         SPACE 10                                                       V1425000
*                                                                       V1426000
*****   $GENTANK   *****     GENERATE DECOMPRESSION TANKS               V1427000
*                                                                       V1428000
*                                                                       V1429000
         MACRO                                                          V1430000
&NAME    $GENTANK                                                       V1431000
         GBLA  &NUMTANK,&TEMP,&CCT,&PRTSIZE                             V1432000
         LCLA  &TEMP1                                                   V1433000
&TEMP    SETA  1                                                        V1434000
.TANK    ANOP                                                           V1435000
&TEMP1   SETA  &TEMP+1                                                  V1436000
$TANK&TEMP $ACON $TANK&TEMP1                                            V1437000
         DC    AL1(0)              TANK RCB                             V1438000
         DC    AL1(0)              TANK SRCB                            V1439000
         DC    AL2(0)              TANK COUNT                           V1440000
         DC    &PRTSIZE.C' '             TANK DATA                      V1441000
         DC    (&CCT)C' '             TANK WORK SPACE                   V1442000
&TEMP    SETA  &TEMP+1                                                  V1443000
         AIF   (&TEMP LE &NUMTANK).TANK                                 V1444000
$TANK&TEMP1 EQU 0                      END CHAIN                        V1445000
&NAME    EQU   $TANK1              EXTERNAL NAME                        V1446000
         MEND                                                           V1447000
 TITLE 'H A S P / R T P  *GLOBAL SYMBOL AND STORAGE MACROS* $GENTCT'    V1448000
*                                                                       V1449000
*        $GENTCT MACRO             GENERATE A TCT                       V1450000
*                                                                       V1451000
         MACRO                                                          V1452000
&NAME    $GENTCT &PRE,&FCS,&RCB,&ADR,&DEV,&TLM,&BLM,&ACS,&ACB           V1453000
         GBLA  &LOCCOM,&CONSOLE                                         V1454000
         GBLA  &A,&B,&MACHINE,&T,&CCT,&D                                V1455000
         GBLB  &R(10)              CONFIGURATION SCOREBOARD             V1456000
         AIF   ('&PRE' EQ 'U' AND '&DEV' GT '9999').TCT12               V1457000
         AIF   (&MACHINE EQ 20).TCT1                                    V1458000
         CNOP  6,8                                                      V1459000
$&PRE.COM&A BALR R7,0                ENTRY FROM COMMUTATOR TO PROCESSOR V1460000
.TCT1    ANOP                                                           V1461000
$TCT&B   DS    0H                  ORIGIN OF TOTAL CONTROL TABLE        V1462000
         AIF   (&A NE 1).TCT2                                           V1463000
*                                                                       V1464000
*        SYMBOLIC DEFINITIONS USED BY PROCESSOR TO REFER TO TCT         V1465000
*                                                                       V1466000
         AIF   (&D LT 2).TCTORG                                         V1467000
&PRE.CTDSECT DSECT                                                      V1468000
         DEFTCT &PRE                                                    V1469000
HASPRTP  CSECT                                                          V1470000
         AGO   .TCT2                                                    V1471000
.TCTORG  ANOP                                                           V1472000
         DEFTCT &PRE                                                    V1473000
         ORG   $TCT&B                                                   V1474000
.TCT2    ANOP                                                           V1475000
*                                                                       V1476000
*        STORAGE ALLOCATION AND INITIAL VALUES FOR TCT                  V1477000
*                                                                       V1478000
&B       SETA  &B+1                                                     V1479000
&NAME    DS    0H                                                       V1480000
         AIF   (&MACHINE EQ 20).TCT11                                   V1481000
         B     $&PRE.RTN1              BASE REG IS SET GO TO PROCESSOR  V1482000
         B     $&PRE.COMM&A.+4           ON RETURN GO TO COMMUTATOR     V1483000
         DC    X'0',AL3(*-*),AL1(&PRE.F&DEV),AL1(&PRE&DEV),AL2(80)      V1484000
         AIF   (&MACHINE EQ 20 OR '&PRE' NE 'P').TCT02                  V1485000
         DC    X'00'               SENSE INFORMATION                    V1486000
         AIF   (&DEV EQ 3203 OR &DEV EQ 5203).TCT01                     V1487000
         DC    X'01'               FCB INDEX BYTE ALLOWED               V1488000
         AGO   .TCT03                                                   V1489000
.TCT01   ANOP                                                           V1490000
         DC    X'00'               FCB INDEX BYTE NOT ALLOWED           V1491000
         AGO   .TCT03                                                   V1492000
.TCT02   ANOP                                                           V1493000
         DC    H'0'                SENSE INFORMATION                    V1494000
.TCT03   ANOP                                                           V1495000
         DC    X'&ADR'              DEVICE ADDRESS (UCB)                V1496000
         DC    X'00'               EVENT CONTROL BLOCK                  V1497000
         DC    AL1(&PRE&DEV.1)                                          V1498000
         $ACON ,                SAVE AREA                               V1499000
.TCT11   ANOP                                                           V1500000
         $ACON ($TCT&B)                                                 V1501000
         DC    AL2(&FCS)                                                V1502000
         DC    AL1(&RCB)                                                V1503000
         DC    AL1(TCT&DEV)                                             V1504000
         $ACON ($&PRE.COMM&A)           COMMUTATOR ENTRY FOR THIS TCT   V1505000
         AIF   (&LOCCOM EQ 0).TCT6                                      V1506000
         DC    C'&PRE.&A'               ID OF DEVICE                    V1507000
.TCT6    ANOP                                                           V1508000
         AIF   (&R(2) AND &R(3) AND &R(7)).TCT3                         V1509000
         DC    AL1(&ACB)                                                V1510000
.TCT3    ANOP                                                           V1511000
         AIF   ('&PRE' EQ 'R' AND &R(2) AND &R(3) AND &R(7)).TCT4       V1512000
*        NORMAL EXTENTION TO TOTAL CONTROL TABLE                        V1513000
         $ACON ,                TANK Q                                  V1514000
         $ACON ,                BUFFER Q                                V1515000
         DC    AL1(&TLM)                                                V1516000
         DC    X'00'               CURRENT NUMBER OF TANKS IN Q         V1517000
         DC    AL1(&BLM)                                                V1518000
         DC    X'00'               CURRENT NUMBER OF BUFFERS IN Q       V1519000
.TCT4    AIF   ('&PRE' NE 'R' AND '&PRE' NE 'W').TCT5                   V1520000
         AIF   ('&PRE' EQ 'W' AND &CONSOLE EQ 0).TCT5                   V1521000
*        INPUT TANKS FOR READER AND CONSOLE                             V1522000
         $ACON ,                                                        V1523000
         DC    AL1(&ACB)                                                V1524000
         DC    X'80'               SRCB                                 V1525000
         DC    H'80'               DATA LENGTH                          V1526000
         DC    CL(&PRE.SIZE+&CCT)' '                                    V1527000
         AIF   ('&PRE' NE 'R').TCT13                                    V1528000
         $ACON ,                                                        V1529000
         DC    AL1(&ACB)                                                V1530000
         DC    X'80'               SRCB                                 V1531000
         DC    H'80'               DATA LENGTH                          V1532000
         DC    CL(&PRE.SIZE+&CCT)' '                                    V1533000
.TCT5    AIF   (  NOT ('&PRE' EQ 'U' AND '&DEV' EQ '2540' OR  &R(6)    CV1534000
               AND  '&PRE' EQ  'R' AND ('&DEV' EQ '25200' OR '&DEV'    CV1535000
               EQ '14420'))).TCT13                                      V1536000
         $ACON (1)                  HOLD TANK PTR                       V1537000
         MEXIT                                                          V1538000
.TCT12   AIF   (&A NE 1).TCT13                                          V1539000
         AIF   (&D EQ 1).TCTOG                                          V1540000
&PRE.CTDSECT DSECT                                                      V1541000
         DEFTCT U                                                       V1542000
HASPRTP CSECT                                                           V1543000
         AGO   .TCT13                                                   V1544000
.TCTOG   ANOP                                                           V1545000
         ORG   $TCT&T                                                   V1546000
         DEFTCT U                                                       V1547000
         ORG                                                            V1548000
.TCT13   MEND                                                           V1549000
 TITLE 'H A S P / R T P  *GLOBAL SYMBOL AND STORAGE MACROS* $LOGENT'    V1550000
         SPACE 12                                                       V1551000
*                                                                       V1552000
*****    $LOGENT *****             GENERATE A LOG TABLE ENTRY           V1553000
*                                                                       V1554000
*                                                                       V1555000
         MACRO                                                          V1556000
&NAME    $LOGENT &ID=,&CLASS=,&TEXT=                                    V1557000
         GBLA  &LOGID                                                   V1558000
&LOGID   SETA  &LOGID+1                                                 V1559000
&ID      EQU   &LOGID                                                   V1560000
&NAME    DS    0H                                                       V1561000
         DC    AL1(&ID)                                                 V1562000
         DC    AL1(&CLASS)                                              V1563000
         DC    H'0'                                                     V1564000
         DC    CL(L'LOGTEXT)&TEXT                                       V1565000
         MEND                                                           V1566000
         PRINT ON                                                       V1567000
         TITLE 'H A S P / R J E  * GLOBAL DEFINITIONS * '               V1568000
         SPACE 10                                                       V1569000
         GBLA  &RMTID              REMOTE'S IDENTIFICATION              V1570000
         GBLA  &TPBFSIZ            COMMUNICATIONS ADAPTER BUFFER SIZE   V1571000
         GBLA  &MLBFSIZ            MULTI-LEAVING BUFFER SIZE            V1572000
         GBLA  &NUMBUFS            NUMBER OF CA BUFFERS                 V1573000
         GBLA  &NUMTANK            NUMBER OF DECOMPRESSION TANKS        V1574000
         GBLA  &MACHINE            TYPE OF MACHINE FOR THIS ASSEMBLY    V1575000
         GBLA  &SUBMOD             SUB-MODEL NUMBER IF MODEL 20         V1576000
         GBLA  &LINESPD            COMMUNICATION LINE SPEED             V1577000
         GBLA  &DEBUG              DEBUG MODE SWITCH                    V1578000
         GBLA  &TRACE              TRACE MODE                           V1579000
         GBLA  &CORESIZ            MODEL 20 CORE SIZE                   V1580000
         GBLC  &XPARENT            TRANSPARENCY FEATURE INDICATOR       V1581000
         GBLA  &ERRMSGN            MAX NUM ERROR MESSAGES QUEUED        V1582000
         GBLA  &ERRTXTL            LENGTH OF TEXT FOR ERR MSG+1         V1583000
         GBLA  &HICORE             MAXIMUM STORAGE ADDRESS IN HRTP      V1584000
         GBLA  &HRTPORG            PROGRAM ORIGIN                       V1585000
         GBLA  &CMPTYPE            COMPRESSION TECHNIQUE UTILIZED       V1586000
         GBLA  &CCT                IDENTICAL CHARACTER COMPRESSION CT   V1587000
         GBLA  &REP                PATCH LOADER SWITCH                  V1588000
         GBLA  &TEMP               TEMPORARY SET SYMBOL                 V1589000
         GBLA  &TEMP2              2ND TEMP SET SYMBOL                  V1590000
         GBLA  &A,&B               TEMPORARY VARIABLES                  V1591000
         GBLA  &LOGCLAS                                                 V1592000
         GBLA  &LOGID              ERROR LOG ID ASSIGNMENT              V1593000
         GBLA  &NUMPRT                                                  V1594000
         GBLA  &NUMRDR                                                  V1595000
         GBLA  &NUMPUN                                                  V1596000
         GBLA  &CONSOLE                                                 V1597000
         GBLA  &PRTSIZE            MAXIMUM LENGTH OF PRINT LINE         V1598000
         GBLA  &WTOSIZE            LENGTH OF CONSOLE INPUT AREA         V1599000
         GBLA  &PRTCONS            OPTION FOR PRINTING MESSAGES         V1600000
         GBLA  &LOCCOM             LOCAL COMMAND OPTION                 V1601000
         GBLA  &HOME               INDICATOR FOR HOME LOOP TESTING      V1602000
         GBLA  &CFCS               CONTROL RECORD FCS                   V1603000
         GBLA  &PFCS(7)            FUNCTION MASK DEFINITIONS            V1604000
         GBLA  &RFCS(7)            FUNCTION MASK DEFINITIONS            V1605000
         GBLA  &UFCS(7)            FUNCTION MASK DEFINITIONS            V1606000
         GBLA  &WFCS(1)            FUNCTION DEFINITIONS                 V1607000
         GBLA  &CRCB               CONTROL RECORD CONTROL BYTE          V1608000
         GBLA  &PRCB(7)            STREAM DEFINITIONS                   V1609000
         GBLA  &RRCB(7)            STREAM DEFINITIONS                   V1610000
         GBLA  &URCB(7)            STREAM DEFINITIONS                   V1611000
         GBLA  &WRCB(1)            STREAM DEFINITIONS                   V1612000
         GBLA  &CTLM               CONTROL RECORD TANK LIMITS           V1613000
         GBLA  &PTLM(7)            NUM PRINTER TANK LIMITS              V1614000
         GBLA  &UTLM(7)            NUM PUNCH TANK LIMITS                V1615000
         GBLA  &WTLM(1)            CONSOLE TANK LIMITS OUTPUT ONLY      V1616000
         GBLA  &CBLM               CONTROL RECORD BUFFER LIMITS         V1617000
         GBLA  &PBLM(7)            NUM PRINTER BUFFER LIMITS            V1618000
         GBLA  &UBLM(7)            NUM PUNCH BUFFER LIMITS              V1619000
         GBLA  &WBLM(1)            NUM CONSOLE LIMITS                   V1620000
         GBLA  &PDEV(7)            DEVICE TYPE FOR PRINTERS             V1621000
         GBLA  &RDEV(7)            DEVICE TYPE FOR READERS              V1622000
         GBLA  &UDEV(7)            DEVICE TYPE FOR PUNCHES              V1623000
         GBLA  &WDEV(1)            DEVICE TYPE FOR CONSOLE              V1624000
         GBLA  &OFCS(1)            OPERATOR COMMAND FCS                 V1625000
         GBLA  &ORCB(1)            OPERATOR COMMAND RCB                 V1626000
         GBLA  &D                  NUMBER OF DUAL READ/PUNCH DEVICES    V1627000
         GBLA  &S(7)               READ/PUNCH CROSS REFERENCE           V1628000
         GBLA  &T                  CONFIGURATION WORK VARIABLE          V1629000
         GBLA  &L                  LENGTH ATTRIBUTE OF ADDR CONSTANTS   V1630000
         GBLB  &R(10)              CONFIGURATION SCOREBOARD             V1631000
         GBLC  &PADR(7)            DEVICE ADDRESSES OF PRINTERS         V1632000
         GBLC  &RADR(7)            DEVICE ADDRESSES OF READERS          V1633000
         GBLC  &UADR(7)            DEVICE ADDRESSES OF PUNCHES          V1634000
         GBLC  &WADR(1)            DEVICE ADDRESSES OF CONSOLE          V1635000
         GBLC  &ADAPT              COMMUNICATIONS ADAPTER               V1636000
         GBLC  &NUM                                                     V1637000
         GBLC  &GEN                                                     V1638000
         ACTR  500                                                      V1639000
         TITLE 'H A S P / R J E  *HASPGEN VARIABLES*  '                 V1640000
         SPACE 5                                                        V1641000
*                                                                       V1642000
*                   CONFIGURATION VARIABLES                             V1643000
*                                                                       V1644000
&RMTID   SETA  1                   REMOTE'S IDENTIFICATION              V1645000
&MACHINE SETA  20                  MODEL OF REMOTE TERMINAL CPU         V1646000
&SUBMOD  SETA  2                   SUB-MODEL 2 (MODEL 20)               V1647000
&LINESPD SETA  2000                COMMUNICATION LINE SPEED             V1648000
&CORESIZ SETA  8                   AMOUNT OF CORE AVAILABLE TO PROGRAM  V1649000
&XPARENT SETC  'YES'               ADAPTER TRANSPARENCY FEATURE         V1650000
&HICORE  SETA  &CORESIZ            HIGHEST CORE LOCATION AVAILABLE      V1651000
&HRTPORG SETA  X'80'               ORIGIN OF PROGRAM                    V1652000
&ERRMSGN SETA  10                  MAX NUM ERROR MSG QUEUED             V1653000
&ERRTXTL SETA  13                  LENGTH OF TEXT + BLANK               V1654000
*                                                                       V1655000
*        CONFIGURATION                                                  V1656000
*                                                                       V1657000
&PDEV(1) SETA  2203                PRINTER 1 MACHINE NUMBER             V1658000
&PDEV(2) SETA  0                   PRINTER 2 MACHINE NUMBER             V1659000
&PDEV(3) SETA  0                   PRINTER 3 MACHINE NUMBER             V1660000
&PDEV(4) SETA  0                   PRINTER 4 MACHINE NUMBER             V1661000
&PDEV(5) SETA  0                   PRINTER 5 MACHINE NUMBER             V1662000
&PDEV(6) SETA  0                   PRINTER 6 MACHINE NUMBER             V1663000
&PDEV(7) SETA  0                   PRINTER 7 MACHINE NUMBER             V1664000
&PADR(1) SETC  '4'                 PRINTER 1 ADDRESS                    V1665000
&PADR(2) SETC  '00F'               PRINTER 2 ADDRESS                    V1666000
&PADR(3) SETC  'FFF'               PRINTER 3 ADDRESS                    V1667000
&PADR(4) SETC  'FFF'               PRINTER 4 ADDRESS                    V1668000
&PADR(5) SETC  'FFF'               PRINTER 5 ADDRESS                    V1669000
&PADR(6) SETC  'FFF'               PRINTER 6 ADDRESS                    V1670000
&PADR(7) SETC  'FFF'               PRINTER 7 ADDRESS                    V1671000
&RDEV(1) SETA  2501                READER 1 MACHINE NUMBER              V1672000
&RDEV(2) SETA  0                   READER 2 MACHINE NUMBER              V1673000
&RDEV(3) SETA  0                   READER 3 MACHINE NUMBER              V1674000
&RDEV(4) SETA  0                   READER 4 MACHINE NUMBER              V1675000
&RDEV(5) SETA  0                   READER 5 MACHINE NUMBER              V1676000
&RDEV(6) SETA  0                   READER 6 MACHINE NUMBER              V1677000
&RDEV(7) SETA  0                   READER 7 MACHINE NUMBER              V1678000
&RADR(1) SETC  '1'                 READER 1 ADDRESS                     V1679000
&RADR(2) SETC  'FFF'               READER 2 ADDRESS                     V1680000
&RADR(3) SETC  'FFF'               READER 3 ADDRESS                     V1681000
&RADR(4) SETC  'FFF'               READER 4 ADDRESS                     V1682000
&RADR(5) SETC  'FFF'               READER 5 ADDRESS                     V1683000
&RADR(6) SETC  'FFF'               READER 6 ADDRESS                     V1684000
&RADR(7) SETC  'FFF'               READER 7 ADDRESS                     V1685000
&UDEV(1) SETA  1442                PUNCH 1 MACHINE NUMBER               V1686000
&UDEV(2) SETA  0                   PUNCH 2 MACHINE NUMBER               V1687000
&UDEV(3) SETA  0                   PUNCH 3 MACHINE NUMBER               V1688000
&UDEV(4) SETA  0                   PUNCH 4 MACHINE NUMBER               V1689000
&UDEV(5) SETA  0                   PUNCH 5 MACHINE NUMBER               V1690000
&UDEV(6) SETA  0                   PUNCH 6 MACHINE NUMBER               V1691000
&UDEV(7) SETA  0                   PUNCH 7 MACHINE NUMBER               V1692000
&UADR(1) SETC  '3'                 PUNCH 1 ADDRESS                      V1693000
&UADR(2) SETC  'FFF'               PUNCH 2 ADDRESS                      V1694000
&UADR(3) SETC  'FFF'               PUNCH 3 ADDRESS                      V1695000
&UADR(4) SETC  'FFF'               PUNCH 4 ADDRESS                      V1696000
&UADR(5) SETC  'FFF'               PUNCH 5 ADDRESS                      V1697000
&UADR(6) SETC  'FFF'               PUNCH 6 ADDRESS                      V1698000
&UADR(7) SETC  'FFF'               PUNCH 7 ADDRESS                      V1699000
&WDEV(1) SETA  0                   CONSOLE MACHINE NUMBER               V1700000
&WADR(1) SETC  '01F'               CONSOLE ADDRESS                      V1701000
&ADAPT   SETC  '020'               ADDRESS OF COMMUNICATIONS ADAPTER    V1702000
         AIF   (&HICORE GT 32).HISKP1                                   V1703000
&L       SETA  2                   LENGTH ATTRIBUTE OF ACONS            V1704000
         AGO   .HISKP                                                   V1705000
.HISKP1  ANOP                                                           V1706000
&L       SETA  4                   LENGTH ATTRIBUTE OF ACONS            V1707000
.HISKP   ANOP                                                           V1708000
&R(1)    SETB  1                   NO NON DUAL READER                   V1709000
&R(2)    SETB  1                   NO DUAL 2520                         V1710000
&R(3)    SETB  1                   NO DUAL 1442                         V1711000
&R(4)    SETB  1                   NO 2540 PUNCH                        V1712000
&R(5)    SETB  1                   NO NON DUAL PUNCH                    V1713000
&R(6)    SETB  1                   NOT MOD 20                           V1714000
&R(7)    SETB  1                   NO DUAL 2560                         V1715000
&R(8)    SETB  1                   NO SINGLE POCKET 1442                V1716000
&PRTSIZE SETA  132                 MAXIMUM PRINT LINE SIZE              V1717000
&WTOSIZE SETA  120                 LENGTH OF CONSOLE INPUT AREA         V1718000
*                                                                       V1719000
*                   INTERNAL VARIABLES                                  V1720000
*                                                                       V1721000
&NUMBUFS SETA  8                   NUMBER OF TP BUFFERS                 V1722000
&TPBFSIZ SETA  400                 DEFAULT BUFFER SIZE                  V1723000
&MLBFSIZ SETA  400                 MULTI-LEAVING BUFFER SIZE            V1724000
&TPBFSIZ SETA  &MLBFSIZ            TRANSMISSION BUFFER SIZE             V1725000
&TPBFSIZ SETA  &TPBFSIZ+&TPBFSIZ-&TPBFSIZ/2*2    FORCE BUFSIZE EVEN     V1726000
&NUMTANK SETA  5                   NUMBER OF DECOMPRESSION TANKS        V1727000
&CMPTYPE SETA  2                   COMPRESSION TECHNIQUE INDICATOR      V1728000
*                                  (0 = NO COMPRESSION )                V1729000
*                                  (1 = TRAILING BLANK ELIMINATION )    V1730000
*                                  (2 = BLANK COMPRESSION ONLY )        V1731000
*                                  (3 = COMPRESS ALL IDENTICAL CHARS )  V1732000
&CCT     SETA  4                   MINIMUM EQUAL CHARACTERS TO COMPRESS V1733000
&LOGCLAS SETA  0                   LOWEST ERROR SEVERITY TO LOG         V1734000
&GEN     SETC  'GEN'                                                    V1735000
&PRTCONS SETA  0                   PRINT CONSOLE MESSAGES OPTION        V1736000
&LOCCOM  SETA  0                   LOCAL COMMAND OPTION                 V1737000
&HOME    SETA  0                   HOME LOOP OFF                        V1738000
*                                                                       V1739000
*        FUNCTION CONTROL MASKS FOR TCTS                                V1740000
*                                                                       V1741000
&CFCS    SETA  X'0000'             CONTROL RECORD PROCESSOR             V1742000
&PFCS(1) SETA  X'0800'             PRINTER 1                            V1743000
&PFCS(2) SETA  X'0400'             PRINTER 2                            V1744000
&PFCS(3) SETA  X'0200'             PRINTER 3                            V1745000
&PFCS(4) SETA  X'0100'             PRINTER 4                            V1746000
&PFCS(5) SETA  X'0008'             PRINTER 5                            V1747000
&PFCS(6) SETA  X'0004'             PRINTER 6                            V1748000
&PFCS(7) SETA  X'0002'             PRINTER 7                            V1749000
&UFCS(1) SETA  X'0001'             PUNCH 1                              V1750000
&UFCS(2) SETA  X'0002'             PUNCH 2                              V1751000
&UFCS(3) SETA  X'0004'             PUNCH 3                              V1752000
&UFCS(4) SETA  X'0008'             PUNCH 4                              V1753000
&UFCS(5) SETA  X'0100'             PUNCH 5                              V1754000
&UFCS(6) SETA  X'0200'             PUNCH 6                              V1755000
&UFCS(7) SETA  X'0400'             PUNCH 7                              V1756000
&WFCS(1) SETA  X'0040'             CONSOLE                              V1757000
&OFCS(1) SETA  X'0000'             OPERATOR COMMAND FCS                 V1758000
&RFCS(1) SETA  X'0800'             READER FUNCTION 1                    V1759000
&RFCS(2) SETA  X'0400'             READER FUNCTION 2                    V1760000
&RFCS(3) SETA  X'0200'             READER FUNCTION 3                    V1761000
&RFCS(4) SETA  X'0100'             READER FUNCTION 4                    V1762000
&RFCS(5) SETA  X'0008'             READER FUNCTION 5                    V1763000
&RFCS(6) SETA  X'0004'             READER FUNCTION 6                    V1764000
&RFCS(7) SETA  X'0002'             READER FUNCTION 7                    V1765000
*        RECORD CONTROL BYTES                                           V1766000
*                                                                       V1767000
&CRCB    SETA  X'80'               CONTROL RECORD CONTROL BYTE          V1768000
&PRCB(1) SETA  X'94'               STREAM 1 PRINT RECORDS               V1769000
&PRCB(2) SETA  X'A4'               STREAM 2 PRINT RECORDS               V1770000
&PRCB(3) SETA  X'B4'               STREAM 3 PRINT RECORDS               V1771000
&PRCB(4) SETA  X'C4'               STREAM 4 PRINT RECORDS               V1772000
&PRCB(5) SETA  X'D4'               STREAM 5 PRINT RECORDS               V1773000
&PRCB(6) SETA  X'E4'               STREAM 6 PRINT RECORDS               V1774000
&PRCB(7) SETA  X'F4'               STREAM 7 PRINT RECORDS               V1775000
&URCB(1) SETA  X'95'               STREAM 1 PUNCH RECORDS               V1776000
&URCB(2) SETA  X'A5'               STREAM 2 PUNCH RECORDS               V1777000
&URCB(3) SETA  X'B5'               STREAM 3 PUNCH RECORDS               V1778000
&URCB(4) SETA  X'D5'               STREAM 3 PUNCH RECORDS               V1779000
&URCB(4) SETA  X'C5'               STREAM 4 PUNCH RECORDS               V1780000
&URCB(5) SETA  X'D5'               STREAM 5 PUNCH RECORDS               V1781000
&URCB(6) SETA  X'E5'               STREAM 6 PUNCH RECORDS               V1782000
&URCB(7) SETA  X'F5'               STREAM 7 PUNCH RECORDS               V1783000
&WRCB(1) SETA  X'91'               MESSAGE TO TERM OPERATOR             V1784000
&ORCB(1) SETA  X'92'               OPERATOR COMMAND RCB                 V1785000
&RRCB(1) SETA  X'93'               STREAM 1 TO HASP                     V1786000
&RRCB(2) SETA  X'A3'               STREAM 2 TO HASP                     V1787000
&RRCB(3) SETA  X'B3'               STREAM 3 TO HASP                     V1788000
&RRCB(4) SETA  X'C3'               STREAM 4 TO HASP                     V1789000
&RRCB(5) SETA  X'D3'               STREAM 5 TO HASP                     V1790000
&RRCB(6) SETA  X'E3'               STREAM 6 TO HASP                     V1791000
&RRCB(7) SETA  X'F3'               STREAM 7 TO HASP                     V1792000
*                                                                       V1793000
*        THE FOLLOWING VALUES REPRESENT THE LIMIT OF QUEUING            V1794000
*        FOR EACH INDICATED DEVICE.                                     V1795000
*        THE 'BL' VALUES REPRESENT THE MAXIMUM NUMBER OF BUFFERS        V1796000
*        FROM HASP WHICH WILL BE QUEUED ON THE DEVICE.                  V1797000
*        THE 'TL' VALUES REPRESENT THE NUMBER OF DECOMPRESSED           V1798000
*        RECORDS WHICH WILL BE QUEUED.NOTE THAT SINCE ONE               V1799000
*        DECOMPRESSED RECORD WILL ALWAYS BE IN PROCESS,THE DEVICE       V1800000
*        WILL REQUIRE ONE TANK MORE THAN THE TANK LIMIT(A 2540          V1801000
*        PUNCH REQUIRES 2 MORE FOR ERROR RECOVERY PURPOSES).            V1802000
*                                                                       V1803000
         SPACE 3                                                        V1804000
*                                                                       V1805000
*        DECOMPRESSION TANK LIMITS                                      V1806000
*                                                                       V1807000
*              PRINTERS                                                 V1808000
&PTLM(1) SETA  1                   PRINTER 1-DECOMPRESSION LIMIT        V1809000
&PTLM(2) SETA  &PTLM(1)            PRINTER 2-DECOMPRESSION LIMIT        V1810000
&PTLM(3) SETA  &PTLM(1)            PRINTER 3-DECOMPRESSION LIMIT        V1811000
&PTLM(4) SETA  &PTLM(1)            PRINTER 4-DECOMPRESSION LIMIT        V1812000
&PTLM(5) SETA  &PTLM(1)            PRINTER 5-DECOMPRESSION LIMIT        V1813000
&PTLM(6) SETA  &PTLM(1)            PRINTER 6-DECOMPRESSION LIMIT        V1814000
&PTLM(7) SETA  &PTLM(1)            PRINTER 7-DECOMPRESSION LIMIT        V1815000
*              PUNCHES                                                  V1816000
&UTLM(1) SETA  1                   PUNCH 1 - DECOMPRESSION LIMIT        V1817000
&UTLM(2) SETA  &UTLM(1)            PUNCH 2 - DECOMPRESSION LIMIT        V1818000
&UTLM(3) SETA  &UTLM(1)            PUNCH 3 - DECOMPRESSION LIMIT        V1819000
&UTLM(4) SETA  &UTLM(1)            PUNCH 4 - DECOMPRESSION LIMIT        V1820000
&UTLM(5) SETA  &UTLM(1)            PUNCH 5 - DECOMPRESSION LIMIT        V1821000
&UTLM(6) SETA  &UTLM(1)            PUNCH 6 - DECOMPRESSION LIMIT        V1822000
&UTLM(7) SETA  &UTLM(1)            PUNCH 7 - DECOMPRESSION LIMIT        V1823000
*              CONSOLE                                                  V1824000
&WTLM(1) SETA  &NUMTANK-2          CONSOLE DECOMPRESSION LIMIT          V1825000
*              CONTROL RECORD PROCESSOR                                 V1826000
&CTLM    SETA  &NUMTANK            CONTROL DECOMPRESSION LIMIT          V1827000
*                                                                       V1828000
*        BUFFER QUEUING LIMITS                                          V1829000
*                                                                       V1830000
*              PRINTERS                                                 V1831000
&PBLM(1) SETA  2                   PRINTER 1-BUFFER QUEUING LIMIT       V1832000
&PBLM(2) SETA  &PBLM(1)            PRINTER 2-BUFFER QUEUING LIMIT       V1833000
&PBLM(3) SETA  &PBLM(1)            PRINTER 3-BUFFER QUEUING LIMIT       V1834000
&PBLM(4) SETA  &PBLM(1)            PRINTER 4-BUFFER QUEUING LIMIT       V1835000
&PBLM(5) SETA  &PBLM(1)            PRINTER 5-BUFFER QUEUING LIMIT       V1836000
&PBLM(6) SETA  &PBLM(1)            PRINTER 6-BUFFER QUEUING LIMIT       V1837000
&PBLM(7) SETA  &PBLM(1)            PRINTER 7-BUFFER QUEUING LIMIT       V1838000
*              PUNCHES                                                  V1839000
&UBLM(1) SETA  2                   PUNCH 1 - BUFFER QUEUING LIMIT       V1840000
&UBLM(2) SETA  &UBLM(1)            PUNCH 2 - BUFFER QUEUING LIMIT       V1841000
&UBLM(3) SETA  &UBLM(1)            PUNCH 3 - BUFFER QUEUING LIMIT       V1842000
&UBLM(4) SETA  &UBLM(1)            PUNCH 4 - BUFFER QUEUING LIMIT       V1843000
&UBLM(5) SETA  &UBLM(1)            PUNCH 5 - BUFFER QUEUING LIMIT       V1844000
&UBLM(6) SETA  &UBLM(1)            PUNCH 6 - BUFFER QUEUING LIMIT       V1845000
&UBLM(7) SETA  &UBLM(1)            PUNCH 7 - BUFFER QUEUING LIMIT       V1846000
*              CONSOLE                                                  V1847000
&WBLM(1) SETA  3                   CONSOLE BUFFER QUEUING LIMIT         V1848000
*              CONTROL RECORD PROCESSOR                                 V1849000
&CBLM    SETA  &NUMBUFS            CONTROL BUFFER QUEUING LIMIT         V1850000
         PRINT &GEN                                                     V1851000
 TITLE ' L O A D E R  --  PUNCHES M/20 OR NON 20 LOADER DECKS'          V1852000
         SPACE 20                                                       V1853000
         AIF   (&MACHINE EQ 20).LOAD20                                  V1854000
         PUNCH '             -  ' PUNCH FIRST LOADER CARD       V1855000
         AGO   .SKIP                                                    V1856000
.LOAD20  ANOP                                                           V1857000
         PUNCH '}+ &&$n+#{nN&&nX&&#00 0CV1858000
               K{ ;}< ^r  J  '    PUNCH LAST LOADER CARD  V1859000
.SKIP    ANOP                                                           V1860000
 TITLE 'G L O B A L   S Y M B O L   D E F I N I T I O N S'              V1861000
         SPACE 3                                                        V1862000
HASPRTP  START 0                                                        V1863000
*                                                                       V1864000
*                   DEBUGGING VARIABLES                                 V1865000
*                                                                       V1866000
&DEBUG   SETA  1                                                        V1867000
&TRACE   SETA  0                   NO TRACE DEGRADATION                 V1868000
&REP     SETA  1                   PATCH MODE ON                        V1869000
*                                                                       V1870000
*        CONFIGURATION DEPENDENT EQUATES                                V1871000
*                                                                       V1872000
         $CONFIG                                                        V1873000
&A       SETA  1                                                        V1874000
*                                                                       V1875000
*        SYMBOLIC DEFINITIONS USED TO REFER TO TCT LOCATIONS            V1876000
*        ** SEE GLOBAL STORAGE FOR UNIQUE PROCESSORS EQUIVALENT DEFS    V1877000
*                                                                       V1878000
TCTDSECT DSECT                                                          V1879000
         DEFTCT T                  DEFINE TCT SYMBOLS                   V1880000
*                                                                       V1881000
*        TCTSTAT BIT DEFINITIONS                                        V1882000
*                                                                       V1883000
TCT1403  EQU   X'08'               TCT STATUS FLAGS FOR 1403, SW ON     V1884000
TCT1443  EQU   X'08'               TCT STATUS FLAGS FOR 1443, SW ON     V1885000
TCT2203  EQU   X'08'               TCT STATUS FLAGS FOR 2203, SW ON     V1886000
TCT3211  EQU   X'08'               TCT STATUS FLAGS FOR 3211, SW ON     V1887000
TCT3203  EQU   X'08'               TCT STATUS FLAGS FOR 3203, SW ON     V1888000
TCT5203  EQU   X'08'               TCT STATUS FLAGS FOR 5203, SW ON     V1889000
TCT2501  EQU   X'00'               TCT STATUS FLAGS FOR 2501            V1890000
TCT2520  EQU   X'00'               TCT STATUS FLAGS FOR 2520            V1891000
TCT25200 EQU   X'01'               TCT STATUS FLAGS FOR 2520 DUAL       V1892000
TCT1442  EQU   X'08'               TCT STATUS FLAGS FOR 1442            V1893000
TCT14420 EQU   X'02'               TCT STATUS FLAGS FOR 1442 DUAL       V1894000
TCT2540  EQU   X'04'               TCT STATUS FLAGS FOR 2540            V1895000
TCT25600 EQU   X'02'               TCT STATUS FLAGS FOR 2560 DUAL       V1896000
TCT2560  EQU   X'00'               TCT STATUS FLAGS FOR 2560            V1897000
TCT1052  EQU   X'10'               TCT STATUS FLAGS FOR 1052            V1898000
TCT2152  EQU   X'10'               TCT STATUS FLAGS FOR 2152            V1899000
TCTREL   EQU   X'04'               INTERLOCK RELEASE REQ FOR CONSOLE    V1900000
TCTDUAL  EQU   TCT14420+TCT25200   EITHER DUAL DEVICE                   V1901000
TCTOPEN  EQU   X'80'               TCT OPEN BIT                         V1902000
TCTACT   EQU   X'40'               ACTION REQUIRED ON THIS TCT          V1903000
TCTREQ   EQU   X'08'               CONSOLE REQUEST BIT                  V1904000
TCTPRTSW EQU   X'08'               PRINTER AVAILABLE FOR CONSOLE        V1905000
TCTSTOP  EQU   X'20'               TCT IS IN STOPPED STATE              V1906000
*                                  .S COMMAND REQUIRED TO START UP      V1907000
*        TCTUCB BIT DEFINITIONS                                         V1908000
         SPACE 2                                                        V1909000
TCTNOINT EQU   X'80'               NO INTERRUPTS ON DEVICE ALLOWED      V1910000
         SPACE 2                                                        V1911000
*        DUMMY TCT DEVICE DEFINITIONS FOR CTLTCT                        V1912000
         SPACE 2                                                        V1913000
C0       EQU   X'00'               DUMMY OPCODE FOR CONTROL             V1914000
C01      EQU   X'00'               DUMMY OPCODE FOR CONTROL             V1915000
CF0      EQU   X'00'               DUMMY FLAGS FOR CCW                  V1916000
TCT0     EQU   0                   DUMMY DEVICE STATUS                  V1917000
         SPACE 2                                                        V1918000
***      TCTECB BIT DEFINITIONS                                         V1919000
         SPACE 2                                                        V1920000
TCTBUSY  EQU   X'10'               DEVICE BUSY BIT                      V1921000
         SPACE 2                                                        V1922000
***      TCTSENSE BIT DEFINITIONS (FIRST BYTE)                          V1923000
         SPACE 1                                                        V1924000
TCTINREQ EQU   X'40'               INTERVENTION REQUIRED BIT            V1925000
         SPACE 1                                                        V1926000
***      TCTINDEX BIT DEFINITIONS                                       V1927000
         SPACE 1                                                        V1928000
INDEXOK  EQU   X'01'               FCB INDEX BYTE ALLOWED               V1929000
         SPACE 2                                                        V1930000
 TITLE '                                   COMMUNICATIONS BUFFER DSECT' V1931000
         SPACE 20                                                       V1932000
BUFDSECT DSECT                     TRANSMISSION BUFFER DSECT            V1933000
BUFBEGIN DS    0F                  BEGINNING OF THE BUFFER              V1934000
BUFCHAIN $ACON 0                   BUFFER CHAIN FIELD                   V1935000
BUFCOUNT DS    H                   COUNT OF BYTES TO TRANSMIT           V1936000
BUFSTAT  DS    C                   BUFFER STATUS BYTE                   V1937000
BUFSTART DS    CL2                 TRANSMISSION CONTROL BYTES           V1938000
BUFBCB   DS    C                   BLOCK CONTROL BYTE                   V1939000
BUFFCS   DS    CL2                 FUNCTION CONTROL SEQUENCE            V1940000
BUFDATA  DS    (&TPBFSIZ-5)C       DATA PORTION OF TP BUFFER            V1941000
BUFEND   DS    0F                  FULL ALIGNMENT FOR THE NEXT          V1942000
         SPACE  8                                                       V1943000
*                                                                       V1944000
*              BUFFER STATUS BIT DEFINITIONS                            V1945000
*                                                                       V1946000
         SPACE 2                                                        V1947000
BUFFAKE  EQU   X'01'               DUMMY BUFFER INDICATOR               V1948000
BUFRESP  EQU   X'02'               RESPONSE ONLY IN BUFFER              V1949000
BUFNAK   EQU   X'04'               NAK RESPONSE BEING SENT              V1950000
BUFTEXT  EQU   X'08'               BUFFER CONTAINS TEXT INFORMATION     V1951000
BUFUCHEK EQU   X'10'               UNIT CHECK EXPECTED                  V1952000
 TITLE '                                   DECOMPRESSION TANK DSECT'    V1953000
         SPACE 20                                                       V1954000
TANKDSEC DSECT                     UNIT RECORD TANK DSECT               V1955000
TANKCHN  $ACON ,                   TANK CHAIN FIELD                     V1956000
TANKRCB  DS    C                   TANK RECORD CONTROL BYTE             V1957000
TANKSRCB DS    C                   TANK SUB-RECORD CONTROL BYTE         V1958000
TANKCNT  DS    H                   COUNT OF DATA BYTES IN TANK          V1959000
TANKDATA DS    CL&PRTSIZE          DATA AREA IN THE TANK                V1960000
         SPACE 20                                                       V1961000
 TITLE '                                 LOG TABLE DSECT'               V1962000
         SPACE 20                                                       V1963000
LOGDSECT DSECT                     LOG DESECT                           V1964000
LOGID    DS    C                   LOG IDENTIFICATION                   V1965000
LOGCLASS DS    C                   SEVERITY  CODE OF MESSAGE            V1966000
LOGCOUNT DS    H                   COUNT OF TOTAL ERRORS                V1967000
LOGTEXT  DS    CL(&ERRTXTL-1)      TEXT OF MESSAGE                      V1968000
LOGEND   DS    0C                  END OF DSECT                         V1969000
 TITLE ' H A S P / R J E  *ORIGIN AND LOAD CONTROL*'                    V1970000
         SPACE 5                                                        V1971000
HASPRTP  CSECT                                                          V1972000
         AIF   (&MACHINE EQ 20).ORG20                                   V1973000
*        THE FOLLOWING CODE GENERATES THE 360 MODE LOADER FOR RTP.      V1974000
*        THE CODE IS VERY LOCATION SENSITIVE AND SHOULD BE MODIFIED     V1975000
*        ONLY WITH GREAT CARE....                                       V1976000
         DC    X'02000008A0000010' CCW TO SKIP 16 COLS OF CARD          V1977000
         DC    X'0200005060000038' LOAD TEXT OF FIRST CARD              V1978000
         DC    X'02000008B0000010' SKIP 16 COLS OF NEXT                 V1979000
         DC    X'0200008820000038' LOAD TEXT OF SECOND CARD             V1980000
         SR    R15,R15             INITIALIZE                           V1981000
         BALR  R14,0               LOOP RETURN ADDR                     V1982000
         LA    R15,1024(R15)       UP ONE K                             V1983000
         OI    0(R15),0            TEST END OF CORE                     V1984000
         BR    R14                 CONTINUE IF NOT                      V1985000
         NOPR  R0                  SPACER                               V1986000
         DC    A(X'18')            CAW                                  V1987000
         DC    AL4(56)             CARD TEXT COUNT                      V1988000
         DC    X'FFFFFFFF'         JUST IN TIME                         V1989000
         SH    R15,X'4E'           BACK UP TEXT LENGTH WORTH            V1990000
         ST    R15,X'20'           SET TEXT READ ADDR                   V1991000
         MVI   X'24',X'20'         AND KILL CHAINING                    V1992000
         LH    R1,2                LOAD UNIT ADDR                       V1993000
         B     X'AC'               AND CONTINUE                         V1994000
         DC    X'0000000000000054' PI NEW                               V1995000
         BALR  R14,0               READ ADDRESS(ABILITY)                V1996000
         USING *,R14               *                                    V1997000
         SIO   0(R1)               READ A CARD                          V1998000
         BCR   7,R14               LOOP UNTIL ACCEPTED                  V1999000
         TIO   0(R1)               TEST COMPLETE                        V2000000
         BC    3,*-4               LOOP IF NOT                          V2001000
         CH    R3,68               TEST FOR ERROR                       V2002000
         BNE   *                   LOOP IF READER ERROR                 V2003000
         L     R13,12              GET ADDR FROM CARD                   V2004000
         CLI   10,C'N'             IS THIS AN END CARD                  V2005000
         BCR   8,R13               BR TO PROGRAM IF YES                 V2006000
         CLI   9,C'T'              IS THIS TEXT CARD                    V2007000
         BCR   7,R14               IGNORE IF NO                         V2008000
         IC    R2,19               GET TEXT COUNT                       V2009000
         BCTR  R2,0                ADJUST                               V2010000
         STC   R2,*+5              AND SET IN MVC                       V2011000
         MVC   0(*-*,R13),0(R15)   LOAD TEXT                            V2012000
         BR    R14                 AND CONTINUE                         V2013000
         DROP  R14                                                      V2014000
         NOPR  R0                  SPACER                               V2015000
         MVC   X'54'(X'AC'-X'70'),X'70' MOVE PROGRAM                    V2016000
         LA    R3,2048             ERROR TEST CODE                      V2017000
         B     X'54'               START LOADING                        V2018000
.ORG20   ANOP                                                           V2019000
         ORG   HASPRTP             TO BEGINNING OF CSECT                V2020000
         DS    (&HRTPORG)C         PROGRAM ORIGIN                       V2021000
 TITLE 'H A S P / R J E  *SYMBOLIC REGISTER DEFINITIONS* '              V2022000
HASPRJE  EQU   *                                                        V2023000
         AIF   (&MACHINE EQ 20).EIGHTR  SKIP FIRST 8 REGS IF 360/20     V2024000
R0       EQU   0                   *                                    V2025000
R1       EQU   1                   *                                    V2026000
R2       EQU   2                   *                                    V2027000
R3       EQU   3                   *                                    V2028000
R4       EQU   4                   *                                    V2029000
R5       EQU   5                   *                                    V2030000
R6       EQU   6                   *                                    V2031000
R7       EQU   7                   *                                    V2032000
.EIGHTR  ANOP                      MODEL 20 BEGIN                       V2033000
R8       EQU   8                   *                                    V2034000
R9       EQU   9                   *                                    V2035000
R10      EQU   10                  *                                    V2036000
R11      EQU   11                  *                                    V2037000
R12      EQU   12                  *                                    V2038000
R13      EQU   13                  *                                    V2039000
R14      EQU   14                  *                                    V2040000
R15      EQU   15                  *                                    V2041000
TCTR     EQU   7                   TCT BASE REGISTER                    V2042000
         SPACE 3                                                        V2043000
*                                                                       V2044000
*              REGISTER ASSIGNMENTS AND/OR TYPICAL ASSIGNMENTS          V2045000
*                                                                       V2046000
         SPACE 3                                                        V2047000
*              R15 = WORK REG (SECONDARY LINK OR PARAMETER REGISTER)    V2048000
*              R14 = LINK REG                                           V2049000
*              R13 = BUFFER POINTER                                     V2050000
*              R12 = RESERVED                                           V2051000
*              R11 = WORK                                               V2052000
*              R10 = WORK                                               V2053000
*              R9  = WORK                                               V2054000
*              R8  = PARAMETER REGISTER                                 V2055000
         AIF   (&MACHINE EQ 20).X1                                      V2056000
*              R7  = WORK          READER ONLY                          V2057000
*              R6  = WORK                                               V2058000
*              R5  = WORK                                               V2059000
*              R4  = WORK                                               V2060000
*              R3  = BASE REGISTER                                      V2061000
*              R2  = BASE REGISTER                                      V2062000
*              R1  = BASE REGISTER                                      V2063000
*              R0  = ALTERNATE PARAMETER REG                            V2064000
.X1      AIF   (&MACHINE EQ 20).BASOK1                                  V2065000
         USING HASPRJE-&HRTPORG,R0,R1,R2,R3 PROVIDE FOR 16K             V2066000
         AGO   .BASOK2                                                  V2067000
.BASOK1  ANOP                                                           V2068000
         USING HASPRJE-&HRTPORG,0,1,2,3 PROVIDE FOR 16K                 V2069000
         DS    (X'24')C            SPACER FOR MODEL 20                  V2070000
.BASOK2  ANOP                                                           V2071000
         AIF   (&CONSOLE EQ 0 AND &PRTCONS EQ 0).ERRLOG                 V2072000
 TITLE 'ERROR MESSAGE LOG TABLE'                                        V2073000
         SPACE 10                                                       V2074000
         AIF   (&ERRMSGN GE 8).ERRLOGA                                  V2075000
&ERRMSGN SETA  8                                                        V2076000
.ERRLOGA ANOP                                                           V2077000
         SPACE 5                                                        V2078000
*                                                                       V2079000
*        ERROR MESSAGE LOG TABLE AND POINTERS                           V2080000
*                                                                       V2081000
         SPACE 3                                                        V2082000
$LOGTAB  DS    &ERRMSGN.XL4        ERROR MESSAGE LOG TABLE              V2083000
$LOGEND  $ACON (*)                 END OF LOG TABLE                     V2084000
$LOGOUT  $ACON ($LOGTAB-4)         ADDRESS OF LAST MESSAGE WRITTEN      V2085000
$LOGLAST $ACON ($LOGTAB-4)         ADDRESS OF LAST MESSAGE LOGGED       V2086000
.ERRLOG  ANOP                                                           V2087000
         TITLE 'H A S P / R T P  * C O M M U T A T O R  *  '            V2088000
         SPACE 12                                                       V2089000
         PRINT GEN                                                      V2090000
         AIF   (&MACHINE EQ 20).STRT1                          @OZ40559 V2090100
         SSM   COMWAIT             ENABLE                      @OZ40559 V2090200
.STRT1   ANOP                                                  @OZ40559 V2090300
$START   $GENCOM                                                        V2091000
         PRINT &GEN                                                     V2092000
         SPACE 3                                                        V2093000
$CHNTEMP $ACON 0                   DISABLED TEMPORARY WORK              V2094000
$LOGINFO DC    A(0)                INFORMATION TO BE LOGGED             V2095000
$LOGSAVE $ACON 0                   $LOG REG SAVE AREA                   V2096000
$COMDCOM DS    0C                                                       V2097000
$INPCOM  DS    0C                                                       V2098000
$DATCOM  DS    0C                                                       V2099000
$ROUCOM  DS    0C                                                       V2100000
 TITLE 'CONTROL PROCESSOR TOTAL CONTROL TABLE  --  C T C T'             V2101000
         PRINT GEN                                                      V2102000
         SPACE 10                                                       V2103000
&B       SETA  1                   SET SYMB TO CHAIN TCTS TOGETHER      V2104000
&A       SETA  1                                                        V2105000
&D       SETA  1                   SIGNAL ORG TO GENTCT                 V2106000
$CTLTCT  $GENTCT C,&CFCS,&CRCB,FFF,0,&CTLM,&CBLM,&CFCS,&CRCB CONT TCT   V2107000
&A       SETA  1                                                        V2108000
&D       SETA  &CONSOLE            SIGNAL DSECT OR ORG TO GENTCT        V2109000
         AIF   (&CONSOLE EQ 0 AND &PRTCONS EQ 0).TCTWTO                 V2110000
 TITLE 'CONSOLE TOTAL CONTROL TABLE  -- W T C T'                        V2111000
$CONTCT  $GENTCT W,&WFCS(&A),&WRCB(&A),&WADR(&A),&WDEV(&A),&WTLM(&A),  CV2112000
               &WBLM(&A),&OFCS(&A),&ORCB(&A) CONSOLE TCT                V2113000
.TCTWTO  ANOP                                                           V2114000
&D       SETA  &NUMPRT             SIGNAL DSECT OR ORG TO GENTCT        V2115000
.TCTPRTL AIF   (&A GT &NUMPRT).TCTPRT                                   V2116000
 TITLE 'PRINTER TOTAL CONTROL TABLES'                                   V2117000
         $GENTCT P,&PFCS(&A),&PRCB(&A),&PADR(&A),&PDEV(&A),&PTLM(&A),  CV2118000
               &PBLM(&A),&PFCS(&A),&PRCB(&A) PRINTER TCT                V2119000
&A       SETA  &A+1                                                     V2120000
         AGO   .TCTPRTL                                                 V2121000
.TCTPRT  ANOP                                                           V2122000
&A       SETA  1                                                        V2123000
&D       SETA  &NUMRDR             SIGNAL DSECT OR ORG TO GENTCT        V2124000
.TCTRDRL AIF   (&A GT &NUMRDR).TCTRDR                                   V2125000
 TITLE 'READER TOTAL CONTROL TABLES'                                    V2126000
         AIF   (&S(&A) NE 0).TCTRDR1                                    V2127000
         $GENTCT R,&RFCS(&A),&RRCB(&A),&RADR(&A),&RDEV(&A),0,0,        CV2128000
               &RFCS(&A),&RRCB(&A) READER TCT                           V2129000
         AGO   .TCTRDR2                                                 V2130000
.TCTRDR1 ANOP                                                           V2131000
&T       SETA  &S(&A)                                                   V2132000
         $GENTCT R,&UFCS(&T),&URCB(&T),&RADR(&A),&RDEV(&A),&UTLM(&T),  CV2133000
               &UBLM(&T),&RFCS(&A),&RRCB(&A) DUAL READER TCT            V2134000
&T       SETA  &B-1                                                     V2135000
.TCTRDR2 ANOP                                                           V2136000
&A       SETA  &A+1                                                     V2137000
         AGO   .TCTRDRL                                                 V2138000
.TCTRDR  ANOP                                                           V2139000
&A       SETA  1                                                        V2140000
&D       SETA  &NUMPUN             SIGNAL DSECT OR ORG TO GENTCT        V2141000
.TCTPUNL AIF   (&A GT &NUMPUN).TCTPUN                                   V2142000
 TITLE 'PUNCH TOTAL CONTROL TABLES  --  U T C T'                        V2143000
         $GENTCT U,&UFCS(&A),&URCB(&A),&UADR(&A),&UDEV(&A),&UTLM(&A),  CV2144000
               &UBLM(&A),&UFCS(&A),&URCB(&A) PUNCH TCT                  V2145000
&A       SETA  &A+1                                                     V2146000
         AGO   .TCTPUNL                                                 V2147000
.TCTPUN  ANOP                                                           V2148000
 TITLE 'MISCELLANEOUS GLOBAL STORAGE'                                   V2149000
$TCT&B   EQU   0                   LAST TCT POINTS TO ZERO              V2150000
         PRINT &GEN                                                     V2151000
         SPACE 3                                                        V2152000
*                                                                       V2153000
*              E R R O R  L O G  T A B L E                              V2154000
*                                                                       V2155000
LOGTABLE DS    0H                                                       V2156000
         ORG   *+X'92'             ORG OVER THE LOG TABLE               V2157000
$ERRTAB  EQU   LOGTABLE-LOGEND+LOGDSECT ERROR LOG TABLE FOR CE          V2158000
 SPACE 3                                                                V2159000
*                                                                       V2160000
*                  BEGINNING OF QUEUE CHAINS                            V2161000
*                                                                       V2162000
 SPACE 3                                                                V2163000
$TEMP    DC    H'0'                GLOBAL TEMPORARY WORK                V2164000
$TPBFSIZ DC    AL2(&TPBFSIZ)       RJE BUFFER SIZE                   R4 V2164500
$BUFPOOL $ACON $1STBUF             BUFFER POOL CHAIN CONTROL WORD       V2165000
$TANKPOL $ACON $1STTANK            TANK QUEUE CONTROL WORD              V2166000
$OUTBUF  $ACON 0                   XMISSION BUFFER CHAIN CTL WORD       V2167000
$CORESIZ $ACON 0                   SYSTEM MEMORY SIZE                   V2168000
$FCSOUT  DS    0H                  OUTGOING FUNCTION CONTROL SEQUENCE   V2169000
         DC    X'8FCF'             ALL FUNCTIONS PERMITTED              V2170000
$FCSIN   DC    X'8FCF'             INCOMING FCS FROM HASP               V2171000
         AIF   (&MACHINE NE 20).N20CON                                  V2172000
$WAITCON DC    H'160'              DELAYING CONSTANT FOR MOD 20         V2173000
         AGO   .N30CON                                                  V2174000
.N20CON  ANOP                                                           V2175000
$WAITCON DC    H'1500'             DELAYING CONSTANT FOR MODEL 30       V2176000
.N30CON  ANOP                                                           V2177000
 TITLE '$ C O N T R O L  -- INPUT CONTROL RECORD PROCESSOR  '           V2178000
*                                                                       V2179000
*                                                                       V2180000
$CRTN1   NULL                                                           V2181000
$CCOMM1  EQU   $CONTCOM                                                 V2182000
CFLAGS   EQU   0                   DUMMY CCW                            V2183000
COPCODE  EQU   0                   DUMMY CCW                            V2184000
*                                                                       V2185000
$CONTROL NULL  *                   ENTRY POINT                          V2186000
        $LA    R13,$CTLTCT         GET CONTROL TCT                      V2187000
         USING TCTDSECT,R13        *                                    V2188000
        $DCHAIN TCTTANK,R8,NOSSM   GET A TANK OF DATA                   V2189000
         BNZ   MPROCESS            BR IF GOTTEN                         V2190000
         MVI   $CONTCOM+1,0        NONE... CLOSE ENTRY                  V2191000
         B     $CONTCOM+4          AND EXIT                             V2192000
*                                                                       V2193000
*              PROCESS A CONTROL RECORD                                 V2194000
*                                                                       V2195000
         SPACE 3                                                        V2196000
MPROCESS NULL  *                   *                                    V2197000
         $TCTPOST T,R10            SHOW TANK GOTTEN                     V2198000
         DROP  R13                 DONE FOR NOW                         V2199000
         USING TANKDSEC,R8         *                                    V2200000
         UNPK  MTEMP+1(1),TANKRCB(1) SWAP DIGITS                        V2201000
         NI    MTEMP+1,7           TURN OFF CTL BIT                  R4 V2202000
         LH    R10,MTEMP           GET CTL FUNCTION TYPE                V2203000
         AR    R10,R10             DOUBLE IT                            V2204000
         $LA   R9,MCONTTAB-2       START OF CTL TYPE TABLE              V2205000
         AR    R9,R10              R9 = CORRECT TABLE ENTRY             V2206000
         LH    R9,0(0,R9)          R9 = CONTROL ADDRESS                 V2207000
         STH   R9,*+6              ENTER ROUTINE                        V2208000
         B     *-*                                                      V2209000
         EJECT                                                          V2210000
*                                                                       V2211000
*              SUBROUTINE TO FIND TCT CORRESPONDING TO SRCB FUNCTION    V2212000
*                R14=RETURN , CC NE 0 -R13 CONTAINS TCT,CC=0-NOT FOUND  V2213000
         SPACE 3                                                        V2214000
MTCTFIND NULL  *                   ENTRY POINT                          V2215000
        $LA    R13,$TCT1           FIRST TCT                            V2216000
         USING TCTDSECT,R13        ADDRESSABILITY                       V2217000
MNEXTTCT NULL  *                   *                                    V2218000
         CLC   TCTRCB,TANKSRCB     IS THIS CORRECT TCT                  V2219000
         BE    MTCTOK              BR IF YES                            V2220000
         AIF   (&R(2) AND &R(3) AND &R(7)).MDUAL                        V2221000
         CLC   TCTINRCB,TANKSRCB   TEST FOR CORRECT TCT HERE            V2222000
         BE    MTCTOK              BR IF YES                            V2223000
.MDUAL   ANOP                                                           V2224000
        $LOAD  R13,TCTNEXT         NO... TO NEXT                        V2225000
        $LTR   R13,R13             IS THIS ALL...                       V2226000
         BNZ   MNEXTTCT            BR IF MORE                           V2227000
         BR    R14                 RETURN WITH COND. CODE = 0           V2228000
MTCTOK  $LTR   R14,R14             SET COND. CODE NON-ZERO              V2229000
         BR    R14                 AND RETURN                           V2230000
         EJECT                                                          V2231000
         SPACE 5                                                        V2232000
*                                                                       V2233000
*              SUBROUTINE TO $TPPUT AN ANSWERING CTL RECORD             V2234000
*                   R8 = TANKADDR                                       V2235000
         SPACE 3                                                        V2236000
MPUT     NULL  *                   ENTRY POINT                          V2237000
         BAS   R14,$TPPUT          GO PUT RECORD                        V2238000
         BNZ   MEXIT               EXIT IF ACCEPTED                     V2239000
         MVC   $CONTCOM+2(2),MREPUTA    SET COMUTATOR RE-ENTRY          V2240000
        $STO   R8,MTANK            SAVE TANK ADDR                       V2241000
         B     $CONTCOM+4          EXIT TO COMUTATOR                    V2242000
MREPUT   NULL  *                   RETRY PUTTING RECORD                 V2243000
        $LOAD  R8,MTANK            RESTORE TANK ADDR                    V2244000
         BAS   R14,$TPREPUT        TRY IT                               V2245000
         BZ    $CONTCOM+4          CYCLE IF STILL NOT ACCEPTED          V2246000
MEXIT    NULL  *                   ENTRY AT END OF PROCESSING           V2247000
        $FREE  $TANKPOL,R8,NOENB   FREE TANK                            V2248000
         MVC   $CONTCOM+2(2),MCONTROL     RESET COMUTATOR               V2249000
         B     $CONTROL            AND TRY NEXT TANK                    V2250000
MTANK   $ACON  0                   TANK REG STORAGE                     V2251000
MTEMP    DC    H'0'                TEMP STORAGE (HI-BYTE ALWAYS ZERO)   V2252000
MREPUTA  DC    S(MREPUT)           COMMUTATOR ADJUSTMENT ADDR           V2253000
MCONTROL DC    S($CONTROL)         COMMUTATOR ADJUSTMENT ADDR           V2254000
MCONTTAB NULL  *                   CONTROL TYPE BRANCH TABLE            V2255000
*        DC    S(MC0)         000  RESERVED                             V2256000
         DC    S(MC1)         001  START FUNCTION REQUEST               V2257000
         DC    S(MC2)         010  START FUNCTION PERMISSION            V2258000
         DC    S(MC3)         011  RESERVED                             V2259000
         DC    S(MC4)         100  RESERVED                             V2260000
         DC    S(MC5)         101  RESERVED                             V2261000
         DC    S(MC6)         110  RESERVED                             V2262000
         DC    S(MC7)         111  GENERAL CONTROL TYPE                 V2263000
         EJECT                                                          V2264000
         SPACE 3                                                        V2265000
*                                                                       V2266000
* MC0          CONTROL RECORD , TYPE = 000 (RESERVED)                   V2267000
*                                                                       V2268000
         SPACE 3                                                        V2269000
*                                                                       V2270000
*              RESERVED FOR FUTURE USE                                  V2271000
*                                                                       V2272000
MC0      EQU   MEXIT               TO DEFINE SYMBOL                     V2273000
         SPACE 3                                                        V2274000
*                                                                       V2275000
* MC1          CONTROL RECORD , TYPE = 001(REQUEST TO START FUNCTION)   V2276000
*                                                                       V2277000
         SPACE 3                                                        V2278000
MC1      NULL  *                   *                                    V2279000
*                                                                       V2280000
         BAS   R14,MTCTFIND        GO FIND TCT                          V2281000
         BNZ   MTCTSET             BR IF FOUND                          V2282000
        $TRACE SSM=YES                                                  V2283000
         B     MEXIT               IGNORE REQUEST                       V2284000
MTCTSET  NULL  *                   CORRECT TCT FOUND                    V2285000
         NI    TCTSTAT,255-TCTOPEN SHOW USE                             V2286000
         MVZ   TANKRCB,=X'A0'      CHANGE REQUEST TO PERMISSION         V2287000
         B     MPUT                AND SEND IT                          V2288000
         SPACE 3                                                        V2289000
*                                                                       V2290000
* MC2          CONTROL RECORD , TYPE = 010(PERMISSION TO START FCN)     V2291000
*                                                                       V2292000
         SPACE 3                                                        V2293000
MC2      NULL  *                   ENTRY POINT                          V2294000
        $TRACE SSM=YES                                                  V2295000
         BAS   R14,MTCTFIND        GO LOOK-UP TCT                       V2296000
         BZ    MEXIT               IGNORE IF NOT FOUND                  V2297000
        $LOAD  R14,TCTCOM          GET COMUTATOR ENTRY                  V2298000
         MVI   1(R14),X'F0'        OPEN IT                              V2299000
         NI    TCTSTAT,255-TCTOPEN SHOW OPEN                            V2300000
         B     MEXIT               AND EXIT                             V2301000
         SPACE 3                                                        V2302000
*                                                                       V2303000
* MC3          CONTROL RECORD , TYPE = 011 (RESERVED)                   V2304000
         SPACE 3                                                        V2305000
MC3      EQU   MEXIT               NOT YET DEFINED                      V2306000
         SPACE 3                                                        V2307000
*                                                                       V2308000
* MC4          CONTROL RECORD , TYP = 100 (RESERVED)                    V2309000
*                                                                       V2310000
         SPACE 3                                                        V2311000
MC4      EQU   MEXIT               NOT YET DEFINED                      V2312000
         SPACE 3                                                        V2313000
*                                                                       V2314000
* MC5          CONTROL RECORD , TYPE = 101 (RESERVED)                   V2315000
*                                                                       V2316000
         SPACE 3                                                        V2317000
MC5      EQU   MEXIT               TO DEFINE SYMBOL                     V2318000
*                                  FUNCTION IS NOT YET SUPPORTED        V2319000
         SPACE 3                                                        V2320000
*                                                                       V2321000
* MC6          CONTROL RECORD , TYPE = 110(RESERVED)                    V2322000
*                                                                       V2323000
         SPACE 3                                                        V2324000
*                                                                       V2325000
*              THIS CONTROL TYPE IS CURRENTLY UNDEFINED BUT IS          V2326000
*              RESERVED FOR FUTURE USE.                                 V2327000
*                                                                       V2328000
MC6      EQU   MEXIT               TO DEFINE SYMBOL                     V2329000
         SPACE 3                                                        V2330000
*                                                                       V2331000
* MC7          CONTROL RECORD , TYPE = 111 (GENERALIZED CONTROL)        V2332000
*                                          (TYPE INDICATED IN SRCB)     V2333000
*                                                                       V2334000
         SPACE 3                                                        V2335000
MC7      EQU   MEXIT               ENTRY POINT                          V2336000
*                                                                       V2337000
*              CURRENTLY NO FUNCTIONS ARE IMPLEMENTED FOR THIS          V2338000
*              CONTROL FUNCTION. THE TYPE OF CONTROL RECORD, SUCH       V2339000
*              AS ACCOUNTING,SIGN-ON,INITIALIZATION,ETC, IS             V2340000
*              INDICATED IN THE SRCB.                                   V2341000
*              THE SRCB IDENTIFICATION CHARACTERS 'A' THRU 'R'          V2342000
*              AND '0' THRU '9' ARE RESERVED FOR FUTURE HASP            V2343000
*              DEVELOPMENT. ALL OTHER EBCDIC CHARACTERS , WHICH         V2344000
*              ARE TRANSMISSION COMPATIBLE ARE AVAILABLE TO THE         V2345000
*              USER TO ADD ADDITIONAL CONTROL FUNCTIONS.                V2346000
*                                                                       V2347000
         SPACE 3                                                        V2348000
         DROP  R8,R13                                                   V2349000
         PRINT &GEN                                                     V2350000
         AIF   (&NUMPRT EQ 0).PRTNSKP                                   V2351000
 TITLE '$ P R T N 1  --  PRINT SERVICE PROCESSOR'                       V2352000
&A       SETA  0                                                        V2353000
*                                                                       V2354000
*        BASE REGISTER ASSIGNMENT                                       V2355000
*                                                                       V2356000
         USING TANKDSEC,R8                                              V2357000
         AIF   (&NUMPRT EQ 1).PSK1                                      V2358000
         USING PCTDSECT,TCTR                                            V2359000
.PSK1    ANOP                                                           V2360000
$PRTN1   NULL                                                           V2361000
PNEXT    EQU   *                   BASIC LOOP                           V2362000
         $GETTNK P,R8,R9,EMPTY=WAIT GET NEXT TANK TO PRINT              V2363000
         AH    R8,=Y(TANKDATA-TANKDSEC) GET TO DATA                @N30 V2363100
         STH R8,PCTCCW+2           PUT DATA ADDRESS IN CCW         @N30 V2363200
         SH    R8,=Y(TANKDATA-TANKDSEC) GET TO START OF TANK       @N30 V2363300
         CLI   TANKCNT+1,0         TEST FOR END OF JOB                  V2364000
         AIF   (&PRTCONS EQ 0).PSK5                                     V2365000
         BNE   PTSTEOF             BRANCH IF NON ZERO COUNT        @N30 V2366000
         MVI   PEOFSW,X'FF'        INDICATE END OF FILE            @N30 V2366500
         OI    PCTSTAT,TCTPRTSW    SET PRINTER AVAILABLE                V2367000
         OI    $WCOMM1+1,X'F0'     TURN ON CONSOLE COMMUTATOR GATE      V2368000
         MVI   TANKSRCB,X'B1'      FORCE SKIP                      @N30 V2369000
         B     PSETCC              GO PRINT BLANK AND SUPPRESS     @N30 V2370000
PEOFSW   DC    AL1(*-*,*-*)        END OF FILE SWITCH              @N30 V2371000
PTSTEOF  CLI   PEOFSW,0            END OF FILE SW ON...            @N30 V2372000
         BE    PTSTRCB             TEST TYPE IF NOT                @N30 V2372600
         CLC   TANKCNT(3),=AL1(0,1,X'40') PRINT BLANK LINE...      @N30 V2372800
         BNE   PTSTRCB             ALLOW PRINT IF NOT              @N30 V2373000
         OI    TANKSRCB,X'20'      FORCE IMMEDIATE COMMAND         @N30 V2373200
         CLI   TANKSRCB,X'B1'      COMMAND EJECT...                @N30 V2373400
         BE    PSKIO               SUPPRESS EJECT IF SO            @N30 V2373600
PTSTRCB  CLC   TANKRCB,PCTRCB      IS THIS A PRINTERS RCB...       @N30 V2374000
         BNE   PTCON               NO, DO CONSOLE PROCESSING       @N30 V2375000
         MVI   PEOFSW,X'00'        SET OFF END OF FILE SWITCH      @N30 V2376000
         NI    PCTSTAT,255-TCTPRTSW RESET PRINTER AVAILABLE        @N30 V2377000
         TM    PCTSTAT,TCTREL      LAST PRINT FOR CONSOLES...      @N30 V2378000
         BZ    PSETCC              NO, NO NEED TO EJECT            @N30 V2379000
         NI    PCTSTAT,255-TCTREL  RESET CONSOLE ACTIVE            @N30 V2379500
         NI    TANKSRCB,X'7F'      FORCE EJECT BEFORE PRINTING     @N30 V2380000
         B     PSETCC              GO AND PRINT                    @N30 V2380200
PTCON    TM    PCTSTAT,TCTREL      WAS PRINT FOR CONSOLES...       @N30 V2380400
         BO    PSETCC              YES - GO AHEAD AND PRINT        @N30 V2380600
         OI    PCTSTAT,TCTREL     INDICATE CONSOLE PROCESSING      @N30 V2380800
PSETCC   DS    0H                                                       V2381000
         AGO   .PSK5A                                                   V2382000
.PSK5    ANOP                                                           V2383000
         BE    PFREE               FREE THE TANK IF END OF JOB          V2384000
.PSK5A   ANOP                                                           V2385000
         CLI   TANKSRCB,X'8E'      LOOK FOR CHANGE IN FORMS             V2386000
         AIF   (&CONSOLE EQ 0).PSK5B                                    V2387000
         BE    PFREE               IGNORE THIS LINE IF FORMS MSG        V2388000
         AGO   .PSK5C                                                   V2389000
.PSK5B   BNE   *+8                 SKIP SRCB MODIFICATION IF NO         V2390000
         MVI   TANKSRCB,X'91'      INSERT PRINT AND EJECT SRCB          V2391000
.PSK5C   ANOP                                                           V2392000
         MVC   PCTCCWCT+1(1),TANKCNT+1 SET THE LINE IN CCW              V2393000
*                                                                       V2394000
*        SET UP CARRIAGE CONTROL                                        V2395000
*                                                                       V2396000
         AIF   (&MACHINE EQ 20).PSK2                                    V2397000
         LA    R9,TANKDATA         LOCATE THE DATA                      V2398000
         ST    R9,PCTCCW           SAVE IT IN THE CCW                   V2399000
         IC    R9,TANKSRCB         PICK UP CARRIAGE CONTROL INFO        V2400000
         SLL   R9,3                ALIGN CC BITS FOR OPCODE             V2401000
         STC   R9,PCTOPCOD         SET CARRIAGE CONTROL IN OPCODE       V2402000
         TM    TANKSRCB,PSKIMM     TEST FOR SKIP IMMEDIATE              V2403000
         BZ    PNOTIMM             NO IF ON SO PRINT WITH DELAYED SKIP  V2404000
         OI    PCTOPCOD,PCCOP      SET CCW OP-CODE FOR CC EXECUTE       V2405000
         $WRITE P                  PERFORM THE CARRIAGE CONTROL         V2406000
         $CHECK P                  CHECK FOR OK                         V2407000
         L     R8,PCTCCW           PICK UP AREA                         V2408000
PRINT    IC    R9,=AL1(POPCODEI)   SET PRINT SPACE 1 AFTER PRINT        V2409000
PNOTIMM  STC   R9,PCTOPCOD         STORE CC BITS IN OP-CODE SAVE        V2410000
         OI    PCTOPCOD,POPCODE    SET TO PRINT A LINE                  V2411000
         CLI   PCTOPCOD,X'61'      Q. IF FCB LOAD REQUEST               V2412000
         BNE   PLINE               BR. IF NO                            V2413000
         OI    PCTOPCOD,X'02'      CONVERT COMMAND TO X'63'             V2414000
         AIF   (&R(9) EQ 0 AND &R(10) EQ 0).PSK3  NO 3203 OR 5203       V2415000
         AIF   (&NUMPRT EQ 1).PSK3A  ONLY ONE PRINTER ON SYSTEM         V2416000
         TM    PCTINDEX,INDEXOK    Q. IF INDEX BYTE ALLOWED             V2417000
         BO    PLINE               BR. IF YES                           V2418000
.PSK3A   ANOP                                                           V2419000
         LM    R8,R9,PCTCCW        PICK UP CCW                          V2420000
         LA    R8,1(0,R8)          INCREMENT OVER INDEX BYTE            V2421000
         BCTR  R9,0                REDUCE BYTE COUNT BY ONE             V2422000
         STM   R8,R9,PCTCCW        REPLACE CCW                          V2423000
         AGO   .PSK3                                                    V2424000
.PSK2    ANOP                                                           V2425000
         MVC   PCIO+3(1),TANKSRCB  PICK UP CARRIAGE CONTROL INFO        V2426000
         MVI   PCIO+1,X'44'        RESET CONTROL OPCODE                 V2427000
         TM    PCIO+3,PSKIMM       CK FOR SKIP IMMEDIATE                V2428000
         BO    PSKIM               IF YES GO AROUND DELAY SETTING       V2429000
         OI    PCIO+1,X'02'        SET SKIP AFTER PRINT 44=46           V2430000
PSKIM    TM    PCIO+3,X'10'        CK FOR SKIP NOT SPACE                V2431000
         BZ    PSKLNS              IF OFF SPACE                         V2432000
         OI    PCIO+1,X'01'        SET SKIP 44=45, 46=47                V2433000
PSKLNS   DS    0H                                                  @N30 V2434000
         TM    PCIO+3,X'80'        IS SPECIAL EJECT REQD...        @N30 V2435100
         BO    PNOEJECT            SKIP NEXT IF NOT                @N30 V2435200
         $DELAY P,TYPE=SETUP       PREPARE FOR WAITING             @N30 V2435300
         CIO   1,X'45'             EJECT IMMEDIATE                 @N30 V2435400
         BC    7,$PCOMM1+4         WAIT FOR START                  @N30 V2435500
         $CHECK P                  WAIT FOR FINISH                 @N30 V2435600
PNOEJECT DS    0H                                                  @N30 V2435700
         OI    PCTCCW+1,X'01'      SPACE SUPPRESS BIT ON                V2436000
         TM    PCIO+3,X'3F'        DO WE SPACE SUPPRESS                 V2437000
         BZ    PLINE               IF SO SKIP OVER CARRIAGE CONTROL     V2438000
         NI    PCTCCW+1,255-X'01'  TURN SPACE SUPPRESS OFF              V2439000
         $DELAY P,TYPE=SETUP       PREPARE FOR WAITING                  V2440000
PCIO     CIO   *-*,*-*             PERFORM CARRIAGE CONTROL OPERATION   V2441000
         BC    7,$PCOMM1+4         WAIT AND TRY LATER IF NO START       V2442000
         $CHECK P                  WAIT FOR FINISH                      V2443000
         TM    PCIO+1,X'02'        IMMEDIATE CARRIAGE CMD...       @N30 V2443300
         BZ    PSKIO               YES, SKIP PRINT                 @N30 V2443600
.PSK3    ANOP                                                           V2444000
PLINE    $WRITE P,S=PCTCCW         PRINT THE LINE                       V2445000
         $CHECK P                  CHECK FOR FINISHED                   V2446000
PSKIO    DS    0H                                                  @N30 V2446500
         $LOAD R8,PCTCCW+4-&L      PICK UP AREA FROM CCW                V2447000
         SH    R8,=Y(TANKDATA-TANKDSEC) GET TO START OF TANK            V2448000
PFREE    $FREE $TANKPOL,R8,ENBL    RELEASE THE TANK ENABLED             V2449000
         B     PNEXT               PRINT NEXT LINE                      V2450000
         AIF   (&NUMPRT EQ 1).PRTN1                                     V2451000
         DROP  TCTR                                                     V2452000
.PRTN1   ANOP                                                           V2453000
         $ENDPROC P                END OF PRINT PROCESSOR               V2454000
*                                                                       V2455000
*        EQUATES FOR PRINT PROCESSOR                                    V2456000
*                                                                       V2457000
PSKIMM   EQU   X'20'               SRCB FLAG TO SKIP IMMEDIATE          V2458000
         AIF   (&MACHINE EQ 20).PSK4                                    V2459000
POPCODEI EQU   X'09'               PRINT OP-CODE SPACE 1 AFTER          V2460000
PFLAGS   EQU   X'20'               NO CHAINING,SUPPRESS WRONG LENGTH CK V2461000
POPCODE  EQU   X'01'               CCW PRINT LINE OPCODE NO SPACE       V2462000
PCCOP    EQU   X'03'               CARRIAGE CONTROL OP-CODE             V2463000
         AGO   .PRTNSKP                                                 V2464000
.PSK4    ANOP                                                           V2465000
PCT      EQU   132                 LINE LENGTH AS ASSEMBLED             V2466000
PCTCCWCT EQU   PCTCCW+4            LOCATION OF COUNT FIELD              V2467000
PCTRTN   EQU   $PCOMM1+4           LOCATION OF NEXT COMMUTATOR ENTRY    V2468000
.PRTNSKP ANOP                                                           V2469000
         AIF   (&NUMRDR EQ 0).RRTNSKP                                   V2470000
 TITLE ' $ R R T N 1  -- INPUT SERVICE PROCESSOR'                       V2471000
&A       SETA  0                                                        V2472000
*                                                                       V2473000
*        INPUT SERVICE PROCESSOR                                        V2474000
*                                                                       V2475000
*        GENERATION LOGIC VARIBLE MEANINGS                              V2476000
*        &R(1) = 0 FOR 1442,2501,2520,2540,2560 READ DEVICES            V2477000
*        &R(2) = 0 FOR 2520 READ/PUNCH DEVICES                          V2478000
*        &R(3) = 0 FOR 1442 READ/PUNCH DEVICES                          V2479000
*        &R(6) = 0 FOR MOD 20                                           V2480000
*        &R(7) = 0 FOR 2560 READ/PUNCH DEVICE                           V2481000
         AIF   (&NUMRDR EQ 1).RRTN1                     1+2+3+6+7       V2482000
         USING RCTDSECT,TCTR       WE HAVE MULTIPLE READ TCTS           V2483000
.RRTN1   AIF   (&R(7)).RRTN2                                            V2484000
         USING TANKDSEC,R8         DATA TANKS FOR 2560 PUNCH ROUTINE    V2485000
.RRTN2   ANOP                                           1+2+3+6+7       V2486000
$RRTN1   NULL                      INITIAL ENTRY AT IPL TIME            V2487000
RDSTART  DS    0H                  ENTRY AFTER EOF, LOOP FOR DUAL PUNCH V2488000
         AIF   (&R(2) AND &R(3) OR NOT &R(6)).RRTN18                    V2489000
         MVI   RCTCCWCT+1,80       MAKE SURE COUNT IS 80                V2490000
.RRTN18  ANOP                                                           V2491000
READ1    $READ R,RCTTDTA1          PERFORM THE INITIAL READ             V2492000
RCK1     $CHECK R,RDERR1,RDEOF1    MAKE SURE IN OK                      V2493000
         AIF   (&R(2) AND &R(3) OR &R(1)).RRTN3           (2+3)*1       V2494000
         TM    RCTSTAT,TCTDUAL     TEST FOR SINGLE FEED DUAL DEVICE     V2495000
         BZ    ROPEN               IF NOT GO AHEAD OPEN THE SERVICE     V2496000
.RRTN3   AIF   (&R(2) AND &R(3)).RRTN4                        2+3       V2497000
         CLC   RCTTDTA1(80),RCTTDTA2 CHECK FOR ALL BLANK CARD           V2498000
         BE    RTESTPUN            LOOK FOR PUNCH DATA IF BLANK         V2499000
.RRTN4   AIF   (&R(2) OR &R(3)).RRTN5                                   V2500000
         TM    RCTSTAT,TCT25200    DO WE HAVE A 2520 READ/PUNCH         V2501000
         BZ    ROPEN               IF NOT NO NEED TO STACKER SELECT     V2502000
.RRTN5   AIF   (&R(2) OR NOT &R(6)).RRTN6                          2*-6 V2503000
         $WRITE R,OP=R252003       SELECT POCKET 1 FOR READ JOB STREAM  V2504000
         MVI   RCTOPCOD,R252002    SET UP FOR READING CARDS             V2505000
.RRTN6   ANOP                                           1+2+3+6+7       V2506000
ROPEN    $LA   R8,RCTTANK1         LOCATE TANK IN PARAMETER REG         V2507000
         AIF   (&HOME EQ 1).RHOME                                       V2508000
         BAS   R14,$TPOPEN         REQUEST HASP TO RECEIVE STREAM       V2509000
         BZ    RREOPEN             IF NOT SENT TO HASP WAIT             V2510000
         AIF   (&LOCCOM EQ 0).RRTN7A                                    V2511000
         NI    RCTID,255-C' '      PREVENT OPERATOR ACTION              V2512000
.RRTN7A  AIF   (&MACHINE EQ 20).RRTN7                                   V2513000
         OI    RCTUCB,TCTNOINT     DISABLE INTERRUPTS ON DEVICE         V2514000
         $DELAY R,TIME=LONG,TYPE=BRANCH WAIT FOR HASP TO RESPOND        V2515000
         NI    RCTUCB,255-TCTNOINT ENABLE INTERRUPTS ON DEVICE          V2516000
         AGO   .RRTN8                                                   V2517000
.RRTN7   ANOP                                            -(1+2+3)       V2518000
         $DELAY R,TIME=LONG,TYPE=BRANCH WAIT FOR HASP TO RESPOND        V2519000
.RRTN8   AIF   (&LOCCOM EQ 0).RRTN8A                                    V2520000
         OI    RCTID,C' '          ALLOW OPERATOR ACTION                V2521000
.RRTN8A  ANOP                                                           V2522000
*              WE MUST GO BACK TO COMMUTATOR FOR GATE TO BE OPENED      V2523000
.RHOME   ANOP                                                           V2524000
RDLOOP   DS    0H                  BASIC READ LOOP                      V2525000
         $READ R,RCTTDTA2          READ A CARD                          V2526000
         MVC   RCTTCT1,=H'80'      SET LENGTH INTO TANK COUNT           V2527000
         $PUT  R,RCTTANK1          SEND PREVIOUS TANK DATA TO HASP      V2528000
         $CHECK R,RDERR,RDEOF      CHECK FOR CARD IN OK                 V2529000
         $READ R,RCTTDTA1          READ A CARD                          V2530000
         MVC   RCTTCT2,=H'80'      SET LENGTH INTO TANK COUNT           V2531000
         $PUT  R,RCTTANK2          SEND PREVIOUS TANK DATA TO HASP      V2532000
RCHECK   DS    0H                  REENTRY AFTER ERRORS                 V2533000
         $CHECK R,RDERR,RDEOF      CHECK FOR CARD IN OK                 V2534000
         B     RDLOOP              IF SO CONTINUE TO READ CARDS         V2535000
RDEOF    MVC   RCTTCT1,=F'0'       SET END OF FILE INDICATOR            V2536000
         $DELAY R,TYPE=SETUP       PREPARE FOR REJECT ON SENDING        V2537000
         $LA   R8,RCTTANK1         PUT TANK ADDR IN PARAMETER REG       V2538000
         BAS   R14,$TPPUT          SEND TO HASP EOF SIGNAL              V2539000
         BZ    RCTRTN              IF NOT PREPARED FOR SEND WAIT RETRY  V2540000
         AIF   (&R(2) AND &R(3)).RRTN9                      2+3         V2541000
         MVI   RCTTDTA2,C' '       INSERT A BLANK IN THE DATA AREA      V2542000
         MVC   RCTTDTA2+1(79),RCTTDTA2  BLANK REST. USED FOR COMPARE    V2543000
.RRTN9   AIF   (&MACHINE EQ 20).RRTN10                     -(6+7)       V2544000
         OI    RCTECB,TCTBUSY      SET READER BUSY FOR WAITING          V2545000
         AIF   (&R(2) OR &R(1) AND &R(3)).RRTN11          2*(1+3)       V2546000
         TM    RCTSTAT,TCT25200    TEST FOR DUAL 2520                   V2547000
         BZ    RDSTART             IF NO GO TO START OF ROUTINE         V2548000
.RRTN11  AIF   (&R(2)).RRTN10                                -6*2       V2549000
         MVI   RCTOPCOD,R25200     RESET THE INITIAL READ OPCODE        V2550000
.RRTN10  AIF   (&R(7)).RRTN14                                   7       V2551000
         B     RDEOF1              ATTEMPT TO PUNCH                     V2552000
         AGO   .RRTN15                                                  V2553000
.RRTN14  ANOP                                                  -7       V2554000
         B     RDSTART             GO BACK TO START OF PROCESSOR        V2555000
.RRTN15  ANOP                                           1+2+3+6+7       V2556000
RDERR    $INTREQ R,RDR             PREPARE TO WAIT ON OPERATOR          V2557000
         $READ  R,RCTTDTA1         READ AGAIN                           V2558000
         B     RCHECK              SEE IF IN PROPERLY                   V2559000
RREOPEN  $DELAY R,TIME=SHORT,TYPE=BRANCH,PREVLOC=ROPEN WAIT, TRY AGAIN  V2560000
RDERR1   $INTREQ R,RDR,PREVLOC=READ1 PREPARE TO WAIT ON OPERATOR, READ  V2561000
         AIF   (&R(7)).RRTN12                                   7       V2562000
RDEOF1   $GETTNK R,R8,R9,EMPTY=RTEST NO CARDS TO READ TRY PUNCHING      V2563000
         CLI   TANKCNT+1,0         TEST FOR END OF JOB                  V2564000
         BE    RDFREE              FREE THE TANK IF END OF JOB          V2565000
RDPUNCH  $WRITE R,TANKDATA,TANKDSEC,OP=UOPCODE,CTADDR=TANKCNT,S=RDPCH   V2566000
         $CHECK R,RDPUNCHA         CHECK IF OK, PUNCH AGAIN IF NOT      V2567000
         DC    X'9A',AL1(RFEED),S(RDPUNCHA)  TEST FEED ERROR            V2568000
         LH    R8,RDPCH+2          PICK UP I/O AREA                     V2569000
         SH    R8,=Y(TANKDATA-TANKDSEC) GET TO START OF TANK            V2570000
RDFREE   $FREE $TANKPOL,R8,ENBL    FREE THE TANK                        V2571000
         LH    R8,RDCTR            LOAD READ TIMER COUNT                V2572000
         AH    R8,=H'-1'           SUBTRACT 1                           V2573000
         STH   R8,RDCTR            SAVE RESULTS                         V2574000
         BNE   RDEOF1              IF NOT ZERO CONTINUE PUNCHING        V2575000
         MVC   RDCTR,RDCT          REPLENISH MAX COUNT                  V2576000
RTEST    MVC   RDCTRR,RDCTAR       SET UP FOR MULTIPLE READ TESTS       V2577000
RTESTB   $DELAY R                  WAIT ONE TIME AROUND                 V2578000
         XIO  RCTTDTA1(ROPCODE+1),RCT TRY READING                       V2579000
         BC    7,RDTESTA           IF NO START DEC COUNT                V2580000
         CIO   RPOC,RSTACK         STACK THE CARD                       V2581000
         $CHECK R,RDERR1,RDTESTA   CHECK FOR COMPLETION                 V2582000
         B     ROPEN               IF IN OK OPEN UP INPUT SERVICE       V2583000
RDTESTA  LH    R8,RDCTRR           LOAD READ TEST COUNT                 V2584000
         AH    R8,=H'-1'           REDUCE                               V2585000
         STH   R8,RDCTRR           SAVE RESULTS                         V2586000
         BNE   RTESTB              WAIT SOME MORE                       V2587000
         B     RDEOF1              TRY PUNCHING                         V2588000
RDPUNCHA CIO   UBADPOC,UNSTACK     SELECT BAD POCKET                    V2589000
         B     RDPUNCH                                                  V2590000
RDCT     DC    H'100'              CONSTANTS FOR DELAY OF READ TEST     V2591000
RDCTR    DC    H'100'              WHILE PUNCHING                       V2592000
RDCTAR   DC    H'190'              DELAY TO RECOGNIZE                   V2593000
RDCTRR   DC    H'190'              INPUT STREAM                         V2594000
         AGO   .RRTN13                                                  V2595000
.RRTN12  AIF   (NOT &R(6)).RRTN12A                                      V2596000
RDEOF1   EQU   RDERR1              HANDLE EOF AS ERROR                  V2597000
         AGO   .RRTN13                                                  V2598000
.RRTN12A ANOP                                                           V2599000
RDEOF1   EQU   RDSTART             IGNORE EOF                           V2600000
.RRTN13  AIF   (&R(2) AND &R(3)).RRTN16                             2+3 V2601000
*                                                                       V2602000
*        ROUTINE TO PREPARE TO PUNCH CARDS ON A DUAL READ/PUNCH DEVICE  V2603000
*                                                                       V2604000
RTESTPUN NULL                                                           V2605000
         AIF   (&MACHINE EQ 20).RRTN19                                  V2606000
         MVI   RCTECB,0            REMOVE DEVICE END INDICATION         V2607000
RTEST    TM    RCTECB,DEVEND       TEST FOR DEVICE END                  V2608000
         BO    RDSTART             OPERATOR INSERTED NEW CARDS IF YES   V2609000
         AGO   .RRTN20                                                  V2610000
.RRTN19  AIF   (&CONSOLE EQ 0).RRTN21                                   V2611000
         OI    RCTSTAT,TCTSTOP     SET STOP STATUS                      V2612000
RTEST    TM    RCTSTAT,TCTSTOP     TEST FOR OPERATOR RESPONSE           V2613000
         BZ    RDSTART             OPERATOR RESPONDED                   V2614000
.RRTN20  ANOP                                                           V2615000
         CLI   RCTTNKCT,0          TEST FOR A PUNCH TANK AVAILABLE      V2616000
         BNE   $URTN1              IF SO PREPARE TO PUNCH               V2617000
         $DELAY R,TYPE=BRANCH,TIME=LONG,PREVLOC=RTEST WAIT, LOOP BACK   V2618000
         AGO   .RRTN16                                                  V2619000
.RRTN21  ANOP                                                           V2620000
         $DELAY R,TIME=SHORT,TYPE=SETUP PREPARE FOR WAIT                V2621000
         BAS   R14,$DIAL           REQUEST DIAL READING                 V2622000
         DC    Y(RADR*2+$DIALTAB)                                       V2623000
         B     RTEST               IF NO RESPONSE TEST FOR TANK         V2624000
         B     RDSTART             OPERATOR RESPONDED                   V2625000
RTEST    MVC   RADR*2+$DIALTAB(2),=Y(YODNULL) REPLACE TABLE ELEMENT     V2626000
         CLI   RCTTNKCT,0          TEST FOR TANK                        V2627000
         BNE   $URTN1              PUNCH CARD IF TANK                   V2628000
         B     $RCOMM1+4           WAIT IF NO TANK                      V2629000
.RRTN16  ANOP                                                           V2630000
         AIF   (&NUMRDR EQ 1).RRTN17                                    V2631000
         DROP  TCTR                                                     V2632000
.RRTN17  ANOP                                                           V2633000
         $ENDPROC R                END OF READ PROCESSOR                V2634000
         AIF   (&MACHINE NE 20).RRTNSKP                                 V2635000
*                                                                       V2636000
*        INPUT PROCESSOR EQUATES                                        V2637000
*                                                                       V2638000
RCT      EQU   80                  LENGTH OF CARD                       V2639000
RCTRTN   EQU   $RCOMM1+4           LOCATION OF NEXT COMMUTATOR ENTRY    V2640000
.RRTNSKP ANOP                                                           V2641000
         AIF   (&NUMPUN EQ 0).URTNSKP                                   V2642000
 TITLE '$ U R T N 1  --  PUNCH SERVICE PROCESSOR'                       V2643000
&A       SETA  0                                                        V2644000
*                                                                       V2645000
*        PUNCH SERVICE PROCESSOR                                        V2646000
*                                                                       V2647000
*        GENERATION LOGIC VARIABLE MEANINGS                             V2648000
*        &R(2) = 0 FOR 2520 READ/PUNCH DEVICES                          V2649000
*        &R(3) = 0 FOR 1442 READ/PUNCH DEVICES                          V2650000
*        &R(4) = 0 FOR 2540 PUNCH DEVICES                               V2651000
*        &R(5) = 0 FOR 2520,2560 PUNCH DEVICES                          V2652000
*        &R(6) = 0 FOR MOD 20                                           V2653000
*        &R(7) = 0 FOR 2560 READ/PUNCH DEVICE                           V2654000
*        &R(8) = 0 FOR 1442 SINGLE POCKET PUNCH DEVICES                 V2655000
         USING TANKDSEC,R8                                              V2656000
         AIF   (&NUMPUN EQ 1).URTN1                                     V2657000
         USING UCTDSECT,TCTR                                            V2658000
.URTN1   ANOP                                               2+3+4+5+6+8 V2659000
$URTN1   NULL                      INITIAL ENTRY AT IPL TIME,DUAL PUNCH V2660000
USTART   DS    0H                  LOOP ENTRY TO CONTINUE PUNCHING      V2661000
         $GETTNK U,R8,R9,EMPTY=WAIT GET OUTPUT TANK WITH PUNCH RECORD   V2662000
         CLI   TANKCNT+1,0         TEST FOR END OF JOB                  V2663000
         BE    UFREE               IF SO FREE TANK                      V2664000
UOUTPUT  DS    0H                  PUNCH THE CARD                       V2665000
UPUNCH   $WRITE U,TANKDATA,TANKDSEC,OP=(UCTALTOP,D),CTADDR=TANKCNT,    CV2666000
               S=UCTCCW            PUNCH THE CARD                       V2667000
         AIF   (&R(4) OR &R(2) AND &R(3) AND &R(5) AND &R(8)).URTN2     V2668000
         TM    UCTSTAT,TCT2540     TEST FOR 2540 PUNCH                  V2669000
         BZ    UCHECK              IF NOT GO CHECK I/O OK               V2670000
.URTN2   AIF   (&R(4)).URTN3                                          4 V2671000
         TM    UCTHOLD+&L-1,1      TEST FOR ODD ADDRESS IN HOLD (EMPTY) V2672000
         BO    USAVHOLD            IF SO HOLD THE CURRENT TANK          V2673000
         $CHECK U,UBAD             CHECK FOR I/O COMPLETE               V2674000
         $LOAD R8,UCTHOLD          PICK UP OLD TANK                     V2675000
         $FREE $TANKPOL,R8,ENBL    RELEASE THE TANK                     V2676000
USAVHOLD $LOAD R8,UCTCCW+4-&L      PICK UP TANK ADDRESS                 V2677000
         SH    R8,=Y(TANKDATA-TANKDSEC) GET TO START OF TANK            V2678000
         $STO  R8,UCTHOLD          SAVE FOR NEXT TIME                   V2679000
         B     USTART              LOOK TO PUNCH NEXT CARD              V2680000
UBAD     $LOAD R8,UCTHOLD          PICK UP THE HELD TANK (OLD)          V2681000
         $LOAD R9,UCTCCW+4-&L      PICK UP THE CURRENT TANK (NEW)       V2682000
         SH    R9,=Y(TANKDATA-TANKDSEC) GET TO START OF NEW TANK        V2683000
         $STO  R9,UCTHOLD          HOLD THE NEW TANK                    V2684000
UBADP    $WRITE U,TANKDATA,CTADDR=TANKCNT PUNCH THE OLD TANK            V2685000
         $CHECK U,UBADP            CHECK FOR OK                         V2686000
         $LOAD R8,UCTHOLD          PICK UP THE NEW TANK                 V2687000
         $LOAD R9,UCTCCW+4-&L      PICK UP THE OLD TANK                 V2688000
         SH    R9,=Y(TANKDATA-TANKDSEC) GET TO START OF OLD TANK        V2689000
         $STO  R9,UCTHOLD          HOLD THE OLD TANK                    V2690000
         B     UOUTPUT             REPUNCH THE CARD                     V2691000
.URTN3   AIF   (&R(2) AND &R(3) AND &R(5) AND &R(8)).URTN4              V2692000
UCHECK   $CHECK U,UERR             CHECK FOR IN OK                      V2693000
         AIF   (&R(2) AND &R(5) AND &R(7) OR &MACHINE NE 20).URTN3A     V2694000
         DC    X'9A',AL1(UFEED),S(UERR) TEST FEED ERROR                 V2695000
.URTN3A  ANOP                                                           V2696000
         $LOAD R8,UCTCCW+4-&L      PICK UP DATA ADDRESS                 V2697000
         SH    R8,=Y(TANKDATA-TANKDSEC) GET TO START OF TANK            V2698000
.URTN4   ANOP                                                           V2699000
UFREE    $FREE $TANKPOL,R8,ENBL    RELEASE THE TANK                     V2700000
         AIF   (&R(2) AND &R(3) OR &R(5) AND &R(8) AND &R(4)).URTN5     V2701000
         TM    UCTSTAT,TCT25200+TCT14420 TEST FOR A DUAL DEVICE         V2702000
         BNZ   $RRTN1              READ NEXT CARD, CHECK FOR BLANK      V2703000
         AGO   .URTN6                                                   V2704000
.URTN5   AIF   (&R(2) AND &R(3)).URTN6                              2+3 V2705000
         B     $RRTN1              READ NEXT CARD, CHECK FOR BLANK      V2706000
.URTN6   AIF   (&R(4) OR &R(2) AND &R(3) AND &R(5) AND &R(8)).URTN7     V2707000
         TM    UCTSTAT,TCT2540     TEST FOR 2540 PUNCH                  V2708000
         BZ    USTART              IF NOT GET NEXT TANK                 V2709000
.URTN7   AIF   (&R(4)).URTN8                                          4 V2710000
         $LOAD R8,UCTHOLD          PICK UP OLD TANK                     V2711000
         OI    UCTHOLD+&L-1,1      MAKE IT EMPTY                        V2712000
         $FREE $TANKPOL,R8,ENBL    FREE 2540 TANK                       V2713000
.URTN8   AIF   (NOT(&R(2) AND &R(3)) AND &R(4) AND &R(5) AND &R(8)).UR9 V2714000
         B     USTART              GO BACK TO START OF PROCESSOR        V2715000
.UR9     AIF   (NOT(&R(8) AND &R(2) AND &R(3)) OR &R(5)).URTN10         V2716000
         AIF   (&UDEV(1) NE 2560).URTN10A                               V2717000
UERR     CIO   UBADPOC,UNSTACK     SELECT BAD POCKET                    V2718000
         B     UPUNCH              RETRY PUNCH                          V2719000
         AGO   .URTN10                                                  V2720000
.URTN10A ANOP                                                           V2721000
UERR     EQU   UPUNCH              ON ERROR REPUNCH THE CARD            V2722000
.URTN10  AIF   (&R(2) AND &R(3) AND &R(8)).URTN11                 2+3+8 V2723000
UERR     DS    0H                  PUNCH I/O ERROR ENTRY                V2724000
.URTN11  AIF   (&R(2) AND &R(3) OR &R(5) OR &R(8)).URTN12     (2+3)*5*8 V2725000
         TM    UCTSTAT,TCT25200+TCT14420+TCT1442 TEST FOR SPECIAL       V2726000
         BZ    UPUNCH              IF NOT REPUNCH THE CARD              V2727000
.URTN12  AIF   (&R(2) AND &R(3) AND &R(5) OR &R(8)).URTN13    (2+3+5)*8 V2728000
         TM    UCTSTAT,TCT1442     TEST FOR SINGLE POCKET 1442          V2729000
         BZ    UEDUAL              IF NOT SKIP 1442 ERROR ROUTINE       V2730000
         AIF   (NOT(&R(2) AND &R(3))).URTN13                            V2731000
UEDUAL   EQU   UPUNCH              REPUNCH THE CARD                     V2732000
.URTN13  AIF   (&R(8)).URTN17                                           V2733000
         $INTREQ U,PUN,PREVLOC=UPUNCH                                   V2734000
.URTN17  AIF   (&R(2) AND &R(3) OR &R(5) OR NOT &R(8)).URTN14           V2735000
         TM    UCTSTAT,TCT25200+TCT14420 TEST FOR DUAL READ/PUNCH       V2736000
         BZ    UPUNCH              REPUNCH THE CARD IF NO               V2737000
.URTN14  AIF   (&R(2) AND &R(3)).URTN15                             2+3 V2738000
UEDUAL   DS    0H                  ERROR ON DUAL READ/PUNCH UNIT        V2739000
         AIF   (&MACHINE EQ 20).URTN14A                                 V2740000
         MVC   UCTHOLD,UCTCCW+4-&L SAVE BAD CARD POINTER                V2741000
         MVI   UCTCCWCT+1,80       SET DATA LENGTH TO 80                V2742000
UEDUALA  DS    0H                                                       V2743000
         $READ U,UCTTDTA1          READ A CARD FROM DUAL UNIT           V2744000
         $CHECK U,URERR,URERR      CHECK TO MAKE SURE IN OK             V2745000
         $LOAD R8,UCTHOLD          PICK UP DATA ADDRESS                 V2746000
         SH    R8,=Y(TANKDATA-TANKDSEC) POINT TO TANK                   V2747000
         CLC   UCTTDTA1(80),UCTTDTA2 CHECK FOR ALL BLANK CARD           V2748000
         BE    UOUTPUT             IF SO GO PUNCH AGAIN                 V2749000
         AGO   .URTN14B                                                 V2750000
.URTN14A ANOP                                                           V2751000
UEDUALA  DS    0H                                                       V2752000
         $READ U,UCTTDTA1,OP=ROPCODE READ A CARD FROM DUAL UNIT         V2753000
         $CHECK U,URERR,URERR,T=R  CHECK FOR IN OK                      V2754000
         CLC   UCTTDTA1(80),UCTTDTA2 CHECK FOR ALL BLANK CARD           V2755000
         BE    UPUNCH              IF SO PUNCH AGAIN                    V2756000
.URTN14B ANOP                                                           V2757000
URERR    $INTREQ U,PUN,PREVLOC=UEDUALA WAIT FOR OPERATOR                V2758000
.URTN15  AIF   (&NUMPUN EQ 1).URTN16                                    V2759000
         DROP  TCTR                DROP BASE FOR NEXT PROCESSOR         V2760000
.URTN16  ANOP                                                           V2761000
         $ENDPROC U                END OF PUNCH PROCESSOR               V2762000
         AIF   (&MACHINE NE 20).URTNSKP                                 V2763000
*                                                                       V2764000
*        PUNCH PROCESSOR EQUATES                                        V2765000
*                                                                       V2766000
UCT      EQU   80                  LENGTH OF CARD                       V2767000
UCTRTN   EQU   $UCOMM1+4           LOCATION OF NEXT COMMUTATOR ENTRY    V2768000
.URTNSKP ANOP                                                           V2769000
         AIF   (&CONSOLE EQ 0 AND &PRTCONS EQ 0).WRTNSKP                V2770000
 TITLE '$ W R T N 1  -- CONSOLE PROCESSOR'                              V2771000
&A       SETA  0                                                        V2772000
*                                                                       V2773000
*        BASE REGISTER ASSIGNMENT                                       V2774000
*                                                                       V2775000
         USING TANKDSEC,R8                                              V2776000
         AIF   (&CONSOLE LT 2).WSK1                                     V2777000
         USING WCTDSECT,TCTR                                            V2778000
.WSK1    ANOP                                                           V2779000
         AIF   (&PRTCONS EQ 0).WSK12                                    V2780000
         AIF   (&CONSOLE NE 0).WSK15                                    V2781000
$WRTN1   NULL                                                           V2782000
.WSK15   ANOP                                                           V2783000
*                                                                       V2784000
*        ROUTINE TO PREPARE MESSAGES FOR PRINTING ON 1403-1443-2203     V2785000
*                                                                       V2786000
WPLOOP   DS    0H                  ENTRY POINT TO PASS MSG TO PRINTER   V2787000
         AIF   (&NUMPRT LT 2).WSK14                                     V2788000
         $LA   R10,$PCOM1+2        PICK UP PRINTER 1 TCT                V2789000
         USING PCTDSECT,R10                                             V2790000
.WSK14   ANOP                                                           V2791000
         CLI   WCTTNKCT,0          TEST FOR MESSAGES                    V2792000
         BE    WPTLOG              IF NONE TEST FOR ERROR LOG           V2793000
WPLOG    TM    PCTSTAT,TCTPRTSW    TEST FOR PRINTER AVAILIABLE          V2794000
         BZ    WPCONS              LOOK FOR PRINTING MESSAGES           V2795000
WPSCANA  $LA   R9,PCTTANK          PICK UP PRINTER TANK Q ADDR          V2796000
WPSCAN   $LOAD R8,0(0,R9)          PICK UP NEXT OR ZERO                 V2797000
         CH    R8,=H'0'            TEST FOR END OF Q                    V2798000
         BE    WPINSERT            INSERT CONSOLE TANKS BEHIND          V2799000
         CLI   TANKRCB,&WRCB(1)    IS THIS A MESSAGE RCB                V2800000
         BNE   WPINSERT            IF NOT INSERT CONSOLE TANKS HERE     V2801000
         $LTR  R9,R8               PULL SCAN POINTER UP ONE             V2802000
         B     WPSCAN              SCAN SOME MORE                       V2803000
WPINSERT MVC   0(&L,R9),WCTTANK    INSERT CONSOLE TANK                  V2804000
         $LOAD R9,0(0,R9)          MOVE TO INSERTED TANK                V2805000
         MVI   TANKSRCB-TANKDSEC(R9),X'81' INSERT SPACE 1 AFTER         V2806000
WPFORCE  MVC   WCTTANK,0(R9)       MAKE NEXT HEAD OF CONSOLE CHAIN      V2807000
         $STO  R8,0(0,R9)          PUT PRINTER CHAIN ON BEHIND          V2808000
         LH    R14,PCTTNKLM        PICK UP PRINTER TANK COUNT           V2809000
         AH    R14,=H'1'           ADD 1                                V2810000
         STH   R14,PCTTNKLM        SAVE IT                              V2811000
         LH    R14,WCTTNKLM        PICK UP CONSOLE COUNT                V2812000
         AH    R14,=H'-1'          SUB 1                                V2813000
         STH   R14,WCTTNKLM        SAVE IT                              V2814000
         CLI   WCTTNKCT,0          TEST FOR MORE                        V2815000
         BNE   WPINSERT            INSERT SOME MORE                     V2816000
         OI    $PCOMM1+1,X'F0'     LET PRINTER PRINT                    V2817000
         OI    WCTSTAT,TCTACT      TURN ON ACTIVITY INDICATOR           V2818000
         B     $WCOMM1+4           WAIT ONE TIME AROUND                 V2820000
         AIF   (&PRTCONS NE 2).WSK12A                                   V2821000
WPCONS   $GETTNK W,R8,R9,EMPTY=WPCLOS GET THE TANK                      V2822000
         $FREE $TANKPOL,R8,ENBL    FREE THE TANK                        V2823000
         B     WPCONS              LOOP BACK FOR MORE                   V2824000
         AGO   .WSK12B                                                  V2825000
.WSK12A  ANOP                                                           V2826000
WPCONS   CLI   WCTTNKCT,&WTLM(1)   DO WE HAVE OUR LIMIT                 V2827000
         BL    WPCLOS              IF NOT WE ARE OK                     V2828000
         $LOAD R9,WCTTANK          PICK UP FIRST TANK                   V2829000
         NI    TANKSRCB-TANKDSEC(R9),X'7F' FRC EJECT BEFORE PRT    @N30 V2830000
         $LOAD R8,PCTTANK          PICK UP PRINTER TANK Q               V2831000
         $STO  R9,PCTTANK          CHAIN FIRST TANK ONTO PRINTER        V2832000
         OI    PCTSTAT,TCTPRTSW    SET PRINTER AVAILABLE                V2833000
         B     WPFORCE             FORCE MESSAGES OUT                   V2834000
.WSK12B  ANOP                                                           V2835000
WPCLOS   $CLOSE W                  WAIT AWHILE                          V2836000
WPTLOG   CLC   $LOGOUT,$LOGLAST    ANY ERROR MESSAGES                   V2837000
         BE    WPCLOS              IF NOT CLOSE GATE AND LOOP           V2838000
         $DCHAIN $TANKPOL,R8,ENBL,EMPTY=$WCOMM1+4 GET A TANK            V2839000
         $FREE WCTTANK,R8,ENBL     PUT TANK INTO CONSOLE Q              V2840000
         MVI   WCTTNKCT,1          SET A VALUE OF 1 IN COUNT            V2841000
         AIF   (&CONSOLE EQ 0).WSK2                                     V2842000
         B     WLOGB               PREPARE LOG INFO                     V2843000
.WSK12   ANOP                                                           V2844000
$WRTN1   NULL                                                           V2845000
WINIT    DS    0H                  CONSOLE LOOP ENTRY POINT             V2846000
WTESTREL TM    WCTSTAT,TCTREL      DO WE HAVE POSSIBLE INTERLOCK        V2847000
         BO    WPUT                IF SO ATTEMPT TO RELEASE IT          V2848000
         NI    $WCOMM1+1,X'0F'     CLOSE THE COMMUTATOR GATE            V2849000
         TM    WCTSTAT,TCTREQ      DO WE HAVE OPERATOR REQUEST          V2850000
         BO    WREADOP             IF SO READ FROM CONSOLE              V2851000
WTANKTST CLI   WCTTNKCT,0          TEST FOR TANK                        V2852000
         BNE   WGETTANK            IF WE HAVE ONE GET IT                V2853000
         $DELAY W,TYPE=SETUP,PREVLOC=WINIT SET UP FOR WAIT              V2854000
         CLC   $LOGOUT,$LOGLAST    TEST FOR ERRORS TO LOG               V2855000
         BE    WCTRTN              WAIT ONE TIME AROUND COMMUTATOR      V2856000
         AIF   (&MACHINE NE 20).WSK2                                    V2857000
         $OPEN W,R9                OPEN THE GATE WE HAVE WORK           V2858000
.WSK2    ANOP                                                           V2859000
WLOGB    $SSM  0                   DISABLE INTERRUPTS                   V2860000
         $LOAD R9,$LOGOUT          PICK UP LOG INFO POINTER             V2861000
WLOGGA   $AA   R9,4                INCREMENT TO NEXT ENTRY              V2862000
         $CA   R9,$LOGEND          TEST FOR END OF TABLE                V2863000
         BL    WLOG                IF NOT PREPARE TO TYPE               V2864000
         BH    WLOGG               BR IF $LOG CHASED US OUT OF TABLE    V2865000
         $LA   R9,$LOGTAB          PICK UP START OF TABLE               V2866000
WLOG     $STO  R9,$LOGOUT          SAVE POINTER FOR NEXT TIME           V2867000
         MVC   WBUFFP,0(R9)        MOVE LOG INFO TO WORK AREA           V2868000
         $SSM  FF                  ENABLE INTERRUPTS                    V2869000
         AIF   (&ERRTXTL EQ 0).WSK3                                     V2870000
         $LMHA R9,R8,WPREFIX,=Y(LOGEND-LOGDSECT) FIND ENTRY             V2871000
         $AA   R9,$ERRTAB          ADD TO ENTRY THE TABLE ORIGIN        V2872000
.WSK3    ANOP                                                           V2873000
         UNPK  WBUFF,WBUFFP(5)     SPREAD THE HEX DIGITS                V2874000
         TR    WBUFF(8),WEBCDIC    CONVERT TO EBCDIC                    V2875000
         AIF   (&ERRTXTL EQ 0).WSK4                                     V2876000
         USING LOGDSECT,R9                                              V2877000
         MVC   WTEXT,LOGTEXT       MOVE IN TEXT PORTION OF ERROR MSG    V2878000
         DROP  R9                                                       V2879000
         MVI   WBUFF+8,C' '        BLANK OUT IN FRONT OF TEXT           V2880000
.WSK4    ANOP                                                           V2881000
         AIF   (&PRTCONS EQ 0 OR &CONSOLE EQ 0).WSK13                   V2882000
* CHANGE FOLLOWING TO NOP TO LOG ON PRINTER, CHANGE COMMUTATOR/WTCT     V2883000
*              TO ENTER AT WPLOOP                                       V2884000
         B     WLOGC                                                    V2885000
.WSK13   AIF   (&PRTCONS EQ 0).WSK11                                    V2886000
         $LOAD R8,WCTTANK                                               V2887000
         MVC   TANKDATA(8+&ERRTXTL),WBUFF MOVE MESSAGE TO TANK          V2888000
         MVC   TANKRCB(4),WLOGHD   INSERT RCB,SRCB,AND COUNT            V2889000
         B     WPLOG                                                    V2890000
WLOGHD   DC    AL1(&WRCB(1)),X'80',AL2(8+&ERRTXTL) RCB,SRCB,COUNT       V2891000
.WSK11   AIF   (&CONSOLE EQ 0).WSKLOCA                                  V2892000
WLOGC    DS    0H                                                       V2893000
         AIF   (&MACHINE EQ 20).WSK5                                    V2894000
         MVI   WCTCCWCT+1,8+&ERRTXTL INSERT COUNT IN CCW                V2895000
WLOGERR  $WRITE W,WBUFF            WRITE ERROR MESSAGE                  V2896000
         AGO   .WSK6                                                    V2897000
.WSK5    ANOP                                                           V2898000
WLOGERR  $DELAY W,TYPE=SETUP,TIME=SHORT PREPARE FOR WAITING             V2899000
         XIO   WBUFF(WOPCODE+1),8+&ERRTXTL TYPE THE MESSAGE             V2900000
         BC    7,$WCOMM1+4         WAIT FOR START                       V2901000
.WSK6    ANOP                                                           V2902000
         $CHECK W                  CHECK FOR I/O COMPLETE,IGNORE ERRORS V2903000
         B     WINIT               LOOP TO START OF PROCESSOR           V2904000
WGETTANK $GETTNK W,R8,R9,EMPTY=WAIT GET A TANK                          V2905000
WTYPE    $WRITE W,TANKDATA,TANKDSEC,CTADDR=TANKCNT TYPE MESSAGE         V2906000
         $CHECK W                  CHECK FOR COMPLETE, IGNORE ERRORS    V2907000
         $LOAD R8,WCTCCW+4-&L      PICK I/O AREA FROM COMMAND           V2908000
         SH    R8,=Y(TANKDATA-TANKDSEC) LOCATE START OF TANK            V2909000
         $FREE $TANKPOL,R8,ENBL    FREE TANK                            V2910000
         B     WINIT               GO BACK FOR MORE WORK                V2911000
WREADOP  NI    WCTSTAT,255-TCTREQ  REMOVE THE REQUEST BIT               V2912000
         AIF   (&MACHINE NE 20).WSK7                                    V2913000
         $OPEN W,R9                OPEN OUR GATE WE HAVE WORK           V2914000
.WSK7    ANOP                                                           V2915000
         MVC   WCTTCT1,=Y(&WTOSIZE) SET TANK DATA LENGTH                V2916000
WOVER    MVI   WCTTDTA1,C' '       INSERT BLANK IN AREA                 V2917000
         MVC   WCTTDTA1+1(&WTOSIZE-1),WCTTDTA1 FILL THE AREA            V2918000
         AIF   (&MACHINE EQ 20).WSK8                                    V2919000
         MVI   WCTCCWCT+1,&WTOSIZE INSERT FULL SIZE COUNT IN CCW        V2920000
.WSK8    ANOP                                                           V2921000
         $READ W,WCTTDTA1,OP=WREAD READ FROM CONSOLE                    V2922000
         AIF   (&MACHINE EQ 20).WSK9                                    V2923000
         $CHECK W                  WAIT FOR COMPLETE                    V2924000
         BC    7,WOVER             IF ERROR OR CANCEL KEY DO OVER       V2925000
         AGO   .WSK9A                                                   V2926000
.WSK9    ANOP                                                           V2927000
         $CHECK W,WOVER            IF ERROR OR CANCEL KEY DO OVER       V2928000
.WSK9A   ANOP                                                           V2929000
         AIF   (&LOCCOM EQ 0).WSKLOC                                    V2930000
         CLI   WCTTDTA1,C'.'       TEST FOR LOCAL COMMAND               V2931000
         BE    WLOCALW             IF SO PROCESS                        V2932000
.WSKLOC  ANOP                                                           V2933000
$WOFF    NOP   WTANKTST            CHECK FOR OUTPUT                     V2934000
WPUT     $PUT  W,WCTTANK1          SEND IT TO HASP                      V2935000
         B     WTANKTST            CHECK FOR OUTPUT                     V2936000
         AIF   (&LOCCOM EQ 0).WSKLOCA                                   V2937000
WLOCALW  MVC   $COMMAND,WCTTDTA1+1 MOVE COMMAND TO WORK AREA            V2938000
         BAS   R14,$WLOCAL         PROCESS LOCAL COMMAND                V2939000
         B     WTANKTST            CHECK FOR OUTPUT                     V2940000
.WSKLOCA ANOP                                                           V2941000
WLOGG    $LOAD R9,$LOGLAST         PICK UP LAST LOGGED                  V2942000
         B     WLOGGA              JUMP BACK IN AHEAD OF $LOG           V2943000
*                                                                       V2944000
*        ERROR MESSAGE WORK AREAS                                       V2945000
*                                                                       V2946000
WPREFIX  DS    0H                                                       V2947000
         DC    X'00'               PADDING FOR ID OFFSET                V2948000
WBUFFP   DC    CL4' '              WORK AREA FOR ERROR MSG              V2949000
         DC    X'0F'               POSITIVE DECIMAL ZERO                V2950000
WBUFF    DC    CL9' '              EBCDIC VERSION OF ERROR              V2951000
WTEXT    DS    CL(&ERRTXTL-1)      LENGTH OF TEXT OF MESSAGE            V2952000
WEBCDIC  EQU   *-X'F0'             SHORT TRANSLATE TABLE                V2953000
         DC    C'0123456789ABCDEF' FOR HEX DIGITS TO EBCDIC             V2954000
         $ENDPROC W                END OF CONSOLE PROCESSOR             V2955000
         AIF   (&MACHINE NE 20 OR &CONSOLE EQ 0).WRTNSKP                V2956000
WCT      EQU   &WTOSIZE            LENGTH OF CONSOLE LINE               V2957000
WCTCCW   EQU   WTYPE+6             LOCATION OF XIO INSTRUCTION          V2958000
WCTRTN   EQU   $WCOMM1+4           LOCATION OF NEXT COMMUTATOR ENTRY    V2959000
.WRTNSKP ANOP                                                           V2960000
         AIF   (&LOCCOM EQ 0).WXX1                                      V2961000
 TITLE 'L O C A L   C O M M A N D   P R O C E S S I N G'                V2962000
*********************************************************************** V2963000
*                                                                     * V2964000
*        COMMANDS ARE OF THE FORM                                     * V2965000
*              .VP1...PN    WHERE  . IS ID IN FIRST POSITION          * V2966000
*                                  V= VERB, SINGLE CHARACTER IN POS 2 * V2967000
*                                  P1...PN ARE PARAMETERS FOR COMMAND * V2968000
*                                       PROCESSORS. (NO BLANKS)       * V2969000
*                                                                     * V2970000
*        DATA AREAS                                                   * V2971000
*   $VERBTAB   VERB TABLE LIST OF SINGLE CHARACTER COMMAND VERBS      * V2972000
*              APPEARING IN COLLATING SEQUENCE, ENDING WITH X'FF'     * V2973000
*   $LOCCOM    LOCAL COMMAND PROCESSOR LIST, ENTRY POINT OF COMMAND   * V2974000
*              PROCESSOR TO INITIALLY HANDLE THE COMMAND.             * V2975000
*   $COMMAND   WORK AREA CONTAINING VERB AND PARAMETERS.              * V2976000
*                                                                     * V2977000
*********************************************************************** V2978000
$VERBTAB DS    0C                  VERB TABLE                           V2979000
         DC    C'S'                START COMMAND                        V2980000
         DC    X'FF'               END OF TABLE                         V2981000
$LOCCOM  DS    0F                  LOCAL COMMAND PROCESSOR POINTERS     V2982000
         $ACON WXS                 START COMMAND                        V2983000
$COMMAND DC    CL4' '              WORK AREA FOR COMMAND PROCESSORS     V2984000
WXXSAV   $ACON 0                   I/O PROCESSOR RETURN POINT           V2985000
         USING TCTDSECT,R15                                             V2986000
$WLOCAL  DS    0H                  ENTRY TO FIND COMMAND'S PROCESSOR    V2987000
         $STO  R14,WXXSAV          SAVE RETURN ADDRESS                  V2988000
         OI    $COMMAND,C' '       SET EXPECTED CHAR UPPER CASE         V2989000
         OI    $COMMAND+1,C' '     SET EXPECTED CHAR UPPER CASE         V2990000
         $LA   R14,$VERBTAB        PICK UP COMMAND VERB TABLE           V2991000
WXXLOOP  CLC   0(1,R14),$COMMAND   LOOK FOR MATCHING VERB               V2992000
         BE    WXXLOC              FOUND MATCH IF EQUAL                 V2993000
         BH    WXXRET              NOT IN TABLE IF HI (IGNORE)          V2994000
         $AA   R14,1               BUMP TO NEXT ENTRY                   V2995000
         B     WXXLOOP             LOOK AGAIN                           V2996000
WXXRET   $LOAD R14,WXXSAV          RETURN TO USER                       V2997000
         BR    R14                 AT NSI                               V2998000
WXXLOC   $SA   R14,$VERBTAB        CREATE OFFSET                        V2999000
         AIF   (&HICORE GT 32).WXX2                                     V3000000
         AR    R14,R14             DOUBLE IT                            V3001000
         AGO   .WXX2A                                                   V3002000
.WXX2    ANOP                                                           V3003000
         SLL   R14,2               CREATE ADCON OFFSET                  V3004000
.WXX2A   ANOP                                                           V3005000
         $AA   R14,$LOCCOM         ADD ORIGIN OF COMMAND TABLE          V3006000
         $LOAD R14,0(0,R14)        PICK UP COMMAND PROCESSOR ENTRY      V3007000
         BR    R14                 GO TO COMMAND PROCESSOR              V3008000
         EJECT                                                          V3009000
*                                                                       V3010000
*        AIDS FOR COMMAND PROCESSORS                                    V3011000
*                                                                       V3012000
*        FIND CORRESPONDING TCT -- ID IN POS 2 OF $COMMAND AREA         V3013000
WXXFIND  DS    0H                                                       V3014000
         $LA   R15,$TCT1           PICK UP TCT CHAIN                    V3015000
WXXFL    CLC   TCTID,$COMMAND+1    CHECK FOR MATCH                      V3016000
         BE    4(0,R14)            RETURN IF FOUND                      V3017000
         $LOAD R15,TCTNEXT         PICK UP NEXT TCT                     V3018000
         $LTR  R15,R15             TEST FOR END OF CHAIN                V3019000
         BNE   WXXFL               LOOP BACK IF NOT END                 V3020000
         BR    R14                 ERROR RETURN                         V3021000
*                                                                       V3022000
*        COMMAND PROCESSORS        COMMANDS THAT DO NOT ISSUE WAITS     V3023000
*                                                                       V3024000
*                                  FIRST LEVEL COMMAND PROCESSORS       V3025000
WXS      DS    0H                  START COMMAND                        V3026000
         BAS   R14,WXXFIND         FIND TCT                             V3027000
         B     WXXRET              RETURN TCT NOT FOUND                 V3028000
         NI    TCTSTAT,255-TCTSTOP START THE TCT                        V3029000
         $LOAD R15,TCTCOM          PICK UP COMMUTATOR ENTRY             V3030000
         OI    1(R15),X'F0'        OPEN THE GATE                        V3031000
         B     WXXRET              RETURN                               V3032000
*                                                                       V3033000
*        SECOND LEVEL COMMAND PROCESSORS REQUIRING COMMUTATOR GATES     V3034000
*                                  MUST HAVE A CORRESPONDING FIRST      V3035000
*                                  LEVEL COMMAND PROCESSOR              V3036000
         DROP  R15                                                      V3037000
.WXX1    ANOP                                                           V3038000
         PRINT GEN                                                      V3039000
 TITLE '$ P U T   --  TPPUT INTERFACE ROUTINE'                          V3040000
*                                                                       V3041000
*        $PUT  ROUTINE             INTERFACE WITH $TPPUT                V3042000
*                                                                       V3043000
&A       SETA  0                                                        V3044000
OXDUM    DSECT                     SYMBOLIC AID FOR PUT ROUTINE         V3045000
         AIF   (&MACHINE EQ 20).OXB                                     V3046000
OXGDRET  DS    H                   RETURN ADDR TO USER                  V3047000
         AGO   .OXAB                                                    V3048000
.OXB     ANOP                                                           V3049000
OXTNK    DS    H                   TANK ADDRESS                         V3050000
OXTCT    DS    H                   TCT ADDRESS                          V3051000
OXBADRET DS    2H                  WAIT RETURN                          V3052000
OXGDRET  DS    2H                  RETURN ADDR TO USER                  V3053000
.OXAB    ANOP                                                           V3054000
HASPRTP  CSECT                                                          V3055000
         USING OXDUM,R14                                                V3056000
         USING TANKDSEC,R8                                              V3057000
         AIF   (&MACHINE EQ 20).OX1                                     V3058000
*        R8 POINTS TO TANK, R14 POINTS TO RETURN, TCTR POINTS TO TCT    V3059000
         USING TCTDSECT,TCTR                                            V3060000
$PUT     NULL                                                           V3061000
         $STO  R14,TCTSAV1         SAVE RETURN ADDRESS                  V3062000
OXSAV    EQU   TCTSAV1             LOCAL SYMBOL FOR SAVE AREA           V3063000
         $STO  R8,TCTCCW+4-&L      SAVE TANK ADDRESS                    V3064000
         AGO   .OXA1                                                    V3065000
.OX1     ANOP                                                           V3066000
*        R14 POINTS TO USER CALLING SEQ WITH TANK AND TCT ADDRESS       V3067000
         USING TCTDSECT,R9                                              V3068000
$PUT     NULL                                                           V3069000
         AH    R14,=H'4'           SKIP OVER INITIAL BAS INST           V3070000
         STH   R14,OXSAV           SAVE RETURN ADDRESS (OFFSET)         V3071000
         LH    R8,OXTNK            PICK UP ADDRESS OF TANK              V3072000
         LH    R9,OXTCT            PICK UP ADDRESS OF TCT               V3073000
.OXA1    AIF   (&CONSOLE EQ 0).OX2                                      V3074000
OXLOOP   TM    WCTSTAT,TCTREL      IS INTERLOCK RELEASE ON              V3075000
         BZ    OXPUT               IF NOT DO NORMAL $TPPUT              V3076000
         $LA   R8,WCTTANK1         PICK UP CONSOLE TANK ADDRESS         V3077000
         BAS   R14,$TPREPUT        ATTEMPT TO SEND TO HASP              V3078000
         $LOAD R14,OXSAV           PICK UP RETURN ADDR                  V3079000
         AIF   (&MACHINE NE 20).OX3                                     V3080000
         LH    R9,OXTCT            PICK UP TCT ADDR                     V3081000
.OX3     ANOP                                                           V3082000
         BNE   OXFINTST            IF TANK OK TEST FOR MORE WORK        V3083000
         TM    TCTSTAT,TCT1052     IF NOT OK TEST FOR USER ID           V3084000
         BO    OXGDRET             IF CONSOLE RETURN                    V3085000
         AIF   (&MACHINE EQ 20).OX4                                     V3086000
         $DELAY O,T,PREVLOC=OXLOOP IF NOT WAIT AND TRY AGAIN            V3087000
         AGO   .OXA4                                                    V3088000
.OX4     ANOP                                                           V3089000
         B     OXNORMA             IF NOT THEN FORGET IT PUT USERS      V3090000
.OXA4    ANOP                                                           V3091000
OXFINTST NI    WCTSTAT,255-TCTREL  RESET INTERLOCK RELEASE              V3092000
         TM    TCTSTAT,TCT1052     CHECK USER ID                        V3093000
         BO    OXGDRET             IF CONSOLE RETURN                    V3094000
         AIF   (&MACHINE EQ 20).OX5                                     V3095000
         $LOAD R8,TCTCCW+4-&L      PICK UP TANK                         V3096000
         AGO   .OXA5                                                    V3097000
.OX5     ANOP                                                           V3098000
OXNORMA  LH    R8,OXTNK            PICK UP TANK                         V3099000
.OXA5    ANOP                                                           V3100000
.OX2     ANOP                                                           V3101000
OXPUT    BAS   R14,$TPPUT          SUBMIT TANK FOR TRANSMISSION         V3102000
         $LOAD R14,OXSAV           RESTORE RETURN POINTER               V3103000
         AIF   (&MACHINE NE 20).OX7                                     V3104000
         LH    R9,OXTCT            PICK UP TCT ADDR                     V3105000
.OX7     ANOP                                                           V3106000
         BNE   OXGDRET             IF TANK WENT OK THEN RETURN          V3107000
         AIF   (&CONSOLE EQ 0).OX8                                      V3108000
         TM    TCTSTAT,TCT1052     IF NOT TEST FOR CONSOLE              V3109000
         BZ    OXWAIT              IF NOT CONSOLE WAIT                  V3110000
         OI    WCTSTAT,TCTREL      SET INTERLOCK RELEASE INDICATOR      V3111000
         B     OXGDRET             RETURN TO USER                       V3112000
OXWAIT   DS    0H                  WAIT TO RESUBMIT TANK                V3113000
.OX8     AIF   (&MACHINE EQ 20).OX9                                     V3114000
         $DELAY O,T                WAIT ONE TIME AROUND COMMUTATOR      V3115000
         $LOAD R8,TCTCCW+4-&L      PICK UP TANK ADDRESS                 V3116000
         BAL   R14,$TPREPUT        RESUBMIT TANK FOR TRANSMISSION       V3117000
         $LOAD R14,OXSAV           PICK UP USER RETURN POINT            V3118000
         BE    TCTRTN              IF IT DIDN'T GO WAIT AGAIN           V3119000
         AGO   .OXA9                                                    V3120000
.OX9     ANOP                                                           V3121000
         B     OXBADRET            WAIT ONE TIME AROUND COMMUTATOR      V3122000
OXSAV    DC    H'0'                SAVE AREA                            V3123000
$PUTA    STH   R14,OXSAV           REENTRY AFTER A WAIT                 V3124000
         LH    R8,OXTNK            PICK UP TANK ADDR                    V3125000
         BAS   R14,$TPREPUT        RESUBMIT TANK FOR TRANSMISSION       V3126000
         LH    R14,OXSAV           PICK UP RETURN POINTER               V3127000
         BE    OXBADRET            IF IT DIDN'T GO WAIT AGAIN           V3128000
.OXA9    ANOP                                                           V3129000
         B     OXGDRET             RETURN                               V3130000
         DROP  R14,R8                                                   V3131000
         AIF   (&MACHINE NE 20).OXC                                     V3132000
         DROP  R9                                                       V3133000
.OXC     ANOP                                                           V3134000
         AIF   (&MACHINE EQ 20).OX50                                    V3135000
 TITLE '$ G E T T N K  --  $ C L O S T C T  -- PROCESSOR ASSISTS'       V3136000
*                                                                       V3137000
*        $GETTNK                   ROUTINE TO GET A TANK FOR PROCESSOR  V3138000
*                                                                       V3139000
$GETTNK  NULL                                                           V3140000
         $STO  R14,TCTSAV1         SAVE USER REG FOR POSSIBLE WAIT      V3141000
         $DELAY O,T,TYPE=SETUP     SET REENTRY FOR POSSIBLE WAIT        V3142000
         $DCHAIN TCTTANK,R8,ENBL,EMPTY=$CLOSTCT GET TANK OUT OF Q       V3143000
         $TCTPOST T,R9             POST COMPLETION                      V3144000
         $LOAD R14,TCTSAV1         PICK UP USER                         V3145000
         BR    R14                 RETURN TO HIM                        V3146000
*                                                                       V3147000
*        $CLOSTCT                  ROUTINE TO CLOSE GATE AND RETURN     V3148000
*                                                                       V3149000
$CLOSTCT NULL                                                           V3150000
         $LOAD R9,TCTCOM           PICK UP COMMUTATOR                   V3151000
         NI    1(R9),X'0F'         CLOSE GATE                           V3152000
         B     4(R9)               RETURN TO COMMUTATOR                 V3153000
.OX50    ANOP                                                           V3154000
         $ENDPROC O                END OF PUT ROUTINE                   V3155000
 TITLE 'HRTP  $ L O G  --  LOG SUBROUTINE'                              V3156000
         USING LOGDSECT,R15                                             V3157000
$LOG     NULL                                                           V3158000
         $STO  R14,LOG14SAV        SAVE R14                             V3159000
         $STO  R15,LOGRTN          STORE RTN REG                        V3160000
         LH    R15,0(0,R15)        PICK UP ERROR ENTRY OFFSET           V3161000
         $AA   R15,$ERRTAB         ADD ERROR TABLE ORIGIN               V3162000
         LH    R14,LOGCOUNT        LOAD ERROR COUNT                     V3163000
         AH    R14,=H'1'           UP COUNT BY ONE                      V3164000
         STH   R14,LOGCOUNT        STORE NEW COUNT                      V3165000
         AIF   (&TRACE EQ 0).LNOTRC                                     V3166000
         $LOAD R14,$TRACUR         PICK UP CURRENT TRACE ADDR           V3167000
         AH    R14,=H'4'           INCREMENT TO NEXT POSITION           V3168000
         CH    R14,$TRAEND         IS THIS THE END OF THE TABLE         V3169000
         BNH   LOGADD              BR LOW OR EQUAL TO ADD ENTRY         V3170000
         $LOAD R14,$TRASTRT        LOAD ADDR OF FIRST ENTRY             V3171000
LOGADD   NULL                                                           V3172000
         MVC   0(1,R14),LOGID      MOVE LOG ID TO TRACE TABLE           V3173000
         MVC   1(3,R14),$LOGINFO   MOVE IN 3 BYTES OF INFORMATION       V3174000
         $STO  R14,$TRACUR         UP DATE CURRENT POINTER              V3175000
.LNOTRC  AIF   (&CONSOLE EQ 0 AND &PRTCONS EQ 0).LOGNOT                 V3176000
         CLI   LOGCLASS,&LOGCLAS   TEST FOR LOGABLE ERROR               V3177000
         BL    LRTN                SKIP ADDING TO LOG TAB IF NOT        V3178000
         $LOAD R14,$LOGLAST        GET ADDRESS OF LAST ENTRY            V3179000
         $AA   R14,4               INCREMENT TO NEXT ENTRY              V3180000
         $CA   R14,$LOGEND         ARE WE AT END OF TABLE               V3181000
         BL    LOGOUT              IF NOT LOG INTO THE TABLE            V3182000
         $LA   R14,$LOGTAB         IF SO RESET TO BEGINNING OF TABLE    V3183000
LOGOUT   $STO  R14,$LOGLAST        SAVE ENTRY                           V3184000
         MVC   0(1,R14),LOGID      BUILD MESSAGE TO BE LOGGED,ID        V3185000
         MVC   1(3,R14),$LOGINFO   HEX BYTES, FORGET TEXT               V3186000
         OI    $WCOMM1+1,X'F0'     OPEN THE CONSOLE GATE                V3187000
         $CA   R14,$LOGOUT         HAVE WE LAPPED CONSOLE LOGGING       V3188000
         BNE   LRTN                IF NOT RETURN                        V3189000
         $AA   R14,4               IF SO CHASE IT AHEAD 1 ENTRY         V3190000
         $STO  R14,$LOGOUT         SAVE IT FOR CONSOLE                  V3191000
.LOGNOT  ANOP                                                           V3192000
LRTN     $LOAD R14,LOG14SAV        RESTORE R14                          V3193000
         $LOAD R15,LOGRTN          PICK UP CALLER                       V3194000
         MVC   $LOGINFO,=F'0'      ZERO OUT LOG INFO FOR NEXT LOG       V3195000
         B     2(0,R15)            RETURN                               V3196000
LOG14SAV $ACON                                                          V3197000
LOGRTN   $ACON                                                          V3198000
$LOGCLAS EQU   &LOGCLAS                                                 V3199000
         DROP  R15                                                      V3200000
 TITLE '$ T P P U T  -- BUILDS BUFFERS FOR TRANSMISSION TO HASP '       V3201000
*                                                                       V3202000
*  ENTRY - $TPPUT                                                       V3203000
*                 REGISTERS - R8=RECORD TANK 2(R8)=RCB,3(R8)=SRCB       V3204000
*                            R14=RETURN ADDR ,CC=0 - RECORD NOT TAKEN   V3205000
*                                             CC.NE.0-RECORD ACCEPTED   V3206000
*                            R15 IS CONSIDERED VOLITILE                 V3207000
*                                                                       V3208000
*                                                                       V3209000
$TPPUT   NULL                                                           V3210000
        $TRACE SSM=YES                                                  V3211000
         $STO  R14,OSAVR14         SAVE RETURN                          V3212000
         STH   R10,OSAVR10                                              V3213000
         STH   R9,OSAVR9                                                V3214000
        $STO   R8,OINADD           SAVE INPUT TANK ADDR                 V3215000
         LH    R15,=H'1'           CONSTANT FOR SPEED                   V3216000
        $LOAD  R10,OINADD          COMPRESSION WORK AREA                V3217000
         AH    R10,=Y(TANKRCB-TANKDSEC) SKIP TO CTL BYTES               V3218000
         USING TANKDSEC,R8         *                                    V3219000
         LH    R9,TANKCNT          TANK DATA COUNT                      V3220000
         CH    R9,=H'0'            IS THIS A NULL RECORD                V3221000
         BE    OEOINPUT            BR IF YES TO ADD TO BUFFER           V3222000
         AIF   (&CMPTYPE LE 1).ONOCOMP TEST NONE OR TRAILING COMP       V3223000
         AR    R9,R8               INCLUDE TANK ADDR                    V3224000
        $STO   R9,OINEND           TO SAFE STORAGE                      V3225000
         CLI   OTS(R8),2           IS THIS A TEXT CARD                  V3226000
         BNE   OGOA                BR IF NO                             V3227000
*                   SKIP ATTEMPTING TO COMPRESS A TEXT CARD             V3228000
         LH    R9,TANKCNT          INPUT COUNT                          V3229000
        $LTR   R11,R8              INPUT ADDR                           V3230000
         AR    R8,R9               END OF RECORD                        V3231000
         AH    R9,OD200            COUNT FORMAT                         V3232000
         B     OSQUEEZE            GO PROCESS RECORD                    V3233000
OGOA     NULL                                                           V3234000
         MVI   OTS(R9),0           SETUP ENDING CHARACTER               V3235000
         AIF   (&CMPTYPE EQ 2).ONB8                                     V3236000
         CLI   OTS-1(R9),0         DOES ENDING MATCH LAST DATA CHAR     V3237000
         BNE   *+8                 BR IF NOT                            V3238000
         MVI   OTS(R9),255         YES...USE ANOTHER                    V3239000
.ONB8    ANOP                                                           V3240000
         MVC   OTS+1(&CCT-1,R9),OTS(R9) PROPAGATE FOR DUPLICATION       V3241000
OGO      NULL                                                           V3242000
        $LA    R14,OGO1            LOAD FOR SPEED                       V3243000
        $LA    R13,OSQUEEZE        LOAD FOR SPEED                       V3244000
         LH    R9,OD200            INITIAL COUNTER FOR MVC              V3245000
        $LTR   R11,R8              INPUT AREA TO R11                    V3246000
OGO1     NULL                                                           V3247000
         AIF   (&CMPTYPE NE 2).ONB1                                     V3248000
         CLI   OTS+&CCT-1(R8),64   IS LOOK-AHEAD A BLANK                V3249000
         BNE   OSKIPUP             BR IF NO                             V3250000
.ONB1    ANOP                                                           V3251000
         CLC   OTS(&CCT-1,R8),OTS+1(R8) CHECK FOR COMPRESSABILITY       V3252000
         BCR   8,R13               BR IF COMPRESSABLE (TO OSQUEEZE)     V3253000
         AR    R8,R15              UP DATA PTR                          V3254000
         AR    R9,R15              AND CHAR COUNT                       V3255000
         BR    R14                 CONTINUE (TO OGO1)                   V3256000
         AIF   (&CMPTYPE NE 2).ONB2                                     V3257000
OSKIPUP  NULL  *                   SKIP &CCT CHARACTERS                 V3258000
         AH    R8,=Y(&CCT)         ON INPUT                             V3259000
         AH    R9,=Y(&CCT)         BUT COUNT IT                         V3260000
         CH    R8,OINEND           IS THIS EOD                          V3261000
         BCR   4,R14               BR IF NO                             V3262000
         SH    R8,OINEND           CALCULATE OVERSHOOT                  V3263000
         SR    R9,R8               ADJUST STRING COUNT                  V3264000
        $LOAD  R8,OINEND           RESET FOR TERMINATION                V3265000
*              FALL THROUGH TO OSQUEEZE                                 V3266000
.ONB2    ANOP                                                           V3267000
*                                                                       V3268000
* OSQUEEZE - &CCT IDENTICAL CHARACTERS FOUND                            V3269000
*                                                                       V3270000
*                                                                       V3271000
OSQUEEZE NULL                      *                                    V3272000
         CH    R9,OD200            IS A CHARACTER STRING ACTIVE         V3273000
         BE    OCOMPTST            BR IF NO TO COMPRESS                 V3274000
         CH    R9,OD263            DOES STRING EXCEED SCB               V3275000
         BH    OBIGMOVE            BR IF YES                            V3276000
         STH   R9,*+4              SET MOVE AND COUNT                   V3277000
         MVC   3(*-*,R10),OTS(R11) MOVE CHAR STRING (+1)                V3278000
         MVC   2(1,R10),*-5        SET SCB COUNT                        V3279000
         OI    2(R10),X'C0'        SET SCB ID BITS                      V3280000
         SH    R9,OD200            REDUCE TO ACTUAL COUNT               V3281000
         AR    R10,R9              FIX OUTPUT POINTER                   V3282000
         AR    R10,R15             COUNT SCB                            V3283000
OCOMPTST NULL  *                   TEST FOR EOI                         V3284000
         CH    R8,OINEND           ARE WE DONE...                       V3285000
         BNL   OEOINPUT            BR IF YES                            V3286000
OCOMP    NULL                                                           V3287000
        $LA    R14,OCOMP1          FOR LOOP SPEED                       V3288000
        $LA    R13,OCMPSTOP        FOR LOOP SPEED                       V3289000
         LH    R9,=Y(&CCT)         START COMPRESSION COUNTER            V3290000
OCOMP1   NULL  *                   CONTINUE COMPRESSION TESTING         V3291000
         AIF   (&CMPTYPE NE 2).ONB3                                     V3292000
         CLI   &CCT+OTS(R8),64     IS NEXT A BLANK                      V3293000
         AGO   .ONB4               BLANKS ONLY                          V3294000
.ONB3    ANOP                                                           V3295000
         CLC   (&CCT+OTS-1)(1,R8),(&CCT+OTS)(R8) DOES MATCH CONTINUE    V3296000
.ONB4    ANOP                                                           V3297000
         BCR   7,R13               BR IF NO (TO CMPSTOP)                V3298000
         AR    R9,R15              ANOTHER MATCH... COUNT IT            V3299000
         AR    R8,R15              UP TO NEXT CHAR                      V3300000
         BR    R14                 CONTINUE (TO OCOMP1)                 V3301000
OCMPSTOP NULL  *                   IDENTICAL STRING ENDED               V3302000
         CH    R9,=H'31'           DOES IT EXCEED SCB...                V3303000
         BH    OBIGPROP            BR IF YES                            V3304000
         STH   R9,$TEMP            TO TEMPORARY STORAGE                 V3305000
         OI    $TEMP+1,X'80'       SET SCB ALWAYS BIT                   V3306000
         MVC   2(1,R10),$TEMP+1    SET SCB                              V3307000
         AIF   (&CMPTYPE EQ 2).ONB5                                     V3308000
         CLI   (&CCT+OTS-1)(R8),C' ' ARE WE SQUEEZING BLANKS            V3309000
         BE    OBLANK              BR IF YES                            V3310000
         MVC   3(1,R10),(&CCT+OTS-1)(R8) SET DUPLICATION CHAR           V3311000
         OI    2(R10),X'20'        SHOW NON-BLANK DUPLICATION           V3312000
         AR    R10,R15             SKIP SAMPLE CHAR                     V3313000
.ONB5    ANOP                                                           V3314000
OBLANK   NULL                                                           V3315000
         AR    R10,R15             COUNT SCB                            V3316000
         AH    R8,=Y(&CCT)         COUNT INPUT FIELD                    V3317000
         B     OGO                 AND CONTINUE RECORD                  V3318000
OBIGPROP NULL  *                   DUPLICATION COUNT EXCEEDS SCB        V3319000
         MVI   2(R10),X'9F'        SHOW MAX SCB                         V3320000
         AIF   (&CMPTYPE EQ 2).ONB6                                     V3321000
         CLI   (&CCT+OTS-1)(R8),C' ' IS THIS BLANKS                     V3322000
         BE    OBIGBLNK            BR IF YES                            V3323000
         MVC   3(1,R10),(&CCT+OTS-1)(R8) SET SAMPLE CHAR                V3324000
         OI    2(R10),X'20'        SHOW NON-BLANK                       V3325000
         AR    R10,R15             COUNT SAMPLE                         V3326000
.ONB6    ANOP                                                           V3327000
OBIGBLNK NULL  *                   EXCESSIVE COUNT BLANKS               V3328000
         AR    R10,R15             COUNT SCB                            V3329000
         SH    R9,=H'31'           ADJUST COUNT                         V3330000
         B     OCMPSTOP            AND TRY AGAIN                        V3331000
OBIGMOVE NULL                      STRING COUNT EXCEEDS SCB MAXIMUM     V3332000
         MVC   3(63,R10),OTS(R11)  MOVE MAX                             V3333000
         MVI   2(R10),X'FF'        SET MAX SCB                          V3334000
         AH    R10,=H'64'          COUNT STRING AND SCB                 V3335000
         AH    R11,=H'63'          UPDATE FROM POINTER                  V3336000
         SH    R9,=H'63'           REDUCE COUNT                         V3337000
         B     OSQUEEZE            AND TRY AGAIN                        V3338000
         AGO   .OSKNCMP                                                 V3339000
.ONOCOMP ANOP                                                           V3340000
OBIGMOVE NULL  *                   MOVE MAXIMUM SCB COUNT               V3341000
         AIF   (&CMPTYPE NE 1).ONB7                                     V3342000
        $LA    R14,ONXTBLK         LOAD FOR SPEED                       V3343000
        $LA    R13,ONONBLK         LOAD FOR SPEED                       V3344000
         AR    R9,R8               R9 = EOR+1                           V3345000
ONXTBLK  NULL  *                   PROCESS NEXT CHARACTER               V3346000
         CLI   OTS-1(R9),64        IS CHARACTER BLANK                   V3347000
         BCR   7,R13               BR IF NO (TO XNONBLK)                V3348000
         SR    R9,R15              YES...REDUCE COUNT                   V3349000
         BR    R14                 AND CONTINUE (AT ONXTBLK)            V3350000
ONONBLK  NULL  *                   LAST TRAILING BLANK OUT              V3351000
         SR    R9,R8               REDUCE TO TRUE COUNT                 V3352000
         BP    *+8                 BR IF ANY NON-BLANKS                 V3353000
         LH    R9,=H'1'            RECORD IS ALL BLANK...FORCE 1        V3354000
.ONB7    ANOP                                                           V3355000
         CH    R9,=H'63'           IS COUNT MAX OR GT                   V3356000
         BL    OENDER              BR IF NO                             V3357000
         MVC   3(63,R10),OTS(R8)   YES...MOVE MAX                       V3358000
         MVI   2(R10),255          SET MAX SCB                          V3359000
         AH    R10,=H'64'          COUNT ADDITION                       V3360000
         AH    R8,=H'63'           COUNT FROM                           V3361000
         SH    R9,=H'63'           REDUCE COUNT                         V3362000
         BZ    OEOINPUT            BR IF NO MORE                        V3363000
         B     OBIGMOVE            OTHERWISE CONTINUE                   V3364000
OENDER   NULL  *                   MOVE RESIDUAL COUNT                  V3365000
         STH   R9,$TEMP            SET COUNT                            V3366000
         MVC   *+7(1),$TEMP+1      AND PUT IN MVC                       V3367000
         MVC   3(*-*,R10),OTS(R8)  MOVE REST                            V3368000
         MVC   2(1,R10),*-5        SET SCB COUNT                        V3369000
         OI    2(R10),X'C0'        SET TYPE BITS                        V3370000
         AR    R10,R9              ADJUST OUTPUT POINTER                V3371000
         AR    R10,R15             COUNT SCB                            V3372000
.OSKNCMP ANOP                                                           V3373000
*                                                                       V3374000
*              END OF INPUT RECORD - TERMINATE AND ADD TO BUFFER        V3375000
*                                                                       V3376000
OEOINPUT MVI   2(R10),0            END-OF-RECORD SCB                    V3377000
         AR    R10,R15             COUNT IT                             V3378000
        $LOAD  R8,OINADD           STARTING ADDR OF COMPRESSED REC      V3379000
         SR    R10,R8              REDUCE TO ACTUAL COUNT               V3380000
         SH    R10,=Y(L'TANKCHN-2) COMPENSATE FOR FULL CHAIN WORD       V3381000
         STH   R10,TANKCHN         SAVE COUNT IN TANK FOR $TPREPUT      V3382000
OREENT   NULL                      RE-ENTRY POINT FROM $TPREPUT         V3383000
        $LOAD  R9,OBUFPTR          GET ADDR OF ACTIVE BUFFER            V3384000
         CH    R9,=H'0'            IS THERE ONE                         V3385000
         BE    OGETBUF             BR IF NO                             V3386000
OBUFOK   NULL  *                   VALID BUFFER                         V3387000
         CH    R10,OBUFCNT         WILL THIS RECORD FIT...              V3388000
         BH    OBUFFULL            BR IF NO                             V3389000
         STH   R10,$TEMP           FOR STC                              V3390000
         MVC   *+7(1),$TEMP+1      SET IN MOVE                          V3391000
         MVC   0(*-*,R9),L'TANKCHN(R8) MOVE RECORD                      V3392000
         AR    R9,R10              UPDATE CURRENT PTR                   V3393000
        $STO   R9,OBUFPTR          AND RESET                            V3394000
         LH    R9,OBUFCNT          REMAINING COUNT                      V3395000
         SR    R9,R10              REDUCE BY THIS RECORD                V3396000
         STH   R9,OBUFCNT          AND RESET                            V3397000
         CH    R10,=H'3'           WAS THIS A NULL RECORD               V3398000
         BE    OFLUSH              BR IF YES TO WRITE BUFFER            V3399000
         CLI   TANKRCB,&ORCB(1)    IS THIS OPER CMD TO HASP             V3400000
         BE    OFLUSH              BR IF YES TO SEND BUFFER             V3401000
ORETOK   NULL  *                   POSITIVE RETURN ENTRY                V3402000
         OI    OFLSW+1,X'F0'       OPEN NORMAL GATE AND SET COND CODE   V3403000
ORETURN  NULL                      RETURN--COND. CODE ALREADY SET       V3404000
         LH    R8,OINADD           RESTORE TANK ADDR                    V3405000
         LH    R9,OSAVR9           RESTORE                              V3406000
         LH    R10,OSAVR10         RESTORE                              V3407000
         $LOAD R14,OSAVR14         GET RETURN                           V3408000
         BR    R14                 AND DO IT                            V3409000
OGETBUF  NULL  *                                                        V3410000
         SR    R9,R9               SET COND CODE                        V3411000
$TPPNONE NOP   ORETURN             SW SET BY COMSUP TO STOP BUFFERING   V3412000
        $DCHAIN $BUFPOOL,R9        GET A BUFFER                         V3413000
         BZ    ORETURN             BR IF NONE (NOTE COND. CODE SET)     V3414000
        $STO   R9,OACTBUF          SET BUFFER ADDR                      V3415000
         AH    R9,=Y(BUFDATA-BUFDSECT)  TO USABLE AREA                  V3416000
        $STO   R9,OBUFPTR          SET CURRENT POINTER                  V3417000
         LH    R14,$TPBFSIZ               SET                        R4 V3417500
         SH    R14,=Y(BUFDATA+2-BUFSTART)  CURRENT                   R4 V3418000
         STH   R14,OBUFCNT                  COUNT                    R4 V3418500
         B     OBUFOK              AND GO FIT RECORD                    V3419000
*                                                                       V3420000
*              BUFFER IS FULL--SEND IT TO HASP                          V3421000
*                                                                       V3422000
OFLUSH   NULL  *                   ENTRY TO WRITE A PARTIAL BUFFER      V3423000
         MVI   OFLSW+1,0           SET FLUSH SWITCH                     V3424000
OBUFFULL NULL                                                           V3425000
         $LOAD R9,OBUFPTR          GET CURRENT BUFFER POINTER           V3426000
        $LOAD  R13,OACTBUF         FOR $EXTP                            V3427000
         USING BUFDSECT,R13                                             V3428000
         MVI   0(R9),0             SET EOB                              V3429000
         SR    R9,R13              SUBTRACT SOB                         V3430000
         SH    R9,=Y(BUFSTART-BUFDSECT-1) MAKE COUNT ACTUAL             V3431000
         STH   R9,BUFCOUNT         SET COUNT                            V3432000
         SR    R9,R9               ZERO                                 V3433000
        $STO   R9,OBUFPTR          AND SHOW NO BUFFER                   V3434000
         BAS   R14,$EXTP           GO DO I/O                            V3435000
OFLSW    NOP   OGETBUF             FLUSH SWITCH                         V3436000
         B     ORETOK              JUST RETURN IF FLUSH                 V3437000
         DROP  R13                                                      V3438000
*                                                                       V3439000
*              RE-ENTRY POINT IF ORIGINAL $TPPUT NOT ACCEPTED           V3440000
*                R8=ORIGINAL TANK , R14= RETURN                         V3441000
$TPREPUT NULL                                                           V3442000
        $STO   R8,OINADD           SET FOR RESTORE                      V3443000
         $STO  R14,OSAVR14         RESET RETURN                         V3444000
         STH   R10,OSAVR10         SAVE                                 V3445000
         STH   R9,OSAVR9           SAVE                                 V3446000
         LH    R15,=H'1'           CONSTANT                             V3447000
         LH    R10,TANKCHN         COMPRESSED COUNT                     V3448000
         B     OREENT              ENTER FLOW                           V3449000
         EJECT                                                          V3450000
*                                                                       V3451000
*                                                                       V3452000
*                                                                       V3453000
*                                                                       V3454000
OSAVR9   $ACON 0                   REG SAVE                             V3455000
OSAVR10  $ACON 0                   REG SAVE                             V3456000
OSAVR14  $ACON 0                   RETURN ADDR SAVE                     V3457000
OINADD   $ACON 0                   INPUT TANK ADDR                      V3458000
OINEND   $ACON 0                   LAST VALID DATA BYTE IN TANK         V3459000
OACTBUF  $ACON 0                   ACTIVE BUFFER ADDR                   V3460000
OBUFPTR  $ACON 0                   CURRENT POINTER IN BUFFER            V3461000
OBUFCNT  DC    H'0'                REMAING SPACE COUNT IN BUFFER        V3462000
OD200    DS    0H                                                       V3463000
         DC    X'D200'             CONSTANT FOR MVC COUNT               V3464000
OD263    DS    0H                                                       V3465000
         DC    X'D23F'             MAX SCB CNT + MVC                    V3466000
OTS      EQU   TANKDATA-TANKDSEC                                        V3467000
         DROP  R8                  DISCONTINUE TANK REG                 V3468000
 TITLE ' $ T P G E T  --DEBLOCKS BUFFERS RECEIVED FROM HASP  '          V3469000
*                                                                       V3470000
*                                                                       V3471000
$TPGET   NULL  *                   ENTERED FROM COMUTATOR               V3472000
         MVI   $TPGETCM+1,0        CLOSE COMMUTATOR                     V3473000
        $LA    R13,$TCT1           BEGINNING OF TCT'S                   V3474000
         USING TCTDSECT,R13        **                                   V3475000
GTEST    NULL  *                   *                                    V3476000
         TM    TCTSTAT,TCTACT      IS ACTION REQUESTED                  V3477000
         BO    GSERVICE            BR IF YES                            V3478000
GNEXTTCT NULL                                                           V3479000
        $LOAD  R13,TCTNEXT         TO NEXT TCT                          V3480000
        $LTR   R13,R13             IS THIS END                          V3481000
         BNZ   GTEST               BR IF NO                             V3482000
*                                                                       V3483000
*              ALL TCT'S HAVE BEEN SERVICED...                          V3484000
*                                                                       V3485000
GWAIT    B     $TPGETCM+4          EXIT                                 V3486000
         EJECT                                                          V3487000
*                                                                       V3488000
*              SERVICE TCT WITH ACTION BIT ON                           V3489000
*                                                                       V3490000
GSERVICE NULL  *                                                        V3491000
         CLI   TCTBUFCT,0          ARE ANY BUFFERS AVAILABLE            V3492000
         BNE   GTTANK              BR IF YES                            V3493000
GNOACT   NI    TCTSTAT,255-TCTACT  NO... TURN OFF ACTION                V3494000
         B     GNEXTTCT            AND CONTINUE                         V3495000
GTTANK   NULL  *                   A BUFFER IS PRESENT                  V3496000
         CLC   TCTTNKCT,TCTTNKLM   ARE SUFFICIENT TANKS QUEUED          V3497000
         BNL   GNOACT              BR IF YES                            V3498000
*                   A DECOMPRESSION IS REQUIRED                         V3499000
        $DCHAIN $TANKPOL,R10,NOENB GET A TANK                           V3500000
         BZ    GWAIT               BR IF NONE                           V3501000
         USING TANKDSEC,R10        *                                    V3502000
        $LOAD  R8,TCTBUFER         CURRENT BUFFER                       V3503000
         AH    R8,(BUFCOUNT-BUFDSECT)(0,R8) TO DATA                     V3504000
        $STO   R10,GTANK           SAVE TANK ADDR.                      V3505000
         MVC   TANKRCB(2),0(R8)    MOVE RCB AND SRCB                    V3506000
         LH    R15,=H'1'           CONSTANT FOR SPEED                   V3507000
GDECOMP  NULL  *                   PROCESS AN SCB                       V3508000
         MVC   GSCB(1),2(R8)       SET SCB                              V3509000
         NI    GSCB,X'7F'          TURN OFF HIGH-BIT                    V3510000
         BZ    GENDREC             END-OF-RECORD                        V3511000
         TM    GSCB,X'40'          IS THIS A CHAR STRING...             V3512000
         BZ    GPROP               BR IF NOT                            V3513000
         NI    GSCB,X'3F'          TURN OFF STRING BIT                  V3514000
         MVC   TANKDATA(*-*),3(R8) MOVE STRING (+1)                     V3515000
GSCB     EQU   *-5                 SCB AND COUNT                        V3516000
         LH    R9,GSCB-1           GET MOVE COUNT                       V3517000
         SH    R9,GD200            REMOVE MOVE                          V3518000
         AR    R8,R9               COUNT INPUT STRING                   V3519000
GCONT    AR    R10,R9              COUNT OUTPUT STRING                  V3520000
         AR    R8,R15              COUNT SCB                            V3521000
         B     GDECOMP             CONTINUE WITH RECORD                 V3522000
GPROP    NULL  *                   PROPGATION REQUIRED                  V3523000
         TM    GSCB,X'20'          IS THIS BLANKS...                    V3524000
         BZ    GBLANKS             BR IF YES                            V3525000
         NI    GSCB,X'1F'          NO .. REMOVE INDICATOR               V3526000
         MVC   TANKDATA(1),3(R8)   SET SAMPLE CHARACTER                 V3527000
         MVC   GMOV+1(1),GSCB      SET COUNT                            V3528000
GMOV     MVC   TANKDATA+1(*-*),TANKDATA  PROPAGATE COUNT (+2)           V3529000
         LH    R9,GSCB-1           PROPAGATION COUNT                    V3530000
         SH    R9,GD200            LESS MOVE                            V3531000
         AR    R8,R15              COUNT SAMPLE CHAR                    V3532000
         B     GCONT               AND ENTER FLOW                       V3533000
GBLANKS  NULL                      BLANK PROPAGATION REQUIRED           V3534000
         MVI   TANKDATA,C' '       SET BLANK SAMPLE                     V3535000
         MVC   *+7(1),GSCB         SET COUNT                            V3536000
         MVC   TANKDATA+1(*-*),TANKDATA PROPAGATE BLANKS                V3537000
         LH    R9,GSCB-1           GET MOVE COUNT                       V3538000
         SH    R9,GD200            LESS MVC                             V3539000
         B     GCONT               ENTER FLOW                           V3540000
GENDREC  NULL                      END OF LOGICAL RECORD                V3541000
        $LOAD  R9,GTANK            TANK ADDR                            V3542000
         SR    R10,R9              FROM END PTR                       X V3543000
         DROP  R10                                                      V3544000
         USING TANKDSEC,R9                                              V3545000
         STH   R10,TANKCNT         SET COUNT IN TANK                    V3546000
        $LA    R10,TCTTANK-TCTDSECT TANK CHAIN DISPLACEMENT             V3547000
         AR    R10,R13             R10 = ABSOLUTE TANK CHAIN PTR        V3548000
        $CHAIN (R10),R9,NOENB      ADD TO TANK QUEUE                    V3549000
         AH    R8,=H'3'            UPDATE TO NEXT RCB                   V3550000
         LH    R10,TCTTNKLM        LIMIT AND COUNT                      V3551000
         AR    R10,R15             INCREMENT COUNT                      V3552000
         STH   R10,TCTTNKLM        AND RESET                            V3553000
        $LOAD  R10,TCTCOM          GET COMMUTATOR ENTRY                 V3554000
         MVI   1(R10),X'F0'        OPEN PROCESSOR GATE                  V3555000
        $LOAD  R9,TCTBUFER         CURRENT BUFFER ADDR                  V3556000
         CLC   TCTRCB,0(R8)        IS NEXT RECORD SAME                  V3557000
         BNE   GSWITCH             BR IF NO                             V3558000
         SR    R8,R9               REDUCE TO DATA DISPLACEMENT          V3559000
         $STO  R8,BUFCOUNT-BUFDSECT(0,R9) AND SAVE                      V3560000
         B     GTTANK              AND CONTINUE                         V3561000
GSWITCH  NULL  *                   DIFFERENT RCB ENCOUNTERED            V3562000
         $SSM  0                   DISABLE INTERRUPTS                   V3563000
         MVC   TCTBUFER,0(R9)      UPDATE CHAIN                         V3564000
         $FREE $BUFPOOL,R9,NOENB   FREE THE BUFFER                      V3565000
         LH    R8,TCTBUFLM         BUFFER LIMIT AND COUNT               V3566000
        $BCTR  R8,0                REDUCE COUNT                         V3567000
         STH   R8,TCTBUFLM         AND RESET                            V3568000
         CLC   TCTBUFCT,TCTBUFLM   IS ANOTHER BUFFER REQUIRED           V3569000
         BNL   GENABLE             ENABLE INTERRUPTS                    V3570000
        $OC    $FCSOUT,TCTFCS      SHOW NEXT BUFFER PERMITTED           V3571000
         MVI   $FCSHOT+1,X'F0'     SHOW FCS CHANGE                      V3572000
GENABLE  $SSM  FF                  ALLOW INTERRUPTS                     V3573000
         B     GSERVICE            AND CONTINUE                         V3574000
GTANK    $ACON 0                   TANK ADDR                            V3575000
GD200    EQU   OD200               SHARE CONSTANT                       V3576000
         DROP  R9                  DISCONTINUE TANK REG                 V3577000
 TITLE 'C O M S U P  --  $TPOPEN (OBTAINS PERMISSION TO BEGIN SENDING)' V3578000
$TPOPEN  NULL  *                                                        V3579000
        $TRACE SSM=YES                                                  V3580000
        $STO   R14,TSAVA           SAVE CALLER'S                        V3581000
        $STO   R8,TSAVB             REGS                                V3582000
         MVC   TTANK+TANKSRCB-TANKDSEC(1),TANKRCB-TANKDSEC(R8) SET FCN  V3583000
        $LOAD  R8,TANKCON          FOR $TPPUT                           V3584000
         BAS   R14,$TPPUT          GO PUT RECORD                        V3585000
        $LOAD  R8,TSAVB            CALLER'S                             V3586000
        $LOAD  R14,TSAVA           REGS                                 V3587000
         BR    R14                 RETURN TO CALLER                     V3588000
*                                  DUMMY TANK                           V3589000
TTANK   $ACON  0                   CHAIN                                V3590000
         DC    X'90'               RCB FOR FUNCTION CTL RECORD          V3591000
         DC    X'00'               USER'S SRCB (FUNCTION TYPE)          V3592000
         DC    H'0'                TANK COUNT                           V3593000
TSAVA   $ACON  0                                                        V3594000
TSAVB   $ACON  0                                                        V3595000
TANKCON $ACON  TTANK                                                    V3596000
 TITLE 'C O M S U P  --  $EXTP (ENTRY TO TRANSMIT A BUFFER TO HASP)'    V3597000
*                                                                       V3598000
*$EXTP - R14 = RETURN , R13 = BUFFER ADDR                               V3599000
*                                                                       V3600000
         SPACE 3                                                        V3601000
$EXTP    NULL  *                   WRITE ENTRY POINT                    V3602000
         USING BUFDSECT,R13        BUFFER ADDR IS IN R13                V3603000
         AIF   ('&XPARENT' EQ 'YES').NONXP1                             V3604000
         $SAVE R14,R15,CTPREGS     SAVE WORK REGISTERS         @OZ27704 V3605000
         AIF   (&MACHINE EQ 20).BUFA                                R41 V3605500
        $LA    R14,BUFDATA         LOCATE START OF BUFFER DATA       R4 V3606000
.BUFA    AIF   (&MACHINE NE 20).BUFB                                R41 V3606200
        $LA    R14,BUFDATA-BUFDSECT  GET BUFFER DATA OFFSET         R41 V3606400
         AR    R14,R13             LOCATE START OF BUFFER DATA      R41 V3606600
.BUFB    ANOP                                                       R41 V3606800
         LH    R15,$TPBFSIZ        OBTAIN BUFFER                     R4 V3607000
         SH    R15,=H'4'            DATA LENGTH                      R4 V3608000
         SPACE 1                                                     R4 V3609000
TR1      CH    R15,=H'256'         IF REMAINING LENGTH NOT GT 256,   R4 V3610000
         BNH   TR2                  BR TO FINISH TRANSLATION         R4 V3611000
         TR    0(256,R14),$NONXPAR   ELSE TRANSLATE 256 BYTES        R4 V3612000
        $AA    R14,256             THEN UPDATE BUFFER ADDRESS        R4 V3613000
         SH    R15,=H'256'         REDUCE BUFFER LENGTH              R4 V3614000
         BZ    TR2+6     ZERO BUFFER REMAINDER                 @OZ27715 V3614500
         B     TR1                  AND BR TO CONTINUE TRANSLATION   R4 V3615000
         SPACE 1                                                     R4 V3615500
&TEMP    SETA  0                                               @OZ27715 V3615550
&TEMP2   SETA  (&TPBFSIZ-4)/256   GET MULT FACTOR              @OZ27715 V3615600
TR2      EQU   *                                               @OZ27715 V3615625
         AIF   (&TPBFSIZ-4 GE 256).LARGE BUFFER TRANSLATE      @OZ27715 V3615650
&TEMP    SETA  &TPBFSIZ-4                                      @OZ27715 V3615750
         AGO   .LAST                                           @OZ27715 V3615800
.LARGE   ANOP                                                  @OZ27715 V3615850
&TEMP    SETA  &TPBFSIZ-4-(256*&TEMP2) GET REMAINDER OF BUFF   @OZ27715 V3615900
.LAST    ANOP                                                  @OZ27715 V3615950
         SPACE 1                                               @OZ27715 V3616000
         TR    0(&TEMP,R14),$NONXPAR TRANSLATE REMAINDER       @OZ27715 V3616200
         $RESTORE R14,R15,CTPREGS RESTORE WORK REGISTERS       @OZ27704 V3616500
.NONXP1  ANOP                                                           V3617000
         AIF   (&HOME EQ 0).EXTPOK                                      V3618000
*              LOCAL PROCESSING MODE SELECTED..............             V3619000
         $SAVE R14,R15,CREGS       SAVE SOME REGS                       V3620000
         B     CHOMASGN            ASSIGN BUFFER TO TCT                 V3621000
         AGO   .EXTPFK                                                  V3622000
.EXTPOK  ANOP                                                           V3623000
        $LA    R9,$OUTBUF          QUEUE CONTROL WORD                   V3624000
.EXTPFK  ANOP                                                           V3625000
        $CHAIN (R9),R13            QUEUE FOR TRANSMISSION               V3626000
         BR    R14                 RETURN TO CALLER                     V3627000
         AIF   ('&XPARENT' EQ 'YES').NONXP2                             V3628000
$NONXPAR DC    64X'00'             TAKE OUT CTL CHARS                   V3629000
         DC    192AL1(*-$NONXPAR)  NON-CTL CHARS                        V3630000
.NONXP2  ANOP                                                           V3631000
         DROP  R13                 KILL BUFFER ADDRESSABILITY           V3632000
 TITLE 'C O M S U P  -- INTERRUPT PROCESSOR (DEFINITIONS)  '            V3633000
         SPACE 3                                                        V3634000
*                        CONTROL CHARACTERS                             V3635000
         SPACE 2                                                        V3636000
XSOH     EQU   X'01'               START OF HEADING                     V3637000
XSTX     EQU   X'02'               START OF TEXT                        V3638000
XETX     EQU   X'03'               END OF TEXT                          V3639000
XDLE     EQU   X'10'               DATA LINK ESCAPE                     V3640000
XETB     EQU   X'26'               END OF TEXT BLOCK                    V3641000
XENQ     EQU   X'2D'               ENQUIRY                              V3642000
XSYN     EQU   X'32'               SYNCHRONIZATION                      V3643000
XEOT     EQU   X'37'               LOST BLOCK ALARM                     V3644000
XNAK     EQU   X'3D'               NEGATIVE ACKNOWLEDGEMENT             V3645000
XACK1    EQU   X'61'               POSITIVE ACKNOWLEDGEMENT-CONDITIONAL V3646000
XACK0    EQU   X'70'               POSITIVE ACKNOWLEDGEMENT             V3647000
         AIF   ('&XPARENT' EQ 'YES').XPARA                              V3648000
XLDR     EQU   XSOH                NON-TRANSPARENCY HEADER              V3649000
XTRL     EQU   XSYN                NON-TRANSPARENCY TRAILER             V3650000
XCHN     EQU   X'A0'               NON-TRANSPARENT CCW CHAINING BITS    V3651000
         AGO   .XPARB                                                   V3652000
.XPARA   ANOP                                                           V3653000
XLDR     EQU   XDLE                TRANSPARENT HEADER                   V3654000
XTRL     EQU   XDLE                TRANSPARENT TRAILER                  V3655000
XCHN     EQU   X'60'               TRANSPARENT CCW CHAINING BITS        V3656000
.XPARB   ANOP                                                           V3657000
         SPACE 5                                                        V3658000
         AIF   (&MACHINE NE 20).D1                                      V3659000
         SPACE 5                                                        V3660000
*                        COMMUNICATIONS ADAPTER ADDRESSES               V3661000
         SPACE 2                                                        V3662000
CAINTID  EQU   X'56'               BSCA INTERRUPT IDENTIFIER            V3663000
CAREAD   EQU   X'54'+1             BSCA RECEIVE CODE                    V3664000
CAWRITE  EQU   X'58'+1             BSCA TRANSMIT CODE                   V3665000
CASENSE  EQU   X'57'               BSCA SENSE CODE                      V3666000
CAERROR  EQU   X'50'               BSCA ERROR TEST CODE                 V3667000
CASCA    EQU   X'56'               BSCA STORE CURRENT ADDRESS           V3668000
CAENABLE EQU   X'52'               BSCA ENABLE CODE                     V3669000
CADISABL EQU   X'53'               BSCA DISABLE CODE                    V3670000
CARECI   EQU   X'51'+1             BSCA RECEIVE INITIAL CODE            V3671000
CAWRTRD  EQU   X'50'+1             BSCA TRANSMIT-RECEIVE CODE           V3672000
         AGO   .D2                                                      V3673000
.D1      ANOP                                                           V3674000
         SPACE 5                                                        V3675000
*                        /360 MACHINE CHARACTERISTICS                   V3676000
         SPACE 2                                                        V3677000
$ADAPTER EQU   X'&ADAPT'           ADDRESS OF COMMUNICATIONS ADAPTER    V3678000
$EXTOLD  EQU   X'18'               EXTERNAL OLD PSW                     V3679000
$IOOLD   EQU   X'38'               I/O OLD PSW                          V3680000
$CSW     EQU   X'40'               CHANNEL STATUS WORD                  V3681000
$CAW     EQU   X'48'                                                    V3682000
$TIMER   EQU   X'50',4             INTERVAL TIMER                       V3683000
.D2      ANOP                                                           V3684000
         SPACE 2                                                        V3685000
*                        BLOCK CONTROL BYTE INDICATORS                  V3686000
         SPACE 2                                                        V3687000
BCBIGNRE EQU   X'10'               IGNORE BLOCK COUNT INDICATOR         V3688000
BCBRESET EQU   X'20'               RESET BLOCK COUNT INDICATOR          V3689000
 TITLE 'C O M S U P  -- INTERRUPT PROCESSOR (ENTRY POINT)             ' V3690000
         AIF   (&MACHINE EQ 20).FRL000                                  V3691000
$EXTINT  NI    $EXTOLD+1,X'FD'     EXTERNAL INTERRUPTS ENTER HERE       V3692000
         LPSW  $EXTOLD             RESET WAIT STATE AND RESUME          V3693000
         SPACE 5                                                        V3694000
.FRL000  ANOP                                                           V3695000
$IOINT   NULL  *                   ALL INTERRUPTS ENTER HERE            V3696000
         AIF   (&MACHINE NE 20).X2                                      V3697000
         CLI   145,CAINTID         IS THIS BSCA                         V3698000
         BNE   $NOTTP              BR IF NO                             V3699000
$COMBUSY B     CEXIT               RETURN IF NO ACTIVITY                V3700000
         TIOB  CERROR,CAERROR      BR IF ANY ERROR                      V3701000
CREADREQ B     CENDREAD            BR IF READ ENDING                    V3702000
CRDRESP  XIO   *-*(CAREAD),&TPBFSIZ OTHERWISE START READ                V3703000
CREADCT  EQU   *-2                 READ COUNT FIELD                     V3704000
         BC    7,*-6               WAIT FOR READ TO TAKE                V3705000
         MVI   CREADREQ+1,X'F0'    SHOW READ ACTIVE                     V3706000
         SPSW  144                 AND EXIT                             V3707000
CREXIT   NULL                                                           V3708000
         AIF   (&TRACE EQ 0 OR &MACHINE NE 20).ITRA                     V3709000
        $RESTORE R12,R15,CREGS     RESTORE INTERRUPTED REGISTERS        V3710000
         AGO   .ITRB                                                    V3711000
.ITRA    ANOP                                                           V3712000
        $RESTORE R13,R15,CREGS     RESTORE INTERRUPTED REGS             V3713000
.ITRB    ANOP                                                           V3714000
CEXIT    NULL                                                           V3715000
         SPSW  144                 RETURN TO INTERRUPTED LOCATION       V3716000
         AGO   .X3                                                      V3717000
.X2      ANOP                                                           V3718000
         NI    $IOOLD+1,X'FD'      RESET WAIT STATE                     V3719000
         CLC   $IOOLD+2(2),=AL2($ADAPTER)    IS THIS SDA                V3720000
         BNE   $NOTTP              BR IF NO                             V3721000
$COMBUSY NOP   CEXIT               BR IF NO COMMUNICATIONS I/O ACTIVE   V3722000
        $SAVE  R13,R15,CREGS       SAVE INTERRUPTED REGS                V3723000
         $LOAD R13,CBUFFER         GET CURRENT BUFFER ADDR              V3724000
CUWFAKE  NOP   CWRTSIO             *** DUMMY READ SWITCH ***            V3725000
         TM    $CSW+5,X'BF'        TEST FOR UNEXPECTED ERRORS           V3726000
         BNZ   CBADERR             BR IF ANY                            V3727000
         TM    $CSW+4,X'F3'        TEST OTHER UNUSUAL ENDINGS           V3728000
         BNZ   CERROR              BR IF ANY                            V3729000
*              CHANNEL-END , DEVICE-END ASSUMED                         V3730000
.X3      ANOP                                                           V3731000
 TITLE 'C O M S U P  -- CENDREAD (PROCESS NORMAL READ COMPLETION) '     V3732000
         SPACE 3                                                        V3733000
$ENDREAD NULL  *                   EXTERNAL ENTRY POINT                 V3734000
CENDREAD NULL  *                   EXAMINE CONTROL INFORMATION          V3735000
         AIF   (&MACHINE NE 20).X21                                     V3736000
         AIF   (&TRACE EQ 0 OR &MACHINE NE 20).ITRC                     V3737000
        $SAVE  R12,R15,CREGS       SAVE INTERRUPTED REGS                V3738000
         $LOAD R12,=Y($SVC)        SET TRACE ENTRY                      V3739000
         AGO   .ITRD                                                    V3740000
.ITRC    ANOP                                                           V3741000
        $SAVE  R13,R15,CREGS       SAVE INTERRUPTED REGS                V3742000
.ITRD    ANOP                                                           V3743000
        $LOAD  R13,CBUFFER         GET ACTIVE BUFFER                    V3744000
.X21     ANOP                                                           V3745000
         USING BUFDSECT,R13        *                                    V3746000
         SPACE 3                                                        V3747000
         B     CNOLOGAL            AVOID LOG OVERHEAD                   V3748000
         SPACE 2                                                        V3749000
*              NOP THE ABOVE BRANCH TO LOG EVERY BLOCK RECEIVED         V3750000
         SPACE 2                                                        V3751000
         MVC   $LOGINFO(3),BUFSTART+1 RESPONSE LEADERS                  V3752000
        $LOG   XTPREAD             LOG RECEIVED DATA                    V3753000
CNOLOGAL NULL  *                   ENTRY TO SKIP LOGGING EVERYTHING     V3754000
         MVC   CRESP,BUFSTART      GET FIRST RESPONSE BYTE              V3755000
         CLI   CRESP,XDLE          IS IT DLE LEADER...                  V3756000
         BNE   *+10                BR IF NO                             V3757000
         MVC   CRESP,BUFSTART+1    YES... GET REAL RESPONSE             V3758000
         CLI   CRESP,XSOH          IS THIS NON-XPARENT LEADER...        V3759000
         BE    CINBUF              BR IF YES TO PROCESS TEXT            V3760000
         CLI   CRESP,XSTX          IS THIS DATA                         V3761000
         BE    CINBUF              BR IF YES TO PROCESS                 V3762000
         CLI   CRESP,XACK0         IS THIS WRITE ACKNOWLEDGEMENT        V3763000
         BE    CACKED              BR IF YES                            V3764000
         CLI   CRESP,XNAK          WERE WE NAK'ED                       V3765000
         BE    CNAKED              BR IF YES                            V3766000
         B     CRESPBAD            UNKNOWN RESPONSE RECEIVED            V3767000
 TITLE 'C O M S U P  -- CWRTOK   (INITIATE NEXT WRITE)   '              V3768000
*                                                                       V3769000
*              POSITIVE ACKNOWLEDGEMENT OF LAST WRITE RECEIVED          V3770000
*                                                                       V3771000
         SPACE 3                                                        V3772000
CACKED   NULL  *                   ACKNOWLEDGEMENT WAS ACK              V3773000
         NI    $FCSIN,255-X'40'    TURN OFF WAIT-A-BIT                  V3774000
CWRTOK   NULL                                                           V3775000
         TM    BUFSTAT,BUFFAKE     IS THIS A DUMMY BUFFER               V3776000
         BO    CWRTNEXT            BR IF YES                            V3777000
         MVI   BUFSTAT,0           RESET STATUS BYTE                    V3778000
        $FREE  $BUFPOOL,R13,NOENB  RELEASE WRITTEN BUFFER               V3779000
CWRTNEXT NOP   CREXIT              RESTORE INTERUPT REGS             R4 V3780000
         LH    R14,$WAITCON        LOAD DELAYING CONSTANT               V3781000
         AIF   (&MACHINE EQ 20).FRL00                                   V3782000
CSWT1    NOP   *+10                BR. IF INTERVAL TIMER IS OFF         V3783000
         MVC   $TIMER,=A(2*300*X'100')  SET 2 SECOND VALUE              V3784000
.FRL00   ANOP                                                           V3785000
         MVC   CREADCT(2),$TPBFSIZ SET READ COUNT TO FULL            R4 V3786000
CYCLE    NULL  *                   COMMUTATOR CYCLE POINT               V3787000
         TM    $FCSIN,X'40'        IS WAIT-A-BIT SET                    V3788000
         BO    CWAITBIT            BR IF YES                            V3789000
         MVI   $TPPNONE+1,0        RESET BUFFERING STOP                 V3790000
        $DCHAIN $OUTBUF,R13,NOENB  OTHERWISE CHECK WRITE QUEUE          V3791000
         BNZ   CSTNDWRT            BR IF WRITE BUFFER GOTTEN            V3792000
$FCSHOT  NOP   CRESPOND            SW TO FORCE FCS RESPONSE             V3793000
         BAS   R15,CSETCOM         CYCLE COMMUTATOR AGAIN               V3794000
         AIF   (&MACHINE EQ 20).FRL10                                   V3795000
CSWT2    NOP   *+16                BR. IF INTERVAL TIMER IS OFF         V3796000
         TM    $TIMER,X'80'        TEST INTERVAL TIMER                  V3797000
         BZ    CYCLE               BRANCH IF NOT EXPIRED                V3798000
         B     CRESPOND            BRANCH TO WRITE RESPONSE             V3799000
.FRL10   ANOP                                                           V3800000
         AH    R14,=H'-1'          DECREMENT DELAY COUNT                V3801000
         BP    CYCLE               BR IF NOT EXHAUSTED                  V3802000
         B     CRESPOND            DELAY TIME UP...SEND RESPONSE        V3803000
CSTNDWRT NULL  *                   ENTRY FOR BUFFER WRITE WITH BCB      V3804000
         MVC   BUFSTART,XSTXSEQ    SET START OF TEXT HEADER             V3805000
         OI    BUFSTAT,BUFTEXT     SHOW TEXT BUFFER                     V3806000
         MVC   CSETBCB+1(1),CBCBCNTO BCB FOR CURRENT BUFFER             V3807000
         LH    R15,CBCBCNTO-1      GET CURRENT COUNT                    V3808000
         AH    R15,=H'1'           INCREMENT TO NEXT                    V3809000
         STH   R15,CBCBCNTO-1      AND SAVE                             V3810000
         NI    CBCBCNTO,X'80'+15   MODULO 16                            V3811000
         B     CNWRITE             GO WRITE BUFFER                      V3812000
         SPACE 3                                                        V3813000
*                                                                       V3814000
*              WAIT-A-BIT SEQUENCE RECEIVED FROM HASP                   V3815000
*                                                                       V3816000
CWAITBIT NULL  *                   *                                    V3817000
         MVI   $TPPNONE+1,X'F0'    STOP ALL BUFFERING                   V3818000
        $TRACE SSM=NO                                                   V3819000
         B     $FCSHOT             GO IDLE                              V3820000
 TITLE 'C O M S U P  -- CINBUF   (PROCESS INPUT BUFFER FROM HASP)  '    V3821000
         SPACE 3                                                        V3822000
CINBUF   NULL  *                   *                                    V3823000
         AIF   (&MACHINE EQ 20).CCOM20                                  V3824000
         LA    R15,BUFSTART-1      POSITION TO                       R4 V3825000
         AH    R15,$TPBFSIZ         END OF BUFFER                    R4 V3825500
         SH    R15,$CSW+6          REDUCE BY RESIDUAL COUNT             V3826000
         AGO   .CCOMN20            ENTER COMMON CODE                    V3827000
.CCOM20  ANOP                                                           V3828000
         CIO   CALASTPO,CASCA      LAST ADDR USED +1                    V3829000
         LH    R15,CALASTPO        TO REG                               V3830000
         AH    R15,=H'-1'          REDUCE TO LAST ADDR                  V3831000
.CCOMN20 ANOP                                                           V3832000
         CLI   0(R15),XETB         WAS ENDING SEQUENCE CORRECT          V3833000
         BNE   CRESPBAD            BR IF YES TO LOG AND NAK             V3834000
         MVC   $FCSIN,BUFFCS       SET NEW FUNCTION CONTROL             V3835000
*              VERIFY BLOCK CONTROL BYTE COUNT                          V3836000
         MVC   CBCB(1),BUFBCB      GET BCB COUNT                        V3837000
CBCB     EQU   *+1                 COUNT BYTE                           V3838000
         CLI   CBCBCNTI,*-*        DOES RECEIVED MATCH EXPECTED         V3839000
         BNE   CBCBCHEK            BR IF NO                             V3840000
         LH    R15,CBCBCNTI-1      GET CURRENT COUNT                    V3841000
         AH    R15,=H'1'           TO NEXT EXPECTED                     V3842000
         STH   R15,CBCBCNTI-1      AND RESET                            V3843000
         NI    CBCBCNTI,X'80'+15   MOLULO 16                            V3844000
CBCBOK   NULL  *                   ENTRY FROM IGNORE                    V3845000
         TM    BUFSTAT,BUFFAKE     IS THIS DUMMY BUFFER                 V3846000
         BO    CWRTOK              BR IF YES TO IGNORE                  V3847000
CHOMASGN $LA   R14,$TCT1           POINT TO FIRST TCT                   V3848000
         USING TCTDSECT,R14                                             V3849000
COMPTCT  CLC   TCTRCB,BUFDATA      DOES BUFFER AND TCT RCBS MATCH       V3850000
         BE    CASSIGN             IF SO ASSIGN BUFFER                  V3851000
         $LOAD R14,TCTNEXT         GO TO NEXT TCT                       V3852000
         $LTR  R14,R14             TEST FOR END                         V3853000
         BNZ   COMPTCT             COMPARE AGAINST TCT                  V3854000
         AIF   (&HOME NE 0).HOMCTL                                      V3855000
         CLI   BUFDATA,0           ZERO RCB                             V3856000
         BE    CWRTOK              FREE BUFFER                          V3857000
         TM    BUFDATA,15          IS IT A CONTROL RECORD               V3858000
         BNZ   CWRTOK              FREE BUFFER IF NOT                   V3859000
         CLI   BUFDATA+1,C'B'      Q. IF SIGN-OFF RECORD FROM HASP      V3860000
         BNE   CNOTOFF             BR. IF NO                            V3861000
         AIF   (&CONSOLE EQ 0).IOFF01                                   V3862000
         OI    $WOFF+1,X'F0'       SET -DISCONNECTED- SWITCH            V3863000
.IOFF01  AIF   (&MACHINE NE 20).IOFF02                                  V3864000
         CIO   1,CADISABL          TURN OFF BSCA                        V3865000
         AGO   .IOFF03                                                  V3866000
.IOFF02 $SIO   CCWOFF              DISABLE SDA-II                       V3867000
.IOFF03  MVC   $RCOMM1+1(3),=AL3($RCOMM1+4)  DISABLE CARD READER        V3868000
         OI    $COMBUSY+1,X'F0'    SHOW NO T/P ACTIVITY                 V3869000
         OI    CWRTNEXT+1,X'F0'    SET -DISCONNECTED- SWITCH            V3870000
         MVI   BUFDATA,X'91'       MAKE LOOK LIKE WTO FROM HASP         V3871000
         B     CHOMASGN            PLACE BUFFER ON CONSOLE TCT          V3872000
CNOTOFF  NULL  *                                                        V3873000
.HOMCTL  ANOP                                                           V3874000
         $LA   R14,$CTLTCT         POINT TO CONTROL TCT                 V3875000
CASSIGN  $LA   R15,TCTBUFER-TCTDSECT GET BUFFER POINTER OFFSET          V3876000
         AR    R15,R14             POINT TO TCT BUFFER CHAIN            V3877000
         MVI   $TPGETCM+1,X'F0'    OPEN TPGETS GATE                     V3878000
         MVI   BUFSTAT,0           RESET BUFFER STATUS BITS             V3879000
        $CHAIN (R15),R13,NOENB     QUEUE FOR PROCESSING                 V3880000
         $LA   R15,BUFDATA-BUFDSECT GET RCB OFFSET                      V3881000
         STH   R15,BUFCOUNT        SAVE OFFSET TO FIRST RCB             V3882000
         LH    R15,TCTBUFLM        PICK LIMIT AND COUNT                 V3883000
         $AA   R15,1               ADD 1 TO COUNT                       V3884000
         STH   R15,TCTBUFLM        SAVE                                 V3885000
         OI    TCTSTAT,TCTACT      SHOW ACTION REQUIRED ON TCT          V3886000
         AIF   (&HOME EQ 0).HOMASGN                                     V3887000
         $RESTORE R14,R15,CREGS    RESTORE REGS                         V3888000
         BR    R14                 RETURN TO CALLER                     V3889000
.HOMASGN ANOP                                                           V3890000
         CLC   TCTBUFCT,TCTBUFLM   IS BUFFER MAXIMUM EXCEEDED           V3891000
         BL    CASMORE             IF NOT ALLOW MORE                    V3892000
         $BITOFF $FCSOUT,TCTFCS,R15 TURN FCS BIT OFF                    V3893000
         DROP  R14                                                      V3894000
         B     CWRTNEXT            CONTINUE TRANSMISSION                V3895000
CASMORE  MVI   $FCSHOT+1,X'F0'     SHOW FCS ACTIVE                      V3896000
         B     CWRTNEXT            AND CONTINUE XMISSION                V3897000
*                                                                       V3898000
*              RECEIVED BCB CHECK COUNT NOT CORRECT                     V3899000
*                                                                       V3900000
CBCBCHEK NULL  *                   DETERMINE DAMAGE                     V3901000
         TM    CBCB,BCBIGNRE       IS THE IGNORE BIT ON                 V3902000
         BO    CBCBOK              BR IF YES                            V3903000
         TM    CBCB,BCBRESET       IS THIS A RESET REQUEST              V3904000
         BZ    CBCBBAD             BR IF NO                             V3905000
         MVN   CBCBCNTI(1),CBCB    YES... DO IT                         V3906000
         B     CBCBOK              AND PROCESS RECORD                   V3907000
CBCBBAD  NULL  *                   BLOCK COUNTS DO NOT AGREE            V3908000
         MVN   $LOGINFO(1),CBCB    SET FOR ERROR LOG                    V3909000
         MVN   $LOGINFO+1(1),CBCBCNTI SET FOR LOG                       V3910000
        $LOG   XBCBCHEK                                                 V3911000
         MVC   CTEMP+1(1),CBCB     ISOLATE RECEIVED CNT                 V3912000
         LH    R15,CBCBCNTI-1      GET EXPECTED CNT                     V3913000
         SH    R15,CTEMP           LESS RECEIVED                        V3914000
         BP    *+8                 BR IF TOO LOW                        V3915000
         AH    R15,=H'16'          MAKE DIFFERENCE POSITIVE             V3916000
         CH    R15,CMAXDUP         IS DIFFERENCE REASONABLE             V3917000
         BH    CBLKLOST            BR IF NO                             V3918000
         B     CWRTOK              IGNORE BLOCK                         V3919000
         SPACE 2                                                        V3920000
CBLKLOST NULL  *                   ONE OR MORE BLOCKS ARE LOST          V3921000
         MVN   CLOSTBCB,CBCB       SET RECEIVED BLOCK COUNT             V3922000
         MVN   CLSTSRCB,CBCBCNTI   SET EXPECTED BLOCK COUNT             V3923000
         MVC   BUFCOUNT(CLOSTEND-CLOSTBLK),CLOSTBLK  SET BAD BLOCK      V3924000
         MVC   CSETBCB+1(1),CLOSTBCB  SET RESTORE BCB INSTRUCTION       V3925000
         B     CNWRITE             GO TELL HASP ABOUT BAD BCB           V3926000
         SPACE 2                                                        V3927000
*              PROTOTYPE CTL RECORD TO TELL HASP THAT BLOCKS ARE LOST   V3928000
         SPACE 2                                                        V3929000
CLOSTBLK NULL  *                   START                                V3930000
         DC    AL2(CLOSTEND-CLOSTBS) BUFCOUNT                           V3931000
         DC    AL1(BUFTEXT)        BUFSTAT                              V3932000
CLOSTBS  DC    AL1(XLDR,XSTX)      BUFSTART                             V3933000
CLOSTBCB DC    AL1(X'80'+BCBIGNRE) BUFBCB(RECEIVED BLOCK CT ADDED       V3934000
CLOSTFCS DC    AL2(0)              FCS                                  V3935000
         DC    AL1(X'E0')          RCB (CTL REC,TYPE=LOST DATA)         V3936000
CLSTSRCB DC    AL1(X'80')          SRCB(EXPECTED BLK CT ADDED)          V3937000
         DC    AL1(0)              SCB (NULL RECORD)                    V3938000
         DC    AL1(0)              RCB (END OF BLOCK)                   V3939000
CLOSTEND EQU   *                   END OF PROTOTYPE                     V3940000
 TITLE 'C O M S U P  -- COMIDLE   (NO DATA TO SEND TO HASP)  '          V3941000
         SPACE 3                                                        V3942000
CRESPOND NULL  *                   ENTRY TO RESPOND TO HASP             V3943000
         MVI   $FCSHOT+1,0         RESET HOT SWITCH                     V3944000
        $DCHAIN $BUFPOOL,R13,NOENB GET A BUFFER TO USE                  V3945000
         BNZ   CBUFGOTN            BR IF GOTTEN                         V3946000
CSTOPIN  NULL  *                   ENTRY TO STOP ALL INPUT              V3947000
        $LA    R13,CDUMMY          USE DUMMY BUFFER                     V3948000
         MVI   BUFDATA,0           SET NULL BUFFER RCB                  V3949000
         MVI   BUFSTAT,BUFFAKE     FORCE STATUS TO DUMMY                V3950000
         MVC   CREADCT(2),=Y(CDUMCT) SET READ COUNT TO SHORT            V3951000
         B     CSTNDWRT            GO DO NORMAL WRITE                   V3952000
CBUFGOTN NULL  *                                                        V3953000
         MVI   BUFDATA,0           SET NULL BUFFER RCB                  V3954000
         MVC   BUFCOUNT,=AL2(CDUMEND-CDUMSTRT) SET WRITE COUNT          V3955000
         CLC   CFCSOUT,$FCSOUT     HAS FCS BEEN CHANGED                 V3956000
         BNE   CSTNDWRT            BR IF YES TO DO NORMAL WRITE         V3957000
         MVC   BUFSTART,XACKSEQ    SETUP STANDARD SEQUENCE              V3958000
CSENDRES NULL                      *                                    V3959000
         OI    BUFSTAT,BUFRESP     SHOW RESPONSE BUFFER                 V3960000
         B     CNWRITE             AND GO WRITE                         V3961000
CDUMMY   $ACON 0                   NO CHAIN                             V3962000
         DC    AL2(CDUMEND-CDUMSTRT) COUNT                              V3963000
         DC    AL1(BUFFAKE)        BUFSTAT                              V3964000
CDUMSTRT DC    AL1(XLDR,XSTX)      BUFSTART                             V3965000
         DC    AL1(X'80'+BCBIGNRE) BUFBCB                               V3966000
         DC    AL2(0)              FCS                                  V3967000
         DC    AL1(0)              RCB (EOB)                            V3968000
CDUMEND  EQU   *                   END OF DUMMY BUFFER                  V3969000
         AIF   (&MACHINE NE 20).CNOPAD                                  V3970000
         DC    AL2(0)              SPACE FOR ENDING SEQUENCE            V3971000
.CNOPAD  ANOP                                                           V3972000
CDUMCT   EQU   *-CDUMSTRT          MAXIMUM ACCEPTABLE COUNT             V3973000
 TITLE 'C O M S U P  -- CNAKED   (PROCESS ERROR REPLY FROM HASP)  '     V3974000
*                                                                       V3975000
*              A NEGATIVE RESPONSE RECEIVED FROM HASP                   V3976000
*                                                                       V3977000
         SPACE 3                                                        V3978000
CNAKED   NULL  *                   PREPARE TO RETRANSMIT                V3979000
        $LOG   XNAKREC             LOG NEGATIVE REPLY                   V3980000
         TM    BUFSTAT,BUFNAK      WERE WE SENDING A NAK                V3981000
         BO    CNAKNAK             BR IF YES                            V3982000
         MVI   BUFSTART,XLDR       RESET LEADER CHARACTER               V3983000
         TM    BUFSTAT,BUFTEXT     WAS THIS A TEXT BUFFER               V3984000
         BO    CREWRITE            BR IF YES TO RETRY                   V3985000
         MVC   BUFSTART,XACKSEQ    SET RESPONSE LEADER AND ACK      R41 V3986000
         B     CWRTXIO             AND GO WRITE IT                      V3987000
CNAKNAK  NULL                      OUR NAK WAS NAK'ED                   V3988000
         TM    BUFSTAT,BUFTEXT     WAS ORIGINAL BUFFER TEXT...          V3989000
         BZ    CWRTOK              NO...FORGET IT                       V3990000
*                                  YES...PREPARE TO RESEND              V3991000
         MVC   BUFSTART,XSTXSEQ    RESET TEXT LEADERS                   V3992000
         NI    BUFSTAT,255-BUFNAK-BUFRESP RESET STATUS                  V3993000
         B     CNWRITE             WRITE BUFFER AGAIN                   V3994000
         SPACE 5                                                        V3995000
*                                                                       V3996000
*              UNKNOWN RESPONSE FROM HASP... RESEND LAST DATA           V3997000
*                                                                       V3998000
CRESPBAD NULL                                                           V3999000
         MVC   $LOGINFO(2),BUFSTART SHOW BAD RESPONSE                   V4000000
         $LOG  XUNKRES             LOG ERROR                            V4001000
         B     CSENDNAK            GO REPLY NAK                         V4002000
         SPACE 3                                                        V4003000
*                                                                       V4004000
*              SEND A NEGATIVE RESPONSE TO HASP                         V4005000
*                                                                       V4006000
CSENDNAK NULL  *                   ENTRY                                V4007000
         MVC   BUFSTART,XNAKSEQ    SET NAK SEQUENCE                     V4008000
         OI    BUFSTAT,BUFRESP+BUFNAK SHOW NAK RESPONSE                 V4009000
         B     CNWRITE             AND GO WRITE IT                      V4010000
 TITLE 'C O M S U P  -- CSETCOM  (COMMUTATOR LINKAGE CONTROL)  '        V4011000
*                                                                       V4012000
*              COMSUP IS EXITING WITHOUT I/O ACTIVE                     V4013000
*              PREPARE FOR RE-ENTRY THROUGH COMUTATOR                   V4014000
*                                                                       V4015000
         SPACE 3                                                        V4016000
CSETCOM  NULL  *                   *                                    V4017000
         MVI   $COMCOM+1,X'F0'     OPEN GATE                            V4018000
         MVI   $COMBUSY+1,X'F0'    SHOW NO ACTIVITY                     V4019000
        $SAVE  R13,R15,CRETREGS    SAVE SOME REGISTERS                  V4020000
         B     CREXIT              AND RETURN TO INTERRUPTED LOC        V4021000
$COMSUP  NULL                                                           V4022000
        $SSM   0                   DISABLE                              V4023000
         MVI   $COMCOM+1,0         CLOSE COMUTATOR ENTRY                V4024000
        $RESTORE R13,R15,CRETREGS  RESTORE                              V4025000
         AIF   (&MACHINE NE 20).CA                                      V4026000
         MVC   146(2),=Y($COMCOM+4) SET EXIT TO COMUTATOR               V4027000
         AGO   .CB                                                      V4028000
.CA      ANOP                                                           V4029000
         MVC   $IOOLD+5(3),=AL3($COMCOM+4) SET EXIT TO COMUTATOR        V4030000
.CB      ANOP                                                           V4031000
         MVI   $COMBUSY+1,0        ALLOW COMMUNICATIONS INTERRUPTS      V4032000
         BR    R15                 RE-ENTER COMSUP                      V4033000
CRETREGS $WCON (0,0,0)             REGISTER SAVE                        V4034000
 TITLE 'C O M S U P  -- CNWRITE  (COMMUNICATIONS WRITE SUBROUTINE)  '   V4035000
         SPACE 3                                                        V4036000
CNWRITE  NULL                                                           V4037000
         AIF   (&MACHINE NE 20).X4                                      V4038000
         LH    R15,=Y(BUFSTART-BUFDSECT) DATA DISPLACEMENT              V4039000
         AR    R15,R13             R15 = BEGINNING OF DATA              V4040000
         STH   R15,CRDRESP+2       SET RETURN READ                      V4041000
         STH   R15,COMWRITE+2      SET WRITE ADDR                       V4042000
         TM    BUFSTAT,BUFRESP     IS THIS A RESPONSE SEQUENCE...       V4043000
         BZ    CSETEND             BR IF NO                             V4044000
         MVC   COMWRITE+4(2),=H'2' YES...SET RESPONSE COUNT             V4045000
         B     CWRTXIO             AND WRITE IT                         V4046000
CSETEND  NULL  *                   ADD BSC ENDING SEQUENCE              V4047000
         LH    R15,BUFCOUNT        DATA COUNT                           V4048000
         AH    R15,=H'11'          FIX FOR XPARENCY                     V4049000
         STH   R15,COMWRITE+4      SET COUNT                            V4050000
         AR    R15,R13             INCLUDE BUFFER                       V4051000
         AH    R15,=Y(BUFSTART-BUFDSECT) ADJUST FOR HEADING             V4052000
         SH    R15,=H'11'          AVOIDS ASSEMBLER ERROR               V4053000
         MVC   0(2,R15),XETBSEQ    SET ENDING                           V4054000
CREWRITE NULL  *                   RE-WRITE TEXT ENTRY                  V4055000
         TM    BUFSTAT,BUFRESP     IS THIS A RESPONSE                   V4056000
         BO    CWRTXIO             BR IF YES TO SKIP FCS SET            V4057000
         MVC   BUFFCS,$FCSOUT      SET CURRENT FCS                      V4058000
         MVC   CFCSOUT,$FCSOUT     SAVE LAST FCS SENT                   V4059000
CSETBCB  MVI   BUFBCB,*-*          SET BCB INTO BUFFER                  V4060000
         MVC   COLDRCB+1(1),BUFDATA SAVE RCB                            V4061000
         TM    BUFSTAT,BUFFAKE     IS THIS A DUMMY BUFFER               V4062000
         BZ    *+8                 BR IF NO                             V4063000
         OI    BUFFCS,X'40'        YES...SET WAIT-A-BIT                 V4064000
CWRTXIO  NULL  *                   WRITE BUFFER                         V4065000
         MVI   CREADREQ+1,0        SHOW READ REQUIRED                   V4066000
         STH   R13,CBUFFER         SET BUFFER ADDR                      V4067000
         B     CNWLOG              NOP THIS TO LOG EVERY WRITE          V4068000
         MVC   $LOGINFO(3),BUFSTART+1 SET LOG INFO                      V4069000
         $LOG  XTPWRITE            AND DO IT                            V4070000
CNWLOG   NULL  *                   WRITE LOG BYPASS                     V4071000
         AIF   (&TRACE EQ 0 OR &MACHINE NE 20).TRX                      V4072000
        $RESTORE R12,R15,CREGS     RESTORE BEFORE I/O IN CASE 40KB      V4073000
         AGO   .TRZ                                                     V4074000
.TRX     ANOP                                                           V4075000
        $RESTORE R13,R15,CREGS     RESTORE BEFORE I/O IN CASE 40KB      V4076000
.TRZ     ANOP                                                           V4077000
         MVI   $COMBUSY+1,0        SHOW ACTIVITY                        V4078000
         AIF   (&MACHINE NE 20 OR &LINESPD LT 19200).CL                 V4079000
         AIF   (&SUBMOD GE 5).CL                                        V4080000
         TIOB  *,PBUSY             WAIT ON PRINTER CARRIAGE CYCLE       V4081000
.CL      ANOP                                                           V4082000
COMWRITE XIO   *-*(CAWRITE),0      ISSUE WRITE                          V4083000
         BC    7,*-6               WAIT UNTIL ACCEPTED                  V4084000
         SPSW  144                 EXIT (QUICKLY)                       V4085000
         AGO   .X5                                                      V4086000
.X4      ANOP                                                           V4087000
         LA    R15,BUFSTART        TO XMISSION POINT                    V4088000
         ST    R15,CCWA            INTO CCW                             V4089000
         MVI   CCWA,1              RESET OP                             V4090000
         ST    R15,CCWC            SET RETURN DATA ADDR                 V4091000
         MVI   CCWC,2              RESET OP                             V4092000
         MVC   CCWA+6(2),BUFCOUNT  SET WRITE COUNT                      V4093000
         MVI   CCWA+4,XCHN         SET PROPER CCW CHAINING              V4094000
         $STO  R13,CBUFFER         SAVE BUFFER ADDR                     V4095000
         MVI   CCWB,1              RESET OP FOR ENDING SEQ              V4096000
         TM    BUFSTAT,BUFRESP     IS THIS JUST A RESPONSE              V4097000
         BZ    CREWRITE            BR IF NO                             V4098000
         MVI   CCWA+4,X'60'        SET COMMAND CHAINING                 V4099000
         MVC   CCWA+6(3),=X'000203' SET COUNT AND 2ND CCW OP            V4100000
         B     CWRTSIO             GO START WRITE                       V4101000
CREWRITE NULL  *                   ENTRY TO RETRY WRITE                 V4102000
         MVC   CFCSOUT,$FCSOUT     SAVE LAST FCS SENT                   V4103000
         MVC   BUFFCS,$FCSOUT      SET CURRENT FCS                      V4104000
CSETBCB  MVI   BUFBCB,*-*          SET BCB INTO BUFFER                  V4105000
         MVC   COLDRCB+1(1),BUFDATA SAVE RCB                            V4106000
         TM    BUFSTAT,BUFFAKE     IS THIS A DUMMY BUFFER               V4107000
         BZ    *+8                 BR IF NO                             V4108000
         OI    BUFFCS,X'40'        YES...SET WAIT-A-BIT                 V4109000
CWRTXIO  NULL  *                   START THE WRITE                      V4110000
CWRTSIO  MVI   CUWFAKE+1,X'00'     MAKE SURE DUMMY READ NOT ON          V4111000
         SPACE 3                                                        V4112000
         B     CNWLOG              NOP THIS TO LOG ALL WRITES           V4113000
         MVC   $LOGINFO(3),BUFSTART+1  SET LOG DATA                     V4114000
        $LOG   XTPWRITE            AND DO IT                            V4115000
CNWLOG   NULL  *                   WRITE LOG BYPASS                     V4116000
        $SIO   CCWA                START I/O                            V4117000
         SPACE 3                                                        V4118000
*                                                                       V4119000
*              INTERRUPT EXIT ROUTINE                                   V4120000
*                                                                       V4121000
         SPACE 3                                                        V4122000
CREXIT   NULL                                                           V4123000
        $RESTORE R13,R15,CREGS     RESTORE INTERRUPTED REGS             V4124000
CEXIT    NULL                                                           V4125000
         LPSW  $IOOLD                                                   V4126000
.X5      ANOP                                                           V4127000
 TITLE 'C O M S U P  -- CERROR   (COMMUNICATIONS ERROR PROCESSOR)  '    V4128000
*                                                                       V4129000
*                                                                       V4130000
*                                                                       V4131000
         SPACE 3                                                        V4132000
CERROR   NULL  *                                                        V4133000
         AIF   (&MACHINE NE 20).X10                                     V4134000
         AIF   (&TRACE EQ 0 OR &MACHINE NE 20).ITRE                     V4135000
        $SAVE  R12,R15,CREGS       SAVE INTERRUPTED REGS                V4136000
         $LOAD R12,=Y($SVC)        SET TRACE ENTRY                      V4137000
         AGO   .ITRF                                                    V4138000
.ITRE    ANOP                                                           V4139000
        $SAVE  R13,R15,CREGS       SAVE INTERRUPTED REGS                V4140000
.ITRF    ANOP                                                           V4141000
        $LOAD  R13,CBUFFER         GET CURRENT BUFFER                   V4142000
         CIO   CENSE,CASENSE       STORE SENSE BYTES                    V4143000
CENSE    EQU   *+1                                                      V4144000
         MVI   $LOGINFO,*-*        SET FOR LOG PROCESSING               V4145000
         $LOG  XUNITCHK            LOG ERROR                            V4146000
         CLI   CENSE,X'7F'         TEST I/O TYPE (CLI FASTER)           V4147000
         BNH   CREWRITE            BR IF WRITE TO RE-TRY                V4148000
*              PROCESS READ ERROR                                       V4149000
COLDRCB  CLI   BUFDATA,*-*         CHECK VALIDITY OF DATA (RCB)         V4150000
         BE    *+8                 BR. IF MATCH                         V4151000
         NI    BUFSTAT,255-BUFTEXT OTHERWISE FORGET TEXT                V4152000
         TM    CENSE,B'00010000'   Q. IF TIMEOUT PROBLEM                V4153000
         BNO   CSENDNAK            GO TO NAK HASP IF NOT            N30 V4154000
         TM    CENSE,B'00011000'   Q. IF LOST DATA W/ TIMEOUT      @N30 V4154100
         BO    CSENDNAK            GO NAK HASP IF YES              @N30 V4154200
        $RESTORE R13,R15,CREGS     RESTORE INTERUPTED REGS           R4 V4154500
         B     CRDRESP             THEN BR. TO REINSTATE READ        R4 V4155000
         AGO   .X12                                                     V4156000
.X10     ANOP                                                           V4157000
         MVC   CCSW,$CSW           PRESERVE CSW AROUND SENSE AND LOG    V4158000
         TM    $CSW+4,2            TEST UNIT CHECK                      V4159000
         BO    CUNITCHK            BR IF YES                            V4160000
         TM    $CSW+4,1            TEST UNIT EXCEPTION                  V4161000
         BO    CUNITEXC            BR IF YES                            V4162000
CBADERR  NULL  *                   ENTRY FOR UNUSUAL ERROR              V4163000
         MVC   $LOGINFO(2),$CSW+4  SET INFO BYTES                       V4164000
        $LOG   XUNSLERR            LOG ERROR                            V4165000
         B     CHECKCCW            GO DETERMINE I/O TYPE                V4166000
CUNITCHK NULL  *                   ENTRY FOR UNIT CHECK                 V4167000
        $SIO   CCWSENS             STORE SENSE BYTE                     V4168000
         LA    R15,CENSEWAT        LOCATE INTERRUPT POINT               V4169000
         ST    R15,$IONEW+4        SET NEW PSW TO SENSE WAIT            V4170000
         LM    R14,R15,$IOOLD      SAVE ORIGINAL PSW                    V4171000
         SSM   =X'FF'              ENABLE FOR INTERRUPT                 V4172000
         B     *                   WAIT FOR COMPLETION OF SENSE         V4173000
CENSEWAT CLC   $IOOLD+2(2),=AL2($ADAPTER)  IS IT SDA                    V4174000
         BNE   $NOTTP              BRANCH IF NOT                        V4175000
         STM   R14,R15,$IOOLD      RESTORE ORIGINAL PSW                 V4176000
         LA    R15,$IOINT          LOCATE NORMAL ENTRY                  V4177000
         ST    R15,$IONEW+4        SET INTERRUPT ADDRESS                V4178000
CENSE    EQU   *+1                                                      V4179000
         MVI   $LOGINFO,*-*        SET FOR LOG PROCESSING               V4180000
        $LOG   XUNITCHK            LOG ERROR                            V4181000
CHECKCCW LA    R14,CREWRITE                                             V4182000
         L     R15,CCSW            GET COMMAND ADDR                     V4183000
         LTR   R15,R15             IS IT ZERO...                        V4184000
         BCR   8,R14               BR IF YES TO TRY REWRITE             V4185000
         TM    CCSW+5,4            TEST CHANNEL CONTROL CHECK           V4186000
         BCR   1,R14               YES... GUESS AT REWRITE              V4187000
         S     R15,=F'8'           OTHERWISE BACK UP TO FAILED CC       V4188000
         CLI   0(R15),1            WAS IT A WRITE                       V4189000
         BCR   8,R14               BR IF YES TO RETRY IT                V4190000
COLDRCB  CLI   BUFDATA,*-*         CHECK VALIDITY OF DATA (RCB)         V4191000
         BE    *+8                 BR. IF MATCH                         V4192000
         NI    BUFSTAT,255-BUFTEXT OTHERWISE FORGET TEXT                V4193000
         TM    CENSE,B'00000001'   Q. IF TIMEOUT PROBLEM                V4194000
         BZ    CSENDNAK            BR. IF NO - SEND A NAK TO HASP       V4195000
         SPACE 3                                                        V4196000
         B     CNRLOG              NOP THIS TO LOG ALL READS            V4197000
         SPACE 3                                                        V4198000
         MVC   $LOGINFO(3),BUFSTART+1  SET LOG DATA                     V4199000
        $LOG   XTPREAD             LOG READ REQUEST                     V4200000
CNRLOG   NULL  *                                                        V4201000
        $SIO   CCWC                REINSTATE READ COMMAND               V4202000
         B     CREXIT              BR. TO RETURN FROM INTERRUPT         V4203000
         DS    0F                  FORCE FULL-WORD ALIGNMENT            V4204000
CCSW     DC    XL8'00'             TEMPORARY STORAGE FOR CSW            V4205000
         SPACE 5                                                        V4206000
*                                                                       V4207000
*              UNIT EXCEPTION SET                                       V4208000
*                                                                       V4209000
         SPACE 3                                                        V4210000
CUNITEXC NULL                                                           V4211000
         L     R15,$CSW            GET CSW ADDR                         V4212000
         S     R15,=F'8'           BACK UP TO CMD IN ERROR              V4213000
         MVC   CUNITCMD(1),0(R15)  SAVE COMMAND CODE                    V4214000
CUNITCMD EQU   *+1                 COMMAND CODE STORAGE                 V4215000
         MVI   $LOGINFO,*-*        SHOW COMMAND TYPE                    V4216000
         MVC   $LOGINFO+1(2),BUFSTART LOG BUFFER LEADERS                V4217000
        $LOG   XUNITEXP            LOG ERROR                            V4218000
         CLI   CUNITCMD,1          WAS THIS A WRITE...                  V4219000
         BNE   CSENDNAK            BR IF NO TO FORCE RESEND (EOT REC)   V4220000
         MVI   CUWFAKE+1,X'F0'     SET SWITCH TO IGNORE ERROR           V4221000
        $SIO   CCWD                START READ                           V4222000
         B     CREXIT              AND EXIT TO AWAIT INT                V4223000
 TITLE 'C O M S U P  -- $SIO     (START I/O SUBROUTINE FOR SDA-II) '    V4224000
$SIO     NULL                                                           V4225000
         MVC   $CAW(4),0(R15)      SET CCW ADDR.                        V4226000
         MVC   CLASTCAW,0(R15)     SAVE                                 V4227000
        $TRACE SSM=NO                                                   V4228000
CSIOAGIN SIO   $ADAPTER            DO IT                                V4229000
         BC    8,4(R15)            RETURN IF ACCEPTED                   V4230000
         ST    R15,CSIOSAV         SAVE                                 V4231000
         BALR  R15,0               GET CURRENT PSW                      V4232000
         SRL   R15,28              ADJUST CONDITION CODE                V4233000
         STC   R15,$LOGINFO        AND SET FOR LOG                      V4234000
         MVC   $LOGINFO+1(2),$CSW+4 LOG CSW ALSO                        V4235000
        $LOG   XSIOBAD             AND LOG IT                           V4236000
         L     R15,CSIOSAV         RESTORE                              V4237000
         B     CSIOAGIN            AND TRY AGAIN                        V4238000
CSIOSAV  DC    F'0'                LINK SAVE                            V4239000
CLASTCAW DC    F'0'                CCW ADDR SAVE                        V4240000
.X12     ANOP                                                           V4241000
 TITLE 'C O M S U P  -- INTERRUPT PROCESSOR (STORAGE)      '            V4242000
         SPACE  5                                                       V4243000
CBUFFER $ACON  0                   ACTIVE COMUNICATIONS BUFFER          V4244000
$BUFFER  EQU   CBUFFER             EXTERNAL REFERENCE NAME              V4245000
CFCSOUT  DC    H'0'                LAST FCS TRANSMITTED TO HASP         V4246000
CTEMP    DC    H'0'                TEMPORARY STORAGE                    V4247000
CMAXDUP  DC    H'3'                MAX REPEATED BLOCKS                  V4248000
         DC    AL1(0)              FIRST BYTE OF HALF-WORD              V4249000
CBCBCNTO DC    AL1(X'80')          BLOCK CHECK COUNT OUT                V4250000
         DC    AL1(0)              SPACER                               V4251000
CBCBCNTI DC    AL1(X'80')          BLOCK COUNT CHARACTER EXPECTED       V4252000
         DC    H'0'                *                                    V4253000
$INQCNT  EQU   *-1                 COUNT OF QUEUED INPUT BUFFERS        V4254000
CRESP    DC    AL1(0)              RESPONSE CHARACTER RECEIVED          V4255000
         AIF   (&TRACE EQ 0 OR &MACHINE NE 20).TRG                      V4256000
CREGS    $WCON (0,0,0,0)           REGISTER SAVE AREA                   V4257000
         AGO   .TRH                                                     V4258000
.TRG     ANOP                                                           V4259000
CREGS    $WCON (0,0,0)             REGISTER SAVE AREA                   V4260000
CTPREGS  $WCON (0,0)               $EXTP SAVE AREA             @OZ27704 V4260500
.TRH     ANOP                                                           V4261000
CALASTPO DC    H'0'                LAST ADDR STORAGE                    V4262000
         SPACE 5                                                        V4263000
*                        CONTROL SEQUENCES                              V4264000
XSTXSEQ  DC    AL1(XLDR,XSTX)      START-OF-TEXT SEQUENCE               V4265000
XETBSEQ  DC    AL1(XTRL,XETB)      END-OF-TEXT-BLOCK SEQUENCE           V4266000
XACKSEQ  DC    AL1(XDLE,XACK0)     POSITIVE ACKNOWLEDGEMENT SEQUENCE    V4267000
XNAKSEQ  DC    AL1(XSYN,XNAK)      NEGATIVE ACKNOWLEDGEMENT SEQUENCE    V4268000
         AIF   (&MACHINE EQ 20).S1                                      V4269000
         SPACE 5                                                        V4270000
*                        CHANNEL CONTROL WORDS                          V4271000
         SPACE 2                                                        V4272000
*                   NORMAL DATA WRITE WITH RETURN DATA READ             V4273000
         SPACE 1                                                        V4274000
CCWA    $CCW   1,*-*,60,*-*        WRITE BUFFER                         V4275000
COMWRITE EQU   CCWA                FOR DEBUGGING AID PAGE               V4276000
CCWB    $CCW   1,XETBSEQ,60,2      WRITE ENDING SEQUENCE                V4277000
CCWC    $CCW   2,*-*,20,&TPBFSIZ   READ RETURN DATA                     V4278000
CREADCT  EQU   *-2                 READ COUNT FIELD                     V4279000
         SPACE 3                                                        V4280000
*                   DUMMY READ TO TURN OFF LOST DATA SENSE              V4281000
         SPACE 1                                                        V4282000
CCWD    $CCW   2,*,30,65000        NON-READ A BUNCH                     V4283000
         SPACE 3                                                        V4284000
*                   SDA-II SENSE COMMAND                                V4285000
         SPACE 1                                                        V4286000
CCWSENS $CCW   4,CENSE,20,1        SENSE                                V4287000
         SPACE 3                                                        V4288000
*                   SDA-II DISABLE COMMAND                              V4289000
         SPACE 1                                                        V4290000
CCWOFF  $CCW   X'2F',0,20,1        DISABLE                              V4291000
.S1      ANOP                                                           V4292000
         DROP  R13                 KILL BUFFER ADDRESSABILITY           V4293000
         AIF   (&MACHINE EQ 20).YOSKP1                                  V4294000
 TITLE '$ X I O  -- UNIT RECORD I/O SUPERVISOR'                         V4295000
*                                                                       V4296000
*        BASE REGISTER ASIGNMENT                                        V4297000
*                                                                       V4298000
         USING TANKDSEC,R8                                              V4299000
         USING TCTDSECT,TCTR                                            V4300000
         SPACE 3                                                        V4301000
&A       SETA  0                                                        V4302000
*                                                                       V4303000
*        ENTRY TO INITIATE I/O ON UNIT RECORD DEVICES                   V4304000
*              TCTR POINTS TO THE DEVICE TCT REG R14 POINTS TO USER     V4305000
*                                                                       V4306000
$XIO     NULL                                                           V4307000
         MVC   TCTCCW,TCTOPCOD     SET NORMAL OP-CODE FROM SAVE         V4308000
$XIOA    $STO  R14,TCTSAV1         SAVE RETURN ADDRESS                  V4309000
         $DELAY Y,T,TYPE=SETUP     PREPARE TO DELAY/WAIT,SET REENTRY    V4310000
         SSM   *+1                 DISABLE INTERRUPTS                   V4311000
         TM    TCTECB,TCTBUSY      IS DEVICE BUSY                       V4312000
         BO    YOCLOSE             HANG IN A LOOP AND WAIT FOR DEV END  V4313000
         MVI   TCTECB,TCTBUSY      SET ECB FOR START I/O                V4314000
         MVI   TCTSENSE,0          ZERO OUT SENSE BYTE                  V4315000
         LA    R8,TCTCCW           PICK UP CCW ADDR                     V4316000
         ST    R8,CAW              PUT IN CAW                           V4317000
YBUSY    LH    R14,TCTUCB          LOAD UP THE DEVICE ADDRESS        R4 V4318000
         SIO   0(R14)              START I/O                            V4319000
         $LOAD R14,TCTSAV1         PREPARE FOR RETURN TO USER           V4320000
         BC    8,YOENBL            I/O WENT OK GO TO USER               V4321000
         BC    4,YOCSWSTO          CSW STORED                           V4322000
         BC    2,YBUSY             ISSUE SIO AGAIN IF BUSY           R4 V4322100
YOCLOSE  $LOAD R14,TCTCOM          CLOSE COMMUTATOR                     V4323000
         NI    1(R14),X'0F'        CHANGE BR TO NOP                     V4324000
*              IF DEVICE BUSY DEVICE END INTERRUPT WILL CLEAR           V4325000
*              IF DEVICE NOT  READY DEVICE END WILL CLEAR               V4326000
YOENBL   SSM   =X'FF'              ALLOW INTERRUPTS                     V4327000
         BR    R14                 RETURN TO CALLER                     V4328000
YOEOF    MVI   TCTECB,DEVEOF       SIGNAL END OF FILE                   V4329000
         B     YOENBL              RETURN TO USER                       V4330000
YOCSWSTO TM    CSW+5,X'FF'         ANY SERIOUS PROBLEMS                 V4331000
         BNZ   YONOSTRT            SET I/O NOT STARTED PSW              V4332000
         CLI   CSW+4,DEVEOF        TEST FOR END OF FILE ONLY            V4333000
         BE    YOEOF               RETURN TO USER                       V4334000
         TM    CSW+4,DEVUCK+DEVATN+DEVMOD TEST FOR NO START CONDITIONS  V4335000
         BNZ   YONOSTRT            SET I/O NOT STARTED PSW              V4336000
YOSETPSW STH   R14,IOOLDPSW+6      SET TO RETURN TO USER I/O STARTED    V4337000
         LR    R15,TCTR            SET INTERRUPT TCT REG                V4338000
         B     YODEVFND            PROCESS AS INTERRUPT                 V4339000
YONOSTRT LA    R14,TCTRTN          PICK RETURN TO COMMUTATOR            V4340000
         B     YOSETPSW            SET PSW TO LOOP BACK TO SIO          V4341000
*                                                                       V4342000
*        $IOCK                     ENTRY POINT TO PASS TO USER CODES    V4343000
*                                                                       V4344000
$IOCK    $STO  R14,TCTSAV1         SAVE USER RETURN ADDRESS             V4345000
         $DELAY Y,T,TYPE=SETUP     GET READY FOR DELAY                  V4346000
         SSM   *+1                 DISABLE I/O INTERRUPTS               V4347000
         TM    TCTECB,TCTBUSY      TEST FOR BUSY                        V4348000
         BNZ   YOCLOSE             WAIT FOR INTERRUPT                   V4349000
         IC    R14,TCTECB          PICK UP I/O COMPLETION               V4350000
         SLL   R14,4               ALIGN UNIT CHECK AND UNIT EXECPTION  V4351000
         STC   R14,YOPSW+4         SET COMPLETION CODES                 V4352000
         LPSW  YOPSW               LOAD PSW                             V4353000
YOCKRET  $LOAD R14,TCTSAV1         PICK UP USER ADDRESS                 V4354000
         BR    R14                 RETURN                               V4355000
         $ENDPROC Y                END OF SIO IOCK USER INTERFACE       V4356000
         DROP  TCTR                                                     V4357000
         USING TCTDSECT,R15                                             V4358000
 TITLE '$ N O T T P  -- UNIT RECORD INTERRUPT HANDLER'                  V4359000
$NOTTP   STM   R13,R15,YOREGSAV    SAVE REGS USED                       V4360000
         LA    R15,$TCT1           PICK UP START OF TCT CHAIN           V4361000
         LH    R14,IOOLDPSW+2      DEVICE ADDRESS                       V4362000
YOTCTLOP CH    R14,TCTUCB          CHECK FOR MATCH                      V4363000
         BE    YODEVFND            EXAMINE THE INTERRUPT                V4364000
         $LOAD R15,TCTNEXT         PICK UP NEXT TCT                     V4365000
         LTR   R15,R15             TEST FOR END OF CHAIN                V4366000
         BNZ   YOTCTLOP            LOOP BACK TO TEST DEV ADDR           V4367000
YORTN    LM    R13,R15,YOREGSAV    RESTORE USER REGS                    V4368000
YOLPSW   LPSW  IOOLDPSW            RETURN                               V4369000
YODEVFND TM    CSW+4,DEVEND        DO WE HAVE DEVICE END                V4370000
         BZ    YOCKLOG             IF NOT SKIP RESET BUSY               V4371000
         $LOAD R13,TCTCOM          GET COMMUTATOR                       V4372000
         OI    1(R13),X'F0'        OPEN GATE                            V4373000
         NI    TCTECB,255-TCTBUSY  RESET BUSY                           V4374000
YOCKLOG  OC    TCTECB,CSW+4        SET ECB WITH STATUS                  V4375000
         TM    CSW+5,X'FF'         TEST ANY LOGABLE ERRORS              V4376000
         BNZ   YOLOG               IF SO LOG THEM                       V4377000
         TM    CSW+4,DEVUCK        TEST FOR UNIT CHECK                  V4378000
         BO    YOSENSE             IF SO SENSE AND LOG                  V4379000
         TM    CSW+4,DEVATN        TEST FOR ATTENTION                   V4380000
         BZ    YORTN               RETURN IF NO                         V4381000
         OI    TCTSTAT,TCTREQ      TURN ON REQUEST FLAG                 V4382000
         $LOAD R13,TCTCOM          GET COMMUTATOR ENTRY                 V4383000
         OI    1(R13),X'F0'        OPEN GATE                            V4384000
         B     YORTN               RETURN                               V4385000
YOSENSE  MVC   CAW(4),=A(YOSENCCW) SET UP FOR SENSE                     V4386000
         LH    R14,TCTUCB          PICK UP DEVICE ADDR                  V4387000
YOSSIO   SIO   0(R14)              SENSE INTO LOG AREA                  V4388000
         BC    2,YOSSIO            TRY AGAIN IF BUSY                    V4389000
YOTEST   TIO   0(R14)              TEST I/O                             V4390000
         BC    2,YOTEST            WAIT UNTIL FINISHED                  V4391000
         MVC   TCTSENSE(1),$LOGINFO SAVE SENSE INFO                     V4392000
         MVC   $LOGINFO+1(2),TCTUCB MOVE IN DEVICE ADDR                 V4393000
         $LOG  XUNITCHK,SAVE       LOG UNIT CHECK                       V4394000
         B     YORTN               RETURN                               V4395000
YOLOG    MVC   $LOGINFO(1),CSW+5   PREPARE LOG INFO                     V4396000
         MVC   $LOGINFO+1(2),TCTUCB MOVE IN DEVICE ADDR                 V4397000
        $LOG   XUNSLERR,SAVE       LOG ERROR                            V4398000
         B     YORTN               RETURN                               V4399000
*                                                                       V4400000
*        UNIT RECORD I/O SUPERVISOR EQUATES                             V4401000
*                                                                       V4402000
DEVEOF   EQU   X'01'               UNIT EXCEPTION                       V4403000
DEVUCK   EQU   X'02'               UNIT CHECK                           V4404000
DEVATN   EQU   X'80'               ATTENTION                            V4405000
DEVMOD   EQU   X'40'               STATUS MODIFIER                      V4406000
DEVEND   EQU   X'04'               DEVICE END                           V4407000
YOREGSAV DC    3F'0'               INTERRUPT REG SAVE AREA              V4408000
YOSENCCW DS    0D                                                       V4409000
CAW      EQU   X'48'               LOCATION OF CHANNEL ADDRESS WORD     V4410000
CSW      EQU   X'40'               LOCATION OF CHANNEL STATUS WORD      V4411000
IOOLDPSW EQU   X'38'               LOCATION OF I/O OLD PSW              V4412000
         DC    X'04',AL3($LOGINFO),X'20',AL3(1) SENSE CCW               V4413000
YOPSW    DC    X'FF',X'04',AL2(0),AL1(0),AL3(YOCKRET)                   V4414000
         AGO   .YOSKP3                                                  V4415000
.YOSKP1  ANOP                                                           V4416000
 TITLE '$ N O T T P  --  UNIT RECORD INTERRUPT HANDLER'                 V4417000
         AIF   (&CONSOLE EQ 0).YOSKP2                                   V4418000
$NOTTP   NULL  ,                   INTERRUPT ENTRY POINT                V4419000
         CLI   145,WREQ            TEST FOR INQUIRY REQUEST             V4420000
         BNE   YORET               IF NOT IGNORE INTERRUPT              V4421000
         OI    WCTSTAT,TCTREQ      TURN ON REQUEST FLAG                 V4422000
         OI    $WCOMM1+1,X'F0'     OPEN GATE TO CONSOLE                 V4423000
YORET    SPSW  144                 RETURN TO INTERRUPTED LOCATION       V4424000
         AGO   .YOSKP3                                                  V4425000
.YOSKP2  ANOP                                                           V4426000
$NOTTP   NULL                                                           V4427000
YORET    SPSW  144                 RETURN TO INTERRUPTED LOCATION       V4428000
         AIF   (&R(2)).YOSKP3                                           V4429000
*                                                                       V4430000
*        $DIAL                     READS DIALS AND CHECKS FOR CHANGE    V4431000
*                                                                       V4432000
*                                  DESTROYS ALL REGISTERS               V4433000
*                                                                       V4434000
$DIAL    NULL                                                           V4435000
         LH    R8,0(0,R14)         PICK LOCATION TO STORE REQUEST       V4436000
         STH   R14,0(0,R8)         STORE REQUESTORS RETURN LOCATION     V4437000
         $SSM  0                   DISABLE INTERRUPTS                   V4438000
         MVC   YODSAV,252          SAVE THE READ IN AREA                V4439000
         DIALS ,                   READ THE DIALS                       V4440000
         MVC   YODIALS,252         MOVE REQUIRED DIAL INFO TO WORK      V4441000
         MVC   252(3),YODSAV       RESTORE READ IN LOCATIONS            V4442000
         MVC   YODIAL2+1(1),YODIALS SEPARATE DATA DIALS                 V4443000
         $SSM  X'FF'               ENABLE INTERRUPTS                    V4444000
         NI    YODIALS,X'10'       MASK OUT DIAL 2 PLUS HIGH 3 BITS     V4445000
         CLC   YODOLD,YODIALS      COMPARE FOR CHANGE IN DATA 1         V4446000
         BE    2(0,R14)            IF NO CHANGE RETURN TO USER          V4447000
         MVC   YODOLD,YODIALS      SET DATA 1 FOR FUTURE READS          V4448000
         NI    YODIAL2+1,X'0F'     MASK OUT DIAL 1                      V4449000
         LH    R8,YODIAL2          PICK UP DATA DIAL 2                  V4450000
         AR    R8,R8               DOUBLE IT                            V4451000
         AH    R8,=Y(YODTAB)       LOCATE REQUEST ENTRY                 V4452000
         LH    R15,0(0,R8)         PICK RESPONSE RETURN POINT           V4453000
         LH    R9,=Y(YODNULL)      PICK UP ADDR OF NULL RTN             V4454000
         STH   R9,0(0,R8)          PUT IT IN RESPONSE TABLE             V4455000
         B     6(0,R15)            RETURN WITH POSITIVE ANSWER          V4456000
$DIALTAB DS    0H                  DIAL RESPONSE TABLE POINTERS         V4457000
YODTAB   DC    Y(YODNULL)          0    DIAL OFFSET TABLE               V4458000
         DC    Y(YODNULL)          1                                    V4459000
         DC    Y(YODNULL)          2                                    V4460000
         DC    Y(YODNULL)          3                                    V4461000
         DC    Y(YODNULL)          4                                    V4462000
         DC    Y(YODNULL)          5                                    V4463000
         DC    Y(YODNULL)          6                                    V4464000
         DC    Y(YODNULL)          7                                    V4465000
         DC    Y(YODNULL)          8                                    V4466000
         DC    Y(YODNULL)          9                                    V4467000
         DC    Y(YODNULL)          A                                    V4468000
         DC    Y(YODNULL)          B                                    V4469000
         DC    Y(YODNULL)          C                                    V4470000
YODNULL  DS    0H                  NULL ROUTINE OFFSET BY -6            V4471000
         DC    Y(YODNULL)          D                                    V4472000
         DC    Y(YODNULL)          E                                    V4473000
         DC    Y(YODNULL)          F                                    V4474000
         B     2(0,R14)            NULL RTN, RETURN TO USER             V4475000
YODSAV   DC    CL3' '              SAVE AREA FOR READ IN AREA           V4476000
YODOLD   DC    CL1' '              OLD DATA DIAL 1                      V4477000
YODIAL2  DC    H'0'                DATA DIAL 2 ISOLATED                 V4478000
YODIALS  DC    CL1' '              WORK AREA FOR DIALS                  V4479000
.YOSKP3  ANOP                                                           V4480000
 TITLE 'IT''S A BIRD... IT''S A PLANE... IT''S  S U P E R T R A C E'    V4481000
$SVC     NULL  *                   SVC NEW ENTRY POINT                  V4482000
         AIF   (&TRACE EQ 0).TRASKIP                                    V4483000
         $SSM  0                   TRACE MUST RUN DISABLED              V4484000
        $STO   R12,SVCSAV          PRESERVE                             V4485000
         $LOAD R12,$TRACUR         CURRENT TRACE LOC                    V4486000
         AH    R12,=H'4'           TO NEXT ENTRY                        V4487000
         CH    R12,$TRAEND         IS THIS END                          V4488000
         BNH   *+8                 BR NO                                V4489000
         $LOAD R12,$TRASTRT        YES...GET START                      V4490000
         $STO  R12,$TRACUR         RESET PTR                            V4491000
         MVI   0(R12),0            CLEAR HIGH BYTE                      V4492000
         AIF   (&MACHINE EQ 20).TR20                                    V4493000
         MVC   1(3,R12),37         SET TRACE LOCATION                   V4494000
         L     R12,36              SVC OLD ADDR                         V4495000
         CLI   35,X'CC'            IS THIS REGULAR TRACE                V4496000
         BNE   TRACNTNO            BR IF NO                             V4497000
         LH    R12,0(R12)          GET COUNT FIELD                      V4498000
         CH    R12,=H'32767'       IS TRACE ALREADY MAXIMUM             V4499000
         BE    *+8                 BR IF YES                            V4500000
         LA    R12,1(R12)          INCREMENT                            V4501000
         STH   R12,TRACNT          SAVE                                 V4502000
         L     R12,36              GET SVC OLD                          V4503000
         MVC   0(2,R12),TRACNT     SET COUNT                            V4504000
         B SVCRET                  BACK TO CALLER                       V4505000
TRACNTNO NULL  *                   TRACE COUNT NOT REQUIRED             V4506000
         MVZ   SVCBRN+1(1),35      SET BRA CONDITION                    V4507000
         SPM   R12                 GET PROGRAM MASK                     V4508000
         MVC   38(2),0(R12)        SET POSSIBLE BRA                     V4509000
SVCBRN   BC    *-*,SVCRETA         DO WHAT USER INTENDED                V4510000
SVCRET   NULL  *                   NORMAL-SEQUENTIAL RETURN             V4511000
         LA    R12,2(R12)          NEXT INST                            V4512000
         STH   R12,38              NO BRA...SET RETURN                  V4513000
SVCRETA  NULL  *                   BR RETURN                            V4514000
         L     R12,SVCSAV          RESTORE 12                           V4515000
         LPSW  32                  RETURN TO CALLER                     V4516000
SVCSAV   DC    F'0'                TEMP SAVE                            V4517000
TRACNT   DC    H'0'                TEMPORARY TRACE COUNT                V4518000
         AGO   .TRNOT20                                                 V4519000
.TR20    ANOP                                                           V4520000
         MVC   2(2,R12),SVCSAV     SET TRACED LOCATION                  V4521000
         MVI   1(R12),0            CLEAR 2ND BYTE OF TRACE              V4522000
         LH    R12,SVCSAV          RESTORE LINKAGE                      V4523000
         AH    R12,=H'2'           ADJUST RETURN                        V4524000
         STH   R12,SVCRET          SET EXIT                             V4525000
         LH    R12,SVCSAV          RESTORE                              V4526000
         LH    R12,0(0,R12)        GET COUNT FIELD                      V4527000
         CH    R12,=H'32767'       WATCH FOR OVERFLOW                   V4528000
         BE    SVCSAV+2            EXIT IF MAX                          V4529000
         AH    R12,=H'1'           COUNT ENTRY                          V4530000
         STH   R12,*-*             RESET COUNT                          V4531000
SVCSAV   EQU   *-2                 STORAGE                              V4532000
         LH    R12,=Y($SVC)        SET FOR NEXT TIME                    V4533000
         B     *-*                 RETURN                               V4534000
SVCRET   EQU   *-2                 RETURN STORAGE                       V4535000
.TRNOT20 ANOP                                                           V4536000
         EJECT                                                          V4537000
         SPACE 10                                                       V4538000
*                                                                       V4539000
*              T R A C E  T A B L E  (AND POINTERS)                     V4540000
*                                                                       V4541000
         SPACE 5                                                        V4542000
$TRACUR  $ACON (TRACETAB-4)        CURRENT TRACE ENTRY                  V4543000
*                                                                       V4544000
*                                                                       V4545000
$TRASTRT $ACON (TRACETAB)          BEGINNING OF TRACE TABLE             V4546000
*                                                                       V4547000
*                                                                       V4548000
$TRAEND  $ACON (TRACETAB+&TRACE*4-4) END OF TRACE TABLE                 V4549000
*                                                                       V4550000
*                                                                       V4551000
TRACETAB DC    (&TRACE)F'0'        T R A C E  T A B L E                 V4552000
*                                                                       V4553000
*                                                                       V4554000
.TRASKIP ANOP                                                           V4555000
         LTORG                                                 @OZ16672 V4555100
 TITLE '$ T A N K P O L  --  DECOMPRESSION TANK POOL '                  V4556000
$1STTANK $GENTANK                                                       V4557000
         AIF   (&CONSOLE EQ 0 AND &PRTCONS EQ 0).TANKSKP                V4558000
         ORG   $TANK1              OVERLAY TANK ONE WITH MESSAGE        V4559000
         DC    H'0',AL1(&WRCB(1)),X'80',H'26' TANK CONTROL BYTES        V4560000
         DC    CL26'COMMUNICATIONS ESTABLISHED' MESSAGE                 V4561000
         ORG   ,                   RESUME NORMAL COUNTER                V4562000
.TANKSKP ANOP                                                           V4563000
         EJECT                                                          V4564000
*              THIS LINE DELETED BY APAR NUMBER              * @OZ16672 V4565000
 TITLE '$ I N I T I 8  --  DYNAMIC BUFFER POOL CONSTRUCTION '           V4567000
$1STBUF  DS    0F                                                       V4568000
*                                                                       V4569000
*              THE FOLLOWING SECTION WILL DYNAMICALLY BUILD THE         V4570000
*              COMMUNICATIONS BUFFER POOL OVER THE INITIALIZATION       V4571000
*              INSTRUCTIONS.   BUFFERS WILL BE CONSTRUCTED TO THE       V4572000
*              EXTENT OF MEMORY OR UNTIL '&NUMBUFS' HAS BEEN BUILT.     V4573000
         SPACE 2                                                     R4 V4575000
         ORG   *+(BUFSTART-BUFBEGIN)  ORG AFTER BUF CNTRL INFO          V4576000
P$1STBUF $ACON $1STBUF                                                  V4577000
BUFLN1   DC    0H'0',AL2(BUFEND-BUFBEGIN)                               V4578000
BUFLN2   DC    0H'0',AL2(2*(BUFEND-BUFBEGIN))                           V4579000
BUFZEROS DC    F'0'                                                     V4580000
BCOREND  DC    0H'0',AL2(1024*&HICORE-1)                                V4581000
BONE     DC    H'1'                                                     V4582000
BNUMBUFS DC    H'&NUMBUFS'                                              V4583000
IBLDBUFS NULL                                                           V4584000
         AIF   (&MACHINE NE 20).NINTANK                        @OZ16672 V4584300
         MVC   INCONTIN+5(135),INCONTIN+4  BLANK OUT TANK 2    @OZ16672 V4584500
.NINTANK ANOP                                                  @OZ16672 V4584700
         $LOAD R11,P$1STBUF        LOAD ADDR OF 1ST BUFFER              V4585000
         LH    R10,P$1STBUF        LOAD ADDR OF 1ST BUFFER              V4586000
         LH    R9,BNUMBUFS         LOAD MAX NUMBER OF BUFFERS           V4587000
         AIF   (&MACHINE EQ 20).FRL30                                   V4588000
         CLC   $TIMER,=F'-1'       Q. IF TIMER IS WORKING               V4589000
         BNE   BULDMORE            BR. IF YES                           V4590000
*                                  THIS LINE DELETED BY APAR   @OZ40560 V4591000
         OI    CSWT1+1,X'F0'       SET TIMET WORKING SWITCH             V4592000
         OI    CSWT2+1,X'F0'       SET TIMET WORKING SWITCH             V4593000
.FRL30   ANOP                                                           V4594000
BULDMORE NULL                                                           V4595000
         AH    R10,BUFLN2          INCREASE R10 BY 2 BUFLENGTHS         V4596000
         $CA   R10,BCOREND         IS THERE ROOM FOR 2 MORE BUFS        V4597000
         BH    BUFSDONE            BR IF NO                             V4598000
         SH    R9,BONE             SUB ONE FROM BUFFER COUNT            V4599000
         BZ    BUFSDONE            BR IF LAST BUBBER                    V4600000
         SH    R10,BUFLN1          BACK UP TO NEXT BUFF ADDR            V4601000
         $STO  R10,0(0,R11)        STORE POINTER IN PREV BUF            V4602000
         MVC   L'BUFCHAIN((BUFSTART-BUFCOUNT),R11),BUFZEROS  MOVE IN    V4603000
*                                  INITIAL VALUES                       V4604000
         LH    R11,0(0,R11)        UPDATE R11 TO NEXT BUFFER            V4605000
         B     BULDMORE            BR TO BUILD ANOTHER BUFF             V4606000
BUFSDONE NULL                                                           V4607000
         $LOAD R10,BUFZEROS        LOAD CHAIN TERMINATOR                V4608000
         $STO  R10,0(0,R11)        STORE IT IN THE LAST BUFFER          V4609000
         MVC   L'BUFCHAIN((BUFSTART-BUFCOUNT),R11),BUFZEROS  MOVE IN    V4610000
*                                  INITIAL VALUES                       V4611000
         AIF   (&HOME EQ 0).IHOMB                                       V4612000
         $SSM  FF                  ENABLE INTERRUPTS                    V4613000
         B     $START              GO TO COMMUTATOR DIRECT              V4614000
.IHOMB   ANOP                                                           V4615000
 TITLE '$ I N I T I 8  --  ESTABLISH HASP SYNCHRONIZATION '             V4616000
         $DCHAIN $BUFPOOL,R13,NOENB GET A BUFFER                        V4617000
         USING BUFDSECT,R13        *                                    V4618000
         MVC   BUFCOUNT(ICTLE-ICTLS),ICTLS SETUP CONTROL REPLY          V4619000
         $CHAIN $OUTBUF,R13,NOENB STAGE FOR WRITE                       V4620000
         $DCHAIN $BUFPOOL,R13,NOENB GET ANOTHER                         V4621000
         $STO  R13,$BUFFER         SET FOR I/O ROUTINES                 V4622000
         MVC   BUFSTART,XACKSEQ    FAKE AN ACK                          V4623000
         B     $ENDREAD            FAKE AN INTERRUPT                    V4624000
ICTLS    DS    0H                  CONTROL INFO FOR BUFFER              V4625000
         DC    AL2(ICTLE-*-3)      BUFCOUNT                             V4626000
         DC    X'00'               BUFSTAT                              V4627000
         DC    AL1(XLDR,XSTX)      BUFSTART                             V4628000
         DC    AL1(X'80'+BCBRESET) BUFBCB (RESETS EXPECTED BLOCK CT)    V4629000
         DC    AL2(0)              FCS                                  V4630000
         DC    X'F0'               GENERAL CONTROL TYPE RCB             V4631000
         DC    C'A'                SIGN-ON ID                           V4632000
ICTXT    DS    0CL80                                                    V4633000
         DC    CL21'/*SIGNON       REMOTE'                              V4634000
         DC    CL59'&RMTID'        REMOTE IDENTIFICATION                V4635000
         DC    AL1(0)              EOR                                  V4636000
ICTLE    EQU   *                                                        V4637000
         LTORG                                                          V4638000
         TITLE 'H A S P / R J E  * ABSOLUTE PATCH LOADER * '            V4639000
$REPLOAD NULL                      ENTRY POINT                          V4640000
ZEP1     NULL  *                   READ REP CARD                        V4644000
         AIF   (&MACHINE EQ 20).REP20                                   V4645000
         LA    R1,4095             PICK UP MAXIMUM DISPLACEMENT         V4646000
         LA    R1,1(0,R1)          SET R1 TO X'1000'  4- 8K             V4647000
         LA    R2,0(R1,R1)         SET R2 TO X'2000'  8-12K             V4648000
         LA    R3,0(R1,R2)         SET R3 TO X'3000' 12-16K             V4649000
         MVC   $TIMER,=F'-1'       INITIALIZE TIMER                  R4 V4649500
         MVC   $CAW(4),=A(IREADCCW)   SET CCW                           V4650000
         SIO   X'&RADR(1)'         READ                                 V4651000
         BC    7,*-4               LOOP UNTIL TAKEN                     V4652000
         TIO   X'&RADR(1)'         TEST COMPLETE                        V4653000
         BC    3,*-4               LOOP BACK UNTIL I/O CHAN END         V4654000
         NC    $CSW+4(2),=X'F3FF'  TURN GOOD BITS OFF                   V4655000
         BNZ   *                   STOP ON ERROR BITS ON                V4656000
         AGO   .REP360A                                                 V4657000
.REP20   ANOP                                                           V4658000
         XIO   ZEPCARD(ROPCODE+1),80 READ REP CARD                      V4659000
         BC    7,*-6               *                                    V4660000
ZEP2     NULL                                                           V4661000
         TIOB  *,RBUSY             WAIT                                 V4662000
ZEP3     NULL                                                           V4663000
         TIOB  ZEP1,RERROR         ERROR                                V4664000
ZEP4     NULL                                                           V4665000
         TIOB  ZEPEND,REOF         EOF                                  V4666000
         XIO   ZEPCARD(POPCODE+1),80 PRINT REP CARD                     V4667000
         BC    7,*-6               WAIT UNTIL TA-EN                     V4668000
         AGO   .REP20A                                                  V4669000
.REP360A ANOP                                                           V4670000
ZEP360   NULL  *                   360 ENTRY                            V4671000
         MVC   $CAW(4),=A(IPRTCCW) SET CCW                              V4672000
         SIO   X'&PADR(1)'         PRINT IT                             V4673000
         BC    7,*-4               LOOP UNTIL TAKEN                     V4674000
         TIO   X'&PADR(1)'         TEST COMPLETE                        V4675000
         BC    7,*-4               LOOP IF NO                           V4676000
.REP20A  ANOP                                                           V4677000
         CLC   ZEPCARD(4),=C'    ' IS THIS BLANK                        V4678000
         BE    ZEPEND              BR IF YES TO END OF REPS             V4679000
         CLC   ZEPCARD(8),ICTXT    IS THIS SIGNON CARD                  V4680000
         BE    ZEPENDA             IF SO MOVE SIGNON                    V4681000
         CLC   ZEPCARD(8),=C'&&MLBFSIZ'  IS THIS &MLBFSIZ      @OZ27487 V4681200
         BE    ZEPMLBF             BR IF SO                          R4 V4681400
         CLC   ZEPCARD(8),=C'&&NUMBUFS'  IS THIS &NUMBUFS      @OZ27487 V4681600
         BE    ZEPBUFS             BR IF SO                          R4 V4681800
         CLC   ZEPCARD+1(3),=C'REP'   IS THIS REP                       V4682000
         BNE   ZEP1                BR IF NO... TO READ AGAIN            V4683000
         CLC   ZEPCARD+8(4),=C'    ' IS LOC FIELD BLANK...              V4684000
         LH    R8,=Y(ZEPCARD+16)   LOAD ADDR OF DATA                    V4685000
         BE    Z1                  BR IF BLANK TO CONT. OLD LOC         V4686000
         LH    R8,=Y(ZEPCARD+8)    ADDR OF LOC FIELD                    V4687000
         BAS   R9,ZTRAN            GO DECODE                            V4688000
         STH   R10,ZWK+1           SIMULATE                             V4689000
         LH    R11,ZWK+1           LR  11,10                            V4690000
         LH    R8,=Y(ZEPCARD+16)   FIRST DATA WORD                      V4691000
Z1       BAS   R9,ZTRAN            GO DECODE                            V4692000
         STH   R10,0(0,R11)        AND STORE                            V4693000
         AH    R11,=H'2'           BUMP LOC CTR                         V4694000
         CLI   4(R8),C','          IS THERE MORE                        V4695000
         BNE   ZEP1                BR IF NO TO NEXT CARD                V4696000
         AH    R8,=H'5'            UP CARD POINTER                      V4697000
         B     Z1                  AND GO AGAIN                         V4698000
         EJECT                                                       R4 V4698100
ZEPMLBF  LH    R8,=Y(ZEPCARD+9)    LOAD ADDR OF BUFFER SIZE          R4 V4698200
         BAS   R9,ZCNVT             AND CONVERT NUMBER TO BINARY     R4 V4698300
        $AA    R10,1               ADD 1 TO BUFFER SIZE              R4 V4698400
         STH   R10,$TPBFSIZ        ENSURE &TPBFSIZ                   R4 V4698500
         NI    $TPBFSIZ+1,X'FE'     A MULTIPLE                       R4 V4698600
         LH    R10,$TPBFSIZ          OF TWO BYTES                    R4 V4698700
         STH   R10,CREADCT         INITIALIZE BUFFER READ COUNT      R4 V4698800
        $AA    R10,BUFDATA-5-BUFBEGIN+3  INTERNAL BUF LEN + 3        R4 V4698900
         STH   R10,BUFLN1          ENSURE INTERNAL                   R4 V4699000
         NI    BUFLN1+1,X'FD'       BUFFER LENGTH A MULTIPLE         R4 V4699100
         LH    R10,BUFLN1            OF FOUR BYTES                   R4 V4699200
         AR    R10,R10             COMPUTE AND STORE                 R4 V4699300
         STH   R10,BUFLN2           INTERNAL BUF LEN TIMES 2         R4 V4699400
         SPACE 1                                                     R4 V4699500
         AIF   ('&XPARENT' EQ 'YES').REP20B                          R4 V4699600
         LH    R10,$TPBFSIZ        SET COUNT                         R4 V4699700
         SH    R10,=H'5'            FOR FINAL                        R4 V4699800
         STH   R10,$TEMP             TRANSLATE                       R4 V4699900
         MVC   TR2+1(1),$TEMP+1       IN $EXCP                       R4 V4700000
.REP20B  ANOP                                                        R4 V4700100
         SPACE 1                                                     R4 V4700200
         B     ZEP1                THEN BR TO READ ANOTHER CARD      R4 V4700300
         SPACE 3                                                     R4 V4700400
ZEPBUFS  LH    R8,=Y(ZEPCARD+9)    LOAD ADDR OF NEW BUFFER COUNT     R4 V4700500
         BAS   R9,ZCNVT             AND CONVERT NUMBER TO BINARY     R4 V4700600
         STH   R10,BNUMBUFS        STORE NUMBER OF BUFFERS           R4 V4700700
         MVC   CCTBUFLM,BNUMBUFS+1  AND SET IN CTCT                  R4 V4700800
         B     ZEP1                THEN BR TO READ ANOTHER CARD      R4 V4700900
         EJECT                                                       R4 V4701000
*********************************************************************** V4701100
*                                                                     * V4701200
*        ZCNVT - CONVERT 4-DIGIT (OR LESS) NUMBER TO BINARY           * V4701300
*                                                                     * V4701400
*        R8    - ADDRESS OF NUMBER TO BE CONVERTED                    * V4701500
*        R9    - RETURN ADDRESS                                       * V4701600
*        R10   - NUMBER IN BINARY FORM ON EXIT                        * V4701700
*                                                                     * V4701800
*********************************************************************** V4701900
         SPACE 1                                                     R4 V4702000
ZCNVT    SR    R10,R10             INITIALIZE COUNT TO ZERO          R4 V4702100
         MVC   ZWORK+1(4),0(R8)    MOVE NUMBER TO WORK AREA          R4 V4702200
         SPACE 1                                                     R4 V4702300
ZCNVDIG  MVC   ZWORK(5),ZWORK+1    SHIFT NUMBER LEFT 1 DIGIT         R4 V4702400
         CLI   ZWORK,C' '          IF END OF NUMBER FIELD,           R4 V4702500
         BER   R9                   RETURN                           R4 V4702600
         MH    R10,=H'10'          'SHIFT' BINARY NO. LEFT 1 'DIGIT' R4 V4702700
         NI    ZWORK,X'0F'         LEAVE ONLY NUMERIC PORTION        R4 V4702800
         AH    R10,ZDIGIT          ADD NEW DIGIT TO TOTAL            R4 V4702900
         B     ZCNVDIG              AND BR TO TEST FOR MORE          R4 V4703000
         SPACE 1                                                     R4 V4703100
ZDIGIT   DC    0H'0',X'00',CL6' '  ZCNVT WORK AREA                   R4 V4703200
ZWORK    EQU   ZDIGIT+1,6          REDEFINITION OF WORK AREA         R4 V4703300
         SPACE 3                                                     R4 V4703400
*********************************************************************** V4703500
*                                                                     * V4703600
*        ZTRAN - CONVERT EBCDIC HEX TO BINARY                         * V4703700
*                                                                     * V4703800
*        R8    - ADDRESS OF NUMBER TO BE CONVERTED                    * V4703900
*        R9    - RETURN ADDRESS                                       * V4704000
*        R10   - NUMBER IN BINARY FORM ON EXIT                        * V4704100
*                                                                     * V4704200
*********************************************************************** V4704300
         SPACE 1                                                     R4 V4704400
ZTRAN    MVC   ZWK(4),0(R8)        MOVE DATA                         R4 V4704500
         TR    ZWK(4),ZTAB         TRANSLATE A LITTLE                   V4708000
         PACK  ZWK(4),ZWK(4)       PACK IT UP                           V4709000
         MVO   ZWK(4),ZWK(4)       SHIFT IT                             V4710000
         LH    R10,ZWK+1           LOAD RESULT--- INTO REG              V4711000
         BR    R9                  AND RETURN                           V4712000
         DS    0H                                                       V4713000
         DC    X'00'                                                    V4714000
ZWK      DC    AL3(0)                                                   V4715000
         DC    X'00'               SPACER                               V4716000
ZEPCARD  DS    80C                                                      V4717000
ZTAB     EQU   *-X'C1'                  -                               V4718000
         DC    X'0A0B0C0D0E0F'                                          V4719000
         DC    (X'F0'-X'C6')X'00'                                       V4720000
         DC    X'010203040506070809'                                    V4721000
         AIF   (&MACHINE EQ 20).REP360C                                 V4722000
IREADCCW $CCW  2,ZEPCARD,20,80     CARD READ CCW                        V4723000
IPRTCCW $CCW   9,ZEPCARD,20,80     PRINT CARD CCW                       V4724000
.REP360C ANOP                                                           V4725000
         SPACE 1                                                     R4 V4725200
ZEPENDA  MVC   ICTXT,ZEPCARD       MOVE SIGNON INTO DEFAULT          R4 V4725400
         SPACE 1                                                     R4 V4725600
ZEPEND   DS    0H                  END OF REP/PARM CARDS             R4 V4725800
 TITLE '$ I N I T I 8  --  INITIALIZATION PROCESSOR '                   V4726000
$INITI8  NULL  *                   ENTRY POINT                          V4727000
         AIF   (&CONSOLE EQ 0 AND &PRTCONS EQ 0).ISKPTNK                V4728000
*                                                                       V4729000
*        SETUP FOR COMMUNICATIONS ESTABLISHED MESSAGE                   V4730000
*                                                                       V4731000
         MVC   WCTTANK,$TANKPOL    SET MESSAGE TANK FOR OUTPUT          V4732000
         MVI   WCTTNKCT,1          SET TANK COUNT                       V4733000
         MVC   $TANKPOL,=Y($TANK2) SET TANK TWO FIRST                   V4734000
         OI    $WCOMM1+1,X'F0'     OPEN COMMUTATOR GATE                 V4735000
.ISKPTNK ANOP                                                           V4736000
         SPACE 5                                                        V4737000
*                                                                       V4738000
*        HASP ENVIRONMENT RECORDING ERROR PRINTOUT (HEREP)              V4739000
*                                                                       V4740000
INIHEREP NULL                                                           V4741000
         CLC   ILOGTABL+4(L'LOGTEXT),LOGTABLE+4 IS THE TABLE GOOD       V4742000
         BNE   INEWTABL            BR NO TO INITIALIZE NEW TABLE        V4743000
         AIF   (&MACHINE EQ 20).INI1                                    V4744000
         SSM   *+1                 DISABLE                              V4745000
         MVC   CAW(4),INICAW1      MVC ADDR OF SKIP TO CHAN 1 CCW       V4746000
*                                  TO THE CAW                           V4747000
         BAL   R8,INIPRINT         BR TO PRINT                          V4748000
         MVC   CAW(4),INICAW2      MVC ADDR OF TITLE CCW TO CAW         V4749000
         BAL   R8,INIPRINT         BR TO PRINT                          V4750000
         MVC   CAW(4),INICAW3      MVC ADDR OF SPACE 3 CCW TO CAW       V4751000
         BAL   R8,INIPRINT         BR TO PRINT                          V4752000
         MVC   CAW(4),INICAW3      SPACE 3 MORE                         V4753000
         BAL   R8,INIPRINT         BR TO PRINT                          V4754000
.INI1    AIF   (&MACHINE NE 20).INI2                                    V4755000
         $SSM  0                   DISABLE I/O INTERRUPTS               V4756000
         CIO   1,X'45'             SKIP TO CHANELL 1                    V4757000
         BC    7,*-4               BR UNTILL EXCEPTED                   V4758000
         XIO   INITITLE(POPCODE+1),90 PRINT TITLE                       V4759000
         BC    7,*-6               BR UNTIL EXCEPTED                    V4760000
         CIO   3,X'44'             SPACE 3                              V4761000
         BC    7,*-4               BR UNTIL EXECTPED                    V4762000
         CIO   3,X'44'             SPACE 3                              V4763000
         BC    7,*-4               BR UNTIL EXCEPTED                    V4764000
.INI2    ANOP                                                           V4765000
         USING LOGDSECT,R9                                              V4766000
         $LA   R9,LOGTABLE         R9 BASE FOR FIRST ENTRY              V4767000
INPRTOUT NULL                                                           V4768000
         CLI   LOGID,X'00'         IS THIS THE END                      V4769000
         BE    INEWTABL            BR YES INITIALIZE NEW TABLE          V4770000
         MVC   INILTEXT,LOGTEXT    MVC LOGTEXT TO PRINT BUFFER          V4771000
         LH    R10,LOGCOUNT        LOAD ERROR COUNT INTO R10            V4772000
         AIF   (&MACHINE EQ 20).INI3                                    V4773000
         CVD   R10,INICVD          CONVERT TO PACKED DECIMAL            V4774000
.INI3    AIF   (&MACHINE NE 20).INI4                                    V4775000
         MVC   INICVD,INIPZERO     MVC PACKED ZERO                      V4776000
INCVDLOP NULL                                                           V4777000
         SH    R10,=H'1'           SUBTRACT ONE                         V4778000
         BM    INCVDONE            BR NEGATIVE TO EDIT                  V4779000
         AP    INICVD,INIPONE      ADD ONE TO THE CONVERT FIELD         V4780000
         B     INCVDLOP            LOOP                                 V4781000
.INI4    ANOP                                                           V4782000
INCVDONE NULL                                                           V4783000
         UNPK  INIERCNT,INICVD      CONVERT THE NUMBER TO EBCDIC        V4784000
         $LA   R10,INIERCNT         PICK UP START OF OUTPUT AREA        V4785000
*                                  FOR LEADING ZERO SUPPRESSION         V4786000
INIEDIT  NULL                                                           V4787000
         CLI   0(R10),C'0'         TERT FOR A LEADING ZERO              V4788000
         BNE   INIWRITE            BR  NO TO WRITE THE LINE             V4789000
         MVI   0(R10),C' '         REPLACE WIT A BLANK                  V4790000
         AH    R10,=H'1'           POINT TO NEXT CHARACTER              V4791000
         B     INIEDIT             GO CHECK FOR ANOTHER BLANK           V4792000
INIWRITE NULL                                                           V4793000
         OI    INIERCNT+6,X'F0'     CORRECT LOW ORDER DIGIT ZONE        V4794000
         AIF   (&MACHINE EQ 20).INI5                                    V4795000
         MVC   CAW(4),INICAW4      SET UP CAW TO PRINT THE LINE         V4796000
         BAL   R8,INIPRINT         PRINT IT                             V4797000
.INI5    AIF   (&MACHINE NE 20).INI6                                    V4798000
         XIO   INIBUFF(POPCODE+1),L'LOGTEXT+37 PRINT THE LINE           V4799000
         BC    7,*-6               BR UNTIL EXCEPTED                    V4800000
.INI6    ANOP                                                           V4801000
         AH    R9,=Y(LOGEND-LOGID) UPDATE R9 TO NEXT LOG ENTRY          V4802000
         B     INPRTOUT            BR TO PROCESS THE NEXT ENTRY         V4803000
         SPACE 3                                                        V4804000
INEWTABL NULL                                                           V4805000
         MVC   LOGTABLE(X'92'),ILOGTABL RECREATE THE LOG TABLE          V4806000
         B     INCONTIN            CONTINUE                             V4807000
ILOGTABL DS    0H                                                       V4808000
         $LOGENT ID=XBCBCHEK,CLASS=10,TEXT='BLOCK SEQ CK'               V4809000
         $LOGENT ID=XNAKREC,CLASS=7,TEXT='ERROR REPLY'                  V4810000
         $LOGENT ID=XUNKRES,CLASS=10,TEXT='INVALID RESP'                V4811000
         $LOGENT ID=XUNITEXP,CLASS=10,TEXT='UNIT EXCPTN'                V4812000
         $LOGENT ID=XUNITCHK,CLASS=7,TEXT='UNIT CHECK'                  V4813000
         $LOGENT ID=XUNSLERR,CLASS=15,TEXT='UNUSUAL END'                V4814000
         $LOGENT ID=XSIOBAD,CLASS=12,TEXT='SIO FAILURE'                 V4815000
         $LOGENT ID=XTPWRITE,CLASS=1,TEXT='W' LOG OF WRITES             V4816000
         $LOGENT ID=XTPREAD,CLASS=1,TEXT='R' LOG FOR ALL READS          V4817000
         DC    X'00'               END OF LOG TABLE                     V4818000
ILTABEND DS    0C                  END OF THE TABLE                     V4819000
         AIF   (&MACHINE EQ 20).INI7                                    V4820000
         SPACE 3                                                        V4821000
PRINTER EQU    X'00E'                                                   V4822000
INIPRINT NULL                                                           V4823000
         SIO   X'&PADR(1)'         START THE OPERATION                  V4824000
         BC    3,*-4               WAIT UNTIL TAKEN                     V4825000
         BC    4,INICSWS           BR IF CSW STORED                     V4826000
         TIO   X'&PADR(1)'         TEST COMPLETION                      V4827000
         BC    3,*-4               LOOP UNTIL COMPLETE                  V4828000
         BR    R8                  AND RETURN                           V4829000
INICSWS  NULL  *                   CSW STORED ON START I/O              V4830000
         NC    68(2),=X'F3FF'      ELIMINATE CE,DE                      V4831000
         BNZ   INIPRINT            BR IF ERROR TO RETRY                 V4832000
         BR    R8                  OTHERWISE RETURN                     V4833000
         SPACE 3                                                        V4834000
*                                                                       V4835000
*        HEREP CCW'S AND CAW'S FOR NON-20'S                             V4836000
*                                                                       V4837000
         SPACE 5                                                        V4838000
INICAW1  DC    A(INICCW1)          CAW TO SKIP TO TOP OF PAGE           V4839000
INICAW2  DC    A(INICCW2)          CAW TO PRINT TITLE AND SPACE 3       V4840000
INICAW3  DC    A(INICCW3)          CAW TO SPACE 3                       V4841000
INICAW4  DC    A(INICCW4)          NORMAL HEREP LINE                    V4842000
         SPACE 3                                                        V4843000
INICCW1  CCW   X'8B',INITITLE,X'20',1 SKIP IMMEDIATE TO CHAN 1          V4844000
INICCW2  CCW   X'19',INITITLE,X'20',90 PRINT TITLE AND SPACE 3          V4845000
INICCW3  CCW   X'1B',INITITLE,X'20',1 SPACE 3 LINES IMMEDIATELY         V4846000
INICCW4  CCW   X'11',INIBUFF,X'20',(L'LOGTEXT+37)                       V4847000
.INI7    ANOP                                                           V4848000
INITITLE DC  45C' ',C'HASP ENVIRONMENT RECORDING ERROR PRINTOUT'        V4849000
INIHEAD  DC    20C' ',C'ERROR ID',14C' '                                V4850000
         DC    C'COMULATIVE COUNT SINCE THE LAST IPL'                   V4851000
INIBUFF  DS    0CL(L'LOGTEXT+37)                                        V4852000
         DC    20C' '                                                   V4853000
INILTEXT DC    CL(L'LOGTEXT)' '                                         V4854000
         DC    10C' '                                                   V4855000
INIERCNT DC    C'0000000'                                               V4856000
INICVD   DC    0D'0',PL8'0'                                             V4857000
INIPZERO DC    PL8'0'                                                   V4858000
INIPONE  DC    P'1'                                                     V4859000
         EJECT                                                          V4860000
         EJECT                                                          V4861000
         AIF   (&MACHINE NE 20).INMOD30                        @OZ16672 V4861500
         ORG   $TANK2+2            PUT INIT CODE IN TANK 2     @OZ16672 V4861600
.INMOD30 ANOP                                                  @OZ16672 V4861700
INCONTIN NULL                                                           V4862000
         AIF   (&MACHINE EQ 20).IMOD20                                  V4863000
         MVC   CAW(4),INICAW1      SET UP FOR SKIP TO CHAN 1            V4864000
         BAL   R8,INIPRINT         BR TO INITIALIZATION PRINT           V4865000
         MVC   $EXTNEW(40),IPSWS   SETUP ALL PSW'S                      V4866000
         SSM   *+1                                                      V4867000
         AIF   (&HOME NE 0).IHOMA                                       V4868000
ISIO     NULL  ,                   ESTABLISH COMMUNICATIONS WITH HASP   V4869000
         LA    R9,INITCCW          INITIALIZATION CCW STRING            V4870000
         BAL   R8,I27XXIO          GO START I/O                         V4871000
         MVI   INITCCW,4           CHANGE DISABLE TO SENSE              V4872000
         MVI   INITCCWS,3          NOP SET MODE                         V4873000
         BNZ   ISIO                RETRY IF PREVIOUS I/O BAD            V4874000
         CLC   IREADRES,=AL1(XDLE,XACK0) WAS ACK RECEIVED               V4875000
         BNE   ISIO                START AGAIN IF NO                    V4876000
.IHOMA   ANOP                                                           V4877000
         MVC   $IOOLD(8),INTFAKE   SET FAKE INTERRUPT                   V4878000
         MVC   $IONEW+4(4),=A($IOINT)  SET NORMAL INTERRUPT ENTRY       V4879000
         B     IBLDBUFS            GO CONSTRUCT BUFFER POOL             V4880000
INTFAKE  DC    X'FF04',AL2($ADAPTER),AL4($START) FAKE OLD PSW           V4881000
         DS    0D                  *                                    V4882000
INITCCW  $CCW  X'2F',INITCCW+5,60,1 DISABLE  (CHANGED TO SENSE)         V4883000
INITCCWS $CCW  X'23',ISETMODE,60,1  SET MODE (CHANGED TO A NOP)         V4884000
         $CCW  X'27',0,60,1        ENABLE                               V4885000
INITCCWR $CCW  1,INITSEQ,60,2      WRITE RESPONSE SEQUENCE              V4886000
         $CCW  2,IREADRES,20,2     READ ANSWER FROM HASP                V4887000
INITSEQ  DC    AL1(XSOH,XENQ)      PRE SIGN ON RESPONSE                 V4888000
IREADRES DC    AL2(0)              RESPONSE CHARACTERS FROM HASP        V4889000
*                                                                       V4890000
*              SUBROUTINE TO PERFORM I/O OPERATIONS ON THE 27XX         V4891000
*               R8=RETURN,R9=CCW ADDR,CC=Z=NORMAL CE,DE--NZ=BAD         V4892000
*                                                                       V4893000
I27XXIO  NULL  *                   ENTRY                                V4894000
         ST    R9,$CAW             SETUP CCW ADDR                       V4895000
         SIO   $ADAPTER            START OPERATION                      V4896000
         BC    7,*-4               LOOP UNTIL TAKEN                     V4897000
INITENB  SSM   =X'FF'              ENABLE INTERRUPTS                    V4898000
         B     *                   WAIT FOR INTERRUPT                   V4899000
$INITWAT CLC   $IOOLD+2(2),=AL2($ADAPTER)  IS THIS SDA                  V4900000
         BNE   INITENB             LOOP IF NOT SDA                      V4901000
         CLC   $CSW+4(2),=X'0C00'  SET COND CODE FOR CALLER             V4902000
         BR    R8                  AND RETURN                           V4903000
ISETMODE DC    X'00'               SET MODE BYTE                        V4904000
IPSWS    NULL  *                   NEW PSW'S                            V4905000
         DC    X'00040000',AL4($EXTINT)  EXTERNAL                       V4906000
         DC    X'00040000',AL4($SVC) SVC                                V4907000
         DC    X'0002000000111111' PROGRAM INTERRUPT                    V4908000
         DC    X'00020000',X'00FFFFFF' MACHINE CHECK                    V4909000
         DC    X'00040000',AL4($INITWAT)  I/O NEW                       V4910000
$IONEW   EQU   120                 I/O NEW                              V4911000
$EXTNEW  EQU   88                  EXTERNAL NEW PSW                     V4912000
         AGO   .IMODXX                                                  V4913000
.IMOD20  ANOP                                                           V4914000
         CIO   1,X'45'             SKIP TO CHAN 1                       V4915000
         BC    7,*-4               WAIT UNTIL ACCEPTED                  V4916000
         $LOAD R12,=Y($SVC)        ESTABLISH TRACE ENTRY                V4917000
         AIF   (&CONSOLE EQ 0).IMOD20A                                  V4918000
         CIO   1,WENABLE           ENABLE CONSOLE REQUESTS              V4919000
         AGO   .IMOD20B                                                 V4920000
.IMOD20A AIF   (&R(2)).IMOD20B                                          V4921000
         MVC   YODSAV,252          SAVE DIAL AREA                       V4922000
         DIALS ,                   READ DIALS                           V4923000
         MVC   YODOLD,252          SET DATA DIALS TO INITIAL VALUE      V4924000
         NI    YODOLD,X'10'        REMOVE DIAL 2 PLUS HIGH 3 BITS       V4925000
         MVC   252(3),YODSAV       RESTORE AREA                         V4926000
.IMOD20B ANOP                                                           V4927000
         AIF   (&HOME EQ 0).IHOMIA                                      V4928000
         B     IHOMSKP                                                  V4929000
.IHOMIA  ANOP                                                           V4930000
         CIO   1,CAENABLE          TURN ON BSCA                         V4931000
IREDOIT  MVC   148(4),=AL4(INITINT) SET NEW PSW                         V4932000
IAGAIN   NULL  *                   TRY AGAIN                            V4933000
         XIO   IWRDRES(CAWRTRD),4  SEND PRE-SIGNON, REC DLE ACK0        V4934000
         BC    7,IAGAIN            TRY AGAIN IF NOT STARTED             V4935000
         $SSM  FF                  PREPARE FOR INTERRUPT                V4936000
         B     *                   LOOP UNITL INTERRUPT                 V4937000
INTFAKE  DC    X'01',AL1(CAINTID),Y($START),AL4($IOINT) FAKE AND REAL   V4938000
INITINT  NULL  *                   INITIALIZATION INTERRUPT PROCESSOR   V4939000
         CLI   145,CAINTID         IS THIS BSCA                         V4940000
         BNE   IBACK               BR IF NO TO IGNORE                   V4941000
         TIOB  IAGAIN,CAERROR      RETRY IF ANY ERROR                   V4942000
         CLC   IREADRES,=AL1(XDLE,XACK0) WAS ACK RECEIVED               V4943000
         BNE   IAGAIN              START OVER IF NOT                    V4944000
IHOMSKP  DS    0H                                                       V4945000
         MVC   144(8),INTFAKE      SETUP FAKE OLD AND GOOD NEW PSW      V4946000
         MVI   INCONTIN,0           RE-INITIALIZE TANK 2       @OZ16672 V4946100
         MVC   INCONTIN+1(3),INCONTIN    WITH A WORD OF ZEROS  @OZ16672 V4946200
         MVI   INCONTIN+4,C' '     SET UP BLANK TO PROPOGATE   @OZ16672 V4946300
         B     IBLDBUFS            GO BUILD BUFFERS AND SIGN-ON         V4947000
IWRDRES  DC    AL1(XSOH,XENQ)      IDENTIFY AS CPU TERMINAL             V4948000
IREADRES DC    AL2(0)              RESPONSE CHARACTERS FROM HASP        V4949000
IBACK    NULL  *                   NOT BSCA INTERRUPT                   V4950000
         SPSW  144                 RETURN                               V4951000
         ORG   INIPONE+2                                       @OZ16672 V4951500
.IMODXX  ANOP                                                           V4952000
         EJECT                                                          V4953000
         LTORG                                                          V4954000
         EJECT                                                          V4955000
         SPACE 20                                                       V4956000
$L       EQU   *-HASPRJE+&HRTPORG                                       V4957000
$L1      EQU   $L/100000*100000                                         V4958000
$L2      EQU   ($L-$L1)/10000*10000                                     V4959000
$L3      EQU   ($L-$L1-$L2)/1000*1000                                   V4960000
$L4      EQU   ($L-$L1-$L2-$L3)/100*100                                 V4961000
$L5      EQU   ($L-$L1-$L2-$L3-$L4)/10*10                               V4962000
$L6      EQU   $L-$L1-$L2-$L3-$L4-$L5                                   V4963000
         SPACE 3                                                        V4964000
*                                                                       V4965000
*                  THE FOLLOWING VALUE OF $DLENGTH INDICATES THE        V4966000
*                  MINIMUM MEMORY SIZE TO CONTAIN THIS PROGRAM.         V4967000
*                  THE VALUE REPRESENTS THE DECIMAL VALUE               V4968000
*                                                                       V4969000
$DLENGTH EQU   $L1/100000*1048576+$L2/10000*65536+$L3/1000*4096+$L4/100CV4970000
               *256+$L5/10*16+$L6                                       V4971000
 TITLE 'H A S P REMOTE TERMINAL PROCESSOR DEBUGGING AID PAGE '          V4972000
*********************************************************************** V4973000
         SPACE 1                                                        V4974000
*                       SIGNIFICANT LOCATION ADDRESSES                  V4975000
         SPACE 1                                                        V4976000
$01   EQU   CBUFFER           CURRENTLY ACTIVE COMMUNICATIONS BUFFER  $ V4977000
         AIF   (&TRACE EQ 0).INFO1                                      V4978000
$02   EQU   $TRACUR           CURRENT LOCATION IN TRACE TABLE         $ V4979000
.INFO1   ANOP                                                           V4980000
$03   EQU   $TANK1            START OF DECOMPRESSION TANKS            $ V4981000
$04   EQU   $1STBUF           BEGINNING OF COMMUNICATIONS BUFFER POOL $ V4982000
$05   EQU   $BUFPOOL          FREE BUFFER CHAIN START                 $ V4983000
$06   EQU   $TANKPOL          FREE DECOMPRESSION TANK CHAIN START     $ V4984000
$08   EQU   $OUTBUF           BUFFERS AWAITING TRANSMISSION           $ V4985000
$09      EQU   $FCSOUT             FUNCTION-CONTROL-SEQUENCE          $ V4986000
$10   EQU   COMWRITE          LAST TP WRITE COMMAND                   $ V4987000
$11   EQU   $LOGCLAS          ERROR LOG CLASS LEVEL                   $ V4988000
         SPACE 1                                                        V4989000
*********************************************************************** V4990000
         SPACE 2                                                        V4991000
*                       M O D E L  2 0  -  BSCA SENSE BYTES           $ V4992000
         SPACE 1                                                        V4993000
*              00 = UNDEFINED                                           V4994000
*              01 = DATA OVER-RUN ON A WRITE                            V4995000
*              02 = CPU-BSCA PARITY CHECK ON WRITE                      V4996000
*              04 = MAIN STORAGE EXCEEDED ON WRITE                      V4997000
*              08 = NO ENDING SEQUENCE FOUND ON WRITE                   V4998000
*              10 = NOT DEFINED                                         V4999000
*              20 = NOT DEFINED                                         V5000000
*              40 = EOT RECEIVED WHILE WRITING                          V5001000
*              80 = NOT DEFINED                                         V5002000
*              81 = DATA OVER-RUN ON READ                               V5003000
*              82 = NOT DEFINED                                         V5004000
*              84 = MAIN STORAGE EXCEEDED ON READ                       V5005000
*              88 = LOST DATA ON READ                                   V5006000
*              90 = READ TIMEOUT                                        V5007000
*              A0 = DATA CHECK ON READ                                  V5008000
*              C0 = EOT RECEIVED ON READ                                V5009000
         SPACE 2                                                        V5010000
*                       H A S P  E R R O R  L O G  C O D E S            V5011000
         SPACE 1                                                        V5012000
*              00 = TRACE ENTRY (NOT LOGGED)                            V5013000
*              01 = BLOCK COUNT CHECK                                   V5014000
*              02 = NEGATIVE ACKNOWLEDGEMENT RECEIVED                   V5015000
*              03 = UNKNOWN RESPONSE RECEIVED                           V5016000
*              04 = EOT RECEIVED                                        V5017000
*              05 = UNIT CHECK                                          V5018000
*              06 = UNUSUAL CHANNEL END                                 V5019000
*              07 = SIO FAILURE (360 ONLY)                              V5020000
*              08 = ADAPTER WRITE LOGGING ( 360 ONLY )                  V5021000
*              09 = ALL COMMUNICATIONS INTERRUPTS                       V5022000
         EJECT                                                          V5023000
         SPACE 5                                                        V5024000
*********************************************************************** V5025000
*                                                                     * V5026000
*        EIGHT CHARACTER ERROR MESSAGE CODES                          * V5027000
*                                                                     * V5028000
*              01 = BLOCK COUNT CHECK (DUPLICATE OR LOST RECORDS)     * V5029000
*                   01IIEE00         II= INPUT BLOCK CHECK FROM HASP  * V5030000
*                                    EE= EXPECTED BLOCK CHECK         * V5031000
*                                                                     * V5032000
*              02 = NEGATIVE ACKNOWLEDGEMENT RECEIVED                 * V5033000
*                   02000000                                          * V5034000
*                                                                     * V5035000
*              03 = UNKNOWN RESPONSE RECEIVED                         * V5036000
*                   03IIII00       IIII= DATA BYTES 1,2 OF INPUT.     * V5037000
*                                  ( IF CORRECT CONTROL SEQUENCE      * V5038000
*                                  ENDING SEQUENCE IS INVALID )       * V5039000
*                                                                     * V5040000
*              04 = UNIT EXCEPTION - EOT RECEIVED                     * V5041000
*                   0400AAAA       AAAA= DEVICE ADDRESS. 0 FOR BSCA   * V5042000
*                                                                     * V5043000
*              05 = UNIT CHECK                                        * V5044000
*                   05SSAAAA         SS= SENSE BYTE                   * V5045000
*                                  AAAA= DEVICE ADDRESS. 0 FOR BSCA   * V5046000
*                                                                     * V5047000
*              06 = UNUSUAL END                                       * V5048000
*                   06CCAAAA         CC= CSW BYTE 5                   * V5049000
*                                  AAAA= DEVICE ADDRESS. 0 FOR BSCA   * V5050000
*                                                                     * V5051000
*              07 = SIO FAILURE                                       * V5052000
*                   07000000                                          * V5053000
*                                                                     * V5054000
*              08 = ADAPTER WRITE LOGGING                             * V5055000
*                   08OOOOOO       OOOOOO= BYTES 2,3,4 OF OUTPUT DATA * V5056000
*                                                                     * V5057000
*              09 = ALL COMMUNICATION ADAPTER INTERRUPTS              * V5058000
*                   09IIIIII       IIIIII= BYTES 2,3,4 OF INPUT DATA  * V5059000
*                                                                     * V5060000
*********************************************************************** V5061000
         EJECT                                                          V5062000
APARNUM  DC    CL5'40561'          APAR NUMBER                          V5062998
         END   $REPLOAD                                                 V5063000
