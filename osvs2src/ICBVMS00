         TITLE 'ICBVMS00 - OCT 9, 1974 MVS                             *00001000
                        '                                               00002000
ICBVMS00 CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL2(@EP00001-@MAINENT)                                   00007000
         DC    AL1(16)                                             0001 00008000
         DC    C'ICBVMS00  76.348'                                 0001 00009000
ICBVUCIR DS    0H                                                  0001 00010000
         USING *,@15                                               0001 00011000
         B     @PROLOG                                             0001 00012000
         DC    AL2(@EP01495-ICBVUCIR)                                   00013000
         ENTRY ICBVUCIR                                                 00014000
ICBVUBVR DS    0H                                                  0001 00015000
         USING *,@15                                               0001 00016000
         B     @PROLOG                                             0001 00017000
         DC    AL2(@EP01677-ICBVUBVR)                                   00018000
         ENTRY ICBVUBVR                                                 00019000
         DROP  @15                                                      00020000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00021000
         BALR  @12,0                                               0001 00022000
@PSTART  LA    @11,4095(,@12)                                      0001 00023000
         LA    @10,4095(,@11)                                      0001 00024000
         LA    @09,4095(,@10)                                      0001 00025000
         USING @PSTART,@12                                         0001 00026000
         USING @PSTART+4095,@11                                    0001 00027000
         USING @PSTART+8190,@10                                    0001 00028000
         USING @PSTART+12285,@09                                   0001 00029000
         ST    @13,@SA00001+4                                      0001 00030000
         LA    @14,@SA00001                                        0001 00031000
         ST    @14,8(,@13)                                         0001 00032000
         LR    @13,@14                                             0001 00033000
         AH    @15,4(,@15)                                         0001 00034000
         BR    @15                                                 0001 00035000
@EP00001 DS    0H                                                  0002 00036000
*   RPLVPTR=RG1;                    /* ADDR TO REQUEST BLK   @Y30LB25*/ 00037000
         LR    RPLVPTR,RG1                                         0113 00038000
*   RESPECIFY                                                      0114 00039000
*     RG1 UNRSTD;                   /* FREE REG1             @Y30LB25*/ 00040000
*   VVIPTR=RPLVVICB;                /* ADDR TO MSVCB         @Y30LB25*/ 00041000
         L     VVIPTR,RPLVVICB(,RPLVPTR)                           0115 00042000
*   MESGPTR=ADDR(RPLVUTIL);         /* ADDR TO MSC MSG       @Y30LB25*/ 00043000
         LA    MESGPTR,RPLVUTIL(,RPLVPTR)                          0116 00044000
*   GROUPPTR=ADDR(GROUPBUF);        /* ADDR GRP BUF          @Y30LB25*/ 00045000
         LA    @08,GROUPBUF                                        0117 00046000
         ST    @08,GROUPPTR                                        0117 00047000
*   COPYVPTR=ADDR(COPYBUF);         /* ADDR CVR BUF          @Y30LB25*/ 00048000
         LA    COPYVPTR,COPYBUF                                    0118 00049000
*   BASEVPTR=ADDR(BASEBUF);         /* ADDR BVR BUF          @Y30LB25*/ 00050000
         LA    @08,BASEBUF                                         0119 00051000
         ST    @08,BASEVPTR                                        0119 00052000
*   INDEXPTR=ADDR(INDEXBUF);        /* ADDR CIR BUF          @Y30LB25*/ 00053000
         LA    INDEXPTR,INDEXBUF                                   0120 00054000
*   DUPVPTR=ADDR(DUPVBUF);          /* ADDR DUP BUF          @Y30LB25*/ 00055000
         LA    @08,DUPVBUF                                         0121 00056000
         ST    @08,DUPVPTR                                         0121 00057000
*   WORKAREA=WORKAREA&&WORKAREA;    /* ZERO WORK AREA        @Y30LB25*/ 00058000
         XC    WORKAREA(19),WORKAREA                               0122 00059000
*   MSGTCODE=I;                     /* INVENTORY ERROR       @Y30LB25*/ 00060000
         MVI   MSGTCODE,C'I'                                       0123 00061000
*   DIDKY=FIXONE;                   /* SET DVR KEY ID        @Y30LB25*/ 00062000
         MVI   DIDKY,X'01'                                         0124 00063000
*   CIDKY=FIXONE;                   /* SET CVR KEY ID        @Y30LB25*/ 00064000
         MVI   CIDKY,X'01'                                         0125 00065000
*                                                                  0126 00066000
*   /*****************************************************************/ 00067000
*   /*                                                               */ 00068000
*   /* CHECK FOR MSVC DISABLED                               @Y30LB25*/ 00069000
*   /*                                                               */ 00070000
*   /*****************************************************************/ 00071000
*                                                                  0126 00072000
*   IF VVIFLG0=ON                   /* MSVC DISABLED?        @Y30LB25*/ 00073000
*     THEN                          /* YES                   @Y30LB25*/ 00074000
         TM    VVIFLG0(VVIPTR),B'10000000'                         0126 00075000
         BNO   @RF00126                                            0126 00076000
*     DO;                           /* NOTIFY LIBRARIAN      @Y30LB25*/ 00077000
*       MSGTCODE=D;                 /* DISABLED              @Y30LB25*/ 00078000
         MVI   MSGTCODE,C'D'                                       0128 00079000
*       CALL PLIBMSG;               /* OF MSC MESSAGE        @Y30LB25*/ 00080000
         BAL   @14,PLIBMSG                                         0129 00081000
*       RETURN;                     /* RETURN TO ICBVCR00    @Y30LB25*/ 00082000
@EL00001 L     @13,4(,@13)                                         0130 00083000
@EF00001 DS    0H                                                  0130 00084000
@ER00001 LM    @14,@12,12(@13)                                     0130 00085000
         BR    @14                                                 0130 00086000
*     END;                          /*                       @Y30LB25*/ 00087000
*                                                                  0132 00088000
*   /*****************************************************************/ 00089000
*   /*                                                               */ 00090000
*   /* JOURNAL THE RPLV                                      @Y30LB25*/ 00091000
*   /*                                                               */ 00092000
*   /*****************************************************************/ 00093000
*                                                                  0132 00094000
*   CALL PJRNL;                     /* JOURNAL THE RPLV      @Y30LB25*/ 00095000
@RF00126 BAL   @14,PJRNL                                           0132 00096000
*   RPLVFLG=ON;                     /* RPLV JOURNALED        @Y30LB25*/ 00097000
         OI    RPLVFLG,B'00000001'                                 0133 00098000
*                                                                  0134 00099000
*   /*****************************************************************/ 00100000
*   /*                                                               */ 00101000
*   /* CHECK FOR MESSAGE ID (CODE) 04.                       @Y30LB25*/ 00102000
*   /* IF CE CARTRIDGE IS INVOLVED, THEN RETURN.             @Y30LB25*/ 00103000
*   /*                                                               */ 00104000
*   /*****************************************************************/ 00105000
*                                                                  0134 00106000
*   IF CODESM=CRTVOL                /* CREATE VOLUME MSG?    @Y30LB25*/ 00107000
*     THEN                          /* YES                   @Y30LB25*/ 00108000
         LA    @08,8                                               0134 00109000
         ALR   @08,MESGPTR                                         0134 00110000
         CLI   CODESM(@08),X'04'                                   0134 00111000
         BNE   @RF00134                                            0134 00112000
*     IF CECART=ON                  /* CE CART?              @Y30LB25*/ 00113000
*       THEN                        /* YES                   @Y30LB25*/ 00114000
         TM    CECART(@08),B'10000000'                             0135 00115000
         BO    @RT00135                                            0135 00116000
*       RETURN;                     /*                       @Y30LB25*/ 00117000
*     ELSE                          /*                       @Y30LB25*/ 00118000
*       DO;                         /* PROCESS MSC MSG       @Y30LB25*/ 00119000
*         CALL PCRTVOL;             /* FOR CREATE VOL        @Y30LB25*/ 00120000
         BAL   @14,PCRTVOL                                         0138 00121000
*         RETURN;                   /* RETURN TO ICBVCR00    @Y30LB25*/ 00122000
         B     @EL00001                                            0139 00123000
*       END;                        /*                       @Y30LB25*/ 00124000
*                                                                  0141 00125000
*   /*****************************************************************/ 00126000
*   /*                                                               */ 00127000
*   /* CHECK FOR MESSAGE ID (CODE) 0A.                       @Y30LB25*/ 00128000
*   /* IF CE CARTRIDGE IS INVOLVED, THEN RETURN.             @Y30LB25*/ 00129000
*   /*                                                               */ 00130000
*   /*****************************************************************/ 00131000
*                                                                  0141 00132000
*   IF CODESM=ACTVOL                /* ACTIVATE VOL MSG?     @Y30LB25*/ 00133000
*     THEN                          /* YES                   @Y30LB25*/ 00134000
@RF00134 LA    @08,8                                               0141 00135000
         ALR   @08,MESGPTR                                         0141 00136000
         CLI   CODESM(@08),X'0A'                                   0141 00137000
         BNE   @RF00141                                            0141 00138000
*     IF CECART=ON                  /* CE CART?              @Y30LB25*/ 00139000
*       THEN                        /* YES                   @Y30LB25*/ 00140000
         TM    CECART(@08),B'10000000'                             0142 00141000
         BO    @RT00142                                            0142 00142000
*       RETURN;                     /*                       @Y30LB25*/ 00143000
*     ELSE                          /*                       @Y30LB25*/ 00144000
*       DO;                         /* PROCESS MSC MSG       @Y30LB25*/ 00145000
*         CALL PACTVOL;             /* FOR ACTIVATE VOL      @Y30LB25*/ 00146000
         BAL   @14,PACTVOL                                         0145 00147000
*         RETURN;                   /* RETURN TO ICBVCR00    @Y30LB25*/ 00148000
         B     @EL00001                                            0146 00149000
*       END;                        /*                       @Y30LB25*/ 00150000
*                                                                  0148 00151000
*   /*****************************************************************/ 00152000
*   /*                                                               */ 00153000
*   /* CHECK FOR MESSAGE ID (CODE) 0D.                       @Y30LB25*/ 00154000
*   /*                                                               */ 00155000
*   /*****************************************************************/ 00156000
*                                                                  0148 00157000
*   IF CODESM=CPYCRT                /* COPY CART. MSG?       @Y30LB25*/ 00158000
*     THEN                          /* YES                   @Y30LB25*/ 00159000
@RF00141 CLI   CODESM+8(MESGPTR),X'0D'                             0148 00160000
         BNE   @RF00148                                            0148 00161000
*     DO;                           /* PROCESS MSC MSG       @Y30LB25*/ 00162000
*       CALL PCPYCRT;               /* FOR COPY CARTRIDGE    @Y30LB25*/ 00163000
         BAL   @14,PCPYCRT                                         0150 00164000
*       RETURN;                     /* RETURN TO ICBVCR00    @Y30LB25*/ 00165000
         B     @EL00001                                            0151 00166000
*     END;                          /*                       @Y30LB25*/ 00167000
*                                                                  0153 00168000
*   /*****************************************************************/ 00169000
*   /*                                                               */ 00170000
*   /* CHECK FOR MESSAGE ID (CODE) 83.                       @Y30LB25*/ 00171000
*   /*                                                               */ 00172000
*   /*****************************************************************/ 00173000
*                                                                  0153 00174000
*   IF CODEUSM=CAS                  /* C.A.S. MSG?           @Y30LB25*/ 00175000
*     THEN                          /* YES                   @Y30LB25*/ 00176000
@RF00148 CLI   CODEUSM+8(MESGPTR),X'83'                            0153 00177000
         BNE   @RF00153                                            0153 00178000
*     DO;                           /* PROCESS MSC MSG       @Y30LB25*/ 00179000
*       CALL PCAS;                  /* FOR C.A.S.            @Y30LB25*/ 00180000
         BAL   @14,PCAS                                            0155 00181000
*       RETURN;                     /* RETURN TO ICBVCR00    @Y30LB25*/ 00182000
         B     @EL00001                                            0156 00183000
*     END;                          /*                       @Y30LB25*/ 00184000
*   ELSE                            /* WRONG MSG ID          @Y30LB25*/ 00185000
*     RETURN;                       /*                       @Y30LB25*/ 00186000
*                                                                  0159 00187000
*   /*****************************************************************/ 00188000
*   /*                                                               */ 00189000
*   /* PROCEDURE NAME - PJRNL                                @Y30LB25*/ 00190000
*   /*                                                       @Y30LB25*/ 00191000
*   /* FUNCTION - WRITE THE RPLV TO .MSVIJRNL.               @Y30LB25*/ 00192000
*   /*                                                       @Y30LB25*/ 00193000
*   /* INPUT -                                               @Y30LB25*/ 00194000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 00195000
*   /*                                                       @Y30LB25*/ 00196000
*   /* OUTPUT -                                              @Y30LB25*/ 00197000
*   /* ERROR RETURN/REASON CODE IN WORKAREA                  @Y30LB25*/ 00198000
*   /*                                                               */ 00199000
*   /*****************************************************************/ 00200000
*                                                                  0159 00201000
*PJRNL:                             /*                       @Y30LB25*/ 00202000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 00203000
PJRNL    ST    @14,@SA00002                                        0159 00204000
*   RESPECIFY                       /*                       @Y30LB25*/ 00205000
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/ 00206000
*   RESPECIFY                       /*                       @Y30LB25*/ 00207000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 00208000
*   RG0=RESEXVJL;                   /* RESERVE JRNL FLAG     @Y30LB25*/ 00209000
         LA    RG0,17                                              0162 00210000
*   RG1=RPLVPTR;                    /* RPLV PTR              @Y30LB25*/ 00211000
         LR    RG1,RPLVPTR                                         0163 00212000
*   CALL ICBVRR00;                  /* RESERVE JOURNNAL      @Y30LB25*/ 00213000
         L     @15,@CV00611                                        0164 00214000
         BALR  @14,@15                                             0164 00215000
*   CALL ICBVJL00;                  /* JRNL THE RPLV         @Y30LB25*/ 00216000
         L     @15,@CV00612                                        0165 00217000
         BALR  @14,@15                                             0165 00218000
*   RG0=DEQJRNL;                    /* RELEASE JRNL FLAG     @Y30LB25*/ 00219000
         LA    RG0,16                                              0166 00220000
*   CALL ICBVRR00;                  /* RELEASE JOURNNAL      @Y30LB25*/ 00221000
         L     @15,@CV00611                                        0167 00222000
         BALR  @14,@15                                             0167 00223000
*   RESPECIFY                       /*                       @Y30LB25*/ 00224000
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/ 00225000
*   RESPECIFY                       /*                       @Y30LB25*/ 00226000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 00227000
*   RETURN;                         /*                       @Y30LB25*/ 00228000
@EL00002 DS    0H                                                  0170 00229000
@EF00002 DS    0H                                                  0170 00230000
@ER00002 L     @14,@SA00002                                        0170 00231000
         BR    @14                                                 0170 00232000
*   END PJRNL;                      /*                       @Y30LB25*/ 00233000
*                                                                  0172 00234000
*   /*****************************************************************/ 00235000
*   /*                                                               */ 00236000
*   /* PROCEDURE NAME - PLIBMSG                              @Y30LB25*/ 00237000
*   /*                                                       @Y30LB25*/ 00238000
*   /* FUNCTION - SEND A MESSAGE TO THE LIBRARIAN            @Y30LB25*/ 00239000
*   /* INDICATING AN ERROR HAS OCCURRED AND THE INCLUDED     @Y30LB25*/ 00240000
*   /* MSC MESSAGE DID NOT RESULT IN THE COMPLETE UPDATE     @Y30LB25*/ 00241000
*   /* OF MSVC'S RECORDS.                                    @Y30LB25*/ 00242000
*   /*                                                       @Y30LB25*/ 00243000
*   /* INPUT -                                               @Y30LB25*/ 00244000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 00245000
*   /*                                                       @Y30LB25*/ 00246000
*   /* OUTPUT -                                              @Y30LB25*/ 00247000
*   /* MESSAGE DEFINITION PARAMETER LIST                     @Y30LB25*/ 00248000
*   /* MESSAGE ID 412 TO THE LIBRARIAN                       @Y30LB25*/ 00249000
*   /*                                                               */ 00250000
*   /*****************************************************************/ 00251000
*                                                                  0172 00252000
*PLIBMSG:                           /*                       @Y30LB25*/ 00253000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 00254000
PLIBMSG  ST    @14,@SA00003                                        0172 00255000
*   MSGRQ=MSGRQ&&MSGRQ;             /* ZERO MEG REQ BLK      @Y30LB25*/ 00256000
         XC    MSGRQ(32),MSGRQ                                     0173 00257000
*   MSGID=VMSGID1;                  /* SET MSG ID NUMBER     @Y30LB25*/ 00258000
         MVC   MSGID(4),@CF00584                                   0174 00259000
*   MSGTEXT1=ADDR(MSG412);          /* ADDR OF MSG           @Y30LB25*/ 00260000
         LA    @08,MSG412                                          0175 00261000
         STCM  @08,7,MSGTEXT1                                      0175 00262000
*   MSGLEN1=LENGTH(MSG412);         /* LENGTH OF MSG         @Y30LB25*/ 00263000
         MVI   MSGLEN1,X'34'                                       0176 00264000
*   MSGRPLV=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/ 00265000
         ST    RPLVPTR,MSGRPLV                                     0177 00266000
*   RESPECIFY                       /*                       @Y30LB25*/ 00267000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 00268000
*   RG1=ADDR(MSGRQ);                /* ADDR OF MSG BLK       @Y30LB25*/ 00269000
*                                                                  0179 00270000
         LA    RG1,MSGRQ                                           0179 00271000
*   /*****************************************************************/ 00272000
*   /*                                                               */ 00273000
*   /* CHECK FOR CREATE A VOLUME - NO CE CARTRIDGES          @Y30LB25*/ 00274000
*   /*                                                               */ 00275000
*   /*****************************************************************/ 00276000
*                                                                  0180 00277000
*   IF CODESM=CRTVOL&CECART=OFF     /* CREATE VOL AND        @Y30LB25   00278000
*                                      NOT A CE CART?        @Y30LB25*/ 00279000
*     THEN                          /* YES                   @Y30LB25*/ 00280000
         LA    @08,8                                               0180 00281000
         ALR   @08,MESGPTR                                         0180 00282000
         CLI   CODESM(@08),X'04'                                   0180 00283000
         BNE   @RF00180                                            0180 00284000
         TM    CECART(@08),B'10000000'                             0180 00285000
         BNZ   @RF00180                                            0180 00286000
*     DO;                           /*                       @Y30LB25*/ 00287000
*       IDMSG=CRTVOL1;              /* SET MSG ID            @Y30LB25*/ 00288000
         MVC   IDMSG(2),@CC00555                                   0182 00289000
*       CSN1=CSN1SM;                /* CSN1                  @Y30LB25*/ 00290000
         MVC   CSN1(12),CSN1SM(@08)                                0183 00291000
*       CSN2=CSN2SM;                /* CSN2                  @Y30LB25*/ 00292000
         MVC   CSN2(12),CSN2SM(@08)                                0184 00293000
*       VOLID=VOLIDSM;              /* VOLID                 @Y30LB25*/ 00294000
         MVC   VOLID(6),VOLIDSM(@08)                               0185 00295000
*       CALL ICBVOP00;              /* MSG TO LIBRARIAN      @Y30LB25*/ 00296000
         L     @15,@CV00613                                        0186 00297000
         BALR  @14,@15                                             0186 00298000
*       RETURN;                     /*                       @Y30LB25*/ 00299000
@EL00003 DS    0H                                                  0187 00300000
@EF00003 DS    0H                                                  0187 00301000
@ER00003 L     @14,@SA00003                                        0187 00302000
         BR    @14                                                 0187 00303000
*     END;                          /*                       @Y30LB25*/ 00304000
*                                                                  0188 00305000
*   /*****************************************************************/ 00306000
*   /*                                                               */ 00307000
*   /* CHECK FOR ACTIVE VOLUME - NO CE CARTRIDGE             @Y30LB25*/ 00308000
*   /*                                                               */ 00309000
*   /*****************************************************************/ 00310000
*                                                                  0189 00311000
*   IF CODESM=ACTVOL&CECART=OFF     /* ACTIVE VOL AND        @Y30LB25   00312000
*                                      NOT A CE CART?        @Y30LB25*/ 00313000
*     THEN                          /* YES                   @Y30LB25*/ 00314000
@RF00180 LA    @08,8                                               0189 00315000
         ALR   @08,MESGPTR                                         0189 00316000
         CLI   CODESM(@08),X'0A'                                   0189 00317000
         BNE   @RF00189                                            0189 00318000
         TM    CECART(@08),B'10000000'                             0189 00319000
         BNZ   @RF00189                                            0189 00320000
*     DO;                           /*                       @Y30LB25*/ 00321000
*       IDMSG=ACTVOL1;              /* SET MSG ID            @Y30LB25*/ 00322000
         MVC   IDMSG(2),@CC00557                                   0191 00323000
*       CSN1=BLANK12;               /* CSN1 BLANK            @Y30LB25*/ 00324000
         MVC   CSN1(12),@CC00572                                   0192 00325000
*       CSN2=BLANK12;               /* CSN2 BLANK            @Y30LB25*/ 00326000
         MVC   CSN2(12),@CC00572                                   0193 00327000
*       VOLID=VOLIDSM;              /* VOLID                 @Y30LB25*/ 00328000
         MVC   VOLID(6),VOLIDSM(@08)                               0194 00329000
*       CALL ICBVOP00;              /* MSG TO LIBRARIAN      @Y30LB25*/ 00330000
         L     @15,@CV00613                                        0195 00331000
         BALR  @14,@15                                             0195 00332000
*       RETURN;                     /*                       @Y30LB25*/ 00333000
         B     @EL00003                                            0196 00334000
*     END;                          /*                       @Y30LB25*/ 00335000
*                                                                  0197 00336000
*   /*****************************************************************/ 00337000
*   /*                                                               */ 00338000
*   /* CHECK FOR COPY CARTRIDGE                              @ZM30979*/ 00339000
*   /*                                                               */ 00340000
*   /*****************************************************************/ 00341000
*                                                                  0198 00342000
*   IF CODESM=CPYCRT                /* COPY CART             @ZM30979*/ 00343000
*     THEN                          /* YES                   @Y30LB25*/ 00344000
@RF00189 LA    @08,8                                               0198 00345000
         ALR   @08,MESGPTR                                         0198 00346000
         CLI   CODESM(@08),X'0D'                                   0198 00347000
         BNE   @RF00198                                            0198 00348000
*     DO;                           /*                       @Y30LB25*/ 00349000
*       IDMSG=CPYVOL1;              /* SET MSG ID            @Y30LB25*/ 00350000
         MVC   IDMSG(2),@CC00559                                   0200 00351000
*       CSN1=NEWCSN;                /* NEW CSN               @Y30LB25*/ 00352000
         MVC   CSN1(12),NEWCSN(@08)                                0201 00353000
*       CSN2=OLDCSN;                /* OLD CSN               @Y30LB25*/ 00354000
         MVC   CSN2(12),OLDCSN(@08)                                0202 00355000
*       VOLID=VOLIDCSM;             /* VOLID                 @ZM30979*/ 00356000
         MVC   VOLID(6),VOLIDCSM(@08)                              0203 00357000
*       CALL ICBVOP00;              /* MSG TO LIBRARIAN      @Y30LB25*/ 00358000
         L     @15,@CV00613                                        0204 00359000
         BALR  @14,@15                                             0204 00360000
*       RETURN;                     /*                       @Y30LB25*/ 00361000
         B     @EL00003                                            0205 00362000
*     END;                          /*                       @Y30LB25*/ 00363000
*                                                                  0206 00364000
*   /*****************************************************************/ 00365000
*   /*                                                               */ 00366000
*   /* CHECK FOR CARTRIDGE ACCESS STATION                    @Y30LB25*/ 00367000
*   /*                                                               */ 00368000
*   /*****************************************************************/ 00369000
*                                                                  0207 00370000
*   IF CODEUSM=CAS                  /* C .A. S.?             @Y30LB25*/ 00371000
*     THEN                          /* YES                   @Y30LB25*/ 00372000
@RF00198 LA    @08,8                                               0207 00373000
         ALR   @08,MESGPTR                                         0207 00374000
         CLI   CODEUSM(@08),X'83'                                  0207 00375000
         BNE   @RF00207                                            0207 00376000
*     DO;                           /*                       @Y30LB25*/ 00377000
*       IDMSG=CAS1;                 /* SET MSG ID            @Y30LB25*/ 00378000
         MVC   IDMSG(2),@CC00561                                   0209 00379000
*       CSN1=CSN1USM;               /* CSN OF CART ENTER     @Y30LB25*/ 00380000
         MVC   CSN1(12),CSN1USM(@08)                               0210 00381000
*       CSN2=CSN2USM;               /* CSN OF OTHER CART     @Y30LB25*/ 00382000
         MVC   CSN2(12),CSN2USM(@08)                               0211 00383000
*       VOLID=VOLIDUSM;             /* VOLID                 @Y30LB25*/ 00384000
         MVC   VOLID(6),VOLIDUSM(@08)                              0212 00385000
*       CALL ICBVOP00;              /* MSG TO LIBRARIAN      @Y30LB25*/ 00386000
         L     @15,@CV00613                                        0213 00387000
         BALR  @14,@15                                             0213 00388000
*       RETURN;                     /*                       @Y30LB25*/ 00389000
         B     @EL00003                                            0214 00390000
*     END;                          /*                       @Y30LB25*/ 00391000
*   RESPECIFY                                                      0216 00392000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 00393000
*   END PLIBMSG;                    /*                       @Y30LB25*/ 00394000
         B     @EL00003                                            0217 00395000
*                                                                  0218 00396000
*   /*****************************************************************/ 00397000
*   /*                                                               */ 00398000
*   /* PROCEDURE NAME - PCRTVOL (CREATE AN INACTIVE VOLUME)  @Y30LB25*/ 00399000
*   /*                                                       @Y30LB25*/ 00400000
*   /* FUNCTION - RESERVE .MSVI DATA SET. FIND THE BVR       @Y30LB25*/ 00401000
*   /* FOR INPUT VOLID. FOR NO BVR OR AN ERROR CONDITION     @Y30LB25*/ 00402000
*   /* BEFORE ANY MSVC RECORDS ARE CREATED OR UPDATED, A     @Y30LB25*/ 00403000
*   /* MESSAGE IS SENT TO THE LIBRARIAN INDICATING THE       @Y30LB25*/ 00404000
*   /* CONTENTS OF THE INPUT MESSAGE WHICH WAS TO BE USED    @Y30LB25*/ 00405000
*   /* TO UPDATE THE MSVC RECORDS.                           @Y30LB25*/ 00406000
*   /*                                                       @Y30LB25*/ 00407000
*   /* INPUT -                                               @Y30LB25*/ 00408000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 00409000
*   /*                                                       @Y30LB25*/ 00410000
*   /* OUTPUT -                                              @Y30LB25*/ 00411000
*   /*                                                               */ 00412000
*   /*****************************************************************/ 00413000
*                                                                  0218 00414000
*PCRTVOL:                           /* ID 04                 @Y30LB25*/ 00415000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 00416000
*                                                                  0218 00417000
PCRTVOL  ST    @14,@SA00004                                        0218 00418000
*   /*****************************************************************/ 00419000
*   /*                                                               */ 00420000
*   /* RESERVE .MSVI                                         @Y30LB25*/ 00421000
*   /*                                                               */ 00422000
*   /*****************************************************************/ 00423000
*                                                                  0219 00424000
*   RESPECIFY                       /*                       @Y30LB25*/ 00425000
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/ 00426000
*   RESPECIFY                       /*                       @Y30LB25*/ 00427000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 00428000
*   RG0=RESEXINV;                   /* INDICATE RESERVE      @Y30LB25*/ 00429000
         LA    RG0,1                                               0221 00430000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 00431000
         LR    RG1,RPLVPTR                                         0222 00432000
*   CALL ICBVRR00;                  /* RESERVE .MSVI         @Y30LB25*/ 00433000
         L     @15,@CV00611                                        0223 00434000
         BALR  @14,@15                                             0223 00435000
*   RESPECIFY                       /*                       @Y30LB25*/ 00436000
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/ 00437000
*   RESPECIFY                       /*                       @Y30LB25*/ 00438000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 00439000
*                                                                  0225 00440000
*   /*****************************************************************/ 00441000
*   /*                                                               */ 00442000
*   /* READ FOR A BASE VOLUME RECORD                         @Y30LB25*/ 00443000
*   /*                                                               */ 00444000
*   /*****************************************************************/ 00445000
*                                                                  0226 00446000
*   BVOLKY=VOLIDSM;                 /* VOLID FROM SOL MSG    @Y30LB25*/ 00447000
         MVC   BVOLKY(6),VOLIDSM+8(MESGPTR)                        0226 00448000
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/ 00449000
         LA    @08,BKEY                                            0227 00450000
         ST    @08,RPLVKEY(,RPLVPTR)                               0227 00451000
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/ 00452000
         L     @08,BASEVPTR                                        0228 00453000
         ST    @08,RPLVBUF(,RPLVPTR)                               0228 00454000
*   RPLVBLN=LENGTH(BASEBUF);        /* BVR BUFFER LENGTH     @Y30LB25*/ 00455000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0229 00456000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 00457000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0230 00458000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 00459000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0231 00460000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 00461000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0232 00462000
*   RESPECIFY                       /*                       @Y30LB25*/ 00463000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 00464000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 00465000
         LR    RG1,RPLVPTR                                         0234 00466000
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/ 00467000
         L     @15,@CV00610                                        0235 00468000
         BALR  @14,@15                                             0235 00469000
*   RESPECIFY                       /*                       @Y30LB25*/ 00470000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 00471000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 00472000
*     THEN                          /* NO BVR, THEREFORE     @Y30LB25*/ 00473000
         LH    @08,RPLVRETC(,RPLVPTR)                              0237 00474000
         N     @08,@CF00815                                        0237 00475000
         LTR   @08,@08                                             0237 00476000
         BZ    @RF00237                                            0237 00477000
*     DO;                           /* NO CVR                @Y30LB25*/ 00478000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 00479000
         BAL   @14,PLIBMSG                                         0239 00480000
*       RETURN;                     /*                       @Y30LB25*/ 00481000
@EL00004 DS    0H                                                  0240 00482000
@EF00004 DS    0H                                                  0240 00483000
@ER00004 L     @14,@SA00004                                        0240 00484000
         BR    @14                                                 0240 00485000
*     END;                          /*                       @Y30LB25*/ 00486000
*   BCDVPTR=BCDVPTR&&BCDVPTR;       /* ZERO BCD PTR          @Y30LB25   00487000
*                                      NO WARN MSG           @Y30LB25*/ 00488000
*                                                                  0242 00489000
@RF00237 L     @08,BCDVPTR                                         0242 00490000
         LR    @04,@08                                             0242 00491000
         XR    @04,@08                                             0242 00492000
         ST    @04,BCDVPTR                                         0242 00493000
*   /*****************************************************************/ 00494000
*   /*                                                               */ 00495000
*   /* UPDATE THE BASE VOLUME RECORD, IF ANY                 @Y30LB25*/ 00496000
*   /*                                                               */ 00497000
*   /*****************************************************************/ 00498000
*                                                                  0243 00499000
*   CALL PBVR;                      /* UPDT BVR FOR VOLID    @Y30LB25*/ 00500000
         BAL   @14,PBVR                                            0243 00501000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 00502000
*     THEN                          /* NO BVR FOUND          @Y30LB25*/ 00503000
         LH    @08,RPLVRETC(,RPLVPTR)                              0244 00504000
         N     @08,@CF00815                                        0244 00505000
         LTR   @08,@08                                             0244 00506000
         BZ    @RF00244                                            0244 00507000
*     DO;                           /*                       @Y30LB25*/ 00508000
*       RETURN;                     /*                       @Y30LB25*/ 00509000
         B     @EL00004                                            0246 00510000
*     END;                          /*                       @Y30LB25*/ 00511000
*   ELSE                            /*                       @Y30LB25*/ 00512000
*     IF BCDVPTR=BASEVPTR           /* BVR FOUND?            @Y30LB25*/ 00513000
*       THEN                        /*                       @Y30LB25*/ 00514000
@RF00244 CLC   BCDVPTR(4),BASEVPTR                                 0248 00515000
         BNE   @RF00248                                            0248 00516000
*       DO;                         /* YES                   @Y30LB25*/ 00517000
*         RETURN;                   /*                       @Y30LB25*/ 00518000
         B     @EL00004                                            0250 00519000
*       END;                        /*                       @Y30LB25*/ 00520000
*                                                                  0251 00521000
*   /*****************************************************************/ 00522000
*   /*                                                               */ 00523000
*   /* NO BASE VOLUME RECORD WAS FOUND, THEREFORE UPDATE     @Y30LB25*/ 00524000
*   /* A COPY VOLUME RECORD                                  @Y30LB25*/ 00525000
*   /*                                                               */ 00526000
*   /*****************************************************************/ 00527000
*                                                                  0252 00528000
*   CALL FNDCVR;                    /* FIND CVR              @Y30LB25*/ 00529000
@RF00248 BAL   @14,FNDCVR                                          0252 00530000
*   RETURN;                         /*                       @Y30LB25*/ 00531000
         B     @EL00004                                            0253 00532000
*   END PCRTVOL;                    /*                       @Y30LB25*/ 00533000
*                                                                  0255 00534000
*   /*****************************************************************/ 00535000
*   /*                                                               */ 00536000
*   /* PROCEDURE NAME - PBVR                                 @Y30LB25*/ 00537000
*   /*                                                       @Y30LB25*/ 00538000
*   /* FUNCTION - DETERMINE IF BVR IS TO BE UPDATED AND      @Y30LB25*/ 00539000
*   /* WRITTEN TO .MSVI.                                     @Y30LB25*/ 00540000
*   /*                                                       @Y30LB25*/ 00541000
*   /* INPUT -                                               @Y30LB25*/ 00542000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 00543000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 00544000
*   /*                                                       @Y30LB25*/ 00545000
*   /* OUTPUT -                                              @Y30LB25*/ 00546000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 00547000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 00548000
*   /*                                                               */ 00549000
*   /*****************************************************************/ 00550000
*                                                                  0255 00551000
*PBVR:                                                             0255 00552000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 00553000
*                                                                  0255 00554000
PBVR     ST    @14,@SA00005                                        0255 00555000
*   /*****************************************************************/ 00556000
*   /*                                                               */ 00557000
*   /* CHECK IF THIS IS THE MSVC RECORD TO BE UPDATED        @Y30LB25*/ 00558000
*   /*                                                               */ 00559000
*   /*****************************************************************/ 00560000
*                                                                  0256 00561000
*   IF(BASCSN1=BLANK12)&(BASCSN2=BLANK12)/* REC TO BE UPDATED?     0256 00562000
*                                                            @Y30LB25*/ 00563000
*     THEN                          /* YES                   @Y30LB25*/ 00564000
         L     @08,BASEVPTR                                        0256 00565000
         CLC   BASCSN1(12,@08),@CC00572                            0256 00566000
         BNE   @RF00256                                            0256 00567000
         CLC   BASCSN2(12,@08),@CC00572                            0256 00568000
         BNE   @RF00256                                            0256 00569000
*     DO;                           /*                       @Y30LB25*/ 00570000
*                                                                  0257 00571000
*       /*************************************************************/ 00572000
*       /*                                                           */ 00573000
*       /* UPDATE AND WRITE THE BVR                          @Y30LB25*/ 00574000
*       /*                                                           */ 00575000
*       /*************************************************************/ 00576000
*                                                                  0258 00577000
*       BASCSN1=CSN1SM;             /* UPDATE CSN1           @Y30LB25*/ 00578000
         LA    @04,8                                               0258 00579000
         ALR   @04,MESGPTR                                         0258 00580000
         MVC   BASCSN1(12,@08),CSN1SM(@04)                         0258 00581000
*       BASCSN2=CSN2SM;             /* UPDATE CSN2           @Y30LB25*/ 00582000
         MVC   BASCSN2(12,@08),CSN2SM(@04)                         0259 00583000
*       RPLVTYP=RPLVPUT;            /* SET PUT ON            @Y30LB25*/ 00584000
         MVI   RPLVTYP(RPLVPTR),X'01'                              0260 00585000
*       RESPECIFY                   /*                       @Y30LB25*/ 00586000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 00587000
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/ 00588000
         LR    RG1,RPLVPTR                                         0262 00589000
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/ 00590000
         L     @15,@CV00610                                        0263 00591000
         BALR  @14,@15                                             0263 00592000
*       RESPECIFY                   /*                       @Y30LB25*/ 00593000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 00594000
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/ 00595000
*         THEN                      /* I/O ERROR             @Y30LB25*/ 00596000
         LH    @08,RPLVRETC(,RPLVPTR)                              0265 00597000
         N     @08,@CF00815                                        0265 00598000
         LTR   @08,@08                                             0265 00599000
         BZ    @RF00265                                            0265 00600000
*         DO;                       /*                       @Y30LB25*/ 00601000
*           CALL PLIBMSG;           /* MSG TO LIBRARIAN      @Y30LB25*/ 00602000
         BAL   @14,PLIBMSG                                         0267 00603000
*           RETURN;                 /*                       @Y30LB25*/ 00604000
@EL00005 DS    0H                                                  0268 00605000
@EF00005 DS    0H                                                  0268 00606000
@ER00005 L     @14,@SA00005                                        0268 00607000
         BR    @14                                                 0268 00608000
*         END;                      /*                       @Y30LB25*/ 00609000
*       ELSE                        /* CREATE CIRS           @Y30LB25*/ 00610000
*                                                                  0270 00611000
*         /***********************************************************/ 00612000
*         /*                                                         */ 00613000
*         /* CREATE OR UPDATE TWO CIRS                       @Y30LB25*/ 00614000
*         /*                                                         */ 00615000
*         /***********************************************************/ 00616000
*                                                                  0270 00617000
*         DO;                       /*                       @Y30LB25*/ 00618000
@RF00265 DS    0H                                                  0271 00619000
*           BCDVPTR=BASEVPTR;       /* COMMON MAP            @Y30LB25*/ 00620000
         L     @08,BASEVPTR                                        0271 00621000
         ST    @08,BCDVPTR                                         0271 00622000
*           CALL CRT2CIR;           /* CREATE CIRS           @Y30LB25*/ 00623000
         BAL   @14,CRT2CIR                                         0272 00624000
*         END;                      /*                       @Y30LB25*/ 00625000
*     END;                          /*                       @Y30LB25*/ 00626000
*   RETURN;                         /*                       @Y30LB25*/ 00627000
         B     @EL00005                                            0275 00628000
*   END PBVR;                       /*                       @Y30LB25*/ 00629000
         B     @EL00005                                            0276 00630000
*                                                                  0277 00631000
*   /*****************************************************************/ 00632000
*   /*                                                               */ 00633000
*   /* PROCEDURE NAME - FNDCVR                               @Y30LB25*/ 00634000
*   /*                                                       @Y30LB25*/ 00635000
*   /* FUNCTION - FIND, UPDATE, AND WRITE THE CVR TO         @Y30LB25*/ 00636000
*   /* .MSVI FOR THE INPUT CSNS AND VOLID.                   @Y30LB25*/ 00637000
*   /*                                                       @Y30LB25*/ 00638000
*   /* INPUT -                                               @Y30LB25*/ 00639000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 00640000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 00641000
*   /*                                                       @Y30LB25*/ 00642000
*   /* OUTPUT -                                              @Y30LB25*/ 00643000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 00644000
*   /*                                                               */ 00645000
*   /*****************************************************************/ 00646000
*                                                                  0277 00647000
*FNDCVR:                            /*                       @Y30LB25*/ 00648000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 00649000
*                                                                  0277 00650000
FNDCVR   ST    @14,@SA00006                                        0277 00651000
*   /*****************************************************************/ 00652000
*   /*                                                               */ 00653000
*   /* FIND THE CORRECT CVR.                                 @Y30LB25*/ 00654000
*   /* START WITH FIRST CVR INCASE AFTER MCS PROCESSING      @Y30LB25*/ 00655000
*   /* FOR ICBVUT00 IS NOT COMPLETE.                         @Y30LB25*/ 00656000
*   /*                                                               */ 00657000
*   /*****************************************************************/ 00658000
*                                                                  0278 00659000
*   CVOLKY=VOLIDSM;                 /* SET CVR VOLID         @Y30LB25*/ 00660000
         MVC   CVOLKY(6),VOLIDSM+8(MESGPTR)                        0278 00661000
*   CIDKY=FIXONE;                   /* 1ST CVR               @Y30LB25*/ 00662000
         LA    @08,1                                               0279 00663000
         STC   @08,CIDKY                                           0279 00664000
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF CVR KEY       @Y30LB25*/ 00665000
         LA    @04,CKEY                                            0280 00666000
         ST    @04,RPLVKEY(,RPLVPTR)                               0280 00667000
*   RPLVBUF=COPYVPTR;               /* ADDR OF READ BUF      @Y30LB25*/ 00668000
         ST    COPYVPTR,RPLVBUF(,RPLVPTR)                          0281 00669000
*   RPLVBLN=LENGTH(COPYBUF);        /* CVR BUFFER LENGTH     @Y30LB25*/ 00670000
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         0282 00671000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 00672000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0283 00673000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 00674000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0284 00675000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 00676000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0285 00677000
*   A=CIDKY;                        /* SET KEY               @Y30LB25*/ 00678000
         LR    A,@08                                               0286 00679000
*   DO CIDKY=A BY 1 TO 255          /* SEARCH FOR CVR        @Y30LB25*/ 00680000
*         WHILE(RPLVRETC=FIXZERO)|(RPLRCODE=NORECFND);/*     @Y30LB25   00681000
*                                      SEARCH CONDITIONS     @Y30LB25*/ 00682000
         LR    @08,A                                               0287 00683000
         STC   @08,CIDKY                                           0287 00684000
         B     @DE00287                                            0287 00685000
@DL00287 LH    @08,RPLVRETC(,RPLVPTR)                              0287 00686000
         N     @08,@CF00815                                        0287 00687000
         LTR   @08,@08                                             0287 00688000
         BZ    @DB00287                                            0287 00689000
         CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0287 00690000
         BNE   @DC00287                                            0287 00691000
@DB00287 DS    0H                                                  0288 00692000
*     RESPECIFY                     /*                       @Y30LB25*/ 00693000
*       RG1 RSTD;                   /* RESTRICT REG 1        @Y30LB25*/ 00694000
*     RG1=RPLVPTR;                  /* PTR TO RPLV           @Y30LB25*/ 00695000
         LR    RG1,RPLVPTR                                         0289 00696000
*     CALL ICBVIO00;                /* READ FOR CVR          @Y30LB25*/ 00697000
         L     @15,@CV00610                                        0290 00698000
         BALR  @14,@15                                             0290 00699000
*     RESPECIFY                     /*                       @Y30LB25*/ 00700000
*       RG1 UNRSTD;                 /* UNRESTRICT REG 1      @Y30LB25*/ 00701000
*                                                                  0291 00702000
*     /***************************************************************/ 00703000
*     /*                                                             */ 00704000
*     /* CHECK FOR CORRECT CVR                               @Y30LB25*/ 00705000
*     /*                                                             */ 00706000
*     /***************************************************************/ 00707000
*                                                                  0292 00708000
*     IF(COPCSN1=BLANK12)&(COPCSN2=BLANK12)&(RPLVRETC=FIXZERO)/* REC    00709000
*                                      TO BE UPDATED?        @Y30LB25*/ 00710000
*       THEN                        /* YES                   @Y30LB25*/ 00711000
         CLC   COPCSN1(12,COPYVPTR),@CC00572                       0292 00712000
         BNE   @RF00292                                            0292 00713000
         CLC   COPCSN2(12,COPYVPTR),@CC00572                       0292 00714000
         BNE   @RF00292                                            0292 00715000
         LH    @08,RPLVRETC(,RPLVPTR)                              0292 00716000
         N     @08,@CF00815                                        0292 00717000
         LTR   @08,@08                                             0292 00718000
         BNZ   @RF00292                                            0292 00719000
*       DO;                         /*                       @Y30LB25*/ 00720000
*                                                                  0293 00721000
*         /***********************************************************/ 00722000
*         /*                                                         */ 00723000
*         /* UPDATE AND WRITE THE CVR                        @Y30LB25*/ 00724000
*         /*                                                         */ 00725000
*         /***********************************************************/ 00726000
*                                                                  0294 00727000
*         COPCSN1=CSN1SM;           /* UPDATE CSN1           @Y30LB25*/ 00728000
         LA    @08,8                                               0294 00729000
         ALR   @08,MESGPTR                                         0294 00730000
         MVC   COPCSN1(12,COPYVPTR),CSN1SM(@08)                    0294 00731000
*         COPCSN2=CSN2SM;           /* UPDATE CSN2           @Y30LB25*/ 00732000
         MVC   COPCSN2(12,COPYVPTR),CSN2SM(@08)                    0295 00733000
*         RPLVTYP=RPLVPUT;          /* WRITE REQUEST         @Y30LB25*/ 00734000
         MVI   RPLVTYP(RPLVPTR),X'01'                              0296 00735000
*         RESPECIFY                 /*                       @Y30LB25*/ 00736000
*           RG1 RSTD;               /* RESTRICT REG 1        @Y30LB25*/ 00737000
*         RG1=RPLVPTR;              /* PTR TO RPLV           @Y30LB25*/ 00738000
         LR    RG1,RPLVPTR                                         0298 00739000
*         CALL ICBVIO00;            /* WRITE CVR             @Y30LB25*/ 00740000
         L     @15,@CV00610                                        0299 00741000
         BALR  @14,@15                                             0299 00742000
*         RESPECIFY                 /*                       @Y30LB25*/ 00743000
*           RG1 UNRSTD;             /* UNRESTRICT REG 1      @Y30LB25*/ 00744000
*         IF RPLVRETC^=FIXZERO      /* CHECK RETN CODE       @Y30LB25*/ 00745000
*           THEN                    /*                       @Y30LB25*/ 00746000
         LH    @08,RPLVRETC(,RPLVPTR)                              0301 00747000
         N     @08,@CF00815                                        0301 00748000
         LTR   @08,@08                                             0301 00749000
         BZ    @RF00301                                            0301 00750000
*           DO;                     /*                       @Y30LB25*/ 00751000
*             CALL PLIBMSG;         /* MSG TO LIBRARIAN      @Y30LB25*/ 00752000
         BAL   @14,PLIBMSG                                         0303 00753000
*             RETURN;               /*                       @Y30LB25*/ 00754000
@EL00006 DS    0H                                                  0304 00755000
@EF00006 DS    0H                                                  0304 00756000
@ER00006 L     @14,@SA00006                                        0304 00757000
         BR    @14                                                 0304 00758000
*           END;                    /*                       @Y30LB25*/ 00759000
*         ELSE                      /*                       @Y30LB25*/ 00760000
*                                                                  0306 00761000
*           /*********************************************************/ 00762000
*           /*                                                       */ 00763000
*           /* CREATE OR UPDATE TWO CIRS                     @Y30LB25*/ 00764000
*           /*                                                       */ 00765000
*           /*********************************************************/ 00766000
*                                                                  0306 00767000
*           DO;                     /* CREATE/UPDATE CIRS    @Y30LB25*/ 00768000
@RF00301 DS    0H                                                  0307 00769000
*             BCDVPTR=COPYVPTR;     /* COMMON MAP            @Y30LB25*/ 00770000
         ST    COPYVPTR,BCDVPTR                                    0307 00771000
*             CALL CRT2CIR;         /* CREATE CIRS           @Y30LB25*/ 00772000
         BAL   @14,CRT2CIR                                         0308 00773000
*             RETURN;               /*                       @Y30LB25*/ 00774000
         B     @EL00006                                            0309 00775000
*           END;                    /*                       @Y30LB25*/ 00776000
*       END;                        /*                       @Y30LB25*/ 00777000
*   END;                            /*                       @Y30LB25*/ 00778000
*                                                                  0312 00779000
@RF00292 LA    @08,1                                               0312 00780000
         SLR   @04,@04                                             0312 00781000
         IC    @04,CIDKY                                           0312 00782000
         ALR   @08,@04                                             0312 00783000
         STC   @08,CIDKY                                           0312 00784000
@DE00287 C     @08,@CF00546                                        0312 00785000
         BNH   @DL00287                                            0312 00786000
@DC00287 DS    0H                                                  0313 00787000
*   /*****************************************************************/ 00788000
*   /*                                                               */ 00789000
*   /* ERROR - NO CVR OR BVR EXISTS, OR AN I/O ERROR OCCURED @Y30LB25*/ 00790000
*   /*                                                               */ 00791000
*   /*****************************************************************/ 00792000
*                                                                  0313 00793000
*   CALL PLIBMSG;                   /* MSG TO LIBRARIAN      @Y30LB25   00794000
*                                      NO CVR TO USE         @Y30LB25*/ 00795000
         BAL   @14,PLIBMSG                                         0313 00796000
*   RETURN;                         /*                       @Y30LB25*/ 00797000
         B     @EL00006                                            0314 00798000
*   END FNDCVR;                     /*                       @Y30LB25*/ 00799000
*                                                                  0316 00800000
*   /*****************************************************************/ 00801000
*   /*                                                               */ 00802000
*   /* PROCEDURE NAME - PACTVOL (ACTIVATE AN INACTIVE        @Y30LB25*/ 00803000
*   /* VOLUME)                                               @Y30LB25*/ 00804000
*   /*                                                       @Y30LB25*/ 00805000
*   /* FUNCTION - GET BVR AND UPDATE ITS ATTRIBUTES.         @Y30LB25*/ 00806000
*   /* WRITE THE BVR.                                        @Y30LB25*/ 00807000
*   /*                                                       @Y30LB25*/ 00808000
*   /* INPUT -                                               @Y30LB25*/ 00809000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 00810000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 00811000
*   /*                                                       @Y30LB25*/ 00812000
*   /* OUTPUT -                                              @Y30LB25*/ 00813000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 00814000
*   /*                                                               */ 00815000
*   /*****************************************************************/ 00816000
*                                                                  0316 00817000
*PACTVOL:                           /* ID 0A                 @Y30LB25*/ 00818000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 00819000
*                                                                  0316 00820000
PACTVOL  ST    @14,@SA00007                                        0316 00821000
*   /*****************************************************************/ 00822000
*   /*                                                               */ 00823000
*   /* RESERVE .MSVI                                         @Y30LB25*/ 00824000
*   /*                                                               */ 00825000
*   /*****************************************************************/ 00826000
*                                                                  0317 00827000
*   RESPECIFY                       /*                       @Y30LB25*/ 00828000
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/ 00829000
*   RESPECIFY                       /*                       @Y30LB25*/ 00830000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 00831000
*   RG0=RESEXINV;                   /* INDICATE RESERVE      @Y30LB25*/ 00832000
         LA    RG0,1                                               0319 00833000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 00834000
         LR    RG1,RPLVPTR                                         0320 00835000
*   CALL ICBVRR00;                  /* RESERVE .MSVI         @Y30LB25*/ 00836000
         L     @15,@CV00611                                        0321 00837000
         BALR  @14,@15                                             0321 00838000
*   RESPECIFY                       /*                       @Y30LB25*/ 00839000
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/ 00840000
*   RESPECIFY                       /*                       @Y30LB25*/ 00841000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 00842000
*                                                                  0323 00843000
*   /*****************************************************************/ 00844000
*   /*                                                               */ 00845000
*   /* GET THE BVR                                           @Y30LB25*/ 00846000
*   /*                                                               */ 00847000
*   /*****************************************************************/ 00848000
*                                                                  0324 00849000
*   BVOLKY=VOLIDSM;                 /* VOLID FROM SOL MSG    @Y30LB25*/ 00850000
         MVC   BVOLKY(6),VOLIDSM+8(MESGPTR)                        0324 00851000
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/ 00852000
         LA    @08,BKEY                                            0325 00853000
         ST    @08,RPLVKEY(,RPLVPTR)                               0325 00854000
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/ 00855000
         L     @08,BASEVPTR                                        0326 00856000
         ST    @08,RPLVBUF(,RPLVPTR)                               0326 00857000
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BVR BUF LENGTH    @Y30LB25*/ 00858000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0327 00859000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 00860000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0328 00861000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 00862000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0329 00863000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 00864000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0330 00865000
*   RESPECIFY                       /*                       @Y30LB25*/ 00866000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 00867000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 00868000
         LR    RG1,RPLVPTR                                         0332 00869000
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/ 00870000
         L     @15,@CV00610                                        0333 00871000
         BALR  @14,@15                                             0333 00872000
*   RESPECIFY                       /*                       @Y30LB25*/ 00873000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 00874000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 00875000
*     THEN                          /*                       @Y30LB25*/ 00876000
         LH    @08,RPLVRETC(,RPLVPTR)                              0335 00877000
         N     @08,@CF00815                                        0335 00878000
         LTR   @08,@08                                             0335 00879000
         BZ    @RF00335                                            0335 00880000
*     DO;                           /*                       @Y30LB25*/ 00881000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 00882000
         BAL   @14,PLIBMSG                                         0337 00883000
*       RETURN;                     /*                       @Y30LB25*/ 00884000
@EL00007 DS    0H                                                  0338 00885000
@EF00007 DS    0H                                                  0338 00886000
@ER00007 L     @14,@SA00007                                        0338 00887000
         BR    @14                                                 0338 00888000
*     END;                          /*                       @Y30LB25*/ 00889000
*                                                                  0339 00890000
*   /*****************************************************************/ 00891000
*   /*                                                               */ 00892000
*   /* SET ATTRIBUTES                                        @Y30LB25*/ 00893000
*   /*                                                               */ 00894000
*   /*****************************************************************/ 00895000
*                                                                  0340 00896000
*   BASEXCL=OFF;                    /* CLEAR EXCLUSIVE       @Y30LB25*/ 00897000
@RF00335 L     @08,BASEVPTR                                        0340 00898000
         NI    BASEXCL(@08),B'11111110'                            0340 00899000
*   BASDAERA=OFF;                   /* CLEAR DASD ERASE      @Y30LB25*/ 00900000
         NI    BASDAERA(@08),B'01111111'                           0341 00901000
*   BASBIND=OFF;                    /* CLEAR BIND            @Y30LB25*/ 00902000
         NI    BASBIND(@08),B'11111101'                            0342 00903000
*   BASRONLY=OFF;                   /* CLEAR READ ONLY       @Y30LB25*/ 00904000
         NI    BASRONLY(@08),B'10111111'                           0343 00905000
*   IF EXCLATTB=ON                  /* SET EXCLUS ATTB?      @Y30LB25*/ 00906000
*     THEN                          /* YES                   @Y30LB25*/ 00907000
         TM    EXCLATTB+8(MESGPTR),B'00010000'                     0344 00908000
         BNO   @RF00344                                            0344 00909000
*     BASEXCL=ON;                   /* SET EXCLUSIVE         @Y30LB25*/ 00910000
         OI    BASEXCL(@08),B'00000001'                            0345 00911000
*   IF SECVOL=ON                    /* DASD ERASE?           @Y30LB25*/ 00912000
*     THEN                          /* YES                   @Y30LB25*/ 00913000
@RF00344 TM    SECVOL+8(MESGPTR),B'00100000'                       0346 00914000
         BNO   @RF00346                                            0346 00915000
*     BASDAERA=ON;                  /* DASD ERASE            @Y30LB25*/ 00916000
         L     @08,BASEVPTR                                        0347 00917000
         OI    BASDAERA(@08),B'10000000'                           0347 00918000
*   IF BINDATTB=ON                  /* SET BIND ATTB?        @Y30LB25*/ 00919000
*     THEN                          /* YES                   @Y30LB25*/ 00920000
@RF00346 TM    BINDATTB+8(MESGPTR),B'00000100'                     0348 00921000
         BNO   @RF00348                                            0348 00922000
*     BASBIND=ON;                   /* SET BIND              @Y30LB25*/ 00923000
         L     @08,BASEVPTR                                        0349 00924000
         OI    BASBIND(@08),B'00000010'                            0349 00925000
*   IF RONLYATB=ON                  /* READ ONLY ATTB?       @Y30LB25*/ 00926000
*     THEN                          /* YES                   @Y30LB25*/ 00927000
@RF00348 TM    RONLYATB+8(MESGPTR),B'00000010'                     0350 00928000
         BNO   @RF00350                                            0350 00929000
*     BASRONLY=ON;                  /* SET READ ONLY         @Y30LB25*/ 00930000
*                                                                  0351 00931000
         L     @08,BASEVPTR                                        0351 00932000
         OI    BASRONLY(@08),B'01000000'                           0351 00933000
*   /*****************************************************************/ 00934000
*   /*                                                               */ 00935000
*   /* WRITE THE RECORD                                      @Y30LB25*/ 00936000
*   /*                                                               */ 00937000
*   /*****************************************************************/ 00938000
*                                                                  0352 00939000
*   RPLVTYP=RPLVPUT;                /* SET PUT ON            @Y30LB25*/ 00940000
@RF00350 MVI   RPLVTYP(RPLVPTR),X'01'                              0352 00941000
*   RESPECIFY                       /*                       @Y30LB25*/ 00942000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 00943000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 00944000
         LR    RG1,RPLVPTR                                         0354 00945000
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/ 00946000
         L     @15,@CV00610                                        0355 00947000
         BALR  @14,@15                                             0355 00948000
*   RESPECIFY                       /*                       @Y30LB25*/ 00949000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 00950000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 00951000
*     THEN                          /*                       @Y30LB25*/ 00952000
         LH    @08,RPLVRETC(,RPLVPTR)                              0357 00953000
         N     @08,@CF00815                                        0357 00954000
         LTR   @08,@08                                             0357 00955000
         BZ    @RF00357                                            0357 00956000
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/ 00957000
         BAL   @14,PLIBMSG                                         0358 00958000
*   RETURN;                         /*                       @Y30LB25*/ 00959000
         B     @EL00007                                            0359 00960000
*   END PACTVOL;                    /*                       @Y30LB25*/ 00961000
         B     @EL00007                                            0360 00962000
*                                                                  0361 00963000
*   /*****************************************************************/ 00964000
*   /*                                                               */ 00965000
*   /* PROCEDURE NAME - PCPYCRT (COPY CARTRIDGE)             @Y30LB25*/ 00966000
*   /*                                                       @Y30LB25*/ 00967000
*   /* FUNCTION - GET THE BVR AND UPDATE ITS CSN FIELD FOR   @Y30LB25*/ 00968000
*   /* THE NEW CSN. WRITE THE BVR. DELETE THE CIR FOR        @Y30LB25*/ 00969000
*   /* THE OLD CSN - NONE FOUND IS OK.                       @Y30LB25*/ 00970000
*   /*                                                       @Y30LB25*/ 00971000
*   /* INPUT -                                               @Y30LB25*/ 00972000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 00973000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 00974000
*   /*                                                       @Y30LB25*/ 00975000
*   /* OUTPUT -                                              @Y30LB25*/ 00976000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 00977000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 00978000
*   /*                                                               */ 00979000
*   /*****************************************************************/ 00980000
*                                                                  0361 00981000
*PCPYCRT:                           /* ID 0D                 @Y30LB25*/ 00982000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 00983000
*                                                                  0361 00984000
PCPYCRT  ST    @14,@SA00008                                        0361 00985000
*   /*****************************************************************/ 00986000
*   /*                                                               */ 00987000
*   /* RESERVE .MSVI                                         @Y30LB25*/ 00988000
*   /*                                                               */ 00989000
*   /*****************************************************************/ 00990000
*                                                                  0362 00991000
*   RESPECIFY                       /*                       @Y30LB25*/ 00992000
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/ 00993000
*   RESPECIFY                       /*                       @Y30LB25*/ 00994000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 00995000
*   RG0=RESEXINV;                   /* INDICATE RESERVE      @Y30LB25*/ 00996000
         LA    RG0,1                                               0364 00997000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 00998000
         LR    RG1,RPLVPTR                                         0365 00999000
*   CALL ICBVRR00;                  /* RESERVE .MSVI         @Y30LB25*/ 01000000
         L     @15,@CV00611                                        0366 01001000
         BALR  @14,@15                                             0366 01002000
*   RESPECIFY                       /*                       @Y30LB25*/ 01003000
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/ 01004000
*   RESPECIFY                       /*                       @Y30LB25*/ 01005000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01006000
*                                                                  0368 01007000
*   /*****************************************************************/ 01008000
*   /*                                                               */ 01009000
*   /* GET THE BVR                                           @Y30LB25*/ 01010000
*   /*                                                               */ 01011000
*   /*****************************************************************/ 01012000
*                                                                  0369 01013000
*   BVOLKY=VOLIDCSM;                /* VOLID FROM SOL MSG    @ZM30979*/ 01014000
         MVC   BVOLKY(6),VOLIDCSM+8(MESGPTR)                       0369 01015000
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/ 01016000
         LA    @08,BKEY                                            0370 01017000
         ST    @08,RPLVKEY(,RPLVPTR)                               0370 01018000
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/ 01019000
         L     @08,BASEVPTR                                        0371 01020000
         ST    @08,RPLVBUF(,RPLVPTR)                               0371 01021000
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BVR BUF LENGTH    @Y30LB25*/ 01022000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0372 01023000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 01024000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0373 01025000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 01026000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0374 01027000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 01028000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0375 01029000
*   RESPECIFY                       /*                       @Y30LB25*/ 01030000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 01031000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 01032000
         LR    RG1,RPLVPTR                                         0377 01033000
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/ 01034000
         L     @15,@CV00610                                        0378 01035000
         BALR  @14,@15                                             0378 01036000
*   RESPECIFY                       /*                       @Y30LB25*/ 01037000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01038000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 01039000
*     THEN                          /*                       @Y30LB25*/ 01040000
         LH    @08,RPLVRETC(,RPLVPTR)                              0380 01041000
         N     @08,@CF00815                                        0380 01042000
         LTR   @08,@08                                             0380 01043000
         BZ    @RF00380                                            0380 01044000
*     DO;                           /*                       @Y30LB25*/ 01045000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 01046000
         BAL   @14,PLIBMSG                                         0382 01047000
*       RETURN;                     /*                       @Y30LB25*/ 01048000
@EL00008 DS    0H                                                  0383 01049000
@EF00008 DS    0H                                                  0383 01050000
@ER00008 L     @14,@SA00008                                        0383 01051000
         BR    @14                                                 0383 01052000
*     END;                          /*                       @Y30LB25*/ 01053000
*                                                                  0384 01054000
*   /*****************************************************************/ 01055000
*   /*                                                               */ 01056000
*   /* UPDATE BVR CSN                                        @Y30LB25*/ 01057000
*   /*                                                               */ 01058000
*   /*****************************************************************/ 01059000
*                                                                  0385 01060000
*   IF OLDCSN=BASCSN1               /* CART COPIED?          @Y30LB25*/ 01061000
*     THEN                          /* YES                   @Y30LB25*/ 01062000
@RF00380 LA    @08,8                                               0385 01063000
         ALR   @08,MESGPTR                                         0385 01064000
         L     @04,BASEVPTR                                        0385 01065000
         CLC   OLDCSN(12,@08),BASCSN1(@04)                         0385 01066000
         BNE   @RF00385                                            0385 01067000
*     DO;                           /*                       @Y30LB25*/ 01068000
*       CSNUMBER=ON;                /* CSN1 FOR ICBVUCIR     @Y30LB25*/ 01069000
         OI    CSNUMBER,B'00000100'                                0387 01070000
*       BASCSN1=NEWCSN;             /* UPDATE CSN            @Y30LB25*/ 01071000
         MVC   BASCSN1(12,@04),NEWCSN(@08)                         0388 01072000
*     END;                          /*                       @Y30LB25*/ 01073000
*   ELSE                            /* CHECK OTHER CSN       @Y30LB25*/ 01074000
*     IF OLDCSN=BASCSN2             /* CART COPIED?          @Y30LB25*/ 01075000
*       THEN                        /* YES                   @Y30LB25*/ 01076000
         B     @RC00385                                            0390 01077000
@RF00385 LA    @08,8                                               0390 01078000
         ALR   @08,MESGPTR                                         0390 01079000
         L     @04,BASEVPTR                                        0390 01080000
         CLC   OLDCSN(12,@08),BASCSN2(@04)                         0390 01081000
         BNE   @RF00390                                            0390 01082000
*       DO;                         /*                       @Y30LB25*/ 01083000
*         CSNUMBER=OFF;             /* CSN1 FOR ICBVUCIR     @Y30LB25*/ 01084000
         NI    CSNUMBER,B'11111011'                                0392 01085000
*         BASCSN2=NEWCSN;           /* UPDATE CSN            @Y30LB25*/ 01086000
         MVC   BASCSN2(12,@04),NEWCSN(@08)                         0393 01087000
*       END;                        /*                       @Y30LB25*/ 01088000
*     ELSE                          /* ERROR                 @Y30LB25*/ 01089000
*       DO;                         /*                       @Y30LB25*/ 01090000
         B     @RC00390                                            0395 01091000
@RF00390 DS    0H                                                  0396 01092000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 01093000
         BAL   @14,PLIBMSG                                         0396 01094000
*         RETURN;                   /*                       @Y30LB25*/ 01095000
         B     @EL00008                                            0397 01096000
*       END;                        /*                       @Y30LB25*/ 01097000
*                                                                  0398 01098000
*   /*****************************************************************/ 01099000
*   /*                                                               */ 01100000
*   /* WRITE THE BVR                                         @Y30LB25*/ 01101000
*   /*                                                               */ 01102000
*   /*****************************************************************/ 01103000
*                                                                  0399 01104000
*   RPLVTYP=RPLVPUT;                /* SET PUT ON            @Y30LB25*/ 01105000
@RC00390 DS    0H                                                  0399 01106000
@RC00385 MVI   RPLVTYP(RPLVPTR),X'01'                              0399 01107000
*   RESPECIFY                       /*                       @Y30LB25*/ 01108000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 01109000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 01110000
         LR    RG1,RPLVPTR                                         0401 01111000
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/ 01112000
         L     @15,@CV00610                                        0402 01113000
         BALR  @14,@15                                             0402 01114000
*   RESPECIFY                       /*                       @Y30LB25*/ 01115000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01116000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 01117000
*     THEN                          /*                       @Y30LB25*/ 01118000
         LH    @08,RPLVRETC(,RPLVPTR)                              0404 01119000
         N     @08,@CF00815                                        0404 01120000
         LTR   @08,@08                                             0404 01121000
         BZ    @RF00404                                            0404 01122000
*     DO;                           /*                       @Y30LB25*/ 01123000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 01124000
         BAL   @14,PLIBMSG                                         0406 01125000
*       RETURN;                     /*                       @Y30LB25*/ 01126000
         B     @EL00008                                            0407 01127000
*     END;                          /*                       @Y30LB25*/ 01128000
*                                                                  0408 01129000
*   /*****************************************************************/ 01130000
*   /*                                                               */ 01131000
*   /* PROCESS AND CREATE A CIR                              @Y30LB25*/ 01132000
*   /*                                                               */ 01133000
*   /*****************************************************************/ 01134000
*                                                                  0409 01135000
*   BCDVPTR=BASEVPTR;               /* PTR TO BVR            @Y30LB25*/ 01136000
@RF00404 L     @08,BASEVPTR                                        0409 01137000
         ST    @08,BCDVPTR                                         0409 01138000
*   CALL VUCIR;                     /*                       @Y30LB25   01139000
*                                      PROC/CREATE CIR       @Y30LB25*/ 01140000
         BAL   @14,VUCIR                                           0410 01141000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 01142000
*     THEN                          /*                       @Y30LB25*/ 01143000
         LH    @08,RPLVRETC(,RPLVPTR)                              0411 01144000
         N     @08,@CF00815                                        0411 01145000
         LTR   @08,@08                                             0411 01146000
         BZ    @RF00411                                            0411 01147000
*     DO;                           /*                       @Y30LB25*/ 01148000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 01149000
         BAL   @14,PLIBMSG                                         0413 01150000
*       RETURN;                     /*                       @Y30LB25*/ 01151000
         B     @EL00008                                            0414 01152000
*     END;                          /*                       @Y30LB25*/ 01153000
*                                                                  0415 01154000
*   /*****************************************************************/ 01155000
*   /*                                                               */ 01156000
*   /* GET CIR FOR THE OLD CSN                               @Y30LB25*/ 01157000
*   /*                                                               */ 01158000
*   /*****************************************************************/ 01159000
*                                                                  0416 01160000
*   IVOLKY=OLDCSN;                  /* SET THE KEY           @Y30LB25*/ 01161000
@RF00411 MVC   IVOLKY(12),OLDCSN+8(MESGPTR)                        0416 01162000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 01163000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0417 01164000
*   RPLVLOC=OFF;                    /* LOCATE OFF            @Y30LB25*/ 01165000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0418 01166000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 01167000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0419 01168000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 01169000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0420 01170000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 01171000
         LA    @08,IKEY                                            0421 01172000
         ST    @08,RPLVKEY(,RPLVPTR)                               0421 01173000
*   RPLVBUF=INDEXPTR;               /* ADDR OF BUFFER        @Y30LB25*/ 01174000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0422 01175000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/ 01176000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0423 01177000
*   RESPECIFY                       /*                       @Y30LB25*/ 01178000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 01179000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 01180000
         LR    RG1,RPLVPTR                                         0425 01181000
*   CALL ICBVIO00;                  /* READ FOR CIR          @Y30LB25*/ 01182000
         L     @15,@CV00610                                        0426 01183000
         BALR  @14,@15                                             0426 01184000
*   RESPECIFY                       /*                       @Y30LB25*/ 01185000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01186000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETURN CODE     @Y30LB25*/ 01187000
*     THEN                          /*                       @Y30LB25*/ 01188000
         LH    @08,RPLVRETC(,RPLVPTR)                              0428 01189000
         N     @08,@CF00815                                        0428 01190000
         LTR   @08,@08                                             0428 01191000
         BZ    @RF00428                                            0428 01192000
*     DO;                           /*                       @Y30LB25*/ 01193000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 01194000
         BAL   @14,PLIBMSG                                         0430 01195000
*       RETURN;                     /*                       @Y30LB25*/ 01196000
         B     @EL00008                                            0431 01197000
*     END;                          /*                       @Y30LB25*/ 01198000
*   IF INDVSRNO^=VOLIDCSM           /* CORRECT CIR?          @ZM30979*/ 01199000
*     THEN                          /* NO                    @Y30LB25*/ 01200000
@RF00428 CLC   INDVSRNO(6,INDEXPTR),VOLIDCSM+8(MESGPTR)            0433 01201000
         BE    @RF00433                                            0433 01202000
*     DO;                           /*                       @Y30LB25*/ 01203000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 01204000
         BAL   @14,PLIBMSG                                         0435 01205000
*       RETURN;                     /*                       @Y30LB25*/ 01206000
         B     @EL00008                                            0436 01207000
*     END;                          /*                       @Y30LB25*/ 01208000
*                                                                  0437 01209000
*   /*****************************************************************/ 01210000
*   /*                                                               */ 01211000
*   /* DELETE THE CIR FOR THE OLD CSN                        @Y30LB25*/ 01212000
*   /*                                                               */ 01213000
*   /*****************************************************************/ 01214000
*                                                                  0438 01215000
*   RPLVTYP=RPLVDEL;                /* DELETE ON             @Y30LB25*/ 01216000
@RF00433 MVI   RPLVTYP(RPLVPTR),X'05'                              0438 01217000
*   RPLVBUF=INDEXPTR;               /* ADDR OF BUFFER        @Y30LB25*/ 01218000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0439 01219000
*   RESPECIFY                       /*                       @Y30LB25*/ 01220000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 01221000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 01222000
         LR    RG1,RPLVPTR                                         0441 01223000
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/ 01224000
         L     @15,@CV00610                                        0442 01225000
         BALR  @14,@15                                             0442 01226000
*   RESPECIFY                       /*                       @Y30LB25*/ 01227000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01228000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETURN CODE     @Y30LB25*/ 01229000
*     THEN                          /* ERROR                 @Y30LB25*/ 01230000
         LH    @08,RPLVRETC(,RPLVPTR)                              0444 01231000
         N     @08,@CF00815                                        0444 01232000
         LTR   @08,@08                                             0444 01233000
         BZ    @RF00444                                            0444 01234000
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/ 01235000
         BAL   @14,PLIBMSG                                         0445 01236000
*   RETURN;                         /*                       @Y30LB25*/ 01237000
         B     @EL00008                                            0446 01238000
*   END PCPYCRT;                    /*                       @Y30LB25*/ 01239000
         B     @EL00008                                            0447 01240000
*                                                                  0448 01241000
*   /*****************************************************************/ 01242000
*   /*                                                               */ 01243000
*   /* PROCEDURE NAME - PCAS (CARTRIDGE ACCESS STATION)      @Y30LB25*/ 01244000
*   /*                                                       @Y30LB25*/ 01245000
*   /* FUNCTION - RESERVE .MSVI DATA SET.                    @Y30LB25*/ 01246000
*   /* PROCESS CARTRIDGES ENTERED AT THE CARTRIDGE           @Y30LB25*/ 01247000
*   /* ACCESS STATION (CAS). FIND AND UPDATE THE             @Y30LB25*/ 01248000
*   /* CORRECT MSVC RECORD FOR THE CARTRIDGE ENTERED.        @Y30LB25*/ 01249000
*   /* IF NONE CAN BE FOUND, TRY TO FIND THE CORRECT MSVC    @Y30LB25*/ 01250000
*   /* RECORD FOR THE OTHER CARTRIDGE OF THE PAIR (THE ONE   @Y30LB25*/ 01251000
*   /* NOT ENTERED)                                          @Y30LB25*/ 01252000
*   /*                                                       @Y30LB25*/ 01253000
*   /* INPUT -                                               @Y30LB25*/ 01254000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 01255000
*   /*                                                       @Y30LB25*/ 01256000
*   /* OUTPUT -                                              @Y30LB25*/ 01257000
*   /*                                                               */ 01258000
*   /*****************************************************************/ 01259000
*                                                                  0448 01260000
*PCAS:                              /* ID 83                 @Y30LB25*/ 01261000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 01262000
*                                                                  0448 01263000
PCAS     ST    @14,@SA00009                                        0448 01264000
*   /*****************************************************************/ 01265000
*   /*                                                               */ 01266000
*   /* RESERVE .MSVI                                         @Y30LB25*/ 01267000
*   /*                                                               */ 01268000
*   /*****************************************************************/ 01269000
*                                                                  0449 01270000
*   RESPECIFY                       /*                       @Y30LB25*/ 01271000
*     RG0 RSTD;                     /* RESTRICT REG 0        @Y30LB25*/ 01272000
*   RESPECIFY                       /*                       @Y30LB25*/ 01273000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 01274000
*   RG0=RESEXINV;                   /* INDICATE RESERVE      @Y30LB25*/ 01275000
         LA    RG0,1                                               0451 01276000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 01277000
         LR    RG1,RPLVPTR                                         0452 01278000
*   CALL ICBVRR00;                  /* RESERVE .MSVI         @Y30LB25*/ 01279000
         L     @15,@CV00611                                        0453 01280000
         BALR  @14,@15                                             0453 01281000
*   RESPECIFY                       /*                       @Y30LB25*/ 01282000
*     RG0 UNRSTD;                   /* UNRESTRICT REG 0      @Y30LB25*/ 01283000
*   RESPECIFY                       /*                       @Y30LB25*/ 01284000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01285000
*                                                                  0455 01286000
*   /*****************************************************************/ 01287000
*   /*                                                               */ 01288000
*   /* GET CIR FOR THE CARTRIDGE ENTERED                     @Y30LB25*/ 01289000
*   /*                                                               */ 01290000
*   /*****************************************************************/ 01291000
*                                                                  0456 01292000
*   IVOLKY=CSN1USM;                 /* CSN OF CART           @Y30LB25   01293000
*                                      ENTERED               @Y30LB25*/ 01294000
         MVC   IVOLKY(12),CSN1USM+8(MESGPTR)                       0456 01295000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 01296000
         LA    @08,IKEY                                            0457 01297000
         ST    @08,RPLVKEY(,RPLVPTR)                               0457 01298000
*   RPLVBUF=INDEXPTR;               /* PT TO CIR BUF         @Y30LB25*/ 01299000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0458 01300000
*   RPLVBLN=LENGTH(INDEXBUF);       /* SET CIR BUF LENGTH    @Y30LB25*/ 01301000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0459 01302000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 01303000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0460 01304000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 01305000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0461 01306000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 01307000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0462 01308000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 01309000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0463 01310000
*   RESPECIFY                       /*                       @Y30LB25*/ 01311000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 01312000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 01313000
         LR    RG1,RPLVPTR                                         0465 01314000
*   CALL ICBVIO00;                  /* READ FOR CIR          @Y30LB25*/ 01315000
         L     @15,@CV00610                                        0466 01316000
         BALR  @14,@15                                             0466 01317000
*   RESPECIFY                       /*                       @Y30LB25*/ 01318000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01319000
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/ 01320000
*     THEN                          /* ERROR                 @Y30LB25*/ 01321000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0468 01322000
         BNE   @RF00468                                            0468 01323000
*     DO;                           /*                       @Y30LB25*/ 01324000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 01325000
         BAL   @14,PLIBMSG                                         0470 01326000
*       RETURN;                     /*                       @Y30LB25*/ 01327000
@EL00009 DS    0H                                                  0471 01328000
@EF00009 DS    0H                                                  0471 01329000
@ER00009 L     @14,@SA00009                                        0471 01330000
         BR    @14                                                 0471 01331000
*     END;                          /*                       @Y30LB25*/ 01332000
*                                                                  0472 01333000
*   /*****************************************************************/ 01334000
*   /*                                                               */ 01335000
*   /* CHECK FOR PROCESS OF THE OTHER CARTRIDGE              @Y30LB25*/ 01336000
*   /* PAIRED WITH THE ONE ENTERED                           @Y30LB25*/ 01337000
*   /*                                                               */ 01338000
*   /*****************************************************************/ 01339000
*                                                                  0473 01340000
*   IF RPLRCODE=NORECFND|INDVSRNO^=VOLIDUSM/* NO REC FND OR  @Y30LB25   01341000
*                                      WRONG VOLID?          @Y30LB25*/ 01342000
*     THEN                          /* YES                   @Y30LB25*/ 01343000
@RF00468 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0473 01344000
         BE    @RT00473                                            0473 01345000
         CLC   INDVSRNO(6,INDEXPTR),VOLIDUSM+8(MESGPTR)            0473 01346000
         BE    @RF00473                                            0473 01347000
@RT00473 DS    0H                                                  0474 01348000
*     DO;                           /*                       @Y30LB25*/ 01349000
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO REASON CODE      @Y30LB25*/ 01350000
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0475 01351000
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETURN CODE      @Y30LB25*/ 01352000
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0476 01353000
*       CALL P2NDCART;              /* CK 2ND CART           @Y30LB25*/ 01354000
         BAL   @14,P2NDCART                                        0477 01355000
*       RETURN;                     /*                       @Y30LB25*/ 01356000
         B     @EL00009                                            0478 01357000
*     END;                          /*                       @Y30LB25*/ 01358000
*                                                                  0479 01359000
*   /*****************************************************************/ 01360000
*   /*                                                               */ 01361000
*   /* DETERMINE TYPE OF MSVC RECORD                         @Y30LB25*/ 01362000
*   /*                                                               */ 01363000
*   /*****************************************************************/ 01364000
*                                                                  0480 01365000
*   IF INDALPHA=D                   /* DVR?                  @Y30LB25*/ 01366000
*     THEN                          /* YES                   @Y30LB25*/ 01367000
@RF00473 CLI   INDALPHA(INDEXPTR),C'D'                             0480 01368000
         BNE   @RF00480                                            0480 01369000
*     DO;                           /*                       @Y30LB25*/ 01370000
*                                                                  0481 01371000
*       /*************************************************************/ 01372000
*       /*                                                           */ 01373000
*       /* DVR FOR CARTRIDGE ENTERED                         @Y30LB25*/ 01374000
*       /*                                                           */ 01375000
*       /*************************************************************/ 01376000
*                                                                  0482 01377000
*       CALL CKDVR1;                /* CK DVR FOR CART       @Y30LB25   01378000
*                                      ENTERED               @Y30LB25*/ 01379000
         BAL   @14,CKDVR1                                          0482 01380000
*       RETURN;                     /*                       @Y30LB25*/ 01381000
         B     @EL00009                                            0483 01382000
*     END;                          /*                       @Y30LB25*/ 01383000
*   ELSE                            /* BVR OR CVR?           @Y30LB25*/ 01384000
*     IF INDEXREC=FIXZERO           /* BVR?                  @Y30LB25*/ 01385000
*       THEN                        /* YES                   @Y30LB25*/ 01386000
@RF00480 CLI   INDEXREC(INDEXPTR),0                                0485 01387000
         BNE   @RF00485                                            0485 01388000
*       DO;                         /*                       @Y30LB25*/ 01389000
*                                                                  0486 01390000
*         /***********************************************************/ 01391000
*         /*                                                         */ 01392000
*         /* BVR FOR CARTRIDGE ENTERED                       @Y30LB25*/ 01393000
*         /*                                                         */ 01394000
*         /***********************************************************/ 01395000
*                                                                  0487 01396000
*         CALL CKBVR1;              /* CK BVR FOR CART       @Y30LB25   01397000
*                                      ENTERED               @Y30LB25*/ 01398000
         BAL   @14,CKBVR1                                          0487 01399000
*         RETURN;                   /*                       @Y30LB25*/ 01400000
         B     @EL00009                                            0488 01401000
*       END;                        /*                       @Y30LB25*/ 01402000
*     ELSE                          /* IS A CVR              @Y30LB25*/ 01403000
*       DO;                         /*                       @Y30LB25*/ 01404000
*                                                                  0490 01405000
@RF00485 DS    0H                                                  0491 01406000
*         /***********************************************************/ 01407000
*         /*                                                         */ 01408000
*         /* CVR FOR CARTRIDGE ENTERED                       @Y30LB25*/ 01409000
*         /*                                                         */ 01410000
*         /***********************************************************/ 01411000
*                                                                  0491 01412000
*         CALL CKCVR1;              /* CK CVR FOR CART       @Y30LB25   01413000
*                                      ENTERED               @Y30LB25*/ 01414000
         BAL   @14,CKCVR1                                          0491 01415000
*         RETURN;                   /*                       @Y30LB25*/ 01416000
         B     @EL00009                                            0492 01417000
*       END;                        /*                       @Y30LB25*/ 01418000
*   END PCAS;                       /*                       @Y30LB25*/ 01419000
*                                                                  0495 01420000
*   /*****************************************************************/ 01421000
*   /*                                                               */ 01422000
*   /* PROCEDURE NAME - P2NDCART                             @Y30LB25*/ 01423000
*   /*                                                       @Y30LB25*/ 01424000
*   /* FUNCTION - FIND AND UPDATE THE CORRECT MSVC RECORD    @Y30LB25*/ 01425000
*   /* FOR THE OTHER CARTRIDGE WHICH IS PAIRED               @Y30LB25*/ 01426000
*   /* WITH THE ONE WHICH WAS ENTERED.                       @Y30LB25*/ 01427000
*   /* IF NONE CAN BE FOUND, CREATE A BVR IF ONE             @Y30LB25*/ 01428000
*   /* DOES NOT EXIST. IF A BVR EXISTS, CREATE A DVR.        @Y30LB25*/ 01429000
*   /*                                                       @Y30LB25*/ 01430000
*   /* INPUT -                                               @Y30LB25*/ 01431000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 01432000
*   /*                                                       @Y30LB25*/ 01433000
*   /* OUTPUT -                                              @Y30LB25*/ 01434000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 01435000
*   /*                                                               */ 01436000
*   /*****************************************************************/ 01437000
*                                                                  0495 01438000
*P2NDCART:                          /*                       @Y30LB25*/ 01439000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 01440000
*                                                                  0495 01441000
P2NDCART ST    @14,@SA00010                                        0495 01442000
*   /*****************************************************************/ 01443000
*   /*                                                               */ 01444000
*   /* GET CIR FOR OTHER CARTRIDGE PAIRED WITH THE           @Y30LB25*/ 01445000
*   /* ONE ENTERED                                           @Y30LB25*/ 01446000
*   /*                                                               */ 01447000
*   /*****************************************************************/ 01448000
*                                                                  0496 01449000
*   IVOLKY=CSN2USM;                 /* CSN OF OTHER CART     @Y30LB25*/ 01450000
         MVC   IVOLKY(12),CSN2USM+8(MESGPTR)                       0496 01451000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 01452000
         LA    @08,IKEY                                            0497 01453000
         ST    @08,RPLVKEY(,RPLVPTR)                               0497 01454000
*   RPLVBUF=INDEXPTR;               /* PT TO CIR BUF         @Y30LB25*/ 01455000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0498 01456000
*   RPLVBLN=LENGTH(INDEXBUF);       /* SET CIR BUF LENGTH    @Y30LB25*/ 01457000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0499 01458000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 01459000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0500 01460000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 01461000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0501 01462000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 01463000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0502 01464000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 01465000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0503 01466000
*   RESPECIFY                       /*                       @Y30LB25*/ 01467000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 01468000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 01469000
         LR    RG1,RPLVPTR                                         0505 01470000
*   CALL ICBVIO00;                  /* READ FOR CIR          @Y30LB25*/ 01471000
         L     @15,@CV00610                                        0506 01472000
         BALR  @14,@15                                             0506 01473000
*   RESPECIFY                       /*                       @Y30LB25*/ 01474000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01475000
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/ 01476000
*     THEN                          /* ERROR                 @Y30LB25*/ 01477000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0508 01478000
         BNE   @RF00508                                            0508 01479000
*     DO;                           /*                       @Y30LB25*/ 01480000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 01481000
         BAL   @14,PLIBMSG                                         0510 01482000
*       RETURN;                     /*                       @Y30LB25*/ 01483000
@EL00010 DS    0H                                                  0511 01484000
@EF00010 DS    0H                                                  0511 01485000
@ER00010 L     @14,@SA00010                                        0511 01486000
         BR    @14                                                 0511 01487000
*     END;                          /*                       @Y30LB25*/ 01488000
*                                                                  0512 01489000
*   /*****************************************************************/ 01490000
*   /*                                                               */ 01491000
*   /* DETERMINE TYPE OF MSVC RECORD FOUND, IF ANY           @Y30LB25*/ 01492000
*   /*                                                               */ 01493000
*   /*****************************************************************/ 01494000
*                                                                  0513 01495000
*   IF RPLRCODE=NORECFND|INDVSRNO^=VOLIDUSM/* NO REC FND OR  @Y30LB25   01496000
*                                      WRONG VOLID?          @Y30LB25*/ 01497000
*     THEN                          /* YES                   @Y30LB25*/ 01498000
@RF00508 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0513 01499000
         BE    @RT00513                                            0513 01500000
         CLC   INDVSRNO(6,INDEXPTR),VOLIDUSM+8(MESGPTR)            0513 01501000
         BE    @RF00513                                            0513 01502000
@RT00513 DS    0H                                                  0514 01503000
*     DO;                           /*                       @Y30LB25*/ 01504000
*                                                                  0514 01505000
*       /*************************************************************/ 01506000
*       /*                                                           */ 01507000
*       /* NO RECORD WAS FOUND                               @Y30LB25*/ 01508000
*       /*                                                           */ 01509000
*       /*************************************************************/ 01510000
*                                                                  0515 01511000
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO REASON CODE      @Y30LB25*/ 01512000
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               0515 01513000
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETURN CODE      @Y30LB25*/ 01514000
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               0516 01515000
*       CALL NONEFND;               /* CREATE BVR OR DVR     @Y30LB25*/ 01516000
         BAL   @14,NONEFND                                         0517 01517000
*       RETURN;                     /*                       @Y30LB25*/ 01518000
         B     @EL00010                                            0518 01519000
*     END;                          /*                       @Y30LB25*/ 01520000
*                                                                  0519 01521000
*   /*****************************************************************/ 01522000
*   /*                                                               */ 01523000
*   /* DVR FOR OTHER CARTRIDGE PAIRED WITH THE               @Y30LB25*/ 01524000
*   /* ONE ENTERED                                           @Y30LB25*/ 01525000
*   /*                                                               */ 01526000
*   /*****************************************************************/ 01527000
*                                                                  0520 01528000
*   IF INDALPHA=D                   /* DVR?                  @Y30LB25*/ 01529000
*     THEN                          /* YES                   @Y30LB25*/ 01530000
@RF00513 CLI   INDALPHA(INDEXPTR),C'D'                             0520 01531000
         BNE   @RF00520                                            0520 01532000
*     DO;                           /*                       @Y30LB25*/ 01533000
*       CALL CKDVR2;                /* CK DVR FOR OTHER      @Y30LB25   01534000
*                                      CARTRIDGE             @Y30LB25*/ 01535000
         BAL   @14,CKDVR2                                          0522 01536000
*       RETURN;                     /*                       @Y30LB25*/ 01537000
         B     @EL00010                                            0523 01538000
*     END;                          /*                       @Y30LB25*/ 01539000
*   ELSE                            /* BVR OR CVR?           @Y30LB25*/ 01540000
*                                                                  0525 01541000
*     /***************************************************************/ 01542000
*     /*                                                             */ 01543000
*     /* BVR FOR OTHER CARTRIDGE PAIRED WITH THE             @Y30LB25*/ 01544000
*     /* ONE ENTERED                                         @Y30LB25*/ 01545000
*     /*                                                             */ 01546000
*     /***************************************************************/ 01547000
*                                                                  0525 01548000
*     IF INDEXREC=FIXZERO           /* BVR?                  @Y30LB25*/ 01549000
*       THEN                        /* YES                   @Y30LB25*/ 01550000
@RF00520 CLI   INDEXREC(INDEXPTR),0                                0525 01551000
         BNE   @RF00525                                            0525 01552000
*       DO;                         /*                       @Y30LB25*/ 01553000
*         CALL CKBVR2;              /* CK BVR FOR OTHER      @Y30LB25   01554000
*                                      CARTRIDGE             @Y30LB25*/ 01555000
         BAL   @14,CKBVR2                                          0527 01556000
*         RETURN;                   /*                       @Y30LB25*/ 01557000
         B     @EL00010                                            0528 01558000
*       END;                        /*                       @Y30LB25*/ 01559000
*     ELSE                          /* IS A CVR              @Y30LB25*/ 01560000
*                                                                  0530 01561000
*       /*************************************************************/ 01562000
*       /*                                                           */ 01563000
*       /* CVR FOR OTHER CARTRIDGE PAIRED WITH THE           @Y30LB25*/ 01564000
*       /* ONE ENTERED                                       @Y30LB25*/ 01565000
*       /*                                                           */ 01566000
*       /*************************************************************/ 01567000
*                                                                  0530 01568000
*       DO;                         /*                       @Y30LB25*/ 01569000
@RF00525 DS    0H                                                  0531 01570000
*         CALL CKCVR2;              /* CK CVR FOR OTHER      @Y30LB25   01571000
*                                      CARTRIDGE             @Y30LB25*/ 01572000
         BAL   @14,CKCVR2                                          0531 01573000
*         RETURN;                   /*                       @Y30LB25*/ 01574000
         B     @EL00010                                            0532 01575000
*       END;                        /*                       @Y30LB25*/ 01576000
*   END P2NDCART;                   /*                       @Y30LB25*/ 01577000
*                                                                  0535 01578000
*   /*****************************************************************/ 01579000
*   /*                                                               */ 01580000
*   /* PROCEDURE NAME - CKDVR1                               @Y30LB25*/ 01581000
*   /*                                                       @Y30LB25*/ 01582000
*   /* FUNCTION - UPDATE A DVR AND CIR FOR THE CSN OF THE    @Y30LB25*/ 01583000
*   /* CARTRIDGE ENTERED.                                    @Y30LB25*/ 01584000
*   /*                                                       @Y30LB25*/ 01585000
*   /* INPUT -                                               @Y30LB25*/ 01586000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 01587000
*   /*                                                       @Y30LB25*/ 01588000
*   /* OUTPUT -                                              @Y30LB25*/ 01589000
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/ 01590000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 01591000
*   /*                                                               */ 01592000
*   /*****************************************************************/ 01593000
*                                                                  0535 01594000
*CKDVR1:                            /*                       @Y30LB25*/ 01595000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 01596000
*                                                                  0535 01597000
CKDVR1   ST    @14,@SA00011                                        0535 01598000
*   /*****************************************************************/ 01599000
*   /*                                                               */ 01600000
*   /* GET THE DVR FROM THE CSN OF THE CARTRIDGE ENTERED     @Y30LB25*/ 01601000
*   /*                                                               */ 01602000
*   /*****************************************************************/ 01603000
*                                                                  0536 01604000
*   DKEY=INDRECKY;                  /* DVR KEY               @Y30LB25*/ 01605000
         MVC   DKEY(13),INDRECKY(INDEXPTR)                         0536 01606000
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/ 01607000
         LA    @08,DKEY                                            0537 01608000
         ST    @08,RPLVKEY(,RPLVPTR)                               0537 01609000
*   RPLVBUF=DUPVPTR;                /* PT TO DVR BUF         @Y30LB25*/ 01610000
         L     @08,DUPVPTR                                         0538 01611000
         ST    @08,RPLVBUF(,RPLVPTR)                               0538 01612000
*   RPLVBLN=LENGTH(DUPVBUF);        /* SET DVR BUF LENGTH    @Y30LB25*/ 01613000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0539 01614000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 01615000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0540 01616000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 01617000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0541 01618000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 01619000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0542 01620000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 01621000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0543 01622000
*   RESPECIFY                       /*                       @Y30LB25*/ 01623000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 01624000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 01625000
         LR    RG1,RPLVPTR                                         0545 01626000
*   CALL ICBVIO00;                  /* READ FOR DVR          @Y30LB25*/ 01627000
         L     @15,@CV00610                                        0546 01628000
         BALR  @14,@15                                             0546 01629000
*   RESPECIFY                       /*                       @Y30LB25*/ 01630000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01631000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 01632000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 01633000
         LH    @08,RPLVRETC(,RPLVPTR)                              0548 01634000
         N     @08,@CF00815                                        0548 01635000
         LTR   @08,@08                                             0548 01636000
         BZ    @RF00548                                            0548 01637000
*     DO;                           /* NO REC FND            @Y30LB25*/ 01638000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 01639000
         BAL   @14,PLIBMSG                                         0550 01640000
*       RETURN;                     /*                       @Y30LB25*/ 01641000
@EL00011 DS    0H                                                  0551 01642000
@EF00011 DS    0H                                                  0551 01643000
@ER00011 L     @14,@SA00011                                        0551 01644000
         BR    @14                                                 0551 01645000
*     END;                          /*                       @Y30LB25*/ 01646000
*                                                                  0552 01647000
*   /*****************************************************************/ 01648000
*   /*                                                               */ 01649000
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/ 01650000
*   /*                                                               */ 01651000
*   /*****************************************************************/ 01652000
*                                                                  0553 01653000
*   IF(CSN1USM=DUPCSN1&CSN2USM=DUPCSN2)|/* ALL CSNS MATCH?   @Y30LB25*/ 01654000
*       (CSN1USM=DUPCSN2&CSN2USM=DUPCSN1)/*                  @Y30LB25*/ 01655000
*     THEN                          /* YES                   @Y30LB25*/ 01656000
@RF00548 LA    @08,8                                               0553 01657000
         ALR   @08,MESGPTR                                         0553 01658000
         L     @04,DUPVPTR                                         0553 01659000
         CLC   CSN1USM(12,@08),DUPCSN1(@04)                        0553 01660000
         BNE   @GL00009                                            0553 01661000
         CLC   CSN2USM(12,@08),DUPCSN2(@04)                        0553 01662000
         BE    @RT00553                                            0553 01663000
@GL00009 LA    @08,8                                               0553 01664000
         ALR   @08,MESGPTR                                         0553 01665000
         L     @04,DUPVPTR                                         0553 01666000
         CLC   CSN1USM(12,@08),DUPCSN2(@04)                        0553 01667000
         BNE   @RF00553                                            0553 01668000
         CLC   CSN2USM(12,@08),DUPCSN1(@04)                        0553 01669000
         BNE   @RF00553                                            0553 01670000
@RT00553 DS    0H                                                  0554 01671000
*     DO;                           /*                       @Y30LB25*/ 01672000
*                                                                  0554 01673000
*       /*************************************************************/ 01674000
*       /*                                                           */ 01675000
*       /* CHECK FOR CSN1                                    @Y30LB25*/ 01676000
*       /*                                                           */ 01677000
*       /*************************************************************/ 01678000
*                                                                  0555 01679000
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/ 01680000
*         THEN                      /* YES                   @Y30LB25*/ 01681000
         LA    @08,8                                               0555 01682000
         ALR   @08,MESGPTR                                         0555 01683000
         CLI   SEQNUM(@08),X'F1'                                   0555 01684000
         BNE   @RF00555                                            0555 01685000
*         DO;                       /*                       @Y30LB25*/ 01686000
*                                                                  0556 01687000
*           /*********************************************************/ 01688000
*           /*                                                       */ 01689000
*           /* SET LIBID1                                    @Y30LB25*/ 01690000
*           /*                                                       */ 01691000
*           /*********************************************************/ 01692000
*                                                                  0557 01693000
*           DUPLIB1=DUPLIB1&&DUPLIB1;/* ZERO LIBID1          @Y30LB25*/ 01694000
         L     @04,DUPVPTR                                         0557 01695000
         SLR   @03,@03                                             0557 01696000
         IC    @03,DUPLIB1(,@04)                                   0557 01697000
         LR    @15,@03                                             0557 01698000
         XR    @15,@03                                             0557 01699000
         STC   @15,DUPLIB1(,@04)                                   0557 01700000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 01701000
*             THEN                  /* YES                   @Y30LB25*/ 01702000
         TM    LUSM1(@08),B'10000000'                              0558 01703000
         BNO   @RF00558                                            0558 01704000
*             DUP1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/ 01705000
         OI    DUP1BIT1(@04),B'00000010'                           0559 01706000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 01707000
*             THEN                  /* YES                   @Y30LB25*/ 01708000
@RF00558 TM    LUSM2+8(MESGPTR),B'01000000'                        0560 01709000
         BNO   @RF00560                                            0560 01710000
*             DUP1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/ 01711000
         L     @08,DUPVPTR                                         0561 01712000
         OI    DUP1BIT2(@08),B'00000001'                           0561 01713000
*           DUPCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/ 01714000
@RF00560 L     @08,DUPVPTR                                         0562 01715000
         LA    @04,8                                               0562 01716000
         ALR   @04,MESGPTR                                         0562 01717000
         MVC   DUPCSN1(12,@08),CSN1USM(@04)                        0562 01718000
*           DUPCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/ 01719000
         MVC   DUPCSN2(12,@08),CSN2USM(@04)                        0563 01720000
*         END;                      /*                       @Y30LB25*/ 01721000
*                                                                  0564 01722000
*       /*************************************************************/ 01723000
*       /*                                                           */ 01724000
*       /* CSN2                                              @Y30LB25*/ 01725000
*       /*                                                           */ 01726000
*       /*************************************************************/ 01727000
*                                                                  0565 01728000
*       ELSE                        /* CSN2                  @Y30LB25*/ 01729000
*                                                                  0565 01730000
*         /***********************************************************/ 01731000
*         /*                                                         */ 01732000
*         /* SET LIBID2                                      @Y30LB25*/ 01733000
*         /*                                                         */ 01734000
*         /***********************************************************/ 01735000
*                                                                  0565 01736000
*         DO;                       /*                       @Y30LB25*/ 01737000
         B     @RC00555                                            0565 01738000
@RF00555 DS    0H                                                  0566 01739000
*           DUPLIB2=DUPLIB2&&DUPLIB2;/* ZERO LIBID2          @Y30LB25*/ 01740000
         L     @08,DUPVPTR                                         0566 01741000
         SLR   @04,@04                                             0566 01742000
         IC    @04,DUPLIB2(,@08)                                   0566 01743000
         LR    @03,@04                                             0566 01744000
         XR    @03,@04                                             0566 01745000
         STC   @03,DUPLIB2(,@08)                                   0566 01746000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 01747000
*             THEN                  /* YES                   @Y30LB25*/ 01748000
         TM    LUSM1+8(MESGPTR),B'10000000'                        0567 01749000
         BNO   @RF00567                                            0567 01750000
*             DUP2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/ 01751000
         OI    DUP2BIT1(@08),B'00000010'                           0568 01752000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 01753000
*             THEN                  /* YES                   @Y30LB25*/ 01754000
@RF00567 TM    LUSM2+8(MESGPTR),B'01000000'                        0569 01755000
         BNO   @RF00569                                            0569 01756000
*             DUP2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/ 01757000
         L     @08,DUPVPTR                                         0570 01758000
         OI    DUP2BIT2(@08),B'00000001'                           0570 01759000
*           DUPCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/ 01760000
@RF00569 L     @08,DUPVPTR                                         0571 01761000
         LA    @04,8                                               0571 01762000
         ALR   @04,MESGPTR                                         0571 01763000
         MVC   DUPCSN1(12,@08),CSN2USM(@04)                        0571 01764000
*           DUPCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/ 01765000
         MVC   DUPCSN2(12,@08),CSN1USM(@04)                        0572 01766000
*         END;                      /*                       @Y30LB25*/ 01767000
*                                                                  0573 01768000
*       /*************************************************************/ 01769000
*       /*                                                           */ 01770000
*       /* WRITE THE DVR                                     @Y30LB25*/ 01771000
*       /*                                                           */ 01772000
*       /*************************************************************/ 01773000
*                                                                  0574 01774000
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/ 01775000
@RC00555 MVI   RPLVTYP(RPLVPTR),X'01'                              0574 01776000
*       RESPECIFY                   /*                       @Y30LB25*/ 01777000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 01778000
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/ 01779000
         LR    RG1,RPLVPTR                                         0576 01780000
*       CALL ICBVIO00;              /* WRITE DVR             @Y30LB25*/ 01781000
         L     @15,@CV00610                                        0577 01782000
         BALR  @14,@15                                             0577 01783000
*       RESPECIFY                   /*                       @Y30LB25*/ 01784000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 01785000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/ 01786000
*         THEN                      /*                       @Y30LB25*/ 01787000
         LH    @08,RPLVRETC(,RPLVPTR)                              0579 01788000
         N     @08,@CF00815                                        0579 01789000
         LTR   @08,@08                                             0579 01790000
         BZ    @RF00579                                            0579 01791000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 01792000
         BAL   @14,PLIBMSG                                         0580 01793000
*       RETURN;                     /*                       @Y30LB25*/ 01794000
         B     @EL00011                                            0581 01795000
*     END;                          /*                       @Y30LB25*/ 01796000
*                                                                  0582 01797000
*   /*****************************************************************/ 01798000
*   /*                                                               */ 01799000
*   /* OTHER CARTRIDGE PAIRED WITH THE ONE ENTERED MUST      @Y30LB25*/ 01800000
*   /* NOT MATCH EITHER CSN1 OR CSN2 IN THE DVR.             @Y30LB25*/ 01801000
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN        @Y30LB25*/ 01802000
*   /* ENTERED MATCHES.                                      @Y30LB25*/ 01803000
*   /*                                                               */ 01804000
*   /*****************************************************************/ 01805000
*                                                                  0583 01806000
*   IF DUPCSN1^=CSN1USM             /* NO MATCH CSN1?        @Y30LB25*/ 01807000
*     THEN                          /* YES                   @Y30LB25*/ 01808000
@RF00553 L     @08,DUPVPTR                                         0583 01809000
         LA    @04,8                                               0583 01810000
         ALR   @04,MESGPTR                                         0583 01811000
         CLC   DUPCSN1(12,@08),CSN1USM(@04)                        0583 01812000
         BE    @RF00583                                            0583 01813000
*     DO;                           /*                       @Y30LB25*/ 01814000
*       IVOLKY=DUPCSN1;             /* SAVE CSN1             @Y30LB25*/ 01815000
         MVC   IVOLKY(12),DUPCSN1(@08)                             0585 01816000
*       DUPCSN1=CSN2USM;            /* UPDATE DVR CSN1       @Y30LB25*/ 01817000
         MVC   DUPCSN1(12,@08),CSN2USM(@04)                        0586 01818000
*       DUPLIB1=DUPLIB1&&DUPLIB1;   /* ZERO LIBID1           @Y30LB25*/ 01819000
         SLR   @03,@03                                             0587 01820000
         IC    @03,DUPLIB1(,@08)                                   0587 01821000
         LR    @15,@03                                             0587 01822000
         XR    @15,@03                                             0587 01823000
         STC   @15,DUPLIB1(,@08)                                   0587 01824000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 01825000
*         THEN                      /* YES                   @Y30LB25*/ 01826000
         TM    LUSM1(@04),B'10000000'                              0588 01827000
         BNO   @RF00588                                            0588 01828000
*         DUP1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/ 01829000
         OI    DUP1BIT1(@08),B'00000010'                           0589 01830000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 01831000
*         THEN                      /* YES                   @Y30LB25*/ 01832000
@RF00588 TM    LUSM2+8(MESGPTR),B'01000000'                        0590 01833000
         BNO   @RF00590                                            0590 01834000
*         DUP2BIT1=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/ 01835000
         L     @08,DUPVPTR                                         0591 01836000
         OI    DUP2BIT1(@08),B'00000010'                           0591 01837000
*       CALL DVRCSN1;               /* PROC DVR CSN1 CIR     @Y30LB25*/ 01838000
@RF00590 BAL   @14,DVRCSN1                                         0592 01839000
*       RETURN;                     /*                       @Y30LB25*/ 01840000
         B     @EL00011                                            0593 01841000
*     END;                          /*                       @Y30LB25*/ 01842000
*   ELSE                            /* NO MATCH DVR CSN2     @Y30LB25*/ 01843000
*     DO;                           /*                       @Y30LB25*/ 01844000
@RF00583 DS    0H                                                  0596 01845000
*       IVOLKY=DUPCSN2;             /* SAVE CSN2             @Y30LB25*/ 01846000
         L     @08,DUPVPTR                                         0596 01847000
         MVC   IVOLKY(12),DUPCSN2(@08)                             0596 01848000
*       DUPCSN2=CSN2USM;            /* UPDATE DVR CSN2       @Y30LB25*/ 01849000
         LA    @04,8                                               0597 01850000
         ALR   @04,MESGPTR                                         0597 01851000
         MVC   DUPCSN2(12,@08),CSN2USM(@04)                        0597 01852000
*       DUPLIB2=DUPLIB2&&DUPLIB2;   /* ZERO LIBID2           @Y30LB25*/ 01853000
         SLR   @03,@03                                             0598 01854000
         IC    @03,DUPLIB2(,@08)                                   0598 01855000
         LR    @15,@03                                             0598 01856000
         XR    @15,@03                                             0598 01857000
         STC   @15,DUPLIB2(,@08)                                   0598 01858000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 01859000
*         THEN                      /* YES                   @Y30LB25*/ 01860000
         TM    LUSM1(@04),B'10000000'                              0599 01861000
         BNO   @RF00599                                            0599 01862000
*         DUP2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/ 01863000
         OI    DUP2BIT1(@08),B'00000010'                           0600 01864000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 01865000
*         THEN                      /* YES                   @Y30LB25*/ 01866000
@RF00599 TM    LUSM2+8(MESGPTR),B'01000000'                        0601 01867000
         BNO   @RF00601                                            0601 01868000
*         DUP2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/ 01869000
         L     @08,DUPVPTR                                         0602 01870000
         OI    DUP2BIT2(@08),B'00000001'                           0602 01871000
*       CALL DVRCSN2;               /* PROC DVR CSN2 CIR     @Y30LB25*/ 01872000
@RF00601 BAL   @14,DVRCSN2                                         0603 01873000
*       RETURN;                     /*                       @Y30LB25*/ 01874000
         B     @EL00011                                            0604 01875000
*     END;                          /*                       @Y30LB25*/ 01876000
*   END CKDVR1;                     /*                       @Y30LB25*/ 01877000
         B     @EL00011                                            0606 01878000
*                                                                  0607 01879000
*   /*****************************************************************/ 01880000
*   /*                                                               */ 01881000
*   /* PROCEDURE NAME - CKDVR2                               @Y30LB25*/ 01882000
*   /*                                                       @Y30LB25*/ 01883000
*   /* FUNCTION - UPDATE A DVR AND CIR FOR THE CSN OF THE    @Y30LB25*/ 01884000
*   /* OTHER CARTRIDGE TO THE PAIR FOR THE ONE ENTERED.      @Y30LB25*/ 01885000
*   /*                                                       @Y30LB25*/ 01886000
*   /* INPUT -                                               @Y30LB25*/ 01887000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 01888000
*   /*                                                       @Y30LB25*/ 01889000
*   /* OUTPUT -                                              @Y30LB25*/ 01890000
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/ 01891000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 01892000
*   /*                                                               */ 01893000
*   /*****************************************************************/ 01894000
*                                                                  0607 01895000
*CKDVR2:                            /*                       @Y30LB25*/ 01896000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 01897000
*                                                                  0607 01898000
CKDVR2   ST    @14,@SA00012                                        0607 01899000
*   /*****************************************************************/ 01900000
*   /*                                                               */ 01901000
*   /* GET THE DVR FROM THE CSN OF THE CARTRIDGE PAIRED      @Y30LB25*/ 01902000
*   /* WITH THE ONE ENTERED                                  @Y30LB25*/ 01903000
*   /*                                                               */ 01904000
*   /*****************************************************************/ 01905000
*                                                                  0608 01906000
*   DKEY=INDRECKY;                  /* DVR KEY               @Y30LB25*/ 01907000
         MVC   DKEY(13),INDRECKY(INDEXPTR)                         0608 01908000
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/ 01909000
         LA    @08,DKEY                                            0609 01910000
         ST    @08,RPLVKEY(,RPLVPTR)                               0609 01911000
*   RPLVBUF=DUPVPTR;                /* PT TO DVR BUF         @Y30LB25*/ 01912000
         L     @08,DUPVPTR                                         0610 01913000
         ST    @08,RPLVBUF(,RPLVPTR)                               0610 01914000
*   RPLVBLN=LENGTH(DUPVBUF);        /* SET DVR BUF LENGTH    @Y30LB25*/ 01915000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0611 01916000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 01917000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0612 01918000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 01919000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0613 01920000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 01921000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0614 01922000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 01923000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0615 01924000
*   RESPECIFY                       /*                       @Y30LB25*/ 01925000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 01926000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 01927000
         LR    RG1,RPLVPTR                                         0617 01928000
*   CALL ICBVIO00;                  /* READ FOR DVR          @Y30LB25*/ 01929000
         L     @15,@CV00610                                        0618 01930000
         BALR  @14,@15                                             0618 01931000
*   RESPECIFY                       /*                       @Y30LB25*/ 01932000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 01933000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 01934000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 01935000
         LH    @08,RPLVRETC(,RPLVPTR)                              0620 01936000
         N     @08,@CF00815                                        0620 01937000
         LTR   @08,@08                                             0620 01938000
         BZ    @RF00620                                            0620 01939000
*     DO;                           /* NO REC FND            @Y30LB25*/ 01940000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 01941000
         BAL   @14,PLIBMSG                                         0622 01942000
*       RETURN;                     /*                       @Y30LB25*/ 01943000
@EL00012 DS    0H                                                  0623 01944000
@EF00012 DS    0H                                                  0623 01945000
@ER00012 L     @14,@SA00012                                        0623 01946000
         BR    @14                                                 0623 01947000
*     END;                          /*                       @Y30LB25*/ 01948000
*                                                                  0624 01949000
*   /*****************************************************************/ 01950000
*   /*                                                               */ 01951000
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/ 01952000
*   /*                                                               */ 01953000
*   /*****************************************************************/ 01954000
*                                                                  0625 01955000
*   IF(CSN1USM=DUPCSN1&CSN2USM=DUPCSN2)|/* ALL CSNS MATCH?   @Y30LB25*/ 01956000
*       (CSN1USM=DUPCSN2&CSN2USM=DUPCSN1)/*                  @Y30LB25*/ 01957000
*     THEN                          /* YES                   @Y30LB25*/ 01958000
@RF00620 LA    @08,8                                               0625 01959000
         ALR   @08,MESGPTR                                         0625 01960000
         L     @04,DUPVPTR                                         0625 01961000
         CLC   CSN1USM(12,@08),DUPCSN1(@04)                        0625 01962000
         BNE   @GL00012                                            0625 01963000
         CLC   CSN2USM(12,@08),DUPCSN2(@04)                        0625 01964000
         BE    @RT00625                                            0625 01965000
@GL00012 LA    @08,8                                               0625 01966000
         ALR   @08,MESGPTR                                         0625 01967000
         L     @04,DUPVPTR                                         0625 01968000
         CLC   CSN1USM(12,@08),DUPCSN2(@04)                        0625 01969000
         BNE   @RF00625                                            0625 01970000
         CLC   CSN2USM(12,@08),DUPCSN1(@04)                        0625 01971000
         BNE   @RF00625                                            0625 01972000
@RT00625 DS    0H                                                  0626 01973000
*     DO;                           /*                       @Y30LB25*/ 01974000
*                                                                  0626 01975000
*       /*************************************************************/ 01976000
*       /*                                                           */ 01977000
*       /* CHECK FOR CSN1                                    @Y30LB25*/ 01978000
*       /*                                                           */ 01979000
*       /*************************************************************/ 01980000
*                                                                  0627 01981000
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/ 01982000
*         THEN                      /* YES                   @Y30LB25*/ 01983000
         LA    @08,8                                               0627 01984000
         ALR   @08,MESGPTR                                         0627 01985000
         CLI   SEQNUM(@08),X'F1'                                   0627 01986000
         BNE   @RF00627                                            0627 01987000
*         DO;                       /*                       @Y30LB25*/ 01988000
*                                                                  0628 01989000
*           /*********************************************************/ 01990000
*           /*                                                       */ 01991000
*           /* SET LIBID1                                    @Y30LB25*/ 01992000
*           /*                                                       */ 01993000
*           /*********************************************************/ 01994000
*                                                                  0629 01995000
*           DUPLIB1=DUPLIB1&&DUPLIB1;/* ZERO LIBID1          @Y30LB25*/ 01996000
         L     @04,DUPVPTR                                         0629 01997000
         SLR   @03,@03                                             0629 01998000
         IC    @03,DUPLIB1(,@04)                                   0629 01999000
         LR    @15,@03                                             0629 02000000
         XR    @15,@03                                             0629 02001000
         STC   @15,DUPLIB1(,@04)                                   0629 02002000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 02003000
*             THEN                  /* YES                   @Y30LB25*/ 02004000
         TM    LUSM1(@08),B'10000000'                              0630 02005000
         BNO   @RF00630                                            0630 02006000
*             DUP1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/ 02007000
         OI    DUP1BIT1(@04),B'00000010'                           0631 02008000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 02009000
*             THEN                  /* YES                   @Y30LB25*/ 02010000
@RF00630 TM    LUSM2+8(MESGPTR),B'01000000'                        0632 02011000
         BNO   @RF00632                                            0632 02012000
*             DUP1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/ 02013000
         L     @08,DUPVPTR                                         0633 02014000
         OI    DUP1BIT2(@08),B'00000001'                           0633 02015000
*           DUPCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/ 02016000
@RF00632 L     @08,DUPVPTR                                         0634 02017000
         LA    @04,8                                               0634 02018000
         ALR   @04,MESGPTR                                         0634 02019000
         MVC   DUPCSN1(12,@08),CSN1USM(@04)                        0634 02020000
*           DUPCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/ 02021000
         MVC   DUPCSN2(12,@08),CSN2USM(@04)                        0635 02022000
*         END;                      /*                       @Y30LB25*/ 02023000
*                                                                  0636 02024000
*       /*************************************************************/ 02025000
*       /*                                                           */ 02026000
*       /* CSN2                                              @Y30LB25*/ 02027000
*       /*                                                           */ 02028000
*       /*************************************************************/ 02029000
*                                                                  0637 02030000
*       ELSE                        /* CSN2                  @Y30LB25*/ 02031000
*                                                                  0637 02032000
*         /***********************************************************/ 02033000
*         /*                                                         */ 02034000
*         /* SET LIBID2                                      @Y30LB25*/ 02035000
*         /*                                                         */ 02036000
*         /***********************************************************/ 02037000
*                                                                  0637 02038000
*         DO;                       /*                       @Y30LB25*/ 02039000
         B     @RC00627                                            0637 02040000
@RF00627 DS    0H                                                  0638 02041000
*           DUPLIB2=DUPLIB2&&DUPLIB2;/* ZERO LIBID2          @Y30LB25*/ 02042000
         L     @08,DUPVPTR                                         0638 02043000
         SLR   @04,@04                                             0638 02044000
         IC    @04,DUPLIB2(,@08)                                   0638 02045000
         LR    @03,@04                                             0638 02046000
         XR    @03,@04                                             0638 02047000
         STC   @03,DUPLIB2(,@08)                                   0638 02048000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 02049000
*             THEN                  /* YES                   @Y30LB25*/ 02050000
         TM    LUSM1+8(MESGPTR),B'10000000'                        0639 02051000
         BNO   @RF00639                                            0639 02052000
*             DUP2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/ 02053000
         OI    DUP2BIT1(@08),B'00000010'                           0640 02054000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 02055000
*             THEN                  /* YES                   @Y30LB25*/ 02056000
@RF00639 TM    LUSM2+8(MESGPTR),B'01000000'                        0641 02057000
         BNO   @RF00641                                            0641 02058000
*             DUP2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/ 02059000
         L     @08,DUPVPTR                                         0642 02060000
         OI    DUP2BIT2(@08),B'00000001'                           0642 02061000
*           DUPCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/ 02062000
@RF00641 L     @08,DUPVPTR                                         0643 02063000
         LA    @04,8                                               0643 02064000
         ALR   @04,MESGPTR                                         0643 02065000
         MVC   DUPCSN1(12,@08),CSN2USM(@04)                        0643 02066000
*           DUPCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/ 02067000
         MVC   DUPCSN2(12,@08),CSN1USM(@04)                        0644 02068000
*         END;                      /*                       @Y30LB25*/ 02069000
*                                                                  0645 02070000
*       /*************************************************************/ 02071000
*       /*                                                           */ 02072000
*       /* WRITE THE DVR                                     @Y30LB25*/ 02073000
*       /*                                                           */ 02074000
*       /*************************************************************/ 02075000
*                                                                  0646 02076000
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/ 02077000
@RC00627 MVI   RPLVTYP(RPLVPTR),X'01'                              0646 02078000
*       RESPECIFY                   /*                       @Y30LB25*/ 02079000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 02080000
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/ 02081000
         LR    RG1,RPLVPTR                                         0648 02082000
*       CALL ICBVIO00;              /* WRITE DVR             @Y30LB25*/ 02083000
         L     @15,@CV00610                                        0649 02084000
         BALR  @14,@15                                             0649 02085000
*       RESPECIFY                   /*                       @Y30LB25*/ 02086000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 02087000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/ 02088000
*         THEN                      /*                       @Y30LB25*/ 02089000
         LH    @08,RPLVRETC(,RPLVPTR)                              0651 02090000
         N     @08,@CF00815                                        0651 02091000
         LTR   @08,@08                                             0651 02092000
         BZ    @RF00651                                            0651 02093000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 02094000
         BAL   @14,PLIBMSG                                         0652 02095000
*       RETURN;                     /*                       @Y30LB25*/ 02096000
         B     @EL00012                                            0653 02097000
*     END;                          /*                       @Y30LB25*/ 02098000
*                                                                  0654 02099000
*   /*****************************************************************/ 02100000
*   /*                                                               */ 02101000
*   /* THE CARTRIDGE ENTERED MUST NOT MATCH WITH EITHER      @Y30LB25*/ 02102000
*   /* CSN1 OR CSN2 IN THE DVR.                              @Y30LB25*/ 02103000
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN NOT    @Y30LB25*/ 02104000
*   /* ENTERED MATCHES.                                      @Y30LB25*/ 02105000
*   /*                                                               */ 02106000
*   /*****************************************************************/ 02107000
*                                                                  0655 02108000
*   IF DUPCSN1^=CSN2USM             /* NO MATCH CSN2?        @Y30LB25*/ 02109000
*     THEN                          /* YES                   @Y30LB25*/ 02110000
@RF00625 L     @08,DUPVPTR                                         0655 02111000
         LA    @04,8                                               0655 02112000
         ALR   @04,MESGPTR                                         0655 02113000
         CLC   DUPCSN1(12,@08),CSN2USM(@04)                        0655 02114000
         BE    @RF00655                                            0655 02115000
*     DO;                           /*                       @Y30LB25*/ 02116000
*       IVOLKY=DUPCSN1;             /* SAVE CSN1             @Y30LB25*/ 02117000
         MVC   IVOLKY(12),DUPCSN1(@08)                             0657 02118000
*       DUPCSN1=CSN1USM;            /* UPDATE DVR CSN1       @Y30LB25*/ 02119000
         MVC   DUPCSN1(12,@08),CSN1USM(@04)                        0658 02120000
*       DUPLIB1=DUPLIB1&&DUPLIB1;   /* ZERO LIBID1           @Y30LB25*/ 02121000
         SLR   @03,@03                                             0659 02122000
         IC    @03,DUPLIB1(,@08)                                   0659 02123000
         LR    @15,@03                                             0659 02124000
         XR    @15,@03                                             0659 02125000
         STC   @15,DUPLIB1(,@08)                                   0659 02126000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 02127000
*         THEN                      /* YES                   @Y30LB25*/ 02128000
         TM    LUSM1(@04),B'10000000'                              0660 02129000
         BNO   @RF00660                                            0660 02130000
*         DUP1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/ 02131000
         OI    DUP1BIT1(@08),B'00000010'                           0661 02132000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 02133000
*         THEN                      /* YES                   @Y30LB25*/ 02134000
@RF00660 TM    LUSM2+8(MESGPTR),B'01000000'                        0662 02135000
         BNO   @RF00662                                            0662 02136000
*         DUP1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/ 02137000
         L     @08,DUPVPTR                                         0663 02138000
         OI    DUP1BIT2(@08),B'00000001'                           0663 02139000
*       CALL DVRCSN1;               /* PROC DVR CSN1 CIR     @Y30LB25*/ 02140000
@RF00662 BAL   @14,DVRCSN1                                         0664 02141000
*       RETURN;                     /*                       @Y30LB25*/ 02142000
         B     @EL00012                                            0665 02143000
*     END;                          /*                       @Y30LB25*/ 02144000
*   ELSE                            /* NO MATCH DVR CSN2     @Y30LB25*/ 02145000
*     DO;                           /*                       @Y30LB25*/ 02146000
@RF00655 DS    0H                                                  0668 02147000
*       IVOLKY=DUPCSN2;             /* SAVE CSN2             @Y30LB25*/ 02148000
         L     @08,DUPVPTR                                         0668 02149000
         MVC   IVOLKY(12),DUPCSN2(@08)                             0668 02150000
*       DUPCSN2=CSN1USM;            /* UPDATE DVR CSN1       @Y30LB25*/ 02151000
         LA    @04,8                                               0669 02152000
         ALR   @04,MESGPTR                                         0669 02153000
         MVC   DUPCSN2(12,@08),CSN1USM(@04)                        0669 02154000
*       DUPLIB2=DUPLIB2&&DUPLIB2;   /* ZERO LIBID2           @Y30LB25*/ 02155000
         SLR   @03,@03                                             0670 02156000
         IC    @03,DUPLIB2(,@08)                                   0670 02157000
         LR    @15,@03                                             0670 02158000
         XR    @15,@03                                             0670 02159000
         STC   @15,DUPLIB2(,@08)                                   0670 02160000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 02161000
*         THEN                      /* YES                   @Y30LB25*/ 02162000
         TM    LUSM1(@04),B'10000000'                              0671 02163000
         BNO   @RF00671                                            0671 02164000
*         DUP2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/ 02165000
         OI    DUP2BIT1(@08),B'00000010'                           0672 02166000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 02167000
*         THEN                      /* YES                   @Y30LB25*/ 02168000
@RF00671 TM    LUSM2+8(MESGPTR),B'01000000'                        0673 02169000
         BNO   @RF00673                                            0673 02170000
*         DUP2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/ 02171000
         L     @08,DUPVPTR                                         0674 02172000
         OI    DUP2BIT2(@08),B'00000001'                           0674 02173000
*       CALL DVRCSN2;               /* PROC DVR CSN2 CIR     @Y30LB25*/ 02174000
@RF00673 BAL   @14,DVRCSN2                                         0675 02175000
*       RETURN;                     /*                       @Y30LB25*/ 02176000
         B     @EL00012                                            0676 02177000
*     END;                          /*                       @Y30LB25*/ 02178000
*   END CKDVR2;                     /*                       @Y30LB25*/ 02179000
         B     @EL00012                                            0678 02180000
*                                                                  0679 02181000
*   /*****************************************************************/ 02182000
*   /*                                                               */ 02183000
*   /* PROCEDURE NAME - DVRCSN1                              @Y30LB25*/ 02184000
*   /*                                                       @Y30LB25*/ 02185000
*   /* FUNCTION - WRITE THE DVR.                             @Y30LB25*/ 02186000
*   /* READ FOR CIR OF REPLACED CSN1.                        @Y30LB25*/ 02187000
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/ 02188000
*   /* DVR, CREATE A NEW CIR FOR CSN1 OF DVR AND RETURN.     @Y30LB25*/ 02189000
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN1          @Y30LB25*/ 02190000
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/ 02191000
*   /*                                                       @Y30LB25*/ 02192000
*   /* INPUT -                                               @Y30LB25*/ 02193000
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/ 02194000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 02195000
*   /*                                                       @Y30LB25*/ 02196000
*   /* OUTPUT -                                              @Y30LB25*/ 02197000
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/ 02198000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 02199000
*   /*                                                               */ 02200000
*   /*****************************************************************/ 02201000
*                                                                  0679 02202000
*DVRCSN1:                           /*                       @Y30LB25*/ 02203000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 02204000
*                                                                  0679 02205000
DVRCSN1  ST    @14,@SA00013                                        0679 02206000
*   /*****************************************************************/ 02207000
*   /*                                                               */ 02208000
*   /* WRITE THE DVR FOR THE CARTRIDGE ENTERED               @Y30LB25*/ 02209000
*   /*                                                               */ 02210000
*   /*****************************************************************/ 02211000
*                                                                  0680 02212000
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/ 02213000
         MVI   RPLVTYP(RPLVPTR),X'01'                              0680 02214000
*   RESPECIFY                       /*                       @Y30LB25*/ 02215000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 02216000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 02217000
         LR    RG1,RPLVPTR                                         0682 02218000
*   CALL ICBVIO00;                  /* WRITE DVR             @Y30LB25*/ 02219000
         L     @15,@CV00610                                        0683 02220000
         BALR  @14,@15                                             0683 02221000
*   RESPECIFY                       /*                       @Y30LB25*/ 02222000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 02223000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 02224000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 02225000
         LH    @08,RPLVRETC(,RPLVPTR)                              0685 02226000
         N     @08,@CF00815                                        0685 02227000
         LTR   @08,@08                                             0685 02228000
         BZ    @RF00685                                            0685 02229000
*     DO;                           /* NO REC FND            @Y30LB25*/ 02230000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 02231000
         BAL   @14,PLIBMSG                                         0687 02232000
*       RETURN;                     /*                       @Y30LB25*/ 02233000
@EL00013 DS    0H                                                  0688 02234000
@EF00013 DS    0H                                                  0688 02235000
@ER00013 L     @14,@SA00013                                        0688 02236000
         BR    @14                                                 0688 02237000
*     END;                          /*                       @Y30LB25*/ 02238000
*                                                                  0689 02239000
*   /*****************************************************************/ 02240000
*   /*                                                               */ 02241000
*   /* READ FOR CIR OF REPLACED CSN1 OF THE DVR              @Y30LB25*/ 02242000
*   /* IVOLKY CAN BE BLANKS FOR A NEWLY CREATED DVR.         @Y30LB25*/ 02243000
*   /*                                                               */ 02244000
*   /*****************************************************************/ 02245000
*                                                                  0690 02246000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 02247000
@RF00685 MVI   RPLVTYP(RPLVPTR),X'00'                              0690 02248000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 02249000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0691 02250000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 02251000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0692 02252000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 02253000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0693 02254000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 02255000
         LA    @08,IKEY                                            0694 02256000
         ST    @08,RPLVKEY(,RPLVPTR)                               0694 02257000
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/ 02258000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0695 02259000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/ 02260000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0696 02261000
*   RESPECIFY                       /*                       @Y30LB25*/ 02262000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 02263000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 02264000
         LR    RG1,RPLVPTR                                         0698 02265000
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/ 02266000
         L     @15,@CV00610                                        0699 02267000
         BALR  @14,@15                                             0699 02268000
*   RESPECIFY                       /*                       @Y30LB25*/ 02269000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 02270000
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/ 02271000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 02272000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0701 02273000
         BNE   @RF00701                                            0701 02274000
*     DO;                           /* NO REC FND            @Y30LB25*/ 02275000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 02276000
         BAL   @14,PLIBMSG                                         0703 02277000
*       RETURN;                     /*                       @Y30LB25*/ 02278000
         B     @EL00013                                            0704 02279000
*     END;                          /*                       @Y30LB25*/ 02280000
*                                                                  0705 02281000
*   /*****************************************************************/ 02282000
*   /*                                                               */ 02283000
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/ 02284000
*   /*                                                               */ 02285000
*   /*****************************************************************/ 02286000
*                                                                  0706 02287000
*   IF RPLRCODE=NORECFND|INDVSRNO^=DUPSERNO/*                @Y30LB25   02288000
*                                      NO RECORD FND OR      @Y30LB25   02289000
*                                      WRONG SERIAL NO?      @Y30LB25*/ 02290000
*     THEN                          /* YES                   @Y30LB25*/ 02291000
@RF00701 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0706 02292000
         BE    @RT00706                                            0706 02293000
         L     @08,DUPVPTR                                         0706 02294000
         CLC   INDVSRNO(6,INDEXPTR),DUPSERNO(@08)                  0706 02295000
         BE    @RF00706                                            0706 02296000
@RT00706 DS    0H                                                  0707 02297000
*     DO;                           /*                       @Y30LB25*/ 02298000
*                                                                  0707 02299000
*       /*************************************************************/ 02300000
*       /*                                                           */ 02301000
*       /* CREATE A CIR FOR CSN1                             @Y30LB25*/ 02302000
*       /*                                                           */ 02303000
*       /*************************************************************/ 02304000
*                                                                  0708 02305000
*       CSNUMBER=ON;                /* CSN1                  @Y30LB25*/ 02306000
         OI    CSNUMBER,B'00000100'                                0708 02307000
*       BCDVPTR=DUPVPTR;            /* DVR PTR               @Y30LB25*/ 02308000
         L     @08,DUPVPTR                                         0709 02309000
         ST    @08,BCDVPTR                                         0709 02310000
*       CALL VUCIR;                 /*                       @Y30LB25   02311000
*                                      MAKE CIR FOR CSN1     @Y30LB25*/ 02312000
         BAL   @14,VUCIR                                           0710 02313000
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/ 02314000
*         THEN                      /* ERROR                 @Y30LB25*/ 02315000
         LH    @08,RPLVRETC(,RPLVPTR)                              0711 02316000
         N     @08,@CF00815                                        0711 02317000
         LTR   @08,@08                                             0711 02318000
         BZ    @RF00711                                            0711 02319000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 02320000
         BAL   @14,PLIBMSG                                         0712 02321000
*       RETURN;                     /*                       @Y30LB25*/ 02322000
         B     @EL00013                                            0713 02323000
*     END;                          /*                       @Y30LB25*/ 02324000
*                                                                  0714 02325000
*   /*****************************************************************/ 02326000
*   /*                                                               */ 02327000
*   /* DELETE CIR FOR THE REPLACED CSN1                      @Y30LB25*/ 02328000
*   /*                                                               */ 02329000
*   /*****************************************************************/ 02330000
*                                                                  0715 02331000
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/ 02332000
@RF00706 MVI   RPLVTYP(RPLVPTR),X'05'                              0715 02333000
*   RESPECIFY                       /*                       @Y30LB25*/ 02334000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 02335000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 02336000
         LR    RG1,RPLVPTR                                         0717 02337000
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/ 02338000
         L     @15,@CV00610                                        0718 02339000
         BALR  @14,@15                                             0718 02340000
*   RESPECIFY                       /*                       @Y30LB25*/ 02341000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 02342000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 02343000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 02344000
         LH    @08,RPLVRETC(,RPLVPTR)                              0720 02345000
         N     @08,@CF00815                                        0720 02346000
         LTR   @08,@08                                             0720 02347000
         BZ    @RF00720                                            0720 02348000
*     DO;                           /* NO REC FND            @Y30LB25*/ 02349000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 02350000
         BAL   @14,PLIBMSG                                         0722 02351000
*       RETURN;                     /*                       @Y30LB25*/ 02352000
         B     @EL00013                                            0723 02353000
*     END;                          /*                       @Y30LB25*/ 02354000
*                                                                  0724 02355000
*   /*****************************************************************/ 02356000
*   /*                                                               */ 02357000
*   /* CREATE A CIR FOR CSN1                                 @Y30LB25*/ 02358000
*   /*                                                               */ 02359000
*   /*****************************************************************/ 02360000
*                                                                  0725 02361000
*   CSNUMBER=ON;                    /* CSN1                  @Y30LB25*/ 02362000
@RF00720 OI    CSNUMBER,B'00000100'                                0725 02363000
*   BCDVPTR=DUPVPTR;                /* DVR PTR               @Y30LB25*/ 02364000
         L     @08,DUPVPTR                                         0726 02365000
         ST    @08,BCDVPTR                                         0726 02366000
*   CALL VUCIR;                     /*                       @Y30LB25   02367000
*                                      MAKE CIR FOR CSN1     @Y30LB25*/ 02368000
         BAL   @14,VUCIR                                           0727 02369000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 02370000
*     THEN                          /* ERROR                 @Y30LB25*/ 02371000
         LH    @08,RPLVRETC(,RPLVPTR)                              0728 02372000
         N     @08,@CF00815                                        0728 02373000
         LTR   @08,@08                                             0728 02374000
         BZ    @RF00728                                            0728 02375000
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/ 02376000
         BAL   @14,PLIBMSG                                         0729 02377000
*   RETURN;                         /*                       @Y30LB25*/ 02378000
         B     @EL00013                                            0730 02379000
*   END DVRCSN1;                    /*                       @Y30LB25*/ 02380000
         B     @EL00013                                            0731 02381000
*                                                                  0732 02382000
*   /*****************************************************************/ 02383000
*   /*                                                               */ 02384000
*   /* PROCEDURE NAME - DVRCSN2                              @Y30LB25*/ 02385000
*   /*                                                       @Y30LB25*/ 02386000
*   /* FUNCTION - WRITE THE DVR.                             @Y30LB25*/ 02387000
*   /* READ FOR CIR OF REPLACED CSN2.                        @Y30LB25*/ 02388000
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/ 02389000
*   /* DVR, CREATE A NEW CIR FOR CSN2 OF DVR AND RETURN.     @Y30LB25*/ 02390000
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN2          @Y30LB25*/ 02391000
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/ 02392000
*   /*                                                       @Y30LB25*/ 02393000
*   /* INPUT -                                               @Y30LB25*/ 02394000
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/ 02395000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 02396000
*   /*                                                       @Y30LB25*/ 02397000
*   /* OUTPUT -                                              @Y30LB25*/ 02398000
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/ 02399000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 02400000
*   /*                                                               */ 02401000
*   /*****************************************************************/ 02402000
*                                                                  0732 02403000
*DVRCSN2:                           /*                       @Y30LB25*/ 02404000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 02405000
*                                                                  0732 02406000
DVRCSN2  ST    @14,@SA00014                                        0732 02407000
*   /*****************************************************************/ 02408000
*   /*                                                               */ 02409000
*   /* WRITE THE DVR FOR THE CARTRIDGE PAIRED WITH THE       @Y30LB25*/ 02410000
*   /* ONE ENTERED                                           @Y30LB25*/ 02411000
*   /*                                                               */ 02412000
*   /*****************************************************************/ 02413000
*                                                                  0733 02414000
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/ 02415000
         MVI   RPLVTYP(RPLVPTR),X'01'                              0733 02416000
*   RESPECIFY                       /*                       @Y30LB25*/ 02417000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 02418000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 02419000
         LR    RG1,RPLVPTR                                         0735 02420000
*   CALL ICBVIO00;                  /* WRITE DVR             @Y30LB25*/ 02421000
         L     @15,@CV00610                                        0736 02422000
         BALR  @14,@15                                             0736 02423000
*   RESPECIFY                       /*                       @Y30LB25*/ 02424000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 02425000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 02426000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 02427000
         LH    @08,RPLVRETC(,RPLVPTR)                              0738 02428000
         N     @08,@CF00815                                        0738 02429000
         LTR   @08,@08                                             0738 02430000
         BZ    @RF00738                                            0738 02431000
*     DO;                           /* NO REC FND            @Y30LB25*/ 02432000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 02433000
         BAL   @14,PLIBMSG                                         0740 02434000
*       RETURN;                     /*                       @Y30LB25*/ 02435000
@EL00014 DS    0H                                                  0741 02436000
@EF00014 DS    0H                                                  0741 02437000
@ER00014 L     @14,@SA00014                                        0741 02438000
         BR    @14                                                 0741 02439000
*     END;                          /*                       @Y30LB25*/ 02440000
*                                                                  0742 02441000
*   /*****************************************************************/ 02442000
*   /*                                                               */ 02443000
*   /* READ FOR CIR OF REPLACED CSN2 OF THE DVR              @Y30LB25*/ 02444000
*   /* IVOLKY CAN BE BLANKS FOR A NEWLY CREATED DVR.         @Y30LB25*/ 02445000
*   /*                                                               */ 02446000
*   /*****************************************************************/ 02447000
*                                                                  0743 02448000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 02449000
@RF00738 MVI   RPLVTYP(RPLVPTR),X'00'                              0743 02450000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 02451000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0744 02452000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 02453000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0745 02454000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 02455000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0746 02456000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 02457000
         LA    @08,IKEY                                            0747 02458000
         ST    @08,RPLVKEY(,RPLVPTR)                               0747 02459000
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/ 02460000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0748 02461000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/ 02462000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0749 02463000
*   RESPECIFY                       /*                       @Y30LB25*/ 02464000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 02465000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 02466000
         LR    RG1,RPLVPTR                                         0751 02467000
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/ 02468000
         L     @15,@CV00610                                        0752 02469000
         BALR  @14,@15                                             0752 02470000
*   RESPECIFY                       /*                       @Y30LB25*/ 02471000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 02472000
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/ 02473000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 02474000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0754 02475000
         BNE   @RF00754                                            0754 02476000
*     DO;                           /* NO REC FND            @Y30LB25*/ 02477000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 02478000
         BAL   @14,PLIBMSG                                         0756 02479000
*       RETURN;                     /*                       @Y30LB25*/ 02480000
         B     @EL00014                                            0757 02481000
*     END;                          /*                       @Y30LB25*/ 02482000
*                                                                  0758 02483000
*   /*****************************************************************/ 02484000
*   /*                                                               */ 02485000
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/ 02486000
*   /*                                                               */ 02487000
*   /*****************************************************************/ 02488000
*                                                                  0759 02489000
*   IF RPLRCODE=NORECFND|INDVSRNO^=DUPSERNO/*                @Y30LB25   02490000
*                                      NO RECORD FND OR      @Y30LB25   02491000
*                                      WRONG SERIAL NO?      @Y30LB25*/ 02492000
*     THEN                          /* YES                   @Y30LB25*/ 02493000
@RF00754 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0759 02494000
         BE    @RT00759                                            0759 02495000
         L     @08,DUPVPTR                                         0759 02496000
         CLC   INDVSRNO(6,INDEXPTR),DUPSERNO(@08)                  0759 02497000
         BE    @RF00759                                            0759 02498000
@RT00759 DS    0H                                                  0760 02499000
*     DO;                           /*                       @Y30LB25*/ 02500000
*                                                                  0760 02501000
*       /*************************************************************/ 02502000
*       /*                                                           */ 02503000
*       /* CREATE A CIR FOR CSN2                             @Y30LB25*/ 02504000
*       /*                                                           */ 02505000
*       /*************************************************************/ 02506000
*                                                                  0761 02507000
*       CSNUMBER=OFF;               /* CSN2                  @Y30LB25*/ 02508000
         NI    CSNUMBER,B'11111011'                                0761 02509000
*       BCDVPTR=DUPVPTR;            /* DVR PTR               @Y30LB25*/ 02510000
         L     @08,DUPVPTR                                         0762 02511000
         ST    @08,BCDVPTR                                         0762 02512000
*       CALL VUCIR;                 /*                       @Y30LB25   02513000
*                                      MAKE CIR FOR CSN2     @Y30LB25*/ 02514000
         BAL   @14,VUCIR                                           0763 02515000
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/ 02516000
*         THEN                      /* ERROR                 @Y30LB25*/ 02517000
         LH    @08,RPLVRETC(,RPLVPTR)                              0764 02518000
         N     @08,@CF00815                                        0764 02519000
         LTR   @08,@08                                             0764 02520000
         BZ    @RF00764                                            0764 02521000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 02522000
         BAL   @14,PLIBMSG                                         0765 02523000
*       RETURN;                     /*                       @Y30LB25*/ 02524000
         B     @EL00014                                            0766 02525000
*     END;                          /*                       @Y30LB25*/ 02526000
*                                                                  0767 02527000
*   /*****************************************************************/ 02528000
*   /*                                                               */ 02529000
*   /* DELETE CIR FOR THE REPLACED CSN2                      @Y30LB25*/ 02530000
*   /*                                                               */ 02531000
*   /*****************************************************************/ 02532000
*                                                                  0768 02533000
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/ 02534000
@RF00759 MVI   RPLVTYP(RPLVPTR),X'05'                              0768 02535000
*   RESPECIFY                       /*                       @Y30LB25*/ 02536000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 02537000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 02538000
         LR    RG1,RPLVPTR                                         0770 02539000
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/ 02540000
         L     @15,@CV00610                                        0771 02541000
         BALR  @14,@15                                             0771 02542000
*   RESPECIFY                       /*                       @Y30LB25*/ 02543000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 02544000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 02545000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 02546000
         LH    @08,RPLVRETC(,RPLVPTR)                              0773 02547000
         N     @08,@CF00815                                        0773 02548000
         LTR   @08,@08                                             0773 02549000
         BZ    @RF00773                                            0773 02550000
*     DO;                           /* NO REC FND            @Y30LB25*/ 02551000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 02552000
         BAL   @14,PLIBMSG                                         0775 02553000
*       RETURN;                     /*                       @Y30LB25*/ 02554000
         B     @EL00014                                            0776 02555000
*     END;                          /*                       @Y30LB25*/ 02556000
*                                                                  0777 02557000
*   /*****************************************************************/ 02558000
*   /*                                                               */ 02559000
*   /* CREATE A CIR FOR CSN2                                 @Y30LB25*/ 02560000
*   /*                                                               */ 02561000
*   /*****************************************************************/ 02562000
*                                                                  0778 02563000
*   CSNUMBER=OFF;                   /* CSN2                  @Y30LB25*/ 02564000
@RF00773 NI    CSNUMBER,B'11111011'                                0778 02565000
*   BCDVPTR=DUPVPTR;                /* DVR PTR               @Y30LB25*/ 02566000
         L     @08,DUPVPTR                                         0779 02567000
         ST    @08,BCDVPTR                                         0779 02568000
*   CALL VUCIR;                     /*                       @Y30LB25   02569000
*                                      MAKE CIR FOR CSN2     @Y30LB25*/ 02570000
         BAL   @14,VUCIR                                           0780 02571000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 02572000
*     THEN                          /* ERROR                 @Y30LB25*/ 02573000
         LH    @08,RPLVRETC(,RPLVPTR)                              0781 02574000
         N     @08,@CF00815                                        0781 02575000
         LTR   @08,@08                                             0781 02576000
         BZ    @RF00781                                            0781 02577000
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/ 02578000
         BAL   @14,PLIBMSG                                         0782 02579000
*   RETURN;                         /*                       @Y30LB25*/ 02580000
         B     @EL00014                                            0783 02581000
*   END DVRCSN2;                    /*                       @Y30LB25*/ 02582000
         B     @EL00014                                            0784 02583000
*                                                                  0785 02584000
*   /*****************************************************************/ 02585000
*   /*                                                               */ 02586000
*   /* PROCEDURE NAME - CKBVR1                               @Y30LB25*/ 02587000
*   /*                                                       @Y30LB25*/ 02588000
*   /* FUNCTION - UPDATE A BVR AND CIR FOR THE CSN OF THE    @Y30LB25*/ 02589000
*   /* CARTRIDGE ENTERED.                                    @Y30LB25*/ 02590000
*   /*                                                       @Y30LB25*/ 02591000
*   /* INPUT -                                               @Y30LB25*/ 02592000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 02593000
*   /*                                                       @Y30LB25*/ 02594000
*   /* OUTPUT -                                              @Y30LB25*/ 02595000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 02596000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 02597000
*   /*                                                               */ 02598000
*   /*****************************************************************/ 02599000
*                                                                  0785 02600000
*CKBVR1:                            /*                       @Y30LB25*/ 02601000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 02602000
*                                                                  0785 02603000
CKBVR1   ST    @14,@SA00015                                        0785 02604000
*   /*****************************************************************/ 02605000
*   /*                                                               */ 02606000
*   /* GET THE BVR FROM THE CSN OF THE CARTRIDGE ENTERED     @Y30LB25*/ 02607000
*   /*                                                               */ 02608000
*   /*****************************************************************/ 02609000
*                                                                  0786 02610000
*   BKEY=INDRECKY;                  /* BVR KEY               @Y30LB25*/ 02611000
         MVC   BKEY(13),INDRECKY(INDEXPTR)                         0786 02612000
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/ 02613000
         LA    @08,BKEY                                            0787 02614000
         ST    @08,RPLVKEY(,RPLVPTR)                               0787 02615000
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/ 02616000
         L     @08,BASEVPTR                                        0788 02617000
         ST    @08,RPLVBUF(,RPLVPTR)                               0788 02618000
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BVR BUF LENGTH    @Y30LB25*/ 02619000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0789 02620000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 02621000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0790 02622000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 02623000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0791 02624000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 02625000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0792 02626000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 02627000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0793 02628000
*   RESPECIFY                       /*                       @Y30LB25*/ 02629000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 02630000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 02631000
         LR    RG1,RPLVPTR                                         0795 02632000
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/ 02633000
         L     @15,@CV00610                                        0796 02634000
         BALR  @14,@15                                             0796 02635000
*   RESPECIFY                       /*                       @Y30LB25*/ 02636000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 02637000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 02638000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 02639000
         LH    @08,RPLVRETC(,RPLVPTR)                              0798 02640000
         N     @08,@CF00815                                        0798 02641000
         LTR   @08,@08                                             0798 02642000
         BZ    @RF00798                                            0798 02643000
*     DO;                           /* NO REC FND            @Y30LB25*/ 02644000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 02645000
         BAL   @14,PLIBMSG                                         0800 02646000
*       RETURN;                     /*                       @Y30LB25*/ 02647000
@EL00015 DS    0H                                                  0801 02648000
@EF00015 DS    0H                                                  0801 02649000
@ER00015 L     @14,@SA00015                                        0801 02650000
         BR    @14                                                 0801 02651000
*     END;                          /*                       @Y30LB25*/ 02652000
*                                                                  0802 02653000
*   /*****************************************************************/ 02654000
*   /*                                                               */ 02655000
*   /* SET THE DOWN LEVEL SPACE FLAGE                        @Y30LB25*/ 02656000
*   /*                                                               */ 02657000
*   /*****************************************************************/ 02658000
*                                                                  0803 02659000
*   BASDLSF=ON;                     /* DOWN LEVEL SPACE      @Y30LB25*/ 02660000
*                                                                  0803 02661000
@RF00798 L     @08,BASEVPTR                                        0803 02662000
         OI    BASDLSF(@08),B'10000000'                            0803 02663000
*   /*****************************************************************/ 02664000
*   /*                                                               */ 02665000
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/ 02666000
*   /*                                                               */ 02667000
*   /*****************************************************************/ 02668000
*                                                                  0804 02669000
*   IF(CSN1USM=BASCSN1&CSN2USM=BASCSN2)|/* ALL CSNS MATCH?   @Y30LB25*/ 02670000
*       (CSN1USM=BASCSN2&CSN2USM=BASCSN1)/*                  @Y30LB25*/ 02671000
*     THEN                          /* YES                   @Y30LB25*/ 02672000
         LA    @04,8                                               0804 02673000
         ALR   @04,MESGPTR                                         0804 02674000
         CLC   CSN1USM(12,@04),BASCSN1(@08)                        0804 02675000
         BNE   @GL00017                                            0804 02676000
         CLC   CSN2USM(12,@04),BASCSN2(@08)                        0804 02677000
         BE    @RT00804                                            0804 02678000
@GL00017 LA    @08,8                                               0804 02679000
         ALR   @08,MESGPTR                                         0804 02680000
         L     @04,BASEVPTR                                        0804 02681000
         CLC   CSN1USM(12,@08),BASCSN2(@04)                        0804 02682000
         BNE   @RF00804                                            0804 02683000
         CLC   CSN2USM(12,@08),BASCSN1(@04)                        0804 02684000
         BNE   @RF00804                                            0804 02685000
@RT00804 DS    0H                                                  0805 02686000
*     DO;                           /*                       @Y30LB25*/ 02687000
*                                                                  0805 02688000
*       /*************************************************************/ 02689000
*       /*                                                           */ 02690000
*       /* CHECK FOR CSN1                                    @Y30LB25*/ 02691000
*       /*                                                           */ 02692000
*       /*************************************************************/ 02693000
*                                                                  0806 02694000
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/ 02695000
*         THEN                      /* YES                   @Y30LB25*/ 02696000
         LA    @08,8                                               0806 02697000
         ALR   @08,MESGPTR                                         0806 02698000
         CLI   SEQNUM(@08),X'F1'                                   0806 02699000
         BNE   @RF00806                                            0806 02700000
*         DO;                       /*                       @Y30LB25*/ 02701000
*                                                                  0807 02702000
*           /*********************************************************/ 02703000
*           /*                                                       */ 02704000
*           /* SET LIBID1                                    @Y30LB25*/ 02705000
*           /*                                                       */ 02706000
*           /*********************************************************/ 02707000
*                                                                  0808 02708000
*           BASLIB1=BASLIB1&&BASLIB1;/* ZERO LIBID1          @Y30LB25*/ 02709000
         L     @04,BASEVPTR                                        0808 02710000
         SLR   @03,@03                                             0808 02711000
         IC    @03,BASLIB1(,@04)                                   0808 02712000
         LR    @15,@03                                             0808 02713000
         XR    @15,@03                                             0808 02714000
         STC   @15,BASLIB1(,@04)                                   0808 02715000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 02716000
*             THEN                  /* YES                   @Y30LB25*/ 02717000
         TM    LUSM1(@08),B'10000000'                              0809 02718000
         BNO   @RF00809                                            0809 02719000
*             BAS1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/ 02720000
         OI    BAS1BIT1(@04),B'00000010'                           0810 02721000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 02722000
*             THEN                  /* YES                   @Y30LB25*/ 02723000
@RF00809 TM    LUSM2+8(MESGPTR),B'01000000'                        0811 02724000
         BNO   @RF00811                                            0811 02725000
*             BAS1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/ 02726000
         L     @08,BASEVPTR                                        0812 02727000
         OI    BAS1BIT2(@08),B'00000001'                           0812 02728000
*           BASCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/ 02729000
@RF00811 L     @08,BASEVPTR                                        0813 02730000
         LA    @04,8                                               0813 02731000
         ALR   @04,MESGPTR                                         0813 02732000
         MVC   BASCSN1(12,@08),CSN1USM(@04)                        0813 02733000
*           BASCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/ 02734000
         MVC   BASCSN2(12,@08),CSN2USM(@04)                        0814 02735000
*         END;                      /*                       @Y30LB25*/ 02736000
*                                                                  0815 02737000
*       /*************************************************************/ 02738000
*       /*                                                           */ 02739000
*       /* CSN2                                              @Y30LB25*/ 02740000
*       /*                                                           */ 02741000
*       /*************************************************************/ 02742000
*                                                                  0816 02743000
*       ELSE                        /* CSN2                  @Y30LB25*/ 02744000
*                                                                  0816 02745000
*         /***********************************************************/ 02746000
*         /*                                                         */ 02747000
*         /* SET LIBID2                                      @Y30LB25*/ 02748000
*         /*                                                         */ 02749000
*         /***********************************************************/ 02750000
*                                                                  0816 02751000
*         DO;                       /*                       @Y30LB25*/ 02752000
         B     @RC00806                                            0816 02753000
@RF00806 DS    0H                                                  0817 02754000
*           BASLIB2=BASLIB2&&BASLIB2;/* ZERO LIBID2          @Y30LB25*/ 02755000
         L     @08,BASEVPTR                                        0817 02756000
         SLR   @04,@04                                             0817 02757000
         IC    @04,BASLIB2(,@08)                                   0817 02758000
         LR    @03,@04                                             0817 02759000
         XR    @03,@04                                             0817 02760000
         STC   @03,BASLIB2(,@08)                                   0817 02761000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 02762000
*             THEN                  /* YES                   @Y30LB25*/ 02763000
         TM    LUSM1+8(MESGPTR),B'10000000'                        0818 02764000
         BNO   @RF00818                                            0818 02765000
*             BAS2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/ 02766000
         OI    BAS2BIT1(@08),B'00000010'                           0819 02767000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 02768000
*             THEN                  /* YES                   @Y30LB25*/ 02769000
@RF00818 TM    LUSM2+8(MESGPTR),B'01000000'                        0820 02770000
         BNO   @RF00820                                            0820 02771000
*             BAS2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/ 02772000
         L     @08,BASEVPTR                                        0821 02773000
         OI    BAS2BIT2(@08),B'00000001'                           0821 02774000
*           BASCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/ 02775000
@RF00820 L     @08,BASEVPTR                                        0822 02776000
         LA    @04,8                                               0822 02777000
         ALR   @04,MESGPTR                                         0822 02778000
         MVC   BASCSN1(12,@08),CSN2USM(@04)                        0822 02779000
*           BASCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/ 02780000
         MVC   BASCSN2(12,@08),CSN1USM(@04)                        0823 02781000
*         END;                      /*                       @Y30LB25*/ 02782000
*                                                                  0824 02783000
*       /*************************************************************/ 02784000
*       /*                                                           */ 02785000
*       /* UPDATE THE BVR                                    @Y30LB25*/ 02786000
*       /*                                                           */ 02787000
*       /*************************************************************/ 02788000
*                                                                  0825 02789000
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 02790000
@RC00806 L     @08,BASEVPTR                                        0825 02791000
         MVI   BASDTREM+1(@08),C' '                                0825 02792000
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0825 02793000
         MVI   BASDTREM(@08),C' '                                  0825 02794000
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 02795000
*                                                                  0826 02796000
         MVI   BASDEST+1(@08),C' '                                 0826 02797000
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0826 02798000
         MVI   BASDEST(@08),C' '                                   0826 02799000
*       /*************************************************************/ 02800000
*       /*                                                           */ 02801000
*       /* WRITE THE BVR                                     @Y30LB25*/ 02802000
*       /*                                                           */ 02803000
*       /*************************************************************/ 02804000
*                                                                  0827 02805000
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/ 02806000
         MVI   RPLVTYP(RPLVPTR),X'01'                              0827 02807000
*       RESPECIFY                   /*                       @Y30LB25*/ 02808000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 02809000
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/ 02810000
         LR    RG1,RPLVPTR                                         0829 02811000
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/ 02812000
         L     @15,@CV00610                                        0830 02813000
         BALR  @14,@15                                             0830 02814000
*       RESPECIFY                   /*                       @Y30LB25*/ 02815000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 02816000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/ 02817000
*         THEN                      /*                       @Y30LB25*/ 02818000
         LH    @08,RPLVRETC(,RPLVPTR)                              0832 02819000
         N     @08,@CF00815                                        0832 02820000
         LTR   @08,@08                                             0832 02821000
         BZ    @RF00832                                            0832 02822000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 02823000
         BAL   @14,PLIBMSG                                         0833 02824000
*       RETURN;                     /*                       @Y30LB25*/ 02825000
         B     @EL00015                                            0834 02826000
*     END;                          /*                       @Y30LB25*/ 02827000
*                                                                  0835 02828000
*   /*****************************************************************/ 02829000
*   /*                                                               */ 02830000
*   /* OTHER CARTRIDGE PAIRED WITH THE ONE ENTERED MUST      @Y30LB25*/ 02831000
*   /* NOT MATCH EITHER CSN1 OR CSN2 IN THE BVR              @Y30LB25*/ 02832000
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN        @Y30LB25*/ 02833000
*   /* ENTERED MATCHES.                                      @Y30LB25*/ 02834000
*   /*                                                               */ 02835000
*   /*****************************************************************/ 02836000
*                                                                  0836 02837000
*   IF BASCSN1^=CSN1USM             /* NO MATCH CSN1?        @Y30LB25*/ 02838000
*     THEN                          /* YES                   @Y30LB25*/ 02839000
@RF00804 L     @08,BASEVPTR                                        0836 02840000
         LA    @04,8                                               0836 02841000
         ALR   @04,MESGPTR                                         0836 02842000
         CLC   BASCSN1(12,@08),CSN1USM(@04)                        0836 02843000
         BE    @RF00836                                            0836 02844000
*     DO;                           /*                       @Y30LB25*/ 02845000
*       IVOLKY=BASCSN1;             /* SAVE CSN1             @Y30LB25*/ 02846000
         MVC   IVOLKY(12),BASCSN1(@08)                             0838 02847000
*       BASCSN1=CSN2USM;            /* UPDATE BVR CSN1       @Y30LB25*/ 02848000
         MVC   BASCSN1(12,@08),CSN2USM(@04)                        0839 02849000
*       BASLIB1=BASLIB1&&BASLIB1;   /* ZERO LIBID1           @Y30LB25*/ 02850000
         SLR   @03,@03                                             0840 02851000
         IC    @03,BASLIB1(,@08)                                   0840 02852000
         LR    @15,@03                                             0840 02853000
         XR    @15,@03                                             0840 02854000
         STC   @15,BASLIB1(,@08)                                   0840 02855000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 02856000
*         THEN                      /* YES                   @Y30LB25*/ 02857000
         TM    LUSM1(@04),B'10000000'                              0841 02858000
         BNO   @RF00841                                            0841 02859000
*         BAS1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/ 02860000
         OI    BAS1BIT1(@08),B'00000010'                           0842 02861000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 02862000
*         THEN                      /* YES                   @Y30LB25*/ 02863000
@RF00841 TM    LUSM2+8(MESGPTR),B'01000000'                        0843 02864000
         BNO   @RF00843                                            0843 02865000
*         BAS1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/ 02866000
         L     @08,BASEVPTR                                        0844 02867000
         OI    BAS1BIT2(@08),B'00000001'                           0844 02868000
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 02869000
@RF00843 L     @08,BASEVPTR                                        0845 02870000
         MVI   BASDTREM+1(@08),C' '                                0845 02871000
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0845 02872000
         MVI   BASDTREM(@08),C' '                                  0845 02873000
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 02874000
         MVI   BASDEST+1(@08),C' '                                 0846 02875000
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0846 02876000
         MVI   BASDEST(@08),C' '                                   0846 02877000
*       CALL BVRCSN1;               /* PROC BVR CSN1 CIR     @Y30LB25*/ 02878000
         BAL   @14,BVRCSN1                                         0847 02879000
*       RETURN;                     /*                       @Y30LB25*/ 02880000
         B     @EL00015                                            0848 02881000
*     END;                          /*                       @Y30LB25*/ 02882000
*   ELSE                            /* NO MATCH BVR CSN2     @Y30LB25*/ 02883000
*     DO;                           /*                       @Y30LB25*/ 02884000
@RF00836 DS    0H                                                  0851 02885000
*       IVOLKY=BASCSN2;             /* SAVE CSN2             @Y30LB25*/ 02886000
         L     @08,BASEVPTR                                        0851 02887000
         MVC   IVOLKY(12),BASCSN2(@08)                             0851 02888000
*       BASCSN2=CSN2USM;            /* UPDATE BVR CSN2       @Y30LB25*/ 02889000
         LA    @04,8                                               0852 02890000
         ALR   @04,MESGPTR                                         0852 02891000
         MVC   BASCSN2(12,@08),CSN2USM(@04)                        0852 02892000
*       BASLIB2=BASLIB2&&BASLIB2;   /* ZERO LIBID2           @Y30LB25*/ 02893000
         SLR   @03,@03                                             0853 02894000
         IC    @03,BASLIB2(,@08)                                   0853 02895000
         LR    @15,@03                                             0853 02896000
         XR    @15,@03                                             0853 02897000
         STC   @15,BASLIB2(,@08)                                   0853 02898000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 02899000
*         THEN                      /* YES                   @Y30LB25*/ 02900000
         TM    LUSM1(@04),B'10000000'                              0854 02901000
         BNO   @RF00854                                            0854 02902000
*         BAS2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/ 02903000
         OI    BAS2BIT1(@08),B'00000010'                           0855 02904000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 02905000
*         THEN                      /* YES                   @Y30LB25*/ 02906000
@RF00854 TM    LUSM2+8(MESGPTR),B'01000000'                        0856 02907000
         BNO   @RF00856                                            0856 02908000
*         BAS2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/ 02909000
         L     @08,BASEVPTR                                        0857 02910000
         OI    BAS2BIT2(@08),B'00000001'                           0857 02911000
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 02912000
@RF00856 L     @08,BASEVPTR                                        0858 02913000
         MVI   BASDTREM+1(@08),C' '                                0858 02914000
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0858 02915000
         MVI   BASDTREM(@08),C' '                                  0858 02916000
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 02917000
         MVI   BASDEST+1(@08),C' '                                 0859 02918000
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0859 02919000
         MVI   BASDEST(@08),C' '                                   0859 02920000
*       CALL BVRCSN2;               /* PROC BVR CSN2 CIR     @Y30LB25*/ 02921000
         BAL   @14,BVRCSN2                                         0860 02922000
*       RETURN;                     /*                       @Y30LB25*/ 02923000
         B     @EL00015                                            0861 02924000
*     END;                          /*                       @Y30LB25*/ 02925000
*   END CKBVR1;                     /*                       @Y30LB25*/ 02926000
         B     @EL00015                                            0863 02927000
*                                                                  0864 02928000
*   /*****************************************************************/ 02929000
*   /*                                                               */ 02930000
*   /* PROCEDURE NAME - CKBVR2                               @Y30LB25*/ 02931000
*   /*                                                       @Y30LB25*/ 02932000
*   /* FUNCTION - UPDATE A BVR AND CIR FOR THE CSN OF THE    @Y30LB25*/ 02933000
*   /* OTHER CARTRIDGE TO THE PAIR FOR THE ONE ENTERED.      @Y30LB25*/ 02934000
*   /*                                                       @Y30LB25*/ 02935000
*   /* INPUT -                                               @Y30LB25*/ 02936000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 02937000
*   /*                                                       @Y30LB25*/ 02938000
*   /* OUTPUT -                                              @Y30LB25*/ 02939000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 02940000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 02941000
*   /*                                                               */ 02942000
*   /*****************************************************************/ 02943000
*                                                                  0864 02944000
*CKBVR2:                            /*                       @Y30LB25*/ 02945000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 02946000
*                                                                  0864 02947000
CKBVR2   ST    @14,@SA00016                                        0864 02948000
*   /*****************************************************************/ 02949000
*   /*                                                               */ 02950000
*   /* GET THE BVR FROM THE CSN OF THE CARTRIDGE PAIRED      @Y30LB25*/ 02951000
*   /* WITH THE ONE ENTERED                                  @Y30LB25*/ 02952000
*   /*                                                               */ 02953000
*   /*****************************************************************/ 02954000
*                                                                  0865 02955000
*   BKEY=INDRECKY;                  /* BVR KEY               @Y30LB25*/ 02956000
         MVC   BKEY(13),INDRECKY(INDEXPTR)                         0865 02957000
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/ 02958000
         LA    @08,BKEY                                            0866 02959000
         ST    @08,RPLVKEY(,RPLVPTR)                               0866 02960000
*   RPLVBUF=BASEVPTR;               /* PT TO BVR BUF         @Y30LB25*/ 02961000
         L     @08,BASEVPTR                                        0867 02962000
         ST    @08,RPLVBUF(,RPLVPTR)                               0867 02963000
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BVR BUF LENGTH    @Y30LB25*/ 02964000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         0868 02965000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 02966000
         MVI   RPLVTYP(RPLVPTR),X'00'                              0869 02967000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 02968000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0870 02969000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 02970000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0871 02971000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 02972000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0872 02973000
*   RESPECIFY                       /*                       @Y30LB25*/ 02974000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 02975000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 02976000
         LR    RG1,RPLVPTR                                         0874 02977000
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/ 02978000
         L     @15,@CV00610                                        0875 02979000
         BALR  @14,@15                                             0875 02980000
*   RESPECIFY                       /*                       @Y30LB25*/ 02981000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 02982000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 02983000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 02984000
         LH    @08,RPLVRETC(,RPLVPTR)                              0877 02985000
         N     @08,@CF00815                                        0877 02986000
         LTR   @08,@08                                             0877 02987000
         BZ    @RF00877                                            0877 02988000
*     DO;                           /* NO REC FND            @Y30LB25*/ 02989000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 02990000
         BAL   @14,PLIBMSG                                         0879 02991000
*       RETURN;                     /*                       @Y30LB25*/ 02992000
@EL00016 DS    0H                                                  0880 02993000
@EF00016 DS    0H                                                  0880 02994000
@ER00016 L     @14,@SA00016                                        0880 02995000
         BR    @14                                                 0880 02996000
*     END;                          /*                       @Y30LB25*/ 02997000
*                                                                  0881 02998000
*   /*****************************************************************/ 02999000
*   /*                                                               */ 03000000
*   /* SET THE DOWN LEVEL SPCAE FLAG                         @Y30LB25*/ 03001000
*   /*                                                               */ 03002000
*   /*****************************************************************/ 03003000
*                                                                  0882 03004000
*   BASDLSF=ON;                     /* DOWN LEVEL SPACE      @Y30LB25*/ 03005000
*                                                                  0882 03006000
@RF00877 L     @08,BASEVPTR                                        0882 03007000
         OI    BASDLSF(@08),B'10000000'                            0882 03008000
*   /*****************************************************************/ 03009000
*   /*                                                               */ 03010000
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/ 03011000
*   /*                                                               */ 03012000
*   /*****************************************************************/ 03013000
*                                                                  0883 03014000
*   IF(CSN1USM=BASCSN1&CSN2USM=BASCSN2)|/* ALL CSNS MATCH?   @Y30LB25*/ 03015000
*       (CSN1USM=BASCSN2&CSN2USM=BASCSN1)/*                  @Y30LB25*/ 03016000
*     THEN                          /* YES                   @Y30LB25*/ 03017000
         LA    @04,8                                               0883 03018000
         ALR   @04,MESGPTR                                         0883 03019000
         CLC   CSN1USM(12,@04),BASCSN1(@08)                        0883 03020000
         BNE   @GL00020                                            0883 03021000
         CLC   CSN2USM(12,@04),BASCSN2(@08)                        0883 03022000
         BE    @RT00883                                            0883 03023000
@GL00020 LA    @08,8                                               0883 03024000
         ALR   @08,MESGPTR                                         0883 03025000
         L     @04,BASEVPTR                                        0883 03026000
         CLC   CSN1USM(12,@08),BASCSN2(@04)                        0883 03027000
         BNE   @RF00883                                            0883 03028000
         CLC   CSN2USM(12,@08),BASCSN1(@04)                        0883 03029000
         BNE   @RF00883                                            0883 03030000
@RT00883 DS    0H                                                  0884 03031000
*     DO;                           /*                       @Y30LB25*/ 03032000
*                                                                  0884 03033000
*       /*************************************************************/ 03034000
*       /*                                                           */ 03035000
*       /* CHECK FOR CSN1                                    @Y30LB25*/ 03036000
*       /*                                                           */ 03037000
*       /*************************************************************/ 03038000
*                                                                  0885 03039000
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/ 03040000
*         THEN                      /* YES                   @Y30LB25*/ 03041000
         LA    @08,8                                               0885 03042000
         ALR   @08,MESGPTR                                         0885 03043000
         CLI   SEQNUM(@08),X'F1'                                   0885 03044000
         BNE   @RF00885                                            0885 03045000
*         DO;                       /*                       @Y30LB25*/ 03046000
*           BASLIB1=BASLIB1&&BASLIB1;/* ZERO LIBID1          @Y30LB25*/ 03047000
         L     @04,BASEVPTR                                        0887 03048000
         SLR   @03,@03                                             0887 03049000
         IC    @03,BASLIB1(,@04)                                   0887 03050000
         LR    @15,@03                                             0887 03051000
         XR    @15,@03                                             0887 03052000
         STC   @15,BASLIB1(,@04)                                   0887 03053000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 03054000
*             THEN                  /* YES                   @Y30LB25*/ 03055000
         TM    LUSM1(@08),B'10000000'                              0888 03056000
         BNO   @RF00888                                            0888 03057000
*             BAS1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/ 03058000
         OI    BAS1BIT1(@04),B'00000010'                           0889 03059000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 03060000
*             THEN                  /* YES                   @Y30LB25*/ 03061000
@RF00888 TM    LUSM2+8(MESGPTR),B'01000000'                        0890 03062000
         BNO   @RF00890                                            0890 03063000
*             BAS1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/ 03064000
         L     @08,BASEVPTR                                        0891 03065000
         OI    BAS1BIT2(@08),B'00000001'                           0891 03066000
*           BASCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/ 03067000
@RF00890 L     @08,BASEVPTR                                        0892 03068000
         LA    @04,8                                               0892 03069000
         ALR   @04,MESGPTR                                         0892 03070000
         MVC   BASCSN1(12,@08),CSN1USM(@04)                        0892 03071000
*           BASCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/ 03072000
         MVC   BASCSN2(12,@08),CSN2USM(@04)                        0893 03073000
*         END;                      /*                       @Y30LB25*/ 03074000
*                                                                  0894 03075000
*       /*************************************************************/ 03076000
*       /*                                                           */ 03077000
*       /* CSN2                                              @Y30LB25*/ 03078000
*       /*                                                           */ 03079000
*       /*************************************************************/ 03080000
*                                                                  0895 03081000
*       ELSE                        /* CSN2                  @Y30LB25*/ 03082000
*         DO;                       /*                       @Y30LB25*/ 03083000
*                                                                  0895 03084000
         B     @RC00885                                            0895 03085000
@RF00885 DS    0H                                                  0896 03086000
*           /*********************************************************/ 03087000
*           /*                                                       */ 03088000
*           /* SET LIBID2                                    @Y30LB25*/ 03089000
*           /*                                                       */ 03090000
*           /*********************************************************/ 03091000
*                                                                  0896 03092000
*           BASLIB2=BASLIB2&&BASLIB2;/* ZERO LIBID2          @Y30LB25*/ 03093000
         L     @08,BASEVPTR                                        0896 03094000
         SLR   @04,@04                                             0896 03095000
         IC    @04,BASLIB2(,@08)                                   0896 03096000
         LR    @03,@04                                             0896 03097000
         XR    @03,@04                                             0896 03098000
         STC   @03,BASLIB2(,@08)                                   0896 03099000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 03100000
*             THEN                  /* YES                   @Y30LB25*/ 03101000
         TM    LUSM1+8(MESGPTR),B'10000000'                        0897 03102000
         BNO   @RF00897                                            0897 03103000
*             BAS2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/ 03104000
         OI    BAS2BIT1(@08),B'00000010'                           0898 03105000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 03106000
*             THEN                  /* YES                   @Y30LB25*/ 03107000
@RF00897 TM    LUSM2+8(MESGPTR),B'01000000'                        0899 03108000
         BNO   @RF00899                                            0899 03109000
*             BAS2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/ 03110000
         L     @08,BASEVPTR                                        0900 03111000
         OI    BAS2BIT2(@08),B'00000001'                           0900 03112000
*           BASCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/ 03113000
@RF00899 L     @08,BASEVPTR                                        0901 03114000
         LA    @04,8                                               0901 03115000
         ALR   @04,MESGPTR                                         0901 03116000
         MVC   BASCSN1(12,@08),CSN2USM(@04)                        0901 03117000
*           BASCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/ 03118000
         MVC   BASCSN2(12,@08),CSN1USM(@04)                        0902 03119000
*         END;                      /*                       @Y30LB25*/ 03120000
*                                                                  0903 03121000
*       /*************************************************************/ 03122000
*       /*                                                           */ 03123000
*       /* UPDATE THE BVR                                    @Y30LB25*/ 03124000
*       /*                                                           */ 03125000
*       /*************************************************************/ 03126000
*                                                                  0904 03127000
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 03128000
@RC00885 L     @08,BASEVPTR                                        0904 03129000
         MVI   BASDTREM+1(@08),C' '                                0904 03130000
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0904 03131000
         MVI   BASDTREM(@08),C' '                                  0904 03132000
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 03133000
*                                                                  0905 03134000
         MVI   BASDEST+1(@08),C' '                                 0905 03135000
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0905 03136000
         MVI   BASDEST(@08),C' '                                   0905 03137000
*       /*************************************************************/ 03138000
*       /*                                                           */ 03139000
*       /* WRITE THE BVR                                     @Y30LB25*/ 03140000
*       /*                                                           */ 03141000
*       /*************************************************************/ 03142000
*                                                                  0906 03143000
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/ 03144000
         MVI   RPLVTYP(RPLVPTR),X'01'                              0906 03145000
*       RESPECIFY                   /*                       @Y30LB25*/ 03146000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 03147000
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/ 03148000
         LR    RG1,RPLVPTR                                         0908 03149000
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/ 03150000
         L     @15,@CV00610                                        0909 03151000
         BALR  @14,@15                                             0909 03152000
*       RESPECIFY                   /*                       @Y30LB25*/ 03153000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 03154000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/ 03155000
*         THEN                      /*                       @Y30LB25*/ 03156000
         LH    @08,RPLVRETC(,RPLVPTR)                              0911 03157000
         N     @08,@CF00815                                        0911 03158000
         LTR   @08,@08                                             0911 03159000
         BZ    @RF00911                                            0911 03160000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 03161000
         BAL   @14,PLIBMSG                                         0912 03162000
*       RETURN;                     /*                       @Y30LB25*/ 03163000
         B     @EL00016                                            0913 03164000
*     END;                          /*                       @Y30LB25*/ 03165000
*                                                                  0914 03166000
*   /*****************************************************************/ 03167000
*   /*                                                               */ 03168000
*   /* THE CARTRIDGE ENTERED MUST NOT MATCH WITH EITHER      @Y30LB25*/ 03169000
*   /* CSN1 OR CSN2 IN THE BVR.                              @Y30LB25*/ 03170000
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN NOT    @Y30LB25*/ 03171000
*   /* ENTERED MATCHES.                                      @Y30LB25*/ 03172000
*   /*                                                               */ 03173000
*   /*****************************************************************/ 03174000
*                                                                  0915 03175000
*   IF BASCSN1^=CSN2USM             /* NO MATCH CSN2?        @Y30LB25*/ 03176000
*     THEN                          /* YES                   @Y30LB25*/ 03177000
@RF00883 L     @08,BASEVPTR                                        0915 03178000
         LA    @04,8                                               0915 03179000
         ALR   @04,MESGPTR                                         0915 03180000
         CLC   BASCSN1(12,@08),CSN2USM(@04)                        0915 03181000
         BE    @RF00915                                            0915 03182000
*     DO;                           /*                       @Y30LB25*/ 03183000
*       IVOLKY=BASCSN1;             /* SAVE CSN1             @Y30LB25*/ 03184000
         MVC   IVOLKY(12),BASCSN1(@08)                             0917 03185000
*       BASCSN1=CSN1USM;            /* UPDATE BVR CSN1       @Y30LB25*/ 03186000
         MVC   BASCSN1(12,@08),CSN1USM(@04)                        0918 03187000
*       BASLIB1=BASLIB1&&BASLIB1;   /* ZERO LIBID1           @Y30LB25*/ 03188000
         SLR   @03,@03                                             0919 03189000
         IC    @03,BASLIB1(,@08)                                   0919 03190000
         LR    @15,@03                                             0919 03191000
         XR    @15,@03                                             0919 03192000
         STC   @15,BASLIB1(,@08)                                   0919 03193000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 03194000
*         THEN                      /* YES                   @Y30LB25*/ 03195000
         TM    LUSM1(@04),B'10000000'                              0920 03196000
         BNO   @RF00920                                            0920 03197000
*         BAS1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/ 03198000
         OI    BAS1BIT1(@08),B'00000010'                           0921 03199000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 03200000
*         THEN                      /* YES                   @Y30LB25*/ 03201000
@RF00920 TM    LUSM2+8(MESGPTR),B'01000000'                        0922 03202000
         BNO   @RF00922                                            0922 03203000
*         BAS1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/ 03204000
         L     @08,BASEVPTR                                        0923 03205000
         OI    BAS1BIT2(@08),B'00000001'                           0923 03206000
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 03207000
@RF00922 L     @08,BASEVPTR                                        0924 03208000
         MVI   BASDTREM+1(@08),C' '                                0924 03209000
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0924 03210000
         MVI   BASDTREM(@08),C' '                                  0924 03211000
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 03212000
         MVI   BASDEST+1(@08),C' '                                 0925 03213000
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0925 03214000
         MVI   BASDEST(@08),C' '                                   0925 03215000
*       CALL BVRCSN1;               /* PROC BVR CSN1 CIR     @Y30LB25*/ 03216000
         BAL   @14,BVRCSN1                                         0926 03217000
*       RETURN;                     /*                       @Y30LB25*/ 03218000
         B     @EL00016                                            0927 03219000
*     END;                          /*                       @Y30LB25*/ 03220000
*   ELSE                            /* NO MATCH BVR CSN2     @Y30LB25*/ 03221000
*     DO;                           /*                       @Y30LB25*/ 03222000
@RF00915 DS    0H                                                  0930 03223000
*       IVOLKY=BASCSN2;             /* SAVE CSN2             @Y30LB25*/ 03224000
         L     @08,BASEVPTR                                        0930 03225000
         MVC   IVOLKY(12),BASCSN2(@08)                             0930 03226000
*       BASCSN2=CSN1USM;            /* UPDATE BVR CSN2       @Y30LB25*/ 03227000
         LA    @04,8                                               0931 03228000
         ALR   @04,MESGPTR                                         0931 03229000
         MVC   BASCSN2(12,@08),CSN1USM(@04)                        0931 03230000
*       BASLIB2=BASLIB2&&BASLIB2;   /* ZERO LIBID2           @Y30LB25*/ 03231000
         SLR   @03,@03                                             0932 03232000
         IC    @03,BASLIB2(,@08)                                   0932 03233000
         LR    @15,@03                                             0932 03234000
         XR    @15,@03                                             0932 03235000
         STC   @15,BASLIB2(,@08)                                   0932 03236000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 03237000
*         THEN                      /* YES                   @Y30LB25*/ 03238000
         TM    LUSM1(@04),B'10000000'                              0933 03239000
         BNO   @RF00933                                            0933 03240000
*         BAS2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/ 03241000
         OI    BAS2BIT1(@08),B'00000010'                           0934 03242000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 03243000
*         THEN                      /* YES                   @Y30LB25*/ 03244000
@RF00933 TM    LUSM2+8(MESGPTR),B'01000000'                        0935 03245000
         BNO   @RF00935                                            0935 03246000
*         BAS2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/ 03247000
         L     @08,BASEVPTR                                        0936 03248000
         OI    BAS2BIT2(@08),B'00000001'                           0936 03249000
*       BASDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 03250000
@RF00935 L     @08,BASEVPTR                                        0937 03251000
         MVI   BASDTREM+1(@08),C' '                                0937 03252000
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   0937 03253000
         MVI   BASDTREM(@08),C' '                                  0937 03254000
*       BASDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 03255000
         MVI   BASDEST+1(@08),C' '                                 0938 03256000
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    0938 03257000
         MVI   BASDEST(@08),C' '                                   0938 03258000
*       CALL BVRCSN2;               /* PROC BVR CSN2 CIR     @Y30LB25*/ 03259000
         BAL   @14,BVRCSN2                                         0939 03260000
*       RETURN;                     /*                       @Y30LB25*/ 03261000
         B     @EL00016                                            0940 03262000
*     END;                          /*                       @Y30LB25*/ 03263000
*   END CKBVR2;                     /*                       @Y30LB25*/ 03264000
         B     @EL00016                                            0942 03265000
*                                                                  0943 03266000
*   /*****************************************************************/ 03267000
*   /*                                                               */ 03268000
*   /* PROCEDURE NAME - BVRCSN1                              @Y30LB25*/ 03269000
*   /*                                                       @Y30LB25*/ 03270000
*   /* FUNCTION - WRITE THE BVR.                             @Y30LB25*/ 03271000
*   /* READ FOR CIR OF REPLACED CSN1.                        @Y30LB25*/ 03272000
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/ 03273000
*   /* BVR, CREATE A NEW CIR FOR CSN1 OF BVR AND RETURN.     @Y30LB25*/ 03274000
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN1          @Y30LB25*/ 03275000
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/ 03276000
*   /*                                                       @Y30LB25*/ 03277000
*   /* INPUT -                                               @Y30LB25*/ 03278000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 03279000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 03280000
*   /*                                                       @Y30LB25*/ 03281000
*   /* OUTPUT -                                              @Y30LB25*/ 03282000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 03283000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 03284000
*   /*                                                               */ 03285000
*   /*****************************************************************/ 03286000
*                                                                  0943 03287000
*BVRCSN1:                           /*                       @Y30LB25*/ 03288000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 03289000
*                                                                  0943 03290000
BVRCSN1  ST    @14,@SA00017                                        0943 03291000
*   /*****************************************************************/ 03292000
*   /*                                                               */ 03293000
*   /* WRITE THE BVR FOR THE CARTRIDGE ENTERED               @Y30LB25*/ 03294000
*   /*                                                               */ 03295000
*   /*****************************************************************/ 03296000
*                                                                  0944 03297000
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/ 03298000
         MVI   RPLVTYP(RPLVPTR),X'01'                              0944 03299000
*   RESPECIFY                       /*                       @Y30LB25*/ 03300000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 03301000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 03302000
         LR    RG1,RPLVPTR                                         0946 03303000
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/ 03304000
         L     @15,@CV00610                                        0947 03305000
         BALR  @14,@15                                             0947 03306000
*   RESPECIFY                       /*                       @Y30LB25*/ 03307000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 03308000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 03309000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 03310000
         LH    @08,RPLVRETC(,RPLVPTR)                              0949 03311000
         N     @08,@CF00815                                        0949 03312000
         LTR   @08,@08                                             0949 03313000
         BZ    @RF00949                                            0949 03314000
*     DO;                           /* NO REC FND            @Y30LB25*/ 03315000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 03316000
         BAL   @14,PLIBMSG                                         0951 03317000
*       RETURN;                     /*                       @Y30LB25*/ 03318000
@EL00017 DS    0H                                                  0952 03319000
@EF00017 DS    0H                                                  0952 03320000
@ER00017 L     @14,@SA00017                                        0952 03321000
         BR    @14                                                 0952 03322000
*     END;                          /*                       @Y30LB25*/ 03323000
*                                                                  0953 03324000
*   /*****************************************************************/ 03325000
*   /*                                                               */ 03326000
*   /* READ FOR CIR OF REPLACED CSN1 OF THE BVR              @Y30LB25*/ 03327000
*   /* IVOLKY CAN BE BLANKS FOR A NEWLY CREATED BVR.         @Y30LB25*/ 03328000
*   /*                                                               */ 03329000
*   /*****************************************************************/ 03330000
*                                                                  0954 03331000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 03332000
@RF00949 MVI   RPLVTYP(RPLVPTR),X'00'                              0954 03333000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 03334000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        0955 03335000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 03336000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        0956 03337000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 03338000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        0957 03339000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 03340000
         LA    @08,IKEY                                            0958 03341000
         ST    @08,RPLVKEY(,RPLVPTR)                               0958 03342000
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/ 03343000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          0959 03344000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/ 03345000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         0960 03346000
*   RESPECIFY                       /*                       @Y30LB25*/ 03347000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 03348000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 03349000
         LR    RG1,RPLVPTR                                         0962 03350000
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/ 03351000
         L     @15,@CV00610                                        0963 03352000
         BALR  @14,@15                                             0963 03353000
*   RESPECIFY                       /*                       @Y30LB25*/ 03354000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 03355000
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/ 03356000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 03357000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        0965 03358000
         BNE   @RF00965                                            0965 03359000
*     DO;                           /* NO REC FND            @Y30LB25*/ 03360000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 03361000
         BAL   @14,PLIBMSG                                         0967 03362000
*       RETURN;                     /*                       @Y30LB25*/ 03363000
         B     @EL00017                                            0968 03364000
*     END;                          /*                       @Y30LB25*/ 03365000
*                                                                  0969 03366000
*   /*****************************************************************/ 03367000
*   /*                                                               */ 03368000
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/ 03369000
*   /*                                                               */ 03370000
*   /*****************************************************************/ 03371000
*                                                                  0970 03372000
*   IF RPLRCODE=NORECFND|INDVSRNO^=BASSERNO/*                @Y30LB25   03373000
*                                      NO RECORD FND OR      @Y30LB25   03374000
*                                      WRONG SERIAL NO?      @Y30LB25*/ 03375000
*     THEN                          /* YES                   @Y30LB25*/ 03376000
@RF00965 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        0970 03377000
         BE    @RT00970                                            0970 03378000
         L     @08,BASEVPTR                                        0970 03379000
         CLC   INDVSRNO(6,INDEXPTR),BASSERNO(@08)                  0970 03380000
         BE    @RF00970                                            0970 03381000
@RT00970 DS    0H                                                  0971 03382000
*     DO;                           /*                       @Y30LB25*/ 03383000
*                                                                  0971 03384000
*       /*************************************************************/ 03385000
*       /*                                                           */ 03386000
*       /* CREATE A CIR FOR CSN1                             @Y30LB25*/ 03387000
*       /*                                                           */ 03388000
*       /*************************************************************/ 03389000
*                                                                  0972 03390000
*       CSNUMBER=ON;                /* CSN1                  @Y30LB25*/ 03391000
         OI    CSNUMBER,B'00000100'                                0972 03392000
*       BCDVPTR=BASEVPTR;           /* BVR PTR               @Y30LB25*/ 03393000
         L     @08,BASEVPTR                                        0973 03394000
         ST    @08,BCDVPTR                                         0973 03395000
*       CALL VUCIR;                 /*                       @Y30LB25   03396000
*                                      MAKE CIR FOR CSN1     @Y30LB25*/ 03397000
         BAL   @14,VUCIR                                           0974 03398000
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/ 03399000
*         THEN                      /* ERROR                 @Y30LB25*/ 03400000
         LH    @08,RPLVRETC(,RPLVPTR)                              0975 03401000
         N     @08,@CF00815                                        0975 03402000
         LTR   @08,@08                                             0975 03403000
         BZ    @RF00975                                            0975 03404000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 03405000
         BAL   @14,PLIBMSG                                         0976 03406000
*       RETURN;                     /*                       @Y30LB25*/ 03407000
         B     @EL00017                                            0977 03408000
*     END;                          /*                       @Y30LB25*/ 03409000
*                                                                  0978 03410000
*   /*****************************************************************/ 03411000
*   /*                                                               */ 03412000
*   /* DELETE CIR FOR THE REPLACED CSN1                      @Y30LB25*/ 03413000
*   /*                                                               */ 03414000
*   /*****************************************************************/ 03415000
*                                                                  0979 03416000
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/ 03417000
@RF00970 MVI   RPLVTYP(RPLVPTR),X'05'                              0979 03418000
*   RESPECIFY                       /*                       @Y30LB25*/ 03419000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 03420000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 03421000
         LR    RG1,RPLVPTR                                         0981 03422000
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/ 03423000
         L     @15,@CV00610                                        0982 03424000
         BALR  @14,@15                                             0982 03425000
*   RESPECIFY                       /*                       @Y30LB25*/ 03426000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 03427000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 03428000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 03429000
         LH    @08,RPLVRETC(,RPLVPTR)                              0984 03430000
         N     @08,@CF00815                                        0984 03431000
         LTR   @08,@08                                             0984 03432000
         BZ    @RF00984                                            0984 03433000
*     DO;                           /* NO REC FND            @Y30LB25*/ 03434000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 03435000
         BAL   @14,PLIBMSG                                         0986 03436000
*       RETURN;                     /*                       @Y30LB25*/ 03437000
         B     @EL00017                                            0987 03438000
*     END;                          /*                       @Y30LB25*/ 03439000
*                                                                  0988 03440000
*   /*****************************************************************/ 03441000
*   /*                                                               */ 03442000
*   /* CREATE A CIR FOR CSN1                                 @Y30LB25*/ 03443000
*   /*                                                               */ 03444000
*   /*****************************************************************/ 03445000
*                                                                  0989 03446000
*   CSNUMBER=ON;                    /* CSN1                  @Y30LB25*/ 03447000
@RF00984 OI    CSNUMBER,B'00000100'                                0989 03448000
*   BCDVPTR=BASEVPTR;               /* BVR PTR               @Y30LB25*/ 03449000
         L     @08,BASEVPTR                                        0990 03450000
         ST    @08,BCDVPTR                                         0990 03451000
*   CALL VUCIR;                     /*                       @Y30LB25   03452000
*                                      MAKE CIR FOR CSN1     @Y30LB25*/ 03453000
         BAL   @14,VUCIR                                           0991 03454000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 03455000
*     THEN                          /* ERROR                 @Y30LB25*/ 03456000
         LH    @08,RPLVRETC(,RPLVPTR)                              0992 03457000
         N     @08,@CF00815                                        0992 03458000
         LTR   @08,@08                                             0992 03459000
         BZ    @RF00992                                            0992 03460000
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/ 03461000
         BAL   @14,PLIBMSG                                         0993 03462000
*   RETURN;                         /*                       @Y30LB25*/ 03463000
         B     @EL00017                                            0994 03464000
*   END BVRCSN1;                    /*                       @Y30LB25*/ 03465000
         B     @EL00017                                            0995 03466000
*                                                                  0996 03467000
*   /*****************************************************************/ 03468000
*   /*                                                               */ 03469000
*   /* PROCEDURE NAME - BVRCSN2                              @Y30LB25*/ 03470000
*   /*                                                       @Y30LB25*/ 03471000
*   /* FUNCTION - WRITE THE BVR.                             @Y30LB25*/ 03472000
*   /* READ FOR CIR OF REPLACED CSN2.                        @Y30LB25*/ 03473000
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/ 03474000
*   /* BVR, CREATE A NEW CIR FOR CSN2 OF BVR AND RETURN.     @Y30LB25*/ 03475000
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN2          @Y30LB25*/ 03476000
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/ 03477000
*   /*                                                       @Y30LB25*/ 03478000
*   /* INPUT -                                               @Y30LB25*/ 03479000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 03480000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 03481000
*   /*                                                       @Y30LB25*/ 03482000
*   /* OUTPUT -                                              @Y30LB25*/ 03483000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 03484000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 03485000
*   /*                                                               */ 03486000
*   /*****************************************************************/ 03487000
*                                                                  0996 03488000
*BVRCSN2:                           /*                       @Y30LB25*/ 03489000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 03490000
*                                                                  0996 03491000
BVRCSN2  ST    @14,@SA00018                                        0996 03492000
*   /*****************************************************************/ 03493000
*   /*                                                               */ 03494000
*   /* WRITE THE BVR FOR THE CARTRIDGE PAIRED WITH THE       @Y30LB25*/ 03495000
*   /* ONE ENTERED                                           @Y30LB25*/ 03496000
*   /*                                                               */ 03497000
*   /*****************************************************************/ 03498000
*                                                                  0997 03499000
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/ 03500000
         MVI   RPLVTYP(RPLVPTR),X'01'                              0997 03501000
*   RESPECIFY                       /*                       @Y30LB25*/ 03502000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 03503000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 03504000
         LR    RG1,RPLVPTR                                         0999 03505000
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/ 03506000
         L     @15,@CV00610                                        1000 03507000
         BALR  @14,@15                                             1000 03508000
*   RESPECIFY                       /*                       @Y30LB25*/ 03509000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 03510000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 03511000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 03512000
         LH    @08,RPLVRETC(,RPLVPTR)                              1002 03513000
         N     @08,@CF00815                                        1002 03514000
         LTR   @08,@08                                             1002 03515000
         BZ    @RF01002                                            1002 03516000
*     DO;                           /* NO REC FND            @Y30LB25*/ 03517000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 03518000
         BAL   @14,PLIBMSG                                         1004 03519000
*       RETURN;                     /*                       @Y30LB25*/ 03520000
@EL00018 DS    0H                                                  1005 03521000
@EF00018 DS    0H                                                  1005 03522000
@ER00018 L     @14,@SA00018                                        1005 03523000
         BR    @14                                                 1005 03524000
*     END;                          /*                       @Y30LB25*/ 03525000
*                                                                  1006 03526000
*   /*****************************************************************/ 03527000
*   /*                                                               */ 03528000
*   /* READ FOR CIR OF REPLACED CSN2 OF THE BVR              @Y30LB25*/ 03529000
*   /* IVOLKY CAN BE BLANKS FOR A NEWLY CREATED BVR.         @Y30LB25*/ 03530000
*   /*                                                               */ 03531000
*   /*****************************************************************/ 03532000
*                                                                  1007 03533000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 03534000
@RF01002 MVI   RPLVTYP(RPLVPTR),X'00'                              1007 03535000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 03536000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1008 03537000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 03538000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1009 03539000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 03540000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1010 03541000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 03542000
         LA    @08,IKEY                                            1011 03543000
         ST    @08,RPLVKEY(,RPLVPTR)                               1011 03544000
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/ 03545000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1012 03546000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/ 03547000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1013 03548000
*   RESPECIFY                       /*                       @Y30LB25*/ 03549000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 03550000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 03551000
         LR    RG1,RPLVPTR                                         1015 03552000
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/ 03553000
         L     @15,@CV00610                                        1016 03554000
         BALR  @14,@15                                             1016 03555000
*   RESPECIFY                       /*                       @Y30LB25*/ 03556000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 03557000
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/ 03558000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 03559000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1018 03560000
         BNE   @RF01018                                            1018 03561000
*     DO;                           /* NO REC FND            @Y30LB25*/ 03562000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 03563000
         BAL   @14,PLIBMSG                                         1020 03564000
*       RETURN;                     /*                       @Y30LB25*/ 03565000
         B     @EL00018                                            1021 03566000
*     END;                          /*                       @Y30LB25*/ 03567000
*                                                                  1022 03568000
*   /*****************************************************************/ 03569000
*   /*                                                               */ 03570000
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/ 03571000
*   /*                                                               */ 03572000
*   /*****************************************************************/ 03573000
*                                                                  1023 03574000
*   IF RPLRCODE=NORECFND|INDVSRNO^=BASSERNO/*                @Y30LB25   03575000
*                                      NO RECORD FND OR      @Y30LB25   03576000
*                                      WRONG SERIAL NO?      @Y30LB25*/ 03577000
*     THEN                          /* YES                   @Y30LB25*/ 03578000
@RF01018 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        1023 03579000
         BE    @RT01023                                            1023 03580000
         L     @08,BASEVPTR                                        1023 03581000
         CLC   INDVSRNO(6,INDEXPTR),BASSERNO(@08)                  1023 03582000
         BE    @RF01023                                            1023 03583000
@RT01023 DS    0H                                                  1024 03584000
*     DO;                           /*                       @Y30LB25*/ 03585000
*                                                                  1024 03586000
*       /*************************************************************/ 03587000
*       /*                                                           */ 03588000
*       /* CREATE A CIR FOR CSN2                             @Y30LB25*/ 03589000
*       /*                                                           */ 03590000
*       /*************************************************************/ 03591000
*                                                                  1025 03592000
*       CSNUMBER=OFF;               /* CSN2                  @Y30LB25*/ 03593000
         NI    CSNUMBER,B'11111011'                                1025 03594000
*       BCDVPTR=BASEVPTR;           /* BVR PTR               @Y30LB25*/ 03595000
         L     @08,BASEVPTR                                        1026 03596000
         ST    @08,BCDVPTR                                         1026 03597000
*       CALL VUCIR;                 /*                       @Y30LB25   03598000
*                                      MAKE CIR FOR CSN2     @Y30LB25*/ 03599000
         BAL   @14,VUCIR                                           1027 03600000
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/ 03601000
*         THEN                      /* ERROR                 @Y30LB25*/ 03602000
         LH    @08,RPLVRETC(,RPLVPTR)                              1028 03603000
         N     @08,@CF00815                                        1028 03604000
         LTR   @08,@08                                             1028 03605000
         BZ    @RF01028                                            1028 03606000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 03607000
         BAL   @14,PLIBMSG                                         1029 03608000
*       RETURN;                     /*                       @Y30LB25*/ 03609000
         B     @EL00018                                            1030 03610000
*     END;                          /*                       @Y30LB25*/ 03611000
*                                                                  1031 03612000
*   /*****************************************************************/ 03613000
*   /*                                                               */ 03614000
*   /* DELETE CIR FOR THE REPLACED CSN2                      @Y30LB25*/ 03615000
*   /*                                                               */ 03616000
*   /*****************************************************************/ 03617000
*                                                                  1032 03618000
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/ 03619000
@RF01023 MVI   RPLVTYP(RPLVPTR),X'05'                              1032 03620000
*   RESPECIFY                       /*                       @Y30LB25*/ 03621000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 03622000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 03623000
         LR    RG1,RPLVPTR                                         1034 03624000
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/ 03625000
         L     @15,@CV00610                                        1035 03626000
         BALR  @14,@15                                             1035 03627000
*   RESPECIFY                       /*                       @Y30LB25*/ 03628000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 03629000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 03630000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 03631000
         LH    @08,RPLVRETC(,RPLVPTR)                              1037 03632000
         N     @08,@CF00815                                        1037 03633000
         LTR   @08,@08                                             1037 03634000
         BZ    @RF01037                                            1037 03635000
*     DO;                           /* NO REC FND            @Y30LB25*/ 03636000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 03637000
         BAL   @14,PLIBMSG                                         1039 03638000
*       RETURN;                     /*                       @Y30LB25*/ 03639000
         B     @EL00018                                            1040 03640000
*     END;                          /*                       @Y30LB25*/ 03641000
*                                                                  1041 03642000
*   /*****************************************************************/ 03643000
*   /*                                                               */ 03644000
*   /* CREATE A CIR FOR CSN2                                 @Y30LB25*/ 03645000
*   /*                                                               */ 03646000
*   /*****************************************************************/ 03647000
*                                                                  1042 03648000
*   CSNUMBER=OFF;                   /* CSN2                  @Y30LB25*/ 03649000
@RF01037 NI    CSNUMBER,B'11111011'                                1042 03650000
*   BCDVPTR=BASEVPTR;               /* BVR PTR               @Y30LB25*/ 03651000
         L     @08,BASEVPTR                                        1043 03652000
         ST    @08,BCDVPTR                                         1043 03653000
*   CALL VUCIR;                     /*                       @Y30LB25   03654000
*                                      MAKE CIR FOR CSN2     @Y30LB25*/ 03655000
         BAL   @14,VUCIR                                           1044 03656000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 03657000
*     THEN                          /* ERROR                 @Y30LB25*/ 03658000
         LH    @08,RPLVRETC(,RPLVPTR)                              1045 03659000
         N     @08,@CF00815                                        1045 03660000
         LTR   @08,@08                                             1045 03661000
         BZ    @RF01045                                            1045 03662000
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/ 03663000
         BAL   @14,PLIBMSG                                         1046 03664000
*   RETURN;                         /*                       @Y30LB25*/ 03665000
         B     @EL00018                                            1047 03666000
*   END BVRCSN2;                    /*                       @Y30LB25*/ 03667000
         B     @EL00018                                            1048 03668000
*                                                                  1049 03669000
*   /*****************************************************************/ 03670000
*   /*                                                               */ 03671000
*   /* PROCEDURE NAME - CKCVR1                               @Y30LB25*/ 03672000
*   /*                                                       @Y30LB25*/ 03673000
*   /* FUNCTION - UPDATE A CVR AND CIR FOR THE CSN OF THE    @Y30LB25*/ 03674000
*   /* CARTRIDGE ENTERED.                                    @Y30LB25*/ 03675000
*   /*                                                       @Y30LB25*/ 03676000
*   /* INPUT -                                               @Y30LB25*/ 03677000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 03678000
*   /*                                                       @Y30LB25*/ 03679000
*   /* OUTPUT -                                              @Y30LB25*/ 03680000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 03681000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 03682000
*   /*                                                               */ 03683000
*   /*****************************************************************/ 03684000
*                                                                  1049 03685000
*CKCVR1:                            /*                       @Y30LB25*/ 03686000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 03687000
*                                                                  1049 03688000
CKCVR1   ST    @14,@SA00019                                        1049 03689000
*   /*****************************************************************/ 03690000
*   /*                                                               */ 03691000
*   /* GET THE CVR FROM THE CSN OF THE CARTRIDGE ENTERED     @Y30LB25*/ 03692000
*   /*                                                               */ 03693000
*   /*****************************************************************/ 03694000
*                                                                  1050 03695000
*   CKEY=INDRECKY;                  /* CVR KEY               @Y30LB25*/ 03696000
         MVC   CKEY(13),INDRECKY(INDEXPTR)                         1050 03697000
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF KEY           @Y30LB25*/ 03698000
         LA    @08,CKEY                                            1051 03699000
         ST    @08,RPLVKEY(,RPLVPTR)                               1051 03700000
*   RPLVBUF=COPYVPTR;               /* PT TO CVR BUF         @Y30LB25*/ 03701000
         ST    COPYVPTR,RPLVBUF(,RPLVPTR)                          1052 03702000
*   RPLVBLN=LENGTH(COPYBUF);        /* SET CVR BUF LENGTH    @Y30LB25*/ 03703000
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1053 03704000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 03705000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1054 03706000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 03707000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1055 03708000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 03709000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1056 03710000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 03711000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1057 03712000
*   RESPECIFY                       /*                       @Y30LB25*/ 03713000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 03714000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 03715000
         LR    RG1,RPLVPTR                                         1059 03716000
*   CALL ICBVIO00;                  /* READ FOR CVR          @Y30LB25*/ 03717000
         L     @15,@CV00610                                        1060 03718000
         BALR  @14,@15                                             1060 03719000
*   RESPECIFY                       /*                       @Y30LB25*/ 03720000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 03721000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 03722000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 03723000
         LH    @08,RPLVRETC(,RPLVPTR)                              1062 03724000
         N     @08,@CF00815                                        1062 03725000
         LTR   @08,@08                                             1062 03726000
         BZ    @RF01062                                            1062 03727000
*     DO;                           /* NO REC FND            @Y30LB25*/ 03728000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 03729000
         BAL   @14,PLIBMSG                                         1064 03730000
*       RETURN;                     /*                       @Y30LB25*/ 03731000
@EL00019 DS    0H                                                  1065 03732000
@EF00019 DS    0H                                                  1065 03733000
@ER00019 L     @14,@SA00019                                        1065 03734000
         BR    @14                                                 1065 03735000
*     END;                          /*                       @Y30LB25*/ 03736000
*                                                                  1066 03737000
*   /*****************************************************************/ 03738000
*   /*                                                               */ 03739000
*   /* SET THE DOWN LEVEL SPASE FLAG                         @Y30LB25*/ 03740000
*   /*                                                               */ 03741000
*   /*****************************************************************/ 03742000
*                                                                  1067 03743000
*   COPDLSPF=ON;                    /* DOWN LEVEL SPACE      @Y30LB25*/ 03744000
*                                                                  1067 03745000
@RF01062 OI    COPDLSPF(COPYVPTR),B'01000000'                      1067 03746000
*   /*****************************************************************/ 03747000
*   /*                                                               */ 03748000
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/ 03749000
*   /*                                                               */ 03750000
*   /*****************************************************************/ 03751000
*                                                                  1068 03752000
*   IF(CSN1USM=COPCSN1&CSN2USM=COPCSN2)|/* ALL CSNS MATCH?   @Y30LB25*/ 03753000
*       (CSN1USM=COPCSN2&CSN2USM=COPCSN1)/*                  @Y30LB25*/ 03754000
*     THEN                          /* YES                   @Y30LB25*/ 03755000
         LA    @08,8                                               1068 03756000
         ALR   @08,MESGPTR                                         1068 03757000
         CLC   CSN1USM(12,@08),COPCSN1(COPYVPTR)                   1068 03758000
         BNE   @GL00025                                            1068 03759000
         CLC   CSN2USM(12,@08),COPCSN2(COPYVPTR)                   1068 03760000
         BE    @RT01068                                            1068 03761000
@GL00025 LA    @08,8                                               1068 03762000
         ALR   @08,MESGPTR                                         1068 03763000
         CLC   CSN1USM(12,@08),COPCSN2(COPYVPTR)                   1068 03764000
         BNE   @RF01068                                            1068 03765000
         CLC   CSN2USM(12,@08),COPCSN1(COPYVPTR)                   1068 03766000
         BNE   @RF01068                                            1068 03767000
@RT01068 DS    0H                                                  1069 03768000
*     DO;                           /*                       @Y30LB25*/ 03769000
*                                                                  1069 03770000
*       /*************************************************************/ 03771000
*       /*                                                           */ 03772000
*       /* CHECK FOR CSN1                                    @Y30LB25*/ 03773000
*       /*                                                           */ 03774000
*       /*************************************************************/ 03775000
*                                                                  1070 03776000
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/ 03777000
*         THEN                      /* YES                   @Y30LB25*/ 03778000
         LA    @08,8                                               1070 03779000
         ALR   @08,MESGPTR                                         1070 03780000
         CLI   SEQNUM(@08),X'F1'                                   1070 03781000
         BNE   @RF01070                                            1070 03782000
*         DO;                       /*                       @Y30LB25*/ 03783000
*                                                                  1071 03784000
*           /*********************************************************/ 03785000
*           /*                                                       */ 03786000
*           /* SET LIBID1                                    @Y30LB25*/ 03787000
*           /*                                                       */ 03788000
*           /*********************************************************/ 03789000
*                                                                  1072 03790000
*           COPLIB1=COPLIB1&&COPLIB1;/* ZERO LIBID1          @Y30LB25*/ 03791000
         SLR   @07,@07                                             1072 03792000
         IC    @07,COPLIB1(,COPYVPTR)                              1072 03793000
         LR    @04,@07                                             1072 03794000
         XR    @04,@07                                             1072 03795000
         STC   @04,COPLIB1(,COPYVPTR)                              1072 03796000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 03797000
*             THEN                  /* YES                   @Y30LB25*/ 03798000
         TM    LUSM1(@08),B'10000000'                              1073 03799000
         BNO   @RF01073                                            1073 03800000
*             COP1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/ 03801000
         OI    COP1BIT1(COPYVPTR),B'00000010'                      1074 03802000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 03803000
*             THEN                  /* YES                   @Y30LB25*/ 03804000
@RF01073 TM    LUSM2+8(MESGPTR),B'01000000'                        1075 03805000
         BNO   @RF01075                                            1075 03806000
*             COP1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/ 03807000
         OI    COP1BIT2(COPYVPTR),B'00000001'                      1076 03808000
*           COPCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/ 03809000
@RF01075 LA    @08,8                                               1077 03810000
         ALR   @08,MESGPTR                                         1077 03811000
         MVC   COPCSN1(12,COPYVPTR),CSN1USM(@08)                   1077 03812000
*           COPCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/ 03813000
         MVC   COPCSN2(12,COPYVPTR),CSN2USM(@08)                   1078 03814000
*         END;                      /*                       @Y30LB25*/ 03815000
*                                                                  1079 03816000
*       /*************************************************************/ 03817000
*       /*                                                           */ 03818000
*       /* CSN2                                              @Y30LB25*/ 03819000
*       /*                                                           */ 03820000
*       /*************************************************************/ 03821000
*                                                                  1080 03822000
*       ELSE                        /* CSN2                  @Y30LB25*/ 03823000
*                                                                  1080 03824000
*         /***********************************************************/ 03825000
*         /*                                                         */ 03826000
*         /* SET LIBID2                                      @Y30LB25*/ 03827000
*         /*                                                         */ 03828000
*         /***********************************************************/ 03829000
*                                                                  1080 03830000
*         DO;                       /*                       @Y30LB25*/ 03831000
         B     @RC01070                                            1080 03832000
@RF01070 DS    0H                                                  1081 03833000
*           COPLIB2=COPLIB2&&COPLIB2;/* ZERO LIBID2          @Y30LB25*/ 03834000
         SLR   @08,@08                                             1081 03835000
         IC    @08,COPLIB2(,COPYVPTR)                              1081 03836000
         LR    @07,@08                                             1081 03837000
         XR    @07,@08                                             1081 03838000
         STC   @07,COPLIB2(,COPYVPTR)                              1081 03839000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 03840000
*             THEN                  /* YES                   @Y30LB25*/ 03841000
         TM    LUSM1+8(MESGPTR),B'10000000'                        1082 03842000
         BNO   @RF01082                                            1082 03843000
*             COP2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/ 03844000
         OI    COP2BIT1(COPYVPTR),B'00000010'                      1083 03845000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 03846000
*             THEN                  /* YES                   @Y30LB25*/ 03847000
@RF01082 TM    LUSM2+8(MESGPTR),B'01000000'                        1084 03848000
         BNO   @RF01084                                            1084 03849000
*             COP2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/ 03850000
         OI    COP2BIT2(COPYVPTR),B'00000001'                      1085 03851000
*           COPCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/ 03852000
@RF01084 LA    @08,8                                               1086 03853000
         ALR   @08,MESGPTR                                         1086 03854000
         MVC   COPCSN1(12,COPYVPTR),CSN2USM(@08)                   1086 03855000
*           COPCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/ 03856000
         MVC   COPCSN2(12,COPYVPTR),CSN1USM(@08)                   1087 03857000
*         END;                      /*                       @Y30LB25*/ 03858000
*                                                                  1088 03859000
*       /*************************************************************/ 03860000
*       /*                                                           */ 03861000
*       /* UPDATE THE CVR                                    @Y30LB25*/ 03862000
*       /*                                                           */ 03863000
*       /*************************************************************/ 03864000
*                                                                  1089 03865000
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 03866000
@RC01070 MVI   COPDTREM+1(COPYVPTR),C' '                           1089 03867000
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1089 03868000
         MVI   COPDTREM(COPYVPTR),C' '                             1089 03869000
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 03870000
*                                                                  1090 03871000
         MVI   COPDEST+1(COPYVPTR),C' '                            1090 03872000
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1090 03873000
         MVI   COPDEST(COPYVPTR),C' '                              1090 03874000
*       /*************************************************************/ 03875000
*       /*                                                           */ 03876000
*       /* WRITE THE DVR                                     @Y30LB25*/ 03877000
*       /*                                                           */ 03878000
*       /*************************************************************/ 03879000
*                                                                  1091 03880000
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/ 03881000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1091 03882000
*       RESPECIFY                   /*                       @Y30LB25*/ 03883000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 03884000
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/ 03885000
         LR    RG1,RPLVPTR                                         1093 03886000
*       CALL ICBVIO00;              /* WRITE CVR             @Y30LB25*/ 03887000
         L     @15,@CV00610                                        1094 03888000
         BALR  @14,@15                                             1094 03889000
*       RESPECIFY                   /*                       @Y30LB25*/ 03890000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 03891000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/ 03892000
*         THEN                      /*                       @Y30LB25*/ 03893000
         LH    @08,RPLVRETC(,RPLVPTR)                              1096 03894000
         N     @08,@CF00815                                        1096 03895000
         LTR   @08,@08                                             1096 03896000
         BZ    @RF01096                                            1096 03897000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 03898000
         BAL   @14,PLIBMSG                                         1097 03899000
*       RETURN;                     /*                       @Y30LB25*/ 03900000
         B     @EL00019                                            1098 03901000
*     END;                          /*                       @Y30LB25*/ 03902000
*                                                                  1099 03903000
*   /*****************************************************************/ 03904000
*   /*                                                               */ 03905000
*   /* OTHER CARTRIDGE PAIRED WITH THE ONE ENTERED MUST      @Y30LB25*/ 03906000
*   /* NOT MATCH EITHER CSN1 OR CSN2 IN THE CVR              @Y30LB25*/ 03907000
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN        @Y30LB25*/ 03908000
*   /* ENTERED MATCHES.                                      @Y30LB25*/ 03909000
*   /*                                                               */ 03910000
*   /*****************************************************************/ 03911000
*                                                                  1100 03912000
*   IF COPCSN1^=CSN1USM             /* NO MATCH CSN1?        @Y30LB25*/ 03913000
*     THEN                          /* YES                   @Y30LB25*/ 03914000
@RF01068 LA    @08,8                                               1100 03915000
         ALR   @08,MESGPTR                                         1100 03916000
         CLC   COPCSN1(12,COPYVPTR),CSN1USM(@08)                   1100 03917000
         BE    @RF01100                                            1100 03918000
*     DO;                           /*                       @Y30LB25*/ 03919000
*       IVOLKY=COPCSN1;             /* SAVE CSN1             @Y30LB25*/ 03920000
         MVC   IVOLKY(12),COPCSN1(COPYVPTR)                        1102 03921000
*       COPCSN1=CSN2USM;            /* UPDATE CVR CSN1       @Y30LB25*/ 03922000
         MVC   COPCSN1(12,COPYVPTR),CSN2USM(@08)                   1103 03923000
*       COPLIB1=COPLIB1&&COPLIB1;   /* ZERO LIBID1           @Y30LB25*/ 03924000
         SLR   @04,@04                                             1104 03925000
         IC    @04,COPLIB1(,COPYVPTR)                              1104 03926000
         LR    @03,@04                                             1104 03927000
         XR    @03,@04                                             1104 03928000
         STC   @03,COPLIB1(,COPYVPTR)                              1104 03929000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 03930000
*         THEN                      /* YES                   @Y30LB25*/ 03931000
         TM    LUSM1(@08),B'10000000'                              1105 03932000
         BNO   @RF01105                                            1105 03933000
*         COP1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/ 03934000
         OI    COP1BIT1(COPYVPTR),B'00000010'                      1106 03935000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 03936000
*         THEN                      /* YES                   @Y30LB25*/ 03937000
@RF01105 TM    LUSM2+8(MESGPTR),B'01000000'                        1107 03938000
         BNO   @RF01107                                            1107 03939000
*         COP1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/ 03940000
         OI    COP1BIT2(COPYVPTR),B'00000001'                      1108 03941000
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 03942000
@RF01107 MVI   COPDTREM+1(COPYVPTR),C' '                           1109 03943000
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1109 03944000
         MVI   COPDTREM(COPYVPTR),C' '                             1109 03945000
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 03946000
         MVI   COPDEST+1(COPYVPTR),C' '                            1110 03947000
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1110 03948000
         MVI   COPDEST(COPYVPTR),C' '                              1110 03949000
*       CALL CVRCSN1;               /* PROC CVR CSN1 CIR     @Y30LB25*/ 03950000
         BAL   @14,CVRCSN1                                         1111 03951000
*       RETURN;                     /*                       @Y30LB25*/ 03952000
         B     @EL00019                                            1112 03953000
*     END;                          /*                       @Y30LB25*/ 03954000
*   ELSE                            /* NO MATCH CVR CSN2     @Y30LB25*/ 03955000
*     DO;                           /*                       @Y30LB25*/ 03956000
@RF01100 DS    0H                                                  1115 03957000
*       IVOLKY=COPCSN2;             /* SAVE CSN2             @Y30LB25*/ 03958000
         MVC   IVOLKY(12),COPCSN2(COPYVPTR)                        1115 03959000
*       COPCSN2=CSN2USM;            /* UPDATE CVR CSN2       @Y30LB25*/ 03960000
         LA    @08,8                                               1116 03961000
         ALR   @08,MESGPTR                                         1116 03962000
         MVC   COPCSN2(12,COPYVPTR),CSN2USM(@08)                   1116 03963000
*       COPLIB2=COPLIB2&&COPLIB2;   /* ZERO LIBID2           @Y30LB25*/ 03964000
         SLR   @04,@04                                             1117 03965000
         IC    @04,COPLIB2(,COPYVPTR)                              1117 03966000
         LR    @03,@04                                             1117 03967000
         XR    @03,@04                                             1117 03968000
         STC   @03,COPLIB2(,COPYVPTR)                              1117 03969000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 03970000
*         THEN                      /* YES                   @Y30LB25*/ 03971000
         TM    LUSM1(@08),B'10000000'                              1118 03972000
         BNO   @RF01118                                            1118 03973000
*         COP2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/ 03974000
         OI    COP2BIT1(COPYVPTR),B'00000010'                      1119 03975000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 03976000
*         THEN                      /* YES                   @Y30LB25*/ 03977000
@RF01118 TM    LUSM2+8(MESGPTR),B'01000000'                        1120 03978000
         BNO   @RF01120                                            1120 03979000
*         COP2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/ 03980000
         OI    COP2BIT2(COPYVPTR),B'00000001'                      1121 03981000
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 03982000
@RF01120 MVI   COPDTREM+1(COPYVPTR),C' '                           1122 03983000
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1122 03984000
         MVI   COPDTREM(COPYVPTR),C' '                             1122 03985000
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 03986000
         MVI   COPDEST+1(COPYVPTR),C' '                            1123 03987000
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1123 03988000
         MVI   COPDEST(COPYVPTR),C' '                              1123 03989000
*       CALL CVRCSN2;               /* PROC CVR CSN2 CIR     @Y30LB25*/ 03990000
         BAL   @14,CVRCSN2                                         1124 03991000
*       RETURN;                     /*                       @Y30LB25*/ 03992000
         B     @EL00019                                            1125 03993000
*     END;                          /*                       @Y30LB25*/ 03994000
*   END CKCVR1;                     /*                       @Y30LB25*/ 03995000
         B     @EL00019                                            1127 03996000
*                                                                  1128 03997000
*   /*****************************************************************/ 03998000
*   /*                                                               */ 03999000
*   /* PROCEDURE NAME - CKCVR2                               @Y30LB25*/ 04000000
*   /*                                                       @Y30LB25*/ 04001000
*   /* FUNCTION - UPDATE A CVR AND CIR FOR THE CSN OF THE    @Y30LB25*/ 04002000
*   /* OTHER CARTRIDGE TO THE PAIR FOR THE ONE ENTERED.      @Y30LB25*/ 04003000
*   /*                                                       @Y30LB25*/ 04004000
*   /* INPUT -                                               @Y30LB25*/ 04005000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 04006000
*   /*                                                       @Y30LB25*/ 04007000
*   /* OUTPUT -                                              @Y30LB25*/ 04008000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 04009000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 04010000
*   /*                                                               */ 04011000
*   /*****************************************************************/ 04012000
*                                                                  1128 04013000
*CKCVR2:                            /*                       @Y30LB25*/ 04014000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 04015000
*                                                                  1128 04016000
CKCVR2   ST    @14,@SA00020                                        1128 04017000
*   /*****************************************************************/ 04018000
*   /*                                                               */ 04019000
*   /* GET THE CVR FROM THE CSN OF THE CARTRIDGE PAIRED      @Y30LB25*/ 04020000
*   /* WITH THE ONE ENTERED                                  @Y30LB25*/ 04021000
*   /*                                                               */ 04022000
*   /*****************************************************************/ 04023000
*                                                                  1129 04024000
*   CKEY=INDRECKY;                  /* CVR KEY               @Y30LB25*/ 04025000
         MVC   CKEY(13),INDRECKY(INDEXPTR)                         1129 04026000
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF CVR KEY       @Y30LB25*/ 04027000
         LA    @08,CKEY                                            1130 04028000
         ST    @08,RPLVKEY(,RPLVPTR)                               1130 04029000
*   RPLVBUF=COPYVPTR;               /* PT TO CVR BUF         @Y30LB25*/ 04030000
         ST    COPYVPTR,RPLVBUF(,RPLVPTR)                          1131 04031000
*   RPLVBLN=LENGTH(COPYBUF);        /* SET CVR BUF LENGTH    @Y30LB25*/ 04032000
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1132 04033000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 04034000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1133 04035000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 04036000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1134 04037000
*   RPLVUPD=ON;                     /* READ FOR UPDATE       @Y30LB25*/ 04038000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1135 04039000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 04040000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1136 04041000
*   RESPECIFY                       /*                       @Y30LB25*/ 04042000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 04043000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 04044000
         LR    RG1,RPLVPTR                                         1138 04045000
*   CALL ICBVIO00;                  /* READ FOR CVR          @Y30LB25*/ 04046000
         L     @15,@CV00610                                        1139 04047000
         BALR  @14,@15                                             1139 04048000
*   RESPECIFY                       /*                       @Y30LB25*/ 04049000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 04050000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 04051000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 04052000
         LH    @08,RPLVRETC(,RPLVPTR)                              1141 04053000
         N     @08,@CF00815                                        1141 04054000
         LTR   @08,@08                                             1141 04055000
         BZ    @RF01141                                            1141 04056000
*     DO;                           /* NO REC FND            @Y30LB25*/ 04057000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 04058000
         BAL   @14,PLIBMSG                                         1143 04059000
*       RETURN;                     /*                       @Y30LB25*/ 04060000
@EL00020 DS    0H                                                  1144 04061000
@EF00020 DS    0H                                                  1144 04062000
@ER00020 L     @14,@SA00020                                        1144 04063000
         BR    @14                                                 1144 04064000
*     END;                          /*                       @Y30LB25*/ 04065000
*                                                                  1145 04066000
*   /*****************************************************************/ 04067000
*   /*                                                               */ 04068000
*   /* SET DOWN LEVEL SPACE FLAG                             @Y30LB25*/ 04069000
*   /*                                                               */ 04070000
*   /*****************************************************************/ 04071000
*                                                                  1146 04072000
*   COPDLSPF=ON;                    /* DOWN LEVEL SPACE      @Y30LB25*/ 04073000
*                                                                  1146 04074000
@RF01141 OI    COPDLSPF(COPYVPTR),B'01000000'                      1146 04075000
*   /*****************************************************************/ 04076000
*   /*                                                               */ 04077000
*   /* CHECK FOR CORRECT RECORD                              @Y30LB25*/ 04078000
*   /*                                                               */ 04079000
*   /*****************************************************************/ 04080000
*                                                                  1147 04081000
*   IF(CSN1USM=COPCSN1&CSN2USM=COPCSN2)|/* ALL CSNS MATCH?   @Y30LB25*/ 04082000
*       (CSN1USM=COPCSN2&CSN2USM=COPCSN1)/*                  @Y30LB25*/ 04083000
*     THEN                          /* YES                   @Y30LB25*/ 04084000
         LA    @08,8                                               1147 04085000
         ALR   @08,MESGPTR                                         1147 04086000
         CLC   CSN1USM(12,@08),COPCSN1(COPYVPTR)                   1147 04087000
         BNE   @GL00028                                            1147 04088000
         CLC   CSN2USM(12,@08),COPCSN2(COPYVPTR)                   1147 04089000
         BE    @RT01147                                            1147 04090000
@GL00028 LA    @08,8                                               1147 04091000
         ALR   @08,MESGPTR                                         1147 04092000
         CLC   CSN1USM(12,@08),COPCSN2(COPYVPTR)                   1147 04093000
         BNE   @RF01147                                            1147 04094000
         CLC   CSN2USM(12,@08),COPCSN1(COPYVPTR)                   1147 04095000
         BNE   @RF01147                                            1147 04096000
@RT01147 DS    0H                                                  1148 04097000
*     DO;                           /*                       @Y30LB25*/ 04098000
*                                                                  1148 04099000
*       /*************************************************************/ 04100000
*       /*                                                           */ 04101000
*       /* CHECK FOR CSN1                                    @Y30LB25*/ 04102000
*       /*                                                           */ 04103000
*       /*************************************************************/ 04104000
*                                                                  1149 04105000
*       IF SEQNUM=ONEF1             /* CSN1?                 @Y30LB25*/ 04106000
*         THEN                      /* YES                   @Y30LB25*/ 04107000
         LA    @08,8                                               1149 04108000
         ALR   @08,MESGPTR                                         1149 04109000
         CLI   SEQNUM(@08),X'F1'                                   1149 04110000
         BNE   @RF01149                                            1149 04111000
*         DO;                       /*                       @Y30LB25*/ 04112000
*                                                                  1150 04113000
*           /*********************************************************/ 04114000
*           /*                                                       */ 04115000
*           /* SET LIBID1                                    @Y30LB25*/ 04116000
*           /*                                                       */ 04117000
*           /*********************************************************/ 04118000
*                                                                  1151 04119000
*           COPLIB1=COPLIB1&&COPLIB1;/* ZERO LIBID1          @Y30LB25*/ 04120000
         SLR   @07,@07                                             1151 04121000
         IC    @07,COPLIB1(,COPYVPTR)                              1151 04122000
         LR    @04,@07                                             1151 04123000
         XR    @04,@07                                             1151 04124000
         STC   @04,COPLIB1(,COPYVPTR)                              1151 04125000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 04126000
*             THEN                  /* YES                   @Y30LB25*/ 04127000
         TM    LUSM1(@08),B'10000000'                              1152 04128000
         BNO   @RF01152                                            1152 04129000
*             COP1BIT1=ON;          /* LIBID1 BIT1 ON        @Y30LB25*/ 04130000
         OI    COP1BIT1(COPYVPTR),B'00000010'                      1153 04131000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 04132000
*             THEN                  /* YES                   @Y30LB25*/ 04133000
@RF01152 TM    LUSM2+8(MESGPTR),B'01000000'                        1154 04134000
         BNO   @RF01154                                            1154 04135000
*             COP1BIT2=ON;          /* LIBID1 BIT2 ON        @Y30LB25*/ 04136000
         OI    COP1BIT2(COPYVPTR),B'00000001'                      1155 04137000
*           COPCSN1=CSN1USM;        /* SET FIRST CSN         @ZM31119*/ 04138000
@RF01154 LA    @08,8                                               1156 04139000
         ALR   @08,MESGPTR                                         1156 04140000
         MVC   COPCSN1(12,COPYVPTR),CSN1USM(@08)                   1156 04141000
*           COPCSN2=CSN2USM;        /* SET SECOND CSN        @ZM31119*/ 04142000
         MVC   COPCSN2(12,COPYVPTR),CSN2USM(@08)                   1157 04143000
*         END;                      /*                       @Y30LB25*/ 04144000
*                                                                  1158 04145000
*       /*************************************************************/ 04146000
*       /*                                                           */ 04147000
*       /* CSN2                                              @Y30LB25*/ 04148000
*       /*                                                           */ 04149000
*       /*************************************************************/ 04150000
*                                                                  1159 04151000
*       ELSE                        /* CSN2                  @Y30LB25*/ 04152000
*                                                                  1159 04153000
*         /***********************************************************/ 04154000
*         /*                                                         */ 04155000
*         /* SET LIBID2                                      @Y30LB25*/ 04156000
*         /*                                                         */ 04157000
*         /***********************************************************/ 04158000
*                                                                  1159 04159000
*         DO;                       /*                       @Y30LB25*/ 04160000
         B     @RC01149                                            1159 04161000
@RF01149 DS    0H                                                  1160 04162000
*           COPLIB2=COPLIB2&&COPLIB2;/* ZERO LIBID2          @Y30LB25*/ 04163000
         SLR   @08,@08                                             1160 04164000
         IC    @08,COPLIB2(,COPYVPTR)                              1160 04165000
         LR    @07,@08                                             1160 04166000
         XR    @07,@08                                             1160 04167000
         STC   @07,COPLIB2(,COPYVPTR)                              1160 04168000
*           IF LUSM1=ON             /* BIT 1 ON?             @Y30LB25*/ 04169000
*             THEN                  /* YES                   @Y30LB25*/ 04170000
         TM    LUSM1+8(MESGPTR),B'10000000'                        1161 04171000
         BNO   @RF01161                                            1161 04172000
*             COP2BIT1=ON;          /* LIBID2 BIT1 ON        @Y30LB25*/ 04173000
         OI    COP2BIT1(COPYVPTR),B'00000010'                      1162 04174000
*           IF LUSM2=ON             /* BIT 2 ON?             @Y30LB25*/ 04175000
*             THEN                  /* YES                   @Y30LB25*/ 04176000
@RF01161 TM    LUSM2+8(MESGPTR),B'01000000'                        1163 04177000
         BNO   @RF01163                                            1163 04178000
*             COP2BIT2=ON;          /* LIBID2 BIT2 ON        @Y30LB25*/ 04179000
         OI    COP2BIT2(COPYVPTR),B'00000001'                      1164 04180000
*           COPCSN1=CSN2USM;        /* SET FIRST CSN         @ZM31119*/ 04181000
@RF01163 LA    @08,8                                               1165 04182000
         ALR   @08,MESGPTR                                         1165 04183000
         MVC   COPCSN1(12,COPYVPTR),CSN2USM(@08)                   1165 04184000
*           COPCSN2=CSN1USM;        /* SET SECOND CSN        @ZM31119*/ 04185000
         MVC   COPCSN2(12,COPYVPTR),CSN1USM(@08)                   1166 04186000
*         END;                      /*                       @Y30LB25*/ 04187000
*                                                                  1167 04188000
*       /*************************************************************/ 04189000
*       /*                                                           */ 04190000
*       /* UPDATE THE CVR                                    @Y30LB25*/ 04191000
*       /*                                                           */ 04192000
*       /*************************************************************/ 04193000
*                                                                  1168 04194000
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 04195000
@RC01149 MVI   COPDTREM+1(COPYVPTR),C' '                           1168 04196000
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1168 04197000
         MVI   COPDTREM(COPYVPTR),C' '                             1168 04198000
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 04199000
*                                                                  1169 04200000
         MVI   COPDEST+1(COPYVPTR),C' '                            1169 04201000
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1169 04202000
         MVI   COPDEST(COPYVPTR),C' '                              1169 04203000
*       /*************************************************************/ 04204000
*       /*                                                           */ 04205000
*       /* WRITE THE CVR                                     @Y30LB25*/ 04206000
*       /*                                                           */ 04207000
*       /*************************************************************/ 04208000
*                                                                  1170 04209000
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/ 04210000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1170 04211000
*       RESPECIFY                   /*                       @Y30LB25*/ 04212000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 04213000
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/ 04214000
         LR    RG1,RPLVPTR                                         1172 04215000
*       CALL ICBVIO00;              /* WRITE CVR             @Y30LB25*/ 04216000
         L     @15,@CV00610                                        1173 04217000
         BALR  @14,@15                                             1173 04218000
*       RESPECIFY                   /*                       @Y30LB25*/ 04219000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 04220000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/ 04221000
*         THEN                      /*                       @Y30LB25*/ 04222000
         LH    @08,RPLVRETC(,RPLVPTR)                              1175 04223000
         N     @08,@CF00815                                        1175 04224000
         LTR   @08,@08                                             1175 04225000
         BZ    @RF01175                                            1175 04226000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 04227000
         BAL   @14,PLIBMSG                                         1176 04228000
*       RETURN;                     /*                       @Y30LB25*/ 04229000
         B     @EL00020                                            1177 04230000
*     END;                          /*                       @Y30LB25*/ 04231000
*                                                                  1178 04232000
*   /*****************************************************************/ 04233000
*   /*                                                               */ 04234000
*   /* THE CARTRIDGE ENTERED MUST NOT MATCH WITH EITHER      @Y30LB25*/ 04235000
*   /* CSN1 OR CSN2 IN THE CVR                               @Y30LB25*/ 04236000
*   /* FIND THE NONMATCH BY FINDING WHICH ONE THE CSN NOT    @Y30LB25*/ 04237000
*   /* ENTERED MATCHES.                                      @Y30LB25*/ 04238000
*   /*                                                               */ 04239000
*   /*****************************************************************/ 04240000
*                                                                  1179 04241000
*   IF COPCSN1^=CSN2USM             /* NO MATCH CSN1?        @Y30LB25*/ 04242000
*     THEN                          /* YES                   @Y30LB25*/ 04243000
@RF01147 LA    @08,8                                               1179 04244000
         ALR   @08,MESGPTR                                         1179 04245000
         CLC   COPCSN1(12,COPYVPTR),CSN2USM(@08)                   1179 04246000
         BE    @RF01179                                            1179 04247000
*     DO;                           /*                       @Y30LB25*/ 04248000
*       IVOLKY=COPCSN1;             /* SAVE CSN1             @Y30LB25*/ 04249000
         MVC   IVOLKY(12),COPCSN1(COPYVPTR)                        1181 04250000
*       COPCSN1=CSN1USM;            /* UPDATE CVR CSN1       @Y30LB25*/ 04251000
         MVC   COPCSN1(12,COPYVPTR),CSN1USM(@08)                   1182 04252000
*       COPLIB1=COPLIB1&&COPLIB1;   /* ZERO LIBID1           @Y30LB25*/ 04253000
         SLR   @04,@04                                             1183 04254000
         IC    @04,COPLIB1(,COPYVPTR)                              1183 04255000
         LR    @03,@04                                             1183 04256000
         XR    @03,@04                                             1183 04257000
         STC   @03,COPLIB1(,COPYVPTR)                              1183 04258000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 04259000
*         THEN                      /* YES                   @Y30LB25*/ 04260000
         TM    LUSM1(@08),B'10000000'                              1184 04261000
         BNO   @RF01184                                            1184 04262000
*         COP1BIT1=ON;              /* LIBID1 BIT1 ON        @Y30LB25*/ 04263000
         OI    COP1BIT1(COPYVPTR),B'00000010'                      1185 04264000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 04265000
*         THEN                      /* YES                   @Y30LB25*/ 04266000
@RF01184 TM    LUSM2+8(MESGPTR),B'01000000'                        1186 04267000
         BNO   @RF01186                                            1186 04268000
*         COP1BIT2=ON;              /* LIBID1 BIT2 ON        @Y30LB25*/ 04269000
         OI    COP1BIT2(COPYVPTR),B'00000001'                      1187 04270000
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 04271000
@RF01186 MVI   COPDTREM+1(COPYVPTR),C' '                           1188 04272000
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1188 04273000
         MVI   COPDTREM(COPYVPTR),C' '                             1188 04274000
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 04275000
         MVI   COPDEST+1(COPYVPTR),C' '                            1189 04276000
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1189 04277000
         MVI   COPDEST(COPYVPTR),C' '                              1189 04278000
*       CALL CVRCSN1;               /* PROC CVR CSN1 CIR     @Y30LB25*/ 04279000
         BAL   @14,CVRCSN1                                         1190 04280000
*       RETURN;                     /*                       @Y30LB25*/ 04281000
         B     @EL00020                                            1191 04282000
*     END;                          /*                       @Y30LB25*/ 04283000
*   ELSE                            /* NO MATCH CVR CSN2     @Y30LB25*/ 04284000
*     DO;                           /*                       @Y30LB25*/ 04285000
@RF01179 DS    0H                                                  1194 04286000
*       IVOLKY=COPCSN2;             /* SAVE CSN2             @Y30LB25*/ 04287000
         MVC   IVOLKY(12),COPCSN2(COPYVPTR)                        1194 04288000
*       COPCSN2=CSN1USM;            /* UPDATE CVR CSN2       @Y30LB25*/ 04289000
         LA    @08,8                                               1195 04290000
         ALR   @08,MESGPTR                                         1195 04291000
         MVC   COPCSN2(12,COPYVPTR),CSN1USM(@08)                   1195 04292000
*       COPLIB2=COPLIB2&&COPLIB2;   /* ZERO LIBID2           @Y30LB25*/ 04293000
         SLR   @04,@04                                             1196 04294000
         IC    @04,COPLIB2(,COPYVPTR)                              1196 04295000
         LR    @03,@04                                             1196 04296000
         XR    @03,@04                                             1196 04297000
         STC   @03,COPLIB2(,COPYVPTR)                              1196 04298000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 04299000
*         THEN                      /* YES                   @Y30LB25*/ 04300000
         TM    LUSM1(@08),B'10000000'                              1197 04301000
         BNO   @RF01197                                            1197 04302000
*         COP2BIT1=ON;              /* LIBID2 BIT1 ON        @Y30LB25*/ 04303000
         OI    COP2BIT1(COPYVPTR),B'00000010'                      1198 04304000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 04305000
*         THEN                      /* YES                   @Y30LB25*/ 04306000
@RF01197 TM    LUSM2+8(MESGPTR),B'01000000'                        1199 04307000
         BNO   @RF01199                                            1199 04308000
*         COP2BIT2=ON;              /* LIBID2 BIT2 ON        @Y30LB25*/ 04309000
         OI    COP2BIT2(COPYVPTR),B'00000001'                      1200 04310000
*       COPDTREM=BLANK4;            /* NULL DATE REMOVED     @Y30LB25*/ 04311000
@RF01199 MVI   COPDTREM+1(COPYVPTR),C' '                           1201 04312000
         MVC   COPDTREM+2(2,COPYVPTR),COPDTREM+1(COPYVPTR)         1201 04313000
         MVI   COPDTREM(COPYVPTR),C' '                             1201 04314000
*       COPDEST=BLANK30;            /* NULL DESTINATION      @Y30LB25*/ 04315000
         MVI   COPDEST+1(COPYVPTR),C' '                            1202 04316000
         MVC   COPDEST+2(28,COPYVPTR),COPDEST+1(COPYVPTR)          1202 04317000
         MVI   COPDEST(COPYVPTR),C' '                              1202 04318000
*       CALL CVRCSN2;               /* PROC CVR CSN2 CIR     @Y30LB25*/ 04319000
         BAL   @14,CVRCSN2                                         1203 04320000
*       RETURN;                     /*                       @Y30LB25*/ 04321000
         B     @EL00020                                            1204 04322000
*     END;                          /*                       @Y30LB25*/ 04323000
*   END CKCVR2;                     /*                       @Y30LB25*/ 04324000
         B     @EL00020                                            1206 04325000
*                                                                  1207 04326000
*   /*****************************************************************/ 04327000
*   /*                                                               */ 04328000
*   /* PROCEDURE NAME - CVRCSN1                              @Y30LB25*/ 04329000
*   /*                                                       @Y30LB25*/ 04330000
*   /* FUNCTION - WRITE THE CVR.                             @Y30LB25*/ 04331000
*   /* READ FOR CIR OF REPLACED CSN1.                        @Y30LB25*/ 04332000
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/ 04333000
*   /* CVR, CREATE A NEW CIR FOR CSN1 OF CVR AND RETURN.     @Y30LB25*/ 04334000
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN1          @Y30LB25*/ 04335000
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/ 04336000
*   /*                                                       @Y30LB25*/ 04337000
*   /* INPUT -                                               @Y30LB25*/ 04338000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 04339000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 04340000
*   /*                                                       @Y30LB25*/ 04341000
*   /* OUTPUT -                                              @Y30LB25*/ 04342000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 04343000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 04344000
*   /*                                                               */ 04345000
*   /*****************************************************************/ 04346000
*                                                                  1207 04347000
*CVRCSN1:                           /*                       @Y30LB25*/ 04348000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 04349000
*                                                                  1207 04350000
CVRCSN1  ST    @14,@SA00021                                        1207 04351000
*   /*****************************************************************/ 04352000
*   /*                                                               */ 04353000
*   /* WRITE THE CVR FOR THE CARTRIDGE ENTERED               @Y30LB25*/ 04354000
*   /*                                                               */ 04355000
*   /*****************************************************************/ 04356000
*                                                                  1208 04357000
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/ 04358000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1208 04359000
*   RESPECIFY                       /*                       @Y30LB25*/ 04360000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 04361000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 04362000
         LR    RG1,RPLVPTR                                         1210 04363000
*   CALL ICBVIO00;                  /* WRITE CVR             @Y30LB25*/ 04364000
         L     @15,@CV00610                                        1211 04365000
         BALR  @14,@15                                             1211 04366000
*   RESPECIFY                       /*                       @Y30LB25*/ 04367000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 04368000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 04369000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 04370000
         LH    @08,RPLVRETC(,RPLVPTR)                              1213 04371000
         N     @08,@CF00815                                        1213 04372000
         LTR   @08,@08                                             1213 04373000
         BZ    @RF01213                                            1213 04374000
*     DO;                           /* NO REC FND            @Y30LB25*/ 04375000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 04376000
         BAL   @14,PLIBMSG                                         1215 04377000
*       RETURN;                     /*                       @Y30LB25*/ 04378000
@EL00021 DS    0H                                                  1216 04379000
@EF00021 DS    0H                                                  1216 04380000
@ER00021 L     @14,@SA00021                                        1216 04381000
         BR    @14                                                 1216 04382000
*     END;                          /*                       @Y30LB25*/ 04383000
*                                                                  1217 04384000
*   /*****************************************************************/ 04385000
*   /*                                                               */ 04386000
*   /* READ FOR CIR OF REPLACED CSN1 OF THE CVR              @Y30LB25*/ 04387000
*   /*                                                               */ 04388000
*   /*****************************************************************/ 04389000
*                                                                  1218 04390000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 04391000
@RF01213 MVI   RPLVTYP(RPLVPTR),X'00'                              1218 04392000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 04393000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1219 04394000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 04395000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1220 04396000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 04397000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1221 04398000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 04399000
         LA    @08,IKEY                                            1222 04400000
         ST    @08,RPLVKEY(,RPLVPTR)                               1222 04401000
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/ 04402000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1223 04403000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/ 04404000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1224 04405000
*   RESPECIFY                       /*                       @Y30LB25*/ 04406000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 04407000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 04408000
         LR    RG1,RPLVPTR                                         1226 04409000
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/ 04410000
         L     @15,@CV00610                                        1227 04411000
         BALR  @14,@15                                             1227 04412000
*   RESPECIFY                       /*                       @Y30LB25*/ 04413000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 04414000
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/ 04415000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 04416000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1229 04417000
         BNE   @RF01229                                            1229 04418000
*     DO;                           /* NO REC FND            @Y30LB25*/ 04419000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 04420000
         BAL   @14,PLIBMSG                                         1231 04421000
*       RETURN;                     /*                       @Y30LB25*/ 04422000
         B     @EL00021                                            1232 04423000
*     END;                          /*                       @Y30LB25*/ 04424000
*                                                                  1233 04425000
*   /*****************************************************************/ 04426000
*   /*                                                               */ 04427000
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/ 04428000
*   /*                                                               */ 04429000
*   /*****************************************************************/ 04430000
*                                                                  1234 04431000
*   IF RPLRCODE=NORECFND|INDVSRNO^=COPSERNO/*                @Y30LB25   04432000
*                                      NO RECORD FND OR      @Y30LB25   04433000
*                                      WRONG SERIAL NO?      @Y30LB25*/ 04434000
*     THEN                          /* YES                   @Y30LB25*/ 04435000
@RF01229 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        1234 04436000
         BE    @RT01234                                            1234 04437000
         CLC   INDVSRNO(6,INDEXPTR),COPSERNO(COPYVPTR)             1234 04438000
         BE    @RF01234                                            1234 04439000
@RT01234 DS    0H                                                  1235 04440000
*     DO;                           /*                       @Y30LB25*/ 04441000
*                                                                  1235 04442000
*       /*************************************************************/ 04443000
*       /*                                                           */ 04444000
*       /* CREATE A CIR FOR CSN1                             @Y30LB25*/ 04445000
*       /*                                                           */ 04446000
*       /*************************************************************/ 04447000
*                                                                  1236 04448000
*       CSNUMBER=ON;                /* CSN1                  @Y30LB25*/ 04449000
         OI    CSNUMBER,B'00000100'                                1236 04450000
*       BCDVPTR=COPYVPTR;           /* CVR PTR               @Y30LB25*/ 04451000
         ST    COPYVPTR,BCDVPTR                                    1237 04452000
*       CALL VUCIR;                 /*                       @Y30LB25   04453000
*                                      MAKE CIR FOR CSN1     @Y30LB25*/ 04454000
         BAL   @14,VUCIR                                           1238 04455000
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/ 04456000
*         THEN                      /* ERROR                 @Y30LB25*/ 04457000
         LH    @08,RPLVRETC(,RPLVPTR)                              1239 04458000
         N     @08,@CF00815                                        1239 04459000
         LTR   @08,@08                                             1239 04460000
         BZ    @RF01239                                            1239 04461000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 04462000
         BAL   @14,PLIBMSG                                         1240 04463000
*       RETURN;                     /*                       @Y30LB25*/ 04464000
         B     @EL00021                                            1241 04465000
*     END;                          /*                       @Y30LB25*/ 04466000
*                                                                  1242 04467000
*   /*****************************************************************/ 04468000
*   /*                                                               */ 04469000
*   /* DELETE CIR FOR THE REPLACED CSN1                      @Y30LB25*/ 04470000
*   /*                                                               */ 04471000
*   /*****************************************************************/ 04472000
*                                                                  1243 04473000
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/ 04474000
@RF01234 MVI   RPLVTYP(RPLVPTR),X'05'                              1243 04475000
*   RESPECIFY                       /*                       @Y30LB25*/ 04476000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 04477000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 04478000
         LR    RG1,RPLVPTR                                         1245 04479000
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/ 04480000
         L     @15,@CV00610                                        1246 04481000
         BALR  @14,@15                                             1246 04482000
*   RESPECIFY                       /*                       @Y30LB25*/ 04483000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 04484000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 04485000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 04486000
         LH    @08,RPLVRETC(,RPLVPTR)                              1248 04487000
         N     @08,@CF00815                                        1248 04488000
         LTR   @08,@08                                             1248 04489000
         BZ    @RF01248                                            1248 04490000
*     DO;                           /* NO REC FND            @Y30LB25*/ 04491000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 04492000
         BAL   @14,PLIBMSG                                         1250 04493000
*       RETURN;                     /*                       @Y30LB25*/ 04494000
         B     @EL00021                                            1251 04495000
*     END;                          /*                       @Y30LB25*/ 04496000
*                                                                  1252 04497000
*   /*****************************************************************/ 04498000
*   /*                                                               */ 04499000
*   /* CREATE A CIR FOR CSN1                                 @Y30LB25*/ 04500000
*   /*                                                               */ 04501000
*   /*****************************************************************/ 04502000
*                                                                  1253 04503000
*   CSNUMBER=ON;                    /* CSN1                  @Y30LB25*/ 04504000
@RF01248 OI    CSNUMBER,B'00000100'                                1253 04505000
*   BCDVPTR=COPYVPTR;               /* CVR PTR               @Y30LB25*/ 04506000
         ST    COPYVPTR,BCDVPTR                                    1254 04507000
*   CALL VUCIR;                     /*                       @Y30LB25   04508000
*                                      MAKE CIR FOR CSN1     @Y30LB25*/ 04509000
         BAL   @14,VUCIR                                           1255 04510000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 04511000
*     THEN                          /* ERROR                 @Y30LB25*/ 04512000
         LH    @08,RPLVRETC(,RPLVPTR)                              1256 04513000
         N     @08,@CF00815                                        1256 04514000
         LTR   @08,@08                                             1256 04515000
         BZ    @RF01256                                            1256 04516000
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/ 04517000
         BAL   @14,PLIBMSG                                         1257 04518000
*   RETURN;                         /*                       @Y30LB25*/ 04519000
         B     @EL00021                                            1258 04520000
*   END CVRCSN1;                    /*                       @Y30LB25*/ 04521000
         B     @EL00021                                            1259 04522000
*                                                                  1260 04523000
*   /*****************************************************************/ 04524000
*   /*                                                               */ 04525000
*   /* PROCEDURE NAME - CVRCSN2                              @Y30LB25*/ 04526000
*   /*                                                       @Y30LB25*/ 04527000
*   /* FUNCTION - WRITE THE CVR.                             @Y30LB25*/ 04528000
*   /* READ FOR CIR OF REPLACED CSN2.                        @Y30LB25*/ 04529000
*   /* IF THERE IS NOT ONE OR IT DOES NOT POINT TO THE       @Y30LB25*/ 04530000
*   /* CVR, CREATE A NEW CIR FOR CSN2 OF CVR AND RETURN.     @Y30LB25*/ 04531000
*   /* OTHERWISE, CREATE A NEW CIR FOR THE NEW CSN2          @Y30LB25*/ 04532000
*   /* AND DELETE THE OLD CSN.                               @Y30LB25*/ 04533000
*   /*                                                       @Y30LB25*/ 04534000
*   /* INPUT -                                               @Y30LB25*/ 04535000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 04536000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 04537000
*   /*                                                       @Y30LB25*/ 04538000
*   /* OUTPUT -                                              @Y30LB25*/ 04539000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 04540000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 04541000
*   /*                                                               */ 04542000
*   /*****************************************************************/ 04543000
*                                                                  1260 04544000
*CVRCSN2:                           /*                       @Y30LB25*/ 04545000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 04546000
*                                                                  1260 04547000
CVRCSN2  ST    @14,@SA00022                                        1260 04548000
*   /*****************************************************************/ 04549000
*   /*                                                               */ 04550000
*   /* WRITE THE CVR FOR THE CARTRIDGE PAIRED WITH THE       @Y30LB25*/ 04551000
*   /* ONE ENTERED                                           @Y30LB25*/ 04552000
*   /*                                                               */ 04553000
*   /*****************************************************************/ 04554000
*                                                                  1261 04555000
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/ 04556000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1261 04557000
*   RESPECIFY                       /*                       @Y30LB25*/ 04558000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 04559000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 04560000
         LR    RG1,RPLVPTR                                         1263 04561000
*   CALL ICBVIO00;                  /* WRITE CVR             @Y30LB25*/ 04562000
         L     @15,@CV00610                                        1264 04563000
         BALR  @14,@15                                             1264 04564000
*   RESPECIFY                       /*                       @Y30LB25*/ 04565000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 04566000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 04567000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 04568000
         LH    @08,RPLVRETC(,RPLVPTR)                              1266 04569000
         N     @08,@CF00815                                        1266 04570000
         LTR   @08,@08                                             1266 04571000
         BZ    @RF01266                                            1266 04572000
*     DO;                           /* NO REC FND            @Y30LB25*/ 04573000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 04574000
         BAL   @14,PLIBMSG                                         1268 04575000
*       RETURN;                     /*                       @Y30LB25*/ 04576000
@EL00022 DS    0H                                                  1269 04577000
@EF00022 DS    0H                                                  1269 04578000
@ER00022 L     @14,@SA00022                                        1269 04579000
         BR    @14                                                 1269 04580000
*     END;                          /*                       @Y30LB25*/ 04581000
*                                                                  1270 04582000
*   /*****************************************************************/ 04583000
*   /*                                                               */ 04584000
*   /* READ FOR CIR OF REPLACED CSN2 OF THE CVR              @Y30LB25*/ 04585000
*   /*                                                               */ 04586000
*   /*****************************************************************/ 04587000
*                                                                  1271 04588000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 04589000
@RF01266 MVI   RPLVTYP(RPLVPTR),X'00'                              1271 04590000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 04591000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1272 04592000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 04593000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1273 04594000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 04595000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1274 04596000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 04597000
         LA    @08,IKEY                                            1275 04598000
         ST    @08,RPLVKEY(,RPLVPTR)                               1275 04599000
*   RPLVBUF=INDEXPTR;               /* PTR TO CIR BUF        @Y30LB25*/ 04600000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1276 04601000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUF LENGTH        @Y30LB25*/ 04602000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1277 04603000
*   RESPECIFY                       /*                       @Y30LB25*/ 04604000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 04605000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 04606000
         LR    RG1,RPLVPTR                                         1279 04607000
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/ 04608000
         L     @15,@CV00610                                        1280 04609000
         BALR  @14,@15                                             1280 04610000
*   RESPECIFY                       /*                       @Y30LB25*/ 04611000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 04612000
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/ 04613000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 04614000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1282 04615000
         BNE   @RF01282                                            1282 04616000
*     DO;                           /* NO REC FND            @Y30LB25*/ 04617000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 04618000
         BAL   @14,PLIBMSG                                         1284 04619000
*       RETURN;                     /*                       @Y30LB25*/ 04620000
         B     @EL00022                                            1285 04621000
*     END;                          /*                       @Y30LB25*/ 04622000
*                                                                  1286 04623000
*   /*****************************************************************/ 04624000
*   /*                                                               */ 04625000
*   /* CHECK THE RECORD, IF ANY                              @Y30LB25*/ 04626000
*   /*                                                               */ 04627000
*   /*****************************************************************/ 04628000
*                                                                  1287 04629000
*   IF RPLRCODE=NORECFND|INDVSRNO^=COPSERNO/*                @Y30LB25   04630000
*                                      NO RECORD FND OR      @Y30LB25   04631000
*                                      WRONG SERIAL NO?      @Y30LB25*/ 04632000
*     THEN                          /* YES                   @Y30LB25*/ 04633000
@RF01282 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        1287 04634000
         BE    @RT01287                                            1287 04635000
         CLC   INDVSRNO(6,INDEXPTR),COPSERNO(COPYVPTR)             1287 04636000
         BE    @RF01287                                            1287 04637000
@RT01287 DS    0H                                                  1288 04638000
*     DO;                           /*                       @Y30LB25*/ 04639000
*                                                                  1288 04640000
*       /*************************************************************/ 04641000
*       /*                                                           */ 04642000
*       /* CREATE A CIR FOR CSN2                             @Y30LB25*/ 04643000
*       /*                                                           */ 04644000
*       /*************************************************************/ 04645000
*                                                                  1289 04646000
*       CSNUMBER=OFF;               /* CSN2                  @Y30LB25*/ 04647000
         NI    CSNUMBER,B'11111011'                                1289 04648000
*       BCDVPTR=COPYVPTR;           /* CVR PTR               @Y30LB25*/ 04649000
         ST    COPYVPTR,BCDVPTR                                    1290 04650000
*       CALL VUCIR;                 /*                       @Y30LB25   04651000
*                                      MAKE CIR FOR CSN2     @Y30LB25*/ 04652000
         BAL   @14,VUCIR                                           1291 04653000
*       IF RPLVRETC^=FIXZERO        /* CK RETURN CODE        @Y30LB25*/ 04654000
*         THEN                      /* ERROR                 @Y30LB25*/ 04655000
         LH    @08,RPLVRETC(,RPLVPTR)                              1292 04656000
         N     @08,@CF00815                                        1292 04657000
         LTR   @08,@08                                             1292 04658000
         BZ    @RF01292                                            1292 04659000
*         CALL PLIBMSG;             /* MSG TO LIBRARIAN      @Y30LB25*/ 04660000
         BAL   @14,PLIBMSG                                         1293 04661000
*       RETURN;                     /*                       @Y30LB25*/ 04662000
         B     @EL00022                                            1294 04663000
*     END;                          /*                       @Y30LB25*/ 04664000
*                                                                  1295 04665000
*   /*****************************************************************/ 04666000
*   /*                                                               */ 04667000
*   /* DELETE CIR FOR THE REPLACED CSN2                      @Y30LB25*/ 04668000
*   /*                                                               */ 04669000
*   /*****************************************************************/ 04670000
*                                                                  1296 04671000
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/ 04672000
@RF01287 MVI   RPLVTYP(RPLVPTR),X'05'                              1296 04673000
*   RESPECIFY                       /*                       @Y30LB25*/ 04674000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 04675000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 04676000
         LR    RG1,RPLVPTR                                         1298 04677000
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/ 04678000
         L     @15,@CV00610                                        1299 04679000
         BALR  @14,@15                                             1299 04680000
*   RESPECIFY                       /*                       @Y30LB25*/ 04681000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 04682000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 04683000
*     THEN                          /* ERROR - I/O ERROR     @Y30LB25*/ 04684000
         LH    @08,RPLVRETC(,RPLVPTR)                              1301 04685000
         N     @08,@CF00815                                        1301 04686000
         LTR   @08,@08                                             1301 04687000
         BZ    @RF01301                                            1301 04688000
*     DO;                           /* NO REC FND            @Y30LB25*/ 04689000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 04690000
         BAL   @14,PLIBMSG                                         1303 04691000
*       RETURN;                     /*                       @Y30LB25*/ 04692000
         B     @EL00022                                            1304 04693000
*     END;                          /*                       @Y30LB25*/ 04694000
*                                                                  1305 04695000
*   /*****************************************************************/ 04696000
*   /*                                                               */ 04697000
*   /* CREATE A CIR FOR CSN2                                 @Y30LB25*/ 04698000
*   /*                                                               */ 04699000
*   /*****************************************************************/ 04700000
*                                                                  1306 04701000
*   CSNUMBER=OFF;                   /* CSN2                  @Y30LB25*/ 04702000
@RF01301 NI    CSNUMBER,B'11111011'                                1306 04703000
*   BCDVPTR=COPYVPTR;               /* CVR PTR               @Y30LB25*/ 04704000
         ST    COPYVPTR,BCDVPTR                                    1307 04705000
*   CALL VUCIR;                     /*                       @Y30LB25   04706000
*                                      MAKE CIR FOR CSN2     @Y30LB25*/ 04707000
         BAL   @14,VUCIR                                           1308 04708000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 04709000
*     THEN                          /* ERROR                 @Y30LB25*/ 04710000
         LH    @08,RPLVRETC(,RPLVPTR)                              1309 04711000
         N     @08,@CF00815                                        1309 04712000
         LTR   @08,@08                                             1309 04713000
         BZ    @RF01309                                            1309 04714000
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/ 04715000
         BAL   @14,PLIBMSG                                         1310 04716000
*   RETURN;                         /*                       @Y30LB25*/ 04717000
         B     @EL00022                                            1311 04718000
*   END CVRCSN2;                    /*                       @Y30LB25*/ 04719000
         B     @EL00022                                            1312 04720000
*                                                                  1313 04721000
*   /*****************************************************************/ 04722000
*   /*                                                               */ 04723000
*   /* PROCEDURE NAME - NONEFND                              @Y30LB25*/ 04724000
*   /*                                                       @Y30LB25*/ 04725000
*   /* FUNCTION - READ FOR A BVR. IF ONE IS FOUND,           @Y30LB25*/ 04726000
*   /* THEN CREATE A DVR AND ITS CIRS, AND WRITE THEM.       @Y30LB25*/ 04727000
*   /* IF NONE IS FOUND, THEN CREATE AN INACTIVE BVR         @Y30LB25*/ 04728000
*   /* AND ITS CIRS, CHAIN THE BVR INTO THE NGVR,            @Y30LB25*/ 04729000
*   /* AND WRITE THEM.                                       @Y30LB25*/ 04730000
*   /*                                                       @Y30LB25*/ 04731000
*   /* INPUT -                                               @Y30LB25*/ 04732000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 04733000
*   /*                                                       @Y30LB25*/ 04734000
*   /* OUTPUT -                                              @Y30LB25*/ 04735000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 04736000
*   /* CARTRIDGE INDEX RECORDS                               @Y30LB25*/ 04737000
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/ 04738000
*   /*                                                               */ 04739000
*   /*****************************************************************/ 04740000
*                                                                  1313 04741000
*NONEFND:                           /*                       @Y30LB25*/ 04742000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 04743000
*                                                                  1313 04744000
NONEFND  ST    @14,@SA00023                                        1313 04745000
*   /*****************************************************************/ 04746000
*   /*                                                               */ 04747000
*   /* READ FOR A BVR                                        @Y30LB25*/ 04748000
*   /*                                                               */ 04749000
*   /*****************************************************************/ 04750000
*                                                                  1314 04751000
*   BVOLKY=VOLIDUSM;                /* SET VOLID             @Y30LB25*/ 04752000
         MVC   BVOLKY(6),VOLIDUSM+8(MESGPTR)                       1314 04753000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 04754000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1315 04755000
*   RPLVLOC=ON;                     /* LOCATE READ           @Y30LB25*/ 04756000
         OI    RPLVLOC(RPLVPTR),B'10000000'                        1316 04757000
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/ 04758000
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1317 04759000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 04760000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1318 04761000
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/ 04762000
         LA    @08,BKEY                                            1319 04763000
         ST    @08,RPLVKEY(,RPLVPTR)                               1319 04764000
*   RESPECIFY                       /*                       @Y30LB25*/ 04765000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 04766000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 04767000
         LR    RG1,RPLVPTR                                         1321 04768000
*   CALL ICBVIO00;                  /* READ FOR BVR          @Y30LB25*/ 04769000
         L     @15,@CV00610                                        1322 04770000
         BALR  @14,@15                                             1322 04771000
*   RESPECIFY                       /*                       @Y30LB25*/ 04772000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 04773000
*   IF RPLRCODE=IOERROR             /* CK REASON CODE        @Y30LB25*/ 04774000
*     THEN                          /* I/O ERROR             @Y30LB25*/ 04775000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1324 04776000
         BNE   @RF01324                                            1324 04777000
*     DO;                           /*                       @Y30LB25*/ 04778000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 04779000
         BAL   @14,PLIBMSG                                         1326 04780000
*       RETURN;                     /*                       @Y30LB25*/ 04781000
@EL00023 DS    0H                                                  1327 04782000
@EF00023 DS    0H                                                  1327 04783000
@ER00023 L     @14,@SA00023                                        1327 04784000
         BR    @14                                                 1327 04785000
*     END;                          /*                       @Y30LB25*/ 04786000
*                                                                  1328 04787000
*   /*****************************************************************/ 04788000
*   /*                                                               */ 04789000
*   /* NO BVR FOUND                                          @Y30LB25*/ 04790000
*   /*                                                               */ 04791000
*   /*****************************************************************/ 04792000
*                                                                  1329 04793000
*   IF RPLRCODE=NORECFND            /* NO REC FOUND?         @Y30LB25*/ 04794000
*     THEN                          /* YES                   @Y30LB25*/ 04795000
@RF01324 CLC   RPLRCODE(2,RPLVPTR),@CB00586                        1329 04796000
         BNE   @RF01329                                            1329 04797000
*     DO;                           /*                       @Y30LB25*/ 04798000
*                                                                  1330 04799000
*       /*************************************************************/ 04800000
*       /*                                                           */ 04801000
*       /* CREATE A BVR                                      @Y30LB25*/ 04802000
*       /*                                                           */ 04803000
*       /*************************************************************/ 04804000
*                                                                  1331 04805000
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO REASON CODE      @Y30LB25*/ 04806000
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               1331 04807000
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETURN CODE      @Y30LB25*/ 04808000
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               1332 04809000
*       CALL CRTBVR;                /* CREATE BVR            @Y30LB25*/ 04810000
         BAL   @14,CRTBVR                                          1333 04811000
*       RETURN;                     /*                       @Y30LB25*/ 04812000
         B     @EL00023                                            1334 04813000
*     END;                          /*                       @Y30LB25*/ 04814000
*                                                                  1335 04815000
*   /*****************************************************************/ 04816000
*   /*                                                               */ 04817000
*   /* BVR WAS FOUND                                         @Y30LB25*/ 04818000
*   /*                                                               */ 04819000
*   /*****************************************************************/ 04820000
*                                                                  1336 04821000
*   ELSE                            /* BVR WAS FOUND         @Y30LB25*/ 04822000
*     DO;                           /*                       @Y30LB25*/ 04823000
*                                                                  1336 04824000
@RF01329 DS    0H                                                  1337 04825000
*       /*************************************************************/ 04826000
*       /*                                                           */ 04827000
*       /* CREATE A DVR                                      @Y30LB25*/ 04828000
*       /*                                                           */ 04829000
*       /*************************************************************/ 04830000
*                                                                  1337 04831000
*       RPLRCODE=RPLRCODE&&RPLRCODE;/* ZERO REASON CODE      @Y30LB25*/ 04832000
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               1337 04833000
*       RPLVRETC=RPLVRETC&&RPLVRETC;/* ZERO RETURN CODE      @Y30LB25*/ 04834000
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               1338 04835000
*       CALL CRTDVR;                /* CREATE DVR            @Y30LB25*/ 04836000
         BAL   @14,CRTDVR                                          1339 04837000
*       RETURN;                     /*                       @Y30LB25*/ 04838000
         B     @EL00023                                            1340 04839000
*     END;                          /*                       @Y30LB25*/ 04840000
*   END NONEFND;                    /*                       @Y30LB25*/ 04841000
*                                                                  1343 04842000
*   /*****************************************************************/ 04843000
*   /*                                                               */ 04844000
*   /* PROCEDURE NAME - CRTBVR                               @Y30LB25*/ 04845000
*   /*                                                       @Y30LB25*/ 04846000
*   /* FUNCTION - INITIALIZE AND WRITE A BVR AND ITS CIRS.   @Y30LB25*/ 04847000
*   /* CHAIN THE BVR INTO THE NGVR.                          @Y30LB25*/ 04848000
*   /*                                                       @Y30LB25*/ 04849000
*   /* INPUT -                                               @Y30LB25*/ 04850000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 04851000
*   /*                                                       @Y30LB25*/ 04852000
*   /* OUTPUT -                                              @Y30LB25*/ 04853000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 04854000
*   /* CARTRIDGE INDEX RECORDS                               @Y30LB25*/ 04855000
*   /*                                                               */ 04856000
*   /*****************************************************************/ 04857000
*                                                                  1343 04858000
*CRTBVR:                            /*                       @Y30LB25*/ 04859000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 04860000
*                                                                  1343 04861000
CRTBVR   ST    @14,@SA00024                                        1343 04862000
*   /*****************************************************************/ 04863000
*   /*                                                               */ 04864000
*   /* INITIALIZE AND SET-UP THE BVR                         @Y30LB25*/ 04865000
*   /*                                                               */ 04866000
*   /*****************************************************************/ 04867000
*                                                                  1344 04868000
*   BASEBUF=BASEBUF&&BASEBUF;       /* ZERO BVR BUFFER       @Y30LB25*/ 04869000
         XC    BASEBUF(224),BASEBUF                                1344 04870000
*   BASNAME=BKEY;                   /* SET BVR KEY           @Y30LB25*/ 04871000
         L     @08,BASEVPTR                                        1345 04872000
         MVC   BASNAME(13,@08),BKEY                                1345 04873000
*   BASBASVR=ON;                    /* BVR FLAG              @Y30LB25*/ 04874000
         OI    BASBASVR(@08),B'00100000'                           1346 04875000
*   IF SEQNUM=ONEF1                 /* CSN1?                 @Y30LB25*/ 04876000
*     THEN                          /* YES                   @Y30LB25*/ 04877000
         LA    @04,8                                               1347 04878000
         ALR   @04,MESGPTR                                         1347 04879000
         CLI   SEQNUM(@04),X'F1'                                   1347 04880000
         BNE   @RF01347                                            1347 04881000
*     DO;                           /*                       @Y30LB25*/ 04882000
*       BASCSN1=CSN1USM;            /* SET CSN1              @Y30LB25*/ 04883000
         MVC   BASCSN1(12,@08),CSN1USM(@04)                        1349 04884000
*       BASCSN2=CSN2USM;            /* INIT CSN2             @YM31076*/ 04885000
         MVC   BASCSN2(12,@08),CSN2USM(@04)                        1350 04886000
*       BASLIB2=FIX2FS;             /* INIT LIBID2           @Y30LB25*/ 04887000
         L     @03,@CF00550                                        1351 04888000
         STC   @03,BASLIB2(,@08)                                   1351 04889000
*       BASLIB1=BASLIB1&&BASLIB1;   /* ZERO LIBID1           @Y30LB25*/ 04890000
         SLR   @03,@03                                             1352 04891000
         IC    @03,BASLIB1(,@08)                                   1352 04892000
         LR    @15,@03                                             1352 04893000
         XR    @15,@03                                             1352 04894000
         STC   @15,BASLIB1(,@08)                                   1352 04895000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 04896000
*         THEN                      /* YES                   @Y30LB25*/ 04897000
         TM    LUSM1(@04),B'10000000'                              1353 04898000
         BNO   @RF01353                                            1353 04899000
*         BAS1BIT1=ON;              /* LIBID1 BIT 1 ON       @Y30LB25*/ 04900000
         OI    BAS1BIT1(@08),B'00000010'                           1354 04901000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 04902000
*         THEN                      /* YES                   @Y30LB25*/ 04903000
@RF01353 TM    LUSM2+8(MESGPTR),B'01000000'                        1355 04904000
         BNO   @RF01355                                            1355 04905000
*         BAS1BIT2=ON;              /* LIBID1 BIT 2 ON       @Y30LB25*/ 04906000
         L     @08,BASEVPTR                                        1356 04907000
         OI    BAS1BIT2(@08),B'00000001'                           1356 04908000
*     END;                          /*                       @Y30LB25*/ 04909000
*   ELSE                            /* CSN2                  @Y30LB25*/ 04910000
*     DO;                           /*                       @Y30LB25*/ 04911000
         B     @RC01347                                            1358 04912000
@RF01347 DS    0H                                                  1359 04913000
*       BASCSN2=CSN1USM;            /* SET CSN2              @Y30LB25*/ 04914000
         L     @08,BASEVPTR                                        1359 04915000
         LA    @04,8                                               1359 04916000
         ALR   @04,MESGPTR                                         1359 04917000
         MVC   BASCSN2(12,@08),CSN1USM(@04)                        1359 04918000
*       BASCSN1=CSN2USM;            /* INIT CSN1             @YM31076*/ 04919000
         MVC   BASCSN1(12,@08),CSN2USM(@04)                        1360 04920000
*       BASLIB1=FIX2FS;             /* INIT LIBID1           @Y30LB25*/ 04921000
         L     @03,@CF00550                                        1361 04922000
         STC   @03,BASLIB1(,@08)                                   1361 04923000
*       BASLIB2=BASLIB2&&BASLIB2;   /* ZERO LIBID2           @Y30LB25*/ 04924000
         SLR   @03,@03                                             1362 04925000
         IC    @03,BASLIB2(,@08)                                   1362 04926000
         LR    @15,@03                                             1362 04927000
         XR    @15,@03                                             1362 04928000
         STC   @15,BASLIB2(,@08)                                   1362 04929000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 04930000
*         THEN                      /* YES                   @Y30LB25*/ 04931000
         TM    LUSM1(@04),B'10000000'                              1363 04932000
         BNO   @RF01363                                            1363 04933000
*         BAS2BIT1=ON;              /* LIBID2 BIT 1 ON       @Y30LB25*/ 04934000
         OI    BAS2BIT1(@08),B'00000010'                           1364 04935000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 04936000
*         THEN                      /* YES                   @Y30LB25*/ 04937000
@RF01363 TM    LUSM2+8(MESGPTR),B'01000000'                        1365 04938000
         BNO   @RF01365                                            1365 04939000
*         BAS2BIT2=ON;              /* LIBID2 BIT 2 ON       @Y30LB25*/ 04940000
         L     @08,BASEVPTR                                        1366 04941000
         OI    BAS2BIT2(@08),B'00000001'                           1366 04942000
*     END;                          /*                       @Y30LB25*/ 04943000
@RF01365 DS    0H                                                  1368 04944000
*   BASDLSF=ON;                     /* DOWN LEVEL SPACE      @Y30LB25*/ 04945000
@RC01347 L     @08,BASEVPTR                                        1368 04946000
         OI    BASDLSF(@08),B'10000000'                            1368 04947000
*   BASBKLMT=FIXONE;                /* BKUP LIMIT = 1        @Y30LB25*/ 04948000
         MVI   BASBKLMT(@08),X'01'                                 1369 04949000
*   BASINAC=ON;                     /* INACTIVE VOL          @Y30LB25*/ 04950000
         OI    BASINAC(@08),B'00000100'                            1370 04951000
*   BASFRESP=FIX2FS;                /* # FREE CYLDERS        @Y30LB25*/ 04952000
         L     @04,@CF00550                                        1371 04953000
         STH   @04,BASFRESP(,@08)                                  1371 04954000
*   BASLEXT=FIX2FS;                 /* LARGE FREE EXTENT     @Y30LB25*/ 04955000
         STH   @04,BASLEXT(,@08)                                   1372 04956000
*   BASFREXT=FIX4FS;                /* # FREE EXTENTS        @Y30LB25*/ 04957000
         MVC   BASFREXT(4,@08),@CF00552                            1373 04958000
*   BASEXPDT=FIX4FS;                /* EXPIR DATE            @Y30LB25*/ 04959000
         MVC   BASEXPDT(4,@08),@CB00552                            1374 04960000
*   BASPREV=BLANK6;                 /* PREV BVR PTR          @Y30LB25*/ 04961000
         MVI   BASPREV+1(@08),C' '                                 1375 04962000
         MVC   BASPREV+2(4,@08),BASPREV+1(@08)                     1375 04963000
         MVI   BASPREV(@08),C' '                                   1375 04964000
*   BASNEXTV=BLANK6;                /* NEXT BVR PTR          @Y30LB25*/ 04965000
         MVI   BASNEXTV+1(@08),C' '                                1376 04966000
         MVC   BASNEXTV+2(4,@08),BASNEXTV+1(@08)                   1376 04967000
         MVI   BASNEXTV(@08),C' '                                  1376 04968000
*   BASKLCPY=BLANK13;               /* KEY LATEST COPY       @Y30LB25*/ 04969000
         MVC   BASKLCPY(13,@08),@CC00575                           1377 04970000
*   BASDLMTD=BLANK4;                /* LAST MOUNT DATE       @Y30LB25*/ 04971000
         MVI   BASDLMTD+1(@08),C' '                                1378 04972000
         MVC   BASDLMTD+2(2,@08),BASDLMTD+1(@08)                   1378 04973000
         MVI   BASDLMTD(@08),C' '                                  1378 04974000
*   BASDTREM=BLANK4;                /* EJECT DATE            @Y30LB25*/ 04975000
         MVI   BASDTREM+1(@08),C' '                                1379 04976000
         MVC   BASDTREM+2(2,@08),BASDTREM+1(@08)                   1379 04977000
         MVI   BASDTREM(@08),C' '                                  1379 04978000
*   BASDESCR=BLANK30;               /* DESCRIPTION           @Y30LB25*/ 04979000
         MVI   BASDESCR+1(@08),C' '                                1380 04980000
         MVC   BASDESCR+2(28,@08),BASDESCR+1(@08)                  1380 04981000
         MVI   BASDESCR(@08),C' '                                  1380 04982000
*   BASOWNER=BLANK10;               /* OWNER                 @Y30LB25*/ 04983000
         MVI   BASOWNER+1(@08),C' '                                1381 04984000
         MVC   BASOWNER+2(8,@08),BASOWNER+1(@08)                   1381 04985000
         MVI   BASOWNER(@08),C' '                                  1381 04986000
*   BASDEST=BLANK30;                /* DEST AFTER EJECT      @Y30LB25*/ 04987000
         MVI   BASDEST+1(@08),C' '                                 1382 04988000
         MVC   BASDEST+2(28,@08),BASDEST+1(@08)                    1382 04989000
         MVI   BASDEST(@08),C' '                                   1382 04990000
*   BASRECOV=BLANK6;                /* SERIAL # RECOVERY     @Y30LB25*/ 04991000
         MVI   BASRECOV+1(@08),C' '                                1383 04992000
         MVC   BASRECOV+2(4,@08),BASRECOV+1(@08)                   1383 04993000
         MVI   BASRECOV(@08),C' '                                  1383 04994000
*   BASGROUP=BLANK8;                /* GROUP NAME            @Y30LB25*/ 04995000
*                                                                  1384 04996000
         MVI   BASGROUP+1(@08),C' '                                1384 04997000
         MVC   BASGROUP+2(6,@08),BASGROUP+1(@08)                   1384 04998000
         MVI   BASGROUP(@08),C' '                                  1384 04999000
*   /*****************************************************************/ 05000000
*   /*                                                               */ 05001000
*   /* CHAIN THE BVR INTO THE NGVR BVR CHAIN                 @Y30LB25*/ 05002000
*   /*                                                               */ 05003000
*   /*****************************************************************/ 05004000
*                                                                  1385 05005000
*   GRPFLG=OFF;                     /* NON-GROUPED           @Y30LB25*/ 05006000
         NI    GRPFLG,B'11101111'                                  1385 05007000
*   CALL ICBVUCHI(FIXZERO,BASEVPTR,RPLVPTR,BYTEPASS);/*      @Y30LB25   05008000
*                                      CHAIN BVR INTO NGVR           */ 05009000
         ST    RPLVPTR,@TF00001                                    1386 05010000
         L     @15,@CV00614                                        1386 05011000
         LA    @01,@AL01386                                        1386 05012000
         BALR  @14,@15                                             1386 05013000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 05014000
*     THEN                          /* ERROR                 @Y30LB25*/ 05015000
         LH    @08,RPLVRETC(,RPLVPTR)                              1387 05016000
         N     @08,@CF00815                                        1387 05017000
         LTR   @08,@08                                             1387 05018000
         BZ    @RF01387                                            1387 05019000
*     DO;                           /*                       @Y30LB25*/ 05020000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 05021000
         BAL   @14,PLIBMSG                                         1389 05022000
*       RETURN;                     /*                       @Y30LB25*/ 05023000
@EL00024 DS    0H                                                  1390 05024000
@EF00024 DS    0H                                                  1390 05025000
@ER00024 L     @14,@SA00024                                        1390 05026000
         BR    @14                                                 1390 05027000
*     END;                          /*                       @Y30LB25*/ 05028000
*                                                                  1391 05029000
*   /*****************************************************************/ 05030000
*   /*                                                               */ 05031000
*   /* WRITE THE NEW BVR                                     @Y30LB25*/ 05032000
*   /*                                                               */ 05033000
*   /*****************************************************************/ 05034000
*                                                                  1392 05035000
*   RPLVBLN=LENGTH(BASEBUF);        /* BVR BUF LENGTH        @Y30LB25*/ 05036000
@RF01387 LA    @08,224                                             1392 05037000
         ST    @08,RPLVBLN(,RPLVPTR)                               1392 05038000
*   RPLVRLN=LENGTH(BASEBUF);        /* BVR LENGTH            @Y30LB25*/ 05039000
         ST    @08,RPLVRLN(,RPLVPTR)                               1393 05040000
*   RPLVBUF=BASEVPTR;               /* BVR BUF PTR           @Y30LB25*/ 05041000
         L     @08,BASEVPTR                                        1394 05042000
         ST    @08,RPLVBUF(,RPLVPTR)                               1394 05043000
*   RPLVUPD=OFF;                    /* NEW RECORD            @Y30LB25*/ 05044000
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1395 05045000
*   RPLVDIR=OFF;                    /* NO DIRECT             @Y30LB25*/ 05046000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 05047000
         NI    RPLVDIR(RPLVPTR),B'00111111'                        1397 05048000
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/ 05049000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1398 05050000
*   RESPECIFY                       /*                       @Y30LB25*/ 05051000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05052000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 05053000
         LR    RG1,RPLVPTR                                         1400 05054000
*   CALL ICBVIO00;                  /* WRITE NEW BVR         @Y30LB25*/ 05055000
         L     @15,@CV00610                                        1401 05056000
         BALR  @14,@15                                             1401 05057000
*   RESPECIFY                       /*                       @Y30LB25*/ 05058000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05059000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 05060000
*     THEN                          /* ERROR                 @Y30LB25*/ 05061000
         LH    @08,RPLVRETC(,RPLVPTR)                              1403 05062000
         N     @08,@CF00815                                        1403 05063000
         LTR   @08,@08                                             1403 05064000
         BZ    @RF01403                                            1403 05065000
*     DO;                           /*                       @Y30LB25*/ 05066000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 05067000
         BAL   @14,PLIBMSG                                         1405 05068000
*       RETURN;                     /*                       @Y30LB25*/ 05069000
         B     @EL00024                                            1406 05070000
*     END;                          /*                       @Y30LB25*/ 05071000
*                                                                  1407 05072000
*   /*****************************************************************/ 05073000
*   /*                                                               */ 05074000
*   /* CREATE THE CIRS FOR THE BVR                           @YM31076*/ 05075000
*   /*                                                               */ 05076000
*   /*****************************************************************/ 05077000
*                                                                  1408 05078000
*   BCDVPTR=BASEVPTR;               /* SET UP FOR BVR        @YM31076*/ 05079000
@RF01403 L     @08,BASEVPTR                                        1408 05080000
         ST    @08,BCDVPTR                                         1408 05081000
*   CALL CRT2CIR;                   /* CREATE CVIRS          @YM31076*/ 05082000
         BAL   @14,CRT2CIR                                         1409 05083000
*   END CRTBVR;                     /*                       @Y30LB25*/ 05084000
         B     @EL00024                                            1410 05085000
*                                                                  1411 05086000
*   /*****************************************************************/ 05087000
*   /*                                                               */ 05088000
*   /* PROCEDURE NAME - CRTDVR                               @Y30LB25*/ 05089000
*   /*                                                       @Y30LB25*/ 05090000
*   /* FUNCTION - LOCATE THE FIRST AVAILABLE DVR KEY.        @Y30LB25*/ 05091000
*   /* INITIALIZE AND WRITE A DVR AND ITS CIRS.              @Y30LB25*/ 05092000
*   /*                                                       @Y30LB25*/ 05093000
*   /* INPUT -                                               @Y30LB25*/ 05094000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 05095000
*   /*                                                       @Y30LB25*/ 05096000
*   /* OUTPUT -                                              @Y30LB25*/ 05097000
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/ 05098000
*   /* CARTRIDGE INDEX RECORDS                               @Y30LB25*/ 05099000
*   /*                                                               */ 05100000
*   /*****************************************************************/ 05101000
*                                                                  1411 05102000
*CRTDVR:                            /*                       @Y30LB25*/ 05103000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 05104000
*                                                                  1411 05105000
CRTDVR   ST    @14,@SA00025                                        1411 05106000
*   /*****************************************************************/ 05107000
*   /*                                                               */ 05108000
*   /* FIND AN ID FOR THE DVR                                @Y30LB25*/ 05109000
*   /*                                                               */ 05110000
*   /*****************************************************************/ 05111000
*                                                                  1412 05112000
*   DVOLKY=VOLIDUSM;                /* SET VOLID             @Y30LB25*/ 05113000
         MVC   DVOLKY(6),VOLIDUSM+8(MESGPTR)                       1412 05114000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 05115000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1413 05116000
*   RPLVLOC=ON;                     /* LOCATE                @Y30LB25*/ 05117000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 05118000
         OI    RPLVLOC(RPLVPTR),B'11000000'                        1415 05119000
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/ 05120000
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1416 05121000
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/ 05122000
         LA    @08,DKEY                                            1417 05123000
         ST    @08,RPLVKEY(,RPLVPTR)                               1417 05124000
*   DIDKY=FIXZERO;                  /* START DVR 0           @Y30LB25*/ 05125000
         MVI   DIDKY,X'00'                                         1418 05126000
*   RESPECIFY                       /*                       @Y30LB25*/ 05127000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05128000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 05129000
         LR    RG1,RPLVPTR                                         1420 05130000
*   A=FIXONE;                       /* LOOP CONTROL          @Y30LB25*/ 05131000
         LA    A,1                                                 1421 05132000
*   DO WHILE A=1;                   /* FIND AVAIL DVR        @Y30LB25*/ 05133000
         B     @DE01422                                            1422 05134000
@DL01422 DS    0H                                                  1423 05135000
*     DIDKY=DIDKY+FIXONE;           /* NEXT KEY              @Y30LB25*/ 05136000
         LA    @08,1                                               1423 05137000
         SLR   @04,@04                                             1423 05138000
         IC    @04,DIDKY                                           1423 05139000
         ALR   @08,@04                                             1423 05140000
         STC   @08,DIDKY                                           1423 05141000
*     CALL ICBVIO00;                /* READ FOR DVR          @Y30LB25*/ 05142000
         L     @15,@CV00610                                        1424 05143000
         BALR  @14,@15                                             1424 05144000
*     IF RPLVRETC^=FIXZERO|DIDKY=FIX255/* ERROR?             @Y30LB25*/ 05145000
*       THEN                        /* YES                   @Y30LB25*/ 05146000
         LH    @08,RPLVRETC(,RPLVPTR)                              1425 05147000
         N     @08,@CF00815                                        1425 05148000
         LTR   @08,@08                                             1425 05149000
         BNZ   @RT01425                                            1425 05150000
         CLI   DIDKY,255                                           1425 05151000
         BNE   @RF01425                                            1425 05152000
@RT01425 DS    0H                                                  1426 05153000
*       A=FIXZERO;                  /* END LOOP              @Y30LB25*/ 05154000
         SLR   A,A                                                 1426 05155000
*   END;                            /*                       @Y30LB25*/ 05156000
@RF01425 DS    0H                                                  1427 05157000
@DE01422 C     A,@CF00045                                          1427 05158000
         BE    @DL01422                                            1427 05159000
*   RESPECIFY                       /*                       @Y30LB25*/ 05160000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05161000
*   IF RPLVRETC=FIXZERO|RPLRCODE=IOERROR/* ERROR?            @Y30LB25*/ 05162000
*     THEN                          /* YES                   @Y30LB25*/ 05163000
         LH    @08,RPLVRETC(,RPLVPTR)                              1429 05164000
         N     @08,@CF00815                                        1429 05165000
         LTR   @08,@08                                             1429 05166000
         BZ    @RT01429                                            1429 05167000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1429 05168000
         BNE   @RF01429                                            1429 05169000
@RT01429 DS    0H                                                  1430 05170000
*     DO;                           /*                       @Y30LB25*/ 05171000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 05172000
         BAL   @14,PLIBMSG                                         1431 05173000
*       RETURN;                     /*                       @Y30LB25*/ 05174000
@EL00025 DS    0H                                                  1432 05175000
@EF00025 DS    0H                                                  1432 05176000
@ER00025 L     @14,@SA00025                                        1432 05177000
         BR    @14                                                 1432 05178000
*     END;                          /*                       @Y30LB25*/ 05179000
*   RPLRCODE=RPLRCODE&&RPLRCODE;    /* ZERO REASON CODE      @Y30LB25*/ 05180000
@RF01429 XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               1434 05181000
*   RPLVRETC=RPLVRETC&&RPLVRETC;    /* ZERO RETURN CODE      @Y30LB25*/ 05182000
*                                                                  1435 05183000
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               1435 05184000
*   /*****************************************************************/ 05185000
*   /*                                                               */ 05186000
*   /* INITIALIZE AND SET-UP THE DVR                         @Y30LB25*/ 05187000
*   /*                                                               */ 05188000
*   /*****************************************************************/ 05189000
*                                                                  1436 05190000
*   DUPVBUF=DUPVBUF&&DUPVBUF;       /* ZERO DVR BUFFER       @Y30LB25*/ 05191000
         XC    DUPVBUF(224),DUPVBUF                                1436 05192000
*   DUPNO=DIDKY;                    /* SET AVAIL DVR #       @Y30LB25*/ 05193000
         L     @08,DUPVPTR                                         1437 05194000
         MVC   DUPNO(1,@08),DIDKY                                  1437 05195000
*   DUPD=D4BLANKS;                  /* D & 4 BLANKS          @Y30LB25*/ 05196000
         MVC   DUPD(5,@08),@CC00466                                1438 05197000
*   DUPSERNO=VOLIDUSM;              /* SET VOLID             @Y30LB25*/ 05198000
         LA    @04,8                                               1439 05199000
         ALR   @04,MESGPTR                                         1439 05200000
         MVC   DUPSERNO(6,@08),VOLIDUSM(@04)                       1439 05201000
*   DUPBLANK=BLANK1;                /* 1 BLANK               @Y30LB25*/ 05202000
         MVI   DUPBLANK(@08),C' '                                  1440 05203000
*   DUPDUPLR=ON;                    /* DVR FLAG              @Y30LB25*/ 05204000
         OI    DUPDUPLR(@08),B'00000100'                           1441 05205000
*   IF SEQNUM=ONEF1                 /* CSN1?                 @Y30LB25*/ 05206000
*     THEN                          /* YES                   @Y30LB25*/ 05207000
         CLI   SEQNUM(@04),X'F1'                                   1442 05208000
         BNE   @RF01442                                            1442 05209000
*     DO;                           /*                       @Y30LB25*/ 05210000
*       DUPCSN1=CSN1USM;            /* SET CSN1              @Y30LB25*/ 05211000
         MVC   DUPCSN1(12,@08),CSN1USM(@04)                        1444 05212000
*       DUPCSN2=CSN2USM;            /* INIT CSN2             @YM31076*/ 05213000
         MVC   DUPCSN2(12,@08),CSN2USM(@04)                        1445 05214000
*       DUPLIB2=FIX2FS;             /* INIT LIBID2           @Y30LB25*/ 05215000
         L     @03,@CF00550                                        1446 05216000
         STC   @03,DUPLIB2(,@08)                                   1446 05217000
*       DUPLIB1=DUPLIB1&&DUPLIB1;   /* ZERO LIBID1           @Y30LB25*/ 05218000
         SLR   @03,@03                                             1447 05219000
         IC    @03,DUPLIB1(,@08)                                   1447 05220000
         LR    @15,@03                                             1447 05221000
         XR    @15,@03                                             1447 05222000
         STC   @15,DUPLIB1(,@08)                                   1447 05223000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 05224000
*         THEN                      /* YES                   @Y30LB25*/ 05225000
         TM    LUSM1(@04),B'10000000'                              1448 05226000
         BNO   @RF01448                                            1448 05227000
*         DUP1BIT1=ON;              /* LIBID1 BIT 1 ON       @Y30LB25*/ 05228000
         OI    DUP1BIT1(@08),B'00000010'                           1449 05229000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 05230000
*         THEN                      /* YES                   @Y30LB25*/ 05231000
@RF01448 TM    LUSM2+8(MESGPTR),B'01000000'                        1450 05232000
         BNO   @RF01450                                            1450 05233000
*         DUP1BIT2=ON;              /* LIBID1 BIT 2 ON       @Y30LB25*/ 05234000
         L     @08,DUPVPTR                                         1451 05235000
         OI    DUP1BIT2(@08),B'00000001'                           1451 05236000
*     END;                          /*                       @Y30LB25*/ 05237000
*   ELSE                            /* CSN2                  @Y30LB25*/ 05238000
*     DO;                           /*                       @Y30LB25*/ 05239000
         B     @RC01442                                            1453 05240000
@RF01442 DS    0H                                                  1454 05241000
*       DUPCSN2=CSN1USM;            /* SET CSN2              @Y30LB25*/ 05242000
         L     @08,DUPVPTR                                         1454 05243000
         LA    @04,8                                               1454 05244000
         ALR   @04,MESGPTR                                         1454 05245000
         MVC   DUPCSN2(12,@08),CSN1USM(@04)                        1454 05246000
*       DUPCSN1=CSN2USM;            /* INIT CSN1             @YM31076*/ 05247000
         MVC   DUPCSN1(12,@08),CSN2USM(@04)                        1455 05248000
*       DUPLIB1=FIX2FS;             /* INIT LIBID1           @Y30LB25*/ 05249000
         L     @03,@CF00550                                        1456 05250000
         STC   @03,DUPLIB1(,@08)                                   1456 05251000
*       DUPLIB2=DUPLIB2&&DUPLIB2;   /* ZERO LIBID2           @Y30LB25*/ 05252000
         SLR   @03,@03                                             1457 05253000
         IC    @03,DUPLIB2(,@08)                                   1457 05254000
         LR    @15,@03                                             1457 05255000
         XR    @15,@03                                             1457 05256000
         STC   @15,DUPLIB2(,@08)                                   1457 05257000
*       IF LUSM1=ON                 /* BIT 1 ON?             @Y30LB25*/ 05258000
*         THEN                      /* YES                   @Y30LB25*/ 05259000
         TM    LUSM1(@04),B'10000000'                              1458 05260000
         BNO   @RF01458                                            1458 05261000
*         DUP2BIT1=ON;              /* LIBID2 BIT 1 ON       @Y30LB25*/ 05262000
         OI    DUP2BIT1(@08),B'00000010'                           1459 05263000
*       IF LUSM2=ON                 /* BIT 2 ON?             @Y30LB25*/ 05264000
*         THEN                      /* YES                   @Y30LB25*/ 05265000
@RF01458 TM    LUSM2+8(MESGPTR),B'01000000'                        1460 05266000
         BNO   @RF01460                                            1460 05267000
*         DUP2BIT2=ON;              /* LIBID2 BIT 2 ON       @Y30LB25*/ 05268000
         L     @08,DUPVPTR                                         1461 05269000
         OI    DUP2BIT2(@08),B'00000001'                           1461 05270000
*     END;                          /*                       @Y30LB25*/ 05271000
*                                                                  1462 05272000
@RF01460 DS    0H                                                  1463 05273000
*   /*****************************************************************/ 05274000
*   /*                                                               */ 05275000
*   /* WRITE THE NEW DVR                                     @Y30LB25*/ 05276000
*   /*                                                               */ 05277000
*   /*****************************************************************/ 05278000
*                                                                  1463 05279000
*   RPLVBUF=DUPVPTR;                /* DVR BUF PTR           @Y30LB25*/ 05280000
@RC01442 L     @08,DUPVPTR                                         1463 05281000
         ST    @08,RPLVBUF(,RPLVPTR)                               1463 05282000
*   RPLVUPD=OFF;                    /* NEW RECORD            @Y30LB25*/ 05283000
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1464 05284000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 05285000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1465 05286000
*   RPLVTYP=RPLVPUT;                /* WRITE                 @Y30LB25*/ 05287000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1466 05288000
*   RPLVRLN=LENGTH(DUPV);           /* DVR LENGTH            @Y30LB25*/ 05289000
         MVC   RPLVRLN(4,RPLVPTR),@CF00807                         1467 05290000
*   RPLVBLN=LENGTH(DUPVBUF);        /* DVR BUF LENGTH        @Y30LB25*/ 05291000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1468 05292000
*   RESPECIFY                       /*                       @Y30LB25*/ 05293000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05294000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 05295000
         LR    RG1,RPLVPTR                                         1470 05296000
*   CALL ICBVIO00;                  /* WRITE NEW DVR         @Y30LB25*/ 05297000
         L     @15,@CV00610                                        1471 05298000
         BALR  @14,@15                                             1471 05299000
*   RESPECIFY                       /*                       @Y30LB25*/ 05300000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05301000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 05302000
*     THEN                          /* ERROR                 @Y30LB25*/ 05303000
         LH    @08,RPLVRETC(,RPLVPTR)                              1473 05304000
         N     @08,@CF00815                                        1473 05305000
         LTR   @08,@08                                             1473 05306000
         BZ    @RF01473                                            1473 05307000
*     DO;                           /*                       @Y30LB25*/ 05308000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 05309000
         BAL   @14,PLIBMSG                                         1475 05310000
*       RETURN;                     /*                       @Y30LB25*/ 05311000
         B     @EL00025                                            1476 05312000
*     END;                          /*                       @Y30LB25*/ 05313000
*                                                                  1477 05314000
*   /*****************************************************************/ 05315000
*   /*                                                               */ 05316000
*   /* CREATE THE CIRS FOR THE DVR                           @YM31076*/ 05317000
*   /*                                                               */ 05318000
*   /*****************************************************************/ 05319000
*                                                                  1478 05320000
*   BCDVPTR=DUPVPTR;                /* SET UP FOR DVR        @YM31076*/ 05321000
@RF01473 L     @08,DUPVPTR                                         1478 05322000
         ST    @08,BCDVPTR                                         1478 05323000
*   CALL CRT2CIR;                   /* CREATE THE CIRS       @YM31076*/ 05324000
         BAL   @14,CRT2CIR                                         1479 05325000
*   END CRTDVR;                     /*                       @Y30LB25*/ 05326000
         B     @EL00025                                            1480 05327000
*                                                                  1481 05328000
*   /*****************************************************************/ 05329000
*   /*                                                               */ 05330000
*   /* PROCEDURE NAME - CRT2CIR                              @Y30LB25*/ 05331000
*   /*                                                       @Y30LB25*/ 05332000
*   /* FUNCTION - SET UP FOR THE CREATION OF CIRS            @Y30LB25*/ 05333000
*   /* FOR BVR, CVR, OR DVR.                                 @Y30LB25*/ 05334000
*   /*                                                       @Y30LB25*/ 05335000
*   /* INPUT -                                               @Y30LB25*/ 05336000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 05337000
*   /* BASE VOLUME RECORD PTR IN BCDVPTR                     @Y30LB25*/ 05338000
*   /* COPY VOLUME RECORD PTR IN BCDVPTR                     @Y30LB25*/ 05339000
*   /* DUPLICATE VOLUME RECORD PTR IN BCDVPTR                @Y30LB25*/ 05340000
*   /*                                                       @Y30LB25*/ 05341000
*   /* OUTPUT -                                              @Y30LB25*/ 05342000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 05343000
*   /*                                                               */ 05344000
*   /*****************************************************************/ 05345000
*                                                                  1481 05346000
*CRT2CIR:                           /*                       @Y30LB25*/ 05347000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 05348000
*                                                                  1481 05349000
CRT2CIR  ST    @14,@SA00026                                        1481 05350000
*   /*****************************************************************/ 05351000
*   /*                                                               */ 05352000
*   /* CHECK FOR CREATE A CIR FOR CSN1                       @Y30LB25*/ 05353000
*   /*                                                               */ 05354000
*   /*****************************************************************/ 05355000
*                                                                  1482 05356000
*   CSNUMBER=ON;                    /* CSN1                  @Y30LB25*/ 05357000
         OI    CSNUMBER,B'00000100'                                1482 05358000
*   CALL VUCIR;                     /*                       @Y30LB25   05359000
*                                      CREATE CIR FOR        @Y30LB25   05360000
*                                      CSN1                  @Y30LB25*/ 05361000
         BAL   @14,VUCIR                                           1483 05362000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 05363000
*     THEN                          /* ERROR                 @Y30LB25*/ 05364000
         LH    @08,RPLVRETC(,RPLVPTR)                              1484 05365000
         N     @08,@CF00815                                        1484 05366000
         LTR   @08,@08                                             1484 05367000
         BZ    @RF01484                                            1484 05368000
*     DO;                           /*                       @Y30LB25*/ 05369000
*       CALL PLIBMSG;               /* MSG TO LIBRARIAN      @Y30LB25*/ 05370000
         BAL   @14,PLIBMSG                                         1486 05371000
*       RETURN;                     /*                       @Y30LB25*/ 05372000
@EL00026 DS    0H                                                  1487 05373000
@EF00026 DS    0H                                                  1487 05374000
@ER00026 L     @14,@SA00026                                        1487 05375000
         BR    @14                                                 1487 05376000
*     END;                          /*                       @Y30LB25*/ 05377000
*                                                                  1488 05378000
*   /*****************************************************************/ 05379000
*   /*                                                               */ 05380000
*   /* CHECK FOR CREATE A CIR FOR CSN2                       @Y30LB25*/ 05381000
*   /*                                                               */ 05382000
*   /*****************************************************************/ 05383000
*                                                                  1489 05384000
*   CSNUMBER=OFF;                   /* CSN2                  @Y30LB25*/ 05385000
@RF01484 NI    CSNUMBER,B'11111011'                                1489 05386000
*   CALL VUCIR;                     /*                       @Y30LB25   05387000
*                                      CREATE CIR FOR        @Y30LB25   05388000
*                                      CSN2                  @Y30LB25*/ 05389000
         BAL   @14,VUCIR                                           1490 05390000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 05391000
*     THEN                          /* ERROR                 @Y30LB25*/ 05392000
         LH    @08,RPLVRETC(,RPLVPTR)                              1491 05393000
         N     @08,@CF00815                                        1491 05394000
         LTR   @08,@08                                             1491 05395000
         BZ    @RF01491                                            1491 05396000
*     CALL PLIBMSG;                 /* MSG TO LIBRARIAN      @Y30LB25*/ 05397000
         BAL   @14,PLIBMSG                                         1492 05398000
*   RETURN;                         /*                       @Y30LB25*/ 05399000
         B     @EL00026                                            1493 05400000
*   END CRT2CIR;                    /*                       @Y30LB25*/ 05401000
         B     @EL00026                                            1494 05402000
*                                                                  1495 05403000
*   /*****************************************************************/ 05404000
*   /*                                                               */ 05405000
*   /* ENTRY NAME - ICBVUCIR                                 @Y30LB25*/ 05406000
*   /*                                                       @Y30LB25*/ 05407000
*   /* FUNCTION - CREATE, UPDATE, AND WRITE A CIR FOR THE    @Y30LB25*/ 05408000
*   /* BVR OR CVR OR DVR ASSOCIATED WITH THE INPUT           @Y30LB25*/ 05409000
*   /* CSN AND VOLID. VVIC. DATA SET MUST BE RESERVED BY     @Y30LB25*/ 05410000
*   /* THE CALLER.                                           @Y30LB25*/ 05411000
*   /*                                                       @Y30LB25*/ 05412000
*   /* INPUT -                                               @Y30LB25*/ 05413000
*   /* MSVC REQUEST PARAMETER LIST PTR IN RPLVPTR            @Y30LB25*/ 05414000
*   /* BASE VOLUME RECORD PTR IN BCDVPTR                     @Y30LB25*/ 05415000
*   /* COPY VOLUME RECORD PTR IN BCDVPTR                     @Y30LB25*/ 05416000
*   /* DUPLICATE VOLUME RECORD PTR IN BCDVPTR                @Y30LB25*/ 05417000
*   /* FLAG IN PASSBYTE                                      @Y30LB25*/ 05418000
*   /*                                                       @Y30LB25*/ 05419000
*   /* OUTPUT -                                              @Y30LB25*/ 05420000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 05421000
*   /* MSVC REQUEST PARAMETER - RETURN CODE IF               @Y30LB25*/ 05422000
*   /* AN ERROR                                              @Y30LB25*/ 05423000
*   /*                                                               */ 05424000
*   /*****************************************************************/ 05425000
*                                                                  1495 05426000
*ICBVUCIR:                          /*                       @Y30LB25*/ 05427000
*   ENTRY(PTRBCDV,PTRRPLV,PASSBYTE);/*                       @Y30LB25*/ 05428000
*                                                                  1495 05429000
@EP01495 MVC   @PC00001(12),0(@01)                                 1495 05430000
*   /*****************************************************************/ 05431000
*   /*                                                               */ 05432000
*   /* DECLARES FOR PASSED PARAMETERS                        @Y30LB25*/ 05433000
*   /*                                                               */ 05434000
*   /*****************************************************************/ 05435000
*                                                                  1496 05436000
*   DCL                                                            1496 05437000
*     PTRBCDV PTR(31);              /* PTR TO BVR, CVR,      @Y30LB25   05438000
*                                      OR DVR                @Y30LB25*/ 05439000
*   DCL                                                            1497 05440000
*     PTRRPLV PTR(31);              /* RPLV PTR              @Y30LB25*/ 05441000
*   DCL                                                            1498 05442000
*     PASSBYTE CHAR(2);             /* CSN NUMBER            @Y30LB25*/ 05443000
*                                                                  1499 05444000
*   /*****************************************************************/ 05445000
*   /*                                                               */ 05446000
*   /* INITIALIZE                                            @Y30LB25*/ 05447000
*   /*                                                               */ 05448000
*   /*****************************************************************/ 05449000
*                                                                  1499 05450000
*   BCDVPTR=PTRBCDV;                /* SET RECORD PTR        @Y30LB25*/ 05451000
         L     @08,@PC00001                                        1499 05452000
         L     @08,PTRBCDV(,@08)                                   1499 05453000
         ST    @08,BCDVPTR                                         1499 05454000
*   RPLVPTR=PTRRPLV;                /* SET RPLV PTR          @Y30LB25*/ 05455000
         L     @08,@PC00001+4                                      1500 05456000
         L     RPLVPTR,PTRRPLV(,@08)                               1500 05457000
*   WORKAREA=WORKAREA&&WORKAREA;    /* ZERO WORK AREA        @Y30LB25*/ 05458000
         XC    WORKAREA(19),WORKAREA                               1501 05459000
*   BYTEPASS=PASSBYTE;              /* GET CSN # FLAG        #Y30LB25*/ 05460000
         L     @08,@PC00001+8                                      1502 05461000
         MVC   BYTEPASS(2),PASSBYTE(@08)                           1502 05462000
*   GROUPPTR=ADDR(GROUPBUF);        /* ADDR GRP BUF          @Y30LB25*/ 05463000
         LA    @08,GROUPBUF                                        1503 05464000
         ST    @08,GROUPPTR                                        1503 05465000
*   COPYVPTR=ADDR(COPYBUF);         /* ADDR CVR BUF          @Y30LB25*/ 05466000
         LA    COPYVPTR,COPYBUF                                    1504 05467000
*   BASEVPTR=ADDR(BASEBUF);         /* ADDR BVR BUF          @Y30LB25*/ 05468000
         LA    @08,BASEBUF                                         1505 05469000
         ST    @08,BASEVPTR                                        1505 05470000
*   INDEXPTR=ADDR(INDEXBUF);        /* ADDR CIR BUF          @Y30LB25*/ 05471000
         LA    INDEXPTR,INDEXBUF                                   1506 05472000
*   DUPVPTR=ADDR(DUPVBUF);          /* ADDR DUP BUF          @Y30LB25*/ 05473000
         LA    @08,DUPVBUF                                         1507 05474000
         ST    @08,DUPVPTR                                         1507 05475000
*   DIDKY=FIXONE;                   /* SET DVR KEY ID        @Y30LB25*/ 05476000
         MVI   DIDKY,X'01'                                         1508 05477000
*   CIDKY=FIXONE;                   /* SET CVR KEY ID        @Y30LB25*/ 05478000
         MVI   CIDKY,X'01'                                         1509 05479000
*   CALL VUCIR;                     /* PROCESS CIR           #Y30LB25*/ 05480000
         BAL   @14,VUCIR                                           1510 05481000
*   RETURN;                         /*                       #Y30LB25*/ 05482000
         B     @EL00001                                            1511 05483000
*                                                                  1512 05484000
*   /*****************************************************************/ 05485000
*   /*                                                               */ 05486000
*   /* PROCEDURE VUCIR IS CODED SO THAT COMMON ENTRY         @Y30LB25*/ 05487000
*   /* CODE IN ICBVUCIR CAN BE USED BY THIS MODULE           @Y30LB25*/ 05488000
*   /* AND BY OTHER MODULES. OTHER MODULES CALL              @Y30LB25*/ 05489000
*   /* ENTRY ICBVUCIR. THIS MODULE CALLS PROCEDURE           @Y30LB25*/ 05490000
*   /* VUCIR.                                                @Y30LB25*/ 05491000
*   /*                                                               */ 05492000
*   /*****************************************************************/ 05493000
*                                                                  1512 05494000
*VUCIR:                             /*                       @Y30LB25*/ 05495000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 05496000
*                                                                  1512 05497000
VUCIR    ST    @14,@SA00027                                        1512 05498000
*   /*****************************************************************/ 05499000
*   /*                                                               */ 05500000
*   /* CREATE A CIR FOR CSN1 OR CSN2                         @Y30LB25*/ 05501000
*   /*                                                               */ 05502000
*   /*****************************************************************/ 05503000
*                                                                  1513 05504000
*   INDEXBUF=INDEXBUF&&INDEXBUF;    /* ZERO CIR BUFFER       @Y30LB25*/ 05505000
         XC    INDEXBUF(36),INDEXBUF                               1513 05506000
*   IF CSNUMBER=ON                  /* CSN1?                 @Y30LB25*/ 05507000
*     THEN                          /* YES                   @Y30LB25*/ 05508000
         TM    CSNUMBER,B'00000100'                                1514 05509000
         BNO   @RF01514                                            1514 05510000
*     INDSERNO=BCDCSN1;             /* CIR FOR CSN1          @Y30LB25*/ 05511000
         L     @08,BCDVPTR                                         1515 05512000
         MVC   INDSERNO(12,INDEXPTR),BCDCSN1(@08)                  1515 05513000
*   ELSE                            /* CSN2                  @Y30LB25*/ 05514000
*     INDSERNO=BCDCSN2;             /* CIR FOR CSN2          @Y30LB25*/ 05515000
         B     @RC01514                                            1516 05516000
@RF01514 L     @08,BCDVPTR                                         1516 05517000
         MVC   INDSERNO(12,INDEXPTR),BCDCSN2(@08)                  1516 05518000
*   INDI=I;                         /* SET CIR INDECATOR     @Y30LB25*/ 05519000
@RC01514 MVI   INDI(INDEXPTR),C'I'                                 1517 05520000
*   INDINDEX=ON;                    /* CIR FLAG SET ON       @Y30LB25*/ 05521000
         OI    INDINDEX(INDEXPTR),B'00001000'                      1518 05522000
*   INDRECKY=BCDNAME;               /* BVR, CVR, DVR KEY     @Y30LB25*/ 05523000
*                                                                  1519 05524000
         L     @08,BCDVPTR                                         1519 05525000
         MVC   INDRECKY(13,INDEXPTR),BCDNAME(@08)                  1519 05526000
*   /*****************************************************************/ 05527000
*   /*                                                               */ 05528000
*   /* WRITE THE CIR                                         @Y30LB25*/ 05529000
*   /*                                                               */ 05530000
*   /*****************************************************************/ 05531000
*                                                                  1520 05532000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/ 05533000
         LA    @08,36                                              1520 05534000
         ST    @08,RPLVBLN(,RPLVPTR)                               1520 05535000
*   RPLVRLN=LENGTH(INDEXBUF);       /* CIR LENGTH            @Y30LB25*/ 05536000
         ST    @08,RPLVRLN(,RPLVPTR)                               1521 05537000
*   RPLVBUF=INDEXPTR;               /* ADDR OF CIR BUF       @Y30LB25*/ 05538000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1522 05539000
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/ 05540000
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1523 05541000
*   RPLVTYP=RPLVPUT;                /* PUT NEW RECORD        @Y30LB25*/ 05542000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1524 05543000
*   RESPECIFY                       /*                       @Y30LB25*/ 05544000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05545000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 05546000
         LR    RG1,RPLVPTR                                         1526 05547000
*   CALL ICBVIO00;                  /* WRITE CIR             @Y30LB25*/ 05548000
         L     @15,@CV00610                                        1527 05549000
         BALR  @14,@15                                             1527 05550000
*   RESPECIFY                       /*                       @Y30LB25*/ 05551000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05552000
*   IF RPLRCODE=IOERROR|RPLVRETC=FIXZERO/* CK CONDITIONS     @Y30LB25*/ 05553000
*     THEN                          /*                       @Y30LB25*/ 05554000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1529 05555000
         BE    @RT01529                                            1529 05556000
         LH    @08,RPLVRETC(,RPLVPTR)                              1529 05557000
         N     @08,@CF00815                                        1529 05558000
         LTR   @08,@08                                             1529 05559000
         BZ    @RT01529                                            1529 05560000
*     RETURN;                       /*                       @Y30LB25*/ 05561000
*                                                                  1530 05562000
*   /*****************************************************************/ 05563000
*   /*                                                               */ 05564000
*   /* CIR ALREADY EXISTS                                    @Y30LB25*/ 05565000
*   /* GET THE CIR                                           @Y30LB25*/ 05566000
*   /*                                                               */ 05567000
*   /*****************************************************************/ 05568000
*                                                                  1531 05569000
*   RPLRCODE=RPLRCODE&&RPLRCODE;    /* ZERO REASON CODE      @Y30LB25*/ 05570000
         XC    RPLRCODE(2,RPLVPTR),RPLRCODE(RPLVPTR)               1531 05571000
*   RPLVRETC=RPLVRETC&&RPLVRETC;    /* ZERO RETURN CODE      @Y30LB25*/ 05572000
         XC    RPLVRETC(2,RPLVPTR),RPLVRETC(RPLVPTR)               1532 05573000
*   IVOLKY=INDSERNO;                /* SET SERIAL NUM        @VS32198*/ 05574000
         MVC   IVOLKY(12),INDSERNO(INDEXPTR)                       1533 05575000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 05576000
         LA    @08,IKEY                                            1534 05577000
         ST    @08,RPLVKEY(,RPLVPTR)                               1534 05578000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 05579000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1535 05580000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 05581000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1536 05582000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 05583000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1537 05584000
*   RESPECIFY                       /*                       @Y30LB25*/ 05585000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05586000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 05587000
         LR    RG1,RPLVPTR                                         1539 05588000
*   CALL ICBVIO00;                  /* READ FOR CIR          @Y30LB25*/ 05589000
         L     @15,@CV00610                                        1540 05590000
         BALR  @14,@15                                             1540 05591000
*   RESPECIFY                       /*                       @Y30LB25*/ 05592000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05593000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 05594000
*     THEN                          /* ERROR                 @Y30LB25*/ 05595000
         LH    @08,RPLVRETC(,RPLVPTR)                              1542 05596000
         N     @08,@CF00815                                        1542 05597000
         LTR   @08,@08                                             1542 05598000
         BNZ   @RT01542                                            1542 05599000
*     RETURN;                       /*                       @Y30LB25*/ 05600000
*                                                                  1543 05601000
*   /*****************************************************************/ 05602000
*   /*                                                               */ 05603000
*   /* CHECK IF THE CIR IS FOR THE CORRECT RECORD            @Y30LB25*/ 05604000
*   /*                                                               */ 05605000
*   /*****************************************************************/ 05606000
*                                                                  1544 05607000
*   IF INDRECKY=BCDNAME             /* CIR EXISTS WITH       @Y30LB25*/ 05608000
*     THEN                          /* CORRECT VOLID?        @Y30LB25*/ 05609000
         L     @08,BCDVPTR                                         1544 05610000
         CLC   INDRECKY(13,INDEXPTR),BCDNAME(@08)                  1544 05611000
         BE    @RT01544                                            1544 05612000
*     RETURN;                       /* YES                   @Y30LB25*/ 05613000
*                                                                  1545 05614000
*   /*****************************************************************/ 05615000
*   /*                                                               */ 05616000
*   /* CIR IS FOR THE WRONG RECORD, DELETE THE CIR           @Y30LB25*/ 05617000
*   /*                                                               */ 05618000
*   /*****************************************************************/ 05619000
*                                                                  1546 05620000
*   RPLVDIR=OFF;                    /* NO DIRECT             @Y30LB25*/ 05621000
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1546 05622000
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/ 05623000
         MVI   RPLVTYP(RPLVPTR),X'05'                              1547 05624000
*   RESPECIFY                       /*                       @Y30LB25*/ 05625000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05626000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 05627000
         LR    RG1,RPLVPTR                                         1549 05628000
*   CALL ICBVIO00;                  /* DELETE CIR            @Y30LB25*/ 05629000
         L     @15,@CV00610                                        1550 05630000
         BALR  @14,@15                                             1550 05631000
*   RESPECIFY                       /*                       @Y30LB25*/ 05632000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05633000
*   IF RPLVRETC^=FIXZERO            /* CK RETURN CODE        @Y30LB25*/ 05634000
*     THEN                          /* ERROR                 @Y30LB25*/ 05635000
         LH    @08,RPLVRETC(,RPLVPTR)                              1552 05636000
         N     @08,@CF00815                                        1552 05637000
         LTR   @08,@08                                             1552 05638000
         BNZ   @RT01552                                            1552 05639000
*     RETURN;                       /*                       @Y30LB25*/ 05640000
*                                                                  1553 05641000
*   /*****************************************************************/ 05642000
*   /*                                                               */ 05643000
*   /* CHECK IF CIR WAS FOR A DVR                            @Y30LB25*/ 05644000
*   /*                                                               */ 05645000
*   /*****************************************************************/ 05646000
*                                                                  1554 05647000
*   IF INDALPHA=D                   /* DVR?                  @Y30LB25*/ 05648000
*     THEN                          /* YES                   @Y30LB25*/ 05649000
         CLI   INDALPHA(INDEXPTR),C'D'                             1554 05650000
         BNE   @RF01554                                            1554 05651000
*     DO;                           /*                       @Y30LB25*/ 05652000
*       CALL FIXDVR;                /* CORRECT DVR           @Y30LB25*/ 05653000
         BAL   @14,FIXDVR                                          1556 05654000
*       RETURN;                     /*                       @Y30LB25*/ 05655000
@EL00027 DS    0H                                                  1557 05656000
@EF00027 DS    0H                                                  1557 05657000
@ER00027 L     @14,@SA00027                                        1557 05658000
         BR    @14                                                 1557 05659000
*     END;                          /*                       @Y30LB25*/ 05660000
*   ELSE                            /* BVR OR CVR?           @Y30LB25*/ 05661000
*                                                                  1559 05662000
*     /***************************************************************/ 05663000
*     /*                                                             */ 05664000
*     /* CHECK IF CIR WAS FOR A BVR                          @Y30LB25*/ 05665000
*     /*                                                             */ 05666000
*     /***************************************************************/ 05667000
*                                                                  1559 05668000
*     IF INDEXREC=FIXZERO           /* BVR?                  @Y30LB25*/ 05669000
*       THEN                        /* YES                   @Y30LB25*/ 05670000
@RF01554 CLI   INDEXREC(INDEXPTR),0                                1559 05671000
         BNE   @RF01559                                            1559 05672000
*       DO;                         /*                       @Y30LB25*/ 05673000
*         CALL FIXBVR;              /* CORRECT BVR           @Y30LB25*/ 05674000
         BAL   @14,FIXBVR                                          1561 05675000
*         RETURN;                   /*                       @Y30LB25*/ 05676000
         B     @EL00027                                            1562 05677000
*       END;                        /*                       @Y30LB25*/ 05678000
*     ELSE                          /* IS A CVR              @Y30LB25*/ 05679000
*                                                                  1564 05680000
*       /*************************************************************/ 05681000
*       /*                                                           */ 05682000
*       /* CHECK IF CIR WAS FOR A CVR                        @Y30LB25*/ 05683000
*       /*                                                           */ 05684000
*       /*************************************************************/ 05685000
*                                                                  1564 05686000
*       DO;                         /*                       @Y30LB25*/ 05687000
@RF01559 DS    0H                                                  1565 05688000
*         CALL FIXCVR;              /* CORRECT CVR           @Y30LB25*/ 05689000
         BAL   @14,FIXCVR                                          1565 05690000
*         RETURN;                   /*                       @Y30LB25*/ 05691000
         B     @EL00027                                            1566 05692000
*       END;                        /*                       @Y30LB25*/ 05693000
*   END VUCIR;                      /*                       @Y30LB25*/ 05694000
         B     @EL00027                                            1568 05695000
*                                                                  1569 05696000
*   /*****************************************************************/ 05697000
*   /*                                                               */ 05698000
*   /* PROCEDURE NAME - FIXDVR                               @Y30LB25*/ 05699000
*   /*                                                       @Y30LB25*/ 05700000
*   /* FUNCTION - DELETE THE DVR. DELETE THE CIR FOR THE     @Y30LB25*/ 05701000
*   /* OTHER CSN IN THE DVR IF ONE EXISTS AND POINTS         @Y30LB25*/ 05702000
*   /* TO THIS DELETED DVR. WRITE THE NEWLY CREATED CIR.     @Y30LB25*/ 05703000
*   /*                                                       @Y30LB25*/ 05704000
*   /* INPUT -                                               @Y30LB25*/ 05705000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 05706000
*   /* DUPLICATE VOLUME RECORD                               @Y30LB25*/ 05707000
*   /*                                                       @Y30LB25*/ 05708000
*   /* OUTPUT -                                              @Y30LB25*/ 05709000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 05710000
*   /*                                                               */ 05711000
*   /*****************************************************************/ 05712000
*                                                                  1569 05713000
*FIXDVR:                            /*                       @Y30LB25*/ 05714000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 05715000
*                                                                  1569 05716000
FIXDVR   ST    @14,@SA00028                                        1569 05717000
*   /*****************************************************************/ 05718000
*   /*                                                               */ 05719000
*   /* GET THE DVR                                           @Y30LB25*/ 05720000
*   /*                                                               */ 05721000
*   /*****************************************************************/ 05722000
*                                                                  1570 05723000
*   DKEY=INDRECKY;                  /* SET RECD KEY          @Y30LB25*/ 05724000
         MVC   DKEY(13),INDRECKY(INDEXPTR)                         1570 05725000
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/ 05726000
         LA    @08,DKEY                                            1571 05727000
         ST    @08,RPLVKEY(,RPLVPTR)                               1571 05728000
*   RPLVBUF=ADDR(BCDRECBF);         /* PTR TO BUFFER         @Y30LB25*/ 05729000
         LA    @08,BCDRECBF                                        1572 05730000
         ST    @08,RPLVBUF(,RPLVPTR)                               1572 05731000
*   RPLVBLN=LENGTH(BCDRECBF);       /* DVR BUFFER LENGTH     @Y30LB25*/ 05732000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1573 05733000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 05734000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1574 05735000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 05736000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1575 05737000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 05738000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1576 05739000
*   RESPECIFY                       /*                       @Y30LB25*/ 05740000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05741000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 05742000
         LR    RG1,RPLVPTR                                         1578 05743000
*   CALL ICBVIO00;                  /* READ DVR              @Y30LB25*/ 05744000
         L     @15,@CV00610                                        1579 05745000
         BALR  @14,@15                                             1579 05746000
*   RESPECIFY                       /*                       @Y30LB25*/ 05747000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05748000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/ 05749000
*     THEN                          /* ERROR                 @Y30LB25*/ 05750000
         LH    @08,RPLVRETC(,RPLVPTR)                              1581 05751000
         N     @08,@CF00815                                        1581 05752000
         LTR   @08,@08                                             1581 05753000
         BNZ   @RT01581                                            1581 05754000
*     RETURN;                       /*                       @Y30LB25*/ 05755000
*                                                                  1582 05756000
*   /*****************************************************************/ 05757000
*   /*                                                               */ 05758000
*   /* DELETE THE DVR                                        @Y30LB25*/ 05759000
*   /*                                                               */ 05760000
*   /*****************************************************************/ 05761000
*                                                                  1583 05762000
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/ 05763000
         MVI   RPLVTYP(RPLVPTR),X'05'                              1583 05764000
*   RESPECIFY                       /*                       @Y30LB25*/ 05765000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05766000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 05767000
         LR    RG1,RPLVPTR                                         1585 05768000
*   CALL ICBVIO00;                  /* DELETE DVR            @Y30LB25*/ 05769000
         L     @15,@CV00610                                        1586 05770000
         BALR  @14,@15                                             1586 05771000
*   RESPECIFY                       /*                       @Y30LB25*/ 05772000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05773000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/ 05774000
*     THEN                          /* ERROR                 @Y30LB25*/ 05775000
         LH    @08,RPLVRETC(,RPLVPTR)                              1588 05776000
         N     @08,@CF00815                                        1588 05777000
         LTR   @08,@08                                             1588 05778000
         BNZ   @RT01588                                            1588 05779000
*     RETURN;                       /*                       @Y30LB25*/ 05780000
*                                                                  1589 05781000
*   /*****************************************************************/ 05782000
*   /*                                                               */ 05783000
*   /* GET THE OTHER CIR FOR THE CSN                         @Y30LB25*/ 05784000
*   /*                                                               */ 05785000
*   /*****************************************************************/ 05786000
*                                                                  1590 05787000
*   BCDTEMP=DUPVPTR;                /* SAVE DVR PTR          @Y30LB25*/ 05788000
         L     BCDTEMP,DUPVPTR                                     1590 05789000
*   DUPVPTR=ADDR(BCDRECBF);         /* DVR MAPPING           @Y30LB25*/ 05790000
         LA    @08,BCDRECBF                                        1591 05791000
         ST    @08,DUPVPTR                                         1591 05792000
*   IF DUPCSN1^=INDSERNO            /* FIND CORRECT CSN      @Y30LB25*/ 05793000
*     THEN                          /*                       @Y30LB25*/ 05794000
         CLC   DUPCSN1(12,@08),INDSERNO(INDEXPTR)                  1592 05795000
         BE    @RF01592                                            1592 05796000
*     IVOLKY=DUPCSN1;               /* KEY OF OTHER CSN      @Y30LB25*/ 05797000
         MVC   IVOLKY(12),DUPCSN1(@08)                             1593 05798000
*   ELSE                            /*                       @Y30LB25*/ 05799000
*     IVOLKY=DUPCSN2;               /* KEY OF OTHER CSN      @Y30LB25*/ 05800000
         B     @RC01592                                            1594 05801000
@RF01592 L     @08,DUPVPTR                                         1594 05802000
         MVC   IVOLKY(12),DUPCSN2(@08)                             1594 05803000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 05804000
@RC01592 LA    @08,IKEY                                            1595 05805000
         ST    @08,RPLVKEY(,RPLVPTR)                               1595 05806000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/ 05807000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1596 05808000
*   RPLVBUF=INDEXPTR;               /* ADDR OF CIR BUF       @Y30LB25*/ 05809000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1597 05810000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 05811000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1598 05812000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 05813000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1599 05814000
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB25*/ 05815000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1600 05816000
*   RESPECIFY                       /*                       @Y30LB25*/ 05817000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05818000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 05819000
         LR    RG1,RPLVPTR                                         1602 05820000
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/ 05821000
         L     @15,@CV00610                                        1603 05822000
         BALR  @14,@15                                             1603 05823000
*   RESPECIFY                       /*                       @Y30LB25*/ 05824000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05825000
*   IF RPLVRETC^=FIXZERO            /* I/O ERROR OR NO       @Y30LB25*/ 05826000
*     THEN                          /* CIR EXISTS            @Y30LB25*/ 05827000
         LH    @08,RPLVRETC(,RPLVPTR)                              1605 05828000
         N     @08,@CF00815                                        1605 05829000
         LTR   @08,@08                                             1605 05830000
         BNZ   @RT01605                                            1605 05831000
*     RETURN;                       /*                       @Y30LB25*/ 05832000
*                                                                  1606 05833000
*   /*****************************************************************/ 05834000
*   /*                                                               */ 05835000
*   /* CHECK IF THE CIR IS FOR THE CORRECT RECORD            @Y30LB25*/ 05836000
*   /*                                                               */ 05837000
*   /*****************************************************************/ 05838000
*                                                                  1607 05839000
*   IF INDRECKY=DUPNAME             /* PT TO RIGHT           @Y30LB25*/ 05840000
*     THEN                          /* RECORD?               @Y30LB25*/ 05841000
         L     @08,DUPVPTR                                         1607 05842000
         CLC   INDRECKY(13,INDEXPTR),DUPNAME(@08)                  1607 05843000
         BNE   @RF01607                                            1607 05844000
*     DO;                           /* YES                   @Y30LB25*/ 05845000
*                                                                  1608 05846000
*       /*************************************************************/ 05847000
*       /*                                                           */ 05848000
*       /* DELETE THE CIR                                    @Y30LB25*/ 05849000
*       /*                                                           */ 05850000
*       /*************************************************************/ 05851000
*                                                                  1609 05852000
*       RPLVTYP=RPLVDEL;            /* DELETE                @Y30LB25*/ 05853000
         MVI   RPLVTYP(RPLVPTR),X'05'                              1609 05854000
*       RPLVDIR=OFF;                /* NO DIRECT             @Y30LB25*/ 05855000
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1610 05856000
*       RESPECIFY                   /*                       @Y30LB25*/ 05857000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 05858000
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/ 05859000
         LR    RG1,RPLVPTR                                         1612 05860000
*       CALL ICBVIO00;              /* DELETE CIR            @Y30LB25*/ 05861000
         L     @15,@CV00610                                        1613 05862000
         BALR  @14,@15                                             1613 05863000
*       RESPECIFY                   /*                       @Y30LB25*/ 05864000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 05865000
*       IF RPLVRETC^=FIXZERO        /* CK RETN CODE          @Y30LB25*/ 05866000
*         THEN                      /* ERROR                 @Y30LB25*/ 05867000
         LH    @08,RPLVRETC(,RPLVPTR)                              1615 05868000
         N     @08,@CF00815                                        1615 05869000
         LTR   @08,@08                                             1615 05870000
         BNZ   @RT01615                                            1615 05871000
*         RETURN;                   /*                       @Y30LB25*/ 05872000
*     END;                          /*                       @Y30LB25*/ 05873000
*                                                                  1617 05874000
*   /*****************************************************************/ 05875000
*   /*                                                               */ 05876000
*   /* NOW CREATE THE CIR, ONE WILL NOT EXIST                @Y30LB25*/ 05877000
*   /*                                                               */ 05878000
*   /*****************************************************************/ 05879000
*                                                                  1618 05880000
*   DUPVPTR=BCDTEMP;                /* RESTORE DVR PTR       @Y30LB25*/ 05881000
@RF01607 ST    BCDTEMP,DUPVPTR                                     1618 05882000
*   CALL CWCIR;                     /* CREATE/WRITE          @Y30LB25   05883000
*                                      NEW CIR               @Y30LB25*/ 05884000
         BAL   @14,CWCIR                                           1619 05885000
*   RETURN;                         /*                       @Y30LB25*/ 05886000
@EL00028 DS    0H                                                  1620 05887000
@EF00028 DS    0H                                                  1620 05888000
@ER00028 L     @14,@SA00028                                        1620 05889000
         BR    @14                                                 1620 05890000
*   END FIXDVR;                     /*                       @Y30LB25*/ 05891000
         B     @EL00028                                            1621 05892000
*                                                                  1622 05893000
*   /*****************************************************************/ 05894000
*   /*                                                               */ 05895000
*   /* PROCEDURE NAME - FIXCVR                               @Y30LB25*/ 05896000
*   /*                                                       @Y30LB25*/ 05897000
*   /* FUNCTION - DELETE THE CVR. DELETE THE CIR FOR THE     @Y30LB25*/ 05898000
*   /* OTHER CSN IN THE CVR IF ONE EXISTS AND POINTS         @Y30LB25*/ 05899000
*   /* TO THIS DELETED CVR. WRITE THE NEWLY CREATED CIR.     @Y30LB25*/ 05900000
*   /* UPDATE THE BVR OF THE DELETED CVR.                    @Y30LB25*/ 05901000
*   /*                                                       @Y30LB25*/ 05902000
*   /* INPUT -                                               @Y30LB25*/ 05903000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 05904000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 05905000
*   /*                                                       @Y30LB25*/ 05906000
*   /* OUTPUT -                                              @Y30LB25*/ 05907000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 05908000
*   /*                                                               */ 05909000
*   /*****************************************************************/ 05910000
*                                                                  1622 05911000
*FIXCVR:                            /*                       @Y30LB25*/ 05912000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 05913000
*                                                                  1622 05914000
FIXCVR   ST    @14,@SA00029                                        1622 05915000
*   /*****************************************************************/ 05916000
*   /*                                                               */ 05917000
*   /* GET THE CVR                                           @Y30LB25*/ 05918000
*   /*                                                               */ 05919000
*   /*****************************************************************/ 05920000
*                                                                  1623 05921000
*   CKEY=INDRECKY;                  /* SET RECD KEY          @Y30LB25*/ 05922000
         MVC   CKEY(13),INDRECKY(INDEXPTR)                         1623 05923000
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF CVR KEY       @Y30LB25*/ 05924000
         LA    @08,CKEY                                            1624 05925000
         ST    @08,RPLVKEY(,RPLVPTR)                               1624 05926000
*   RPLVBUF=COPYVPTR;               /* PTR TO BUFFER         @Y30LB25*/ 05927000
         ST    COPYVPTR,RPLVBUF(,RPLVPTR)                          1625 05928000
*   RPLVBLN=LENGTH(COPYBUF);        /* CVR BUFFER LENGTH     @Y30LB25*/ 05929000
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1626 05930000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 05931000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1627 05932000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 05933000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1628 05934000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 05935000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1629 05936000
*   RESPECIFY                       /*                       @Y30LB25*/ 05937000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05938000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 05939000
         LR    RG1,RPLVPTR                                         1631 05940000
*   CALL ICBVIO00;                  /* READ CVR              @Y30LB25*/ 05941000
         L     @15,@CV00610                                        1632 05942000
         BALR  @14,@15                                             1632 05943000
*   RESPECIFY                       /*                       @Y30LB25*/ 05944000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05945000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/ 05946000
*     THEN                          /* ERROR                 @Y30LB25*/ 05947000
         LH    @08,RPLVRETC(,RPLVPTR)                              1634 05948000
         N     @08,@CF00815                                        1634 05949000
         LTR   @08,@08                                             1634 05950000
         BNZ   @RT01634                                            1634 05951000
*     RETURN;                       /*                       @Y30LB25*/ 05952000
*                                                                  1635 05953000
*   /*****************************************************************/ 05954000
*   /*                                                               */ 05955000
*   /* DELETE THE CVR                                        @Y30LB25*/ 05956000
*   /*                                                               */ 05957000
*   /*****************************************************************/ 05958000
*                                                                  1636 05959000
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/ 05960000
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1636 05961000
*   RPLVTYP=RPLVDEL;                /* DELETE                @Y30LB25*/ 05962000
         MVI   RPLVTYP(RPLVPTR),X'05'                              1637 05963000
*   RESPECIFY                       /*                       @Y30LB25*/ 05964000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 05965000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 05966000
         LR    RG1,RPLVPTR                                         1639 05967000
*   CALL ICBVIO00;                  /* DELETE CVR            @Y30LB25*/ 05968000
         L     @15,@CV00610                                        1640 05969000
         BALR  @14,@15                                             1640 05970000
*   RESPECIFY                       /*                       @Y30LB25*/ 05971000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 05972000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/ 05973000
*     THEN                          /* ERROR                 @Y30LB25*/ 05974000
         LH    @08,RPLVRETC(,RPLVPTR)                              1642 05975000
         N     @08,@CF00815                                        1642 05976000
         LTR   @08,@08                                             1642 05977000
         BNZ   @RT01642                                            1642 05978000
*     RETURN;                       /*                       @Y30LB25*/ 05979000
*                                                                  1643 05980000
*   /*****************************************************************/ 05981000
*   /*                                                               */ 05982000
*   /* UPDATE CVR'S BVR                                      @Y30LB25*/ 05983000
*   /*                                                               */ 05984000
*   /*****************************************************************/ 05985000
*                                                                  1644 05986000
*   ADDSUB=OFF;                     /* REMOVE CVR            @Y30LB25*/ 05987000
         NI    ADDSUB,B'10111111'                                  1644 05988000
*   CALL PBVR1;                     /* UPDATE CVR'S BVR      @Y30LB25*/ 05989000
         BAL   @14,PBVR1                                           1645 05990000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/ 05991000
*     THEN                          /* ERROR                 @Y30LB25*/ 05992000
         LH    @08,RPLVRETC(,RPLVPTR)                              1646 05993000
         N     @08,@CF00815                                        1646 05994000
         LTR   @08,@08                                             1646 05995000
         BNZ   @RT01646                                            1646 05996000
*     RETURN;                       /*                       @Y30LB25*/ 05997000
*                                                                  1647 05998000
*   /*****************************************************************/ 05999000
*   /*                                                               */ 06000000
*   /* GET THE CIR                                           @Y30LB25*/ 06001000
*   /*                                                               */ 06002000
*   /*****************************************************************/ 06003000
*                                                                  1648 06004000
*   IF COPCSN1^=INDSERNO            /* FIND CORRECT CSN      @Y30LB25*/ 06005000
*     THEN                          /*                       @Y30LB25*/ 06006000
         CLC   COPCSN1(12,COPYVPTR),INDSERNO(INDEXPTR)             1648 06007000
         BE    @RF01648                                            1648 06008000
*     IVOLKY=COPCSN1;               /* KEY OF OTHER CSN      @Y30LB25*/ 06009000
         MVC   IVOLKY(12),COPCSN1(COPYVPTR)                        1649 06010000
*   ELSE                            /*                       @Y30LB25*/ 06011000
*     IVOLKY=COPCSN2;               /* KEY OF OTHER CSN      @Y30LB25*/ 06012000
         B     @RC01648                                            1650 06013000
@RF01648 MVC   IVOLKY(12),COPCSN2(COPYVPTR)                        1650 06014000
*   RPLVKEY=ADDR(IKEY);             /* ADDR OF KEY           @Y30LB25*/ 06015000
@RC01648 LA    @08,IKEY                                            1651 06016000
         ST    @08,RPLVKEY(,RPLVPTR)                               1651 06017000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/ 06018000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1652 06019000
*   RPLVBUF=INDEXPTR;               /* ADDR OF CIR BUF       @Y30LB25*/ 06020000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1653 06021000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 06022000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1654 06023000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 06024000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1655 06025000
*   RPLVTYP=RPLVREAD;               /* READ RECORD           @Y30LB25*/ 06026000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1656 06027000
*   RESPECIFY                       /*                       @Y30LB25*/ 06028000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 06029000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 06030000
         LR    RG1,RPLVPTR                                         1658 06031000
*   CALL ICBVIO00;                  /* READ CIR              @Y30LB25*/ 06032000
         L     @15,@CV00610                                        1659 06033000
         BALR  @14,@15                                             1659 06034000
*   RESPECIFY                       /*                       @Y30LB25*/ 06035000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 06036000
*   IF RPLVRETC^=FIXZERO            /* I/O ERROR OR NO       @Y30LB25*/ 06037000
*     THEN                          /* CIR EXISTS            @Y30LB25*/ 06038000
         LH    @08,RPLVRETC(,RPLVPTR)                              1661 06039000
         N     @08,@CF00815                                        1661 06040000
         LTR   @08,@08                                             1661 06041000
         BNZ   @RT01661                                            1661 06042000
*     RETURN;                       /*                       @Y30LB25*/ 06043000
*                                                                  1662 06044000
*   /*****************************************************************/ 06045000
*   /*                                                               */ 06046000
*   /* CHECK THAT CIR POINTS TO CORRECT MSVC RECORD          @Y30LB25*/ 06047000
*   /*                                                               */ 06048000
*   /*****************************************************************/ 06049000
*                                                                  1663 06050000
*   IF INDRECKY=COPNAME             /* PT TO RIGHT           @Y30LB25*/ 06051000
*     THEN                          /* RECORD?               @Y30LB25*/ 06052000
         CLC   INDRECKY(13,INDEXPTR),COPNAME(COPYVPTR)             1663 06053000
         BNE   @RF01663                                            1663 06054000
*     DO;                           /* YES                   @Y30LB25*/ 06055000
*                                                                  1664 06056000
*       /*************************************************************/ 06057000
*       /*                                                           */ 06058000
*       /* CORRECT CIR - DELETE IT                           @Y30LB25*/ 06059000
*       /*                                                           */ 06060000
*       /*************************************************************/ 06061000
*                                                                  1665 06062000
*       RPLVTYP=RPLVDEL;            /* DELETE                @Y30LB25*/ 06063000
         MVI   RPLVTYP(RPLVPTR),X'05'                              1665 06064000
*       RPLVDIR=OFF;                /* NO DIRECT             @Y30LB25*/ 06065000
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1666 06066000
*       RESPECIFY                   /*                       @Y30LB25*/ 06067000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 06068000
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/ 06069000
         LR    RG1,RPLVPTR                                         1668 06070000
*       CALL ICBVIO00;              /* DELETE CIR            @Y30LB25*/ 06071000
         L     @15,@CV00610                                        1669 06072000
         BALR  @14,@15                                             1669 06073000
*       RESPECIFY                   /*                       @Y30LB25*/ 06074000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 06075000
*       IF RPLVRETC^=FIXZERO        /* CK RETN CODE          @Y30LB25*/ 06076000
*         THEN                      /* ERROR                 @Y30LB25*/ 06077000
         LH    @08,RPLVRETC(,RPLVPTR)                              1671 06078000
         N     @08,@CF00815                                        1671 06079000
         LTR   @08,@08                                             1671 06080000
         BNZ   @RT01671                                            1671 06081000
*         RETURN;                   /*                       @Y30LB25*/ 06082000
*     END;                          /*                       @Y30LB25*/ 06083000
*                                                                  1673 06084000
*   /*****************************************************************/ 06085000
*   /*                                                               */ 06086000
*   /* NOW CREATE THE CIR, ONE WILL NOT EXIST                @Y30LB25*/ 06087000
*   /*                                                               */ 06088000
*   /*****************************************************************/ 06089000
*                                                                  1674 06090000
*   CALL CWCIR;                     /* CREATE/WRITE          @Y30LB25   06091000
*                                      NEW CIR               @Y30LB25*/ 06092000
@RF01663 BAL   @14,CWCIR                                           1674 06093000
*   RETURN;                         /*                       @Y30LB25*/ 06094000
@EL00029 DS    0H                                                  1675 06095000
@EF00029 DS    0H                                                  1675 06096000
@ER00029 L     @14,@SA00029                                        1675 06097000
         BR    @14                                                 1675 06098000
*   END FIXCVR;                     /*                       @Y30LB25*/ 06099000
         B     @EL00029                                            1676 06100000
*                                                                  1677 06101000
*   /*****************************************************************/ 06102000
*   /*                                                               */ 06103000
*   /* ENTRY NAME - ICBVUBVR                                 @Y30LB25*/ 06104000
*   /*                                                       @Y30LB25*/ 06105000
*   /* FUNCTION - UPDATE THE NUMBER OF BACKUP COPIES OR      @Y30LB25*/ 06106000
*   /* THE NUMBER OF COPIES, AND IF NECESSARY THE KEY        @Y30LB25*/ 06107000
*   /* OF THE LATEST COPY IN THE BVR.                        @Y30LB25*/ 06108000
*   /* WITH ADDSUB OF THE CALLER MUST FIRST DELETE           @Y30LB25*/ 06109000
*   /* THE CVR.                                              @Y30LB25*/ 06110000
*   /*                                                       @Y30LB25*/ 06111000
*   /* INPUT -                                               @Y30LB25*/ 06112000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 06113000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 06114000
*   /*                                                       @Y30LB25*/ 06115000
*   /* OUTPUT -                                              @Y30LB25*/ 06116000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 06117000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 06118000
*   /*                                                               */ 06119000
*   /*****************************************************************/ 06120000
*                                                                  1677 06121000
*ICBVUBVR:                          /*                       @Y30LB25*/ 06122000
*   ENTRY(PTRCOPYV,PTRRPLV,PASSBYTE);/*                      @Y30LB25*/ 06123000
*                                                                  1677 06124000
@EP01677 MVC   @PC00001+12(4),0(@01)                               1677 06125000
         MVC   @PC00001+4(8),4(@01)                                1677 06126000
*   /*****************************************************************/ 06127000
*   /*                                                               */ 06128000
*   /* DECLARES FOR PASSED PARAMETERS                        @Y30LB25*/ 06129000
*   /* PTRRPLV AND PASSBYTE ARE DECLARED IN ICBVUCIR.        @Y30LB25*/ 06130000
*   /* PASSBTYE IS USED TO DETERMINE ADD OR SUBTRACT.        @Y30LB25*/ 06131000
*   /*                                                               */ 06132000
*   /*****************************************************************/ 06133000
*                                                                  1678 06134000
*   DCL                                                            1678 06135000
*     PTRCOPYV PTR(31);             /* PTR TO CVR            @Y30LB25*/ 06136000
*   DCL                                                            1679 06137000
*     SAVCVRPT PTR(31);             /* SAVE CVR BUF PTR      @Y30LB25*/ 06138000
*   COPYVPTR=PTRCOPYV;              /* SET CVR PTR           @Y30LB25*/ 06139000
         L     @08,@PC00001+12                                     1680 06140000
         L     COPYVPTR,PTRCOPYV(,@08)                             1680 06141000
*   RPLVPTR=PTRRPLV;                /* SET RPLV PTR          @Y30LB25*/ 06142000
         L     @08,@PC00001+4                                      1681 06143000
         L     RPLVPTR,PTRRPLV(,@08)                               1681 06144000
*   BYTEPASS=PASSBYTE;              /* GET CSN # FLAG        @Y30LB25*/ 06145000
         L     @08,@PC00001+8                                      1682 06146000
         MVC   BYTEPASS(2),PASSBYTE(@08)                           1682 06147000
*   CIDKY=FIXONE;                   /* SET KEY ID            @Y30LB25*/ 06148000
         MVI   CIDKY,X'01'                                         1683 06149000
*   CALL PBVR1;                     /* PROCESS BVR           @Y30LB25*/ 06150000
         BAL   @14,PBVR1                                           1684 06151000
*   RETURN;                         /*                       @Y30LB25*/ 06152000
         B     @EL00001                                            1685 06153000
*                                                                  1686 06154000
*   /*****************************************************************/ 06155000
*   /*                                                               */ 06156000
*   /* PROCEDURE PBVR1 IS CODED SO THAT COMMON ENTRY         @Y30LB25*/ 06157000
*   /* CODE IN ICBVUBVR CAN BE USED BY THIS MODULE           @Y30LB25*/ 06158000
*   /* AND BY OTHER MODULES. OTHER MODULES CALL              @Y30LB25*/ 06159000
*   /* ENTRY ICBVUBVR. THIS MODULE CALLS PROCEDURE           @Y30LB25*/ 06160000
*   /* PBVR1.                                                @Y30LB25*/ 06161000
*   /*                                                               */ 06162000
*   /*****************************************************************/ 06163000
*                                                                  1686 06164000
*PBVR1:                             /*                       @Y30LB25*/ 06165000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 06166000
*                                                                  1686 06167000
PBVR1    ST    @14,@SA00030                                        1686 06168000
*   /*****************************************************************/ 06169000
*   /*                                                               */ 06170000
*   /* GET THE BVR                                           @Y30LB25*/ 06171000
*   /*                                                               */ 06172000
*   /*****************************************************************/ 06173000
*                                                                  1687 06174000
*   SAVCVRPT=COPYVPTR;              /* SAVE CVR BUF PTR      @Y30LB25*/ 06175000
         LR    SAVCVRPT,COPYVPTR                                   1687 06176000
*   BVOLKY=COPSERNO;                /* SET VOLID IN KEY      @Y30LB25*/ 06177000
         MVC   BVOLKY(6),COPSERNO(COPYVPTR)                        1688 06178000
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/ 06179000
         LA    @04,BKEY                                            1689 06180000
         ST    @04,RPLVKEY(,RPLVPTR)                               1689 06181000
*   RPLVBUF=ADDR(BCDRECBF);         /* SET BUFFER PTR        @Y30LB25*/ 06182000
         LA    @04,BCDRECBF                                        1690 06183000
         ST    @04,RPLVBUF(,RPLVPTR)                               1690 06184000
*   RPLVBLN=LENGTH(BCDRECBF);       /* BVR BUFFER LENGTH     @Y30LB25*/ 06185000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1691 06186000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 06187000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1692 06188000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 06189000
*   RPLVLOC=OFF;                    /* NO LOCATE READ        @Y30LB25*/ 06190000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1694 06191000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1694 06192000
*   RPLVUPD=ON;                     /* UPDATE ON             @Y30LB25*/ 06193000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1695 06194000
*   RESPECIFY                       /*                       @Y30LB25*/ 06195000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 06196000
*   RG1=RPLVPTR;                    /* PTR TO RPLV           @Y30LB25*/ 06197000
         LR    RG1,RPLVPTR                                         1697 06198000
*   CALL ICBVIO00;                  /* READ BVR              @Y30LB25*/ 06199000
         L     @15,@CV00610                                        1698 06200000
         BALR  @14,@15                                             1698 06201000
*   RESPECIFY                       /*                       @Y30LB25*/ 06202000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 06203000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/ 06204000
*     THEN                          /* ERROR                 @Y30LB25*/ 06205000
         LH    @04,RPLVRETC(,RPLVPTR)                              1700 06206000
         N     @04,@CF00815                                        1700 06207000
         LTR   @04,@04                                             1700 06208000
         BNZ   @RT01700                                            1700 06209000
*     RETURN;                       /*                       @Y30LB25*/ 06210000
*                                                                  1701 06211000
*   /*****************************************************************/ 06212000
*   /*                                                               */ 06213000
*   /* SET NUMBER OF COPIES AND/OR BACKUPS                   @Y30LB25*/ 06214000
*   /*                                                               */ 06215000
*   /*****************************************************************/ 06216000
*                                                                  1702 06217000
*   BCDTEMP=BASEVPTR;               /* SAVE BVR PTR          @Y30LB25   06218000
*                                      FOR INTERNAL CALL     @Y30LB25*/ 06219000
         L     BCDTEMP,BASEVPTR                                    1702 06220000
*   BASEVPTR=ADDR(BCDRECBF);        /* BVR MAPPING           @Y30LB25*/ 06221000
         LA    @04,BCDRECBF                                        1703 06222000
         ST    @04,BASEVPTR                                        1703 06223000
*   IF COPBKUP=ON&ADDSUB=OFF        /* DELETE BKUP CVR?      @Y30LB25*/ 06224000
*     THEN                          /* YES                   @Y30LB25*/ 06225000
         TM    COPBKUP(COPYVPTR),B'00001000'                       1704 06226000
         BNO   @RF01704                                            1704 06227000
         TM    ADDSUB,B'01000000'                                  1704 06228000
         BNZ   @RF01704                                            1704 06229000
*     DO;                           /*                       @Y30LB25*/ 06230000
*       BASNBKUP=BASNBKUP-FIXONE;   /* DECREM BKUP CNT       @Y30LB25*/ 06231000
         SLR   @15,@15                                             1706 06232000
         IC    @15,BASNBKUP(,@04)                                  1706 06233000
         BCTR  @15,0                                               1706 06234000
         STC   @15,BASNBKUP(,@04)                                  1706 06235000
*       BASNCOPY=BASNCOPY-FIXONE;   /* DECREM COPY CNT       @Y30LB25*/ 06236000
         SLR   @15,@15                                             1707 06237000
         IC    @15,BASNCOPY(,@04)                                  1707 06238000
         BCTR  @15,0                                               1707 06239000
         STC   @15,BASNCOPY(,@04)                                  1707 06240000
*     END;                          /*                       @Y30LB25*/ 06241000
*   ELSE                            /*                       @Y30LB25*/ 06242000
*     IF ADDSUB=OFF                 /* DELETE CVR?           @Y30LB25*/ 06243000
*       THEN                        /* YES                   @Y30LB25*/ 06244000
         B     @RC01704                                            1709 06245000
@RF01704 TM    ADDSUB,B'01000000'                                  1709 06246000
         BNZ   @RF01709                                            1709 06247000
*       BASNCOPY=BASNCOPY-FIXONE;   /* DECREM COPY CNT       @Y30LB25*/ 06248000
         L     @04,BASEVPTR                                        1710 06249000
         SLR   @15,@15                                             1710 06250000
         IC    @15,BASNCOPY(,@04)                                  1710 06251000
         BCTR  @15,0                                               1710 06252000
         STC   @15,BASNCOPY(,@04)                                  1710 06253000
*   IF COPBKUP=ON&ADDSUB=ON         /* ADD BKUP CVR?         @Y30LB25*/ 06254000
*     THEN                          /* YES                   @Y30LB25*/ 06255000
@RF01709 DS    0H                                                  1711 06256000
@RC01704 TM    COPBKUP(COPYVPTR),B'00001000'                       1711 06257000
         BNO   @RF01711                                            1711 06258000
         TM    ADDSUB,B'01000000'                                  1711 06259000
         BNO   @RF01711                                            1711 06260000
*     DO;                           /*                       @Y30LB25*/ 06261000
*       BASNBKUP=BASNBKUP+FIXONE;   /* INCREM BKUP CNT       @Y30LB25*/ 06262000
         L     @04,BASEVPTR                                        1713 06263000
         LA    @15,1                                               1713 06264000
         SLR   @14,@14                                             1713 06265000
         IC    @14,BASNBKUP(,@04)                                  1713 06266000
         ALR   @14,@15                                             1713 06267000
         STC   @14,BASNBKUP(,@04)                                  1713 06268000
*       BASNCOPY=BASNCOPY+FIXONE;   /* INCREM COPY CNT       @Y30LB25*/ 06269000
         SLR   @14,@14                                             1714 06270000
         IC    @14,BASNCOPY(,@04)                                  1714 06271000
         ALR   @15,@14                                             1714 06272000
         STC   @15,BASNCOPY(,@04)                                  1714 06273000
*       BASKLCPY=COPNAME;           /* NEW LATEST COPY       @Y30LB25*/ 06274000
         MVC   BASKLCPY(13,@04),COPNAME(COPYVPTR)                  1715 06275000
*     END;                          /*                       @Y30LB25*/ 06276000
*   ELSE                            /*                       @Y30LB25*/ 06277000
*     IF ADDSUB=ON                  /* ADD CVR?              @Y30LB25*/ 06278000
*       THEN                        /* YES                   @Y30LB25*/ 06279000
         B     @RC01711                                            1717 06280000
@RF01711 TM    ADDSUB,B'01000000'                                  1717 06281000
         BNO   @RF01717                                            1717 06282000
*       DO;                         /*                       @Y30LB25*/ 06283000
*         BASNCOPY=BASNCOPY+FIXONE; /* INCREM COPY CNT       @Y30LB25*/ 06284000
         L     @04,BASEVPTR                                        1719 06285000
         LA    @15,1                                               1719 06286000
         SLR   @14,@14                                             1719 06287000
         IC    @14,BASNCOPY(,@04)                                  1719 06288000
         ALR   @15,@14                                             1719 06289000
         STC   @15,BASNCOPY(,@04)                                  1719 06290000
*         BASKLCPY=COPNAME;         /* NEW LATEST COPY       @Y30LB25*/ 06291000
         MVC   BASKLCPY(13,@04),COPNAME(COPYVPTR)                  1720 06292000
*       END;                        /*                       @Y30LB25*/ 06293000
*   IF BASNCOPY=FIXZERO             /* ANY COPIES?           @Y30LB25*/ 06294000
*     THEN                          /* NO                    @Y30LB25*/ 06295000
@RF01717 DS    0H                                                  1722 06296000
@RC01711 L     @04,BASEVPTR                                        1722 06297000
         CLI   BASNCOPY(@04),0                                     1722 06298000
         BNE   @RF01722                                            1722 06299000
*     BASKLCPY=BLANK13;             /* NO LATEST COPY        @Y30LB25*/ 06300000
*                                                                  1723 06301000
         MVC   BASKLCPY(13,@04),@CC00575                           1723 06302000
*   /*****************************************************************/ 06303000
*   /*                                                               */ 06304000
*   /* WRITE THE BVR                                         @Y30LB25*/ 06305000
*   /*                                                               */ 06306000
*   /*****************************************************************/ 06307000
*                                                                  1724 06308000
*   RPLVTYP=RPLVPUT;                /* SET PUT ON            @Y30LB25*/ 06309000
@RF01722 MVI   RPLVTYP(RPLVPTR),X'01'                              1724 06310000
*   RESPECIFY                       /*                       @Y30LB25*/ 06311000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 06312000
*   RG1=RPLVPTR;                    /* RPLV ADDR             @Y30LB25*/ 06313000
         LR    RG1,RPLVPTR                                         1726 06314000
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/ 06315000
         L     @15,@CV00610                                        1727 06316000
         BALR  @14,@15                                             1727 06317000
*   RESPECIFY                       /*                       @Y30LB25*/ 06318000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 06319000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/ 06320000
*     THEN                          /* ERROR                 @Y30LB25*/ 06321000
         LH    @04,RPLVRETC(,RPLVPTR)                              1729 06322000
         N     @04,@CF00815                                        1729 06323000
         LTR   @04,@04                                             1729 06324000
         BNZ   @RT01729                                            1729 06325000
*     RETURN;                       /*                       @Y30LB25*/ 06326000
*                                                                  1730 06327000
*   /*****************************************************************/ 06328000
*   /*                                                               */ 06329000
*   /* CHECK IF A LATEST COPY WAS DELETED                    @Y30LB25*/ 06330000
*   /*                                                               */ 06331000
*   /*****************************************************************/ 06332000
*                                                                  1731 06333000
*   IF ADDSUB=OFF&BASNCOPY^=FIXZERO&/* WAS LATEST COPY       @Y30LB25*/ 06334000
*       COPNAME=BASKLCPY            /* DELETED?              @VS32198*/ 06335000
*     THEN                          /* YES                   @Y30LB25*/ 06336000
         TM    ADDSUB,B'01000000'                                  1731 06337000
         BNZ   @RF01731                                            1731 06338000
         L     @04,BASEVPTR                                        1731 06339000
         CLI   BASNCOPY(@04),0                                     1731 06340000
         BE    @RF01731                                            1731 06341000
         CLC   COPNAME(13,COPYVPTR),BASKLCPY(@04)                  1731 06342000
         BNE   @RF01731                                            1731 06343000
*     CALL LCVRKY;                  /* UPDATE LATEST COPY    @Y30LB25*/ 06344000
         BAL   @14,LCVRKY                                          1732 06345000
*   BASEVPTR=BCDTEMP;               /* RESTORE BVR PTR       @Y30LB25   06346000
*                                      FOR INTERNAL CALL     @Y30LB25*/ 06347000
@RF01731 ST    BCDTEMP,BASEVPTR                                    1733 06348000
*   RETURN;                         /*                       @Y30LB25*/ 06349000
@EL00030 DS    0H                                                  1734 06350000
@EF00030 DS    0H                                                  1734 06351000
@ER00030 L     @14,@SA00030                                        1734 06352000
         BR    @14                                                 1734 06353000
*   END PBVR1;                      /*                       @Y30LB25*/ 06354000
         B     @EL00030                                            1735 06355000
*                                                                  1736 06356000
*   /*****************************************************************/ 06357000
*   /*                                                               */ 06358000
*   /* PROCEDURE NAME - LCVRKY                               @Y30LB25*/ 06359000
*   /*                                                       @Y30LB25*/ 06360000
*   /* FUNCTION - FIND THE NEW LATEST CVR AND PLACE          @Y30LB25*/ 06361000
*   /* ITS KEY INTO THE BVR.                                 @Y30LB25*/ 06362000
*   /* THE OLD LATEST CVR MUST HAVE BEEN DELETED.            @Y30LB25*/ 06363000
*   /* (OLD LATEST CVR IS IN THE CVR BUFFER AND ITS KEY      @Y30LB25*/ 06364000
*   /* IS SET UP FOR A READ. ALSO, THE UPDATED BVR IS        @Y30LB25*/ 06365000
*   /* IN ITS BUFFER AND ITS KEY IS SET UP FOR A READ.)      @Y30LB25*/ 06366000
*   /*                                                       @Y30LB25*/ 06367000
*   /* INPUT -                                               @Y30LB25*/ 06368000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 06369000
*   /* COPY VOLUME RECORD                                    @Y30LB25*/ 06370000
*   /*                                                       @Y30LB25*/ 06371000
*   /* OUTPUT -                                              @Y30LB25*/ 06372000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 06373000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 06374000
*   /*                                                               */ 06375000
*   /*****************************************************************/ 06376000
*                                                                  1736 06377000
*LCVRKY:                            /*                       @Y30LB25*/ 06378000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 06379000
*                                                                  1736 06380000
LCVRKY   ST    @14,@SA00031                                        1736 06381000
*   /*****************************************************************/ 06382000
*   /*                                                               */ 06383000
*   /* FIND THE NEW LATEST CVR KEY                           @Y30LB25*/ 06384000
*   /*                                                               */ 06385000
*   /*****************************************************************/ 06386000
*                                                                  1737 06387000
*   CKEY=COPNAME;                   /* SET CVR KEY           @Y30LB25*/ 06388000
         MVC   CKEY(13),COPNAME(COPYVPTR)                          1737 06389000
*   RPLVKEY=ADDR(CKEY);             /* ADDR OF CVR KEY       @Y30LB25*/ 06390000
         LA    @04,CKEY                                            1738 06391000
         ST    @04,RPLVKEY(,RPLVPTR)                               1738 06392000
*   RPLVDIR=ON;                     /* READ DIRECT           @Y30LB25*/ 06393000
*   RPLVLOC=ON;                     /* READ LOCATE           @Y30LB25*/ 06394000
         OI    RPLVDIR(RPLVPTR),B'11000000'                        1740 06395000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 06396000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1741 06397000
*   RPLVUPD=OFF;                    /* NO READ FOR UPDATE    @Y30LB25*/ 06398000
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1742 06399000
*   RESPECIFY                       /*                       @Y30LB25*/ 06400000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 06401000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 06402000
         LR    RG1,RPLVPTR                                         1744 06403000
*   DO WHILE CIDKY>1;               /* FIND LATEST CVR       @Y30LB25*/ 06404000
         B     @DE01745                                            1745 06405000
@DL01745 DS    0H                                                  1746 06406000
*     CIDKY=CIDKY-FIXONE;           /* LOOP CONTROL          @Y30LB25*/ 06407000
         SLR   @04,@04                                             1746 06408000
         IC    @04,CIDKY                                           1746 06409000
         BCTR  @04,0                                               1746 06410000
         STC   @04,CIDKY                                           1746 06411000
*     CALL ICBVIO00;                /* READ CVR              @Y30LB25*/ 06412000
         L     @15,@CV00610                                        1747 06413000
         BALR  @14,@15                                             1747 06414000
*     IF RPLRCODE=IOERROR           /* CHECK RETURN CODE     @Y30LB25*/ 06415000
*       THEN                        /* ERROR                 @Y30LB25*/ 06416000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1748 06417000
         BE    @RT01748                                            1748 06418000
*       RETURN;                     /*                       @Y30LB25*/ 06419000
*     IF RPLVRETC=FIXZERO           /* CVR FOUND?            @Y30LB25*/ 06420000
*       THEN                        /* YES                   @Y30LB25*/ 06421000
         LH    @04,RPLVRETC(,RPLVPTR)                              1750 06422000
         N     @04,@CF00815                                        1750 06423000
         LTR   @04,@04                                             1750 06424000
         BNZ   @RF01750                                            1750 06425000
*       CIDKY=FIXZERO;              /* LOOP CONTROL          @Y30LB25*/ 06426000
         MVI   CIDKY,X'00'                                         1751 06427000
*   END;                            /*                       @Y30LB25*/ 06428000
@RF01750 DS    0H                                                  1752 06429000
@DE01745 CLI   CIDKY,1                                             1752 06430000
         BH    @DL01745                                            1752 06431000
*   RESPECIFY                       /*                       @Y30LB25*/ 06432000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 06433000
*                                                                  1753 06434000
*   /*****************************************************************/ 06435000
*   /*                                                               */ 06436000
*   /* LASTEST CVR KEY WAS FOUND                             @Y30LB25*/ 06437000
*   /*                                                               */ 06438000
*   /*****************************************************************/ 06439000
*                                                                  1754 06440000
*   IF CIDKY=FIXZERO                /* LATEST CVR FOUND?     @Y30LB25*/ 06441000
*     THEN                          /* YES                   @Y30LB25*/ 06442000
         CLI   CIDKY,0                                             1754 06443000
         BNE   @RF01754                                            1754 06444000
*     DO;                           /*                       @Y30LB25*/ 06445000
*                                                                  1755 06446000
*       /*************************************************************/ 06447000
*       /*                                                           */ 06448000
*       /* GET THE BVR'S CVR                                 @Y30LB25*/ 06449000
*       /*                                                           */ 06450000
*       /*************************************************************/ 06451000
*                                                                  1756 06452000
*       COPYVPTR=RPLVBUF;           /* PT TO LATEST CVR      @Y30LB25*/ 06453000
         L     COPYVPTR,RPLVBUF(,RPLVPTR)                          1756 06454000
*       TEMPCKEY=COPNAME;           /* GET KEY               @Y30LB25*/ 06455000
         MVC   TEMPCKEY(13),COPNAME(COPYVPTR)                      1757 06456000
*       COPYVPTR=SAVCVRPT;          /* MAPPING OF CVR        @Y30LB25*/ 06457000
         LR    COPYVPTR,SAVCVRPT                                   1758 06458000
*       RPLVKEY=ADDR(BKEY);         /* ADDR OF KEY           @Y30LB25*/ 06459000
         LA    @08,BKEY                                            1759 06460000
         ST    @08,RPLVKEY(,RPLVPTR)                               1759 06461000
*       RPLVBUF=ADDR(BCDRECBF);     /* SET BUFFER PTR        @Y30LB25*/ 06462000
         LA    @08,BCDRECBF                                        1760 06463000
         ST    @08,RPLVBUF(,RPLVPTR)                               1760 06464000
*       RPLVBLN=LENGTH(BCDRECBF);   /* BVR BUFFER LENGTH     @Y30LB25*/ 06465000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1761 06466000
*       RPLVLOC=OFF;                /* LOCATE OFF            @Y30LB25*/ 06467000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1762 06468000
*       RPLVUPD=ON;                 /* READ FOR UPDATE       @Y30LB25*/ 06469000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1763 06470000
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/ 06471000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1764 06472000
*       RESPECIFY                   /*                       @Y30LB25*/ 06473000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 06474000
*       RG1=RPLVPTR;                /* PTR TO RPLV           @Y30LB25*/ 06475000
         LR    RG1,RPLVPTR                                         1766 06476000
*       CALL ICBVIO00;              /* READ BVR              @Y30LB25*/ 06477000
         L     @15,@CV00610                                        1767 06478000
         BALR  @14,@15                                             1767 06479000
*       RESPECIFY                   /*                       @Y30LB25*/ 06480000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 06481000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/ 06482000
*         THEN                      /* ERROR                 @Y30LB25*/ 06483000
         LH    @08,RPLVRETC(,RPLVPTR)                              1769 06484000
         N     @08,@CF00815                                        1769 06485000
         LTR   @08,@08                                             1769 06486000
         BNZ   @RT01769                                            1769 06487000
*         RETURN;                   /*                       @Y30LB25*/ 06488000
*                                                                  1770 06489000
*       /*************************************************************/ 06490000
*       /*                                                           */ 06491000
*       /* UPDATE THE KEY OF THE LATEST CVR IN THE BVR       @Y30LB25*/ 06492000
*       /*                                                           */ 06493000
*       /*************************************************************/ 06494000
*                                                                  1771 06495000
*       BASKLCPY=TEMPCKEY;          /* NEW LATEST COPY       @Y30LB25*/ 06496000
*                                                                  1771 06497000
         L     @08,BASEVPTR                                        1771 06498000
         MVC   BASKLCPY(13,@08),TEMPCKEY                           1771 06499000
*       /*************************************************************/ 06500000
*       /*                                                           */ 06501000
*       /* WRITE THE BVR                                     @Y30LB25*/ 06502000
*       /*                                                           */ 06503000
*       /*************************************************************/ 06504000
*                                                                  1772 06505000
*       RPLVTYP=RPLVPUT;            /* SET PUT ON            @Y30LB25*/ 06506000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1772 06507000
*       RESPECIFY                   /*                       @Y30LB25*/ 06508000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 06509000
*       RG1=RPLVPTR;                /* SET PTR TO RPLV       @Y30LB25*/ 06510000
         LR    RG1,RPLVPTR                                         1774 06511000
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/ 06512000
         L     @15,@CV00610                                        1775 06513000
         BALR  @14,@15                                             1775 06514000
*       RESPECIFY                   /*                       @Y30LB25*/ 06515000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 06516000
*     END;                          /*                       @Y30LB25*/ 06517000
*   RETURN;                         /*                       @Y30LB25*/ 06518000
@EL00031 DS    0H                                                  1778 06519000
@EF00031 DS    0H                                                  1778 06520000
@ER00031 L     @14,@SA00031                                        1778 06521000
         BR    @14                                                 1778 06522000
*   END LCVRKY;                     /*                       @Y30LB25*/ 06523000
         B     @EL00031                                            1779 06524000
*                                                                  1780 06525000
*   /*****************************************************************/ 06526000
*   /*                                                               */ 06527000
*   /* PROCEDURE NAME - FIXBVR                               @Y30LB25*/ 06528000
*   /*                                                       @Y30LB25*/ 06529000
*   /* FUNCTION - FOR BVR WITH NO COPIES, DELETE IT.         @Y30LB25*/ 06530000
*   /* IF GROUPED, GET GVR, UPDATE IT AND CHAIN THE          @Y30LB25*/ 06531000
*   /* BVR OUT OF THE GVR.                                   @Y30LB25*/ 06532000
*   /* WRITE THE NEWLY CREATE CIR.                           @Y30LB25*/ 06533000
*   /* ALSO, IF IT EXISTS MAKE A DVR INTO A BVR.             @Y30LB25*/ 06534000
*   /* FOR A BVR WITH COPIES, INDICATE CSNS AS BEING         @Y30LB25*/ 06535000
*   /* REASSIGNED, AND WRITE THE BVR.                        @Y30LB25*/ 06536000
*   /* WRITE THE NEWLY CREATED CIR.                          @Y30LB25*/ 06537000
*   /*                                                       @Y30LB25*/ 06538000
*   /* INPUT -                                               @Y30LB25*/ 06539000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 06540000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 06541000
*   /*                                                       @Y30LB25*/ 06542000
*   /* OUTPUT -                                              @Y30LB25*/ 06543000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 06544000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 06545000
*   /*                                                               */ 06546000
*   /*****************************************************************/ 06547000
*                                                                  1780 06548000
*FIXBVR:                            /*                       @Y30LB25*/ 06549000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 06550000
*                                                                  1780 06551000
FIXBVR   ST    @14,@SA00032                                        1780 06552000
*   /*****************************************************************/ 06553000
*   /*                                                               */ 06554000
*   /* GET THE BVR                                           @Y30LB25*/ 06555000
*   /*                                                               */ 06556000
*   /*****************************************************************/ 06557000
*                                                                  1781 06558000
*   BKEY=INDRECKY;                  /* SET RECD KEY          @Y30LB25*/ 06559000
         MVC   BKEY(13),INDRECKY(INDEXPTR)                         1781 06560000
*   RPLVKEY=ADDR(BKEY);             /* ADDR OF KEY           @Y30LB25*/ 06561000
         LA    @08,BKEY                                            1782 06562000
         ST    @08,RPLVKEY(,RPLVPTR)                               1782 06563000
*   RPLVBUF=ADDR(BCDRECBF);         /* PTR TO BUFFER         @Y30LB25*/ 06564000
         LA    @08,BCDRECBF                                        1783 06565000
         ST    @08,RPLVBUF(,RPLVPTR)                               1783 06566000
*   RPLVBLN=LENGTH(BCDRECBF);       /* BVR BUFFER LENGTH     @Y30LB25*/ 06567000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1784 06568000
*   RPLVTYP=RPLVREAD;               /* READ                  @Y30LB25*/ 06569000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1785 06570000
*   RPLVDIR=ON;                     /* DIRECT                @Y30LB25*/ 06571000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1786 06572000
*   RPLVUPD=ON;                     /* UPDATE                @Y30LB25*/ 06573000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1787 06574000
*   RESPECIFY                       /*                       @Y30LB25*/ 06575000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 06576000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 06577000
         LR    RG1,RPLVPTR                                         1789 06578000
*   CALL ICBVIO00;                  /* READ BVR              @Y30LB25*/ 06579000
         L     @15,@CV00610                                        1790 06580000
         BALR  @14,@15                                             1790 06581000
*   RESPECIFY                       /*                       @Y30LB25*/ 06582000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 06583000
*   IF RPLVRETC^=FIXZERO            /* CHECK RETN CODE       @Y30LB25*/ 06584000
*     THEN                          /* ERROR                 @Y30LB25*/ 06585000
         LH    @08,RPLVRETC(,RPLVPTR)                              1792 06586000
         N     @08,@CF00815                                        1792 06587000
         LTR   @08,@08                                             1792 06588000
         BNZ   @RT01792                                            1792 06589000
*     RETURN;                       /*                       @Y30LB25*/ 06590000
*   BCDTEMP=BASEVPTR;               /* SAVE BVR PTR          @Y30LB25*/ 06591000
         L     BCDTEMP,BASEVPTR                                    1794 06592000
*   BASEVPTR=ADDR(BCDRECBF);        /* BVR                   @Y30LB25*/ 06593000
*                                                                  1795 06594000
         LA    @08,BCDRECBF                                        1795 06595000
         ST    @08,BASEVPTR                                        1795 06596000
*   /*****************************************************************/ 06597000
*   /*                                                               */ 06598000
*   /* CHECK FOR COPIES                                      @Y30LB25*/ 06599000
*   /*                                                               */ 06600000
*   /*****************************************************************/ 06601000
*                                                                  1796 06602000
*   IF BASNCOPY=FIXZERO             /* ANY COPIES?           @Y30LB25*/ 06603000
*     THEN                          /* NO                    @Y30LB25*/ 06604000
         CLI   BASNCOPY(@08),0                                     1796 06605000
         BNE   @RF01796                                            1796 06606000
*     DO;                           /*                       @Y30LB25*/ 06607000
*                                                                  1797 06608000
*       /*************************************************************/ 06609000
*       /*                                                           */ 06610000
*       /* NO COPIES, DELETE THE BVR                         @Y30LB25*/ 06611000
*       /*                                                           */ 06612000
*       /*************************************************************/ 06613000
*                                                                  1798 06614000
*       RPLVTYP=RPLVDEL;            /* DELETE                @Y30LB25*/ 06615000
         MVI   RPLVTYP(RPLVPTR),X'05'                              1798 06616000
*       RESPECIFY                   /*                       @Y30LB25*/ 06617000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 06618000
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/ 06619000
         LR    RG1,RPLVPTR                                         1800 06620000
*       CALL ICBVIO00;              /* DELETE BVR            @Y30LB25*/ 06621000
         L     @15,@CV00610                                        1801 06622000
         BALR  @14,@15                                             1801 06623000
*       RESPECIFY                   /*                       @Y30LB25*/ 06624000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 06625000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/ 06626000
*         THEN                      /* ERROR                 @Y30LB25*/ 06627000
         LH    @08,RPLVRETC(,RPLVPTR)                              1803 06628000
         N     @08,@CF00815                                        1803 06629000
         LTR   @08,@08                                             1803 06630000
         BNZ   @RT01803                                            1803 06631000
*         RETURN;                   /*                       @Y30LB25*/ 06632000
*                                                                  1804 06633000
*       /*************************************************************/ 06634000
*       /*                                                           */ 06635000
*       /* GET THE CIR FOR THE CORRECT CSN                   @Y30LB25*/ 06636000
*       /*                                                           */ 06637000
*       /*************************************************************/ 06638000
*                                                                  1805 06639000
*       IF BASCSN1^=INDSERNO        /* FIND CORRECT CSN      @Y30LB25*/ 06640000
*         THEN                      /*                       @Y30LB25*/ 06641000
         L     @08,BASEVPTR                                        1805 06642000
         CLC   BASCSN1(12,@08),INDSERNO(INDEXPTR)                  1805 06643000
         BE    @RF01805                                            1805 06644000
*         IVOLKY=BASCSN1;           /* KEY OF CSN            @Y30LB25*/ 06645000
         MVC   IVOLKY(12),BASCSN1(@08)                             1806 06646000
*       ELSE                        /*                       @Y30LB25*/ 06647000
*         IVOLKY=BASCSN2;           /* KEY OF OTHER CSN      @Y30LB25*/ 06648000
         B     @RC01805                                            1807 06649000
@RF01805 L     @08,BASEVPTR                                        1807 06650000
         MVC   IVOLKY(12),BASCSN2(@08)                             1807 06651000
*       RPLVKEY=ADDR(IKEY);         /* ADDR OF KEY           @Y30LB25*/ 06652000
@RC01805 LA    @08,IKEY                                            1808 06653000
         ST    @08,RPLVKEY(,RPLVPTR)                               1808 06654000
*       RPLVBLN=LENGTH(INDEXBUF);   /* CIR BUFFER LENGTH     @Y30LB25*/ 06655000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1809 06656000
*       RPLVBUF=INDEXPTR;           /* ADDR OF CIR BUF       @Y30LB25*/ 06657000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1810 06658000
*       RPLVUPD=ON;                 /* UPDATE                @Y30LB25*/ 06659000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1811 06660000
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/ 06661000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1812 06662000
*       RPLVTYP=RPLVREAD;           /* READ RECORD           @Y30LB25*/ 06663000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1813 06664000
*       RESPECIFY                   /*                       @Y30LB25*/ 06665000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 06666000
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/ 06667000
         LR    RG1,RPLVPTR                                         1815 06668000
*       CALL ICBVIO00;              /* READ CIR              @Y30LB25*/ 06669000
         L     @15,@CV00610                                        1816 06670000
         BALR  @14,@15                                             1816 06671000
*       RESPECIFY                   /*                       @Y30LB25*/ 06672000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 06673000
*       IF RPLVRETC^=FIXZERO        /* I/O ERROR OR NO       @Y30LB25*/ 06674000
*         THEN                      /* CIR EXISTS            @Y30LB25*/ 06675000
         LH    @08,RPLVRETC(,RPLVPTR)                              1818 06676000
         N     @08,@CF00815                                        1818 06677000
         LTR   @08,@08                                             1818 06678000
         BNZ   @RT01818                                            1818 06679000
*         RETURN;                   /*                       @Y30LB25*/ 06680000
*                                                                  1819 06681000
*       /*************************************************************/ 06682000
*       /*                                                           */ 06683000
*       /* CHECK IF CIR POINTS TO THE DELETE BVR             @Y30LB25*/ 06684000
*       /*                                                           */ 06685000
*       /*************************************************************/ 06686000
*                                                                  1820 06687000
*       IF INDRECKY=BASNAME         /* PT TO RIGHT           @Y30LB25*/ 06688000
*         THEN                      /* RECORD?               @Y30LB25*/ 06689000
         L     @08,BASEVPTR                                        1820 06690000
         CLC   INDRECKY(13,INDEXPTR),BASNAME(@08)                  1820 06691000
         BNE   @RF01820                                            1820 06692000
*         DO;                       /* YES                   @Y30LB25*/ 06693000
*                                                                  1821 06694000
*           /*********************************************************/ 06695000
*           /*                                                       */ 06696000
*           /* DELETE THE CIR                                @Y30LB25*/ 06697000
*           /*                                                       */ 06698000
*           /*********************************************************/ 06699000
*                                                                  1822 06700000
*           RPLVTYP=RPLVDEL;        /* DELETE                @Y30LB25*/ 06701000
         MVI   RPLVTYP(RPLVPTR),X'05'                              1822 06702000
*           RESPECIFY               /*                       @Y30LB25*/ 06703000
*             RG1 RSTD;             /* RESTRICT REG 1        @Y30LB25*/ 06704000
*           RG1=RPLVPTR;            /* SET RPLV PTR          @Y30LB25*/ 06705000
         LR    RG1,RPLVPTR                                         1824 06706000
*           CALL ICBVIO00;          /* DELETE CIR            @Y30LB25*/ 06707000
         L     @15,@CV00610                                        1825 06708000
         BALR  @14,@15                                             1825 06709000
*           RESPECIFY               /*                       @Y30LB25*/ 06710000
*             RG1 UNRSTD;           /* UNRESTRICT REG 1      @Y30LB25*/ 06711000
*           IF RPLVRETC^=FIXZERO    /* CK RETN CODE          @Y30LB25*/ 06712000
*             THEN                  /* ERROR                 @Y30LB25*/ 06713000
         LH    @08,RPLVRETC(,RPLVPTR)                              1827 06714000
         N     @08,@CF00815                                        1827 06715000
         LTR   @08,@08                                             1827 06716000
         BNZ   @RT01827                                            1827 06717000
*             RETURN;               /*                       @Y30LB25*/ 06718000
*         END;                      /*                       @Y30LB25*/ 06719000
*                                                                  1829 06720000
*       /*************************************************************/ 06721000
*       /*                                                           */ 06722000
*       /* UPDATE THE GVR OR NGVR FOR THE DELETED BVR        @Y30LB25*/ 06723000
*       /*                                                           */ 06724000
*       /*************************************************************/ 06725000
*                                                                  1830 06726000
*       CALL PDELTBVR;              /* UPDATE, WRITE GVR     @Y30LB25*/ 06727000
@RF01820 BAL   @14,PDELTBVR                                        1830 06728000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/ 06729000
*         THEN                      /* ERROR                 @Y30LB25*/ 06730000
         LH    @08,RPLVRETC(,RPLVPTR)                              1831 06731000
         N     @08,@CF00815                                        1831 06732000
         LTR   @08,@08                                             1831 06733000
         BNZ   @RT01831                                            1831 06734000
*         RETURN;                   /*                       @Y30LB25   06735000
*                                      CHAIN BVR OUT OF      @Y30LB25   06736000
*                                      GVR, AND MAKE         @Y30LB25   06737000
*                                      LATEST DVR A BVR      @Y30LB25*/ 06738000
*     END;                          /*                       @Y30LB25*/ 06739000
*                                                                  1833 06740000
*   /*****************************************************************/ 06741000
*   /*                                                               */ 06742000
*   /* THE BVR HAS COPIES                                    @Y30LB25*/ 06743000
*   /*                                                               */ 06744000
*   /*****************************************************************/ 06745000
*                                                                  1834 06746000
*   ELSE                            /* HAS COPIES            @Y30LB25*/ 06747000
*     DO;                           /*                       @Y30LB25*/ 06748000
*                                                                  1834 06749000
         B     @RC01796                                            1834 06750000
@RF01796 DS    0H                                                  1835 06751000
*       /*************************************************************/ 06752000
*       /*                                                           */ 06753000
*       /* WRITE THE BVR                                     @Y30LB25*/ 06754000
*       /*                                                           */ 06755000
*       /*************************************************************/ 06756000
*                                                                  1835 06757000
*       BASLIB1=FIX1F;              /* INSURE NULL           @Y30LB25*/ 06758000
         L     @08,BASEVPTR                                        1835 06759000
         MVI   BASLIB1(@08),X'FF'                                  1835 06760000
*       BASLIB2=FIX1F;              /* INSURE NULL           @Y30LB25*/ 06761000
         MVI   BASLIB2(@08),X'FF'                                  1836 06762000
*       BASREASS=ON;                /* CSNS REASSIGNED       @Y30LB25*/ 06763000
         OI    BASREASS(@08),B'00100000'                           1837 06764000
*       RPLVDIR=OFF;                /* NO DIRECT             @Y30LB25*/ 06765000
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1838 06766000
*       RPLVTYP=RPLVPUT;            /* WRITE                 @Y30LB25*/ 06767000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1839 06768000
*       RESPECIFY                   /*                       @Y30LB25*/ 06769000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 06770000
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/ 06771000
         LR    RG1,RPLVPTR                                         1841 06772000
*       CALL ICBVIO00;              /* WRITE BVR             @Y30LB25*/ 06773000
         L     @15,@CV00610                                        1842 06774000
         BALR  @14,@15                                             1842 06775000
*       RESPECIFY                   /*                       @Y30LB25*/ 06776000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 06777000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETN CODE       @Y30LB25*/ 06778000
*         THEN                      /* ERROR                 @Y30LB25*/ 06779000
         LH    @08,RPLVRETC(,RPLVPTR)                              1844 06780000
         N     @08,@CF00815                                        1844 06781000
         LTR   @08,@08                                             1844 06782000
         BNZ   @RT01844                                            1844 06783000
*         RETURN;                   /*                       @Y30LB25*/ 06784000
*                                                                  1845 06785000
*       /*************************************************************/ 06786000
*       /*                                                           */ 06787000
*       /* GET THE CIR FOR THE CORRECT CSN                   @Y30LB25*/ 06788000
*       /*                                                           */ 06789000
*       /*************************************************************/ 06790000
*                                                                  1846 06791000
*       IF BASCSN1^=INDSERNO        /* FIND CORRECT CSN      @Y30LB25*/ 06792000
*         THEN                      /*                       @Y30LB25*/ 06793000
         L     @08,BASEVPTR                                        1846 06794000
         CLC   BASCSN1(12,@08),INDSERNO(INDEXPTR)                  1846 06795000
         BE    @RF01846                                            1846 06796000
*         IVOLKY=BASCSN1;           /* KEY OF CSN            @Y30LB25*/ 06797000
         MVC   IVOLKY(12),BASCSN1(@08)                             1847 06798000
*       ELSE                        /*                       @Y30LB25*/ 06799000
*         IVOLKY=BASCSN2;           /* KEY OF OTHER CSN      @Y30LB25*/ 06800000
         B     @RC01846                                            1848 06801000
@RF01846 L     @08,BASEVPTR                                        1848 06802000
         MVC   IVOLKY(12),BASCSN2(@08)                             1848 06803000
*       RPLVKEY=ADDR(IKEY);         /* ADDR OF KEY           @Y30LB25*/ 06804000
@RC01846 LA    @08,IKEY                                            1849 06805000
         ST    @08,RPLVKEY(,RPLVPTR)                               1849 06806000
*       RPLVBLN=LENGTH(INDEXBUF);   /* CIR BUFFER LENGTH     @Y30LB25*/ 06807000
         MVC   RPLVBLN(4,RPLVPTR),@CF00806                         1850 06808000
*       RPLVBUF=INDEXPTR;           /* ADDR OF CIR BUF       @Y30LB25*/ 06809000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          1851 06810000
*       RPLVUPD=ON;                 /* UPDATE                @Y30LB25*/ 06811000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1852 06812000
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/ 06813000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1853 06814000
*       RPLVTYP=RPLVREAD;           /* READ RECORD           @Y30LB25*/ 06815000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1854 06816000
*       RESPECIFY                   /*                       @Y30LB25*/ 06817000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 06818000
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/ 06819000
         LR    RG1,RPLVPTR                                         1856 06820000
*       CALL ICBVIO00;              /* READ CIR              @Y30LB25*/ 06821000
         L     @15,@CV00610                                        1857 06822000
         BALR  @14,@15                                             1857 06823000
*       RESPECIFY                   /*                       @Y30LB25*/ 06824000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 06825000
*       IF RPLVRETC^=FIXZERO        /* I/O ERROR OR NO       @Y30LB25*/ 06826000
*         THEN                      /* CIR EXISTS            @Y30LB25*/ 06827000
         LH    @08,RPLVRETC(,RPLVPTR)                              1859 06828000
         N     @08,@CF00815                                        1859 06829000
         LTR   @08,@08                                             1859 06830000
         BNZ   @RT01859                                            1859 06831000
*         RETURN;                   /*                       @Y30LB25*/ 06832000
*                                                                  1860 06833000
*       /*************************************************************/ 06834000
*       /*                                                           */ 06835000
*       /* CHECK IF THE CIR POINTS TO THE WRITTEN BVR        @Y30LB25*/ 06836000
*       /*                                                           */ 06837000
*       /*************************************************************/ 06838000
*                                                                  1861 06839000
*       IF INDRECKY=BASNAME         /* PT TO RIGHT           @Y30LB25*/ 06840000
*         THEN                      /* RECORD?               @Y30LB25*/ 06841000
         L     @08,BASEVPTR                                        1861 06842000
         CLC   INDRECKY(13,INDEXPTR),BASNAME(@08)                  1861 06843000
         BNE   @RF01861                                            1861 06844000
*         DO;                       /* YES                   @Y30LB25*/ 06845000
*                                                                  1862 06846000
*           /*********************************************************/ 06847000
*           /*                                                       */ 06848000
*           /* DELETE THE CIR                                @Y30LB25*/ 06849000
*           /*                                                       */ 06850000
*           /*********************************************************/ 06851000
*                                                                  1863 06852000
*           RPLVTYP=RPLVDEL;        /* DELETE                @Y30LB25*/ 06853000
         MVI   RPLVTYP(RPLVPTR),X'05'                              1863 06854000
*           RPLVDIR=OFF;            /* NO DIRECT             @Y30LB25*/ 06855000
         NI    RPLVDIR(RPLVPTR),B'10111111'                        1864 06856000
*           RESPECIFY               /*                       @Y30LB25*/ 06857000
*             RG1 RSTD;             /* RESTRICT REG 1        @Y30LB25*/ 06858000
*           RG1=RPLVPTR;            /* SET RPLV PTR          @Y30LB25*/ 06859000
         LR    RG1,RPLVPTR                                         1866 06860000
*           CALL ICBVIO00;          /* DELETE CIR            @Y30LB25*/ 06861000
         L     @15,@CV00610                                        1867 06862000
         BALR  @14,@15                                             1867 06863000
*           RESPECIFY               /*                       @Y30LB25*/ 06864000
*             RG1 UNRSTD;           /* UNRESTRICT REG 1      @Y30LB25*/ 06865000
*           IF RPLVRETC^=FIXZERO    /* CK RETN CODE          @Y30LB25*/ 06866000
*             THEN                  /* ERROR                 @Y30LB25*/ 06867000
         LH    @08,RPLVRETC(,RPLVPTR)                              1869 06868000
         N     @08,@CF00815                                        1869 06869000
         LTR   @08,@08                                             1869 06870000
         BNZ   @RT01869                                            1869 06871000
*             RETURN;               /*                       @Y30LB25*/ 06872000
*         END;                      /*                       @Y30LB25*/ 06873000
*     END;                          /*                       @Y30LB25*/ 06874000
*                                                                  1872 06875000
@RF01861 DS    0H                                                  1873 06876000
*   /*****************************************************************/ 06877000
*   /*                                                               */ 06878000
*   /* NOW CREATE A CIR, ONE WILL NOT EXIST                  @Y30LB25*/ 06879000
*   /*                                                               */ 06880000
*   /*****************************************************************/ 06881000
*                                                                  1873 06882000
*   CALL CWCIR;                     /* CREATE/WRITE          @Y30LB25   06883000
*                                      NEW CIR               @Y30LB25*/ 06884000
@RC01796 BAL   @14,CWCIR                                           1873 06885000
*   BASEVPTR=BCDTEMP;               /* RESTORE BVR PTR       @Y30LB25*/ 06886000
         ST    BCDTEMP,BASEVPTR                                    1874 06887000
*   RETURN;                         /*                       @Y30LB25*/ 06888000
@EL00032 DS    0H                                                  1875 06889000
@EF00032 DS    0H                                                  1875 06890000
@ER00032 L     @14,@SA00032                                        1875 06891000
         BR    @14                                                 1875 06892000
*   END FIXBVR;                     /*                       @Y30LB25*/ 06893000
         B     @EL00032                                            1876 06894000
*                                                                  1877 06895000
*   /*****************************************************************/ 06896000
*   /*                                                               */ 06897000
*   /* PROCEDURE NAME - PDELTBVR                             @Y30LB25*/ 06898000
*   /*                                                       @Y30LB25*/ 06899000
*   /* FUNCTION - THE INPUT BVR HAS ALREADY BEEN DELETED.    @Y30LB25*/ 06900000
*   /* IF THE BVR IS GROUPED, GET THE GVR, UPDATE IT, CHAIN  @Y30LB25*/ 06901000
*   /* THE BVR OUT OF THE GVR, AND WRITE THE GVR.            @Y30LB25*/ 06902000
*   /* LOCATE A DVR FOR THE BVR, IF ANY, AND MAKE            @Y30LB25*/ 06903000
*   /* IT THE BVR. IF NO DVR IS FOUND, THEN DELETE THE       @Y30LB25*/ 06904000
*   /* BVR FROM THE NGVR CHAIN OF BVRS.                      @Y30LB25*/ 06905000
*   /*                                                       @Y30LB25*/ 06906000
*   /* INPUT -                                               @Y30LB25*/ 06907000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 06908000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 06909000
*   /*                                                       @Y30LB25*/ 06910000
*   /* OUTPUT -                                              @Y30LB25*/ 06911000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 06912000
*   /* BASE VOLUME RECORD                                    @Y30LB25*/ 06913000
*   /* GROUP VOLUME RECORD                                   @Y30LB25*/ 06914000
*   /* NON-GROUP VOLUME RECORD                               @Y30LB25*/ 06915000
*   /*                                                               */ 06916000
*   /*****************************************************************/ 06917000
*                                                                  1877 06918000
*PDELTBVR:                          /*                       @Y30LB25*/ 06919000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 06920000
*                                                                  1877 06921000
PDELTBVR ST    @14,@SA00033                                        1877 06922000
*   /*****************************************************************/ 06923000
*   /*                                                               */ 06924000
*   /* CHECK IF BVR WAS GROUPED                              @Y30LB25*/ 06925000
*   /*                                                               */ 06926000
*   /*****************************************************************/ 06927000
*                                                                  1878 06928000
*   IF BASGRPV=ON                   /* GROUPED?              @Y30LB25*/ 06929000
*     THEN                          /* YES                   @Y30LB25*/ 06930000
         L     @08,BASEVPTR                                        1878 06931000
         TM    BASGRPV(@08),B'00100000'                            1878 06932000
         BNO   @RF01878                                            1878 06933000
*     DO;                           /*                       @Y30LB25*/ 06934000
*                                                                  1879 06935000
*       /*************************************************************/ 06936000
*       /*                                                           */ 06937000
*       /* GET THE GVR                                       @Y30LB25*/ 06938000
*       /*                                                           */ 06939000
*       /*************************************************************/ 06940000
*                                                                  1880 06941000
*       GROUPKY=BASGROUP;           /* SET THE KEY           @Y30LB25*/ 06942000
         MVC   GROUPKY(8),BASGROUP(@08)                            1880 06943000
*       RPLVKEY=ADDR(GKEY);         /* PTR TO KEY            @Y30LB25*/ 06944000
         LA    @08,GKEY                                            1881 06945000
         ST    @08,RPLVKEY(,RPLVPTR)                               1881 06946000
*       RPLVTYP=RPLVREAD;           /* READ OPTION ON        @Y30LB25*/ 06947000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1882 06948000
*       RPLVLOC=OFF;                /* NO LOCATE             @Y30LB25*/ 06949000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1883 06950000
*       RPLVUPD=ON;                 /* UPDATE                @Y30LB25*/ 06951000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1884 06952000
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/ 06953000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1885 06954000
*       RPLVBUF=GROUPPTR;           /* BUFFER PTR            @Y30LB25*/ 06955000
         L     @08,GROUPPTR                                        1886 06956000
         ST    @08,RPLVBUF(,RPLVPTR)                               1886 06957000
*       RPLVBLN=LENGTH(GROUPBUF);   /* BUFFER LENGTH         @Y30LB25*/ 06958000
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1887 06959000
*       RESPECIFY                                                  1888 06960000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 06961000
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/ 06962000
         LR    RG1,RPLVPTR                                         1889 06963000
*       CALL ICBVIO00;              /* GET GVR               @Y30LB25*/ 06964000
         L     @15,@CV00610                                        1890 06965000
         BALR  @14,@15                                             1890 06966000
*       RESPECIFY                                                  1891 06967000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 06968000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/ 06969000
*         THEN                      /* ERROR                 @Y30LB25*/ 06970000
         LH    @08,RPLVRETC(,RPLVPTR)                              1892 06971000
         N     @08,@CF00815                                        1892 06972000
         LTR   @08,@08                                             1892 06973000
         BNZ   @RT01892                                            1892 06974000
*         RETURN;                   /*                       @Y30LB25*/ 06975000
*                                                                  1893 06976000
*       /*************************************************************/ 06977000
*       /*                                                           */ 06978000
*       /* CHAIN THE BVR OUT OF THE GVR CHAIN OF BVRS        @Y30LB25*/ 06979000
*       /*                                                           */ 06980000
*       /*************************************************************/ 06981000
*                                                                  1894 06982000
*       IF BASINAC=ON THEN          /* IS VOL INACTIVE       @ZA14747*/ 06983000
         L     @08,BASEVPTR                                        1894 06984000
         TM    BASINAC(@08),B'00000100'                            1894 06985000
         BNO   @RF01894                                            1894 06986000
*         GRONINAC=GRONINAC-FIXONE; /* DECREM INACT VOL #    @ZA14747*/ 06987000
         L     @08,GROUPPTR                                        1895 06988000
         LH    @04,GRONINAC(,@08)                                  1895 06989000
         BCTR  @04,0                                               1895 06990000
         STH   @04,GRONINAC(,@08)                                  1895 06991000
*       ELSE                                                       1896 06992000
*         IF BASRSTD=ON THEN        /* IS VOL RESTRCTED      @ZA14747*/ 06993000
         B     @RC01894                                            1896 06994000
@RF01894 L     @08,BASEVPTR                                        1896 06995000
         TM    BASRSTD(@08),B'00001000'                            1896 06996000
         BNO   @RF01896                                            1896 06997000
*           GRONRSTD=GRONRSTD-FIXONE;/* DECREM RSTD VOL CNT  @ZA14747*/ 06998000
         L     @08,GROUPPTR                                        1897 06999000
         LH    @04,GRONRSTD(,@08)                                  1897 07000000
         BCTR  @04,0                                               1897 07001000
         STH   @04,GRONRSTD(,@08)                                  1897 07002000
*         ELSE                                                     1898 07003000
*           IF BASGENUS=ON THEN     /* IS VOL GEN USE        @ZA14747*/ 07004000
         B     @RC01896                                            1898 07005000
@RF01896 L     @08,BASEVPTR                                        1898 07006000
         TM    BASGENUS(@08),B'00010000'                           1898 07007000
         BNO   @RF01898                                            1898 07008000
*             GRONGEN=GRONGEN-FIXONE;/* DECREM GENUSE CNT    @ZA14747*/ 07009000
         L     @08,GROUPPTR                                        1899 07010000
         LH    @04,GRONGEN(,@08)                                   1899 07011000
         BCTR  @04,0                                               1899 07012000
         STH   @04,GRONGEN(,@08)                                   1899 07013000
*       GRPFLG=ON;                  /* SET GROUP FLAG        @Y30LB25*/ 07014000
@RF01898 DS    0H                                                  1900 07015000
@RC01896 DS    0H                                                  1900 07016000
@RC01894 OI    GRPFLG,B'00010000'                                  1900 07017000
*       CALL ICBVUCHO(GROUPPTR,BASEVPTR,RPLVPTR,BYTEPASS);/* @Y30LB25   07018000
*                                      CHAIN BVR OUT GVR     @Y30LB25*/ 07019000
         ST    RPLVPTR,@TF00001                                    1901 07020000
         L     @15,@CV00615                                        1901 07021000
         LA    @01,@AL01901                                        1901 07022000
         BALR  @14,@15                                             1901 07023000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/ 07024000
*         THEN                      /* ERROR                 @Y30LB25*/ 07025000
         LH    @08,RPLVRETC(,RPLVPTR)                              1902 07026000
         N     @08,@CF00815                                        1902 07027000
         LTR   @08,@08                                             1902 07028000
         BNZ   @RT01902                                            1902 07029000
*         RETURN;                   /*                       @Y30LB25*/ 07030000
*                                                                  1903 07031000
*       /*************************************************************/ 07032000
*       /*                                                           */ 07033000
*       /* REESTABLISH RPLV FOR UPDATE OF GVR                @Y30LB25*/ 07034000
*       /*                                                           */ 07035000
*       /*************************************************************/ 07036000
*                                                                  1904 07037000
*       GROUPKY=BASGROUP;           /* SET THE KEY           @Y30LB25*/ 07038000
         L     @08,BASEVPTR                                        1904 07039000
         MVC   GROUPKY(8),BASGROUP(@08)                            1904 07040000
*       RPLVKEY=ADDR(GKEY);         /* PTR TO KEY            @Y30LB25*/ 07041000
         LA    @08,GKEY                                            1905 07042000
         ST    @08,RPLVKEY(,RPLVPTR)                               1905 07043000
*       RPLVTYP=RPLVREAD;           /* READ OPTION ON        @Y30LB25*/ 07044000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1906 07045000
*       RPLVLOC=OFF;                /* NO LOCATE             @Y30LB25*/ 07046000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1907 07047000
*       RPLVUPD=ON;                 /* UPDATE                @Y30LB25*/ 07048000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1908 07049000
*       RPLVDIR=ON;                 /* DIRECT                @Y30LB25*/ 07050000
         OI    RPLVDIR(RPLVPTR),B'01000000'                        1909 07051000
*       RPLVBUF=ADDR(GRECBF);       /* BUFFER PTR            @Y30LB25*/ 07052000
         LA    @08,GRECBF                                          1910 07053000
         ST    @08,RPLVBUF(,RPLVPTR)                               1910 07054000
*       RPLVBLN=LENGTH(GRECBF);     /* BUFFER LENGTH         @Y30LB25*/ 07055000
         MVC   RPLVBLN(4,RPLVPTR),@CF00805                         1911 07056000
*       RESPECIFY                                                  1912 07057000
*         RG1 RSTD;                 /* RESTRICT REG 1        @Y30LB25*/ 07058000
*       RG1=RPLVPTR;                /* SET RPLV PTR          @Y30LB25*/ 07059000
         LR    RG1,RPLVPTR                                         1913 07060000
*       CALL ICBVIO00;              /* GET GVR               @Y30LB25*/ 07061000
         L     @15,@CV00610                                        1914 07062000
         BALR  @14,@15                                             1914 07063000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/ 07064000
*         THEN                      /* ERROR                 @Y30LB25*/ 07065000
         LH    @08,RPLVRETC(,RPLVPTR)                              1915 07066000
         N     @08,@CF00815                                        1915 07067000
         LTR   @08,@08                                             1915 07068000
         BNZ   @RT01915                                            1915 07069000
*         RETURN;                   /*                       @Y30LB25*/ 07070000
*                                                                  1916 07071000
*       /*************************************************************/ 07072000
*       /*                                                           */ 07073000
*       /* WRITE THE GVR                                     @Y30LB25*/ 07074000
*       /*                                                           */ 07075000
*       /*************************************************************/ 07076000
*                                                                  1917 07077000
*       RPLVTYP=RPLVPUT;            /* WRITE FOR GVR         @Y30LB25*/ 07078000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1917 07079000
*       RPLVBUF=GROUPPTR;           /* PTR TO GVR            @Y30LB25*/ 07080000
         L     @08,GROUPPTR                                        1918 07081000
         ST    @08,RPLVBUF(,RPLVPTR)                               1918 07082000
*       CALL ICBVIO00;              /* GET GVR               @Y30LB25*/ 07083000
         L     @15,@CV00610                                        1919 07084000
         BALR  @14,@15                                             1919 07085000
*       RESPECIFY                                                  1920 07086000
*         RG1 UNRSTD;               /* UNRESTRICT REG 1      @Y30LB25*/ 07087000
*       IF RPLVRETC^=FIXZERO        /* CHECK RETURN CODE     @Y30LB25*/ 07088000
*         THEN                      /* ERROR                 @Y30LB25*/ 07089000
         LH    @08,RPLVRETC(,RPLVPTR)                              1921 07090000
         N     @08,@CF00815                                        1921 07091000
         LTR   @08,@08                                             1921 07092000
         BNZ   @RT01921                                            1921 07093000
*         RETURN;                   /*                       @Y30LB25*/ 07094000
*       IF BASINAC=OFF&             /* VOL INACTIVE          @ZA14747*/ 07095000
*           BASGENUS=ON THEN        /* VOL GENERAL USE       @ZA14747*/ 07096000
         L     @08,BASEVPTR                                        1923 07097000
         TM    BASGENUS(@08),B'00010000'                           1923 07098000
         BNO   @RF01923                                            1923 07099000
         TM    BASINAC(@08),B'00000100'                            1923 07100000
         BNZ   @RF01923                                            1923 07101000
*         DO;                       /*                       @ZA14747*/ 07102000
*           ADDSUBSL=OFF;           /* DELETE SLOT           @ZA14747*/ 07103000
         NI    ADDSUBSL,B'11111101'                                1925 07104000
*           EXPSLOT=OFF;            /* NO EXPIR DATE         @ZA14747*/ 07105000
         NI    EXPSLOT,B'01111111'                                 1926 07106000
*           CALL ICBVUEXT(GROUPPTR,BASEVPTR,RPLVPTR,BYTEPASS);/*   1927 07107000
*                                      DELETE A SLOT         @ZA14747*/ 07108000
         ST    RPLVPTR,@TF00001                                    1927 07109000
         L     @15,@CV00617                                        1927 07110000
         LA    @01,@AL01927                                        1927 07111000
         BALR  @14,@15                                             1927 07112000
*           IF RPLVRETC^=FIXZERO THEN/* CHECK RETURN CODE    @ZA14747*/ 07113000
         LH    @08,RPLVRETC(,RPLVPTR)                              1928 07114000
         N     @08,@CF00815                                        1928 07115000
         LTR   @08,@08                                             1928 07116000
         BNZ   @RT01928                                            1928 07117000
*             RETURN;               /*                       @ZA14747*/ 07118000
*         END;                      /*                       @ZA14747*/ 07119000
*     END;                          /*                       @Y30LB25*/ 07120000
*                                                                  1931 07121000
@RF01923 DS    0H                                                  1932 07122000
*   /*****************************************************************/ 07123000
*   /*                                                               */ 07124000
*   /* READ FOR A DVR FOR THE DELETED BVR                    @Y30LB25*/ 07125000
*   /*                                                               */ 07126000
*   /*****************************************************************/ 07127000
*                                                                  1932 07128000
*   DVOLKY=BASSERNO;                /* SET VOLID IN KEY      @Y30LB25*/ 07129000
@RF01878 L     @08,BASEVPTR                                        1932 07130000
         MVC   DVOLKY(6),BASSERNO(@08)                             1932 07131000
*   DIDKY=FIXONE;                   /* SET KEY               @Y30LB25*/ 07132000
         MVI   DIDKY,X'01'                                         1933 07133000
*   RPLVKEY=ADDR(DKEY);             /* ADDR OF KEY           @Y30LB25*/ 07134000
         LA    @08,DKEY                                            1934 07135000
         ST    @08,RPLVKEY(,RPLVPTR)                               1934 07136000
*   RPLVTYP=RPLVREAD;               /* READ OPTION ON        @Y30LB25*/ 07137000
         MVI   RPLVTYP(RPLVPTR),X'00'                              1935 07138000
*   RPLVLOC=OFF;                    /* NO LOCATE             @Y30LB25*/ 07139000
         NI    RPLVLOC(RPLVPTR),B'01111111'                        1936 07140000
*   RPLVUPD=ON;                     /* SET UPDATE            @Y30LB25*/ 07141000
         OI    RPLVUPD(RPLVPTR),B'00000010'                        1937 07142000
*   RPLVKGE=ON;                     /* READ KEY = OR >       @Y30LB25*/ 07143000
         OI    RPLVKGE(RPLVPTR),B'00000100'                        1938 07144000
*   RPLVBUF=DUPVPTR;                /* BUFFER PTR            @Y30LB25*/ 07145000
         L     @08,DUPVPTR                                         1939 07146000
         ST    @08,RPLVBUF(,RPLVPTR)                               1939 07147000
*   RPLVBLN=LENGTH(DUPVBUF);        /* BUFFER LENGTH         @Y30LB25*/ 07148000
         MVC   RPLVBLN(4,RPLVPTR),@CF00804                         1940 07149000
*   RESPECIFY                                                      1941 07150000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 07151000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 07152000
         LR    RG1,RPLVPTR                                         1942 07153000
*   CALL ICBVIO00;                  /* READ FOR DVR          @Y30LB25*/ 07154000
         L     @15,@CV00610                                        1943 07155000
         BALR  @14,@15                                             1943 07156000
*   RESPECIFY                                                      1944 07157000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 07158000
*   RPLVKGE=OFF;                    /* NO > OR =             @Y30LB25*/ 07159000
         NI    RPLVKGE(RPLVPTR),B'11111011'                        1945 07160000
*   IF RPLRCODE=IOERROR             /* CHECK REASON CODE     @Y30LB25*/ 07161000
*     THEN                          /* YES                   @Y30LB25*/ 07162000
         CLC   RPLRCODE(2,RPLVPTR),@CB00588                        1946 07163000
         BE    @RT01946                                            1946 07164000
*     RETURN;                       /*                       @Y30LB25*/ 07165000
*                                                                  1947 07166000
*   /*****************************************************************/ 07167000
*   /*                                                               */ 07168000
*   /* CHECK IF A DVR WAS FOUND                              @Y30LB25*/ 07169000
*   /*                                                               */ 07170000
*   /*****************************************************************/ 07171000
*                                                                  1948 07172000
*   IF DKY^=DUPD|DVOLKY^=DUPSERNO   /* DVR FOUND?            @Y30LB25*/ 07173000
*     THEN                          /* NO                    @Y30LB25*/ 07174000
*                                                                  1948 07175000
         L     @08,DUPVPTR                                         1948 07176000
         CLC   DKY(5),DUPD(@08)                                    1948 07177000
         BNE   @RT01948                                            1948 07178000
         CLC   DVOLKY(6),DUPSERNO(@08)                             1948 07179000
         BE    @RF01948                                            1948 07180000
@RT01948 DS    0H                                                  1949 07181000
*     /***************************************************************/ 07182000
*     /*                                                             */ 07183000
*     /* NO DVR WAS FOUND, BUT BVR WAS NOT GROUPED           @Y30LB25*/ 07184000
*     /*                                                             */ 07185000
*     /***************************************************************/ 07186000
*                                                                  1949 07187000
*     IF BASGRPV=OFF                /* BVR NOT GRPD?         @Y30LB25*/ 07188000
*       THEN                        /* YES                   @Y30LB25*/ 07189000
         L     @08,BASEVPTR                                        1949 07190000
         TM    BASGRPV(@08),B'00100000'                            1949 07191000
         BNZ   @RF01949                                            1949 07192000
*       DO;                         /*                       @Y30LB25*/ 07193000
*                                                                  1950 07194000
*         /***********************************************************/ 07195000
*         /*                                                         */ 07196000
*         /* CHAIN THE BVR OUT OF THE NGVR                   @Y30LB25*/ 07197000
*         /* CHAIN OF BVRS                                   @Y30LB25*/ 07198000
*         /*                                                         */ 07199000
*         /***********************************************************/ 07200000
*                                                                  1951 07201000
*         GRPFLG=OFF;               /* NON-GROUPED           @Y30LB25*/ 07202000
         NI    GRPFLG,B'11101111'                                  1951 07203000
*         CALL ICBVUCHO(FIXZERO,BASEVPTR,RPLVPTR,BYTEPASS);/*      1952 07204000
*                                                            @Y30LB25   07205000
*                                      CHAIN BVR OUT NGVR    @Y30LB25*/ 07206000
         ST    RPLVPTR,@TF00001                                    1952 07207000
         L     @15,@CV00615                                        1952 07208000
         LA    @01,@AL01952                                        1952 07209000
         BALR  @14,@15                                             1952 07210000
*         RETURN;                   /*                       @Y30LB25*/ 07211000
@EL00033 DS    0H                                                  1953 07212000
@EF00033 DS    0H                                                  1953 07213000
@ER00033 L     @14,@SA00033                                        1953 07214000
         BR    @14                                                 1953 07215000
*       END;                        /*                       @Y30LB25*/ 07216000
*     ELSE                          /* GROUPED               @Y30LB25*/ 07217000
*       RETURN;                     /*                       @Y30LB25*/ 07218000
*                                                                  1955 07219000
*   /*****************************************************************/ 07220000
*   /*                                                               */ 07221000
*   /* A DVR WAS FOUND, MAKE IT INTO A BVR                   @Y30LB25*/ 07222000
*   /*                                                               */ 07223000
*   /*****************************************************************/ 07224000
*                                                                  1956 07225000
*   ELSE                            /* DVR WAS FOUND         @Y30LB25*/ 07226000
*     DO;                           /*                       @Y30LB25*/ 07227000
*                                                                  1956 07228000
@RF01948 DS    0H                                                  1957 07229000
*       /*************************************************************/ 07230000
*       /*                                                           */ 07231000
*       /* CHECK IF DELETED BVR WAS GROUPED                  @Y30LB25*/ 07232000
*       /* OR NON-GROUPED                                    @Y30LB25*/ 07233000
*       /*                                                           */ 07234000
*       /*************************************************************/ 07235000
*                                                                  1957 07236000
*       IF BASGRPV=ON               /* BVR GROUPED?          @Y30LB25*/ 07237000
*         THEN                      /* YES                   @Y30LB25*/ 07238000
         L     @08,BASEVPTR                                        1957 07239000
         TM    BASGRPV(@08),B'00100000'                            1957 07240000
         BNO   @RF01957                                            1957 07241000
*         DO;                       /*                       @Y30LB25*/ 07242000
*           GRPDV=ON;               /* GROUPED FLAG ON       @Y30LB25*/ 07243000
         OI    GRPDV,B'10000000'                                   1959 07244000
*           CALL ICBVUDBR(DUPVPTR,PTRBASEV,RPLVPTR,BYTEPASS,/*     1960 07245000
*                                                            @Y30LB25*/ 07246000
*               FIXZERO,FIXZERO);   /*                       @Y30LB25   07247000
*                                      MAKE DVR A BVR        @Y30LB25*/ 07248000
         ST    RPLVPTR,@TF00001                                    1960 07249000
         L     @15,@CV00616                                        1960 07250000
         LA    @01,@AL01960                                        1960 07251000
         BALR  @14,@15                                             1960 07252000
*           IF RPLVRETC^=FIXZERO    /* CHECK RETURN CODE     @Y30LB25*/ 07253000
*             THEN                  /* ERROR                 @Y30LB25*/ 07254000
         LH    @08,RPLVRETC(,RPLVPTR)                              1961 07255000
         N     @08,@CF00815                                        1961 07256000
         LTR   @08,@08                                             1961 07257000
         BNZ   @RT01961                                            1961 07258000
*             RETURN;               /*                       @Y30LB25*/ 07259000
*                                                                  1962 07260000
*           /*********************************************************/ 07261000
*           /*                                                       */ 07262000
*           /* CHAIN THE NEW BVR INTO THE NGVR               @Y30LB25*/ 07263000
*           /* CHAIN OF BVRS                                 @Y30LB25*/ 07264000
*           /*                                                       */ 07265000
*           /*********************************************************/ 07266000
*                                                                  1963 07267000
*           GRPFLG=OFF;             /* NON-GROUPED           @Y30LB25*/ 07268000
         NI    GRPFLG,B'11101111'                                  1963 07269000
*           CALL ICBVUCHI(FIXZERO,PTRBASEV,RPLVPTR,BYTEPASS);/*    1964 07270000
*                                                            @Y30LB25   07271000
*                                      CHAIN BVR IN NGVR     @Y30LB25*/ 07272000
         ST    RPLVPTR,@TF00001                                    1964 07273000
         L     @15,@CV00614                                        1964 07274000
         LA    @01,@AL01964                                        1964 07275000
         BALR  @14,@15                                             1964 07276000
*           IF RPLVRETC^=FIXZERO    /* CHECK RETURN CODE     @Y30LB25*/ 07277000
*             THEN                  /* ERROR                 @Y30LB25*/ 07278000
         LH    @08,RPLVRETC(,RPLVPTR)                              1965 07279000
         N     @08,@CF00815                                        1965 07280000
         LTR   @08,@08                                             1965 07281000
         BNZ   @RT01965                                            1965 07282000
*             RETURN;               /*                       @Y30LB25*/ 07283000
*         END;                      /*                       @Y30LB25*/ 07284000
*                                                                  1967 07285000
*       /*************************************************************/ 07286000
*       /*                                                           */ 07287000
*       /* THE DELETED BVR WAS NOT GROUPED                   @Y30LB25*/ 07288000
*       /* CREATE A BVR AND IT WILL ALREADY BE               @Y30LB25*/ 07289000
*       /* CHAINED INTO THE NGVR CHAIN OF BVRS               @Y30LB25*/ 07290000
*       /*                                                           */ 07291000
*       /*************************************************************/ 07292000
*                                                                  1968 07293000
*       ELSE                        /* NOT GROUPED           @Y30LB25*/ 07294000
*         DO;                       /*                       @Y30LB25*/ 07295000
         B     @RC01957                                            1968 07296000
@RF01957 DS    0H                                                  1969 07297000
*           GRPDV=OFF;              /* GROUPED FLAG OFF      @Y30LB25*/ 07298000
         NI    GRPDV,B'01111111'                                   1969 07299000
*           IF BASFIRST=ON          /* 1ST BVR IN CHAIN?     @Y30LB25*/ 07300000
*             THEN                  /* YES                   @Y30LB25*/ 07301000
         L     @08,BASEVPTR                                        1970 07302000
         TM    BASFIRST(@08),B'00010000'                           1970 07303000
         BNO   @RF01970                                            1970 07304000
*             FRSTDV=ON;            /* SET 1ST FLG ON        @Y30LB25*/ 07305000
         OI    FRSTDV,B'01000000'                                  1971 07306000
*           IF BASLAST=ON           /* LAST BVR IN CHAIN?    @Y30LB25*/ 07307000
*             THEN                  /* YES                   @Y30LB25*/ 07308000
@RF01970 L     @08,BASEVPTR                                        1972 07309000
         TM    BASLAST(@08),B'00001000'                            1972 07310000
         BNO   @RF01972                                            1972 07311000
*             LASTDV=ON;            /* SET LAST FLG ON       @Y30LB25*/ 07312000
         OI    LASTDV,B'00100000'                                  1973 07313000
*           CALL ICBVUDBR(DUPVPTR,PTRBASEV,RPLVPTR,BYTEPASS,/*     1974 07314000
*                                                            @Y30LB25*/ 07315000
*               BASPREV,BASNEXTV);  /*                       @Y30LB25   07316000
*                                      MAKE DVR A BVR        @Y30LB25*/ 07317000
@RF01972 MVC   @AL00001(16),@AL01974                               1974 07318000
         ST    RPLVPTR,@TF00001                                    1974 07319000
         L     @08,BASEVPTR                                        1974 07320000
         LA    @04,BASPREV(,@08)                                   1974 07321000
         ST    @04,@AL00001+16                                     1974 07322000
         LA    @08,BASNEXTV(,@08)                                  1974 07323000
         ST    @08,@AL00001+20                                     1974 07324000
         L     @15,@CV00616                                        1974 07325000
         LA    @01,@AL00001                                        1974 07326000
         BALR  @14,@15                                             1974 07327000
*           IF RPLVRETC^=FIXZERO    /* CHECK RETURN CODE     @Y30LB25*/ 07328000
*             THEN                  /* ERROR                 @Y30LB25*/ 07329000
         LH    @08,RPLVRETC(,RPLVPTR)                              1975 07330000
         N     @08,@CF00815                                        1975 07331000
         LTR   @08,@08                                             1975 07332000
         BNZ   @RT01975                                            1975 07333000
*             RETURN;               /*                       @Y30LB25*/ 07334000
*         END;                      /*                       @Y30LB25*/ 07335000
*     END;                          /*                       @Y30LB25*/ 07336000
*                                                                  1978 07337000
@RC01957 DS    0H                                                  1979 07338000
*   /*****************************************************************/ 07339000
*   /*                                                               */ 07340000
*   /* WRITE THE NEWLY CREATED BVR                           @Y30LB25*/ 07341000
*   /*                                                               */ 07342000
*   /*****************************************************************/ 07343000
*                                                                  1979 07344000
*   RPLVTYP=RPLVPUT;                /* WRITE BVR             @Y30LB25*/ 07345000
         MVI   RPLVTYP(RPLVPTR),X'01'                              1979 07346000
*   RPLVBUF=PTRBASEV;               /* PTR TO BVR            @Y30LB25*/ 07347000
         L     @08,PTRBASEV                                        1980 07348000
         ST    @08,RPLVBUF(,RPLVPTR)                               1980 07349000
*   RPLVUPD=OFF;                    /* NEW RECORD            @Y30LB25*/ 07350000
         NI    RPLVUPD(RPLVPTR),B'11111101'                        1981 07351000
*   RPLVBLN=LENGTH(BASEBUF);        /* SET BUF LENGTH        @Y30LB25*/ 07352000
         LA    @08,224                                             1982 07353000
         ST    @08,RPLVBLN(,RPLVPTR)                               1982 07354000
*   RPLVRLN=LENGTH(BASEBUF);        /* SET BVR LENGTH        @Y30LB25*/ 07355000
         ST    @08,RPLVRLN(,RPLVPTR)                               1983 07356000
*   RESPECIFY                       /*                       @Y30LB25*/ 07357000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 07358000
*   RG1=RPLVPTR;                    /* SET PTR TO RPLV       @Y30LB25*/ 07359000
         LR    RG1,RPLVPTR                                         1985 07360000
*   CALL ICBVIO00;                  /* WRITE BVR             @Y30LB25*/ 07361000
         L     @15,@CV00610                                        1986 07362000
         BALR  @14,@15                                             1986 07363000
*   RESPECIFY                       /*                       @Y30LB25*/ 07364000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 07365000
*   RETURN;                         /*                       @Y30LB25*/ 07366000
         B     @EL00033                                            1988 07367000
*   END PDELTBVR;                   /*                       @Y30LB25*/ 07368000
         B     @EL00033                                            1989 07369000
*                                                                  1990 07370000
*   /*****************************************************************/ 07371000
*   /*                                                               */ 07372000
*   /* PROCEDURE NAME - CWCIR                                @Y30LB25*/ 07373000
*   /*                                                       @Y30LB25*/ 07374000
*   /* FUNCTION - CREATE AND WRITE A CIR.                    @Y30LB25*/ 07375000
*   /*                                                       @Y30LB25*/ 07376000
*   /* INPUT -                                               @Y30LB25*/ 07377000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 07378000
*   /*                                                       @Y30LB25*/ 07379000
*   /* OUTPUT -                                              @Y30LB25*/ 07380000
*   /* MSVC REQUEST PARAMETER LIST                           @Y30LB25*/ 07381000
*   /* CARTRIDGE INDEX RECORD                                @Y30LB25*/ 07382000
*   /*                                                               */ 07383000
*   /*****************************************************************/ 07384000
*                                                                  1990 07385000
*CWCIR:                             /*                       @Y30LB25*/ 07386000
*   PROC OPTIONS(SAVE(RG14));       /*                       @ZA13484*/ 07387000
*                                                                  1990 07388000
CWCIR    ST    @14,@SA00034                                        1990 07389000
*   /*****************************************************************/ 07390000
*   /*                                                               */ 07391000
*   /* CREATE AND INITIALIZE A CIR                           @Y30LB25*/ 07392000
*   /*                                                               */ 07393000
*   /*****************************************************************/ 07394000
*                                                                  1991 07395000
*   INDEXBUF=INDEXBUF&&INDEXBUF;    /* ZERO CIR BUFFER       @Y30LB25*/ 07396000
         XC    INDEXBUF(36),INDEXBUF                               1991 07397000
*   IF CSNUMBER=ON                  /* CSN1?                 @Y30LB25*/ 07398000
*     THEN                          /* YES                   @Y30LB25*/ 07399000
         TM    CSNUMBER,B'00000100'                                1992 07400000
         BNO   @RF01992                                            1992 07401000
*     INDSERNO=BCDCSN1;             /* CIR FOR CSN1          @Y30LB25*/ 07402000
         L     @08,BCDVPTR                                         1993 07403000
         MVC   INDSERNO(12,INDEXPTR),BCDCSN1(@08)                  1993 07404000
*   ELSE                            /* CSN2                  @Y30LB25*/ 07405000
*     INDSERNO=BCDCSN2;             /* CIR FOR CSN2          @Y30LB25*/ 07406000
         B     @RC01992                                            1994 07407000
@RF01992 L     @08,BCDVPTR                                         1994 07408000
         MVC   INDSERNO(12,INDEXPTR),BCDCSN2(@08)                  1994 07409000
*   INDI=I;                         /* SET CIR INDECATOR     @Y30LB25*/ 07410000
@RC01992 MVI   INDI(INDEXPTR),C'I'                                 1995 07411000
*   INDINDEX=ON;                    /* CIR FLAG SET ON       @Y30LB25*/ 07412000
         OI    INDINDEX(INDEXPTR),B'00001000'                      1996 07413000
*   INDRECKY=BCDNAME;               /* BVR, CVR, DVR KEY     @Y30LB25*/ 07414000
*                                                                  1997 07415000
         L     @08,BCDVPTR                                         1997 07416000
         MVC   INDRECKY(13,INDEXPTR),BCDNAME(@08)                  1997 07417000
*   /*****************************************************************/ 07418000
*   /*                                                               */ 07419000
*   /* WRITE THE NEW CIR                                     @Y30LB25*/ 07420000
*   /*                                                               */ 07421000
*   /*****************************************************************/ 07422000
*                                                                  1998 07423000
*   RPLVBLN=LENGTH(INDEXBUF);       /* CIR BUFFER LENGTH     @Y30LB25*/ 07424000
         LA    @08,36                                              1998 07425000
         ST    @08,RPLVBLN(,RPLVPTR)                               1998 07426000
*   RPLVRLN=LENGTH(INDEXBUF);       /* CIR LENGTH            @Y30LB25*/ 07427000
         ST    @08,RPLVRLN(,RPLVPTR)                               1999 07428000
*   RPLVBUF=INDEXPTR;               /* ADDR OF CIR BUF       @Y30LB25*/ 07429000
         ST    INDEXPTR,RPLVBUF(,RPLVPTR)                          2000 07430000
*   RPLVUPD=OFF;                    /* NO UPDATE             @Y30LB25*/ 07431000
         NI    RPLVUPD(RPLVPTR),B'11111101'                        2001 07432000
*   RPLVTYP=RPLVPUT;                /* PUT NEW RECORD        @Y30LB25*/ 07433000
         MVI   RPLVTYP(RPLVPTR),X'01'                              2002 07434000
*   RESPECIFY                       /*                       @Y30LB25*/ 07435000
*     RG1 RSTD;                     /* RESTRICT REG 1        @Y30LB25*/ 07436000
*   RG1=RPLVPTR;                    /* SET RPLV PTR          @Y30LB25*/ 07437000
         LR    RG1,RPLVPTR                                         2004 07438000
*   CALL ICBVIO00;                  /* WRITE CIR FOR CSN1    @Y30LB25*/ 07439000
         L     @15,@CV00610                                        2005 07440000
         BALR  @14,@15                                             2005 07441000
*   RESPECIFY                       /*                       @Y30LB25*/ 07442000
*     RG1 UNRSTD;                   /* UNRESTRICT REG 1      @Y30LB25*/ 07443000
*   RETURN;                         /*                       @Y30LB25*/ 07444000
@EL00034 DS    0H                                                  2007 07445000
@EF00034 DS    0H                                                  2007 07446000
@ER00034 L     @14,@SA00034                                        2007 07447000
         BR    @14                                                 2007 07448000
*   END CWCIR;                      /*                       @Y30LB25*/ 07449000
*   RESPECIFY                       /*                       @Y30LB25*/ 07450000
*     RPLVPTR UNRSTD;               /* UNRESTRICT REG 2      @Y30LB25*/ 07451000
*   END ICBVMS00                    /* THE END               @Y30LB25*/ 07452000
*                                                                  2010 07453000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 07454000
*/*%INCLUDE SYSLIB  (IEZVVICB)                                       */ 07455000
*/*%INCLUDE SYSLIB  (IEZRPLV )                                       */ 07456000
*/*%INCLUDE SYSLIB  (IEZMESG )                                       */ 07457000
*/*%INCLUDE SYSLIB  (IEZINDEX)                                       */ 07458000
*/*%INCLUDE SYSLIB  (IEZGROUP)                                       */ 07459000
*/*%INCLUDE SYSLIB  (IEZBCDV )                                       */ 07460000
*/*%INCLUDE SYSLIB  (IEZBASEV)                                       */ 07461000
*/*%INCLUDE SYSLIB  (IEZCOPYV)                                       */ 07462000
*/*%INCLUDE SYSLIB  (IEZDUPV )                                       */ 07463000
*/*%INCLUDE SYSLIB  (IEZMSGRQ)                                       */ 07464000
*                                                                  2010 07465000
*       ;                                                          2010 07466000
         B     @EL00001                                            2010 07467000
@DATA    DS    0H                                                       07468000
         DS    0F                                                       07469000
@AL01386 EQU   *                       LIST WITH   4 ARGUMENT(S)        07470000
@AL01952 DC    A(@CF00083)             LIST WITH   4 ARGUMENT(S)        07471000
         DC    A(BASEVPTR)                                              07472000
         DC    A(@TF00001)                                              07473000
         DC    A(BYTEPASS)                                              07474000
@AL01901 EQU   *                       LIST WITH   4 ARGUMENT(S)        07475000
@AL01927 DC    A(GROUPPTR)             LIST WITH   4 ARGUMENT(S)        07476000
         DC    A(BASEVPTR)                                              07477000
         DC    A(@TF00001)                                              07478000
         DC    A(BYTEPASS)                                              07479000
@AL01960 EQU   *                       LIST WITH   6 ARGUMENT(S)        07480000
@AL01974 DC    A(DUPVPTR)              LIST WITH   4 ARGUMENT(S)        07481000
         DC    A(PTRBASEV)                                              07482000
         DC    A(@TF00001)                                              07483000
         DC    A(BYTEPASS)                                              07484000
         DC    A(@CF00083)                                              07485000
         DC    A(@CF00083)                                              07486000
@AL01964 DC    A(@CF00083)             LIST WITH   4 ARGUMENT(S)        07487000
         DC    A(PTRBASEV)                                              07488000
         DC    A(@TF00001)                                              07489000
         DC    A(BYTEPASS)                                              07490000
         DS    0F                                                       07491000
@SA00001 DS    18F                                                      07492000
@PC00001 DS    4F                                                       07493000
@SA00004 DS    1F                                                       07494000
@SA00007 DS    1F                                                       07495000
@SA00008 DS    1F                                                       07496000
@SA00009 DS    1F                                                       07497000
@SA00005 DS    1F                                                       07498000
@SA00006 DS    1F                                                       07499000
@SA00026 DS    1F                                                       07500000
@SA00027 DS    1F                                                       07501000
@SA00010 DS    1F                                                       07502000
@SA00011 DS    1F                                                       07503000
@SA00015 DS    1F                                                       07504000
@SA00019 DS    1F                                                       07505000
@SA00023 DS    1F                                                       07506000
@SA00012 DS    1F                                                       07507000
@SA00016 DS    1F                                                       07508000
@SA00020 DS    1F                                                       07509000
@SA00013 DS    1F                                                       07510000
@SA00014 DS    1F                                                       07511000
@SA00017 DS    1F                                                       07512000
@SA00018 DS    1F                                                       07513000
@SA00021 DS    1F                                                       07514000
@SA00022 DS    1F                                                       07515000
@SA00024 DS    1F                                                       07516000
@SA00025 DS    1F                                                       07517000
@SA00028 DS    1F                                                       07518000
@SA00032 DS    1F                                                       07519000
@SA00029 DS    1F                                                       07520000
@SA00030 DS    1F                                                       07521000
@SA00033 DS    0F                                                       07522000
@SA00031 DS    0F                                                       07523000
@SA00034 DS    0F                                                       07524000
@SA00002 DS    0F                                                       07525000
@SA00003 DS    0F                                                       07526000
         DS    1F                                                       07527000
@AL00001 DS    6A                                                       07528000
@TF00001 DS    F                                                        07529000
         DS    0F                                                       07530000
@CF00083 DC    F'0'                                                     07531000
@CF00045 DC    F'1'                                                     07532000
@CF00806 DC    F'36'                                                    07533000
@CF00807 DC    F'65'                                                    07534000
@CF00805 DC    F'164'                                                   07535000
@CF00804 DC    F'224'                                                   07536000
@CF00546 DC    F'255'                                                   07537000
@CF00584 DC    F'412'                                                   07538000
@CF00552 DC    XL4'FFFFFFFF'                                            07539000
@CF00815 DC    XL4'0000FFFF'                                            07540000
@CF00550 DC    XL4'FFFF'                                                07541000
@CV00610 DC    V(ICBVIO00)                                              07542000
@CV00611 DC    V(ICBVRR00)                                              07543000
@CV00612 DC    V(ICBVJL00)                                              07544000
@CV00613 DC    V(ICBVOP00)                                              07545000
@CV00614 DC    V(ICBVUCHI)                                              07546000
@CV00615 DC    V(ICBVUCHO)                                              07547000
@CV00616 DC    V(ICBVUDBR)                                              07548000
@CV00617 DC    V(ICBVUEXT)                                              07549000
         DS    0D                                                       07550000
GROUPPTR DS    A                                                        07551000
BCDVPTR  DS    A                                                        07552000
BASEVPTR DS    A                                                        07553000
DUPVPTR  DS    A                                                        07554000
PTRBASEV DS    A                                                        07555000
MESLEN   DC    AL2(68)                                                  07556000
@CC00575 DC    C'             '                                         07557000
@CC00572 EQU   @CC00575                                                 07558000
@CC00466 DC    C'D    '                                                 07559000
@CC00555 DC    C'04'                                                    07560000
@CC00557 DC    C'0A'                                                    07561000
@CC00559 DC    C'0D'                                                    07562000
@CC00561 DC    C'83'                                                    07563000
@CB00552 DC    X'FFFFFFFF'                                              07564000
@CB00586 DC    X'0208'                                                  07565000
@CB00588 DC    X'0209'                                                  07566000
MSGRQ    DS    CL32                                                     07567000
         ORG   MSGRQ                                                    07568000
MSGID    DS    FL4                                                      07569000
MSGRPLV  DS    AL4                                                      07570000
MSGRLEN  DS    BL1                                                      07571000
MSGREPLY DS    AL3                                                      07572000
MSGLEN1  DS    BL1                                                      07573000
MSGTEXT1 DS    AL3                                                      07574000
MSGLEN2  DS    BL1                                                      07575000
MSGTEXT2 DS    AL3                                                      07576000
MSGLEN3  DS    BL1                                                      07577000
MSGTEXT3 DS    AL3                                                      07578000
MSGLEN4  DS    BL1                                                      07579000
MSGTEXT4 DS    AL3                                                      07580000
MSGLEN5  DS    BL1                                                      07581000
MSGTEXT5 DS    AL3                                                      07582000
         ORG   MSGRQ+32                                                 07583000
GROUPBUF DS    CL164                                                    07584000
GRECBF   DS    CL164                                                    07585000
BASEBUF  DS    CL224                                                    07586000
COPYBUF  DS    CL164                                                    07587000
INDEXBUF DS    CL36                                                     07588000
DUPVBUF  DS    CL224                                                    07589000
BCDRECBF DS    CL224                                                    07590000
GKEY     DS    CL13                                                     07591000
         ORG   GKEY                                                     07592000
GKY      DC    CL3'G  '                                                 07593000
GROUPKY  DS    CL8                                                      07594000
GBLKKY   DC    CL1' '                                                   07595000
GIDKY    DC    XL1'00'                                                  07596000
         ORG   GKEY+13                                                  07597000
         DS    CL3                                                      07598000
BKEY     DS    CL13                                                     07599000
         ORG   BKEY                                                     07600000
BKY      DC    CL5'V    '                                               07601000
BVOLKY   DS    CL6                                                      07602000
BBLKKY   DC    CL1' '                                                   07603000
BIDKY    DC    XL1'00'                                                  07604000
         ORG   BKEY+13                                                  07605000
         DS    CL3                                                      07606000
DKEY     DS    CL13                                                     07607000
         ORG   DKEY                                                     07608000
DKY      DC    CL5'D    '                                               07609000
DVOLKY   DS    CL6                                                      07610000
DBLKKY   DC    CL1' '                                                   07611000
DIDKY    DS    FL1                                                      07612000
         ORG   DKEY+13                                                  07613000
         DS    CL3                                                      07614000
CKEY     DS    CL13                                                     07615000
         ORG   CKEY                                                     07616000
CKY      DC    CL5'V    '                                               07617000
CVOLKY   DS    CL6                                                      07618000
CBLKKY   DC    CL1' '                                                   07619000
CIDKY    DS    FL1                                                      07620000
         ORG   CKEY+13                                                  07621000
         DS    CL3                                                      07622000
IKEY     DS    CL13                                                     07623000
         ORG   IKEY                                                     07624000
IKY      DC    CL1'I'                                                   07625000
IVOLKY   DS    CL12                                                     07626000
         ORG   IKEY+13                                                  07627000
         DS    CL3                                                      07628000
WORKAREA DS    CL19                                                     07629000
         ORG   WORKAREA                                                 07630000
REACODE  DS    CL2                                                      07631000
RETCODE  DS    CL2                                                      07632000
TEMPCKEY DS    CL13                                                     07633000
BYTEPASS DS    CL2                                                      07634000
         ORG   BYTEPASS                                                 07635000
GRPDV    DS    BL1                                                      07636000
FRSTDV   EQU   BYTEPASS+0                                               07637000
LASTDV   EQU   BYTEPASS+0                                               07638000
GRPFLG   EQU   BYTEPASS+0                                               07639000
ADDSUBGR EQU   BYTEPASS+0                                               07640000
CSNUMBER EQU   BYTEPASS+0                                               07641000
ADDSUBSL EQU   BYTEPASS+0                                               07642000
RPLVFLG  EQU   BYTEPASS+0                                               07643000
EXPSLOT  DS    BL1                                                      07644000
ADDSUB   EQU   BYTEPASS+1                                               07645000
@NM00029 EQU   BYTEPASS+1                                               07646000
         ORG   WORKAREA+19                                              07647000
         DS    CL1                                                      07648000
VMSPATCH DS    CL400                                                    07649000
         ORG   VMSPATCH                                                 07650000
@NM00030 DC    400X'00'                                                 07651000
         ORG   VMSPATCH+400                                             07652000
MSG412   DS    CL52                                                     07653000
         ORG   MSG412                                                   07654000
MSG      DC    CL7'MESSAGE'                                             07655000
FILL2    DC    CL1' '                                                   07656000
IDMSG    DS    CL2                                                      07657000
FILL3    DC    CL2'  '                                                  07658000
CODELAB  DC    CL4'CODE'                                                07659000
FILL4    DC    CL1' '                                                   07660000
MSGTCODE DS    CL1                                                      07661000
FILL5    DC    CL2'  '                                                  07662000
VOLID    DS    CL6                                                      07663000
FILL7    DC    CL1' '                                                   07664000
CSN1     DS    CL12                                                     07665000
FILL6    DC    CL1' '                                                   07666000
CSN2     DS    CL12                                                     07667000
         ORG   MSG412+52                                                07668000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       07669000
@01      EQU   01                                                       07670000
@02      EQU   02                                                       07671000
@03      EQU   03                                                       07672000
@04      EQU   04                                                       07673000
@05      EQU   05                                                       07674000
@06      EQU   06                                                       07675000
@07      EQU   07                                                       07676000
@08      EQU   08                                                       07677000
@09      EQU   09                                                       07678000
@10      EQU   10                                                       07679000
@11      EQU   11                                                       07680000
@12      EQU   12                                                       07681000
@13      EQU   13                                                       07682000
@14      EQU   14                                                       07683000
@15      EQU   15                                                       07684000
SAVCVRPT EQU   @08                                                      07685000
A        EQU   @03                                                      07686000
BCDTEMP  EQU   @03                                                      07687000
COPYVPTR EQU   @06                                                      07688000
INDEXPTR EQU   @07                                                      07689000
MESGPTR  EQU   @05                                                      07690000
VVIPTR   EQU   @03                                                      07691000
RPLVPTR  EQU   @02                                                      07692000
RG0      EQU   @00                                                      07693000
RG1      EQU   @01                                                      07694000
RG14     EQU   @14                                                      07695000
RG10     EQU   @10                                                      07696000
RG11     EQU   @11                                                      07697000
RG12     EQU   @12                                                      07698000
RG13     EQU   @13                                                      07699000
RG15     EQU   @15                                                      07700000
RG2      EQU   @02                                                      07701000
RG3      EQU   @03                                                      07702000
RG4      EQU   @04                                                      07703000
RG5      EQU   @05                                                      07704000
RG6      EQU   @06                                                      07705000
RG7      EQU   @07                                                      07706000
RG8      EQU   @08                                                      07707000
RG9      EQU   @09                                                      07708000
VVICB    EQU   0                                                        07709000
VVIFLGA  EQU   VVICB+15                                                 07710000
VVIFLG0  EQU   VVIFLGA                                                  07711000
RPLV     EQU   0                                                        07712000
RPLTCBPR EQU   RPLV+8                                                   07713000
RPLVVICB EQU   RPLV+12                                                  07714000
RPLFLAGA EQU   RPLV+28                                                  07715000
RPLRCODE EQU   RPLV+32                                                  07716000
RPLVRETC EQU   RPLV+34                                                  07717000
RPLVSAM  EQU   RPLV+56                                                  07718000
RPLVTYP  EQU   RPLVSAM+2                                                07719000
RPLVBUF  EQU   RPLVSAM+32                                               07720000
RPLVKEY  EQU   RPLVSAM+36                                               07721000
RPLVOPT  EQU   RPLVSAM+40                                               07722000
RPLVLOC  EQU   RPLVOPT                                                  07723000
RPLVDIR  EQU   RPLVOPT                                                  07724000
RPLVKGE  EQU   RPLVOPT                                                  07725000
RPLVUPD  EQU   RPLVOPT+1                                                07726000
RPLVRLN  EQU   RPLVSAM+48                                               07727000
RPLVBLN  EQU   RPLVSAM+52                                               07728000
RPLVUTIL EQU   RPLV+132                                                 07729000
MESG     EQU   0                                                        07730000
MESCODE  EQU   MESG+4                                                   07731000
MESGBUF  EQU   MESG+8                                                   07732000
INDEX    EQU   0                                                        07733000
INDNAME  EQU   INDEX                                                    07734000
INDI     EQU   INDNAME                                                  07735000
INDSERNO EQU   INDNAME+1                                                07736000
INDTYPE  EQU   INDEX+13                                                 07737000
INDINDEX EQU   INDTYPE                                                  07738000
INDRECKY EQU   INDEX+15                                                 07739000
INDPREFX EQU   INDRECKY                                                 07740000
INDALPHA EQU   INDPREFX                                                 07741000
INDVSRNO EQU   INDRECKY+5                                               07742000
INDRECID EQU   INDRECKY+11                                              07743000
INDEXREC EQU   INDRECID+1                                               07744000
GROUP    EQU   0                                                        07745000
GRONAME  EQU   GROUP                                                    07746000
GROID    EQU   GRONAME+11                                               07747000
GROFLAGA EQU   GROUP+13                                                 07748000
GROTYPE  EQU   GROFLAGA                                                 07749000
GRONGEN  EQU   GROUP+30                                                 07750000
GRONRSTD EQU   GROUP+32                                                 07751000
GRONINAC EQU   GROUP+34                                                 07752000
GROERRTS EQU   GROUP+56                                                 07753000
BCDV     EQU   0                                                        07754000
BCDNAME  EQU   BCDV                                                     07755000
BCDPREFX EQU   BCDNAME                                                  07756000
BCDID    EQU   BCDNAME+11                                               07757000
BCDFLAGA EQU   BCDV+14                                                  07758000
BCDTYPE  EQU   BCDFLAGA                                                 07759000
BCDFLAGB EQU   BCDFLAGA+2                                               07760000
BCDRCVYF EQU   BCDV+20                                                  07761000
BCDSATIA EQU   BCDRCVYF                                                 07762000
BCDMISCF EQU   BCDRCVYF+2                                               07763000
BCDCSN1  EQU   BCDV+24                                                  07764000
BCDLIB1  EQU   BCDV+36                                                  07765000
BCDLID1  EQU   BCDLIB1                                                  07766000
BCDCSN2  EQU   BCDV+37                                                  07767000
BCDLIB2  EQU   BCDV+49                                                  07768000
BCDLID2  EQU   BCDLIB2                                                  07769000
BASEV    EQU   0                                                        07770000
BASNAME  EQU   BASEV                                                    07771000
BASSERNO EQU   BASNAME+5                                                07772000
BASID    EQU   BASNAME+11                                               07773000
BASFLAGA EQU   BASEV+14                                                 07774000
BASTYPE  EQU   BASFLAGA                                                 07775000
BASBASVR EQU   BASTYPE                                                  07776000
BASDLSF  EQU   BASFLAGA+2                                               07777000
BASGRPV  EQU   BASFLAGA+2                                               07778000
BASGENUS EQU   BASFLAGA+2                                               07779000
BASRSTD  EQU   BASFLAGA+2                                               07780000
BASINAC  EQU   BASFLAGA+2                                               07781000
BASBIND  EQU   BASFLAGA+2                                               07782000
BASEXCL  EQU   BASFLAGA+2                                               07783000
BASDAERA EQU   BASFLAGA+3                                               07784000
BASRONLY EQU   BASFLAGA+3                                               07785000
BASREASS EQU   BASFLAGA+3                                               07786000
BASFIRST EQU   BASFLAGA+3                                               07787000
BASLAST  EQU   BASFLAGA+3                                               07788000
BASRCVYF EQU   BASEV+20                                                 07789000
BASSATIA EQU   BASRCVYF                                                 07790000
BASMISCF EQU   BASRCVYF+2                                               07791000
BASCSN1  EQU   BASEV+24                                                 07792000
BASLIB1  EQU   BASEV+36                                                 07793000
BASLID1  EQU   BASLIB1                                                  07794000
BAS1BIT1 EQU   BASLID1                                                  07795000
BAS1BIT2 EQU   BASLID1                                                  07796000
BASCSN2  EQU   BASEV+37                                                 07797000
BASLIB2  EQU   BASEV+49                                                 07798000
BASLID2  EQU   BASLIB2                                                  07799000
BAS2BIT1 EQU   BASLID2                                                  07800000
BAS2BIT2 EQU   BASLID2                                                  07801000
BASPREV  EQU   BASEV+50                                                 07802000
BASNEXTV EQU   BASEV+56                                                 07803000
BASNCOPY EQU   BASEV+62                                                 07804000
BASNBKUP EQU   BASEV+63                                                 07805000
BASBKLMT EQU   BASEV+64                                                 07806000
BASFRESP EQU   BASEV+68                                                 07807000
BASLEXT  EQU   BASEV+70                                                 07808000
BASFREXT EQU   BASEV+72                                                 07809000
BASKLCPY EQU   BASEV+76                                                 07810000
BASCOPID EQU   BASKLCPY+11                                              07811000
BASDLMTD EQU   BASEV+92                                                 07812000
BASEXPDT EQU   BASEV+96                                                 07813000
BASDTREM EQU   BASEV+100                                                07814000
BASDESCR EQU   BASEV+104                                                07815000
BASOWNER EQU   BASEV+134                                                07816000
BASDEST  EQU   BASEV+144                                                07817000
BASRECOV EQU   BASEV+174                                                07818000
BASGROUP EQU   BASEV+180                                                07819000
COPYV    EQU   0                                                        07820000
COPNAME  EQU   COPYV                                                    07821000
COPSERNO EQU   COPNAME+5                                                07822000
COPID    EQU   COPNAME+11                                               07823000
COPFLAGA EQU   COPYV+14                                                 07824000
COPTYPE  EQU   COPFLAGA                                                 07825000
COPBKUP  EQU   COPFLAGA+2                                               07826000
COPDLSPF EQU   COPFLAGA+3                                               07827000
COPRCVYF EQU   COPYV+20                                                 07828000
COPSATIA EQU   COPRCVYF                                                 07829000
COPMISCF EQU   COPRCVYF+2                                               07830000
COPCSN1  EQU   COPYV+24                                                 07831000
COPLIB1  EQU   COPYV+36                                                 07832000
COPLID1  EQU   COPLIB1                                                  07833000
COP1BIT1 EQU   COPLID1                                                  07834000
COP1BIT2 EQU   COPLID1                                                  07835000
COPCSN2  EQU   COPYV+37                                                 07836000
COPLIB2  EQU   COPYV+49                                                 07837000
COPLID2  EQU   COPLIB2                                                  07838000
COP2BIT1 EQU   COPLID2                                                  07839000
COP2BIT2 EQU   COPLID2                                                  07840000
COPDTREM EQU   COPYV+54                                                 07841000
COPDEST  EQU   COPYV+88                                                 07842000
DUPV     EQU   0                                                        07843000
DUPNAME  EQU   DUPV                                                     07844000
DUPD     EQU   DUPNAME                                                  07845000
DUPSERNO EQU   DUPNAME+5                                                07846000
DUPID    EQU   DUPNAME+11                                               07847000
DUPBLANK EQU   DUPID                                                    07848000
DUPNO    EQU   DUPID+1                                                  07849000
DUPFLAGA EQU   DUPV+14                                                  07850000
DUPTYPE  EQU   DUPFLAGA                                                 07851000
DUPDUPLR EQU   DUPTYPE                                                  07852000
DUPRCVYF EQU   DUPV+20                                                  07853000
DUPCSN1  EQU   DUPV+24                                                  07854000
DUPLIB1  EQU   DUPV+36                                                  07855000
DUPLID1  EQU   DUPLIB1                                                  07856000
DUP1BIT1 EQU   DUPLID1                                                  07857000
DUP1BIT2 EQU   DUPLID1                                                  07858000
DUPCSN2  EQU   DUPV+37                                                  07859000
DUPLIB2  EQU   DUPV+49                                                  07860000
DUPLID2  EQU   DUPLIB2                                                  07861000
DUP2BIT1 EQU   DUPLID2                                                  07862000
DUP2BIT2 EQU   DUPLID2                                                  07863000
SMSG     EQU   0                                                        07864000
CODESM   EQU   SMSG+1                                                   07865000
VOLIDSM  EQU   SMSG+8                                                   07866000
VFSM     EQU   SMSG+14                                                  07867000
CECART   EQU   VFSM                                                     07868000
SECVOL   EQU   VFSM                                                     07869000
EXCLATTB EQU   VFSM                                                     07870000
BINDATTB EQU   VFSM                                                     07871000
RONLYATB EQU   VFSM                                                     07872000
CSN1SM   EQU   SMSG+24                                                  07873000
CSN2SM   EQU   SMSG+36                                                  07874000
USMSG    EQU   0                                                        07875000
CODEUSM  EQU   USMSG+1                                                  07876000
ADDRUSM  EQU   USMSG+2                                                  07877000
LUSM     EQU   ADDRUSM                                                  07878000
LUSM1    EQU   LUSM                                                     07879000
LUSM2    EQU   LUSM                                                     07880000
CSN1USM  EQU   USMSG+4                                                  07881000
CSN2USM  EQU   USMSG+16                                                 07882000
VOLIDUSM EQU   USMSG+28                                                 07883000
SEQNUM   EQU   USMSG+34                                                 07884000
PTRBCDV  EQU   0                                                        07885000
PTRRPLV  EQU   0                                                        07886000
PASSBYTE EQU   0                                                        07887000
PTRCOPYV EQU   0                                                        07888000
SMSGCOPY EQU   SMSG                                                     07889000
VOLIDCSM EQU   SMSGCOPY+12                                              07890000
NEWCSN   EQU   SMSGCOPY+20                                              07891000
OLDCSN   EQU   SMSGCOPY+32                                              07892000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    07893000
@NM00027 EQU   SMSGCOPY+18                                              07894000
@NM00026 EQU   SMSGCOPY+10                                              07895000
EJECTCD  EQU   SMSGCOPY+9                                               07896000
POSTCD   EQU   SMSGCOPY+8                                               07897000
@NM00025 EQU   SMSGCOPY                                                 07898000
@NM00028 EQU   USMSG+35                                                 07899000
XUSM     EQU   ADDRUSM+1                                                07900000
YUSM     EQU   ADDRUSM                                                  07901000
ZUSM     EQU   ADDRUSM                                                  07902000
LENUSM   EQU   USMSG                                                    07903000
ZSM      EQU   SMSG+23                                                  07904000
@NM00024 EQU   SMSG+15                                                  07905000
@NM00023 EQU   VFSM                                                     07906000
SCRATCH  EQU   VFSM                                                     07907000
@NM00022 EQU   VFSM                                                     07908000
MSGIDSM  EQU   SMSG+2                                                   07909000
LENSM    EQU   SMSG                                                     07910000
@NM00021 EQU   DUPV+50                                                  07911000
DUPRES4  EQU   DUPLIB2                                                  07912000
DUPRES3  EQU   DUPLIB1                                                  07913000
DUPMISCF EQU   DUPRCVYF+2                                               07914000
DUPSATIA EQU   DUPRCVYF                                                 07915000
@NM00020 EQU   DUPV+18                                                  07916000
@NM00019 EQU   DUPFLAGA+2                                               07917000
DUPRES2  EQU   DUPTYPE                                                  07918000
DUPRES1  EQU   DUPTYPE                                                  07919000
DUPRES5  EQU   DUPV+13                                                  07920000
@NM00018 EQU   COPYV+136                                                07921000
COPFREXT EQU   COPYV+132                                                07922000
COPLEXT  EQU   COPYV+130                                                07923000
COPFRESP EQU   COPYV+128                                                07924000
COPOWNER EQU   COPYV+118                                                07925000
COPDESCR EQU   COPYV+58                                                 07926000
COPDATE  EQU   COPYV+50                                                 07927000
COPRES5  EQU   COPLIB2                                                  07928000
COPRES4  EQU   COPLIB1                                                  07929000
@NM00017 EQU   COPMISCF                                                 07930000
COPHOLD  EQU   COPMISCF                                                 07931000
COPRES3  EQU   COPSATIA                                                 07932000
COPVSMIS EQU   COPSATIA                                                 07933000
COPIVCPY EQU   COPSATIA                                                 07934000
COPIVCRE EQU   COPSATIA                                                 07935000
@NM00016 EQU   COPYV+18                                                 07936000
@NM00015 EQU   COPFLAGA+3                                               07937000
COPRONLY EQU   COPFLAGA+3                                               07938000
COPDAERA EQU   COPFLAGA+2                                               07939000
COPEXCL  EQU   COPFLAGA+2                                               07940000
COPBIND  EQU   COPFLAGA+2                                               07941000
COPRSTD  EQU   COPFLAGA+2                                               07942000
COPGENUS EQU   COPFLAGA+2                                               07943000
COPVSAM  EQU   COPFLAGA+2                                               07944000
COPGROUP EQU   COPFLAGA+2                                               07945000
COPRES2  EQU   COPTYPE                                                  07946000
COPCOPYV EQU   COPTYPE                                                  07947000
COPRES1  EQU   COPTYPE                                                  07948000
COPRES6  EQU   COPYV+13                                                 07949000
COPNO    EQU   COPID+1                                                  07950000
COPBLANK EQU   COPID                                                    07951000
COPV     EQU   COPNAME                                                  07952000
@NM00014 EQU   BASEV+192                                                07953000
BASXPDT2 EQU   BASEV+188                                                07954000
BASRES6  EQU   BASEV+89                                                 07955000
BASCOPNO EQU   BASCOPID+1                                               07956000
BASCOPBK EQU   BASCOPID                                                 07957000
BASCOPSN EQU   BASKLCPY+5                                               07958000
BASCOPV  EQU   BASKLCPY                                                 07959000
@NM00013 EQU   BASEV+65                                                 07960000
BASRES5  EQU   BASLIB2                                                  07961000
BASRES4  EQU   BASLIB1                                                  07962000
BASRES3  EQU   BASMISCF                                                 07963000
BASHOLD  EQU   BASMISCF                                                 07964000
BASRES8  EQU   BASSATIA                                                 07965000
BASVSMIS EQU   BASSATIA                                                 07966000
BASIVCPY EQU   BASSATIA                                                 07967000
BASIVCRE EQU   BASSATIA                                                 07968000
BASCPUID EQU   BASEV+18                                                 07969000
@NM00012 EQU   BASFLAGA+3                                               07970000
BASNOCPY EQU   BASFLAGA+2                                               07971000
BASRES2  EQU   BASTYPE                                                  07972000
BASRES1  EQU   BASTYPE                                                  07973000
BASRES7  EQU   BASEV+13                                                 07974000
BASZERO  EQU   BASID+1                                                  07975000
BASBLANK EQU   BASID                                                    07976000
BASEVKEY EQU   BASNAME                                                  07977000
BCD2BIT2 EQU   BCDLID2                                                  07978000
BCD2BIT1 EQU   BCDLID2                                                  07979000
BCDRES8  EQU   BCDLIB2                                                  07980000
BCD1BIT2 EQU   BCDLID1                                                  07981000
BCD1BIT1 EQU   BCDLID1                                                  07982000
BCDRE10  EQU   BCDLIB1                                                  07983000
BCDRES7A EQU   BCDMISCF                                                 07984000
BCDHOLD  EQU   BCDMISCF                                                 07985000
BCDRES7  EQU   BCDSATIA                                                 07986000
BCDVSMIS EQU   BCDSATIA                                                 07987000
BCDIVCPY EQU   BCDSATIA                                                 07988000
BCDIVCRE EQU   BCDSATIA                                                 07989000
BCDCPUID EQU   BCDV+18                                                  07990000
BCDRES5  EQU   BCDFLAGB+1                                               07991000
BCDREASS EQU   BCDFLAGB+1                                               07992000
BCDRES4  EQU   BCDFLAGB                                                 07993000
BCDRES3  EQU   BCDTYPE                                                  07994000
BCDDUP   EQU   BCDTYPE                                                  07995000
BCDRES2  EQU   BCDTYPE                                                  07996000
BCDCOPY  EQU   BCDTYPE                                                  07997000
BCDBASE  EQU   BCDTYPE                                                  07998000
BCDRES1  EQU   BCDTYPE                                                  07999000
BCDRES9  EQU   BCDV+13                                                  08000000
BCDINDEX EQU   BCDID+1                                                  08001000
BCDBLNK2 EQU   BCDID                                                    08002000
BCDSERNO EQU   BCDNAME+5                                                08003000
BCDBLNK1 EQU   BCDPREFX+1                                               08004000
BCDALPHA EQU   BCDPREFX                                                 08005000
@NM00011 EQU   GROUP+136                                                08006000
GROADDR  EQU   GROUP+106                                                08007000
GROOWNER EQU   GROUP+96                                                 08008000
GRORESSP EQU   GROUP+95                                                 08009000
GROCONUS EQU   GROUP+94                                                 08010000
GRODESCR EQU   GROUP+64                                                 08011000
GROERRTM EQU   GROERRTS+4                                               08012000
GROERRDT EQU   GROERRTS                                                 08013000
GRORETPD EQU   GROUP+52                                                 08014000
GROFREXT EQU   GROUP+48                                                 08015000
GROFRESP EQU   GROUP+44                                                 08016000
GROSTRSH EQU   GROUP+40                                                 08017000
GROSSPD  EQU   GROUP+38                                                 08018000
GROPSPD  EQU   GROUP+36                                                 08019000
GROPCENT EQU   GROUP+29                                                 08020000
GROLSN   EQU   GROUP+23                                                 08021000
GROFSN   EQU   GROUP+17                                                 08022000
@NM00010 EQU   GROFLAGA+2                                               08023000
GROMSG1  EQU   GROFLAGA+2                                               08024000
GRORETN  EQU   GROFLAGA+2                                               08025000
GRORLSE  EQU   GROFLAGA+2                                               08026000
GRORONLY EQU   GROFLAGA+2                                               08027000
GRODAERA EQU   GROFLAGA+2                                               08028000
GROEXCL  EQU   GROFLAGA+2                                               08029000
GROBIND  EQU   GROFLAGA+2                                               08030000
GRORES1  EQU   GROTYPE                                                  08031000
GROGVR   EQU   GROTYPE                                                  08032000
GROZERO  EQU   GROID+1                                                  08033000
GROBLANK EQU   GROID                                                    08034000
GROVVGRP EQU   GRONAME+3                                                08035000
GROG     EQU   GRONAME                                                  08036000
@NM00009 EQU   INDEX+28                                                 08037000
INDBLNK2 EQU   INDRECID                                                 08038000
INDBLNK1 EQU   INDPREFX+1                                               08039000
INDRES2  EQU   INDTYPE                                                  08040000
INDRES1  EQU   INDTYPE                                                  08041000
@NM00008 EQU   MESCODE+1                                                08042000
MESOPCD  EQU   MESCODE                                                  08043000
MESLNGTH EQU   MESG                                                     08044000
@NM00007 EQU   RPLVSAM+44                                               08045000
@NM00006 EQU   RPLVOPT                                                  08046000
@NM00005 EQU   RPLVOPT                                                  08047000
RPLVNEXT EQU   RPLVOPT                                                  08048000
@NM00004 EQU   RPLVSAM+28                                               08049000
RPLVACB  EQU   RPLVSAM+24                                               08050000
@NM00003 EQU   RPLVSAM+3                                                08051000
@NM00002 EQU   RPLVSAM                                                  08052000
@NM00001 EQU   RPLV+42                                                  08053000
RPLVDATE EQU   RPLV+38                                                  08054000
RPLRMSCC EQU   RPLV+36                                                  08055000
RPLVTLEN EQU   RPLV+30                                                  08056000
RPLVRES1 EQU   RPLFLAGA+1                                               08057000
RPLVJRNL EQU   RPLFLAGA                                                 08058000
RPLJRCVY EQU   RPLFLAGA                                                 08059000
RPLVVOP  EQU   RPLFLAGA                                                 08060000
RPLVVIN  EQU   RPLFLAGA                                                 08061000
RPLVCOMP EQU   RPLFLAGA                                                 08062000
RPLVPROG EQU   RPLFLAGA                                                 08063000
RPLVPOST EQU   RPLFLAGA                                                 08064000
RPLFTIME EQU   RPLFLAGA                                                 08065000
RPLVRSV3 EQU   RPLV+24                                                  08066000
RPLVRSV2 EQU   RPLV+20                                                  08067000
RPLVRSV1 EQU   RPLV+16                                                  08068000
RPLASCBP EQU   RPLTCBPR                                                 08069000
RPLVECB  EQU   RPLV+4                                                   08070000
RPLVQPTR EQU   RPLV                                                     08071000
VVIUNUSD EQU   VVICB+116                                                08072000
VVINUSDC EQU   VVICB+112                                                08073000
VVITPFCH EQU   VVICB+108                                                08074000
VVIDVMEL EQU   VVICB+104                                                08075000
VVIVBSTF EQU   VVICB+100                                                08076000
VVISSOBA EQU   VVICB+96                                                 08077000
VVIVSCRA EQU   VVICB+92                                                 08078000
VVISTPTB EQU   VVICB+88                                                 08079000
VVIDVMTA EQU   VVICB+84                                                 08080000
VVIJUCB  EQU   VVICB+80                                                 08081000
VVIIUCB  EQU   VVICB+76                                                 08082000
VVIRES6  EQU   VVICB+72                                                 08083000
VVIRES5  EQU   VVICB+68                                                 08084000
VVIRES4  EQU   VVICB+64                                                 08085000
VVIUCB   EQU   VVICB+60                                                 08086000
VVIVJL   EQU   VVICB+56                                                 08087000
VVIVRR   EQU   VVICB+52                                                 08088000
VVIQLSPL EQU   VVICB+48                                                 08089000
VVIQRPL2 EQU   VVICB+44                                                 08090000
VVIQRPL1 EQU   VVICB+40                                                 08091000
VVIRES3  EQU   VVICB+36                                                 08092000
VVIVQMP  EQU   VVICB+32                                                 08093000
VVIECB1  EQU   VVICB+28                                                 08094000
VVICATAD EQU   VVICB+24                                                 08095000
VVIDCBAD EQU   VVICB+20                                                 08096000
VVIACBAD EQU   VVICB+16                                                 08097000
VVIFLG7  EQU   VVIFLGA                                                  08098000
VVIFLG6  EQU   VVIFLGA                                                  08099000
VVIFLG5  EQU   VVIFLGA                                                  08100000
VVIFLG4  EQU   VVIFLGA                                                  08101000
VVIFLG3  EQU   VVIFLGA                                                  08102000
VVIFLG2  EQU   VVIFLGA                                                  08103000
VVIFLG1  EQU   VVIFLGA                                                  08104000
VVIALCON EQU   VVICB+14                                                 08105000
VVICPUID EQU   VVICB+12                                                 08106000
VVIUCAT  EQU   VVICB+4                                                  08107000
VVICID   EQU   VVICB                                                    08108000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      08109000
@RT00135 EQU   @EL00001                                                 08110000
@RT00142 EQU   @EL00001                                                 08111000
@RF00153 EQU   @EL00001                                                 08112000
@RF00207 EQU   @EL00003                                                 08113000
@RF00256 EQU   @EL00005                                                 08114000
@RF00357 EQU   @EL00007                                                 08115000
@RF00444 EQU   @EL00008                                                 08116000
@RF00579 EQU   @EL00011                                                 08117000
@RF00651 EQU   @EL00012                                                 08118000
@RF00711 EQU   @EL00013                                                 08119000
@RF00728 EQU   @EL00013                                                 08120000
@RF00764 EQU   @EL00014                                                 08121000
@RF00781 EQU   @EL00014                                                 08122000
@RF00832 EQU   @EL00015                                                 08123000
@RF00911 EQU   @EL00016                                                 08124000
@RF00975 EQU   @EL00017                                                 08125000
@RF00992 EQU   @EL00017                                                 08126000
@RF01028 EQU   @EL00018                                                 08127000
@RF01045 EQU   @EL00018                                                 08128000
@RF01096 EQU   @EL00019                                                 08129000
@RF01175 EQU   @EL00020                                                 08130000
@RF01239 EQU   @EL00021                                                 08131000
@RF01256 EQU   @EL00021                                                 08132000
@RF01292 EQU   @EL00022                                                 08133000
@RF01309 EQU   @EL00022                                                 08134000
@RF01355 EQU   @RC01347                                                 08135000
@RF01450 EQU   @RC01442                                                 08136000
@RF01491 EQU   @EL00026                                                 08137000
@RT01529 EQU   @EL00027                                                 08138000
@RT01542 EQU   @EL00027                                                 08139000
@RT01544 EQU   @EL00027                                                 08140000
@RT01552 EQU   @EL00027                                                 08141000
@RT01581 EQU   @EL00028                                                 08142000
@RT01588 EQU   @EL00028                                                 08143000
@RT01605 EQU   @EL00028                                                 08144000
@RT01615 EQU   @EL00028                                                 08145000
@RT01634 EQU   @EL00029                                                 08146000
@RT01642 EQU   @EL00029                                                 08147000
@RT01646 EQU   @EL00029                                                 08148000
@RT01661 EQU   @EL00029                                                 08149000
@RT01671 EQU   @EL00029                                                 08150000
@RT01700 EQU   @EL00030                                                 08151000
@RT01729 EQU   @EL00030                                                 08152000
@RT01748 EQU   @EL00031                                                 08153000
@RT01769 EQU   @EL00031                                                 08154000
@RF01754 EQU   @EL00031                                                 08155000
@RT01792 EQU   @EL00032                                                 08156000
@RT01803 EQU   @EL00032                                                 08157000
@RT01818 EQU   @EL00032                                                 08158000
@RT01827 EQU   @EL00032                                                 08159000
@RT01831 EQU   @EL00032                                                 08160000
@RT01844 EQU   @EL00032                                                 08161000
@RT01859 EQU   @EL00032                                                 08162000
@RT01869 EQU   @EL00032                                                 08163000
@RT01892 EQU   @EL00033                                                 08164000
@RT01902 EQU   @EL00033                                                 08165000
@RT01915 EQU   @EL00033                                                 08166000
@RT01921 EQU   @EL00033                                                 08167000
@RT01928 EQU   @EL00033                                                 08168000
@RT01946 EQU   @EL00033                                                 08169000
@RF01949 EQU   @EL00033                                                 08170000
@RT01961 EQU   @EL00033                                                 08171000
@RT01965 EQU   @EL00033                                                 08172000
@RT01975 EQU   @EL00033                                                 08173000
@ENDDATA EQU   *                                                        08174000
         END   ICBVMS00,(C'PLS1923',0603,76348)                         08175000
