         TITLE 'ICBVOP00 MSVC OPERATOR/LIBRARIAN (JULY 30, 1974) MVS   *00001000
                        '                                               00002000
ICBVOP00 CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'ICBVOP00  77.070'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00010000
         BALR  @12,0                                               0001 00011000
@PSTART  DS    0H                                                  0001 00012000
         USING @PSTART,@12                                         0001 00013000
         L     @00,@SIZDATD                                        0001 00014000
         GETMAIN  R,LV=(0)                                              00015000
         LR    @11,@01                                             0001 00016000
         USING @DATD,@11                                           0001 00017000
         ST    @13,@SA00001+4                                      0001 00018000
         LM    @00,@01,20(@13)                                     0001 00019000
         ST    @11,8(,@13)                                         0001 00020000
         LR    @13,@11                                             0001 00021000
*   MSGPTR=REG1;                    /* ADDR REQUEST BLK      @Y30LB26*/ 00022000
         LR    MSGPTR,REG1                                         0068 00023000
*   RESPECIFY                                                      0069 00024000
*     REG1 UNRSTD;                  /* FREE REG 1            @Y30LB26*/ 00025000
*                                                                  0069 00026000
*   /*****************************************************************/ 00027000
*   /*                                                               */ 00028000
*   /* SET UP ADDRESSABILITY TO THE RPLV AND MSVC CONTROL    @Y30LB26*/ 00029000
*   /* BLOCK                                                 @Y30LB26*/ 00030000
*   /*                                                               */ 00031000
*   /*****************************************************************/ 00032000
*                                                                  0070 00033000
*   RPLVPTR=MSGRPLV;                /* ADDR OF RPLV          @Y30LB26*/ 00034000
         L     RPLVPTR,MSGRPLV(,MSGPTR)                            0070 00035000
*   VVIPTR=RPLVVICB;                /* ADDR MSVC CB          @Y30LB26*/ 00036000
         L     VVIPTR,RPLVVICB(,RPLVPTR)                           0071 00037000
*   SWITCHES=OFF;                   /*                       @ZM30991*/ 00038000
*                                                                  0072 00039000
         MVI   SWITCHES,B'00000000'                                0072 00040000
*   /*****************************************************************/ 00041000
*   /*                                                               */ 00042000
*   /* MOVE EXPANDED WTO AMD WTOR MACROES TO DSECT           @VS32893*/ 00043000
*   /*                                                               */ 00044000
*   /*****************************************************************/ 00045000
*                                                                  0073 00046000
*   WTO=WTOMSG;                     /* MOVE WTO MACRO        @VS32893*/ 00047000
         MVC   WTO(80),WTOMSG                                      0073 00048000
*   WTOR=WTORMSG;                   /* MOVE WTOR MACRO       @VS32893*/ 00049000
*                                                                  0074 00050000
         MVC   WTOR(88),WTORMSG                                    0074 00051000
*   /*****************************************************************/ 00052000
*   /*                                                               */ 00053000
*   /* SET UP INDEX TO MESSAGES AND SEE IF A VALID INDEX     @Y30LB26*/ 00054000
*   /* WAS GIVEN                                             @Y30LB26*/ 00055000
*   /* ZERO ROUTING CODE                                     @Y30LB26*/ 00056000
*   /*                                                               */ 00057000
*   /*****************************************************************/ 00058000
*                                                                  0075 00059000
*   LIBROUT=BITZERO;                /* ZERO ROUTING          @Y30LB26*/ 00060000
         MVC   LIBROUT(2),@CB00154                                 0075 00061000
*   I=MSGID-TRE99;                  /* SET MESSAGE INDEX     @Y30LB26*/ 00062000
         L     I,MSGID(,MSGPTR)                                    0076 00063000
         SL    I,@CF00157                                          0076 00064000
*   IF I>MSGLIMIT|I<=ZERO|MSGTBL(I)=ZERO THEN/*              @Y30LB26*/ 00065000
*                                                                  0077 00066000
         L     @10,@CV00137                                        0077 00067000
         L     @10,LIMITADR(,@10)                                  0077 00068000
         C     I,MSGLIMIT(,@10)                                    0077 00069000
         BH    @RT00077                                            0077 00070000
         SLR   @10,@10                                             0077 00071000
         CR    I,@10                                               0077 00072000
         BNH   @RT00077                                            0077 00073000
         LR    @07,I                                               0077 00074000
         SLA   @07,2                                               0077 00075000
         L     @03,@CV00137                                        0077 00076000
         C     @10,MSGTBL(@07,@03)                                 0077 00077000
         BNE   @RF00077                                            0077 00078000
@RT00077 DS    0H                                                  0078 00079000
*     /***************************************************************/ 00080000
*     /*                                                             */ 00081000
*     /* IF INVALID INDEX GIVEN, PUT OUT ERROR MESSAGE       @Y30LB26*/ 00082000
*     /*                                                             */ 00083000
*     /***************************************************************/ 00084000
*                                                                  0078 00085000
*     DO;                           /*                       @Y30LB26*/ 00086000
*       I=MYMSGID-TRE99;            /* SET NEW ID            @Y30LB26*/ 00087000
         LA    I,22                                                0079 00088000
*       CVD(MSGID,DECID);           /* CONVRT USRS MSGID     @Y30LB26*/ 00089000
         L     @10,MSGID(,MSGPTR)                                  0080 00090000
         CVD   @10,@TS00001                                        0080 00091000
         MVC   DECID(4),@TS00001+4                                 0080 00092000
*       UNPK(PRINTID,DECID);        /* MAKE PRINTABLE        @Y30LB26*/ 00093000
         UNPK  PRINTID(4),DECID(4)                                 0081 00094000
*       PRINTID(4)=PRINTID(4)|ORID; /* FIX SIGN TO F         @Y30LB26*/ 00095000
         OC    PRINTID+3(1),ORID                                   0082 00096000
*       MSGLEN1=FOUR;               /* LENGTH FOUR           @Y30LB26*/ 00097000
         MVI   MSGLEN1(MSGPTR),X'04'                               0083 00098000
*       MSGTEXT1=ADDR(PRINTID);     /* ADDR TEXT INSRT       @Y30LB26*/ 00099000
         LA    @10,PRINTID                                         0084 00100000
         STCM  @10,7,MSGTEXT1(MSGPTR)                              0084 00101000
*       MSGLEN2=ZERO;               /* ZERO LENGTH           @Y30LB26*/ 00102000
         MVI   MSGLEN2(MSGPTR),X'00'                               0085 00103000
*       MSGLEN3=ZERO;               /* ZERO LENGTH           @Y30LB26*/ 00104000
         MVI   MSGLEN3(MSGPTR),X'00'                               0086 00105000
*       MSGLEN4=ZERO;               /* ZERO LENGTH           @Y30LB26*/ 00106000
         MVI   MSGLEN4(MSGPTR),X'00'                               0087 00107000
*       MSGLEN5=ZERO;               /* ZERO LENGTH           @Y30LB26*/ 00108000
         MVI   MSGLEN5(MSGPTR),X'00'                               0088 00109000
*     END;                          /*                       @Y30LB26*/ 00110000
*                                                                  0090 00111000
*   /*****************************************************************/ 00112000
*   /*                                                               */ 00113000
*   /* BLANK OUT MESSAGE BUFFER AND MOVE IN SKELETON MESSAGE @Y30LB26*/ 00114000
*   /*                                                               */ 00115000
*   /*****************************************************************/ 00116000
*                                                                  0090 00117000
*   MESGBUF=BLANK;                  /* BLANK BUFFER          @Y30LB26*/ 00118000
@RF00077 MVI   MESGBUF+1,C' '                                      0090 00119000
         MVC   MESGBUF+2(70),MESGBUF+1                             0090 00120000
         MVI   MESGBUF,C' '                                        0090 00121000
*   MESGBUF=MESGSKEL(1:MESGLEN);    /* SKELETON MESSAGE      @Y30LB26*/ 00122000
*                                                                  0091 00123000
         MVI   MESGBUF+1,C' '                                      0091 00124000
         MVC   MESGBUF+2(70),MESGBUF+1                             0091 00125000
         LR    @10,I                                               0091 00126000
         SLA   @10,2                                               0091 00127000
         LA    @07,4                                               0091 00128000
         L     @03,@CV00137                                        0091 00129000
         ALR   @03,@07                                             0091 00130000
         AL    @03,@CF00294                                        0091 00131000
         L     @03,MSGTBL(@10,@03)                                 0091 00132000
         SLR   @15,@15                                             0091 00133000
         IC    @15,MESGLEN(,@03)                                   0091 00134000
         BCTR  @15,0                                               0091 00135000
         L     @03,@CV00137                                        0091 00136000
         ALR   @03,@07                                             0091 00137000
         AL    @03,@CF00294                                        0091 00138000
         L     @03,MSGTBL(@10,@03)                                 0091 00139000
         EX    @15,@SM00295                                        0091 00140000
*   /*****************************************************************/ 00141000
*   /*                                                               */ 00142000
*   /* SEE IF FIRST SUBSTITUTION WAS REQUESTED AND           @Y30LB26*/ 00143000
*   /* CHECK STATIC TEXT TO SEE IF IT EXPECTS A SUBSTITUTION @Y30LB26*/ 00144000
*   /* CHECK LENGTH TO BE SURE THAT IT IS NOT TOO LONG       @Y30LB26*/ 00145000
*   /*                                                               */ 00146000
*   /*****************************************************************/ 00147000
*                                                                  0092 00148000
*   IF MSGLEN1^=ZERO&MESGLEN1^=ZERO THEN/* PARAMETER SPEC?   @Y30LB26*/ 00149000
*                                                                  0092 00150000
         CLI   MSGLEN1(MSGPTR),0                                   0092 00151000
         BE    @RF00092                                            0092 00152000
         L     @03,@CV00137                                        0092 00153000
         ALR   @03,@07                                             0092 00154000
         AL    @03,@CF00294                                        0092 00155000
         L     @03,MSGTBL(@10,@03)                                 0092 00156000
         CLI   MESGLEN1(@03),0                                     0092 00157000
         BE    @RF00092                                            0092 00158000
*     /***************************************************************/ 00159000
*     /*                                                             */ 00160000
*     /* IF TOO LONG, SET TO MAXIMUM ALLOWED VALUE AND       @Y30LB26*/ 00161000
*     /* MOVE FIRST TEXT SECTION INTO MESSAGE                @Y30LB26*/ 00162000
*     /*                                                             */ 00163000
*     /***************************************************************/ 00164000
*                                                                  0093 00165000
*     DO;                           /*                       @Y30LB26*/ 00166000
*       IF MSGLEN1>MESGLEN1 THEN    /* SEE IF TOO LONG       @Y30LB26*/ 00167000
         L     @03,@CV00137                                        0094 00168000
         ALR   @03,@07                                             0094 00169000
         AL    @03,@CF00294                                        0094 00170000
         L     @03,MSGTBL(@10,@03)                                 0094 00171000
         CLC   MSGLEN1(1,MSGPTR),MESGLEN1(@03)                     0094 00172000
         BNH   @RF00094                                            0094 00173000
*         MSGLEN1=MESGLEN1;         /* IF LONG, SHORTEN      @Y30LB26*/ 00174000
         L     @03,@CV00137                                        0095 00175000
         ALR   @03,@07                                             0095 00176000
         AL    @03,@CF00294                                        0095 00177000
         L     @10,MSGTBL(@10,@03)                                 0095 00178000
         MVC   MSGLEN1(1,MSGPTR),MESGLEN1(@10)                     0095 00179000
*       MESGBUF(MESGLOC1:MESGLOC1+MSGLEN1-1)=/*              @Y30LB26*/ 00180000
*           TEXT1(1:MSGLEN1);       /*                       @Y30LB26*/ 00181000
@RF00094 LR    @10,I                                               0096 00182000
         SLA   @10,2                                               0096 00183000
         L     @07,@CV00137                                        0096 00184000
         L     @10,MSGTBL(@10,@07)                                 0096 00185000
         SLR   @07,@07                                             0096 00186000
         IC    @07,MESGLOC1(,@10)                                  0096 00187000
         LA    @10,MESGBUF-1(@07)                                  0096 00188000
         SLR   @07,@07                                             0096 00189000
         IC    @07,MSGLEN1(,MSGPTR)                                0096 00190000
         BCTR  @07,0                                               0096 00191000
         L     @03,MSGTEXT1-1(,MSGPTR)                             0096 00192000
         LA    @03,0(,@03)                                         0096 00193000
         EX    @07,@SM00297                                        0096 00194000
*     END;                          /*                       @Y30LB26*/ 00195000
*                                                                  0097 00196000
*   /*****************************************************************/ 00197000
*   /*                                                               */ 00198000
*   /* DO SAME FOR SECOND TEXT SUBSTITUTION                  @Y30LB26*/ 00199000
*   /*                                                               */ 00200000
*   /*****************************************************************/ 00201000
*                                                                  0098 00202000
*   IF MSGLEN2^=ZERO&MESGLEN2^=ZERO THEN/* PARAMETER SPEC?   @Y30LB26*/ 00203000
@RF00092 CLI   MSGLEN2(MSGPTR),0                                   0098 00204000
         BE    @RF00098                                            0098 00205000
         LR    @10,I                                               0098 00206000
         SLA   @10,2                                               0098 00207000
         LA    @07,4                                               0098 00208000
         L     @03,@CV00137                                        0098 00209000
         ALR   @03,@07                                             0098 00210000
         AL    @03,@CF00294                                        0098 00211000
         L     @03,MSGTBL(@10,@03)                                 0098 00212000
         CLI   MESGLEN2(@03),0                                     0098 00213000
         BE    @RF00098                                            0098 00214000
*     DO;                           /*                       @Y30LB26*/ 00215000
*       IF MSGLEN2>MESGLEN2 THEN    /* SEE IF TOO LONG       @Y30LB26*/ 00216000
         L     @03,@CV00137                                        0100 00217000
         ALR   @03,@07                                             0100 00218000
         AL    @03,@CF00294                                        0100 00219000
         L     @03,MSGTBL(@10,@03)                                 0100 00220000
         CLC   MSGLEN2(1,MSGPTR),MESGLEN2(@03)                     0100 00221000
         BNH   @RF00100                                            0100 00222000
*         MSGLEN2=MESGLEN2;         /* IF LONG, SHORTEN      @Y30LB26*/ 00223000
         L     @03,@CV00137                                        0101 00224000
         ALR   @03,@07                                             0101 00225000
         AL    @03,@CF00294                                        0101 00226000
         L     @10,MSGTBL(@10,@03)                                 0101 00227000
         MVC   MSGLEN2(1,MSGPTR),MESGLEN2(@10)                     0101 00228000
*       MESGBUF(MESGLOC2:MESGLOC2+MSGLEN2-1)=/*              @Y30LB26*/ 00229000
*           TEXT2(1:MSGLEN2);       /*                       @Y30LB26*/ 00230000
@RF00100 LR    @10,I                                               0102 00231000
         SLA   @10,2                                               0102 00232000
         L     @07,@CV00137                                        0102 00233000
         L     @10,MSGTBL(@10,@07)                                 0102 00234000
         SLR   @07,@07                                             0102 00235000
         IC    @07,MESGLOC2(,@10)                                  0102 00236000
         LA    @10,MESGBUF-1(@07)                                  0102 00237000
         SLR   @07,@07                                             0102 00238000
         IC    @07,MSGLEN2(,MSGPTR)                                0102 00239000
         BCTR  @07,0                                               0102 00240000
         L     @03,MSGTEXT2-1(,MSGPTR)                             0102 00241000
         LA    @03,0(,@03)                                         0102 00242000
         EX    @07,@SM00299                                        0102 00243000
*     END;                          /*                       @Y30LB26*/ 00244000
*                                                                  0103 00245000
*   /*****************************************************************/ 00246000
*   /*                                                               */ 00247000
*   /* DO SAME FOR THIRD TEXT SUBSTITUTION                   @Y30LB26*/ 00248000
*   /*                                                               */ 00249000
*   /*****************************************************************/ 00250000
*                                                                  0104 00251000
*   IF MSGLEN3^=ZERO&MESGLEN3^=ZERO THEN/* PARM SPECIFIED?   @Y30LB26*/ 00252000
@RF00098 CLI   MSGLEN3(MSGPTR),0                                   0104 00253000
         BE    @RF00104                                            0104 00254000
         LR    @10,I                                               0104 00255000
         SLA   @10,2                                               0104 00256000
         LA    @07,4                                               0104 00257000
         L     @03,@CV00137                                        0104 00258000
         ALR   @03,@07                                             0104 00259000
         AL    @03,@CF00294                                        0104 00260000
         L     @03,MSGTBL(@10,@03)                                 0104 00261000
         CLI   MESGLEN3(@03),0                                     0104 00262000
         BE    @RF00104                                            0104 00263000
*     DO;                           /*                       @Y30LB26*/ 00264000
*       IF MSGLEN3>MESGLEN3 THEN    /* SEE IF TOO LONG       @Y30LB26*/ 00265000
         L     @03,@CV00137                                        0106 00266000
         ALR   @03,@07                                             0106 00267000
         AL    @03,@CF00294                                        0106 00268000
         L     @03,MSGTBL(@10,@03)                                 0106 00269000
         CLC   MSGLEN3(1,MSGPTR),MESGLEN3(@03)                     0106 00270000
         BNH   @RF00106                                            0106 00271000
*         MSGLEN3=MESGLEN3;         /* IF LONG, SHORTEN      @Y30LB26*/ 00272000
         L     @03,@CV00137                                        0107 00273000
         ALR   @03,@07                                             0107 00274000
         AL    @03,@CF00294                                        0107 00275000
         L     @10,MSGTBL(@10,@03)                                 0107 00276000
         MVC   MSGLEN3(1,MSGPTR),MESGLEN3(@10)                     0107 00277000
*       MESGBUF(MESGLOC3:MESGLOC3+MSGLEN3-1)=/*              @Y30LB26*/ 00278000
*           TEXT3(1:MSGLEN3);       /*                       @Y30LB26*/ 00279000
@RF00106 LR    @10,I                                               0108 00280000
         SLA   @10,2                                               0108 00281000
         L     @07,@CV00137                                        0108 00282000
         L     @10,MSGTBL(@10,@07)                                 0108 00283000
         SLR   @07,@07                                             0108 00284000
         IC    @07,MESGLOC3(,@10)                                  0108 00285000
         LA    @10,MESGBUF-1(@07)                                  0108 00286000
         SLR   @07,@07                                             0108 00287000
         IC    @07,MSGLEN3(,MSGPTR)                                0108 00288000
         BCTR  @07,0                                               0108 00289000
         L     @03,MSGTEXT3-1(,MSGPTR)                             0108 00290000
         LA    @03,0(,@03)                                         0108 00291000
         EX    @07,@SM00301                                        0108 00292000
*     END;                          /*                       @Y30LB26*/ 00293000
*                                                                  0109 00294000
*   /*****************************************************************/ 00295000
*   /*                                                               */ 00296000
*   /* DO SAME FOR FOURTH                                    @Y30LB26*/ 00297000
*   /*                                                               */ 00298000
*   /*****************************************************************/ 00299000
*                                                                  0110 00300000
*   IF MSGLEN4^=ZERO&MESGLEN4^=ZERO THEN/* PARM SPEC?        @Y30LB26*/ 00301000
@RF00104 CLI   MSGLEN4(MSGPTR),0                                   0110 00302000
         BE    @RF00110                                            0110 00303000
         LR    @10,I                                               0110 00304000
         SLA   @10,2                                               0110 00305000
         LA    @07,4                                               0110 00306000
         L     @03,@CV00137                                        0110 00307000
         ALR   @03,@07                                             0110 00308000
         AL    @03,@CF00294                                        0110 00309000
         L     @03,MSGTBL(@10,@03)                                 0110 00310000
         CLI   MESGLEN4(@03),0                                     0110 00311000
         BE    @RF00110                                            0110 00312000
*     DO;                           /*                       @Y30LB26*/ 00313000
*       IF MSGLEN4>MESGLEN4 THEN    /* TOO LONG?             @Y30LB26*/ 00314000
         L     @03,@CV00137                                        0112 00315000
         ALR   @03,@07                                             0112 00316000
         AL    @03,@CF00294                                        0112 00317000
         L     @03,MSGTBL(@10,@03)                                 0112 00318000
         CLC   MSGLEN4(1,MSGPTR),MESGLEN4(@03)                     0112 00319000
         BNH   @RF00112                                            0112 00320000
*         MSGLEN4=MESGLEN4;         /* IF LONG, SHORTEN      @Y30LB26*/ 00321000
         L     @03,@CV00137                                        0113 00322000
         ALR   @03,@07                                             0113 00323000
         AL    @03,@CF00294                                        0113 00324000
         L     @10,MSGTBL(@10,@03)                                 0113 00325000
         MVC   MSGLEN4(1,MSGPTR),MESGLEN4(@10)                     0113 00326000
*       MESGBUF(MESGLOC4:MESGLOC4+MSGLEN4-1)=/*              @Y30LB26*/ 00327000
*           TEXT4(1:MSGLEN4);       /*                       @Y30LB26*/ 00328000
@RF00112 LR    @10,I                                               0114 00329000
         SLA   @10,2                                               0114 00330000
         L     @07,@CV00137                                        0114 00331000
         L     @10,MSGTBL(@10,@07)                                 0114 00332000
         SLR   @07,@07                                             0114 00333000
         IC    @07,MESGLOC4(,@10)                                  0114 00334000
         LA    @10,MESGBUF-1(@07)                                  0114 00335000
         SLR   @07,@07                                             0114 00336000
         IC    @07,MSGLEN4(,MSGPTR)                                0114 00337000
         BCTR  @07,0                                               0114 00338000
         L     @03,MSGTEXT4-1(,MSGPTR)                             0114 00339000
         LA    @03,0(,@03)                                         0114 00340000
         EX    @07,@SM00303                                        0114 00341000
*     END;                          /*                       @Y30LB26*/ 00342000
*                                                                  0115 00343000
*   /*****************************************************************/ 00344000
*   /*                                                               */ 00345000
*   /* DO SAME FOR FIFTH                                     @Y30LB26*/ 00346000
*   /*                                                               */ 00347000
*   /*****************************************************************/ 00348000
*                                                                  0116 00349000
*   IF MSGLEN5^=ZERO&MESGLEN5^=ZERO THEN/* PARM SPEC?        @Y30LB26*/ 00350000
@RF00110 CLI   MSGLEN5(MSGPTR),0                                   0116 00351000
         BE    @RF00116                                            0116 00352000
         LR    @10,I                                               0116 00353000
         SLA   @10,2                                               0116 00354000
         LA    @07,4                                               0116 00355000
         L     @03,@CV00137                                        0116 00356000
         ALR   @03,@07                                             0116 00357000
         AL    @03,@CF00294                                        0116 00358000
         L     @03,MSGTBL(@10,@03)                                 0116 00359000
         CLI   MESGLEN5(@03),0                                     0116 00360000
         BE    @RF00116                                            0116 00361000
*     DO;                           /*                       @Y30LB26*/ 00362000
*       IF MSGLEN5>MESGLEN5 THEN    /* TOO LONG?             @Y30LB26*/ 00363000
         L     @03,@CV00137                                        0118 00364000
         ALR   @03,@07                                             0118 00365000
         AL    @03,@CF00294                                        0118 00366000
         L     @03,MSGTBL(@10,@03)                                 0118 00367000
         CLC   MSGLEN5(1,MSGPTR),MESGLEN5(@03)                     0118 00368000
         BNH   @RF00118                                            0118 00369000
*         MSGLEN5=MESGLEN5;         /* IF SO, SHORTEN        @Y30LB26*/ 00370000
         L     @03,@CV00137                                        0119 00371000
         ALR   @03,@07                                             0119 00372000
         AL    @03,@CF00294                                        0119 00373000
         L     @10,MSGTBL(@10,@03)                                 0119 00374000
         MVC   MSGLEN5(1,MSGPTR),MESGLEN5(@10)                     0119 00375000
*       MESGBUF(MESGLOC5:MESGLOC5+MSGLEN5-1)=/*              @Y30LB26*/ 00376000
*           TEXT5(1:MSGLEN5);       /*                       @Y30LB26*/ 00377000
@RF00118 LR    @10,I                                               0120 00378000
         SLA   @10,2                                               0120 00379000
         L     @07,@CV00137                                        0120 00380000
         L     @10,MSGTBL(@10,@07)                                 0120 00381000
         SLR   @07,@07                                             0120 00382000
         IC    @07,MESGLOC5(,@10)                                  0120 00383000
         LA    @10,MESGBUF-1(@07)                                  0120 00384000
         SLR   @07,@07                                             0120 00385000
         IC    @07,MSGLEN5(,MSGPTR)                                0120 00386000
         BCTR  @07,0                                               0120 00387000
         L     @03,MSGTEXT5-1(,MSGPTR)                             0120 00388000
         LA    @03,0(,@03)                                         0120 00389000
         EX    @07,@SM00305                                        0120 00390000
*     END;                          /*                       @Y30LB26*/ 00391000
*                                                                  0122 00392000
*   /*****************************************************************/ 00393000
*   /*                                                               */ 00394000
*   /* CALL ROUTINE THAT SENDS MESSAGE                       @Y30LB26*/ 00395000
*   /*                                                               */ 00396000
*   /*****************************************************************/ 00397000
*                                                                  0122 00398000
*   CALL SENDMSG;                   /* WRITE TO OPERATOR     @Y30LB26*/ 00399000
@RF00116 BAL   @14,SENDMSG                                         0122 00400000
*                                                                  0123 00401000
*   /*****************************************************************/ 00402000
*   /*                                                               */ 00403000
*   /* SET REASON AND RETURN CODES IN RPLV FROM STATIC TABLE @Y30LB26*/ 00404000
*   /*                                                               */ 00405000
*   /*****************************************************************/ 00406000
*                                                                  0123 00407000
*   RPLVRETC=MESGRET;               /* SET RETURN CODE       @Y30LB26*/ 00408000
         LR    @10,I                                               0123 00409000
         SLA   @10,2                                               0123 00410000
         LA    @15,4                                               0123 00411000
         L     @14,@CV00137                                        0123 00412000
         ALR   @14,@15                                             0123 00413000
         AL    @14,@CF00294                                        0123 00414000
         L     @01,MSGTBL(@10,@14)                                 0123 00415000
         MVC   RPLVRETC(2,RPLVPTR),MESGRET(@01)                    0123 00416000
*   RPLRCODE=MESGREA;               /* SET REASON CODE       @Y30LB26*/ 00417000
         L     @14,@CV00137                                        0124 00418000
         ALR   @14,@15                                             0124 00419000
         AL    @14,@CF00294                                        0124 00420000
         L     @10,MSGTBL(@10,@14)                                 0124 00421000
         MVC   RPLRCODE(2,RPLVPTR),MESGREA(@10)                    0124 00422000
*   RETURN;                         /*                       @Y30LB26*/ 00423000
@EL00001 L     @13,4(,@13)                                         0125 00424000
@EF00001 L     @00,@SIZDATD                                        0125 00425000
         LR    @01,@11                                             0125 00426000
         FREEMAIN R,LV=(0),A=(1)                                        00427000
@ER00001 LM    @14,@12,12(@13)                                     0125 00428000
         BR    @14                                                 0125 00429000
*                                                                  0126 00430000
*   /*****************************************************************/ 00431000
*   /*                                                               */ 00432000
*   /* ROUTINE WRITES MESSAGE TO OPERATOR AND/OR LIBRARIAN.  @Y30LB26*/ 00433000
*   /* MESSAGES THAT REQUIRE REPLYS WILL ONLY GO             @Y30LB26*/ 00434000
*   /* TO THE OPERATOR.                                      @Y30LB26*/ 00435000
*   /*                                                               */ 00436000
*   /*****************************************************************/ 00437000
*                                                                  0126 00438000
*SENDMSG:                                                          0126 00439000
*   PROC;                           /*                       @Y30LB26*/ 00440000
*                                                                  0126 00441000
SENDMSG  STM   @14,@12,@SA00002                                    0126 00442000
*   /*****************************************************************/ 00443000
*   /*                                                               */ 00444000
*   /* SEE IF MESSAGE NEEDS A REPLY                          @Y30LB26*/ 00445000
*   /*                                                               */ 00446000
*   /*****************************************************************/ 00447000
*                                                                  0127 00448000
*   IF MESGFLG3=ON&MESGFLG1=ON THEN /* WTO WITH REPLY        @Y30LB26*/ 00449000
         LR    @10,I                                               0127 00450000
         SLA   @10,2                                               0127 00451000
         L     @07,@CV00137                                        0127 00452000
         L     @10,MSGTBL(@10,@07)                                 0127 00453000
         TM    MESGFLG3(@10),B'10100000'                           0127 00454000
         BNO   @RF00127                                            0127 00455000
*     DO;                           /*                       @Y30LB26*/ 00456000
*                                                                  0128 00457000
*       /*************************************************************/ 00458000
*       /*                                                           */ 00459000
*       /* ZERO WTOR ECB AND DEFAULT REPLY LENGTH IF CALLER  @Y30LB26*/ 00460000
*       /* FORGOT TO INITILIZE IT. OTHERWISE PUT IN          @Y30LB26*/ 00461000
*       /* REPLY LENGTH.                                     @Y30LB26*/ 00462000
*       /*                                                           */ 00463000
*       /*************************************************************/ 00464000
*                                                                  0129 00465000
*       WTORECB=ZERO;               /* ZERO WTOR ECB         @Y30LB26*/ 00466000
         SLR   @10,@10                                             0129 00467000
         ST    @10,WTORECB                                         0129 00468000
*       IF MSGRLEN=ZERO THEN        /* FORGOT LENGTH ?       @Y30LB26*/ 00469000
         CLI   MSGRLEN(MSGPTR),0                                   0130 00470000
         BNE   @RF00130                                            0130 00471000
*         WTORLENR=SEVENTWO;        /* DEFAULT               @Y30LB26*/ 00472000
         MVI   WTORLENR,X'48'                                      0131 00473000
*       ELSE                        /*                       @Y30LB26*/ 00474000
*         WTORLENR=MSGRLEN;         /* GET REPLY LENGTH      @Y30LB26*/ 00475000
*                                                                  0132 00476000
         B     @RC00130                                            0132 00477000
@RF00130 MVC   WTORLENR(1),MSGRLEN(MSGPTR)                         0132 00478000
*       /*************************************************************/ 00479000
*       /*                                                           */ 00480000
*       /* BLANK OUT REPLY BUFFER. INITILIZE FIELDS IN WTOR  @Y30LB26*/ 00481000
*       /* MACRO AND MOVE IN MESSAGE.                        @Y30LB26*/ 00482000
*       /*                                                           */ 00483000
*       /*************************************************************/ 00484000
*                                                                  0133 00485000
*       WTORECBA=ADDR(WTORECB);     /* ADDRESS OF ECB        @Y30LB26*/ 00486000
@RC00130 LA    @10,WTORECB                                         0133 00487000
         ST    @10,WTORECBA                                        0133 00488000
*       WTORTEXT=MESGBUF;           /* NONE IN TEXT          @Y30LB26*/ 00489000
         MVC   WTORTEXT(72),MESGBUF                                0134 00490000
*       WTORDESC=MESGDES;           /* DESCRIPTOR            @Y30LB26*/ 00491000
         LR    @10,I                                               0135 00492000
         SLA   @10,2                                               0135 00493000
         LA    @05,4                                               0135 00494000
         L     @03,@CV00137                                        0135 00495000
         ALR   @03,@05                                             0135 00496000
         AL    @03,@CF00294                                        0135 00497000
         L     @03,MSGTBL(@10,@03)                                 0135 00498000
         MVC   WTORDESC(2),MESGDES(@03)                            0135 00499000
*       WTORROUT=MESGRTE;           /* SET ROUTING INFO      @Y30LB26*/ 00500000
         L     @03,@CV00137                                        0136 00501000
         ALR   @03,@05                                             0136 00502000
         AL    @03,@CF00294                                        0136 00503000
         L     @10,MSGTBL(@10,@03)                                 0136 00504000
         MVC   WTORROUT(2),MESGRTE(@10)                            0136 00505000
*       REPLY=BLANK;                /* BLANK REPLY BUF       @VS32893*/ 00506000
         MVI   REPLY+1,C' '                                        0137 00507000
         MVC   REPLY+2(70),REPLY+1                                 0137 00508000
         MVI   REPLY,C' '                                          0137 00509000
*       WTORADDR=ADDR(REPLY);       /* ADDRESS OF REPLY      @VS32893*/ 00510000
         LA    @10,REPLY                                           0138 00511000
         STCM  @10,7,WTORADDR                                      0138 00512000
*                                                                  0139 00513000
*       /*************************************************************/ 00514000
*       /*                                                           */ 00515000
*       /* ISSUE WRITE TO OPERATOR WITH REPLY                @Y30LB26*/ 00516000
*       /*                                                           */ 00517000
*       /*************************************************************/ 00518000
*                                                                  0139 00519000
*       RESPECIFY                                                  0139 00520000
*         REG1 RSTD;                /* RESTRICT              @Y30LB26*/ 00521000
*       REG1=ADDR(WTOR);            /* LIST WTOR ADDR        @VS32893*/ 00522000
         LA    REG1,WTOR                                           0140 00523000
*LWTOR1:                                                           0141 00524000
*       GEN(WTOR   MF=(E,(REG1)));  /* WRITE TO OPERATOR     @Y30LB26*/ 00525000
LWTOR1   WTOR   MF=(E,(REG1))                                           00526000
*       RESPECIFY                                                  0142 00527000
*         REG1 UNRSTD;              /* FREE REG 1            @Y30LB26*/ 00528000
*                                                                  0142 00529000
*       /*************************************************************/ 00530000
*       /*                                                           */ 00531000
*       /* WAIT FOR REPLY                                    @Y30LB26*/ 00532000
*       /*                                                           */ 00533000
*       /*************************************************************/ 00534000
*                                                                  0143 00535000
*LWAIT1:                                                           0143 00536000
*       GEN(WAIT ECB=WTORECB);      /* WAIT FOR REPLY        @Y30LB26*/ 00537000
*                                                                  0143 00538000
LWAIT1   WAIT ECB=WTORECB                                               00539000
*       /*************************************************************/ 00540000
*       /*                                                           */ 00541000
*       /* CHECK TO SEE IF USER SUPPLIED BOTH A REPLY        @Y30LB26*/ 00542000
*       /* LENGTH AND A REPLY ADDRESS. IF BOTH NOT GIVEN,    @Y30LB26*/ 00543000
*       /* NO REPLY CAN BE RETURNED TO USER. IF GIVEN, PUT   @Y30LB26*/ 00544000
*       /* REPLY IN USERS BUFFER                             @Y30LB26*/ 00545000
*       /*                                                           */ 00546000
*       /*************************************************************/ 00547000
*                                                                  0144 00548000
*       IF MSGRLEN^=ZERO&MSGREPLY^=ZERO THEN/*               @Y30LB26*/ 00549000
         CLI   MSGRLEN(MSGPTR),0                                   0144 00550000
         BE    @RF00144                                            0144 00551000
         L     @10,MSGREPLY-1(,MSGPTR)                             0144 00552000
         LA    @10,0(,@10)                                         0144 00553000
         LTR   @10,@10                                             0144 00554000
         BZ    @RF00144                                            0144 00555000
*         USERRBUF(1:MSGRLEN)=REPLY(1:MSGRLEN);/* RPLY USER  @Y30LB26*/ 00556000
         SLR   @05,@05                                             0145 00557000
         IC    @05,MSGRLEN(,MSGPTR)                                0145 00558000
         BCTR  @05,0                                               0145 00559000
         EX    @05,@SM00307                                        0145 00560000
*       RETURN;                     /*                       @Y30LB26*/ 00561000
@EL00002 DS    0H                                                  0146 00562000
@EF00002 DS    0H                                                  0146 00563000
@ER00002 LM    @14,@12,@SA00002                                    0146 00564000
         BR    @14                                                 0146 00565000
*     END;                          /*                       @Y30LB26*/ 00566000
*                                                                  0148 00567000
*   /*****************************************************************/ 00568000
*   /*                                                               */ 00569000
*   /* IF REPLY NOT WANTED, CHECK FOR LIBRARIAN AND/OR       @Y30LB26*/ 00570000
*   /* OPERATOR MESSAGE                                      @Y30LB26*/ 00571000
*   /*                                                               */ 00572000
*   /*****************************************************************/ 00573000
*                                                                  0148 00574000
*   ELSE                            /*                       @Y30LB26*/ 00575000
*     DO;                           /*                       @Y30LB26*/ 00576000
*                                                                  0148 00577000
@RF00127 DS    0H                                                  0149 00578000
*       /*************************************************************/ 00579000
*       /*                                                           */ 00580000
*       /* SEE IF MESSAGE BEING SENT TO LIBRARIAN            @Y30LB26*/ 00581000
*       /* ALTERNATE CONSOLE                                 @Y30LB26*/ 00582000
*       /*                                                           */ 00583000
*       /*************************************************************/ 00584000
*                                                                  0149 00585000
*       IF VVIALCON^=ZERO&MESGFLG2=ON THEN/* NO ROUTING      @Y30LB26*/ 00586000
         CLI   VVIALCON(VVIPTR),0                                  0149 00587000
         BE    @RF00149                                            0149 00588000
         LR    @10,I                                               0149 00589000
         SLA   @10,2                                               0149 00590000
         L     @07,@CV00137                                        0149 00591000
         L     @10,MSGTBL(@10,@07)                                 0149 00592000
         TM    MESGFLG2(@10),B'01000000'                           0149 00593000
         BNO   @RF00149                                            0149 00594000
*         DO;                       /*                       @Y30LB26*/ 00595000
*                                                                  0150 00596000
*           /*********************************************************/ 00597000
*           /*                                                       */ 00598000
*           /* SET DUMMY ROUTE CODE WITH FIRST BIT ON TO BE  @Y30LB26*/ 00599000
*           /* SHIFTED RIGHT                                 @Y30LB26*/ 00600000
*           /*                                                       */ 00601000
*           /*********************************************************/ 00602000
*                                                                  0151 00603000
*           LIBROUT=INITROUT;       /* INITIAL ROUTING       @Y30LB26*/ 00604000
*                                                                  0151 00605000
         MVC   LIBROUT(2),@CB00149                                 0151 00606000
*           /*********************************************************/ 00607000
*           /*                                                       */ 00608000
*           /* IF ROUTING CODE IS ONE, THEN DUMMY ROUTE      @Y30LB26*/ 00609000
*           /* CODE ALREADY SET RIGHT. OTHERWISE SHIFT BIT   @Y30LB26*/ 00610000
*           /* TO CORRECT POSITION.                          @Y30LB26*/ 00611000
*           /*                                                       */ 00612000
*           /*********************************************************/ 00613000
*                                                                  0152 00614000
*           IF VVIALCON>ONE THEN    /* ROUTING CODE 1?       @Y30LB26*/ 00615000
         CLI   VVIALCON(VVIPTR),1                                  0152 00616000
         BNH   @RF00152                                            0152 00617000
*             DO J=1 TO VVIALCON-1; /* START SHIFT BIT       @Y30LB26*/ 00618000
         LA    J,1                                                 0153 00619000
         B     @DE00153                                            0153 00620000
@DL00153 DS    0H                                                  0154 00621000
*               LIBROUT=LIBROUT/2;  /* SHIFT RT ONE          @Y30LB26*/ 00622000
         SLR   @10,@10                                             0154 00623000
         ICM   @10,3,LIBROUT                                       0154 00624000
         SRL   @10,1                                               0154 00625000
         STCM  @10,3,LIBROUT                                       0154 00626000
*             END;                  /*                       @Y30LB26*/ 00627000
         AL    J,@CF00038                                          0155 00628000
@DE00153 SLR   @10,@10                                             0155 00629000
         IC    @10,VVIALCON(,VVIPTR)                               0155 00630000
         BCTR  @10,0                                               0155 00631000
         CR    J,@10                                               0155 00632000
         BNH   @DL00153                                            0155 00633000
*         END;                      /*                       @Y30LB26*/ 00634000
@RF00152 DS    0H                                                  0157 00635000
*                                                                  0157 00636000
*       /*************************************************************/ 00637000
*       /*                                                           */ 00638000
*       /* SET UP FIELDS IN WTO MACRO AND MOVE IN MESSAGE    @Y30LB26*/ 00639000
*       /*                                                           */ 00640000
*       /*************************************************************/ 00641000
*                                                                  0157 00642000
*       WTOTEXT=MESGBUF;            /* MESSAGE TEXT          @Y30LB26*/ 00643000
@RF00149 MVC   WTOTEXT(72),MESGBUF                                 0157 00644000
*       WTODESC=MESGDES;            /* DESCRIPTOR CODES      @Y30LB26*/ 00645000
*                                                                  0158 00646000
         LR    @10,I                                               0158 00647000
         SLA   @10,2                                               0158 00648000
         LA    @07,4                                               0158 00649000
         L     @15,@CV00137                                        0158 00650000
         ALR   @15,@07                                             0158 00651000
         AL    @15,@CF00294                                        0158 00652000
         L     @01,MSGTBL(@10,@15)                                 0158 00653000
         MVC   WTODESC(2),MESGDES(@01)                             0158 00654000
*       /*************************************************************/ 00655000
*       /*                                                           */ 00656000
*       /* SEE IF ORING ROUTING CODE IS REQUIRED             @Y30LB26*/ 00657000
*       /* TO SEND THE MESSAGE TO THE OPERATOR               @Y30LB26*/ 00658000
*       /*                                                           */ 00659000
*       /*************************************************************/ 00660000
*                                                                  0159 00661000
*       IF MESGFLG1=ON THEN         /* OPERATOR MESSAGE      @Y30LB26*/ 00662000
         L     @15,@CV00137                                        0159 00663000
         ALR   @15,@07                                             0159 00664000
         AL    @15,@CF00294                                        0159 00665000
         L     @01,MSGTBL(@10,@15)                                 0159 00666000
         TM    MESGFLG1(@01),B'10000000'                           0159 00667000
         BNO   @RF00159                                            0159 00668000
*         WTOROUT=MESGRTE|LIBROUT;  /* OR ROUTING CODES      @Y30LB26*/ 00669000
         L     @15,@CV00137                                        0160 00670000
         ALR   @15,@07                                             0160 00671000
         AL    @15,@CF00294                                        0160 00672000
         L     @10,MSGTBL(@10,@15)                                 0160 00673000
         MVC   WTOROUT(2),MESGRTE(@10)                             0160 00674000
         OC    WTOROUT(2),LIBROUT                                  0160 00675000
*       ELSE                        /*                       @Y30LB26*/ 00676000
*                                                                  0161 00677000
*         /***********************************************************/ 00678000
*         /*                                                         */ 00679000
*         /* OTHERWISE PUT IN ROUTING FOR LIBRARIAN          @Y30LB26*/ 00680000
*         /*                                                         */ 00681000
*         /***********************************************************/ 00682000
*                                                                  0161 00683000
*         IF MESGFLG2=ON THEN       /* LIBRARIAN ROUTING     @Y30LB26*/ 00684000
         B     @RC00159                                            0161 00685000
@RF00159 LR    @10,I                                               0161 00686000
         SLA   @10,2                                               0161 00687000
         L     @07,@CV00137                                        0161 00688000
         L     @10,MSGTBL(@10,@07)                                 0161 00689000
         TM    MESGFLG2(@10),B'01000000'                           0161 00690000
         BNO   @RF00161                                            0161 00691000
*           WTOROUT=LIBROUT;        /* LIB ROUTING           @Y30LB26*/ 00692000
         MVC   WTOROUT(2),LIBROUT                                  0162 00693000
*                                                                  0163 00694000
*       /*************************************************************/ 00695000
*       /*                                                           */ 00696000
*       /* ISSUE WRITE TO OPERATOR MACRO IF MESSAGE IS TO BE @Y30LB26*/ 00697000
*       /* SENT TO THE OPERATOR AND/OR ALTERNATE CONSOLE     @Y30LB26*/ 00698000
*       /*                                                           */ 00699000
*       /*************************************************************/ 00700000
*                                                                  0163 00701000
*       IF WTOROUT^=BITZERO THEN    /*                       @Y30LB26*/ 00702000
@RF00161 DS    0H                                                  0163 00703000
@RC00159 CLC   WTOROUT(2),@CB00154                                 0163 00704000
         BE    @RF00163                                            0163 00705000
*         DO;                       /*                       @Y30LB26*/ 00706000
*           RESPECIFY                                              0165 00707000
*             REG1 RSTD;            /* RESTRICT REG1         @Y30LB26*/ 00708000
*           REG1=ADDR(WTO);         /* ADDRESS MSG LIST      @VS32893*/ 00709000
         LA    REG1,WTO                                            0166 00710000
*LWTO1:                                                            0167 00711000
*           GEN(WTO   MF=(E,(REG1)));/* WRITE MESSAGE        @Y30LB26*/ 00712000
LWTO1    WTO   MF=(E,(REG1))                                            00713000
*           RESPECIFY                                              0168 00714000
*             REG1 UNRSTD;          /* FREE REG 1            @Y30LB26*/ 00715000
*         END;                      /*                       @Y30LB26*/ 00716000
*                                                                  0169 00717000
*       /*************************************************************/ 00718000
*       /*                                                           */ 00719000
*       /* SEE IF MESSAGE IS TO BE JOURNALED, IF             @Y30LB26*/ 00720000
*       /* REQUIRED GO JOURNAL IT                            @Y30LB26*/ 00721000
*       /*                                                           */ 00722000
*       /*************************************************************/ 00723000
*                                                                  0170 00724000
*       IF VVIFLG3=ON&MESGFLG2=ON THEN                             0170 00725000
@RF00163 TM    VVIFLG3(VVIPTR),B'00010000'                         0170 00726000
         BNO   @RF00170                                            0170 00727000
         LR    @10,I                                               0170 00728000
         SLA   @10,2                                               0170 00729000
         L     @07,@CV00137                                        0170 00730000
         L     @10,MSGTBL(@10,@07)                                 0170 00731000
         TM    MESGFLG2(@10),B'01000000'                           0170 00732000
         BNO   @RF00170                                            0170 00733000
*         CALL JRNLMSG;             /* GO JOURNAL MESSAGE    @YM04320*/ 00734000
         BAL   @14,JRNLMSG                                         0171 00735000
*     END;                          /*                       @Y30LB26*/ 00736000
*   RETURN;                         /*                       @Y30LB26*/ 00737000
         B     @EL00002                                            0173 00738000
*   END SENDMSG;                    /*                       @Y30LB26*/ 00739000
         B     @EL00002                                            0174 00740000
*                                                                  0175 00741000
*   /*****************************************************************/ 00742000
*   /*                                                               */ 00743000
*   /* ROUTINE WILL JOURNAL THE MESSAGE IF FLAG IN MSVC      @Y30LB26*/ 00744000
*   /* CONTROL BLOCK INDICATES IT SHOULD BE AND              @Y30LB26*/ 00745000
*   /* THE MESSAGE IS FOR THE LIBRARIAN.                     @Y30LB26*/ 00746000
*   /*                                                               */ 00747000
*   /*****************************************************************/ 00748000
*                                                                  0175 00749000
*JRNLMSG:                                                          0175 00750000
*   PROC;                           /*                       @Y30LB26*/ 00751000
*                                                                  0175 00752000
JRNLMSG  STM   @14,@12,@SA00003                                    0175 00753000
*   /*****************************************************************/ 00754000
*   /*                                                               */ 00755000
*   /* IF NOT ALREADY RESERVED BY TASK                       @ZM30991*/ 00756000
*   /*                                                               */ 00757000
*   /*****************************************************************/ 00758000
*                                                                  0176 00759000
*   IF VVIFLG5=OFF&                 /*                       @ZM31134*/ 00760000
*       VVIJUCB^=ZERO THEN          /*                       @ZM31134*/ 00761000
         TM    VVIFLG5(VVIPTR),B'00000100'                         0176 00762000
         BNZ   @RF00176                                            0176 00763000
         L     @10,VVIJUCB(,VVIPTR)                                0176 00764000
         LTR   @10,@10                                             0176 00765000
         BZ    @RF00176                                            0176 00766000
*     DO;                           /*                       @ZM30991*/ 00767000
*       VVIFLG5=ON;                 /* INDIC JRNL RSV        @ZA17161*/ 00768000
         OI    VVIFLG5(VVIPTR),B'00000100'                         0178 00769000
*       RESPECIFY                                                  0179 00770000
*        (REG1,                                                    0179 00771000
*         REG0) RSTD;               /* RESTRICT              @ZM30991*/ 00772000
*       RESLIST2=RESLIST1;          /* MOVE LIST             @ZM31134*/ 00773000
         MVC   RESLIST2(16),RESLIST1                               0180 00774000
*       RESJUCB=ADDR(VVIJUCB);      /* SET UCB ADDR          @ZM31134*/ 00775000
         LA    @10,VVIJUCB(,VVIPTR)                                0181 00776000
         ST    @10,RESJUCB                                         0181 00777000
*       REG1=ADDR(RESLIST2);        /* SET UP REG 1          @ZM31134*/ 00778000
         LA    REG1,RESLIST2                                       0182 00779000
*LRES1:                                                            0183 00780000
*       GEN(RESERVE  MF=(E,(REG1)));/* ISSUE RESERVE         @ZM31134*/ 00781000
LRES1    RESERVE  MF=(E,(REG1))                                         00782000
*       RESPECIFY                                                  0184 00783000
*        (REG1,                                                    0184 00784000
*         REG0) UNRSTD;             /* FREE REGS             @ZM30991*/ 00785000
*       DEQSW=ON;                   /* INDICATE DEQ REQD     @ZM30991*/ 00786000
         OI    DEQSW,B'10000000'                                   0185 00787000
*     END;                          /*                       @ZM30991*/ 00788000
*                                                                  0186 00789000
*   /*****************************************************************/ 00790000
*   /*                                                               */ 00791000
*   /* SAVE THE BUFFER ADDRESS AND THE RECORD LENGTH IN      @Y30LB26*/ 00792000
*   /* THE RPLV SO IT CAN BE RESTORED AFTER THE MESSAGE      @Y30LB26*/ 00793000
*   /* HAS BEEN JOURNALED                                    @Y30LB26*/ 00794000
*   /*                                                               */ 00795000
*   /*****************************************************************/ 00796000
*                                                                  0187 00797000
*   RPLBUFSV=RPLVBUF;               /* SAVE BUF PTR          @Y30LB26*/ 00798000
@RF00176 L     RPLBUFSV,RPLVBUF(,RPLVPTR)                          0187 00799000
*   RPLLNSV=RPLVRLN;                /* SAVE RECORD LEN       @Y30LB26*/ 00800000
*                                                                  0188 00801000
         L     RPLLNSV,RPLVRLN(,RPLVPTR)                           0188 00802000
*   /*****************************************************************/ 00803000
*   /*                                                               */ 00804000
*   /* SET UP PARAMETERS IN THE RPLV TO JOURNAL MESSAGE      @Y30LB26*/ 00805000
*   /*                                                               */ 00806000
*   /*****************************************************************/ 00807000
*                                                                  0189 00808000
*   RPLVVOP=ON;                     /* INDICATE VOP CALL     @Y30LB26*/ 00809000
         OI    RPLVVOP(RPLVPTR),B'00000100'                        0189 00810000
*   RPLVBUF=ADDR(MESGBUF);          /* ADDR MESSAGE          @Y30LB26*/ 00811000
         LA    @10,MESGBUF                                         0190 00812000
         ST    @10,RPLVBUF(,RPLVPTR)                               0190 00813000
*   RPLVRLN=SEVENTWO;               /* LENGTH MESSAGE        @Y30LB26*/ 00814000
*                                                                  0191 00815000
         MVC   RPLVRLN(4,RPLVPTR),@CF00163                         0191 00816000
*   /*****************************************************************/ 00817000
*   /*                                                               */ 00818000
*   /* CALL JOURNAL ROUTINE TO JOURNAL MESSAGE               @Y30LB26*/ 00819000
*   /*                                                               */ 00820000
*   /*****************************************************************/ 00821000
*                                                                  0192 00822000
*   RESPECIFY                                                      0192 00823000
*     REG1 RSTD;                    /* RESTRICT              @Y30LB26*/ 00824000
*   REG1=RPLVPTR;                   /* ADDR RPLV             @Y30LB26*/ 00825000
         LR    REG1,RPLVPTR                                        0193 00826000
*   CALL ICBVJL00;                  /* JOURNAL MESSAGE       @Y30LB26*/ 00827000
*                                                                  0194 00828000
         L     @15,@CV00138                                        0194 00829000
         BALR  @14,@15                                             0194 00830000
*   /*****************************************************************/ 00831000
*   /*                                                               */ 00832000
*   /* FREE JOURNAL DATA SET                                 @Y30LB26*/ 00833000
*   /* IF RESERVED BY VOP                                    @ZM30991*/ 00834000
*   /*                                                               */ 00835000
*   /*****************************************************************/ 00836000
*                                                                  0195 00837000
*   IF DEQSW=ON THEN                /*                       @ZM30991*/ 00838000
         TM    DEQSW,B'10000000'                                   0195 00839000
         BNO   @RF00195                                            0195 00840000
*     DO;                           /*                       @ZM30991*/ 00841000
*       RESPECIFY                                                  0197 00842000
*         REG0 RSTD;                /* RESTRICT              @ZM30991*/ 00843000
*       RESLIST2=RESLIST1;          /* MOVE LIST             @ZM31134*/ 00844000
         MVC   RESLIST2(16),RESLIST1                               0198 00845000
*       RESJUCB=ADDR(VVIJUCB);      /* SET UCB ADDR          @ZM31134*/ 00846000
         LA    @10,VVIJUCB(,VVIPTR)                                0199 00847000
         ST    @10,RESJUCB                                         0199 00848000
*       REG1=ADDR(RESLIST2);        /* SET UP REG 1          @ZM31134*/ 00849000
         LA    REG1,RESLIST2                                       0200 00850000
*LDEQ1:                                                            0201 00851000
*       GEN(DEQ  MF=(E,(REG1)));    /* ISSUE RELEASE         @ZM31134*/ 00852000
LDEQ1    DEQ  MF=(E,(REG1))                                             00853000
*       RESPECIFY                                                  0202 00854000
*        (REG1,                                                    0202 00855000
*         REG0) UNRSTD;             /* FREE REGS             @ZM30991*/ 00856000
*       DEQSW=OFF;                  /*                       @ZM30991*/ 00857000
         NI    DEQSW,B'01111111'                                   0203 00858000
*       VVIFLG5=OFF;                /* INDICATE JRNL FREE    @ZA17161*/ 00859000
         NI    VVIFLG5(VVIPTR),B'11111011'                         0204 00860000
*     END;                          /*                       @ZM30991*/ 00861000
*                                                                  0205 00862000
*   /*****************************************************************/ 00863000
*   /*                                                               */ 00864000
*   /* RESTORE BUFFER ADDRESS AND RECORD LENGTH IN RPLV      #Y30LB26*/ 00865000
*   /* TURN OFF MESSAGE JOURNALING FLAG                      #Y30LB26*/ 00866000
*   /*                                                               */ 00867000
*   /*****************************************************************/ 00868000
*                                                                  0206 00869000
*   RPLVBUF=RPLBUFSV;               /* RESTORE BUF ADDR      @Y30LB26*/ 00870000
@RF00195 ST    RPLBUFSV,RPLVBUF(,RPLVPTR)                          0206 00871000
*   RPLVRLN=RPLLNSV;                /* RESTORE LENGTH        @Y30LB26*/ 00872000
         ST    RPLLNSV,RPLVRLN(,RPLVPTR)                           0207 00873000
*   RPLVVOP=OFF;                    /* SET BACK TO ORIG      @Y30LB26*/ 00874000
         NI    RPLVVOP(RPLVPTR),B'11111011'                        0208 00875000
*   RETURN;                         /*                       @Y30LB26*/ 00876000
@EL00003 DS    0H                                                  0209 00877000
@EF00003 DS    0H                                                  0209 00878000
@ER00003 LM    @14,@12,@SA00003                                    0209 00879000
         BR    @14                                                 0209 00880000
*   END JRNLMSG;                    /*                       @Y30LB26*/ 00881000
*   END ICBVOP00                    /*                       @Y30LB26*/ 00882000
*                                                                  0211 00883000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00884000
*/*%INCLUDE SYSLIB  (IEZRPLV )                                       */ 00885000
*/*%INCLUDE SYSLIB  (IEZVVICB)                                       */ 00886000
*                                                                  0211 00887000
*       ;                                                          0211 00888000
@DATA    DS    0H                                                       00889000
@SM00295 MVC   MESGBUF(0),MESGSKEL(@03)                                 00890000
@SM00297 MVC   0(0,@10),TEXT1(@03)                                      00891000
@SM00299 MVC   0(0,@10),TEXT2(@03)                                      00892000
@SM00301 MVC   0(0,@10),TEXT3(@03)                                      00893000
@SM00303 MVC   0(0,@10),TEXT4(@03)                                      00894000
@SM00305 MVC   0(0,@10),TEXT5(@03)                                      00895000
@SM00307 MVC   USERRBUF(0,@10),REPLY                                    00896000
@DATD    DSECT                                                          00897000
         DS    0F                                                       00898000
@SA00001 DS    18F                                                      00899000
@SA00002 DS    15F                                                      00900000
@SA00003 DS    15F                                                      00901000
ICBVOP00 CSECT                                                          00902000
         DS    0F                                                       00903000
@CF00038 DC    F'1'                                                     00904000
@CF00163 DC    F'72'                                                    00905000
@CF00157 DC    F'399'                                                   00906000
@CF00294 DC    F'-4'                                                    00907000
@DATD    DSECT                                                          00908000
         DS    0D                                                       00909000
WTORECB  DS    F                                                        00910000
         DS    0D                                                       00911000
@TS00001 DS    CL8                                                      00912000
LIBROUT  DS    BL2                                                      00913000
DECID    DS    CL4                                                      00914000
PRINTID  DS    CL4                                                      00915000
MESGBUF  DS    CL72                                                     00916000
SWITCHES DS    BL1                                                      00917000
         ORG   SWITCHES                                                 00918000
DEQSW    DS    BL1                                                      00919000
@NM00008 EQU   SWITCHES+0                                               00920000
         ORG   SWITCHES+1                                               00921000
         DS    CL1                                                      00922000
RESLIST2 DS    CL16                                                     00923000
WTO      DS    CL80                                                     00924000
         ORG   WTO                                                      00925000
WTOLEN   DS    FL2                                                      00926000
WTOMCS   DS    BL2                                                      00927000
WTOTEXT  DS    CL72                                                     00928000
WTODESC  DS    BL2                                                      00929000
WTOROUT  DS    BL2                                                      00930000
         ORG   WTO+80                                                   00931000
WTOR     DS    CL88                                                     00932000
         ORG   WTOR                                                     00933000
WTORLENR DS    FL1                                                      00934000
WTORADDR DS    AL3                                                      00935000
WTORECBA DS    AL4                                                      00936000
WTORLEN  DS    FL2                                                      00937000
WTORMCS  DS    BL2                                                      00938000
WTORTEXT DS    CL72                                                     00939000
WTORDESC DS    BL2                                                      00940000
WTORROUT DS    BL2                                                      00941000
         ORG   WTOR+88                                                  00942000
ICBVOP00 CSECT                                                          00943000
         DS    0F                                                       00944000
@SIZDATD DC    AL1(241)                                                 00945000
         DC    AL3(@ENDDATD-@DATD)                                      00946000
@CV00137 DC    V(ICBVMG00)                                              00947000
@CV00138 DC    V(ICBVJL00)                                              00948000
@CV00139 DC    V(ICBVRR00)                                              00949000
         DS    0D                                                       00950000
@CB00154 DC    X'0000'                                                  00951000
@CB00149 DC    B'1000000000000000'                                      00952000
ORID     DC    X'F0'                                                    00953000
QNAME    DC    CL8'SYSZMSVI'                                            00954000
JRNAME   DC    CL8'MSVIJRNL'                                            00955000
VOPPATCH DS    CL200                                                    00956000
         ORG   VOPPATCH                                                 00957000
@NM00009 DC    200X'00'                                                 00958000
         ORG   VOPPATCH+200                                             00959000
ICBVOP00 CSECT                                                          00960000
*                                                          /*@ZM31134*/ 00961000
RESLIST1 RESERVE (QNAME,JRNAME,E,8,SYSTEMS),UCB=RESLIST1,RET=HAVE,MF=L  00962000
ICBVOP00 CSECT                                                          00963000
*                                                          /*@Y30LB26*/ 00964000
WTOMSG WTO '12345678901234567890123456789012345678901234567890123456789*00965000
               0123456789012',ROUTCDE=2,DESC=3,MF=L            @Y30LB26 00966000
ICBVOP00 CSECT                                                          00967000
*                                                          /*@Y30LB26*/ 00968000
WTORMSG WTOR '123456789012345678901234567890123456789012345678901234567*00969000
               890123456789012',ROUTCDE=2,DESC=3,MF=L          @Y30LB26 00970000
@DATD    DSECT                                                          00971000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00972000
@ENDDATD EQU   *                                                        00973000
ICBVOP00 CSECT                                                          00974000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00975000
@01      EQU   01                                                       00976000
@02      EQU   02                                                       00977000
@03      EQU   03                                                       00978000
@04      EQU   04                                                       00979000
@05      EQU   05                                                       00980000
@06      EQU   06                                                       00981000
@07      EQU   07                                                       00982000
@08      EQU   08                                                       00983000
@09      EQU   09                                                       00984000
@10      EQU   10                                                       00985000
@11      EQU   11                                                       00986000
@12      EQU   12                                                       00987000
@13      EQU   13                                                       00988000
@14      EQU   14                                                       00989000
@15      EQU   15                                                       00990000
RPLLNSV  EQU   @07                                                      00991000
RPLBUFSV EQU   @04                                                      00992000
J        EQU   @02                                                      00993000
I        EQU   @04                                                      00994000
MSGPTR   EQU   @02                                                      00995000
VVIPTR   EQU   @06                                                      00996000
RPLVPTR  EQU   @05                                                      00997000
REG0     EQU   @00                                                      00998000
REG1     EQU   @01                                                      00999000
REG2     EQU   @02                                                      01000000
RPLV     EQU   0                                                        01001000
RPLTCBPR EQU   RPLV+8                                                   01002000
RPLVVICB EQU   RPLV+12                                                  01003000
RPLFLAGA EQU   RPLV+28                                                  01004000
RPLVVOP  EQU   RPLFLAGA                                                 01005000
RPLRCODE EQU   RPLV+32                                                  01006000
RPLVRETC EQU   RPLV+34                                                  01007000
RPLVSAM  EQU   RPLV+56                                                  01008000
RPLVBUF  EQU   RPLVSAM+32                                               01009000
RPLVOPT  EQU   RPLVSAM+40                                               01010000
RPLVRLN  EQU   RPLVSAM+48                                               01011000
VVICB    EQU   0                                                        01012000
VVIALCON EQU   VVICB+14                                                 01013000
VVIFLGA  EQU   VVICB+15                                                 01014000
VVIFLG3  EQU   VVIFLGA                                                  01015000
VVIFLG5  EQU   VVIFLGA                                                  01016000
VVIJUCB  EQU   VVICB+80                                                 01017000
TEXT1    EQU   0                                                        01018000
TEXT2    EQU   0                                                        01019000
TEXT3    EQU   0                                                        01020000
TEXT4    EQU   0                                                        01021000
TEXT5    EQU   0                                                        01022000
LIMITADR EQU   0                                                        01023000
MSGLIMIT EQU   0                                                        01024000
USERRBUF EQU   0                                                        01025000
MSGTABLE EQU   0                                                        01026000
MSGTBL   EQU   MSGTABLE                                                 01027000
MESGDEF  EQU   0                                                        01028000
MESGREA  EQU   MESGDEF                                                  01029000
MESGRET  EQU   MESGDEF+2                                                01030000
MESGRTE  EQU   MESGDEF+4                                                01031000
MESGDES  EQU   MESGDEF+6                                                01032000
MESGLEN  EQU   MESGDEF+8                                                01033000
MESGFLG  EQU   MESGDEF+12                                               01034000
MESGFLG1 EQU   MESGFLG                                                  01035000
MESGFLG2 EQU   MESGFLG                                                  01036000
MESGFLG3 EQU   MESGFLG                                                  01037000
MESGLEN1 EQU   MESGDEF+14                                               01038000
MESGLOC1 EQU   MESGDEF+15                                               01039000
MESGLEN2 EQU   MESGDEF+16                                               01040000
MESGLOC2 EQU   MESGDEF+17                                               01041000
MESGLEN3 EQU   MESGDEF+18                                               01042000
MESGLOC3 EQU   MESGDEF+19                                               01043000
MESGLEN4 EQU   MESGDEF+20                                               01044000
MESGLOC4 EQU   MESGDEF+21                                               01045000
MESGLEN5 EQU   MESGDEF+22                                               01046000
MESGLOC5 EQU   MESGDEF+23                                               01047000
MESGSKEL EQU   MESGDEF+24                                               01048000
MSGRQ    EQU   0                                                        01049000
MSGID    EQU   MSGRQ                                                    01050000
MSGRPLV  EQU   MSGRQ+4                                                  01051000
MSGRLEN  EQU   MSGRQ+8                                                  01052000
MSGREPLY EQU   MSGRQ+9                                                  01053000
MSGLEN1  EQU   MSGRQ+12                                                 01054000
MSGTEXT1 EQU   MSGRQ+13                                                 01055000
MSGLEN2  EQU   MSGRQ+16                                                 01056000
MSGTEXT2 EQU   MSGRQ+17                                                 01057000
MSGLEN3  EQU   MSGRQ+20                                                 01058000
MSGTEXT3 EQU   MSGRQ+21                                                 01059000
MSGLEN4  EQU   MSGRQ+24                                                 01060000
MSGTEXT4 EQU   MSGRQ+25                                                 01061000
MSGLEN5  EQU   MSGRQ+28                                                 01062000
MSGTEXT5 EQU   MSGRQ+29                                                 01063000
REPLY    EQU   MESGBUF                                                  01064000
RESJUCB  EQU   RESLIST2+12                                              01065000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    01066000
MESGRES  EQU   MESGDEF+13                                               01067000
MESGFILL EQU   MESGFLG                                                  01068000
MESGLOC  EQU   MESGDEF+9                                                01069000
VVIUNUSD EQU   VVICB+116                                                01070000
VVINUSDC EQU   VVICB+112                                                01071000
VVITPFCH EQU   VVICB+108                                                01072000
VVIDVMEL EQU   VVICB+104                                                01073000
VVIVBSTF EQU   VVICB+100                                                01074000
VVISSOBA EQU   VVICB+96                                                 01075000
VVIVSCRA EQU   VVICB+92                                                 01076000
VVISTPTB EQU   VVICB+88                                                 01077000
VVIDVMTA EQU   VVICB+84                                                 01078000
VVIIUCB  EQU   VVICB+76                                                 01079000
VVIRES6  EQU   VVICB+72                                                 01080000
VVIRES5  EQU   VVICB+68                                                 01081000
VVIRES4  EQU   VVICB+64                                                 01082000
VVIUCB   EQU   VVICB+60                                                 01083000
VVIVJL   EQU   VVICB+56                                                 01084000
VVIVRR   EQU   VVICB+52                                                 01085000
VVIQLSPL EQU   VVICB+48                                                 01086000
VVIQRPL2 EQU   VVICB+44                                                 01087000
VVIQRPL1 EQU   VVICB+40                                                 01088000
VVIRES3  EQU   VVICB+36                                                 01089000
VVIVQMP  EQU   VVICB+32                                                 01090000
VVIECB1  EQU   VVICB+28                                                 01091000
VVICATAD EQU   VVICB+24                                                 01092000
VVIDCBAD EQU   VVICB+20                                                 01093000
VVIACBAD EQU   VVICB+16                                                 01094000
VVIFLG7  EQU   VVIFLGA                                                  01095000
VVIFLG6  EQU   VVIFLGA                                                  01096000
VVIFLG4  EQU   VVIFLGA                                                  01097000
VVIFLG2  EQU   VVIFLGA                                                  01098000
VVIFLG1  EQU   VVIFLGA                                                  01099000
VVIFLG0  EQU   VVIFLGA                                                  01100000
VVICPUID EQU   VVICB+12                                                 01101000
VVIUCAT  EQU   VVICB+4                                                  01102000
VVICID   EQU   VVICB                                                    01103000
RPLVUTIL EQU   RPLV+132                                                 01104000
RPLVBLN  EQU   RPLVSAM+52                                               01105000
@NM00007 EQU   RPLVSAM+44                                               01106000
RPLVUPD  EQU   RPLVOPT+1                                                01107000
@NM00006 EQU   RPLVOPT                                                  01108000
RPLVKGE  EQU   RPLVOPT                                                  01109000
@NM00005 EQU   RPLVOPT                                                  01110000
RPLVNEXT EQU   RPLVOPT                                                  01111000
RPLVDIR  EQU   RPLVOPT                                                  01112000
RPLVLOC  EQU   RPLVOPT                                                  01113000
RPLVKEY  EQU   RPLVSAM+36                                               01114000
@NM00004 EQU   RPLVSAM+28                                               01115000
RPLVACB  EQU   RPLVSAM+24                                               01116000
@NM00003 EQU   RPLVSAM+3                                                01117000
RPLVTYP  EQU   RPLVSAM+2                                                01118000
@NM00002 EQU   RPLVSAM                                                  01119000
@NM00001 EQU   RPLV+42                                                  01120000
RPLVDATE EQU   RPLV+38                                                  01121000
RPLRMSCC EQU   RPLV+36                                                  01122000
RPLVTLEN EQU   RPLV+30                                                  01123000
RPLVRES1 EQU   RPLFLAGA+1                                               01124000
RPLVJRNL EQU   RPLFLAGA                                                 01125000
RPLJRCVY EQU   RPLFLAGA                                                 01126000
RPLVVIN  EQU   RPLFLAGA                                                 01127000
RPLVCOMP EQU   RPLFLAGA                                                 01128000
RPLVPROG EQU   RPLFLAGA                                                 01129000
RPLVPOST EQU   RPLFLAGA                                                 01130000
RPLFTIME EQU   RPLFLAGA                                                 01131000
RPLVRSV3 EQU   RPLV+24                                                  01132000
RPLVRSV2 EQU   RPLV+20                                                  01133000
RPLVRSV1 EQU   RPLV+16                                                  01134000
RPLASCBP EQU   RPLTCBPR                                                 01135000
RPLVECB  EQU   RPLV+4                                                   01136000
RPLVQPTR EQU   RPLV                                                     01137000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      01138000
@RF00144 EQU   @EL00002                                                 01139000
@RF00170 EQU   @EL00002                                                 01140000
@ENDDATA EQU   *                                                        01141000
         END   ICBVOP00,(C'PLS0341',0603,77070)                         01142000
