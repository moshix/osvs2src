         TITLE 'IFG0193A                      OPEN INITIAL JFCB PROCESSI00100002
               ING'                                              Y02134 00150002
IFG0193A CSECT                                                          00400021
*********************************************************************** 00450002
*                                                                     * 00452008
*        VS2 RELEASE 03 DELETIONS/CHANGES                             * 00454008
*0000                                                          @ZA02193 00456008
*0000506000                                                    @ZA12906 00458008
*0000517488                                                    @ZA12942 00459008
*A314000-315600,A316400,517488,273146                          @ZA25895 00459108
*A506000                                                       @ZA25251 00459508
*A36981700,37031700                                            @ZA26878 00459608
*D50750037                                                     @ZA26878 00459708
*                                                                     * 00460002
* MODULE NAME = IFG0193A (OS/VS2)                                     * 00470002
*                                                                     * 00480002
* DESCRIPTIVE NAME = OPEN INITIAL JFCB PROCESSING                     * 00490002
*                                                                     * 00492002
* COPYRIGHT = NONE                                                    * 00494002
*                                                                     * 00496002
* STATUS = RELEASE 2, LEVEL 0                                         * 00498002
*                                                                     * 00498402
* FUNCTION =                                                          * 00498802
*        1. INITIALIZE LAST PLUS NEXT WHERE-TO-GO ENTRY.              * 00498902
*                                                                     * 00499002
*        2. TURN ON TRACE ROUTINE INDICATOR IF REQUIRED.              * 00499102
*                                                                     * 00499202
*        3. LOCATE DCB AND START PARALLEL PROCESSING:                 * 00499302
*           A. GET CORE STORAGE FOR DEB EXTENSION FOR ALL DCB/ACB'S   * 00499402
*           EXCEPT SPOOLED DCB'S;                                     * 00499502
*           B. GO TO PROBLEM DETERMINATION IF VSAM ACB IS BEING       * 00504302
*           PROCESSED (IDA0192P);                                     * 00506302
*           C. GO ISAM INTERFACE MODULE IF ISAM TO VSAM INTERFACE     * 00508302
*           (IFG0192I).                                               * 00508702
*                                                                     * 00509102
*        4. PERFORM ANY PROCESSING FOR AN OPEN OVERRIDE REQUEST       * 00513302
*        (LABEL = (,,,IN) OR LABEL = (,,,OUT) IN THE DD STATEMENT).   * 00515302
*                                                                     * 00517302
*        5. TURN OFF NEGATIVE INDICATOR FOR OPEN ACCESS METHOD        * 00517702
*        EXECUTOR IF DIRECT ACCESS WITH RPS.                          * 00517802
*                                                                     * 00517902
*        6. MERGE DSORG FROM JFCB PRIOR TO SELECTING VOLUME SERIAL    * 00518202
*        NUMBER.                                                      * 00518602
*                                                                     * 00518702
*        7. TEST FOR A VALID VOLUME SEQUENCE NUMBER. WHEN PROCESSING  * 00519902
*        STARTS WITH A SELECTED VOLUME OF A PHYSICAL SEQUENTIAL DATA  * 00521902
*        SET, THEN THE VOLUME SEQUENCE NUMBER MUST BE LESS THAN OR    * 00522302
*        EQUAL TO THE NUMBER OF VOLUMES ALLOCATED.                    * 00523502
*                                                                     * 00525502
*        8. SET UP PARAMETERS TO MOUNT TAPE AND DA VOLUMES.           * 00525902
*                                                                     * 00526002
*        9. SET RPS INDICATOR FOR ACCESS METHOD. IF ALL        Z30TSRJ* 00526103
*        VOLUMES WILL ACCEPT RPS COMMANDS, AND AT LEAST        Z30TSRJ* 00526203
*        ONE IS NON-VIO, SET TO ALLOW RPS COMMANDS.            Z30TSRJ* 00526303
*                                                                       00526430
*        10. ZERO NOT-READY BIT IN UCB FOR 3895 DOCUMENT       @Z30HSRB 00526630
*        READER/INSCRIBER DEVICE.                              @Z30HSRB 00526830
*                                                                     * 00527030
* NOTES = SEE BELOW                                                   * 00527202
*                                                                     * 00528402
*    DEPENDENCIES =                                                   * 00530602
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 00534802
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 00539002
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 00543202
*                                                                     * 00553202
*    RESTRICTIONS = NONE                                              * 00563202
*                                                                     * 00565202
*    REGISTER CONVENTIONS =                                           * 00565602
*            R2 POINTS TO DCB                                         * 00566002
*            R4 POINTS TO OPEN WORK AREA                              * 00566402
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 00566502
*            R6 POINTS TO THE WTG TABLE                               * 00566602
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 00577702
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 00587702
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 00588102
*            R10 POINTS TO THE UCB                                    * 00588502
*                                                                     * 00588602
*    PATCH LABEL = SEE NEXT TO LAST LABEL BEFORE ORG STATEMENT AT END * 00588702
*                  OF LISTING.                                        * 00588802
*                                                                     * 00592502
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 00594502
*                                                                     * 00594902
*    PROCESSOR = ASSEMBLER XF                                         * 00595302
*                                                                     * 00595702
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 00596102
*                  ORG STATEMENT AT END OF LISTING                    * 00596202
*                                                                     * 00622102
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 00632102
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 00642102
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 00644102
*                                                                     * 00646102
* ENTRY POINT = IFG0193A FROM:                                        * 00648102
*                 IGC0001I FOR NORMAL PROCESSING                      * 00650202
*                 IGC0002B FOR NORMAL PROCESSING                      * 00652202
*                                                                     * 00656702
*    PURPOSE = DETERMINE DEVICE DEPENDENT PROCESSING STRING.          * 00658702
*                                                                     * 00660702
*    LINKAGE = STANDARD OPEN/CLOSE/EOV INTERFACE.                     * 00662702
*                                                                     * 00664702
* INPUT = STANDARD OPEN/CLOSE/EOV INTERFACE.                          * 00665102
*                                                                     * 00665202
* OUTPUT = CONTROL BLOCKS & WORKAREAS INITIALIZED FOR DEVICE          * 00665302
*          DEPENDENT PROCESSING. STANDARD OPEN/CLOSE/EOV              * 00667402
*          LINKAGE CONVENTIONS USED.                                  * 00669402
*                                                                     * 00670402
* EXIT-NORMAL = AS FOLLOWS -                                          * 00674002
*               IFG0192I - ISAM TO VSAM INTERFACE MODULE              * 00674802
*               IFG0196J - FIRST COMMON MERGE MODULE                  * 00678802
*               IFG0192A - VSAM STRING                                * 00680902
*               IFG0194A - VOLUME SELECT (TAPE - DIRECT ACCESS)       * 00683002
*               IFG0192F - VTAM STRING                                * 00685102
*               IFG0196V - ACCESS METHOD EXECUTOR                     * 00687202
*                                                                     * 00689302
* EXIT-ERROR = IFG0190P - PROBLEM DETERMINATION                       * 00691402
*              IDA0192P - VSAM PROBLEM DETERMINATION                  * 00693402
*                                                                     * 00693502
* EXTERNAL REFERENCES = SEE BELOW                                     * 00695602
*                                                                     * 00697702
*    ROUTINES = IFG0190P,IFG0194A,IFG0196J,IFG0192A,IFG0198N,         * 00699802
*               IFG0192I,IFG0196V,IFG0192F,IFG0192P,IFG0195A,         * 00701802
*               IFG0195B,IFG0195C,IFG0195D.                           * 00704602
*                                                                     * 00707702
*    DATA AREAS = SEE PARAMETERS OF IECDSECS MACRO.                   * 00710502
*                                                                     * 00713302
*    CONTROL BLOCK = SEE PARAMETERS OF IECDSECS MACRO.                * 00716102
*                                                                     * 00726102
* TABLES = SEE XCTLTABL MACRO.                                        * 00728102
*                                                                     * 00728502
* MACROS = IECDSECS,IECEQU,IECRES,MODESET,SETLOCK,DMABCOND,XCTLTABL.  * 00728902
*                                                                     * 00729302
* CHANGE ACTIVITY = NEW RELEASE (LEVEL 0)                             * 00729702
*                                                                     * 00731703
*        VS2 RELEASE 041 DELETIONS/CHANGES                     @Z40JSGD 00732708
*0000                                                          @Z40JSGD 00732830
*        VS2 RELEASE 03.7 SU 30                                @Z30HSRB 00732930
*0000512680                                                    @Z30HSRB 00733030
*0000                                                          @ZM44722 00733130
*                                                                       00733230
*        VS2 RELEASE 03 DELETIONS/CHANGES                             * 00733703
*0000273320,273420,273478                                       Y30ASJC 00735703
*    517532,517532                                              Z30TSRJ 00735803
*                                                                     * 00737502
*********************************************************************** 00739502
         EJECT                                                          12800021
         IECDSECS CVT,TCB,TIOT,UCB,DCB,ACB,MAIN,PREFX,WTG,       Y02080*12900002
               PSA,DSAB,                                         Y02082*12902002
               IEZDEB,IDAPDPRM                                   Y02004 12950002
TIOTSPOL EQU   X'06'                    SPOOL INDICATOR          YM3070 13000002
ACBMJEP  EQU   X'40'                    ACB JEPS INDICATOR       X02989 13050002
DATAMGT  EQU   X'50'                    DATA MANAGEMENT KEY      YM3070 13100002
WALNTH   EQU   X'23A'                   LENGTH OF 2311 ERP WA    YM3153 13105002
         IECEQU AOS=YES,IEZDEB=YES                               Y02134 13230002
*                                                                       13300021
         USING IHADCB,RDCB              DEFINE BASE TO USER'S DCB       13400021
         USING FORCORE,RCORE            DEFINE BASE TO MAIN WORK AREA   13500021
         USING WTG,RWTG                 DEFINE BASE TO XCTL/WTG TABLE   13600021
         USING TIOENTRY,RTIOT           DEFINE BASE TO TIOT DD ENTRY    13700021
         USING UCBOB,RUCB               DEFINE BASE TO MAIN UCB         13800021
         USING USERPRML,RPARC           RPARC POINTS TO CURRENT  Y02134 13850002
*                                                                       13900021
         BALR  RBASE,R0                 ESTABLISH BASE REGISTER         14000002
         USING *,RBASE                  DEFINE BASE REGISTER            14100021
*                                                                       14200021
         B     OIN30200(RET)            BR TO INDICATED FUNCTION        14300021
*                                                                       14400021
OIN30200 B     OIN30400                 RET=0 INITIAL ENTRY FROM OPEN   14500021
         B     OIN32800                 RET=4 PARALLEL OPEN DCB START   14600021
*                                                                       14800021
*********************************************************************** 14900021
*                                                                       15000021
*  INTIALIZE WTG TABLE ENTRIES                                          15100021
*                                                                       15200021
OIN30400 EQU   *                        INITIAL ENTRY                   15300002
         L     RPAR,WTGPREFX            PT TO BASE PREFIX        Y02080 15350002
         L     RPAR,IECUPRML-IECPREFX(,RPAR) ADDR OF PARAMLIST   Y02080 15400002
         LR    RPARC,RPAR               ADDR FIRST ENTRY IN PARM LIST   15500021
         LA    RWTGC,WTGENTRY           ADDR FIRST ENTRY IN WTG TABLE   15600021
         USING WTGENTRY,RWTGC           DEFINE BASE TO CURRENT WTG      15700021
*                                                                       15800021
OIN30600 EQU   *                        LOOP FOR NEXT DCB               15900002
         L     RF,WTGCORE-K1            LOAD DCB WORK AREA ADDR  A39979 16000021
         LTR   RF,RF                    IS DCB BEING OPENED      A39979 16400021
         BZ    OIN31300                 BR IF NO                 A39979 16800021
*                                                                       17200021
         LR    RCORE,RF                 WORK AREA ADDR TO RCORE  A39979 17300021
         LA    RET,K4                   BRANCH INDEX             Y02080 17950002
         ST    RET,DXREGE               STORE FOR LOAD BY RESIDENT RTN  18000021
*                                                                       18100021
         TM    JFCBMASK+K6,JFCTRACE     IS TRACE ROUTINE DESIRED        18800021
         BZ    OIN31300                 BR IF NO TO NEXT DCB     A39979 18900021
*                                                                       19000021
         OI    WTGPATHS+K1,WTGTRACE     SET TRACE ROUTINE INDR          19100021
*                                                                       19200021
OIN31300 EQU   *                        CHECK FOR MORE DCBS      A39979 19240002
         TM    DXDCBLST,LASTNTRY        CHECK FOR LAST ENTRY     Y02134 19280002
         LA    RPARC,L'DXDCBLST(,RPARC) ADVANCE TO NEXT PARM DCB Y02134 19320002
         LA    RWTGC,L'WTGENTRY(,RWTGC) ADVANCE NEXT WTG ENTRY   Y02134 19360002
         BZ    OIN30600                 BR IF NO TO NEXT DCB     A39979 19400021
*                                                                       19440021
         XC    WTGENTRY,WTGENTRY        CLEAR EXTRA WTG ENTRY           19500021
*                                                                       19700021
*********************************************************************** 24300021
*                                                                       24400021
*  LOCATE A DCB TO START PARALLEL PROCESSING.                           24500021
*                                                                       24510002
OIN32200 EQU   *                        PARALLEL PROCESSING             24550002
*                                                                       24600021
         LA    RWTGC,WTGENTRY-WTG(,RWTG) POINT TO FIRST ENTRY IN WTG    24700002
         LR    RPARC,RPAR               POINT TO FIRST DCB IN PARM LIST 24800021
         L     RES,CVTPTR               GET CVT ADDR             A39979 24900021
         L     RES,CVTDMSR-CVT(,RES)    GET RESIDENT RTN ADDR    A39979 24950021
*                                                                       25000021
OIN32400 EQU   *                        CHECK IF ACTIVE                 25100002
         CLC   WTGIDTTR(K2),OIN3930X    IS DCB ACTIVE IN THIS MODULE    25200021
         BE    OIN32600                 BR IF YES                       25300021
*                                                                       25400021
         LA    RPARC,L'DXDCBLST(,RPARC) ADVANCE TO NEXT PARM     Y02134 25500002
         LA    RWTGC,L'WTGENTRY(,RWTGC) ADVANCE TO NEXT WTGENTRY Y02134 25600002
         B     OIN32400                 BR TO FIND ACTIVE DCB           25700021
*                                                                       25800021
OIN32600 EQU   *                        INITIALIZE REGS                 25900002
         L     RDCB,DXDCBLST            LOAD CURRENT DCB ADDR    Y02134 26000002
         L     RCORE,WTGCORE-K1         LOAD CURRENT WORK AREA ADDR     26100021
         L     RTIOT,DXTIOTAD           LOAD ADDR TIOT DD ENTRY  YM1294 26150002
         L     R0,DXREG0                INT ABEND CODE           Y02080 26160002
         LTR   R0,R0                    DEF ABEND FROM 1ST LOADS Y02080 26170002
         BNZ   OIN37800                 ABEND IF DEFERRED        Y02080 26180002
*                                                                       26200021
         DROP  RWTGC                                                    26300002
*                                                                       26400021
*********************************************************************** 26500021
*                                                                       26600021
*  FROM THIS POINT ON, ALL PARALLELISM OF DCB'S IS HANDLED BY THE       26700021
*  RESIDENT ROUTINE.                                                    26800021
*                                                                       26900021
*********************************************************************** 27000021
*                                                                       27100021
OIN32800 EQU   *                        PARALLEL PROCESSING ENTRY       27200002
*                                                                       27210002
*        GET DEB EXTENSION FOR ALL DCB/ACBS EXCEPT SPOOLED DCBS  Y02134 27250002
*        FOR WHICH NO DEB IS OBTAINED DIRECTLY                   Y02134 27300002
*        ALSO, DO NOT GET DEB EXTENSION FOR VTAM ACB, WHICH     Y30ASJC 27300103
*        HAS KEY 6 ACDEB INSTEAD OF REGULAR DEB.                Y30ASJC 27300203
*                                                                       27300402
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP   Y30ASJC 27300503
         BO    OIN32810                 BR IF YES, NOT AN ACB   Y30ASJC 27300603
*                                                                       27300703
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB Y30ASJC 27302203
         BZ    OIN32810                 BR IF NO                Y30ASJC 27302503
*                                                                Y02004 27302603
         CLI   ACBAMETH-IFGACB(RDCB),ACBVTAM TEST FOR VTAM ACB  Y30ASJC 27303003
         BE    OIN37600                 YES, BYPASS JFCB READ   Y30ASJC 27303403
*                                                                       27303503
OIN32810 EQU   *                        NON VTAM DATA SET       Y30ASJC 27303603
*                                                                       27303803
         LTR   RTIOT,RTIOT              DON'T TEST TIOT IF ZERO  YM2436 27304103
         BZ    OIN32820                 BRANCH IF NO TIOT ADDR   YM2436 27305603
         TM    TIOELINK,TIOTSPOL        IS DS SPOOLED SYSIN-OUT  Y02134 27307103
         BZ    OIN32820                 BR IF NO                 Y02134 27308603
         TM    DCBDSRG2,ACBDORGA        IS IT AN ACB?            Y02134 27310103
         BZ    OIN32850                 BR IF NO - NO DEB EXT    Y02134 27311603
OIN32820 EQU   *                        GET DEB EXTENSION               27313103
         LA    RET,LTHODEBX(0,0)        LENGTH OF DEB EXT      @ZM43353 27314608
         IECRES GET,PREFIX=NO,LV=(RET),STM=(2,14,WTGPREFX)       Y02134 27316103
         ST    R1,DXDEBXAD              STORE DEBX ADDR IN WKA   Y02134 27317603
         USING DEBXTN,R1                DEB EXTENSION USING      Y02134 27319103
         STH   RET,DEBXLNGH             LENGTH OF DEB EXTENSION  Y02134 27320603
         MVC   DEBXDSAB,DXDSABAD        DSAB ADDR IN DEBX        Y02134 27322103
         MVC   DEBXDSO1(L'DCBDSORG),DCBDSORG DSORG IN DEBX       Y02134 27323603
         MVC   DEBXMCF1(L'DCBMACRF),DCBMACRF MACRF IN DEBX       Y02134 27325103
         DROP  R1                                                Y02134 27326603
         LTR   RTIOT,RTIOT              DON'T TEST TIOT IF ZERO  YM2436 27328103
         BZ    OIN32840                 BRANCH IF NO TIOT ADDR   YM2436 27329603
*                                                                       27331103
*  DETERMINE IF THE CONTROL BLOCK IS FOR A SPOOLED DATA SET             27332603
*                                                                       27334103
         TM    TIOELINK,TIOTSPOL        IS DS SPOOLED SYSIN-OUT  A39979 27335603
         BM    OIN32850                 BR IF YES                Y02120 27337103
*                                                                       27338603
*  TEST FOR AN ACB                                                      27340103
*                                                                       27341603
OIN32840 EQU   *                        DCB OR ACB              Y30ASJC 27343103
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    A39979 27344603
         BO    OIN32950                 BR IF YES, NOT AN ACB    A39979 27346103
*                                                                       27347603
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  A39979 27349103
         BZ    OIN32950                 BR IF NO                 A39979 27350603
         B     OIN32900                 BRANCH IF NO             Y02120 27358103
*                                                                       27359603
*  A JES DCB OR ACB IS BEING PROCESSED                                  27361103
*                                                                       27362603
OIN32850 EQU   *                        SPOOLED DATA SET         Y02120 27364103
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    Y02120 27365603
         BZ    OIN32900                 BRANCH IF NO             Y02120 27367103
OABD051  EQU   51                       013 INTERNAL ABEND CODE  Y02120 27368603
         LA    R0,OABD051               013 ABEND IF EXCP/SPOOL  Y02120 27370102
         B     OIN37800                 BRANCH TO ABEND          Y02120 27380102
OIN32900 EQU   *                        TEST FOR JFCB ERROR      A39979 27392402
         TM    DXECB,ECBNOERR           JFCB READ GOOD           X02989 27396802
         BO    OIN32930                 BR IF YES                X02989 27410002
         USING IFGACB,RACB              DEFINE BASE TO ACB       X02989 27410402
*                                                                X02989 27412402
*  IF A VSAM ACB IS BEING PROCESSED, INITIALIZE PARAMETER LIST   X02989 27412502
*  AND BRANCH TO VSAM PROBLEM DETERMINATION.                     X02989 27412602
*                                                                X02989 27412702
         TM    ACBINFL,ACBMJEP          IS THIS A JEPS ACB       X02989 27416002
         BO    OIN32950                 BR IF YES                X02989 27418002
         TM    TIOELINK,TIOTSPOL        IS THIS A SPOOLED ACB    X02989 27425302
         BM    OIN32950                 BR IF YES                X02989 27428602
         MVI   ACBERFLG,VSOJFBER        SET READ JFCB ERROR      X02989 27431902
         LA    RC,DXIOB                 LD ADDR OF WORK AREA     X02989 27435202
         USING IDAPDPRM,RC              SET BASE FOR PARM LIST   X02989 27437202
         XC    IDAPDPRM(PDPLNGTH),IDAPDPRM ZERO PARAMETER LIST   X02989 27439702
         MVI   PDPCALL,PDPOPEN          INDICATE CALLER          X02989 27439802
         MVI   PDPCODE,VSJFBERR         SET INTERNAL ERROR CODE  X02989 27439902
         MVI   PDPFUNC,VSOPEN           LOAD FUNCTION CODE       X02989 27449902
         ST    RDCB,PDPACB              LOAD ADDR OF ACB         X02989 27459902
         ST    RTIOT,PDPTIOT            LOAD ADDR OF TIOT ENTRY  X02989 27469902
         LR    R1,RCORE                 LD ADDR OF WORK AREA     X02989 27543202
         IECRES LOAD,MODNM=OIN4010K,BRANCH=NO,PREFIX=WTGPREFX    Y02080*27553202
                                        LOAD VSAM PD ROUTINE     Y02080 27563202
         L     RF,WTGMODEP              GET EPA                  Y02080 27573202
         BALR  RET,RF                   BR TO VSAM PD ROUTINE    X02989 27583202
         MVC   WTGMODNM,OIN3870K        RESET MOD NAME TO OPEN   Y02080 27593202
         XC    WTGMODEP,WTGMODEP        CLEAR ADDR               Y02080 27594002
         MVI   JFCDSRG2,JFCORGAM        SET VSAM INDICATOR       X02989 27595202
         NI    ACBOFLGS,X'FF'-DCBOBUSY  TURN OFF BUSY BIT        X02989 27597202
         B     OIN37500                 BR TO XCTL               X02989 27647202
*                                                                X02989 27732002
*  SET LOCK BIT ON IN ALL ACBS, AND SET VSAM FLAG IN VSAM ACBS.  X02989 27734002
*                                                                X02989 27736002
OIN32930 EQU   *                        VALIDITY CHECK ACB       X02989 27736402
         TM    TIOELINK,TIOTSPOL        SPOOLED DATA SET?        Y02120 27736802
         BM    OIN32937                 BRANCH IF YES            Y02120 27737202
         TM    JFCDSRG2,JFCORGAM        TEST FOR VSAM            X02989 27738102
         BO    OIN32933                 BRANCH IF YES            YM5597 27738202
         MVI   ACBERFLG,VSOACBIN        SET ACB INVALID ERROR    YM5597 27740202
         MVI   JFCDSRG2,JFCORGAM        SET VSAM BIT IN JFCB     YM5597 27742202
         NI    ACBOFLGS,ALLBITS-DCBOBUSY TURN OFF BUSY BIT       YM5597 27742602
         B     OIN37500                 XCTL TO VSAM STRING      YM5597 27743002
*                                       TO RESTORE ACB           YM5597 27743402
OIN32933 EQU   *                        VSAM PROCESSING          YM5597 27743802
         MVI   ACBAMETH,ACBVSAM         SET VSAM FLAG IN ACB     X02989 27743902
         TM    DXWORK1,ACBCAT+ACBSCRA   OPEN VSAM CATLG/SCRA    Z30SSRL 27745908
         BM    OIN32935                 BR IF YES              @Y30DSDT 27747908
         SR    RTIOT,RTIOT              ZERO TIOT PTR            X02989 27749902
OIN32935 EQU   *                        VSAM ACB PROCESSING      X02989 27751902
         XC    DXWORK1,DXWORK1          ZERO VSAM CATLG FLAG     X02989 27752302
         B     OIN37500                 BR TO XCTL TO VSAM MOD   X02989 27753902
OIN32937 EQU   *                        SPOOLED ACB PROCESSING   Y02120 27754302
         USING IHADCB,RDCB              DEFINE BASE TO DCB       Y02120 27756602
         TM    DCBDSRG2,ACBDORGA        ACB? (CAN'T BE EXCP)     Y02120 27759002
         BZ    OIN37000                 IFG0196J IF SPOOLED DCB  Y02120 27761302
         USING IFGACB,RACB              DEFINE BASE TO ACB       Y02120 27763302
         MVI   ACBAMETH,ACBSUBS         SET SUBSYSTEM FLAGS      Y02120 27763602
OIN32940 EQU   *                        GO TO SPOOLED DCB        X02989 27765902
         USING IHADCB,RDCB              DEFINE BASE TO DCB       X02989 27768202
*                                                                       27782102
         IECRES LOAD,MODID=LOAD6V3A,BRCODE=0, XCTL TO SELECT     Y02080*27805202
               BRANCH=QUEUED            A.M. EXECUTOR            Y02080 27807602
*                                                                       27808302
OIN32950 EQU   *                        CHECK PREVIOUS ERROR     A39979 27821402
         L     RUCB,DXUCBADR            PREPARE FOR DEVICE TYPE  Y02134 27847602
*                                       DEPENDENT PROCESSING     Y02134 27860702
         TM    DXECB,ECBNOERR           CHECK FOR I/O ERROR             27873802
         BO    OIN33200                 BR IF NO ERROR                  27886902
OABD034  EQU   34                       JFCB EXIT LIST ENTRY MISSING    27900021
         LA    R0,OABD034               LOAD OPEN J ERROR CODE          28000021
         CLI   DXECB,ECBCOD7F-ECBNOERR  IS THIS OPEN J EXIT LIST ERROR  28100021
         BE    OIN37800                 BR IF YES                       28200002
*                                                                       28300021
OABD033  EQU   33                       I/O ERROR READING JFCB          28400021
         LA    R0,OABD033               LOAD JFCB ERROR CODE            28500021
         B     OIN37800                 BRANCH TO PROBLEM DET    Y02134 28550002
*                                                                       28600021
OIN33200 EQU   *                        INITIALIZE IOB IN WORK AREA     29000002
         LA    RF,DXCCW1                RESTORE START CCW ADDR IN       29100021
         ST    RF,IOBSTART-K1           WORK IOB IN CASE RPS JFCB       29200021
         EJECT                                                          29200208
         MVC   DXCCW6(K1),DXDCBLST      OPEN OPTIONS           @Z40JSGD 29201008
         NI    DXCCW6,PLISTOP1          REMOVE ALL BUT OPTION1 @Z40JSGD 29202008
*                                                              @Z40JSGD 29203008
* IF EXTEND OR OUTINX OPTION WAS REQUESTED THEN SAVE DISP      @Z40JSGD 29204008
* SET DISP=MOD AND CHANGE OPEN OPTION TO OUTPUT OR OUTIN.      @Z40JSGD 29205008
* IFG0196X WILL RESTORE JFCBDISP BEFORE REWRITING THE JFCB     @Z40JSGD 29206008
*                                                              @Z40JSGD 29207008
         NI    JFCBMASK+K7,ALLBITS-JFCMDSPM-JFCMDSPO CLEAR     @Z40JSGD 29208008
*                                       DISP                   @Z40JSGD 29209008
         CLI   DXCCW6,PLISTEXT          IS IT OPEN FOR EXTEND  @Z40JSGD 29210008
         BE    OIN33220                 YES - SAVE DISP        @Z40JSGD 29211008
         CLI   DXCCW6,PLISTOIX          IS IT OPEN FOR OUTINX  @Z40JSGD 29212008
         BNE   OIN33290                 NO-DON'T SAVE DISP     @Z40JSGD 29213008
* CORRECT THE OPEN PARAMETER LIST EXTEND AND OUTINX NOT        @Z40JSGD 29213208
* EXPECTED BY ACCESS METHOD EXECUTORS.                         @Z40JSGD 29213408
OIN33220 OI    DXDCBLST,X01             CHANGE OUTPUT/OUTINX   @Z40JSGD 29214008
* CHECK IF SCHEDULER SET DISP TO NEW FROM MOD                  @Z40JSGD 29214208
         TM    JFCBFLG2,JFCMODNW        DID SCHE RESET DISP    @Z40JSGD 29214408
         BO    OIN33270                 YES - SAVE DISP=MOD    @Z40JSGD 29214608
* SAVE JFCBDISP IN THE JFCBMASK                                @Z40JSGD 29215008
         TM    JFCBIND2,JFCMOD          IS BIT 1 SET           @Z40JSGD 29216008
         BZ    OIN33250                 NO-DON'T SAVE BIT 1    @Z40JSGD 29217008
         OI    JFCBMASK+K7,JFCMDSPM     YES-SAVE BIT 1         @Z40JSGD 29218008
OIN33250 TM    JFCBIND2,JFCOLD          IS BIT 2 SET           @Z40JSGD 29219008
         BZ    OIN33260                 NO-DON'T SAVE BIT 2    @Z40JSGD 29220008
         OI    JFCBMASK+K7,JFCMDSPO     YES-SAVE BIT 2         @Z40JSGD 29221008
OIN33260 EQU   *                        SET JFCBDISP=MOD       @Z40JSGD 29222008
* CHANGE DISP TO MOD FOR ACCESS METHOD EXECUTORS               @Z40JSGD 29222208
* AND THE REST OF OPEN.                                        @Z40JSGD 29222408
         NI    JFCBIND2,ALLBITS-JFCDISP CLEAR DISPOSITION      @Z40JSGD 29223008
         OI    JFCBIND2,JFCMOD          DISP = MOD             @Z40JSGD 29224008
         B     OIN33290                 DONE                   @Z40JSGD 29225008
* SAVE DISP = MOD BECAUSE SCHEDULER SET THE DISP TO NEW        @Z40JSGD 29226008
OIN33270 NI    JFCBFLG2,ALLBITS-JFCMODNW RESET SCHEDULER SW SO @Z40JSGD 29227008
*                                       RESTORE WILL NOT BE    @Z40JSGD 29228008
*                                       DONE                   @Z40JSGD 29229008
         OI    JFCBMASK+K7,JFCMDSPM     SAVE DISP=MOD          @Z40JSGD 29230008
OIN33290 EQU   *                        DONE                   @Z40JSGD 29231008
         EJECT                                                          29232008
*                                                                X02989 29260002
* IF ISAM TO VSAM INTERFACE IS INDICATED,                        X02989 29270002
* SET WTGIDTTR FOR DCB TO ISAM INTERFACE MODULE.                 X02989 29280002
*                                                                X02989 29292002
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    X02989 29294002
         BO    OIN33300                 BR IF YES                X02989 29296002
         TM    DCBDSRG1,DCBDSGIS        ISAM DCB                 X02989 29298002
         BNO   OIN33300                 BR IF NO                 X02989 29298402
         TM    JFCDSRG2,JFCORGAM        IS DATA SET VSAM         X02989 29298802
         BNO   OIN33300                 BR IF NO                 X02989 29299202
         NI    DCBOFLGS,X'FF'-DCBOLOCK  TURN OFF LOCK BIT        X02989 29299602
         OI    DXATGENS,DXATVCIG        ISAM-VSAM CI GIVEN CNTRL Y02144 29309602
         IECRES LOAD,MODID=OIN3990Y,BRCODE=0,                    Y02080*29319602
               BRANCH=QUEUED                                     Y02080 29323602
OIN33300 EQU   *                        OUTIN/INOUT OVERIDE      X02989 29324702
*********************************************************************** 29400021
*                                                                       29500021
*   PERFORM ANY PROCESSING REQUIRED FOR AN OPEN OVERRIDE REQUEST.       29600021
*   THE REQUEST IS MADE BY THE LABEL=(,,,IN)                            29700021
*   OR LABEL=(,,,OUT) DD STATEMENT PARAMETER.                           29800021
*                                                                       29900021
*********************************************************************** 29950002
*                                                                       29960002
         TM    JFCBMASK+K6,JFCINOP+JFCOUTOP  IS AN OVERRIDE REQUESTED   30000021
         BZ    OIN33800                 BR IF NO                        30100021
         BO    OIN33600                 IF BOTH ON, IGNORE THEM         30200021
         TM    JFCBMASK+K6,JFCINOP      IS IT LABEL=(,,,IN)             30300021
         BO    OIN33400                 BR IF YES                       30400021
*                                       LABEL=(,,,OUT)                  30500021
         TM    DXDCBLST,PLISTOIN        OPENING FOR OUTIN        Y02134 30600002
         BNO   OIN33800                 BR IF NO                        30700021
         TM    DXDCBLST,PLISTOP1-PLISTOIN  OPENING FOR OUTPUT    Y02134 30800002
         BNZ   OIN33800                 BR IF OUTPUT                    30900021
         OI    DXDCBLST,PLISTOUT        CHANGE OPEN TO OUTPUT    Y02134 31000002
         OI    JFCBMASK+K6,JFCINOP      INDIC OVERRIDE REQ       YM5943 31050002
         B     OIN33800                 PERFORM OUTPUT PROCESSING       31200021
*                                                                       31300021
OIN33400 EQU   *                        FIRST,CHECK BDAM       @ZA25895 31400008
         TM    DCBDSORG,DCBDSGDA        IS DCB FOR BDAM?       @ZA25895 31420008
         BNO   OIN33450                 NO,BRANCH              @ZA25895 31440008
         TM    DXDCBLST,PLISTOUT-PLISTUPD  OPENING FOR OUTPUT? @ZA25895 31460008
         BNZ   OIN33450                 YES,THEN NOT UPDATE    @ZA25895 31480008
         TM    DXDCBLST,PLISTUPD        OPENING FOR UPDATE?    @ZA25895 31500008
         BNO   OIN33800                 NO,IGNORE LABEL OVERRID@ZA25895 31520008
         B     OIN33500                 YES,LABEL OVERRIDE     @ZA25895 31540008
OIN33450 TM    DXDCBLST,PLISTIO         OPENING FOR INOUT      @ZA25895 31560008
         BNO   OIN33800                 BR IF NO                        31580008
         TM    DXDCBLST,PLISTOP1-PLISTIO ENSURE IT IS ONLY INOUT Y02134 31600008
         BNZ   OIN33800                 BR IF ANYTHING ELSE             31620008
OIN33500 EQU   *                                               @ZA25895 31640008
         NI    DXDCBLST,X'FF'-PLISTOP1+PLISTIN CHANGE TO INPUT   Y02134 31800002
         OI    JFCBMASK+K6,JFCOUTOP     INDIC OVERRIDE REQ       YM5943 31850002
         B     OIN33800                 PERFORM INPUT PROCESSING        32000021
*                                                                       32100021
OIN33600 NI    JFCBMASK+K6,X'FF'-JFCINOP-JFCOUTOP  IGNORE OVERRIDE      32200021
*                                       REQUEST BECAUSE OF              32300021
*                                       CONFLICTING INFORMATION         32400021
OIN33800 EQU   *                        DD DUMMY OR NULLFILE            32500002
*                                                                       32600021
*********************************************************************** 32700021
*                                                                       32800021
*        NEGATIVE INDICATOR FOR OPEN ACCESS METHOD EXECUTORS.           32900021
*        WILL BE TURNED OFF IF DIRECT ACCESS WITH RPS FEATURE.          33000021
         OI    JFCBMASK+K6,JFCMNRPS     TURN ON NO RPS INDICATOR BIT    33100021
*                                                                       33200021
         CLC   OIN3820K,JFCBDSNM        CHECK FOR DUMMY, NULL DATA SET  33300021
         BE    OIN34000                 BR IF YES                       33400021
*                                                                       33500021
         TM    TIOELINK,TIOEQNAM        IS THIS A TCAM DUMMY            33600021
         BNZ   OIN34000                 BRANCH IF NO             YM5397 33700002
         LTR   RUCB,RUCB                CHECK FOR NO UCB         YM5397 33720002
         BNZ   OIN34200                 BRANCH IF NOT A DUMMY    YM5397X33740002
                                        DATA SET (UCB PRESENT)   YM5397 33760002
*                                                                       33800021
OIN34000 EQU   *                        DD DUMMY OR DSN=NULLFILE        33900002
         OI    JFCBMASK+K4,JFCMNULL     SET NULL DATA SET SW ON         34000021
         MODESET EXTKEY=SUPR            KEY OF UCB               Y02082 34050002
         XC    TIOEFSRT(K3),TIOEFSRT    ZERO UCB ADDR FOR NULL DATA SET 34100021
         MODESET EXTKEY=DATAMGT         BACK TO DATA MGMT KEY    Y02082 34150002
         B     OIN37000                 BR TO GO TO MERGE MODULE        34200021
*                                                                       34300021
OIN34200 EQU   *                        PARTIAL RELSE INVALID FOR ISAM  34400002
         TM    JFCDSORG,JFCORGIS        IS THIS ISAM            SA53186 34460002
         BZ    OIN34300                 BRANCH IF NO            SA53186 34470002
         NI    JFCBIND1,X'FF'-JFCRLSE   YES, SET PARTIAL RLSE   SA53186 34480002
*                                       BITS TO ZERO            SA53186 34490002
OIN34300 EQU   *                        DA & TAPE PROCESSING    SA53186 34492002
*                                                                       34700021
         TM    UCBTBYT3,UCB3TAPE+UCB3DACC  TEST IF MAGNETIC TAPE OR     34800021
         BZ    OIN36600                 DIRECT ACCESS, BR IF NO  Y02134 34900002
*                                                                A44135 35000002
*        INITIALIZE NO. OF VOLUMES TO 1 IF ZERO                  Y02134 35050002
*                                                                Y02134 35100002
         CLI   JFCBNVOL,K0              CHECK FOR ZERO NO. VOL   Y02134 35150002
         BNE   OTA03200                 BR IF NO                 Y02134 35200002
         MVI   JFCBNVOL,K1              SET NO. VOL TO ONE       Y02134 35250002
*                                                                Y02134 35300002
OTA03200 EQU   *                        MERGE DSORG              Y02134 35350002
*                                                                       35724202
*****************************************************************A44135 35724902
*                                                                A44135 35725602
* MERGE DSORG FROM JFCB TO DCB PRIOR TO SELECTING VOLUME SERIAL  A44135 35726302
* NUMBER                                                         A44135 35727002
*                                                                A44135 35729002
*****************************************************************Y02134 35732502
*                                                                Y02134 35736002
         L     RC,DXDEBXAD              DEB EXTENSION ADDR       Y02134 35738002
         USING DEBXTN,RC                DEB EXTENSION USING      Y02134 35738402
         TM    DCBMACRF,DCBMEXCP        IS DCB EXCP              A44135 35739502
         BZ    OIN34620                 NO, BR, DSORG IS PRESENT A44135 35743002
         MVI   DEBXDSO1,DCBORGPS        SET DEFAULT TO PS        Y02134 35745402
         TM    DCBMACRF,DCBMFOUN        DOES DSORG FIELD EXIST   A44135 35746502
         BZ    OIN34660                 NO, BR, TREAT EXCP WITH  A44135 35750002
*                                       NO DSORG AS PS           A44135 35753502
OIN34620 EQU   *                        DSORG FIELD EXISTS       A44135 35757002
*                                                                YM3070 35757402
         MVC   DEBXDSO1(L'DCBDSORG),DCBDSORG UPDATE DEBX DSORG   YM3070 35757502
         TM    DCBDSORG,DCBORGPS        IS THIS A PS DATA SET    Y02134 35757802
         BO    OIN34660                 BRANCH IF PS             YM3070 35758202
         NC    DCBDSORG,DCBDSORG        SEE IF DSORG SPECIFIED   YM3070 35759002
         BNZ   OIN36600                 BRANCH IF SPECIFIED      YM3070 35759402
         TM    JFCDSORG+K1,ACBDORGA     TEST FOR VSAM            YM3070 35766202
         BO    OIN34660                 BRANCH IF VSAM           YM3070 35768202
         NC    JFCDSORG,JFCDSORG        CHECK FOR DSORG IN JFCB  YM3070 35770202
         BZ    OIN34660                 BRANCH IF NO DSORG       YM3070 35772202
*                                                                YM3070 35772602
         MVC   DCBDSORG,JFCDSORG        MERGE DSORG TO DCB       YM3070 35773002
         OI    JFCBMASK+K3,X01          DSORG MERGE MASK         YM3070 35773402
*                                                                YM3070 35773802
         TM    DCBDSORG,DCBDSGPS        TEST FOR PS              YM3070 35773902
         BO    OIN34660                 BRANCH IF SPECIFIED      YM3070 35774002
*                                                                YM3070 35774102
*****************************************************************Y02134 35774202
*                                                                Y02134 35774302
*        RECOPY DCB WITH PROPER SIZE                             YM3070 35774502
*                                                                Y02134 35774902
*****************************************************************Y02134 35776002
*                                                                YM3070 35778002
         L     RDCB,DXUDCBAD            SAVE USER DCB PTR        YM3070 35778102
         ICM   RDCB,B'1000',DXUKEY      SAVE USER KEY            YM3070 35778202
         MVC   DXUDCBAD,DXPDCBAD        SET USER=PROTECT         YM3070 35778402
         MVI   DXUKEY,DATAMGT           SET DM KEY               YM3070 35778802
         IECRES INIT,DCBCOPY=TOWKAR,STM=(2,14,WTGPREFX),         YM3070X35778902
               PREFIX=WTGPREFX                                   YM3070 35828902
*                                                                YM3070 35838902
         STCM  RDCB,B'1000',DXUKEY      RESTORE KEY              YM3070 35848902
         STCM  RDCB,B'0111',DXUDCBAD+K1 RESTORE USER DCB ADDRESS YM3070 35858902
         L     RDCB,DXPDCBAD            LOAD COPY DCB ADDRESS    YM3070 35868902
         MVC   DEBXDSO1(L'DCBDSORG),DCBDSORG UPDATE DEBX DSORG   YM3070 35874902
*                                                                YM3070 35876902
*        RESTORE DCB FROM ORIGINAL WITH PROPER LENGTH            YM3070 35877302
         IECRES INIT,DCBCOPY=TOWKAR,STM=(3,14,WTGPREFX),         YM3070X35877702
               PREFIX=WTGPREFX                                   YM3070 35878102
*                                                                YM3070 35878502
         MVC   DCBDSORG,DEBXDSO1        RESTORE PROPER DSORG     YM3070 35878702
*                                                                YM3070 35895502
         OI    JFCBMASK+K3,X01          SET DSORG MERGE MASK BIT A44135 36228902
         MVC   DEBXDSO1(L'DCBDSORG),DCBDSORG DSORG TO DEBX       Y02134 36278902
         B     OIN36600                 BYPASS PS PROCESS        YM3070 36288902
         DROP  RC                                                Y02134 36750002
*                                                                Y02134 36760002
OIN34660 EQU   *                        SEQ OF 1ST VOL TO MOUNT  Y02134 36800002
*                                                                Y02134 36862002
*****************************************************************Y02134 36864002
*                                                                Y02134 36866002
*   TEST FOR A VALID VOLUME SEQUENCE NUMBER. WHEN PROCESSING IS  Y02134 36868002
*   TO BEGIN WITH A SELECTED VOLUME OF A PHYSICAL SEQUENTIAL     Y02134 36868402
*   DATA SET, THIS NUMBER IS USED AS AN INDEX TO THE APPROPRIATE Y02134 36868802
*   VOLUME SERIAL NUMBER IN THE JFCB. IT MUST BE LESS THAN OR    Y02134 36869202
*   EQUAL TO THE NUMBER OF VOLUMES ALLOCATED TO THE DATA SET.    Y02134 36869602
*                                                                Y02134 36869702
*****************************************************************Y02134 36869802
*                                                                Y02134 36879702
         MVC   DXVOLSEQ,JFCBVLSQ        MOVE VOLUME SEQ TO WA    Y02134 36879802
OABD037  EQU   37                       VOL. SEQ. NO. IS TOO BIG Y02134 36881502
         LA    R0,OABD037               LOAD PROB. DET. CODE     Y02134 36883502
         CLC   JFCBNVOL,DXVOLSEQ+K1     NO. OF VOLS & VOL SEQ    Y02134 36884902
         BL    OIN37800                 BRANCH IF VOLSEQ GT VOLS Y02134 36886602
*                                                                Y02134 36890002
         CLC   DXVOLSEQ,ZEROS           TEST FOR VOL SEQ OF ZERO Y02134 36900002
         BH    OIN36600                 BRANCH NOT ZERO, USE IT  Y02134 36910002
*                                                                Y02134 36923202
         TM    DXDCBLST,PLISTM03        CHECK FOR RDBACK         Y02134 36926502
         BM    OIN35000                 BR IF YES                Y02134 36926602
*                                                                Y02134 36944902
         TM    DXDCBLST,PLISTM01        IS IT UPDAT OR INPUT     Y02134 36954902
         BZ    OIN36600                 BR IF YES, IGNORE MOD    Y02134 36964902
         TM    DXDCBLST,PLISTM06        IS IT INOUT              Y02134 36974902
         BM    OIN36600                 BR IF YES, IGNORE MOD    Y02134 36976902
*                                                                Y02134 36978902
         TM    JFCBIND2,JFCOLD          TEST FOR MOD             Y02134 36980902
         BNZ   OIN36600                 BRANCH IF NOT MOD        Y02134 36981302
*                                                                Y02134 36981402
OIN35000 EQU   *                        USE LAST VOLUME          Y02134 36981502
         MVC   DXVOLSEQ+K1(K1),JFCBNVOL USE NO. OF VOLS          Y02134 36981602
         TM    DXDCBLST,PLISTM03        CHECK FOR RDBACK       @ZA26878 36981708
         BM    OIN36610                 BRANCH IF RDBACK       @ZA26878 37031708
*                                                                Y02134 37081708
OIN36600 EQU   *                                                        50600008
*                                                                       50630008
         TM    JFCBIND2,JFCNEW          TEST FOR NEW           @ZA12906 50660008
         BNO   OIN36610                 BRANCH NOT NEW         @ZA12906 50690008
         MVC   DXVOLSEQ,ONE             SET VOLSEQ TO ONE      @ZA12906 50720008
         OI    JFCBMASK+K4,X'01'        VOLSEQ MERGE MASK      @ZA25251 50760008
*                                                                       50780008
OIN36610 EQU   *                 SAVE INITIAL DEVICE SELECTION @ZA12906 50810008
*                                                                       50900021
         LA    RUCB,0(,RUCB)            CLEAR HIGH ORDER BYTE           51000021
         ST    RUCB,DXDEBUCB            STORE UCB ADDR IN WORK DEB      51100021
*                                                                       51200021
         TM    UCBTBYT3,UCB3TAPE+UCB3DACC  TAPE OR DA            Y02134 51250002
         BNZ   OIN36780                 BRANCH IF EITHER         YM5792 51260002
         CLI   UCBTBYT3,UCB3UREC        UNIT RECORD DEVICE       Y02082 51262002
         BNE   OIN37000                 BRANCH IF NO             Y02082 51264002
         CLI   UCBTBYT4,K9              IS IT A 3211 PRINTER     Y02082 51266002
         BE    OIN36615                 BRANCH IF YES          @Z30HSRB 51268030
         CLI   UCBTBYT4,UCB3895         IS IT A 3895           @Z30HSRB 51268430
         BNE   OIN37000                 BRANCH IF NO             Y02082 51268830
*                                                                       51269230
*        MARK 3895 DEVICE READY                                @Z30HSRB 51269630
*                                                                       51270030
         MODESET EXTKEY=ZERO            KEY ZERO TO CHANGE UCB @ZM44722 51270430
         NI    UCBFLA,X'FF'-UCBNOTRD    ZERO NOT-READY BIT     @Z30HSRB 51270530
         MODESET EXTKEY=DATAMGT         RETURN TO KEY FIVE     @ZM44722 51270630
         B     OIN37000                 ON TO MERGE MODULES    @Z30HSRB 51270830
OIN36615 EQU   *                        3211 SUPPORT           @Z30HSRB 51271230
         L     RF,WTGPREFX              PREFIX ADDRESS           Y02082 51272002
         STM   RA,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS    Y02082 51274002
         MODESET EXTKEY=SUPR            UCB, SETLOCK KEY         Y02082 51274402
OIN36620 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02082*51276002
               RELATED=(LOCAL,IFG0193A(OIN36760)) GET LOCAL LOCK Y02082 51278002
         LTR   RD,RD                    SETLOCK ERROR            Y02082 51280002
         LM    RA,RET,IECREGSV-IECPREFX(RF) RESTORE SETLOCK REGS Y02082 51282002
         BNZ   OIN37900                 BRANCH IF SETLOCK ERROR  Y02082 51284002
         L     RC,UCBXTADR              PRINTER EXTENSION        Y02082 51286002
         USING UCBUCS,RC                                         Y02082 51288002
         SR    RF,RF                    ZERO RF FOR IC, LTR      Y02082 51290002
         IC    RF,UCBERADR              GET USE COUNT            Y02082 51292002
         LTR   RF,RF                    IS IT NOW ZERO           Y02082 51294002
         LA    RF,K1(,RF)               INCREMENT BY ONE         Y02082 51296002
         STC   RF,UCBERADR              STORE UPDATED COUNT      Y02082 51298002
         BNZ   OIN36740                 BRANCH IF COUNT WASN'T 0 Y02082 51300002
*                                                                YM3153 51303002
*        GET ERP WORKAREA WITH LOCK HELD                         YM3153 51304002
         IECRES GET,WLH,LV=WALNTH,KEY=K0,SP=K255,PREFIX=NO,      YM3153X51306002
               STM=(2,14,WTGPREFX)                               YM3153 51308002
         STCM  R1,B'0111',UCBERADR+K1   STORE WORKAREA ADDR      Y02082 51312002
*                                                                YM3153 51313002
OIN36740 EQU   *                        RELEASE LOCK             YM3153 51314002
*                                                                YM3153 51315002
         L     RF,WTGPREFX              PREFIX ADDRESS           Y02082 51316002
         MODESET EXTKEY=DATAMGT         D.M.KEY FOR SAVEAREA     Y02082 51316402
         STM   RA,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS    Y02082 51318002
         MODESET EXTKEY=SUPR            UCB, SETLOCK KEY         Y02082 51318402
OIN36760 SETLOCK RELEASE,TYPE=LOCAL,                             Y02082*51320002
               RELATED=(LOCAL,IFG0193A(OIN36620)) RELEASE LOCK   Y02082 51322002
         LTR   RD,RD                    SETLOCK ERROR TEST       Y02082 51324002
         LM    RA,RET,IECREGSV-IECPREFX(RF) RESTORE REGS         Y02082 51326002
         BNZ   OIN37900                 BRANCH IF SETLOCK ERROR  Y02082 51328002
         MODESET EXTKEY=DATAMGT         RETURN TO KEY 5          Y02082 51330002
         B     OIN37000                 BRANCH TO MERGE          Y02082 51332002
OIN36780 EQU   *                        SEQ VALIDITY CHECK       Y02082 51334002
         CLC   DXVOLSEQ,ZEROS           TEST FOR VOL SEQ OF ZERO Y02134 51360002
         BH    OIN36800                 BRANCH NOT ZERO, USE IT  Y02134 51410002
         MVC   DXVOLSEQ,ONE             SET VOL SEQ TO ONE       Y02134 51420002
*                                                                Y02134 51460002
OIN36800 EQU   *                        DEVICE DEPENDENT PROC    Y02134 51510002
*                                                                Y02134 51720002
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE            Y02134 51730002
         BO    OIN36810                 BRANCH IF TAPE           Y02134 51740002
*                                                                       51742008
         CLC   DXDSAB,DXDSABAD          OPENJ DYNAMIC ALLOC    @ZA02193 51744008
         BE    OIN36801                 BRANCH IF NO           @ZA02193 51746008
*                                                                       51748008
         L     RC,DXDEBXAD              LOAD DEB EXT ADR       @ZA02193 51748408
         MVC   DEBXOPNJ-DEBXTN(L'DXDSAB,RC),DXDSAB CHAIN OPENJ @ZA12942 51748808
*                                       ALLOCATION FOR CLOSE   @ZA02193 51749208
         MVC   DXDSAB,DXDSABAD          RESET DSAB ADR         @ZA02193 51749608
*                                                                       51749708
OIN36801 EQU   *                        CONTINUE DA PROCESS    @ZA02193 51749808
*                                                                Y02134 51750002
         NI    JFCBMASK+K6,X'FF'-JFCMNRPS  TURN OFF NO RPS BIT   Y02134 51752002
*                                                                YM5792 51752102
         L     RB,DXDSABAD              LOAD DSAB POINTER        YM5792 51752202
         SR    RF,RF                    ZERO RF FOR RPS INDIC   Z30TSRJ 51752303
*                                                                YM5792 51752403
OIN36803 EQU   *                        LOOP FOR NEXT DSAB       YM5792 51752503
*                                                                YM5792 51752603
         TM    UCBTBYT2,UCBRPS          DEVICE HAVE RPS FEATURE  YM5792 51753002
         BZ    OIN36806                 BRANCH IF NO RPS         YM5792 51753102
*                                                                YM5792 51753303
         TM    UCBJBNR,UCBVRDEV         VIO UCB                 Z30TSRJ 51753403
         BO    OIN36804                 BRANCH IF VIO           Z30TSRJ 51753503
         LR    RF,RUCB                  INDICATE REAL RPS FOUND Z30TSRJ 51753603
*                                                               Z30TSRJ 51753703
OIN36804 EQU   *                        CONTINUE SEARCH         Z30TSRJ 51753803
*                                                               Z30TSRJ 51753903
         L     RB,DSABFCHN-DSAB(RB)     LOAD NEXT DSAB PTR       YM5792 51754003
         LTR   RB,RB                    TEST FOR END OF CHAIN    YM5792 51754103
         BZ    OIN36809                 BRANCH, END OF CHAIN    Z30TSRJ 51754203
*                                                                YM5792 51754303
         L     RTIOT,DSABTIOT-DSAB(RB)  LOAD TIOT POINTER        YM5792 51754403
*                                                                YM5792 51754503
         CLC   TIOEDDNM,BLANKS          CHECK FOR CONCATENATION  YM5792 51754603
         BNE   OIN36809                 BRANCH IF NOT           Z30TSRJ 51754703
*                                                                YM5792 51754803
         L     RUCB,TIOEFSRT-K1         GET UCB ADDRESS          YM5792 51754903
         LTR   RUCB,RUCB                TEST FOR UCB ADDRESS     YM5792 51755003
         BZ    OIN36809                 BRANCH IF NOT VALID     Z30TSRJ 51755103
         TM    UCBTBYT3,UCB3DACC        MAKE SURE OF DA          YM5792 51755203
         BO    OIN36803                 BRANCH IF DA             YM5792 51755303
*                                                                YM5792 51755402
OIN36806 EQU   *                        SET NO RPS INDICATOR     YM5792 51755502
*                                                                YM5792 51755602
         OI    JFCBMASK+K6,JFCMNRPS     TURN ON NO RPS BIT       YM5792 51755702
*                                                                YM5792 51756002
OIN36808 EQU   *                        SET DA RETURN MOD        YM5792 51757502
*                                                                Y02134 51758402
         L     RTIOT,DXTIOTAD           RELOAD TIOT ADDR         YM5792 51758602
         L     RUCB,DXUCBADR            LOAD CURRENT UCB         YM5792 51758902
*                                                                YM5792 51759302
         XC    DXRETCOD,DXRETCOD        ZERO OUT RETURN CODE     Y02134 51759602
         MVC   DXRETMOD,ID3A5A          MOVE IN DA MERGE LOAD    Y02134 51760802
*                                                                Y02134 51762002
         B     OIN36840                 BRANCH TO MOUNT VOLUMES  Y02134 51763202
*                                                                Y02134 51764402
OIN36809 EQU   *                        CHECK IF REAL RPS FOUND Z30TSRJ 51764503
*                                                               Z30TSRJ 51764603
         LTR   RF,RF                    IS IT NOW ZERO          Z30TSRJ 51764703
         BZ    OIN36806                 BRANCH IF NO REAL RPS   Z30TSRJ 51764803
         B     OIN36808                 BRANCH IF REAL RPS      Z30TSRJ 51764903
*                                                               Z30TSRJ 51765003
OIN36810 EQU   *                        TAPE PROCESSING          Y02134 51765602
*                                                                Y02134 51766802
         CLC   JFCBFLSQ,ZEROS           TEST FOR FILE SEQ = ZERO Y02134 51768002
         BH    OIN36815                 BRANCH NOT ZERO, USE IT  Y02134 51769202
         MVC   JFCBFLSQ,ONE             SET FILE SEQ TO ONE      Y02134 51770402
*                                                                Y02134 51771602
OIN36815 EQU   *                        LBL TYP INDICATES STRING Y02134 51772802
*                                                                Y02134 51774002
         TM    JFCBLTYP,JFCNL+JFCBLP    TEST FOR NL OR BLP       Y02134 51775202
         BZ    OIN36820                 BRANCH IF NEITHER        Y02134 51776402
         XC    DXRETCOD,DXRETCOD        ZERO OUT RETURN CODE     Y02134 51777602
         MVC   DXRETMOD,ID3A5C          MOVE IN NL/BLP LOAD      Y02134 51778802
         B     OIN36840                 BRANCH TO MOUNT VOLUMES  Y02134 51780002
*                                                                Y02134 51781202
OIN36820 EQU   *                        NSL, SL, AL              Y02134 51782402
*                                                                Y02134 51783602
         TM    JFCBLTYP,JFCNSL          TEST FOR NSL             Y02134 51784802
         BZ    OIN36830                 BRANCH TO ASSUME AL/SL   Y02134 51786002
         TM    DXDCBLST,PLISTOIN        TEST FOR OUTPUT OR OUTIN Y02134 51787202
         BO    OIN36825                 BRANCH IF EITHER         Y02134 51788402
         MVI   DXRETCOD,K12             SET CODE INIT PROCESS    Y02134 51789602
         MVC   DXRETMOD,ID3A5D          MOVE IN NSL INPUT LOAD   Y02134 51790802
         B     OIN36840                 BRANCH TO MOUNT VOLUMES  Y02134 51792002
*                                                                Y02134 51793202
OIN36825 EQU   *                        NSL OUTPUT               Y02134 51794402
*                                                                Y02134 51795602
         XC    DXRETCOD,DXRETCOD        ZERO OUT RETURN CODE     Y02134 51796802
         MVC   DXRETMOD,OIN3960X        MOVE IN NSL OUTPUT LOAD  Y02134 51798002
         B     OIN36840                 BRANCH TO MOUNT VOLUMES  Y02134 51799202
*                                                                Y02134 51800402
OIN36830 EQU   *                        SL/AL PROCESSING STRING  Y02134 51801602
*                                                                Y02134 51802802
         XC    DXRETCOD,DXRETCOD        ZERO OUT RETURN CODE     Y02134 51804002
         MVC   DXRETMOD,ID3A5B          MOVE IN SL/AL LOAD       Y02134 51805202
*                                                                Y02134 51806402
OIN36840 EQU   *                        SELECT VOL/UNIT          Y02134 51807602
*                                                                Y02134 51808802
*****************************************************************Y02134 51810002
*                                                                Y02134 51820002
*        BRANCH TO VOLUME SELECT MODULE                          Y02134 51850002
*                                                                       51900002
*****************************************************************Y02134 51950002
*                                                                Y02134 52000002
         IECRES LOAD,MODID=OIN3940X,BRCODE=0,BRANCH=QUEUED       Y02134 52050002
*                                                                       52400021
OIN37000 EQU   *                        UNIT RECORD, NULLFILE, ETC.     52500021
*                                                                       52550002
         IECRES LOAD,MODID=OIN3960X,BRCODE=0, XCTL TO FIRST      Y02080*52610102
               BRANCH=QUEUED            COMMON MERGE MODULE      Y02080 52622002
*                                                                       52624002
OIN37500 EQU   *                        VSAM STRING              XM1037 52630002
*                                                                       52640002
         OI    DXATGENS,DXATVSMG        VSAM STRING TO GET CNTRL Y02144 52676602
         IECRES LOAD,MODID=OIN3980X,BRCODE=0, XCTL TO VSAM       Y02080*52683402
               BRANCH=QUEUED            STRING                   Y02080 52690002
*                                                                       52690402
OIN37600 EQU   *                        VTAM STRING              Y02004 52692002
*                                                                       52692402
         OI    DXATGENS,DXATVTMG        VTAM STRING TO GET CNTRL Y02144 52692802
         IECRES LOAD,MODID=OIN4000X,BRANCH=QUEUED                Y02004 52694002
*                                                                Y02134 52694402
OIN37800 EQU   *                        BRANCH TO PROBLEM DET    Y02134 52694802
*                                                                Y02134 52695202
         DMABCOND (0),OIN3920X          BRANCH TO PROBLEM DET    Y02134 52698002
*                                                                       52700021
OIN37900 EQU   *                        ERROR IN SETLOCK         Y02082 52702002
         DMABCOND PCK,SETLOCK           SETLOCK ERROR ANALYSIS   Y02082 52704002
*                                       ROUTINE                  Y02082 52706002
         EJECT                                                          52708002
*********************************************************************** 52800021
*                                                                       52900021
*        CONSTANTS                                                      53000021
*                                                                       53100021
*********************************************************************** 53110002
*                                                                       53300021
OIN3820K DC    C'NULLFILE '             DSNAME FOR NULL DATA SET        53800021
BLANKS   DC    CL8' '                   DDNAME FOR CONCATENATION YM5792 53850002
*                                                                       53900021
         SPACE 1                                                        53908002
ZEROS    DC    X'0000'                  CONSTANT 0               Y02134 54000002
ONE      DC    X'0001'                  CONSTANT ONE             Y02134 54050002
OIN3870K DC    C'IFG0193A'              NAME FOR RESTORE         Y02080 54622402
*                                                                       54624002
         XCTLTABL  ID=(OIN3920X,0P,OIN3930X,3A,OIN3940X,4A,      Y02134X54630002
               OIN3960X,6J,OIN3980X,2A,OIN3990X,8N,OIN3990Y,2I,  Y02134X54640002
               LOAD6V3A,6V,OIN4000X,2F,OIN4010K,IDA0192P,        Y02134X54645002
               ID3A5A,5A,ID3A5B,5B,ID3A5C,5C,ID3A5D,5D),         Y02134X54647002
               SVC=019,BRT=YES,LENGTH=                           Y02080 54650002
         IECDSECS EXPAND=YES            EXPAND DESIRED DSECTS HERE      54800008
UCB3895  EQU   X'19'                    3895 DEVICE TYPE CODE- @Z30HSRB*54900030
               DELETE IT WHEN THE IEFUCBOB MACRO CONTAINS IT   @Z30HSRB 54950030
DEBXTN   DSECT                          REESTABLISH DEBX DSECT @ZM43353 55000008
LTHODEBX EQU   *-DEBXTN                 LENGTH OF DEBX         @ZM43353 58000008
IFG0193A CSECT                          REESTABLISH MODULE     @ZM43353 61000008
         END                                                            64000008
