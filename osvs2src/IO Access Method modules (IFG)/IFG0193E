         TITLE 'IFG0193E                      CREATE STANDARD LABEL ROUT00200002
               TINE'                                             Y02134 00210002
IFG0193E CSECT                                                          00800021
         ENTRY IFG0553E                 ALIAS ENTRY POINT        Y02134 00850002
IFG0553E EQU   IFG0193E                 ALIAS ENTRY POINT        Y02134 00900002
*                                                                     * 00902032
*********************************************************************** 00904032
*                                                                     * 00906032
*             VS2 RELEASE 030 DELETIONS/CHANGES                       * 00908032
*0000390999,393299                                             @ZA08273 00988032
*0000                                                          @ZA10546 01068032
*             VS2 SU32 DELETEIONS                                     * 01108032
*                                                              @G32DSMI 01148032
*                                                                     * 01230003
* MODULE NAME = IFG0193E (OS/VS2)                                     * 01250002
*                                                                     * 01300002
* DESCRIPTIVE NAME = CREATE STANDARD LABEL ROUTINE                    * 01350002
*                                                                     * 01360002
* COPYRIGHT = NONE                                                    * 01370002
*                                                                     * 01380002
* STATUS = RELEASE 2, LEVEL 0                                         * 01390002
*                                                                     * 01392002
* FUNCTION =                                                          * 01394002
*        1A. IF A SPECIFIC VOLUME REQUEST HAS BEEN MADE AND THE       * 01394132
*        SYSTEM HAS RACF TAPE VOLUME PROTECTION, THEN ISSUE THE       * 01394232
*        RACHECK MACRO ON THE SPECIFICALLY PROVIDED SL/AL VOLUME      * 01394332
*        SERIAL NUMBER (BEFORE ISSUING MESSAGE IEC704A) TO DETERMINE  * 01394432
*        IF THE CALLER IS AUTHORIZED TO CREATE THE SL/AL VOLUME.      * 01394532
*                                                                     * 01394632
*        1B. ISSUE MESSAGE IEC704A TO GET SERIAL NUMBER AND OWNER'S   * 01394732
*        NAME FROM THE OPERATOR.                                      * 01394832
*                                                                     * 01394932
*        1C. IF A NON-SPECIFIC VOLUME REQUEST HAS BEEN MADE AND       * 01395032
*        THE SYSTEM HAS RACF TAPE VOLUME PROTECTION, THEN ISSUE       * 01395132
*        THE RACHECK MACRO ON THE OPERATOR-PROVIDED SL/AL VOLUME      * 01395232
*        SERIAL NUMBER (AFTER ISSUING MESSAGE IEC704A) TO DETERMINE   * 01395332
*        IF THE CALLER IS AUTHORIZED TO CREATE THE SL/AL VOLUME.      * 01395432
*                                                                     * 01395632
*        2. CONSTRUCT AND WRITE A STANDARD OR ANSII LABEL AND A TAPE  * 01395732
*        MARK.  ANSII LABELS ARE TRANSLATED BEFORE BEING WRITTEN.     * 01395832
*                                                                     * 01395932
*        3. EXIT FOR A REMOUNT IF AN I/O ERROR OCCURS RATHER THAN     * 01396032
*        ISSUING A 613 ABEND.                                         * 01396132
*                                                                     * 01396232
* NOTES = SEE BELOW                                                   * 01398002
*                                                                     * 01398402
*    DEPENDENCIES =                                                   * 01398802
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 01399202
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 01399602
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 01399702
*                                                                     * 01399802
*    RESTRICTIONS = NONE                                              * 01399902
*                                                                     * 01449902
*    REGISTER CONVENTIONS =                                           * 01459902
*            R2 POINTS TO DCB                                         * 01469902
*            R4 POINTS TO OPEN WORK AREA                              * 01479902
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 01489902
*            R6 POINTS TO THE WTG TABLE                               * 01491902
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 01493902
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 01495902
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 01497902
*            R10 POINTS TO THE UCB                                    * 01498302
*                                                                     * 01498702
*    PATCH LABEL = SEE NEXT TO LAST LABEL BEFORE ORG STATEMENT AT END * 01499102
*                  OF LISTING.                                        * 01499502
*                                                                     * 01499602
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 01499702
*                                                                     * 01499802
*    PROCESSOR = ASSEMBLER XF                                         * 01533202
*                                                                     * 01543202
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 01553202
*                  ORG STATEMENT AT END OF LISTING                    * 01563202
*                                                                     * 01565202
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 01565602
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 01566002
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 01566402
*                                                                     * 01566502
* ENTRY POINT = IFG0193E FROM OPEN                                    * 01577602
*               IFG0553E FROM EOV                                     * 01579602
*                                                                     * 01587602
*    PURPOSE = TO CREATE A STANDARD LABELED TAPE.                     * 01588002
*                                                                     * 01588402
*    LINKAGE = IECRES LOAD,BRANCH=QUEUED,MODID=ID3E,BRCODE=VALUE      * 01588802
*                                                                     * 01592502
* INPUT = AS FOLLOWS -                                                * 01594602
*                                                                     * 01594702
*        RDCB (REG 2) = CONTENTS OF CURRENT PARMLIST ENTRY            * 01594802
*                       CONTAINING DCB POINTER                        * 01600502
*        RCORE (REG 4) = OPEN/EOV WORK AREA POINTER                   * 01602502
*        REG 5 = POINTER TO RESIDENT ROUTINE                          * 01604902
*        RWTG (REG 6) = POINTER TO OPEN/EOV WTG TABLE                 * 01605302
*        RPARC (REG 7) = POINTER TO CURRENT ENTRY IN PARMLIST         * 01605702
*        RWTGC (REG 8) = POINTER TO CURRENT WTG ENTRY                 * 01606102
*        RTIOT (REG 9) = POINTER TO CURRENT TIOT ENTRY                * 01606202
*        RUCB (REG 10) = POINTER TO FIRST UCB                         * 01611202
*        RET (REG 14) = VALUE 0 = INITIAL ENTRY, 4 = RETURN FROM WTOR * 01614002
*                                                                     * 01616202
* OUTPUT = STANDARD LABEL ON TAPE OR TAPE REJECTED                    * 01621202
*                                                                     * 01626202
* EXIT-NORMAL = IFG0194J R14 = 4 REJECT VOLUME MESSAGE                * 01631202
*                            = 36 WTOR MSG IEC704A L DDD              * 01636202
*               IFG0194F R14 = 16 TAPE MOUNT/VERIFY ROUTINE           * 01641202
*                                                                     * 01646202
* EXIT-ERROR = IFG0194A R14 = 16 DISMOUNT RACF-PROTECTED VOLUME       * 01651232
*                                                                     * 01656202
* EXTERNAL REFERENCES = SEE BELOW                                     * 01666202
*                                                                     * 01676202
*    ROUTINES = IFG0194A,IFG0194F,IFG0194J.                           * 01686232
*                                                                     * 01688202
*    DATA AREAS = MAIN WORKAREA, WTG TABLE.                           * 01690202
*                                                                     * 01692202
*    CONTROL BLOCK = CVT,TCB,TIOT,DCB,UCB.                            * 01694202
*                                                                     * 01694602
* TABLES = SEE WTG TABLE AND XCTLTABL.                                * 01695002
*                                                                     * 01695402
* MACROS = IECRES,XLATE,EXCP,MODESET,XCTLTABL,IECDSECS,IECEQU,RACHECK.* 01695832
*                                                                     * 01695902
* CHANGE ACTIVITY = SEE DELETIONS/CHANGES SECTION AFTER CSECT CARD.   * 01696032
*                                                                     * 01696102
*********************************************************************** 01712802
         EJECT                                                          01722802
         USING FORCORE,RCORE            WORK AREA                       26200021
         USING WTG,RWTG                 WHERE-TO-GO              Y02080 26250002
         USING TIOENTRY,RTIOT           TIOT ENTRY                      26400021
         USING USERPRML,RPARC           CURRENT ENTRY          @G32DSMI 26500032
         USING IHADCB,RDCB              DCB                             26600021
         USING UCBOB,RUCB               UCB                             26800021
         BALR  RBASE,K0                 SET BASE REGISTER               27000002
         USING *,RBASE                                                  27200021
*                                                                Y02134 27210002
         B     CSL00000(RET)            BRANCH TO SPECIFD OFFSET Y02134 27220002
*                                                                Y02134 27240002
CSL00000 EQU   *                        BRANCH TABLE             Y02080 27242002
*                                                                Y02134 27244002
         B     CSL00500                 GO TO INITIAL ENTRY    @G32DSMI 27246032
         B     CSL02000                 RETURN FROM WTOR         Y02134 27253032
         EJECT                                                          27260032
*                                                                Y02134 27267032
***************************************************************@G32DSMI 27274032
*                                                              @G32DSMI 27281032
*        CHECK RACF AUTHORIZATION FOR SPECIFICALLY REQUESTED   @G32DSMI 27288032
*        VOLUME SERIAL BEFORE ISSUING MESSAGE IEC704A.         @G32DSMI 27295032
*                                                              @G32DSMI 27302032
***************************************************************@G32DSMI 27309032
*                                                              @G32DSMI 27316032
CSL00500 EQU   *                        CHK RACF AUTHORIZATION @G32DSMI 27323032
*                                                              @G32DSMI 27330032
         CLC   DXVOLSR2,SCRTCH          CHK IF NONSPECIFIC REQ @G32DSMI 27337032
         BE    CSL01000                 BRANCH IF NONSPECIFIC  @G32DSMI 27344032
         LA    R0,DXVOLSR2              PT TO SPECIFIC VOLSER  @G32DSMI 27351032
         BAL   RET,CSL09500             GO CHK FOR RACF AUTH   @G32DSMI 27358032
*                                                              @G32DSMI 27365032
         LTR   RF,RF                    CHK FOR ERROR          @G32DSMI 27372032
         BNZ   CSL10000                 ABEND - INT CODE IN R0 @G32DSMI 27379032
         EJECT                                                 @G32DSMI 27386032
*                                                                Y02134 27399032
*****************************************************************Y02134 27400002
*                                                                       27600021
*  GET VOLUME LABEL INFORMATION                                         27800021
*                                                                       28000021
*  SET UP TO WRITE TO OPERATOR THE FOLLOWING MESSAGE                    28200021
*                                                                       28400021
*              IEC704A L DDD                                            28600021
*                                                                       28800021
*  WHERE L INDICATES THAT LABEL INFORMATION IS REQUIRED FOR THE         29000021
*  OUTPUT TAPE VOLUME MOUNTED ON DEVICE DDD.  OPERATOR RESPONSE-        29200021
*                                                                       29400021
*              REPLY XX, 'SER,OWNER'                                    29600021
*                                                                       29800021
*  WHERE SER IS THE 6-DIGIT VOLUME SERIAL NUMBER AND OWNER IS A         30000021
*  10 CHARACTER FIELD FOR OWNER'S NAME OR SIMILAR IDENTIFICATION.       30200021
*                                                                Y02134 30250002
*****************************************************************Y02134 30300002
*                                                                       30400021
CSL01000 EQU   *                        SET UP TO ISSUE MESSAGE  Y02134 30600002
*                                                                Y02134 30800002
         MVC   DXRETMOD,ID3E3E          RETURN ID TO SAVE AREA   Y02134 30850002
         MVI   DXRETCOD,K4              SET RETURN INDICATOR     Y02134 30900002
*                                                                Y02134 30950002
         MVI   DXLBL,BLANK              SET 1ST CHAR BLANK       Y02134 30960002
         MVC   DXLBL+K1(L'DXLBL-K1),DXLBL PROPAGATE BLANKS       Y02134 30962002
         LA    R1,VOLOWNER              POINT TO REPLY AREA      Y02134 30970002
*                                                                Y02134 31069902
         LA    R0,K17                   LOAD SL LENGTH OF 17     Y02134 31542602
         TM    JFCBLTYP,JFCBAL          ANSI LABEL SPECIFIED            32000021
         BZ    CSL01100                 NO, BRANCH               Y02134 32200002
         LA    R0,K21                   LOAD ANSI LENGTH OF 21   Y02134 32400002
*                                                                Y02134 32450002
CSL01100 EQU   *                        SET REPLY LENGTH         Y02134 32600002
*                                                                Y02134 32610002
         SLL   R0,K24                   MOVE LENGTH TO HI BYTE   Y02134 32700002
         OR    R1,R0                    SET UP WTOR PARM         Y02134 32750002
*                                                                Y02134 32760002
         IECRES LOAD,MODID=ID3E4J,BRCODE=K36,BRANCH=QUEUED       Y02134 32770002
         EJECT                                                          32772002
*                                                                Y02134 32780002
*****************************************************************Y02134 32790002
*                                                                Y02134 32792002
*        RETURN HERE WITH OPERATOR REPLY                         Y02134 32794002
*                                                                Y02134 32796002
*****************************************************************Y02134 32798002
*                                                                Y02134 32798402
CSL02000 EQU   *                        WAIT FOR OPERATOR REPLY  Y02134 32798802
*                                                                Y02134 32799202
         IECRES WAIT                    WAIT FOR OPERATOR REPLY  Y02134 32799602
*                                                                Y02134 32799702
         OC    VOLSERNO(K7),VOLOWNER    RETRIEVE 1ST SEVEN CHARS Y02134 36600002
         CLC   CHRM9T,VOLSERNO          IF OPER WANTS DISMOUNT          36800002
         BE    CSL08000                 BRANCH TO REJECT VOLUME  Y02134 37000002
*                                                                Y02134 37200002
         LA    RD,K7                    LOOK THRU 7 CHRS FOR COMMA      37400021
         LA    R1,VOLSERNO              POINT IN FRONT OF VOLSER Y02134 37600002
*                                                                Y02134 37800002
CSL03000 EQU   *                        LOOP TO CHECK REPLY      Y02134 38000002
*                                                                Y02134 38200002
         CLI   K0(R1),COMMA             IS THIS A COMMA          Y02134 38600002
         BE    CSL03200                 BRANCH IF COMMA          Y02134 38800002
*                                                                Y02134 38850002
         CLI   K0(R1),BLANK             IS THIS A BLANK          Y02134 38900002
         BE    CSL03200                 BRANCH IF BLANK          Y02134 38950002
*                                                                Y02134 38960002
         LA    R1,K1(R1)                INCREMENT POINTER        Y02134 38962002
         BCT   RD,CSL03000              LOOP TO CHECK NEXT CHAR  Y02134 38970002
         B     CSL01000                 INVALID REPLY            Y02134 38980002
*                                                                Y02134 38990002
CSL03200 EQU   *                        CHECK FOR INVALID REPLY  Y02134 38992002
*                                                                Y02134 38994002
         LA    R0,K7                    CHECK LENGTH             Y02134 38996002
         CR    RD,R0                    FIRST CHAR ',' OR BLANK  Y02134 38998002
         BE    CSL01000                 BRANCH INVALID REPLY     Y02134 38998402
*                                                                Y02134 38998802
         MVI   K0(R1),BLANK             SET COMMA TO BLANK       Y02134 38999202
         MVC   K1(K6,R1),K0(R1)         PROPAGATE BLANKS         Y02134 38999602
*                                                                Y02134 38999702
         MVC   DXVOLSR1,VOLSERNO        SERIAL TO REJECT SLOT    Y02134 38999802
*                                                                YM8218 39016502
         CLC   DXVOLSR2,SCRTCH          CHECK FOR NON-SPEC REQ   YM8218 39026502
         BE    CSL03300                 BRANCH IF NON-SPEC       YM8218 39028502
*                                                                YM8218 39030502
         CLC   DXVOLSR2,DXVOLSR1        CHECK IF CORRECT REPLY   YM8218 39030902
         BE    CSL03350                 BRANCH IF CORRECT      @G32DSMI 39031332
*                                                                YM8218 39031702
         CLC   DXVOLSR1,REPLYU          CHECK FOR REPLY U        YM8218 39032502
         BNE   CSL01000                 BRANCH IF BAD REPLY      YM8218 39032902
*                                                                YM8218 39033002
         MVC   DXVOLSR1,DXVOLSR2        MAKE VOL SER SAME AS REQ YM8218 39033102
         MVC   VOLSERNO,DXVOLSR2        MOVE VOL SER TO LABEL  @ZA10546 39034032
         B     CSL03350                 GO FILL IN OWNER INFO  @G32DSMI 39034732
*                                                                YM8218 39035432
CSL03300 EQU   *                        CHK RACF AUTHORIZATION @G32DSMI 39036132
*                                                                Y02134 39036832
         LA    R0,DXVOLSR1              PT TO OPERATOR REPLY   @G32DSMI 39037532
         BAL   RET,CSL09500             GO CHK RACF AUTH FOR   @G32DSMI*39038232
                                        OPERATOR-PROVIDED      @G32DSMI*39038932
                                        VOLSER (NON-SPEC REQ)  @G32DSMI 39039632
*                                                              @G32DSMI 39040332
         LTR   RF,RF                    CHK FOR ERROR          @G32DSMI 39041032
         BNZ   CSL01000                 BR IF RACF AUTH ERROR  @G32DSMI*39041732
                                        TO REISSUE MSG IEC704A @G32DSMI 39042432
*                                                                YM8218 39043132
CSL03350 EQU   *                        FILL IN OWNER INFO     @G32DSMI 39043832
*                                                              @G32DSMI 39044532
***************************************************************@G32DSMI 39045232
*                                                              @G32DSMI 39045932
*        FILL IN OWNER INFORMATION                             @G32DSMI 39046632
*                                                              @G32DSMI 39047332
***************************************************************@G32DSMI 39048032
*                                                              @G32DSMI 39048732
         TM    JFCBLTYP,JFCBAL          ANSI LABELS SPECIFIED    Y02134 39049902
         BO    CSL03400                 BRANCH IF SPECIFIED      Y02134 39059902
*                                                                Y02134 39079902
         MVC   VOLOWNER,VOLOWNER-VOLSERNO+K1(R1) OWNER INFO    @ZA08273 39099903
         MVI   VOLOWNER+K10,BLANK       SET DELIMITER            Y02134 39149902
         MVC   VOLOWNER+K10+K1(K21-K10-K1),VOLOWNER+K10 PROPAGAT Y02134 39199902
         B     CSL03500                 BRANCH AROUND AL         Y02134 39249902
*                                                                Y02134 39259902
CSL03400 EQU   *                        AL OWNER INFORMATION     Y02134 39269902
*                                                                Y02134 39279902
         MVC   AVOLOWNR,VOLOWNER-VOLSERNO+K1(R1) OWNER INFO    @ZA08273 39329903
         MVI   AVOLOWNR+K14,BLANK       SET DELIMITER            Y02134 39379902
         MVC   AVOLOWNR+K14+K1(K21-K14-K1),AVOLOWNR+K14 PROPAGAT Y02134 39429902
         EJECT                                                          39439902
*                                                                Y02134 39479902
CSL03500 EQU   *                        COMPLETE VOL1 LABEL      Y02134 41400002
*                                                                Y02134 41600002
*****************************************************************Y02134 41610002
*                                                                Y02134 41620002
*        FINISH VOL1 LABEL                                       Y02134 41630002
*                                                                Y02134 41650002
*****************************************************************Y02134 41700002
*                                                                Y02134 41750002
         MVC   VOLLABI(L'AVOL1T),AVOL1T   PUT IN LABEL IDENTIFIER       48600021
         MVI   VOLSEC,CHAR0             SECURITY                        48800021
*                                                                Y02134 49250002
         TM    JFCBLTYP,JFCBAL          ANSI LABEL SPECIFIED            49400021
         BZ    CSL04000                 NO, GO WRITE LABEL       Y02134 49600002
*                                                                Y02134 49700002
*****************************************************************Y02134 49750002
*                                                                       49800021
*   MAKE CHANGES REQUIRED TO CREATE AN ANSI LABEL                       50000021
*                                                                       50200021
*****************************************************************Y02134 50250002
*                                                                Y02134 50300002
         MVI   VOLSEC,BLANK             ACCESSABILITY BYTE TO BLANK     50400021
         MVI   LABSTAND,CHAR1           SET LABEL STANDARD              50600021
*                                                                       50800021
*****************************************************************Y02134 50850002
*                                                                Y02134 50900002
*              TRANSLATE LABEL DATA TO ASCII CODE BEFORE WRITING        51000021
*                                                                       51200021
*****************************************************************Y02134 51250002
*                                                                Y02134 51300002
         XLATE DXLBL,K80,TO=A           TRANSLATE LABEL DATA            51400021
*                                                                Y02134 51450002
         EJECT                                                          51500002
*                                                                Y02134 51550002
CSL04000 EQU   *                        PREPARE TO WRITE LABEL   Y02134 51600002
*                                                                Y02134 51610002
*****************************************************************Y02134 51620002
*                                                                Y02134 51630002
*        REWIND TO LOAD POINT                                    Y02134 51632002
*                                                                Y02134 51640002
*****************************************************************Y02134 51642002
*                                                                Y02134 51644002
         MVC   DXCCW1,ACCWT             GET BASIC CCW FOR REWIND        51650002
         EXCP  DXIOB                                             Y02134 51660002
*                                                                Y02134 51670002
         IECRES WAIT                                             Y02134 51680002
*                                                                Y02134 51690002
         TM    DXECB,ECBNOERR           TEST FOR I/O ERROR       Y02134 51692002
         BNO   CSL08000                 BRANCH IF I/O ERROR      Y02134 51694002
*                                                                Y02134 51696002
*****************************************************************Y02134 51698002
*                                                                Y02134 51698402
*        WRITE OUT THE LABEL                                     T02134 51698802
*                                                                Y02134 51699202
*****************************************************************Y02134 51699602
*                                                                Y02134 51699702
         ST    RCORE,DXCCW1             ADDR OF LABEL AREA       Y02134 64252002
         MVI   DXCCW1,CCWWRTAP          1ST CCW IS WRITE VOL1    Y02134 64260002
*                                                                Y02134 64270002
         EXCP  DXIOB                                             Y02134 64300002
*                                                                Y02134 64350002
         IECRES WAIT                                             Y02134 64360002
*                                                                Y02134 64370002
         TM    DXECB,ECBNOERR           TEST FOR I/O ERROR       Y02134 64380002
         BNO   CSL08000                 BRANCH IF I/O ERROR      Y02134 64390002
*                                                                Y02134 64392002
         EJECT                                                          64442002
*                                                                       64600021
*****************************************************************Y02134 64650002
*                                                                Y02134 64700002
*        WRITE 1 TAPE MARK AT END OF LABEL                       Y02134 64750002
*                                                                Y02134 64800002
*****************************************************************Y02134 64850002
*                                                                Y02134 64900002
CSL07000 EQU   *                        WRITE TAPE MARK          Y02134 64950002
*                                                                Y02134 65000002
         MVC   DXCCW1,ACCWT             MOVE IN REWIND CCW       Y02134 65046002
         MVC   DXCCW2,ACCWT             WILL NEED 2 CCWS         Y02134 65048002
         MVI   DXCCW1,CCWWTM            1ST CCW IS WTM           Y02080 65048402
         MVI   DXCCW1+K4,CCWCMDCH       CONNECT TO NEXT CCW      Y02134 65048802
         MVI   DXCCW2,CCWNOP            GET NOP CODE             Y02134 65049202
*                                                                Y02134 65049602
         EXCP  DXIOB                                             Y02134 65049702
*                                                                Y02134 65049802
         IECRES WAIT                                             Y02134 65049902
*                                                                Y02134 65066602
         TM    DXECB,ECBNOERR           TEST FOR I/O ERROR       Y02134 65076602
         BNO   CSL08000                 BRANCH IF I/O ERROR      Y02134 65078602
*                                                                Y02134 65080602
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 65082602
*                                                                Y02134 65083002
         NI    UCBSTAT,ALLBITS-UCBDADI  TURN OFF SL INDICATOR    Y02134 65083102
         NI    UCBSTAB,ALLBITS-UCBBSTR  TURN OFF AL INDICATOR    Y02134 65083202
         NI    UCBTFL1,ALLBITS-UCBNSLTP TURN OFF NSL INDICATOR   Y02134 65088802
         NI    UCBTFL1,ALLBITS-UCBNLTP  TURN OFF NL INDICATOR    Y02134 65090802
*                                                                Y02134 65092802
         TM    JFCBLTYP,JFCBAL          TEST FOR AL SPECIFIED    Y02134 65094302
         BO    CSL07100                 BRANCH IF AL SPECIFIED   Y02134 65096202
*                                                                Y02134 65098202
         OI    UCBSTAT,UCBDADI          SET SL INDICATOR         Y02134 65098602
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 65098702
         B     CSL09000                 RETURN TO VERIFY         Y02134 65099002
*                                                                Y02134 65099402
CSL07100 EQU   *                        INDICATE ASCII MOUNTED   Y02134 65099802
*                                                                Y02134 65099902
         OI    UCBSTAB,UCBBSTR          SET AL INDICATOR         Y02134 65104402
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 65104802
         B     CSL09000                 RETURN TO VERIFY         Y02134 65106402
*                                                                Y02134 65108402
         EJECT                                                          65108802
*                                                                Y02134 65122002
*****************************************************************Y02134 65122102
*                                                                Y02134 65126702
*        REJECT VOLUME CURRENTLY MOUNTED                         Y02134 65128702
*                                                                Y02134 65130702
*****************************************************************Y02134 65131102
*                                                                Y02134 65131202
CSL08000 EQU   *                        GO TO 4J                 Y02134 65131302
*                                                                Y02134 65131402
         NI    DCBIFLGS,X'FF'-DCBIFPIO  TURN OFF ERROR FLAGS     Y02134 65136002
         NI    JFCBMASK+K5,LBWTRI9T     TURN OFF LBL ERR INDICATORS     65138002
*                                                                Y02134 65140002
         MVC   DXRETMOD,ID3E4F          SET UP RETURN TO 4F      Y02134 65140402
         MVI   DXRETCOD,K4              4F MOUNT/VERIFY OFFSET   Y02134 65140502
*                                                                Y02134 65140602
         IECRES LOAD,MODID=ID3E4J,BRCODE=K4,BRANCH=QUEUED        Y02134 65140702
*                                                                Y02134 65227902
*****************************************************************Y02134 65228302
*                                                                Y02134 65228702
*        RETURN TO VERIFY VOLUME                                 Y02134 65229102
*                                                                Y02134 65229202
*****************************************************************Y02134 65229302
*                                                                Y02134 65229402
CSL09000 EQU   *                        CHECK FOR DISP=MOD       YM8218 65232802
*                                                                YM8218 65233202
         CLC   DXVOLSEQ,ONE9T           CHECK FOR FIRST VOLUME   YM8218 65233602
         BNE   CSL09050                 BRANCH, BYPASS NEW-MOD   YM8218 65234002
         TM    JFCBIND2,JFCOLD          DISP=MOD                 YM8218 65234402
         BO    CSL09050                 BR IF NOT- CONTINUE      YM8218 65234502
*                                                                YM8218 65234602
         OI    JFCBIND2,JFCNEW          CHANGE 'MOD' TO 'NEW'    YM8218 65234702
         OI    JFCBFLG2,JFCMODNW        INDICATE THAT 'MOD' WAS  YM8218 65240102
*                                       CHANGED TO 'NEW'         YM8218 65242102
CSL09050 EQU   *                        CONTINUE                 YM8218 65244102
*                                                                Y02134 65246002
         NI    DCBIFLGS,X'FF'-DCBIFPIO  TURN OFF ERROR FLAGS     Y02134 65251402
         NI    JFCBMASK+K5,LBWTRI9T     TURN OFF LBL ERR INDICATORS     65256802
*                                                                Y02134 65262202
         IECRES LOAD,MODID=ID3E4F,BRCODE=K16,BRANCH=QUEUED       Y02134 65267602
         EJECT                                                          65273002
*                                                              @G32DSMI 65274032
***************************************************************@G32DSMI 65275032
*                                                              @G32DSMI 65276032
*        CHECK FOR RACF AUTHORIZATION TO CREATE VOLUME SERIAL  @G32DSMI 65277032
*                                                              @G32DSMI 65278032
***************************************************************@G32DSMI 65279032
*                                                              @G32DSMI 65280032
CSL09500 EQU   *                        CHK RACF AUTHORIZATION @G32DSMI 65281032
*                                                              @G32DSMI 65282032
         L     RB,DXJSCBAD              LOAD JSCB ADDRESS      @G32DSMI 65283032
         USING IEZJSCB,RB               JSCB ADDRESSABILITY    @G32DSMI 65284032
         TM    JSCBSWT1,JSCBPASS        TEST IF RAC CHECKING   @G32DSMIX65285032
                                        SHOULD BE BYPASSED     @G32DSMI 65286032
         BO    CSL09900                 BRANCH IF BYPASS SET   @G32DSMI 65287032
         L     RB,CVTPTR                LOAD CVT ADDRESS       @G32DSMI 65288032
         USING CVT,RB                   CVT ADDRESSABILITY     @G32DSMI 65289032
         L     RB,CVTRAC                LOAD RAC CVT ADDRESS   @G32DSMI 65290032
         LTR   RB,RB                    CHECK IF RACF ACTIVE   @G32DSMI 65291032
         BZ    CSL09900                 RACF NOT ACTIVE        @G32DSMI 65292032
         USING RCVT,RB                                         @G32DSMI 65293032
         TM    RCVTSTA1,RCVTTAPE        TEST FOR TAPE VOLUME   @G32DSMIX65294032
                                        PROTECTION OPTION      @G32DSMI 65295032
         BNO   CSL09900                 BRANCH IF NOT          @G32DSMI 65296032
         DROP  RB                                              @G32DSMI 65297032
         MVC   DXCCW4(RACKLNTH),RACKLIST   MOVE IN RACHECK     @G32DSMIX65298032
                                        PARAMETER LIST         @G32DSMI 65299032
*                                                              @G32DSMI 65300032
         LA    RB,DXCCW4                ADDR OF RACHECK LIST   @G32DSMI 65301032
         USING ACHKLIST,RB                                     @G32DSMI 65302032
         CLC   DXVOLSR2,SCRTCH          NON - SPECIFIC REQUEST @G32DSMI 65303032
         BNE   CSL09530                 NO - SKIP SETTING FLAG @G32DSMI 65304032
         OI    ACHKFLG1,ACHKLOGF        SET LOG = NOFAIL       @G32DSMI 65305032
CSL09530 EQU   *                        SPECIFIC REQUEST       @G32DSMI 65306032
         CLC   CSLEOV,WTGMODNM+K3       EOV                    @G32DSMI 65307032
         BNE   CSL09560                 NO                     @G32DSMI 65308032
         TM    DXDCBLST,X02             INPUT REQUEST          @G32DSMI 65309032
         BZ    CSL09560                 YES                    @G32DSMI 65310032
         LA    RF,DXOLDVOL              ADDRESS OF LAST VOL SER@G32DSMI 65311032
         ST    RF,ACHKOVOL              PUT IN PARM LIST       @G32DSMI 65312032
         DROP  RB                                              @G32DSMI 65313032
CSL09560 EQU   *                                               @G32DSMI 65314032
         RACHECK ENTITY=((R0)),MF=(E,DXCCW4)   CHECK USER'S    @G32DSMI*65315032
                                        AUTHORIZATION TO       @G32DSMI*65316032
                                        CREATE THIS VOL SER    @G32DSMI 65317032
*                                                              @G32DSMI 65318032
         LA    RB,K8                    SET REG FOR UNAUTH     @G32DSMI 65319032
         CR    RF,RB                    TEST FOR UNAUTHORIZED  @G32DSMI 65320032
         BE    CSL09700                 BR IF USER NOT AUTH    @G32DSMI 65321032
         BL    CSL09900                 BR IF AUTH (RC=0)      @G32DSMI 65322032
*                                        OR NOT DEFINED (RC=4) @G32DSMI 65323032
*                                                                       65324032
*        NOT SAME VOLUME SET  RC=12                            @G32DSMI 65325032
*                                                                       65326032
CSL09600 EQU   *                        EOV RACF INCONSISTENCY @G32DSMI 65327032
*                                                              @G32DSMI 65328032
***************************************************************@G32DSMI 65332032
*                                                              @G32DSMI 65333032
*        AN INCONSISTENT RACF DEFINITION EXISTS AT EOV         @G32DSMI 65334032
*        BETWEEN THE FIRST VOLUME AND THE CURRENTLY            @G32DSMI 65335032
*        SPECIFIED VOLUME. SET UP REG 0 WITH THE INTERNAL      @G32DSMI 65336032
*        CODE FOR A 937-3C OR A 937-40 ABEND.                  @G32DSMI 65337032
*                                                              @G32DSMI 65338032
***************************************************************@G32DSMI 65339032
*                                                              @G32DSMI 65340032
         L     R1,DXDEBXAD              ADDRESS OF DEB EXTN    @G32DSMI 65341032
         USING DEBXTN,R1                                       @G32DSMI 65342032
         LA    R0,EABD006               SET FOR 937-3C         @G32DSMI 65343032
         TM    DEBXFLG1,DEBXDSSI        FIRST VOLUME DEFINED   @G32DSMI 65344032
         BZR   RET                      YES RETURN             @G32DSMI 65345032
         LA    R0,EABD007               SET FOR 937-40         @G32DSMI 65346032
         BR    RET                      RETURN                 @G32DSMI 65347032
*                                                              @G32DSMI 65348032
CSL09700 EQU   *                        USER NOT AUTHORIZED    @G32DSMI 65349032
*                                                              @G32DSMI 65350032
*                                                              @G32DSMI 65351032
***************************************************************@G32DSMI 65352032
*                                                              @G32DSMI 65353032
*        THE USER IS NOT AUTHORIZED TO CREATE THE SPECIFED     @G32DSMI 65354032
*        VOLUME SERIAL. SET UP REG 0 WITH THE INTERNAL CODE    @G32DSMI 65355032
*        FOR A 913-38 OR A 937-28 ABEND                        @G32DSMI 65356032
*                                                              @G32DSMI 65357032
***************************************************************@G32DSMI 65358032
*                                                              @G32DSMI 65359032
         LA    R0,OABD141               913-38 ABEND IF OPEN   @G32DSMI 65360032
         CLC   CSLEOV,WTGMODNM+K3       TEST IF EOV            @G32DSMI 65361032
         BNER  RET                      RETURN IF OPEN         @G32DSMI 65362032
         LA    R0,EABD001               937-28 ABEND IF EOV    @G32DSMI 65363032
         BR    RET                      RETURN TO CALLER       @G32DSMI 65364032
*                                                              @G32DSMI 65365032
CSL09900 EQU   *                        SET OK RETURN CODE     @G32DSMI 65366032
*                                                              @G32DSMI 65367032
         LA    RF,0                     RACF CHECK OK          @G32DSMI 65368032
         BR    RET                      RETURN TO CALLER       @G32DSMI 65369032
*                                                              @G32DSMI 65370032
         EJECT                                                 @G32DSMI 65379032
*                                                              @G32DSMI 65380032
***************************************************************@G32DSMI 65381032
*                                                              @G32DSMI 65382032
*        GO TO IFG0194A TO DISMOUNT THE VOLUME.                @G32DSMI 65383032
*        REG 0 CONTAINS AN INTERNAL ABEND CODE.                @G32DSMI 65384032
*        IFG0194A WILL SUBSEQUENTLY CALL PROBLEM               @G32DSMI 65385032
*        DETERMINATION TO ISSUE THE INDICATED ABEND.           @G32DSMI 65386032
*                                                              @G32DSMI 65387032
***************************************************************@G32DSMI 65388032
*                                                              @G32DSMI 65389032
CSL10000 EQU   *                        BRANCH TO IFG0194A     @G32DSMI 65390032
*                                                              @G32DSMI 65391032
         NI    DCBIFLGS,X'FF'-DCBIFPIO  TURN OFF ERROR FLAGS   @G32DSMI 65392032
         NI    JFCBMASK+K5,LBWTRI9T     TURN OFF LABEL ERROR   @G32DSMIX65393032
                                        INDICATORS             @G32DSMI 65394032
         MVC   DXCALLID,ID3E3E          SET UP ERROR ID        @G32DSMI 65395032
         MVC   DXRETMOD,DXSAVMOD        SAVE RETURN MODULE     @G32DSMI 65396032
         MVC   DXRETCOD,DXSAVOFF        SAVE RETURN OFFSET     @G32DSMI 65397032
*                                                              @G32DSMI 65398032
         IECRES LOAD,MODID=ID3E4A,BRCODE=K16,BRANCH=QUEUED     @G32DSMI 65399032
         EJECT                                                 @G32DSMI 65400032
*                                                                Y02134 65500032
*****************************************************************Y02134 65502032
*                                                                Y02134 65504032
*        CONSTANTS                                               Y02134 65506032
*                                                                Y02134 65508032
*****************************************************************Y02134 65510032
*                                                                Y02134 65512032
RACKLIST RACHECK CLASS='TAPEVOL',ATTR=ALTER,MF=L               @G32DSMI 65590032
RACKLNTH EQU   *-RACKLIST               LENGTH OF RACHECK LIST @G32DSMI 65592032
EABD007  EQU   7                        INTERNAL ABEND 007     @G32DSMI 65594032
CSLEOV   DC    CL3'055'                 EOV SVC CODE IN WTGTBL @G32DSMI 65596032
AVOL1T   DC    C'VOL1'                  VOL LABEL IDENTIFIER            65600021
ACCWT    DC    X'0700000020000050'      BASIC CCW - REWIND COMMAN       65800021
ONE9T    DC    X'0001'                  ONE                             66600021
CHRM9T   DC    CL2'M '                  OPERATOR REJECT REPLY    Y02134 66610002
REPLYU   DC    CL6'U     '              OPERATOR REPLY U         YM8218 66620002
SCRTCH   DC    CL6'SCRTCH'              NON-SPECIFIC REQUEST     YM8218 66630002
*                                                                Y02134 66650002
XCTL3E   XCTLTABL ID=(ID3E3E,3E,ID3E4F,4F,ID3E4J,4J,           @G32DSMI*67650032
               ID3E4A,4A),                                     @G32DSMI*70650032
               SVC=019,LENGTH=,BRT=YES                           Y02134 73650032
         IECDSECS CVT,TCB,TIOT,DCB,UCB,MAIN,WTG,PREFX,         @G32DSMI*76650032
               JSCB,RACVT,ICHACHKL,IEZDEB,                     @G32DSMI*79650032
               EXPAND=YES                                      @G32DSMI 82650032
         IECEQU IEZDEB=YES                                              85650032
         END                                                            88650032
