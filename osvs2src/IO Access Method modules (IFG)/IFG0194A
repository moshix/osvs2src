         TITLE 'IFG0194A                      TAPE/DIRECT ACCESS VOLUMEX00050002
                AND UNIT SELECTION ROUTINE'                      Y02134 00100002
IFG0194A CSECT                                                          00101002
         ENTRY IFG0554A                 ENTRY FOR FEOV/EOV       Y02134 00102002
         ENTRY IFG0204A                 ENTRY FROM CLOSE         Y02134 00103002
IFG0554A EQU   IFG0194A                 ALIAS ENTRY POINT        Y02134 00104002
IFG0204A EQU   IFG0194A                 ALIAS ENTRY POINT        Y02134 00104202
*********************************************************************** 00104402
*                                                                     * 00104602
*        VS 2 RELEASE 03 DELETIONS/CHANGES                            * 00104737
*0000092637,092638,092664,092684                               @ZA03196 00105737
*0000                                                          @ZA02218 00106737
*0000785500-789550,795504,800000-802000                        @ZA14612 00107737
*                                                                     * 00108737
*        VS2 RELEASE O37 CHANGES/DELETIONS                            * 00108937
*C357997,A353580-353860,A795511,A882000-883800                 @ZA15095 00109137
*A882210-882220,A973210-973290,A882010-882020,A883810-883830   @ZA18540 00109337
*C520000                                                       @ZA19129 00109537
*                                                                     * 00109737
*        VS 2 RELEASE 02 DELETIONS/CHANGES                            * 00110737
*0000                                                           ZA00700 00114437
*0000139700-140300                                              ZA00142 00115337
*0000                                                          @Y30LSFY 00116237
*0000                                                          @ZM32752 00117137
*0000140864                                                    @ZA00002 00118037
*0000697027-697029                                             @ZA05469 00118937
*                                                                     * 00119837
* MODULE NAME = IFG0194A (OS/VS2)                                     * 00120737
*                                                                     * 00121637
* DESCRIPTIVE NAME = TAPE/DIRECT ACCESS VOLUME AND UNIT SELECTION     * 00122802
*                                                                     * 00123437
* COPYRIGHT = NONE                                                    * 00124337
*                                                                     * 00125237
* STATUS = RELEASE 2, LEVEL 0                                         * 00127402
*                                                                     * 00127802
* FUNCTION = THIS ROUTINE PERFORMS ALL VOLUME MOUNTING AND            * 00128802
*            DISMOUNTING FUNCTIONS FOR OPEN/CLOSE/EOV.                * 00129002
*                                                                     * 00129737
*            NEW VOLUME MOUNT FUNCTION - THE TYPE OF VOLUME           * 00130637
*            MOUNTING IS DERIVED FROM THE DATA SET ORGANIZATION.      * 00131537
*                                                                     * 00132437
*              A. PHYSICAL SEQUENTIAL & EXCP - VOLUME INDICATED BY    * 00133337
*                 DXVOLSEQ IS MOUNTED AND THE VOLUME INDICATED BY     * 00134237
*                 DXVOLSEQ + 1 IS LOOK-AHEAD MOUNTED.                 * 00135137
*                                                                     * 00136037
*              B. FOR NON-PHYSICAL SEQUENTIAL DATA SETS ALL VOLUMES   * 00136937
*                 ARE PARALLEL MOUNTED.                               * 00137837
*                                                                     * 00138737
*              C. ISAM OR BPAM - ALL VOLUMES ON ALL CONCATENATED      * 00139637
*                 DATA SETS ARE PARALLEL MOUNTED.                     * 00140537
*                                                                     * 00141437
*            THE VOLUME TO BE MOUNTED IS SELECTED AS INDICATED BY     * 00142337
*            DXVOLSEQ AND THE VOLUME SERIAL NUMBER IS SAVED AT        * 00143237
*            DXVOLSR2. THE VOLUME SERIAL NUMBER INDICATED BY          * 00144137
*            DXVOLSEQ + 1 IS SAVED AT DXVOLSR3. DXVOLSR3 WILL BE 0    * 00145037
*            IF DXVOLSEQ + 1 IS GREATER THAN THE CURRENT NO.          * 00145937
*            OF VOLUMES OR THE VOLUME COUNT SPECIFIED ON THE VOL      * 00146837
*            PARAMETER OF THE JCL.                                    * 00147737
*                                                                     * 00148637
*            IF THE VOLUME AT DXVOLSR2 IS OF THE FORM $TTRXX WHERE    * 00149537
*            $ = X'FF' AND TTR IS THE ADDRESS OF A JFCB EXTENSION,    * 00150437
*            THIS INDICATES THAT EITHER A NON-SPECIFIC REQUEST FOR    * 00151337
*            A TAPE VOLUME WAS MADE (TTR = 0 OR IS THE ADDRESS OF     * 00152237
*            THE JFCB WE ARE INTERRROGATING) OR A TAPE VOLUME WAS     * 00153137
*            REQUESTED USING VOL=REF ON THE JCL (IN WHICH CASE TTR    * 00154037
*            POINTS TO THE REFERENCED JFCB). IF THE REFERENCED        * 00154937
*            VOLUME IS ALSO NON-SPECIFIC, THE REFERENCED JFCB IS      * 00155837
*            REPOINTED TO THE CURRENT JFCB. THIS WILL CAUSE DD1 TO    * 00156737
*            LOOK LIKE IT IS REFERENCING DD2 IF DD2 ORIGINALLY        * 00157637
*            REFERENCED DD1 AND DD2 WAS OPENED FIRST. NOTE- VOL=REF   * 00158537
*            FOR TAPE ALWAYS USES THE LAST VOLUME OF THE REFERENCED   * 00159437
*            JFCB. IF ONLY ONE VOLUME EXISTS THIS WILL BE THE VOLUME  * 00160337
*            WHICH WILL BE USED.                                      * 00161237
*                                                                     * 00162137
*            THE VOLUME SPECIFIED BY DXVOLSR1 IS DISMOUNTED IF        * 00163037
*            THE NUMBER VOLUMES IS GREATER THAN THE NUMBER OF UNITS.  * 00163937
*            FOR EOV INPUT, THE DATA MANAGEMENT COUNT IN THE UCB      * 00164837
*            IS DECREMENTED. IF DXVOLSR2 COULD NOT BE OBTAINED        * 00165737
*            THE COUNT WOULD REMAIN INCREMENTED AND EOF PROCESSING    * 00166637
*            IS REQUESTED.                                            * 00167537
*                                                                     * 00168437
*            A UNIT IS SELECTED FOR DXVOLSR2 BASED ON THE ATTRIBUTES  * 00169337
*            OF THE VOLUME MOUNTED VERSUS THE ATTRIBUTES OF THE       * 00170237
*            VOLUME REQUESTED. THE DATA MANAGEMENT COUNT IS           * 00171137
*            INCREMENTED WHEN THE UNIT HAS BEEN SELECTED TO INFORM    * 00172037
*            THE SYSTEM THAT PROCESSING ON THIS UNIT IS IN PROGRESS.  * 00172937
*                                                                     * 00173837
*            WHEN A VOLUME SERIAL NUMBER (OR SCRTCH) AND A UNIT       * 00174737
*            HAVE BEEN SELECTED, THIS ROUTINE PASSES CONTROL TO A     * 00175637
*            TAPE OR DIRECT ACCESS MOUNT/VERIFY ROUTINE TO INSURE     * 00176537
*            THE CORRECT VOLUME IS MOUNTED ON THE SPECIFIED UNIT.     * 00177437
*            THE MOUNT/VERIFY ROUTINE RETURNS CONTROL TO THIS         * 00178337
*            ROUTINE TO SELECT ANOTHER VOLUME FOR PARALLEL MOUNTING   * 00179237
*            OR TO LOOK AHEAD MOUNT DXVOLSR3.                         * 00180137
*                                                                     * 00181037
*            BEFORE LOOK-AHEAD MOUNTING DXVOLSR3, IF DXVOLSR2 IS      * 00181937
*            SCRTCH, THE JFCB IS UPDATED TO REFLECT THE NEW VOLUME    * 00182837
*            SERIAL NUMBER FROM THE UCB.                              * 00183737
*                                                                     * 00184637
*            ONE OTHER ENTRY INTO THIS ROUTINE, PROVIDES              * 00185537
*            FOR PROCESSING DISP=MOD OUTPUT, WHERE THE LAST           * 00186437
*            VOLUME OF THE DATA SET IS NOT THE LAST VOLUME            * 00187337
*            SPECIFIED ON THE JCL.                                    * 00188237
*                                                                     * 00189137
*            ANOTHER ENTRY INTO THIS ROUTINE, PROVIDES A              * 00190037
*            VOLUME REJECT FUNCTION, WHEREBY THE VOLUME SPECIFIED     * 00190937
*            BY DXVOLSR2 COULD NOT BE USED.                           * 00191837
*                                                                     * 00192737
* NOTES = THIS MODULE MAY BE ENTERED FROM OPEN, CLOSE, OR EOV.        * 00193637
*                                                                     * 00194537
*    DEPENDENCIES = AS FOLLOWS -                                      * 00195437
*                                                                     * 00196337
*            1. CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE  * 00197237
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 00198137
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 00199037
*                                                                     * 00199937
*            2. ALL VOLUMES MOUNTED AND RECOGNIZED (LABEL READ AND    * 00200837
*               VOLUME SERIAL NUMBER IN THE UCBVOLI FIELD OF THE UCB) * 00201737
*               HAVE BEEN PREVIOUSLY ENQD IF THE VOLUMES ARE NOT      * 00202637
*               SHAREABLE.                                            * 00203537
*                                                                     * 00204437
*            3. A PRIVATE REQUEST FOR A DIRECT ACCESS VOLUME WILL     * 00205337
*               RESULT IN EXCLUSIVE USE OF THE VOLUME UNLESS IT       * 00206237
*               HAS BEEN SPECIFICALLY REQUESTED.                      * 00207137
*                                                                     * 00208037
*            4. A PUBLIC REQUEST FOR A DIRECT ACCESS VOLUME MAY       * 00208937
*               BE SHARED WITH ANY OTHER PUBLIC DA REQUEST.           * 00209837
*                                                                     * 00210737
*            5. A PRIVATE OR PUBLIC REQUEST FOR TAPE WILL RESULT IN   * 00211637
*               EXCLUSIVE USE OF THE VOLUME.                          * 00212537
*                                                                     * 00213437
*            6. IF A REQUEST (DEFFERED OR NOT) IS MADE FOR A          * 00214337
*               PRIVATE TAPE VOLUME AND THE ALLOCATED UNIT            * 00215237
*               CONTAINS A VOLUME OTHER THAN THE ONE REQUESTED,       * 00216137
*               THE MOUNTED VOLUME WILL BE DISMOUNTED BY THE          * 00217037
*               SCHEDULER (ALSO FOR NON-DEFERED REQUESTS, A           * 00217937
*               MOUNT MESSAGE FOR THE RIGHT VOLUME IS ISSUED.         * 00218837
*                                                                     * 00219737
*            7. ALSO, FOR A NON-SPECIFIC REQUEST FOR A PRIVATE        * 00220637
*               TAPE VOLUME, SCHEDULER WILL UNLOAD ANY VOLUME         * 00221537
*               ON AN ALLOCATED UNIT. (A VOLUME READY AND VERIFIED    * 00222437
*               IS LEFT OVER FROM A PREVIOUS OPEN/CLOSE).             * 00223337
*                                                                     * 00224237
*    RESTRICTIONS =                                                   * 00225137
*            1. IF A PROCESS REQUIRES TWO DATA SETS TO SHARE THE      * 00226037
*               SAME NON-SPECIFIC TAPE VOLUME AND UNIT WITHOUT        * 00226937
*               AN INTERVENING MOUNT AND DISMOUNT, THE VOL=REF        * 00227837
*               FACILITY OF THE JCL MUST BE USED. IF NOT USED,        * 00228737
*               THE MOUNTED VOLUME WILL BE DISMOUNTED AND A           * 00229637
*               REQUEST WILL BE MADE FOR A SCRTCH OR PRIVAT VOLUME.   * 00230537
*                                                                     * 00231437
*    REGISTER CONVENTIONS =                                           * 00232337
*            R2 POINTS TO DCB                                         * 00233237
*            R3 IS THE BASE REGISTER                                  * 00234137
*            R4 POINTS TO OPEN WORK AREA                              * 00235037
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 00235937
*            R6 POINTS TO THE WTG TABLE                               * 00236837
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 00237737
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 00238637
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 00239537
*            R10 POINTS TO THE UCB                                    * 00240437
*                                                                     * 00241337
* PATCH LABEL = DEFINED IN THE XCTLTABL MACRO AT THE END OF THE       * 00242237
*               LISTING FOR THIS MODULE.                              * 00243137
*                                                                     * 00244037
* MODULE TYPE = CONTROL                                               * 00244937
*                                                                     * 00245837
*     PROCESSOR = ASSEMBLER XF                                        * 00246737
*                                                                     * 00247637
*     MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON    * 00248537
*                   ORG STATEMENT AT END OF LISTING                   * 00249437
*                                                                     * 00250337
*     ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,         * 00251237
*                  PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY, * 00252137
*                  LINK PACK AREA RESIDENT/PAGEABLE                   * 00253037
*                                                                     * 00253902
* ENTRY POINT =                                                       * 01187202
*        IFG0194A FROM OPEN                                           * 01187602
*        IFG0204A FROM CLOSE                                          * 01188002
*        IFG0554A FROM EOV                                            * 01188402
*                                                                     * 01188902
*                  BRANCH OFFSET 0 = INITIAL ENTRY TO PERFORM         * 01204402
*                                    VOLUME AND UNIT SELECTION        * 01204602
*                                    FUNCTIONS LISTED ABOVE.          * 01204702
*                                                                     * 01205002
*                  BRANCH OFFSET 4 = ENTRY TO PERFORM DISPOSITION     * 01210002
*                                    ONLY FOR VOLUME SPECIFIED BY     * 01215002
*                                    DXVOLSR1 IN THE WORK AREA.       * 01220002
*                                                                     * 01230002
*                  BRANCH OFFSET 8 = RETURN FROM DISMOUNT ROUTINE.    * 01235002
*                                                                     * 01241002
*                  BRANCH OFFSET 12 = RETURN FROM VOLUME              * 01242002
*                                     MOUNT/VERIFY ROUTINE. ALSO      * 01247002
*                                     PARALLEL MOUNT RENTRY.          * 01252002
*                                                                     * 01253002
*                  BRANCH OFFSET 16 = ENTRY TO REJECT VOLUME          * 01254002
*                                     SPECIFIED BY DXVOLSR2.          * 01255002
*                                                                     * 01257002
*                  BRANCH OFFSET 20 = ENTRY TO REJECT VOLUME          * 01262002
*                                     SPECIFIED BY DXVOLSR2 FOR       * 01267002
*                                     DISP=MOD ON DIRECT ACCESS.      * 01272002
*                                                                     * 01274002
*                  BRANCH OFFSET 24 = ENTRY FROM PROBLEM              * 01276002
*                                     DETERMINATION TO RETRY          * 01276402
*                                     MOUNT VERIFY WITH NEW VOLUMES.  * 01276802
*                                                                     * 01276902
*                  BRANCH OFFSET 24 = RETURN FROM LOOK/AHEAD MOUNT    * 01278602
*                                     MESSAGE ROUTINE.                * 01279002
*                                                                     * 01279402
*                  BRANCH OFFSET 28 = RETURN FROM REJECT DXVOLSR2     * 01279802
*                                     MESSAGE ROUTINE.                * 01280202
*                                                                     * 01280302
*        LINKAGE = THIS MODULE IS ENTERED AS A SUBROUTINE.            * 01282002
*                                                                     * 01287002
*                  MVC   DXVOLSEQ,VOLSEQ    INDICATE WHICH VOLUME     * 01288002
*                  MVC   DXRETMOD(5),RETID  SAVE RETURN ID/VCON       * 01292002
*                  MVI   DXRETCOD,RETOFF    SAVE RETURN BRANCH OFFSET * 01297002
*                  IECRES LOAD,MODID=ID4A,BRCODE=OFFSET,BRANCH=QUEUED * 01302002
*                                                                     * 01307002
* INPUT = AS FOLLOWS -                                                * 01500002
*                                                                     * 01510002
*                REGISTERS 2-10 INITIALIZED AS TO OPEN/CLOSE/EOV      * 01515002
*                REGISTER CONVENTIONS.                                * 01520002
*                                                                     * 01525002
*                DXVOLSEQ - SEQUENCE NUMBER OF VOLUME TO BE MOUNTED.  * 01530002
*                DXVOLSR1 - VOLUME TO BE DISMOUNTED.                  * 01535002
*                DXUCBADR - ADDRESS OF UCB FOR DXVOLSR1 OR            * 01540002
*                           ADDRESS TO START SEARCH FOR VOLUME        * 01545002
*                           TO BE MOUNTED.                            * 01550002
*                                                                     * 01555002
*                OTHER AREAS AS TO OPEN, CLOSE, AND EOV CONVENTION.   * 01560002
*                                                                     * 01600002
* OUTPUT =                                                            * 01650002
*                                                                     * 01660002
*                 DXVOLSR1 - SET TO ZERO.                             * 01700002
*                 DXVOLSR2 - VOLUME MOUNTED AND VERIFIED OR SCRTCH.   * 01705002
*                 DXVOLSR3 - VOLUME LOOK-AHEAD MOUNTED.               * 01710002
*                 DXUCBADR - ADDRESS OF UCB FOR DXVOLSR2.             * 01715002
*                 DXUNITOF - OFFSET OF UCB IN TIOT ENTRY.             * 01720002
*                                                                     * 01725002
*                 VOLUME MOUNTED AND VERIFIED ON UCB SPECIFIED BY     * 01730002
*                 DXUCBADR WITH UCBDMCT INCREMENTED.                  * 01735002
*                                                                     * 01740002
*                 JFCB UPDATED AND WRITTEN TO JOBQUE.                 * 01745002
*                                                                     * 01746002
* EXIT-NORMAL = NORMAL EXIT IS TO THE CALLER VIA                      * 01747002
*                                                                     * 01747402
*               IC    RET,DXSAVOFF     LOAD RETURN OFFSET             * 01748202
*               IECRES LOAD,MODID=DXSAVMOD,BRCODE=(RET),BRANCH=QUEUED * 01749002
*                                                                     * 01751002
*               SUBROUTINE EXITS-                                     * 01753002
*                                                                     * 01755002
*               IFG0194C VERIFY VOLUME ON DA                          * 01759202
*               IFG0194F VERIFY VOLUME ON TAPE                        * 01769202
*               IFG0194J ISSUE MOUNT/DISMOUNT MESSAGES                * 01769602
*                                                                     * 01776402
* EXIT-ERROR = IFG0190P ALIAS = IFG0200P,IFG0550P                     * 01779802
*                                                                     * 01789902
* EXTERNAL REFERENCES = AS FOLLOWS -                                  * 01800002
*                                                                     * 01805002
*        ROUTINES =                                                   * 01810002
*                                                                     * 01815002
*         IFG019RA - OPEN/CLOSE/EOV RESIDENT ROUTINE                  * 01850002
*                    FOR IECRES FUNCTIONS.                            * 01900002
*                                                                     * 01910002
*         IFG0194C - DIRECT ACCESS MOUNT/VERIFY FUNCTION.             * 01950002
*                                                                     * 01955002
*         IFG0194F - TAPE MOUNT/VERIFY FUNCTION.                      * 01960002
*                                                                     * 01965002
*         IFG0194J - MESSAGE FUNCTION.                                * 01970002
*                                                                     * 01971002
*         DEQ - DEQ VOLUME RESOURCE.                                  * 01972002
*                                                                     * 01975002
*        DATA-AREAS = SEE DESCRIPTION OF IECDSECT FOR DESCRIPTION     * 01980002
*                     OF OPEN, CLOSE, AND EOV WORKAREAS.              * 01985002
*                                                                     * 02000002
*        CONTROL-BLOCKS = SEE LIST SPECIFIED BY IECDSECS              * 02050002
*                         MACRO CALL AT END OF LISTING.               * 02055002
*                                                                     * 02750002
* TABLES = AS FOLLOWS -                                               * 02800002
*          OPEN/EOV INTERNAL ABEND CODE TABLE. ONE ERROR GENERATES A  * 02802002
*          DIFFERENT ABEND CODE FOR OPEN AND EOV.                     * 02804002
*                                                                     * 02900002
* MACROS = THE FOLLOWING MACROS ARE USED-                             * 03400002
*                                                                     * 03405002
*              IECDSECS                                               * 03410002
*              IECEQU                                                 * 03420002
*              IECRES                                                 * 03425002
*              DMABCOND                                               * 03426002
*              XCTLTABL                                               * 03430002
*              SAVE                                                   * 03431002
*              RETURN                                                 * 03432002
*              SETLOCK                                                * 03435002
*              MODESET                                                * 03440002
*              DEQ                                                    * 03445002
*                                                                     * 03446002
* CHANGE ACTIVITY = FIRST RELEASE                                     * 03447002
*                                                                     * 03450002
*********************************************************************** 03500002
         EJECT                                                          03550002
         IECEQU AOS=YES                                                 08100002
*                                                                       08200002
         USING FORCORE,RCORE                                            08250002
         USING IHADCB,RDCB                                              08300002
         USING TIOENTRY,RTIOT                                           08350002
         USING WTG,RWTG                                                 08400002
         USING WTGENTRY,RWTGC           RWTGC POINTS TO WTGENTRY Y02134 08410002
         USING UCBOB,RUCB               RUCB POINTS TO UCB       Y02134 08450002
         USING USERPRML,RPARC           POINTS TO CURRENT ENTRY  Y02134 08500002
EABD185  EQU   185                      B37-4 ABEND CODE       @ZA02218 08510037
         BALR  RBASE,R0                 ESTABLISH ADDRESSABILITY        08550002
         USING *,RBASE                                                  08600002
*                                                                Y02134 08650002
VUS00000 EQU   *                        GO TO BRANCH TABLE       Y02134 08700002
*                                                                Y02134 08750002
         B     VUS00100(RET)            BRANCH ON INDEX          Y02134 08800002
*                                                                Y02134 08850002
VUS00100 EQU   *                        BRANCH TABLE             Y02134 08900002
*                                                                Y02134 08950002
         B     VUS03000                 BRANCH TO INITIAL ENTRY  Y02134 09000002
         B     VUS02100                 BRANCH VOLUME DISPOSITN  Y02134 09010002
         B     VUS05010                 BRANCH RETURN FROM DISMT Y02134 09050002
         B     VUS01000                 BRANCH RETURN FROM MOUNT Y02134 09100002
         B     VUS02000                 BRANCH DXVOLSR2 REJECT   Y02134 09160002
         B     VUS02500                 BRANCH DISP=MOD REJECT   Y02134 09170002
         B     VUS11000                 BRANCH PD RETRY ENTRY    Y02080 09180002
         B     VUS09100                 LOOK AHEAD MOUNT RETURN  YM1350 09190002
         B     VUS02050                 REJECT RETURN            YM1108 09192002
         B     VUS02010                 I/O ERROR RETURN       @ZA03196 09192137
         EJECT                                                          09200002
*                                                                Y02134 09200402
*****************************************************************Y02134 09200802
*                                                                Y02134 09201202
*        RETURN HERE FROM MOUNT VERIFY.                          Y02134 09201602
*        PHYSICAL SEQUENTIAL DATA SETS GO TO LOOK AHEAD MOUNT.   Y02134 09201702
*        NON-PHYSICAL SEQUENTIAL DATA SETS GO TO PARALLEL MOUNT. Y02134 09201802
*                                                                Y02134 09202002
*****************************************************************Y02134 09202402
*                                                                Y02134 09202802
VUS01000 EQU   *                                                 Y02134 09204002
*                                                                Y02134 09206002
*        CHECK FOR PO BEFORE EXCP, DSORG FIELD EXISTS IN COPY    YM3925 09206402
*        EVEN IF NOT IN USERS DCB.                               YM3925 09206802
         TM    DCBDSORG,DCBDSGPO        TEST FOR BPAM DATA SET   YM3925 09208002
         BO    VUS03220                 BRANCH TO PARALLEL MOUNT YM3925 09209602
*                                                                YM3925 09210002
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    Y02134 09211302
         BO    VUS06000                 BR IF EXCP, ASSUME PS    Y02134 09212902
*                                                                Y02134 09214502
VUS01010 EQU   *                        NOT EXCP                 Y02134 09214902
*                                                                Y02134 09215302
         NC    DCBDSORG,DCBDSORG        CHECK IF DSORG SPECIFIED Y02134 09216502
         BZ    VUS06000                 BRANCH 0, ASSUME PS      Y02134 09218502
*                                                                Y02134 09220502
         TM    DCBDSORG,DCBDSGPS        PHYSICAL SEQUENTIAL DCB  Y02134 09222502
         BO    VUS06000                 BR IF YES                Y02134 09224502
         B     VUS03220                 BRANCH TO PARALLEL MOUNT Y02134 09226502
         EJECT                                                          09226702
*                                                                Y02134 09230102
*****************************************************************Y02134 09240002
*                                                                Y02134 09242002
*        VOLUME SPECIFIED BY DXVOLSR2 IS TO BE REJECTED.         Y02134 09242402
*                                                                Y02134 09244002
*****************************************************************Y02134 09246002
*                                                                Y02134 09250402
VUS02000 EQU   *                                                 Y02134 09250502
*                                                                Y02134 09250602
         LR    RB,R0                    SAVE PD CODE IN RB       YM1108 09252202
         MVC   DXSAVMOD,DXRETMOD        SAVE RETURN LOAD         Y02134 09252702
         MVC   DXSAVOFF,DXRETCOD        SAVE RETURN OFFSET       Y02134 09253202
*                                                                Y02134 09253702
         MVC   DXWORK(L'UCBVOLI),UCBVOLI SAVE VOLUME TO DISMOUNT YM2850 09254202
*                                                                Y02080 09260502
         MVI   DXEXTSW,K0               SET DISP=MOD SW TO 0     YM1108 09261502
*                                                                YM1108 09261702
         L     RET,DXDSAB               FETCH DSAB ADDRESS       YM5957 09261802
         MODESET EXTKEY=SCHED           ASSUME DSAB KEY          YM5957 09261902
         NI    DSABFLG4-DSAB(RET),X'FF'-DSABCKVL VOLUME REJECTED YM5957 09262002
*                                       RESET ANY RESIDUAL CHKPT YM5957 09262102
*                                       SECURE FLAG IN DSAB      YM5957 09262202
         MODESET EXTKEY=DATAMGT         RESUME D/M KEY           YM5957 09262302
         CLI   UCBDMCT,X01              TEST FOR ONE USER        YM1472 09262402
         BNE   VUS02050                 BRANCH IF MORE THAN 1    YM1472 09262502
         TM    UCBSTAT,UCBRESV+UCBSYSR+UCBPRES RSRVD,SYSRES,PERM YM1108 09263402
         BNZ   VUS02050                 BRANCH IF ANY OR ALL     YM1108 09263602
         TM    UCBTBYT3,UCB3TAPE        TEST IF 2400 UNIT      @ZA03196 09263737
         BO    VUS02002                 BRANCH IF TAPE         @ZA03196 09263837
         TM    UCBSTAB,UCBBSVL          TEST FOR SHARED VOLUME   YM1108 09264302
         BNO   VUS02050                 BRANCH IF SHARED UNIT    YM1108 09264402
         EJECT                                                          09264737
*                                                                       09264837
*********************************************************************** 09264937
*                                                                       09265037
*        IF AN I/O ERROR OCCURRED ON TAPE SETUP FOR NEW TAPE.           09265137
*                                                                       09265237
*********************************************************************** 09265337
*                                                                       09265437
VUS02002 EQU   *                        TEST FOR I/O ERROR     @ZA03196 09265537
*                                                                       09265637
         TM    DXECB,ECBNOERR           TEST FOR I/O ERROR     @ZA03196 09265737
         BO    VUS02020                 BRANCH IF NO ERROR     @ZA03196 09265837
*                                                                       09265937
         LTR   RB,RB                    CHECK IF WRONG VOL     @ZA03196 09266137
         BZ    VUS02020                 BRANCH TO GET NEW VOL  @ZA03196 09266237
         CLC   DXVOLSR2,SCRTCH          CHECK IF SCRTCH VOLUME @ZA03196 09266337
         BE    VUS02020                 BRANCH IF SCRATCH      @ZA03196 09266437
*                                                                       09266537
VUS02005 EQU   *                        ISSUE IEC513D MSG      @ZA03196 09266637
*                                                                       09266737
         XC    DXWORK2,DXWORK2          CLEAR REPLY AREA       @ZA03196 09266837
         LA    R1,DXWORK2               LOAD POINTER TO REPLY  @ZA03196 09266937
         LA    R0,K1                    LOAD LENGTH OF REPLY   @ZA03196 09267037
         SLL   R0,K24                   SHIFT TO HI BYTE       @ZA03196 09267137
         OR    R1,R0                    MOVE LENGTH TO REG 1   @ZA03196 09267237
*                                                              @ZA03196 09267337
         MVC   DXRETMOD,ID4A4A          RETURN MOD NAME        @ZA03196 09268037
         MVI   DXRETCOD,K36             RETURN OFFSET          @ZA03196 09268137
         IECRES LOAD,MODID=ID4A4J,BRCODE=K68,BRANCH=QUEUED     @ZA03196 09268237
         EJECT                                                          09268337
*                                                                       09268437
*********************************************************************** 09268537
*                                                                       09268637
*        RETURN WITH OPERATOR REPLY TO I/O ERROR MSG.                   09268737
*                                                                       09268837
*********************************************************************** 09268937
*                                                                       09269037
VUS02010 EQU   *                        CHECK REPLY            @ZA03196 09269137
*                                                              @ZA03196 09269237
         CLI   DXWORK2,CHARU            CHECK IF ABEND REQSTD  @ZA03196 09269337
         BE    VUS02020                 BRANCH TO ABEND        @ZA03196 09269437
*                                                              @ZA03196 09269537
         CLI   DXWORK2,CHARM            CHECK FOR NEW VOL      @ZA03196 09269637
         BNE   VUS02005                 BRANCH TO ASK AGAIN    @ZA03196 09269737
*                                                              @ZA03196 09269837
         XR    RB,RB                    CLEAR TO BYPASS ABEND  @ZA03196 09269937
*                                                                YM1108 09270037
VUS02020 EQU   *                        EXIT TO DISMOUNT ROUTINE YM2850 09270137
*                                                                YM2850 09270402
         MVC   DXRETMOD,ID4A4A          MOVE IN RETURN MOD NAME  YM1108 09362502
         MVI   DXRETCOD,K32             SET BRANCH RETURN CODE   YM1108 09364502
*                                                                YM1108 09364902
         IECRES LOAD,MODID=ID4A4J,BRCODE=K12,BRANCH=QUEUED       YM1157 09365302
         EJECT                                                          09365437
*                                                                       09365537
*********************************************************************** 09365637
*                                                                       09365737
*        RETURN FROM REWIND UNLOAD OF BAD VOLUME.                       09365837
*                                                                       09365937
*********************************************************************** 09366037
*                                                                YM1108 09366302
VUS02050 EQU   *                        RETURN FROM DISMOUNT     YM1108 09366402
*                                                                YM1108 09367402
         MVC   DXVOLSR1,DXWORK          SET UP DISMOUNTED VOLUME YM2850 09367802
*                                                                Y02134 09374502
*        NOTE - ERROR CODE PASSED IN REG 0 SAVED IN REG 11       YM1108 09378002
*                                                                Y02134 09378402
         LTR   R0,RB                    CHECK IF WRONG VOL       YM7396 09379502
         BZ    VUS02060                 BRANCH TO GET RIGHT VOL  YM7396 09379602
         CLC   DXVOLSR1,SCRTCH          CHECK FOR VOLSER SCRTCH  YM3008 09379802
         BE    VUS02070                 BRANCH SPECIFIC REQUEST  YM3111 09380202
         CLC   DXVOLSR2,SCRTCH          CHECK FOR SCRTCH VOLUME  Y02134 09380402
         BNE   VUS02070                 BRANCH SPECIFIC REQUEST  YM3111 09382502
*                                                                Y02134 09386502
         CLC   DXVOLSR1,UCBVOLI         CHECK IF STILL MOUNTED   YM1108 09386702
         BE    VUS02060                 BYPASS DEQ IF STILL UP   YM1108 09386902
*                                                                YM1108 09387102
         MVC   DXWORK1(K16),DEQLIST     INIT DEQ LIST            Y02134 09390502
         L     RF,DXJSCBAD              LOAD JSCB ADDRESS        Y02134 09394502
         L     R0,JSCBTCBP-IEZJSCB(,RF) INITIATOR TCB POINTER    Y02134 09398202
VUS02450 DEQ   (,DXVOLSR1),TCB=(0),MF=(E,DXWORK2),               Y02134X09405602
               RELATED=(SYSZVOLS,IFG0194C(DAMV0202))             Y02134 09409302
*                                                                Y02134 09420402
VUS02060 EQU   *                        DECREMENT COUNT          YM1108 09424302
*                                                                Y02134 09425702
         BAL   RET,VUS07100             DECREMENT DM COUNT       Y02134 09426402
*                                                                Y02134 09454502
         STC   RB,DXRETCOD              INDICATE REJECT          YM1157 09454902
         XC    DXUCBSAV,DXUCBSAV        CLEAR TO RESAVE FIRST    Y02134 09455202
         B     VUS05020                 BRANCH TO GET NEW UNIT   YM1157 09456202
*                                                                YM3111 09466202
VUS02070 EQU   *                        PROB DET                 YM3111 09476202
*                                                                YM3111 09486202
         CLC   DXCALLID,ZEROS           CHECK IF ALREADY SET UP  YM4647 09488202
         BNZ   VUS02080                 BRANCH IF SET UP         YM4647 09488602
*                                                                YM4647 09489002
         MVC   DXCALLID,DXSAVMOD        SET UP ERROR MOD         YM3111 09490202
*                                                                YM4647 09490302
VUS02080 EQU   *                        PROB DET                 YM3111 09490402
*                                                                YM3111 09490502
         MVC   DXRETMOD,ID4A4A          SET UP RETRY MOD         YM3111 09490602
         IECRES LOAD,MODID=ID4A0P,BRCODE=K24,BRANCH=QUEUED       YM3111 09492202
         EJECT                                                          09494702
*                                                                Y02134 09502602
*****************************************************************Y02134 09504102
*                                                                Y02134 09504602
*        VOLUME SPECIFIED BY UCBVOLI IS TO BE DISMOUNTED.        Y02134 09505102
*                                                                Y02134 09505602
*****************************************************************Y02134 09506102
*                                                                Y02134 09506602
VUS02100 EQU   *                                                 Y02134 09507102
*                                                                Y02134 09507602
         MVC   DXSAVMOD,DXRETMOD        SAVE RETURN LOAD         Y02134 09508102
         MVC   DXSAVOFF,DXRETCOD        SAVE RETURN OFFSET       Y02134 09508602
*                                                                Y02134 09509102
         MVC   DXVOLSR1,UCBVOLI         MOVE BAD VOL TO DISMOUNT Y02134 09509602
         MVC   DXUCBSAV,DXUCBADR        SAVE UCB ADDRESS         YM1192 09509702
         MVC   DXUCBSAV(K1),DXUNITOF+K1 SAVE TIOT OFFSET         YM1192 09510202
         MVC   DXDSAB,DXDSABAD          SAVE DSAB ADDRESS        YM1192 09510302
         B     VUS05000                 BRANCH TO DISMOUNT       Y02134 09510702
*                                                                Y02134 09511202
         EJECT                                                          09511702
*                                                                Y02134 09512202
*****************************************************************Y02134 09526302
*                                                                Y02134 09534202
*        FOR DIRECT ACCESS DISP=MOD, THE LAST VOLUME IS          Y02134 09542102
*        MOUNTED FIRST. IF THE DATA SET DOES NOT EXIST           Y02134 09550002
*        ON THE LAST VOLUME, A SEARCH IS MADE FOR THE            Y02134 09600002
*        END OF THE DATA SET, STARTING WITH THE FIRST VOLUME.    Y02134 09650002
*                                                                Y02134 09700002
*****************************************************************Y02134 09750002
*                                                                Y02134 09800002
VUS02500 EQU   *                                                 Y02134 09850002
*                                                                Y02134 09860002
         LH    RC,DXVOLSEQ              LOAD VOL SEQ NO.         Y02134 09895002
         CLC   JFCBNVOL,DXVOLSEQ+K1     CHECK TO SEE IF LAST VOL Y02134 09897502
         BE    VUS02510                 BRANCH IF LAST VOLUME    Y02134 09900002
*                                                                Y02134 09910002
*****************************************************************Y02134 09912002
*                                                                Y02134 09914002
*        IF NOT THE LAST VOLUME AND THE VOLUME REJECT            Y02134 09916002
*        INDICATOR IS ON THE VOLUME SEQUENCE NUMBER IS           Y02134 09918002
*        TO BE DECREMENTED BY ONE, BECAUSE THE LAST VOLUME       Y02134 09918402
*        INDICATOR IN THE DSCB WAS NOT ON AND WAS NOT FOUND      Y02134 09918802
*        WHEN VOLUME N-1 WAS VERIFIED. THIS IS BECAUSE           Y02134 09919202
*        THE DATA SET WAS PROBABLY CREATED BEFORE RELEASE 17.    Y02134 09919702
*                                                                Y02134 09920002
*****************************************************************Y02134 09930002
*                                                                Y02134 09940002
         TM    DXEXTSW,ALLBITS          TEST FOR NO DSCB FOUND   Y02134 09942002
         BNO   VUS02520                 INCREMENT TO NEXT        Y02134 09944002
*                                                                Y02134 09950002
         BCTR  RC,R0                    DECREMENT COUNT          Y02134 10000002
         B     VUS02530                 BRANCH TO STORE COUNT    Y02134 10010002
*                                                                Y02134 10050002
VUS02510 EQU   *                        LAST VOLUME              Y02134 10100002
*                                                                Y02134 10150002
         MVI   DXEXTSW,K0               SET REJECT OFF           Y02134 10152002
         LH    RC,ONE                   SET COUNT TO ONE         Y02134 10160002
         B     VUS02530                 BRANCH TO STORE COUNT    Y02134 10162002
*                                                                Y02134 10170002
VUS02520 EQU   *                        INCREMENT TO NEXT DSCB   Y02134 10180002
*                                                                Y02134 10190002
         LA    RC,K1(RC)                INCREMENT BY ONE         Y02134 10250002
*                                                                Y02134 10260002
VUS02530 EQU   *                        STORE COUNT              Y02134 10270002
*                                                                Y02134 10280002
         STH   RC,DXVOLSEQ              UPDATE VOL SEQ NO.       Y02134 10282002
*                                                                Y02134 10284002
         CLC   JFCBNVOL,DXVOLSEQ+K1     CHECK TO SEE IF LAST VOL Y02134 10286002
         BE    VUS10060                 BR IF DATA SET NOT FOUND Y02134 10288402
*                                                                Y02134 10288802
         BAL   RET,VUS07100             DECREMENT DM COUNT       Y02134 10290002
*                                                                Y02134 10342802
         XC    DXUCBSAV,DXUCBSAV        CLEAR TO SAVE FIRST UNIT Y02134 10510002
*                                                                Y02134 10520002
         MVC   DXVOLSR1,DXVOLSR2        DISMOUNT CURRENT VOLUME  Y02134 10550002
         B     VUS03300                 BRANCH TO FIND VOLUMES   Y02134 10600002
         EJECT                                                          10650002
*                                                                Y02134 10700002
VUS03000 EQU   *                        INITIAL ENTRY            Y02134 10750002
*                                                                Y02134 10800002
*****************************************************************Y02134 10850002
*                                                                Y02134 10900002
*        THE TYPE OF VOLUME MOUNTING REQUIRED IS DERIVED         Y02134 10950002
*        FROM THE DATA SET ORGANIZATION.                         Y02134 11000002
*                                                                Y02134 11050002
*****************************************************************Y02134 11100002
*                                                                Y02134 11150002
         XC    DXUCBSAV,DXUCBSAV        CLEAR TO SAVE FIRST UNIT Y02134 11150402
*                                                                Y02134 11150802
         LA    RCORE,DXDSCB             CLEAR HI ORDER BYTE      Y02134 11152002
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE DEVICE     Y02134 11154002
         BO    VUS03200                 BRANCH IF TAPE           Y02134 11156002
         ST    RCORE,CORECH(,RCORE)     INITIALIZE FOR DA VERIFY Y02134 11156402
*                                                                Y02134 11156802
VUS03200 EQU   *                        CHECK DSORG              YM3925 11157202
*                                                                Y02134 11158002
         MVC   DXDSAB,DXDSABAD          INITIALIZE DSAB POINTER  Y02134 11160002
*                                                                Y02134 11170002
         MVC   DXSAVMOD,DXRETMOD        SAVE RETURN LOAD         Y02134 11180002
         MVC   DXSAVOFF,DXRETCOD        SAVE RETURN OFFSET       Y02134 11192002
*                                                                Y02134 11194002
*        CHECK FOR PO BEFORE EXCP, DSORG FIELD EXISTS IN COPY    YM3925 11196002
*        EVEN IF NOT IN USERS DCB.                               YM3925 11198002
         TM    DCBDSORG,DCBDSGPO        TEST FOR BPAM DATA SET   YM3925 11198402
         BO    VUS03210                 BRANCH TO PARALLEL MOUNT YM3925 11198802
*                                                                YM3925 11199202
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    Y02134 11200002
         BO    VUS03300                 BRANCH IF EXCP           YM1228 11250002
*                                                                Y02134 11260002
         NC    DCBDSORG,DCBDSORG        CHECK IF DSORG SPECIFIED Y02134 11350002
         BZ    VUS03300                 BRANCH 0, ASSUME PS      Y02134 11400002
*                                                                Y02134 11450002
         TM    DCBDSORG,DCBDSGPS        PHYSICAL SEQUENTIAL DCB  Y02134 11500002
         BO    VUS03300                 BR IF YES                Y02134 11550002
*                                                                Y02134 11600002
VUS03210 EQU   *                        DSORG FOR DA DATA SETS   YM3925 11602002
*                                                                YM3925 11604002
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE DEVICE     Y02134 11700002
         LA    R0,K2                    OPEN=413=04 EOV=NA       YM1238 11710002
         BO    VUS10090                 BRANCH IF TAPE           Y02134 11750002
*                                                                Y02134 11800002
*****************************************************************Y02134 11850002
*                                                                Y02134 11900002
*        FOR NON-PHYSICAL SEQUENTIAL DATA SETS ALL               Y02134 11950002
*        VOLUMES ARE TO BE MOUNTED. THE FIRST VOLUME             Y02134 12000002
*        IS SET UP AND THE REST ARE PARALLEL MOUNTED.            Y02134 12050002
*                                                                Y02134 12100002
*****************************************************************Y02134 12150002
*                                                                Y02134 12210002
         XC    DXVOLSEQ,DXVOLSEQ        INITIALIZE TO ZERO       Y02134 12212002
*                                                                Y02134 12214002
         TM    DCBDSORG,DCBDSGDA        TEST IF BDAM             Y02134 12220002
         BZ    VUS03218                 BRANCH IF NOT BDAM       Y02134 12230002
*                                                                Y02134 12240002
         MVI   DCBDRDX,K0               SET BDAM EXTENTS TO 0    Y02134 12242002
*                                                                Y02134 12244002
VUS03218 EQU   *                        PARALLEL MOUNT           Y02134 12244402
*                                                                Y02134 12244802
         TM    DCBDSORG,DCBDSGIS        TEST IF ISAM             Y02134 12245202
         BNO   VUS03220                 BRANCH IF NOT ISAM       Y02134 12245602
*                                                                Y02134 12245702
         MVC   DXDEBSYS(K1),DXDCBLST    SAVE ISAM OPTIONS        YM7051 12255702
ISAMOUT  EQU   X'7C'                    ISAM OUTPUT OPTIONS      YM7535 12265702
         TM    DCBMACRF+K1,ISAMOUT      TEST FOR ISAM OUTPUT     YM7535 12275702
         BZ    VUS03220                 BRANCH IF NOT OUTPUT     YM7535 12285702
*                                                                Y02134 12295902
         OI    DXDCBLST,PLISTOUT        SET OUTPUT IN PARM LIST  Y02134 12305902
*                                                                Y02134 12345902
VUS03220 EQU   *                        PARALLEL MOUNT           Y02134 12400002
*                                                                Y02134 12450002
         L     RB,DXDSAB                POINTER TO CURRENT DSAB  Y02134 12500002
         L     RTIOT,DSABTIOT-DSAB(RB)  LOAD TIOT POINTER        Y02134 12550002
         LH    RC,DXVOLSEQ              LOAD VOL SEQ INDEX       Y02134 12650002
         LA    RC,K1(RC)                INCREMENT BY ONE         Y02134 12700002
         STH   RC,DXVOLSEQ              UPDATE VOL SEQ COUNT     Y02134 12750002
*                                                                Y02134 12752002
         LA    RET,DXJBF                WORK AREA JFCB           Y02134 12754002
         C     RB,DXDSABAD              CHECK FOR CONCATENATION  Y02134 12756002
         BE    VUS03221                 BRANCH IF NO CONCATENATN Y02134 12758002
         LA    RET,TIOEJFCB             LOAD POINTER TO JFCB PTR Y02134 12760002
*                                                                Y02134 12800002
         IECRES LOCJFCB,(RET)                                    Y02134 12850002
*                                                                Y02134 12860002
VUS03221 EQU   *                        NO CONCATENATION         Y02134 12870002
*                                                                Y02134 12900002
         CLC   JFCBNVOL-INFMJFCB(K1,RET),ONE+K1 VALIDITY CHECK   Y02134 12950002
         LA    R0,K3                    OPEN=413-18 EOV=NA       Y02080 12960002
         BL    VUS10090                 BRANCH TO PROB DET       Y02134 13000002
         BE    VUS03222                 BRANCH PASSED BPAM CHECK Y02134 13002002
         CLC   DXVOLSEQ,ONE             CHECK FOR FIRST VOLUME   Y02134 13004002
         BE    VUS03222                 BRANCH PASSED BPAM CHECK Y02134 13006002
*                                                                Y02134 13008002
         TM    DCBDSORG,DCBDSGPO        CHECK FOR BPAM           Y02134 13008402
         BO    VUS03223                 BRANCH IF BPAM           Y02134 13008802
*                                                                Y02134 13010002
VUS03222 EQU   *                        NOT BPAM                 Y02134 13020002
*                                                                Y02134 13030002
         TM    DCBDSORG,DCBDSGDA        TEST IF BDAM           @ZA14612 13032037
         BZ    VUS03224                 BRANCH IF NOT BDAM     @ZA14612 13034037
*                                                              @ZA14612 13036037
         CLI   K0(RCORE),CHAR1          FMT 1 IN WORK AREA     @ZA14612 13036537
         BNE   VUS03224                 BRANCH IF NOT FMT 1    @ZA14612 13037037
*                                                              @ZA14612 13037537
         L     RF,LASTVOL               GO TEST FOR LAST VOLUME@ZA14612 13038037
         BR    RF                       INDICATOR IN DSCB      @ZA14612 13040037
*                                                              @ZA14612 13042037
VUS03224 EQU   *                                               @ZA14612 13044037
*                                                              @ZA14612 13046037
         CLC   JFCBNVOL-INFMJFCB(K1,RET),DXVOLSEQ+K1 MORE VOLS   Y02134 13050002
         BNL   VUS03230                 BRANCH TO FIND VOLUME    Y02134 13100002
*                                                                Y02134 13150002
VUS03223 EQU   *                        BPAM                     Y02134 13160002
*                                                                Y02134 13170002
         XC    DXVOLSEQ,DXVOLSEQ        INITIALIZE TO ZERO       Y02134 13200002
*                                                                Y02134 13250002
         TM    DCBDSORG,DCBDSGIS        ISAM DCB                 Y02134 13300002
         BO    VUS03225                 BR IF YES                Y02134 13350002
*                                                                Y02134 13400002
         TM    DCBDSORG,DCBDSGPO        BPAM DCB                 Y02134 13450002
         BO    VUS03225                 BR IF YES                Y02134 13500002
*                                                                Y02134 13550002
         B     VUS09000                 BRANCH, ALL FINISHED     Y02134 13600002
*                                                                Y02134 13650002
VUS03225 EQU   *                        ISAM DCB                 Y02134 13700002
*                                                                Y02134 13750002
         L     RB,DSABFCHN-DSAB(RB)     LOAD NEXT DSAB PTR       Y02134 13800002
         LTR   RB,RB                    TEST FOR END OF CHAIN    Y02134 13810002
         BZ    VUS09000                 BRANCH, END OF CHAIN     Y02134 13820002
*                                                                Y02134 13830002
         L     RTIOT,DSABTIOT-DSAB(RB)  LOAD TIOT POINTER        Y02134 13850002
         CLC   TIOEDDNM,BLANKS          CHECK FOR CONCATENATION  Y02134 13900002
         BNE   VUS09000                 BR IF NOT, ALL FINISHED  Y02134 13950002
*                                                                Y02134 13952002
         ST    RB,DXDSAB                SAVE CURRENT DSAB PTR   SA66776 13953002
*                                                               SA66776 13953202
         L     RUCB,TIOEFSRT-K1         GET UCB ADDRESS         SA66776 13954002
         LA    RUCB,UCBOB               CLEAR HI BYTE           SA66776 13956002
         LTR   RUCB,RUCB                CHECK FOR UNIT ADDRESS  SA66776 13960002
         LA    R0,K13                   OPEN=013-64 EOV=NA       Y02080 14002002
         BZ    VUS10090                 BRANCH IF DD DUMMY      ZA00142 14006002
*                                                                Y02134 14030002
         TM    UCBTBYT3,UCB3DACC        TEST FOR DA DEVICE      SA66776 14035002
         LA    R0,K15                   OPEN=C13-18 EOV=NA      SA66776 14040002
         BNO   VUS10090                 BRANCH IF NOT DA        SA66776 14045002
*                                                               SA66776 14050002
         TM    DCBDSORG,DCBDSGPO        BPAM DCB                 Y02134 14070002
         BO    VUS03227                 BR IF YES                Y02134 14080002
*                                                                Y02134 14080402
         OI    JFCBMASK+K4,JFCMISAM     ISAM PARALLEL MOUNT SW   Y02134 14080502
         B     VUS03220                 BRANCH, CHECK NEXT JFCB  Y02134 14081202
*                                                                Y02134 14082002
VUS03227 EQU   *                        BPAM DCB                 Y02134 14084002
*                                                                Y02134 14086002
         TM    DXDCBLST,PLISTOP1-PLISTIN  TEST FOR INPUT       @ZA00002 14086402
         LA    R0,K14                   OPEN=C13-10 EOV=NA       YM2899 14086502
         BNZ   VUS10090                 BRANCH IF OUTPUT         YM2899 14086802
*                                                                Y02134 14087202
         OI    JFCBMASK+K4,JFCMBPAM     BPAM CONCATENATION SW ON Y02134 14088002
         B     VUS03220                 BRANCH, CHECK NEXT JFCB  Y02134 14100002
*                                                                Y02134 14150002
VUS03230 EQU   *                        FIND VOLUME              Y02134 14200002
*                                                                Y02134 14250002
         CLC   DXVOLSEQ,ONE             CHECK FOR FIRST VOLUME   Y02134 14260002
         BNH   VUS03235                 BRANCH IF FIRST VOLUME   Y02134 14270002
         OI    JFCBMASK+K4,JFCMISAM     SET PARALLEL MOUNT SW    Y02134 14270402
*                                                                Y02134 14272002
VUS03235 EQU   *                        FIRST VOLUME             Y02134 14280002
*                                                                Y02134 14290002
         CLC   JFCBNVOL-INFMJFCB(K1,RET),JFCBVLSQ-INFMJFCB(RET)  Y02080 14294002
         LA    R0,K4                    OPEN=413-1C EOV=NA       Y02080 14294402
         BL    VUS10090                 BRANCH TO PROB DET       Y02080 14296002
*                                                                Y02134 14298002
         LA    RD,JFCBVOLS-INFMJFCB(RET) LOAD POINTER TO VOLUMES Y02134 14300002
         LA    RET,JFCBEXAD-INFMJFCB(RET) SET UP POINTER FOR EXT Y02134 14350002
*                                                                Y02134 14400002
*****************************************************************Y02134 14450002
*                                                                Y02134 14500002
*        CHECK FOR VOLUME IN MAIN JFCB                           Y02134 14550002
*                                                                Y02134 14600002
*****************************************************************Y02134 14650002
*                                                                Y02134 14700002
         CH    RC,VOL5                  VOL SEQ LESS THAN 5      Y02134 14750002
         BNH   VUS03250                 BRANCH, VOL SER IN MAIN  Y02134 14800002
         SH    RC,VOL5                  DECREMENT FOR INDEXING   Y02134 14850002
*                                                                Y02134 14900002
*****************************************************************Y02134 14950002
*                                                                Y02134 15000002
*        CHECK FOR VOLUME IN JFCB EXTENSION.                     Y02134 15050002
*                                                                Y02134 15100002
*****************************************************************Y02134 15150002
*                                                                Y02134 15200002
VUS03240 EQU   *                                                 Y02134 15250002
*                                                                Y02134 15300002
         CLC   K0(L'JFCBEXAD,RET),ZEROS IS THERE AN EXTENSION    Y02134 15350002
         LA    R0,K5                    OPEN=113-18 EOV=NA       Y02080 15360002
         BZ    VUS10090                 BRANCH IF NO EXTENSION   Y02134 15400002
         IECRES LOCJFCB,(RET)           LOCATE JFCB EXTENSION    Y02134 15450002
         LA    RD,K4(RET)               LOAD POINTER TO VOLUMES  Y02134 15500002
         CH    RC,VOL15                 VOL SEQ LESS THAN 15     Y02134 15550002
         BNH   VUS03250                 BRANCH, VOL SER IN EXT   Y02134 15600002
         SH    RC,VOL15                 DECREMENT FOR INDEXING   Y02134 15650002
         B     VUS03240                 BRANCH TO CHECK NEXT EXT Y02134 15700002
*                                                                Y02134 15750002
*****************************************************************Y02134 15800002
*                                                                Y02134 15850002
*        VOLUME TO BE PARALLEL MOUNTED HAS BEEN FOUND.           Y02134 15900002
*        RC CONTAINS THE POSITION OF THE VOLUMES IN THE LIST.    Y02134 15950002
*        RD POINTS TO THE LIST OF VOLUMES.                       Y02134 16000002
*                                                                Y02134 16050002
*****************************************************************Y02134 16100002
*                                                                Y02134 16150002
VUS03250 EQU   *                        SET UP NEXT VOLUME       YM3822 16200002
*                                                                Y02134 16250002
         BCTR  RC,R0                    DECREMENT FOR INDEXING   Y02134 16300002
         MH    RC,VOL6                  CONVERT SEQ NO TO OFFSET Y02134 16350002
         AR    RD,RC                    ADD OFFSET TO BASE       Y02134 16400002
         MVC   DXVOLSR2,K0(RD)          MOVE VOL N TO WA         Y02134 16450002
*                                                                YM3822 16450202
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         YM3822 16451002
         BO    VUS04200                 BRANCH IF VIO DATA SET   YM3822 16451202
*                                                                YM3822 16451402
         LA    R0,K6                    OPEN=413-18 EOV= NA      Y02080 16452002
         CLC   DXVOLSR2,ZEROS           CHECK FOR ZEROS          Y02134 16460002
         BZ    VUS10090                 BRANCH IF NO VOLUME      Y02134 16470002
         CLC   DXVOLSR2,BLANKS          CHECK FOR BLANKS         Y02134 16480002
         BZ    VUS10090                 BRANCH IF NO VOLUME      YM3822 16490002
         XC    DXVOLSR3,DXVOLSR3        INVALIDATE NEXT VOL SLOT Y02134 16500002
         B     VUS05000                 BRANCH TO SELECT UNIT    Y02134 16550002
         EJECT                                                          16600002
*                                                                Y02134 16650002
VUS03300 EQU   *                        FIND VOLUMES             Y02134 16700002
*                                                                Y02134 16750002
*****************************************************************Y02134 16800002
*                                                                Y02134 16850002
*        SEARCH FOR THE CURRENT AND NEXT VOLUME TO BE MOUNTED.   Y02134 16900002
*        (N & N+1) N IS THE NUMBER SPECIFIED BY DXVOLSEQ.        Y02134 16950002
*                                                                Y02134 17000002
*****************************************************************Y02134 17050002
*                                                                Y02134 17100002
         LH    RC,DXVOLSEQ              LOAD VOLUME SEQUENCE NO. Y02134 17150002
         LA    RD,JFCBVOLS              LOAD POINTER TO VOLUMES  Y02134 17200002
         LA    RET,JFCBEXAD             SET UP POINTER FOR EXT   Y02134 17250002
*                                                                Y02134 17300002
         TM    DXDCBLST,PLISTM03        CHECK FOR RDBACK         Y02134 17350002
         BNM   VUS03320                 BRANCH IF NOT RDBACK     Y02134 17400002
*                                                                Y02134 17450002
*****************************************************************Y02134 17500002
*                                                                Y02134 17550002
*        SEARCH FOR THE N+1 VOLUME FIRST.                        Y02134 17600002
*        FOR RDBACK N+1 IS REALLY VOLUME N-1.                    Y02134 17650002
*                                                                Y02134 17700002
*****************************************************************Y02134 17750002
*                                                                Y02134 17800002
         CH    RC,ONE                   CHECK FOR ONLY 1 VOLUME  Y02134 17850002
         BE    VUS03360                 BRANCH TO GET CURRENT    Y02134 17900002
         BCTR  RC,R0                    IT'S NEVER NEGATIVE      Y02134 17950002
*                                                                Y02134 18000002
*****************************************************************Y02134 18050002
*                                                                Y02134 18100002
*        CHECK FOR VOLUME IN MAIN JFCB                           Y02134 18150002
*                                                                Y02134 18200002
*****************************************************************Y02134 18250002
*                                                                Y02134 18300002
VUS03320 EQU   *                                                 Y02134 18350002
*                                                                Y02134 18400002
         CH    RC,VOL5                  VOL SEQ LESS THAN 5      Y02134 18450002
         BL    VUS03340                 BRANCH, IF BOTH IN MAIN  Y02134 18500002
         BE    VUS03350                 BRANCH IF 1ST IN MAIN    Y02134 18550002
         SH    RC,VOL5                  DECREMENT FOR INDEXING   Y02134 18600002
*                                                                Y02134 18650002
*****************************************************************Y02134 18700002
*                                                                Y02134 18750002
*        CHECK FOR VOLUME IN JFCB EXTENSION.                     Y02134 18800002
*                                                                Y02134 18850002
*****************************************************************Y02134 18900002
*                                                                Y02134 18950002
VUS03330 EQU   *                                                 Y02134 19000002
*                                                                Y02134 19050002
         CLC   K0(L'JFCBEXAD,RET),ZEROS IS THERE AN EXTENSION    Y02134 19100002
         LA    R0,K9                    OPEN=113-08 EOV=837-08   Y02080 19110002
         BZ    VUS10085                 BRANCH IF NO EXTENSION   YM6514 19150002
         IECRES LOCJFCB,(RET)           LOCATE JFCB EXTENSION    Y02134 19200002
         LA    RD,K4(RET)               LOAD POINTER TO VOLUMES  Y02134 19250002
         CH    RC,VOL15                 VOL SEQ LESS THAN 15     Y02134 19300002
         BL    VUS03340                 BRANCH, BOTH VOLS IN EXT Y02134 19350002
         BE    VUS03350                 BRANCH IF 1ST IN MAIN    Y02134 19400002
         SH    RC,VOL15                 DECREMENT FOR INDEXING   Y02134 19450002
         B     VUS03330                 BRANCH TO CHECK NEXT EXT Y02134 19500002
*                                                                Y02134 19550002
*****************************************************************Y02134 19600002
*                                                                Y02134 19650002
*        VOLUME N & N+1 HAVE BEEN LOCATED IN THE SAME EXTENSION. Y02134 19700002
*        RC CONTAINS THE POSITION OF THE VOLUMES IN THE LIST.    Y02134 19750002
*        RD POINTS TO THE LIST OF VOLUMES.                       Y02134 19800002
*        RE POINTS TO THE ADDRESS OF THE NEXT EXTENSION.         Y02134 19850002
*                                                                Y02134 19900002
*****************************************************************Y02134 19950002
*                                                                Y02134 20000002
VUS03340 EQU   *                                                 Y02134 20050002
*                                                                Y02134 20100002
         BCTR  RC,R0                    DECREMENT FOR INDEXING   Y02134 20150002
         MH    RC,VOL6                  CONVERT SEQ NO TO OFFSET Y02134 20200002
         AR    RD,RC                    ADD OFFSET TO BASE       Y02134 20250002
         MVC   DXVOLSR2,K0(RD)          MOVE VOL N TO WA         Y02134 20300002
         AH    RD,VOL6                  ADD VOLUME SERIAL LENGTH Y02134 20350002
         B     VUS03360                 BRANCH TO GET VOLUME N+1 Y02134 20400002
*                                                                Y02134 20450002
*****************************************************************Y02134 20500002
*                                                                Y02134 20550002
*        VOLUME N & N+1 HAVE BEEN LOCATED. VOLUME N IS IN        Y02134 20600002
*        THE LIST POINTED TO BY RD. VOLUME N+1 IS THE FIRST      Y02134 20650002
*        VOLUME IN THE EXTENSION POINTED BY RE.                  Y02134 20700002
*        RC CONTAINS THE POSITION OF VOLUME N IN THE LIST.       Y02134 20750002
*        RD POINTS TO THE LIST OF VOLUMES.                       Y02134 20800002
*        RE POINTS TO THE ADDRESS OF THE NEXT EXTENSION.         Y02134 20850002
*                                                                Y02134 20900002
*****************************************************************Y02134 20950002
*                                                                Y02134 21000002
VUS03350 EQU   *                                                 Y02134 21050002
*                                                                Y02134 21100002
         BCTR  RC,R0                    DECREMENT FOR INDEXING   Y02134 21150002
         MH    RC,VOL6                  CONVERT SEQ NO TO OFFSET Y02134 21200002
         AR    RD,RC                    ADD OFFSET TO BASE       Y02134 21250002
         MVC   DXVOLSR2,K0(RD)          MOVE VOL N TO WA         Y02134 21300002
         CLC   K0(L'JFCBEXAD,RET),ZEROS IS THERE AN EXTENSION    Y02134 21350002
         BZ    VUS03370                 BRANCH IF NO EXTENSION   Y02134 21400002
         IECRES LOCJFCB,(RET)           LOCATE JFCB EXTENSION    Y02134 21450002
         LA    RD,K4(RET)               LOAD POINTER TO VOLUMES  Y02134 21500002
*                                                                Y02134 21550002
*****************************************************************Y02134 21600002
*                                                                Y02134 21650002
*        VOLUME N+1 IS POINTED TO BY RD.                         Y02134 21700002
*                                                                Y02134 21750002
*****************************************************************Y02134 21800002
*                                                                Y02134 21850002
VUS03360 EQU   *                                                 Y02134 21900002
*                                                                Y02134 21950002
         MVC   DXVOLSR3,K0(RD)          MOVE VOL N+1 TO WA       Y02134 22000002
*                                                                Y02134 22050002
VUS03370 EQU   *                        NO EXTENSIONS            Y02134 22100002
*                                                                Y02134 22150002
*****************************************************************Y02134 22200002
*                                                                Y02134 22250002
*        SWAP VOLUME N WITH N+1 IF RDBACK                        Y02134 22300002
*                                                                Y02134 22350002
*****************************************************************Y02134 22400002
*                                                                Y02134 22450002
         TM    DXDCBLST,PLISTM03        CHECK FOR RDBACK         Y02134 22500002
         BNM   VUS03380                 BRANCH IF NOT RDBACK     Y02134 22550002
*                                                                Y02134 22600002
         XC    DXVOLSR2,DXVOLSR3        SWAP VOLUME SERIAL NO.S  Y02134 22650002
         XC    DXVOLSR3,DXVOLSR2        IF RDBACK, N=N+1 & N+1=N Y02134 22700002
         XC    DXVOLSR2,DXVOLSR3        VOLUMES ARE NOW SWAPPED  Y02134 22750002
*                                                                Y02134 22800002
VUS03380 EQU   *                        NOT RDBACK               Y02134 22850002
*                                                                Y02134 22900002
*****************************************************************Y02134 22950002
*                                                                Y02134 23000002
*        VALIDITY CHECK VOLUME N+1                               Y02134 23050002
*                                                                Y02134 23100002
*****************************************************************Y02134 23150002
*                                                                Y02134 23200002
         CLC   JFCBNVOL,DXVOLSEQ+K1     VOL N+1 AVAILABLE        Y02134 23250002
         BH    VUS03390                 BRANCH IF N+1 IS REAL    Y02134 23300002
*                                                                Y02134 23350002
         MVC   DXVOLSR3,ZEROS           INVALIDATE VOL N+1       Y02134 23400002
*                                                                Y02134 23450002
         CLC   JFCBVLCT,DXVOLSEQ+K1     VOL N+1 REQUESTED        Y02134 23500002
         BNH   VUS03390                 BRANCH, BYPASS N+1 MOUNT Y02134 23550002
*                                                                Y02134 23600002
         TM    DXDCBLST,PLISTOIN        OUTPUT OR OUTIN          Y02134 23650002
         BNO   VUS03390                 BRANCH IF NEITHER        Y02134 23700002
*                                                                Y02134 23750002
         MVC   DXVOLSR3,SCRTCH          MAKE VOL N+1 IS SCRATCH  Y02134 23800002
*                                                                Y02134 23850002
VUS03390 EQU   *                        NEITHER OUTPUT NOR OUTIN Y02134 23900002
*                                                                Y02134 23950002
         CLC   DXVOLSR3,BLANKS          CHECK FOR BLANKS         Y02134 24000002
         BNE   VUS03400                 BRANCH IF NOT BLANKS     Y02134 24050002
*                                                                Y02134 24100002
         MVC   DXVOLSR3,ZEROS           INVALIDATE VOL N+1       Y02134 24150002
*                                                                Y02134 24200002
VUS03400 EQU   *                        NOT BLANK                Y02134 24250002
*                                                                Y02134 24300002
*****************************************************************Y02134 24350002
*                                                                Y02134 24400002
*        VALIDITY CHECK VOLUME N                                 Y02134 24450002
*                                                                Y02134 24500002
*****************************************************************Y02134 24550002
*                                                                Y02134 24600002
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         YM3822 24605002
         BO    VUS04200                 BRANCH IF VIO DATA SET   YM3822 24610002
*                                                                YM3822 24615002
         CLC   DXVOLSR2,ZEROS           CHECK FOR ZEROS          Y02134 24650002
         BZ    VUS04100                 ASSUME SCRTCH            Y02134 24700002
*                                                                Y02134 24750002
         CLC   DXVOLSR2,BLANKS          CHECK FOR BLANKS         Y02134 24800002
         BE    VUS04100                 ASSUME SCRTCH            Y02134 24850002
*                                                                Y02134 24900002
         TM    UCBTBYT3,UCB3DACC        TEST FOR DIRECT ACCESS   Y02134 24950002
         BO    VUS05000                 ASSUME SPECIFIC REQUEST  Y02134 25000002
*                                                                Y02134 25050002
         CLI   DXVOLSR2,VIRTUAL         CHECK FOR VIRTUAL VOLUME Y02134 25100002
         BNE   VUS05000                 ASSUME SPECIFIC REQUSET  Y02134 25150002
*                                                                Y02134 25200002
         CLI   JFCBVOLS,VIRTUAL         CHECK FOR FIRST VOLUME   Y02134 25250002
         BNE   VUS04100                 JFCB IS OUT OF ORDER     Y02134 25300002
*                                                                Y02134 25350002
         CLC   DXVOLSR2+K1(K3),BLANKS   CHECK FOR VIRTUAL SCRTCH Y02134 25400002
         BE    VUS04000                 BRANCH, SCRTCH REQUEST  SA54607 25450002
*                                                                Y02134 25460002
         CLC   DXVOLSR2+K1(K3),ZEROS    CHECK FOR VIRTUAL SCRTCH Y02134 25470002
         BE    VUS04000                 BRANCH, SCRTCH REQUEST  SA54607 25480002
*                                                                Y02134 25500002
         CLC   DXVOLSR2+K1(K3),TIOEJFCB CHECK FOR VIRTUAL SCRTCH Y02134 25550002
         BE    VUS04000                 BRANCH IF SCRTCH REQUEST Y02134 25600002
         B     VUS03430                 BRANCH, PROCESS VOL=REF  Y02134 25650002
         EJECT                                                          25700002
*                                                                Y02134 26800002
*****************************************************************Y02134 26850002
*                                                                Y02134 26900002
*        VOL=REF=DDNAME WAS SPECIFIED.                           Y02134 26950002
*        GET LAST VOLUME IN REFERENCED JFCB.                     Y02134 27000002
*                                                                Y02134 27050002
*****************************************************************Y02134 27100002
*                                                                Y02134 27150002
VUS03430 EQU   *                                                 Y02134 27200002
*                                                                Y02134 27250002
         LA    RET,INFMJFCB             LOAD POINTER TO JFCB     Y02134 27300002
*                                                                Y02134 27350002
VUS03440 EQU   *                        BOTH VOLS IN EXTENSION   Y02134 27400002
*                                                                Y02134 27450002
         LR    RD,RET                   SAVE LAST JFCB POINTER   Y02134 27650002
         LA    RET,JFCBVOLS-INFMJFCB+K1(RET) POINT TO REF JFCB   Y02134 27660002
*                                                                Y02134 27700002
         IECRES LOCJFCB,(RET)           LOCATE JFCB              Y02134 27750002
*                                                                Y02134 27800002
         CLI   JFCBVOLS-INFMJFCB(RET),VIRTUAL VOL=REF SER NO.    Y02134 27850002
         BE    VUS03445                 BRANCH, CHECK IF VOL=REF Y02134 27900002
*                                                                Y02134 27902002
         CLC   JFCBVOLS-INFMJFCB(K6,RET),ZEROS CHECK FOR SCRTCH  Y02080 27902402
         BE    VUS03450                 BRANCH TO ASSUME SCRTCH  Y02134 27902802
*                                                                Y02134 27903202
         CLC   JFCBVOLS-INFMJFCB(K6,RET),BLANKS CHECK FOR SCRTCH Y02080 27903602
         BE    VUS03450                 BRANCH TO ASSUME SCRTCH  Y02134 27903702
*                                                                Y02134 27904002
         CLI   JFCBNVOL-INFMJFCB(RET),K0 CHECK IF SPECIFIED      Y02080 27910002
         BNE   VUS03460                 BRANCH TO FIND LAST VOL  Y02080 27920002
         B     VUS03450                 BRANCH TO ASSUME SCRTCH  Y02134 27930002
*                                                                Y02134 27950002
VUS03445 EQU   *                        CHECK IF VOL = REF       Y02134 27960002
*                                                                Y02134 27970002
         CLC   JFCBVOLS-INFMJFCB+K1(K3,RET),BLANKS GDG SCRTCH    Y02134 28000002
         BE    VUS03450                 BRANCH IF SCRTCH REQUEST Y02134 28050002
*                                                                Y02134 28100002
         CLC   JFCBVOLS-INFMJFCB+K1(L'JFCBEXAD,RET),ZEROS        Y02134 28110002
         BZ    VUS03450                 BRANCH IF NO JFCB        Y02134 28120002
*                                                                Y02134 28130002
         CLC   JFCBVOLS-INFMJFCB(K4,RET),JFCBVOLS-INFMJFCB(RD)   Y02134 28150002
         BE    VUS03450                 BRANCH IF SCRTCH REQUEST Y02134 28200002
         B     VUS03440                 BRANCH, GET NEXT JFCB    Y02134 28250002
*                                                                Y02134 28300002
VUS03450 EQU   *                        ASSUME SCRTCH            Y02134 28350002
*                                                                Y02134 28400002
*****************************************************************Y02134 28450002
*                                                                Y02134 28500002
*        VOL=REF WAS SPECIFIED TO A DATA SET WHICH ALSO HAS      Y02134 28550002
*        NON-SPECIFIC VOLUMES. THIS MEANS THAT THE DATA SETS     Y02134 28600002
*        ARE BEING OPENED IN AN ORDER DIFFERENT THAN WAS         Y02134 28650002
*        SPECIFIED ON THE JCL. THE ENTRIES WILL BE RECHAINED     Y02134 28700002
*        IN THE ORDER OPENED.                                    Y02134 28750002
*                                                                Y02134 28800002
*****************************************************************Y02134 28850002
*                                                                Y02134 28900002
         TM    DXDCBLST,PLISTOIN        OUTPUT OR OUTIN          Y02134 28950002
         LA    R0,K7                    OPEN=413-18 EOV=837-08   Y02134 28960002
         BNO   VUS10085                 BRANCH IF NEITHER        YM6514 29000002
*                                                                Y02134 29090002
*****************************************************************Y02134 29100002
*                                                                Y02134 29150002
*        READ IN THE REFERENCED JFCB AND UPDATE THE SERIAL NO.   Y02134 29200002
*                                                                Y02134 29250002
*****************************************************************Y02134 29300002
*                                                                Y02134 29350002
         IECRES GET,LV=JFCBLGTH,ID=JFCB,                         Y02134X29400002
               PREFIX=YES,STM=(2,14,WTGPREFX)                    Y02134 29450002
*                                                                Y02134 29500002
         MVC   K0(JFCBLGTH,R1),K0(RET)  MOVE IN REFERENCED JFCB  Y02134 29550002
         LR    RET,R1                   LOAD JFCB PTR            Y02134 29600002
         MVC   DXVOLSR2,JFCBVOLS-INFMJFCB(RET) NEW VOL SER TO WA Y02134 29700002
*                                                                Y02134 29750002
*****************************************************************Y02134 29800002
*                                                                Y02134 29850002
*        CHANGE REFERENCED JFCB TO POINT TO THE CURRENT JFCB.    Y02134 29900002
*                                                                Y02134 29950002
*****************************************************************Y02134 30000002
*                                                                Y02134 30050002
         MVC   JFCBVOLS-INFMJFCB+K1(K3,RET),TIOEJFCB             Y02134 30100002
*                                                                Y02134 30900002
*****************************************************************Y02134 30950002
*                                                                Y02134 31000002
*        WRITE THE JFCB BACK.                                    Y02134 31050002
*                                                                Y02134 31100002
*****************************************************************Y02134 31150002
*                                                                Y02134 31200002
         LA    R1,JFCBVOLS-INFMJFCB+K1(RD) POINT TO REF JFCB PTR Y02134 31210002
*                                                                Y02134 31220002
         IECRES WRJFCB,(R1),(RET)       WRITE JFCB BACK          Y02134 31250002
*                                                                Y02134 31300002
         IECRES FREE,A=(RET),PREFIX=YES,STM=(0,14,WTGPREFX)      Y02134 31350002
*                                                                Y02134 31400002
         B     VUS04000                 BRANCH TO ASSUME SCRTCH  Y02134 31450002
*                                                                Y02134 31500002
*****************************************************************Y02134 31650002
*                                                                Y02134 31700002
*        FIND LAST VOLUME IN REFERENCED JFCB                     Y02134 31750002
*                                                                Y02134 31800002
*****************************************************************Y02134 31850002
*                                                                Y02134 31900002
VUS03460 EQU   *                                                 Y02134 31910002
*                                                                Y02134 31920002
         XR    RC,RC                    CLEAR FOR IC INST        Y02134 31950002
         IC    RC,JFCBNVOL-INFMJFCB(RET) GET NUMBER OF VOLUMES   Y02134 32000002
         LA    RD,JFCBVOLS-INFMJFCB(RET) LOAD POINTER TO VOLUMES Y02134 32050002
         LA    RET,JFCBEXAD-INFMJFCB(RET) SET UP POINTER FOR EXT Y02134 32100002
*                                                                Y02134 32150002
*****************************************************************Y02134 32200002
*                                                                Y02134 32250002
*        CHECK FOR VOLUME IN MAIN JFCB                           Y02134 32300002
*                                                                Y02134 32350002
*****************************************************************Y02134 32400002
*                                                                Y02134 32450002
         CH    RC,VOL5                  VOL SEQ LESS THAN 5      Y02134 32500002
         BNH   VUS03480                 BRANCH, VOL SER IN MAIN  Y02134 32550002
         SH    RC,VOL5                  DECREMENT FOR INDEXING   Y02134 32600002
*                                                                Y02134 32650002
*****************************************************************Y02134 32700002
*                                                                Y02134 32750002
*        CHECK FOR VOLUME IN JFCB EXTENSION.                     Y02134 32800002
*                                                                Y02134 32850002
*****************************************************************Y02134 32900002
*                                                                Y02134 32950002
VUS03470 EQU   *                                                 Y02134 33000002
*                                                                Y02134 33050002
         CLC   K0(L'JFCBEXAD,RET),ZEROS IS THERE AN EXTENSION    Y02134 33100002
         LA    R0,K9                    OPEN=113-08 EOV=837-08   Y02080 33110002
         BZ    VUS10090                 BRANCH IF NO EXTENSION   Y02134 33150002
         IECRES LOCJFCB,(RET)           LOCATE JFCB EXTENSION    Y02134 33200002
         LA    RD,K4(RET)               LOAD POINTER TO VOLUMES  Y02134 33250002
         CH    RC,VOL15                 VOL SEQ LESS THAN 15     Y02134 33300002
         BNH   VUS03480                 BRANCH, VOL SER IN EXT   Y02134 33350002
         SH    RC,VOL15                 DECREMENT FOR INDEXING   Y02134 33400002
         B     VUS03470                 BRANCH TO CHECK NEXT EXT Y02134 33450002
*                                                                Y02134 33500002
*****************************************************************Y02134 33550002
*                                                                Y02134 33600002
*        REFERENCED VOLUME HAS BEEN FOUND.                       Y02134 33650002
*        RC CONTAINS THE POSITION OF THE VOLUMES IN THE LIST.    Y02134 33700002
*        RD POINTS TO THE LIST OF VOLUMES.                       Y02134 33750002
*                                                                Y02134 33800002
*****************************************************************Y02134 33850002
*                                                                Y02134 33900002
VUS03480 EQU   *                                                 Y02134 33950002
*                                                                Y02134 34000002
         BCTR  RC,R0                    DECREMENT FOR INDEXING   Y02134 34050002
         MH    RC,VOL6                  CONVERT SEQ NO TO OFFSET Y02134 34100002
         AR    RD,RC                    ADD OFFSET TO BASE       Y02134 34150002
         MVC   DXVOLSR2,K0(RD)          MOVE VOL N TO WA         Y02134 34200002
         MVC   JFCBVOLS(L'DXVOLSR2),DXVOLSR2 MOVE VOLUME TO JFCB Y02134 34250002
*                                                                YM5928 34260002
         OI    JFCBTSDM,JFCVSL          SET VOL SER LIST MODIF-  A45617 34270002
*                                       IED SO SCHEDULER WILL    A45617 34280002
*                                       RECATALOG WITH NEW VOL   A45617 34290002
*                                                                YM5928 34292002
         OI    JFCBMASK+K4,X80          INDICATE JFCB MODIFIED   Y02134 34300002
*                                                              @Y30LSFY 34302003
         XC    JFCVINDX(K2),JFCVINDX    CLEAR VVIC INDICATORS  @Y30LSFY 34304003
*                                                              @Y30LSFY 34306003
*                                                                YM5928 34310002
         LA    R1,TIOEJFCB              POINT TO MAIN JFCB       YM5928 34320002
         LA    RET,DXJBF                POINT TO WORK AREA JFCB  YM5928 34330002
*                                                                YM5928 34340002
         IECRES WRJFCB,(R1),(RET)       WRITE JFCB BACK          YM5928 34342002
*                                                                YM5928 34344002
         B     VUS05000                 BRANCH TO SELECT UNIT    Y02134 34350002
*                                                                Y02134 34400002
*****************************************************************Y02134 34450002
*                                                                Y02134 34500002
*        VOLUME WAS NON-SPECIFIC. INDICATE SCRTCH.               Y02134 34550002
*                                                                Y02134 34600002
*****************************************************************Y02134 34650002
*                                                                Y02134 34700002
VUS04000 EQU   *                                                 Y02134 34750002
*                                                                Y02134 34800002
         MVC   JFCBVOLS(K6),BLANKS      MOVE BLANKS TO JFCB      Y02134 34850002
*                                                                Y02134 34900002
VUS04100 EQU   *                        SCRATCH REQUESTED        YM3822 34950002
*                                                                Y02134 35000002
         TM    DXDCBLST,PLISTOIN        OUTPUT OR OUTIN          Y02134 35050002
         LA    R0,K7                    OPEN=413-18 EOV=837-08   Y02080 35060002
         BNO   VUS10085                 BRANCH IF NEITHER        YM6514 35100002
*                                                                YM5928 35150002
         MVC   DXVOLSR2,SCRTCH          INDICATE SCRTCH REQUEST  Y02134 35200002
*                                                               SA54607 35202002
         CLC   DXVOLSEQ,ONE             CHECK FOR FIRST VOLUME  SA54607 35204002
         BNE   VUS05000                 BRANCH, BYPASS NEW-MOD  SA54607 35206002
         TM    JFCBIND2,JFCOLD          IS DISP EQUAL 'MOD'-    SA50304 35208002
         BO    VUS05000                 BR IF NOT- CONTINUE     SA54607 35210002
*                                                               SA54607 35212002
         OI    JFCBIND2,JFCNEW          CHANGE 'MOD' TO 'NEW'   SA50304 35214002
         OI    JFCBFLG2,JFCMODNW        INDICATE THAT 'MOD' WAS SA50304 35216002
*                                       CHANGED TO 'NEW'        SA50304 35218002
         B     VUS05000                 BRANCH TO GET UNIT       YM3822 35218202
*                                                                YM3822 35219002
VUS04200 EQU   *                        VIO DATA SET             YM3822 35223002
*                                                                YM3822 35228002
         CLC   DXVOLSEQ,ONE             CHECK FOR VOLUME 1       YM3855 35230002
         LA    R0,K10                   OPEN=413-04 EOV=B37-04   YM3855 35230202
         BNE   VUS10070                 BRANCH IF NOT ONE VOLUME YM3855 35231002
*                                                                YM3855 35232002
         MVC   DXVOLSR2,VUSVIO          SET UP VIO VOLSER        YM3822 35233002
         XC    DXVOLSR3,DXVOLSR3        CLEAR LOOK-AHEAD         YM3822 35238002
         EJECT                                                          35250002
*                                                                Y02134 35300002
VUS05000 EQU   *                        VOLUME DISPOSITION       Y02134 35350002
         TM    JFCBLTYP,JFCBLP          TEST FOR BLP           @ZA15095 35358037
         L     RF,SETMODE               EPA OF SETMODE RTN     @ZA15095 35366037
         BOR   RF                       BRANCH TO CLEAR        @ZA15095 35376037
*                                       VOLUME SERIAL          @ZA15095 35386037
*                                                                Y02134 35400002
*****************************************************************Y02134 35450002
*                                                                Y02134 35500002
*        UNIT SELECTION                                          Y02134 35550002
*                                                                Y02134 35600002
*****************************************************************Y02134 35650002
*                                                                Y02134 35700002
VUS05005 XC    DXUCBADR(K2),DXUCBADR    CLEAR HI TWO BYTES     @ZA15095 35799737
         L     RUCB,DXUCBADR            LOAD CURRENT UCB ADDRESS Y02134 35800002
*                                                                YM7516 35802002
         TM    UCBTBYT3,UCB3DACC        TEST FOR DA UNIT         YM7516 35810002
         BO    VUS05010                 BRANCH IF DIRECT ACCESS  YM7516 35820002
*                                                                Y02134 35836002
*****************************************************************Y02134 35839002
*                                                                Y02134 35842002
*        FINISH POSITIONING VOL N-1                              YM7516 35845002
*                                                                Y02134 35848002
*****************************************************************Y02134 35851002
*                                                                Y02134 35854002
         NC    DXVOLSR1,DXVOLSR1        TEST FOR VOL SPECIFIED   Y02134 35857002
         BZ    VUS05010                 BRANCH IF NO VOLUME      Y02134 35860002
         CLC   UCBVOLI,DXVOLSR1         VOLUME ON DEVICE         Y02134 35870002
         BNE   VUS05010                 BYPASS IF VOL NOT ON DEV YM7516 35880002
*                                                                Y02134 35890102
*****************************************************************Y02134 35895302
*                                                                Y02134 35896002
*        GO TO FINISH POSITIONING                                YM7516 35896702
*                                                                Y02134 35897002
*****************************************************************Y02134 35898702
*                                                                Y02134 35900402
         MVC   DXRETMOD,ID4A4A          RETURN ID TO SAVE AREA   Y02134 35930002
         MVI   DXRETCOD,K8              SET RETURN INDICATOR     Y02134 36030002
*                                                                Y02134 36050002
         IECRES LOAD,MODID=ID4A4J,BRCODE=K0,BRANCH=QUEUED        Y02134 36100002
*                                                                Y02134 36110002
*****************************************************************Y02134 36120002
*                                                                Y02134 36130002
*        RETURN HERE FROM POSITIONING                            YM7516 36140002
*        OR                                                      Y02134 36140402
*        MOUNT AND VERIFY VOLUME SPECIFIED BY DXVOLSR2           Y02134 36140802
*                                                                Y02134 36141202
*****************************************************************Y02134 36144002
*                                                                Y02134 36146002
VUS05010 EQU   *                                                 Y02134 36148002
*                                                                Y02134 36150002
         MVI   DXRETCOD,K0              SET REJECT OFF           YM1157 36150102
*                                                                YM1157 36150502
VUS05020 EQU   *                        ENTRY FROM REJECT        YM1157 36151002
*                                                                YM1157 36151502
         NC    DXVOLSR2,DXVOLSR2        CHECK IF VOL N SPECIFIED Y02134 50210002
         BZ    VUS09100                 BRANCH IF NONE SPECIFIED Y02134 50230002
*                                                                Y02134 50240002
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX   Y02134 50250002
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134 50300002
*                                                                Y02134 50370002
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02082 50380002
*                                                                Y02134 50390002
VUS05110 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02134X50400002
               RELATED=(LOCAL,IFG0194A(VUS05430))                Y02134 50450002
*                                                                Y02134 50460002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 50470002
*                                                                Y02134 50500002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 50550002
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134 50600002
         BNZ   VUS10000                 BRANCH IF ERROR          Y02134 50650002
*                                                                Y02134 50700002
*****************************************************************Y02134 50750002
*                                                                Y02134 50800002
*        FIND NUMBER OF UNITS                                    Y02134 50850002
*                                                                Y02134 50900002
*****************************************************************Y02134 50950002
*                                                                Y02134 51000002
         XR    RB,RB                    CLEAR REG FOR IC INST    Y02134 51050002
         IC    RB,TIOELNGH              GET TIOT ENTRY LENGTH    Y02134 51100002
         LA    RF,TIOEFSRT-K1-TIOENTRY  GET LENGTH TO UCBS       Y02134 51150002
         SR    RB,RF                    GET LENGTH OF UCB LIST   Y02134 51200002
         SRL   RB,K2                    DIVIDE BY FOUR           Y02134 51250002
         STH   RB,DXNOUNIT              SAVE NUMBER OF UNITS     Y02134 51300002
*                                                                Y02134 51350002
*****************************************************************Y02134 51400002
*                                                                Y02134 51450002
*        FIND UNIT TO PROCESS DXVOLSR2                           Y02134 51500002
*                                                                Y02134 51550002
*****************************************************************Y02134 51600002
*                                                                Y02134 51650002
         XR    RC,RC                    SET OFFSET TO ZERO       Y02134 51700002
*                                                                Y02134 51800002
VUS05120 EQU   *                                                 Y02134 51850002
*                                                                Y02134 51900002
         BAL   RET,VUS07000             BRANCH TO GET NEXT UNIT  Y02134 51950002
         CLM   RUCB,K7,DXUCBADR+K1      VERIFY UCB ADDRESS     @ZA19129 52000037
         BE    VUS05130                 BRANCH IF OFFSET FOUND   Y02134 52050002
         BCT   RB,VUS05120              LOOP IF MORE UCBS        Y02134 52100002
*                                                                Y02134 52150002
*****************************************************************Y02134 52200002
*                                                                Y02134 52250002
*        IF THE UNIT IS NOT WITHIN THE TIOT ENTRY, IT MUST BE    Y02134 52300002
*        IN THE PREVIOUS CONCATENATED ENTRY. GET FIRST UNIT.     Y02134 52350002
*                                                                Y02134 52400002
*****************************************************************Y02134 52450002
*                                                                Y02134 52500002
         XR    RC,RC                    SET TO ZERO TO GET FIRST Y02134 52550002
*                                                                Y02134 52600002
*****************************************************************Y02134 52650002
*                                                                Y02134 52700002
*        UNIT HAS BEEN LOCATED. IF PREVIOUS DISMOUNT             Y02134 52750002
*        OCCURRED, GET NEXT UNIT.                                Y02134 52800002
*                                                                Y02134 52850002
*****************************************************************Y02134 52900002
*                                                                Y02134 52950002
VUS05130 EQU   *                                                 Y02134 53000002
*                                                                Y02134 53050002
         NC    DXVOLSR1,DXVOLSR1        TEST FOR PREVIOUS VOLUME Y02134 53060002
         BZ    VUS05140                 BRANCH IF NONE           Y02134 53070002
         BAL   RET,VUS07000             GET NEXT UNIT            Y02134 53200002
*                                                                Y02134 53250002
VUS05140 EQU   *                        NO PREVIOUS VOLUME       Y02134 53300002
*                                                                Y02134 53350002
         LTR   RC,RC                    PREVIOUS CONCATENATION   Y02134 53400002
         BNZ   VUS05150                 BRANCH IF UNIT FOUND     Y02134 53450002
         BAL   RET,VUS07000             LINK TO GET FIRST UNIT   Y02134 53500002
*                                                                Y02134 53550002
VUS05150 EQU   *                        UNIT FOUND               Y02134 53600002
*                                                                Y02134 53650002
         NC    DXVOLSR1,DXVOLSR1        TEST FOR PREVIOUS VOLUME Y02134 53650402
         BZ    VUS05160                 BRANCH IF NONE           Y02134 53650802
         CLC   UCBVOLI,DXVOLSR1         TEST FOR PREVIOUS VOLUME Y02134 53652002
         BNE   VUS05160                 BRANCH NOT PREVIOUS      Y02134 53654002
         BAL   RET,VUS07000             GET NEXT UNIT            Y02134 53654402
*                                                                Y02134 53656002
*****************************************************************Y02134 53660002
*                                                                Y02134 53670002
*        LOCATE COMPATIBLE UNIT FOR VOLUME SPECIFIED.            Y02134 53680002
*                                                                Y02134 53690002
*****************************************************************Y02134 53692002
*                                                                Y02134 53694002
VUS05160 EQU   *                                                 Y02134 53696002
*                                                                Y02134 53698002
         STH   RC,DXUNITOF              SAVE CURRENT OFFSET      Y02134 53700002
         ST    RUCB,DXUCBADR            SAVE CURRENT UCB ADDRESS Y02134 53750002
         LH    RB,DXNOUNIT              GET NUMBER OF UNITS      Y02134 53760002
         LA    R1,DXVOLSR2              POINTER TO VOLUME N      Y02134 53770002
         L     RD,WTGPREFX              POINTER TO PREFIX        Y02134 53780002
         LA    RD,IECREGSV-IECPREFX(,RD) POINTER TO SAVE AREA    Y02134 53792002
         BAL   RET,VUS08000             LINK TO GET UNIT         Y02134 53794002
*                                                                YM1472 53796002
         LA    R0,K12(R0,R0)            NO UNITS AVAIL. CODE     YM7503 53798002
         MVI   DXRETCOD,K10             OPEN=413-04 EOV=B37-04   YM1472 53798402
         CR    RF,R0                    CHECK FOR NO UNITS AVAIL.YM1472 53800002
         BE    VUS05425                 BRANCH IF NO UNITS       YM1472 53802002
*                                                                YM1472 53802402
         ST    RUCB,DXUCBADR            SAVE CURRENT UCB ADDRESS Y02134 53804002
         STH   RC,DXUNITOF              SAVE TIOT ENTRY OFFSET   Y02134 53814002
*                                                                Y02134 58500002
*****************************************************************Y02134 58550002
*                                                                Y02134 58600002
*        VOLUME AND UNIT HAVE BEEN FOUND.                        Y02134 58650002
*        INCREMENT DATA MANAGEMENT COUNT TO TIE UP UNIT          Y02134 60150002
*        WHILE MOUNT/VERIFY IN PROGRESS.                         Y02134 60160002
*                                                                Y02134 60200002
*****************************************************************Y02134 60250002
*                                                                Y02134 60260002
VUS05400 EQU   *                                                 Y02134 60262002
*                                                                Y02134 60264002
         LA    RF,K1                    LOAD INCREMENT VALUE     Y02134 60270002
*        SHIFT INCREMENT TO USE WITH CS INSTRUCTION              Y02134 60272002
         SLL   RF,K24-(K8*((UCBDMCT-UCBOB)-(((UCBDMCT-UCBOB)/K4)*K4)))  60280002
         L     R0,UCBOB+(((UCBDMCT-UCBOB)/K4)*K4) ALLIGN & LOAD  Y02134 60292002
*                                                                Y02134 60292402
VUS05410 EQU   *                        LOOP TO DECREMENT        Y02134 60300402
*                                                                Y02134 60300802
         LR    RET,R0                   SAVE CONTENTS OF CS OPER Y02134 60341602
         SLL   RET,K25                  LEAVE ONLY UCBDMCT COUNT Y02134 60342002
         SRL   RET,K25                  SHIFT COUNT FOR TEST     Y02134 60342102
         CLM   RET,B'0001',MAXIMUM      CHECK FOR 127 USERS      Y02134 60342202
         BL    VUS05415                 BRANCH IF NOT 127 USERS  Y02134 60342302
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE DEVICE     YM1472 60342402
         BO    VUS05416                 BRANCH IF TAPE UNIT      YM1472 60342502
         TM    UCBSTAB,UCBBSTR          CHECK FOR STORAGE VOLUME YM1472 60342602
         BNZ   VUS05423                 BRANCH IF STORAGE        YM1472 60342802
         TM    UCBSTAT,UCBRESV+UCBSYSR+UCBPRES RSRVD,SYSRES,PERM YM1472 60343202
         BNZ   VUS05423                 BRANCH IF ANY OR ALL     YM1472 60343302
         TM    UCBSTAB,UCBBSVL          TEST FOR SHARED VOLUME   YM1472 60343402
         BNO   VUS05423                 OK TO USE SHARED UNIT    YM1472 60343502
         MVI   DXRETCOD,K11             OPEN=213-28 EOV=B37-0C   YM1238 60343702
         B     VUS05425                 BRANCH OUT               Y02134 60343802
*                                                                Y02134 60343902
VUS05415 EQU   *                        LESS THAN 127 USERS      Y02134 60344002
*                                                                Y02134 60344102
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE UNIT       Y02134 60344302
         BNO   VUS05420                 BRANCH IF NOT TAPE       Y02134 60344502
*                                                                Y02134 60344702
         LTR   RET,RET                  TEST FOR COUNT OF ZERO   Y02134 60344902
         BZ    VUS05420                 BRANCH, TAPE NOT IN USE  Y02134 60345102
*                                                                YM1472 60345502
VUS05416 EQU   *                        TOO MANY USERS ON TAPE   YM1472 60345902
*                                                                YM1472 60346302
         MVI   DXRETCOD,K12             OPEN=513-04 EOV=837-0C   YM1238 60347102
         B     VUS05425                 BRANCH OUT               Y02134 60347502
*                                                                Y02134 60348902
VUS05420 EQU   *                        NOT TAPE                 Y02134 60349002
*                                                                Y02134 60349102
         LR    R1,R0                    LOAD OLD VALUE TO MODIFY Y02134 60352302
         AR    R1,RF                    ADD INCREMENT TO COUNT   Y02134 60354302
*                                                                Y02134 60356302
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 60356902
*                                                                Y02134 60357002
         CS    R0,R1,UCBOB+(((UCBDMCT-UCBOB)/K4)*K4) UPDAT COUNT Y02134 60357202
*                                                                Y02134 60357602
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 60359202
*                                                                Y02134 60359602
         BNE   VUS05410                 BRANCH IF NOT THE SAME   Y02134 60360402
*                                                                YM1472 60360802
         OI    DXATGENS,DXATDMCT        DM COUNT INCREMENTED     YM1472 60362402
*                                                                Y02134 60363502
VUS05423 EQU   *                        UNIT OK TO USE           YM1472 60365502
*                                                                YM1472 60367502
         MVI   DXRETCOD,K0              SET RETURN CODE TO ZERO  Y02134 60368702
*                                                                Y02134 60370002
VUS05425 EQU   *                        CONTINUE                 Y02134 60373202
*                                                                Y02134 60376402
         L     RF,WTGPREFX              LOAD PREFIX ADDRESS      Y02134 60382802
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134 60386002
*                                                                Y02134 60389202
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02082 60392402
VUS05430 SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCK             Y02134X60395602
               RELATED=(LOCAL,IFG0194A(VUS05110))                Y02134 60398802
*                                                                Y02134 60402002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 60405202
*                                                                Y02134 60407202
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 60408402
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134 60411602
         BNZ   VUS10000                 BRANCH IF ERROR          Y02134 60414802
         XR    R0,R0                    PREPARE FOR IC INST      Y02134 60418002
         IC    R0,DXRETCOD              PICK UP SAVED ERROR CODE Y02134 60421202
*                                                                Y02134 60423202
         CLI   DXRETCOD,K10             TEST FOR NO UNITS        Y02134 60423602
         BE    VUS10070                 BRANCH TO ERROR ROUTINE  Y02134 60424002
*                                                                Y02134 60424102
         LTR   R0,R0                    TEST FOR UNIT ERROR      Y02134 60424402
         BNZ   VUS10090                 BRANCH IF UNIT ERROR     Y02134 60427602
*                                                                Y02134 60430802
         NC    DXUCBSAV,DXUCBSAV        TEST FOR FIRST UNIT      Y02134 60439202
         BNZ   VUS05510                 BRANCH IF FIRST SPECIFD  Y02134 60439602
*                                                                Y02134 60440102
         MVC   DXUCBSAV,DXUCBADR        SAVE FIRST UNIT          Y02134 60440202
         MVC   DXUCBSAV(K1),DXUNITOF+K1 SAVE TIOT OFFSET         Y02134 60440302
*                                                                Y02134 60450202
VUS05510 EQU   *                        FIRST SPECIFIED          Y02134 60460202
*                                                                Y02134 60460302
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE DEVICE     Y02134 60470302
         BNO   VUS05600                 BRANCH NOT TAPE DEVICE   Y02134 60480202
*                                                                Y02134 60490102
*****************************************************************Y02134 60500002
*                                                                Y02134 60550002
*        GO VERIFY VOLUME ON TAPE UNIT.                          Y02134 60600002
*                                                                Y02134 60650002
*****************************************************************Y02134 60700002
*                                                                Y02134 60750002
         IECRES LOAD,MODID=ID4A4F,BRCODE=K0,BRANCH=QUEUED        Y02134 60800002
*                                                                Y02134 60950002
*****************************************************************Y02134 61000002
*                                                                Y02134 61050002
*        GO VERIFY VOLUME ON DIRECT ACCESS UNIT.                 Y02134 61100002
*                                                                Y02134 61150002
*****************************************************************Y02134 61200002
*                                                                Y02134 61250002
VUS05600 EQU   *                                                 Y02134 61300002
*                                                                Y02134 61400002
         IECRES LOAD,MODID=ID4A4C,BRCODE=K0,BRANCH=QUEUED        Y02134 61450002
*                                                                Y02134 62800002
*****************************************************************Y02134 62850002
*                                                                Y02134 62900002
*        UPDATE JFCB WITH NEW VOLUME FROM DXVOLSR2.              Y02134 62950002
*                                                                Y02134 63000002
*****************************************************************Y02134 63050002
*                                                                Y02134 63100002
VUS06000 EQU   *                        PHYSICAL SEQUENTIAL      Y02134 63150002
*                                                                Y02134 65000002
         CLC   DXVOLSR2,SCRTCH          CHECK FOR SCRTCH VOLUME  Y02134 65050002
         BNE   VUS06500                 BRANCH, LOOK AHEAD MOUNT Y02134 65100002
*                                                                YM3840 65151202
         LH    RC,DXVOLSEQ              LOAD VOL SEQ NO.         YM3195 65152002
         LA    RD,JFCBVOLS              LOAD POINTER TO VOLUMES  Y02134 65250002
         LA    RET,JFCBEXAD             SET UP POINTER FOR EXT   Y02134 65300002
         MVC   DXWORK1,TIOEJFCB         SAVE JFCB PTR            Y02134 65310002
*                                                                Y02134 65350002
*****************************************************************Y02134 65400002
*                                                                Y02134 65450002
*        CHECK FOR VOLUME IN MAIN JFCB                           Y02134 65500002
*                                                                Y02134 65550002
*****************************************************************Y02134 65600002
*                                                                Y02134 65650002
         CH    RC,VOL5                  VOL SEQ LESS THAN 5      Y02134 65700002
         BNH   VUS06200                 BRANCH, VOL SER IN MAIN  Y02134 65750002
         SH    RC,VOL5                  DECREMENT FOR INDEXING   Y02134 65800002
*                                                                Y02134 65850002
         IECRES GET,LV=JFCBLGTH,ID=JFCB,                         Y02134X65960002
               PREFIX=YES,STM=(2,14,WTGPREFX)                    Y02134 65962002
*                                                                Y02134 65970002
*****************************************************************Y02134 66050002
*                                                                Y02134 66100002
*        CHECK FOR VOLUME IN JFCB EXTENSION.                     Y02134 66150002
*                                                                Y02134 66200002
*****************************************************************Y02134 66250002
*                                                                Y02134 66300002
VUS06100 EQU   *                                                 Y02134 66350002
*                                                                Y02134 66400002
         CLC   K0(L'JFCBEXAD,RET),ZEROS IS THERE AN EXTENSION    Y02134 66450002
         LA    R0,K9                    OPEN=113-08 EOV=837-08   Y02080 66460002
         BZ    VUS10090                 BRANCH IF NO EXTENSION   Y02134 66500002
         MVC   DXWORK1,JFCBEXAD-JFCBEXAD(RET) SAVE JFCB PTR      Y02134 66510002
         IECRES LOCJFCB,(RET)           LOCATE JFCB EXTENSION    Y02134 66550002
         MVC   K0(JFCBLGTH,R1),K0(RET)  MOVE JFCB TO WORK AREA   Y02134 66600002
         LR    RET,R1                   LOAD POINTER TO JFCB     Y02134 66650002
         LA    RD,K4(RET)               LOAD POINTER TO VOLUMES  Y02134 66700002
         CH    RC,VOL15                 VOL SEQ LESS THAN 15     Y02134 66750002
         BNH   VUS06200                 BRANCH, VOL SER IN EXT   Y02134 66800002
         SH    RC,VOL15                 DECREMENT FOR INDEXING   Y02134 66850002
         B     VUS06100                 BRANCH TO CHECK NEXT EXT Y02134 66900002
*                                                                Y02134 66950002
*****************************************************************Y02134 67000002
*                                                                Y02134 67050002
*        REFERENCED VOLUME HAS BEEN FOUND.                       Y02134 67100002
*        RC CONTAINS THE POSITION OF THE VOLUMES IN THE LIST.    Y02134 67150002
*        RD POINTS TO THE LIST OF VOLUMES.                       Y02134 67200002
*                                                                Y02134 67250002
*****************************************************************Y02134 67300002
*                                                                Y02134 67350002
VUS06200 EQU   *                                                 Y02134 67400002
*                                                                Y02134 67450002
         BCTR  RC,R0                    DECREMENT FOR INDEXING   Y02134 67500002
         MH    RC,VOL6                  CONVERT SEQ NO TO OFFSET Y02134 67550002
         AR    RD,RC                    ADD OFFSET TO BASE       Y02134 67600002
         MVC   K0(L'UCBVOLI,RD),UCBVOLI MOVE VOLUME N TO JFCB    Y02134 67650002
         LH    RC,DXVOLSEQ              GET VOL SEQ OF VOL N     Y02134 67652002
         STC   RC,JFCBNVOL              UPDATE NO. OF VOLS       Y02134 67654002
*                                                                YM5928 67664002
         OI    JFCBTSDM,JFCVSL          SET VOL SER LIST MODIF-  A45617 67674002
*                                       IED SO SCHEDULER WILL    A45617 67684002
*                                       RECATALOG WITH NEW VOL   A45617 67694002
*                                                                YM5928 67696002
         OI    JFCBMASK+K4,X80          INDICATE JFCB MODIFIED   Y02134 67700002
*                                                                Y02134 67750002
         XC    JFCVINDX(K2),JFCVINDX    CLEAR VVIC INDICATORS  @Y30LSFY 67752003
*                                                              @Y30LSFY 67754003
         TM    JFCBTSDM,JFCNWRIT        JFCB UPDATE INHIBITED    Y02134 67760002
         BO    VUS06500                 BRANCH TO INHIBIT UPDATE Y02134 67770002
*                                                                YM3840 67775002
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE UNIT       YM3840 67776002
         BNO   VUS06250                 BRANCH IF NOT TAPE UNIT  YM3840 67777002
         TM    JFCBLTYP,JFCNL+JFCNSL+JFCBLP TEST FOR NL TAPE     YM3840 67778002
         BZ    VUS06250                 BRANCH IF NOT NL SCRTCH  YM3840 67779002
*                                                                YM3840 67779202
         OI    JFCBMASK+K5,X01          SET L NO. GENERATED      YM3840 67779402
*                                                                Y02134 67779602
VUS06250 EQU   *                        PREPARE TO UPDATE VOLSER YM3840 67779802
*                                                                Y02134 67780002
         CLC   DXVOLSEQ,VOL5            CHECK IF IN MAIN JFCB    Y02134 67800002
         BNH   VUS06300                 BRANCH IF VOLUME IN MAIN Y02134 67850002
*                                                                Y02134 67900002
*****************************************************************Y02134 67950002
*                                                                Y02134 68000002
*        WRITE THE JFCB BACK.                                    Y02134 68050002
*                                                                Y02134 68100002
*****************************************************************Y02134 68150002
*                                                                Y02134 68160002
         LA    R1,DXWORK1               POINT TO SAVED JFCB PTR  Y02134 68250002
*                                                                Y02134 68300002
         IECRES WRJFCB,(R1),(RET)       WRITE JFCB BACK          Y02134 68350002
*                                                                Y02134 68350402
         IECRES FREE,A=(RET),PREFIX=YES,STM=(0,14,WTGPREFX)      Y02134 68352002
*                                                                Y02134 68360002
VUS06300 EQU   *                        VOLUME IN MAIN           Y02134 68370002
*                                                                Y02134 68400002
         LA    R1,TIOEJFCB              POINT TO MAIN JFCB       Y02134 68450002
         LA    RET,DXJBF                POINT TO WORK AREA JFCB  Y02134 68452002
*                                                                Y02134 68460002
         IECRES WRJFCB,(R1),(RET)       WRITE JFCB BACK          Y02134 68470002
*                                                                Y02134 68500002
*****************************************************************Y02134 68550002
*                                                                Y02134 68600002
*        LOOK AHEAD MOUNT VOL N+1                                Y02134 68650002
*                                                                Y02134 68700002
*****************************************************************Y02134 68750002
*                                                                Y02134 68800002
VUS06500 EQU   *                                                 Y02134 68850002
*                                                                Y02134 68900002
         TM    UCBTBYT2,UCBRVDEV        TEST FOR VIRTUAL VOLUME@ZA05469 68910037
         BO    VUS09100                 YES, SKIP LOOKAHEAD    @ZA05469 68920037
*                                       NO,                    @ZA05469 68930037
         CLC   DXVOLSR3,ZEROS           SEE IF VOL N+1 SPECIFIED Y02134 68950002
         BZ    VUS09100                 BRANCH IF NONE SPECIFIED Y02134 69000002
         CLC   DXNOUNIT,ONE             CHECK FOR ONE UNIT       Y02134 69010002
         BNH   VUS09100                 BRANCH IF ONLY ONE UNIT  Y02134 69020002
*                                                                Y02134 69050002
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX   Y02134 69060002
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134 69070002
*                                                                Y02134 69080002
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02134 69082002
*                                                                Y02134 69084002
VUS06550 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02134X69090002
               RELATED=(LOCAL,IFG0194A(VUS06560))                Y02134 69092002
*                                                                Y02134 69094002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 69094402
*                                                                Y02134 69094802
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 69096002
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134 69098002
         BNZ   VUS10000                 BRANCH IF ERROR          Y02134 69098402
*                                                                Y02134 69098802
         LH    RC,DXUNITOF              GET CURRENT OFFSET       Y02134 69100002
         L     RUCB,DXUCBADR            GET CURRENT UCB ADDRESS  Y02134 69150002
         LH    RB,DXNOUNIT              GET NUMBER OF UNITS      Y02134 69200002
         BAL   RET,VUS07000             LINK TO GET NEXT UNIT    Y02134 69250002
*                                                                YM1472 69252002
         MVI   DXRETCOD,K0              SET REJECT OFF           YM1472 69254002
         MVC   DXVOLSR1,DXVOLSR2        SET UP LAST VOLUME       YM1472 69256002
         LA    R1,DXVOLSR3              POINTER TO VOLUME N+1    Y02134 69300002
         L     RD,WTGPREFX              POINTER TO PREFIX        Y02134 69350002
         LA    RD,IECREGSV-IECPREFX(,RD) POINTER TO SAVE AREA    Y02134 69400002
         BAL   RET,VUS08000             LINK TO GET UNIT         Y02134 69450002
*                                                                YM1472 69452002
         L     R1,WTGPREFX              LOAD POINTER TO PREFIX   Y02134 69470402
         STM   R0,RF,IECREGSV-IECPREFX(R1) SAVE REGISTERS        Y02134 69472002
*                                                                Y02134 69480002
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02134 69482002
*                                                                Y02134 69484002
VUS06560 SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCK             Y02134X69490002
               RELATED=(LOCAL,IFG0194A(VUS06550))                Y02134 69492002
*                                                                Y02134 69494002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 69494402
*                                                                Y02134 69494802
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 69496002
         LM    R0,RF,IECREGSV-IECPREFX(R1) RESTORE REGISTERS     Y02134 69498002
         BNZ   VUS10000                 BRANCH IF ERROR          Y02134 69498402
*                                                                Y02134 69498802
         B     VUS06600(RF)             BRANCH TO BRANCH TABLE   Y02134 69500002
*                                                                Y02134 69550002
VUS06600 EQU   *                        BRANCH TABLE             Y02134 69600002
*                                                                Y02134 69602002
         B     VUS09100                 BRANCH TO UNIT LOCATED   YM1472 69604002
         B     VUS06800                 BRANCH TO EMPTY UNIT     Y02134 69604402
         B     VUS06800                 BRANCH TO UNIT DISMOUNT  Y02134 69606002
         B     VUS09100                 BRANCH TO SKIP LOOKAHEAD Y02134 69608102
*                                                                Y02134 69639902
*****************************************************************Y02134 69641502
*                                                                Y02134 69643102
*        LOOK AHEAD DEVICE LOCATED.                              Y02134 69644702
*                                                                Y02134 69646302
*****************************************************************Y02134 69647902
*                                                                Y02134 69649502
VUS06800 EQU   *                                                 Y02134 69651102
*                                                                Y02134 69652702
         MVC   DXRETMOD,ID4A4A          RETURN ID TO SAVE AREA   YM1350 69718102
         MVI   DXRETCOD,K28             SET RETURN INDICATOR     YM3081 69727202
*                                                                Y02134 69736302
         IECRES LOAD,MODID=ID4A4J,BRCODE=K16,BRANCH=QUEUED       Y02134 69754502
         EJECT                                                          69763602
*                                                                Y02134 69772702
*****************************************************************Y02134 69781802
*                                                                Y02134 69790902
*        THIS ROUTINE LOCATES A UNIT TO PROCESS A SPECIFIED      Y02134 69800002
*        VOLUME SERIAL NUMBER.                                   Y02134 69850002
*                                                                Y02134 69900002
*****************************************************************Y02134 69910002
*                                                                Y02134 69920002
*        DXVOLSR1 CONTAINS THE VOLUME SERIAL OF THE LAST VOLUME  YM1472 69922002
*        PROCESSED.                                              YM1472 69924002
*                                                                YM1472 69928002
*        REG   ENTRY CONTENTS           EXIT CONTENTS            Y02134 69950002
*        R0    WORK REGISTER            SAME AS ENTRY            Y02134 70000002
*        R1    POINTER TO VOLUME SERIAL SAME AS ENTRY            Y02134 70050002
*        R2    DCB ADDRESS              SAME AS ENTRY            Y02134 70100002
*        R3    BASE REGISTER            SAME AS ENTRY            Y02134 70150002
*        R4    O/C/E WORK AREA POINTER  SAME AS ENTRY            Y02134 70200002
*        R5    NOT USED                 SAME AS ENTRY            Y02134 70250002
*        R6    O/C/E WTG TABLE POINTER  SAME AS ENTRY            Y02134 70300002
*        R7    NOT USED                 SAME AS ENTRY            Y02134 70350002
*        R8    NOT USED                 SAME AS ENTRY            Y02134 70400002
*        R9    POINTER TO TIOT ENTRY    SAME AS ENTRY            Y02134 70450002
*        RA    POINTER TO UCB           POINTER TO NEW UCB       Y02134 70500002
*        RB    NUMBER OF UNITS IN TIOT  SAME AS ENTRY            Y02134 70550002
*        RC    TIOT ENTRY UCB OFFSET    NEW TIOT ENTRY OFFSET    Y02134 70600002
*        RD    POINTER TO SAVE AREA     SAME AS ENTRY            Y02134 70650002
*        RET   RETURN POINT             SAME AS ENTRY            Y02134 70700002
*        RF    WORK REGISTER            RETURN CODE              Y02134 70750002
*                                       0 = VOLUME MOUNTED       Y02134 70760002
*                                       4 = UNIT AVAILABLE       Y02134 70762002
*                                       8 = WRONG VOLUME MOUNTED Y02134 70770002
*                                      12 = MOUNT ISSUED, BAD VOLY02134 70790002
*                                      16 = NO UNIT AVAILABLE    Y02134 70792002
*                                                                Y02134 70800002
*****************************************************************Y02134 70850002
*                                                                Y02134 70900002
VUS08000 EQU   *                                                 Y02134 70950002
*                                                                Y02134 71000002
         SAVE  (14,12)                  SAVE REGISTERS           Y02134 71050002
         LTR   RB,RB                    TEST FOR 1 OR MORE UNITS Y02134 71060002
         BNP   VUS08860                 BRANCH IF NO UNITS       Y02134 71070002
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         YM3192 71076002
         BO    VUS08810                 BR IF VIO                YM3192 71078002
         XC    DXWORK1,DXWORK1          CLEAR WORK AREA          Y02134 71080002
         XC    DXWORK2,DXWORK2          CLEAR WORK AREA          Y02134 71090002
         XC    DXWORK3,DXWORK3          CLEAR WORK AREA          Y02134 71092002
         XC    DXWORK4,DXWORK4          CLEAR WORK AREA          Y02134 71094002
*                                                                Y02134 71098002
*****************************************************************Y02134 71099202
*                                                                Y02134 71099602
*        CHECK FOR UNLOADED UNIT WITH NO ACTIVITY                Y02134 71099702
*                                                                Y02134 71099802
*****************************************************************Y02134 71099902
*                                                                Y02134 71116602
VUS08100 EQU   *                                                 Y02134 71118602
*                                                                Y02134 71120602
         NC    DXVOLSR1,DXVOLSR1        TEST FOR PREVIOUS VOLUME YM1472 71122602
         BZ    VUS08105                 BRANCH IF NONE           YM1472 71124602
         CLC   DXVOLSR1,UCBVOLI         TEST FOR PREVIOUS VOLUME YM1472 71125002
         BNE   VUS08105                 BRANCH IF DIFFENENT VOL  YM4647 71125102
         CLC   DXVOLSR1,0(R1)           SEE IF LAST SAME AS NEXT YM4647 71125202
         BNE   VUS08800                 BRANCH NO TO DISMOUNT    YM4647 71125402
*                                                                YM1472 71125802
VUS08105 EQU   *                        CHECK OUT UNIT           YM1472 71126202
*                                                                YM1472 71126302
         TM    UCBDMCT,ALLBITS          TEST FOR ACTIVITY        Y02134 71126602
         BNZ   VUS08200                 BRANCH IF ANY ACTIVITY   Y02134 71128602
         CLC   UCBVOLI,ZEROS            CHECK IF NOTHING MOUNTED Y02134 71130602
         BZ    VUS08820                 BRANCH IF UNIT EMPTY     Y02134 71132602
         CLC   UCBVOLI,BLANKS           CHECK IF NOTHING MOUNTED Y02134 71133002
         BZ    VUS08820                 BRANCH IF UNIT EMPTY     Y02134 71133102
         CLI   UCBVOLI,VIRTUAL          UNVERIFIED SCRATCH TEST  Y02134 71133202
         BE    VUS08820                 BRANCH IF UNIT EMPTY     Y02134 71138802
*                                                                Y02134 71510002
*****************************************************************Y02134 71520002
*                                                                Y02134 71530002
*        CHECK FOR VOLUME ALREADY MOUNTED                        Y02134 71540002
*                                                                Y02134 71542002
*****************************************************************Y02134 71544002
*                                                                Y02134 71546002
VUS08200 EQU   *                                                 Y02134 71548002
*                                                                Y02134 71548402
         CLC   UCBVOLI,K0(R1)           UNIT ASSIGNED TO VOLUME  Y02134 71550002
         BE    VUS08810                 BRANCH IF UNIT LOCATED   Y02134 71600002
*                                                                Y02134 71602002
*****************************************************************Y02134 71604002
*                                                                Y02134 71606002
*        CHECK FOR SCRATCH VOLUME MOUNTING                       Y02134 71608002
*                                                                Y02134 71608402
*****************************************************************Y02134 71608802
*                                                                Y02134 71609202
         CLI   DXRETCOD,K0              TEST FOR REJECT          YM1157 71609702
         BNE   VUS08800                 BRANCH IF REJECT         YM1157 71609802
         CLC   SCRTCH,K0(R1)            CHECK FOR SCRTCH REQ     Y02134 71610002
         BNE   VUS08800                 BRANCH NOT SCRTCH        Y02134 71620002
         CLI   UCBDMCT,UCBMOUNT         SEE IF MOUNT IN PROGRESS Y02134 71630002
         BNE   VUS08300                 BRANCH IF NOT MOUNTING   Y02134 71642002
         CLI   UCBVOLI,VIRTUAL          TEST FOR SCRTCH MOUNT    Y02134 71644002
         BE    VUS08810                 BRANCH IF SCRTCH MOUNT   Y02134 71646002
         CLC   UCBVOLI,ZEROS            TEST FOR NON-SPECIFIC    Y02134 71648002
         BE    VUS08810                 BRANCH, OK FOR SCRTCH    Y02134 71648402
         CLC   UCBVOLI,BLANKS           CHECK FOR MOUNT BLANKS   Y02134 71649202
         BE    VUS08810                 BRANCH, OK FOR SCRTCH    Y02134 71649602
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE DEVICE     Y02134 71649702
         BO    VUS08800                 BRANCH, PURGE SPEC MOUNT YM7503 71649802
         L     RF,UCBEXTPT              LOAD UCB EXTENSION PTR   Y02146 71651802
         TM    UCBFLP1-UCBCMEXT(RF),UCBNSRCH TEST NON-SCRTCH VOL Y02146 71658002
         BO    VUS08800                 BRANCH IF NONSCRTCH VOL  YM7503 71662102
         B     VUS08810                 BR TO USE COMPATIBLE VOL Y02134 71666202
*                                                                Y02134 71676602
*****************************************************************Y02134 71799402
*                                                                Y02134 71849402
*        CHECK FOR SCRATCH VOLUME ALREADY MOUNTED                Y02134 71899402
*                                                                Y02134 71949402
*****************************************************************Y02134 71999402
*                                                                Y02134 72049402
VUS08300 EQU   *                                                 Y02134 72049802
*                                                                Y02134 72049902
         TM    UCBTBYT3,UCB3DACC        TEST FOR DA DEVICE       Y02134 72050002
         BO    VUS08400                 BRANCH IF DA DEVICE      Y02134 72100002
         TM    UCBDMCT,ALLBITS          TEST FOR ACTIVITY        Y02134 72110002
         BNZ   VUS08850                 BRANCH IF DEVICE IN USE  Y02134 72120002
         TM    JFCBLTYP,JFCNSL          TEST FOR NSL REQUSET     Y02134 72150002
         BO    VUS08800                 BRANCH IF NSL SCRTCH     Y02134 72200002
         TM    JFCBLTYP,JFCBLP          TEST FOR BLP REQUEST     Y02134 72250002
         BO    VUS08800                 BRANCH TO GET UNIT       Y02134 72300002
*                                                                YM2899 72310002
         L     RF,UCBEXTPT              LOAD UCB EXTENSION PTR   YM2899 72350002
         TM    UCBFLP1-UCBCMEXT(RF),UCBNSRCH  TEST IF NON-SCRTCH YM2899 72450002
         BO    VUS08800                 BRANCH IF NONSCRTCH VOL  YM2899 72550002
*                                                                Y02134 72650002
VUS08400 EQU   *                        DA DEVICE                Y02134 72700002
*                                                                Y02134 72750002
         TM    TIOESTTA,TIOSDSP1        TEST FOR PRIVATE REQUEST YM1108 72750402
         BNO   VUS08450                 BRANCH IF NOT PRIVATE    YM1108 72750802
         TM    UCBSTAB,UCBBPRV          TEST FOR PRIVATE SCRTCH  YM1108 72751202
         BNO   VUS08800                 BRANCH IF NO PRIVATE VOL YM1108 72751602
         L     RF,UCBEXTPT              LOAD UCB EXTENSION PTR   Y02146 72752002
         TM    UCBFLP1-UCBCMEXT(RF),UCBNSRCH TEST IF NON-SCRTCH  Y02146 72770002
         BO    VUS08800                 BRANCH IF NONSCRTCH VOL  Y02134 72799002
         B     VUS08500                 BRANCH, COMPATIBLE VOL   YM1108 72952002
*                                                                Y02134 72952102
VUS08450 EQU   *                        NOT PRIVATE VOL          Y02134 72952202
*                                                                Y02134 72952302
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE            Y02134 72954802
         BO    VUS08500                 BRANCH IF TAPE           Y02134 72956802
         TM    UCBSTAB,UCBBPRV          TEST FOR PRIVATE SCRTCH  Y02134 72960002
         BO    VUS08800                 BRANCH IF PRIVATE VOL    Y02134 72962502
*                                                                Y02134 72965002
VUS08500 EQU   *                        PRIVATE VOLUME           Y02134 72967502
*                                                                Y02134 72970002
         TM    UCBSTAT,UCBDADI          TEST FOR SL VOL          Y02134 73000002
         BNO   VUS08600                 BRANCH IF NOT SL         Y02134 73050002
         TM    JFCBLTYP,JFCSL           TEST FOR SL REQUEST      Y02134 73100002
         BO    VUS08815                 BRANCH, USE THIS UNIT    Y02134 73150002
         B     VUS08800                 BRANCH, INCOMPATIBLE VOL Y02134 73160002
*                                                                Y02134 73250002
VUS08600 EQU   *                        NOT SL                   Y02134 73300002
*                                                                Y02134 73350002
         TM    UCBTBYT3,UCB3DACC        TEST FOR DIRECT ACCESS   Y02134 73400002
         BO    VUS08815                 BRANCH TO USE THIS UNIT  Y02134 73450002
         TM    UCBSTAB,UCBBSTR          TEST FOR ANSI VOLUME     Y02134 73500002
         BNO   VUS08700                 BRANCH IF NOT ANSI VOL   Y02134 73550002
         TM    JFCBLTYP,JFCBAL          TEST FOR USASI REQUEST   Y02134 73600002
         BO    VUS08810                 BRANCH TO USE THIS UNIT  Y02134 73650002
         B     VUS08800                 BRANCH, INCOMPATIBLE VOL Y02134 73660002
*                                                                Y02134 73750002
VUS08700 EQU   *                        NOT ANSI VOL             Y02134 73800002
*                                                                Y02134 73850002
         TM    UCBTFL1,UCBNSLTP         TEST FOR NSL VOLUME      Y02134 73900002
         BO    VUS08800                 BRANCH IF NSL MOUNTED    Y02134 73950002
         TM    UCBTFL1,UCBNLTP          TEST FOR NL VOLUME       Y02134 74000002
         BNO   VUS08810                 BRANCH, VOL NOT IDENTIFD Y02134 74050002
         TM    JFCBLTYP,JFCNL           TEST FOR NL REQUEST      Y02134 74100002
         BO    VUS08810                 BRANCH TO USE THIS UNIT  Y02134 74150002
*                                                                Y02134 74200002
*****************************************************************Y02134 74550002
*                                                                Y02134 74600002
*        THE VOLUME IS NOT MOUNTED ON ONE OF THE                 Y02134 74650002
*        ALLOCATED UNITS. FIND THE FIRST AVAILABLE UNIT.         Y02134 74700002
*                                                                Y02134 74750002
*****************************************************************Y02134 74800002
*                                                                Y02134 74850002
VUS08800 EQU   *                                                 Y02134 74900002
*                                                                Y02134 74950002
         TM    UCBTBYT3,UCB3TAPE        TEST FOR 2400 UNIT       YM2850 74950102
         BO    VUS08801                 BRANCH IF NON SHR UNIT   YM2850 74950202
         TM    UCBSTAB,UCBBSVL          TEST FOR SHARED VOLUME   YM2850 74950402
         BNO   VUS08850                 DO NOT USE SHARED UNIT   YM2850 74950802
*                                                                YM2850 74950902
VUS08801 EQU   *                        NONSHARED UNIT           YM2850 74951202
*                                                                YM2850 74951602
         TM    UCBSTAT,UCBRESV+UCBSYSR+UCBPRES RSRVD,SYSRES,PERM YM4647 74952002
         BNZ   VUS08850                 BRANCH IF ANY OR ALL     YM4647 74954002
         TM    UCBDMCT,UCBDMC           CHECK FOR ANY USERS      Y02134 75000002
         BNZ   VUS08850                 BRANCH YES, SKIP         Y02134 75050002
         TM    UCBDMCT,UCBMOUNT         WRONG MOUNT PENDING      Y02134 75052002
         BO    VUS08830                 BRANCH, WRONG MOUNT PEND YM7503 75054002
         CLC   UCBVOLI,ZEROS            TEST FOR NO VOL SER      Y02134 75060002
         BZ    VUS08820                 BRANCH, NOTHING MOUNTED  Y02134 75070002
         CLC   UCBVOLI,BLANKS           TEST FOR BLANK VOL SER   Y02134 75080002
         BE    VUS08820                 BRANCH, NOTHING MOUNTED  Y02134 75090002
         CLI   UCBVOLI,VIRTUAL          TEST FOR SCRTCH UNIT     Y02134 75092002
         BE    VUS08820                 BRANCH, USE EMPTY UNIT   Y02134 75094002
         B     VUS08830                 DISMOUNTABLE VOLUME      YM4647 75460002
*                                                                Y02134 75466002
*****************************************************************Y02134 75468002
*                                                                Y02134 75468402
*        UNIT HAS BEEN FOUND WITH VOLUME MOUNTED OR              Y02134 75468802
*        IN THE PROCESS OF BEING MOUNTED.                        Y02134 75469202
*                                                                Y02134 75469602
*****************************************************************Y02134 75469702
*                                                                Y02134 75469802
VUS08810 EQU   *                                                 Y02134 75473102
         XR    RF,RF                    ZERO OUT RETURN CODE     Y02134 75476802
         XC    DXVOLSR1,DXVOLSR1        CLEAR REJECT VOLUME      YM3925 75478802
         B     VUS08950                 BRANCH TO RETURN         YM3925 75480102
*                                                                Y02134 75483402
*****************************************************************Y02134 75490602
*                                                                Y02134 75490702
*        UNIT HAS BEEN FOUND WITH VOLUME MOUNTED OR              Y02134 75491002
*        IN THE PROCESS OF BEING MOUNTED.                        Y02134 75491102
*                                                                Y02134 75491402
*****************************************************************Y02134 75491502
*                                                                Y02134 75491602
VUS08815 EQU   *                                                 Y02134 75493602
*                                                                Y02134 75494002
         NC    DXWORK1,DXWORK1          PREVIOUS EMPTY UNIT TEST Y02134 75494102
         BNZ   VUS08850                 BRANCH IF PREVIOUS UNIT  Y02134 75494202
         ST    RUCB,DXWORK1             SAVE EMPTY UNIT ADDRESS  Y02134 75494302
         STC   RC,DXWORK1               SAVE EMPTY UNIT OFFSET   Y02134 75494702
         B     VUS08850                 BRANCH TO GET MORE UNITS Y02134 75495102
*                                                                Y02134 75496402
*****************************************************************Y02134 75496502
*                                                                Y02134 75497402
*        UNIT AVAILABLE WITH NOTHING MOUNTED.                    Y02134 75497602
*                                                                Y02134 75497802
*****************************************************************Y02134 75498002
*                                                                Y02134 75498202
VUS08820 EQU   *                                                 Y02134 75499102
*                                                                       75502702
         NC    DXWORK2,DXWORK2          PREVIOUS EMPTY UNIT TEST Y02134 75502802
         BNZ   VUS08850                 BRANCH IF PREVIOUS UNIT  Y02134 75503702
         ST    RUCB,DXWORK2             SAVE EMPTY UNIT ADDRESS  Y02134 75504602
         STC   RC,DXWORK2               SAVE EMPTY UNIT OFFSET   Y02134 75505502
         B     VUS08850                 BRANCH TO GET MORE UNITS Y02134 75506402
*                                                                Y02134 75507302
*****************************************************************Y02134 75510002
*                                                                Y02134 75510902
*        DISMOUNTABLE UNIT WITH WRONG VOLUME MOUNTED OR MOUNTING YM7503 75511802
*                                                                Y02134 75512702
*****************************************************************Y02134 75513602
*                                                                Y02134 75514502
VUS08830 EQU   *                                                        75515002
*                                                                       75515102
         NC    DXWORK3,DXWORK3          PREVIOUS UNIT TEST       Y02134 75515402
         BNZ   VUS08850                 BRANCH IF PREVIOUS UNIT  Y02134 75516302
         ST    RUCB,DXWORK3             SAVE UNIT ADDRESS        Y02134 75517202
         STC   RC,DXWORK3               SAVE UNIT OFFSET         Y02134 75518102
         B     VUS08850                 BRANCH TO GET MORE UNITS Y02134 75519002
*                                                                Y02134 75533302
VUS08850 EQU   *                        GET MORE UNITS           Y02134 75550002
*                                                                Y02134 75600002
         BAL   RET,VUS07000             LINK TO GET NEXT UNIT    Y02134 75650002
         BCT   RB,VUS08100              LOOP IF MORE UCBS        Y02134 75700002
*                                                                YM4611 75700502
         XR    RC,RC                    CLEAR REG FOR IC INST    Y02134 75702002
*                                                                Y02134 75710002
*****************************************************************Y02134 75710802
*                                                                Y02134 75711202
*        TEST FOR UNIT AVAILABLE WITH NOTHING MOUNTED.           Y02134 75711602
*                                                                Y02134 75712102
*****************************************************************Y02134 75712202
*                                                                Y02134 75712302
         LA    RF,K4                    EMPTY UNIT RETURN CODE   Y02134 75712402
         IC    RC,DXWORK2               INSERT UNIT OFFSET       Y02134 75718002
         L     RUCB,DXWORK2             LOAD UCB ADDRESS         Y02134 75718402
         LA    RUCB,UCBOB               CLEAR HI ORDER BYTE      Y02134 75718802
         NC    DXWORK2,DXWORK2          TEST FOR EMPTY UNIT      Y02134 75720002
         BNZ   VUS08900                 BRANCH TO RETURN         Y02134 75730002
*                                                                Y02134 75732002
*****************************************************************Y02134 75734002
*                                                                Y02134 75736002
*        TEST FOR SCRTCH VOLUME ALREADY MOUNTED.                 Y02134 75738002
*                                                                Y02134 75738402
*****************************************************************Y02134 75738802
*                                                                Y02134 75739202
         XR    RF,RF                    VOL MOUNTED RETURN CODE  Y02134 75739602
         IC    RC,DXWORK1               INSERT UNIT OFFSET       Y02134 75739802
         L     RUCB,DXWORK1             LOAD UCB ADDRESS         Y02134 75739902
         LA    RUCB,UCBOB               CLEAR HI ORDER BYTE      Y02134 75740002
         NC    DXWORK1,DXWORK1          TEST FOR EMPTY UNIT      Y02134 75740102
         BNZ   VUS08900                 BRANCH TO RETURN         Y02134 75740202
*                                                                Y02134 75740302
*****************************************************************Y02134 75740402
*                                                                Y02134 75740502
*        TEST FOR DISMOUNTABLE UNIT WITH WRONG VOLUME MOUNTED.   Y02134 75740602
*                                                                Y02134 75743502
*****************************************************************Y02134 75744602
*                                                                Y02134 75745702
         LA    RF,K8                    DISMOUNT REQUIRED        Y02134 75746802
         IC    RC,DXWORK3               INSERT UNIT OFFSET       Y02134 75747902
         L     RUCB,DXWORK3             LOAD UCB ADDRESS         Y02134 75749002
         LA    RUCB,UCBOB               CLEAR HI ORDER BYTE      Y02134 75750102
         NC    DXWORK3,DXWORK3          TEST FOR DISMNTABLE UNIT YM1472 75752102
         BNZ   VUS08910                 BRANCH TO RETURN         YM1472 75754102
*                                                                Y02134 75783302
*****************************************************************Y02134 75800002
*                                                                Y02134 75850002
*        NO AVAILABLE UNIT EXISTS.                               Y02134 75900002
*                                                                Y02134 75950002
*****************************************************************Y02134 76000002
*                                                                Y02134 76050002
VUS08860 EQU   *                                                 Y02134 76060002
*                                                                Y02134 76070002
         LA    RF,K12                   LOAD ERROR RETURN CODE   YM7503 76080002
         B     VUS08990                 BRANCH TO RETURN         Y02134 76100002
*                                                                YM1472 76472002
*****************************************************************YM1472 76476002
*                                                                YM1472 76478002
*        VOLUME AND UNIT HAVE BEEN FOUND.                        YM1472 76480002
*                                                                YM1472 76482002
*****************************************************************YM1472 76484002
*                                                                YM1472 76486002
VUS08900 EQU   *                                                 Y02134 76500002
*                                                                Y02134 76550002
         XC    DXVOLSR1,DXVOLSR1        CLEAR REJECT             YM1472 76550402
         B     VUS08920                 BYPASS REJECT INDICATOR  YM1472 76550802
*                                                                YM1472 76552002
VUS08910 EQU   *                        SET UP FOR REJECT        YM1472 76554002
*                                                                YM1472 76556002
         MVI   DXVOLSR1,ALLBITS         SET REJECT INDICATOR     YM1472 76558002
*                                                                YM1472 76560002
VUS08920 EQU   *                        CHECK FOR UNIT NOT READY YM1472 76562002
*                                                                YM1472 76564002
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO             YM3822 76564202
         BO    VUS08950                 BRANCH IF VIO            YM3822 76564302
         TM    UCBDMCT,UCBMOUNT         TEST FOR MOUNT PENDING   YM1472 76564402
         BO    VUS08925                 BRANCH IF MOUNT PENDING  YM1472 76564802
         TM    UCBFL1,UCBNOTRD          TEST IF UNIT READY       YM1472 76565202
         BO    VUS08930                 BRANCH IF NOT READY      YM1472 76565602
*                                                                YM1472 76565702
VUS08925 EQU   *                        CHECK FOR EMPTY UNIT     YM1472 76565802
*                                                                YM1472 76565902
         CLC   UCBVOLI,ZEROS            TEST FOR NO VOL SER      YM1472 76566002
         BZ    VUS08940                 BRANCH, NOTHING MOUNTED  YM1472 76568002
         CLC   UCBVOLI,BLANKS           TEST FOR BLANK VOL SER   YM1472 76570002
         BE    VUS08930                 BRANCH, RESOLVE BLANKS   YM1472 76572002
         CLI   UCBVOLI,VIRTUAL          TEST FOR SCRTCH UNIT     YM1472 76574002
         BNE   VUS08940                 BRANCH, VOLSER OK        YM1472 76576002
*                                                                YM1472 76576402
VUS08930 EQU   *                        INDICATE EMPTY UNIT      YM1472 76576802
*                                                                YM1472 76577202
         MODESET EXTKEY=SUPR            UCB KEY                  YM1472 76577602
*                                                                YM1472 76577702
         XC    UCBVOLI,UCBVOLI          CLEAR VOLUME SERIAL      YM1472 76577802
*                                                                YM1472 76577902
         MODESET EXTKEY=DATAMGT         RESET KEY                YM1472 76579902
*                                                                YM1472 76580302
VUS08940 EQU   *                        CHECK REJECT SWITCH      YM1472 76580702
*                                                                YM1472 76581102
         CLI   DXVOLSR1,ALLBITS         CHECK FOR REJECT         YM1472 76581502
         BNE   VUS08950                 BRANCH TO RETURN         YM1472 76581602
*                                                                YM1472 76581702
         MVC   DXVOLSR1,UCBVOLI         VOL SER TO REJECT        YM1472 76581802
*                                                                YM1472 76583802
         MODESET EXTKEY=SUPR            UCB KEY                  YM1472 76584202
*                                                                YM1472 76584602
         XC    UCBVOLI,UCBVOLI          CLEAR VOLUME SERIAL      YM1472 76585002
*                                                                YM1472 76585402
         MODESET EXTKEY=DATAMGT         RESET KEY                YM1472 76585502
*                                                                YM1472 76585602
VUS08950 EQU   *                        SET UP TO RETURN         YM1472 76585702
*                                                                YM1472 76585802
         ST    RUCB,K60(RD)             SAVE NEW UCB ADDRESS     Y02134 76633302
         ST    RC,K68(RD)               SAVE NEW UCB OFFSET      Y02134 76650002
*                                                                Y02134 76652002
VUS08990 EQU   *                        RETURN                   Y02134 76660002
*                                                                Y02134 76670002
         RETURN (14,12),RC=(15)         RETURN                   Y02134 76700002
         EJECT                                                          76710002
*                                                                Y02134 76750002
*****************************************************************Y02134 76800002
*                                                                Y02134 76850002
*        FIND NEXT UNIT IN TIOT DD ENTRY                         Y02134 76900002
*                                                                Y02134 76950002
*****************************************************************Y02134 77000002
*                                                                Y02134 77050002
VUS07000 EQU   *                                                 Y02134 77100002
*                                                                Y02134 77150002
         LTR   RC,RC                    TEST FOR INVALID OFFSET  Y02134 77200002
         BZ    VUS07004                 BRANCH, NO OFFSET        Y02134 77250002
         LA    RC,K4(RC)                INCREMENT TO NEXT ENTRY  Y02134 77300002
         EX    RC,VUS07008              CLI   TIOELNGH,K0        Y02134 77350002
         BH    VUS07006                 BRANCH IF NOT, GET UCB   Y02134 77400002
*                                                                Y02134 77450002
VUS07004 EQU   *                        NO OFFSET                Y02134 77500002
*                                                                Y02134 77550002
         LA    RC,TIOEFSRT-K1-TIOENTRY  GET OFFSET TO FIRST UCB  Y02134 77600002
*                                                                Y02134 77650002
VUS07006 EQU   *                        GET UCB                  Y02134 77700002
*                                                                Y02134 77750002
         L     RUCB,TIOENTRY(RC)        LOAD NEXT UCB ADDRESS    Y02134 77800002
         LA    RUCB,UCBOB               ZERO HI ORDER BYTE       Y02134 77850002
         BR    RET                      RETURN                   Y02134 77900002
*                                                                Y02134 77950002
VUS07008 CLI   TIOELNGH,K0              CHECK FOR END OF ENTRY   Y02134 78000002
         EJECT                                                          78010002
*                                                                Y02134 78020002
*****************************************************************Y02134 78030002
*                                                                Y02134 78040002
*        DECREMENT DATA MANAGEMENT COUNT                         Y02134 78042002
*                                                                Y02134 78044002
*        REGS - RUCB POINTS TO UCB, RET POINTS TO RETURN ADDRESS Y02134 78046002
*        REGS R0, R1, RF WILL BE USED AS WORK REGS               Y02134 78048002
*                                                                Y02134 78048402
*****************************************************************Y02134 78048802
*                                                                Y02134 78049202
VUS07100 EQU   *                                                 Y02134 78049602
*                                                                Y02134 78049702
         L     R0,UCBOB+(((UCBDMCT-UCBOB)/K4)*K4) ALLIGN & LOAD  Y02134 78049802
*                                                                Y02134 78049902
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 78066602
*                                                                Y02134 78076602
VUS07110 EQU   *                        LOOP                     Y02134 78078602
*                                                                Y02134 78080602
         LR    RF,R0                    SAVE CS OPERAND          Y02134 78082602
         SLL   RF,K25                   LEAVE ONLY UCBDMCT COUNT Y02134 78083002
         LTR   RF,RF                    TEST FOR COUNT OF 0      Y02134 78083102
         BZ    VUS07120                 BRANCH IF ALREADY 0      Y02134 78083202
*                                                                Y02134 78088802
         LR    R1,R0                    LOAD OLD VALUE TO MODIFY Y02134 78090802
         SH    R1,ONE                   ADD DECREMENT TO COUNT   Y02134 78092802
         CS    R0,R1,UCBOB+(((UCBDMCT-UCBOB)/K4)*K4) UPDAT COUNT Y02134 78093202
         BNE   VUS07110                 BRANCH IF NOT THE SAME   Y02134 78093602
*                                                                Y02134 78094002
VUS07120 EQU   *                        ALREADY 0                Y02134 78094102
*                                                                Y02134 78094202
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 78094302
*                                                                Y02134 78108202
         RETURN ,                       RETURN TO CALLER         Y02134 78118202
         EJECT                                                          78120202
*                                                                Y02134 78122202
*****************************************************************Y02134 78136102
*                                                                Y02134 78150002
*        BRANCH TO CONTINUE PROCESSING                           Y02134 78200002
*                                                                Y02134 78250002
*****************************************************************Y02134 78300002
*                                                                Y02134 78350002
VUS09000 EQU   *                                                 Y02134 78400002
*                                                                Y02134 78450002
         MVC   DXVOLSEQ,ONE             RESET VOLSEQ TO ONE      Y02134 78450402
         MVC   DXVOLSR2,JFCBVOLS        RESTORE FIRST VOL SER    Y02134 78450802
*                                                                Y02134 78452002
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    YM3111 78452102
         BO    VUS09100                 BR IF EXCP, ASSUME PS    YM3111 78453402
*                                                                YM3111 78455402
         TM    DCBDSORG,DCBDSGDA        TEST IF BDAM             YM1289 78456702
         BZ    VUS09010                 BR IF NO                 YM7051 78458002
*                                                                YM1289 78459302
         SR    R0,R0                    GET NO. OF BDAM EXTENTS  YM1289 78460602
         IC    R0,DCBDRDX               SO FAR FROM DCB          YM1289 78461902
         SR    R1,R1                    GET BDAM EXTENTS ON 1ST  YM1289 78463202
         IC    R1,DS1NOEPV-DS1FMTID(,RCORE) VOL FROM F1 DSCB     YM1289 78464502
         SR    R0,R1                    SUBTRACT FROM CURRENT    YM1289 78465802
         STC   R0,DCBDRDX               UPDATE COUNT IN DCB      YM1289 78467102
         B     VUS09100                 RETURN TO CALLER         YM7051 78467502
*                                                                YM7051 78467902
VUS09010 EQU   *                        CHECK FOR ISAM           YM7051 78468302
*                                                                YM7051 78470402
         TM    DCBDSORG,DCBDSGIS        TEST IF ISAM             Y02134 78474002
         BNO   VUS09100                 BRANCH IF NOT ISAM       Y02134 78474102
*                                                                YM7535 78477502
ISAMLOAD EQU   X'18'                    QISAM LOAD MODE          YM7535 78479502
         TM    DCBMACRF+K1,ISAMLOAD     TEST FOR QISAM LOAD MODE YM7535 78481502
         BZ    VUS09100                 BRANCH IF NOT            YM7535 78481902
*                                                                Y02134 78482002
*        SETUP FOR ISAM 03B ABEND                                YM7535 78485202
         MVC   DXDCBLST(K1),DXDEBSYS    RESTORE ISAM OPTIONS     YM7051 78485402
*                                                                YM1289 78488802
VUS09100 EQU   *                        RESTORE POINTERS & EXIT  Y02134 78492202
*                                                                Y02134 78495602
         MVC   DXDSAB,DXDSABAD          RESTORE DSAB PTRS        Y02134 78499002
         L     RTIOT,DXDSABAD           GET DSAB ADDRESS         Y02134 78502402
         L     RTIOT,DSABTIOT-DSAB(,RTIOT) RESTORE TIOT ENTRY    Y02134 78505802
         MVC   DXUCBADR+K1(K3),DXUCBSAV+K1  RESTORE 1ST UCB ADDR YM6530 78509202
         MVC   DXUNITOF+K1(K1),DXUCBSAV RESTORE ENTRY OFFSET     Y02134 78512602
         XC    DXUCBSAV,DXUCBSAV        CLEAR TO SAVE FIRST UNIT Y02134 78516002
         XC    DXVOLSR1,DXVOLSR1        CLEAR DISMOUNTED VOL     YM3081 78519402
         L     RUCB,DXUCBADR            LOAD FIRST UCB           YM1350 78522802
*                                                                Y02134 78526202
         MVC   WTGIDTTR,DXSAVMOD        RETURN ROUTINE ADDR      YM1350 78529602
         XR    RET,RET                  CLEAR REG FOR IC INST    Y02134 78533002
         IC    RET,DXSAVOFF             PICK UP RETURN OFFSET    Y02134 78536402
*                                                                Y02134 78539802
         IECRES LOAD,BRANCH=QUEUED                               Y02134 78543202
         EJECT                                                          78546602
VUS10000 EQU   *                                               @ZA14612 78550037
*                                                              @ZA14612 78570037
         L     RF,SETLOCK               EPA OF SETLOCK ROUTINE @ZA14612 78590037
         BR    RF                       BRANCH TO ABEND 0C1    @ZA14612 78610037
*                                                              @ZA14612 78630037
VUS10060 EQU   *                                               @ZA14612 78650037
*                                                              @ZA14612 78670037
         L     RF,EXIT213               EPA OF 213 EXIT ROUTINE@ZA14612 78690037
         BR    RF                       BRANCH TO EXIT         @ZA14612 78710037
*                                                              @ZA14612 78730037
VUS10070 EQU   *                                               @ZA14612 78750037
*                                                              @ZA14612 78770037
         L     RF,EXITB37               EPA OF B37 EXIT ROUTINE@ZA14612 78790037
         BR    RF                       BRANCH TO EXIT         @ZA14612 78810037
*                                                                Y02134 78955202
*****************************************************************Y02134 78958002
*                                                                Y02134 78958402
*        DETERMINE PROPER RETURN CODE FOR NON-SPECIFIC VOLUME    Y02134 78958502
*                                                                Y02134 78958802
*****************************************************************Y02134 78958902
*                                                                Y02134 78959202
VUS10085 EQU   *                                                 Y02134 78959302
*                                                                Y02134 78959402
         CLC   JFCBNVOL,JFCBVLSQ+K1     INVALID VOL SEQ          Y02134 78959602
         BNL   VUS10090                 BRANCH IF VOLSEQ INVALID YM3916 78959702
*                                                                Y02134 78959902
         LA    R0,K8                    OPEN=413-1C EOV=837-08   Y02134 78963202
*                                                                Y02134 78970002
VUS10090 EQU   *                        GET INTERNAL CODE        Y02080 79000002
*                                                                Y02080 79050002
*****************************************************************Y02134 79052002
*                                                                Y02134 79054002
*        DETERMINE PROPER RETURN CODE FOR OPEN OR EOV            Y02134 79056002
*                                                                Y02134 79058002
*****************************************************************Y02134 79058402
*                                                                Y02134 79058802
         LA    RF,VUSERRFF              GET LENGTH OF CODE LIST  Y02080 79060002
         CR    RF,R0                    CHECK IF CODE IS OK      Y02134 79070002
         BNL   VUS10092                 BRANCH IF OK             Y02080 79080002
         LA    R0,K0                    SET BAD CODE IN REG 0    Y02080 79090002
*                                                                Y02134 79092002
VUS10092 EQU   *                        OKAY                     Y02080 79094002
*                                                                Y02080 79096002
         LA    RF,VUSERR19              POINT TO OPEN CODES      Y02080 79100002
         CLC   VUSEOV,WTGMODNM+K3       CHECK FOR EOV CALL       Y02080 79150002
         BNE   VUS10095                 BRANCH IF OPEN           Y02080 79160002
         LA    RF,VUSERR55              POINT TO EOV  CODES      Y02080 79170002
*                                                                Y02134 79180002
VUS10095 EQU   *                        OPEN                     Y02080 79190002
*                                                                Y02080 79192002
         AR    RF,R0                    ADD ERROR OFFSET         Y02080 79194002
         IC    R0,K0(RF)                INSERT PROPER PD CODE    Y02080 79196002
*                                                                Y02134 79198002
VUS10100 EQU   *                        SPECIFIC REQUEST         Y02080 79198102
*                                                                Y02080 79198202
         MVC   DXRETMOD,ID4A4A          SET UP RETURN MOD        Y02080 79198402
         LA    RET,K24                  SET UP RETURN OFFSET     Y02080 79198802
*                                                                Y02134 79199202
*        NOTE - 4A RETURN MODULE SAVED AT DXSAVMOD               Y02080 79199602
*                                                                Y02080 79199702
         DMABCOND (0),ID4A0P                                     Y02080 79200002
         EJECT                                                          79202002
*                                                                Y02134 79210002
*****************************************************************Y02134 79220002
*                                                                Y02134 79240002
*        THIS IS THE ENTRY WHEN THE USER, IN HIS ABEND EXIT      Y02134 79242002
*        ROUTINE, HAS SUPPLIED A NEW VOLUME SERIAL NUMBER AND    Y02134 79244002
*        RETURNED A CODE, TO PROBLEM DETERMINATION, SPECIFYING   Y02134 79246002
*        THAT AN ATTEMPT TO RECOVER BE MADE.                     Y02134 79248002
*                                                                Y02080 79248102
*        CALLER RETURN IS ALREADY SET UP AT DXSAVMOD.            Y02080 79248202
*                                                                Y02080 79248402
*        NECESSARY CLEANUP IS PERFORMED TO ALLOW THE DCB TO BE   Y02134 79248502
*        REPROCESSED.                                            Y02134 79248802
*                                                                Y02134 79248902
*****************************************************************Y02134 79249002
*                                                                Y02134 79249202
VUS11000 EQU   *                                                 Y02080 79249302
*                                                                Y02080 79249402
         MVC   DXRETMOD,DXSAVMOD        SET UP RETURN LOAD       YM5728 79251402
         MVC   DXRETCOD,DXSAVOFF        SET UP RETURN OFFSET     YM5728 79253402
         L     RUCB,DXUCBADR            LOAD CURRENT UCB ADDRESS Y02080 79259402
         L     RTIOT,DXTIOTAD           LOAD TIOT ADDRESS        Y02080 79259502
         XC    DXVOLSR1,DXVOLSR1        ZERO OUT OLD VOLSER      Y02080 79271602
         TM    DXATGENS,DXATDMCT        TEST IF COUNT INCR       YM5728 79279602
         BNO   VUS03000                 RETRY WITH NEW VOLS      YM5728 79281602
         BAL   RET,VUS07100             DECREMENT DM COUNT       Y02134 79283002
         B     VUS03000                 RETRY WITH NEW VOLS      YM5728 79283102
         EJECT                                                          79283202
*                                                                       79283302
*********************************************************************** 79300002
*                                                                       79350002
*        CONSTANTS                                                      79400002
*                                                                       79450002
*********************************************************************** 79500002
*                                                                       79550002
SETLOCK  DC    A(VUS20000)              SETLOCK ERROR ROUTINE  @ZA14612 79550437
EXIT213  DC    A(VUS20060)              213 EXIT ROUTINE       @ZA14612 79550737
EXITB37  DC    A(VUS20070)              B37 EXIT ROUTINE       @ZA14612 79551037
SETMODE  DC    A(VUS20075)              SETMODE ROUTINE        @ZA15095 79551137
LASTVOL  DC    A(VUS20090)              LAST VOLUME ROUTINE    @ZA14612 79551337
DEQLIST  DS    0F                       DEQ LIST                 YM5728 79551637
         DEQ   (SYSZVOLS,,6,SYSTEM),TCB=0,MF=L                   YM5728 79552002
SYSZVOLS DC    CL8'SYSZVOLS'            VOL SER ENQ MAJOR NAME   Y02134 79560002
SCRTCH   DC    CL6'SCRTCH'              SCRTCH VOLUME SERIAL     Y02134 79600002
BLANKS   DC    CL8' '                   BLANK VOLUME SERIAL      Y02134 79650002
ZEROS    DC    XL6'00'                  ZERO VOLUME SERIAL       Y02134 79700002
VUSVIO   DC    CL6'VIO   '              DUMMY VOL SER FOR VIO    YM3822 79705002
VOL5     DC    H'5'                     THE CONSTANT FIVE        Y02134 79750002
VOL6     DC    H'6'                     THE CONSTANT SIX         Y02134 79800002
VOL15    DC    H'15'                    THE CONSTANT FIFTEEN     Y02134 79850002
ONE      DC    H'1'                     CONSTANT ONE             Y02134 79900002
MAXIMUM  DC    X'7F'                    MAXIMUM DA USERS = 127   Y02134 79902002
VUSB37   DC    X'00000B37'              B37 ABEND CODE           Y02134 79904002
VUSEOV   DC    CL3'055'                 EOV MODULE ID            Y02134 79910002
*                                                                Y02080 79912002
         EJECT                                                          79912402
VUSERR19 DC    AL1(0)                   OPEN ERROR CODES         Y02080 79914002
         DC    AL1(0)                   CODE 1 = CANNOT HAPPEN   Y02080 79914402
         DC    AL1(1)                   CODE 2 = 413-04          YM1238 79914802
         DC    AL1(8)                   CODE 3 = 413-18          Y02080 79915202
         DC    AL1(37)                  CODE 4 = 413-1C          Y02080 79915302
         DC    AL1(50)                  CODE 5 = 113-18          Y02080 79915602
         DC    AL1(8)                   CODE 6 = 413-18          Y02080 79915702
         DC    AL1(8)                   CODE 7 = 413-18          Y02080 79915802
         DC    AL1(37)                  CODE 8 = 413-1C          Y02080 79915902
         DC    AL1(32)                  CODE 9 = 113-08          Y02080 79916302
         DC    AL1(1)                   CODE 10 = 413-04         Y02080 79916702
         DC    AL1(246)                 CODE 11 = 213-28         YM1238 79917102
         DC    AL1(6)                   CODE 12 = 513-04         Y02080 79917202
         DC    AL1(43)                  CODE 13 = 013-64         Y02080 79917602
         DC    AL1(42)                  CODE 14 = C13-10         Y02080 79918102
         DC    AL1(220)                 CODE 15 = C13-18        SA66776 79918202
*                                                                Y02134 79918302
VUSERR55 DC    AL1(0)                   EOV  ERROR CODES         Y02080 79918802
         DC    AL1(0)                   CODE 1 = CANNOT OCCUR    Y02080 79919002
         DC    AL1(0)                   CODE 2 = CANNOT OCCUR    Y02080 79919202
         DC    AL1(0)                   CODE 3 = CANNOT OCCUR    Y02080 79919402
         DC    AL1(0)                   CODE 4 = CANNOT OCCUR    Y02080 79919602
         DC    AL1(0)                   CODE 5 = CANNOT OCCUR    Y02080 79919802
         DC    AL1(0)                   CODE 6 = CANNOT OCCUR    Y02080 79920002
         DC    AL1(197)                 CODE 7 = 837-08          Y02080 79927202
         DC    AL1(197)                 CODE 8 = 837-08          Y02080 79929202
         DC    AL1(197)                 CODE 9 = 837-08          Y02080 79931202
         DC    AL1(168)                 CODE 10 = B37-04         Y02080 79931602
         DC    AL1(247)                 CODE 11 = B37-0C         YM1238 79933602
         DC    AL1(248)                 CODE 12 = 837-0C         YM1238 79934002
         DC    AL1(0)                   CODE 13 = CANNOT OCCUR   Y02080 79934402
         DC    AL1(0)                   CODE 14 = CANNOT OCCUR   Y02080 79934802
         DC    AL1(0)                   CODE 15 = CANNOT OCCUR  SA66776 79934902
VUSERRFF EQU   VUSERR55-VUSERR19        LENGTH OF CODE LIST      Y02080 79935002
*                                                                Y02134 79942502
         EJECT                                                          79944502
         XCTLTABL ID=(ID4A4A,4A,ID4A4C,4C,ID4A4F,4F,ID4A4J,4J,   Y02134X79950002
               ID4A0P,0P,ID4A5G,5G,,IFG0554T),                   YM6514X79960002
               SVC=019,BRT=SHORT,LENGTH=4K                     @ZA14612 80000037
         EJECT                                                 @ZA14612 80100037
*                                                              @ZA14612 80200037
***************************************************************@ZA14612 80800037
*                                                              @ZA14612 81000037
*        AN ERROR HAS BEEN DETECTED.                           @ZA14612 81200037
*                                                              @ZA14612 81400037
***************************************************************@ZA14612 81600037
*                                                              @ZA14612 81800037
VUS20000 DMABCOND PCK,SETLOCK           SETLOCK INTERFACE ERROR@ZA14612 82000037
*                                                              @ZA14612 82200037
***************************************************************@ZA14612 82400037
*                                                              @ZA14612 82600037
*        GO TO 213 EXIT ROUTINE                                @ZA14612 82800037
*                                                              @ZA14612 83000037
***************************************************************@ZA14612 83200037
*                                                              @ZA14612 83400037
VUS20060 EQU   *                                               @ZA14612 83600037
*                                                              @ZA14612 83800037
         LA    R0,K30                   LOAD 213-04 CODE       @ZA14612 84000037
         IECRES LOAD,MODID=ID4A5G,BRCODE=K0,BRANCH=QUEUED      @ZA14612 84200037
*                                                              @ZA14612 84400037
***************************************************************@ZA14612 84600037
*                                                              @ZA14612 84800037
*        GO TO B37 EXIT ROUTINE                                @ZA14612 85000037
*                                                              @ZA14612 85200037
***************************************************************@ZA14612 85400037
*                                                              @ZA14612 85600037
VUS20070 EQU   *                                               @ZA14612 85800037
*                                                              @ZA14612 86000037
         TM    DXDCBLST,PLISTOIN        OUTPUT OR OUTIN        @ZA14612 86200037
         BNO   VUS10090                 BRANCH IF NEITHER      @ZA14612 86400037
*                                                              @ZA14612 86600037
         CLC   VUSEOV,WTGMODNM+K3       CHECK FOR EOV          @ZA14612 86800037
         BNE   VUS10090                 BRANCH IF NOT EOV      @ZA14612 87000037
*                                                              @ZA14612 87200037
         ICM   RD,B'1111',VUSB37        LOAD B37 ABEND CODE    @ZA14612 87400037
         LA    RC,EABD185               LOAD B37 ABEND CODE    @ZA14612 87600037
         IECRES LOAD,MODNM=IFG0554T,BRCODE=K0,BRANCH=QUEUED    @ZA14612 87800037
         EJECT                                                 @ZA14612 88000037
*                                                              @ZA14612 88200037
         USING  *,RF                   ESTABLISH ADDRESSABILITY@ZA18540 88220037
*                                                              @ZA18540 88224037
VUS20075 EQU   *                                               @ZA15095 88228037
         CLC   VUSOPEN,WTGMODNM+K3      OPEN IN CONTROL?       @ZA18540 88232037
         BNE   VUS05005                 CONTINUE               @ZA18540 88236037
         MODESET EXTKEY=SUPR                                   @ZA15095 88240037
*                                                              @ZA15095 88260037
         NI    UCBSTAT,ALLBITS-UCBDADI  SET SL NOT MOUNTED     @ZA15095 88280037
         XC    UCBVOLI,UCBVOLI          CLEAR VOL SERIAL       @ZA15095 88300037
*                                                              @ZA15095 88320037
         MODESET EXTKEY=DATAMGT                                @ZA15095 88340037
*                                                              @ZA15095 88360037
         B     VUS05005                 CONTINUE BLP PROCESS   @ZA15095 88380037
*                                                              @ZA18540 88385037
         DROP  RF                                              @ZA18540 88390037
*                                                              @ZA18540 88395037
***************************************************************@ZA14612 88400037
*                                                              @ZA14612 88600037
*   TEST LAST FMT 1 AREA FOR THE LAST VOLUME INDICATOR         @ZA14612 88800037
*                                                              @ZA14612 89000037
***************************************************************@ZA14612 89200037
*                                                              @ZA14612 89400037
         USING  *,RF                   ESTABLISH ADDRESSABILITY@ZA14612 89460037
*                                                              @ZA14612 89520037
VUS20090 EQU   *                                               @ZA14612 89600037
*                                                              @ZA14612 89800037
         STM   RTIOT,RET,DXREG9         SAVE REGS 9-14 IN W.A. @ZA14612 90000037
         LR    RB,RCORE                 GET FIRST AREA POINTER @ZA14612 90200037
*                                                              @ZA14612 90400037
VUS20100 EQU   *                                               @ZA14612 90600037
*                                                              @ZA14612 90800037
         NC    CORECH(R4,RB),CORECH(RB) IS THERE A NEXT AREA   @ZA14612 91000037
         BZ    VUS20400                 NO, GO TEST FOR THE    @ZA14612 91200037
*                                       LAST VOLUME INDICATOR  @ZA14612 91400037
VUS20200 EQU   *                                               @ZA14612 91600037
*                                                              @ZA14612 91800037
         L     RA,CORECH(RB)            POINT TO NEXT AREA     @ZA14612 92000037
         CLI   K0(RA),CHAR1             IS IT A FORMAT 1 AREA  @ZA14612 92200037
         BNE   VUS20300                 BRANCH IF NOT          @ZA14612 92400037
         LR    RB,RA                    USE IT AS CURRENT      @ZA14612 92600037
         B     VUS20100                 DO IT AGAIN            @ZA14612 92800037
*                                                              @ZA14612 93000037
VUS20300 EQU   *                        NEXT AREA IS NOT       @ZA14612 93200037
*                                       A FORMAT 1 AREA        @ZA14612 93400037
         LA    RA,L'JFCBDSNM(,RA)       INCREMENT PASSED KEY   @ZA14612 93600037
         NC    CORECH(K4,RA),CORECH(RA) IS THERE A NEXT AREA   @ZA14612 93800037
         BZ    VUS20400                 NO USE PREVIOUS AREA   @ZA14612 94000037
         LR    RB,RA                    UPDATE REG B           @ZA14612 94200037
         B     VUS20200                 TRY AGAIN              @ZA14612 94400037
*                                                              @ZA14612 94600037
VUS20400 EQU   *                        TEST FOR LAST VOLUME   @ZA14612 94800037
*                                       REG B POINTS TO DSCB   @ZA14612 95000037
*                                                              @ZA14612 95200037
         TM    K49(RB),K128             IS THIS THE LAST VOLUME@ZA14612 95400037
         BO    VUS20500                 BRANCH IF IT IS        @ZA14612 95600037
         LM    RTIOT,RET,DXREG9         RESTORE REGS 9-14      @ZA14612 95800037
         B     VUS03224                 TEST FOR MORE VOLUMES  @ZA14612 96000037
*                                                              @ZA14612 96200037
VUS20500 EQU   *                                               @ZA14612 96400037
*                                                              @ZA14612 96600037
         LM    RTIOT,RET,DXREG9         RESTORE REGS 9-14      @ZA14612 96800037
         B     VUS03223                 DON'T USE ANY          @ZA14612 97000037
*                                       MORE VOLUMES           @ZA14612 97200037
         DROP  RF                                              @ZA14612 97260037
*                                                              @ZA14612 97320037
*                                                                       97328037
*********************************************************************** 97336037
*                                                                       97344037
*        CONSTANTS                                                      97352037
*                                                                       97360037
*********************************************************************** 97368037
*                                                                       97376037
VUSOPEN  DC    CL3'019'                 OPEN MODULE ID         @ZA18540 97384037
*                                                                       97392037
         EJECT                                                 @ZA14612 97400037
         XCTLTABL BRT=YES,LENGTH=                              @ZA14612 97600037
         IECDSECS CVT,TCB,JSCB,TIOT,PSA,DSAB,DCB,DSCB1,UCB,      Y02146X97800037
               MAIN,WTG,PREFX,EXPAND=YES                         Y02146 98000037
         END                                                            98200037
