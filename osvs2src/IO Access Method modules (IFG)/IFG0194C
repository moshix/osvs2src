         TITLE 'IFG0194C                      DIRECT ACCESS MOUNT VERIF*00200000
               ICATION ROUTINE'                                  Y02134 00210000
IFG0194C CSECT                                                          00800000
         ENTRY IFG0554C                 ENTRY FROM EOV           Y02134 00805000
IFG0554C EQU   IFG0194C                 ALIAS ENTRY POINT        Y02134 00810000
*********************************************************************** 01000000
*                                                                     * 01200000
* MODULE NAME = IFG0194C (OS/VS2)                                     * 01250000
*                                                                     * 01260000
* CHANGE ACTIVITY - AS FOLLOWS:                                       * 01270000
*                                                                     * 01280000
*        VS2 RELEASE 2 DELETIONS                               @ZM30032 01290000
*                                                                     * 01340000
*        VS2 RELEASE 3 DELETIONS                                      * 01390000
*0000034249,420496-420522,525424,600403-600420,609900-611020   @Y30LSBS 01440000
*0000000000                                                    @Z40RSDH 01490000
*0000477640,477680                                             @ZA02859 01540000
*0000                                                          @ZA03658 01590000
*0000                                                          @ZA02209 01640000
*0000                                                          @ZA04643 01690000
*0000                                                          @ZA02225 01740000
*0000                                                          @ZA05097 01790000
*0000                                                          @ZA08882 01840000
*0000                                                          @ZA08332 01890000
*C60660,C47404                                                 @ZA33308 01910000
*A525583-525584,C525585,A600410,607312-607323                  @ZA26665 01910100
*C515025                                                       @ZA30123 01920000
*                                                                     * 01940000
*        VS2 RELEASE 3.818 ADDITIONS/CHANGES/DELETIONS                * 01990000
*A610686,610696,610726                                         @ZA29779 02010000
*C621381                                                       @ZM44627 02040000
*A000                                                          @G18MSBS 02090000
*C000048538-048738,525702,525712,525732                        @G18MSBS 02140000
*D000034987,034991,420484-420615,420762-420777                 @G18MSBS 02190000
*                                                                       02329900
*        VS2 RELEASE 3.832 ADDITIONS/CHANGES/DELETIONS                * 02359900
*SEQUENCE LINE NUMBER RIPPLE HAS CAUSED A LARGE NUMBER OF      @G32DSMI 02389900
*LINES TO BE RE-SEQUENCED. PREVIOUS LINE REFERENCE BY SEQUENCE @G32DSFS 02419900
*NUMBERS MAY THEREFORE NOT BE MEANINGFUL                       @G32DSFS 02449900
*        VS2 RELEASE 3.860 ADDITIONS/CHANGES DELETIONS         @G60ASRB 02470000
*C404800-404880,486036-486600,492850-493200,498250-498350,     @G60ASRB 02473900
*C515015-515045,515135-515165,515300,530000-530400             @G60ASRB 02477900
*A504401-504419,548884-549412,600484-600486,608639-608898,     @G60ASRB 02481900
*A609611-609740,611081-611107,621413-621423,628961-629001,     @G60ASRB 02485900
*A629081-629411,877261-883261                                  @G60ASRB 02489900
*D498000,530600-534800,607896                                  @G60ASRB 02493900
*                                                              @ZA32427 02495900
*                                                              @ZA32427 02497900
*                                                                     * 02499900
* FUNCTION = 1. FINDS THE VOLUME LABEL READ AREA;                     * 03200000
*            2. READS THE VOLUME LABEL FROM RECORD 3 TRACK 0;         * 03250000
*            3. DETERMINES IF THERE ARE ANY OUTSTANDING MOUNT REQUESTS* 03300000
*            4. VERIFIES IF VOLUME IS ON DEVICE; CHECKS FOR ASCENDING * 03350000
*            VOLUME SEQUENCE NUMBERS, EXPIRATION DATE,                * 03360000
*            RAC AUTHORIZATION AND/OR PASSWORD;                       * 03363000
*            5. UPDATES VOLUME DISPOSITION IN UCB:                    * 03370000
*               A. PRIVATE OR NOT PRIVATE                             * 03390000
*               B. PASS OR NOT PASS                                   * 03392000
*               C. PUBLIC OR NOT PUBLIC                               * 03394000
*            6A. READ DSCB OF THE DATA SET                     @G60ASRB 03396000
*            INDICATED BY THE DSNAME IN                        @G60ASRB 03396600
*            THE JFCB FROM THE VOLUME INDICATED IN THE INPUT. THE     * 03398000
*            DSCB IS READ WITH THE EXTENTS OF THE VTOC. IT IS READ    * 03398400
*            DIRECTLY USING THE TTR IN THE JFCB OR A SEARCH IS        * 03398800
*            PERFORMED ON THE DSNAME IF THE JFCB TTR IS NOT AVAILABLE.* 03398900
*            6B. IF FORMAT 1 DSCB NOT FOUND, THEN CALL THE     @G60ASBJ 03399200
*            INSTALLATION EXIT MODULE IFG0EX0A.  RETURN CODE   @G60ASRB 03400000
*            FROM EXIT IS -                                    @G60ASRB 03400800
*                0 CONTINUE                                    @G60ASRB 03401600
*                4 RETRY ONE TIME THE READ OF THE DSCB         @G60ASRB 03402400
*                8 EXIT ERROR-ABEND                            @G60ASRB 03403200
*            7. THE JFCB DSCB TTR IS UPDATED IF NECESSARY.            * 03405200
*            8. THE EXTENTS OF THE DATA SET ARE VERIFIED.             * 03406200
*            9. THE VOLUME IS MADE SECURE IF THE DATA SET IS A        * 03412200
*            CHECKPOINT DATA SET.                                     * 03424200
*            10. ANY FORMAT 2 AND 3 DSCBS ARE READ (EXTENTS ARE       * 03424600
*            VERIFIED) AND CHAINED TO THE PREVIOUS WORK AREA.         * 03424700
*            11. ANY VERIFIED VIRTUAL VOLUME ON A JES3 MANAGED UNIT   * 03424800
*            WILL OFFER THE VOLUME CHOICE TO JES3 FOR APPROVAL.       * 03424900
*            12. LAST REFERENCED DATE OR BACKUP COPY BIT       @G60ASRB 03425100
*            UPDATED IN FORMAT 1 DSCB IF REQUIRED.  DSCB       @G60ASRB 03426100
*            WRITTEN   IF NOT THE FIRST DSCB1, SUCH AS CONCAT. @G60ASRB 03427100
*            PDS OR ISAM OR BDAM.  FIRST DSCB WRITTEN IN       @G60ASRB 03428100
*            IFG0196W.                                         @G60ASRB 03429100
*                                                              @G60ASRB 03430100
* NOTES = SEE BELOW                                                   * 03437400
*                                                                     * 03449900
*    DEPENDENCIES = CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER   * 03459900
*                   CODE WAS USED FOR ASSEMBLY.  THE MODULE MUST BE   * 03469900
*                   REASSEMBLED IF A DIFFERENT CHARACTER SET IS USED  * 03479900
*                   FOR EXECUTION.                                    * 03489900
*                                                                     * 03491900
*    RESTRICTIONS = NONE                                              * 03493900
*                                                                     * 03495900
*                                                                     * 03553200
*    PATCH LABEL = SEE NEXT TO LAST LABEL BEFORE ORG STATEMENT AT END * 03563200
*                  OF LISTING                                         * 03565200
*                                                                     * 03565600
* MODULE TYPE = CONTROL (OPEN,CLOSE,EOV DATA MANAGEMENT)              * 03566000
*                                                                     * 03566400
*    PROCESSOR = ASSEMBLER XF                                         * 03566500
*                                                                     * 03577600
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON ORG * 03587600
*                  STATEMENT AT END OF LISTING.                       * 03588000
*                                                                     * 03588400
*     ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,         * 03590800
*                  PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY, * 03591200
*                  LINK PACK AREA RESIDENT/PAGEABLE                   * 03591600
*                                                                     * 03592500
* ENTRY POINT = IFG0194C FROM OPEN                                    * 04200000
*               IFG0554C FROM EOV                                     * 04250000
*                                                                     * 04300000
*     PURPOSE = TO MOUNT AND VERIFY A SPECIFIED DIRECT ACCESS VOLUME. * 04350000
*                                                                     * 04400000
*     LINKAGE = IECRES LOAD,MODID=ID4C,BRCODE=OFFSET,BRANCH=QUEUED    * 04450000
*                                                                     * 04500000
* INPUT = STANDARD O/C/E INPUT.                                       * 04550000
*        DXVOLSR2 CONTAINS THE VOLUME SERIAL NUMBER OF THE            * 04552000
*        VOLUME SERIAL NUMBER OF THE VOLUME TO BE MOUNTED             * 04554000
*        AND DXUCBADR CONTAINS THE UCB ADDRESS OF THE UNIT            * 04556000
*        TO CONTAIN THE VOLUME. DXDSAB CONTAINS THE CURRENT           * 04558000
*        DSAB ADDRESS OF THE DATA SET BEING PROCESSED.                * 04558400
*                                                                     * 04560000
* OUTPUT = THE SPECIFIED VOLUME IS MOUNTED AND VERIFIED ON THE        * 04570000
*          SPECIFIED UNIT AND THE FORMAT 2 AND 3 DSCBS ARE            * 04572000
*          CHAINED TO THE WORK AREA CONTAING THE FORMAT 1.            * 04574000
*                                                                     * 04580000
* EXIT-NORMAL = IFG0194A - TO PARALLEL MOUNT MORE VOLUMES, OR         * 04590000
*                          TO LOOK-AHEAD MOUNT THE NEXT VOLUME, OR    * 04590400
*                          TO EXIT TO CALLER, OR                      * 04591200
*                          TO PROCESS DISP=MOD ERROR RECOVERY, OR     * 04591700
*                          TO REJECT VOLUME AND UNIT PASSED.          * 04592000
*               IFG0194J - TO ISSUE MESSAGES.                         * 04594000
*               IFG0195T - TO VERIFY PASSWORD FOR THE DATA SET.       * 04596000
*               IFG0554P - TO EXTEND THE DATA SET.                    * 04598000
*               IFG0EX0A - FORMAT 1 DSCB-NOT-FOUND             @G60ASRB 04598100
*                          INSTALLATION EXIT.                  @G60ASRB 04598200
*                                                                     * 04598400
* EXIT-ERROR = IFG0190P - PROBLEM DETERMINATION ROUTINE.              * 04598800
*                         SEE LABEL DAMVER19 FOR A LIST OF ABENDS     * 04599800
*                         PROCESS 413-30 FOR WRONG VOLUME MOUNT@Y30LSBS 04601800
*                         OPEN.                                @Y30LSBS 04602600
*                         PROCESS 737-38 FOR WRONG VOLUME MOUNT@Y30LSBS 04603000
*                         EOV.                                 @Y30LSBS 04604200
*                         PROCESS 03D-0C FOR BDAM ACCESSING    @ZA02225 04604600
*                         AN ISAM DATA SET DURING OPEN         @ZA02225 04605000
*                         PROCESS 413-34 FOR JES3 ERROR-OPEN   @ZM44627 04605400
*                         PROCESS 737-28 FOR JES3 ERROR-EOV    @G18MSBS 04605800
*                         737-04 I/O ERROR WRITING DSCB(EOV)   @G60ASRB 04606600
*                         737-3C DSCB-NOT-FOUND INSTALLATION   @G60ASRB 04607100
*                         EXIT ERROR(EOV)                      @G60ASRB 04607600
*              IFG0195G - TO PROCESS 213 ABEND.                       * 04608100
*                         213-18 I/O ERROR WRITING DSCB(OPEN)  @G60ASRB 04608600
*                         213-2C DSCB-NOT-FOUND INSTALLATION   @G60ASRB 04609100
*                         EXIT ERROR(OPEN).                    @G60ASRB 04609600
*                                                                     * 04610900
* EXTERNAL REFERENCES = AS FOLLOWS -                                  * 04614800
*                                                                     * 04618700
*    ROUTINES = IFG0190P - ALIAS IFG0550P.                            * 04622600
*               IFG0194A - ALIAS IFG0554A.                            * 04626500
*               IFG0194J - ALIAS IFG0554J.                            * 04628500
*               IFG0195T - ALIAS IFG0555T.                            * 04630500
*               IFG0195G.                                             * 04632500
*               IFG0554P.                                             * 04632900
*               IFG0EX0A.                                      @G60ASRB 04633000
*               IEAQCDSR                                       @G60ASRB 04633200
*               IEAVVMSR                                       @G60ASRB 04637200
*                                                                     * 04641200
*    DATA AREAS = SEE PARAMETERS OF IECDSECS MACRO.                   * 04649900
*                                                                     * 04659900
*    CONTROL BLOCKS = SEE PARAMETERS OF IECDSECS MACRO.               * 04669900
*                                                                     * 04671900
* TABLES = NUCLEUS UCB LOOK-UP TABLE.                                 * 04679900
*          OPEN/EOV INTERNAL ABEND CODE TABLE. ONE ERROR GENERATES A  * 04681900
*          DIFFERENT ABEND CODE FOR OPEN AND EOV.                     * 04683900
*                                                                     * 04689900
* MACROS = AS FOLLOWS -                                               * 04691900
*        IECDSECS                                                     * 04692300
*        IECEQU                                                       * 04692700
*        IECRES                                                       * 04693100
*        EXCP                                                         * 04693500
*        MODESET                                                      * 04693600
*        NIL                                                          * 04693700
*        DOM                                                          * 04693800
*        ENQ                                                          * 04743800
*        SETLOCK                                                      * 04753800
*        OIL                                                          * 04763800
*        TESTAUTH                                                     * 04773800
*        DMABCOND                                                     * 04783800
*        XCTLTABL                                                     * 04785800
*        IEFAJCTB                                              @G18MSBS 04793800
*        IEFASCTG                                              @G18MSBS 04803800
*        IEFJESCT                                              @G18MSBS 04813800
*        IEFJSSOB                                              @G18MSBS 04823800
*        IEFSSREQ                                              @G18MSBS 04833800
*                                                                     * 04843800
* CHANGE ACTIVITY = SEE CHANGE ACTIVITY BEFORE FUNCTION DESCRIPTION   * 04853800
*                                                                     * 04893800
*********************************************************************** 11400000
         EJECT                                                          35600000
         IECDSECS CVT,JSCB,TIOT,DSAB,PSA,DSCB1,DSCB4,DCB,ACB,    Y02146X35800000
               CDE,LPDE,                                       @G60ASRB*35802000
               UCB,IEZDEB,ICHACHKL,                            @Z40RSRJ*35803000
               MAIN,WTG,PREFX                                    Y02146 35805000
K213     EQU   213                      INDICATOR FOR 213 ABEND  Y02134 36450000
OUTPUT   EQU   X'0E'                    MASK FOR INPUT OR RDBACK Y02134 36500000
DSCBCKDS EQU   X'01'                    DSCB CHKPT INDICATOR     Y02083 36500100
DATAMGT  EQU   X'50'                    DM KEY                   YM3070 36500500
HIORDER  EQU   X'80'                    HI-ORDER BIT OF A BYTE @G18MSBS 36501000
SWAPREFX EQU   16                       PREFIX OF QUEUE ELEMENT@G18MSBS 36501500
         IECEQU AOS=YES,IEZDEB=YES      DEFINE EQUATES           YM3070 36502100
*                                                                       36600000
         USING FORCORE,RCORE            DEFINE BASE TO MAIN WORK AREA   36800000
         USING WTG,RWTG                 WHERE-TO-GO TABLE        Y02080 36850000
         USING USERPRML,RPARC           RPARC POINTS TO CURRENT  Y02134 36870000
         USING IHADCB,RDCB              RDCB POINTS TO DCB       Y02134 36910000
         USING TIOENTRY,RTIOT           DEFINE BASE TO TIOT DD ENTRY    37000000
         USING UCBOB,RUCB               DEFINE BASE TO MAIN UCB         37200000
*                                                                       37400000
         BALR  RBASE,R0                 ESTABLISH BASE REGISTER         37600000
         USING *,RBASE                  DEFINE BASE REGISTER            37800000
*                                                                Y02134 37805000
DAMV0000 EQU   *                        BASE ADDRESS           @Z40RSDH 37807000
         B     DAMV0010(RET)            BRANCH TO BRANCH TABLE   Y02134 37810000
*                                                                Y02134 37815000
DAMV0010 EQU   *                        BRANCH TABLE             YM1472 37820000
*                                                                Y02134 37825000
         B     DAMV0050                 BRANCH IF ENTRY FROM 4A  Y02134 37830000
         B     DAMV0100                 BRANCH ENTRY FROM REJECT Y02134 37835000
         B     DAMV2450                 RETURN FROM EXPIRATION   Y02134 37839000
         B     DAMV2550                 RETURN FROM PASSWORD     Y02083 37843800
         B     DAMV0020                 RETURN FROM CHECKPOINT   Y02083 37844200
*                                                                YM3925 37844700
DAMV0020 EQU   *                        CHECKPOINT WTOR RETURN   YM3925 37844800
*                                                                YM3925 37844900
         L     RF,CHKPTRET              GET RETURN ADDRESS       YM3925 37846900
         BR    RF                       RETURN FROM MESSAGE      YM3925 37847300
         EJECT                                                          37848900
*                                                                       40220000
DAMV0050 EQU   *                        VOLUME MOUNT/VERIFY      YM3070 40240000
*                                                                Y02134 40260000
*****************************************************************Y02134 40280000
*                                                                Y02134 40300000
*        FIND VOLUME LABEL READ AREA                             Y02134 40320000
*                                                                Y02134 40340000
*****************************************************************Y02134 40360000
*                                                                Y02134 40380000
         LA    RCORE,DXDSCB             CLEAR HI ORDER BYTE      Y02134 40381000
         LR    RB,RCORE                 INITIALIZE FOR LOOP      Y02134 40382000
*                                                                Y02134 40383000
DAMV0060 EQU   *                        LOOP TO FIND LAST AREA   YM1472 40402100
*                                                                Y02134 40413100
         C     RB,CORECH(,RB)           TEST FOR SAME AREA       YM3807 40444000
         BE    DAMV0090                 BRANCH IF REUSE REQUESTD Y02134 40448000
*                                                                Y02134 40448200
         CLI   DXDSCB-DXDSCB(RB),CHAR1  CHECK FOR F1 AREA        Y02134 40452000
         BNE   DAMV0070                 BRANCH NOT F1 AREA       Y02134 40456000
*                                                                Y02134 40456200
*        CHECK FOR PO BEFORE EXCP, DSORG FIELD EXISTS IN COPY    YM3925 40456300
*        EVEN IF NOT IN USERS DCB.                               YM3925 40456400
         TM    DCBDSORG,DCBDSGPO        BPAM & DSN = CHAR ONE    YM3925 40456500
         BO    DAMV0070                 BRANCH IF BPAM           YM3925 40456600
*                                                                YM3925 40456800
         TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP            Y02134 40457400
         BO    DAMV0075                 BR IF EXCP               YM3807 40457600
*                                                                Y02134 40458000
         TM    DCBDSORG,DCBDSGIS        TEST FOR ISAM            Y02134 40458100
         BNO   DAMV0075                 BRANCH IF NOT ISAM       YM3807 40458200
*                                                                Y02134 40458400
* CHECK FOR VOLUME ALREADY PROCESSED                             Y02134 40458500
* NOTE-AN AREA CHAINED FOR REUSE WILL NOT BE BYPASSED BY THE     YM1472 40460100
*      FOLLOWING CODE BECAUSE THE CONDITION BELOW WILL ALWAYS    YM1472 40462200
*      ARISE BEFORE THE CONDITION CAUSING THE RECHAINING.        YM1472 40462300
         CLC   DXUCBADR,DSCSCALO-DXDSCB(RB) VOL ALREADY PROC?    Y02134 40462400
         BE    DAMV6000                 BRANCH TO GET NEXT       Y02134 40464000
         B     DAMV0075                 BRANCH, CHECK NEXT AREA  YM3807 40465600
*                                                                Y02134 40467200
DAMV0070 EQU   *                        INCREMENT FOR AREAS      YM1472 40468800
*                                       PRECEDED WITH 44 BYTE KEYYM1472 40470400
*                                                                YM3807 40470800
         CR    RB,RCORE                 TEST IF FIRST AREA       YM3807 40471200
         BE    DAMV0075                 BRANCH IF FIRST          YM3807 40471600
*                                                                YM3807 40471700
         LA    RB,L'JFCBDSNM(,RB)       INCREMENT PASSED KEY     Y02134 40472000
*                                                                YM3807 40472400
DAMV0075 EQU   *                        INCREMENT TO NEXT AREA   YM3807 40472800
*                                                                YM3807 40473200
         NC    CORECH(K4,RB),CORECH(RB) TEST FOR END OF CHAIN    YM3807 40473300
         BZ    DAMV0080                 BRANCH IF END OF CHAIN   YM3807 40473400
*                                                                YM3807 40473500
         L     RB,CORECH(,RB)           LOAD NEXT CHAIN POINTER  YM3807 40473700
         B     DAMV0060                 BRANCH TO LOOP           Y02134 40474200
         EJECT                                                          40474400
*                                                                YM1472 40474600
*****************************************************************YM1472 40474800
*                                                                YM1472 40475000
*        GET NEXT AREA AND CHAIN TO LAST                         YM1472 40475200
*                                                                YM1472 40475400
*****************************************************************YM1472 40475600
*                                                                Y02134 40476300
DAMV0080 EQU   *                        BPAM F1 AREA GETS 44 MOREYM1472 40476800
*                                                                Y02134 40478400
*        CHECK FOR PO BEFORE EXCP, DSORG FIELD EXISTS IN COPY    YM3925 40480000
*        EVEN IF NOT IN USERS DCB.                               YM3925 40481000
         LA    R0,F1LTH                                        @G60ASRB 40482000
         TM    DCBDSORG,DCBDSGPO        BPAM CONCATENATION       Y02134 40483000
         BNO   DAMV0085                 BRANCH NOT BPAM          Y02134 40484000
         LA    R0,F1POLTH                                      @G60ASRB 40485000
*                                                                Y02134 40489600
DAMV0085 EQU   *                        GET F1 DSCB AREA         YM1472 40491200
*                                                                Y02134 40492800
         L     RF,ADDRF1                GET THE GETF1 ADDRESS  @G18MSBS 40494400
         BALR  RET,RF                   GO GET F1 DSCB AREA    @G18MSBS 40495400
*                                                                Y02134 40497600
         ST    R1,CORECH(,RB)           CHAIN AREAS              Y02134 40499200
         LR    RB,R1                    LOAD WORK AREA POINTER   Y02134 40500800
         EJECT                                                          40501200
*                                                                YM1472 40501600
*****************************************************************YM1472 40502000
*                                                                YM1472 40502100
*        MOVE DATA SET NAME TO AREA FOR BPAM CONCATENATION.      YM1472 40502200
*                                                                YM1472 40502300
*****************************************************************YM1472 40502800
*                                                                Y02134 40503500
*        CHECK FOR PO BEFORE EXCP, DSORG FIELD EXISTS IN COPY    YM3925 40506000
*        EVEN IF NOT IN USERS DCB.                               YM3925 40506400
         TM    DCBDSORG,DCBDSGPO        BPAM CONCATENATION       Y02134 40507200
         BNO   DAMV0089                 BRANCH NOT BPAM          Y02134 40508800
*                                                                Y02134 40510400
         LA    RD,INFMJFCB              LOAD POINTER TO JFCB     Y02134 40512000
         CLC   DXDSABAD,DXDSAB          CHECK IF CURRENT JFCB    Y02134 40513600
         BE    DAMV0087                 BRANCH IF CURRENT        Y02134 40515200
         LA    RD,TIOEJFCB              PTR TO CURRENT JFCB PTR  Y02134 40516800
         IECRES LOCJFCB,(RD)            LOCATE JFCB              Y02134 40518400
*                                                                YM1472 40520400
DAMV0087 EQU   *                        MOVE DSNM TO KEY OF DSCB YM1472 40531200
*                                                                Y02134 40532800
         MVC   JFCBDSNM-INFMJFCB(L'JFCBDSNM,RB),INFMJFCB-INFMJFCB(RD)   40534400
         LA    RB,L'JFCBDSNM(,RB)       POINT TO F1 AREA         Y02134 40536000
*                                                                Y02134 40537600
DAMV0089 EQU   *                        SAVE UCB ADDRESS         YM1472 40539200
*                                                                Y02134 40540800
         MVC   DXUCBSAV-DXUCBSAV+CORECH+K4(L'DXUCBADR,RB),DXUCBADR      40542400
         MVC   DXUCBSAV-DXUCBSAV+CORECH+K4(K1,RB),DXUNITOF+K1    Y02134 40544000
*                                                                Y02134 40545600
DAMV0090 EQU   *                        INDICATE END OF CHAIN    YM1472 40547200
*                                                                Y02134 40548800
         XC    CORECH(K4,RB),CORECH(RB) CLEAR CHAIN POINTER      Y02134 40550400
         EJECT                                                          40550800
*                                                                Y02134 40552000
*****************************************************************Y02134 40553600
*                                                                Y02134 40555200
*        SET UP EXTENT TO COVER THE WHOLE DISK.                  Y02134 40556800
*                                                                Y02134 40558400
*****************************************************************Y02134 40560000
*                                                                Y02134 40580000
DAMV0100 EQU   *                                                 Y02134 40600000
*                                                                Y02134 40620000
         XC    DXDEBSCC(K4),DXDEBSCC    EXTENT TO COVER DISK     Y02134 40640000
*                                                                Y02134 40660000
         L     RF,CVTPTR                GET CVT ADDR             Y02134 40680000
         L     RF,CVTZDTAB-CVT(,RF)     I/O DEVICE TABLE ADDRESS Y02134 40700000
*                                                                Y02134 40720000
         XR    R1,R1                    ZERO WORK REGISTER       Y02080 40884000
         IC    R1,UCBTBYT4              GET UCB DEVICE TYPE      Y02134 40900000
         IC    R1,0(R1,RF)              INDEX TO DEVICE OFFSET   Y02134 40920000
         AR    RF,R1                    ADDR OF DEVICE ENTRY     Y02134 40940000
         MVC   DXDEBECC(K4),0(RF)       SET MAX EXTENT FROM TBL  Y02134 40960000
         MVC   DXCCW8(K4),0(RF)         SAVE MAX PACK EXTENTS    Y02082 40980000
*                                                                Y02134 41000000
         MVC   DXDEBNTR,ODA0660K        SET TRACKS TO LARGEST NO Y02134 41020000
         MVC   DXDEBUCB+K1(K3),DXUCBADR+K1 UCB ADDRESS TO DEB    Y02134 41040000
         XC    DXDEBBIN,DXDEBBIN        ZERO OUT BIN NUMBER      Y02134 41060000
*                                                                YM3192 41062000
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         YM3822 41064000
         BO    DAMV0205                 BR IF VIO                YM3192 41066000
*                                                                YM3192 41068000
         EJECT                                                          41080000
*                                                                Y02134 41100000
*****************************************************************Y02134 41120000
*                                                                Y02134 41140000
*        TEST FOR OUTSTANDING MOUNT REQUEST.                     Y02134 41160000
*                                                                Y02134 41180000
*****************************************************************Y02134 41200000
*                                                                Y02134 41220000
         TM    UCBDMCT,UCBMOUNT         OUTSTANDING MOUNT        Y02134 41240000
         BNO   DAMV0200                 BRANCH, NO MOUNT ISSUED  Y02134 41260000
*                                                                Y02134 41280000
*****************************************************************Y02134 41300000
*                                                                Y02134 41320000
*        READ THE VOLUME LABEL FROM RECORD 3 OF TRACK 0.         Y02134 41340000
*        WILL GO INTO A WAIT STATE UNTIL THE VOLUME IS MOUNTED.  Y02134 41360000
*                                                                Y02134 41380000
*****************************************************************Y02134 41400000
*                                                                Y02134 41420000
         XC    DXDAADDR,DXDAADDR        DA VOL LABEL ADDR CCHH = 0000   41440000
         MVI   DXDAADDR+K7,K3           VOL LABEL IS ALWAYS RECORD 3    41460000
*                                                                Y02134 41480000
*****************************************************************Y02134 41500000
*                                                                       41520000
*        CONSTRUCT CHANNEL PROGRAM TO READ VOLUME LABEL.                41540000
*                                                                       41560000
*        SEARCH ID EQ                                                   41580000
*        TIC *-8                                                        41600000
*        READ DATA                                                      41620000
*                                                                       41640000
*****************************************************************Y02134 41660000
*                                                                Y02134 41680000
         XC    DXCCW1(K24),DXCCW1       CLEAR CCW AREA                  41700000
         LA    RF,DXDAADDR+K3           SEARCH ADDRESS                  41720000
         ST    RF,DXCCW1                                                41740000
         LA    RF,DXCCW1                TIC ADDRESS                     41760000
         ST    RF,DXCCW2                                                41780000
         ST    RB,DXCCW3                STORE READ IN AREA PTR   Y02134 41800000
         OC    DXCCW1(K24),ODA7440K     OR IN CMND CODE, FLAGS, LENGTH  41820000
         MVC   DXCCW2+K5(K3),DXDEBUCB+K1 SAVE UCB ADDRESS        Y02134 41840000
         EJECT                                                          41842000
*****************************************************************YM7890 41846000
*                                                                YM7890 41848000
*        IF MOUNT PENDING AND UNIT NOT READY MEMORY MAY          YM7890 41848400
*        NOT BE SWAPPED OUT, BECAUSE IF OPERATOR CANCELS         YM7890 41848800
*        THE JOB, THE JOB WILL NOT TERMINATE UNTIL THE           YM7890 41849200
*        MOUNT IS SATISFIED.                                     YM7890 41849600
*                                                                YM7890 41850000
*****************************************************************YM7890 41850100
*                                                                YM7890 41850200
         TM    UCBFL1,UCBNOTRD          TEST IF READY            YM7890 41850400
         BZ    DAMV0105                 BR READY- BYPASS NOSWAP  YM7890 41850800
*                                                                YM7890 41851600
         SYSEVENT DONTSWAP              IN CASE OPERATOR CANCEL  YM7890 41852000
*                                                                YM7890 41854000
         SLL   R1,K24                   CLEAR HI 3 BYTES         YM7890 41854100
         LTR   R1,R1                    CHECK FOR ERROR          YM7890 41854200
         BNZ   DAMV0105                 BRANCH IF ERROR          YM7890 41854300
*                                                                YM8511 41856300
         OI    DXATALL,DXATSWAP         SET RECOVERY INDICATOR   YM8511 41856700
*                                                                YM7890 41857500
         EXCP  DXIOB                    READ VOLUME LABEL        YM7890 41860800
*                                                                YM7890 41862800
         IECRES WAIT                    WAIT FOR I/O TO FINISH   YM7890 41863200
*                                                                YM8511 41863400
         NI    DXATALL,ALLBITS-DXATSWAP RESET RECOVERY INDICATOR YM8511 41863500
*                                                                YM7890 41863900
         SYSEVENT OKSWAP                ALLOW SWAPOUT-UNIT READY YM7890 41864000
*                                                                YM7890 41866000
         B     DAMV0110                 BRANCH TO VERIFY LABEL   YM7890 41867200
*                                                                YM7890 41870400
DAMV0105 EQU   *                        READ LABEL - UNIT READY  YM7890 41873600
*                                                                       41876800
         EXCP  DXIOB                    READ VOLUME LABEL               41880000
*                                                                       41900000
         IECRES WAIT                    WAIT FOR MOUNT AND LABEL READ   41920000
         EJECT                                                          41922000
*                                                                Y02134 41940000
DAMV0110 EQU   *                        VERIFY MOUNTED VOLUME    YM7890 41942000
*                                                                YM7890 41942400
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 41944000
         TM    DXECB,ECBNOERR           TEST FOR I/O ERROR     @ZA08332 41945800
         BZ    DAMV0111                 BRANCH IF I/O ERROR    @G18MSBS 41946200
         MVC   UCBVOLI,VOLSERNO-DXLBL(RB) VOL SERIAL FOR REJECT  YM7023 41946600
*                                                              @ZA08332 41947000
DAMV0111 EQU   *                                               @G18MSBS 41947400
*                                                              @ZA08332 41947800
*        RESET MOUNT BIT                                         Y02134 41949200
         NIL   UCBDMCT,ALLBITS-UCBMOUNT,REF=UCBOB,WREGS=(,,RF)   Y02134 41951000
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 41952800
*                                                                Y02134 41954600
         EJECT                                                          41956400
*        NO DOM SUPPORT AVAILABLE FOR DA BECAUSE OF UCB CHANGES  YM7310 42006400
         TM    DXECB,ECBNOERR           CHECK FOR I/O ERROR      Y02134 42016600
         BNZ   DAMV0112                 BR IF NO ERROR           Y02134 42020000
*                                                                Y02134 42030000
         CLC   DXVOLSR2,SCRTCH          CHECK IF SCRTCH REQUEST  Y02134 42032000
         LA    R0,K1                    OPEN=413-20 EOV=737-08   Y02080 42032400
         BNE   DAMV9900                 BRANCH IF SPECIFIC REQ   Y02134 42032800
         B     DAMV8000                 BRANCH TO GET NEW VOLUME Y02134 42032900
         EJECT                                                          42033000
*                                                                Y02134 42033200
DAMV0112 EQU   *                        VERIFY MOUNTED VOLUME    YM1472 42033600
         SPACE                                                          42040000
         CLC   DXVOLSR2,VOLSERNO-DXLBL(RB) CHECK FOR RIGHT VOL   Y02134 42041000
         BE    DAMV0115                 BRANCH, BYPASS DISMOUNT  Y02134 42042000
        SPACE                                                           42043000
         NC    DXVOLSR1,DXVOLSR1        WRONG VOL MNT INDICATOR@G18MSBS 42044000
         MVC   DXVOLSR1,VOLSERNO-DXLBL(RB) VOL SER FOR REJECT  @G18MSBS 42045000
         BNZ   DAMV0113                 BRANCH TO MSS TEST     @G18MSBS 42046000
        SPACE                                                           42047000
         CLC   DXVOLSR2,SCRTCH          SCRATCH REQUEST ?      @G18MSBS 42048000
         BE    DAMV0114                 YES, GO ENQ TO REJ VOL @G18MSBS 42049000
        SPACE                                                           42050000
DAMV0113 EQU   *                                               @G18MSBS 42051000
        SPACE                                                           42052000
         TM    UCBTBYT2,UCBRVDEV        VIRTUAL DASD ?         @G18MSBS 42053000
         BNO   DAMV8000                 NO, BRANCH TO REJ VOL  @G18MSBS 42054000
         SPACE                                                          42055000
*                      YES, SSC MOUNTED WRONG VIRTUAL VOLUME - @G18MSBS 42056000
         LA    R0,K14                   OPEN=413-30 EOV=737-38 @G18MSBS 42057000
         B     DAMV9900                 GO ABEND               @G18MSBS 42058000
        SPACE                                                           42059000
DAMV0114 EQU   *                                               @G18MSBS 42060000
        SPACE                                                           42061000
         MVC   DXWORK1(K16),ENQLIST     INIT ENQ LIST            Y02134 42076200
         L     RF,DXJSCBAD              LOAD JSCB ADDRESS        Y02134 42077400
         L     R0,JSCBTCBP-IEZJSCB(,RF) INITIATOR TCB POINTER    Y02134 42077500
DAMV0202 ENQ   (,DXVOLSR1),TCB=(0),RET=USE,MF=(E,DXWORK2),       Y02134X42077600
               RELATED=(SYSZVOLS,IFG0194A(VUS02450))             Y02134 42077700
*                                                                Y02134 42087200
         LTR   RF,RF                    VOLUME ALREADY IN USE    Y02134 42088800
         BNZ   DAMV8000                 BRANCH IF ERROR, REJECT  Y02134 42090700
         EJECT                                                          42091100
*                                                                Y02134 42091500
DAMV0115 EQU   *                        CONVERT MBBCCHHR TO TTR  YM1472 42092300
*                                                                Y02134 42092400
         XC    DXVOLSR1,DXVOLSR1        CLEAR REJECT VOLUME      Y02134 42092500
*                                                                Y02134 42092600
         L     RF,WTGPREFX              LOAD PREFIX ADDRESS      Y02134 42092700
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134 42094500
*                                                                Y02134 42100000
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02082 42104000
*                                                                Y02134 42108000
DAMV0120 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02134X42120000
               RELATED=(LOCAL,IFG0194C(DAMV0190))                Y02134 42140000
*                                                                Y02134 42140800
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 42144000
*                                                                Y02134 42160000
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 42180000
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134 42200000
         BNZ   DAMV9000                 BRANCH IF SETLOCK ERROR  Y02134 42220000
*                                                                       42300000
*********************************************************************** 42320000
*                                                                       42340000
*  CONVERT VTOC ADDR FROM MBBCCHHR TO TTR FORM                          42360000
*                                                                       42380000
*********************************************************************** 42400000
*                                                                       42420000
         MVC   DXDAADDR+K3(K5),VOLVTOC-DXLBL(RB) CCHHR VTOC ADDR Y02134 42440000
         L     RF,IECPRLTV              EPA OF IECPRLTV CONV RTN YM3070 42442000
         BALR  RET,RF                   LINK TO CONVERT ROUTINE  YM3070 42460000
         ST    R0,DXDAADDR              SAVE CONVERTED TTR       Y02134 42480000
         EJECT                                                          42482000
*                                                                       42500000
*********************************************************************** 42520000
*                                                                       42540000
*        INSERT VTOC TTR ADDR IN UCB.                            Y02134 42560000
*                                                                       42580000
*********************************************************************** 42600000
*                                                                       42620000
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 42624000
         MVC   UCBVTOC(K3),DXDAADDR     PLACE VTOC TTR INTO UCB  Y02134 42640000
         MVC   UCBVOLI,VOLSERNO-DXLBL(RB) MOVE SERIAL NO. TO UCB Y02134 42644000
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02134 42649000
*                                                                Y02134 42660000
         L     RF,WTGPREFX              LOAD PREFIX ADDRESS      Y02134 42680000
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134 42700000
*                                                                Y02134 42720000
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02134 42725000
*                                                                Y02134 42730000
DAMV0190 SETLOCK RELEASE,TYPE=LOCAL,                             Y02134X42740000
               RELATED=(LOCAL,IFG0194C(DAMV0120))                Y02134 42760000
*                                                                Y02134 42780000
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 42784000
*                                                                Y02134 42788000
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 42800000
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134 42820000
         BNZ   DAMV9000                 BRANCH IF SETLOCK ERROR  Y02134 42840000
         B     DAMV0205                 GET VOLUME DISPOSITION   Y02134 42860000
         EJECT                                                          42862000
*                                                                Y02134 42893300
*****************************************************************Y02134 42900000
*                                                                Y02134 42920000
*        VERIFY VOLUME ON DEVICE                                 Y02134 42940000
*                                                                Y02134 42960000
*****************************************************************Y02134 42980000
*                                                                Y02134 43000000
DAMV0200 EQU   *                        VERIFY PREMOUNTED VOLUME YM1472 43020000
*                                                                Y02134 43040000
         CLC   UCBVOLI,ZEROS            CHECK FOR NO VOL         Y02134 43140000
         BE    DAMV8000                 BRANCH IF NO VOL         Y02134 43160000
*                                                                Y02134 43260000
         NC    DXVOLSR1,DXVOLSR1        WRONG VOL MNT INDICATOR  YM1472 43310000
         BNZ   DAMV8000                 BRANCH TO REJECT         YM1472 43410000
*                                                                Y02134 43796800
*****************************************************************Y02134 43800000
*                                                                Y02134 43820000
*        UPDATE UCB VOLUME DISPOSITION                           Y02134 43840000
*                                                                Y02134 43860000
*****************************************************************Y02134 43880000
*                                                                Y02134 43900000
DAMV0205 EQU   *                                                 Y02134 43920000
*                                                                Y02134 43940000
         XC    DXVOLSR1,DXVOLSR1        CLEAR REJECT VOLUME      Y02134 43944000
*                                                                Y02134 43948000
         L     RF,WTGPREFX              LOAD PREFIX ADDRESS      Y02134 43960000
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134 43980000
*                                                                Y02134 44000000
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02082 44004000
*                                                                Y02134 44008000
DAMV0210 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02134X44020000
               RELATED=(LOCAL,IFG0194C(DAMV0290))                Y02134 44040000
*                                                                Y02134 44060000
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 44064000
*                                                                Y02134 44068000
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 44080000
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134 44100000
         BNZ   DAMV9000                 BRANCH IF SETLOCK ERROR  Y02134 44120000
*                                                                Y02134 44140000
         TM    UCBDMCT,UCBDMC-K1        TEST FOR ONE USER        Y02134 44160000
         BNZ   DAMV0285                 BRANCH, MORE THAN 1 USER Y02134 44180000
         TM    UCBSTAB,UCBBSVL          TEST FOR SHAREABLE       Y02134 44200000
         BZ    DAMV0285                 BRANCH IF SHAREABLE UNIT Y02134 44220000
*                                                                Y02134 44240000
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 44257600
         NI    UCBJBNR,ALLBITS-UCBMONT  SET PASS TO 0            YM1472 44260000
         NI    UCBSTAB,ALLBITS-UCBBPRV  SET PRIVATE TO 0         YM1472 44280000
         NI    UCBSTAB,ALLBITS-UCBBPUB  SET PUBLIC TO 0          YM1472 44300000
         OI    UCBSTAT,UCBDADI          INDICATE SL VOLUME       YM1472 44320000
*                                                                Y02134 44340000
* REGISTER RB RESTORED AFTER SETLOCK RELEASE                     Y02134 44345000
         L     RB,DXDSAB                CURRENT DSAB POINTER     Y02134 44360000
         TM    DSABFLG3-DSAB(RB),DSABPASS TEST FOR PASSED DATA   Y02134 44380000
         BNO   DAMV0220                 BRANCH IF NOT PASSED     Y02134 44400000
*                                                                Y02134 44420000
         OI    UCBJBNR,UCBMONT          SET PASS INDICATOR       YM1472 44440000
*                                                                Y02134 44460000
DAMV0220 EQU   *                        TEST PRIVATE REQUEST     Y02134 44480000
*                                                                Y02134 44500000
         TM    TIOESTTA,TIOSDSP1        TEST FOR PRIVATE DATA    Y02134 44520000
         BNO   DAMV0230                 BRANCH IF NOT PRIVATE    Y02134 44540000
*                                                                Y02134 44560000
         OI    UCBSTAB,UCBBPRV          SET PRIVATE INDICATOR    YM1472 44580000
*                                                                Y02134 44600000
DAMV0230 EQU   *                        TEST PUBLIC REQUEST      Y02134 44620000
*                                                                Y02134 44640000
         TM    TIOESTTA,TIOSDSP2        TEST FOR PUBLIC DATA     Y02134 44660000
         BNO   DAMV0280                 BRANCH IF NOT PUBLIC     Y02134 44680000
*                                                                Y02134 44700000
         OI    UCBSTAB,UCBBPUB          SET PUBLIC INDICATOR     YM1472 44720000
*                                                                Y02134 44740000
DAMV0280 EQU   *                        SEE IF NOT SCRTCH        Y02134 44760000
*                                                                Y02134 44780000
         TM    TIOESTTA,TIOSDSP1        TEST FOR PRIVATE DATA    Y02134 44800000
         BNO   DAMV0285                 BRANCH IF NOT PRIVATE    Y02134 44820000
*                                                                Y02134 44840000
         L     RET,UCBEXTPT             LOAD UCB EXTENSION PTR   Y02146 44860000
         USING UCBCMEXT,RET             RET POINTS TO EXTENSION  Y02146 44865000
         OI    UCBFLP1,UCBNSRCH         SET NON-SCRTCH INDICATOR Y02146 44868000
         DROP  RET                                               Y02146 44872100
*                                                                Y02134 44872200
DAMV0285 EQU   *                        RELEASE LOCK             Y02134 44873000
*                                                                Y02134 44874000
         MODESET EXTKEY=ZERO            SETLOCK KEY              Y02082 44877000
*                                                                Y02134 44920000
DAMV0290 SETLOCK RELEASE,TYPE=LOCAL,                             Y02134X45000000
               RELATED=(LOCAL,IFG0194C(DAMV0210))                Y02134 45020000
*                                                                Y02134 45040000
         MODESET EXTKEY=DATAMGT         DM KEY                   Y02082 45052000
*                                                                Y02134 45056000
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 45060000
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134 45080000
         BNZ   DAMV9000                 BRANCH IF SETLOCK ERROR  Y02134 45100000
         EJECT                                                          46540000
*                                                                Y02134 46560000
*****************************************************************Y02132 46561500
*                                                                Y02132 46563000
*        TEST FOR VIO UCB BEFORE READING F1 OR F4 DSCB'S         Y02132 46564500
*                                                                Y02132 46566000
*****************************************************************Y02132 46566300
*                                                                Y02134 46566700
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02132 46567500
         BNO   DAMV1010                 BR IF NOT                Y02132 46569000
*                                                                Y02134 46569400
*****************************************************************Y02132 46569800
*                                                                Y02132 46570200
*        READ FORMAT ONE DSCB FROM SWA FOR VIO                   Y02132 46570500
*                                                                Y02134 46570900
*****************************************************************Y02132 46571300
*                                                                Y02132 46571700
         LA    R0,K3                    OPEN=213-04 EOV=737-04   YM7888 46572200
         LA    RD,INFMJFCB              LOAD POINTER TO JFCB     YM7888 46572300
         CLC   DXDSABAD,DXDSAB          CHECK IF CURRENT JFCB    YM7888 46572400
         BE    DAMV1005                 BRANCH IF CURRENT        YM7888 46572500
         LA    RD,TIOEJFCB              POINT TO CURRENT JFCB    YM7888 46572600
         IECRES LOCJFCB,(RD)            LOCATE JFCB              YM7888 46572800
*                                                                YM7888 46572900
DAMV1005 EQU   *                        USE JFCB TTR IF VALID    YM7888 46573000
         CLC   K0(L'JFCBDSNM,RD),VDSDSCB-VDSUCB(RUCB) DSNS EQUAL YM7888 46573100
         BNE   DAMV9100                 BRANCH IF NOT CORRECT    YM7888 46573400
*                                                                Y02132 46573500
         MVC   K0(DSCEXT2-DSCFMTID,RB),VDSDSCB-VDSUCB+L'JFCBDSNM(RUCB)  46574000
*                                                                Y02132 46574500
         OC    K0(DSCEXT2-DSCFMTID,RB),K0(RB) IS DSCB = ZERO?    Y02132 46575000
         BZ    DAMV9100                 BRANCH IF DSCB NOT FOUND Y02132 46576500
*                                                                Y02132 46578000
         XC    DSCEXT2-DXDSCB(DSCBEND-DSCEXT2,RB),DSCEXT2-DXDSCB(RB)    46579500
*                                                                Y02132 46581000
         B     DAMV2000                 CONTINUE PROCESSING      Y02132 46582500
*                                                                Y02134 46582900
DAMV1010 EQU   *                        READ FORMAT 4            YM1472 46584000
*                                                                Y02134 46586000
*****************************************************************Y02134 46590000
*                                                                Y02134 46600000
*        READ THE FORMAT 4 DSCB TO INITIALIZE THE DEB            Y02134 46620000
*        EXTENTS TO THOSE OF THE VTOC                            Y02134 46640000
*                                                                Y02134 46660000
*****************************************************************Y02134 46680000
*                                                                Y02134 46700000
         LA    R1,UCBVTOC               LOAD POINTER TO VTOC TTR Y02134 46720000
         L     RF,IECPCNVT              EPA OF IECPCNVT CONV RTN YM3070 46722000
         BALR  RET,RF                   LINK TO CONVERT ROUTINE  YM3070 46740000
         EJECT                                                          46742000
*                                                                Y02134 46760000
*****************************************************************Y02134 46780000
*                                                                Y02134 46800000
*        CONSTRUCT CHANNEL PROGRAM TO READ FORMAT 4              Y02082 46820000
*        SEARCH ID EQ                                            Y02134 46840000
*        TIC *-8                                                 Y02134 46860000
*        SEARCH KEY EQ                                           Y02134 46880000
*        NOP  (NO CHAIN BIT, SLI)                                Y02134 46900000
*        READ DATA (DSCB)                                        Y02134 46920000
*                                                                Y02134 46970000
*****************************************************************Y02134 46972000
*                                                                Y02134 46980000
         XC    DXCCW1(K40),DXCCW1       CLEAR AREA (5 CCWS)      Y02134 47000000
         LA    RF,DXDAADDR+K3           SEARCH ADDRESS           Y02134 47020000
         ST    RF,DXCCW1                                         Y02134 47040000
         LA    RF,DXCCW1                TIC ADDRESS              Y02134 47060000
         ST    RF,DXCCW2                                         Y02134 47080000
         MVC   K0(K4,RB),ODA0670K       MOVE KEY TO SEARCH ON    Y02082 47100000
         ST    RB,DXCCW3                                         Y02134 47140000
         ST    RB,DXCCW5                                         Y02134 47180000
         OC    DXCCW1(K40),ODA0640K     CMND CODE, FLAGS, LENGTH Y02134 47200000
         OI    DXCCW3+K4,CCWSILI        SLI BIT ON SEARCH KEY    Y02082 47220000
         MVI   DXCCW3+K7,K4             SEARCH 4 BYTES OF KEY    Y02082 47240000
*                                                                Y02134 47260000
         EXCP  DXIOB                    READ DSCB VIA EXCP       Y02134 47280000
*                                                                Y02134 47300000
         IECRES WAIT                    WAIT FOR READ TO FINISH  Y02134 47320000
*                                                                Y02134 47340000
         LA    R0,K1                    OPEN=413-20 EOV=737-08   Y02080 47350000
         TM    DXECB,ECBNOERR           CHECK FOR IO ERROR       Y02134 47360000
         BZ    DAMV9900                 BR IF I/O ERROR          Y02082 47380000
*                                                                Y02134 47384000
         CLI   DXDSCB-DXDSCB(RB),CHAR4  CHECK FOR F4 READ        Y02134 47388000
         BNE   DAMV9900                 BRANCH IF BAD PACK       Y02134 47392000
*                                                                Y02134 47401600
         CLC   JFCBDSNM,ODA0670K        TEST FOR VTOC DSNAME   @ZA33308 47404000
         BNE   DAMV1020                 BRANCH IF NOT            Y02134 47408000
*                                                                Y02134 47408400
         TM    UCBJBNR,UCBJES3          DOES JES3 MANAGE UNIT? @G18MSBS 47409000
         BNO   DAMV1015                 NO, CONTINUE           @G18MSBS 47409100
         TM    UCBTBYT2,UCBRVDEV        YES, THEN VIRTUAL VOL? @G18MSBS 47409200
         BNO   DAMV1015                 NO, CONTINUE           @G18MSBS 47409300
         LA    RC,K4                    SET FINAL PASS SWITCH  @G18MSBS 47409400
         L     RF,JES3ROUT              GET JES3 ROUTINE ADDR  @G18MSBS 47409500
         BALR  RET,RF                   BRANCH TO JES3 ROUTINE @G18MSBS 47409600
DAMV1015 EQU     *                                             @G18MSBS 47409700
         MVC   DXCCW7(K5),DXDAADDR+K3   SAVE DSCB CCHHR TO UPDAT Y02134 47409800
         B     DAMV7000                 FORMAT 4 REQUESTED       Y02082 47410000
         EJECT                                                          47410100
*                                                                Y02134 47410400
DAMV1020 EQU   *                        SAVE CCHHR               YM1472 47411000
*                                                                Y02134 47412000
         MVC   DXCCW6(K4),DS4VTOCE+K6-DSCB4(RB) SAVE END CCHH    Y02082 47420000
         MVC   DXCCW6+K4(K1),DS4DEVDT-DSCB4(RB) SAVE R           Y02082 47440000
*                                                                Y02134 47440400
*****************************************************************Y02134 47440800
*                                                                Y02134 47442000
*        DXCCW6 CONTAINS THE CCHHR OF THE HIGHEST DSCB ON THE    Y02082 47445000
*        VTOC                                                    Y02082 47450000
*                                                                Y02134 47460000
*****************************************************************Y02134 47470000
*                                                                Y02134 47500000
         LA    RD,INFMJFCB              LOAD POINTER TO JFCB     Y02134 47504000
         CLC   DXDSABAD,DXDSAB          CHECK IF CURRENT JFCB    Y02134 47508000
         BE    DAMV1050                 BRANCH IF CURRENT        Y02134 47512000
         LA    RD,TIOEJFCB              POINT TO CURRENT JFCB    Y02134 47520000
         IECRES LOCJFCB,(RD)            LOCATE JFCB              Y02134 47540000
*                                                                Y02134 47560000
DAMV1050 EQU   *                        USE JFCB TTR IF VALID    Y02134 47564000
*                                                                Y02134 47568000
         CLC   DXVOLSR2,JFCBVOLS-INFMJFCB(RD) FIRST VOLUME       Y02134 47580000
         BNE   DAMV1100                 BR IF NOT FIRST VOLUME   Y02134 47600000
*                                                                Y02134 47620000
         CLC   JFCBDSCB-INFMJFCB(K3,RD),UCBVTOC TTR INVALID OR 0 Y02134 47640000
         BL    DAMV1100                 INVALID-SEARCH FULL VTOC Y02134 47660000
*                                                                Y02134 47680000
         LA    R1,JFCBDSCB-INFMJFCB(,RD) LOAD POINTER TO DSCB    Y02134 47700000
         L     RF,IECPCNVT              EPA OF IECPCNVT CONV RTN YM3070 47722000
         BALR  RET,RF                   LINK TO CONVERT ROUTINE  YM3070 47724000
         LTR   RF,RF                    TTR WITHIN VTOC?         Y02082 47740000
         BNZ   DAMV1100                 BR IF TTR OUTSIDE VTOC   Y02082 47760000
         CLC   DXDAADDR+K3(K4),DS4VTOCE+K6-DSCB4(RB) CCHH      @ZA02859 47764000
*                                       WITHIN THE VTOC        @ZA02859 47766000
         BH    DAMV1100                 BRANCH IF NOT            Y02082 47772000
         EJECT                                                          47774000
*                                                                Y02134 47780000
*****************************************************************Y02134 47800000
*                                                                Y02134 47820000
*        CONSTRUCT CHANNEL PROGRAM TO READ DSCB DIRECTLY         Y02134 47840000
*        SEARCH ID EQ                                            Y02134 47860000
*        TIC *-8                                                 Y02134 47880000
*        SEARCH KEY EQ                                           Y02134 47900000
*        NOP  (NO CHAIN BIT, SLI)                                Y02134 47920000
*        READ DATA (DSCB)                                        Y02134 47940000
*                                                                Y02134 47960000
*        CHANNEL PROGRAM TO READ FORMAT 4 IS CORRECT TO READ     Y02082 47980000
*        FORMAT 1 EXCPT THE SEARCH KEY EQUAL MUST SEARCH ON 44   Y02082 48000000
*        BYTES OF THE JFCB DSNAME AND OMIT THE SLI BIT           Y02082 48020000
*                                                                Y02134 48040000
*****************************************************************Y02134 48060000
*                                                                Y02082 48080000
         MVI   DXCCW3+K7,L'JFCBDSNM     COUNT OF 44              Y02082 48100000
         NI    DXCCW3+K4,ALLBITS-CCWSILI TURN OFF SLI BIT        Y02082 48120000
         LA    RF,JFCBDSNM-INFMJFCB(,RD) DATA SET NAME KEY ADDR  Y02082 48140000
         STCM  RF,B'0111',DXCCW3+K1     STORE KEY ADDR IN CCW    Y02134 48160000
*                                                                Y02082 48340000
         EXCP  DXIOB                    READ DSCB VIA EXCP       Y02134 48360000
*                                                                Y02134 48380000
         IECRES WAIT                    WAIT FOR READ TO FINISH  Y02134 48400000
*                                                                Y02134 48420000
         TM    DXECB,ECBNOERR           CHECK FOR IO ERROR       Y02134 48440000
         BZ    DAMV1100                 BR IF YES, SEARCH VTOC   Y02134 48460000
*                                                                Y02134 48480000
         LA    RF,DXCCW6                TEST IF CHANNEL PROGRAM  Y02134 48500000
         L     R1,IOBCOMAD              TERMINATED AFTER READ    Y02134 48520000
         LA    R1,0(R1)                 CCW BY EXAMINING CSW     Y02134 48540000
         CR    R1,RF                    STORED IN IOB            Y02134 48560000
         BNE   DAMV1100                 BR IF NO, SEARCH VTOC    M0033  48580000
*                                                                Y02134 48600000
*        DO NOT MOVE CCHHR INTO DXCCW7 FOR THE EXECUTORS UNLESS  Y02134 48600400
*        THIS IS THE FIRST DSCB READ                             Y02134 48600800
*                                                                Y02134 48601200
         LA    RB,K0(,RB)               CLEAR HIGH BYTE          Y02134 48602400
         LA    RCORE,K0(,RCORE)         CLEAR HIGH BYTE          Y02134 48602800
         CR    RB,RCORE                 IS THIS FIRST DSCB READ  Y02134 48603200
         BNE   DAMV1070                 BRANCH IF NOT          @G60ASRB 48603600
         MVC   DXCCW7(K5),DXDAADDR+K3   SAVE DSCB CCHHR TO UPDAT Y02134 48608600
*                                                                Y02134 48613600
         B     DAMV2000                 BRANCH TO PROCESS F1     Y02134 48618600
*                                                              @G60ASRB 48623600
DAMV1070 EQU   *                        SAVE CCHHR             @G60ASRB 48628600
*                                                              @G60ASRB 48633600
         MVC   F1CCHHR-F1DATA(,RB),DXDAADDR+K3 MOVE CCHHR OF   @G60ASRB*48638600
                                        F1 DSCB                @G60ASRB 48643600
         B     DAMV2000                 PROCESS F1             @G60ASRB 48648600
         EJECT                                                          48662000
*                                                                Y02134 48680000
*****************************************************************Y02134 48700000
*                                                                Y02134 48720000
*        START SEARCHING FOR DSCB FROM THE START OF THE VTOC.    Y02134 48740000
*                                                                Y02134 48760000
*****************************************************************Y02134 48780000
*                                                                Y02134 48800000
DAMV1100 EQU   *                                                 Y02134 48820000
*                                                                Y02134 48840000
         L     R1,UCBVTOC               LOAD TTR OF VTOC AND     Y02134 48860000
         SRL   R1,K8                    DECREMENT R BY ONE TO    Y02134 48880000
         BCTR  R1,R0                    READ COUNT & READ R1     Y02134 48900000
         ST    R1,DXWORK1               AFTER SEARCH FOR R0      Y02134 48920000
         LA    R1,DXWORK1+K1            POINT TO TTR             Y02134 48940000
         L     RF,IECPCNVT              EPA OF IECPCNVT CONV RTN YM3070 48962000
         BALR  RET,RF                   LINK TO CONVERT ROUTINE  YM3070 48964000
*                                                                Y02134 48980000
*****************************************************************Y02134 49000000
*                                                                Y02134 49020000
*        CONSTRUCT CHANNEL PROGRAM TO READ FORMAT 1 DSCB         Y02082 49040000
*                                                                Y02134 49060000
*DXCCW1  SEARCH ID EQUAL (VTOC CCHHR)                            Y02082 49080000
*DXCCW2  TIC *-8                                                 Y02082 49100000
*DXCCW3  TIC TO GETMAIN WORKAREA                                 Y02082 49120000
*                                                                Y02134 49130000
*        GETMAIN AREA                                            Y02082 49140000
*                                                                Y02134 49150000
*WACCW1  SEARCH ID EQ MULTI-TRACK (CCHHR OF LAST DSCB IN VTOC)   Y02082 49160000
*WACCW2  TIC WACCW6                                              Y02082 49180000
*WACCW3  SEARCH KEY EQUAL (DATA SET NAME)                        Y02082 49200000
*WACCW4  NOP (COUNT=1, SLI BIT ON)                               Y02082 49220000
*WACCW5  TIC WACCW8                                              Y02082 49240000
*WACCW6  SEARCH KEY EQUAL (DATA SET NAME)                        Y02082 49260000
*WACCW7  TIC WACCW1                                              Y02082 49280000
*WACCW8  READ DATA (96 BYTES)                                  @G60ASRB 49285000
*WACCW9  READ COUNT (DXCCW7 IF FIRST DSCB, OR F1CCHHR IF NOT)  @G60ASRB 49295000
*                                                                Y02082 49340000
*****************************************************************Y02082 49345000
*                                                                Y02134 49350000
*        GO GET STORAGE AREA FOR THE ABOVE CCW'S               @G18MSBS 49360000
*                                                              @G18MSBS 49360400
         L     RF,ADDRCCWS              GET ADDRESS OF GETCCWS @G18MSBS 49360800
         BALR  RET,RF                   GO GET THE WORK AREA   @G18MSBS 49361200
*                                                                Y02082 49362000
*****************************************************************Y02082 49364000
*                                                                Y02082 49365000
*        R1 POINTS TO CCW AREA - SAVE IN DXCCW3 AS TIC ADDRESS   Y02082 49380000
*                                                                Y02082 49390000
*****************************************************************Y02082 49392000
*                                                                Y02082 49400000
         USING WACCW,R1                                          Y02082 49420000
         ST    R1,DXCCW3                SAVE IN DXCCW3           Y02082 49440000
         MVI   DXCCW3,CCWTIC            MAKE DXCCW3 A TIC        Y02082 49460000
         XC    WACCW1(K72),WACCW1       CLEAR CCWS               Y02082 49480000
         LA    RF,DXCCW6                HIGH VTOC CCHHR          Y02082 49500000
         ST    RF,WACCW1                STORE IN SERRCH ID HIGH  Y02082 49520000
         LA    RF,WACCW6                TIC TO ADDR              Y02082 49540000
         ST    RF,WACCW2                SAVE IN TIC              Y02082 49560000
         LA    RF,JFCBDSNM-INFMJFCB(,RD) DATA SET NAME           Y02082 49580000
         ST    RF,WACCW3                SAVE IN SEARCH KEY       Y02082 49600000
         ST    RF,WACCW6                SAVE IN OTHER SEARCH KEY Y02082 49620000
         LA    RF,WACCW8                TIC TO ADDR              Y02082 49640000
         ST    RF,WACCW5                STORE IN TIC             Y02082 49660000
         LA    RF,WACCW1                TIC TO ADDR              Y02082 49680000
         ST    RF,WACCW7                STORE IN TIC             Y02082 49700000
         LA    RF,K0(,RB)               DSCB BUFFER              Y02082 49720000
         ST    RF,WACCW8                STORE IN READ DATA       Y02082 49740000
         LA    RF,DXCCW7                COUNT ADDRESS            Y02082 49760000
         ST    RF,WACCW9                STORE IN READ COUNT      Y02082 49780000
         LA    RCORE,K0(,RCORE)         CLEAR HI BYTE FOR CR     Y02082 49805000
         LA    RB,K0(,RB)               CLEAR HI BYTE FOR CR     Y02082 49810000
         CR    RB,RCORE                 IS DSCB TO BE READ INTO  Y02082 49815000
*                                       DCB WORKAREA             Y02082 49820000
         BE    DAMV1150                 BRANCH IF YES          @G60ASRB 49825000
         LA    RF,F1CCHHR-F1DATA(,RB)   CCHHR AREA             @G60ASRB 49831000
         ST    RF,WACCW9                PUT IN READ COUNT CCW  @G60ASRB 49837000
*                                                              @G60ASRB 49843000
DAMV1150 EQU   *                        OR IN OP CODES         @G60ASRB 49849000
*                                                              @G60ASRB 49855000
         OC    WACCW1(K72),ODA0650K     OR IN CMDS,FLGS,COUNTS @G60ASRB 49861000
*                                                              @G60ASRB 49867000
         NI    DXFLAG1,X'FF'-DXEX0A01   ZERO THE SECOND PASS   @G60ASRB*49873000
                                        BIT                    @G60ASRB 49879000
         EJECT                                                 @G60ASRB 49885000
*                                                                Y02134 49900000
DAMV1200 EQU   *                        READ A FORMAT 1 DSCB     YM1472 49905000
*                                                                Y02134 49910000
         EXCP  DXIOB                    READ DSCB VIA EXCP       Y02134 49920000
*                                                                Y02134 49940000
         IECRES WAIT                    WAIT FOR READ TO FINISH  Y02134 49960000
*                                                                Y02082 49980000
*****************************************************************Y02134 50000000
*                                                                Y02082 50020000
*        CHECK FOR I/O ERROR                                     Y02082 50040000
*                                                                Y02082 50060000
*****************************************************************Y02134 50080000
*                                                                Y02082 50220000
         TM    DXECB,ECBNOERR           CHECK FOR I/O ERROR      Y02082 50240000
         BO    DAMV1300                 BR IF NO                 YM1472 50260000
*                                                                YM1472 50262000
*        CHECK FOR PO BEFORE EXCP, DSORG FIELD EXISTS IN COPY    YM3925 50262100
*        EVEN IF NOT IN USERS DCB.                               YM3925 50262200
         TM    DCBDSORG,DCBDSGPO        TEST FOR BPAM DATA SET   YM3925 50262300
         LA    R0,K2                    OPEN=213-0C EOV=737-0C   YM3925 50262500
         BO    DAMV9100                 BRANCH, BPAM ERROR       YM3925 50262800
*                                                                YM3925 50263200
         LA    R0,K3                    OPEN=213-04 EOV=737-04   YM1459 50263500
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    YM1472 50264000
         BO    DAMV9100                 BRANCH EXCP, ASSUME PS   YM1472 50266000
         NC    DCBDSORG,DCBDSORG        CHECK IF DSORG SPECIFIED YM1472 50270000
         BZ    DAMV9100                 BRANCH 0, ASSUME PS      YM1472 50272000
         TM    DCBDSORG,DCBDSGPS        PHYSICAL SEQUENTIAL DCB  YM1472 50276000
         BO    DAMV9100                 BRANCH IF DSORG=PS       YM1472 50280000
*                                                                YM1472 50280100
         LA    R0,K2                    OPEN=213-0C EOV=737-0C   YM1472 50280400
         B     DAMV9100                 BRANCH IF NOT PS         YM1472 50280800
*                                                                YM1472 50281600
*****************************************************************YM1472 50281700
*                                                                YM1472 50281800
*        IF CSW INDICATES CHANNEL PROGRAM ENDED AT NOP, DSCB     YM1472 50281900
*        WAS NOT READ. THE DATA SET IS NOT ON THE VOLUME.        YM1472 50282600
*                                                                YM1472 50283500
*****************************************************************YM1472 50283600
*                                                                YM1472 50283700
DAMV1300 EQU   *                        CHECK FOR NO DSCB        YM1472 50284100
*                                                                YM1472 50284200
         L     RF,IOBCOMAD              CSW'S ENDING CCW+8       YM1472 50284600
         LA    RF,K0(,RF)               CLEAR HIGH BYTE          YM1472 50284700
         L     R1,DXCCW3                CCW AREA                 YM1472 50284800
         LA    R1,WACCW5                CCW PAST NOP             YM1472 50284900
         CR    RF,R1                    ARE THEY EQUAL           YM1472 50285000
         BE    DAMV1350                 BRANCH IF YES-NO DSCB    YM1472 50285100
         CLI   DXDSCB-DXDSCB(RB),CHAR1  FORMAT 1 ID              YM1472 50285200
         BE    DAMV1500                 BRANCH IF DATA SET FOUND YM1472 50285400
         DROP  R1                                                YM1472 50287500
*                                                                Y02134 50400000
DAMV1350 EQU   *                        PROCESS NO DSCB          YM1472 50420000
*                                                                Y02134 50440000
*                                                              @G60ASRB 50440100
*        CALL THE DSCB NOT FOUND INSTALLATION EXIT. RETURN     @G60ASRB 50440200
*        WILL CONTAIN RETURN CODE IN REG 15.                   @G60ASRB 50440300
*          0 - CONTINUE                                        @G60ASRB 50440400
*          4 - RETRY READ OF DSCB                              @G60ASRB 50440500
*          8 - EXIT ERROR                                      @G60ASRB 50440600
*                                                              @G60ASRB 50440700
         L     RF,DSNOTFA               SUBROUTINE ADDRESS     @G60ASRB 50440800
         BALR  RET,RF                                          @G60ASRB 50440900
         B     DAMV1360(RF)                                    @G60ASRB 50441000
DAMV1360 EQU   *                        TEST RESULT            @G60ASRB 50441100
         B     DAMV1370                 CONTINUE               @G60ASRB 50441400
         B     DAMV1200                 RETRY                  @G60ASRB 50441500
         B     DAMV9900                 ABEND                  @G60ASRB 50441600
*                                                              @G60ASRB 50442400
DAMV1370 EQU   *                        DSCB NOT FOUND         @G60ASRB 50442800
*                                                              @G60ASRB 50443200
*        CHECK FOR PO BEFORE EXCP, DSORG FIELD EXISTS IN COPY    YM3925 50443600
*        EVEN IF NOT IN USERS DCB.                               YM3925 50444000
         TM    DCBDSORG,DCBDSGPO        TEST FOR BPAM DATA SET   YM3925 50446000
         LA    R0,K2                    OPEN=213-0C EOV=737-0C   YM3925 50448000
         BO    DAMV9100                 BRANCH, BPAM ERROR       YM3925 50450000
*                                                                YM3925 50452000
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    Y02134 50460000
         BO    DAMV1400                 BRANCH EXCP, ASSUME PS   Y02134 50480000
*                                                                Y02134 50500000
         NC    DCBDSORG,DCBDSORG        CHECK IF DSORG SPECIFIED Y02134 50520000
         BZ    DAMV1400                 BRANCH 0, ASSUME PS      Y02134 50540000
*                                                                Y02134 50560000
         TM    DCBDSORG,DCBDSGPS        PHYSICAL SEQUENTIAL DCB  Y02134 50580000
         LA    R0,K2                    OPEN=213-0C EOV=737-0C   Y02134 50590000
         BNO   DAMV9100                 BRANCH IF NOT PS         Y02134 50600000
*                                                                Y02134 50620000
DAMV1400 EQU   *                        CHECK IF OUTPUT          YM1472 50640000
*                                                                Y02134 50660000
         TM    DXDCBLST,PLISTOIN        TEST FOR OUTPUT          YM1459 50661000
         LA    R0,K3                    OPEN=213-04 EOV=737-04   YM1459 50662000
         BNO   DAMV9100                 BRANCH IF INPUT NO DSCB  YM1459 50663000
*                                                                YM1459 50663200
         CLC   WTGMODNM+K3(K3),DAMVEOV  TEST FOR EOV             Y02134 50664000
         BNE   DAMV1450                 BRANCH IF NOT EOV        Y02134 50668000
*                                                                Y02134 50672000
         EJECT                                                          50676700
*                                                                Y02083 50676800
*****************************************************************Y02083 50676900
*                                                                Y02083 50680800
*        EOV CHECKPOINT DATA SET PROCESSING                      Y02083 50682800
*                                                                Y02083 50684800
*****************************************************************Y02083 50685000
*                                                                Y02083 50685400
         L     RF,DXDSAB                FETCH DSAB ADDRESS       YM1311 50685500
         TM    DSABFLG4-DSAB(RF),DSABCKDS TEST FOR CHKPT D/S     YM1311 50686400
         BZ    DAMV1420                 IF NOT, CONTINUE       @G18MSBS 50686800
*                                                                YM3925 50692000
         LA    RET,K52                  CAN VOL BE SECURED       YM3925 50692400
         L     RF,CHKPTWTO              GET MSG RTN ADDR         YM3925 50692500
         BALR  RC,RF                    ISSUE MESSAGE            YM3925 50692600
*                                                                YM3925 50692700
         LA    R0,K10                   OPEN=NA EOV=937-10       YM3925 50692800
         BNE   DAMV7510                 BRANCH IF NOT SECURE     YM5957 50693200
         L     RF,DXDSAB                FETCH DSAB ADDRESS       YM5957 50693300
         MODESET EXTKEY=SCHED           ASSUME DSAB KEY          YM5957 50693600
         OI    DSABFLG4-DSAB(RF),DSABCKVL SET SECURE BIT         YM5957 50693700
         MODESET EXTKEY=DATAMGT         RESUME D/M KEY           YM5957 50693800
         EJECT                                                          50694000
*                                                              @G18MSBS 50694100
***************************************************************@G18MSBS 50694200
*                                                              @G18MSBS 50694300
**       FOR JES3 MANAGED UNIT, OFFER VOLUME CHOICE TO JES3    @G18MSBS 50694400
**       FOR APPROVAL BEFORE TRYING TO EXTEND ON NEW VOLUME    @G18MSBS 50694500
*                                                              @G18MSBS 50694600
***************************************************************@G18MSBS 50694700
*                                                              @G18MSBS 50694800
DAMV1420 EQU   *                                               @G18MSBS 50694900
         TM    UCBJBNR,UCBJES3          DOES JES3 MANAGE UNIT? @G18MSBS 50695000
         BNO   DAMV1430                 NO, CONTINUE           @G18MSBS 50695100
         TM    UCBTBYT2,UCBRVDEV        YES, THEN VIRTUAL VOL? @G18MSBS 50695200
         BNO   DAMV1430                 NO, CONTINUE           @G18MSBS 50695300
         XR    RC,RC                    SET FIRST PASS SWITCH  @G18MSBS 50695400
         L     RF,JES3ROUT              GET JES3 ROUTINE ADDR  @G18MSBS 50695500
         BALR  RET,RF                   BRANCH TO JES3 ROUTINE @G18MSBS 50695600
*                                                                YM1472 50695700
*****************************************************************YM1472 50695800
*                                                                YM1472 50695900
*        TRY TO EXTEND ON NEW VOLUME                             YM1472 50696000
*                                                                YM1472 50696100
*****************************************************************YM1472 50696200
*                                                                YM1472 50696300
DAMV1430 EQU   *                                                 Y02083 50696400
*                                                              @ZA04643 50696500
***************************************************************@ZA04643 50696600
*                                                              @ZA04643 50696700
*        THE FORMAT1 DSCB HAS NOT BEEN FOUND ON THE NEW        @ZA04643 50696800
*        VOLUME. THEREFORE, SET THE 'TREAT AS NEW' INDICATOR   @ZA04643 50696900
*        IN THE DEB SO THAT THE NEXT EOV WILL TREAT THE DATA   @ZA04643 50697000
*        SET AS IF IT WERE NEW AND FOLLOW THE NORMAL RULES     @ZA04643 50697100
*        FOR OBTAINING SPACE ON THE VOLUME.                    @ZA04643 50697200
*                                                              @ZA04643 50697300
***************************************************************@ZA04643 50697400
*                                                              @ZA04643 50697500
         L     RET,DCBDEBAD             GET DEB ADDR           @ZA04643 50697600
         SR    RF,RF                    ZERO WORK REG          @ZA04643 50697700
         IC    RF,DEBNMEXT-DEBBASIC(RET) GET NUMBER OF EXTENTS @ZA04643 50697800
         SLL   RF,4                     MPY BY 16-BYTES/EXT    @ZA04643 50697900
         AR    RF,RET                   ADD DEB BASE ADDR      @ZA04643 50698000
         OI    DEBVOLSQ-DEBVOLSQ+DEBSUCBA-DEBBASIC(RF),JFCMOD  @ZA04643 50698100
*                                       TURN ON TREAT AS       @ZA04643 50698200
*                                       NEW SW IN DEB          @ZA04643 50698300
DAMV1435 EQU   *                                               @ZA04643 50698400
         MVI   DXRETCOD,K4              SET UP RETURN OFFSET     Y02134 50698500
         MVC   DXRETMOD,ID4C4C          SET UP RETURN MODULE     Y02134 50698600
         MVI   DXEXTSW,CHAR00           ZERO EXTEND SWITCH       Y02082 50698700
         LA    RCORE,K0(RCORE)          ZERO HI BYTE           @ZA08882 50698800
         ST    RCORE,CORECH(,RCORE)     REUSE W.A. FOR F1      @ZA05097 50698900
*                                                                Y02134 50699000
         IECRES LOAD,MODNM=IFG0554P,BRCODE=K8,BRANCH=QUEUED      Y02080 50699100
         EJECT                                                          50699200
*                                                                Y02134 50704400
*****************************************************************YM1472 50706400
*                                                                YM1472 50706800
*        CHECK FOR DISP=MOD AND OUTPUT                           YM1472 50707200
*                                                                YM1472 50707600
*****************************************************************YM1472 50708000
*                                                                YM1472 50708100
DAMV1450 EQU   *                                                 Y02082 50708300
*                                                                Y02134 50712200
*                                       TEST FOR DISP=MOD        Y02134 50716100
         TM    JFCBIND2-INFMJFCB(RD),JFCOLD NOT OLD OR NEW       Y02134 50720000
         LA    R0,K3                    OPEN=213-04 EOV=737-04   Y02134 50730000
         BO    DAMV9100                 BRANCH IF NOT MOD        Y02134 50740000
*                                                                Y02134 50760000
*****************************************************************Y02134 50780000
*                                                                Y02082 50800000
*        IF JFCBVLSQ IS GREATER THAN 1, IT MUST HAVE BEEN        Y02134 50820000
*        SPECIFIED IN THE DD STATEMENT.  A FAILURE TO FIND       Y02134 50840000
*        THE INITIAL DSCB ON VOLUME 1 WILL RESULT IN A 213       Y02134 50860000
*        ABEND, SINCE THERE CAN BE NO RECOVERY WHEN              Y02134 50880000
*        THE DATA SET IS NOT EVEN ON THE FIRST VOLUME.           Y02134 50900000
*                                                                Y02134 50920000
*****************************************************************Y02134 50940000
*                                                                Y02082 50960000
         CLC   JFCBVLSQ-INFMJFCB(L'JFCBVLSQ,RD),ONE VOL SEQ GE 1 Y02134 50980000
         LA    R0,K3                    OPEN=213-04 EOV=737-04   Y02134 50990000
         BNL   DAMV9100                 BR IF YES TO 213 ABEND   Y02134 51000000
*                                                                Y02134 51020000
*****************************************************************Y02134 51040000
*                                                                Y02134 51060000
*        DISP=MOD ERROR RECOVERY                                 Y02134 51080000
*                                                                Y02134 51100000
*****************************************************************Y02134 51120000
*                                                                Y02134 51140000
         ST    RB,CORECH(,RB)           CHAIN FOR REUSE          Y02134 51141000
         MVI   DXEXTSW,ALLBITS          DSCB NOT FOUND INDICATOR Y02134 51144000
*                                                                Y02134 51148000
         IECRES LOAD,MODID=ID4C4A,BRCODE=K20,BRANCH=QUEUED       Y02134 51160000
         EJECT                                                          51170000
*                                                                Y02134 51200000
*****************************************************************Y02134 51220000
*                                                                Y02134 51240000
*        IF THE VTOC DSCB SEARCH JUST DONE WAS FOR THE FIRST     Y02134 51260000
*        VOLUME, UPDATE THE JFCB DSCB TTR SO THAT THE DSCB CAN   Y02134 51280000
*        BE READ DIRECTLY THE NEXT TIME THE DATA SET IS OPENED.  Y02134 51300000
*                                                                Y02134 51320000
*****************************************************************Y02134 51340000
*                                                                Y02134 51360000
DAMV1500 EQU   *                                                 Y02134 51380000
*                                                                Y02082 51400000
*****************************************************************Y02134 51420000
*                                                                Y02082 51440000
*        IF R IN COUNT READ IS 1, THE COUNT OF THE DSCB READ IS  Y02082 51455000
*              THE LAST ON THE TRACK                             Y02082 51460000
*        OTHERWISE R MUST BE REDUCED BY ONE AS THE COUNT OF      Y02082 51460200
*              RECORD R+1 WAS READ                               Y02082 51460400
*                                                                Y02134 51461000
*****************************************************************Y02134 51462000
*                                                                Y02134 51463000
         USING WACCW,R1                 R1 POINTS TO CCWS        YM1472 51465000
         L     R1,DXCCW3                CCW AREA                 Y02082 51500300
         L     RF,WACCW9                CCHHR OF NEXT DSCB     @G60ASRB 51501500
         CLI   K4(RF),K1                IS RECORD NO. 1        @ZA30123 51502500
         BE    DAMV1550                 BR IF YES                Y02082 51506000
*                                                                Y02134 51506400
*****************************************************************Y02134 51506800
*                                                                Y02082 51507500
*        REDUCE R BY 1 AS CCHHR IS OF DSCB PAST THE ONE READ     Y02082 51509000
*                                                                Y02082 51510500
*****************************************************************Y02134 51510900
*                                                                Y02082 51511300
         SR    R1,R1                    ZERO FOR IC              Y02082 51512000
         IC    R1,K4(RF)                RECORD NUMBER          @G60ASRB 51513500
         BCTR  R1,K0                    REDUCE BY 1              Y02082 51514500
         STC   R1,K4(RF)                RESTORE                @G60ASRB 51515500
         B     DAMV1600                 BRANCH TO FREE WORKAREA  Y02082 51518000
*                                                                Y02082 51521000
*****************************************************************Y02134 51521400
*                                                                Y02082 51521800
*        R IS 1 - R SHOULD BE HIGH R ON TRACK                    Y02082 51522500
*                                                                Y02082 51522900
*****************************************************************Y02134 51523300
*                                                                Y02082 51523700
DAMV1550 EQU   *                                                 Y02082 51523800
*                                                                Y02082 51524000
         MVC   K4(K1,RF),DXCCW6+K4      HIGH R ON VTOC TRACK   @G60ASRB 51530000
         EJECT                                                          51532000
*                                                                Y02082 51560000
*****************************************************************Y02134 51580000
*                                                                Y02082 51600000
*        FREE CCW AREA                                           YM1472 51600400
*                                                                YM1472 51602000
*****************************************************************Y02134 51602400
*                                                                YM1472 51604000
DAMV1600 EQU   *                                                 Y02082 51605000
*                                                                Y02082 51607000
         L     R1,DXCCW3                WORKAREA CCW CORE ADDR   Y02082 51610000
         LA    R1,WACCW                 CLEAR HI BYTE            YM1472 51615000
         DROP  R1                                                YM1472 51615400
*                                                                YM1472 51615800
         L     RF,ADDRFREE              GET ADDRESS OF FREECCW @G18MSBS 51616000
         BALR  RET,RF                   GO FREE CCW WORKAREA   @G18MSBS 51666000
*                                                                Y02134 52060000
         LA    RCORE,K0(RCORE)          SET HI ORDER BYTE TO 0   Y02134 52080000
         LA    RB,K0(RB)                SET HI ORDER BYTE TO 0   Y02134 52100000
         CR    RCORE,RB                 CHECK FOR INCORE JFCB    Y02134 52120000
         BNE   DAMV2000                 BRANCH NOT FIRST DSCB    Y02134 52140000
*                                                                Y02134 52160000
         TM    JFCBTSDM,JFCNDSCB        DSCB-JFCB MERGE INHIBITD Y02134 52180000
         BO    DAMV2000                 BRANCH IF MERGE IHIBITED Y02134 52200000
*                                                                Y02134 52220000
         MVC   DXDAADDR+K3(K5),DXCCW7   ADD ACTUAL CCHHR TO MBB  Y02134 52240000
         L     RF,IECPRLTV              EPA OF IECPRLTV CONV RTN YM3070 52262000
         BALR  RET,RF                   LINK TO CONVERT ROUTINE  YM3070 52264000
*                                                                Y02134 52280000
         STCM  R0,B'1110',JFCBDSCB      UPDATE TTR IN JFCB       Y02134 52300000
         OI    JFCBMASK+K6,JFCMCTTR     SET RE-CATALOG DSCB TTR  Y02134 52340000
         OI    JFCBMASK+K4,JFCMJMOD     SET JFCB MOD SWITCH ON   Y02134 52360000
         EJECT                                                          52370000
*                                                                Y02072 52530000
*****************************************************************Y02072 52532000
*                                                                Y02072 52534000
*        CHECK FOR DOS COMPATIBILITY                             Y02072 52536000
*        NO SPLIT CYLINDER EXTENTS EXCEPT THE FIRST              Y02134 52536400
*        IGNORE USER LABEL EXTENT                                Y02134 52536800
*                                                                Y02072 52538000
*****************************************************************Y02072 52538400
*                                                                Y02134 52538500
DAMV2000 EQU   *                                                 Y02134 52538600
*                                                                Y02134 52538800
         XR    RF,RF                    CLEAR REG FOR IC INST    Y02134 52539200
         IC    RF,DSCNOEXT-DXDSCB(,RB)  GET NO OF EXTENTS        Y02134 52539600
         CLI   DSCEXTYP-DXDSCB(RB),X40  CHECK FOR UL EXTENT      Y02134 52539700
         BNE   DAMV2010                 BRANCH IF NOT UL EXTENT  Y02134 52539800
         LA    RF,K1(,RF)               REFLECT UL EXTENT        Y02134 52539900
         STC   RF,DXWORK                SAVE NO OF EXTENTS       Y02134 52541900
         B     DAMV2020                 BRANCH, CHECK 3RD EXTENT Y02134 52542700
*                                                                Y02134 52544900
*****************************************************************Y02072 52545000
*                                                                Y02134 52545100
*        CHECK FOR SPLIT CYLINDERS ON SECOND EXTENT              Y02134 52545200
*                                                                Y02134 52545700
*****************************************************************Y02072 52545800
*                                                                Y02134 52545900
DAMV2010 EQU   *                                                 Y02134 52546000
*                                                                Y02072 52546100
         STC   RF,DXWORK                SAVE NO OF EXTENTS       Y02134 52546200
*                                                                Y02134 52547200
         CLI   DXWORK,K2                CHECK FOR 2ND EXTENT     Y02072 52547300
         BL    DAMV2030                 BRANCH IF NO 2ND EXTENT  Y02072 52547400
*                                                                Y02134 52547500
         CLI   DSCEXT1-DXDSCB(RB),X80   IS THIS A SPLIT CYLINDER?Y02072 52547600
         LA    R0,K9                    OPEN=213-24 EOV=C37-08   Y02134 52547700
         BE    DAMV9100                 YES - GO TO PROB DET     Y02072 52547800
*                                                                Y02134 52548000
*****************************************************************Y02072 52548400
*                                                                Y02134 52548500
*        CHECK FOR SPLIT CYLINDERS ON THIRD EXTENT               Y02134 52548600
*                                                                Y02134 52548700
*****************************************************************Y02072 52548800
*                                                                Y02134 52548900
DAMV2020 EQU   *                                                 Y02072 52549000
*                                                                Y02134 52549100
         CLI   DXWORK,K3                CHECK FOR 3RD EXTENT     Y02072 52549200
         BL    DAMV2030                 BRANCH IF NO 3RD EXTENT  Y02072 52549300
*                                                                Y02134 52549600
         CLI   DSCEXT2-DXDSCB(RB),X80   IS THIS A SPLIT CYLINDER?Y02072 52549900
         LA    R0,K9                    OPEN=213-24 EOV=C37-08   Y02134 52550000
         BE    DAMV9100                 YES - GO TO PROB DET     Y02072 52550100
*                                                                Y02072 52552100
*****************************************************************Y02072 52552500
*                                                                Y02072 52552900
*        CHECK FOR DOS COMPATIBILITY                             Y02072 52553100
*                                                                Y02072 52553500
*****************************************************************Y02072 52553900
*                                                                Y02134 52554000
DAMV2030 EQU   *                                                 Y02072 52554100
*                                                                Y02134 52554200
         CLI   DXWORK,K16               MORE THAN 16 EXTENTS?    Y02072 52556200
         LA    R0,K8                    OPEN=213-20 EOV=C37-04   Y02134 52556300
         BH    DAMV9100                 YES - GO TO PROBLEM DET  Y02072 52556700
         EJECT                                                          52557000
*                                                                Y02134 52557100
*****************************************************************Y02134 52557200
*                                                                Y02134 52557300
*        F1 DSCB HAS BEEN READ                                   Y02134 52557400
*                                                                Y02134 52557500
*****************************************************************Y02134 52557600
*                                                                Y02134 52557700
DAMV2100 EQU   *                        F1 DSCB PROCESSING       Y02134 52557800
*                                                                Y02134 52557900
         L     RF,ISAMRTN                                      @ZA26665 52558300
         BALR  RET,RF                   CHK ISAM NO NEXT DSCB  @ZA26665 52558400
DAMV2105 CLC   DAMVEOV,WTGMODNM+K3      CHECK FOR EOV          @ZA26665 52558500
         BE    DAMV2150                 BRANCH IF EOV            YM3070 52558600
         LA    RCORE,DXDSCB             CLEAR HI BYTE            YM3070 52558800
         LA    RB,DXDSCB-DXDSCB(,RB)    CLEAR HI BYTE            YM3070 52558900
         CR    RCORE,RB                 CHECK FOR 1ST VOL MOUNT  YM3070 52559000
         BNE   DAMV2150                 BRANCH IF NOT FIRST      YM3070 52559100
         NC    DCBDSORG,DCBDSORG        SEE IF DSORG SPECIFIED   YM3070 52559300
         BNZ   DAMV2150                 BRANCH IF SPECIFIED      YM3070 52559400
         TM    DSCFILTY+K1,ACBDORGA     TEST FOR VSAM            YM3070 52559800
         BO    DAMV2150                 BRANCH IF VSAM           YM3070 52559900
         NC    DSCFILTY,DSCFILTY        CHECK FOR DSORG IN DSCB  YM3070 52560000
         BZ    DAMV2150                 BRANCH IF NO DSORG       YM3070 52560100
*                                                                YM3070 52560200
*        MERGE DSORG IN COPY EVEN IF FIELD DOES NOT EXIST FOR    YM3925 52560500
*        EXCP. IT WILL BE IGNORED EXCEPT FOR BPAM DSORG=PO.      YM3925 52560900
         MVC   DCBDSORG,DSCFILTY        MERGE DSORG TO DCB       YM3070 52561000
         OI    JFCBMASK+K3,X01          DSORG MERGE MASK         YM3070 52561300
*                                                                YM3070 52561400
         TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP ORG        YM3925 52561500
         BNO   DAMV2110                 BRANCH IF NOT EXCP       YM3925 52561900
         TM    DCBMACRF,DCBMFOUN        DOES DSORG FIELD EXIST   YM3925 52562300
         BNO   DAMV2150                 BRANCH IF NO DSORG       YM3925 52562500
*                                                                YM3925 52562900
DAMV2110 EQU   *                        DSORG=PS NEEDS NO RECOPY YM3925 52563300
*                                                                YM3925 52563400
         TM    DCBDSORG,DCBDSGPS        TEST FOR PS              YM3070 52563500
         BO    DAMV2150                 BRANCH IF SPECIFIED      YM3070 52563600
*                                                                YM3070 52563700
*****************************************************************Y02134 52563800
*                                                                Y02134 52563900
*        RECOPY DCB WITH PROPER SIZE                             YM3070 52564000
*                                                                Y02134 52564100
*****************************************************************Y02134 52564200
*                                                                YM3070 52564300
         L     RDCB,DXUDCBAD            SAVE USER DCB PTR        YM3070 52564400
         ICM   RDCB,B'1000',DXUKEY      SAVE USER KEY            YM3070 52564500
         MVC   DXUDCBAD,DXPDCBAD        SET USER=PROTECT         YM3070 52564600
         MVI   DXUKEY,DATAMGT           SET DM KEY               YM3070 52564700
*        GET PROPER SIZE AREA FOR NEW DCB (DSORG IS DIFFERENT)   YM3070 52564800
         IECRES INIT,DCBCOPY=TOWKAR,STM=(2,14,WTGPREFX),         YM3070X52564900
               PREFIX=WTGPREFX                                   YM3070 52565000
*                                                                YM3070 52565100
         STCM  RDCB,B'1000',DXUKEY      RESTORE KEY              YM3070 52565200
         STCM  RDCB,B'0111',DXUDCBAD+K1 RESTORE USER DCB ADDRESS YM3070 52565300
         L     RDCB,DXPDCBAD            LOAD COPY DCB ADDRESS    YM3070 52565400
         L     R1,DXDEBXAD              LOAD DEB EXTENSION ADDR  YM3070 52565500
         USING DEBXTN,R1                R1 POINTS TO DEB EXT     YM3070 52565600
         MVC   DEBXDSO1(L'DCBDSORG),DCBDSORG UPDATE DEBX DSORG   YM3070 52565700
         DROP  R1                                                YM3070 52565800
*                                                                YM3070 52565900
*        RESTORE DCB FROM ORIGINAL WITH PROPER LENGTH            YM3070 52566000
         IECRES INIT,DCBCOPY=TOWKAR,STM=(3,14,WTGPREFX),         YM3070X52566100
               PREFIX=WTGPREFX                                   YM3070 52566200
*                                                                YM3070 52566300
         TM    DCBDSORG,DCBDSGDA        DSORG=DA                 YM3925 52566500
         BZ    DAMV2150                 BR IF NO                 YM3070 52566700
*                                                                YM3070 52566800
         MVI   DCBDRDX,K0               INITIALIZE EXTENTS TO 0  YM3070 52566900
         EJECT                                                          52567500
*                                                                YM3070 52567600
DAMV2150 EQU   *                        CHECK AM DEPND PROCESS   YM3070 52567700
*                                                                YM3070 52567800
         CLC   WTGMODNM+K3(K3),DAMVEOV  TEST FOR EOV           @ZA02209 52567900
         BNE   DAMV2155                 NO, BR TO CONTINUE     @G18MSBS 52568000
         TM    DCBMACRF,DCBMEXCP        EXCP?                  @ZA02209 52568100
         BO    DAMV2155                 YES, BR TO CONTINUE    @G18MSBS 52568200
         TM    DCBCIND2,DCBC2PUT        TEST FOR EOV CALLED BY @ZA02209 52568300
*                                       CLOSE EXECUTORS WHEN   @ZA02209 52568400
*                                       FLUSHING THE BUFFERS   @ZA02209 52568500
         BZ    DAMV2155                 NO, BR TO CONTINUE     @G18MSBS 52568600
         L     RET,DCBDEBAD             GET DEB ADDRESS        @ZA02209 52568700
         OI    DEBFLGS1-DEBBASIC(RET),DEBF1CEV SET INDICATOR IN@ZA02209 52568800
*                                       DEB TO TELL CLOSE TO   @ZA02209 52568900
*                                       READ FORMAT1 DSCB      @ZA02209 52569000
*                                       ON NEW VOLUME          @ZA02209 52569100
         EJECT                                                          52569200
*                                                              @G18MSBS 52569300
***************************************************************@G18MSBS 52569400
*                                                              @G18MSBS 52569500
**       FOR JES3 MANAGED UNIT, OFFER VOLUME CHOICE TO JES3    @G18MSBS 52569600
**       FOR APPROVAL BEFORE CONTINUING                        @G18MSBS 52569700
*                                                              @G18MSBS 52569800
***************************************************************@G18MSBS 52569900
*                                                              @G18MSBS 52570000
DAMV2155 EQU   *                                               @G18MSBS 52570100
         TM    UCBJBNR,UCBJES3          DOES JES3 MANAGE UNIT? @G18MSBS 52570200
         BNO   DAMV2160                 NO, CONTINUE           @G18MSBS 52570300
         TM    UCBTBYT2,UCBRVDEV        YES, THEN VIRTUAL VOL? @G18MSBS 52570400
         BNO   DAMV2160                 NO, CONTINUE           @G18MSBS 52570500
         LA    RC,K4                    SET FINAL PASS SWITCH  @G18MSBS 52570600
         L     RF,JES3ROUT              GET JES3 ROUTINE ADDR  @G18MSBS 52570700
         BALR  RET,RF                   BRANCH TO JES3 ROUTINE @G18MSBS 52570800
         SPACE 3                                                        52570900
***************************************************************@G18MSBS 52571000
*        CHECK FOR PO BEFORE EXCP, DSORG FIELD EXISTS IN COPY    YM3925 52571100
*        EVEN IF NOT IN USERS DCB.                               YM3925 52571200
*                                                              @ZA02209 52571300
DAMV2160 EQU   *                                               @ZA02209 52571400
*                                                              @ZA02209 52571500
         TM    DCBDSORG,DCBDSGPO        TEST FOR BPAM DATA SET   YM3925 52571600
         BO    DAMV2300                 BRANCH IF BPAM           YM3925 52571700
*                                                                YM3925 52571800
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    Y02134 52571900
         BO    DAMV2200                 BRANCH IF EXCP           YM1228 52572000
*                                                                Y02134 52572100
         NC    DCBDSORG,DCBDSORG        CHECK IF DSORG SPECIFIED Y02134 52572200
         BZ    DAMV2200                 BRANCH 0, ASSUME PS      Y02134 52572300
*                                                                Y02134 52572400
         TM    DCBDSORG,DCBDSGPS        PHYSICAL SEQUENTIAL DCB  Y02134 52572500
         BNO   DAMV2300                 BRANCH IF NOT PS         Y02134 52572600
*                                                                Y02134 52572800
DAMV2200 EQU   *                        DSORG=PS                 YM1472 52573300
*                                                                Y02134 52573800
         CLC   WTGMODNM+K3(K3),DAMVEOV  CHECK FOR EOV            Y02134 52574300
         BNE   DAMV2210                 BRANCH IF NOT EOV        YM1108 52577400
*                                                                YM1108 52580500
         CLI   DXEXTSW,X04              CHECK IF DS EXTENDED     YM1174 52583600
         BE    DAMV3000                 BRANCH YES, CONTINUE     YM3925 52586700
*                                                                YM1108 52589800
         CLC   DXVOLSR2,SCRTCH          NON-SPECIFIC REQUEST     YM1108 52592900
         BNE   DAMV2400                 BRANCH IF SPECIFIC REQ   YM1108 52596000
         B     DAMV7500                 GET NEW VOLUME           YM6514 52599100
         EJECT                                                          52602200
*                                                                YM1108 52605300
DAMV2210 EQU   *                        TEST FOR DISP=MOD        YM1108 52608400
*                                                                Y02134 52611500
         TM    DXDCBLST,PLISTOIN        TEST FOR OUTPUT          YM1459 52614600
         BNO   DAMV2410                 BRANCH IF INPUT          YM1459 52617700
*                                                                YM1459 52620800
         TM    JFCBIND2-INFMJFCB(RD),JFCOLD NOT OLD OR NEW       Y02134 52623900
         BO    DAMV2410                 BRANCH IF NOT MOD        YM1108 52627000
         TM    DSCDSIND-DXDSCB(RB),X80  LAST VOLUME INDICATOR    Y02134 52630100
         BO    DAMV2410                 BRANCH IF LAST VOLUME    YM1108 52633200
         XR    RF,RF                    CLEAR REG FOR IC INST    Y02134 52636300
         IC    RF,JFCBNVOL              GET NUMBER OF VOLUMES    Y02134 52639400
         CH    RF,DXVOLSEQ              CHECK FOR LAST VOLUME    Y02134 52642500
         BNH   DAMV2410                 BRANCH IF LAST VOLUME    YM1108 52645600
         BCTR  RF,R0                    DECREMENT TO N-1 VOLUME  Y02134 52648700
         CH    RF,DXVOLSEQ              CHECK FOR N-1 VOLUME     Y02134 52651800
         BNH   DAMV2410                 ACCEPT IF N-1 VOLUME     YM1108 52654900
*                                                                Y02134 52658000
*****************************************************************Y02134 52661100
*                                                                Y02134 52664200
*        LAST VOLUME INDICATOR WAS NOT SET BEFORE RELEASE 17.    Y02134 52667300
*                                                                Y02134 52670400
*****************************************************************Y02134 52673500
*                                                                Y02134 52676600
         TM    DXEXTSW,ALLBITS          TEST FOR USE VOL FOR MOD Y02134 52679700
         BO    DAMV2410                 BRANCH, USE ANYWAY       YM1108 52682800
*                                                                Y02134 52685900
*****************************************************************Y02134 52689000
*                                                                Y02134 52692100
*        DISP=MOD ERROR RECOVERY                                 Y02134 52695200
*                                                                Y02134 52698300
*****************************************************************Y02134 52701400
*                                                                Y02134 52704500
         ST    RB,CORECH(,RB)           CHAIN FOR REUSE          Y02134 52707600
*                                                                Y02134 52710700
         IECRES LOAD,MODID=ID4C4A,BRCODE=K20,BRANCH=QUEUED       Y02134 52713800
         EJECT                                                          52716900
*                                                                Y02134 52720000
*****************************************************************Y02134 52721600
*                                                                Y02134 52722400
*        CHECK FOR ASCENDING VOLUME SEQUENCE NUMBER IN FORMAT 1  Y02134 52723200
*                                                                Y02134 52723300
*****************************************************************Y02134 52723400
*                                                                Y02134 52725400
DAMV2300 EQU   *                        DSORG NOT PS             YM1472 52725800
*                                                                Y02134 52726500
         CLC   DXVOLSEQ,DS1VOLSQ-DS1FMTID(RB) COMPARE VOL SEQ NO Y02134 52732800
         LA    R0,K6                    OPEN=03D-04 EOV=NA       Y02080 52735200
         BH    DAMV2360                 BR IF NOT SAME         @ZA09644 52737600
*                                                                Y02134 52738000
         TM    DSCFILTY-DXDSCB(RB),DCBDSGPO TEST FOR BPAM F1     YM7817 52738400
         BNO   DAMV2340                 BRANCH IF NOT PO         Y02134 52739700
*                                                                Y02134 52740000
         TM    DCBDSORG,DCBDSGPO        TEST FOR BPAM            YM7817 52740100
         LA    R0,K10                   OPEN=013-14 EOV=NA       Y02080 52740400
         BNO   DAMV9900                 BRANCH IF NOT SAME       Y02134 52740500
*                                                                Y02134 52740700
DAMV2340 EQU   *                        TEST FOR BDAM            YM1472 52741000
*                                                                Y02134 52741300
         TM    DCBDSORG,DCBDSGDA        TEST IF BDAM             Y02134 52742400
         BZ    DAMV2350                 BR IF NO                 Y02134 52744800
*                                                                Y02134 52747200
         SR    R0,R0                    GET NO. OF BDAM EXTENTS  Y02134 52749600
         IC    R0,DCBDRDX               SO FAR FROM DCB          Y02134 52752000
         SR    R1,R1                    GET BDAM EXTENTS ON THIS Y02134 52754400
         IC    R1,DS1NOEPV-DS1FMTID(,RB) VOL FROM FORMAT 1 DSCB  Y02134 52756800
         AR    R0,R1                    ADD TO CURRENT TOTAL     Y02134 52759200
         STC   R0,DCBDRDX               UPDATE COUNT IN DCB      Y02134 52761600
*                                                                Y02134 52764000
DAMV2350 EQU   *                        TEST FOR ISAM            YM1472 52766400
*                                                                Y02134 52768800
         TM    DCBDSORG,DCBDSGIS        TEST FOR ISAM            Y02134 52771200
         BNO   DAMV2400                 BRANCH IF NOT ISAM       YM1108 52773600
*                                                              @ZA09644 52774200
DAMV2355 EQU   *                                               @ZA09644 52774800
*                                                              @ZA09644 52775400
         MVC   DSCSCALO-DXDSCB(L'DSCSCALO,RB),DXUCBADR ISAM UCB  Y02134 52776000
         CLC   DXDSABAD,DXDSAB          COMPARE FIRST TO CURRENT Y02134 52778400
         BE    DAMV2400                 BR IF FIRST IS CURRENT   YM3807 52780800
         LA    R0,K11                   913-2C ERROR CODE        Y02082 52783200
         CLC   JFCBDSNM(L'JFCBDSNM),JFCBDSNM-INFMJFCB(RD) IS     Y02082 52783600
*                                       CURRENT DSN THE SAME AS  Y02082 52784000
*                                       THE FIRST JFCB'S         Y02082 52784400
         BNE   DAMV9900                 BRANCH IF NO TO ABEND    Y02082 52784800
         B     DAMV3000                 BRANCH TO CONTINUE       Y02082 52784900
         EJECT                                                 @ZA09644 52785200
*                                                              @ZA09644 52785300
***************************************************************@ZA09644 52785400
*                                                              @ZA09644 52785500
*      CHECK ISAM ASCENDING SEQUENCE NUMBER IN DSCB            @ZA09644 52785600
*                                                              @ZA09644 52785700
***************************************************************@ZA09644 52785800
*                                                              @ZA09644 52785900
DAMV2360 EQU   *                                               @ZA09644 52786000
*                                                              @ZA09644 52786100
         TM    DCBDSORG,DCBDSGIS        TEST FOR ISAM          @ZA09644 52786200
         BNO   DAMV9900                 NO, CONTINUE ABEND     @ZA09644 52786300
*                                                              @ZA09644 52786400
         CR    RB,RCORE                 TEST IF FIRST AREA     @ZA09644 52786500
         BE    DAMV9900                 YES, CONTINUE ABEND    @ZA09644 52786600
*                                                              @ZA09644 52786700
         LR    RB,RCORE                 GET FIRST ARE POINTER  @ZA09644 52786800
         LH    R0,DS1VOLSQ-DS1FMTID(,RB) GET VOLUME SEQUENCE   @ZA09644 52786900
*                                       NUMBER FROM FIRST DSCB @ZA09644 52787000
DAMV2370 EQU   *                                               @ZA09644 52787100
*                                                              @ZA09644 52787200
         AH    R0,ONE                   ADD ONE TO IT          @ZA09644 52787300
*                                                              @ZA09644 52787400
DAMV2380 EQU   *                                               @ZA09644 52787500
*                                                              @ZA09644 52787600
         NC    CORECH(K4,RB),CORECH(RB) IS THERE A NEXT AREA   @ZA09644 52787700
         BZ    DAMV2355                 NO, BR, DON'T ABEND    @ZA09644 52787800
         L     RB,CORECH(,RB)           POINT TO NEXT AREA     @ZA09644 52787900
         CLI   DXDSCB-DXDSCB(RB),CHAR1  IS IT A FMT 1 AREA     @ZA09644 52788000
         BNE   DAMV2390                 BRANCH IF NOT          @ZA09644 52788100
         CH    R0,DS1VOLSQ-DS1FMTID(,RB) IS VOLUME SEQUENCE    @ZA09644 52788200
*                                        NUMBER NEXT IN        @ZA09644 52788300
*                                        ASCENDING SEQUENCE    @ZA09644 52788400
         BE    DAMV2370                 YES, CHECK NEXT AREA   @ZA09644 52788500
         LA    R0,K6                    OPEN=03D-04, EOV=NA    @ZA09644 52788600
         B     DAMV9900                 BRANCH TO ABEND        @ZA09644 52788700
*                                                              @ZA09644 52788800
DAMV2390 EQU   *                                               @ZA09644 52788900
*                                                              @ZA09644 52789000
         LA    RB,L'JFCBDSNM(,RB)       INCREMENT PASSED KEY   @ZA09644 52789100
         B     DAMV2380                 CHECK NEXT AREA        @ZA09644 52789200
         EJECT                                                          52789300
*                                                                Y02134 52789400
*****************************************************************Y02134 52792800
*                                                                Y02134 52795200
*        CHECK EXPIRATION DATE                                   Y02134 52797600
*                                                                Y02134 52800000
*****************************************************************Y02134 52820000
*                                                                Y02134 52840000
DAMV2400 EQU   *                        EOV AND NON-PS ENTRY     YM1108 52841000
*                                                                YM1108 52842000
         CLC   DXVOLSR2,JFCBVOLS-INFMJFCB(RD) FIRST VOLUME       Y02134 52860000
         BNE   DAMV2500                 BR IF NOT FIRST VOLUME   Y02083 52880000
*                                       TO CHECK FOR SECURITY    Y02082 52882000
*                                                                Y02134 52884000
DAMV2410 EQU   *                        OPEN DSORG=PS ENTRY      YM1108 52888000
*                                                                Y02134 52892000
         TM    JFCBIND2-INFMJFCB(RD),JFCNEW CHECK FOR NEW        Y02134 52900000
         BO    DAMV2500                 BR IF NEW                Y02082 52920000
         TM    DXDCBLST,OUTPUT          INPUT OR RDBACK CHECK    Y02134 52940000
         BZ    DAMV2500                 BRANCH IF EITHER         Y02134 52960000
*                                                                Y02134 52980000
         L     RF,DOCVTD                 CVTDATE TO DXWORK2    @G60ASRB 53000000
         BALR  RET,RF                    CALL DATE ROUTINE     @G60ASRB 53050000
*                                                                Y02134 53500000
         CLC   DSCEXPDT-DXDSCB(K3,RB),DXWORK2+K1 BIN TO BIN VALU Y02134 53520000
         BNH   DAMV2500                 BR IF DATE HAS EXPIRED   Y02134 53540000
         EJECT                                                          53542000
*                                                                Y02134 53560000
*****************************************************************Y02134 53580000
*                                                                Y02134 53600000
*        GO TO ERROR ROUTINE TO WRITE EXPIRATION DATE            Y02134 53620000
*        ERROR MESSAGE TO THE OPERATOR, AND WAIT FOR             Y02134 53640000
*        HIS REPLY TO USE OR NOT USE THE DATA SET.               Y02134 53660000
*                                                                Y02134 53680000
*****************************************************************Y02134 53700000
*                                                                Y02134 53720000
DAMV2440 EQU   *                                                 Y02134 53724000
*                                                                Y02134 53728000
         MVC   DXRETMOD,ID4C4C          RETURN ID TO SAVE AREA   Y02134 53740000
         MVI   DXRETCOD,K8              SET RETURN INDICATOR     Y02134 53760000
*                                                                Y02134 53760100
         XC    DXWORK1,DXWORK1          SET REPLY AREA TO BLANKS Y02134 53760200
         LA    R1,DXWORK1               POINT TO REPLY AREA      Y02134 53760300
         LA    R0,K1                    SET REPLY LENGTH         Y02134 53760400
         SLL   R0,K24                   MOVE LENGTH TO HI BYTE   Y02134 53760500
         OR    R1,R0                    SET UP WTOR PARM         Y02134 53760600
         LA    R0,JFCBDSNM-INFMJFCB(,RD) GET DSNAME ADDRESS      Y02134 53760700
*                                                                Y02134 53786900
         IECRES LOAD,MODID=ID4C4J,BRCODE=K20,BRANCH=QUEUED       Y02134 53800000
*                                                                Y02134 53837600
*****************************************************************Y02134 53837700
*                                                                Y02134 53837800
*        RETURN HERE FROM EXPIRATION CHECK                       Y02134 53837900
*                                                                Y02134 53838000
*****************************************************************Y02134 53838100
*                                                                Y02134 53838200
DAMV2450 EQU   *                                                 Y02134 53838400
*                                                                Y02134 53839200
         IECRES WAIT                    WAIT FOR OPERATOR REPLY  Y02134 53839300
*                                                                Y02134 53839400
         OI    DXWORK1,BLANK            FOLD REPLY               Y02134 53841000
         CLI   DXWORK1,CHARU            CHECK FOR REPLY U        Y02134 53842600
         BE    DAMV2500                 BRANCH TO USE            Y02134 53844200
*                                                                Y02134 53845800
         CLI   DXWORK1,CHARM            CHECK IF REJECT          Y02134 53847400
         BNE   DAMV2440                 BRANCH, INCORRECT REPLY  Y02134 53849000
*                                                                Y02134 53850600
         B     DAMV7500                 BRANCH TO REJECT VOLUME  Y02134 53851400
         EJECT                                                          53851800
*                                                                Y02134 53853300
***************************************************************@Z40RSDH 53853600
*                                                              @Z40RSDH 53853900
*        TEST FOR RAC AUTHORIZATION                            @Z40RSDH 53854200
*                                                              @Z40RSDH 53854500
***************************************************************@Z40RSDH 53854800
DAMV2500 EQU   *                        RAC CHECK              @Z40RSDH 53855100
         L     RF,RACRTN                GET RAC ROUTINE        @Z40RSDH 53855400
         BALR  RET,RF                   CHK RAC AUTH TO D.S.   @Z40RSDH 53855700
*                                                              @Z40RSDH 53856000
*        RETURN CODE IN REG 15                                 @Z40RSDH 53856300
*        0     DATA SET RAC DEFINED - ENVIRONMENT OK           @Z40RSDH 53856600
*        4     DATA SET NOT RAC DEFINED                        @Z40RSDH 53856900
*        8     ERROR - ABCODE TBL OFFSET IN REG 0              @Z40RSDH 53857200
*                                                              @Z40RSDH 53857500
         B     DAMV2502(RF)             PROCESS RAC RETURN     @Z40RSDH 53857800
DAMV2502 EQU   *                        BRANCH TABLE           @Z40RSDH 53858100
         B     DAMV2550                 RAC OK - BYP PW        @Z40RSDH 53858400
         B     DAMV2504                 NO RAC - CHK PW        @Z40RSDH 53858700
         B     DAMV9900                 ABEND                  @Z40RSDH 53859000
*                                                              @Z40RSDH 53859300
*****************************************************************Y02134 53860000
*                                                                Y02134 53880000
*        TEST FOR PASSWORD NEEDED                                Y02134 53900000
*                                                                Y02134 53920000
*****************************************************************Y02134 53940000
*                                                                Y02134 53960000
DAMV2504 EQU   *                                               @Z40RSDH 53980000
*                                                                Y02134 54000000
         TM    DSCDSIND-DXDSCB(RB),DS1SECTY TEST IF PASSWORD REQ Y02134 54004000
         BNO   DAMV2550                 BRANCH IF NOT NEEDED     Y02083 54008000
         CLC   WTGMODNM+K3(K3),DAMVEOV  TEST FOR EOV             Y02082 54008100
         BE    DAMV2505                 GO TEST PASSWORD         Y02082 54008200
         TM    JFCBIND2-INFMJFCB(RD),JFCNEW IS DISP = NEW        Y02082 54008400
         BNO   DAMV2505                 BR IF NO                 Y02082 54008800
         TM    JFCBMASK+K5-INFMJFCB(RD),JFCBPWBP JFCB MODIFIED?  Y02082 54009200
         BNO   DAMV2555                 BR IF NO                 Y02083 54009600
*                                                                Y02082 54009800
         L     RF,ADDRTEST              GET ADDRESS OF TESTAUTH@G18MSBS 54010000
         BALR  RET,RF                   GO TEST AUTHORIZATION  @G18MSBS 54010100
*                                                                Y02082 54010400
         LTR   RF,RF                    WAS CALLER AUTHORIZED    Y02082 54010800
         BZ    DAMV2550                 BR IF YES                Y02083 54011200
*                                                                Y02082 54011400
DAMV2505 EQU   *                        DISP NOT NEW             Y02082 54011600
*                                                                Y02134 54012000
         TM    DSCDSIND-DXDSCB(RB),DS1WRSEC TEST IF WRITE ONLY   Y02134 54016000
         BZ    DAMV2510                 BRANCH IF NOT            Y02134 54016800
*                                                                Y02134 54017600
         TM    DXDCBLST,OUTPUT          INPUT OR RDBACK CHECK    Y02134 54020000
         BZ    DAMV2555                 BRANCH IF EITHER         Y02083 54040000
*                                                                Y02134 54740000
DAMV2510 EQU   *                        ASK OPERATOR FOR PASSWORDY02134 54744000
*                                                                Y02134 54748000
         OI    JFCBMASK+K4,JFCMPSWD     CHECK PASSWORD           YM7835 54750000
*                                                                       54752000
         MVC   DXRETMOD,ID4C4C          SET UP RETURN LOAD       Y02134 54756400
         MVI   DXRETCOD,K12             SET UP RETURN OFFSET     Y02134 54756500
*                                                                Y02134 54756600
         IECRES LOAD,MODID=ID4C5T,BRCODE=K12,BRANCH=QUEUED       Y02134 54756800
         EJECT                                                          54756900
*                                                                Y02083 54757000
*****************************************************************Y02083 54757100
*                                                                Y02083 54761600
*        CHECKPOINT DATA SET SECURITY PROCESSING                 Y02083 54763600
*                                                                Y02083 54765600
*****************************************************************Y02083 54766000
*                                                                Y02083 54766400
DAMV2550 EQU   *                        RESET PASSWORD BYPASS    YM3925 54768400
*                                                                YM3925 54770400
         NI    JFCBMASK+K5,ALLBITS-JFCBPWBP TURN OFF PW BYPASS   YM3925 54772000
*                                                                YM3925 54772400
DAMV2555 EQU   *                        CHECKPOINT PROCESSING    YM3925 54772800
*                                                                YM3925 54773200
         L     RD,DXDSAB                FETCH DSAB ADDRESS       Y02083 54791200
         TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP            YM1228 54793200
         BO    DAMV2557                 BRANCH EXCP TO ASSUME PS YM1228 54795200
         TM    DCBDSORG,DCBDSGPS        PHYSICAL SEQUENTIAL D/S  Y02083 54797200
         BO    DAMV2557                 IF PS, BRANCH            YM5957 54799200
         TM    DCBDSORG,DCBDSGPO        PARTITIONED D/S          YM5957 54799700
         BO    DAMV2640                 IF PO, BRANCH            YM5957 54800200
         LA    R0,K12                   ANTICIPATE 913-28 ABEND  YM5957 54800700
         TM    DSABFLG4-DSAB(RD),DSABCKDS TEST FOR CHKPT D/S     YM5957 54800800
         BO    DAMV2556                 IF CHKPT, SEE IF ERROR   YM5957 54800900
         TM    DSCDSIND-DXDSCB(RB),DSCBCKDS F1 INDICATE CHKPT    YM5957 54801000
         BO    DAMV2556                 IF CHKPT, SEE IF ERROR   YM5957 54801100
         B     DAMV3000                 CONTINUE                 YM5957 54801600
DAMV2556 EQU   *                        SEE IF USER IS AUTH      YM5957 54801700
         TM    DSABFLG4-DSAB(RD),DSABCKSI IS USER KNOWN NOT AUTH YM5957 54801900
         BO    DAMV9900                 IF YES, GO ABEND         YM5957 54802000
*                                                              @G18MSBS 54802400
         L     RF,ADDRTEST              GET ADDRESS OF TESTAUTH@G18MSBS 54802500
         BALR  RET,RF                   GO TEST AUTHORIZATION  @G18MSBS 54802600
*                                                              @G18MSBS 54802700
         LTR   RF,RF                    CHECK RETURN CODE        YM5957 54802800
         BNZ   DAMV9900                 IF NOT AUTH, GO ABEND    YM5957 54802900
*                                                                YM1228 54803000
DAMV2557 EQU   *                        PS CHECK FOR EOV OR OPEN YM1228 54803200
*                                                                YM1228 54805200
         CLC   WTGMODNM+K3(K3),DAMVEOV  TEST FOR EOV             Y02083 54807200
         BE    DAMV2610                 BR IF EOV FOR PS         Y02083 54809200
*                                                                Y02083 54829200
*        OPEN FOR PS D/S                                         Y02083 54831200
*                                                                Y02083 54833200
DAMV2570 TM    DSCDSIND-DXDSCB(RB),DSCBCKDS F1 INDICATE CHKPT    Y02083 54835200
         BO    DAMV2590                 IF YES, BRANCH           Y02083 54837200
DAMV2580 MODESET EXTKEY=SCHED           DSAB KEY                 Y02083 54839200
         NI    DSABFLG4-DSAB(RD),X'FF'-DSABCKVL RESET            Y02083 54841200
*                                       DSAB CHKPT FLAGS         Y02083 54843200
         MODESET EXTKEY=DATAMGT         BACK TO D/M KEY          Y02083 54845200
         TM    DSABFLG4-DSAB(RD),DSABCKDS CHKPT DS               Y02083 54845600
         BNO   DAMV3000                 BRANCH IF NOT CHKPT      Y02083 54846000
         LA    RET,K52                  CAN VOL BE SECURED       YM3925 54848400
         L     RF,CHKPTWTO              GET MSG RTN ADDR         YM3925 54848800
         BALR  RC,RF                    ISSUE MESSAGE            YM3925 54848900
*                                                                YM3925 54849000
         BNE   DAMV3000                 BRANCH IF NOT SECURE     YM5957 54849800
         MODESET EXTKEY=SCHED           DSAB KEY                 Y02083 54850200
         OI    DSABFLG4-DSAB(RD),DSABCKVL SET SECURE VOL FLAG    Y02083 54850300
         MODESET EXTKEY=DATAMGT         BACK TO D/M KEY          Y02083 54850400
         B     DAMV3000                 CONTINUE                 Y02083 54850600
DAMV2590 TM    DSABFLG4-DSAB(RD),DSABCKVL VOL ALREADY SECURE     Y02083 54851000
         BO    DAMV3000                 IF YES, CONTINUE         Y02083 54851200
         LA    RET,K56                  IS VOL SECURE            YM3925 54855600
         L     RF,CHKPTWTO              GET MSG RTN ADDR         YM3925 54856000
         BALR  RC,RF                    ISSUE MESSAGE            YM3925 54856400
*                                                                YM3925 54856800
         BNE   DAMV2580                 BRANCH IF NOT SECURE     YM3925 54857000
DAMV2600 MODESET EXTKEY=SCHED           DSAB KEY                 Y02083 54861200
         OI    DSABFLG4-DSAB(RD),DSABCKDS+DSABCKVL SET CHKPT FLGSY02083 54863200
         MODESET EXTKEY=DATAMGT         BACK TO D/M KEY          Y02083 54865200
         B     DAMV3000                 CONTINUE                 Y02083 54867200
*                                                                Y02083 54869200
*        PS EOV PROCESSING                                       Y02083 54871200
*                                                                Y02083 54871900
DAMV2610 MODESET EXTKEY=SCHED           DSAB KEY                 Y02083 54872300
         NI    DSABFLG4-DSAB(RD),X'FF'-DSABCKVL RESET SECURE     Y02083 54872400
*                                       VOLUME FLAG              Y02083 54872500
         MODESET EXTKEY=DATAMGT         BACK TO D/M KEY          Y02083 54872600
         TM    DSCDSIND-DXDSCB(RB),DSCBCKDS F1 INDICATE CHKPT    Y02083 54872800
         BZ    DAMV2620                 IF NOT, BRANCH           Y02083 54872900
         LA    RET,K56                  IS VOL SECURE            YM3925 54873000
         L     RF,CHKPTWTO              GET MSG RTN ADDR         YM3925 54873100
         BALR  RC,RF                    ISSUE MESSAGE            YM3925 54873200
*                                                                YM3925 54873300
         BE    DAMV2630                 BRANCH IF NOT SECURE     YM3925 54873400
DAMV2620 LA    R0,K10                   ANTICIPATE 937-10 ABEND  Y02083 54873800
         TM    DSABFLG4-DSAB(RD),DSABCKDS DSAB INDICATE CHKPT    Y02083 54873900
         BO    DAMV9900                 IF YES, IT'S AN ERROR    Y02083 54874000
*                                       VOLUME NOT SECURABLE     Y02083 54874100
         B     DAMV3000                 OTHERWISE, CONTINUE      Y02083 54874400
DAMV2630 LA    R0,K11                   ANTICIPATE 937-14 ABEND  Y02083 54874800
         TM    DSABFLG4-DSAB(RD),DSABCKDS DSAB INDICATE CHKPT    Y02083 54875200
         BZ    DAMV9900                 IF NOT, IT'S AN ERROR    Y02083 54875300
*                                       D/S USE IS NOT CONSISTANTY02083 54875600
*                                       WITH CHKPT STATUS        Y02083 54875700
         MODESET EXTKEY=SCHED           DSAB KEY                 Y02083 54875800
         OI    DSABFLG4-DSAB(RD),DSABCKVL SET SECURE VOL FLAG    Y02083 54876100
         MODESET EXTKEY=DATAMGT         BACK TO D/M KEY          Y02083 54876200
         B     DAMV3000                 CONTINUE                 Y02083 54876300
*                                                                Y02083 54876600
*        PO OPEN PROCESSING                                      Y02083 54876700
*                                                                Y02083 54876800
DAMV2640 L     RF,DSABTIOT-DSAB(RD)     FETCH TIOT ENTRY ADDRESS Y02083 54876900
         CLI   TIOEDDNM-TIOENTRY(RF),BLANK CONCATENATED PO       Y02083 54877600
         BNE   DAMV2570                 IF NOT, BRANCH           Y02083 54878000
         L     RF,DSABBCHN-DSAB(RD)     FETCH PREVIOUS DSAB ADDR Y02083 54878400
         TM    DSABFLG4-DSAB(RF),DSABCKDS PREVIOUS CONCATENATED  Y02083 54878500
*                                       MEMBER A CHKPT D/S       Y02083 54878600
         BZ    DAMV2660                 IF NOT, BRANCH           Y02083 54878800
         TM    DSCDSIND-DXDSCB(RB),DSCBCKDS F1 INDICATE CHKPT    Y02083 54878900
         BZ    DAMV2670                 IF NOT, ISSUE 937-14     Y02083 54879000
         TM    DSABFLG4-DSAB(RD),DSABCKVL VOL ALREADY SECURE     Y02083 54879100
         BO    DAMV2650                 IF YES, SKIP ASKING OPER Y02083 54879300
         LA    RET,K56                  IS VOL SECURE            YM3925 54879400
         L     RF,CHKPTWTO              GET MSG RTN ADDR         YM3925 54879500
         BALR  RC,RF                    ISSUE MESSAGE            YM3925 54879600
*                                                                YM3925 54879700
         BNE   DAMV2670                 BRANCH IF NOT SECURE     YM3925 54879800
*                                       GO ISSUE 913-14 ABEND    Y02083 54880400
*                                       IF NOT SECURE            Y02083 54880500
DAMV2650 MODESET EXTKEY=SCHED           DSAB KEY                 Y02083 54880600
         OI    DSABFLG4-DSAB(RD),DSABCKDS+DSABCKVL SET CHKPT FLGSY02083 54880700
         MODESET EXTKEY=DATAMGT         BACK TO D/M KEY          Y02083 54880800
         B     DAMV3000                 CONTINUE                 Y02083 54880900
DAMV2660 MODESET EXTKEY=SCHED           DSAB KEY                 Y02083 54881000
         NI    DSABFLG4-DSAB(RD),X'FF'-DSABCKDS-DSABCKVL RESET   Y02083 54881100
*                                       CHKPT FLAGS              Y02083 54881300
         MODESET EXTKEY=DATAMGT         BACK TO D/M KEY          Y02083 54881700
         TM    DSCDSIND-DXDSCB(RB),DSCBCKDS F1 INDICATE CHKPT    Y02083 54882100
         BZ    DAMV3000                 IF NOT, CONTINUE         Y02083 54882300
         LA    RET,K56                  IS VOL SECURE            YM3925 54882400
         L     RF,CHKPTWTO              GET MSG RTN ADDR         YM3925 54882500
         BALR  RC,RF                    ISSUE MESSAGE            YM3925 54882600
*                                                                YM3925 54882700
         BNE   DAMV3000                 BRANCH IF NOT SECURE     YM3925 54882800
*                                       BRANCH IF NOT SECURE     Y02083 54883300
DAMV2670 LA    R0,K5                    SET 913-14 ABEND INDEX   Y02083 54883400
         B     DAMV9900                 GO ISSUE 913-14 ABEND    Y02083 54883500
         EJECT                                                          54887700
*                                                                Y02134 54887900
*****************************************************************Y02134 54888100
*                                                                Y02134 54888300
*        UPDATE ACCESSED DATE AND BACKUP COPY BIT.             @G60ASRB 54888400
*        READ IN ANY FORMAT 2 AND 3 DSCBS THAT DESCRIBE ISAM     Y02134 54888600
*        INFORMATION OR ADDITIONAL EXTENTS INTO ADDITIONAL       Y02134 54888700
*        GETMAINED CORE STORAGE.                                 Y02134 54888900
*                                                                Y02134 54892600
*****************************************************************Y02134 54896300
*                                                                Y02134 54900000
DAMV3000 EQU   *                                                 Y02134 54920000
*                                                                Y02134 54940000
         L     RF,DSCUPDA               UPDATE ROUTINE         @G60ASRB 54940100
         BALR  RET,RF                   CALL ROUTINE           @G60ASRB 54940200
*                                                              @G60ASRB 54940300
*        REG 15 CONTAINS 0 IF EXCP DONE IN THE UPDATE          @ZA32427 54940400
*        ROUTINE, AND 4 IF EXCP NOT DONE.                      @ZA32427 54940500
*                                                              @G60ASRB 54940600
         B     DAMV3001(RF)             DETERMINE PATH         @G60ASRB 54940700
DAMV3001 EQU   *                        BRANCH TABLE           @G60ASRB 54940800
         B     DAMV3002                 NO EXCP DONE           @ZA32427 54940900
         IECRES WAIT                                           @ZA32427 54941000
         TM    DXECB,ECBNOERR           CHECK I/O ERROR        @ZA32427 54941100
         BO    DAMV3002                 BRANCH IF NO           @ZA32427 54941200
         LA    R0,K24                   ABEND TABLE CODE       @ZA32427 54941300
         B     DAMV9900                 ABEND                  @ZA32427 54941400
*                                                              @G60ASRB 54941700
DAMV3002 EQU   *                                               @G60ASRB 54941800
*                                                              @G60ASRB 54942100
         XR    RD,RD                    CLEAR REG FOR IC INST    Y02072 54942400
         IC    RD,DSCNOEXT-DXDSCB(,RB)  GET NO. OF EXTENTS       Y02072 54943200
         CLI   DSCEXTYP-DXDSCB(RB),X40  CHECK FOR UL EXTENT      Y02134 54943600
         BNE   DAMV3005                 BRANCH IF NOT UL EXTENT  Y02134 54943700
         LA    RD,K1(,RD)               REFLECT UL EXTENT        Y02134 54943800
*                                                                Y02134 54943900
DAMV3005 EQU   *                        RD HAS NO. OF EXTENTS    YM1472 54944000
*                                                                Y02134 54944800
         SH    RD,THREE                 EXTENTS IN FORMAT 1      Y02072 54945200
         B     DAMV3020                 BRANCH TO READ F2 & F3   Y02134 54945600
         EJECT                                                          54945700
*                                                                Y02134 54946000
*****************************************************************Y02134 54947400
*                                                                Y02134 54948800
*        LOOP TO READ FORMAT 3 DSCB                              YM1472 54952000
*                                                                Y02134 54956000
*****************************************************************Y02134 54956800
*                                                                Y02134 54957600
DAMV3010 EQU   *                                                 Y02134 54959600
*                                                                Y02134 54959700
         LA    RB,L'JFCBDSNM(,RB)       INCREMENT PASSED KEY     Y02134 54959800
*                                                                Y02134 54961500
*****************************************************************Y02134 54961900
*                                                                Y02134 54962300
*        CHECK FOR MORE DSCB'S.                                  Y02134 54962700
*                                                                Y02134 54963100
*****************************************************************Y02134 54963700
*                                                                Y02134 54964300
DAMV3020 EQU   *                        LOOP TO READ F2 & F3     YM1472 54964900
*                                                                Y02134 54966600
         NC    DSCNEXT-DXDSCB(L'DSCNEXT,RB),DSCNEXT-DXDSCB(RB)   Y02134 54973300
         BZ    DAMV7000                 BRANCH IF NO MORE        Y02134 54980000
*                                                                Y02134 55040000
         MVC   DXDAADDR+K3(L'DSCNEXT),DSCNEXT-DXDSCB(RB) CCHHR   YM1472 55042000
*                                                                YM1472 55044000
         LA    R0,DSCBLNG+K4            LENGTH OF DSCB + PTR     Y02134 55120000
*                                                              @G18MSBS 55140000
         L     RF,ADDRF2F3              GET ADDRESS OF GETF2F3 @G18MSBS 55150000
         BALR  RET,RF                   GO GET F2F3 WORKAREA   @G18MSBS 55160000
*                                                                Y02134 55180000
         LA    R1,DXDSCB-DXDSCB(,R1)    CLEAR HIGH ORDER BYTE    Y02134 55200000
         ST    R1,CORECH(,RB)           CHAIN TO PREVIOUS CORE   Y02134 55220000
         LR    RC,RB                    SAVE LAST AREA PTR       YM1472 55222000
         LR    RB,R1                    LOAD DSCB BUFFER ADDR    Y02134 55240000
         EJECT                                                          55242000
*                                                                Y02134 55244000
*****************************************************************Y02134 55248000
*                                                                Y02134 55260000
*        MODIFY CCW TO READ NEXT FORMAT 2 OR 3 DSCB KEY & DATA   Y02134 55280000
*                                                                Y02134 55300000
*        SEARCH ID EQ                                            Y02134 55320000
*        TIC *-8                                                 Y02134 55340000
*        READ KEY & DATA                                         Y02134 55360000
*                                                                Y02134 55380000
*****************************************************************Y02134 55384000
*                                                                Y02134 55388000
         XC    DXCCW1(K16),DXCCW1       CLEAR CCW CORE         @ZA03658 55388200
         LA    RF,DXDAADDR+K3           SEARCH ADDR            @ZA03658 55388400
         ST    RF,DXCCW1                                       @ZA03658 55388600
         LA    RF,DXCCW1                TIC ADDR               @ZA03658 55388800
         ST    RF,DXCCW2                                       @ZA03658 55389000
         OC    DXCCW1(K16),ODA7440K     INIT CCWS              @ZA03658 55389200
DAMV3025 EQU   *                        READ NEXT DSCB           YM1472 55390000
*                                                                YM1472 55392000
         XC    DXCCW3,DXCCW3            CLEAR CCW                YM1472 55394000
         ST    RB,DXCCW3                DSCB BUFFER ADDRESS      YM1472 55420000
         OC    DXCCW3,ODA0630K          READ KEY & DATA/96 BYTES YM1472 55440000
*                                                                Y02134 55460000
         EXCP  DXIOB                    READ FORMAT 2 OR 3 DSCB  Y02134 55480000
*                                                                Y02134 55500000
         IECRES WAIT                    WAIT FOR READ COMPLETE   Y02134 55520000
*                                                                Y02134 55540000
         TM    DXECB,ECBNOERR           CHECK FOR I/O ERROR      Y02134 55560000
         LA    R0,K4                    OPEN=313-04 EOV=737-1C   Y02134 55570000
         BNO   DAMV9900                 BRANCH IF ERROR          Y02134 55580000
*                                                                Y02134 55580100
         CLC   DSCNEXT-DXDSCB(L'DSCNEXT,RC),L'JFCBDSNM+DSCNEXT-DXDSCB(RB55580300
               B)                       TEST FOR DSCB LOOP       YM1472 55580400
         LA    R0,K4                    OPEN=313-04 EOV=737-1C   YM1472 55580500
         BE    DAMV9900                 BRANCH IF IN LOOP        YM1472 55580600
*                                                                YM1472 55580700
         C     RB,CORECH(RCORE)         TEST FOR FIRST AREA      YM1472 55581600
         BNE   DAMV3030                 BRANCH IF NOT            YM1472 55581700
*                                                                YM1472 55581800
         TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP            YM1472 55581900
         BO    DAMV3030                 BR IF EXCP               YM1228 55582000
         TM    DCBDSORG,DCBDSGIS        TEST FOR ISAM            YM1472 55582100
         BNO   DAMV3030                 BRANCH IF NOT ISAM       YM1472 55582200
*                                                                YM1472 55582300
         LA    R0,K7                    OPEN=03D-08 EOV=NA       YM1228 55582400
         CLI   L'JFCBDSNM(RB),CHAR2     TEST FOR FORMAT 2        Y02134 55582500
         BNE   DAMV9900                 BRANCH IF NOT F2         YM1472 55582600
         B     DAMV3010                 BRANCH IF NO ERROR       Y02134 55593100
*                                                                YM1472 55593500
*****************************************************************YM1472 55593900
*                                                                YM1472 55594300
*        CHECK FOR FORMAT 2 AND NOT DSORG=IS                     YM1472 55594700
*                                                                YM1472 55594800
*****************************************************************YM1472 55595100
*                                                                Y02134 55595500
DAMV3030 EQU   *                        CHECK F3 EXTENTS         Y02134 55595900
*                                                                Y02134 55597300
         CLI   L'JFCBDSNM(RB),CHAR2     TEST FOR FORMAT 2        YM1472 55597700
         BNE   DAMV3035                 BRANCH TO CHECK FOR F3   YM1472 55598100
*                                                                YM1472 55598200
         LA    R0,K15                   OPEN = 03D-0C  EOV=NA  @ZA02225 55598600
         TM    DCBDSORG,DCBDSGDA        TEST IF BDAM           @ZA02225 55598700
         BO    DAMV9900                 IF YES,ERROR           @ZA02225 55598800
*                                                              @ZA02225 55598900
         NC    L'JFCBDSNM+DSCNEXT-DXDSCB(L'DSCNEXT,RB),L'JFCBDSNM+DSCNEX55599000
               XT-DXDSCB(RB)            TEST FOR MORE DSCBS      YM1472 55599100
         BZ    DAMV3060                 BRANCH IF NO MORE        YM1472 55599400
*                                                                YM1472 55599500
         MVC   DXDAADDR+K3(L'DSCNEXT),L'JFCBDSNM+DSCNEXT-DXDSCB(RB)     55599700
*                                       MOVE IN F3 CCHHR         YM1472 55600100
         B     DAMV3025                 BRANCH TO READ F3        YM1472 55600800
*                                                                YM1472 55601000
*****************************************************************YM1472 55601100
*                                                                YM1472 55601200
*        CHECK FOR SPLIT CYLINDER EXTENTS IN FORMAT 3            YM1472 55601300
*                                                                YM1472 55601400
*****************************************************************YM1472 55601800
*                                                                YM1472 55602200
DAMV3035 EQU   *                        CHECK FOR F3 DSCB        YM1472 55602300
*                                                                YM1472 55602400
         CLI   L'JFCBDSNM(RB),CHAR3     TEST FOR FORMAT 3        Y02134 55602500
         LA    R0,K4                    OPEN=313-04 EOV=737-1C   Y02134 55602600
         BNE   DAMV9900                 BRANCH IF NOT F3         Y02134 55602700
*                                                                Y02134 55602800
         LTR   RD,RD                    IS THERE ANOTHER EXT?    YM1472 55602900
         BNP   DAMV3060                 NO - CONTINUE            YM1472 55603300
*                                                                Y02134 55603800
         LA    RC,K4                    NO. OF EXTS IN FMT3 KEY  Y02072 55604300
         LR    R1,RB                    SAVE F3 POINTER          Y02134 55605700
*                                                                Y02134 55607100
DAMV3040 EQU   *                        LOOP FOR EXTENTS IN KEY  YM1472 55608500
*                                                                Y02134 55609900
         LTR   RD,RD                    IS THERE ANOTHER EXT?    Y02072 55611300
         BNP   DAMV7000                 NO - CONTINUE            YM1472 55612700
*                                                                Y02134 55614100
         CLI   DSCBEXTY-DSCBF3C(R1),X80 IS THIS A SPLIT CYLINDER?Y02072 55615500
         LA    R0,K9                    OPEN=213-24 EOV=C37-08   Y02134 55615900
         BE    DAMV9100                 YES - GO TO PROB DET     Y02072 55617500
*                                                                Y02072 55619500
         LA    R1,L'DSCEXT1(,R1)        INCREMENT TO NEXT EXT    Y02072 55620100
         BCTR  RD,R0                    DECREMENT EXTENT COUNT   Y02072 55622200
         BCT   RC,DAMV3040              CHECK ALL EXTS           Y02072 55626700
         EJECT                                                          55627100
*                                                                Y02072 55627200
         LA    RC,K9                    NO. OF EXTS IN RECORD    Y02072 55630700
*                                                                Y02134 55641000
DAMV3050 EQU   *                        LOOP FOR EXTENTS IN F3   YM1472 55643000
*                                                                Y02134 55645000
         LTR   RD,RD                    IS THERE ANOTHER EXT?    Y02072 55645400
         BNP   DAMV7000                 NO - CONTINUE            YM1472 55645800
*                                                                Y02134 55646200
         CLI   DSCBEXTY-DSCBF3C+L'DSCBFMID(R1),X80 SPLIT CYLINDR Y02072 55646300
         LA    R0,K9                    OPEN=213-24 EOV=C37-08   Y02134 55646700
         BE    DAMV9100                 YES - GO TO PROB DET     Y02072 55646800
*                                                                Y02072 55646900
         LA    R1,L'DSCEXT1(,R1)        INCREMENT TO NEXT EXT    Y02072 55648500
         BCTR  RD,R0                    DECREMENT EXTENT COUNT   Y02072 55650500
         BCT   RC,DAMV3050              CHECK ALL EXTS           Y02072 55650900
         B     DAMV7000                 BRANCH IF NO ERROR       YM1472 55651800
*                                                                YM1472 55652200
DAMV3060 EQU   *                        CLEAR LAST CHAIN PTR     YM1472 55652600
*                                                                YM1472 55653000
         XC    CORECH(K4,RC),CORECH(RC) CLEAR CHAIN PTR          YM1472 55653100
         B     DAMV7000                 EXIT                     YM1472 55653200
         EJECT                                                          55653400
*                                                                Y02134 55658000
*****************************************************************Y02134 55663500
*                                                                Y02134 55669000
*        ISAM VOLUME SPECIFIED ALREADY MOUNTED AND               Y02134 55674500
*        EXTENTS SPECIFIED ELSEWHERE.                            Y02134 55680000
*                                                                Y02134 55760000
*****************************************************************Y02134 55780000
*                                                                Y02134 55800000
DAMV6000 EQU   *                                                 Y02134 55820000
*                                                                Y02134 55840000
         LA    RF,K1                    LOAD DECREMENT VALUE     Y02134 55860000
*        SHIFT DECREMENT TO USE WITH CS INSTRUCTION              Y02134 55880000
         SLL   RF,K24-(K8*((UCBDMCT-UCBOB)-(((UCBDMCT-UCBOB)/K4)*K4)))  55900000
         L     R0,UCBOB+(((UCBDMCT-UCBOB)/K4)*K4) ALLIGN & LOAD  Y02134 55920000
*                                                                Y02134 55948000
DAMV6010 EQU   *                        LOOP FOR CS              Y02134 55960000
*                                                                Y02134 55980000
         LR    RET,R0                   SAVE CS OPERAND          Y02134 56000000
         SLL   RET,K25                  LEAVE ONLY UCBDMCT COUNT Y02134 56020000
         LTR   RET,RET                  TEST FOR COUNT OF 0      Y02134 56024000
         BZ    DAMV6020                 BRANCH IF ALREADY 0      Y02134 56028000
*                                                                Y02134 56032000
         LR    R1,R0                    LOAD OLD VALUE TO MODIFY Y02134 56040000
         SR    R1,RF                    ADD DECREMENT TO COUNT   Y02134 56060000
*                                                                Y02134 56064000
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 56068000
         CS    R0,R1,UCBOB+(((UCBDMCT-UCBOB)/K4)*K4) UPDAT COUNT Y02134 56080000
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 56084000
*                                                                Y02134 56088000
         BNE   DAMV6010                 BRANCH IF NOT THE SAME   Y02134 56100000
*                                                                Y02134 56104000
DAMV6020 EQU   *                        DECREMENT COMPLETE       Y02134 56108000
*                                                                YM1472 56110000
         EJECT                                                          56110400
*                                                                Y02134 56112000
*****************************************************************Y02134 57500000
*                                                                Y02134 57520000
*        RETURN TO IFG0194A TO PARALLEL MOUNT                    Y02134 57540000
*        OR LOOK AHEAD MOUNT.                                    Y02134 57560000
*                                                                Y02134 57580000
*****************************************************************Y02134 57600000
*                                                                Y02134 57620000
DAMV7000 EQU   *                                                 Y02134 57640000
*                                                                Y02072 57641000
         LH    RF,DXUNITOF              GET UNIT OFFSET IN TIOT  Y02134 57712000
         AR    RF,RTIOT                 ADD OFFSET TO ENTRY      Y02134 57714000
         MODESET EXTKEY=SUPR            TIOT/UCB KEY             Y02082 57716000
         OI    TIOESTTB-TIOESTTB(RF),TIOSUSED DATA SET ON DEVICE Y02134 57718000
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 57718400
*                                                                Y02134 57718800
         IECRES LOAD,MODID=ID4C4A,BRCODE=K12,BRANCH=QUEUED       Y02134 57719000
         EJECT                                                          57719400
*                                                                Y02134 57720000
*****************************************************************Y02134 57724000
*                                                                Y02134 57728000
*        RETURN TO IFG0194A TO REJECT VOLUME.                    Y02134 57732000
*                                                                Y02134 57736800
*****************************************************************Y02134 57737600
*                                                                Y02134 57738400
DAMV7500 EQU   *                                                 Y02134 57739200
*                                                                Y02134 57739300
         LA    R0,K13                   OPEN= 713-08 EOV= 737-08 YM6514 57743500
         B     DAMV9900                 DETERMINE ABEND CODE     YM6514 57743600
*                                                                YM1472 57743700
DAMV7510 EQU   *                        ENTRY WITH CODE IN R0    YM1472 57744300
*                                                                YM1472 57744700
         CLC   UCBVOLI,ZEROS            CHECK FOR WRONG VOLUME   YM7396 57745100
         BNZ   DAMV7520                 BYPASS REJECT SWITCH     YM7396 57745200
*                                                                YM7396 57748100
         XR    R0,R0                    CLEAR FOR REJECT         YM7396 57748500
*                                                                YM7396 57748600
DAMV7520 EQU   *                        RETURN TO ABEND OR REJECTYM7396 57750600
*                                                                YM7396 57752600
         ST    RB,CORECH(,RB)           CHAIN FOR REUSE          Y02134 57752800
         MVC   DXRETMOD,DXSAVMOD        SAVE RETURN LOAD         Y02134 57756200
         MVC   DXRETCOD,DXSAVOFF        SAVE RETURN OFFSET       Y02134 57759600
*                                                                Y02134 57763000
         IECRES LOAD,MODID=ID4C4A,BRCODE=K16,BRANCH=QUEUED       Y02134 57766400
*                                                                Y02134 57769800
*****************************************************************Y02134 57773200
*                                                                Y02134 57776600
*        REJECT WRONG VOLUME MOUNTED.                            Y02134 57780000
*                                                                Y02134 57800000
*****************************************************************Y02134 57820000
*                                                                Y02134 57840000
DAMV8000 EQU   *                                                 Y02134 57860000
*                                                                Y02134 57880000
         TM    UCBDMCT,UCBDMC-K1        TEST FOR ONE USER        YM1472 57890000
         BNZ   DAMV7500                 BRANCH, MORE THAN 1 USER YM1472 57892000
         TM    UCBSTAB,UCBBSVL          TEST FOR SHAREABLE       YM1472 57894000
         BZ    DAMV7500                 BRANCH IF SHAREABLE UNIT YM1472 57896000
*                                                                YM1472 57898000
         MVC   DXRETMOD,ID4C4C          RETURN ID TO SAVE AREA   Y02134 57900000
         MVI   DXRETCOD,K4              SET RETURN INDICATOR     Y02134 57920000
*                                                                Y02134 57940000
         IECRES LOAD,MODID=ID4C4J,BRCODE=K4,BRANCH=QUEUED        Y02134 57960000
         EJECT                                                          58280000
*                                                                Y02134 59680000
*****************************************************************Y02134 59700000
*                                                                Y02134 59720000
*        AN ERROR HAS BEEN DETECTED.                             Y02134 59740000
*                                                                Y02134 59760000
*****************************************************************Y02134 59780000
*                                                                       59800000
DAMV9000 DMABCOND PCK,SETLOCK           SETLOCK ERROR ROUTINE    Y02134 59810000
*                                                                Y02080 59862800
*****************************************************************Y02134 59864000
*                                                                Y02134 59866000
*        213 ABEND EXIT ROUTINE                                  Y02134 59866400
*                                                                Y02134 59868000
*****************************************************************Y02134 59868400
*                                                                Y02134 59868500
DAMV9100 EQU   *                                                 Y02080 59868600
*                                                                Y02134 59868800
         MVI   DXWORK,K213              SET 213 CODE             Y02134 59878800
         B     DAMV9901                 BRANCH TO ERROR ROUTINE  Y02134 59888800
*                                                                Y02080 59910000
*****************************************************************Y02134 59912000
*                                                                Y02134 59914000
*        GO TO PROBLEM DETERMINATION                             YM3111 59916000
*                                                                Y02134 59918000
*****************************************************************Y02134 59918400
*                                                                Y02134 59918500
DAMV9900 EQU   *                        REGULAR ENTRY            Y02080 59918600
*                                                                Y02134 59918800
         MVI   DXWORK,K0                SET 213 SWITCH OFF       Y02134 59918900
*                                                                Y02134 59919000
DAMV9901 EQU   *                        213 ABEND ENTRY          Y02080 59919100
*                                                                Y02134 59919200
         L     RF,ABEND                 EPA OF INTERFACE ROUTINE YM3070 59921200
         BR    RF                       BRANCH, GET INTERNAL CDE YM3070 59923200
         EJECT                                                          59927200
*                                                                       59998400
*********************************************************************** 60000000
*                                                                       60002900
*        CONSTANTS                                                      60008600
*                                                                       60014300
*********************************************************************** 60020000
*                                                                       60040000
ISAMRTN  DC    A(DAMV2103)                                     @ZA26665 60041000
RACRTN   DC    A(DAMV4500)              RAC ROUTINE            @Z40RSDH 60043400
CHKPTWTO DC    A(DAMV4000)              CHECKPOINT MSG ROUTINE   YM3925 60044400
CHKPTRET DC    A(DAMV4010)              CHECKPOINT WTOR RETURN   YM3925 60045400
JES3ROUT DC    A(DAMV5000)              JES3 INTERFACE ROUTINE @G18MSBS 60046400
IECPRLTV DC    A(DAMV8800)              IECPRLTV INTERFACE RTN   YM3070 60047400
IECPCNVT DC    A(DAMV8900)              IECPCNVT INTERFACE RTN   YM3070 60048700
ABEND    DC    A(DAMV9999)              PROB DET INTERFACE RTN   YM3070 60049400
ADDRF1   DC    A(GETF1)                 IECRES GET FOR F1 DSCB @G18MSBS 60050400
ADDRF2F3 DC    A(GETF2F3)               IECRES GET FOR F2/F3   @G18MSBS 60051400
ADDRCCWS DC    A(GETCCWS)               IECRES GET FOR CCW'S   @G18MSBS 60052400
ADDRFREE DC    A(FREECCWS)              IECRES FREE FOR CCW'S  @G18MSBS 60053400
ADDRTEST DC    A(DAMVTEST)              TEST AUTHORIZED USER   @G18MSBS 60054400
DSNOTFA  DC    A(DSNOTFND)              DSCB-NOT-FOUND ROUTINE @G60ASRB 60054600
DSCUPDA  DC    A(DSCUPD)                UPDATE DSCB ROUTINE    @G60ASRB 60054800
DOCVTD   DC    A(DOCVTDTE)              CONVERT CVT DATE RTN.  @G60ASRB 60055000
ENQLIST  DC    A(0)                     ENQ LIST                 Y02134 60055400
         ENQ   (SYSZVOLS,,E,6,SYSTEM),TCB=,RET=USE,MF=L          Y02134 60056400
DASSOBID DC    CL4'SSOB'                SSOB HEADER ID         @G18MSBS 60057400
SYSZVOLS DC    CL8'SYSZVOLS'            ENQ VOL SER MAJOR NAME   Y02134 60060000
SCRTCH   DC    CL6'SCRTCH'              SCRTCH REQUEST NAME      Y02134 60080000
KNO      DC    C'NO '                   WTOR REPLY COMPARAND     Y02083 60090000
KYES     DC    C'YES'                   WTOR REPLY COMPARAND     Y02083 60092000
BLANKS   DC    CL6' '                   BLANK VOLUME SERIAL NO.  Y02134 60100000
ZEROS    DC    XL6'00'                  ZERO VOLUME SERIAL NO.   Y02134 60120000
DAMVEOV  DC    CL3'055'                 EOV MOD ID               Y02134 60140000
ONE      DC    H'1'                     CONSTANT OF ONE          Y02134 60144000
THREE    DC    H'3'                     CONSTANT OF THREE        Y02072 60144400
         EJECT                                                          60214000
*                                                                Y02134 60218600
*********************************************************************** 60223200
*                                                                Y02134 60227800
*        CCW'S TO READ VOLUME LABEL                              Y02134 60232400
*                                                                Y02134 60237000
*********************************************************************** 60241600
*                                                                Y02134 60246200
ODA7440K DC    X'3100000040000005'      SEARCH ID EQ             Y02134 60250800
         DC    X'0800000000000000'      TIC *-8                  Y02134 60255400
         DC    X'0600000000000050'      READ DATA                Y02134 60260000
*                                                                Y02134 60450000
*********************************************************************** 60452000
*                                                                Y02134 60460000
*        CCW'S TO READ FORMAT 1 OR 4 DSCB DIRECTLY.              Y02134 60480000
*                                                                Y02134 60490000
*********************************************************************** 60492000
*                                                                Y02134 60500000
ODA0630K CCW   CCWRDKEY,K0,K0,DSCBLNG   READ KEY AND DATA        YM1472 60502000
*                                                                YM1472 60504000
ODA0640K DC    X'3100000040000005'      SEARCH ID EQ             Y02134 60520000
         DC    X'0800000000000000'      TIC *-8                  Y02134 60540000
         DC    X'290000004000002C'      SEARCH KEY EQ            Y02134 60560000
         DC    X'0300000020000001'      NOP  (NO CHAIN, SLI)     Y02134 60580000
         DC    X'0600000000000060'      READ DATA (DSCB)         Y02134 60600000
*                                                                Y02134 60620000
ODA0650K CCW   CCWMTSID,K0,CCWCMDCH+CCWSILI,K5 CCWS TO FIND F1   Y02082 60625000
         CCW   CCWTIC,K0,K0,K0                                   Y02082 60630000
         CCW   CCWSCHKE,K0,CCWCMDCH+CCWSILI,L'JFCBDSNM           Y02134 60635000
         CCW   CCWNOP,K0,CCWSILI,K1                              Y02082 60636000
         CCW   CCWTIC,K0,K0,K0                                   Y02082 60637000
         CCW   CCWSCHKE,K0,CCWCMDCH+CCWSILI,L'JFCBDSNM           Y02134 60638000
         CCW   CCWTIC,K0,K0,K0                                   Y02082 60639000
         CCW   CCWRDDA,K0,CCWCMDCH,K96                           Y02082 60639200
         CCW   CCWRDCNT,K0,K0,K8                                 Y02082 60639400
*                                                                Y02134 60639800
ODA0660K DC    X'7FFF'                  MAX NO. TRACKS IN EXTENT Y02134 60640000
ODA0670K DC    44X'04'                  KEY OF FORMAT 4 DSCB   @ZA33308 60660000
*                                                                Y02134 60680000
         EJECT                                                          60690000
         XCTLTABL ID=(ID4C0P,0P,ID4C4C,4C,ID4C4A,4A,ID4C4J,4J,   Y02134X60700000
               ID4C5T,5T,ID4C5G,5G,,IFG0554P),                   Y02134X60720000
               SVC=019,BRT=SHORT,LENGTH=4K                       YM3070 60730000
*                                                                YM3925 60730100
***************************************************************@ZA26665 60730200
*       CZASOWO DODANE PRZEZ GP ZEBY ZNIWELOWAC EFEKT BLEDU             60730300
***************************************************************@ZA26665 60730400
*                                                              @ZA26665 60730600
         EJECT                                                          60730700
*                                                                YM3925 60730800
***************************************************************@ZA26665 60731200
*       SETUP 03D-08 ABEND IF ISAM AND NO NEXT DSCB            @ZA26665 60731300
***************************************************************@ZA26665 60731400
*                                                              @ZA26665 60731500
DAMV2103 EQU   *                                               @ZA26665 60731600
         TM    DCBDSORG,DCBDSGIS        TEST FOR ISAM          @ZA26665 60731700
         BNO   DAMV2105                 BR IF NOT ISAM         @ZA26665 60731800
         LA    R0,K7                    OPEN=03D-08            @ZA26665 60731900
         NC    DSCNEXT,DSCNEXT          NEXT DSCB ?            @ZA26665 60732000
         BZ    DAMV9900                 NO BR TO ERROR         @ZA26665 60732100
         BR    RET                      RETURN                 @ZA26665 60732200
*                                                              @ZA26665 60732300
*****************************************************************YM3925 60732400
*                                                                YM3925 60732500
*        ISSUE CHECKPOINT MESSAGES                               YM3925 60734000
*                                                                YM3925 60734400
*        ON ENTRY -                                              YM3925 60734500
*        RC = RETURN ADDRESS                                     YM3925 60734800
*        RF = ENTRY ADDRESS                                      YM3925 60735200
*        R0,R1 = VOLATILE                                        YM3925 60735600
*        RET = 52 - CAN VOLUME BE MADE SECURE FOR CHECKPOINT     YM3925 60735700
*              56 - IS THE VOLUME A SECURE CHECKPOINT VOLUME     YM3925 60735800
*                                                                YM3925 60735900
*        ON RETURN -                                             YM3925 60736200
*        CC=8 (ZERO) MEANS SECURE VOLUME                         YM3925 60736300
*                                                                YM3925 60736500
*****************************************************************YM3925 60736800
*                                                                YM3925 60737100
DAMV4000 EQU   *                        CHECKPOINT MSGS          YM3925 60737400
*                                                                YM3925 60737700
         USING *,RF                     ESTABLISH ADDRESSABILITY YM3925 60738100
         STC   RET,DXWORK1              SAVE WTOR OFFSET         YM3925 60739700
         ICM   RC,B'1000',DXWORK1       RETREIVE OFFSET          YM3925 60741700
*                                                                YM3925 60741800
         MVC   DXWORK1(L'KYES),KYES     SET UP VIO REPLY         YM3925 60741900
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO DATA SET    YM3925 60742100
         BO    DAMV4020                 BRANCH IF VIO DATA SET   YM3925 60742500
         DROP  RF                                                YM3925 60742600
*                                                                YM3925 60742800
         XC    DXWORK1,DXWORK1          CLEAR WTOR REPLY AREA    YM3925 60743000
         LA    R1,DXWORK1               POINT TO REPLY AREA      YM3925 60743100
         LA    R0,K3                    SET REPLY LENGTH         YM3925 60743200
         SLL   R0,K24                   MOVE LENGTH TO HI BYTE   YM3925 60743300
         OR    R1,R0                    SET UP WTOR PARM         YM3925 60743400
*                                                                YM3925 60743600
         MVC   DXRETMOD,ID4C4C          SET RETURN NAME & EPA    YM3925 60743800
         MVI   DXRETCOD,K16             SET BR TABLE RETURN CODE YM3925 60744000
         IECRES LOAD,MODID=ID4C4J,BRCODE=(14),BRANCH=QUEUED      YM5957 60744800
*                                                                YM3925 60745400
*****************************************************************YM3925 60745800
*                                                                YM3925 60746200
*        RETURN HERE WITH OPERATOR REPLY                         YM3925 60746600
*                                                                YM3925 60747000
*****************************************************************YM3925 60747100
*                                                                YM3925 60747200
DAMV4010 EQU   *                        WTOR RETURN              YM3925 60747300
*                                                                YM3925 60747900
         IECRES WAIT                    WAIT FOR REPLY           YM3925 60748700
*                                                                YM3925 60749100
         USING *,RET                    ESTABLISH ADDRESSABILITY YM3925 60749200
         OC    DXWORK1,BLANKS           FOLD REPLY TO UPPER CASE YM3925 60749300
         CLC   KYES,DXWORK1             CHECK CORRECT REPLY      YM3925 60749400
         BE    DAMV4020                 BRANCH TO SET CODE       YM3925 60749500
         CLC   KNO,DXWORK1              CHECK CORRECT REPLY      YM3925 60749700
         BE    DAMV4020                 BRANCH TO SET CODE       YM3925 60750500
         L     RF,CHKPTWTO              GET MSG RTN ADDRESS      YM3925 60750600
         LR    RET,RC                   GET OFFSET IN HI BYTE    YM3925 60750700
         SRL   RET,K24                  SHIFT TO LOW BYTE        YM3925 60750800
         BR    RF                       RE-ISSUE MSG             YM3925 60752600
*                                                                YM3925 60754600
DAMV4020 EQU   *                        SET RETURN CODE          YM3925 60754700
*                                                                YM3925 60755300
         CLC   KYES,DXWORK1             REPLY = 'YES'            YM3925 60756000
         BR    RC                       RETURN                   YM3925 60756600
         DROP  RET                                               YM3925 60758400
         EJECT                                                 @Z40RSDH 60760200
*********************************************************************** 60760300
*                                                                     * 60760400
*        RAC VERIFICATION ROUTINE                                     * 60760500
*                                                                     * 60760600
*********************************************************************** 60760700
*                                                                     * 60760800
*        REG   CONTENTS AT ENTRY                                      * 60760900
*        2     PTR DCB COPY                                           * 60761000
*        4     WORK AREA ADDR                                         * 60761100
*        6     WTG TABLE                                              * 60761200
*        7     CURRENT PARM LIST ENTRY                                * 60761300
*        A     CURRENT UCB ADDRESS                                    * 60761400
*        B     CURRENT F1 DSCB AREA                                   * 60761500
*        D     CURRENT JFCB ADDR                                      * 60761600
*        E     RETURN ADDR                                            * 60761700
*        F     ENTRY POINT                                            * 60761800
*                                                                     * 60761900
*        THIS ROUTINE PERFORMS ALL CHECKS FOR RAC ON DASD DATA @Z40RSDH 60762000
*        SETS.                                                 @Z40RSDH 60762100
*              1. CHECK THE CURRENT ENVIRONMENT'S AUTHORIZATION@Z40RSDH 60762200
*                 TO RAC DEFINED DATA SETS.                    @Z40RSDH 60762300
*              2. FOR PS OUTPUT AT EOV, ENSURE THAT THE DATA   @Z40RSDH 60762400
*                 SET ON THE SUBSEQUENT VOLUME IS CONSISTENTLY @Z40RSDH 60762500
*                 DEFINED TO RAC WITH RESPECT TO THE PREVIOUS  @Z40RSDH 60762600
*                 VOLUME.                                      @Z40RSDH 60762700
*                                                                     * 60762800
*        RETURN IS VIA REG 14 WITH THE FOLLOWING IN REG 15:           * 60762900
*                                                                     * 60763000
*        0     RAC OK, BYPASS PASSWORD                                * 60763100
*        4     NO RAC, PROCESS PASSWORD                               * 60763200
*        8     ABEND - REG 0 CONTAINS INDEX TO 194C INTERNAL ABEND TBL* 60763300
*                                                                     * 60763400
*        REGISTERS 2-14 ARE PRESERVED.                                * 60763500
*********************************************************************** 60763600
         SPACE 1                                               @Z40RSDH 60763700
*                                                              @Z40RSDH 60763800
*        DATA FOR RAC                                          @Z40RSDH 60763900
*                                                              @Z40RSDH 60764000
*        THE FOLLOWING ARE OFFSETS TO THE ERROR CODE TABLES    @Z40RSDH 60764100
*        IN THIS MODULE FOR RAC ABENDS                         @Z40RSDH 60764200
OABRAC01 EQU   16                       OPEN=913-38 EOV=937-28 @Z40RSDH 60764300
OABRAC02 EQU   OABRAC01+1               EOV=937-2C             @Z40RSDH 60764400
OABRAC03 EQU   OABRAC01+2               OPEN=913-3C EOV=937-30 @Z40RSDH 60764500
OABRAC04 EQU   OABRAC01+3               OPEN=913-40 EOV=937-34 @Z40RSDH 60764600
OABRAC05 EQU   OABRAC01+4               EOV=937-3C             @Z40RSDH 60764700
OABRAC06 EQU   OABRAC01+6               EOV=937-40             @G32DSMI 60764800
*                                                                       60764900
         SPACE 2                                               @Z40RSDH 60765000
*                                                              @Z40RSDH 60765100
* RAC ROUTINE                                                  @Z40RSDH 60765200
*                                                              @Z40RSDH 60765300
DAMV4500 EQU   *                        RAC CHECK              @Z40RSDH 60765400
         L     R1,WTGPREFX              ADDR OF PREFIX         @Z40RSDH 60765500
         STM   R2,RET,IECREGSV-IECPREFX+R2*K4(R1) SAVE REGS    @Z40RSDH 60765600
         LR    RC,R1                    SAVE REG SAEA          @Z40RSDH 60765700
         LR    RBASE,RF                 SET BASE FOR RAC CODE  @Z40RSDH 60765800
         USING DAMV4500,RBASE           EPA IS BASE            @Z40RSDH 60765900
         L     R9,DXJSCBAD              PTR ACTV JSCB          @Z40RSDH 60766000
         USING IEZJSCB,R9               JSCB BASE REG          @Z40RSDH 60768800
         TM    JSCBSWT1,JSCBPASS        CHK BYPASS RAC         @Z40RSDH 60768900
         BO    DAMV4910                 BR - NO RAC CHECKING   @Z40RSDH 60769000
*                                                              @Z40RSDH 60769100
*        A VSAM DATA SPACE MAY NOT BE DEFINED TO RAC; VSAM     @Z40RSDH 60769200
*        PERMITS DATA SETS, CATALOGS, ETC. BUT NOT DATA SPACES @Z40RSDH 60769300
*                                                              @Z40RSDH 60769400
         TM    DSCFILTY+K1-DXDSCB(RB),ACBDORGA VSAM DATA SPACE @Z40RSDH 60769500
         BNO   DAMV4520                 BR NOT VSAM DATA SPACE @Z40RSDH 60769600
         LA    R0,OABRAC04              INT ABEND CODE OFFSET  @Z40RSDH 60769700
         TM    DSCDSIND-DXDSCB(RB),DS1RACDF CHK IF RAC FMT1    @Z40RSDH 60769800
         BO    DAMV4920                 OPEN=913-40 EOV=937-34 @Z40RSDH 60769900
*                                                              @Z40RSDH 60770000
DAMV4520 EQU   *                        CHECK COMPONENT        @Z40RSRJ 60771200
         MVC   DXCCW9(RACLLEN),RACLIST  SET UP RACHECK LIST    @G32DSMI 60771300
         CLC   WTGMODNM+K3(K3),DAMVEOV2 CHK IF EOV             @Z40RSDH 60771400
         BE    DAMV4600                 BR IF EOV              @Z40RSDH 60771500
*                                                              @Z40RSDH 60771600
* OPEN OR CONCATENATION - RACF                                 @G32DSMI 60771700
*                                                              @Z40RSDH 60771800
DAMV4530 EQU   *                                               @G32DSMI 60771900
         L     RET,DXDEBXAD             GET ADDRESS OF DEB EXT @G32DSMI 60772000
         USING DEBXTN,RET                                      @G32DSMI 60772100
         NI    DEBXFLG1,X'FF'-DEBXDSSI  TURN OFF RACF FLAG     @G32DSMI 60772200
         DROP  RET                                             @G32DSMI 60772300
         TM    DSCDSIND-DXDSCB(RB),DS1RACDF CHK F1 RAC DEFINED @Z40RSDH 60772400
         BNO   DAMV4910                 BR F1 NOT RAC DEFINED  @Z40RSDH 60772500
         BAL   RET,DAMV4800             PERFORM RACHECK        @Z40RSDH 60772600
         LTR   RF,RF                    CHK IF AUTH            @Z40RSDH 60772700
         BZ    DAMV4900                 BR IF RAC AUTH         @Z40RSDH 60772800
         LA    R0,OABRAC03              NO RAC PROFILE         @Z40RSDH 60772900
         CL    RF,DAMVRNAU              CHK IF NOT AUTHORIZED  @Z40RSDH 60773000
         BNE   DAMV4920                 OPEN=913-3C            @Z40RSDH 60773100
         LA    R0,OABRAC01              NOT AUTHORIZED         @Z40RSDH 60773200
         B     DAMV4920                 OPEN=913-38            @Z40RSRJ 60773300
*                                                              @Z40RSDH 60773400
* EOV - RAC                                                    @Z40RSDH 60773500
*                                                              @Z40RSDH 60773600
DAMV4600 EQU   *                        EOV RAC                @Z40RSDH 60773700
         TM    DCBOFLGS,DCBOFEOV        CONCATENATION          @G32DSMI 60773800
         BO    DAMV4530                 YES - TREAT LIKE OPEN  @G32DSMI 60773900
         TM    DXDCBLST,OUTPUT          CHK OPEN OUTPUT        @Z40RSDH 60774000
         BZ    DAMV4660                 BR INPUT ONLY          @Z40RSDH 60774100
*                                                              @Z40RSDH 60774200
*        CHECK FOR PO BEFORE EXCP, DSORG FIELD EXISTS IN COPY  @Z40RSDH 60774400
*        EVEN IF NOT IN USER DCB                               @Z40RSDH 60774600
         TM    DCBDSORG,DCBDSGPO        CHK IF PO              @Z40RSDH 60774800
         BO    DAMV4660                 BR IF PO               @Z40RSDH 60775000
         TM    DCBMACRF,DCBMEXCP        CHK IF EXCP            @Z40RSDH 60775200
         BO    DAMV4620                 EXCP ASSUME PS         @Z40RSDH 60775400
         NC    DCBDSORG,DCBDSORG        CHK IF DSORG SPECIFIED @Z40RSDH 60775600
         BZ    DAMV4620                 NO DSORG ASSUME PS     @Z40RSDH 60775800
         TM    DCBDSORG,DCBDSGPS        CHK PHYSICAL SEQ       @Z40RSDH 60776000
         BNO   DAMV4660                 BR NOT PS              @Z40RSDH 60777000
*                                                              @Z40RSDH 60777200
*        PS OUTPUT                                             @Z40RSDH 60777400
*                                                              @Z40RSDH 60777900
DAMV4620 EQU   *                        PS OUTPUT              @Z40RSDH 60778000
         L     R9,DXDEBXAD              GET CURRENT DEBX       @Z40RSDH 60778100
         USING DEBXTN,R9                DEBX ADDR              @Z40RSDH 60778200
         TM    DEBXFLG1,DEBXDSSI        CHK IF 1ST VOL RAC DEF @Z40RSRJ 60778300
         BZ    DAMV4640                 BR IF NOT RAC DATA SET @Z40RSDH 60778400
         DROP  R9                                              @Z40RSDH 60778500
*                                                              @Z40RSDH 60778600
*        ON OUTPUT IF FIRST VOLUME IS RAC DEFINED THEN ALL     @Z40RSDH 60778700
*        SUCCEEDING VOLUMES MUST BE RAC DEFINED.               @Z40RSRJ 60778800
*                                                              @Z40RSDH 60778900
         LA    R0,OABRAC02              INCONSISTENT RAC DEFN  @Z40RSDH 60780100
         TM    DSCDSIND-DXDSCB(RB),DS1RACDF CHK CURR RAC DEFN  @Z40RSDH 60780200
         BNO   DAMV4920                 EOV=937-2C             @Z40RSDH 60780300
         LA    R9,DXCCW9                ADDRESS OF THE RACHECK @G32DSMI 60780400
         USING ACHKLIST,R9              PARAMETER LIST         @G32DSMI 60780500
         LA    RET,DXOLDVOL             ADDRESS OF OLDVOL PARM @G32DSMI 60780600
         ST    RET,ACHKOVOL             STORE ADD OF OLD VOL   @G32DSMI 60780700
         DROP  R9                                              @G32DSMI 60780800
         BAL   RET,DAMV4800             GO PERFORM RACHECK     @Z40RSRJ 60780900
         B     DAMV4670                 GO CHECK RESULTS       @Z40RSRJ 60781000
*                                                              @Z40RSDH 60781100
*        ON OUTPUT IF THE FIRST VOLUME IS NOT RAC DEFINED      @Z40RSDH 60781200
*        THEN ALL SUCCEEDING VOLUMES MUST NOT BE RAC DEFINED.  @Z40RSDH 60781300
*                                                              @Z40RSDH 60781400
DAMV4640 EQU   *                        FIRST VOL NOT RAC DEF  @Z40RSDH 60782000
         LA    R0,OABRAC05              INCONSISTENT RAC DEFN  @Z40RSDH 60782100
         TM    DSCDSIND-DXDSCB(RB),DS1RACDF CHK CURR RAC DEFN  @Z40RSRJ 60782200
         BO    DAMV4920                 EOV=937-3C             @Z40RSDH 60782300
         B     DAMV4910                 NOT RAC DEFN - CONTIN  @Z40RSDH 60782400
*                                                              @Z40RSDH 60782500
*        NOT PS OUTPUT                                         @Z40RSDH 60782600
*                                                              @Z40RSDH 60782700
DAMV4660 EQU   *                        NOT PS OUTPUT          @Z40RSDH 60782800
         TM    DSCDSIND-DXDSCB(RB),DS1RACDF CHK CURR F1 RAC    @Z40RSDH 60782900
         BNO   DAMV4910                 BR CURR VOL NOT RAC    @Z40RSDH 60783000
         BAL   RET,DAMV4800             CHK RAC AUTH TO VOL    @Z40RSDH 60783100
DAMV4670 EQU   *                        CHECK RESULTS          @Z40RSRJ 60783200
         LTR   RF,RF                    CHK AUTHORIZED         @Z40RSDH 60783300
         BZ    DAMV4905                 RAC AUTH CONTIN        @Z40RSRJ 60783400
         LA    R0,OABRAC03              NO RAC PROFILE         @Z40RSDH 60783500
         CL    RF,DAMVRNAU              CHK IF NOT AUTHORIZED  @Z40RSDH 60783600
         BL    DAMV4920                 EOV=937-30 NO PROFILE  @Z40RSDH 60784400
         LA    R0,OABRAC01              NOT RAC AUTHORIZED     @Z40RSDH 60784500
         BE    DAMV4920                 EOV=937-28             @G32DSMI 60784600
         LA    R0,OABRAC06              INCONSISTANT DS        @G32DSMI 60784700
         B     DAMV4920                 EOV=937-40             @G32DSMI 60784800
         SPACE 2                                               @Z40RSDH 60784900
*                                                              @Z40RSDH 60785000
*        PERFORM RACHECK                                       @Z40RSDH 60785100
*        RETURN WITH RACHECK RETURN CODE IN REG 15             @Z40RSDH 60785200
*                                                              @Z40RSDH 60785300
DAMV4800 EQU   *                        RACHECK                @Z40RSDH 60785400
         LA    R5,ACHKTRD               CHK READ AUTH          @Z40RSRJ 60785600
         TM    DXDCBLST,OUTPUT          TEST FOR OUTPUT        @Z40RSDH 60785700
         BZ    DAMV4820                 BR READ ONLY           @Z40RSDH 60785800
         LA    R5,ACHKTUPD              CHK UPDATE AUTH        @Z40RSRJ 60785900
DAMV4820 EQU   *                        ISSUE RACHECK          @Z40RSDH 60786000
         RACHECK ENTITY=((RD)),VOLSER=UCBVOLI,ATTR=(R5),       @Z40RSDH*60786100
               MF=(E,DXCCW9)            CHK AUTHORIZATION      @Z40RSRJ 60786200
*                                                              @Z40RSDH 60786300
*        RETURN CODE FROM RACHECK                              @Z40RSDH 60786400
*          0 - AUTHORIZED                                      @Z40RSDH 60786500
*          4 - ENTITY/VOLUME NOT DEFINED TO RAC                @Z40RSDH 60786600
*          8 - NOT AUTHORIZED                                  @Z40RSDH 60786700
*                                                              @Z40RSDH 60786800
         BR    RET                      RETURN                 @Z40RSDH 60786900
*                                                              @Z40RSDH 60787000
* RETURN TO CALLER                                             @Z40RSDH 60787100
*                                                              @Z40RSDH 60787200
DAMV4900 EQU   *                        RAC OK - OPEN          @Z40RSRJ 60787300
         L     R9,DXDEBXAD              GET CURRENT DEBX       @Z40RSDH 60787400
         USING DEBXTN,R9                DEBX ADDR              @Z40RSDH 60787500
         OI    DEBXFLG1,DEBXDSSI        INDIC 1ST VOL RAC DEF  @Z40RSRJ 60787600
         DROP  R9                                              @Z40RSRJ 60787700
DAMV4905 EQU   *                        RAC OK - EOV           @Z40RSRJ 60787800
         LA    RF,K0                    RAC OK                 @Z40RSDH 60787900
         B     DAMV4950                 EXIT                   @Z40RSDH 60788000
DAMV4910 EQU   *                        NOT RAC DEFINED        @Z40RSDH 60788100
         LA    RF,K4                    NOT RAC DEFINED        @Z40RSDH 60788200
         B     DAMV4950                 EXIT                   @Z40RSDH 60788300
DAMV4920 EQU   *                        ABEND                  @Z40RSDH 60788400
         LA    RF,K8                    ABEND - TBL OFFSET R0  @Z40RSDH 60788500
         B     DAMV4950                 EXIT                   @Z40RSDH 60788600
*                                                              @Z40RSDH 60788700
DAMV4950 LM    R2,RET,IECREGSV-IECPREFX+R2*K4(RC) RESTORE REGS @Z40RSDH 60788800
         BR    RET                      RETURN                 @Z40RSDH 60788900
         SPACE 2                                               @Z40RSDH 60789000
*                                                              @Z40RSDH 60789100
* CONSTANTS FOR RAC CODE                                       @Z40RSDH 60789200
*                                                              @Z40RSDH 60789300
RACLIST  RACHECK CLASS=DATASET,DSTYPE=N,MF=L RACHECK PLIST     @Z40RSRJ 60789400
RACLLEN  EQU   *-RACLIST                LENGTH RACHECK PLIST   @Z40RSDH 60789500
DATASET  DC    AL1(7),CL7'DATASET'      CLASS NAME             @Z40RSRJ 60789700
DAMVRNAU DC    F'8'                     RACHECK RETURN CODE    @Z40RSDH*60789800
                                        FOR NOT AUTHORIZED     @Z40RSDH 60789900
         USING DAMV0000,RBASE           REESTABLISH BASE USING @Z40RSDH 60790000
         EJECT                                                          60790200
*                                                              @G18MSBS 60790300
***************************************************************@G18MSBS 60790400
*                                                              @G18MSBS 60790500
*      **************************                              @G18MSBS 60790600
*      * JES3 INTERFACE ROUTINE *                              @G18MSBS 60790700
*      **************************                              @G18MSBS 60790800
*                                                              @G18MSBS 60790900
*        ON ENTRY -                                            @G18MSBS 60791000
*        R0 AND R1 ARE VOLATILE                                @G18MSBS 60791100
*        RC  = PASS SWITCH: 0=FIRST PASS; 4=FINAL PASS         @G18MSBS 60791200
*        RET = RETURN ADDRESS                                  @G18MSBS 60791300
*        RF  = ENTRY ADDRESS                                   @G18MSBS 60791400
*                                                              @G18MSBS 60791500
*        THIS ROUTINE WILL GET SPACE FOR AND BUILD THE SSOB    @G18MSBS 60791600
*        HEADER AND EXTENSION TO PASS TO JES3 VIA THE MACRO:   @G18MSBS 60791700
*        'IEFSSREQ', OFFERING THE VOLUME CHOICE TO JES3 FOR    @G18MSBS 60791800
*        APPROVAL.  UPON RETURN, REGISTER 15 WILL CONTAIN:     @G18MSBS 60791900
*                                                              @G18MSBS 60792000
*               REGISTER 15 = 0  : JES3 RESPONDED-OK           @G18MSBS 60792100
*               REGISTER 15 = >0 : JES3 ERROR-ABEND            @G18MSBS 60792200
*                                                              @G18MSBS 60792300
*        IF REGISTER 15 CONTAINS ZERO, THEN 'SSOBRETN'         @G18MSBS 60792400
*        IS TESTED FOR ZERO.  ZERO ALLOWS OPEN/EOV TO          @G18MSBS 60792500
*        CONTINUE AND A NON-ZERO INDICATES JES3 DETERMINED     @G18MSBS 60792600
*        THAT VOLUME COULD NOT BE USED BY THIS JOB NOW. IT     @G18MSBS 60792700
*        WILL BE REJECTED BY OPEN/EOV LIKE A WRONG VOLUME.     @G18MSBS 60792800
***************************************************************@G18MSBS 60792900
***************************************************************@G18MSBS 60793000
*                                                              @G18MSBS 60793100
DAMV5000 EQU   *                        JES3 ROUTINE           @G18MSBS 60793200
        SPACE                                                           60793300
         L     RF,WTGPREFX              GET WHERE TO GO PREFIX @G18MSBS 60793400
         LA    RF,IECREGSV-IECPREFX(,RF) ADDR OF REG SAVE AREA @G18MSBS 60793500
         STM   R0,RET,K0(RF)            SAVE REGISTERS         @G18MSBS 60793600
         LR    R8,RF                    SAVE SAVEAREA          @G18MSBS 60793700
         IECRES GET,PREFIX=YES,ID=SSOB,LV=SSOBSIZE,A=(RF)      @G18MSBS 60793800
         LM    R2,RET,K8(R8)            RESTORE REGS           @G18MSBS 60793900
         USING SSOB,R1                  ESTAB ADDRESSABILITY   @G18MSBS 60794000
         ST    R1,DASSOBAD              SAVE PARM POINTER      @G18MSBS 60794100
        SPACE                                                           60794200
         MVC   SSOBID,DASSOBID          ID OF SSOB             @G18MSBS 60794300
         MVI   SSOBLEN+K1,SSOBHSIZ      LENGTH OF SSOBHEADER   @G18MSBS 60794400
         MVI   SSOBFUNC+K1,SSOBOEOV     OPEN/EOV FUNCTION ID   @G18MSBS 60794500
         LA    RF,SSMOBGN               GET FUNCTION DEPENDENT @G18MSBS 60794600
         ST    RF,SSOBINDV              AREA PTR AND SAVE IT   @G18MSBS 60794700
         MVI   SSMOLEN+K1,SSMOSIZE      LENGTH OF EXTENSION    @G18MSBS 60794800
         L     RF,DXJSCBAD              LOAD JSCB ADDR         @G18MSBS 60794900
         L     RF,JSCBJCT-IEZJSCB(,RF)  GET JCT PTR FROM JSCB  @G18MSBS 60795000
         LA    RF,SWAPREFX+JCTJNAME-JCTABLE(,RF) GET PTR OF    @G18MSBS 60795100
*                                       JOB NAME               @G18MSBS 60795200
         ST    RF,SSMOPNAM              AND SAVE IT FOR SSOB   @G18MSBS 60795300
         L     RF,DXJSCBAD              LOAD JSCB ADDR AGAIN   @G18MSBS 60795400
         L     RF,JSCSCT-IEZJSCB(,RF)   GET SCT PTR FROM JSCB  @G18MSBS 60795500
         LA    RF,SWAPREFX+SCTSNUMB-SCTABLE(,RF) GET PTR OF    @G18MSBS 60795600
*                                       STEP NUMBER            @G18MSBS 60795700
         ST    RF,SSMOPSTN              AND SAVE IT FOR SSOB   @G18MSBS 60795800
         LA    RF,UCBNAME               GET PTR OF UNIT ADDRESS@G18MSBS 60795900
         ST    RF,SSMOPUAD              AND SAVE IT FOR SSOB   @G18MSBS 60796000
         LA    RF,UCBVOLI               GET PTR OF VOLSER      @G18MSBS 60796100
         ST    RF,SSMOPVOL              AND SAVE IT FOR SSOB   @G18MSBS 60796200
         BALR  RF,R0                    ESTABLISH              @G18MSBS 60796300
         USING *,RF                        ADDRESSABILITY      @G18MSBS 60796400
         LTR   RC,RC                    FINAL REQ SWITCH ON?   @G18MSBS 60796500
         BZ    DAMV5020                 OFF, SKIP FINAL REQ FLG@G18MSBS 60796600
         OI    SSMOFLG1,SSMOFINL        ON, INDICATE FINAL REQ @G18MSBS 60796700
         DROP  RF                                              @G18MSBS 60796800
        EJECT                                                           60796900
DAMV5020 EQU   *                        PREPARE TO ISSUE       @G18MSBS 60797000
         OI    DASSOBAD,HIORDER         REQUEST FOR SSOB MACRO @G18MSBS 60797100
         LA    RD,SSOBSAVE              GET SAVE AREA FOR SSOB @G18MSBS 60797200
         LA    R1,DASSOBAD              GET ADDR OF PARM PTR   @G18MSBS 60797300
         DROP  R1                                              @G18MSBS 60797400
        SPACE                                                           60797500
*                                                              @G18MSBS 60797600
***************************************************************@G18MSBS 60797700
*                                                              @G18MSBS 60797800
**       PREPARE TO ISSUE MACRO: 'IEFSSREQ'                    @G18MSBS 60797900
*                                                              @G18MSBS 60798000
**       ON ENTRY:                                             @G18MSBS 60798100
*                                                              @G18MSBS 60798200
**       REGISTER 1 = POINTER TO SSOB PARAMETER LIST POINTER   @G18MSBS 60798300
**       REGISTER D = SAVE AREA TO BE USED BY JES3             @G18MSBS 60798400
*                                                              @G18MSBS 60798500
**       ON RETURN:                                            @G18MSBS 60798600
*                                                              @G18MSBS 60798700
**       REGISTER 0 = VOLATILE                                 @G18MSBS 60798800
**       REGISTER 1 = POINTER TO SSOB PARAMETER LIST           @G18MSBS 60798900
**       REGISTER F = RETURN CODE FROM JES3                    @G18MSBS 60799000
**                    0=JES3 RESPONDED - TEST 'SSOBRETN' CODE  @G18MSBS 60799100
*                                                              @G18MSBS 60799200
**       'SSOBRETN' CONTAINS A RETURN CODE:                    @G18MSBS 60799300
**                  0 = THIS VOLUME IS AVAILABLE FOR USE.      @G18MSBS 60799400
**                  4 = JES3 HAS SOME OTHER USE FOR THIS VOL.  @G18MSBS 60799500
***************************************************************@G18MSBS 60799600
*                                                              @G18MSBS 60799700
         IEFSSREQ                       ISSUE MACRO            @G18MSBS 60799800
        SPACE                                                           60799900
         USING *,RET                    ESTAB ADDRESSABILITY   @G18MSBS 60800000
         LTR   RF,RF                    TEST RETURN CODE       @G18MSBS 60800100
         BZ    DAMV5030                 NO JES3 ERROR - BRANCH @G18MSBS 60800200
         LA    R0,K21                   OPEN=413-34 EOV=737-28 @ZM44627 60800300
         XC    DXVOLSR2,DXVOLSR2        CLEAR VOLSER FOR ABEND @G18MSBS 60800400
         B     DAMV9900                 JES3 ERROR - ABEND     @G18MSBS 60800500
         EJECT                                                          60800600
DAMV5030 EQU   *                        JES3 PROCESSING OK     @G18MSBS 60800700
         USING SSOB,R1                  ESTAB ADDRESSABILITY   @G18MSBS 60800800
         L     R8,WTGPREFX              GET WHERE TO GO PREFIX @G18MSBS 60800900
         L     R9,SSOBRETN              GET JES3 FUNCT RET CODE@G18MSBS 60801000
         DROP  R1,RET                                          @G18MSBS 60801100
         SPACE                                                          60801200
         IECRES FREE,PREFIX=YES,A=(R1)                         @G18MSBS 60801300
         SPACE                                                          60801400
         LTR   R9,R9                    TEST RET FROM IEFSSREQ @G18MSBS 60801500
         LM    R0,RET,IECREGSV-IECPREFX(R8) RESTORE REGISTERS  @G18MSBS 60801600
         BNZ   DAMV9900                 REJECT JES3 DISAPPROVED@G18MSBS 60801700
         BR    RET                      VOLUME APPROVED-RETURN @G18MSBS 60801800
         EJECT                                                          60801900
*                                                                Y02134 60802000
*****************************************************************Y02134 60804000
*                                                                Y02134 60810000
*        INTERFACE TO IECPRLTV CONVERT ROUTINE.                  Y02134 60816000
*        MBBCCHHR IS CONVERTED TO TTR                            Y02134 60822000
*                                                                Y02134 60836000
*****************************************************************Y02134 60838000
*                                                                Y02134 60840000
*        REG   CONTENTS AT ENTRY        CONTENTS AT EXIT         Y02134 60842000
*        R0    WORK REGISTER            CONVERTED TTR            Y02134 60844000
*        R4    O/C/E WORK AREA POINTER  SAME AS ENTRY            Y02134 60846000
*        R6    POINTER TO WTGTABLE      SAME AS ENTRY            Y02134 60848000
*        R14   RETURN ADDRESS           SAME AS ENTRY            Y02134 60850000
*        R15   WORK REGISTER            RETURN CODE              Y02134 60852000
*                                                                Y02134 60854000
*        MBBCCHHR IS PASSED IN DXDAADDR                          Y02134 60856000
*                                                                Y02134 60856100
*****************************************************************Y02134 60856200
*                                                                Y02134 60856300
DAMV8800 EQU   *                                                 Y02134 60856400
*                                                                Y02134 60856500
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX   Y02134 60856600
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134 60856700
         LA    R1,DXDEB                 POINT TO OPEN WORK DEB   Y02134 60856800
         LA    R2,DXDAADDR              ADDR TO STORE MBBCCHHR   Y02134 60856900
         L     RF,CVTPTR                GET CVT ADDR             Y02134 60857000
         L     RF,CVTPRLTV-CVT(,RF)     ADDR OF IECPRLTV ROUTINE Y02134 60857100
         BALR  RET,RF                   CONVERT TTR TO MBBCCHHR  Y02134 60857200
         L     RET,WTGPREFX             LOAD POINTER TO PREFIX   Y02134 60857300
         LM    R1,RET,IECREGSV-IECPREFX+K4(RET) RESTORE REGISTRS Y02134 60857400
         BR    RET                      RETURN                   Y02134 60857500
         EJECT                                                          60857600
DSNOTFND EQU   *                        DSCB-NOT-FOUND EXIT    @G60ASRB 60857700
*                                                              @G60ASRB 60864100
***************************************************************@G60ASRB 60864200
*        CALL IFG0EX0A, THE DSCB-NOT-FOUND INSTALLATION EXIT.  @G60ASRB 60864300
*        THIS SUBROUTINE USES REGISTERS 0,1,12,14,15.          @G60ASRB 60864400
*        RETURN ON REG 14.                                     @G60ASRB 60864500
*        EXIT INTERFACE                                        @G60ASRB 60864600
*          REG1 - PARMLIST ADDRESS                             @G60ASRB 60864700
*                 FIRST WORD UCB ADDRESS                       @G60ASRB 60864800
*                 SECOND WORD DATASET NAME ADDRESS             @G60ASRB 60864900
*          REG13 - IECREGSV   ADDRESS TO SAVE REGISTERS        @G60ASRB 60865000
*          REG14 - RETURN                                      @G60ASRB 60865100
*          REG15 - IFG0EX0A ADDRESS                            @G60ASRB 60865200
*        EXIT RETURN CODE IN REGISTER 15                       @G60ASRB 60865300
*          0 - CONTINUE DSCB NOT FOUND PROCESSING              @G60ASRB 60865400
*          4 - RETRY READ OF DSCB. EXIT NOT TAKEN IF STILL     @G60ASRB 60865500
*              MISSING.                                        @G60ASRB 60865600
*          8 - EXIT ERROR - 213-2C/737-3C                      @G60ASRB 60865700
*        ACTION BASED ON EXIT RETURN CODE                      @G60ASRB 60865800
*          0 - RETURN ON REG 14 TO CONTINUE DSCB-NOT-FOUND     @G60ASRB 60865900
*              PROCESSING, WITH 0 IN REG15.                    @G60ASRB 60866100
*          4 - SET DXEX0A01 SWITCH AND RETURN TO               @G60ASRB 60866200
*              RETRY READ OF DSCB, WITH 4 IN REG15.            @G60ASRB 60866300
*          8 - RETURN ON REG14 WITH REG0 SET TO ABEND          @G60ASRB 60866400
*              INDICATOR AND 8 IN REG15.                       @G60ASRB 60866500
***************************************************************@G60ASRB 60866600
*                                                              @G60ASRB 60866700
         ST    RET,DXCCW4               SAVE RETURN            @G60ASRB 60866800
         ST    RBASE,DXCCW4+K4          SAVE FIRST BASE        @G60ASRB 60866900
         LR    RBASE,RF                 ESTABLISH NEW BASE     @G60ASRB 60867000
         USING DSNOTFND,RBASE                                  @G60ASRB 60867100
         TM    DXFLAG1,DXEX0A01         2ND DSCB-NOT-FOUND     @G60ASRB 60867200
         BO    DSNOTFN0                 BRANCH IF YES-EXIT     @G60ASRB 60867300
         MVC   DXIDENT(K7),WTGMODNM+K4  SAVE THIS MODULE ID    @G60ASRB 60867400
         IECRES LOAD,MODNM=EX0A,BRANCH=NO,PREFIX=WTGPREFX      @G60ASBJ 60868000
         L     RC,WTGMODEP              GET IFG0EX0A ENTRY PT. @G60ASBJ 60872000
         MVC   WTGMODNM+K4(K7),DXIDENT  RESTORE THIS MODULE ID @G60ASBJ 60876000
         LA    RUCB,K0(,RUCB)                                  @G60ASRB 60886500
         ST    RUCB,DXWORK              UCB ADDRESS            @G60ASRB 60886600
         LA    RD,K0(,RD)                                      @G60ASRB 60886700
         ST    RD,DXWORK1               DATA SET NAME ADDRESS  @G60ASRB 60886800
         OI    DXWORK1,X'80'            END OF LIST INDICATOR  @G60ASRB 60886900
         LA    R1,DXWORK                PARMLIST ADDRESS       @G60ASRB 60887000
         LR    RF,RC                    ENTRY ADDRESS          @G60ASRB 60887100
         LR    RC,RD                    SAVE RD                @G60ASRB 60887200
         L     RD,WTGPREFX              PREFIX ADDRESS         @G60ASRB 60887300
         LA    RD,IECREGSV-IECPREFX(,RD) REGSAVE AREA          @G60ASRB 60887400
         BALR  RET,RF                   TAKE EXIT              @G60ASRB 60887500
         LR    RD,RC                    RESTORE RD             @G60ASRB 60887600
         LTR   RC,RF                    CODE TO RC AND TEST    @G60ASRB*60887700
                                        IF CODE IS ZERO        @G60ASRB 60887800
         BE    DSNOTFN0                 EXIT IF YES            @G60ASRB 60887900
         LA    RF,K4                    COMPERAND OF FOUR      @G60ASRB 60888100
         CR    RF,RC                    IS RETURN CODE 4       @G60ASRB 60888200
         BE    DSNOTFN4                 BRANCH IF YES          @G60ASRB 60888300
         LA    R0,K23                   EXIT ERROR             @G60ASRB 60888400
         B     DSNOTFN8                 EXIT WITHOUT ZERO IN 0 @G60ASRB 60888500
DSNOTFN0 EQU   *                        NORMAL RETURN          @G60ASRB 60888600
         LA    RF,K0                    RETURN INDICATOR       @G60ASRB 60888700
         B     DSNOTFO                                         @G60ASRB 60888800
DSNOTFN4 EQU   *                        RETRY RETURN           @G60ASRB 60888900
         OI    DXFLAG1,DXEX0A01         SET SECOND TIME BIT    @G60ASRB 60889000
         LA    RF,K4                                           @G60ASRB 60889100
         B     DSNOTFO                                         @G60ASRB 60889200
DSNOTFN8 EQU   *                        ERROR RETURN           @G60ASRB 60889300
         LA    RF,8                                            @G60ASRB 60889400
DSNOTFO  EQU   *                        RETURN                 @G60ASRB 60889500
         L     RET,DXCCW4               RETURN ADDRESS         @G60ASRB 60889600
         L     RBASE,DXCCW4+K4          BASE REG               @G60ASRB 60889700
         BR    RET                                             @G60ASRB 60889800
         USING DAMV0000,RBASE           REESTABLISH BASE       @G60ASRB 60889900
         EJECT                                                          60890000
*                                                                Y02134 60891100
*****************************************************************Y02134 60891200
*                                                                Y02134 60891300
*        INTERFACE TO IECPCNVT CONVERT ROUTINE.                  Y02134 60891400
*        TTR IS CONVERTED TO MBBCCHHR                            Y02134 60891500
*                                                                Y02134 60891600
*****************************************************************Y02134 60891700
*                                                                Y02134 60891800
*        REG   CONTENTS AT ENTRY        CONTENTS AT EXIT         Y02134 60891900
*        R1    POINTER TO TTR           SAME AS ENTRY            Y02134 60892400
*        R4    O/C/E WORK AREA POINTER  SAME AS ENTRY            Y02134 60893500
*        R6    POINTER TO WTGTABLE      SAME AS ENTRY            Y02134 60894000
*        R14   RETURN ADDRESS           SAME AS ENTRY            Y02134 60896000
*        R15   WORK REGISTER            RETURN CODE              Y02134 60898000
*                                                                Y02134 60900000
*        MBBCCHHR IS RETURNED IN DXDAADDR                        Y02134 60902000
*                                                                Y02134 60904000
*****************************************************************Y02134 60906000
*                                                                Y02134 60908000
DAMV8900 EQU   *                                                 Y02134 60910000
*                                                                Y02134 60912000
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX   Y02134 60914000
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134 60916000
         XC    DXDAADDR,DXDAADDR        ZERO OUT MBBCCHHR        Y02134 60918000
         MVC   DXDAADDR(K3),K0(R1)      TTR TO WORK AREA         Y02134 60920000
         L     R0,DXDAADDR              LOAD TTR0                Y02134 60922000
         XC    DXDAADDR,DXDAADDR        ZERO OUT MBBCCHHR        Y02134 60924000
         LA    R1,DXDEB                 POINT TO OPEN WORK DEB   Y02134 60926000
         LA    R2,DXDAADDR              ADDR TO STORE MBBCCHHR   Y02134 60928000
         L     RF,CVTPTR                GET CVT ADDR             Y02134 60930000
         L     RF,CVTPCNVT-CVT(,RF)     ADDR OF IECPCNVT ROUTINE Y02134 60932000
         BALR  RET,RF                   CONVERT TTR TO MBBCCHHR  Y02134 60934000
         L     RET,WTGPREFX             LOAD POINTER TO PREFIX   Y02134 60936000
         LM    R0,RET,IECREGSV-IECPREFX(RET) RESTORE 15 REGISTRS Y02134 60938000
         BR    RET                      RETURN                   Y02134 60940000
         EJECT                                                          60942000
DSCUPD   EQU   *                        UPDATE DSCB            @G60ASRB 60961100
*                                                              @G60ASRB 60961200
***************************************************************@G60ASRB 60961300
*        THE LAST ACCESSED DATE IN THE FORMAT 1 DSCB IS        @G60ASRB 60961400
*        UPDATED IF THE DATE IS NONZERO AND THE DATE IS        @G60ASRB 60961500
*        LESS THAN TODAY'S DATE.                               @G60ASRB 60961600
*        SET THE BACKUP COPY INDICATOR IF OPEN FOR OTHER THAN  @G60ASRB 60961700
*        INPUT.                                                @G60ASRB 60961800
*        WRITE UDPATED DSCB IF EOV OR IF NOT THE FIRST DSCB.   @G60ASRB 60961900
*        SET THE DSCB-UPDATED BIT IN JFCBMASK(JFCMDMOD) IF     @G60ASRB 60964100
*        FIRST DSCB.                                           @G60ASRB 60964200
*        RETURN WITH 0 IN REG 15 IF NO ERROR.                  @G60ASRB 60964300
*        RETURN WITH 4 IN REG 15 IF I/O ERROR WRITING DSCB.    @G60ASRB 60964400
***************************************************************@G60ASRB 60964500
*                                                              @G60ASRB 60964600
         L     R1,WTGPREFX              WTG PREFIX             @G60ASRB 60964700
         STM   R2,RET,IECREGSV-IECPREFX(R1) SAVE REGISTERS     @G60ASRB 60964800
         LR    RBASE,RF                 NEW BASE               @G60ASRB 60964900
         USING DSCUPD,RBASE                                    @G60ASRB 60965000
         LA    RC,0                     INITIALIZE TO INDICATE @G60ASRB*60965100
                                        DSCB NOT MODIFIED      @G60ASRB 60965200
         TM    DXDCBLST,PLISTOP1        INPUT                  @G60ASRB 60965300
         BZ    DSCUP10                  BRANCH IF INPUT        @G60ASRB 60965400
         TM    DS1DSIND-DS1FMTID(RB),DS1DSCHA AREADY ON        @G60ASRB 60965500
         BO    DSCUP10                  BRANCH IF NEEDNT SET   @G60ASRB 60965600
         OI    DS1DSIND-DS1FMTID(RB),DS1DSCHA SET IT           @G60ASRB 60965700
         LA    RC,K1                    INDICATE DSCB UPDATED  @G60ASRB 60965800
*                                                              @G60ASRB 60965900
DSCUP10  EQU   *                        CHECK ACCESS DATE      @G60ASRB 60966000
         CLC   DS1REFD-DS1FMTID(,RB),DAMVZERO IS DATE ZERO     @G60ASRB 60966100
         BE    DSCUP20                  BRANCH IF ZERO-DATE IS @G60ASRB*60966200
                                        NOT BEING MAINTAINED   @G60ASRB 60966300
         BAL   RET,DOCVTDTE             MOVE CVTDATE TO        @G60ASRB*60966400
                                        DXWORK2 IN BINARY      @G60ASRB 60966500
         CLC   DS1REFD-DS1FMTID(,RB),DXWORK2+K1 IS DSCB DATE   @G60ASBJ*60966600
                                        DIFFERENT FROM CVT DATE@G60ASBJ 60967000
         BE    DSCUP20                  BRANCH IF DSCB DATE IS @G60ASBJ*60967500
                                        EQUAL TO CVT DATE      @G60ASRB 60968100
         MVC   DS1REFD-DS1FMTID(,RB),DXWORK2+K1 UPDATE DSCB    @G60ASRB 60969100
         LA    RC,K1                    INDICATE DSCB UPDATED  @G60ASRB 60969600
*                                                              @G60ASRB 60969700
DSCUP20  EQU   *                        CAUSE WRITE OF DSCB    @G60ASRB 60969800
*                                                              @G60ASRB 60969900
         LTR   RC,RC                    DSCB UPDATED           @G60ASRB 60970100
         BZ    DSCUP40                  BRANCH IF NO           @G60ASRB 60970200
         LA    RB,0(,RB)                CLEAR HIGH BYTE        @G60ASRB 60970300
         LA    RCORE,0(,RCORE)          CLEAR HIGH BYTE        @G60ASRB 60970400
         LA    RF,F1CCHHR-F1DATA(,RB)   CCHHR IF NOT 1ST DSCB  @G60ASRB 60970500
         CR    RB,RCORE                 FIRST DSCB             @G60ASRB 60970600
         BNE   DSCUP30                  BRANCH IF NOT          @G60ASRB 60970700
         LA    RF,DXCCW7                CCHHR IF EOV(1ST DSCB) @G60ASRB 60970800
         CLC   DAMVEOV2,WTGMODNM+K3     IS IT EOV              @G60ASRB 60970900
         BE    DSCUP30                  BRANCH IF YES          @G60ASRB 60971000
         OI    JFCBMASK+K4,JFCMDMOD     REWRITE DSCB LATER     @G60ASRB 60971100
         B     DSCUP40                  EXIT                   @G60ASRB 60971200
*                                                              @G60ASRB 60971300
DSCUP30  EQU   *                        WRITE DSCB             @G60ASRB 60971400
*                                                              @G60ASRB 60971500
         XC    DXCCW1(K24),DXCCW1       ZERO 3 CCWS            @G60ASRB 60971600
         MVC   DXDAADDR+K3(L'F1CCHHR),K0(RF) SET UP IOBSEEK    @G60ASRB 60971700
         ST    RF,DXCCW1                PUT IN SID CCW         @G60ASRB 60971800
         LA    RF,DXCCW1                                       @G60ASRB 60971900
         ST    RF,DXCCW2                TIC TO CCW1            @G60ASRB 60972000
         LA    RB,K0(,RB)                                      @G60ASRB 60972200
         ST    RB,DXCCW3                DSCB                   @G60ASRB 60972300
         OC    DXCCW1(K24),DAMVWRF1     OP CODES,FLAGS         @G60ASRB 60972400
         EXCP  DXIOB                    WRITE DSCB             @G60ASRB 60972500
         LA    RF,K4                    ERROR EXIT             @G60ASRB 60972600
         B     DSCUP50                  EXIT                   @G60ASRB 60972700
*                                                              @G60ASRB 60972800
DSCUP40  EQU   *                        NO EXCP DONE EXIT      @ZA32427 60972900
*                                                              @G60ASRB 60973400
         LA    RF,K0                                           @G60ASRB 60973500
*                                                              @G60ASRB 60973600
DSCUP50  EQU   *                        COMMON EXIT            @G60ASRB 60973700
*                                                              @G60ASRB 60973800
         L     RC,WTGPREFX              PREFIX                 @G60ASRB 60973900
         LM    R2,RET,IECREGSV-IECPREFX(RC) RESTORE REGISTERS  @G60ASRB 60974000
         BR    RET                      EXIT                   @G60ASRB 60974100
         USING DAMV0000,RBASE           REESTABLISH BASE       @G60ASRB 60974200
         EJECT                                                          60974300
*                                                                Y02080 60974400
*****************************************************************Y02134 60974500
*                                                                Y02134 60974600
*        DETERMINE PROPER RETURN CODE FOR OPEN OR EOV            YM1472 60974700
*                                                                Y02134 60976000
*****************************************************************Y02134 60976100
*                                                                Y02134 60976200
DAMV9999 EQU   *                                                 Y02080 60976300
*                                                                Y02134 60976400
         BALR  RC,R0                    ESTABLISH NEW BASE       YM3070 60976500
         USING *,RC                     ESTABLISH ADDRESSABILITY YM3070 60976600
*                                                                YM3070 60976700
         LA    RF,DAMVERFF              GET LENGTH OF CODE LIST  Y02080 60976800
         CR    RF,R0                    CHECK IF CODE IS OK      Y02134 60976900
         BNL   DAMV9902                 BRANCH IF OK             Y02080 60977000
         LA    R0,K0                    SET BAD CODE IN REG 0    Y02080 60977100
*                                                                Y02134 60977200
DAMV9902 EQU   *                        GET PROPER ABEND TABLE   YM1472 60977300
*                                                                Y02080 60977400
         LA    RF,DAMVER19              POINT TO OPEN CODES      Y02080 60977500
         CLC   DAMVEOV,WTGMODNM+K3      CHECK FOR EOV CALL       Y02080 60977600
         BNE   DAMV9905                 BRANCH IF OPEN           Y02080 60977700
         LA    RF,DAMVER55              POINT TO EOV  CODES      Y02080 60977800
*                                                                Y02134 60977900
DAMV9905 EQU   *                        GET PROPER ABEND CODE    YM1472 60978000
*                                                                Y02080 60978100
         AR    RF,R0                    ADD ERROR OFFSET         Y02080 60978200
         IC    R0,K0(RF)                INSERT PROPER PD CODE    Y02080 60978300
*                                                                Y02134 60978400
         CLC   DAMVEOV,WTGMODNM+K3      CHECK FOR EOV CALL       Y02080 60978500
         BE    DAMV9990                 BRANCH IF EOV            Y02134 60978600
*                                                                Y02134 60978700
         CLI   DXWORK,K213              CHECK FOR 213 CODE       Y02134 60978800
         BNE   DAMV9990                 BRANCH IF NOT 213        Y02134 60978900
*                                                                       60979000
         IECRES LOAD,MODID=ID4C5G,BRCODE=0,BRANCH=QUEUED         Y02080 60979100
*                                                                Y02134 60979200
DAMV9990 EQU   *                        SEE IF NEW VOL OK        YM1472 60979300
*                                                                Y02080 60979400
         MVC   DXVOLSR1,UCBVOLI         SET UP DISMOUNT          YM1472 60979500
         CLC   DXVOLSR2,SCRTCH          CHECK FOR NON-SPECIFIC   YM1472 60979600
         BE    DAMV7510                 BRANCH IF SCRTCH         YM1472 60979700
*                                                                YM1472 60979800
         MVC   DXRETMOD,ID4C4A          SET UP RETURN MOD        Y02080 60979900
         LA    RET,K24                  SET UP RETURN OFFSET     Y02080 60981900
*                                                                Y02134 60982000
*        NOTE - 4A RETURN MODULE SAVED AT DXSAVMOD               Y02080 60984000
*                                                                Y02080 60986000
         DMABCOND (0),ID4C0P                                     Y02080 60988000
         DROP  RC                                                       60990000
         EJECT                                                          60993600
GETF1    EQU   *                        GET F1 DSCB WORKAREA   @G18MSBS 60996600
         IECRES GET,LV=(0),ID=F1,                              @G18MSBSX60999600
               PREFIX=YES,STM=(R2,RET,WTGPREFX)                @G18MSBS 61002600
*                                                              @G18MSBS 61005600
         BR    RET                      RETURN TO CALLER       @G18MSBS 61008600
         SPACE 1                                               @G18MSBS 61011600
GETF2F3  EQU   *                        GET F2/F3 DSCB WKAREA  @G18MSBS 61014600
         IECRES GET,LV=(0),ID=F2F3,                            @G18MSBSX61017600
               PREFIX=YES,STM=(2,14,WTGPREFX)                  @G18MSBS 61020600
*                                                              @G18MSBS 61023600
         BR    RET                      RETURN TO CALLER       @G18MSBS 61026600
         EJECT                                                          61029600
DOCVTDTE EQU   *                        CVTDATE CONVERT RTNE   @G60ASRB 61108100
*                                                              @G60ASRB 61108200
*        CONVERT CVTDATE TO BINARY                             @G60ASRB 61108300
*        CVTDATE IN FORM X'00YYDDDF' IN PACKED DECIMAL.        @G60ASRB 61108400
*        DXWORK2 WILL CONTAIN X'00YYDDDD' IN BINARY.           @G60ASRB 61108500
*                                                              @G60ASRB 61108600
         L     R1,CVTPTR                GET ADDR OF CVT        @G60ASRB 61108700
         XC    DXWORK,DXWORK            CLEAR WORK AREA        @G60ASRB 61108800
         XC    DXWORK1,DXWORK1          CLEAR WORK AREA        @G60ASRB 61108900
         XC    DXWORK2,DXWORK2          CLEAR WORK AREA        @G60ASRB 61109000
         MVC   DXWORK+K6(K2),CVTDATE+K2-CVT(R1) CURRENT DAY    @G60ASRB*61109100
                                        AS X'000000000000DDDF' @G60ASRB*61109200
                                        IN PACKED DECIMAL      @G60ASRB 61109300
         CVB   RF,DXWORK                DAY NOW IN BINARY      @G60ASRB 61109400
         STH   RF,DXWORK2+K2            X'0000DDDD' IN BINARY  @G60ASRB 61109500
         MVO   DXWORK(K8),CVTDATE-CVT+K1(K1,R1) THE RESULT IS  @G60ASRB*61109600
                                        X'0000000000000YYF'    @G60ASRB*61109700
                                        IN PACKED DECIMAL      @G60ASRB 61109800
         CVB   RF,DXWORK                CONVERT YEAR TO BINARY @G60ASRB 61109900
         STH   RF,DXWORK2               DATE NOW X'00YYDDDD'   @G60ASRB*61110000
                                        IN BINARY              @G60ASRB 61110100
         BR    RET                      RETURN                 @G60ASRB 61110600
         EJECT                                                 @G60ASRB 61110700
GETCCWS  EQU   *                        GET CCW'S WORKAREA     @G18MSBS 61110800
         IECRES GET,LV=K72,ID=CCWS,                            @G18MSBSX61110900
               PREFIX=YES,STM=(2,14,WTGPREFX)                  @G18MSBS 61111000
*                                                              @G18MSBS 61113000
         BR    RET                      RETURN TO CALLER       @G18MSBS 61115000
         SPACE 1                                               @G18MSBS 61117000
FREECCWS EQU   *                        FREE CCW'S WORKAREA    @G18MSBS 61119000
         IECRES FREE,A=(1),PREFIX=YES,STM=(2,14,WTGPREFX)      @G18MSBS 61121000
*                                                              @G18MSBS 61123000
         BR    RET                      RETURN TO CALLER       @G18MSBS 61125000
         SPACE 1                                               @G18MSBS 61127000
DAMVTEST EQU   *                        TEST AUTHORIZED CALLER @G18MSBS 61129000
         BALR  RF,R0                   ESTABLISH ADDRESSABILITY@ZA29779 61131000
         USING *,RF                                            @ZA29779 61131400
         TESTAUTH KEY=YES,FCTN=1        TEST AUTHORIZATION     @G18MSBS 61131800
         DROP  RF                                              @ZA29779 61132200
         BR    RET                      RETURN TO CALLER       @G18MSBS 61133000
         EJECT                                                          61135000
*                                                                       61137000
*********************************************************************** 61146100
*                                                                       61196100
*        CONSTANTS                                                      61246100
*                                                                       61296100
*********************************************************************** 61346100
*                                                                Y02080 61396100
DAMVER19 DC    AL1(0)                   OPEN ERROR CODES         Y02080 61446100
         DC    AL1(27)                  CODE 1 = 413-20          Y02080 61496100
         DC    AL1(216)                 CODE 2 = 213-0C          Y02080 61546100
         DC    AL1(30)                  CODE 3 = 213-04          Y02080 61596100
         DC    AL1(36)                  CODE 4 = 313-04          Y02080 61646100
         DC    AL1(41)                  CODE 5 = 913-14          Y02083 61696100
         DC    AL1(214)                 CODE 6 = 03D-04          Y02080 61746100
         DC    AL1(215)                 CODE 7 = 03D-08          Y02080 61796100
         DC    AL1(230)                 CODE 8 = 213-20          Y02134 61846100
         DC    AL1(231)                 CODE 9 = 213-24          Y02134 61896100
         DC    AL1(53)                  CODE 10 = 013-14         Y02134 61946100
         DC    AL1(243)                 CODE 11 = 913-2C         Y02082 61996100
         DC    AL1(239)                 CODE 12 = 913-28         Y02083 62046100
         DC    AL1(28)                  CODE 13 = 713-08         YM6514 62096100
         DC    AL1(112)                 CODE 14 = 413-30       @Y30LSFY 62106100
         DC    AL1(232)                 CODE 15 = 03D-0C       @ZA02225 62110100
         DC    AL1(141)                 CODE 16 = 913-38       @Z40RSDH 62114100
         DC    AL1(0)                   CODE 17 = CANNOT OCCUR @Z40RSDH 62118100
         DC    AL1(142)                 CODE 18 = 913-3C       @Z40RSDH 62122100
         DC    AL1(143)                 CODE 19 = 913-40       @Z40RSDH 62126100
         DC    AL1(0)                   CODE 20 = CANNOT OCCUR @Z40RSDH 62130100
         DC    AL1(253)                 CODE 21 = 413-34       @ZM44627 62134100
         DC    AL1(0)                   CODE 22 = CANNOT OCCUR @G32DSMI 62140300
         DC    AL1(242)                 CODE 23 = 213-2C       @G60ASRB 62141300
         DC    AL1(31)                  CODE 24 = 213=18       @G60ASRB 62142300
*                                                                Y02134 62146100
DAMVER55 DC    AL1(0)                   EOV  ERROR CODES         Y02080 62196100
         DC    AL1(189)                 CODE 1 = 737-08          Y02080 62246100
         DC    AL1(171)                 CODE 2 = 737-0C          Y02080 62296100
         DC    AL1(190)                 CODE 3 = 737-04          Y02080 62346100
         DC    AL1(178)                 CODE 4 = 737-1C          Y02080 62396100
         DC    AL1(0)                   CODE 5 = CANNOT OCCUR    Y02080 62446100
         DC    AL1(0)                   CODE 6 = CANNOT OCCUR    Y02080 62496100
         DC    AL1(0)                   CODE 7 = CANNOT OCCUR    Y02080 62546100
         DC    AL1(230)                 CODE 8 = C37-04          Y02134 62596100
         DC    AL1(231)                 CODE 9 = C37-08          Y02134 62646100
         DC    AL1(240)                 CODE 10 = 937-10         Y02083 62696100
         DC    AL1(241)                 CODE 11 = 937-14         Y02083 62746100
         DC    AL1(0)                   CODE 12 = CANNOT OCCUR   Y02083 62796100
         DC    AL1(189)                 CODE 13 = 737-08         YM6514 62846100
         DC    AL1(112)                 CODE 14 = 737-38       @Y30LSFY 62856100
         DC    AL1(0)                   CODE 15 = CANT OCCUR   @ZA02225 62860100
         DC    AL1(1)                   CODE 16 = 937-28       @Z40RSDH 62864100
         DC    AL1(2)                   CODE 17 = 937-2C       @Z40RSDH 62868100
         DC    AL1(3)                   CODE 18 = 937-30       @Z40RSDH 62872100
         DC    AL1(4)                   CODE 19 = 937-34       @Z40RSDH 62876100
         DC    AL1(6)                   CODE 20 = 937-3C       @Z40RSDH 62880100
         DC    AL1(250)                 CODE 21 = 737-28       @G18MSBS 62884100
         DC    AL1(7)                   CODE 22 = 937-40       @G32DSMI 62890300
         DC    AL1(113)                 CODE 23 = 737-3C       @G60ASRB 62896100
         DC    AL1(190)                 CODE 24 = 737-04       @G60ASRB 62900100
DAMVERFF EQU   DAMVER55-DAMVER19        LENGTH OF CODE LIST      Y02083 62904100
DAMVZERO DC    XL3'0'                   ZEROS                  @G60ASRB 62908100
*                                                              @G60ASRB 62912100
DAMVWRF1 DS    0D                       WRITE F1DSCB CCWS      @G60ASRB 62916100
         CCW   CCWSCHID,K0,CCWCMDCH,K5  SEARCH ID EQUAL        @G60ASRB 62920100
         CCW   CCWTIC,K0,K0,K0          TIC                    @G60ASRB 62924100
         CCW   CCWWRTDA,K0,K0,DS1END-DS1FMTID WRITE DATA       @G60ASRB 62928100
LOCKERR  DMABCOND PCK,SETLOCK           SETLOCK ERROR ANALYSIS @G60ASRB*62932100
                                        ROUTINE                @G60ASRB 62934100
DAMVEOV2 DC    CL3'055'                 EOV MOD ID             @G60ASRB 62936100
IFG0EX0A DC    C'IFG0EX0A'              DSCB-NOT-FOUND EXIT    @G60ASRB 62941100
         EJECT                                                          62946100
*                                       CHANGED FOLLOWING LINE @G60ASBJ 62996100
         XCTLTABL BRT=YES,LENGTH=,ID=(EX0A,IFG0EX0A)                    63006100
         IECDSECS EXPAND=YES            EXPAND DESIRED DSECTS    YM3070 63046100
         EJECT                                                          63096100
         IDDVDSCB                                                Y02132 63146100
         EJECT                                                          63196100
WACCW    DSECT                                                   Y02082 63246100
WACCW1   DS    D                        EXTENDED CCW 1           Y02082 63296100
WACCW2   DS    D                        EXTENDED CCW 2           Y02082 63346100
WACCW3   DS    D                        EXTENDED CCW 3           Y02082 63396100
WACCW4   DS    D                        EXTENDED CCW 4           Y02082 63446100
WACCW5   DS    D                        EXTENDED CCW 5           Y02082 63496100
WACCW6   DS    D                        EXTENDED CCW 6           Y02082 63546100
WACCW7   DS    D                        EXTENDED CCW 7           Y02082 63596100
WACCW8   DS    D                        EXTENDED CCW 8           Y02082 63646100
WACCW9   DS    D                        EXTENDED CCW 9           Y02082 63696100
         EJECT                                                          63746100
         IEFJSSOB MO,CONTIG=YES                                @G18MSBS 63796100
DASSOBAD DS    A                        SSOB PARM PTR          @G18MSBS 63846100
SSOBSAVE DS    10D                      SSOB SAVE AREA         @G18MSBS 63896100
SSOBSIZE EQU   *-SSOB                   SIZE OF GETMAIN        @G18MSBS 63946100
         EJECT                                                          63996100
         IEFJESCT                                              @G18MSBS 64046100
         EJECT                                                          64096100
JCTABLE  DSECT                                                 @G18MSBS 64146100
         IEFAJCTB                                              @G18MSBS 64196100
         EJECT                                                          64246100
SCTABLE  DSECT                                                 @G18MSBS 64296100
         IEFASCTB                                              @G18MSBS 64346100
         EJECT                                                          64396100
F1AREA   DSECT                                                 @G60ASRB 87776100
*                                                              @G60ASRB 87826100
*        THIS DSECT DESCRIBES THE AREA INTO WHICH A FORMAT 1   @G60ASRB 87876100
*        DSCB IS READ.  F1DSN EXISTS ONLY IF A PDS.            @G60ASRB 87926100
*                                                              @G60ASRB 87976100
F1DSN    DS    CL(L'JFCBDSNM)           DATASET NAME           @G60ASRB 88026100
F1DATA   DS    CL(DS1END-DS1FMTID)      DATA AREA OF DSCB      @G60ASRB 88076100
F1NEXT   DS    F                        CHAIN TO NEXT DSCB     @G60ASRB 88126100
F1UCB    DS    F                        UCB                    @G60ASRB 88176100
F1CCHHR  DS    CL5                      CCHHR OF FORMAT 1 DSCB @G60ASRB 88226100
F1POLTH  EQU   *-F1DSN                  LENGTH IF A PDS        @G60ASRB 88276100
F1LTH    EQU   *-F1DATA                 LENTH IF NOT A PDS     @G60ASRB 88326100
         EJECT                                                          88376100
         END                                                            88426100
