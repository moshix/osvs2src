         TITLE 'IFG0195B - OPEN TAPE INPUT AND OUTPUT SL POSITIONING'   00200037
         COPY  LCGASMSW                                                 00250000
IFG0195B CSECT                                                          00800021
*********************************************************************** 00850002
*                                                                     * 00900002
*        VS2 RELEASE 3.7 DELETIONS/CHANGES                            * 00910037
*0000333164                                                    @ZA11150 00910337
*0000                                                          @ZA28320 00910437
*        VS2 RELEASE 03 DELETIONS/CHANGES                             * 00910637
*0000                                                          @ZA00003 00911037
*0000                                                          @ZA04600 00912037
*0000                                                          @ZA04601 00913037
*0000                                                          @ZA04602 00914037
*0000                                                          @ZA04603 00915037
*0000                                                          @ZA04605 00916037
*0000                                                          @ZA04606 00917037
*0000                                                          @ZA04607 00918037
*0000                                                          @ZA04608 00919037
*0000                                                          @ZA05622 00919537
*0000                                                          @ZA07028 00919737
*0000827400                                                    @ZA07589 00919837
*0000                                                          @ZA08035 00919937
*        VS2 RELEASE 02 DELETIONS/CHANGES                             * 00920037
*0000332863                                                    @ZA02882 00930000
*                                                                     * 00940000
* MODULE NAME = IFG0195B (OS/VS2)                                     * 00950002
*                                                                     * 00960002
* DESCRIPTIVE NAME = OPEN - LABELED TAPE POSITIONING                  * 00970002
*                                                                     * 00980002
* COPYRIGHT = NONE                                                    * 00990002
*                                                                     * 00992002
* STATUS = RELEASE 4, LEVEL 0                                         * 00994037
*                                                                     * 00996002
* FUNCTION =                                                          * 00998002
*        1. ZERO THE DCB BLOCK COUNT.                                 * 00998102
*                                                                     * 00998202
*        2. ENSURES THAT CHECK POINT DATA SETS ONLY GO ON SECURE      * 00998337
*        VOLUMES AND THAT NON CHECK POINT DATA SETS DON'T GO ON CHECK * 00998437
*        POINT SECURE VOLUMES.                                        * 00998537
*                                                                     * 00998637
*        3. TEST THE UCB FILE SEQUENCE NUMBER.  IF IT IS ZERO, THEN   * 00999037
*        THE JFCB FILE SEQUENCE NUMBER IS EXAMINED.  IF IT INDICATES  * 00999302
*        THAT A FILE GREATER THAN THE FIRST IS BEING OPENED, THEN THE * 01004902
*        HEADER LABEL IS READ.  THE FILE SEQUENCE NUMBER FROM THE     * 01006902
*        LABEL IS PLACED IN THE UCB.  THE TAPE IS FORWARD OR BACK     * 01009302
*        SPACED AS NECESSARY TO POSITION IT TO THE REQUESTED FILE (   * 01009702
*        POSITIONING IS DETERMINED BY COMPARING THE UCB AND JFCB FILE * 01010102
*        SEQUENCE NUMBERS.)                                           * 01010502
*        THE TAPE IS POSITIONED TO THE HEADER 1 LABEL FOR NORMAL INPUT* 01010602
*        OPERATIONS, AND IT IS POSITIONED TO THE TRAILER 1 LABEL FOR  * 01015502
*        RDBACK OR DISP=MOD PROCESSING.                               * 01017502
*                                                                     * 01019502
*        4. STARTS READ FILE LABEL 1.                                 * 01019937
*                                                                     * 01020302
*        5. VERIFIES THAT THE DSNAME FROM THE LABEL IS THE SAME AS    * 01020437
*        THAT SPECIFIED IN THE JFCB.                                  * 01020502
*                                                                     * 01034802
* NOTES = SEE BELOW                                                   * 01036102
*                                                                     * 01037402
*    DEPENDENCIES =                                                   * 01038702
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 01040302
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 01045202
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 01050102
*                                                                     * 01055002
*    RESTRICTIONS = NONE                                              * 01059902
*                                                                     * 01069902
*    REGISTER CONVENTIONS =                                           * 01079902
*            R2 POINTS TO DCB                                         * 01089902
*            R4 POINTS TO OPEN WORK AREA                              * 01091902
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 01093902
*            R6 POINTS TO THE WTG TABLE                               * 01095902
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 01097902
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 01098302
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 01098702
*            R10 POINTS TO THE UCB                                    * 01099102
*                                                                     * 01099502
*    PATCH LABEL = SEE NEXT TO LAST LABEL BEFORE ORG STATEMENT AT END * 01099602
*                  OF LISTING.                                        * 01099702
*                                                                     * 01099802
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 01133202
*                                                                     * 01143202
*    PROCESSOR = ASSEMBLER XF                                         * 01153202
*                                                                     * 01163202
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 01165202
*                  ORG STATEMENT AT END OF LISTING                    * 01165602
*                                                                     * 01166002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 01166402
*                  PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY, * 01166502
*                  LINK PACK AREA RESIDENT/PAGEABLE                   * 01177602
*                                                                     * 01187602
* ENTRY POINT =                                                       * 01188002
*        IFG0195B R14 = 0 NORMAL ENTRY                                * 01188102
*        IFG0195B R14 = 4 RETURN FROM IFG0194J                        * 01188202
*                                                                     * 01188402
*    PURPOSE = SEE FUNCTION                                           * 01188802
*                                                                     * 01192502
*    LINKAGE =                                                        * 01194502
*        FROM IFG0194A:                                               * 01194602
*           IC  RET,DXSAVOFF                                          * 01194702
*           IECRES LOAD,MODID=DXSAVMOD,BRCODE=(RET),BRANCH=QUEUED     * 01194802
*                                                                     * 01195002
*        FROM IFG0194J:                                               * 01195402
*           IC RET,DXRETCOD                                           * 01195502
*           IECRES LOAD,MODID=DXRETMOD,BRCODE=(RET),BRANCH=QUEUED     * 01195602
*                                                                     * 01195902
* INPUT = STANDARD                                                    * 01196002
*                                                                     * 01196102
* OUTPUT =                                                            * 01196202
*        1. TAPE POSITIONED AT REQUESTED FILE.                        * 01196302
*           DXCCW3 SET TO INDICATE TO IFG0195H THAT RDBACK OR OUTPUT  * 01196437
*           DISP=MOD POSITIONING HAS BEEN DONE.                       * 01196537
*                                                                     * 01196702
*        2. INDICATORS SET FOR:                                       * 01197402
*           A. SETTING SECURITY INDICATOR IN LABEL AND EXTENDING TO   * 01199402
*           ANOTHER VOLUME IF A MOD DATA SET REACHES EOV.             * 01199802
*                                                                     * 01230802
* EXIT-NORMAL =                                                       * 01246202
*        IFG0194A                                                     * 01248202
*        IFG0195H TAPE INPUT HEADER LABEL VERIFICATION                * 01250202
*        IFG0196J JFCB TO DCB MERGE                                   * 01252202
*                                                                     * 01256202
* EXIT-ERROR =                                                        * 01266202
*        IFG0190P ABEND:                                              * 01268202
*        9 - 613-04 ABEND - I/O ERROR POSITIONING TAPE.               * 01269037
*       10 - A13-04 ABEND - BACKSPACED INTO LOAD POINT DUE TO A       * 01270037
*            INCORRECT UCB FILE SEQUENCE COUNT OR TAPE POSITION.      * 01271037
*       11 - 613-08 ABEND - I/O ERROR READING LABEL. (RECOVERABLE)    * 01272037
*       12 - 613-0C ABEND - INVALID TAPE LABEL READ. (RECOVERABLE)    * 01272537
*       14 - 813-04 ABEND - INCORRECT DATA SET NAME. (RECOVERABLE,    * 01272637
*            (DETECTED BY IFG0195B, ISSUED BY IFG0195H)               * 01272737
*      152 - A13-08 ABEND - FILE SEQUENCE BEFORE START OF VOLUME      * 01273037
*            WHILE POSITIONING TO START OF FILE.                      * 01274037
*      153 - A13-0C ABEND - FILE SEQUENCE BEFORE START OF VOLUME      * 01275037
*            WHILE POSITIONING TO END OF FILE.                        * 01275537
*            (DETECTED BY IFG0195B, ISSUED BY IFG0195H)               * 01275737
*      154 - A13-10 ABEND - TM INSTEAD OF HDR1 DURING FSF POSITIONING.* 01276037
*            (DETECTED BY IFG0195B, ISSUED BY IFG0195H)               * 01276237
*      156 - A13-18 ABEND - EOV1 ON LAST OR ONLY VOLUME AND           * 01276537
*            DESIRED FILE SEQUENCE IS GREATER THAN EOV1'S.            * 01277037
*                                                                     * 01278137
* EXTERNAL REFERENCES = SEE BELOW                                     * 01286202
*                                                                     * 01288202
*    ROUTINES = IFG019RA                                              * 01290202
*                                                                     * 01292202
*    DATA AREAS = NONE                                                * 01294202
*                                                                     * 01294602
*    CONTROL BLOCKS =                                                 * 01295002
*        UCB, JFCB, DSAB                                              * 01295102
*                                                                     * 01295402
* TABLES = O/C WORK AREA:                                             * 01295802
*              WTG TABLE, CCW, DXRETMOD, DXSAVMOD                     * 01303602
*                                                                     * 01303802
* MACROS = IECEQU, IECDSECS, MODESET, DMABCOND, IECRES, XLATE, EXCP,  * 01307602
*          XCTLTABL, WTO                                              * 01311402
*                                                                     * 01315202
* CHANGE ACTIVITY = SEE DELETIONS/CHANGES ABOVE AT START OF LISTING.  * 01319037
*                                                                     * 01322802
*********************************************************************** 01324802
         EJECT                                                          01326802
         BALR  RBASE,0                                                  28000021
         USING *,RBASE                                                  28200021
*                                                                       28400021
         USING FORCORE,RCORE                                            28600021
*        USING WTG,RWTG                 DEFINE BASE TO WTG TABLE        28650037
         USING IHADCB,RDCB                                              28800021
         USING TIOENTRY,RTIOT                                           29000021
         USING UCBOB,RUCB                                               29200021
*                                                                       29400037
         B     LABEL00(RET)             BR ON REG 14 CODE        Y02083 29450002
LABEL00  B     OTA25000                 NORMAL ENTRY             Y02083 29500002
         B     OTA25455                 RETURN IFG0194J          Y02083 29550002
*                                                                       29560037
*********************************************************************** 29570037
*                                                                       29580037
*  ZERO DCB TAPE BLOCK COUNT                                            29590037
*                                                                       29595037
OTA25000 EQU   *                        NORMAL ENTRY                    29600002
OTA25200 TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP                   31800021
         BNO   OTA25300                 BRANCH IF NOT EXCP              32000021
         TM    DCBMACRF+1,DCBMDEV       IS DEV DEP SECTION PRESENT      32200021
         BZ    OTA25400                 BRANCH IF DEV DEP NOT PRESENT   32400021
OTA25300 EQU   *                        NOT EXCP                        32600002
         XC    DCBBLKCT,DCBBLKCT        ZERO BLOCK COUNT                32800021
         EJECT                                                          32900037
*********************************************************************** 33010002
*                                                                     * 33015037
*          MAKE SURE CHECK POINT DATA SETS ONLY GO ON SECURE VOLUMES  * 33020002
*          AND THAT NON CHECK POINT DATA SETS DONT GO ON CHECK POINT  * 33030002
*          SECURE VOLUMES.                                            * 33040002
*                                                                     * 33041037
*********************************************************************** 33042002
OTA25400 EQU   *                                                        33042102
         MVI   DXLBL,K0                 IND NO HDR1 READ, POS  @ZA04601 33042237
         L     RB,DXDSAB                GET DSAB ADDRESS         YM7580 33042502
         USING DSAB,RB                                           YM7580 33042602
         TM    DSABFLG4,DSABCKVL        CHECK IF SECURE VOL      YM7580 33042902
         BO    OTA25480                 BRANCH IF SECURE         YM7580 33043302
         DROP  RB                                                YM7580 33043702
         TM    JFCBLTYP,JFCBAL          ANSI LABEL               Y02083 33044002
         BO    OTA25480                 YES   NO PROCESSING  REQ Y02083 33046002
         CLC   JFCBFLSQ,BSRCCW+K6       FILE SEQ NO. GT ONE      Y02083 33048002
         BNH   OTA25480                 NO                       Y02083 33048402
         CLC   SRTEFSCT,BSRCCW+K6       SEQ CNT GT ONE           Y02083 33048802
         BNH   OTA25405                 NO, READ HDR 1           Y02083 33049202
*********************************************************************** 33049602
*              BACK SPACE FILE TWICE TO GET IN FRONT OF EOV1 OR EOF1  * 33049737
*********************************************************************** 33059737
         MVC   DXCCW1,BSFCCWD           SET UP FOR BSF           Y02083 33099902
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT  Y02083 33109902
         BZ    OTA27500                 BRANCH IF I/O ERROR      Y02083 33119902
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT@ZA04601 33125037
         BZ    OTA27500                 BRANCH IF I/O ERROR    @ZA04601 33130037
*********************************************************************** 33139902
*              FORWARD SPACE FILE ONCE TO GET TO EOV1 OR EOF1         * 33141937
*********************************************************************** 33143902
         MVI   DXCCW1,CCWFSF            SET UP FORWARD SPACE FILEY02083 33145902
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT  Y02083 33148302
         BZ    OTA27500                 BRANCH IF I/O ERROR      Y02083 33148702
*********************************************************************** 33149102
*              READ 80 BYTES     HDR1 (VOL/EOV1/EOF1/TM) EXPECTED     * 33149537
*********************************************************************** 33149602
OTA25405 EQU   *                        INSTR MUST FOLLOW        Y02083 33149702
         BAL   RD,OTA25650              GO READ LABEL OR TM    @ZA04601 33160037
         BO    OTA25420                 BRANCH IF NO I/O ERROR   Y02083 33183002
         TM    IOBSTAT0,CSWUNITX        WAS TAPE MARK READ     @ZA04601 33184037
         BO    OTA25441                 BR IF YES TO BSF/NONE  @ZA04601 33185037
OTA25415 EQU   *                        I/O ERROR READING LABEL@ZA04601 33185237
OABD011  EQU   011                      I/O ERROR READING LBL  @ZA04601 33185437
         LA    R0,OABD011               LOAD 613-08 ABEND CODE @ZA04601 33185637
         CLC   JFCBFLSQ,BSRCCW+K6       FILE SEQ NO. GT ONE    @ZA28320 33185737
         BH    OTA25416                 YES, ABEND             @ZA28320 33185837
         B     OTA25451                 REJECT VOLUME          @ZA11150 33186137
*                                                                       33186337
OTA25416 EQU   *                        INVALID LABEL READ     @ZA04601 33186537
         MVC   DXSAVMOD,ID5B5B          SAVE THIS LOAD FOR RETRN Y02083 33187037
         MVI   DXSAVOFF,K0              SAVE RETURN OFFSET       Y02083 33188802
         LA    RET,K24                  INITIALIZE RETRY OFFSET  Y02083 33190802
         DMABCOND (0),ID5B0P,RETURN=ID5B4A  GO PROB DET/ABEND  @ZA04601 33191037
*                                                                       33191237
OTA25418 EQU   *                        INVALID LABEL READ     @ZA04601 33191437
OABD012  EQU   012                      INVALID LABEL READ     @ZA04601 33191637
         LA    R0,OABD012               LOAD 613-0C ABEND CODE @ZA04601 33191837
         B     OTA25416                 BR TO COMMAND ABEND    @ZA04601 33192037
*                                                                       33192237
OTA25420 EQU   *                        INSTR MUST FOLLOW        Y02083 33193202
         CLC   FL1LABI(K4),OP2KHDR1     FILE HEADER LABEL        Y02083 33193602
         BE    OTA25425                 CHK SEQ NUMBER           Y02083 33194002
         CLC   FL1LABI(K4),OP2KEOV1     EOV TRAILER LABEL      @ZA04601 33194537
         BE    OTA25425                 BR IF YES TO USE IT    @ZA04601 33195037
         CLC   FL1LABI(K4),OP2KEOF1     FILE TRAILER LABEL       Y02083 33196602
         BE    OTA25425                 BR IF YES TO USE IT    @ZA04601 33197037
         CLC   FL1LABI,VOL195B          VOLN LABEL             @ZA04601 33197537
         BE    OTA25405                 BR IF YES TO READ NEXT @ZA04601 33198037
         B     OTA25418                 BR ABEND INVALID LABEL @ZA04601 33198537
OTA25425 EQU   *                        INSTR MUST FOLLOW        Y02083 33199002
         CLC   SRTEFSEQ(K2),DANULLD     SEQ NO. = ZERO           Y02083 33199602
         BNE   OTA25440                 NO                       Y02083 33202202
         LA    RB,K1                    ASSUME FILE SEQ NO IS 1@ZA07028 33204237
         TM    FL1FILSQ,ALLBITS-BLANK   FILE SEQ NO BLANK OR 0 @ZA07028 33204837
         BZ    OTA25435                 YES, BRANCH            @ZA07028 33205437
         PACK  DXWORK(K8),FL1FILSQ      PACK SEQ NO.             YM4659 33206037
         CVB   RB,DXWORK                CONV SEQ NO. TO BINARY   Y02083 33206637
OTA25435 EQU   *                                               @ZA07028 33207237
         MODESET EXTKEY=SUPR                                     Y02083 33208202
         STH   RB,SRTEFSEQ              STORE FILE SEQ NO.       Y02083 33208602
         MVI   UCBFSCT+K1,K1            SET FILE SEQ COUNT TO 1  YM5321 33209002
         MODESET EXTKEY=DATAMGT                                  Y02083 33210002
*********************************************************************** 33244302
*              READ 80 BYTES   HDR2 (EOV2/EOF2/UHL/UTL/TM) EXPECTED   * 33254337
*********************************************************************** 33264302
OTA25440 EQU   *                        INSTR MUST FOLLOW        Y02083 33274302
         BAL   RB,OTA27400              READ LABEL               Y02083 33284302
         BO    OTA25442                 BRANCH IF NO I/O ERROR @ZA02882 33286300
         TM    IOBSTAT0,CSWUNITX        WAS TAPE MARK READ?    @ZA02882 33286700
         BZ    OTA25415                 NO, BRANCH TO ABEND    @ZA02882 33287100
OTA25441 EQU   *                        TAPE MARK, NOT HDR1/2  @ZA04601 33287437
         L     RB,DXDSAB                DSAB ADR               @ZA02882 33287500
         USING DSAB,RB                                         @ZA02882 33287900
         MODESET  EXTKEY=SCHED                                 @ZA02882 33288000
         NI    DSABFLG4,X'FF'-DSABCKDS-DSABCKVL  RESET DSAB CK @ZA02882 33288100
*                                       PT DS AND CP VOL INDS  @ZA02882 33288200
         MODESET  EXTKEY=DATAMGT                               @ZA02882 33290300
         CLC   SRTEFSCT,BSRCCW+K6       SEQ GT ONE             @ZA02882 33294500
         BH    OTA25480                 YES, BR TO NORMAL PROC @ZA02882 33294900
         MVI   DXCCW1,CCWBSF            SET UP BACKSPACE FILE  @ZA02882 33295100
         BAL   RB,OTA27400              BR TO EXCP AND WAIT    @ZA02882 33295200
         BZ    OTA27500                 BR IF I/O ERROR        @ZA02882 33295500
         CLC   FL1LABI(K4),OP2KHDR1     WAS A HDR1 ALSO READ   @ZA04601 33295737
         BNE   OTA25480                 BR IF NO, DONE         @ZA04601 33295837
         B     OTA25477                 BR TO DO 1 BSR         @ZA02882 33295937
*                                                                       33296037
OTA25442 EQU   *                                               @ZA02882 33296137
         CLC   FL1LABI,OP2KHDR1         IS THIS HDR(2) LABEL   @ZA04601 33296237
         BE    OTA25443                 BR IF YES              @ZA04601 33296337
         CLC   FL1LABI,OP2KEOV1         IS THIS EOV(2) LABEL   @ZA04601 33296437
         BE    OTA25443                 BR IF YES              @ZA04601 33296537
         CLC   FL1LABI,OP2KEOF1         IS THIS EOF(2) LABEL   @ZA04601 33296637
         BNE   OTA25445                 BR IF NO, NOT LBL(2)   @ZA04601 33296737
OTA25443 EQU   *                                               @ZA04601 33296837
         CLI   FL1NO,C'2'               IS THIS LBL2 (HDR2)    @ZA04601 33296937
         BNE   OTA25445                 BR IF NO, NOT HDR2 LBL @ZA04601 33297037
         CLI   FL2DSIND,CHARC           CHK PT IND ON IN HDR2    Y02083 33297137
         BE    OTA25450                 YES                      Y02083 33297300
OTA25445 EQU   *                        INSTR MUST FOLLOW        Y02083 33297802
         L     RB,DXDSAB                DSAB ADR                 Y02083 33299902
         USING DSAB,RB                                           Y02083 33302002
         MODESET  EXTKEY=SCHED                                   Y02083 33304102
         NI    DSABFLG4,X'FF'-DSABCKDS-DSABCKVL  RESET DSAB CK   Y02083 33306202
*                                       PT DS AND CP VOL INDS    Y02083 33308302
         MODESET  EXTKEY=DATAMGT                                 Y02083 33310402
         B     OTA25470                 CHK FILE SEQ CNT         Y02083 33312502
OTA25450 EQU   *                        INSTR MUST FOLLOW        Y02083 33314637
         CLC   DXVOLSR2,SCRATCH         IS SCRATCH MOUNTED?    @ZA05622 33315237
         BNE   OTA25453                 BRANCH IF NOT          @ZA05622 33315837
OTA25451 MVC   DXRETMOD,ID5B5B          LOAD RETURN 5B         @ZA11150 33316437
         MVI   DXRETCOD,K0              ZERO RETURN CODE       @ZA05622 33317037
         MVC   DXVOLSR1,UCBVOLI         MOVE IN VOLSER         @ZA05622 33317637
         IECRES LOAD,MODID=ID5B4A,BRCODE=K16,  LOAD 194A TO    @ZA05622X33318237
               PREFIX=WTGPREFX,BRANCH=QUEUED   REJECT TAPE     @ZA05622 33318837
*************************************************************  @ZA05622 33319437
*       ASK OPERATOR IF VOLUME IS SECURE                    *  @ZA05622 33320037
*************************************************************  @ZA05622 33320637
OTA25453 EQU   *                        INSTR MUST FOLLOW      @ZA05622 33321237
         MVC   DXRETMOD,ID5B5B          SET RETURN NAME & ADR    Y02083 33322902
         MVI   DXRETCOD,K4              SET BR TABLE RETURN VAL  Y02083 33324902
         XC    DXWORK1,DXWORK1          ZERO WTOR REPLY AREA     Y02083 33326902
         LA    R1,DXWORK1               POINT TO REPLY AREA      Y02083 33327302
         LA    R0,K3                    SET REPLY LENGTH         Y02083 33327402
         SLL   R0,K24                   MOVE LENGTH TO HI BYTE   Y02083 33327502
         OR    R1,R0                    SET UP WTOR PARM         Y02083 33333102
         IECRES LOAD,MODID=ID5B4J,BRCODE=K56,BRANCH=QUEUED       Y02083 33335102
OTA25455 EQU   *                        INSTR MUST FOLLOW        Y02083 33337102
         IECRES WAIT                    WAIT FOR REPLY           Y02083 33337502
         OC    DXWORK1(K3),BLANKS       FOLD REPLY TO UPPER CASE Y02083 33337902
         CLC   KYES,DXWORK1             REPLY=YES                Y02083 33338302
         BE    OTA25460                 YES                      Y02083 33338402
         CLC   KNO,DXWORK1              REPLY=N0                 Y02083 33338502
         BE    OTA25445                 YES                      Y02083 33338602
         B     OTA25450                 NEITHER ISSUE MSG AGAIN  Y02083 33353902
OTA25460 EQU   *                        INSTR MUST FOLLOW        Y02083 33363902
         L     RB,DXDSAB                DSAB ADR                 Y02083 33365902
         MODESET  EXTKEY=SCHED                                   Y02083 33366302
         OI    DSABFLG4,DSABCKDS+DSABCKVL       SET DSAB CHK PT  YM6514 33367902
*                                       DS AND CP VOL INDS       Y02083 33368102
         MODESET  EXTKEY=DATAMGT                                 Y02083 33368402
OTA25470 EQU   *                        INSTR MUST FOLLOW        Y02083 33368702
         CLC   SRTEFSCT,BSRCCW+K6       SEQ CNT GT ONE           Y02083 33369102
         BNH   OTA25475                 NO                       Y02083 33369202
*********************************************************************** 33369302
*              FORWARD SPACE ONE FILE TO GET AFTER TRAILER LABELS     * 33374437
*********************************************************************** 33376402
         MVI   DXCCW1,CCWFSF            SET UP FORWARD SPACE FILEY02083 33378402
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT  Y02083 33378802
         BZ    OTA27500                 BRANCH IF I/O ERROR      Y02083 33379202
         B     OTA25480                 START NORMAL PROCESSING  Y02083 33379302
*********************************************************************** 33379402
*              BACK SPACE RECORD TWICE TO GET IN FRONT OF HDR LABELS  * 33379537
*********************************************************************** 33384602
OTA25475 EQU   *                        INSTR MUST FOLLOW        Y02083 33386602
         MVC   DXCCW1,BSRCCW            SET UP FOR BACKSPACE REC Y02083 33389002
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT  Y02083 33389402
         BZ    OTA27500                 BRANCH IF I/O ERROR      Y02083 33389502
OTA25477 EQU   *                        BACKSPACE 1 RECORD     @ZA04601 33390037
         MVC   DXCCW1,BSRCCW            SET UP FOR BSR         @ZA04601 33392037
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT@ZA04601 33394037
         BZ    OTA27500                 BRANCH IF I/O ERROR             33396037
         DROP  RB                                                Y02083 33399602
OTA25480 EQU   *                        INSTR MUST FOLLOW        Y02083 33410002
*                                                                       33411037
*********************************************************************** 33412037
         EJECT                                                          33415037
*********************************************************************** 33416037
*                                                                       33417037
*  READ HDR1 LABEL TO DEFINE UCB FILE SEQUENCE NUMBER IF TAPE NOT YET   33418037
*  USED.  (ONLY OPEN OUTPUT TO FILE 1 OR EOV OUTPUT WILL OVERRIDE THIS) 33419037
*  IF VOL LABEL WAS JUST CREATED BY OMODVOL1, IT IS FOLLOWED BY A TM.   33420037
*  IF THE NUMBER IN THE UCB IS ZERO, THEN THE VOLUME MUST HAVE JUST     33421037
*  BEEN VERIFIED AND SO TAPE IS POSITIONED AFTER VOL1 LABEL.            33422037
*                                                                       33423037
         MVI   DXLBL,K0                 IND NO POSITIONING DONE@ZA04601 33424037
*                                       AND SO EOV1 TEST MAY BE NEEDED  33425037
         CLC   UCBFSEQ,DANULLD          IS FILE SEQ NUMBER IN SRT ZERO  33430002
         BNE   OTA26100                 BRANCH IF NO                    33440002
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 33450002
         MVC   UCBFSCT(L'UCBFSCT+L'UCBFSEQ),FW5B101  SET UCB   @ZA04601 33600037
*                                       FILE COUNT AND SEQ TO 1         33800037
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 33850002
*                                                                       34800037
OTA25600 EQU   *                        READ A RECORD                   35200002
         BAL   RD,OTA25650              GO READ LABEL OR TM    @ZA04601 35400037
         BO    OTA25900                 BR IF LABEL READ OK    @ZA04601 35600037
         TM    IOBSTAT0,CSWUNITX        TEST UNIT EXCEPTION TM @ZA04601 35800037
         BZ    OTA25415                 BR IF NO, I/O ERROR    @ZA04601 36000037
         MVC   DXCCW1,BSFCCWD           SET UP TO BSF OVER TM  @ZA04601 36200037
         B     OTA26000                 BR TO BSF OVER TM      @ZA04601 36400037
*                                                                       36600037
OTA25900 EQU   *                        TEST FOR HDR 1                  38600002
         CLC   FL1LABI(4),OP2KHDR1      IS THIS A FILE HEADER LABEL     38800021
         BE    OTA25950                 BR IF YES TO USE IT    @ZA04601 39000037
         CLC   FL1LABI,VOL195B          IS THIS A VOL LABEL    @ZA04601 39020037
         BE    OTA25600                 BR YES, READ NEXT LABEL@ZA04601 39040037
         CLC   FL1LABI,UVL195B          IS THIS A UVL LABEL    @ZA04601 39060037
         BE    OTA25600                 BR YES, READ NEXT LABEL@ZA04601 39080037
         B     OTA25418                 BR ABEND INVALID LABEL @ZA04601 39100037
*                                                                       39200037
OTA25950 EQU   *                        HAVE HDR1 LABEL        @ZA04601 39400037
         LA    RB,K1                    ASSUME FILE SEQ NO IS 1@ZA07028 39800037
         TM    FL1FILSQ,ALLBITS-BLANK   FILE SEQ NO BLANK OR 0 @ZA07028 39840037
         BZ    OTA25960                 YES, BRANCH            @ZA07028 39880037
         PACK  DXCCW2,FL1FILSQ          PACK FILE SEQ NUMBER FROM LBL   39920037
         CVB   RB,DXCCW2                CONVERT FIL SEQ NO TO BINARY    39960037
OTA25960 EQU   *                                               @ZA07028 40000037
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 40050002
         STH   RB,UCBFSEQ               STORE RESULTS IN UCB            40200021
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY    @ZA04601 40210037
*                                                                       40250037
         MVC   DXCCW1,BSRCCW            SET UP TO BSR          @ZA04601 40300037
OTA26000 EQU   *                        TO DO BSF              @ZA04601 40320037
         BAL   RB,OTA27400              BR TO EXCP AND WAIT    @ZA04601 40450037
         BZ    OTA27500                 BR IF I/O ERROR        @ZA04601 40500037
*                                                                       40550037
*********************************************************************** 40840037
*                                                                       40860037
*  DETERMINE IF POSITIONING TO START OR TO END OF FILE.                 40880037
*                                                                       40900037
OTA26100 EQU   *                        POSITION TAPE                   41000002
         XC    DXCCW3(K2),DXCCW3        ZERO END FILE POS IND  @ZA00003 41050037
*                                                                       41100037
         LH    RC,JFCBFLSQ              JFCB FIL SEQ CTR                41200021
         LH    RD,UCBFSEQ               SRT FIL SEQ CTR                 41400021
         TM    0(RPARC),PLISTOP1-PLISTRBK  PRELIMINARY TO RDBACK TEST   41600021
         BNZ   OTA26150                 BRANCH IF NOT RDBACK   @ZA00003 41800037
         TM    0(RPARC),PLISTRBK        IS IT  RDBACK                   42000021
         BO    OTA26200                 BRANCH IF RDBACK       @ZA00003 42200037
*                                                                       42250037
OTA26150 EQU   *                                                        42300037
         TM    0(RPARC),PLISTUPD        TEST FOR INPUT         @ZA00003 42350037
         BZ    OTA26800                 BR IF YES, POS TO START@ZA00003 42400037
         TM    JFCBIND2,JFCOLD          OUTPUT, IS DISP=MOD    @ZA00003 42450037
         BO    OTA26700                 BR NO, DISP=OLD OR NEW @ZA04601 42500037
*                                                                       42600037
*---------------------------------------------------------------------- 42650037
*                                                                       42700037
*  READ BACKWARD OR DISP=MOD OUTPUT POSITIONING TO END OF FILE FOLLOWS  42800037
*                                                                       43000037
OTA26200 EQU   *                        POSITION FOR READBACK           43200002
         STH   RC,DXCCW3                SAVE END FILE POS IND  @ZA00003 43300037
*                                                                       43310037
         LA    RF,K1(RD)                CALC FILE SEQ AT WHICH @ZA04602 43320037
         SH    RF,UCBFSCT               THIS TAPE STARTS       @ZA04602 43330037
OABD153  EQU   153                      FILE BEFORE START TAPE @ZA04602 43340037
         LA    R0,OABD153               LOAD A13-0C ABEND CODE @ZA04602 43350037
         CR    RF,RC                    IS FILE ON THIS TAPE   @ZA04602 43360037
         BH    OTA26940                 BR IF NOT ON TAPE TO   @ZA04602 43370037
*                                       POSSIBLE RECOVERY PREVIOUS TAPE 43380037
*                                                                       43390037
         LA    RC,K1(,RC)               INCR JFCB FIL SEQ NR            43400021
         CR    RC,RD                    JFCB+1=SRT                      43600021
         BE    OTA26600                 BR IF THEY ARE EQUAL            43800021
         BH    OTA26900                 BR IF JFCB HIGH                 44000021
*                                                                       44050037
*---------------------------------------------------------------------- 44100037
*                                                                       44200021
*  JFCB FILE SEQUENCE NO. IS LOW                                        44250037
*                                                                       44300037
OTA26300 EQU   *                        TAPE NEEDS BSF POSITIONING      44400037
         MVC   DXCCW1,BSFCCWD           SET UP BSF CCW         @ZA00003 44700037
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT         45200021
         BZ    OTA27500                 BRANCH IF I/O ERROR             45400021
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT@ZA00003 45600037
         BZ    OTA27500                 BRANCH IF I/O ERROR    @ZA00003 45800037
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT@ZA00003 46000037
         BZ    OTA27500                 BRANCH IF I/O ERROR    @ZA00003 46200037
*                                                                       47000037
         L     RD,UCBFSCT+UCBFSEQ-UCBFSEQ  DECREMENT UCB FILE  @ZA00003 47200037
         S     RD,FW5B101               COUNT AND SEQUENCE     @ZA00003 47400037
         MODESET EXTKEY=SUPR            UCB KEY                @ZA00003 47450037
         ST    RD,UCBFSCT+UCBFSEQ-UCBFSEQ  BY 1 EACH           @ZA00003 47500037
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY    @ZA00003 47550037
*                                                                       47600037
         CH    RC,UCBFSEQ               CHECK AT DESIRED FILE  @ZA00003 47700037
         BL    OTA26300                 BR IF NO, CONTINUE BSF @ZA00003 47800037
*                                                                       47900037
         BAL   RB,OTA27400              BR TO DO EXTRA BSF     @ZA00003 48000037
         BZ    OTA27500                 BR IF I/O ERROR        @ZA00003 48100037
*                                                                       48200037
         MVI   DXCCW1,CCWFSF            SET UP FORWARD SPACE FILE       48400021
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT         48600021
         BZ    OTA27500                 BRANCH IF I/O ERROR             48800021
         B     OTA26100                 BR TO CHECK FOR RDBACK OUT MOD  50200037
*                                       POSITIONING TO PREVIOUS FILE    50400037
*---------------------------------------------------------------------- 50450037
*                                                                       50500037
*  RDBACK OR DISP=MOD OUTPUT, JFCB FILE SEQUENCE NO. IS EQUAL           50600037
*  (NO TEST FOR EOV1 BECAUSE EITHER THIS IS THE LAST VOLUME, A SPECIFIC 50650037
*  VOLUME SEQUENCE REQUEST, OR THE DATA SET IS MISSING FROM THE NEXT    50660037
*  VOLUME AND WE ARE ALREADY IN DISP=MOD VOLUME POSITIONING RECOVERY)   50670037
*                                                                       50700037
OTA26600 EQU   *                                                        50800021
         MVC   DXCCW1,BSFCCWD           SET UP FOR BSF                  51200021
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT         51400021
         BZ    OTA27500                 BRANCH IF I/O ERROR             51600021
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT@ZA00003 51800037
         BZ    OTA27500                 BRANCH IF I/O ERROR    @ZA00003 51900037
         MVI   DXCCW1,CCWFSF            SET UP FORWARD SPACE FILE       52000021
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT         52200021
         BZ    OTA27500                 BRANCH IF I/O ERROR             52400021
*                                                                       52600037
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 52650002
         L     RD,UCBFSCT+UCBFSEQ-UCBFSEQ  DECREMENT UCB FILE  @ZA00003 52800037
         S     RD,FW5B101               COUNT AND SEQUENCE     @ZA00003 53000037
         ST    RD,UCBFSCT+UCBFSEQ-UCBFSEQ  BY 1 EACH           @ZA00003 53200037
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 53450002
*                                                                       53500037
         B     OTA27000                 SKIP CODE FOR NOT RDBACK        53600021
*                                                                       53650037
*---------------------------------------------------------------------- 53700037
*                                                                       53710037
*  INPUT OR OUTPUT POSITIONING TO START OF FILE FOLLOWS                 53720037
*                                                                       53730037
*              IF OPENING TO FILE 1, THEN WE CAN PROTECT AGAINST        53740037
*              PREVIOUS ABENDS WHICH MAY HAVE LEFT THE TAPE             53750037
*              MISPOSITIONED BY REWINDING THE TAPE TO FILE 1.           53760037
*              NO REWIND IS REQUIRED IF THIS OPEN JUST VERIFIED         53770037
*              THE VOLUME BY REWINDING IT, READING VOL1, AND            53780037
*              READING HDR1 IN THIS MODULE.  IF WE DO A REWIND,         53790037
*              IT WILL PROBABLY BE A NOP, BECAUSE EOV OR CLOSE          53800037
*              DID A REWIND TO POSITION THE TAPE TO FILE 1 AND          53810037
*              THUS WE ARE NOT SPENDING TIME READING VOL1 TWICE.        53820037
*                                                                       53830037
OTA26700 EQU   *                        OUTPUT TO START OF FILE@ZA04601 53900037
         CH    RC,FW5B101               IS JFCB FILE SEQ = 1   @ZA04601 54000037
         BNE   OTA26800                 BR IF NO TO USE UCBFSEQ@ZA04601 54100037
         CLC   UCBFSCT,FW5B101          IS TAPE AT COUNT = 1   @ZA04601 54200037
         BNE   OTA26850                 BR IF NO TO REWIND     @ZA04601 54300037
         CLI   DXLBL,K0                 WAS HDR1 JUST READ     @ZA04601 54400037
         BE    OTA26850                 BR IF NO TO DO REWIND  @ZA04601 54500037
         B     OTA26860                 BR TO SET UCB FSEQ = 1 @ZA04601 54600037
*                                                                       54700037
OTA26800 EQU   *                        INPUT TO START OF FILE @ZA04601 54800037
         LA    RF,K1(RD)                CALC FILE SEQ AT WHICH @ZA04601 54900037
         SH    RF,UCBFSCT               THIS TAPE STARTS       @ZA04601 55000037
OABD152  EQU   152                      FILE STARTS BEFORE TAPE@ZA04601 55100037
         LA    R0,OABD152               LOAD A13-08 ABEND CODE @ZA04601 55200037
         CR    RC,RF                    CHECK IF FILE ON TAPE  @ZA04601 55300037
         BL    OTA27600                 BR NOT ON TAPE TO ABEND@ZA04601 55400037
         BH    OTA26870                 BR HIGH TO BSF,NONE,FSF@ZA04601 55500037
         CLI   DXLBL,K0                 WAS HDR1 JUST READ     @ZA04601 55600037
         BNE   OTA26870                 BR YES, NO WANT REWIND @ZA04601 55700037
*                                                                       55800037
OTA26850 EQU   *                        REWIND TAPE            @ZA04601 55900037
         MVC   DXCCW1,REWCCWD           SET UP CCW FOR REWIND  @ZA04601 56000037
         BAL   RB,OTA27400              BR TO EXCP AND WAIT    @ZA04601 56100037
         BZ    OTA27500                 BR IF I/O ERROR        @ZA04601 56200037
         MODESET EXTKEY=SUPR            UCB KEY                @ZA04601 56250037
         MVC   UCBFSCT,FW5B101          SET UCB FILE COUNT TO 1@ZA04601 56300037
OTA26860 EQU   *                                               @ZA04601 56400037
         MODESET EXTKEY=SUPR            UCB KEY                @ZA04601 56450037
         STH   RC,UCBFSEQ               SET UCB TO JFCB FSEQ   @ZA04601 56500037
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY    @ZA04601 56550037
         B     OTA27000                 BR, TAPE NOW POSITIONED@ZA04601 56600037
*                                                                       56700037
OTA26870 EQU   *                                               @ZA04601 56800037
         CR    RC,RD                    IS JFCB FSEQ = UCB FSEQ@ZA04601 56900037
         BL    OTA26300                 BR IF LOW TO DO BSF    @ZA04601 57000037
         BE    OTA26995                 BR IF EQUAL, CHECK EOV1@ZA04601 57100037
*                                       HIGH, DO FSF           @ZA04601 57200037
*                                                                       57250002
*---------------------------------------------------------------------- 57300037
*                                                                       57350037
*  JFCB FILE SEQUENCE NO. IS HIGH                                       57400037
*                                                                       57410037
OTA26900 EQU   *                        TAPE NEEDS FSF POSITIONING      57420037
         BAL   RC,OTA26990              GO CHECK FOR PREV EOV1 @ZA04606 57430037
*                                                                       57440037
OTA26905 EQU   *                                               @ZA00003 57445037
         BAL   RD,OTA25650              GO READ HDR1 OR TM     @ZA00003 57450037
         BZ    OTA26930                 BR IF I/O ERROR OR TM  @ZA04603 57460037
*                                                                       57462037
         CLC   FL1LABI,VOL195B          IS THIS A VOL LABEL    @ZA00003 57462537
         BE    OTA26905                 BR YES, READ NEXT LABEL@ZA00003 57463037
         CLC   FL1LABI,UVL195B          IS THIS A UVL LABEL    @ZA00003 57463537
         BE    OTA26905                 BR YES, READ NEXT LABEL@ZA00003 57463637
         CLC   FL1LABI(K4),OP2KHDR1     IS THIS A HDR1 LABEL   @ZA00003 57464037
         BNE   OTA25418                 BR NO, INVALID LABEL   @ZA00003 57466037
*                                                                       57470037
         CLC   UCBFSEQ,DXCCW3           IS THIS HDR1 OF DESIRED@ZA00003 57480037
         BNE   OTA26920                 END FILE, BR IF NO     @ZA00003 57490037
*                                                                       57500037
*  DOING THE DSN TEST NOW TO HDR1 RATHER THAN ONLY LATER TO EOV1/EOF1   57510037
*  SAVES 10 MINUTES PER REEL IF DOING DISP=MOD VOLUME POSITIONING       57520037
*  RECOVERY DUE TO STARTING SEARCH ON A VOLUME LATER THAN THE           57530037
*  LAST ONE ACTUALLY WRITTEN ON, OR IF WILL DSN ABEND ANYWAY.           57540037
*                                                                       57550037
*  DETERMINE 17 LEAST SIGNIFICANT NON-BLANK                             57560037
*  CHARACTERS IN JFCB DATA SET NAME                                     57570037
*                                                                       57580037
         LA    RD,JFCBDSNM              POINT TO DSNAME        @ZA00003 57590037
         LA    RB,JFCBDSNM+K27          ADDR 1ST POSS SIG CHAR @ZA00003 57600037
OTA26910 EQU   *                                               @ZA00003 57610037
         CLI   K16(RB),BLANK            IS THE CHARACTER BLANK @ZA00003 57620037
         BNE   OTA26912                 NO,GO SET UP START ADDR@ZA00003 57630037
         BCT   RB,OTA26910              GO CHECK NEXT CHAR     @ZA00003 57640037
OTA26912 EQU   *                                               @ZA00003 57650037
         LA    RC,K17(RB)               POINT TO FIRST BLANK   @ZA00003 57660037
         CLR   RB,RD                    LEFT PTR WITHIN FIELD  @ZA00003 57670037
         BNL   OTA26914                 BR IF YES              @ZA00003 57680037
         LR    RB,RD                    SET BASE OF START      @ZA00003 57690037
*                                                                       57700037
*  COMPARE THE DATA SET NAME IN THE HDR1 LABEL AGINST THE NAME IN THE   57710037
*  JFCB. CONTINUE IF EQUAL. IF NOT EQUAL AND THE DATA SET IS A          57720037
*  GENERATION DATA SET, IT MAY BE A DOS TAPE IN WHICH CASE THE          57730037
*  DATA SET NAME MUST BE COMPARED SEPARATELY FROM THE GENERATION        57740037
*  AND VERSION NUMBERS.                                                 57750037
*                                                                       57760037
OTA26914 EQU   *                                               @ZA00003 57770037
         CLC   FL1ID,0(RB)              COMPARE 17 CHAR DSNAME @ZA00003 57780037
         BE    OTA26920                 BR EQUAL, CORRECT DSN  @ZA00003 57790037
*                                                                       57800037
         LA    RET,K8                   BR TABLE OFFSET DSN BAD@ZA00003 57810037
         TM    JFCBIND1,JFCGDG          GENERATION DATA SET    @ZA00003 57870037
         BNO   OTA27200                 BR IF NO, INCORRECT DSN@ZA00003 57880037
         LA    RF,K9                    PREP TO BACK OVER GEN  @ZA00003 57890037
         SR    RC,RF                    BACK UP END POINTER    @ZA00003 57900037
         BNE   OTA27200                 BR IF NOT EQUAL        @ZA00003 57905037
         CLC   FL1VNG,K7(RC)            COMPARE VERSION NUMBER @ZA00003 57910037
         BNE   OTA27200                 BR IF NOT EQUAL        @ZA00003 57915037
         SR    RB,RF                    BACK UP COMPARE START  @ZA00003 57920037
         CLR   RB,RD                    LEFT PTR WITHIN FIELD  @ZA00003 57925037
         BNL   OTA26917                 BR IF YES TO COMP 17   @ZA00003 57930037
         SR    RC,RD                    GET CHAR COUNT         @ZA00003 57935037
         LA    RF,FL1ID(RC)             PT DSN IN LBL +CHAR CNT@ZA00003 57940037
         CLI   0(RF),BLANK              SHOULD BE PAST NAME    @ZA00003 57945037
         BNE   OTA27200                 BR, LONGER THAN IN JFCB@ZA00003 57950037
         BCTR  RC,0                     SUB 1 FOR EX INSTR     @ZA00003 57955037
         EX    RC,OTA26916              COMPARE SHORT DSNAMES  @ZA00003 57960037
         B     OTA26918                 GO TEST COMPARE RESULT @ZA00003 57965037
OTA26916 CLC   FL1ID(*-*),JFCBDSNM      CLC INSTR FOR EXEC     @ZA00003 57970037
OTA26917 CLC   FL1ID,0(RB)              COMPARE DSNAMES        @ZA00003 57975037
OTA26918 BNE   OTA27200                 BR IF DSNAME INCORRECT @ZA00003 57980037
*                                                                       57990037
OTA26920 EQU   *                        DSN CORRECT OR NOT FILE@ZA00003 57995037
         MVC   DXCCW1,FSFCCWD           SET UP FOR FSF                  58000021
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT         58200021
         BZ    OTA27500                 BRANCH IF I/O ERROR             58400021
*                                                                       58420037
         L     RD,UCBFSCT+UCBFSEQ-UCBFSEQ  INCREMENT UCB FILE  @ZA04608 58440037
         A     RD,FW5B101               COUNT AND SEQUENCE     @ZA04608 58460037
         MODESET EXTKEY=SUPR            UCB KEY                @ZA04608 58470037
         ST    RD,UCBFSCT+UCBFSEQ-UCBFSEQ  BY 1 EACH           @ZA04608 58480037
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY    @ZA04608 58490037
*                                                                       58500037
         BAL   RC,OTA27420              TEST TRLR LBLS FOR EOV1 SA55582 58600037
*                                       RETURN IF NOT EOV1      SA55582 58650002
         B     OTA26100                 GO LOOP UNTIL PROPER FILE IS    59800021
*                                       REACHED                         59810037
*                                                                       59820037
OTA26930 EQU   *                        I/O ERR OR TM FOR HDR1 @ZA04603 59830037
         TM    IOBSTAT0,CSWUNITX        TEST UNIT EXCEPTION TM @ZA04603 59840037
         BZ    OTA25415                 BR IF NO, I/O ERROR    @ZA04603 59850037
*                                                                       59860037
         MVC   DXCCW1,BSFCCWD           SET UP FOR BSF OVER TM @ZA04603 59870037
         BAL   RB,OTA27400              BR TO EXCP AND WAIT    @ZA04603 59880037
*                                                                       59890037
OABD154  EQU   154                      TM BEFORE DESIRED FILE @ZA04603 59900037
         LA    R0,OABD154               LOAD A13-10 ABEND CODE @ZA04603 59910037
OTA26940 EQU   *                                               @ZA00003 59915037
         LA    RET,K12                  LOAD BR TABLE OFFSET   @ZA00003 59920037
         B     OTA27200                 GO IFG0195H POS RECOVRY@ZA00003 59925037
*                                                                       59930037
*---------------------------------------------------------------------- 59940037
*                                                                       59950037
*  EOV1 LABEL ENCOUNTERED IN FRONT OF OR AT END OF DESIRED FILE.        59960037
*  IF POSITIONING TO START OF FILE, TRY TO GO TO NEXT TAPE AND          59970037
*  CONTINUE FSF TO CORRECT FILE.                                        59980037
*  IF POSITIONING TO END OF FILE, ABEND UNLESS EOV1 IS FOR DESIRED      59990037
*  FILE AND SO CAN TREAT AS EOF.  (NO RECOVERY BECAUSE                  60000037
*  IF JFCBVLSQ=0, THEN ALREADY ON LAST VOLUME, AND                      60001037
*  IF JFCBVLSQ NOT 0, THEN REQUEST FOR SPECIFIC VOLUME IN THE LIST      60002037
*  AND IT WILL NOT BE OVERRIDDEN.  ALSO, NO RECOVERY IN CASE HAVE       60003037
*  JUST BACKED UP FROM A VOLUME NOT CONTAINING THE DATA SET AND THUS    60004037
*  DO NOT WANT TO GET INTO A LOOP ADVANCING AND BACKING UP VOLUMES.)    60005037
*                                                                       60006037
OTA26950 EQU   *                        EOV1 ENCOUNTERED                60010037
OABD156  EQU   156                      FILE SEQ BEYOND EOV1   @ZA04605 60015037
         LA    R0,OABD156               LOAD A13-18 ABEND CODE @ZA04605 60020037
         LH    RC,DXCCW3                IS THIS RDBACK, OUT MOD@ZA04605 60025037
         LTR   RC,RC                    (OTHERWISE FILE BEYOND @ZA04605 60030037
         BZ    OTA26960                 EOV1), BR IF NO        @ZA04605 60035037
         LA    RC,K1(RC)                IS THIS FILE SEQUENCE  @ZA04605 60040037
         CH    RC,UCBFSEQ               OF DESIRED FILE        @ZA04605 60045037
         BNE   OTA27600                 BR IF NO TO ABEND      @ZA04605 60050037
         TM    JFCBIND2,JFCOLD          DISPOSITION MOD        @ZA08035 60051037
         BZ    OTA26960                 YES, BRANCH            @ZA08035 60052037
         B     OTA26600                 BR TO POSITION RDBACK  @ZA04605 60055037
*                                                                       60060037
OTA26960 EQU    *                       POS TO START OF FILE   @ZA04605 60065037
         LH    RB,DXVOLSEQ              LOAD VOLUME SEQUENCE NO SA55582 60067037
         SR    RC,RC                    ZERO REG                SA68161 60072037
         IC    RC,JFCBNVOL              LOAD NUMBER OF VOLS     SA68161 60073037
         CR    RC,RB                    IS VOLSEQ = NO. OF VOLS SA68161 60074037
         BE    OTA27600                 BR IF YES TO ABEND      SA68161 60075037
         LA    RB,K1(,RB)               INCREMENT VOLSEQ BY 1   SA55582 60076037
         STH   RB,DXVOLSEQ              AND STORE IT BACK       SA55582 60077037
         STH   RB,JFCBVLSQ              UPDATE JFCB NEXT OPEN  @ZA04607 60077537
*                                                                       60078037
*  WRITE MSG 'IEC140I DDNAMEXX,VOLIDX START OF DATA SET NOT ON VOLUME'  60079037
*                                                                       60081037
         MVC   MSGLSTSZ(OTA27701),OTA27700  MOVE MSG WORK AREA  SA55582 60082037
         MVC   MSGACTN(L'TIOEDDNM),TIOEDDNM  DDNAME TO MSG      SA55582 60089037
         MVC   MSGVOLSR+K3,UCBVOLI      VOLID TO MESSAGE        SA55582 60090037
         WTO   MF=(E,MSGLSTSZ)          WRITE MSG TO PROGRAMMER SA55582 60091037
*                                                                       60092037
         MVC   DXVOLSR1,UCBVOLI         GET VOLUME SERIAL NO.   SA55582 60093037
         MODESET EXTKEY=SUPR            UCB KEY                 SA55582 60094037
         MVI   UCBDMCT,K0               SET DATAMGT COUNT TO 0  SA55582 60095037
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY     SA55582 60096037
         MVC   DXRETMOD,ID5B5B          ID OF THIS MODULE       SA55582 60097037
         MVI   DXRETCOD,K0              BR TABLE ENTRY ON RETURNSA55582 60098037
         IECRES LOAD,MODID=ID5B4A,BRCODE=K0,BRANCH=QUEUED      @ZA04605 60100037
*                                                                       60102037
*---------------------------------------------------------------------- 60103037
*                                                                       60103537
*  SUBROUTINE TO CHECK IF PREVIOUS FILE ENDED IN EOV ON THIS VOLUME.    60104037
*  TAPE IS AT START OF A FILE AND WILL BE FSF'ED OR IS AT DESIRED FILE. 60104537
*  IF NO POSITIONG DONE, CHECK PREVIOUS TRAILER LABELS FOR EOV.         60105037
*                                                                       60110037
OTA26990 EQU   *                        ENTRY VIA BAL RC,---   @ZA00003 60112037
         CLI   DXLBL,K0                 WAS VOL REPOSITIONED   @ZA00003 60117237
         BCR   7,RC                     RETURN IF YES          @ZA00003 60117837
         CLC   UCBFSCT,FW5B101          IS UCB FILE COUNT =1   @ZA04600 60117937
         BCR   8,RC                     RETURN IF EQUAL        @ZA04600 60124237
         MVC   DXCCW1,BSFCCWD           SET UP FOR BSF         @ZA00003 60137037
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT@ZA00003 60140037
         BZ    OTA27500                 BRANCH IF I/O ERROR    @ZA00003 60145037
         BAL   RB,OTA27400              BRANCH TO EXCP AND WAIT SA55582 60150037
         BZ    OTA27500                 BRANCH IF I/O ERROR     SA55582 60155037
         B     OTA27420                 TEST TRLR LBLS FOR EOV1@ZA00003 60160037
*                                       RETURN TO CALLER IF NOT EOV1    60165037
*                                                                       60170037
*---------------------------------------------------------------------- 60171037
*                                                                       60172037
*  TAPE IS AT START OF DESIRED FILE.  IF NO POSITIONG DONE, CHECK       60173037
*  PREVIOUS TRAILER LABELS FOR EOV.                                     60174037
*                                                                       60174537
OTA26995 EQU   *                                               @ZA00003 60175037
         BAL   RC,OTA26990              GO CHECK FOR PREV EOV1 @ZA00003 60180037
*                                                                       60185037
*********************************************************************** 60186037
         EJECT                                                          60187037
*********************************************************************** 60190037
*                                                                       60195037
OTA27000 EQU   *                                                        60200037
         LA    RF,ID5B6J                MERGE MODULE IDTTR              60400021
         TM    PLISTOPT(RPARC),PLISTOIN  OUTPUT OR OUTIN         S21940 61000037
         BNO   OTA27100                 NO, BRANCH                      61200021
         TM    JFCBIND2,JFCOLD          DISPOSITION MOD                 61400021
         BNZ   OTA27300                 NO, BRANCH                      61600021
*                                                                       61800037
*********************************************************************** 62000037
*                                                                       62200037
*  START READ HDR1 (EOV1/EOF1) LABEL OF DESIRED DATA SET                79800037
*                                                                       79820037
OTA27100 EQU   *                                                        79850002
*                                                                       80000037
         BAL   RB,OTA27350              GO SET UP READ CCW     @ZA00003 80200037
*                                                                       81600037
         EXCP  DXIOB                                                    81800021
*                                                                       81900037
         LA    RET,K4                   SET FOR NEXT MOD ENTRY          82000021
OTA27200 EQU   *                        XCTL TO IFG0195H       @ZA00003 82100037
         LA    RF,ID5B5H                FILE LABEL 1 MOD IDTTR          82200021
OTA27300 EQU   *                        GO TO NEXT MODULE               82400002
         IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED       Y02080 82650002
         EJECT                                                          82651037
*********************************************************************** 82652037
*                                                                       82653037
*  SUBROUTINE TO SET UP READ CCW                                        82654037
*                                                                       82655037
OTA27350 EQU   *                        ENTRY VIA BAL RB,---   @ZA00003 82660037
         LA    RF,DXLBL                 ADDR TO READ IN LABEL  @ZA00003 82670037
         ST    RF,DXCCW1                STORE INTO CCW         @ZA00003 82680037
         MVI   DXCCW1,CCWRDTAP          READ TAPE COMMAND CODE @ZA00003 82690037
         LA    RF,K80                   NO FLAGS, LENGTH 80    @ZA00003 82700037
         ST    RF,DXCCW1+K4             STORE INTO CCW         @ZA00003 82710037
         TM    JFCBLTYP,JFCBAL          IS THIS ANSI LABEL     @ZA00003 82720037
         BCR   8,RB                     RETURN IF NO           @ZA00003 82730037
         MVI   DXCCW1+K4,CCWSILI        TURN ON SILI FOR AL    @ZA07589 82740037
         BR    RB                       RETURN                 @ZA00003 82750037
*                                                                       82760037
*********************************************************************** 82770037
*                                                                       82800021
*  SUBROUTINE TO READ ONE RECORD, TEST FOR ERRORS, AND XLATE IF AL      82850037
*                                                                       82900037
OTA25650 EQU   *                        ENTRY VIA BAL RD,---   @ZA00003 82950037
         BAL   RB,OTA27350              GO SET UP READ CCW     @ZA00003 82960037
         BAL   RB,OTA27400              READ LABEL             @ZA00003 82970037
         BCR   8,RD                     RETURN IF I/O ERROR    @ZA00003 83000037
*                                                                       83020037
         TM    JFCBLTYP,JFCBAL          CHECK FOR ANSI LABEL   @ZA00003 83030037
         BZ    OTA25690                 BR IF NO               @ZA00003 83040037
         XLATE DXLBL,K80                TRANSLATE LABEL DATA   @ZA00003 83050037
OTA25690 EQU   *                                               @ZA00003 83055037
         TM    DXECB,ECBNOERR           SET NO I/O ERROR CODE  @ZA00003 83057037
         BR    RD                       RETURN                 @ZA00003 83059037
*                                                                       83060037
*********************************************************************** 83070037
*                                                                       83080037
*  SUBROUTINE TO EXCP, WAIT, AND TEST ECB CODE FOR I/O ERROR            83090037
*                                                                       83200037
OTA27400 EQU   *                        ENTRY VIA BAL RB,---            83400037
         EXCP  DXIOB                    ISSUE I/O OPERATION             83600021
         IECRES WAIT                                                    83800021
         TM    DXECB,ECBNOERR           CK FOR PERMANENT I/O ERROR      84000021
         BR    RB                       RETURN                          84200021
*                                                                       84200537
*********************************************************************** 84201037
*                                                                       84201537
*  SUBROUTINE TO TEST TRAILER LABELS FOR EOV                            84202037
*                                                                       84203037
OTA27420 EQU   *                        ENTRY VIA BAL RC,---    SA55582 84204037
         MVC   DXCCW1,FSFCCWD           SET UP FOR FSF          SA55582 84206002
         BAL   RB,OTA27400              EXCP AND WAIT           SA55582 84208002
         BZ    OTA27500                 BR IF I/O ERROR         SA55582 84210002
         BAL   RD,OTA25650              GO READ A RECORD         YM1132 84212002
         BZ    OTA25415                 BR IF I/O ERROR        @ZA00003 84213037
         MVC   DXCCW1,FSFCCWD           SET UP FOR FSF          SA55582 84214002
         BAL   RB,OTA27400              EXCP AND WAIT           SA55582 84216002
         BZ    OTA27500                 BR IF I/O ERROR         SA55582 84218002
         CLC   FL1LABI(K4),OP2KEOV1     TEST FOR EOV RECORD     SA55582 84222002
         BE    OTA26950                 BR IF EOV RECORD        SA55582 84224002
         BR    RC                       RETURN IF NOT EOV RCD   SA55582 84226002
*                                                                       84340037
*********************************************************************** 84350037
*                                                                       84360037
OTA27500 EQU   *                        POSITIONING ERROR               84550002
OABD010  EQU   010                      WRONG FILE SEQ NO.       S21940 84560037
         LA    R0,OABD010               LOAD A13-04 ABEND CODE   S21940 84562037
         TM    IOBSENSE+1,UCBLDPT       IS TAPE AT LOAD POINT   SA65081 84570002
         BO    OTA27600                 ERROR IF AT LOAD POINT  SA65081 84580002
OABD009  EQU   009                      I/O ERROR POSITIONING    S21940 84590037
         LA    R0,OABD009               LOAD 613-04 ABEND CODE   S21940 84600037
*                                                                       84700037
OTA27600 EQU   *                        POSITIONING ERROR               84800002
         DMABCOND (0),ID5B0P                                            85000021
         EJECT                                                          85010037
*********************************************************************** 85020037
*                                                                       85030037
*        CONSTANTS                                                      85040037
*                                                                       85200021
OTA27700 WTO  'IEC140I DDNAMEXX,VOLIDX START OF DATA SET NOT ON VOLUME'X85202037
               ,MF=L,DESC=6,            JOB STATUS             @ZA00003X85202437
               ROUTCDE=11               PROGRAMMER INFORMATION @ZA00003 85203037
OTA27701 EQU   *-OTA27700               LENGTH OF WTO           SA55582 85204002
OP2KEOV1 DC    CL4'EOV1'                EOV1 LABEL ID           SA55582 85206002
VOL195B  DC    C'VOL'                   VOL LABEL ID           @ZA04601 85210037
UVL195B  DC    C'UVL'                   USER VOL LABEL ID      @ZA04601 85220037
FW5B101  DC    0F'0',H'1',H'1'          TO SET UCB COUNT+SEQ 1 @ZA04601 85300037
OP2KHDR1 DC    CL4'HDR1'                HDR 1 LBL ID                    85400021
OP2KEOF1 DC    CL4'EOF1'                EOF 1 LBL ID             Y02083 85450002
BSRCCW   DC    X'2700000020000001'      BSR CCW                         85800021
BSFCCWD  DC    X'2F00000020000001'      BSF CCW                         86000021
FSFCCWD  DC    X'3F00000020000001'      FSF CCW                         86200021
REWCCWD  DC    X'0700000020000001'      REW CCW                         86400021
DANULLD  EQU   REWCCWD+1                3 BYTES OF ZEROES               86500037
BLANKS   DC    C'   '                   3 BLANK CHARS            Y02083 86650002
KYES     DC    C'YES'                   YES REPLY MASK           Y02083 86700002
KNO      DC    C'NO '                   NO REPLY MASK            Y02083 86750002
SCRATCH  DC    C'SCRTCH'                SCRATCH REQUEST        @ZA05622 86950037
*                                                                       87200021
XCTL5B   XCTLTABL ID=(ID5B4A,4A,ID5B5H,5H,ID5B6J,6J,ID5B0P,0P,   Y02080X87400002
               ID5B4J,4J,                                        Y02083X87410002
               ID5B5B,5B),BRT=YES,LENGTH=                        Y02080 87450002
         EJECT                                                          87570037
         IECEQU ,                       DEFINE EQUATES                  87580037
CHARC    EQU   C'C'                     CHARACTER C              Y02083 87590037
         IECDSECS TIOT,DSAB,UCB,DCB,MAIN,                      @ZA00003X87600037
               EXPAND=YES                                        Y02083 87650002
         END                                                            87800021
