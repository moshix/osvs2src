         TITLE 'IFG0195U                      PASSWORD CHECK ROUTINE'   00200002
IFG0195U CSECT                                                          00800021
*********************************************************************** 01000021
*                                                                     * 01002000
*        VS2 RELEASE 04 DELETIONS/CHANGES                             * 01004000
*0000                                                          @ZA02896 01004400
*                                                                     * 01005002
* MODULE NAME = IFG0195U (OS/VS2)                                     * 01010002
*                                                                     * 01015002
* DESCRIPTIVE NAME = PASSWORD CHECK ROUTINE                           * 01020002
*                                                                     * 01025002
* COPYRIGHT = NONE                                                    * 01030002
*                                                                     * 01035002
* STATUS = RELEASE 2, LEVEL 0                                         * 01040002
*                                                                     * 01045002
* FUNCTION =                                                          * 01050002
*                                                                     * 01055002
*        1. SEARCHES PASSWORD DATA SET FOR MATCHING KEY               * 01060002
*           DSNAME + PASSWORD (52 BYTES).                             * 01065002
*                                                                     * 01070002
*        2. UPDATE USE COUNT IN PASSWORD RECORD AND WRITE IT BACK.    * 01075002
*                                                                     * 01085002
*        3. IF AN UNRECOVERABLE ERROR OCCURS OR IF THE OPERATOR       * 01090002
*           IS UNABLE TO MAKE A CORRECT RESPONSE IN TWO TRIES,        * 01091002
*           MESSAGES IEC117I AND IEC118I ARE ISSUED TO TERMINAL TASKS.* 01092002
*                                                                     * 01100002
* NOTES = ALL SEARCHES TO THE PASSWORD DATA SET ARE PROTECTED VIA ENQ.* 01200002
*         THE ENQ ON THE DATA SET NAME IS NOT THE SAME AS THE         * 01201002
*         SHARE/EXCLUSIVE ENQ ON THE DSNAME DONE BY THE JOB           * 01202002
*         SCHEDULER, SINCE THE MAJOR NAME IS DIFFERENT. THE ENQ       * 01203002
*         IS DONE TO PREVENT SIMULTANEOUS UPDATE (BY DIFFERENT        * 01204002
*         TASKS) OF THE PASSWORD RECORD USE COUNT AND SO LOSING       * 01204202
*         COUNT. THIS WOULD NEITHER BE LIKELY NOR CRITICAL.           * 01204402
*                                                                     * 01204602
*         NOTE THAT WRONG LENGTH IS SUPPRESSED WHEN READING THE       * 01204802
*         PASSWORD RECORD BECAUSE MANY USERS HAVE INCORRECTLY         * 01204902
*         CREATED THIS DATA SET WITH A BLOCK SIZE OF 132 INSTEAD      * 01206602
*         OF WITH A BLOCK SIZE OF 80 WITH KEY OF 44 + 8 = 52.         * 01207602
*         THE KEY IS NOT SUPPOSED TO BE INCLUDED IN THE BLOCK SIZE.   * 01207802
*                                                                     * 01208302
*    DEPENDENCIES =                                                   * 01210002
*                                                                     * 01215002
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 01220002
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 01225002
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 01230002
*                                                                     * 01235002
*    RESTRICTIONS = NONE                                              * 01240002
*                                                                     * 01245002
*    REGISTER CONVENTIONS = SEE IECEQU MACRO.                         * 01250002
*                                                                     * 01255002
*    PATCH LABEL = SEE XCTLTABL MACRO.                                * 01260002
*                                                                     * 01265002
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 01270002
*                                                                     * 01275002
*    PROCESSOR = ASSEMBLER XF                                         * 01280002
*                                                                     * 01285002
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 01290002
*                  ORG STATEMENT AT END OF LISTING                    * 01295002
*                                                                     * 01300002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 01305002
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 01310002
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 01315002
*                                                                     * 01320002
* ENTRY POINT = IFG0195U FROM IFG0195V OR READPSWD.                   * 01325002
*                                                                     * 01330002
*    PURPOSE = TO READ A PASSWORD RECORD AND VALIDATE THAT IT IS      * 01335002
*              CONSISTENT WITH THE PROCESSING MODE REQUESTED.         * 01340002
*                                                                     * 01350002
*    LINKAGE =                                                        * 01355002
*        IECRES LOAD,MODNM=IFG0195U,PREFIX=WTGPREFX,BRANCH=DIRECT     * 01360002
*                                                                     * 01365002
* INPUT = AS FOLLOWS -                                                * 01370002
*                                                                     * 01375002
*        R4 = ADDRESSABILITY TO FORCORE-LIKE WORK AREA.               * 01380002
*        R6 = ADDRESSABILITY TO WTG TABLE.                            * 01385002
*        RD = ADDRESSABILITY TO SECCORE WORK AREA                     * 01390002
*                                                                     * 01391002
*        IF RET (REG 14) HAS 0 ON ENTRY A PASSWORD MUST BE AT MYREPLY * 01392002
*        IF RET (REG 14) HAS 4 ON ENTRY, A PASSWORD RECORD            * 01394002
*        IS AT THE 132 BYTE AREA BEGINNING AT MYDSN.                  * 01394202
*                                                                     * 01395002
* OUTPUT = AS FOLLOWS -                                               * 01400002
*                                                                     * 01405002
*        PASSWORD RECORD UPDATED IN PASSWORD DATA SET.                * 01410002
*        PASSWORD TTR UPDATED IN DSAB.                                * 01415002
*                                                                     * 01420002
* EXIT-NORMAL = IFG0195T - PASSWORD SUPPLIED WAS OK.                  * 01425002
*               READPSWD - PASSWORD WAS INCORRECT/ TRY COUNT NOT 2.   * 01435002
*               SECLOADA - PASSWORD SUPPLIED WAS OK.                  * 01440002
*                                                                     * 01445002
* EXIT-ERROR =  IFG0195T - PASSWORD SUPPLIED WAS INCORRECT.           * 01450002
*               SECLOADA - PASSWORD SUPPLIED WAS INCORRECT.           * 01452002
*                                                                     * 01455002
* EXTERNAL REFERENCES = SEE BELOW                                     * 01460002
*                                                                     * 01465002
*    ROUTINES = READPSWD.                                             * 01470002
*                                                                     * 01475002
*    DATA AREAS = IECDSECS SECCORE,MAIN,WTG,PREFX,RRPL                * 01480002
*                                                                     * 01485002
*    CONTROL BLOCK = CVT,ASCB,TCB,JSCB,PSCB,DSAB,UCB,UPT,DEB,DCB.     * 01490002
*                                                                     * 01495002
* TABLES = SEE XCTLTABL MACRO.                                        * 01500002
*                                                                     * 01505002
* MACROS = IECRES,EXCP,WAIT,ENQ,DEQ,MODESET,TPUT,                     * 01510002
*          XCTLTABL,IECDSECS,IECEQU.                                  * 01511002
*                                                                     * 01515002
* CHANGE ACTIVITY = NEW RELEASE (LEVEL 0)                             * 01520002
*                                                                     * 01525002
*********************************************************************** 01530002
         EJECT                                                          01535002
*                                                                       01540002
         USING FORCORE,RCORE            DEFINE BASE TO MAIN WORK AREA   27600021
         USING WTG,RWTG                 DEFINE BASE TO WTG TABLE        27800021
         USING SECCORE,RD               DEFINE BASE TO SECURITY WK AREA 28200021
*                                                                       28400021
         BALR  RBASE,R0                 ESTABLISH BASE REGISTER         28600002
         USING *,RBASE                  DEFINE BASE REGISTER            28800021
*                                                                       29000021
         B     PCR00000(RET)            BRANCH TO BRANCH TABLE   Y02134 29050002
*                                                                Y02134 29100002
PCR00000 EQU   *                        BRANCH TABLE             Y02134 29150002
*                                                                Y02134 29160002
         B     PCR01000                 (0) SEARCH PSWD DATA SET Y02134 29170002
         B     PCR02000                 (4) WRITE BACK PSWD REC  Y02134 29180002
         B     PCR09500                 (8) ISSUE ERROR MESSAGE  Y02134 29192002
         EJECT                                                          29196002
*                                                                Y02134 29198002
*****************************************************************Y02134 29198402
*                                                                Y02134 29198802
*        SEARCH PASSWORD DATA SET FOR ENTRY                      Y02134 29198902
*        WITH MATCHING KEY - DSNAME + PASSWORD                   Y02134 29199002
*                                                                Y02134 29199202
*****************************************************************Y02134 29199602
*                                                                Y02134 29199702
PCR01000 EQU   *                        SEARCH FOR PASSWORD REC  Y02134 30200002
*                                                                Y02134 30400002
         XC    MYDAADDR,MYDAADDR        SET MBBCCHHR TO ZEROES   Y02134 31200002
         MVC   MYDAADDR+K3(K4),MYDEBSCC SET CCHH FROM START EXT  Y02134 31400002
*                                                                       31600021
*****************************************************************Y02134 31650002
*                                                                Y02134 31700002
*        CONSTRUCT CHANNEL PROGRAM TO SEARCH THE PASSWORD DATA SET      31800021
*        FOR DSNAME+PASSWORD AND READ THE DATA FROM THAT RECORD.        32000021
*                                                                       32200021
*****************************************************************Y02134 32250002
*                                                                Y02134 32300002
*        SEARCH ID EQ                                                   32400021
*        TIC *-8                                                        32600021
*        READ COUNT  MT                                                 32800021
*        SEARCH KEY EQ                                                  33000021
*        TIC *-16                                                       33200021
*        READ DATA                                                      33400021
*                                                                       33600021
*****************************************************************Y02134 33650002
*                                                                Y02134 33700002
         XC    MYCCW,MYCCW              CLEAR CHANNEL PROG AREA  Y02134 33800002
         LA    R1,MYDAADDR+K3           SEARCH ID ADDR           Y02134 34000002
         ST    R1,DXCCW1                                                34200021
         LA    R1,DXCCW1                TIC *-8                         34400021
         ST    R1,DXCCW2                                                34600021
         LA    R1,DXCCW7                READ COUNT IN WORK AREA  Y02134 34800002
         ST    R1,DXCCW3                                                35000021
         LA    R1,MYDSN                 SEARCH KEY EQ ADDR       Y02134 35200002
         ST    R1,DXCCW4                                                35400021
         LA    R1,DXCCW3                TIC *-16                        35600021
         ST    R1,DXCCW5                                                35800021
         LA    R1,MYLOGFLD              READ DATA AREA           Y02134 36000002
         ST    R1,DXCCW6                                                36200021
         OC    DXCCW1(K6*K8),PCRCCW01   CMND, FLAGS, AND LENGTH  Y02134 36400002
         EJECT                                                          36450002
*                                                                Y02134 36500002
*****************************************************************Y02134 36550002
*                                                                Y02134 36600002
*        ESTABLISH ENQ/DEQ LIST IN SECURITY WORK AREA            Y02134 36650002
*                                                                Y02134 36700002
*****************************************************************Y02134 36750002
*                                                                Y02134 36800002
         TM    WTGPATHS,X01             TEST SCRATCH/RENAME      Y02134 36850002
         BO    PCR01100                 BRANCH TO BYPASS ENQ     Y02134 36900002
*                                                                Y02134 36950002
         MVC   MYSYSDSN,MYDSN           DSNAME TO ENQ AREA       Y02134 36960002
         L     R1,IECRRPRM-IECEXTPR(,RD) LOAD RECOVERY PARM LIST Y02134 37000002
         OI    RRFLAGS2-RRPLIST(R1),RRFENQPW PSWD ENQ IND        Y02134 37050002
*                                                                Y02134 37100002
         MVC   MYENQSW1(K12),ENQLIST    ENQ LIST TO WORK AREA    Y02134 37150002
*                                                                Y02134 37200002
         ENQ   (,MYSYSDSN),MF=(E,MYENQSW1) ENQ ON DSNAME         Y02134 37250002
*                                                                Y02134 37300002
*****************************************************************Y02134 37350002
*                                                                Y02134 37400002
*        READ PASSWORD ENTRY                                     Y02134 37450002
*                                                                Y02134 37500002
*****************************************************************Y02134 37550002
*                                                                Y02134 37600002
PCR01100 EQU   *                        READ IN RECORD           Y02134 37650002
*                                                                       39000021
         EXCP  MYIOB                    READ PASSWORD ENTRY      Y02134 39200002
*                                                                       39400021
         WAIT  ECB=MYECB                WAIT FOR READ COMPLETE   Y02134 39600002
*                                                                       39800021
         XC    MYREPLY,MYREPLY          HIDE PASSWORD            Y02134 39850002
*                                                                Y02134 39900002
         MVC   DXDAADDR+K3(K5),DXCCW7   PASSWORD CCHHR DA ADDR   Y02134 39910002
*                                                                Y02134 39920002
         NI    DCBIFLGS-IHADCB+MYDCB,ALLBITS-DCBIFPIO CLEAR ERR  YM8526 39970002
*                                                                YM8526 39980002
         TM    MYECB,ECBNOERR           TEST IF I/O ERROR        Y02134 40000002
         BNZ   PCR01200                 BRANCH IF NO I/O ERROR   YM1353 40200002
         EJECT                                                          40250002
*                                                                YM1353 40300002
*****************************************************************YM1353 40350002
*                                                                YM1353 40400002
*        DEQ DSNAME FOR ERROR PROCESSING                         YM1353 40450002
*                                                                YM1353 40550002
*****************************************************************YM1353 40600002
*                                                                YM1353 40650002
         BAL   RET,PCR20000             LINK TO DEQ              YM1353 40700002
         LA    R0,K22                   LOAD ERROR CODE          YM1353 40750002
         B     PCR09000                 BRANCH, ISSUE ERROR MSG  YM1353 40800002
*                                                                Y02134 56850002
*****************************************************************Y02134 56900002
*                                                                Y02134 56950002
*        CHECK THAT THE MODE INDICATOR IN PASSWORD RECORD        Y02134 56960002
*        CORRESPONDS TO MODE OF USE OF THE DATA SET              Y02134 56970002
*                                                                Y02134 56980002
*****************************************************************Y02134 56990002
*                                                                Y02134 56992002
PCR01200 EQU   *                        TEST FOR PROPER MODE     YM1353 56992402
*                                                                YM1353 56992802
         TM    MYMODE,K1                IS MODE READ AND WRITE   Y02134 56996002
         BO    PCR02000                 BRANCH IF FULL ACCESS    Y02134 56998002
*                                                                Y02134 56998402
OUTPUT   EQU   X'0E'                    NOT INPUT OR RDBACK      Y02134 56998802
         TM    MYDEBSYS,OUTPUT          OPEN FOR INPUT OR RDBACK Y02134 56999202
         BZ    PCR02000                 BRANCH CONSISTENT MODE   YM1353 56999602
*                                                                YM1353 57049602
*****************************************************************YM1353 57059602
*                                                                YM1353 57069602
*        DEQ DSNAME FOR ERROR PROCESSING                         YM1353 57079602
*                                                                YM1353 57089602
*****************************************************************YM1353 57091602
*                                                                YM1353 57093602
         BAL   RET,PCR20000             LINK TO DEQ              YM1353 57095602
         LA    R0,K22                   LOAD ERROR CODE          YM1353 57097602
         B     PCR09100                 BRANCH, ISSUE ERROR MSG  YM1353 57098002
         EJECT                                                          57099602
*                                                                       61400021
*********************************************************************** 61600021
*                                                                       61800021
*        UPDATE PASSWORD USE COUNT AND WRITE BACK THE RECORD     Y02134 62000002
*                                                                       62400021
*****************************************************************Y02134 62450002
*                                                                Y02134 62500002
PCR02000 EQU   *                        UPDATE RECORD            Y02134 62600002
*                                                                Y02134 62650002
         LA    R1,K1                    GET INCREMENTING FACTOR  Y02134 62800002
         AH    R1,MYCNTR                INCREMENT USE CNT BY ONE Y02134 63000002
         STH   R1,MYCNTR                STORE IT BACK            Y02134 63200002
*                                                                       63400021
         XC    MYCCW,MYCCW              CLEAR CHANNEL PROG AREA  Y02134 63450002
         LA    R1,MYDAADDR+K3           SEARCH ID ADDR           Y02134 63500002
         ST    R1,DXCCW1                                         Y02134 63550002
         LA    R1,DXCCW1                TIC *-8                  Y02134 63600002
         ST    R1,DXCCW2                                         Y02134 63650002
         LA    R1,MYLOGFLD              POINT TO UPDATE RECORD   Y02134 64000002
         ST    R1,DXCCW3                STORE UPDATED RECORD PTR Y02134 64050002
         OC    DXCCW1(K3*K8),PCRCCW02   CMDS, FLAGS, LENGTHS     Y02134 64200002
*                                                                       64400021
*****************************************************************Y02134 64450002
*                                                                Y02134 64500002
*        WRITE THE UPDATED PASSWORD ENTRY BACK                          64600021
*                                                                       64800021
*****************************************************************Y02134 64850002
*                                                                Y02134 64900002
         EXCP  MYIOB                    WRITE BACK DATA          Y02134 65000002
*                                                                       65200021
         WAIT  ECB=DXECB                WAIT FOR I/O TO COMPLETE Y02134 65400002
*                                                                YM1353 65410002
         BAL   RET,PCR20000             LINK TO DEQ              YM1353 65450002
*                                                                YM1353 65500002
         NI    DCBIFLGS-IHADCB+MYDCB,ALLBITS-DCBIFPIO CLEAR ERR  YM8526 65550002
         LA    R0,K22                   LOAD ERROR CODE          Y02134 66580002
         TM    MYECB,ECBNOERR           TEST IF I/O ERROR        Y02134 66600002
         BZ    PCR09500                 BR IF YES                Y02134 66800002
         EJECT                                                          66850002
*                                                                       67000021
*********************************************************************** 67200021
*                                                                       67400021
*        UPDATE THE TTR OF THE PASSWORD RECORD IN THE DSAB       Y02134 67600002
*                                                                       68000021
*        CONVERT MBBCCHHR DISK ADDRESS TO TTR                           78400021
*                                                                       78600021
*****************************************************************Y02134 78650002
*                                                                Y02134 78700002
         STM   R1,RF,MYPREFIX           SAVE REGS                Y02134 79000002
         L     RF,CVTPTR                GET CVT ADDR                    79200021
         LA    R1,MYDEB                 POINT TO SECURITY WORK DEB      79400021
         LA    R2,MYDAADDR              POINT TO MBBCCHHR FIELD  Y02134 79600002
         L     RF,CVTPRLTV-CVT(,RF)     GET ADDR OF IECPRLTV ROUTINE    79800021
         BALR  RET,RF                   BR TO CONVERT MBBCCHHR TO TTR   80000021
*                                                                Y02134 80050002
         L     RD,WTGPREFX              LOAD PREFIX POINTER      Y02134 80100002
         LA    RD,IECSTART-IECPREFX(,RD) POINT TO EXT PREFIX     Y02134 80150002
         LM    R1,RF,MYPREFIX           RESTORE REGS             Y02134 80200002
*                                                                Y02134 80250002
         L     R1,MYDSAB                LOAD DSAB ADDRESS        Y02134 80300002
*                                                                Y02134 80350002
         MODESET EXTKEY=SCHED           SCHEDULER KEY            Y02134 80400002
*                                                                Y02134 80450002
         ST    R0,DSABPTTR-DSAB(,R1)    PUT PSWD TTR IN DSAB     Y02080 80600002
*                                                                Y02134 80610002
         MODESET EXTKEY=DATAMGT         RESET TO DM KEY          Y02134 80620002
*                                                                Y02134 80630002
         B     PCR09950                 RETURN TO CALLER         Y02134 80650002
         EJECT                                                          81150002
*                                                                       81200021
*********************************************************************** 81400021
*                                                                       81600021
*        INVALID PASSWORD                                        Y02134 81800002
*                                                                Y02134 82000002
*****************************************************************Y02134 82050002
*                                                                       82200021
PCR09000 EQU   *                        INVALID PASSWORD MSG     Y02134 82400002
*                                                                       83000021
         CLI   MYCODE2,K0               CHECK IF USER ERROR    @ZA02896 83050000
         BE    PCR09900                 BRANCH IF NOT USER ERR @ZA02896 83100000
*                                                                       83150000
         LA    R1,PCRMSG01              INVALID PASSWORD         Y02134 83200002
         BAL   RET,PCR10000             LINK TO ISSUE MESSAGE    Y02134 83250002
         B     PCR09900                 BRANCH TO READPSWD       Y02134 83300002
*                                                                Y02134 83350002
*****************************************************************Y02134 83400002
*                                                                Y02134 83450002
*        PASSWORD=READ ONLY AND OUTPUT REQUESTED                 Y02134 83500002
*                                                                Y02134 83550002
*****************************************************************Y02134 83600002
*                                                                Y02134 83650002
PCR09100 EQU   *                        INCORRECT MODE MSG       Y02134 83700002
*                                                                Y02134 83750002
         CLI   MYCODE2,K0               CHECK IF USER ERROR    @ZA02896 83760000
         BE    PCR09900                 BRANCH IF NOT USER ERR @ZA02896 83770000
*                                                                       83780000
         LA    R1,PCRMSG02              PASSWORD=READ ONLY       Y02134 83800002
         BAL   RET,PCR10000             LINK TO ISSUE MESSAGE    Y02134 83850002
         B     PCR09900                 BRANCH TO READPSWD       Y02134 83900002
*                                                                Y02134 83950002
*****************************************************************Y02134 84000002
*                                                                Y02134 84050002
*        I/O ERROR ACCESSING PASSWORD DATA SET                   Y02134 84100002
*                                                                Y02134 84150002
*****************************************************************Y02134 84200002
*                                                                Y02134 84250002
PCR09500 EQU   *                        I/O ERROR MSG            Y02134 84300002
*                                                                Y02134 84350002
         LA    R1,PCRMSG01              INVALID PASSWORD/I/O ERR Y02134 84400002
         BAL   RET,PCR10000             LINK TO ISSUE MESSAGE    Y02134 84450002
         B     PCR09950                 BRANCH TO RETURN ERROR   Y02134 84500002
         EJECT                                                          84560002
*                                                                Y02134 84570002
*****************************************************************Y02134 84580002
*                                                                Y02134 84590002
*        GIVE OPERATOR TWO TRIES BEFORE RETURNING ERROR          Y02134 84592002
*                                                                Y02134 84594002
*****************************************************************Y02134 84596002
*                                                                Y02134 84598002
PCR09900 EQU   *                        CHECK TRY COUNT          Y02134 84598402
*                                                                Y02134 84598802
         CLI   MYCODE2,K2               ALREADY TWO TRIES        Y02134 84599202
         BE    PCR09940                 BRANCH IF ALREADY TWO    Y02134 84599602
*                                                                Y02134 84624802
         IECRES LOAD,MODNM=READPSWD,BRCODE=K0,                   Y02134X84634802
               PREFIX=WTGPREFX,BRANCH=DIRECT                     Y02134 84644802
*                                                                Y02134 84646802
PCR09940 EQU   *                        RETURN ERROR CODE        Y02134 84648802
*                                                                Y02134 84648902
         STC   R0,MYERRCOD              STORE ERROR CODE         Y02134 84649002
*                                                                Y02134 84649202
*****************************************************************Y02134 84650002
*                                                                Y02134 84700002
*        RETURN TO CALLER                                        Y02134 84750002
*                                                                Y02134 84800002
*****************************************************************Y02134 84850002
*                                                                Y02134 84900002
PCR09950 EQU   *                        RETURN                   Y02134 84910002
*                                                                Y02134 84920002
         XR    RET,RET                  CLEAR RETURN OFFSET      Y02134 84950002
         IC    RET,MYRETCOD             GET RETURN OFFSET        Y02134 85000002
*                                                                Y02134 85050002
         IECRES LOAD,MODNM=MYRETMOD,BRCODE=(14),                 Y02134X85100002
               PREFIX=WTGPREFX,BRANCH=DIRECT                     Y02134 85150002
         EJECT                                                          85200002
*                                                                Y02134 85250002
*****************************************************************Y02134 85300002
*                                                                Y02134 85350002
*        SEND MESSAGE TO TSO TERMINAL ONLY                       Y02134 85700002
*                                                                Y02134 85750002
*****************************************************************Y02134 85760002
*                                                                Y02134 85770002
PCR10000 EQU   *                        MESSAGE SUBROUTINE       Y02134 85772002
*                                                                Y02134 85774002
         STM   R0,RF,MYPREFIX           SAVE REGS                Y02134 85776002
*                                                                Y02134 85778002
         L     RF,MYASCB                LOAD CURRENT ASCB ADDR   Y02134 85784002
         L     RF,ASCBTSB-ASCB(,RF)     LOAD TSB ADDRESS         Y02134 85794002
         LTR   RF,RF                    TEST FOR TERMINAL TASK   Y02134 85796002
         BZ    PCR12000                 BRANCH IF NOT            Y02134 85798002
*                                                                Y02134 85798402
         LH    RC,K0(R1)                GET LENGTH OF MESSAGE    Y02134 85798802
         STCM  RC,B'0011',MYMCSFLG      SAVE LENGTH              Y02134 85799202
         BCTR  RC,R0                    DECREMENT FOR EX INST    Y02134 85799402
         EX    RC,MOVE                  MVC  MYMIEC(0),2(1)      Y02134 85799502
         LA    R1,MYMIEC                POINT TO TSO MSG         Y02134 85799602
*                                                                Y02134 85799702
         L     RF,MYJSCB                GET JSCB ADDRESS         Y02134 85799802
         MVC   MYMSIZE(L'JSCBTJID),JSCBTJID-IEZJSCB(RF) ID       Y02134 85807902
         L     RF,JSCBPSCB-IEZJSCB(,RF) GET THE PSCB ADDRESS     Y02134 85809902
         LTR   RF,RF                    PSCB INITIALIZED         Y02134 85811902
         BZ    PCR11000                 DEFAULT TPUT W/MSG ID    Y02134 85813902
*                                                                Y02134 85815902
         L     RF,PSCBUPT-PSCB(,RF)     GET UPT ADDRESS          Y02134 85816302
         MODESET EXTKEY=ZERO            SWITCH TO KEY ZERO       YM6725 85816402
         TM    UPTSWS-UPT(RF),UPTMID    IS MESSAGE ID REQUIRED   Y02134 85816502
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    YM6725 85816602
         BO    PCR11000                 BRANCH IF REQUIRED       Y02134 85816702
*                                                                Y02134 85816802
         LH    RC,MYMCSFLG              LOAD MESSAGE LENGTH      Y02134 85822702
         LA    R0,L'MYMIEC              LOAD ID LENGTH           Y02134 85823102
         SR    RC,R0                    GET NEW MESSAGE LENGTH   Y02134 85823502
         STCM  RC,B'0011',MYMCSFLG      SAVE LENGTH              Y02134 85824702
         LA    R1,MYMNOID               POINT PASSED MSG ID      Y02134 85826702
*                                                                Y02134 85828702
PCR11000 EQU   *                        ISSUE MESSAGE            Y02134 85829102
*                                                                Y02134 85829202
         ICM   R0,B'1111',MYMSIZE       LOAD ID AND LENGTH       Y02134 85829302
         TPUT  (1),(0),R                SEND MSG TO TERMINAL     Y02134 85830602
*                                                                Y02134 85832602
PCR12000 EQU   *                        RETURN                   Y02134 85833202
*                                                                Y02134 85835902
         LM    R0,RF,MYPREFIX           RESTORE REGISTERS        Y02134 85836302
         BR    RET                      RETURN                   Y02134 85837902
MOVE     MVC   MYMIEC(K0),K2(R1)        MOVE MESSAGE TO BUFFER   Y02134 85838302
         EJECT                                                          85838702
*                                                                YM1353 85839102
*****************************************************************YM1353 85839502
*                                                                YM1353 85839602
*        DEQ PASSWORD ENTRY                                      YM1353 85839702
*                                                                YM1353 85839802
*****************************************************************YM1353 85889802
*                                                                YM1353 85899802
PCR20000 EQU   *                        DEQ SUBROUTINE           YM1353 85901802
*                                                                YM1353 85903802
         TM    WTGPATHS,X01             TEST SCRATCH/RENAME      YM1353 85909802
         BCR   K1,RET                   BRANCH TO BYPASS DEQ     YM1353 85919802
*                                                                YM1353 85929802
         DEQ   MF=(E,MYENQSW1)          DEQ PREVIOUS ENQ ON DSN  YM1353 85931802
*                                                                YM1353 85933802
         L     R1,IECRRPRM-IECEXTPR(,RD) LOAD RECOVERY PARM LIST YM1353 85935802
         NI    RRFLAGS2-RRPLIST(R1),ALLBITS-RRFENQPW ENQ IND OFF YM1353 85937802
*                                                                YM1353 85938202
         BR    RET                      RETURN                   YM1353 85938602
*                                                                YM1353 85939002
         EJECT                                                          85939802
*                                                                       86000021
*********************************************************************** 86200021
*                                                                       86400021
*        CONSTANTS                                                      86600021
*                                                                       86800021
*****************************************************************Y02134 86850002
*                                                                Y02134 86900002
*        CCWS TO SEARCH PASSWORD DATA SET FOR PASSWORD RECORD    Y02134 87000002
*                                                                Y02134 87250002
PCRCCW01 CCW   CCWSCHID,K0,CCWCMDCH,K5  SEARCH ID EQUAL          Y02134 87400002
         CCW   CCWTIC,K0,K0,K0          TIC *-8                  Y02134 87600002
         CCW   CCWMTRDC,K0,CCWCMDCH,K8  READ COUNT  MT           Y02134 87800002
         CCW   CCWSCHKE,K0,CCWCMDCH,L'MYDSN+L'MYREPLY SCH KEY EQ Y02134 88000002
         CCW   CCWTIC,K0,K0,K0          TIC *-16                 Y02134 88050002
         CCW   CCWRDDA,K0,CCWSILI,L'MYLOGFLD READ DATA           Y02134 88400002
*                                                                Y02134 88450002
*        CCWS TO UPDATE THE PASSWORD RECORD IN PASSWORD DATA SET Y02134 88500002
*                                                                Y02134 88550002
PCRCCW02 CCW   CCWSCHID,K0,CCWCMDCH,K5  SEARCH ID EQUAL          Y02134 88560002
         CCW   CCWTIC,K0,K0,K0          TIC *-8                  Y02134 88570002
         CCW   CCWWRTDA,K0,CCWSILI,L'MYLOGFLD WRITE DATA-UPDATE  Y02134 88580002
*                                                                       88600021
ENQLIST  ENQ   (SYSZPSWD,,E,L'JFCBDSNM,SYSTEM),MF=L              Y02134 88650002
SYSZPSWD DC    C'SYSZPSWD'              MAJOR ENQ/DEQ NAME       Y02134 88700002
*                                                                Y02134 88750002
PCRMSG01 DC    AL2(PCRMSG1E-*-2)        LENGTH OF MESSAGE 1      Y02134 89600002
OSQ2870K DC    C'IEC117I DATA SET CANNOT BE USED - PASSWORD INVALID' H  90000002
PCRMSG1E EQU   *                        END OF MESSAGE 1         Y02134 90050002
PCRMSG02 DC    AL2(PCRMSG2E-*-2)        LENGTH OF MESSAGE 2      Y02134 90100002
OSQ2880K DC    C'IEC118I READ ONLY DATA SET CANNOT BE OPENED FOR OUTPUTX90200021
               '                                                        90400021
PCRMSG2E EQU   *                        END OF MESSAGE 2         Y02134 90450002
*                                                                       90600021
         XCTLTABL ID=(,READPSWD),BRT=YES,LENGTH=                 Y02080 90800002
*                                                                       91000021
         IECDSECS CVT,ASCB,TCB,JSCB,PSCB,UPT,UCB,DSAB,           Y02134X91050002
               DCB,DEB,MAIN,SECCORE,WTG,PREFX,RRPL,EXPAND=YES    Y02134 91100002
         IECEQU ,                       DEFINE EQUATES                  91150002
         END                                                            91600021
