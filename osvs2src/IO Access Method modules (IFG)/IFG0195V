         TITLE 'IFG0195V                      TSO AUTOMATIC SECURITY PAS00200002
               SSWORD'                                           Y02134 00400002
IFG0195V CSECT                                                          01000021
*********************************************************************** 01050002
*                                                                     * 01100002
*             VS2 RELEASE 037 DELETIONS/CHANGES                       * 01110037
*0000743000                                                    @ZA10842 01120037
*                                                                     * 01130037
*                                                                     * 01140037
* MODULE NAME = IFG0195V (OS/VS2)                                     * 01150002
*                                                                     * 01160002
* DESCRIPTIVE NAME = TSO AUTOMATIC SECURITY PASSWORD ROUTINE          * 01170002
*                                                                     * 01180002
* COPYRIGHT = NONE                                                    * 01190002
*                                                                     * 01192002
* STATUS = RELEASE 2, LEVEL 0                                         * 01194002
*                                                                     * 01196002
* FUNCTION =                                                          * 01198002
*                                                                     * 01200702
*        1. SETS UP CONTROL BLOCKS IN THE SECURITY WORK AREA          * 01202702
*           TO DO I/O TO THE PASSWORD DATA SET ON SYSRES.             * 01227802
*                                                                     * 01228102
*        2. IF THE DSCB POINTED BY INPUT REGISTER 4 INDICATES         * 01228402
*           DSORG=VSAM, CONTROL IS PASSED TO IDA0192G.                * 01228702
*                                                                     * 01229002
*        3. F4 DSCB OF SYSRES IS OBTAINED TO READ F1 OF THE           * 01229302
*           PASSWORD DATA SET WITH THE PROPER EXTENTS FOR THE VTOC.   * 01229602
*                                                                     * 01230002
*        4. THE F1 DSCB OF THE PASSWORD DATA SET IS READ TO GET       * 01230102
*           THE PROPER EXTENTS FOR READING THE PASSWORD DATA SET.     * 01230602
*                                                                     * 01231102
*        5. THE INPUT DSAB IS INSPECTED TO DETERMINE IF A TTR FOR     * 01231502
*           THE PASSWORD RECORD EXISTS, INDICATING THAT THE PASSWORD  * 01231802
*           WAS PREVIOUSLY REQUESTED. IF THE TTR EXISTS, THE          * 01232902
*           PASSWORD RECORD IS READ, THE DSNAME IS COMPARED TO THE    * 01233302
*           INPUT DSNAME AND THE PROCESSING MODE IS CHECKED.          * 01233602
*           IF THE PASSWORD RECORD SATISFIES THE REQUEST, CONTROL     * 01233702
*           IS PASSED TO IFG0195U TO UPDATE THE PASSWORD RECORD.      * 01233802
*                                                                     * 01234002
*        6. IF THE TTR IS NOT PRESENT OR IF THE PASSWORD RECORD       * 01234402
*           TESTS FAIL, THE MASTER LOGON PASSWORD IN THE TSB IS       * 01234502
*           MOVED TO THE PASSWORD AREA TO BE USED IN IFG0195U         * 01234902
*           TO SEARCH THE PASSWORD DATA SET.                          * 01235002
*                                                                     * 01237502
*        7. IF NO MASTER LOGON PASSWORD EXISTS, CONTROL PASSES        * 01240202
*           TO READPSWD TO GET A PASSWORD.                            * 01242902
*                                                                     * 01245602
* NOTES = ALL SEARCHES TO THE PASSWORD DATA SET ARE PROTECTED VIA ENQ.* 01248302
*                                                                     * 01251002
*    DEPENDENCIES =                                                   * 01253702
*                                                                     * 01255402
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 01256402
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 01259102
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 01261802
*                                                                     * 01264502
*    RESTRICTIONS = NONE                                              * 01267202
*                                                                     * 01269902
*    REGISTER CONVENTIONS = SEE IECEQU MACRO.                         * 01279902
*                                                                     * 01299502
*    PATCH LABEL = SEE XCTLTABL MACRO.                                * 01299602
*                                                                     * 01299802
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 01333202
*                                                                     * 01343202
*    PROCESSOR = ASSEMBLER XF                                         * 01353202
*                                                                     * 01363202
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 01365202
*                  ORG STATEMENT AT END OF LISTING                    * 01365602
*                                                                     * 01366002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 01366402
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 01366502
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 01377602
*                                                                     * 01387602
* ENTRY POINT = IFG0195V FROM IFG0195T OR SECLOADA.                   * 01388002
*                                                                     * 01388402
*    PURPOSE = TO BYPASS REQUESTING A PASSWORD IF IT HAS ALREADY      * 01388802
*              BEEN REQUESTED OR IF A MASTER LOGON PASSWORD           * 01390802
*              IS AVAILABLE.                                          * 01391202
*                                                                     * 01392502
*    LINKAGE =                                                        * 01394502
*        IECRES LOAD,MODNM=IFG0195V,PREFIX=WTGPREFX,BRANCH=DIRECT     * 01394902
*                                                                     * 01395102
* INPUT = AS FOLLOWS -                                                * 01395302
*                                                                     * 01395402
*        R4 = ADDRESSABILITY TO FORCORE-LIKE WORK AREA.               * 01395502
*        R6 = ADDRESSABILITY TO WTG TABLE.                            * 01395602
*        RD = ADDRESSABILITY TO SECCORE WORK AREA                     * 01397602
*                                                                     * 01399602
* OUTPUT = FINISH WORK AREA INITIALIZATION.                           * 01401602
*                                                                     * 01402002
*        PASSWORD RECORD READ IF TTR IN DSAB.                         * 01402402
*        PASSWORD IN WORK AREA IF MASTER LOGON PASSWORD PRESENT.      * 01402802
*                                                                     * 01403602
* EXIT-NORMAL = IFG0195T - GOOD RETURN FROM VSAM.                     * 01409602
*               IFG0195U - READ OR UPDATE PASSWORD RECORD.            * 01411602
*               READPSWD - GET PASSWORD FROM OPERATOR OR TERMINAL.    * 01413602
*               SECLOADA - GOOD RETURN FROM VSAM.                     * 01415602
*                                                                     * 01419602
* EXIT-ERROR =  IFG0195U TO ISSUE ERROR MESSAGE.                      * 01429602
*                                                                     * 01431602
* EXTERNAL REFERENCES = SEE BELOW                                     * 01433602
*                                                                     * 01435602
*    ROUTINES = IDA0192G,IFG0195U,READPSWD.                           * 01436002
*                                                                     * 01436402
*    DATA AREAS = IECDSECS SECCORE,MAIN,WTG,PREFX,RRPL                * 01436502
*                                                                     * 01441002
*    CONTROL BLOCK = CVT,ASCB,TCB,JSCB,TSB,DSAB,UCB,DSCB4,ACB,DCB.    * 01443002
*                                                                     * 01445002
* TABLES = SEE XCTLTABL MACRO.                                        * 01445402
*                                                                     * 01459002
* MACROS = IECRES,EXCP,WAIT,ENQ,DEQ,XCTLTABL,IECDSECS,IECEQU.         * 01469002
*                                                                     * 01479002
* CHANGE ACTIVITY = NEW RELEASE (LEVEL 0)                             * 01481002
*        VS2 RELEASE 03 DELETIONS/CHANGES                             * 01481402
*0000742000                                                     ZA00111 01481802
*                                                                     * 01483002
*********************************************************************** 01485002
         EJECT                                                          28800021
*                                                                       30000021
         USING FORCORE,RCORE            DEFINE BASE TO MAIN WORK AREA   30200021
         USING WTG,RWTG                 DEFINE BASE TO XCTL/WTG TABLE   30400021
         USING SECCORE,RD               DEFINE BASE TO SECURITY WK AREA 30600021
*                                                                       30800021
         BALR  RBASE,R0                 ESTABLISH BASE REGISTER         31000002
         USING *,RBASE                  DEFINE BASE REGISTER            31200021
         EJECT                                                          31250002
*                                                                Y02134 31498302
*****************************************************************Y02134 31498402
*                                                                Y02134 31498702
*        SET UP CONTROL BLOCK POINTERS FOR I/O OPERATIONS        Y02134 31499102
*                                                                Y02134 31499502
*****************************************************************Y02134 31499602
*                                                                Y02134 31506302
         L     RC,CVTPTR                GET CVT ADDR             Y02134 31543202
         L     RF,CVTZDTAB-CVT(,RC)     GET ADDR I/O DEVICE TBL  Y02134 31553202
         L     RET,CVTSYSAD-CVT(,RC)    GET ADDR OF SYSRES UCB   Y02134 31563202
         ST    RET,MYDEBUCB             SAVE SYSRES UCBAD        Y02134 31564202
         L     R1,CVTSVDCB-CVT(,RC)     GET ADDR OF SVCLIB DCB   Y02134 31565202
         L     R1,DCBDEBAD-IHADCB(,R1)  GET ADDR OF SVCLIB DEB   Y02134 31565602
         L     R0,MYDEBSYS              SAVE ATTRIBUTES          Y02134 31565702
         MVC   MYDEBDEB(K32),K4(R1)     COPY SVCLIB DEB          Y02134 31566002
         MVC   MYDEBAPP,CVTXAPG-CVT(RC) DUMMY APP VECTOR TABLE   Y02134 31566102
         MVI   MYDEBMOD,K0              SET FILE MASK TO ZERO    YM6841 31566202
         MVI   MYDEBUSR,K1              DEFINE DEB AS 1 EXTENT   Y02134 31566402
         STCM  R0,B'1000',MYDEBSYS      RESTORE ATTRIBUTES       Y02134 31566502
*                                                                Y02134 31566602
         XC    MYDEBSCC(K4),MYDEBSCC    SET EXTENT TO COVER DISK Y02134 31577602
*                                                                Y02134 31587602
         SR    R1,R1                    CLEAR REG FOR IC         Y02134 31588002
         IC    R1,UCBTBYT4-UCB(,RET)    GET UCB DEVICE TYPE      Y02134 31588402
         IC    R1,K0(R1,RF)             INDEX TO DEVICE OFFSET   Y02134 31588802
         AR    RF,R1                    ADDR OF DEVICE ENTRY     Y02134 31592502
         MVC   MYDEBECC(K4),K0(RF)      DEVICE TABLE MAX EXTENT  Y02134 31594502
*                                                                Y02134 31594902
         MVC   MYDEBNTR,TASTRK          SET TRACKS TO MAXIMUM    Y02134 31595302
*                                                                Y02134 31595702
         LA    R1,MYDCB                 POINT TO DCB             Y02134 31595802
         ST    R1,IOBDCBPT-K1           SAVE DCB IN IOB          Y02134 31595902
         ST    R1,MYDEBDCB              SAVE DCB IN DEB          Y02134 31596102
*                                                                Y02134 31596702
         LA    R1,MYECB                 LOAD ECB POINTER         Y02134 31603702
         ST    R1,IOBECBPT              SAVE ECB POINTER         Y02134 31605702
*                                                                Y02134 31607702
         LA    R1,MYDEB                 LOAD DEB POINTER         Y02134 31611202
         ST    R1,MYDCBDEB              SAVE DEB ADDRESS         Y02134 31618202
*                                                                Y02134 31625202
         MVI   MYDEBMOD,K0              FILE MASK TO ALLOW SEEKS Y02134 31632202
         MVI   MYDEBID,DEBIDENT         DEB ID                   Y02134 31666202
*                                                                Y02134 31676202
         LA    RF,MYCCW                 CCW START ADDRESS        Y02134 31686202
         ST    RF,IOBSIOCC              TO SECURITY IOB          Y02134 31688202
*                                                                Y02134 31688302
         L     R1,CVTPTR                LOAD CVT ADDRESS         Y02134 31688702
         L     R1,CVTTCBP-CVT(,R1)      LOAD TCB/ASCB PTRS       Y02134 31688802
         MVC   MYASCB,K12(R1)           GET CURRENT ASCB         Y02134 31688902
         EJECT                                                          31689002
*                                                                Y02134 31689102
*****************************************************************Y02134 31689202
*                                                                X02989 31689302
*        IF THE FORMAT 1 DSCB INDICATES A VSAM DATA SPACE,       X02989 31689402
*        BRANCH TO THE THE VSAM SECURITY INTERFACE MODULE        X02989 31689502
*        TO VERIFY SECURITY FOR THE DATA SPACE.                  X02989 31689802
*                                                                X02989 31690602
*****************************************************************Y02134 31690802
*                                                                Y02134 31690902
         CLI   MYDSCB,CHAR1             CHECK FOR DA             Y02134 31691002
         BNE   TAS03000                 BRANCH IF NOT F1         Y02134 31691102
         TM    DSCFILTY+K1,ACBDORGA     IS DATA SET VSAM         YM1389 31691402
         BNO   TAS03000                 BRANCH IF NO             X02989 31691502
*                                                                Y02134 31691602
         LA    RB,MYDSN                 LOAD POINTER TO DSNAME   Y02134 31691702
*                                                                Y02134 31692002
         IECRES LOAD,MODNM=IDA0192G,BRCODE=TAS02000,             Y02134X31692402
               PREFIX=WTGPREFX,BRANCH=DIRECT                     Y02134 31692802
*                                                                Y02134 31693102
TAS02000 EQU   *                        RETURN FROM VSAM         Y02134 31693502
*                                                                Y02134 31693602
         LTR   RF,RF                    TEST RETURN CODE         XM0856 31693702
         BZ    TAS10000                 BR IF SUCCESSFUL         X02989 31693802
         LA    R0,K22                   LOAD VSAM ERROR CODE     Y02134 31693902
         B     TAS09000                 SECURITY FAILED          X02989 31694202
         EJECT                                                          31694302
*                                                                Y02134 31694402
*****************************************************************Y02134 31694502
*                                                                Y02134 31694702
*        GET VTOC ADDRESS FROM SYSRES UCB FOR READING FORMAT 4   Y02082 31694802
*        DSCB IN ORDER TO DETERMINE THE HIGHEST RECORD IN THE    Y02082 31694902
*        VTOC                                                    Y02082 31695002
*                                                                Y02134 31695102
*        CONVERT TTR TO MBBCCHHR FORM                            Y02134 31695402
*                                                                Y02134 31695802
*****************************************************************Y02134 31699202
*                                                                Y02134 31701202
TAS03000 EQU   *                        GO CONVERT TTR           Y02134 31701602
*                                                                Y02134 31702002
         L     RUCB,MYDEBUCB            GET ADDR OF SYSRES UCB   Y02134 31702902
         USING UCBOB,RUCB               POINTS TO SYSRES UCB     Y02134 31703002
*                                                                Y02134 31703302
         STM   R0,RF,MYPREFIX           SAVE REGS                Y02134 31703702
*                                                                Y02134 31704102
         XR    R0,R0                    CLEAR REG FOR ICM INST   Y02134 31704902
         ICM   R0,B'1110',UCBVTOC       GET VTOC TTRN FROM UCB   Y02134 31706202
*                                                                Y02134 31712802
         LA    R1,MYDEB                 WORK AREA DEB            Y02134 31722802
         LA    R2,MYDAADDR              MBBCCHHR RESULT FIELD    Y02134 31728802
         L     RF,CVTPTR                GET CVT ADDR             Y02134 31729202
         L     RF,CVTPCNVT-CVT(,RF)     ADDR OF IECPCNVT ROUTINE Y02134 31729302
         BALR  RET,RF                   CONVERT TTR TO MBBCCHHR  Y02134 31729402
*                                                                Y02134 31735002
         L     RD,WTGPREFX              LOAD PREFIX POINTER      Y02134 31735402
         LA    RD,IECSTART-IECPREFX(,RD) POINT TO EXT PREFIX     Y02134 31735802
         LM    R0,RF,MYPREFIX           RESTORE REGISTERS        Y02134 31737002
         EJECT                                                          31737402
*                                                                Y02134 31739002
*****************************************************************Y02134 31739102
*                                                                Y02134 31739202
*        CONSTRUCT CHANNEL PROGRAM TO READ FORMAT 4 DSCB         Y02082 31739402
*                                                                Y02082 31739802
*        SEARCH ID EQUAL                                         Y02082 31740202
*        TIC *-8                                                 Y02082 31740302
*        SEARCH KEY EQUAL (4 BYTES - SLI BIT ON)                 Y02082 31740402
*        NOP (COUNT 1, SLI BIT ON)                               Y02082 31740502
*        READ DATA (80 BYTES - SLI BIT ON)                       Y02082 31755302
*                                                                Y02082 31765302
*****************************************************************Y02134 31765702
*                                                                Y02134 31766102
         XC    MYCCW,MYCCW              CLEAR CCW AREA           Y02134 31767302
         LA    RF,MYDAADDR+K3           SEARCH ADDR              Y02082 31769302
         ST    RF,DXCCW1                                         Y02082 31769702
         LA    RF,DXCCW1                TIC *-8                  Y02082 31770102
         ST    RF,DXCCW2                                         Y02082 31770202
         LA    RF,MYDSCB                GET F4 READ AREA ADDRESS Y02134 31770302
         MVC   MYDSCB(L'F4KEY),F4KEY    MOVE F4 KEY TO WORK AREA Y02134 31772302
         ST    RF,DXCCW3                SEARCH KEY               Y02082 31775202
         ST    RF,DXCCW5                READ DATA                Y02082 31777202
         OC    DXCCW1(K5*K8),TASCCW01   OR IN CMD, FLGS, LENGTHS Y02082 31779202
*                                                                Y02134 31779602
         EXCP  MYIOB                    READ FORMAT 4            Y02082 31780002
*                                                                Y02134 31780102
         WAIT  ECB=MYECB                WAIT FOR COMPLETION      Y02082 31780202
*                                                                Y02134 31781402
         NI    DCBIFLGS-IHADCB+MYDCB,ALLBITS-DCBIFPIO CLEAR ERR  YM8526 31781802
         LA    R0,K21                   PASSWORD I/O ERROR CODE  Y02134 31783402
         TM    MYECB,ECBNOERR           I/O ERROR                Y02082 31784002
         BZ    TAS09000                 BR IF I/O ERROR          Y02082 31785202
         CLI   MYDSCB,CHAR4             FORMAT 4 READ            Y02082 31787102
         BNE   TAS09000                 BRANCH IF NOT            Y02082 31789102
         EJECT                                                          31789202
*                                                                Y02082 31789502
*****************************************************************Y02134 31789602
*                                                                Y02134 31789702
*        CONSTRUCT CHANNEL PROGRAM TO READ F1 DSCB               Y02134 31789902
*        OF THE PASSWORD DATA SET.                               Y02134 31790002
*                                                                Y02082 31790102
*****************************************************************Y02134 31810002
*                                                                Y02134 31820002
*DXCCW1  SEARCH ID EQUAL                                         Y02082 31832002
*DXCCW2  TIC *-8                                                 Y02082 31842002
*DXCCW3  SEARCH ID EQ MULTI-TRACK (CCHHR OF LAST RECORD IN VTOC) Y02082 31872002
*DXCCW4  TIC DXCCW8                                              Y02082 31874002
*DXCCW5  SEARCH KEY EQ (PASSWORD DATA SET NAME)                  Y02082 31874102
*DXCCW6  NOP (COUNT = 1, SLI BIT ON)                             Y02082 31874202
*DXCCW7  TIC DXCCW10                                             Y02082 31888202
*DXCCW8  SEARCH KEY EQUAL (PASSWORD DATA SET NAME)               Y02082 31898202
*DXCCW9  TIC DXCCW3                                              Y02082 31900202
*DXCCW10 READ DATA (80 BYTES, SLI BIT ON)                        Y02082 31900602
*                                                                Y02082 31901002
*****************************************************************Y02134 31901102
*                                                                Y02134 31901202
         XC    MYCCW,MYCCW              CLEAR CCW AREA           Y02134 31902402
         LA    RF,MYDAADDR+K3           SEARCH ADDR              Y02082 31902802
         ST    RF,DXCCW1                                         Y02082 31903202
         LA    RF,DXCCW1                TIC *-8                  Y02082 31903602
         ST    RF,DXCCW2                                         Y02082 31903702
         LA    RF,DXCCW11               HIGH VTOC ADDR           Y02082 31911202
*                                                                Y02134 31911302
         MVC   DXCCW11(K4),DS4VTOCE+K6-DSCB4(RCORE) HIGH CCHH    Y02134 31911402
         MVC   DXCCW11+K4(K1),DS4DEVDT-DSCB4(RCORE) DSCBS/TRK    Y02134 31912502
*                                                                Y02134 31914502
         ST    RF,DXCCW3                STORE IN CCW             Y02082 31915002
         LA    RF,DXCCW8                TIC ADDR IF SEARCH ID =  Y02082 31916202
         ST    RF,DXCCW4                STORE IN CCW4            Y02082 31923002
         LA    RF,MYSYSDSN              PASSWORD DSN ADDR        Y02082 31933002
*                                                                Y02134 31933102
         MVC   MYSYSDSN(L'PASSWORD),PASSWORD NAME + BLANK        Y02134 31933202
         MVC   MYSYSDSN+L'PASSWORD(L'JFCBDSNM-L'PASSWORD),MYSYSDSN+L'PAS31933302
               SSWORD-K1                PROPAGATE THE BLANK      Y02134 31933502
*                                                                Y02134 31933602
         ST    RF,DXCCW5                STORE IN CCW5            Y02082 31933902
         ST    RF,DXCCW8                STORE IN CCW8            Y02082 31934102
         LA    RF,DXCCW10               TIC ADDR IF SEARCH KEY = Y02082 31934302
         ST    RF,DXCCW7                STORE IN CCW7            Y02082 31934602
         LA    RF,DXCCW3                TIC TO CCW3              Y02134 31934702
         ST    RF,DXCCW9                STORE IN CCW9            Y02134 31935202
         LA    RF,MYDSCB                READ DATA ADDR           Y02082 31937002
         ST    RF,DXCCW10               STORE IN CCW10           Y02082 31937502
         OC    DXCCW1(K10*K8),TASCCW02  OR IN CMDS, FLAGS, LTHS  Y02082 31938702
         EJECT                                                          31939102
*                                                                Y02134 31940702
*****************************************************************Y02134 31940802
*                                                                Y02134 31940902
*        READ FORMAT 1 OF PASSWORD DATA SET                      Y02134 31941102
*                                                                Y02134 31941202
*****************************************************************Y02134 31941502
*                                                                Y02134 31943502
         EXCP  MYIOB                    SEARCH SYSRES VTOC       Y02134 31945802
*                                                                Y02134 31946502
         WAIT  ECB=MYECB                WAIT FOR READ COMPLETE   Y02134 31948402
*                                                                Y02134 31948802
         NI    DCBIFLGS-IHADCB+MYDCB,ALLBITS-DCBIFPIO CLEAR ERR  YM8526 31948902
         LA    R0,K21                   PASSWORD I/O ERROR CODE  Y02134 31949202
         TM    MYECB,ECBNOERR           TEST IF I/O ERROR        Y02134 31950002
         BZ    TAS09000                 BR IF I/O ERROR          Y02082 31950102
*                                                                Y02134 32018502
         LA    R1,DXCCW10+K8            NORMAL ENDING CSW ADDR   Y02082 32046502
         CLM   R1,B'0111',IOBCOMAD+K1   DID CHAN PGM END OK      Y02082 32059502
         BNE   TAS09000                 BRANCH IF NOT            Y02082 32069502
         CLI   MYDSCB,CHAR1             FORMAT 1 READ            Y02082 32071502
         BNE   TAS09000                 BRANCH IF NOT            Y02082 32071902
*                                                                Y02134 32072002
         MVC   MYDEBSCC(K8),DSCLOWLM    PASSWORD EXTENT TO DEB   Y02134 32072102
*                                                                Y02134 32072202
         CLI   DSCEXTYP,X80+X01         TEST FOR CYLINDER EXTENT Y02134 32076502
         BE    TAS04000                 BR IF YES                Y02134 32078502
*                                                                Y02134 32078902
TRACK    EQU   X'18'                    FILE MASK TRACK ALLOCATION      32079302
         MVI   MYDEBMOD,TRACK           INHIBIT HEAD, CYL SEEKS  Y02134 32080502
*                                                                Y02134 32082102
*********************************************************************** 32455002
*                                                                     * 32484002
*        CHECK FOR TTR IN DSAB                                        * 32542002
*                                                                     * 33200021
*********************************************************************** 33400021
*                                                                Y02134 33450002
TAS04000 EQU   *                        PREVIOUS PASSWORD REQ    Y02134 33500002
*                                                                       33600021
         L     R1,MYDSAB                GET PTR TO CURRENT DSAB  Y02080 37450002
         L     R0,DSABPTTR-DSAB(,R1)    GET PSWD RECORD TTR      Y02080 37500002
         LTR   R0,R0                    CHECK FOR TTR EXISTENCE  Y02080 37550002
         BZ    TAS05100                 BR IF NO                 Y02080 37560002
*                                                                Y02134 37610002
         MVC   MYSYSDSN,MYDSN           SAVE DSNAME              Y02134 37660002
         EJECT                                                          37710002
*                                                                       45800021
*********************************************************************** 46000021
*                                                                       46200021
*        CONVERT TTR OF PASSWORD RECORD TO MBBCCHHR              Y02134 46400002
*                                                                       46600021
*****************************************************************Y02134 46650002
*                                                                Y02134 46700002
         STM   R0,RF,MYPREFIX           SAVE REGS                Y02134 46800002
         LA    R1,MYDEB                 POINT TO SECURITY WORK DEB      47000021
         LA    RDCB,MYDAADDR            POINT TO MBBCCHHR RESULT FIELD  47200002
         L     RF,CVTPTR                GET CVT ADDR                    47400021
         L     RF,CVTPCNVT-CVT(,RF)     GET ADDR OF IECPCNVT ROUTINE    47600021
         BALR  RET,RF                   LINK TO CONVERT ROUTINE         47800021
*                                                                Y02134 47810002
         L     RD,WTGPREFX              LOAD PREFIX POINTER      Y02134 47850002
         LA    RD,IECSTART-IECPREFX(,RD) POINT TO EXT PREFIX     Y02134 47900002
         LM    R0,RF,MYPREFIX           RESTORE REGS             Y02134 48000002
*                                                                       48200021
*********************************************************************** 48400021
*                                                                       48600021
*        CONSTRUCT CHANNEL PROGRAM TO READ KEY AND               Y02134 48800002
*        DATA OF RECORD POINTED TO BY DSAB TTR.                  Y02134 49000002
*                                                                       49200021
*        SEARCH ID EQ                                                   49400021
*        TIC *-8                                                        49600021
*        READ KEY+DATA, KEY TO MYDSN + MYREPLY (PASSWORD)        Y02134 49800002
*                                                                       50200021
*****************************************************************Y02134 50250002
*                                                                Y02134 50300002
         XC    MYCCW,MYCCW              CLEAR CCW AREA           Y02134 50350002
         LA    RF,MYDAADDR+K3           SEARCH ADDR              Y02082 50360002
         ST    RF,DXCCW1                                         Y02082 50370002
         LA    RF,DXCCW1                TIC *-8                  Y02082 50380002
         ST    RF,DXCCW2                                         Y02082 50390002
         LA    RF,MYDSN                 READ KEY + DATA ADDR     Y02134 51400002
         ST    RF,DXCCW3                                         Y02134 51600002
         OC    DXCCW1(K3*K8),TASCCW03   OR IN CMND,FLAGS, LENGTH Y02134 52200002
         EJECT                                                          52250002
*                                                                       52400021
*****************************************************************Y02134 52450002
*                                                                Y02134 52500002
*        ESTABLISH ENQ/DEQ LIST IN SECURITY WORK AREA                   52600021
*                                                                       52800021
*****************************************************************Y02134 52850002
*                                                                Y02134 52900002
         TM    WTGPATHS,X01             TEST SCRATCH/RENAME      Y02134 53000002
         BO    TAS04500                 BRANCH TO BYPASS ENQ     Y02134 53050002
*                                                                Y02134 53100002
         CLI   MYCODE1,K1               CHECK FOR EOV            Y02134 53150002
         BE    TAS04500                 BRANCH TO BYPASS ENQ     Y02134 53200002
*                                                                       53400021
         L     R1,IECRRPRM-IECEXTPR(,RD) LOAD RECOVERY PARM LIST Y02134 53450002
         OI    RRFLAGS2-RRPLIST(R1),RRFENQPW PSWD ENQ IND        Y02134 53500002
*                                                                Y02134 53550002
         MVC   MYENQSW1(K12),ENQLIST    ENQ LIST TO WORK AREA    Y02134 53600002
*                                                                       55000021
         ENQ   (,MYSYSDSN),MF=(E,MYENQSW1) ENQ ON DSNAME         Y02134 55200002
*                                                                       55400021
*****************************************************************Y02134 55450002
*                                                                Y02134 55500002
*        READ PASSWORD ENTRY                                            55600021
*                                                                       55800021
*****************************************************************Y02134 55850002
*                                                                Y02134 55900002
TAS04500 EQU   *                        READ WITH DSAB TTR       Y02134 55950002
*                                                                Y02134 56000002
         EXCP  MYIOB                    READ KEY AND DATA OF RCD Y02134 56200002
*                                                                       56400021
         WAIT  ECB=MYECB                WAIT ON READ TO COMPLETE Y02134 56600002
*                                                                       56800021
         XC    MYREPLY,MYREPLY          HIDE PASSWORD BY ZEROING Y02134 57000002
*                                                                       57200021
         NI    DCBIFLGS-IHADCB+MYDCB,ALLBITS-DCBIFPIO CLEAR ERR  YM8526 57250002
         TM    MYECB,ECBNOERR           CHECK FOR I/O ERROR      Y02134 57400002
         BZ    TAS05000                 BR IF YES                Y02134 57600002
*                                                                       57800021
         CLC   MYDSN,MYSYSDSN           ARE DSNAMES SAME         Y02134 58000002
         BNE   TAS05000                 CHECK MASTER PASSWORD    Y02134 58200002
*                                                                Y02134 58440002
*****************************************************************Y02134 58490002
*                                                                Y02134 58540002
*        CHECK THAT THE MODE INDICATOR IN PASSWORD RECORD        Y02134 58590002
*        CORRESPONDS TO MODE OF USE OF THE DATA SET              Y02134 58600002
*                                                                Y02134 58640002
*****************************************************************Y02134 58690002
*                                                                Y02134 58740002
         LA    RET,K4                   LOAD ENTRY OFFSET        Y02134 58790002
         TM    MYMODE,K1                IS MODE READ AND WRITE   Y02134 58890002
         BO    TAS10100                 BRANCH IF FULL ACCESS    Y02134 58940002
*                                                                Y02134 58990002
OUTPUT   EQU   X'0E'                    NOT INPUT OR RDBACK      Y02134 59040002
         TM    MYDEBSYS,OUTPUT          OPEN FOR INPUT OR RDBACK Y02134 59090002
         BZ    TAS10100                 BRANCH CONSISTENT MODE   Y02134 59140002
         EJECT                                                          59240002
*                                                                       69200021
*********************************************************************** 69400021
*                                                                       69600021
*        DEQ UNSUCCESSFUL PASSWORD RECORD                        Y02134 69800002
*                                                                       70000021
*****************************************************************Y02134 70050002
*                                                                Y02134 70100002
TAS05000 EQU   *                        DEQ DATA SET             Y02134 70110002
*                                                                Y02134 70150002
         MVC   MYDSN,MYSYSDSN           RESTORE DSN              Y02134 70152002
         L     R1,MYDSAB                GET POINTER TO DSAB      Y02134 70160002
         MODESET EXTKEY=SCHED           SET TO SCHED KEY         Y02134 70170002
         XC    DSABPTTR-DSAB(L'DSABPTTR,R1),DSABPTTR-DSAB(R1) 0  Y02134 70180002
         MODESET EXTKEY=DATAMGT         RESET TO DM KEY          Y02134 70190002
*                                                                Y02134 70250002
         TM    WTGPATHS,X01             TEST FOR SCRATCH/RENAME  Y02134 70400002
         BO    TAS05100                 BRANCH TO BYPASS DEQ     Y02134 70600002
*                                                                Y02134 70650002
         CLI   MYCODE1,K1               CHECK FOR EOV            Y02134 70700002
         BE    TAS05100                 BRANCH TO BYPASS DEQ     Y02134 70750002
*                                                                       70800021
         DEQ   MF=(E,MYENQSW1)          DEQ PREVIOUS ENQ ON DSNAME      71000021
*                                                                Y02134 71050002
         L     R1,IECRRPRM-IECEXTPR(,RD) LOAD RECOVERY PARM LIST Y02134 71120002
         NI    RRFLAGS2-RRPLIST(R1),ALLBITS-RRFENQPW SET ENQ OFF Y02134 71150002
*                                                                       71200021
*********************************************************************** 71400021
*                                                                     * 71600021
*        CHECK MASTER LOGON PASSWORD                             Y02134 72000002
*                                                                     * 72200021
*********************************************************************** 72400021
*                                                                       72600021
TAS05100 EQU   *                        CHECK LOGON PASSWORD     Y02134 73200002
*                                                                Y02134 73210002
         L     R1,MYASCB                LOAD ASCB POINTER        Y02134 73300002
         L     RF,ASCBTSB-ASCB(,R1)     LOAD TSB POINTER         Y02080 73400002
         LTR   RF,RF                    CHECK IF TSB INITIALIZED Y02134 73450002
         BZ    TAS10200                 BRANCH IF NOT TSO        Y02134 73500002
         MODESET EXTKEY=TCAM            SWITCH TO KEY OF TSB     YM6211 73550002
         CLI   TSBPSWD-TSB(RF),BLANK    CHECK FOR LOGON PASSWORD Y02080 73600002
         BE    TAS10200                 BR IF NO PASSWORD FOUND  Y02080 73800002
         CLI   TSBPSWD-TSB(RF),K0       CHECK FOR LOGON PASSWORD Y02080 73850002
         BE    TAS10200                 BR IF NO PASSWORD FOUND  Y02080 73900002
*                                                                       74000021
         LM    RET,RF,TSBPSWD-TSB(RF)   LOAD MASTER PASSWORD    ZA00111 74050002
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    YM6211 74210002
         STM   RET,RF,MYREPLY           PSWD TO SEARCH AREA     ZA00111 74220002
         LA    RET,K0                   LOAD ENTRY OFFSET        Y02134 74250002
         B     TAS10150                 BR TO READ PSWD REC    @ZA10842 74300037
         EJECT                                                          74350002
*                                                                       74600021
*********************************************************************** 74800021
*                                                                       75000021
*        AN UNCORRECTABLE ERROR HAS OCCURRED                     Y02134 75200002
*                                                                       75400021
*****************************************************************Y02134 75450002
*                                                                Y02134 75500002
TAS09000 EQU   *                        I/O ERROR                Y02134 75600002
*                                                                       77600021
         STC   R0,MYERRCOD              SAVE ERROR CODE          Y02134 77650002
         LA    RET,K8                   LOAD ENTRY OFFSET        Y02134 77800002
         B     TAS10100                 ISSUE ERROR MSG          Y02134 78000002
         EJECT                                                          78050002
*                                                                       78200021
*****************************************************************Y02134 79050002
*                                                                Y02134 79100002
*        VSAM PASSWORD CHECKING COMPLETED NORMALLY               Y02134 79150002
*                                                                Y02134 79200002
*****************************************************************Y02134 79250002
*                                                                Y02134 79300002
TAS10000 EQU   *                        RETURN TO CALLER         Y02134 79350002
*                                                                Y02134 79400002
         XR    RET,RET                  CLEAR RETURN OFFSET      Y02134 79450002
         IC    RET,MYRETCOD             GET RETURN OFFSET        Y02134 79500002
*                                                                Y02134 79550002
         IECRES LOAD,MODNM=MYRETMOD,BRCODE=(14),                 Y02134X81450002
               PREFIX=WTGPREFX,BRANCH=DIRECT                     Y02134 81500002
         EJECT                                                          81550002
*                                                                       81600021
*****************************************************************Y02134 81650002
*                                                                Y02134 81700002
*        GO TO NEXT LOAD                                         Y02134 81750002
*                                                                Y02134 81800002
*****************************************************************Y02134 81850002
*                                                                Y02134 81900002
TAS10100 EQU   *                        GO UPDATE DSCB           Y02134 81950002
*                                                                Y02134 82000002
         CLI   MYCODE1,K1               CHECK FOR EOV            Y02134 82050002
         BE    TAS10000                 DON'T REWRITE PASSWORD   Y02134 82100002
*                                                                Y02134 82150002
TAS10150 EQU   *                                               @ZA10842 82160037
*                                                              @ZA10842 82170037
         IECRES LOAD,MODNM=IFG0195U,BRCODE=(14),                 Y02134X82200002
               PREFIX=WTGPREFX,BRANCH=DIRECT                     Y02134 82250002
         EJECT                                                          82300002
*                                                                       82600021
*****************************************************************Y02134 82650002
*                                                                Y02134 82700002
*        GO READ A PASSWORD                                      Y02134 82750002
*                                                                Y02134 82800002
*****************************************************************Y02134 82850002
*                                                                Y02134 82900002
TAS10200 EQU   *                        GET PASSWORD             Y02134 82950002
*                                                                Y02134 83000002
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    YM6211 83010002
         IECRES LOAD,MODNM=READPSWD,                             Y02134X83050002
               PREFIX=WTGPREFX,BRANCH=DIRECT                     Y02134 83100002
         EJECT                                                          83150002
*                                                                       87200021
*********************************************************************** 87400021
*                                                                       87600021
*        CONSTANTS                                                      87800021
*                                                                       88000021
*****************************************************************Y02134 88050002
*                                                                Y02134 88100002
*        CCWS TO READ FORMAT 4 OF SYSRES                         Y02134 88170002
*                                                                Y02134 88182002
TASCCW01 CCW   CCWSCHID,K0,CCWCMDCH,K5  SEARCH ID EQ             Y02134 88190002
         CCW   CCWTIC,K0,K0,K0          TIC *-8                  Y02134 88192002
         CCW   X80+CCWSCHKE,K0,CCWSILI+CCWCMDCH,L'F4KEY S KEY EQ Y02134 88194002
         CCW   CCWNOP,K0,CCWSILI,K1     NOP                      Y02082 88198002
         CCW   CCWRDDA,K0,CCWSILI,K80   READ DATA-SILI 80 BYTES  Y02134 88198802
*                                                                Y02134 88198902
*        CCWS TO READ FORMAT 1 OF PASSWORD DATA SET              Y02134 88199002
*                                                                Y02134 88199202
TASCCW02 CCW   CCWSCHID,K0,CCWCMDCH,K5  SEARCH ID EQ             Y02134 88199402
         CCW   CCWTIC,K0,K0,K0          TIC *-8                  Y02134 88199502
         CCW   CCWMTSID,K0,CCWCMDCH+CCWSILI,K5                   Y02082 88199602
         CCW   CCWTIC,K0,K0,K0                                   Y02082 88199702
         CCW   CCWSCHKE,K0,CCWCMDCH+CCWSILI,L'JFCBDSNM           Y02134 88199802
         CCW   CCWNOP,K0,CCWSILI,K1                              Y02082 88224902
         CCW   CCWTIC,K0,K0,K0                                   Y02082 88237402
         CCW   CCWSCHKE,K0,CCWCMDCH+CCWSILI,L'JFCBDSNM           Y02134 88249902
         CCW   CCWTIC,K0,K0,K0                                   Y02082 88259902
         CCW   CCWRDDA,K0,CCWSILI,K80                            Y02082 88269902
*                                                                       89400021
*        CCWS TO READ PASSWORD RECORD FROM TTR IN DSAB           Y02134 89402002
*                                                                Y02134 89404002
TASCCW03 CCW   CCWSCHID,K0,CCWCMDCH,K5  SEARCH ID EQ             Y02134 89410002
         CCW   CCWTIC,K0,K0,K0          TIC *-8                  Y02134 89420002
         CCW   CCWRDKEY,K0,CCWSILI,L'MYDSN+L'MYREPLY+L'MYLOGFLD  Y02134 89422002
*                                                                Y02134 89430002
TASTRK   DC    X'7FFF'                  MAX TRACKS IN EXTENT     Y02134 89450002
F4KEY    DC    XL4'04040404'            FORMAT 4 KEY             Y02082 89500002
PASSWORD DC    C'PASSWORD '             DSNAME OF PASSWORD DS    Y02134 89550002
*                                                                Y02134 89600002
ENQLIST  ENQ   (SYSZPSWD,,E,L'JFCBDSNM,SYSTEM),MF=L              Y02134 89800002
SYSZPSWD DC    C'SYSZPSWD'              MAJOR ENQ/DEQ NAME       Y02134 90000002
*                                                                       90800021
         XCTLTABL ID=(,IDA0192G,,IFG0195U,,READPSWD),            Y02134X91000002
               BRT=YES,LENGTH=                                   Y02134 91050002
*                                                                       91200021
         IECDSECS CVT,ASCB,TCB,JSCB,TSB,DSAB,UCB,DSCB4,          Y02080X91250002
               ACB,DCB,DEB,MAIN,SECCORE,PREFX,WTG,RRPL,          Y02080X91300002
               EXPAND=YES                                        Y02134 91310002
         IECEQU ,                       DEFINE EQUATES                  91350002
*                                                                       91600021
         END                                                            91800021
