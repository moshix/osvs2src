         TITLE 'IFG0196J                      OPEN - JFCB TO DCB MERGE' 00100002
         COPY  LCGASMSW                                                 00150000
IFG0196J CSECT                                                          00400021
*********************************************************************** 00450002
*        VS 2 RELEASE 02 DELETIONS/CHANGES                            * 00453037
*                                                                     * 00454037
*A449100-450000                                              @ZA21109 * 00455037
*0000                                                        @ZA02660 * 00456037
*                                                                     * 00460002
* MODULE NAME = IFG0196J (OS/VS2)                                     * 00470002
*                                                                     * 00480002
* DESCRIPTIVE NAME = OPEN - JFCB TO DCB MERGE                         * 00490002
*                                                                     * 00492002
* COPYRIGHT = NONE                                                    * 00494002
*                                                                     * 00496002
* STATUS = RELEASE 2, LEVEL 0                                         * 00498002
*                                                                     * 00498402
* FUNCTION =                                                          * 00498802
*        1. RESTORE WORK DEB FIRST MAIN UCB ADDRESS FOR DIRECT ACCESS * 00498902
*        DATA SETS.                                                   * 00499002
*                                                                     * 00499102
*        2. MERGE JFCB TO DCB FIELDS FOR SAM, PAM, DAM, ISAM, EXCP    * 00499202
*        DATA SETS.                                                   * 00499302
*                                                                     * 00499602
* NOTES = SEE BELOW                                                   * 00499702
*                                                                     * 00499802
*    DEPENDENCIES =                                                   * 00499902
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 00500002
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 00533202
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 00543202
*                                                                     * 00553202
*    RESTRICTIONS = NONE                                              * 00563202
*                                                                     * 00565202
*    REGISTER CONVENTIONS =                                           * 00565602
*            R2 POINTS TO DCB                                         * 00566002
*            R4 POINTS TO OPEN WORK AREA                              * 00566402
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 00566502
*            R6 POINTS TO THE WTG TABLE                               * 00566602
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 00577702
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 00587702
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 00588102
*            R10 POINTS TO THE UCB                                    * 00588502
*                                                                     * 00588602
*    PATCH LABEL = SEE NEXT TO LAST LABEL BEFORE ORG STATEMENT AT END * 00588702
*                  OF LISTING.                                        * 00588802
*                                                                     * 00592502
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 00594502
*                                                                     * 00594902
*    PROCESSOR = ASSEMBLER XF                                         * 00595302
*                                                                     * 00595702
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 00596102
*                  ORG STATEMENT AT END OF LISTING                    * 00596202
*                                                                     * 00622102
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 00632102
*                  PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY, * 00642102
*                  LINK PACK AREA RESIDENT/PAGEABLE                   * 00644102
*                                                                     * 00646102
* ENTRY POINT =                                                       * 00648102
*        IFG0196J R14 = 0                                             * 00650202
*                                                                     * 00656702
*    PURPOSE = SEE FUNCTION                                           * 00658702
*                                                                     * 00660702
*    LINKAGE =                                                        * 00662702
*        FROM IFG0194A:                                               * 00663102
*           MVC WTGIDDTR,DXSAVMOD                                     * 00663502
*           XR  RET,RET                                               * 00663902
*           IC  RET,DXSAVMOD                                          * 00664302
*           IECRES LOAD,BRANCH=QUEUED                                 * 00664402
*                                                                     * 00664502
*        FROM IFG0195A:                                               * 00664602
*           IECRES LOAD,MODID=ODA1950X,BRCODE=0,BRANCH=QUEUED         * 00664702
*                                                                     * 00664802
*        FROM IFG0195B:                                               * 00664902
*           LA  RF,ID5B6J                                             * 00665002
*           IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED         * 00666102
*                                                                     * 00668102
*        FROM IFG0195C:                                               * 00668502
*           IECRES LOAD,MODID=ID5C6J,BRANCH=QUEUED                    * 00669202
*                                                                     * 00669302
*        FROM IFG0195D:                                               * 00669402
*           MVC  WTGIDTTR,MERGE                                       * 00669502
*           LA   RET,K0                                               * 00670502
*           IECRES LOAD,BRANCH=QUEUED                                 * 00672502
*                                                                     * 00673102
*        FROM IFG0195J:                                               * 00674102
*           IECRES LOAD,MODID=ID5J6J,BRCODE=K0,BRANCH=QUEUED          * 00675102
*                                                                     * 00676102
*        FROM IFG0195K:                                               * 00677102
*           LA  RET,K0                                                * 00678102
*           LA  RF,ID5K6J                                             * 00679102
*           IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED         * 00680102
*                                                                     * 00681102
*        FROM IFG0195N:                                               * 00682102
*           LA  RET,K0                                                * 00683102
*           LA  RF,ID5N6J                                             * 00684102
*           IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED         * 00685102
*                                                                     * 00686102
* INPUT =                                                             * 00687102
*        A JFCB IN EACH OF THE DCB WORK AREAS.                        * 00688102
*                                                                     * 00689102
* OUTPUT =                                                            * 00690102
*        MERGED FIELDS IN THE USER'S DCB, AND AN INDICATION OF WHICH  * 00691102
*        FIELDS WERE MERGED SAVED IN JFCBMASK.                        * 00692102
*                                                                     * 00693102
* EXIT-NORMAL =                                                       * 00694102
*        IFG0196L DCB EXIT                                            * 00695102
*        IFG0196K JFCB TO DCB MERGE TELECOMMUNICATIONS                * 00696102
*                                                                     * 00697102
* EXIT-ERROR =                                                        * 00698102
*        IFG0190P 013 ABEND                                           * 00699102
*                                                                     * 00700102
* EXTERNAL REFERENCES = SEE BELOW                                     * 00701102
*                                                                     * 00702102
*    ROUTINES = NONE                                                  * 00703102
*                                                                     * 00704102
*    DATA AREAS = NONE                                                * 00705102
*                                                                     * 00706102
*    CONTROL BLOCK = NONE                                             * 00716102
*                                                                     * 00726102
* TABLES = NONE                                                       * 00728102
*                                                                     * 00728502
* MACROS = IECRES, DMABCOND, XCTLTABL, IECDSECS                       * 00728902
*                                                                     * 00729302
* CHANGE ACTIVITY = NEW RELEASE (LEVEL 0)                             * 00729702
*                                                                     * 00737502
*********************************************************************** 00739502
         EJECT                                                          00741502
         IECDSECS CVT,TIOT,UCB,         DEFINE DESIRED DSECTS TO BE    X11000021
               DCB,MAIN,WTG,PREFX       EXPANDED AT THE END      Y02080 11100002
*                                                                       11200021
         IECEQU ,                       DEFINE EQUATES                  11400021
*                                                                       11600021
         USING IHADCB,RDCB              DEFINE BASE TO USER'S DCB       11700021
         USING FORCORE,RCORE            DEFINE BASE TO MAIN WORK AREA   11800021
         USING WTG,RWTG                 DEFINE BASE TO WTG TABLE Y02080 11850002
         USING TIOENTRY,RTIOT           DEFINE BASE TO TIOT DD ENTRY    11900021
         USING UCBOB,RUCB               DEFINE BASE TO MAIN UCB         12000021
*                                                                       12100021
         BALR  RBASE,0                  ESTABLISH BASE REGISTER         12200021
         USING *,RBASE                  DEFINE BASE REGISTER            12300021
*                                                                       12400021
*********************************************************************** 12500021
*                                                                       12600021
*  DIRECT ACCESS MULTI-VOLUME ISAM, BDAM, MQ, AND PO REQUIRES           12700021
*  REINITIALIZATION OF THE WORK DEB MAIN UCB ADDR FOR UCB               12800021
*  ATTRIBUTE TESTING PURPOSES.                                          12900021
*  SINCE PS ALWAYS ROTATES THE TIOT DD ENTRY UCB POINTERS SO THAT       13000021
*  THE CURRENT UNIT IS FIRST, DOING THIS REINITIALIZATION FOR           13100021
*  EVERY DSORG WILL DO NO HARM.                                         13200021
*  (NOTE THAT THE WORK DEB EXTENT IS NOT BEING REINITIALIZED YET.)      13300021
*                                                                       13400021
         TM    JFCBMASK+K4,JFCMNULL     TEST IF NULL DATA SET           13500021
         BO    OMG10600                 BR IF YES                       13600021
         TM    TIOELINK,TIOESYIN+TIOESYOT SPOOLED DATA SET?      Y02120 13650002
         BM    OMG10950                 BRANCH IF YES            Y02120 13660002
*                                                                       13700021
         L     RUCB,DXUCBADR            LOAD UCB ADDRESS         Y02134 13800002
         TM    UCBTBYT3,UCB3DACC        IS IT DIRECT ACCESS             15000021
         BNO   OMG10600                 BR IF NO                        15100021
*                                                                       15200021
         LA    RUCB,0(RUCB)             CLEAR HIGH ORDER BYTE           15300021
         ST    RUCB,DXDEBUCB            STORE MAIN UCB ADDR IN WRK DEB  15400021
*                                                                       15500021
*********************************************************************** 15600021
*                                                                       15700021
* INITIALIZE THE DEVT AND DVTBL FIELDS FOR DA EXCP DCB'S HERE.          15800021
* WHEN ACCESS METHODS ARE USED, THE A.M. EXECUTORS INITIALIZE           15900021
* THESE FIELDS.                                                         16000021
*                                                                       16100021
OMG10600 EQU   *                        INIT DEVT, DVTB FIELDS          16200002
         TM    DCBMACRF,DCBMEXCP        IS THIS EXCP                    16300021
         BZ    OMG10800                 BR IF NOT EXCP                  16400021
*                                                                       16500021
         TM    JFCBMASK+K4,JFCMNULL     TEST IF NULL DATA SET           16600021
         BO    OMG12200                 BR IF YES TO ABEND              16700021
*                                                                       16800021
         TM    DCBMACRF,DCBMFOUN        IS DCB F.B.E. PRESENT           16900021
         BZ    OMG11200                 BR IF NO                        17000021
*                                                                       17100021
         TM    UCBTBYT3,UCB3DACC        IS IT DIRECT ACCESS             17200021
         BNO   OMG10800                 BR IF NO                        17300021
*                                                                       17400021
         MVC   DCBDEVT,UCBTBYT4         SET UP DEVTYPE FIELD            17500021
         OC    DCBDEVT,UCBTBYT3         OR IN DEVICE CLASS              17600021
*                                                                       17700021
         L     RC,CVTPTR                GET CVT ADDR                    17800021
         L     RC,CVTZDTAB-CVT(,RC)     GET DEVICE CONSTANT TABLE ADDR  17900021
         SR    R1,R1                    CLEAR WORK REGISTER             18000021
         IC    R1,UCBTBYT4              GET DEVICE CHARACTERISTIC       18100021
         IC    R1,0(R1,RC)              ADD ID TO TABLE ADDRESS         18200021
         LA    RC,0(R1,RC)              ADD CONST AT THIS LOCATION      18300021
         IC    RB,DCBDVTBL              SAVE POSSIBLE RECRD NUMBER      18400021
         ST    RC,DCBDVTBL              SET UP DEVICE TABLE FIELD       18500021
         STC   RB,DCBDVTBL              RESTORE RECORD NUMBER           18600021
*                                                                       18700021
*********************************************************************** 19000021
*                                                                       19100021
*  MERGE JFCB FUNC TO DCB FUNC IF 3525 UNIT RECORD DEVICE.       S21088 19200021
*                                                                S21088 19300021
OMG10800 EQU   *                        JFCB TO DCB MERGE               19350002
*                                                                       19360002
         TM    JFCBMASK+K4,JFCMNULL     TEST IF NULL DATA SET    S21088 19400021
         BO    OMG10950                 BR IF YES                S21088 19500021
*                                                                S21088 19600021
         CLI   UCBTBYT3,UCB3UREC        IS DEVICE UNIT RECORD    S21088 19700021
         BNE   OMG10950                 BR IF NO                 S21088 19800021
*                                                                S21088 19900021
         CLI   UCBTBYT4,X'0C'           IS DEVICE 3525           S21088 20000021
         BNE   OMG10950                 BR IF NO                 S21088 20100021
*                                                                S21088 20200021
         TM    DCBMACRF,DCBMEXCP        IS THIS EXCP DCB         S21088 20300021
         BZ    OMG10900                 BR IF NO                 S21088 20400021
*                                                                S21088 20500021
         TM    DCBMACRF,DCBMDI5W+DCBMDI4W+DCBMDI3W+DCBMDI1W      S21088 20600021
         BZ    OMG10950                 BR IF NO DCB FUNC FIELD  S21088 20700021
*                                                                S21088 20800021
OMG10900 EQU   *                        NOT EXCP                 S21088 20900002
         CLI   DCBFUNC,K0               IS DCB FUNC SPECIFIED    S21088 21000021
         BNE   OMG10950                 BR IF YES                S21088 21100021
*                                                                S21088 21200021
         MVC   DCBFUNC,JFCFUNC          MERGE FUNC FROM JFCB     S21088 21300021
         OI    JFCBMASK+K3,X'08'        INDICATE FUNC MERGED     S21088 21400021
*                                                                S21088 21500021
OMG10950 EQU   *                        MERGE CONTINUED          S21088 21600002
*                                                                       21700021
         MVI   DXATOPEN,DXATMODS        SHOW DCB MERGE STARTED   Y02144 21950002
         TM    DCBMACRF,DCBMEXCP        CHECK FOR EXCP                  22800021
         BZ    OMG11600                 BR IF NOT EXCP                  22900021
OMG11200 EQU   *                        NO DCB F.B.E.                   23000002
         LA    R1,K13                   POINT TO FBE IN MERGE TABLE     23100021
         TM    DCBMACRF,DCBMAPP         IS EXCP INTERFACE PRESENT       23200021
         BO    OMG11400                 BR IF YES, OPTCD INCLUDED       23300021
         LA    R1,K14                   NO, DO NOT MERGE OPTCD          23400021
OMG11400 EQU   *                        OPTCD INCLUDED                  23500002
         TM    DCBMACRF,DCBMFOUN        IS F.B.E. PRESENT               23600021
         BO    OMG15000                 BR IF YES TO MERGE              23700021
         B     OMG16900                 BR TO BYPASS MERGE              23800021
*                                                                       23900021
*********************************************************************** 24000021
*                                                                       24100021
* IF GRAPHICS OR TELEPROCESSING, BYPASS THE PROCESSING IN THIS MODULE.  24200021
*                                                                       24300021
OMG11600 EQU   *                        NOT EXCP                        24400002
*        TEST FOR GRAPHICS, TCAM, OR 3705 CU                     S22024 24450002
         TM    DCBDSORG+K1,DCBORGGR+DCBORGTQ+DCBORGTX+DCBDSGTR   S22024 24500002
         BNZ   OMG11800                 BR IF GRAPHICS, TCAM, 3705 CU  C24600002
                                                                 S22024 24660002
         TM    DCBDSORG,DCBORGCX+DCBORGCQ+DCBORGMQ                      24700021
         BNZ   OMG11800                 BRANCH IF TP                    24800021
         TM    DCBDSORG,DCBORGPS        IS THIS PS                      24900021
         BNO   OMG12000                 BRANCH IF NO                    25000021
         TM    TIOELINK,TIOEQNAM        IS THIS A TCAM DUMMY            25100021
         BNO   OMG12000                 BRANCH IF NO                    25200021
OMG11800 EQU   *                        GO TO JFCB TO DCB MERGE TELECOM 25300002
*                                                                       25400021
         IECRES LOAD,MODID=ID6J6K,BRANCH=QUEUED                  Y02080 25550002
*                                       XCTL TO GX,TELCOM MODULE Y02080 25560002
*                                                                       25600021
*********************************************************************** 25700021
*                                                                       25800021
*  NULL DATA SET IS ONLY SUPPORTED FOR DSORG=PS OR MQ.                  25900021
*  FOR MQ IT IS NOT LOGICALLY A DUMMY, SINCE IT WILL BE LINKED          26000021
*  UP WITH A DATA SET SUPPORTED BY A MASTER QTAM PROGRAM.               26100021
*                                                                       26200021
OMG12000 EQU   *                        NULL DATA SET                   26300002
         TM    JFCBMASK+K4,JFCMNULL     TEST IF NULL DATA SET           26400021
         BNO   OMG12400                 BR IF NOT                       26500021
         TM    DCBDSORG,DCBORGMQ        IS IT DSORG=MQ           A43751 26540021
         BO    OMG12400                 BR IF YES                A43751 26580021
         TM    DCBDSORG,DCBORGPS        IS IT DSORG=PS           A43751 26620021
         BZ    OMG12200                 BR IF NO TO PROB DET     A43751 26660021
         TM    DCBMACRF+K1,DCBMWRIT+DCBMLOAD  IS BDAM LOAD MODE  A43751 26700021
         BNO   OMG12400                 BR IF NO, JUST PS        A43751 26740021
*                                                                       26800021
*********************************************************************** 26850002
OMG12200 EQU   *                        ABEND                           26900002
OABD043  EQU   43                       NULL DATA SET NOT SUPPORTED     27000021
*                                       FOR EXCP, AND ONLY FOR          27100021
*                                       DSORG=PS OR MQ                  27200021
         DMABCOND OABD043,ID6J0P        XCTL TO PROBLEM DET / ABEND     27300002
*                                                                       27400021
*********************************************************************** 27450002
OMG12400 EQU   *                        DSORG TESTS                     27500002
         TM    DCBDSORG,DCBORGPS        IS IT PHYSICAL SEQ              27600021
         BO    OMG12600                 BR IF YES                       27700021
*                                                                       27800021
         TM    DCBDSORG,DCBORGIS        IS IT INDEXED SEQ               27900021
         BO    OMG14000                 BR IF YES                       28000021
*                                                                       28100021
         TM    DCBDSORG,DCBORGDA        IS IT DIRECT ACCESS             28200021
         LA    R1,K8                    POINT TO DAM IN MRG TABLE       28300021
         BO    OMG15000                 BR IF YES                       28400021
*                                                                       28500021
         TM    DCBDSORG,DCBORGPO        IS IT PARTITIONED ORGANIZATION  28600021
         BO    OMG13600                 BR IF YES                       28700021
*                                                                       28800021
*                                       NO DSORG SPECIFIED,             28900021
*                                       DEFAULT TO PS                   29000021
*                                                                       29100021
*********************************************************************** 29200021
*                                                                       29300021
OMG12600 EQU   *                        PHYSICAL SEQUENTIAL             29400002
         TM    JFCBMASK+K4,JFCMNULL     CHECK FOR NULL DATA SET         29500021
         BZ    OMG12800                 BR IF NO                        29600021
*                                                                       29700021
         TM    TIOELINK,TIOTTERM        IS THIS TSO                     29800021
         BNO   OMG13400                 BR IF NO                        29900021
*                                                                       30000021
         MVI   DCBDEVT,DCBDEVTM         SET DEVICE TYPE TO X'4F'        30100021
*                                                                       30200021
         CLI   DCBBUFNO,K0              IS BUFNO SPECIFIED IN DCB       30300021
         BNE   OMG13400                 BR IF YES                       30400021
*                                                                       30500021
         CLI   JFCBUFNO,K0              IS BUFNO SPECIFIED IN DD CARD   30600021
         BNE   OMG13400                 BR IF YES                       30700021
*                                                                       30800021
         MVI   DCBBUFNO,K1              SET DCB BUFNO TO 1              30900021
         B     OMG13400                 BR TO CONT NULL DATA SET        31000021
*                                                                       31100021
*********************************************************************** 31200021
*                                                                       31300021
*   THIS SECTION TESTS THE JFCBUFOF BYTE TO DETERMINE THE STATUS        31400021
*   OF THE OPTIONAL BUFFER OFFSET FIELD FOR ASCII'S DATA SETS. THE      31500021
*   CORRESPONDING BITS IN THE DCB ARE MERGED IF NOT PREVIOUSLY SET.     31600021
*                                                                       31700021
OMG12800 EQU   *                                                        31800021
         TM    TIOELINK,TIOESYIN+TIOESYOT SPOOLED DATA SET?      Y02120 31850002
         BM    OMG13400                 BRANCH IF YES            Y02120 31860002
         TM    UCBTBYT3,UCB3TAPE        TEST IF MAGNETIC TAPE           31900021
         BZ    OMG13400                 BR IF NO                        32000021
*                                                                       32400021
         TM    DCBUSASI,DCBBLBP         IS DCB FIELD ZERO               32500021
         BO    OMG13000                 NO, BYPASS MERGE                32600021
         TM    JFCBUFOF,DCBUSAON        BLK LENGTH IN JFCB              32700021
         BZ    OMG13000                 NO, BYPASS MERGE                32800021
         OI    DCBUSASI,DCBBLBP         SET BUF OF =BLK LNG             32900021
         OI    JFCBMASK,DCBUSAON        INDICATE MERGE IN JFCBMASK      33000021
*                                                                       33100021
OMG13000 TM    DCBBUFOF,X'FF'-DCBUSAON  CHECK DCB FOR BUFFER OFFSET     33200021
         BNZ   OMG13400                 BYPASS BUFOFF CHECK             33300021
         MVC   DCBBUFOF,JFCBUFOF        SET BUFFER OFFSET LENGTH        33400021
         NI    DCBBUFOF,X'FF'-DCBUSAON  TURN OFF BIT 0                  33500021
         OI    JFCBMASK+K1,JFCMBFOF     SET BUFOFF MERGE MASK           33600021
*                                                                       33700021
*********************************************************************** 33800021
*                                                                       33900021
OMG13400 EQU   *                        CONTINUE MERGE TESTS            34000002
         LA    R1,K5                    POINT TO QSAM IN MRG TAB        34100021
*                                                                       34200021
         TM    DCBMACRF,DCBMGET         TEST IF QSAM GET                34300021
         BO    OMG15000                 BR IF YES                       34400021
         TM    DCBMACRF+K1,DCBMPUT      TEST IF QSAM PUT                34500021
         BO    OMG15000                 BR IF YES                       34600021
*                                                                       34700021
*        THIS IS PS BSAM OR PO BPAM                                     34800021
OMG13600 EQU   *                                                        34900021
         NC    DCBLRECL,DCBLRECL        IS LRECL=0                      35000021
         BNZ   OMG13800                 BR IF NO                        35100021
         MVC   DCBLRECL,JFCLRECL        MERGE LRECL                     35200021
         OI    JFCBMASK+K3,X'02'        SET LRECL MERGE MASK            35300021
OMG13800 EQU   *                        LRECL NOT 0                     35400002
         LA    R1,K10                   POINT TO BSAM IN MERGE TABLE    35500021
         B     OMG15000                 BR TO MAIN MERGE                35600021
*                                                                       35700021
OMG14000 EQU   *                        ISAM                            35800021
         LA    R1,K0                    POINT TO ISAM IN MRG TABLE      35900021
         TM    DCBMACRF+K1,DCBMPMOV+DCBMLOC  IS IT QISAM LOAD MODE      36000021
         BNZ   OMG15000                 BR IF YES                       36100021
*                                                                       36200021
         L     RF,DSCCORE               PTR TO FORMAT 2 DSCB            36300021
         MVC   DCBNCRHI,DS2NOBYT(RF)    MOVE TO DCB THE                 36400021
*                                       NUMBER OF BYTES NEEDED          36500021
*                                       FOR HIGHEST LEVEL INDEX         36600021
DS2NOBYT EQU   X'40'                    DS2NOBYT OFFSET IN DSCB         36700021
*                                                                       36800021
         NC    DCBBLKSI,DCBBLKSI        IS DCBBLKSI=0         @ZA02660  36830037
         BNZ   OMG15000                 BRANCH IF NO          @ZA02660  36860037
         MVC   DCBBLKSI,JFCBLKSI        MERGE BLKSIZE                   36900021
         OI    JFCBMASK+K2,X'10'        INDICATE MERGE DONE             37000021
*                                                                       37100021
*********************************************************************** 37200021
*                                                                       37300021
*        JFCB TO DCB MERGE ROUTINE                                      37400021
*                                                                       37500021
*  NOTE - THE HIARCHY FIELD DOES NOT PARTICIPATE IN THE FORWARD         37600021
*        MERGE IN THE MANNER OF OTHER FIELDS.                           37700021
*  THE FOLLOWING INSTRUCTIONS SAVE THE BYTE CONTAINING THE              37800021
*  HIERARCHY SPECIFICATION (INDICATED BY BITS 0 AND 5) SO THAT          37900021
*  AFTER THE MERGE IS COMPLETED, THE HIERARCHY INDICATION CAN           38000021
*  BE RESTORED, AND ALLOWS THE MERGE OF DCBBFTEK AND DCBBFALN           38100021
*  FIELDS TO BE INDEPENDENT OF THE HIERARCHY SPECIFICATION.             38200021
*                                                                       38300021
OMG15000 EQU   *                        JFCB TO DCB MERGE               38400002
         MVC   DXCCW11(K1),DCBBFTEK     SAVE DCB HIERARCHY BITS         38500021
         NI    DCBBFTEK,X'FF'-DCBH0-DCBH1  ZERO DCB HIERARCHY BITS      38600021
*                                                                       38700021
*                                                                       38800021
         LR    R0,RDCB                  DCB WORK REGISTER               38900021
         LA    RET,OMG1720K             DCB DISP PTR FOR MERGE          39000021
         LA    RF,OMG1800K              JFCB DISP PTR FOR MERGE         39100021
         LA    RD,OMG1840K              FIELD LENGTHS FOR JFCB-DCB MRG  39200021
         AR    RF,R1                    POINT TO                        39300021
         AR    RET,R1                   PROPER                          39400021
         AR    RD,R1                    ENTRY                           39500021
         SR    RUCB,RUCB                CLEAR MASK REGISTER             39600021
*                                                                       39700021
OMG15200 EQU   *                        MERGE NEXT FIELD                39800002
         L     RCORE,WTGCORE-K1-WTGENTRY(,RWTGC)  RELOAD DCB WORK ADDR  39900021
         LA    RCORE,DXJBF              ADDRESS OF JFCB                 40000021
         SR    RC,RC                    CLEAR REGISTER                  40100021
         IC    RC,0(,RET)               PICK UP DCB DISP                40200021
         AR    RDCB,RC                  POINT TO DCB FIELD              40300021
         IC    RC,0(,RF)                PICK UP JFCB DISP               40400021
         AR    RCORE,RC                 POINT TO JFCB FIELD             40500021
         IC    RC,0(,RD)                PICK UP FIELD LENGTH-1          40600021
         CLI   0(RET),X'24'             IS THIS FIELD RECFM             40700021
         BE    OMG16600                 BR IF IT IS RECFM               40800021
         EX    RC,OMG16000              ****EXECUTE COMPARE****         40900021
         BNZ   OMG15600                 BRANCH IF FIELD NOT ZERO        41000021
OMG15400 EQU   *                        NO RECFM                        41100002
         EX    RC,OMG16200              ****EXECUTE THE MERGE****       41200021
         O     RUCB,OMG1700K            OR A BIT INTO THE MASK REGISTER 41300021
*                                                                       41400021
OMG15600 EQU   *                        RECFM NON-ZERO                  41500002
         LA    RET,K1(RET)              STEP DCB DISP POINTER           41600021
         TM    0(RET),X'FF'             TEST IF AT END OF MERGE         41700021
         BZ    OMG16700                 BRANCH IF AT END OF MERGE       41800021
         BO    OMG16400                 BRANCH IF END OF A.M. MERGE     41900021
         LA    RF,K1(RF)                STEP JFCB DISP POINTER          42000021
         LA    RD,K1(RD)                STEP FIELD LENGTH POINTER       42100021
OMG15800 EQU   *                        SHIFT MERGE MASK                42200002
         SLL   RUCB,K1                  SHIFT THE MASK TO THE LEFT 1    42300021
         LR    RDCB,R0                  RESET DCB POINTER               42400021
         B     OMG15200                 BR TO MERGE NEXT FIELD          42500021
*                                                                       42600021
OMG16000 NC    0(*-*,RDCB),0(RDCB)      ****CHECK FOR ZERO FIELD****    42700021
OMG16200 OC    0(*-*,RDCB),0(RCORE)     ****MERGE****                   42800021
*                                                                       42900021
OMG16400 EQU   *                        END OF AM MERGE                 43000002
         LA    RF,K1(RF)                STEP RF BY ONE                  43100021
         IC    RC,0(,RF)                PICK UP SHIFT FACTOR            43200021
         SLL   RUCB,0(RC)               SHIFT MASK LEFT ONE             43300021
         LA    RET,OMG1740K             RESET POINTERS                  43400021
         LA    RF,OMG1820K                                              43500021
         LA    RD,OMG1860K                                              43600021
         B     OMG15800                 BR TO SHIFT MERGE MASK          43700021
*                                                                       43800021
OMG16600 EQU   *                        RECFM                           43900002
         TM    0(RDCB),X'FF'-DCBRECKY   IS ANY VALUE IN RECFM           44000021
         BZ    OMG15400                 BR IF NO                        44100021
         B     OMG15600                 BR RECFM NON-ZERO               44200021
*                                                                       44300021
OMG16700 EQU   *                        END OF MERGE                    44400002
         L     RDCB,0(,RPARC)           RELOAD DCB ADDR                 44500021
         L     RCORE,WTGCORE-K1-WTGENTRY(,RWTGC)  RELOAD DCB WORK ADDR  44600021
*                                                                       44700021
*  TO INSURE BFTEK/BFALN CAME FROM SAME SOURCE AND TAKE DOUBLEWORD      44800037
*  DEFAULT IF NOT SPECIFIED FOR BFALN AND RESET HIERARCHY BITS 0,5 TO   44810037
*  PRE-MERGE SETTING.                                                   44820037
OMG16710 EQU   *                                               @ZA21109 44830037
         TM    DXCCW11,X'7B'            BFALN/BFTEK SPEC IN DCB?ZA21109 44840037
         BZ    OMG16730                 NO, GO CHK JFCB        @ZA21109 44850037
         TM    DXCCW11,X'03'            BFALN SPECIFIED IN DCB?@ZA21109 44860037
         BNZ   OMG16740                 YES, USE IT            @ZA21109 44870037
OMG16720 OI    DXCCW11,X'02'            SET DEFAULT            @ZA21109 44880037
         B     OMG16740                                        @ZA21109 44890037
OMG16730 EQU   *                        CHECK JFCB             @ZA21109 44900037
         TM    JFCBFALN,X'7B'           BFALN/BFTECK SPEC IN JFCB?21109 44910037
         BZ    OMG16720                 GO SET DEFAULT         @ZA21109 44920037
         OC    DXCCW11,JFCBFALN         USE JFCB FIELDS        @ZA21109 44930037
         TM    JFCBFALN,X'03'           BUFF ALGN SPECIFIED IN JFCB?    44940037
         BZ    OMG16720                 TAKE DEFAULT IF NOT    @ZA21109 44950037
OMG16740 EQU   *                                                        44960037
         NI    DCBBFTEK,X'FF'-JFCBH1    INSURES HIARCHY NOT MERGED      45000021
         OC    DCBBFTEK,DXCCW11         RESTORES ONLY HIARCHY FLAGS     45100021
*                                                                       45200021
*                                                                       45300021
         TM    DCBRECFM,DCBRECKY        IS KEY LENGTH SPECIFIED         45400021
         BO    OMG16800                 BR IF YES                       45500021
         CLI   DCBKEYLE,K0              IS KEY LENGTH=0                 45600021
         BNE   OMG16800                 BR IF NO                        45700021
         MVC   DCBKEYLE,JFCKEYLE        MERGE KEY LENGTH                45800021
         OI    JFCBMASK+K3,X'20'        SET KEY LENGTH MERGE MASK       45900021
OMG16800 EQU   *                        KEY LENGTH NOT ZERO             46000002
*                                                                       46100021
         SLL   RUCB,K6                  FINAL ALIGN MERGE MASK BITS     46200021
         O     RUCB,JFCBMASK            OR WITH EXISTING MERGE BITS     46300021
         ST    RUCB,JFCBMASK            STORE IN JFCB MASK FIELD        46400021
         MVI   DXATOPEN,DXATMODE        SHOW DCB MERGE DONE      Y02144 46450002
*                                                                       46500021
*********************************************************************** 46600021
*                                                                       46700021
OMG16900 EQU   *                                                        46800021
         IECRES LOAD,MODID=ID6J6L,BRANCH=QUEUED                        C46950002
                                        XCTL TO NEXT MODULE      Y02080 46960002
*                                                                       47000021
OMG1700K DC    F'1'                     REG LOW ORDER BIT MASK          47100021
**********************************************************************  47200021
         EJECT                                                          47300021
**********************************************************************  47400021
*                                                                       47500021
*                                                                       47600021
*                                                                       47700021
*        THE FOLLOWING ARE DISPLACEMENTS WITHIN THE DCB                 47800021
*                                                                       47900021
*                                                                       48000021
*                                                                       48100021
*        OF FIELDS WHICH WILL BE MERGED TO THE DCB FROM THE JFCB        48200021
*                                                                       48300021
*                                                                       48400021
*                                                                       48500021
**********************************************************************  48600021
OMG1720K EQU   *                                                        48700021
*                   ****ISAM SECTION OF MERGE TABLE FOLLOWS****         48800021
         DC    FL1'54'                  ISAM NTM                        48900021
         DC    FL1'55'                  ISAM CYLOF                      49000021
         DC    FL1'60'                  ISAM RKP                        49100021
         DC    FL1'112'                 ISAM DUBFN                      49200021
         DC    FL1'72'                  ISAM NCP                        49300021
         DC    FL1'84'                  ISAM-QSAM EROPT                 49400021
         DC    FL1'82'                  ISAM-QSAM LRECL                 49500021
         DC    X'FF'                    ****DIVISION LINE*****          49600021
         DC    FL1'81'                  BDAM LIMCT                      49700021
         DC    X'FF'                    ****DIVISION LINE****           49800021
*                   ****BSAM SECTION OF MERGE TABLE FOLLOWS****         49900021
         DC    FL1'72'                  BSAM NCP                        50000021
         DC    X'FF'                    *****DIVISION LINE****          50100021
*                                       COMMON SECTION FOLLOWS          50200021
OMG1740K EQU   *                                                        50300021
         DC    FL1'62'                  BLOCK SIZE                      50400021
OMG1760K EQU   *                                                        50500021
         DC    FL1'52'                  OPTCOD                          50600021
         DC    FL1'36'                  RECFM                           50700021
         DC    FL1'18'                  DEN                             50800021
OMG1780K EQU   *                                                        50900021
         DC    FL1'32'                  BFTEK OR BFALN                  51000021
         DC    FL1'24'                  BUFL                            51100021
         DC    FL1'20'                  BUFNO                           51200021
         DC    X'00'                    ****END OF TABLE****            51300021
**********************************************************************  51400021
         EJECT                                                          51500021
**********************************************************************  51600021
*                                                                       51700021
*                                                                       51800021
*                                                                       51900021
*        THE FOLLOWING ARE THE DISPLACEMENTS OF FIELDS IN THE           52000021
*                                                                       52100021
*                                                                       52200021
*                                                                       52300021
*        JFCB WHICH WILL BE MERGED INTO THE DCB                         52400021
*                                                                       52500021
*                                                                       52600021
*                                                                       52700021
**********************************************************************  52800021
OMG1800K EQU   *                                                        52900021
*                   ****ISAM SECTION OF MERGE TABLE FOLLOWS****         53000021
         DC    FL1'107'                 ISAM NTM OFFSET                 53100021
         DC    FL1'110'                 ISAM CYLOF OFFSET               53200021
         DC    FL1'108'                 ISAM RKP OFFSET                 53300021
         DC    FL1'111'                 ISAM DUBFN OFFSET               53400021
         DC    FL1'106'                 ISAM NCP OFFSET                 53500021
         DC    FL1'92'                  ISAM-QSAM EROPT OFFSET          53600021
         DC    FL1'104'                 ISAM-QSAM LRECL OFFSET          53700021
         DC    X'02'                    MASK SHIFT FACTOR AFTER ISAM    53800021
*                   ****BDAM SECTION OF MERGE TABLE FOLLOWS****         53900021
         DC    FL1'95'                  BDAM LIMCT OFFSET               54000021
         DC    X'01'                    MASK SHIFT FACTOR AFTER DAM     54100021
*                   ****BSAM SECTION OF MERGE TABLE FOLLOWS****         54200021
         DC    FL1'106'                 BSAM NCP OFFSSET                54300021
         DC    X'00'                    MASK SHIFT FACTOR AFTER BSAM    54400021
OMG1820K EQU   *                                                        54500021
         DC    FL1'102'                 BLOCKSIZE OFFSET                54600021
         DC    FL1'101'                 OPTCOD OFFSET                   54700021
         DC    FL1'100'                 RECFM OFFSET                    54800021
         DC    FL1'94'                  DEN OFFSET                      54900021
         DC    FL1'89'                  BFTEK-BALN OFFSET               55000021
         DC    FL1'90'                  BUFL OFFSET                     55100021
         DC    FL1'88'                  BUFNO OFFSET                    55200021
         DC    X'00'                    END OF TABLE**********          55300021
**********************************************************************  55400021
         EJECT                                                          55500021
**********************************************************************  55600021
*                                                                       55700021
*                                                                       55800021
*                                                                       55900021
*        THE FOLLOWING ARE THE LENGTHS-1 OF THE FIELDS                  56000021
*                                                                       56100021
*                                                                       56200021
*                                                                       56300021
*        WHICH ARE MERGED FROM THE JFCB TO THE DCB                      56400021
*                                                                       56500021
*                                                                       56600021
*                                                                       56700021
**********************************************************************  56800021
OMG1840K EQU   *                                                        56900021
*                   ****ISAM SECTION OF MERGE TABLE FOLLOWS****         57000021
         DC    FL1'0'                   ISAM NTM LGH                    57100021
         DC    FL1'0'                   ISAM CYLOF LGH                  57200021
         DC    FL1'1'                   ISAM RKP LGH                    57300021
         DC    FL1'0'                   ISAM DUBFN LGH                  57400021
         DC    FL1'0'                   ISAM NCP LGH                    57500021
         DC    FL1'0'                   ISAM-QSAM EROPT LGH             57600021
         DC    FL1'1'                   ISAM-QSAM LRECL LGH             57700021
         DC    X'FF'                    ****DIVISION LINE****           57800021
*                   ****BDAM SECTION OF MERGE TABLE FOLLOWS****         57900021
         DC    FL1'2'                   BDAM LIMCT LGH                  58000021
         DC    X'FF'                    ****DIVISION LINE****           58100021
*                   ****BSAM SECTION OF MERGE TABLE FOLLOWS****         58200021
         DC    FL1'0'                   BSAM NCP LGH                    58300021
         DC    X'FF'                    ****DIVISION LINE*******        58400021
OMG1860K EQU   *                                                        58500021
         DC    FL1'1'                   BLOCK SIZE LENGTH               58600021
         DC    FL1'0'                   OPTCOD LGH                      58700021
         DC    FL1'0'                   RECFM LGH                       58800021
         DC    FL1'0'                   DEN LGH                         58900021
         DC    FL1'0'                   BFTEK-BALN LGH                  59000021
         DC    FL1'1'                   BUFL LGH                        59100021
         DC    FL1'0'                   BUFNO LGH                       59200021
         DC    X'00'                    ****END OF TABLE****            59300021
*********************************************************************** 59400021
         EJECT                                                          59500021
*                                                                       59600021
         XCTLTABL ID=(ID6J0P,0P,ID6J6L,6L,ID6J6K,6K),            Y02080X59700002
               BRT=YES,LENGTH=                                   Y02080 59750002
*                                                                       59800021
         IECDSECS EXPAND=YES            EXPAND DESIRED DSECTS HERE      59900021
*                                                                       60000021
         END                                                            60100021
