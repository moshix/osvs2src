         TITLE 'IFG0196V/OPEN - ACCESS METHOD EXECUTOR DETERMINATION'   00200021
IFG0196V CSECT                                                          00800021
*********************************************************************** 00900002
*                                                                     * 01000002
*        VS2 RELEASE 04 DELETIONS/CHANGES                             * 01002003
*0000                                                          @ZA02899 01004003
*0000330670                                                    @ZA04309 01006003
*                                                                     * 01008003
*        VS2 RELEASE 03 DELETIONS/CHANGES                             * 01010002
*0000330660,330670                                              ZA00017 01020002
*                                                                     * 01050002
* MODULE NAME = IFG0196V (OS/VS2)                                     * 01100002
*                                                                     * 01200002
* DESCRIPTIVE NAME = ACCESS METHOD EXECUTOR DETERMINATION             * 01300002
*                                                                     * 01400002
* COPYRIGHT = NONE                                                    * 01500002
*                                                                     * 01600002
* STATUS = RELEASE 2, LEVEL 0                                         * 01700002
*                                                                     * 01800002
* FUNCTION =                                                          * 01900002
*        1. STOP PARALLEL PROCESSING WITH RESIDENT ROUTINE UNTIL      * 02000002
*        RETURN FROM ACESS METHOD EXECUTORS.                          * 02100002
*                                                                     * 02200002
*        2. PERFORM ACB MERGES AND ACB EXIT PROCESSING.               * 02300002
*                                                                     * 02400002
*        3. MERGE ACB TO JFCB.                                        * 02500002
*                                                                     * 02600002
*        4. DETERMINE PROPER ACCESS METHOD EXECUTOR MODULE TO GIVE    * 02700002
*        CONTROL TO FOR THIS DCB, AND STORE ITS IDTTR IN THE WTG      * 02800002
*        TABLE ENTRY FOR THIS DCB.                                    * 02900002
*                                                                     * 03000002
*        5. COPY DCB FROM THE OPEN WORK AREA TO THE USER'S STORAGE.   * 03100002
*                                                                     * 03200002
*        6. COPY DCB FROM THE USER'S STORAGE TO THE OPEN WORK AREA    * 03300002
*                                                                     * 03400002
*        7. IF THIS IS A CHECK POINT DATA SET, ESTABLISH THE SECURITY * 03500002
*        INTERFACE INCLUDING BUILDING A SECURE DCB IN GOTTEN CORE.    * 03600002
*                                                                     * 03700002
* NOTES = SEE BELOW                                                   * 03800002
*                                                                     * 03900002
*    DEPENDENCIES =                                                   * 04000002
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 04100002
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 04200002
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 04300002
*                                                                     * 04400002
*    RESTRICTIONS = NONE                                              * 04500002
*                                                                     * 04600002
*    REGISTER CONVENTIONS =                                           * 04700002
*            R2 POINTS TO DCB                                         * 04800002
*            R4 POINTS TO OPEN WORK AREA                              * 04900002
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 05000002
*            R6 POINTS TO THE WTG TABLE                               * 05100002
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 05200002
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 05300002
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 05400002
*            R10 POINTS TO THE UCB                                    * 05500002
*                                                                     * 05600002
*    PATCH LABEL = SEE THIRD LABEL BEFORE ORG STATEMENT AT END        * 05700002
*                  OF LISTING.                                        * 05800002
*                                                                     * 05900002
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 06000002
*                                                                     * 06100002
*    PROCESSOR = ASSEMBLER XF                                         * 06200002
*                                                                     * 06300002
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 06400002
*                  ORG STATEMENT AT END OF LISTING                    * 06500002
*                                                                     * 06600002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 06700002
*                  PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY, * 06800002
*                  LINK PACK AREA RESIDENT/PAGEABLE                   * 06900002
*                                                                     * 07000002
* ENTRY POINT = IFG0196V FROM:                                        * 07100002
*                 IFG0196M                                            * 07200002
*                 IFG0193A                                            * 07300002
*                 IFG0196O                                            * 07400002
*                 IFG0196U                                            * 07500002
*                 IFG0196P                                            * 07600002
*                 IFG0196T                                            * 07700002
*                                                                     * 07800002
*    PURPOSE = SEE FUNCTION                                           * 07900002
*                                                                     * 08000002
*    LINKAGE =                                                        * 08100002
*        FROM IFG0196M:                                               * 08200002
*        IECRES LOAD,MODID=ID6M6V,BRCODE=0,BRANCH=QUEUED              * 08300002
*                                                                     * 08400002
*        FROM IFG0193A:                                               * 08500002
*        IECRES LOAD,MODID=LOAD6V3A,BRCODE=0,BRANCH=QUEUED            * 08600002
*                                                                     * 08700002
*        FROM IFG0196O:                                               * 08800002
*        MVC   WTGIDTTR,ID6O6V                                        * 08900002
*        LA    RET,K8                                                 * 09000002
*        IECRES LOAD,BRANCH=QUEUED                                    * 09100002
*                                                                     * 09200002
*        FROM IFG0196U:                                               * 09300002
*        LA    RET,K8                                                 * 09400002
*        LA    RF,ID6U6V                                              * 09500002
*        IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED            * 09600002
*                                                                     * 09700002
*        FROM IFG0196T:                                               * 09800002
*        XR    RET,RET                                                * 09900002
*        IC    RET,DXRETCOD                                           * 10000002
*        IECRES LOAD,MODID=DXRETMOD,BRCODE=(RET)                      * 10100002
*        (WITH DXRETCOD AND DXRETMOD HAVING BEEN SET IN IFG0196V.)    * 10200002
*                                                                     * 10300002
* INPUT = REGISTERS AND WORK AREA                                     * 10400002
*                                                                     * 10500002
* OUTPUT = REGISTERS, WORK AREA, UPDATED DCB                          * 10600002
*                                                                     * 10700002
* EXIT-NORMAL = IGG0191A EXCP, BSAM, QSAM, TSO DUMMY, BPAM            * 10800002
*               IGG0192A ISAM                                         * 10900002
*               IGG0193A BDAM                                         * 11000002
*               IGG0193M BTAM                                         * 11100002
*               IGG0193P GET/PUT DSORG = MQ                           * 11200002
*               IGG0193Y GRAPHICS                                     * 11300002
*               IGG0191C SAM NULL DUMMY                               * 11400002
*               IGG01935 TCAM LINE GROUP                              * 11500002
*               IGG01930 TCAM MESSAGE QUEUE                           * 11600002
*               IGG01946 TCAM DUMMY PS                                * 11700002
*               IGG0198B TCAM 3705                                    * 11800002
*               IGG0199F SPOOLED DCB EXECUTOR                         * 11900002
*               IGG0193K SPOOL ACB EXECUTOR                           * 12000002
*                                                                     * 12100002
* EXIT-ERROR =                                                        * 12200002
*        IFG0190P PROBLEM DETERMINATION                               * 12300002
*           913-28 ABEND - IMPROPER DATA SET ORG                      * 12400002
*                                                                     * 12500002
* EXTERNAL REFERENCES = SEE BELOW                                     * 12600002
*                                                                     * 12700002
*    ROUTINES = IFG019RA                                              * 12800002
*                                                                     * 12900002
*    DATA AREAS = NONE                                                * 13000002
*                                                                     * 13100002
*    CONTROL BLOCK = ACB, JFCB, DCB                                   * 13200002
*                                                                     * 13300002
* TABLES = OPEN, CLOSE, OR EOV WORK AREA                              * 13400002
*                                                                     * 13500002
* MACROS = IECRES, MODESET, IECDSECS                                  * 13600002
*                                                                     * 13700002
* CHANGE ACTIVITY = NEW RELEASE (LEVEL 0)                             * 13800002
*                                                                     * 13900002
*********************************************************************** 14000002
         EJECT                                                          25800021
         IECDSECS CVT,TCB,RB,TIOT,UCB,DCB,ACB,MAIN,PREFX,WTG,    Y02080*26000002
               DSAB,                                             Y02083*26010002
               RRPL                                              Y02144 26050002
ACBRCFM  EQU   X'7F'                    RECFM MASK                      26660000
TIOTSPOL EQU   X'06'                                                    26680000
TIOTSPIN EQU   X'04'                                                    26700000
EABD239  EQU   239                      913-28 INTERNAL ABEND CD Y02083 26710002
         IECEQU AOS=YES                                                 26720000
         USING IHADCB,RDCB              DEFINE BASE TO USER'S DCB       27000021
         USING UCB,RUCB                                                 27050002
         USING FORCORE,RCORE            DEFINE BASE TO MAIN WORK AREA   27200021
         USING TIOENTRY,RTIOT           DEFINE BASE TO TIOT DD ENTRY    27400021
         USING RRPLIST,RC                                        Y02144 27450002
*                                                                       27600021
         BALR  RBASE,0                  ESTABLISH BASE REGISTER         27800021
         USING *,RBASE                  DEFINE BASE REGISTER            28000021
*                                                                       28200021
*********************************************************************** 28400021
*                                                                       28600021
*  PARALLEL PROCESSING OF DCB'S BY THE RESIDENT ROUTINE STOPS HERE      28800021
*  SO THAT THE ACCESS METHOD EXECUTORS CAN WORK AS THEY HAVE WITHOUT    29000021
*  REQUIRING A CODING CHANGE.                                           29200021
*                                                                       29400021
*********************************************************************** 29600021
*                                                                       29800021
         USING WTG,RWTG                 DEFINE BASE TO XCTL/WTG TABLE   30200021
         L     RPAR,WTGPREFX            GET PTR TO WTG PREFIX    Y02080 30650002
         USING IECPREFX,RPAR                                     Y02080 30700002
         L     RC,IECRRPRM              GET RRPLIST PTR          Y02144 30710002
         L     RPAR,IECUPRML            LOAD PTR TO DCB PARM LST Y02080 30750002
         DROP  RPAR                                              Y02080 30760002
         LR    RPARC,RPAR               CURRENT DCB PARM ADDR           30800021
         USING USERPRML,RPARC                                    Y02080 30850002
*                                                                       31000021
         LA    RWTGC,WTGENTRY           CALC ADDR OF FIRST WTG ENTRY    31200021
         USING WTGENTRY,RWTGC           DEFINE BASE TO WTG ENTRY        31400021
*                                                                       31600021
         TM    RRFLAGS1,RRFAMEXG        FR AM EXECS VIA PROB DET Y02144 31650002
         BO    OMG91800                 BR YES, GO TO EXECS      Y02144 31750002
*                                                                Y02144 31760002
OMG90400 EQU   *                        PROCESS DCB                     31800002
         L     RCORE,WTGCORE-K1         LOAD ADDR DCB WORK AREA         32000021
         LA    RCORE,0(RCORE)           TEST IF THE DCB IS NOT          32200021
         LTR   RCORE,RCORE              BEING OPENED                    32400021
         BZ    OMG91200                 BR IF NOT BEING OPENED          32600021
*                                                                       32800021
         L     RDCB,DXUDCBAD            LOAD USER DCB ADDR     @ZA02899 32850003
         LA    RDCB,IHADCB              CLEAR HI BYTE          @ZA02899 32900003
         ST    RDCB,DXUDCBAD            SAVE USER DCB PTR      @ZA02899 32950003
*                                                                       32960003
         L     RDCB,0(,RPARC)           LOAD CURRENT DCB ADDR           33000021
         TM    DCBOFLGS,DCBOLOCK+DCBOBUSY CHK LOCK AND OPEN BITS YM1342 33000402
         BNO   OMG91200                 BR IF NOT STILL OPENING  YM1342 33000802
         L     RTIOT,DXREG9             LOAD CURRENT TIOT DD ADDR       33002021
*                                                                       33008033
*********************************************************************** 33008402
*                                                                     * 33008802
* TEST FOR ACB                                                          33009033
*                                                                     * 33009402
*********************************************************************** 33009802
*                                                                       33010033
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP           33011033
         BO    OMG90580                 YES, CANNOT BE AN ACB           33012033
*                                                                       33013033
         TM    DCBDSORG+K1,ACBDORGA     IS THIS AN ACB                  33014033
         BZ    OMG90410                 NO                              33015033
         CLI   ACBAMETH-IFGACB(RDCB),ACBVTAM IS THIS VTAM ACB?   YM3011 33015402
         BE    OMG91200                 YES, GO TO NEXT PARM     Y02004 33015902
*                                                                       33016033
* ASSUME SPOOLED SYSIN OR SYSOUT ACB                                    33017002
*                                                                       33018033
         B     OMG90420                 MEGE ACB                        33020002
*                                                                       33021033
*********************************************************************** 33031002
*                                                                     * 33033002
* TEST FOR SPOOLED SYSIN OR SYSOUT DCB                                  33040033
*                                                                     * 33040402
*********************************************************************** 33040802
*                                                                       33041033
OMG90410 EQU   *                        TEST FOR SPOOLED SYSIN/SYSOUT   33042002
         TM    TIOELINK,TIOTSPOL        IS THIS SPOOLED SYIN OR SYSOUT  33043033
         BZ    OMG90580                 NO                              33044033
*                                                                       33047033
         LA    RF,OMG9990X              POINT TO IDTTR OF TRANSLATE     33048033
         B     OMG91400                 MOVE IDDTR INTO CURR WTG ENTRY  33049002
*                                                                       33050033
*********************************************************************** 33050402
*                                                                     * 33050802
* SPOOLED ACB SET UP                                                    33051002
* BRANCH AND LINK TO ACB MERGE ROUTINE                                  33051102
*                                                                     * 33051402
*********************************************************************** 33051802
*                                                                       33052033
OMG90420 EQU   *                        SPOOLED ACB SET UP              33053002
         BAL   RET,OMG90450             EXECUTE MERGES AND ACB EXIT     33057033
         USING IFGACB,RACB                                              33058033
*                                                                       33059033
* SET UP LRECL WITH DEFAULT VALUE IF ZERO                               33060033
*                                                                       33061033
         CLC   ACBLRECL(K2),ZERO0000    IS LRECL ZERO            X02050 33062033
         BNE   OMG90430                 NO                              33063033
*                                                                       33064033
         CLC   ACBBLKSZ(K2),ZERO0000    IS BLKSIZE ZERO        @ZA04309 33064403
         BE    OMG90422                 YES,USE FIXED DEFAULTS @ZA04309 33064803
         MVC   ACBLRECL(K2),ACBBLKSZ    MOVE BLKSIZE TO LRECL  @ZA04309 33064903
         B     OMG90425                 CONTINUE               @ZA04309 33066203
*                                                              @ZA04309 33066603
OMG90422 MVI   ACBLRECL+K1,ACBOUTLN     PUT IN OUTPUT DEFAULT  @ZA04309 33067803
*                                                                       33069103
         TM    DXDCBLST-USERPRML(RPARC),PLISTOIN OUTPUT & OUTIN ZA00017 33070403
         BO    OMG90425                 BRANCH IF OUTPUT/OUTIN  ZA00017 33071703
*                                                                       33073003
         MVI   ACBLRECL+K1,ACBINLN      PUT IN DEFAULT FOR INPUT X02050 33074303
*                                                                       33075603
OMG90425 EQU   *                        MERGE TO JFCB           ZA00017 33076903
         OI    JFCBMASK+K3,JFCBLREC     LRECL SWITCH FOR CLOSE  ZA00017 33078203
         MVC   JFCLRECL(K2),ACBLRECL    MERGE TO JFCB           ZA00017 33079503
*                                                                       33080803
OMG90430 EQU   *                        ACBSPOOL EXECUTOR               33082103
         LA    RF,OMG0000X              POINT TO SPOOL EXECUTOR TTR     33083403
         B     OMG91400                 MOVE IDTTR INTO CURR WTG ENTRY  33084703
*                                                                       33086033
*********************************************************************** 33086402
*                                                                     * 33086802
* ACB MERGE ROUTINE                                                     33087033
*                                                                     * 33087402
*********************************************************************** 33087802
*                                                                       33088033
OMG90450 EQU   *                        ACB MERGE ROUTINE               33089002
         LR    RB,RET                   SAVE RETURN ADDRESS             33090033
         CLC   ACBLRECL(K2),ZERO0000    LRECL SPECIFIED IN ACB   X02050 33092033
         BNE   OMG90470                 YES, TEST FOR BLOCKSIZE         33093033
         MVC   ACBLRECL(K2),JFCLRECL    MERGE JFCB LRECL TO ACB  X02050 33094033
         OI    JFCBMASK+K3,JFCBLREC     SET LRECL SWITCH ON FOR MERGE   33095033
OMG90470 EQU   *                        TEST FOR BLOCKSIZE              33096002
         CLC   ACBBLKSZ(K2),ZERO0000    BLKSIZE SPECIFIED IN ACB X02050 33097033
         BNE   OMG90480                 YES, DO NOT MERGE               33098033
         MVC   ACBBLKSZ(K2),JFCBLKSI    MOVE JFCB BLKSIZE TO ACB X02050 33099033
         OI    JFCBMASK+K2,JFCBBKSZ     SET BLKSIZE SWITCH ON FOR MERGE 33100033
OMG90480 EQU   *                        DO NOT MERGE, BLKSIZE SPECIFIED 33101002
         CLC   ACBCCTYP(K1),ZERO0000    ARE CONTROL CHARACTERS SPECIF   33102033
         BNE   OMG90490                 YES, DO NOT MERGE               33103033
         MVC   ACBCCTYP(K1),JFCRECFM    MERGE CONTROL CHARACTERS CODE   33104033
         OI    JFCBMASK+K2,JFCBRCFM     SET RECFM SWITCH ON FOR MERGE   33105033
OMG90490 EQU   *                        CONTROL CHARACTERS SPECIFIED    33106002
         TM    ACBRECFM,ACBRCFM         IS RECORD FORMAT SPECIFIED      33107033
         BM    OMG90495                 YES  DO NOT MERGE               33108033
         ICM   RF,8,JFCRECFM            PICKUP RECFM FIELD              33109033
         SRL   RF,K1                    MAP JFCB RECFM TO ACB RECFM     33110033
         ICM   R1,8,ACBRECFM            SAVE HIGH ORDER BIT             33111033
         OR    RF,R1                    IF ON                           33112033
         STCM  RF,8,ACBRECFM            MERGE JFCB RECFM WITH ACB       33113033
         OI    JFCBMASK+K2,JFCBRCFM     SET RECFM SWITCH ON FOR MERGE   33114033
*                                                                       33116033
* GET POINTER TO USER EXIT LIST                                         33117033
*                                                                       33118033
OMG90495 EQU   *                        GET EXIT LIST POINTER           33118402
         L     RF,ACBUEL                GET USER EXIT LIST PTR   X02050 33119033
         LTR   RF,RF                    IS THERE AN EXIT LIST           33120033
         BZ    OMG90520                 NO, MERGE ACB TO DCB            33121002
*                                                                       33122033
* CHECK EXIT LIST FOR ACB EXIT ROUTINE                                  33123033
*                                                                       33124033
         USING IFGEXLST,RF                                       X02050 33125000
         MODESET KEYADDR=DXUKEY,WORKREG=14 TO LOOK AT EXIT LIST  Y02082 33125402
         CLI   EXLLEN+K1,EXLOPNL        ACB USER EXIT SPECIFIED  X02050 33127000
         BL    OMG90520                 NO, BYPASS USER EXIT     X02050 33127400
         TM    EXLOPNF,EXLACTV          ACB EXIT ACTIVE          X02050 33127800
         BZ    OMG90520                 NO, BYPASS USER EXIT     X02050 33127900
*                                                                       33128000
* SET UP TO TAKE USER ACB EXIT                                          33129000
*                                                                       33130000
         L     RET,EXLOPNP              GET ACB USER EXIT ADDR   X02050 33132002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGT KEY   Y02082 33132402
         NI    ACBOFLGS,X'FF'-DCBOLOCK  SET LOCK BIT FOR EXIT    Y02082 33132902
*                                                                Y02082 33133002
* COPY THE DCB FROM THE WORK AREA TO USER'S STORAGE              Y02082 33136402
*                                                                Y02082 33138002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(3,14,WTGPREFX)          Y02082 33139602
*                                                                Y02082 33141202
         IECRES UEXIT,EXITAD=(RET),REG1=DXUDCBAD,                      *33142802
               STM=(2,13,WTGPREFX)                               Y02082 33144402
         OI    ACBOFLGS,DCBOLOCK        RESET ACB LOCK BIT       Y02082 33151402
*                                                                Y02082 33151802
* COPY THE DCB FROM THE USER'S STORAGE TO OUR WORK AREA          Y02082 33167002
*                                                                Y02082 33174602
         IECRES INIT,DCBCOPY=TOWKAR,STM=(3,14,WTGPREFX)          Y02082 33178402
*                                                                Y02082 33182202
         L     RDCB,DXUDCBAD            GET PTR TO USER'S DCB    Y02082 33186002
         MODESET KEYADDR=DXUKEY,WORKREG=1 ASSUME USER'S KEY      Y02082 33189802
         OI    ACBOFLGS,DCBOLOCK        SET LOCK BIT             Y02082 33193602
*                                                                Y02082 33197402
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 33201202
         L     RDCB,DXPDCBAD            POINT TO COPIED DCB      Y02082 33205002
*                                                                       33208802
* MERGE ACB TO JFCB                                                     33212602
*                                                                       33216402
OMG90520 EQU   *                        ACB TO JFCB MERGE               33220202
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 33224002
         TM    JFCBTSDM,K2              IS ACB TO JFCB MERGE OK         33227802
         BO    OMG90540                 NO                              33231602
         TM    0(RPARC),PARMININ        IS IT INPUT OR INOUT            33235402
         BZ    OMG90550                 YES                             33239202
*                                                                       33243002
         MVC   JFCLRECL(K2),ACBLRECL    MERGE ACB LRECL TO JFCB  X02050 33246802
         MVC   JFCBLKSI(K2),ACBBLKSZ    MOVE ACB BLKSIZE TO JFCB X02050 33250602
OMG90530 EQU   *                        MERGE RECFM                     33254402
         IC    RF,ACBRECFM              POCKUP ACB RECFM FIELD          33258202
         SLL   RF,K1                    MAP ACB RECFM TO JFCB RECFM     33262002
         STC   RF,JFCRECFM              MERGE ACB RECFM TO JFCB RECFM   33265802
         OC    JFCRECFM,ACBCCTYP        MERGE ACB CCTYPE TO JFCB RECFM  33269602
*                                                                       33273402
         OI    JFCBMASK+K4,JFCBMOD      TURN ON JFCB MODIFIED SWITCH    33277202
*                                                                       33281002
* RETURN TO CALLER                                                      33284802
*                                                                       33288602
OMG90540 EQU   *                        RETURN TO CALLER                33292402
         LR    RET,RB                   RESTORE RETURN ADDRESS          33296202
         BR    RET                      RETURN TO CALLER                33300002
*                                                                       33303802
*                                                                       33307602
*                                                                       33311402
OMG90550 EQU   *                        YES IS INPUT OR INOUT           33315202
         CLC   JFCLRECL(K2),ZERO0000    IS JFCB LRECL ZERO              33319002
         BNE   OMG90560                 NO TEST BLKSIZE                 33322802
         MVC   JFCLRECL(K2),ACBLRECL    MERGE ACB LRECL TO JFCB  X02050 33326602
         OI    JFCBMASK+K4,JFCBMOD      TURN ON JFCB MODIFIED SWITCH    33330402
*                                                                       33334202
OMG90560 EQU   *                        TEST JFCB BLKSIZE               33338002
         CLC   JFCBLKSI(K2),ZERO0000    IS JFCB BLKSIZE ZERO            33341802
         BNE   OMG90570                 NO TEST RECFM FOR CONTROL CHAR  33345602
         MVC   JFCBLKSI(K2),ACBBLKSZ    MOVE ACB BLKSIZE TO JFCB X02050 33349402
         OI    JFCBMASK+K4,JFCBMOD      TURN ON JFCB MODIFIED SWITCH    33353202
OMG90570 EQU   *                        TEST RECFM FOR CONTROL CHAR     33357002
         CLC   JFCRECFM,ZERO0000        IS JFCB RECFM ZERO              33360802
         BE    OMG90530                 YES MERGE RECFM                 33364602
         BNE   OMG90540                 NO  RETURN                      33368402
OMG90580 EQU   *                        VSAM OR EXCP, NOT SPOOLED       33372202
         USING IHADCB,RDCB                                              33376002
*                                                                       33380802
*********************************************************************** 33650002
*                                                                     * 33700002
*  DETERMINE EXECUTOR MODULE TO PROCESS THIS DCB AND STORE ITS ID TTR   33800021
*  IN THE WTG TABLE ENTRY FOR THIS DCB.                                 34000021
*                                                                     * 34050002
*********************************************************************** 34100002
*                                                                       34200021
         L     RTIOT,DXREG9             LOAD CURRENT TIOT DD ADDR       34400021
*                                                                       34600021
         LA    RF,OMG9740X              POINT TO EXCP EXECUTOR IDTTR    34800021
         TM    DCBMACRF,DCBMEXCP        TEST IF EXCP DCB                35000021
         BO    OMG91400                 BR IF YES                       35200021
*                                                                       35400021
         TM    DCBDSORG,DCBORGPS        TEST IF DSORG=PS DATA SET       35600021
         BZ    OMG90800                 BR IF NO                        35800021
*                                                                       36000021
OMG90600 EQU   *                        DSORG NOT MQ                    36200002
         LA    RF,OMG9740X              POINT TO PS BSAM/QSAM IDTTR     36400021
*                                                                       36600021
         TM    JFCBMASK+K4,JFCMNULL     TEST IF DUMMY DATA SET          36800021
         BZ    OMG91400                 BR IF NO, ORDINARY PS           37000021
*                                                                       37200021
         LA    RF,OMG9960X              POINT TO TCAM DUMMY PS IDTTR    37400021
         TM    TIOELINK,TIOEQNAM        TEST IF TCAM DUMMY              37600021
         BO    OMG91400                 BR IF YES                       37800021
*                                                                       38000021
         LA    RF,OMG9740X              POINT TO TSO DUMMY PS IDTTR     38200021
         TM    TIOELINK,TIOTTERM        TEST IF TSO DUMMY PS            38400021
         BO    OMG91400                 BR IF YES                       38600021
*                                                                       38800021
         LA    RF,OMG9900X              POINT TO BSAM/QSAM DUMMY PS     39000021
         B     OMG91400                 BR TO SET UP ORDINARY PS DUMMY  39200021
*                                                                       39400021
OMG90800 EQU   *                        DSORG NOT PS                    39600002
         LA    RF,OMG9740X              POINT TO BPAM EXECUTOR IDTTR    39800021
         TM    DCBDSORG,DCBORGPO        TEST IF DSORG=PO                40000021
         BO    OMG91400                 BR IF YES                       40200021
*                                                                       40400021
         LA    RF,OMG9760X              POINT TO BISAM/QISAM IDTTR      40600021
         TM    DCBDSORG,DCBORGIS        TEST IF DSORG=IS                40800021
         BO    OMG91400                 BR IF YES                       41000021
*                                                                       41200021
         LA    RF,OMG9780X              POINT TO BDAM EXECUTOR IDTTR    41400021
         TM    DCBDSORG,DCBORGDA        TEST IF DSORG=DA                41600021
         BO    OMG91400                 BR IF YES                       41800021
*                                                                       42000021
         LA    RF,OMG9880X              POINT TO GRAPHICS IDTTR         42200021
         TM    DCBDSORG+K1,DCBORGGR     TEST IF DSORG=GS                42400021
         BO    OMG91400                 BR IF YES                       42600021
*                                                                       42800021
         TM    DCBDSORG,DCBORGCX        TEST IF DSORG=CX                43000021
         BZ    OMG91000                 BR IF NO                        43200021
*                                                                       43400021
*                                                                       43452000
*        THE HIGH ORDER BIT OF DXREG1 MUST BE ZERO WHEN CONTROL IS      43454000
*        TRANSFERRED TO THE BTAM EXECUTORS.                             43456000
*                                                                       43458000
         MVI   DXREG1,K0                ZERO BIT FOR BTAM        XM5598 43500000
*                                       EXECUTOR                        43502000
         LA    RF,OMG9820X              POINT TO BTAM EXECUTOR IDTTR    43600021
         B     OMG91400                 BR TO SET UP BTAM IDTTR         45000002
*                                                                       45200021
OMG91000 EQU   *                        DSORG NOT CX                    45400002
         LA    RF,OMG9920X              POINT TO TCAM LINE GROUP IDTTR  45600021
         TM    DCBDSORG+K1,DCBORGTX     TEST IF DSORG=TX                45800021
         BO    OMG91400                 BR IF YES                       46000021
*                                                                       46200021
         LA    RF,OMG9940X              POINT TO TCAM MESSAGE QUEUE     46400021
         TM    DCBDSORG+K1,DCBORGTQ     TEST IF DSORG=TQ                46600021
         BO    OMG91400                 BR IF YES                       46800021
*                                                                       47000021
         LA    RF,ID6V8B                POINT TO TCAM 3705 EXEC  S22024 47050002
         TM    DCBDSORG+K1,DCBDSGTR     TEST IF DSORG = TR       S22024 47100002
         BO    OMG91400                 YES, SET UP 3705 EXEC    S22024 47150002
*                                                                       47200002
         TM    DCBDSORG,DCBORGMQ        TEST IF DSORG=MQ                48200021
         BZ    OMG90600                 BR IF NO, DEFAULT TO PS  M1158  48400021
         LA    RF,OMG9960X              PT TO TCAM DUMMY IDTTR   M1158  48700021
         B     OMG91400                 BR TO SET IDTTR          M1158  48800021
*                                                                       49200021
OMG91200 EQU   *                        NOT BEING OPENED                49400002
*                                       CLEAR MODULE ID SO THAT THE     49600021
         XC    WTGIDTTR,WTGIDTTR        EXECTORS WILL NOT PROCESS DCB   49800021
         B     OMG91600                 BR TO ADVANCE TO NEXT DCB       50000021
*                                                                       50200021
*********************************************************************** 50400021
*                                                                       50600021
*  MOVE ACCESS METHOD ID TTR INTO CURRENT DCB'S WTG TABLE ENTRY         50800021
*                                                                     * 50810002
*********************************************************************** 50850002
*                                                                       51000021
OMG91400 EQU   *                                                        51200021
         MVC   WTGIDTTR,0(RF)           MOVE IDTTR INTO WTG TABLE       51400021
*                                       ZERO DCB ADDR IN XCTL PARM LIST 51410002
         XC    DXCCW12+K4(K4),DXCCW12+K4  USED BY A.M.E. TO XCTL        51450002
*                                                                Y02082 51500002
* COPY THE DCB FROM THE WORK AREA TO USER'S STORAGE              Y02082 51550002
*                                                                     * 51560002
*********************************************************************** 51570002
*                                                                Y02082 51600002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(3,14,WTGPREFX)          Y02082 51650002
*                                                                       52000021
*********************************************************************** 52005002
*              IF THIS IS A CHECK POINT DATA SET ESTABLISH THE        * 52010002
*              SECURITY INTERFACE.                                    * 52015002
*********************************************************************** 52020002
         L     RD,DXDSAB                DSAB ADR                 Y02083 52025002
         USING DSAB,RD                                           Y02083 52030002
         TM    DSABFLG4,DSABCKVL        SECURE CHK PT VOL REF    Y02083 52035002
         BO    OMG91420                 YES, SEE IF S/I NEEDED   YM5932 52040002
         MODESET EXTKEY=SCHED           ASSUME DSAB KEY          YM5932 52040502
         NI    DSABFLG4,X'FF'-DSABCKSI  RESET RESIDUAL S/I FLAG  YM5932 52041002
         MODESET EXTKEY=DATAMGT         RESUME D/M KEY           YM5932 52041502
         B     OMG91600                 CONTINUE NON-S/I OPEN    YM5932 52042002
OMG91420 EQU   *                        TEST FOR NEEDED S/I      YM5932 52042502
         TM    DSABFLG4,DSABCKSI        SECURITY INTERFACE EST   Y02083 52045002
         BO    OMG91500                 YES BYPASS AUTHOR. TEST  Y02083 52050002
         DROP  RD                                                Y02083 52055002
         TESTAUTH FCTN=1,KEY=YES,STATE=YES                       YM6538 52060002
         LTR   RF,RF                    USER AUTHORIZED          Y02083 52065002
         BZ    OMG91600                 YES CONTINE NORMAL PROC  Y02083 52070002
OMG91500 EQU   *                        TEST FOR PROPER DSORG    Y02083 52075002
*********************************************************************** 52080002
*              TEST FOR PROPER DATA SET ORGANIZATION                  * 52085002
*********************************************************************** 52090002
         TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP DCB        Y02083 52095002
         BO    OMG91505                 YES, ABEND               Y02083 52100002
         TM    DCBDSORG,DCBORGPS        DSORG=PS                 Y02083 52105002
         BO    OMG91510                 YES BUILD SECURITY INT   Y02083 52110002
         TM    DCBDSORG,DCBORGPO        DSORG=PO                 Y02083 52115002
         BO    OMG91510                 YES BUILD SECURITY INT   Y02083 52120002
*********************************************************************** 52125002
*              IMPROPER DATA SET ORG ABEND 913-28                     * 52130002
*********************************************************************** 52135002
OMG91505 EQU   *                        ISSUE 913-28 ABEND       Y02083 52140002
         LA    R0,EABD239               LOAD INTERNAL ABEND CDE  Y02083 52145002
         MVC   DXCALLID,OMGDUMMY        SET UP IFG019XX          Y02083 52150002
         IECRES LOAD,MODID=ID6V0P,BRANCH=DIRECT,PREFIX=WTGPREFX  Y02083 52155002
*********************************************************************** 52160002
*              GET STORAGE FOR PROTECTED DCB (SECURE INTERFACE)       * 52165002
*********************************************************************** 52170002
OMG91510 EQU   *                        GET CORE FOR PROT'D DCB  Y02083 52175002
         TM    DCBMACRF,DCBMREAD        IS IT BSAM READ          YM3806 52180002
         BO    OMG91515                 YES, CONTINUE            YM3806 52185002
         TM    DCBMACRF+K1,DCBMWRIT     IS IT BSAM WRITE         YM3806 52190002
         BNO   OMG91505                 NOT BSAM, ABEND          YM3806 52195002
OMG91515 EQU   *                        BUILD SECURITY INTERFACE YM3806 52200002
         XC    DCBEXLSA,DCBEXLSA        ZERO EXIT LIST, CHKPT SI YM3863 52205002
         LH    RD,DXUDCBPL              COMPUTE GETMAIN SIZE     Y02083 52210002
         AH    RD,DXUDCBML              PREFIX + MOVED DCB       Y02083 52215002
         LA    RD,K4(RD)                + 4 BYTES FOR POINTER    Y02083 52220002
         LA    RD,L'CKSITEXT(RD)        + LENGTH OF EXPLANATORY  YM5766X52222002
                                        TEXT PRECEDING THE DCB   YM5766 52224002
         IECRES GET,LV=(RD),SP=252,KEY=0,ID=SCHK,                Y02083*52225002
               PREFIX=NO,STM=(2,14,WTGPREFX)                     YM3947 52230002
*********************************************************************** 52235002
*              BUILD SECURE DCB IN GOTTEN STORAGE                     * 52240002
*********************************************************************** 52245002
         MVC   K0(L'CKSITEXT,R1),CKSITEXT  MOVE IN TEXT          YM5766 52246002
         LA    R1,L'CKSITEXT(R1)        INCREMENT PAST THIS TEXT YM5766 52247002
         STC   RD,K0(,R1)               SAVE GETMAIN LENGTH      YM7828 52249002
         MVC   K1(K3,R1),DXUDCBAD+K1    SAVE PTR TO USERS DCB    YM7828 52250002
         LA    R1,K4(R1)                INCR PAST PTR            Y02083 52255002
         ST    R1,DXUDCBAD              SI DCB BECOMES USERS DCB Y02083 52260002
         AH    R1,DXUDCBPL              COMPUTE FIRST MOVE LOC   Y02083 52265002
         L     RF,DXPDCBAD              ADR OF DCB TO COPY       Y02083 52270002
         AH    RF,DXUDCBPL              STEP TO FIRST MOVE LOC   Y02083 52275002
         LH    RD,DXUDCBML              NUMBER OF BYTES TO MOVE  Y02083 52280002
         BCTR  RD,R0                    DECREMENT FOR MOVE       YM2874 52285002
         EX    RD,OMG91520              EXECUTE DCB MOVE         Y02083 52290002
         L     RD,DXDSAB                LOAD DSAB ADDRESS        YM5363 52295002
         MODESET EXTKEY=SCHED           SWITCH TO SCHEDULER KEY  YM5363 52300002
         OI    DSABFLG4-DSAB(RD),DSABCKSI SET SECURITY INTERFACE YM5363X52305002
                                        ESTABLISHED BIT IN DSAB  YM5363 52310002
         MODESET EXTKEY=DATAMGT         GET INTO DATA MGT KEY    Y02083 52315002
         MVI   DXUKEY,K0                SET USER KEY TO ZERO     Y02083 52320002
         B     OMG91600                 CONTINUE NORMAL PROC     Y02083 52325002
*                                                                       52330002
OMG91520 EQU   *                        MOVE COPY OF USERS DCB   Y02083 52335002
         MVC   K0(K0,R1),K0(RF)         MOVE COPY OF USERS DCB   Y02083 52340002
OMG91600 EQU   *                                                        52345002
         LA    RWTGC,L'WTGENTRY(RWTGC)  ADVANCE TO NEXT WTG ENTRY       52400021
         TM    0(RPARC),LASTNTRY        TEST IF LAST DCB IN PARM LIST   52600021
         LA    RPARC,K4(RPARC)          ADVANCE TO NEXT DCB IN PARM     52800021
         BZ    OMG90400                 BR IF NO TO PROCESS NEXT DCB    53000021
*                                                                       53200021
*********************************************************************** 53250002
*                                                                       53300002
*  SET UP ID TTR OF LAST LOAD FOR USE BY ACCESS METHOD EXECUTORS        53400021
*  IN TERMINATING THEIR EXECUTION AND RETURNING TO THE OPEN MODULES.    53600021
*  IT IS STORED IN THE VERY LAST WTG ENTRY, WHICH IS ONE                53800021
*  MORE ENTRY THAN DCB'S IN THE OPEN PARAMETER LIST.                    54000021
*  NOTE THAT THE ID MUST BE 0S, SINCE THE EXECUTORS TEST FOR            54200021
*  THIS RATHER THAN TEST THE X'80' BIT IN THE DCB PARAMETER LIST.       54400021
*                                                                       54450002
*********************************************************************** 54500002
*                                                                       54600021
         MVC   WTGIDTTR,OMG9720X        ID FOR OPEN FINAL LOAD          54800021
*                                                                       55200021
*  XCTL TO OPEN EXECUTOR.                                               55400021
*                                                                       55600021
*  EVERY DCB BEING OPENED GOES TO AN EXECUTOR.  HOWEVER, DCBS           55800021
*  THAT ARE NOT OPENABLE HAVE A ZERO WTG TABLE ENTRY.                   56000021
*                                                                       56400021
         LR    RPARC,RPAR               POINT TO START OF DCB LIST      56600021
         LA    RWTGC,WTGENTRY-WTG(,RWTG)  POINT TO START OF WTG ENTRIES 56800021
*                                                                       57000021
OMG91800 EQU   *                        CHECK WTG ENTRY                 57200002
         CLI   WTGIDTTR,K0              IS THIS ENTRY ZERO              57400021
         BNE   OMG92000                 BR IF NO TO XCTL TO IT          57600021
         LA    RWTGC,L'WTGENTRY(RWTGC)  ADVANCE TO NEXT WTG ENTRY       57800021
         LA    RPARC,K4(RPARC)          ADVANCE TO NEXT DCB IN LIST     58000021
         B     OMG91800                 BR TO CHECK NEXT WTG ENTRY      58200021
*                                                                       58400021
OMG92000 EQU   *                        ENTRY NOT ZERO                  58600002
         MVI   WTGMODNM+K1,C'G'         CHANGE XCTL NAME TO IGG019XX    58800021
         MVC   WTGMODID,WTGIDTTR        ID OF EXECUTOR TO XCTL TABLE    59000021
         MVC   WTGMODEP+K1(K3),WTGIDTTR+K2 TTR OF NEXT MODULE    Y02080 59200002
         MVC   WTGATTRB(K7),WTGCONSI    SET PSEUDO BLDL LIST FOR        59210002
*                                       XCTLING BY EXECUTORS            59220002
*                                                                YM1342 59410002
*  NOTE: IT IS POSSIBLE TO BE AT THIS POINT WITH THE WTGMODNM    YM1342 59420002
*        FIELD CONTAINING THE NAME IGG0190S, INDICATING THAT     YM1342 59430002
*        THE ONLY NON-ZERO ID LEFT IN A WTG ENTRY WAS '0S' IN    YM1342 59480002
*        THE LAST WTG ENTRY. CONTROL WILL BE GIVEN TO IGG0190S   YM1342 59490002
*        (AN ALIAS FOR IFG0196W, NOT AN EXECUTOR) FOR SETTING    YM1342 59520002
*        THE CORRECT ENTRY OFFSET TO IFG0198N.                   YM1342 59530002
*                                                                Y02082 59592002
*                                       DEBUG SERVICE AID - MODULE      59800021
         LM    R0,R1,WTGMODNM           NAME IN SVC TRACE TABLE REGS    60000021
         L     RC,WTGPREFX              GET BASE PREFIX PTR      YM1342 60050002
         L     RC,IECRRPRM-IECPREFX(RC) GET RRPLIST PTR          YM1342 60060002
         OI    RRFLAGS1,RRFAMEXG        SHOW GOING TO A.M. EXECS Y02144 60100002
*                                                                       60200021
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT               Y02080 60450002
*                                       XCTL TO EXECUTOR MODULE  Y02080 60500002
*                                                                       60600021
         DROP  RWTG,RWTGC                                               60800021
*                                                                       61000021
*********************************************************************** 61200021
*                                                                       61400021
*        CONSTANTS                                                      61600021
*                                                                       61640000
WTGCONSI DC    X'C379'                  MODULE ATTRIBUTES               61660000
         DC    X'000400'                MODULE SIZE                     61680000
         DC    X'0400'                  TEXT LENGTH                     61700000
CKSITEXT DC    CL24'CHECKPOINT PROTECTED DCB'  EXPLANATORY TEXT  YM5766 61710002
ZERO0000 DC    F'0'                     ZERO CONSTANT                   61720000
*                                                                       61740000
*                                                                       61800021
OMG9700X XCTLTABL ID=(OMGDUMMY,6V,ID6V0P,0P,,FFFF,OMG9740X,1A,   Y02080X61850002
               OMG9760X,2A,OMG9780X,3A,OMG9820X,3M,OMG9880X,3Y,  Y02080X61900002
               OMG9920X,35,OMG9940X,30,OMG9960X,46,OMG9900X,1C,  Y02080X66250002
               OMG9990X,9F,OMG0000X,3K,OMG9720X,0S,ID6V8B,8B),   Y02080X66300002
               BRT=YES,LENGTH=                                   Y02080 66400002
         EJECT                                                   YM5363 70600002
         IFGEXLST                                                X02050 70710000
         SPACE 2                                                 YM5363 70720002
         IECDSECS EXPAND=YES            EXPAND DESIRED DSECTS HERE      70800021
*                                                                       71000021
         END                                                            81000000
