         TITLE 'IFG0199D - OPEN/CLOSE/EOV ABEND INTERPRETATION AND RECO*00200021
               VERY TRACE ROUTINE'                                      00400021
         COPY  LCGASMSW                                                 00450000
IFG0199D CSECT                                                          01000021
         ENTRY IFG0209D                                                 01050002
         ENTRY IFG0239D                                                 01100002
         ENTRY IFG0559D                                                 01150002
IFG0209D EQU   IFG0199D                 ALIAS ENTRY POINT        Y02080 01160002
IFG0239D EQU   IFG0199D                 ALIAS ENTRY POINT        Y02080 01170002
IFG0559D EQU   IFG0199D                 ALIAS ENTRY POINT        Y02080 01180002
*********************************************************************** 01230002
*                   VS2 RELEASE 037 CHANGES                           * 01280000
*D85798002,86250002                                            @ZA32987 01290000
*                                                                     * 01300000
*********************************************************************** 01310000
* MODULE NAME = IFG0199D (OS/VS2)                                     * 01330002
*                                                                     * 01380002
* DESCRIPTIVE NAME = OPEN/CLOSE/EOV ABEND INTERPRETATION AND RECOVERY * 01430002
*                    TRACE ROUTINE                                    * 01450002
*                                                                     * 01480002
* COPYRIGHT = NONE                                                    * 01530002
*                                                                     * 01580002
* STATUS = RELEASE 2, LEVEL 0                                         * 01630002
*                                                                     * 01680002
* FUNCTION =                                                          * 01730002
*        1. USE THE PROBLEM DETERMINATION CODE AS A BRANCH TABLE      * 01740002
*        OFFSET TO DETERMINE THE DATA TO BE TRACED.  DATA IS          * 01750002
*        TRACED BY ISSUING THE GRACE MACRO.  REGISTER D IS USED       * 01760002
*        FOR THE BRANCH TABLE OFFSET.  THE INFORMATION TRACED IS:     * 01770002
*           CODE      DATA TRACED                                     * 01772002
*           0  (0)    EXIT TO NEXT MODULE                             * 01774002
*           4  (4)    IOB, CCW'S                                      * 01776002
*           8  (8)    TIOT DD ENTRY, UCB'S                            * 01778002
*           12 (C)    JFCB VOLID'S                                    * 01778402
*           16 (10)   TAPE LABEL                                      * 01778802
*           20 (14)   JFCB DSN, TAPE LABEL                            * 01779202
*           24 (18)   DA VOLUME LABEL                                 * 01779602
*           28 (1C)   DSCB(S)                                         * 01779702
*           32 (20)   EXIT TO NEXT MODULE                             * 01779802
*           36 (24)   EXIT TO NEXT MODULE                             * 01789802
*           40 (28)   DCB                                             * 01799802
*           44 (2C)   EXIT TO NEXT MODULE                             * 01799902
*           48 (30)   EXIT TO NEXT MODULE                             * 01809902
*           52 (34)   DCB, DSCB                                       * 01819902
*           56 (38)   JFCB ELEMENT NAME                               * 01823202
*           60 (3C)   DCB EXIT LIST                                   * 01825202
*           64 (40)   DCB, TAPE LABEL                                 * 01825602
*           68 (44)   JFCB DSNAME, DCB                                * 01826002
*           72 (48)   JFCB DSNAME                                     * 01826402
*           76 (4C)   JFCB VOLID'S, DSCB                              * 01826502
*                                                                     * 01826602
*        2. EXITS TO NEXT MODULE IN PROBLEM DETERMINATION.            * 01832402
*                                                                     * 01844202
* NOTES = SEE BELOW                                                   * 01850002
*                                                                     * 01880002
*    DEPENDENCIES =                                                   * 01930002
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 01980002
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 02030002
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 02080002
*                                                                     * 02130002
*    RESTRICTIONS = NONE                                              * 02180002
*                                                                     * 02230002
*    REGISTER CONVENTIONS =                                           * 02280002
*            R2 POINTS TO DCB                                         * 02330002
*            R4 POINTS TO OPEN WORK AREA                              * 02380002
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 02430002
*            R6 POINTS TO THE WTG TABLE                               * 02480002
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 02530002
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 02580002
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 02630002
*            R10 POINTS TO THE UCB                                    * 02680002
*                                                                     * 02730002
*    PATCH LABEL = SEE NEXT TO LAST LABEL BEFORE ORG STATEMENT AT END * 02780002
*                  OF LISTING.                                        * 02830002
*                                                                     * 02880002
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 02930002
*                                                                     * 02980002
*    PROCESSOR = ASSEMBLER XF                                         * 03030002
*                                                                     * 03080002
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 03130002
*                  ORG STATEMENT AT END OF LISTING                    * 03180002
*                                                                     * 03230002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 03280002
*                  PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY, * 03330002
*                  LINK PACK AREA RESIDENT/PAGEABLE                   * 03380002
*                                                                     * 03430002
* ENTRY POINT = IFG0199D FOR OPEN                                     * 03480002
*               IFG0209D FOR CLOSE                                    * 03490002
*               IFG0239D FOR TCLOSE                                   * 03500002
*               IFG0559D FOR EOV                                      * 03510002
*                                                                     * 03530002
*    PURPOSE = SEE FUNCTION                                           * 03580002
*                                                                     * 03630002
*    LINKAGE = R1 POINTS TO PROBLEM DETERMINATION WORK AREA.          * 03680002
*              R2,R4-R10 SAME AS WHEN PROBLEM DETERMINATION CALLED.   * 03690002
*              PROBLEM DETERMINATION CODE IN WORK AREA.               * 03700002
*                                                                     * 03730002
* INPUT = SEE FUNCTION AND LINKAGE.                                   * 03780002
*                                                                     * 03830002
* OUTPUT = TRACE DATA.                                                * 03880002
*          TRACE CODE IN PROBLEM DETERMINATION WORK AREA.             * 03890002
*                                                                     * 03930002
* EXIT-NORMAL = IFG0199E FOR OPEN                                     * 03980002
*               IFG0209E FOR CLOSE                                    * 03990002
*               IFG0239E FOR TCLOSE                                   * 04000002
*               IFG0559E FOR EOV                                      * 04010002
*                                                                     * 04030002
* EXIT-ERROR = NONE                                                   * 04080002
*                                                                     * 04130002
* EXTERNAL REFERENCES = SEE BELOW                                     * 04180002
*                                                                     * 04230002
*    ROUTINES = IFG019RA                                              * 04280002
*               LOCK ROUTINE                                          * 04290002
*               GTRACE MONITOR CALL                                   * 04300002
*                                                                     * 04330002
*    DATA AREAS = PROBLEM DETERMINATION WORK AREA                     * 04380002
*                 OPEN/CLOSE/EOV WORK AREA                            * 04390002
*                                                                     * 04430002
*    CONTROL BLOCKS = CVT                                             * 04480002
*                     DCB                                             * 04485002
*                     DSCB                                            * 04490002
*                     IOB                                             * 04495002
*                     JFCB                                            * 04500002
*                     SVRB                                            * 04505002
*                     TCB                                             * 04510002
*                     TIOT                                            * 04515002
*                     UCB                                             * 04520002
*                                                                     * 04530002
* TABLES = DCB EXIT LIST                                              * 04580002
*                                                                     * 04630002
* MACROS = GTRACE                                                     * 04680002
*          IECDSECS                                                   * 04685002
*          IECPDSCT                                                   * 04690002
*          IECRES LOAD                                                * 04695002
*          MODESET                                                    * 04700002
*          SETLOCK                                                    * 04705002
*          XCTLTABL                                                   * 04710002
*                                                                     * 04730002
* CHANGE ACTIVITY = NEW RELEASE (LEVEL 0)                             * 04780002
*                                                                     * 04830002
*********************************************************************** 04880002
         EJECT                                                          04930002
R0       EQU   0                        WORK/PARAMETER REG              15400021
R1       EQU   1                        WORK/PARAMETER REG              15600021
RDCB     EQU   2                        PTR TO DCB                      15800021
RBASE    EQU   3                        BASE REG                        16000021
RCORE    EQU   4                        O/C/EOV WKAREA PTR              16200021
RWTG     EQU   6                        PTR TO WTG TABLE                16600021
RPARC    EQU   7                        PTR TO PARALIST CURRENT ENTRY   16800021
RWTGC    EQU   8                        PTR TO WTG TABLE CURRENT ENTRY  17000021
RTIOT    EQU   9                        PTR TO TIOT ENTRY               17200021
RUCB     EQU   10                       PTR TO UCB                      17400021
RB       EQU   11                       WORK/PARAMETER REG              17600021
RC       EQU   12                       WORK/PARAMETER REG              17800021
RD       EQU   13                       WORK/PARAMETER REG              18000021
RET      EQU   14                       WORK/PARAMETER REG              18200021
RF       EQU   15                       WORK/PARAMETER REG              18400021
ONE      EQU   1                        WORK VALUE                      18748302
ORG      EQU   0                        WORK VALUE                      18800021
IOBLNG   EQU   44                       LNG OF IOB IN O/C/EOV WKAREA    19000021
CCWLNG   EQU   8                        LNG OF CCW                      19200021
TIC      EQU   X'08'                    CHANNEL COMMAND CODE OF TIC     19400021
FOUR     EQU   4                        WORK VALUE                      19600021
ZERO     EQU   0                        WORK VALUE                      19800021
TWO      EQU   2                        WORK VALUE                      20000021
UCBLNG   EQU   60                       LNG OF DA UCB                   20200002
DEXITLNG EQU   4                        LNG OF DCB EXIT LIST ENTRY      20600021
JVOLLNG  EQU   30                       LNG OF JFCBVOLS FIELD           21400021
LBLLNG   EQU   80                       LNG OF TAPE LABEL               21600021
DSNLNG   EQU   44                       MAXIMUM LNG OF DSNAME           21800021
DSCBLNG  EQU   96                       LNG OF F1 DSCB                  22000021
CDCHN    EQU   X'C0'                    CCW FLAGS INDICATING CHAINING   22200021
FIDLNG   EQU   2                        LNG OF FORMAT ID                22400021
CURRTCB  EQU   4                        CURRENT TCB ADDR OFFSET  Y02082 22650002
IOBCOD   EQU   4                        TRACE CODE FOR IOB              22800021
CCWCOD   EQU   32                       TRACE CODE FOR CCWS             23000021
TIOCOD   EQU   8                        TRACE CODE FOR TIOT ENTRY       23200021
UCBCOD   EQU   36                       TRACE CODE FOR UCB              23400021
JVOLCOD  EQU   12                       TRACE CODE FOR JFCBVOLS         23600021
TLBLCOD  EQU   16                       TRACE CODE FOR TAPE LABEL       23800021
JDSNCOD  EQU   20                       TRACE CODE FOR JFCB DSNAME      24000021
VLBLCOD  EQU   24                       TRACE CODE FOR VOLUME LABEL     24200021
DSCBCOD  EQU   28                       TRACE CODE FOR F1 DSCB          24400021
DCBCOD   EQU   40                       TRACE CODE FOR DCB              24600021
JELNMCOD EQU   52                       TRACE CODE FOR JFCBELNM         24800021
DEXITCOD EQU   56                       TRACE CODE FOR DCBEXLST ENTRY   25000021
ELNMLNG  EQU   8                        LNG OF JFCBELNM                 25400021
LAST     EQU   X'80'                    BIT IN DCB EXIT LAST INDICATING 25600021
*                                       LAST ENTRY                      25800021
THREE    EQU   3                        WORK VALUE                      26000021
F2HXCODE EQU   X'02'                    F2 DSCB FORMAT ID               26600021
F3HXCODE EQU   X'03'                    F3 DSCB FORMAT ID               26800021
F1CODE   EQU   X'F1'                    F1 DSCB FORMAT ID               27000021
F2DSCBCD EQU   X'58'                    TRACE CODE FOR F2 DSCB          27200021
F3DSCBCD EQU   X'5C'                    TRACE CODE FOR F3 DSCB          27400021
F23DSCLN EQU   44                       LNG OF FIRST PART OF F2 AND F3  27600021
*                                       DSCBS THAT ARE TRACED           27800021
F3COD2   EQU   X'68'                    TRACE CODE FOR LAST 96 BYTES OF 28400021
*                                       F3 DSCB                         28600021
         BALR  RBASE,R0                 ESTABLISH ADDRESSABILITY        28800021
         USING *,RBASE                                                  29000021
         USING FORCORE,RCORE                                            29200021
         USING PDDSECT,R1                                               29400021
         USING TIOT,RTIOT                                               29600021
         USING IHADCB,RDCB                                              30000021
         USING WTG,RWTG                                         XM8309  30100002
         MVC   PDTRCFID(FIDLNG),OCEFID  MOVE FORMAT ID TO BUFFER        30200021
         LA    RF,PDTRCDAT              PTR TO DATA ADDR                30400021
         ST    RF,PDDATAAD              STORE IN BUFFER                 30600021
         SR    RF,RF                    ZERO WKREG                      30800021
         SR    RD,RD                    ZERO WKREG                      31000021
         IC    RD,PDCODE                PUT TRACE CODE IN REG           31200021
         B     PDF03020(RD)             USE TO REFERENCE BRANCH TABLE   31400021
PDF03020 EQU   *                        BRANCH TABLE                    31600002
         B     PDF03820                 NO TRACE, CHECK FOR ABEND EXIT  31800021
*                                       CODE 00                         32000021
         B     PDF03040                 TRACE IOB, CCWS                 32200021
*                                       CODE 04                         32400021
         B     PDF03060                 TRACE TIOT ENTRY, UCBS          32600021
*                                       CODE 08                         32800021
         B     PDF03100                 TRACE JFCB VOLIDS               33000021
*                                       CODE 0C                         33200021
         B     PDF03140                 TRACE TAPE LABEL                33400021
*                                       CODE 10                         33600021
         B     PDF03160                 TRACE JFCB DSN FLD, TAPE LABEL  33800021
*                                       CODE 14                         34000021
         B     PDF03120                 TRACE DA VOLUME LABEL           34200021
*                                       CODE 18                         34400021
         B     PDF03180                 TRACE DSCB                      34600021
*                                       CODE 1C                         34800021
         B     PDF03820                 NO TRACE, CHECK FOR ABEND EXIT  35000021
*                                       CODE 20                         35200021
         B     PDF03820                 NO TRACE, CHECK FOR ABEND EXIT  35400021
*                                       CODE 24                         35600021
         B     PDF03200                 TRACE DCB                       35800021
*                                       CODE 28                         36000021
         B     PDF03820                 NO TRACE, CHECK FOR ABEND EXIT  36200021
*                                       CODE 2C                         36400021
         B     PDF03820                 NO TRACE, CHECK FOR ABEND EXIT  36600021
*                                       CODE 30                         36800021
         B     PDF03220                 TRACE DCB, DSCB                 37000021
*                                       CODE 34                         37200021
         B     PDF03240                 TRACE JFCB ELEM NAME            37400021
*                                       CODE 38                         37600021
         B     PDF03260                 TRACE DCB EXIT LIST             37800021
*                                       CODE 3C                         38000021
         B     PDF03280                 TRACE DCB, TAPE LABEL           38200021
*                                       CODE 40                         38400021
         B     PDF03300                 TRACE DCB, JFCB DSNAME          38600021
*                                       CODE 44                         38800021
         B     PDF03320                 TRACE JFCB DSNAME               39000021
*                                       CODE 48                         39200021
         B     PDF03340                 TRACE JFCB VOLIDS, DSCB         39400002
*                                       CODE 4C                         39600021
PDF03040 EQU   *                        TRACE IOB, CCWS                 39800002
         BAL   RB,PDF03360              MOVE IOB FR WKAREA TO TRACE BFR 40000002
         BAL   RB,PDF03800              GO TO TRACE RTN                 40400021
         BAL   RB,PDF03380              MOVE CCWS TO TRACE BUFFER       40600021
         LA    RB,PDF03820              LOAD RETURN ADDRESS IN REG      40800021
         B     PDF03800                 BRANCH TO TRACE RTN             41000021
PDF03060 EQU   *                        TRACE TIOT ENTRY, UCBS          41200002
         BAL   RB,PDF03460              MOVE TIOT TO TRACE BUFFER       41400021
         BAL   RB,PDF03800              GO TO TRACE RTN                 41600021
         LR    R0,RUCB                  SAVE UCB REG                    41800021
         LA    RET,TIOEFSRT-ONE-TIOENTRY(RTIOT)  PTR TO UCB IN TIOT     42000002
         SR    RC,RC                    ZERO WORK REG                   42400021
         IC    RC,TIOELNGH-TIOENTRY(RTIOT)  PUT LNG OF ENTRY IN REG     42600002
         AR    RC,RTIOT                 POINT TO END OF ENTRY           43000021
PDF03080 L     RUCB,ORG(RET)            SET UP RUCB FOR UCB TRACE RTN   43200021
         BAL   RB,PDF03500              MOVE UCB TO TRACE RTN           43400021
         BAL   RB,PDF03800              TRACE UCB                M0144  43500021
         LA    RET,FOUR(RET)            POINT TO NEXT DEVICE ENTRY      43600021
         CR    RET,RC                   END OF DD ENTRY                 43800021
         BNE   PDF03080                 NO                              44000021
         LR    RUCB,R0                  RESTORE UCB REG                 44200021
         B     PDF03820                 GO TO EXIT FROM MODULE   M0144  44500021
PDF03100 EQU   *                        TRACE JFCB VOLUME IDS           44800002
         BAL   RB,PDF03560              GO TO TRACE VOLIDS FROM JFCB    45000021
         LA    RB,PDF03820              LOAD RETURN ADDRESS             45200021
         B     PDF03800                 GO TO TRACE RTN                 45400021
PDF03120 EQU   *                        TRACE DA VOLUME LABEL           45600002
         BAL   RB,PDF03620              MOVE VOL LABEL TO TRACE BUFFER  45800021
         LA    RB,PDF03820              SET RETURN ADDRESS              46000021
         B     PDF03800                 GO TO TRACE RTN                 46200021
PDF03140 EQU   *                        TRACE TAPE LABEL                46400002
         BAL   RB,PDF03580              MOVE TAPE LABEL TO TRACE BUFFER 46600021
         LA    RB,PDF03820              LOAD RETURN ADDRESS             46800021
         B     PDF03800                 GO TO TRACE RTN                 47000021
PDF03160 EQU   *                        TRACE JFCB DSN, TAPE LABEL      47200002
         BAL   RB,PDF03640              MOVE DSN FROM JFCB TO BUFFER    47400021
         BAL   RB,PDF03800              GO TO TRACE RTN                 47600021
         B     PDF03140                 TRACE TAPE LABEL                47800021
PDF03180 EQU   *                        SET DSCB TRACE CODE             48000002
         MVI   PDTRCDAT,DSCBCOD         MOVE TRACE CODE TO BUFFER       48200021
PDF03182 EQU   *                        TRACE FORMAT 1 DSCB             48400002
         CLI   DSCFMTID,F1CODE          FORMAT 1 DSCB                   48600021
         BNE   PDF03185                 NO, CHECK FOR F2 OR F3 DSCB     48800021
         BAL   RB,PDF03660              MOVE DSCB TO BUFFER             49000021
         BAL   RB,PDF03800              GO TO TRACE RTN                 49200021
         NC    DSCCORE+ONE(THREE),DSCCORE+ONE  ANOTHER DSCB IN CORE     49400002
         BZ    PDF03820                 NO, EXIT                        49800021
         L     RCORE,DSCCORE            POINT TO NEXT DSCB              50000021
PDF03185 EQU   *                        CHK DSCB FORMAT TYPE            50200002
         CLI   ORG(RCORE),F2HXCODE      IS IT A FORMAT 2 DSCB           50400021
         MVI   PDTRCDAT,F2DSCBCD        MOVE F2 DSCB CODE TO BUFFER     50600021
         BE    PDF03190                 GO TO TRACE F2 DSCB             50800021
         CLI   ORG(RCORE),F3HXCODE      IS IT A FORMAT 3 DSCB           51000021
         MVI   PDTRCDAT,F3DSCBCD        MOVE TRACE CODE TO BUFFER       51200021
         BE    PDF03190                 GO TO TRACE F3 DSCB             51400021
*                                       IF NOT F2 OR F3 DSCB, IT MUST   51600021
*                                       BE ANOTHER F1                   51800021
         MVI   PDTRCDAT,DSCBCOD         MOVE CODE TO BUFFER             52000021
         CLI   ORG(RCORE),F1CODE        IS DSNAME PREFIX PRESENT?       52200021
         BE    PDF03180                 NO, GO TRACE F1 DSCB            52400021
         LA    RCORE,DSNLNG(RCORE)      BUMP PAST PREFIX                52600021
*                                       NOW CHECK TO SEE WHETHER OR     52630021
*                                       NO IT IS A VALID DSCB OR THE    52660021
*                                       WKAREA HAS BEEN CLOBBERRED      52690021
         CLI   ORG(RCORE),F1CODE        IS IT A F1 DSCB W/O PREFIX      52720021
         BNE   PDF03820                 NO, EXIT WITHOUT TRACING        52750021
         B     PDF03180                 GO TRACE F1 DSCB                52800021
PDF03190 EQU   *                        TRACE FORMAT 2 OR 3 DSCB        53000002
         BAL   RB,PDF03670              GO MOVE F2 OR F3 DSCB TO BFR    53200021
         BAL   RB,PDF03800              TRACE IT                        53400021
         MVI   PDTRCDAT,F2HXCODE        MOVE CODE FOR 2ND HALF OF F2    53600021
*                                       DSCB TO TRACE BUFFER            53800021
         LA    RCORE,F23DSCLN(,RCORE)   BUMP PTR TO DSCB 2ND HALF       54000021
         CLI   PDTRCDAT,F2HXCODE        TRACING FORMAT 2 DSCB           54200021
         BE    PDF03182                 YES, USE F1 TRACE RTN TO TRACE  54400021
*                                       2ND HALF OF F2 DSCB             54600021
         MVI   PDTRCDAT,F3COD2          MOVE CODE FOR 2ND HALF OF F3    54800021
*                                       DSCB TO TRACE BUFFER            55000021
         B     PDF03182                 USE F1 TRACE RTN TO TRACE       55200021
*                                       2ND HALF OF F3 DSCB             55400021
PDF03200 EQU   *                        TRACE DCB                       55600002
         BAL   RB,PDF03680              MOVE DCB TO BUFFER              55800021
         LA    RB,PDF03820              SET RETURN ADDR                 56000021
         B     PDF03800                 GO TO TRACE RTN                 56200021
PDF03220 EQU   *                        TRACE DCB, DSCB                 56400002
         BAL   RB,PDF03680              MOVE DCB TO BUFFER              56600021
         BAL   RB,PDF03800              GO TO TRACE RTN                 56800021
         B     PDF03180                 TRACE DSCB                      57000021
PDF03240 EQU   *                        TRACE JFCB ELEMENT NAME         57200002
         BAL   RB,PDF03700              MOVE JFCB ELEM NAME TO BFR      57400021
         LA    RB,PDF03820              SET RETURN ADDR                 57600021
         B     PDF03800                 GO TO TRACE RTN                 57800021
PDF03260 EQU   *                        TRACE DCB EXIT LIST             58000002
         BAL   RB,PDF03720              MOVE EXLST TO BUFFER            58200021
         LA    RB,PDF03820              SET RETURN ADDRESS              58400021
         B     PDF03800                 GO TO TRACE RTN                 58600021
PDF03280 EQU   *                        TRACE DCB, TAPE LABEL           58800002
         BAL   RB,PDF03680              MOVE DCB TO BUFFER              59000021
         BAL   RB,PDF03800              GO TO TRACE RTN                 59200021
         B     PDF03140                 TRACE TAPE LABEL                59400021
PDF03300 EQU   *                        TRACE JFCB DSNAME, DCB          59600002
         BAL   RB,PDF03640              TRACE JFCB DSNAME               59800021
         BAL   RB,PDF03800              GO TO TRACE RTN                 60000021
         B     PDF03200                 TRACE DCB                       60200021
PDF03320 EQU   *                        TRACE JFCB DSNAME               60400002
         BAL   RB,PDF03640              TRACE JFCB DSNAME               60600021
         LA    RB,PDF03820              SET RETURN ADDRESS              60800021
         B     PDF03800                 GO TO TRACE RTN                 61000021
PDF03340 EQU   *                        TRACE JFCB VOLIDS, DSCB         61200002
         BAL   RB,PDF03560              TRACE JFCB VOLIDS               61400002
         BAL   RB,PDF03800              GO TO TRACE RTN                 61600021
         B     PDF03180                 TRACE DSCB                      61800021
PDF03360 EQU   *                        MOVE IOB TO TRACE BUFFER        62000002
         MVI   PDTRCDAT,IOBCOD          MOVE TRACE CODE TO BUFFER       62200021
         MVC   PDTRCDAT+ONE(IOBLNG),DXIOB  TRACE IOB FROM WKAREA        62400002
         LA    RF,IOBLNG+ONE            LENGTH OF TRACE DATA            62800021
         BR    RB                       RETURN                          63000021
PDF03380 EQU   *                        SET UP TO MOVE CCWS TO BUFFER   63200002
*                                       THE FOLLOWING ROUTINE MOVES     63400021
*                                       CCWS FROM THE O/C/EOV WKAREA    63600021
*                                       TO THE TRACE BUFFER.            63800021
*                                       IF A CHAIN BIT IS ON IN THE     64000021
*                                       CCW, OR THE COMMAND CODE IS     64200021
*                                       A TIC, THEN IT IS ASSUMED       64400021
*                                       THAT ANOTHER CCW FOLLOWS THIS   64600021
*                                       ONE.                            64800021
*                                       AS EACH CCW IS MOVED TO THE     65000021
*                                       BUFFER, THE COUNT IS UPDATED.   65200021
         LA    RF,CCWLNG+ONE            LNG OF A CCW                    65400021
         LA    RC,DXCCW1                PTR TO FIRST CCW                65600021
         LA    RET,PDTRCDAT+ONE         PTR TO BUFFER                   65800021
PDF03400 EQU   *                        MOVE CCW TO TRACE BUFFER        66000002
         MVC   ORG(CCWLNG,RET),ORG(RC)  MOVE CCW TO BUFFER              66200021
         TM    ORG(RC),TIC              IS CCW A TIC                    66400021
         BO    PDF03420                 YES, THERE MUST BE MORE CCWS    66600021
         TM    FOUR(RC),CDCHN           COMMAND OR DATA CHAIN           66800021
         BZ    PDF03440                 BRANCH IF NO MORE CCWS TO TRACE 67000021
PDF03420 EQU   *                        INCR POINTERS, COUNT            67200002
         LA    RC,CCWLNG(RC)            BUMP CCW PTR                    67400021
         LA    RET,CCWLNG(RET)          BUMP BUFFER PTR                 67600021
         LA    RF,CCWLNG(RF)            BUMP LNG COUNT                  67800021
         B     PDF03400                 GO MOVE CCW TO BUFFER           68000021
PDF03440 EQU   *                        SET CCW TRACE CODE              68200002
         MVI   PDTRCDAT,CCWCOD          MOVE CODE TO BUFFER             68400021
         BR    RB                       RETURN TO CALLER                68600021
PDF03460 EQU   *                        CHK TIOT DD ENTRY LENGTH        68800002
         IC    RF,ORG(,RTIOT)           PUT LNG OF DD ENTRY IN   M0144  68900021
*                                       REG                      M0144  69000021
         LA    R0,((L'PDTRCDAT-ONE)/FOUR)*FOUR  SET LENGTH FOR  OY02805 69020002
*                                       MAXIMUM WORDS IN BUFFER OY02805 69030002
         CR    RF,R0                    DD ENTRY FIT IN BUFFER  OY02805 69040002
         BNH   PDF03470                 BR IF YES               OY02805 69060002
         LR    RF,R0                    USE SMALLER BUFFER SIZE OY02805 69080002
PDF03470 EQU   *                        MOVE TIOT ENTRY TO BFR  OY02805 69100002
         BCTR  RF,ZERO                  REDUCE BY ONE FOR EX            69200021
         EX    RF,PDF03480              MOVE TIOT ENTRY TO BUFFER       69400021
         LA    RF,TWO(RF)               RESTORE LNG AND ADD ONE FOR COD 69600021
         MVI   PDTRCDAT,TIOCOD          MOVE TRACE CODE TO BUFFER       69800021
         BR    RB                       RETURN TO CALLER                70000021
PDF03480 MVC   PDTRCDAT+ONE(ZERO),TIOENTRY-TIOENTRY(RTIOT) MOVE TIOT   *70200002
                                        ENTRY TO BUFFER                 70400002
PDF03500 EQU   *                        MOVE UCB TO BUFFER              70600002
         MVI   PDTRCDAT,UCBCOD          MOVE TRACE CODE TO BUFFER       70800021
         LA    RF,UCBLNG+ONE            UCB LENGTH                      73600021
         MVC   PDTRCDAT+ONE(UCBLNG),ORG(RUCB)  MOVE UCB TO BUFFER       73800002
         BR    RB                       RETURN TO CALLER                74200021
PDF03560 EQU   *                        MOVE JFCB VOL IDS TO BUFFER     74400002
         MVC   PDTRCDAT+ONE(JVOLLNG),JFCBVOLS  MOVE VOLIDS TO BUFFER    74600002
         MVI   PDTRCDAT,JVOLCOD         MOVE TRACE CODE TO BUFFER       75000021
         LA    RF,JVOLLNG+ONE           PUT LNG IN REG                  75200021
         BR    RB                       RETURN                          75400021
PDF03580 EQU   *                        SET TAPE LABEL TRACE CODE       75600002
         MVI   PDTRCDAT,TLBLCOD         MOVE TRACE CODE TO BUFFER       75800021
PDF03600 EQU   *                        MOVE TAPE LABEL TO BUFFER       76000002
         MVC   PDTRCDAT+ONE(LBLLNG),DXLBL                               76200002
         LA    RF,LBLLNG+ONE            LNG OF TRACE DATA               76600021
         BR    RB                       RETURN                          76800021
PDF03620 EQU   *                        SET VOLUME LABEL TRACE CODE     77000002
         MVI   PDTRCDAT,VLBLCOD         MOVE TRACE CODE TO BUFFER       77200021
         B     PDF03600                 GO MOVE LABEL TO BUFFER         77400021
PDF03640 EQU   *                        MOVE DSNAME TO BUFFER           77600002
         MVC   PDTRCDAT+ONE(DSNLNG),JFCBDSNM                            77800021
         LA    RF,DSNLNG+ONE            PUT LNG IN REG                  78200021
         MVI   PDTRCDAT,JDSNCOD         MOVE TRACE CODE TO BUFFER       78400021
         BR    RB                       RETURN                          78600021
PDF03660 EQU   *                        MOVE DSCB TO BUFFER             78800002
         MVC   PDTRCDAT+ONE(DSCBLNG),DXDSCB                             79000021
         LA    RF,DSCBLNG+ONE           PUT LNG IN REG                  79400021
         BR    RB                       RETURN                          79600021
PDF03670 EQU   *                        MOVE F2 OR F3 DSCB TO BUFFER    79800002
         MVC   PDTRCDAT+ONE(F23DSCLN),DXDSCB                            80000021
         LA    RF,F23DSCLN+ONE          PUT LNG IN REG                  80400021
         BR    RB                       RETURN                          80600021
PDF03680 EQU   *                        SET DCB TRACE CODE              80800002
         MVI   PDTRCDAT,DCBCOD          MOVE TRACE CODE TO BUFFER       81000021
         LH    RF,DXUDCBPL              LOAD DCB PREFIX LENGTH   YM1297 81050002
         AH    RF,DXUDCBML              ADD DCB LENGTH           YM1297 81100002
         STH   RF,ORG(,R1)              SAVE ACB/DCB LENGTH      YM3945 81101002
         LA    RF,L'PDTRCDAT-ONE        SET MAX LNG TO TRANSFER  YM3945 81102002
         CH    RF,ORG(,R1)              COMP MAX LNG TO DCB SIZE YM3945 81103002
         BNH   PDF03685                 BR TO USE MAX LENGTH     YM3945 81104002
         LH    RF,ORG(,R1)              USE ACTUAL SIZE DCB/ACB  YM3945 81105002
PDF03685 EQU   *                        SET LNG                  YM3945 81106002
         BCTR  RF,R0                    SET RF FOR EXECUTE INSTR YM1115 81150002
         EX    RF,PDF03690              MOVE DCB TO BUFFER       YM1297 81200002
         LA    RF,TWO(RF)               RESTORE TRACE DATA LNG   YM1297 81250002
         BR    RB                       RETURN                          81800021
PDF03690 MVC   PDTRCDAT+ONE(ZERO),ORG(RDCB) MOVE DCB TO BUFFER   YM1297 81850002
PDF03700 EQU   *                        MOVE JFCB ELEMENT NAME          82000002
         MVI   PDTRCDAT,JELNMCOD        MOVE TRACE CODE TO BUFFER       82200021
         MVC   PDTRCDAT+ONE(ELNMLNG),JFCBELNM                           82400021
*                                       MOVE ELEMENT NAME TO BUFFER     82600021
         LA    RF,ELNMLNG+ONE           DATA LENGTH                     82800021
         BR    RB                       RETURN                          83000021
PDF03720 EQU   *                        SET USER KEY                    83200002
         CLC   DCBEXLST+ONE(THREE),EXITCHK DCB PT TO EXIT LIST  OY02805 83202002
         BNH   PDF03820                 BR IF NO, NO TRACE      OY02805 83204002
         MVI   PDTRCDAT,DEXITCOD        MOVE TRACE CODE TO BFR   YM5352 83206002
         L     RC,CVTPTR                ADDRESS OF CVT           Y02082 83210002
         USING CVT,RC                                            Y02082 83220002
         L     RC,CVTTCBP               TCB POINTERS ADDRESS     Y02082 83230002
         L     RC,CURRTCB(,RC)          CURRENT TCB ADDRESS      Y02082 83240002
         USING TCB,RC                   USING FOR MODESET        Y02082 83242002
         MODESET EXTKEY=RBT234,WORKREG=12 USER KEY               Y02082 83250002
         L     RC,DCBEXLST              PTR TO USER EXIT LIST           83400021
         LA    R0,((L'PDTRCDAT-ONE)/FOUR)*FOUR  SET LENGTH FOR  OY02805 83410002
*                                       MAXIMUM WORDS IN BUFFER OY02805 83420002
         LA    RET,DEXITLNG             LNG OF ENTRY                    83600021
PDF03740 TM    ORG(RC),LAST             LAST ENTRY                      83800021
         BO    PDF03760                 YES                             84000021
         CR    RET,R0                   EXIT LIST FIT IN BUFFER OY02805 84010002
         BNL   PDF03760                 BR IF BUFFER NOW FULL   OY02805 84020002
         LA    RC,FOUR(RC)              POINT TO NEXT ENTRY             84200021
         LA    RET,FOUR(RET)            BUMP LENGTH                     84400021
         B     PDF03740                 GO CHECK FOR LAST ENTRY IN LIST 84600021
PDF03760 EQU   *                        SET DCB EXIT CODE               84800002
         LA    RF,ONE(RET)              LNG OF DATA                     85200021
         BCTR  RET,R0                   SUBTRACT ONE FOR EX             85400021
         MODESET EXTKEY=SUPR            SETLOCK KEY              Y02082 85650002
         LR    RC,RF                    SAVE RF                  Y02082 85700002
         L     RF,WTGPREFX              PREFIX ADDR              Y02082 85750002
         STM   RB,RET,IECREGSV-IECPREFX(RF)                      Y02082 85760002
PDF03762 EQU   *                        MOVE DCB EXIT LIST       Y02082 85770002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND, GET LOCAL LOCK   Y02082*85780002
               RELATED=(FREEMAIN,IFG0199D(PDF03764))             Y02082 85790002
         LM    RB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS         Y02082 85792002
         LR    RF,RC                    RESTORE RF               Y02082 85794002
         L     RC,CVTPTR                ADDRESS OF CVT           Y02082 85794402
         USING CVT,RC                                            Y02082 85794802
         L     RC,CVTTCBP               TCB POINTERS ADDRESS     Y02082 85795202
         L     RC,CURRTCB(,RC)          CURRENT TCB ADDRESS      Y02082 85795602
         USING TCB,RC                   USING FOR MODESET        Y02082 85795702
         MODESET EXTKEY=RBT234,WORKREG=12 USER KEY               Y02082 85796002
         DROP  RC                                                Y02082 85796402
         L     RC,DCBEXLST              PTR TO EXIT LIST        OY02805 85797002
         MODESET EXTKEY=SUPR            KEY 0 FOR MOVE           Y02082 85798402
         EX    RET,PDF03780             MOVE EXIT LIST TO BUFFER        85800021
         LR    RC,RF                    SAVE RF                  Y02082 85850002
         L     RF,WTGPREFX              WTG PREFIX               Y02082 85900002
         STM   RB,RET,IECREGSV-IECPREFX(RF) SAVE REGS            Y02082 85950002
PDF03764 EQU   *                        RELEASE LOCK, SET KEY 5  Y02082 85960002
         SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       Y02082*85970002
               RELATED=(FREEMAIN,IFG0199D(PDF03762))             Y02082 85980002
         LM    RB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS         Y02082 85990002
         LR    RF,RC                    RESTORE RF               Y02082 85992002
         MODESET EXTKEY=DATAMGT         KEY 5                    Y02082 85994002
         BR    RB                       RETURN                          86000021
PDF03780 MVC   PDTRCDAT+ONE(ZERO),ORG(RC) MOVE EXIT LIST                86200002
PDF03800 EQU   *                        ISSUE GTRACE MACRO              86400002
         STH   RF,PDTRCLNG              STORE LNG OF TRACE DATA IN BFR  86600021
         GTRACE ID=4095,PAGEIN=YES,MF=(E,(1))  ISSUE TRACE MACRO YM7364 86800002
         BR    RB                       RETURN                          87000021
PDF03820 EQU   *                        RESTORE WORK AREA PT            87200002
         L     RCORE,WTGCORE-WTGENTRY-ONE(RWTGC)                        87400021
*                                       RESTORE RCORE IN CASE IT WAS    87600021
*                                       DESTROYED                       87800021
         IECRES LOAD,PREFIX=WTGPREFX,BRANCH=DIRECT,              Y02080X88850002
               MODID=EXITID                                      Y02080 88860002
*                                       GO TO EXIT ROUTINE       Y02080 88900002
OCEFID   DC    X'00FF'                  TRACE FORMAT ID                 89000021
EXITCHK  DC    AL3(1)                   ADDR TO CHK IF DCB EXIT OY02805 89100002
*                                       LIST EXISTS             OY02805 89200002
         XCTLTABL ID=(EXITID,9E),BRT=YES,LENGTH=                 Y02080 89250002
         IECPDSCT                                                       89400021
         IECDSECS MAIN,RB,TCB,TIOT,CVT,DCB,WTG,PREFX,            Y02080*90250002
               DSCB2,DSCB3,PSA,EXPAND=YES                        Y02082 90300002
         END                                                            90400021
