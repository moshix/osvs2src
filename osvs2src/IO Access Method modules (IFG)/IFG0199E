         TITLE 'IFG0199E - OPEN/CLOSE/EOV PROBLEM DETERMINATION USER EX*00100002
               IT PROCESSING ROUTINE'                                   00200002
         COPY  LCGASMSW                                                 00200100
IFG0199E CSECT                                                          00500021
         ENTRY IFG0209E                                                 00550002
         ENTRY IFG0239E                                                 00560002
         ENTRY IFG0559E                                                 00570002
IFG0209E EQU   IFG0199E                 ALIAS ENTRY POINT        Y02080 00580002
IFG0239E EQU   IFG0199E                 ALIAS ENTRY POINT        Y02080 00590002
IFG0559E EQU   IFG0199E                 ALIAS ENTRY POINT        Y02080 00592002
*********************************************************************** 00642002
*                                                                     * 00692002
* MODULE NAME = IFG0199E (OS/VS2)                                     * 00742002
*                                                                     * 00792002
* DESCRIPTIVE NAME = OPEN,CLOSE/EOV PROBLEM DETERMINATION USER EXIT   * 00842002
*                    PROCESSING ROUTINE                               * 00862002
*                                                                     * 00892002
* COPYRIGHT = NONE                                                    * 00942002
*                                                                     * 00992002
* STATUS = RELEASE 4, LEVEL 0                                         * 01042037
*                                                                     * 01092002
* FUNCTION =                                                          * 01142002
*        1. FINAL ROUTINE OF ABEND INTERPRETATION AND RECOVERY.       * 01152002
*        DETERMINES IF THE USER HAS SPECIFIED A DCB EXIT LIST         * 01162002
*        ADDRESS, AND IF HE HAS, IF ONE OF THE ENTRIES IS AN ABEND    * 01172002
*        EXIT (CODE X'11').                                           * 01182002
*                                                                     * 01184002
*        2. IF NO ABEND EXIT IS SPECIFIED, O/C/EOV REGISTERS ARE      * 01186002
*        RESTORED AND AN ABEND IS ISSUED WITH:                        * 01188002
*           A. CONDITION CODE EQUAL TO THAT PASSED TO THE ROUTINE IN  * 01190002
*           PDABCODE;                                                 * 01190402
*           B. R15 LOADED WITH A RETURN CODE FROM PDRETCODE.          * 01190802
*                                                                     * 01191202
*        3. IF AN ABEND EXIT IS SPECIFIED, USER REGISTERS ARE         * 01191602
*        RESTORED, REGISTER 1 IS LOADED WITH A POINTER TO A           * 01191702
*        PARAMETER LIST, AND A SYNCH TO THE USER'S EXIT ROUTINE       * 01191802
*        IS ISSUED.  UPON RETURN FROM THE USER'S ROUTINE, A BRANCH    * 01191902
*        TABLE DETERMINES THE OPTION SELECTED:                        * 01194602
*           CODE     ACTION                                           * 01196602
*           0  (0)   ABEND                                            * 01198602
*           4  (4)   IGNORE ERROR                                     * 01199002
*           8  (8)   DELAY ERROR                                      * 01199402
*           12 (C)   ATTEMPT RECOVERY                                 * 01199802
*                                                                     * 01199902
*        4. IF HE CHOOSES TO ABEND, O/C/EOV REGISTERS ARE             * 01213902
*        RESTORED AND AN ABEND ISSUED.                                * 01223902
*                                                                     * 01225902
*        5. IF HE CHOOSES TO IGNORE THE ERROR, THEN THE ABEND IS      * 01227902
*        IGNORED OR AN ABEND IS ISSUED DEPENDING UPON WHETHER OR NOT  * 01232602
*        THE ERROR CAN BE DELAYED.                                    * 01234602
*                                                                     * 01237102
*        6. IF HE CHOOSES TO DELAY THE ERROR, THEN THE ABEND IS       * 01237202
*        DELAYED OR AN ABEND IS ISSUED DEPENDING UPON WHETHER OR NOT  * 01250902
*        THE ERROR CAN BE DELAYED.                                    * 01260902
*                                                                     * 01262902
*        7. IF HE CHOOSES TO ATTEMPT RECOVERY, HE MAY SUPPLY NEW      * 01263302
*        DATA WITH WHICH RECOVERY WILL BE ATTEMPTED; NEW VOLUME SERIAL* 01263702
*        NUMBERS. THE JFCB AND/OR EXTENSION BLOCKS WILL BE UPDATED    * 01264502
*        AND WRITTEN BACK.  OPEN'S REGISTERS WILL BE RESTORED, AND    * 01269102
*        CONTROL WILL BE RETURNED TO THE RESIDENT ROUTINE WITH THE    * 01271102
*        MODULE SPECIFIED BY DXRETMOD.                                * 01273102
*                                                                     * 01282802
* NOTES = SEE BELOW                                                   * 01287402
*                                                                     * 01292002
*    DEPENDENCIES =                                                   * 01342002
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 01392002
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 01442002
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 01492002
*                                                                     * 01542002
*    RESTRICTIONS = NONE                                              * 01592002
*                                                                     * 01642002
*    REGISTER CONVENTIONS =                                           * 01692002
*            R2 POINTS TO DCB                                         * 01742002
*            R4 POINTS TO OPEN WORK AREA                              * 01792002
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 01842002
*            R6 POINTS TO THE WTG TABLE                               * 01892002
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 01942002
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 01992002
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 02042002
*            R10 POINTS TO THE UCB                                    * 02092002
*                                                                     * 02142002
*    PATCH LABEL = SEE THIRD LABEL BEFORE ORG STATEMENT AT END        * 02192002
*                  OF LISTING.                                        * 02242002
*                                                                     * 02292002
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 02342002
*                                                                     * 02392002
*    PROCESSOR = ASSEMBLER XF                                         * 02442002
*                                                                     * 02492002
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 02542002
*                  ORG STATEMENT AT END OF LISTING                    * 02592002
*                                                                     * 02642002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 02692002
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 02742002
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 02792002
*                                                                     * 02842002
* ENTRY POINT = IFG0199E OPEN                                         * 02892002
*               IFG0209E CLOSE                                        * 02902002
*               IFG0239E TCLOSE                                       * 02912002
*               IFG0559E EOV                                          * 02922002
*                                                                     * 02942002
*    PURPOSE = SEE FUNCTION                                           * 02992002
*                                                                     * 03042002
*    LINKAGE =                                                        * 03092002
*        R1 POINTER TO PROBLEM DETERMINATION WORK AREA                * 03102002
*        R2, R4-R10 AS THEY WERE WHEN PROBLEM DETERMINATION CALLED    * 03112002
*                                                                     * 03142002
* INPUT = R1 POINTING TO PROBLEM DETERMINATION WORK AREA              * 03192002
*                                                                     * 03242002
* OUTPUT = WHEN RECOVERY IS ATTEMPTED, THE JFCB AND/OR EXTENSION      * 03292002
*          BLOCKS ARE UPDATED WITH NEW VOLUME SERIAL NUMBERS.         * 03302002
*                                                                     * 03342002
* EXIT-NORMAL = IFG0196V TO DELAY/IGNORE AN OPEN EXECUTOR ABEND.      * 03392002
*               IFG0200W TO DELAY/IGNORE A CLOSE EXECUTOR ABEND.      * 03394002
*               IFG019RA TO TO SELECT NEXT MODULE TO GET CONTROL.     * 03395002
*                                                                     * 03396002
* EXIT-ERROR = ABEND - SEE FUNCTION FOR CONDITIONS                    * 03492002
*                                                                     * 03542002
* EXTERNAL REFERENCES = SEE BELOW                                     * 03592002
*                                                                     * 03642002
*    ROUTINES = IFG019RA                                              * 03692002
*               LOCK ROUTINE                                          * 03693002
*                                                                     * 03742002
*    DATA AREAS = PROBLEM DETERMINATION WORK AREA                     * 03792002
*                 OPEN/CLOSE/EOV WORK AREA                            * 03793002
*                 RECOVERY ROUTINE PARAMETER LIST                     * 03794002
*                 ABEND EXIT PARAMETER LIST                           * 03795002
*                 ABEND EXIT RECOVERY WORK AREA                       * 03796002
*                                                                     * 03842002
*    CONTROL BLOCKS = CVT                                             * 03892002
*                     DCB                                             * 03893002
*                     JFCB                                            * 03894002
*                     JFCB EXTENSION                                  * 03895002
*                     SVRB                                            * 03896002
*                     TCB                                             * 03897002
*                                                                     * 03942002
* TABLES = NONE                                                       * 03992002
*                                                                     * 04042002
* MACROS = ABEND                                                      * 04092002
*          FREEMAIN                                                   * 04093002
*          IECDSECS                                                   * 04094002
*          IECPDSCT                                                   * 04095002
*          IECRES FREE                                                * 04096002
*          IECRES GET                                                 * 04097002
*          IECRES INIT                                                * 04097202
*          IECRES LOAD                                                * 04098002
*          IECRES LOCJFCB                                             * 04099002
*          IECRES UEXIT                                               * 04100002
*          IECRES WRJFCB                                              * 04101002
*          MODESET                                                    * 04102002
*          SETLOCK                                                    * 04103002
*          SNAP MF=L                                                  * 04104002
*          XCTLTABL                                                   * 04105002
*                                                                     * 04142002
* CHANGE ACTIVITY                                                     * 04192000
* VS2-RELEASE 3.7 CHANGES/DELETIONS                                   * 04194037
*0000618399-618899                                             @ZA10633 04197037
* VS2-RELEASE 3 CHANGES/DELETIONS                                     * 04200037
*0000618399                                                    @ZA03152 04203037
*0000171000,451000-460000,464000                               @ZA01340 04206037
* VS2-RELEASE 2 CHANGES/DELETIONS                                     * 04209037
*A168500,176500-176700,618399                                   ZA01291 04212000
*                                                                     * 04242002
*********************************************************************** 04292002
         EJECT                                                          11300021
R0       EQU   0                        WORK/PARAMETER REG              11400021
R1       EQU   1                        WORK/PARAMETER REG              11500021
RDCB     EQU   2                        PTR TO DCB                      11600021
RBASE    EQU   3                        BASE REG                        11700021
RCORE    EQU   4                        PTR TO O/C/EOV WKAREA           11800021
RES      EQU   5                        PTR TO RESIDENT RTN             11900021
RWTG     EQU   6                        PTR TO WTG TABLE                12000021
RPARC    EQU   7                        PTR TO PARALIST CURRENT ENTRY   12100021
RWTGC    EQU   8                        PTR TO WTG TABLE CURRENT ENTRY  12200021
RTIOT    EQU   9                        TIOT ENTRY                      12300021
RUCB     EQU   10                       PTR TO UCB                      12400021
RB       EQU   11                       WORK/PARAMETER REG              12500021
RC       EQU   12                       WORK/PARAMETER REG              12600021
RD       EQU   13                       WORK/PARAMETER REG              12700021
RET      EQU   14                       WORK/PARAMETER REG              12800021
RF       EQU   15                       WORK/PARAMETER REG              12900021
ZERO     EQU   0                        WORK VALUE                      13000021
THREE    EQU   3                        WORK VALUE                      13100021
ONE      EQU   1                        WORK VALUE                      13200021
ORG      EQU   0                        WORK VALUE                      13300021
CHAR1    EQU   C'1'                     CHARACTER ONE            YM1195 13350002
ABEXCOD  EQU   X'11'                    DCB ABEND EXIT CODE             13400021
LAST     EQU   X'80'                    BIT FOR LAST ENTRY IN LIST      13500021
FOUR     EQU   4                        WORK VALUE                      13600021
SIXTY    EQU   60                       WORK VALUE                      13800021
CODLNG   EQU   1                        LNG OF PDCODE FIELD IN IECPDSCT 13900021
EIGHT    EQU   8                        WORK VALUE                      14000021
LEGALOPT EQU   X'0C'                    VALID BIT COMBINATIONS FOR USER 14100021
*                                       ON RETURN FROM ABEND EXIT       14200021
TWO      EQU   2                        WORK VALUE                      14300021
BLANK    EQU   C' '                     BLANK CHARACTER                 14400021
DSNLNG   EQU   44                       MAXIMUM LNG OF DSNAME           14500021
CHNGVOLS EQU   X'40'                    USER OPTION TO CHANGE VOLUMES   14600021
CCWLNG   EQU   8                        LNG OF A CCW                    14700021
TWENTY4  EQU   24                       WORK VALUE                      14800021
GOODIO   EQU   X'7F'                    ECB COMP CODE FOR SUCCESSFUL IO 14900021
JFCABEND EQU   X'02'                    BIT INDICATING DELAYED ABEND    15100021
FULL     EQU   X'FF'                    ALL BITS IN BYTE SET TO ONE     15200021
DCBBUSY  EQU   X'01'                    DCBOFLGS BUSY BIT               15300021
DCBLOCK  EQU   X'02'                    DCBOFLGS LOCK BIT               15400021
OPEN     EQU   X'10'                    DCBOFLGS OPEN BIT               15500021
FIVE     EQU   5                        WORK VALUE                      15600021
SIX      EQU   6                        WORK VALUE                      15800021
WTGPATH  EQU   30                       OFFSET OF WTGPATHS IN WTG TBL   15900021
TWELVE   EQU   12                       WORK VALUE                      16000021
RDCODE   EQU   X'06'                    READ COMMAND CODE               16100021
THIRTY2  EQU   32                       WORK VALUE                      16200021
WRTCODE  EQU   X'05'                    WRITE COMMAND CODE              16300021
FREEBUF  EQU   X'80'                    USER OPTION TO FREE BUFFER      16400021
TWENTY8  EQU   28                       WORK VALUE                      16500021
MASKSET  EQU   X'80'                    ORIGINAL OPTION MASK SET YM5994 16550002
RECOVRY  EQU   X'08'                    RECOVERY OPTION VALID BIT       16600021
IGN      EQU   X'04'                    IGNORE OPTION VALID BIT         16700021
DEL      EQU   X'02'                    DELAY OPTION VALID BIT          16800021
NODCBEX  EQU   X'01'                    DISALLOW DCB ABEND EXIT ZA01291 16850000
RESXCTL  EQU   4                        BRANCH TABLE OFFSET TO XCTL     16900021
EOV      EQU   X'03'                    EOV ABEND CODES ARE X37  A51158 16902000
*                                       LEFT JUSTIFIED IN A      A51158 16904000
*                                       HALFWORD                 A51158 16904400
K24      EQU   24                       CONSTANT  24                    16912000
K16      EQU   16                       CONSTANT OF 16           Y02134 16912402
K12      EQU   12                       CONSTANT OF 12           Y02134 16912802
K8       EQU   8                        CONSTANT OF 8            Y02082 16914002
K4       EQU   4                        CONSTANT  4                     16918000
K6       EQU   6                        CONSTANT OF 6            YM5728 16920002
K10      EQU   10                       CONSTANT OF 10           YM5728 16922002
K1       EQU   1                        CONSTANT  1                     16924000
K229     EQU   229                      FETCH PROT. SUBPOOL      Y02082 16934002
K0       EQU   0                        CONSTANT OF ZERO         Y02082 16934802
ABTEST   EQU   X'F0'                    ABEND CODE TEST MASK     Y02144 16935202
K68      EQU   68                       CONSTANT 68              Y02082 16984802
K2       EQU   2                        CONSTANT 2               YM5728 16994802
K3       EQU   3                        CONSTANT 3               YM5728 17004802
K5       EQU   5                        CONSTANT 5               YM5728 17014802
K7       EQU   7                        CONSTANT 7               YM5728 17016802
         EJECT                                                          17022002
         BALR  RBASE,R0                 ESTABLISH ADDRESSABILITY        17200021
         USING *,RBASE                                                  17300021
         USING PDDSECT,R1                                               17400021
         USING FORCORE,RCORE                                            17500021
         USING WTG,RWTG                 BASE FOR WTG TABLE       Y02080 17550002
         USING IHADCB,RDCB                                              17600021
         CLI   PDABCODE,ZERO            IS THIS A REAL ABEND     Y02144 17700002
         BNE   PDF04010                 YES, CHK FOR EXIT LIST   Y02144 17750002
         TM    PDABCODE+ONE,ABTEST      IS THERE AN ABEND CODE   Y02144 17800002
         BNZ   PDF04010                 YES, CHK FOR EXIT LIST   Y02144 17850002
         TM    PDABCODE+ONE,IGN         IS IGNORE OPTION ALLOWED Y02144 17860002
         BZ    PDF04520                 NO, BYPASS ABEND EXIT    Y02144 17870002
         B     PDF04460                 PROCESS FOR IGNORE       Y02144 17880002
PDF04010 EQU   *                        CHECK FOR BAD DCB      @ZA01291 17900000
         TM    PDABCODE+ONE,NODCBEX     DCB ABND EXIT DISALLOWD ZA01291 17950000
         BNO   PDF04015                 NO, GO CHECK EXIT      @ZA01291 17960000
         TM    PDABCODE+ONE,IGN         CAN DEFAULT TO IGNORE  @ZA01291 17970000
         BO    PDF04460                 GO IGNORE ERROR        @ZA01291 17972000
         TM    PDABCODE+ONE,DEL         CAN DEFAULT TO DELAY   @ZA01291 17974000
         BO    PDF04420                 GO DELAY ERROR         @ZA01291 17976000
         B     PDF04485                 GO ABEND NOW           @ZA01291 17978000
*                                                                       17980000
PDF04015 EQU   *                        CHK FOR DCB EXIT LIST           17990000
         L     RB,DCBEXLST              PTR TO DCB EXIT LIST            18000021
         LA    RB,ORG(RB)               CLEAR HI-ORDER BYTE             18100021
         LTR   RB,RB                    EXIT LIST ADDR SPECIFIED        18200021
         BZ    PDF04420                 NO, CHK FOR DELAY        Y02144 18300002
         MODESET KEYADDR=DXUKEY,WORKREG=13 USER KEY FOR EXITLIST Y02082 18310002
PDF04020 CLI   ORG(RB),ABEXCOD          ABEND EXIT                      18400021
         BE    PDF04040                 YES                             18500021
         CLI   ORG(RB),ABEXCOD+LAST     ABEND EXIT                      18600021
         BE    PDF04040                 YES                             18700021
         TM    ORG(RB),LAST             LAST ENTRY IN LIST              18800021
         BO    PDF04420                 YES, CHK FOR DELAY       Y02144 18900002
         LA    RB,FOUR(RB)              BUMP ENTRY PTR                  19000021
         B     PDF04020                 TRY AGAIN                       19100021
         EJECT                                                          19150002
PDF04040 EQU   *                        REFRESH USER DCB FR COPY        25600002
         L     RD,ORG(,RB)              PTR TO EXIT RTN          Y02082 25602002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 25610002
         TM    DXATCOM1,DXATREFR        DO THE ACCESS METHODS    Y02072 25612002
*                                       WANT THE DCB REFRESHED   Y02072 25612802
         BO    PDF04050                 NO, BYPASS COPYBACK      Y02072 25616002
         NI    DCBOFLGS,FULL-DCBLOCK    TURN OFF LOCK BIT BEFORE GOING  25620002
*                                       TO USER                  Y02082 25630002
*                                                                Y02082 25660002
* COPY THE DCB FROM THE WORK AREA TO USER'S STORAGE              Y02082 25670002
*                                                                Y02082 25680002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(1,14,WTGPREFX)          Y02082 25690002
*                                                                Y02082 25692002
         OI    DCBOFLGS,DCBLOCK         SET LOCK BIT             Y02082 25694002
PDF04050 EQU   *                        SET UP TO TAKE USER EXIT Y02072 25744002
         MVC   PDCODE,PDABCODE+ONE      MOVE VALID OPTIONS TO PARALIST  26600021
         NI    PDCODE,RECOVRY+DEL+IGN   TURN OFF ANY OTHER BITS         26700021
         LA    RCORE,ORG(RCORE)         ZERO HI-ORDER BYTE       M0178  27150021
         ST    RCORE,PDFORCOR           STORE WKAREA PTR FOR USER       27200021
         L     RDCB,DXUDCBAD            GET USER'S DCB ADDR      YM5353 27210002
         ST    RDCB,PDDCBPTR            STORE DCB ADDR IN PARM   M0178  27230021
*                                       LIST                     M0178  27260021
         LR    RB,R1                    SAVE POINTER TO DATA     Y02082 27354002
*                                       MGMT'S P/D WORKAREA      Y02082 27358002
         IECRES GET,LV=L'PDPARM+L'PDUSRAR,KEY=USER,PREFIX=NO,    Y02082*27368002
               SP=229,STM=(2,14,WTGPREFX) GET USER P/D WORKAREA  Y20082 27368402
         USING PDABCODE,R1              BASE PD LIST IN USER KEY        27368837
*    REG 1 NOW POINTS TO USER'S P/D WORKAREA                     Y02082 27370002
*    USING ON PDPARM FOR REG 1 IS ESTABLISHED                    Y02082 27374002
*    CONTROL IS RETURNED FROM IECRES IN USER KEY                 Y02082 27378002
         MVC   PDABCODE(L'PDPARM),PDABCODE-PDDSECT(RB)                  27382037
*                                       FILL IN USER P/D W/A     Y02082 27382237
         OI    PDCODE,MASKSET           INDICATE OPTION MASK SET YM5994 27382402
         NI    DCBOFLGS,FULL-DCBLOCK    TURN OFF LOCK BIT BEFORE GOING  27382802
*                                       TO USER                         27383202
         NI    PDABCODE+K1,FULL-RECOVRY-IGN-DEL-ONE              Y02144 27384002
*                                       TURN OFF LOW-ORDER BITS  Y02144 27384402
*                                       IN ABEND CODE            Y02144 27384802
         MODESET EXTKEY=DATAMGT         GET IN DM KEY            Y02082 27386002
         ST    R1,PDDCBPTR-PDDSECT(RB)  SAVE USER P/D W/A PTR    Y02082 27390037
         IECRES UEXIT,STM=(2,13,WTGPREFX),EXITAD=(RD)            Y02082 27900002
         LM    RTIOT,RUCB,DXREG9        RESTORE REGS 9-10               28240002
         L     RDCB,DXUDCBAD            GET PTR TO USER'S DCB    Y02082 28350002
         EJECT                                                          28352002
         MODESET KEYADDR=DXUKEY,WORKREG=1 ASSUME USER'S KEY      Y02082 28360002
         OI    DCBOFLGS,DCBLOCK         SET LOCK BIT             Y02082 28372002
         MODESET EXTKEY=DATAMGT         RESUME DATA MGT KEY      Y02082 28394002
         L     RDCB,DXPDCBAD            DCB ADDRESS              Y02082 28394102
         OI    DCBOFLGS,DCBLOCK         SET LOCK BIT                    28400021
         LR    R1,RB                    R1 POINTS TO PD WORKAREA Y02082 29000002
         USING PDDSECT,R1                                               29200021
         L     RB,PDDCBPTR              SAVED PTR TO USER'S      Y02082 29220002
*                                       P/D WORKAREA             Y02082 29240002
         MODESET KEYADDR=DXUKEY,WORKREG=12 GET IN USER KEY       Y02082 29260002
         L     RC,PDUSRAR-PDABCODE(RB)  GET USER PARM LIST ADDR  Y02082 29280002
         ICM   RC,B'1000',PDCODE-PDABCODE(RB)   GET USER RETURN  Y02082 29300002
*                                       CODE                     Y02082 29320002
         MODESET EXTKEY=DATAMGT         GET BACK IN DM KEY       Y02082 29340002
         STCM  RC,B'1000',PDCODE        STORE USER RET CODE      Y02082 29360002
         STCM  RC,B'0111',PDUSRAR+K1    STORE USER DATA ADDRESS  Y02082 29380002
         IECRES FREE,LV=L'PDPARM+L'PDUSRAR,KEY=USER,PREFIX=NO,   Y02082*29390002
               SP=229,A=(RB),STM=(1,14,WTGPREFX) FREE USER W/A   Y02082 29400002
         EJECT                                                          29410002
         MODESET EXTKEY=DATAMGT         GET IN DM KEY            Y02082 29440002
         TM    PDCODE,MASKSET           WAS OPTION MASK CHANGED  YM5994 29450002
         BO    PDF04420                 NO, DO DELAYED ABEND     YM5994 29460002
         NI    PDCODE,LEGALOPT          INSURE OPTION SELECTED IS LEGAL 29500021
         SR    RET,RET                  ZERO WKREG                      29600021
         IC    RET,PDCODE               PUT OPTION CODE IN REG          29700021
         B     PDF04060(RET)            USE FOR BRANCH TABLE            29800021
PDF04060 EQU   *                        BRANCH TABLE                    29900002
         B     PDF04480                 ABEND                           30000021
         B     PDF04450                 IGNORE ERR               YM1195 30100002
         B     PDF04420                 DELAY ERR                       30200021
PDF04080 EQU   *                        ATTEMPT RECOVERY                30300021
         TM    PDABCODE+ONE,RECOVRY     WAS RECOVERY POSSIBLE           30400021
         BNO   PDF04420                 NO, DO DELAYED ABEND     Y02144 30500002
         TM    JFCBMASK+FOUR,JFCABEND   HAS RECOVERY BEEN PERFORMED     30600021
*                                       ON THIS DCB PREVIOUSLY          30700021
         BO    PDF04420                 YES, DO DELAYED ABEND    Y02144 30800002
         OI    JFCBMASK+FOUR,JFCABEND   SET RECOVERY BIT IN JFCB MASK   31000021
         L     RB,PDUSRAR               PTR TO USER BUFFER              31100021
         LA    RB,ORG(RB)               ZERO HI-ORDER BYTE              31200021
         LTR   RB,RB                    BUFFER ADDR SUPPLIED            31300021
         BZ    PDF04520                 NO, USE SAME DATA               31400021
*                                       IF USER HAS NOT SUPPLIED NEW    31500021
*                                       VOLIDS, THEN RECOVERY WILL      31600021
*                                       BE ATTEMPTED WITH ORIGINAL VOLS 31700021
         EJECT                                                          31710002
*                                                                Y02082 31720002
*                                       USER KEY                 Y02082 31740002
*                                                                Y02082 31760002
         MODESET KEYADDR=DXUKEY,WORKREG=13 GET IN USER KEY       Y02082 31780002
         TM    TWO(RB),CHNGVOLS         VALID REQUEST                   31800021
         BZ    PDF04420                 NO, DO DELAYED ABEND     Y02144 31900002
*                                                                       32000021
         LA    RD,FOUR(RB)              POINT TO 1ST DATA IN BUFFER     32100021
         SR    RC,RC                    ZERO WKREG                      32300021
         IC    RC,ORG(RD)               NO. OF VOLS TO BE CHANGED       32400021
         LTR   RC,RC                    IS NO VOLS TO BE CHANGED ZERO   32500021
         BZ    PDF04320                 YES, TEST IF BUFFER TO BE FREED 32600021
         LA    RD,ONE(RD)               UPDATE USER BUFFER PTR          32700021
         LH    RET,DXVOLSEQ             GET STARTING VOLSEQ      Y02134 33600002
         CH    RET,CONH5                IS SEQ NO. GREATER THAN 5       34300021
         BNH   PDF04140                 NO START WITH MAIN JFCB         34400021
         SH    RET,CONH5                SUBTRACT NO. VOLS IN MAIN JFCB  34500021
         B     PDF04160                 GO READ JFCB EXTENSION          34600021
PDF04140 EQU   *                        CALC LNG OF MOVE TO JFCB        34700002
*                                                                Y02082 34720002
*                                       DATA MANAGEMENT KEY      Y02082 34740002
*                                                                Y02082 34760002
         MODESET EXTKEY=DATAMGT         KEY 5                    Y02082 34780002
         MVC   PDMSGLNG(TWO),CONH6      MOVE CONSTANT TO WKAREA         34800021
         BAL   RF,PDF04360              GO TO COMMON RTN TO DETERMINE   34900021
*                                       NO. VOLS TO BE MOVED INTO JFCB. 35000021
*                                       CALCULATE LNG OF MOVE AND       35100021
*                                       START POINT                     35200021
         EJECT                                                          35202002
         L     RF,WTGPREFX                                       Y02082 35207502
         STM   RB,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS    Y02082 35215002
         MODESET EXTKEY=SUPR            SETLOCK KEY              Y02082 35222502
PDF04142 EQU   *                        MOVE VOLS TO JFCB        Y02082 35230002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND, GET LOCAL LOCK   Y02082*35237502
               RELATED=(FREEMAIN,IFG0199E(PDF04144))             Y02082 35245002
         L     RF,WTGPREFX              WTG PREFIX               YM5994 35246002
         LM    RB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS         YM5994 35247002
         SR    RCORE,RET                RESTORE WKAREA PTR       YM5728 35248002
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY              Y02082 35252502
         AR    RCORE,RET                RESET FOR MOVE           YM5728 35254502
         LR    RF,R0                    R0 CONTAINS LNG OF FIELD TO BE  35300021
*                                       MOVED TO JFCBVOLS               35400021
         EX    RF,PDF04281              ENSURE IN USER CORE      Y02082 35407502
         MODESET EXTKEY=SUPR            KEY 0                    Y02082 35415002
         EX    RF,PDF04280              MOVE VOLS TO MAIN JFCB          35500021
         LA    RD,ONE(RD,RF)            INCREMENT RD TO NEXT     YM5728 35510002
*                                       VOLUMES IN USER BUFFER   YM5728 35520002
         SR    RCORE,RET                RESTORE WKAREA PTR              35600021
*                                       RCORE IS BUMPED BY VALUE IN RET 35700021
*                                       BY SUBRTN AT PDF04360           35800021
         L     RF,WTGPREFX              WTG PREFIX               Y02082 35910002
         STM   RB,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS    Y02082 35920002
PDF04144 EQU   *                        CHK FOR ALL VOLS MOVED   Y02082 35930002
         SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       Y02082*35940002
               RELATED=(FREEMAIN,IFG0199E(PDF04142))             Y02082 35950002
         LM    RB,RET,IECREGSV-IECPREFX(RF) RESTORE SETLOCK REGS Y02082 35960002
         MODESET EXTKEY=DATAMGT         KEY 5                    Y02082 35970002
         EJECT                                                          35980002
*                                                                YM5728 35996002
*        REG 0 = LENGTH OF VOLS MOVED - 1                        YM5728 35996102
*        REG 14 = OFFSET TO VOL SER FROM JFCBVOLS                YM5728 35996202
*        REG 15 = POINTER TO IECPREFX                            YM5728 35996302
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        YM5728 35996402
         LR    RD,R0                    LOAD LENGTH              YM5728 35996502
         LA    RD,K1(RD)                INCREMENT                YM5728 35996602
         LA    RC,JFCBVOLS(RET)         POINT TO VOLSER          YM5728 35996702
         XR    RB,RB                    INIT TO ZERO FOR LOOP    YM5728 35996902
         LA    RTIOT,PDTRCDAT           POINT TO ENQ AREA        YM5728 35997202
         USING PDTRCDAT,RTIOT                                    YM5728 35998102
*                                                                YM5728 35998302
PDF04150 EQU   *                        ENQ NEW VOL SERS         YM5728 35998402
*                                                                YM5728 35998502
         MVC   PDTRCDAT(K16),ENQLIST    INIT ENQLIST             YM5728 35998702
         L     RF,DXJSCBAD              LOAD JSCB ADDRESS        YM5728 35998902
         L     R0,JSCBTCBP-IEZJSCB(,RF) INITIATOR TCB POINTER    YM5728 35999102
         ENQ   (,(RC)),TCB=(0),RET=USE,MF=(E,PDTRCDAT+4),        YM5728X35999602
               RELATED=(SYSZVOLS,IFG0194A(VUS02450))             YM5728 35999702
         DROP  RTIOT                                             YM5728 36001702
*                                                                YM5728 36003902
         LTR   RF,RF                    VOLUME ALREADY IN USE    YM5728 36005902
         BZ    PDF04155                 BRANCH IF NOT IN USE     YM5728 36007902
*                                                                YM5728 36009902
         CLI   K3(RF),K8                SEE IF TASK HAS RESOURCE YM5728 36011902
         BE    PDF04155                 BRANCH IF ALREADY HELD   YM5728 36013902
*                                                                YM5728 36015902
*    VOL SER REQUESTED ALREADY IN USE ELSEWHERE                  YM5728 36016302
*                                                                YM5728 36016702
         L     RF,WTGPREFX              GET PREFIX POINTER       YM5728 36017902
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     YM5728 36018302
         B     PDF04420                 BRANCH TO CONTINUE ABEND YM5728 36018702
*                                                                YM5728 36019102
PDF04155 EQU   *                        ENQ SUCCESSFUL           YM5728 36019502
*                                                                YM5728 36019602
         LA    RB,K6(RB)                BUMP TO NEXT VOLSER      YM5728 36019702
         LA    RC,K6(RC)                POINT TO NEXT VOL SER    YM5728 36019802
         CR    RB,RD                    CHECK FOR END            YM5728 36029802
         BL    PDF04150                 BRANCH IF MORE VOLS      YM5728 36031802
*                                                                YM5728 36033802
         L     RF,WTGPREFX              GET PREFIX POINTER       YM5728 36035802
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     YM5728 36037802
         EJECT                                                          36038202
         LA    RET,ONE                  SET VOL SEQ NO. TO ONE          36039802
         LTR   RC,RC                    HAVE ALL VOLS BEEN MOVED        36200021
         BZ    PDF04320                 YES, TEST IF BUFFER TO BE FREED 36300021
*                                                                Y02134 36350002
PDF04160 EQU   *                        GET CORE FOR JFCB EXTENSION     40206002
*                                                                Y02082 40206402
*                                       DATA MANAGEMENT KEY      Y02082 40206802
*                                                                Y02082 40207202
         MODESET EXTKEY=DATAMGT         KEY 5                    Y02082 40207602
         LR    RTIOT,R1                 SAVE PTR TO WORK AREA           40208000
         IECRES GET,LV=L'DXJBF,PREFIX=YES,  GET CORE FOR Q MGR   Y02144*40216002
               STM=(2,14,WTGPREFX),ID=JFWA                       Y02144 40218002
*                                                                       40248000
         LR    RF,R1                    SAVE JFCB EXT BUFFER     Y02134 40248402
         LA    R1,JFCBEXAD              JFCB EXTENSION TTR       Y02134 40250002
*                                                                       40260000
         EJECT                                                          40260402
PDF04165 EQU   *                        LOCATE AND MOVE JFCB EXTENSION  40262002
*                                                                       40266000
         CLC   JFCBEXAD-JFCBEXAD(L'JFCBEXAD,R1),CONF0 VALID PTR  Y02134 40268002
         BZ    PDF04510                 BRANCH IF INVALID        YM5728 40270402
         MVC   DXWORK(L'JFCBEXAD),JFCBEXAD-JFCBEXAD(R1) SAVE PTR Y02134 40270602
*                                                                Y02134 40270802
         IECRES LOCJFCB,(R1)            LOCATE JFCB              Y02134 40272002
*                                                                       40286000
         MVC   DXJBF-DXJBF(L'DXJBF,RF),DXJBF-DXJBF(R1) MOVE EXT  Y02134 40288002
*                                                                Y02134 40290002
         CH    RET,CONH15               SEQ NO. GREATER THAN 15         40300021
         BNH   PDF04220                 NO, USE THIS EXTENSION   Y02134 40400002
         SH    RET,CONH15               SUBTR NO. VOLS IN EXT BLK       40500021
         B     PDF04165                 SET UP TO READ ANOTHER EXT      40860000
         EJECT                                                          40870002
PDF04220 EQU   *                        CALC LNG FO MOVE TO JFCB        40900002
         LR    R1,RF                    R1 POINTS TO JFCB        YM5728 40910002
*                                       EXTENTION IN WORKAREA    YM5728 40920002
         MVC   PDMSGLNG(TWO),CONH16     MOVE CONSTANT TO WKAREA         41000021
         BAL   RF,PDF04360              GO TO COMMON RTN TO DETERMINE   41100021
*                                       NO. VOLS TO BE MOVED INTO JFCB  41200021
*                                       CALCULATE LNG OF MOVE AND       41300021
*                                       START POINT                     41400021
         SR    RCORE,RET                RESTORE WKAREA PTR RCORE YM5728 41402002
*                                       IS BUMPED BY VALUE IN RETYM5728 41404002
*                                       BY SUBRTN AT PDF04360    YM5728 41406002
         L     RF,WTGPREFX              WTG PREFIX               Y02082 41410002
         STM   RB,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS    Y02082 41420002
         MODESET EXTKEY=SUPR                                     Y02082 41430002
PDF04222 EQU   *                        MOVE VOLS TO JFCB EXT    Y02082 41440002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND, GET LOCAL LOCK   Y02082*41450002
               RELATED=(FREEMAIN,IFG0199E(PDF04242))             Y02082 41460002
         LM    RB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS         Y02082 41470002
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY              Y02082 41480002
         LR    RF,R0                    R0 CONTAINS LNG OF FIELD TO BE  41500021
*                                       MOVED TO EXTENSION BLOCK        41600021
         EX    RF,PDF04301              ENSURE IN USER CORE      Y02082 41610002
         MODESET EXTKEY=ZERO            KEY 0                    Y02082 41620002
         AR    R1,RET                   POINT TO VOL SER         YM5728 41630002
         EX    RF,PDF04300              MOVE VOLS TO EXTENSION BLOCK    41700021
         SR    R1,RET                   RESTORE POINTER          YM5728 41702002
         LA    RD,ONE(RF,RD)            BUMP PTR TO USER BUFFER  YM5728 41710002
         L     RF,WTGPREFX              WTG PREFIX               Y02082 42710002
         STM   RB,RET,IECREGSV-IECPREFX(RF) SAVE REGS            Y02082 42720002
PDF04242 EQU   *                        WRITE BACK JFCB EXT      Y02082 42730002
         SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       Y02082*42740002
               RELATED=(FREEMAIN,IFG0199E(PDF04222))             Y02082 42750002
         LM    RB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS         Y02082 42760002
         EJECT                                                          42760102
*                                                                YM5728 42760402
*        REG 0 = LENGTH OF VOLS MOVED - 1                        YM5728 42760802
*        REG 9 POINTS TO PD WORKAREA                             YM5728 42760902
*        REG 14 = OFFSET TO VOL SER FROM JFCB EXTENSION (PTR R1) YM5728 42761202
*        REG 15 = POINTER TO IECPREFX                            YM5728 42761602
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        YM5728 42761702
         LR    RD,R0                    LOAD LENGTH              YM5728 42761802
         LA    RD,K1(RD)                INCREMENT                YM5728 42761902
         LA    RC,K4(RET,R1)            POINT TO VOL SER         YM5728 42764602
         XR    RB,RB                    INIT TO ZERO FOR LOOP    YM5728 42766602
         LR    R1,RTIOT                 LOAD PD WORKAREA PTR     YM5728 42766702
         LA    RTIOT,PDTRCDAT           POINT TO ENQ AREA        YM5728 42767602
         USING PDTRCDAT,RTIOT                                    YM5728 42768002
*                                                                YM5728 42768102
PDF04250 EQU   *                        ENQ NEW VOL SERS         YM5728 42768202
*                                                                YM5728 42768302
         MVC   PDTRCDAT(K16),ENQLIST    INIT ENQLIST             YM5728 42768602
         L     RF,DXJSCBAD              LOAD JSCB ADDRESS        YM5728 42769002
         L     R0,JSCBTCBP-IEZJSCB(,RF) INITIATOR TCB POINTER    YM5728 42769402
         ENQ   (,(RC)),TCB=(0),RET=USE,MF=(E,PDTRCDAT+4),        YM5728X42770302
               RELATED=(SYSZVOLS,IFG0194A(VUS02450))             YM5728 42770702
         DROP  RTIOT                                             YM5728 42771102
*                                                                YM5728 42781102
         LTR   RF,RF                    VOLUME ALREADY IN USE    YM5728 42782702
         BZ    PDF04255                 BRANCH IF NOT IN USE     YM5728 42783102
*                                                                YM5728 42783502
         CLI   K3(RF),K8                SEE IF TASK HAS RESOURCE YM5728 42783902
         BE    PDF04255                 BRANCH IF ALREADY HELD   YM5728 42784302
*                                                                YM5728 42784402
*    VOL SER REQUESTED ALREADY IN USE ELSEWHERE                  YM5728 42784602
*                                                                YM5728 42787102
         L     RF,WTGPREFX              GET PREFIX POINTER       YM5728 42789102
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     YM5728 42789502
         LR    R1,RTIOT                 RESTORE WORKAREA PTR     YM5728 42789602
         B     PDF04420                 BRANCH TO CONTINUE ABEND YM5728 42789702
*                                                                YM5728 42790502
PDF04255 EQU   *                        ENQ SUCCESSFUL           YM5728 42790902
*                                                                YM5728 42791302
         LA    RB,K6(RB)                BUMP TO NEXT VOLSER      YM5728 42793402
         LA    RC,K6(RC)                POINT TO NEXT VOL SER    YM5728 42795402
         CR    RB,RD                    CHECK FOR END            YM5728 42795502
         BL    PDF04250                 BRANCH IF MORE VOLS      YM5728 42795602
*                                                                YM5728 42795702
         L     RF,WTGPREFX              GET PREFIX POINTER       YM5728 42796402
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     YM5728 42796802
         EJECT                                                          42797202
         MODESET EXTKEY=DATAMGT         KEY 5                    Y02082 42797902
         LA    RET,ONE                  SET VOL SEQ  TO ONE             42800021
         LR    R0,R1                    R0 POINTS TO JFCB        YM5728 42810002
         LA    R1,DXWORK                R1 POINTS TO JFCB PTR    YM5728 42950002
         IECRES WRJFCB,(1),(0)          WRITE BACK EXTENSION     YM5728 43918002
*                                                                       44000021
         LTR   RC,RC                    HAVE ALL VOLS BEEN MOVED        44100021
         BZ    PDF04310                 BRANCH IF YES TO TEST    YM5728 44200002
*                                       IF USER BUFFER FREED     YM5728 44210002
         LR    R1,R0                    R1 POINTS TO JFCB        YM5728 44300002
*                                       EXTENTION WORKAREA       YM5728 44310002
         LR    RF,R1                    AS DOES RF               YM5728 44320002
         B     PDF04165                 GO FILL NEXT EXTENSION BLK      44400002
PDF04280 MVC   JFCBVOLS(ZERO),ORG(RD)   MOVE VOLSERS TO JFCB            44500002
PDF04281 OC    ORG(ZERO,RD),ORG(RD)     CHECK IF IN USER KEY     Y02082 44510002
PDF04300 MVC   K4(K0,R1),ORG(RD)        MOVE IN VOL SERS         Y02134 44600002
PDF04301 OC    ORG(ZERO,RD),ORG(RD)     CHECK IF IN USER KEY     Y02082 44610002
         EJECT                                                          44660002
PDF04310 EQU   *                        RESTORE PD WORKAREA ADDR YM5728 44670002
*                                                                       44672002
         LR    R1,RTIOT                 PROB DET WORKAREA        YM5728 44680002
*                                                                       44690002
*  FREEMAIN USER RECOVERY WORK AREA IF USER REQUESTED THAT IT BE FREED. 44695037
*                                                                       44696037
PDF04320 EQU   *                        CHK TO FREE USER BUFFER         44700002
*                                                                Y02082 44710002
*                                       USER KEY                 Y02082 44720002
*                                                                Y02082 44730002
         MODESET KEYADDR=DXUKEY,WORKREG=15 USER KEY              Y02082 44740002
         TM    TWO(RB),FREEBUF          USER BUFFER TO BE FREED         44800021
         BNO   PDF04520                 NO, GO FREE P.D. WKAREA         44900021
         LR    RD,R1                    SAVE PD WKAREA PTR              45000021
         LH    R0,0(,RB)                BUFFER LNG             @ZA01340 45800037
         ICM   R0,B'1000',THREE(RB)     SUBPOOL NO.            @ZA01340 45900037
         LR    R1,RB                    BUFFER PTR                      46100021
         MODESET EXTKEY=DATAMGT         RESUME DATA MNGMT KEY  @ZA01340 46150037
*        ASSUME SAME STATE AS PD DCB ABEND EXIT X'11' SO THAT  @ZA01340 46200037
*        SUBPOOL NUMBER MEANS THE SAME AS IT DID FOR THE USER. @ZA01340 46300037
         LA    RF,PDF04330              POINT TO 'EXIT ROUTINE'@ZA01340 46350037
         IECRES UEXIT,STM=(2,13,WTGPREFX),EXITAD=(15)          @ZA01340 46400037
         LR    R1,RD                    RESTORE WKAREA PTR              46500021
         B     PDF04520                 PRESS FORWARD            Y02082 46510002
*                                                                       46520037
*  THE FOLLOWING FREEMAIN IS EXECUTED IN USER STATE.           @ZA01340 46530037
PDF04330 EQU   *                                               @ZA01340 46540037
         FREEMAIN R,LV=(0),A=(1)        FREEMAIN USER BUFFER   @ZA01340 46550037
         BR    RET                      RETURN FROM UEXIT      @ZA01340 46560037
         EJECT                                                          46700021
*********************************************************************** 46800021
*                                                                     * 46850002
*    THE NUMBER OF SLOTS TO BE FILLED IS CALCULATED BY SUBTRACTING      48200021
*    FROM THE VOLUME SEQUENCE NUMBER, 6(THE CAPACITY OF A JFCB + 1),    48300021
*    OR 16( THE CAPACITY OF A JFCB EXTENSION BLOCK + 1), AND MAKING     48400021
*    THE RESULT POSITIVE.  THIS IS THE NUMBER OF SLOTS AVAILABLE IN     48500021
*    THE JFCB OR CURRENT EXTENSION BLOCK.  THEN THIS NUMBER IS          48600021
*    SUBTRACTED FROM THE NUMBER OF VOLS TO BE CHANGED.  IF THIS RESULT  48700021
*    IS POSITIVE, THEN THERE ARE MORE SLOTS AVAILABLE THAN THERE ARE    48800021
*    VOLS TO BE CHANGED, AND THE NUMBER OF SLOTS IS SET EQUAL TO THE    48900021
*    NUMBER OF VOLS TO BE CHANGED.  IF THE RESULT IS NEGATIVE, THE      49000021
*    NUMBER OF SLOTS OPEN IS USED TO CALCULATE THE LENGTH OF THE FIELD  49100021
*    TO BE MOVED.                                                       49200021
*                                                                       49300021
*    THE VALUE CALCULATED IS MULTIPLIED BY 6, AND 1 IS SUBTRACTED FROM  49400021
*    IT.  THIS IS THE LENGTH OF THE FIELD TO BE MOVED TO THE JFCB OR    49500021
*    EXTENSION.                                                         49600021
*                                                                       49700021
*    THE VOLUME SEQUENCE NUMBER IS RESTORED IN A REGISTER, AND          49800021
*    MULTIPLIED BY 6.  THIS IS USED AS AN INDEX INTO THE JFCB OR        49900021
*    EXTENSION BLOCK.  IT IS ADDED TO RCORE, THE O/C/EOV WKAREA PTR SO  50000021
*    THAT REFERRING TO THE FIELDS BY SYMBOLIC NAME WILL AUTOMATICALLY   50100021
*    GET THE PROPER LOCATION.  THE PTR WILL BE RESTORED BY THE CALLING  50200021
*    RTN.                                                               50300021
*                                                                     * 50400021
*********************************************************************** 54100021
*                                                                     * 54150002
PDF04360 EQU   *                        CALC NO. OF SLOTS TO FILL       54300002
         SH    RET,PDMSGLNG             SUBTR CONST (6 FOR MAIN JFCB,   54400021
         LPR   RET,RET                  16 FOR EXTENSION) AND FIND      54500021
*                                       THAT CONSTANT'S COMPLEMENT OF   54600021
*                                       VOL SEQ NO.  THAT WILL BE THE   54700021
*                                       NO. OF SLOTS OPEN IN THE JFCB   54800021
*                                       OR EXTENSION BLOCK.             54900021
         SR    RC,RET                   SUBTR NO. SLOTS OPEN FROM NO.   55000021
*                                       VOLS TO BE CHANGED              55100021
         LR    R0,RET                   NO. SLOTS TO BE FILLED          55200021
         BNM   PDF04380                 IF RESULT IS NOT NEGATIVE       55300021
*                                       FIND START OF MOVE              55400021
         AR    RET,RC                   IF NEGATIVE, THERE ARE MORE     55500021
*                                       SLOTS THAN VOLS. REDUCE NO.     55600021
*                                       SLOTS TO EQUAL NO. VOLS.        55700021
*                                       COUNT EQUAL TO ZERO.            55800021
         LR    R0,RET                   NO. SLOTS TO BE FILLED          55900021
         SR    RET,RC                   RESTORE COMPLEMENT OF VOL SEQ   56000021
*                                       NUMBER                          56100021
         SR    RC,RC                    VOL COUNT = 0                   56200021
PDF04380 EQU   *                        CALC LNG OF MOVE & START POINT  56300002
         MH    R0,CONH6                 MULTIPLY BY VOLID LNG           56400021
         BCTR  R0,ZERO                  SUBTR ONE FOR EX                56500021
         SH    RET,PDMSGLNG             RESTORE VOLUME                  56600021
         LPR   RET,RET                  SEQUENCE NUMBER                 56700021
         BCTR  RET,ZERO                 SUBTR ONE FOR USE AS INDEX      56800021
         MH    RET,CONH6                MULTIPLY BY VOLID LNG           56900021
         AR    RCORE,RET                ADD TO WKAREA PTR FOR USE       57000021
*                                       AS INDEX                        57100021
         BR    RF                       RETURN TO CALLER                57200021
         EJECT                                                          57300021
PDF04420 EQU   *                        CHK FOR VALID DELAY ABEND       58800002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02144 58850002
         TM    PDABCODE+ONE,DEL         IS DELAY VALID FOR THIS ABEND   58900021
         BNO   PDF04480                 NO, ABEND                       59000021
         OI    JFCBMASK+FOUR,JFCABEND   INDICATE A DELAYED ABEND YM1195 59010002
PDF04430 EQU   *                        CHK FOR A.M. EXEC CALL   YM1195 59020002
         MVC   DXABCODE,PDABCODE        ABEND CODE TO WORKAREA   YM1342 59100002
         MVC   DXRETCOD,PDRETCOD        RETURN CODE TO WORKAREA  YM1342 59300002
         NI    DCBOFLGS,FULL-DCBBUSY    TURN OFF BUSY BIT               59700021
         L     RDCB,DXUDCBAD            USER'S DCB               Y02080 60050002
         MODESET KEYADDR=DXUKEY,WORKREG=15 GET INTO USER'S KEY   Y02080 60060002
         NI    DCBOFLGS,FULL-DCBBUSY    TURN OFF BUSY BIT        Y02080 60070002
         MODESET EXTKEY=DATAMGT         RETURN TO DM KEY         Y02080 60080002
         L     RDCB,DXPDCBAD            RETURN TO COPIED DCB     Y02080 60090002
         LA    RET,FOUR                 LOAD BR TABLE ERR CODE          60100021
         L     RF,DXATCOM3              GET RRPLIST PTR          Y02144 60200002
         USING RRPLIST,RF                                        Y02144 60250002
         TM    RRFLAGS1,RRFAMEXG+RRFAMEXR  DID AN OPEN A.M.      Y02144 60260002
*                                       EXECUTOR CALL PROB DET   Y02144 60270002
         BNM   PDF04540                 NO, GET OUT              Y02144 60290002
         USING WTGENTRY,RWTGC           DEFINE BASE TO WTG ENTRY YM3018 60290502
         XC    WTGIDTTR,WTGIDTTR        ZERO ID AND EPA FIELDS   Y03018 60291002
         LA    RWTGC,WTGENTRY-WTG(,RWTG) PT TO FIRST WTG ENTRY   YM3907 60291502
*                                                                YM3018 60291602
*        ZERO THE EPA FIELD OF THE FIRST WTG ENTRY WITH A        YM3018 60291702
*        NON-ZERO ID SINCE THAT FIELD MAY NOT CONTAIN AN EPA.    YM3018 60291802
*        THE OPEN/CLOSE MODULE THAT WILL NOW BE GIVEN CONTROL    YM3018 60291902
*        RELIES ON THAT FIELD BEING A VALID EPA OR ZERO WHEN     YM3018 60292002
*        GIVING CONTROL TO THE IGG MODULE WHOSE NAME IS SET UP   YM3018 60292102
*        FROM THE FIRST WTG ENTRY WITH A NON-ZERO ID.            YM3018 60292202
*                                                                YM3018 60292302
PDF04434 EQU   *                        CHK WTG ENTRIES          YM3018 60292402
         CLI   WTGIDTTR,ZERO            IS ENTRY ID ZERO         YM3018 60292602
         BNE   PDF04438                 BR NO TO ZERO EPA FIELD  YM3018 60292802
         LA    RWTGC,L'WTGENTRY(RWTGC)  INCR TO NEXT WTG ENTRY   YM3018 60293002
         B     PDF04434                 BR TO CHK NEXT WTG ENTRY YM3018 60293202
PDF04438 EQU   *                        ZERO EPA, PT TO NEXT MOD YM3018 60293402
         XC    WTGIDTTR+TWO(THREE),WTGIDTTR+TWO  ZERO EPA FIELD  Y03018 60294002
         DROP  RWTGC                                             YM3018 60294502
         LA    RC,OPAMSET               PT TO IFG0196V NAME/EPA  YM3122 60295002
         CLI   WTGMODNM+FOUR,CHAR1      ENTRY FROM OPEN EXEC     YM1195 60296002
         BE    PDF04440                 BRANCH YES               YM1195 60298002
         LA    RC,CLAMSET               PT TO IFG0200W NAME/EPA  YM3122 60300002
         LA    RET,TWELVE               LOAD BR TABLE ERROR CODE YM1195 60302002
PDF04440 EQU   *                        GO TO OPEN/CLOSE MODULE  YM1195 60310002
*                                                                YM1195 60320002
*        RETURN TO THE OPEN/CLOSE MODULE THAT WILL SET UP        YM1195 60330002
*        REGISTERS FOR RETURN TO THE ACCESS METHOD EXECUTORS     YM1195 60340002
*        UNDER A DELAYED/IGNORED ABEND CONDITION.                YM1195 60350002
*                                                                YM1195 60360002
         IECRES LOAD,MODNM=(RC),PREFIX=WTGPREFX,BRANCH=DIRECT    YM3122 60370002
         EJECT                                                          60380002
PDF04450 EQU   *                        VALIDITY CHK IGNORE ABND YM1195 60390002
         TM    PDABCODE+ONE,IGN         CAN THIS ERROR BE IGNORED       60400021
         BNO   PDF04480                 NO, ABEND                       60500021
PDF04460 EQU   *                        INDICATE IGNORE ABEND           60600002
         OI    DXATOPEN,DXATIGN         AN IGNORED ABEND EXISTS  Y02144 60750002
         B     PDF04430                 GET OUT                  Y02144 61100002
PDF04480 EQU   *                        CHK FOR ABEND IN CNTRL AT EOV   61200002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 61210002
         L     RF,CVTPTR                POINT TO CVT                    61300021
         L     RF,CVTTCBP-CVT(RF)       TCB DOUBLE WORDS                61400021
         L     RF,FOUR(RF)              POINT TO CURRENT TCB            61500021
         TM    TCBFLGS1-TCB(RF),TCBFA   IS ABEND IN CONTROL             61600021
         BNO   PDF04485                 NO,ISSUE ABEND           YM0899 61753600
         TM    PDABCODE,EOV             EOV CALLED BY ABEND      A51158 61760000
         BNO   PDF04460                 NO, IGNORE ERROR         A51158 61760500
*                                       IF EOV IGNORES ERROR     A51158 61760900
*                                       WHEN CALLED BY ABEND, IT A51158 61761300
*                                       MAY CAUSE ABEND TO PROG  A51158 61763400
*                                       PROG CHECK BECAUSE ABEND A51158 61766400
*                                       DOESN'T EXPECT TO GET    A51158 61766800
*                                       CONTROL BACK WITH A      A51158 61767200
*                                       CLOSED DCB               A51158 61767600
         EJECT                                                          61769602
PDF04485 EQU   *                        SET UP TO ISSUE ABEND    YM0899 61769902
         MVC   DXABCODE,PDABCODE        ABEND CODE TO WORKAREA   YM1342 61779902
         MVC   DXRETCOD,PDRETCOD        RETURN CODE TO WORKAREA  YM1342 61789902
         L     RDCB,DXUDCBAD            RESTORE CALLERS REG 2  @ZA10633 61839937
         LM    RTIOT,RET,DXREG9         RESTORE CALLERS REGS   @ZA10633 61869937
*                                       4-14. CANNOT RESTORE   @ZA03152 61899937
*                                       REG 3-NEEDED BY ABEND  @ZA03152 61933237
*                                       MACRO                  @ZA03152 61953237
         SR    RF,RF                    ZERO RETURN CODE REG            61966737
         IC    RF,PDRETCOD              RETURN CODE IN REG 15           62000021
         LH    R1,PDABCODE              ABEND CODE IN REG 1             62100021
         SRL   R1,FOUR                  ZERO MASK BITS                  62200021
         ABEND (1),DUMP,,SYSTEM,        SYSTEM ABEND WITH DUMP   Y02080*62250002
               DUMPOPT=SNAPLIST                                  Y02144 62300002
         EJECT                                                          62350002
PDF04510 EQU   *                        RESTORE PD WORKAREA ADDR YM5728 62360002
*                                                                       62370002
         LR    R1,RTIOT                 PROB DET WORKAREA        YM5728 62380002
*                                                                       62390002
PDF04520 EQU   *                        GO RETRY               @ZA01291 63500000
         MODESET EXTKEY=DATAMGT         DATA MGMNT KEY         @ZA01291 63550000
         L     RET,DXREGE               RESTORE REG 14           Y02134 63600002
         MVC   ORG(FIVE,RWTGC),DXRETMOD MOVE RETURN MOD ID TO WTG TBL   63800021
         MVC   DXRETMOD,DXSAVMOD        SET UP RET MOD           Y02134 63810002
         MVC   DXRETCOD,DXSAVOFF        RESTORE RETURN OFFSET    Y02134 63820002
PDF04540 EQU   *                        RETURN VIA BRANCH QUEUED        64000002
         LA    RF,DXDCB                 PTR TO WKAREA DCB               64100021
         ST    RF,IOBDCBPT-ONE          RESTORE IOB DCB PTR             64200021
*                                       IN CASE IT WAS MODIFIED         64300021
*                                       TRYING TO RECOVER               64400021
         LM    RTIOT,RD,DXREG9          RESTORE REGS 9-13               64500021
         LM    R0,R1,DXREG0             RESTORE REGS 0-1                64600021
         IECRES LOAD,BRANCH=QUEUED                               Y02080 64750002
         EJECT                                                          64750402
ENQLIST  DC    A(0)                     DEQ LIST                 YM5728 64752002
         ENQ   (SYSZVOLS,,E,6,SYSTEM),TCB=,RET=USE,MF=L          YM5728 64754002
SYSZVOLS DC    CL8'SYSZVOLS'            VOL SER ENQ MAJOR NAME   YM5728 64756002
         EJECT                                                          64760002
         DS    0F                                                       64800021
CONF0    DC    F'0'                     CONSTANT OF ZERO         Y02134 64850002
CONH5    DC    H'5'                     CONST USED IN RECOVERY          65100021
CONH6    DC    H'6'                     CONST USED IN RECOVERY          65200021
CONH15   DC    H'15'                    CONST USED IN RECOVERY          65300021
CONH16   DC    H'16'                    CONST USED IN RECOVERY          65400021
SNAPLIST SNAP  SDATA=TRT,MF=L           READ ONLY SNAP LIST FOR  Y02144*65750002
                                        ABEND OPTION DUMPOPT     Y02144 65800002
         XCTLTABL ID=(OPAMSET,IFG0196V,CLAMSET,IFG0200W),        Y02144*66460002
               BRT=YES,LENGTH=                                   Y02144 66461002
         EJECT                                                          66470002
         IECPDSCT                                                       66500021
         EJECT                                                          66550002
         IECDSECS MAIN,TCB,CVT,DCB,TIOT,WTG,PREFX,PSA,JSCB,      YM5728*66600002
               RRPL,EXPAND=YES                                   Y02144 66650002
         END                                                            66700021
